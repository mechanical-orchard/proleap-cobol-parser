000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.      EPKUT144.                                       00020001
000300 AUTHOR.          NANCY MARTIN.                                   00030001
000400 DATE-WRITTEN.    JUNE 2004.                                      00040006
000500                                                                  00050001
000600*--------------------------------------------------------------*  00060001
000700*                                                              *  00070001
000701*  EPKUT144 - FULL FPLU EXTRACT.                               *  00070001
000702*                                                              *  00070001
000800*  INPUTS:                                                     *  00080001
000900*  01  EPCC045   CONTAINS NUMBER OF DAYS BEFORE OPENING TO     *  00090006
001000*     (EPRD045)  INCLUDE NEW STORES.                           *  00100001
001100*                                                              *  00110001
001200*  02  EPCC154   CONTAINS TODAYS DATE.                         *  00120001
001300*     (EPWS140)                                                *  00130001
001400*                                                              *  00140001
001500*  03  EPCC155   CONTAINS TOMORROWS DATE.                      *  00150001
001600*     (EPWS112)                                                *  00160001
001700*                                                              *  00170001
001800*  04  EPCC161   CONTAINS PREVIOUS AND NEXT "NEW" DAY DATES    *  00180001
001900*     (EPWS161)  FOR FPLU.                                     *  00190001
002000*                                                              *  00200001
002400* OUTPUTS:                                                     *  00240001
002500*                                                              *  00250001
002600*  01  EPRD136   FILE OF FPLU ADDS (POTENTIALLY FROM FUTURE    *  00260001
002700*     (EPRD136)       PERM AND / OR CLEARANCE PRICING DATA).   *  00270001
002800*                                                              *  00280001
002900*  01  EPRD220   FILE OF FPLU ADDS (POTENTIALLY FROM FUTURE    *  00260001
003000*     (EPRD220)       PERM AND / OR CLEARANCE PRICING DATA).   *  00270001
003100*                     THIS OUTPUT FILE WILL BE USED TO LOAD    *  00280001
003101*                     SQLSERVER TABLE SKU_PRICG.               *  00290001
003102*                                                              *  00290001
003103* DESCRIPTION:                                                 *  00300001
003104*                                                              *  00310001
003105*      THIS PROGAM DOES FULL (OR ALL DATA FOR TIME PERIOD)     *  00320001
003106*  EXTRACT OF FUTURE PRICE CHANGE DATA TO SEND TO STORES       *  00320001
003107*  REQUESTED (I.E. INITIAL FILE FOR NEW STORES OR TO REFRESH   *  00320001
003108*  DATA AT A STORE THAT HAS HAD APPLY PROCESS PROBLEMS).       *  00320001
003200*      PROGRAM MAJOR PURPOSE IS TO CREATE ADD RECORDS FOR      *  00320001
003300*  FUTURE PERM PERMANENT PRICE CHANGES. RED TICKET PRICING IS  *  00330012
003400*  NO LONGER EXTRACTED OR NEEDED.                              *  00340001
003500*     ** NOTE: ALL PRICING GROUP TYPES WILL BE SENT AS STORE   *  00350006
003600*  SPECIFIC DATA (I.E. CORPRATE LEVEL; AD VERSION, ETC.)       *  00360001
003700*     ** NOTE: NO "NEXT NEW DAY" ITEMS WILL BE CREATED BY      *  00370012
003800*  THIS PROGRAM, SINCE THEY SHOULD ALL COME OUT IN REGULAR     *  00380012
003900*  DAY PROCESSING AND NOT NEED TO BE REPEATED FROM THIS PGM.   *  00390012
004000*                                                              *  00400001
004100*  XS SKU TABLE IS CHECKED FOR GET SOME DATA ELEMENTS TO SEND  *  00410001
004200*  AND CHECK TO SEE IF THE ITEM SHOULD BE EXCLUDED.            *  00420001
004300*       OUTPUT RECORDS WILL DEFAULT DATA NON-DIRECTLY ATTAINED.*  00430001
004400*                                                              *  00440001
004500*--------------------------------------------------------------*  00450001
004600*--------------------------------------------------------------*  00460001
004700* HISTORY LOG:                                                    00470001
004800*--------------------------------------------------------------*  00480001
004900* DATE:        JAN. 28, 2005                                      00490001
005000* WR/IR#:      WR27634                                            00500001
005100* PROGRAMMER:  NANCY MARTIN                                       00510001
005200* DESCRIPTION: REMOVE XST_CLR_PRCHG AND USE DATA FROM PRCHG       00520001
005300*              TABLES FOR RED TICKET DATA (+ ADD PRICING GRIDS)   00530001
005400*                                                                 00530001
005500* DATE:        FEB. 01, 2009                                      00490001
005600* WR/IR#:      WR35484                                            00500001
005700* PROGRAMMER:  DENORRIS COOKS                                     00510001
005800* DESCRIPTION: ADDED PARA: 7200-; 7300-; AND 8100-:               00520001
005900*              THESE PARAGRAPHS WILL STORE AND WRITE DATA FROM    00530001
006000*              PCHG-CSR CURSOR INTO NEW COPYBOOK EPRD220. THIS    00530001
006100*              DATA WILL BE USED TO LOAD THE SQLSERVER TBL        00530001
006200*              SKU_PRICG.                                         00530001
006300*                                                                 00530001
006400*              REMOVED LOGIC TO EXTRACT RED TICKET PRICING.       00530001
006500*              FOR IT IS NO LONGER NEEDED.                        00530001
006600*                                                                 00530001
006700*              ADDED M.LAST_UPD_TMST TO PCHG-CSR CURSOR TO BE     00530001
006800*              EXTRACTED FOR LOADING INTO SKU_PRICG SQLSERVER     00530001
006801*              TABLE WITH OTHER DATA THAT IS ALREADY IN THE CSR.  00530001
006802*                                                                 00530001
006804* DATE:        FEB. 09, 2011                                      00490001
006805* WR/IR#:      PBI11409/PKE6877                                   00500001
006806* PROGRAMMER:  MARGARET MORRISON                                  00510001
006807* DESCRIPTION: REMOVE NT10 PROCESSING.  ALSO, REMOVE REMAINDER    00520001
006808*              OF RED TICKET PROCESSING.                          00530001
006811*                                                                 00530001
006812*--------------------------------------------------------------*  00480001
006813* DATE:                                                           00490001
006814* WR/IR#:                                                         00500001
006815* PROGRAMMER:                                                     00510001
006816* DESCRIPTION:                                                    00520001
006817*                                                                 00530001
006818*--------------------------------------------------------------*  00540001
006819 ENVIRONMENT DIVISION.                                            00550001
006820*--------------------------------------------------------------*  00560001
006821 CONFIGURATION SECTION.                                           00570001
006822 SOURCE-COMPUTER.        IBM-3090.                                00580001
006823 OBJECT-COMPUTER.        IBM-3090.                                00590001
006824                                                                  00600001
006825 INPUT-OUTPUT SECTION.                                            00610001
006826                                                                  00620001
006827 FILE-CONTROL.                                                    00630001
006828                                                                  00640005
006829     SELECT CC-PRIOR-OPEN                                         00650001
006830            ASSIGN TO INP01.                                      00660005
006831                                                                  00670001
006840     SELECT CC-TODAY                                              00680001
006900            ASSIGN TO INP02.                                      00690001
007000                                                                  00700001
007100     SELECT CC-TOMORROW                                           00710001
007200            ASSIGN TO INP03.                                      00720001
007300                                                                  00730001
007400     SELECT CC-PREV-NEXT-NEW-DAY                                  00740001
007500            ASSIGN TO INP04.                                      00750001
008200                                                                  00820001
008201     SELECT FPLU-SQLSRV-FILE                                      00800005
008202            ASSIGN TO OUT01.                                      00810001
008203                                                                  00820001
008300 DATA DIVISION.                                                   00830001
008400 FILE SECTION.                                                    00840001
008500                                                                  00850001
008600*  00  EPCC045   CONTAINS NUMBER OF DAYS BEFORE OPENING TO     *  00860001
008700                                                                  00870001
008800 FD  CC-PRIOR-OPEN                                                00880001
008900     RECORDING MODE F                                             00890001
009000     BLOCK CONTAINS 0 RECORDS                                     00900001
009100     LABEL RECORDS ARE OMITTED                                    00910001
009200     DATA RECORD IS CC-PRIOR-OPEN-RECORD.                         00920001
009300 01  CC-PRIOR-OPEN-RECORD         PIC  X(080).                    00930001
009400                                                                  00940001
009500 FD  CC-TODAY                                                     00950001
009600     RECORDING MODE F                                             00960001
009700     BLOCK CONTAINS 0 RECORDS                                     00970001
009800     LABEL RECORDS ARE OMITTED                                    00980001
009900     DATA RECORD IS CC-TODAY-RECORD.                              00990001
010000 01  CC-TODAY-RECORD              PIC  X(080).                    01000001
010100                                                                  01010001
010200 FD  CC-TOMORROW                                                  01020001
010300     RECORDING MODE F                                             01030001
010400     BLOCK CONTAINS 0 RECORDS                                     01040001
010500     LABEL RECORDS ARE OMITTED                                    01050001
010600     DATA RECORD IS CC-TOMORROW-RECORD.                           01060001
010700 01  CC-TOMORROW-RECORD      PIC  X(080).                         01070001
010800                                                                  01080001
010900 FD  CC-PREV-NEXT-NEW-DAY                                         01090001
011000     RECORDING MODE F                                             01100001
011100     BLOCK CONTAINS 0 RECORDS                                     01110001
011200     LABEL RECORDS ARE OMITTED                                    01120001
011300     DATA RECORD IS CC-PREV-NEXT-NEW-DAY-RECORD.                  01130006
011400 01  CC-PREV-NEXT-NEW-DAY-RECORD     PIC  X(080).                 01140006
011500                                                                  01150001
012901 FD  FPLU-SQLSRV-FILE                                             01230005
012902     RECORDING MODE F                                             01240001
012903     BLOCK CONTAINS 0 RECORDS                                     01250001
012904     LABEL RECORDS ARE OMITTED                                    01260001
012905     DATA RECORD IS FPLU-SQLSRV-REC.                              01270005
012906 01  FPLU-SQLSRV-REC               PIC  X(260).                   01280005
012907                                                                  01290001
012908                                                                  01290001
013000 WORKING-STORAGE SECTION.                                         01300001
013100*--------------------------------------------------------------*  01310001
013200* PS - PROGRAM SWITCHES                                           01320001
013300*--------------------------------------------------------------*  01330001
013400***********WORK HERE                                              01340001
013500 01  PS-PROGRAM-SWITCHES.                                         01350001
013600********* NOTE: SAME SWITCH WILL BE USED FOR ALL CONTROL CARDS    01360005
013700     05  PS-END-OF-CNTL-CRD-SW        PIC  X(001).                01370001
013800         88  PS-END-OF-CNTL-CRD-FILE              VALUE 'Y'.      01380001
013900         88  PS-NOT-END-OF-CNTL-CRD-FILE          VALUE 'N'.      01390001
014000                                                                  01400001
014100     05  PS-END-OF-FUTURE-PERM-CSR-SW PIC  X(001).                01410005
014200         88  PS-END-OF-FUTURE-PERM-CSR             VALUE 'Y'.     01420005
014300         88  PS-NOT-END-OF-FUTURE-PERM-CSR         VALUE 'N'.     01430005
014400                                                                  01440005
014401     05  PS-END-OF-CLEARANCE-CSR-SW   PIC  X(001).                01410005
014402         88  PS-END-OF-CLEARANCE-CSR               VALUE 'Y'.     01420005
014403         88  PS-NOT-END-OF-CLEARANCE-CSR           VALUE 'N'.     01430005
014404                                                                  01440005
014500     05  PS-STORES-SW                 PIC  X(001).                01450010
014600         88  PS-STORES-FOUND                       VALUE 'Y'.     01460010
014700         88  PS-NO-STORES-FOUND                    VALUE 'N'.     01470010
014800                                                                  01480009
014900     05  PS-REFRESH-CSR-SW            PIC  X(001).                01490009
015000         88  PS-END-OF-REFRESH-CSR                 VALUE 'Y'.     01500009
015100         88  PS-NOT-END-OF-REFRESH-CSR             VALUE 'N'.     01510009
015200                                                                  01520001
015300     05  PS-WRITE-PRCHG-SW            PIC  X(001).                01530006
015400         88  PS-WRITE-PRCHG                        VALUE 'Y'.     01540006
015500         88  PS-DO-NOT-WRITE-PRCHG                 VALUE 'N'.     01550006
015600                                                                  01560001
015700*--------------------------------------------------------------*  01570001
015800* PROGRAM CONSTANTS                                               01580001
015900*--------------------------------------------------------------*  01590001
016000 01  PC-PROGRAM-CONSTANTS.                                        01600001
016100     05  PC-PROGRAM-NAME          PIC X(08) VALUE 'EPKUT144'.     01610001
016200     05  PC-MAX-RETRIES           PIC S9(4) VALUE +5 COMP.        01620004
016300     05  PC-CNT-REFRESH-CSR       PIC 9(09) VALUE 0.              01630009
016400     05  PC-FIVE-BLANKS           PIC X(05) VALUE SPACES.         01640007
016500     05  PC-TEN-BLANKS            PIC X(10) VALUE SPACES.         01650001
016600     05  PC-ASTERISK-LINE         PIC X(80) VALUE ALL '*'.        01660001
016700     05  PC-ACTIVE-STAT           PIC XX    VALUE '20'.           01670001
016800     05  PC-CLEARANCE-STAT        PIC XX    VALUE '30'.           01680001
016801     05  PC-TCKT-CLR-YELLOW       PIC X     VALUE 'Y'.            01680001
016802     05  PC-TCKT-CLR-WHITE        PIC X     VALUE 'W'.            01680001
016803     05  PC-ALL-COLORS            PIC XX    VALUE 'AL'.           01680001
016804     05  PC-NULLS                 PIC X     VALUE '~'.            01680001
016805     05  PC-COLON                 PIC X     VALUE ':'.            01680001
016806     05  PC-3CLOCK                PIC X(09) VALUE ' 03:00:00'.    01680001
016900                                                                  01690001
017000*--------------------------------------------------------------*  01700001
017100* PV- PROGRAM VARIABLES                                           01710001
017200*--------------------------------------------------------------*  01720001
017300 01  PV-PROGRAM-VARIABLES.                                        01730001
017400     05  PV-INTR-UPC-ID           PIC S9(11)   VALUE +0 COMP.     01740005
017700     05  PV-NON-CL-RTL-PRC        PIC 9(06)V99 VALUE 0.           01770005
017701     05  PV-NEW-DATE              PIC X(10)    VALUE SPACES.      01750005
017702     05  PV-PARAGRAPH-NAME        PIC X(40)    VALUE SPACES.      01760005
017703     05  PV-SQL-SUB               PIC S9(04)   VALUE 0  COMP.     01770001
017800     05  PV-ABEND-CODE            PIC 9999     VALUE 0  COMP.     01780001
018000                                                                  01800001
018100*--------------------------------------------------------------*  01810001
018200* PV- DB2 VARIABLES.                                              01820001
018300*--------------------------------------------------------------*  01830001
018400 01  PV-DB2-VARIABLES.                                            01840001
018500     05  PV-DB2-SKU-NBR           PIC S9(8)V  COMP-3 VALUE 0.     01850005
018600     05  PV-DB2-INTR-UPC-ID       PIC S9(11)  COMP-3 VALUE 0.     01860001
018601     05  PV-DB2-STYLE             PIC S9(8)V  COMP-3 VALUE 0.     01850005
018602     05  PV-DB2-STR               PIC S9(04)  COMP   VALUE 0.     01860001
018603     05  PV-DB2-DEPT              PIC S9(04)V COMP-3 VALUE 0.     01860001
018604     05  PV-DB2-MAJ-CL            PIC S9(04)V COMP-3 VALUE 0.     01860001
018605     05  PV-DB2-SUB-CL            PIC S9(04)V COMP-3 VALUE 0.     01860001
018805     05  PV-DB2-PREV-NEW-TMST     PIC X(26).                      01880001
018806     05  PV-DB2-PREV-NEW-TMST-X   REDEFINES PV-DB2-PREV-NEW-TMST. 01880001
018807        10  PV-DB2-PREV-NEW-DATE  PIC X(10).                      01880001
018808        10  PV-DB2-PREV-NEW-TIME  PIC X(16).                      01880001
018809     05  PV-DB2-NEXT-NEW-TMST     PIC X(26).                      01880001
018810     05  PV-DB2-NEXT-NEW-TMST-X   REDEFINES PV-DB2-NEXT-NEW-TMST. 01880001
018811        10  PV-DB2-NEXT-NEW-DATE  PIC X(10).                      01880001
018812        10  PV-DB2-NEXT-NEW-TIME  PIC X(16).                      01880001
018813     05  PV-NULL-FIELDS.                                          01910006
019100         10  PV-NULL-DEPT         PIC S9(04)  VALUE +0 COMP SYNC. 01910006
019200         10  PV-NULL-MAJ-CL       PIC S9(04)  VALUE +0 COMP SYNC. 01910006
019300         10  PV-NULL-SUB-CL       PIC S9(04)  VALUE +0 COMP SYNC. 01930006
019301         10  PV-NULL-STYLE        PIC S9(04)  VALUE +0 COMP SYNC. 01930006
019302         10  PV-NULL-SKU          PIC S9(04)  VALUE +0 COMP SYNC. 01930006
019303         10  PV-NULL-UNT-RTL      PIC S9(04)  VALUE +0 COMP SYNC. 01870006
019304         10  PV-NULL-NCLR-RTL-AMT PIC S9(04)  VALUE +0 COMP SYNC. 01870006
019305         10  PV-NULL-GP-PRIC-ID   PIC S9(04)  VALUE +0 COMP SYNC. 01890006
019306         10  PV-NULL-GP-RTL-QTY   PIC S9(04)  VALUE +0 COMP SYNC. 01910006
019307         10  PV-NULL-GP-RTL-AMT   PIC S9(04)  VALUE +0 COMP SYNC. 01930006
019308         10  PV-NULL-CLR-TYP      PIC S9(04)  VALUE +0 COMP SYNC. 01870006
019309         10  PV-NULL-GRID-ID      PIC S9(04)  VALUE +0 COMP SYNC. 01870006
019500                                                                  01950001
019600*--------------------------------------------------------------*  01960001
019700* EPRD045 CONTROL CARD LAYOUT - NUMBER DAYS TO SEND BEFORE OPEN   01970001
019800*--------------------------------------------------------------*  01980001
019900     COPY EPRD045.                                                01990001
020000                                                                  02000001
020100*--------------------------------------------------------------*  02010001
020200* EPRD136 FPLU RECORD LAYOUT --- OUTPUT (BOTH FILES USE SAME)     02020001
020300*--------------------------------------------------------------*  02030001
020400     COPY EPRD136.                                                02040001
020500                                                                  02050001
020501*--------------------------------------------------------------*  02010001
020502* EPRD220 FPLU SQLSERVER LAYOUT - OUTPUT (BOTH FILES USE SAME)    02020001
020503*--------------------------------------------------------------*  02030001
020504     COPY EPRD220.                                                02040001
020505                                                                  02050001
020600*--------------------------------------------------------------*  02060001
020700* EPWS112 CONTROL CARD LAYOUT - TOMMORROWS DATE                   02070001
020800*--------------------------------------------------------------*  02080001
020900     COPY EPWS112.                                                02090001
021000                                                                  02100001
021100*--------------------------------------------------------------*  02110001
021200* EPWS140 CONTROL CARD LAYOUT - TODAYS DATE                       02120001
021300*--------------------------------------------------------------*  02130001
021400     COPY EPWS140.                                                02140001
021500                                                                  02150001
021600*--------------------------------------------------------------*  02160001
021700* EPWS161 CONTROL CARD LAYOUT - FOR PREV & NEXT "NEW" DAY DATES   02170001
021800*--------------------------------------------------------------*  02180001
021900     COPY EPWS161.                                                02190001
022000                                                                  02200001
022600*--------------------------------------------------------------*  02260001
022700* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02270001
022800*--------------------------------------------------------------*  02280001
022900     COPY DPWS004.                                                02290001
023000                                                                  02300001
023100*--------------------------------------------------------------*  02310001
023200* DATE ROUTINE COPY MEMBER                                        02320001
023300*--------------------------------------------------------------*  02330001
023400     COPY DPWS500.                                                02340001
023500                                                                  02350001
023600*--------------------------------------------------------------*  02360001
023700* DB2 ABEND COPYBOOK                                              02370001
023800*--------------------------------------------------------------*  02380001
023900     COPY DPWS900.                                                02390001
024000                                                                  02400001
024100*--------------------------------------------------------------*  02410001
024200* DB2 MESSAGE AREA                                                02420001
024300*--------------------------------------------------------------*  02430001
024400     COPY SQLCA2.                                                 02440001
024500                                                                  02450001
024600*--------------------------------------------------------------*  02460001
024700* PROGRAM COUNTERS                                                02470001
024800*--------------------------------------------------------------*  02480001
024900 01  PV-PROGRAM-COUNTERS         COMP-3.                          02490001
025100**   05  PV-FUTURE-PERM-FETCHES    PIC 9(9) VALUE 0.              02510006
025200     05  PV-PRCHG-FETCHES          PIC 9(9) VALUE 0.              02520006
025600                                                                  02560001
025700     05  PV-FUTURE-PERM-COUNT      PIC 9(9) VALUE 0.              02570001
025800     05  PV-MISSING-SKU-COUNT      PIC 9(9) VALUE 0.              02580005
025810     05  PV-MISSING-STYLE-COUNT    PIC 9(9) VALUE 0.              02580005
025900     05  PV-EXCLUDE-SKU-COUNT      PIC 9(9) VALUE 0.              02590005
026100     05  PV-FOUND-SKU-COUNT        PIC 9(9) VALUE 0.              02610005
026200     05  PV-SKU-PASS-COUNT         PIC 9(9) VALUE 0.              02610005
026201     05  PV-STYLE-COUNT            PIC 9(9) VALUE 0.              02610005
026202     05  PV-HIER-CODE-COUNT        PIC 9(9) VALUE 0.              02610005
026203                                                                  02620001
026300     05  PV-CNT-OUTPUT-RECORDS     PIC 9(9) VALUE 0.              02630001
026310     05  PV-SQLSRVR-OUT-RECORDS    PIC 9(9) VALUE 0.              02630001
026700                                                                  02670001
027700*--------------------------------------------------------------*  02770001
027800* ERROR HANDLING                                                  02780001
027900*--------------------------------------------------------------*  02790001
028000 01  PV-MISC-ABEND-FIELDS.                                        02800001
028100     05  PV-OPERATION-MSG-1      PIC X(40) VALUE SPACES.          02810001
028200     05  PV-OPERATION-MSG-2      PIC X(40) VALUE SPACES.          02820001
028300     05  PV-DB2-OPERATION        PIC X(30) VALUE SPACES.          02830001
028400                                                                  02840001
028500 01  ABEND-CODE                  PIC S9(4) VALUE 0  COMP SYNC.    02850001
028600     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           02860001
028700     88  ABEND-4013-DB2-ERROR              VALUE +4013.           02870001
028800     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           02880001
028900     88  ABEND-4020-MQ-ERROR               VALUE +4020.           02890001
029000     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           02900001
029100     88  ABEND-4008-PGM-LOGIC-ERROR        VALUE +4008.           02910001
029200                                                                  02920001
029300*--------------------------------------------------------------*  02930001
029400* DB2 COMMUNICATIONS AREA                                         02940001
029500*--------------------------------------------------------------*  02950001
029600     EXEC SQL                                                     02960001
029700       INCLUDE SQLCA                                              02970001
029800     END-EXEC.                                                    02980001
029900                                                                  02990001
030000*-----------------------------------------------------------      03000006
030100* DB2 TABLE EPT00010(EPT_STR_FIL_RFRSH) - STORE FILE REFRESH      03010000
030200*                                              TABLE              03020000
030300*-----------------------------------------------------------      03030000
030400     EXEC SQL                                                     03040000
030500          INCLUDE EPT00010                                        03050000
030600     END-EXEC.                                                    03060000
030700                                                                  03070000
030800*--------------------------------------------------------------*  03080001
030900* DB2 TABLE XST00001 (XST_LOC) - LOCATION TABLE                   03090001
031000*--------------------------------------------------------------*  03100001
031100     EXEC SQL                                                     03110001
031200       INCLUDE XST00001                                           03120001
031300     END-EXEC.                                                    03130001
031400                                                                  03140001
031500*--------------------------------------------------------------*  03080001
031600* DB2 TABLE XST00013 (XST_VND_STYL) - VENDOR STYLE TABLE          03090001
031700*--------------------------------------------------------------*  03100001
031800     EXEC SQL                                                     03110001
031900       INCLUDE XST00013                                           03120001
032000     END-EXEC.                                                    03130001
032001                                                                  03140001
032002*--------------------------------------------------------------*  03150001
032003* DB2 TABLE XST00023 (XST_STR_GP_MBSHP) - STORE GRP MEMBERSHIP    03160001
032004*--------------------------------------------------------------*  03170001
032005     EXEC SQL                                                     03180001
032006       INCLUDE XST00023                                           03190001
032007     END-EXEC.                                                    03200001
032100                                                                  03210001
032101*--------------------------------------------------------------*  03150001
032102* DB2 TABLE XST00025 (XST_LOC_ATTR) - LOC ATTRIBUTE TABLE         03160001
032103*--------------------------------------------------------------*  03170001
032104     EXEC SQL                                                     03180001
032105       INCLUDE XST00025                                           03190001
032106     END-EXEC.                                                    03200001
032107                                                                  03210001
032200*--------------------------------------------------------------*  03220001
032300* DB2 TABLE XST00011 (XST_SKU) - SKU TABLE                        03230001
032400*--------------------------------------------------------------*  03240001
032500     EXEC SQL                                                     03250001
032600       INCLUDE XST00010                                           03260001
032700     END-EXEC.                                                    03270001
032800                                                                  03280001
032900*--------------------------------------------------------------*  03290006
033000* DB2 TABLE XST00011 (XST_SKU_ATTR) - SKU ATTRIBUTE TABLE         03300001
033100*--------------------------------------------------------------*  03310001
033200     EXEC SQL                                                     03320001
033300       INCLUDE XST00011                                           03330001
033400     END-EXEC.                                                    03340001
033500                                                                  03350001
033600*--------------------------------------------------------------*  03360001
033700* DB2 TABLE XST00063 (XST_PRCHG) FUTURE PERM PRICE CHANGES        03370001
033800*--------------------------------------------------------------*  03380001
033900     EXEC SQL                                                     03390001
034000       INCLUDE XST00063                                           03400001
034100     END-EXEC.                                                    03410001
034200                                                                  03420001
034300*--------------------------------------------------------------*  03430001
034400* DB2 TABLE XST00064 (XST_STR_GP_PRCHG)                           03440001
034500*           FUTURE PERM PRICE CHANGE STORE GROUPS                 03450001
034600*--------------------------------------------------------------*  03460001
034700     EXEC SQL                                                     03470001
034800       INCLUDE XST00064                                           03480001
034900     END-EXEC.                                                    03490001
035000                                                                  03500001
035001*--------------------------------------------------------------*  03430001
035002* DB2 TABLE XST00065 (XST_PRCHG_MDSE)                             03440001
035003*           FUTURE PERM PRICE CHANGE MERCHANDISE                  03450001
035004*--------------------------------------------------------------*  03460001
035005     EXEC SQL                                                     03470001
035006       INCLUDE XST00065                                           03480001
035007     END-EXEC.                                                    03490001
035008                                                                  03500001
035800                                                                  03580001
035900*--------------------------------------------------------------*  03590001
036000*  CURSOR TO IDENTIFY CHANGES TO FUTURE PERM CHANGE EVENTS     *  03600003
036200*--------------------------------------------------------------*  03620001
036300     EXEC SQL                                                     03630001
036400       DECLARE PRCHG-CSR CURSOR FOR                               03640006
036700        SELECT  S.PRCHG_EFF_DTE                                   03670006
036800               ,M.UNT_RTL_AMT                                     03680006
036900               ,M.GP_PRIC_ID                                      03690003
037000               ,M.GP_RTL_QTY                                      03700003
037100               ,M.GP_RTL_AMT                                      03710003
037200               ,M.MDSE_HIER_CDE                                   03720003
037201               ,M.DEPT_NBR                                        03720003
037202               ,M.MAJ_CL_NBR                                      03720003
037203               ,M.SUB_CL_NBR                                      03720003
037204               ,M.STYL_ID                                         03720003
037205               ,M.SKU_NBR                                         03720003
037206               ,P.PRCHG_TYP_CDE                                   03720003
037207               ,P.EVNT_CTG_CDE                                    03720003
037208               ,M.PRICG_GRID_ID                                   03720003
037209               ,M.CLR_TYP_CDE                                     03720003
037210               ,M.LAST_UPD_TMST                                           
037400          FROM  XST_PRCHG_MDSE   M                                03740003
037401               ,XST_STR_GP_PRCHG S                                03730003
037402               ,XST_PRCHG        P                                03730003
037403               ,XST_STR_GP_MBSHP G                                03740003
038100         WHERE  P.PRCHG_ST_CDE    = 'APR'                         03810006
038101           AND (S.PRCHG_EFF_DTE  >= :CC-EPCC112-TOMORROW-DATE     03760006
038102             AND S.PRCHG_EFF_DTE <= :CC-EPCC161-PREV-NEW-DATE)    03770006
038103           AND  P.PRCHG_ID       = M.PRCHG_ID                     03800006
038104           AND  S.PRCHG_ID       = M.PRCHG_ID                     03800006
038105           AND  S.LAST_ACTN_CDE <> 'D'                            03790006
038106           AND  M.LAST_ACTN_CDE <> 'D'                            03790006
038107           AND  P.LAST_ACTN_CDE <> 'D'                            03790006
038108           AND  G.STR_GP_TYP_CDE = S.STR_GP_TYP_CDE               03800006
038109           AND  G.STR_GP_ID      = S.STR_GP_ID                    03800006
038110           AND  M.STR_GP_TYP_CDE = S.STR_GP_TYP_CDE               03800006
038111           AND  M.STR_GP_ID      = S.STR_GP_ID                    03800006
038112           AND  G.STR_NBR       = :EPT00010-STR-NBR               03800006
038113           AND  EFF_BEG_DTE    <= S.PRCHG_EFF_DTE                 03760006
038114           AND (EFF_END_DTE    >= S.PRCHG_EFF_DTE                 03760006
038115             OR EFF_END_DTE  IS NULL)                             03770006
038200                                                                  03820001
038300         FOR FETCH ONLY                                           03830001
038400         WITH UR                                                  03840001
038500     END-EXEC.                                                    03850001
038600                                                                  03860001
049000*-----------------------------------------------------------      04900006
049100* REFRESH-CURSOR WILL FIND ALL THE STORES THAT NEED A FULL        04910006
049200* FILE REFRESH.                                                   04920006
049300*-----------------------------------------------------------      04930006
049400     EXEC SQL                                                     04940006
049500       DECLARE REFRESH-CURSOR CURSOR FOR                          04950006
049600            SELECT  A.STR_NBR                                     04960006
049700              FROM  EPT_STR_FIL_RFRSH A                           04970006
049800                   ,XST_LOC B                                     04980006
049900                   ,XST_LOC_ATTR C                                04990006
050000             WHERE  A.STR_NBR        = B.LOC_NBR                  05000006
050100               AND  B.LOC_NBR        = C.LOC_NBR                  05010006
050200               AND  A.RFRSH_TYP_CDE  = 'FP'                       05020006
050300               AND (A.RFRSH_DTE      IS NULL                      05030006
050400                OR  A.RFRSH_DTE      = :CC-EPCC140-TODAY-DATE)    05040006
050500               AND  B.LOC_TYP_CDE    = 'DS'                       05050006
050600               AND (C.POS_CAP_LVL_ID = 5                          05060006
050700                OR  C.POS_CAP_LVL_ID > 12)                        05070006
051200               AND  B.CLO_DTE    >= :CC-EPCC140-TODAY-DATE        05120006
051201               AND ((B.OPN_DTE   >  :CC-EPCC140-TODAY-DATE        05080006
051202               AND  B.OPN_DTE    <= :PV-NEW-DATE)                 05090006
051203                OR  B.OPN_DTE    <= :CC-EPCC140-TODAY-DATE)       05110006
051300             ORDER BY A.STR_NBR                                   05130006
051400           WITH UR                                                05140006
051500     END-EXEC.                                                    05150006
054800                                                                  05480006
054900 LINKAGE SECTION.                                                 05490001
055000                                                                  05500001
055100*--------------------------------------------------------------*  05510001
055200 PROCEDURE DIVISION.                                              05520001
055300*--------------------------------------------------------------*  05530001
055400 0000-MAINLINE.                                                   05540001
055500                                                                  05550001
055600     DISPLAY ' '.                                                 05560005
055700     DISPLAY  PC-ASTERISK-LINE                                    05570005
055800     DISPLAY '   PROGRAM NAME: ' PC-PROGRAM-NAME, ' START'.       05580005
055900     DISPLAY '*********************************************'.     05590005
056000     DISPLAY ' '.                                                 05600005
056100     PERFORM 1000-INITIALIZATION.                                 05610001
056200                                                                  05620001
056300     IF PS-STORES-FOUND                                           05630010
056400        DISPLAY PC-ASTERISK-LINE                                  05640006
056500        DISPLAY PC-FIVE-BLANKS, 'STARTING REFRESH WORK'           05650006
056600        PERFORM 2000-PROCESS-LIST                                 06400006
056700          UNTIL PS-END-OF-REFRESH-CSR                             06410006
056800                                                                          
056900        PERFORM 1790-CLOSE-REFRESH-CURSOR                         06420006
095700        DISPLAY ' REFRESH STORE COUNT -', PC-CNT-REFRESH-CSR      09570006
095701     ELSE                                                         05690005
095702        DISPLAY PC-ASTERISK-LINE                                  05700006
095703        DISPLAY PC-FIVE-BLANKS, 'NO STORES REFRESHING TODAY '     05710006
095704     END-IF.                                                      05720005
095705                                                                  05730005
095706     PERFORM 9999-WRAPUP.                                         05760001
095707                                                                  05770001
095708     GOBACK.                                                      05780001
095709                                                                  05790001
095710*0000-EXIT.                                                       05800001
095711                                                                  05810001
095712*--------------------------------------------------------------*  05820001
095713* 1000-INITIALIZATION.                                            05830001
095714*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      05840001
095715*     FILES, DOES INITIAL FETCH AND PROCESSES ANY CALCULATES      05850001
095716*     PARAMETERS IT MAY NEED.                                     05860001
095717*--------------------------------------------------------------*  05870001
095718 1000-INITIALIZATION.                                             05880001
095719                                                                  05890001
095720     INITIALIZE PC-CNT-REFRESH-CSR.                               05950006
095721                                                                  05960006
095722     OPEN INPUT  CC-PREV-NEXT-NEW-DAY,                            05970005
095724                 CC-PRIOR-OPEN,                                   05990005
095725                 CC-TODAY,                                        06000005
095726                 CC-TOMORROW.                                     06010005
095728     OPEN OUTPUT FPLU-SQLSRV-FILE.                                00800005
095729                                                                  06030001
095730     PERFORM 1100-READ-PREV-NEXT-NEW-RECORD.                      06040005
095731                                                                  06050001
095732     PERFORM 1200-READ-PRIOR-DAYS-RECORD.                         06060005
095733                                                                  06070005
095734     PERFORM 1300-READ-TODAY-RECORD.                              06080005
095735                                                                  06090005
095736     PERFORM 1400-READ-TOMORROW-RECORD.                           06100005
095737                                                                  06110005
095738     PERFORM 1500-CALC-DAYS-DATE.                                 06120006
095739                                                                  06130005
095742     DISPLAY ' '                                                  06160005
095743     DISPLAY '** CONTROL CARD DATES USED TO PROVIDE '             06170006
095744             'SELECT DATE RANGES ** '                             06180005
095745     DISPLAY PC-FIVE-BLANKS, '** EFFECTIVE DATE >=  '             06190005
095746              CC-EPCC112-TOMORROW-DATE, ' AND <='                 06200006
095747              CC-EPCC161-PREV-NEW-DATE, '***'                     06210006
095748     DISPLAY PC-FIVE-BLANKS, '* STORE SPECIFIC DATES *',          06220005
095749              '* OPEN DATE < TODAY AND CLOSE DATE > TODAY - ',    06230005
095750               CC-EPCC140-TODAY-DATE, ' **'                       06240006
095751     DISPLAY PC-FIVE-BLANKS, '*** FUTURE STORES ***'              06250005
095752              '* OPEN DATE > TODAY + OPEN DATE < CALC DAY & ',    06260005
095753              'CLOSE DATE > CALC DAY --- CALC DAY - ',            06270005
095754               PV-NEW-DATE, '**'.                                 06280006
095755                                                                          
095756     PERFORM 1710-OPEN-REFRESH-CURSOR.                            06300006
095757     PERFORM 1750-FETCH-REFRESH-CURSOR.                           06310007
095758                                                                  06320006
095759     IF PS-END-OF-REFRESH-CSR                                     06330006
095760        PERFORM 1790-CLOSE-REFRESH-CURSOR                         06340006
095761        DISPLAY 'NO STORES IDENTIFIED TO RECEIVE FPLU REFRESH'    06350006
095762        SET PS-NO-STORES-FOUND TO TRUE                            06370010
095763     ELSE                                                         06380006
095764        SET PS-STORES-FOUND TO TRUE                               06390010
095765     END-IF.                                                      06430006
095766                                                                  06440006
095767*1000-EXIT.                                                       06460001
095768                                                                  06470001
095769*--------------------------------------------------------------*  06480001
095770* 1100-READ-PREV-NEXT-NEW-RECORD.                                 06490005
095771*     READ CONTROL CARD EPCC161. THIS CONTROL CARD CONTAINS       06500005
095772*     THE PREVIOUS AND NEXT NEW FPLU DAY.                         06510005
095773*--------------------------------------------------------------*  06520001
095774 1100-READ-PREV-NEXT-NEW-RECORD.                                  06530005
095775                                                                  06540001
095776     READ CC-PREV-NEXT-NEW-DAY INTO CC-EPCC161-CONTROL-CARD       06550005
095777       AT END                                                     06560001
095778          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    06570001
095779                                                                  06580001
095780     IF PS-END-OF-CNTL-CRD-FILE                                   06590001
095781       DISPLAY ' '                                                06600001
095782       DISPLAY '** ABEND     **'                                  06610001
095783       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              06620001
095784       DISPLAY '** PARAGRAPH **  = 1100-READ-PREV-NEXT-NEW'       06630005
095785       DISPLAY '** MISSING PREV NEXT NEW DAY CONTROL CARD - 161'  06640005
095786       DISPLAY ' '                                                06650001
095787       MOVE +4002 TO ABEND-CODE                                   06660001
095788       CALL 'ILBOABN0' USING ABEND-CODE                           06670001
095789     ELSE                                                         06680001
095790       DISPLAY '** PREV NEXT NEW DAY CONTROL CARD  = '            06690005
095791                CC-PREV-NEXT-NEW-DAY-RECORD,  ' **'               06700006
095792       DISPLAY PC-FIVE-BLANKS, '** EPCC161 NEXT NEW DATE  = '     06710005
095793                CC-EPCC161-NEW-DATE, ' **'                        06720005
095794       DISPLAY PC-FIVE-BLANKS, '** EPCC161 PREV NEW DATE  = '     06730005
095795                CC-EPCC161-PREV-NEW-DATE, ' **'                   06740005
095796       DISPLAY ' '                                                06750001
095797     END-IF.                                                      06760001
095798                                                                  06770001
095799*1100-EXIT.                                                       06780001
095800                                                                  06790001
095801*--------------------------------------------------------------*  06800005
095802* 1200-READ-PRIOR-DAYS-RECORD.                                    06810005
095803*     READ CONTROL CARD EPCC045. THIS CONTROL CARD CONTAINS       06820005
095804*     NUMBER OF DAYS PRIOR TO OPENING TO CONSIDER NEW STORES      06830005
095805*--------------------------------------------------------------*  06840005
095806 1200-READ-PRIOR-DAYS-RECORD.                                     06850005
095807                                                                  06860005
095808     READ CC-PRIOR-OPEN INTO EP045-ADVDAYS-TO-SND-RECORD          06870006
095809       AT END                                                     06880005
095810          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    06890005
095811                                                                  06900005
095812     IF PS-END-OF-CNTL-CRD-FILE                                   06910005
095813       DISPLAY ' '                                                06920005
095814       DISPLAY '** ABEND     **'                                  06930005
095815       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              06940005
095816       DISPLAY '** PARAGRAPH **  = 1200-READ-PRIOR-DAYS'          06950005
095817       DISPLAY '** MISSING PRIOR DAYS CONTROL CARD - 045'         06960005
095818       DISPLAY ' '                                                06970005
095819       MOVE +4002 TO ABEND-CODE                                   06980005
095820       CALL 'ILBOABN0' USING ABEND-CODE                           06990005
095821     ELSE                                                         07000005
095822       DISPLAY '** PRIOR DAYS TO SEND STORES CARD  = '            07010005
095823                CC-PRIOR-OPEN-RECORD,  ' **'                      07020006
095824       DISPLAY PC-FIVE-BLANKS, '** EPCC045 DAYS TILL OPEN = '     07030005
095825                EP045-DAYS-TILL-STORE-OPN, ' **'                  07040005
095826       DISPLAY PC-FIVE-BLANKS, '** EPCC045 DAYS FOR METRO = '     07050005
095827                EP045-DAYS-TO-INCR-METRO, ' * (NOT USED) *'       07060006
095828       DISPLAY ' '                                                07070005
095829     END-IF.                                                      07080005
095830                                                                  07090006
095831     IF EP045-DAYS-TILL-STORE-OPN NOT NUMERIC                     07100006
095832        DISPLAY 'INVALID PRIOR DAYS CONTROL CARD 045 '            07110006
095833        DISPLAY '   DAYS UNTIL OPEN: ',                           07120006
095834                         EP045-DAYS-TILL-STORE-OPN                07130006
095835             ' ** SHOULD HAVE BEEN NUMERIC **'                    07140006
095836        MOVE 4003 TO ABEND-CODE                                   07150006
095837        CALL 'ILBOABN0' USING ABEND-CODE                          07160005
095838     END-IF.                                                      07170006
095839                                                                  07180005
095840*1200-EXIT.                                                       07190005
095841                                                                          
095842*--------------------------------------------------------------*  07200005
095843* 1300-READ-TODAY-RECORD.                                         07210005
095844*     READ CONTROL CARD EPCC154. THIS CONTROL CARD CONTAINS       07220006
095845*     TODAYS FPLU CYCLE DATE.                                     07230006
095846*--------------------------------------------------------------*  07240005
095847 1300-READ-TODAY-RECORD.                                          07250005
095848                                                                  07260005
095849     READ CC-TODAY INTO CC-EPCC140-CONTROL-CARD                   07270005
095850       AT END                                                     07280005
095851          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    07290005
095852                                                                  07300005
095853     IF PS-END-OF-CNTL-CRD-FILE                                   07310005
095854       DISPLAY ' '                                                07320005
095855       DISPLAY '** ABEND     **'                                  07330005
095856       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              07340005
095857       DISPLAY '** PARAGRAPH **  = 1300-READ-TODAY'               07350006
095858       DISPLAY '** MISSING CONTROL CARD FOR TODAYS DATE - 154'    07360006
095859       DISPLAY ' '                                                07370005
095860       MOVE +4002 TO ABEND-CODE                                   07380005
095861       CALL 'ILBOABN0' USING ABEND-CODE                           07390005
095862     ELSE                                                         07400005
095863       DISPLAY '** CONTROL CARD FOR TODAYS DATE    = '            07410006
095864                CC-TODAY-RECORD,  ' **'                           07420006
095865       DISPLAY PC-FIVE-BLANKS, '** EPCC154 TODAY DATE     = '     07430006
095866                CC-EPCC140-TODAY-DATE, ' **'                      07440006
095867       DISPLAY ' '                                                07450005
095868     END-IF.                                                      07460005
095869                                                                  07470005
095870*1300-EXIT.                                                       07480005
095871                                                                  07490005
095872*--------------------------------------------------------------*  07500005
095873* 1400-READ-TOMORROW-RECORD.                                      07510005
095874*     READ CONTROL CARD EPCC155. THIS CONTROL CARD CONTAINS       07520006
095875*     TOMORROWS DATE FOR FPLU.                                    07530006
095876*--------------------------------------------------------------*  07540005
095877 1400-READ-TOMORROW-RECORD.                                       07550005
095878                                                                  07560005
095879     READ CC-TOMORROW INTO CC-EPCC112-CONTROL-CARD                07570005
095880       AT END                                                     07580005
095881          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    07590005
095882                                                                  07600005
095883     IF PS-END-OF-CNTL-CRD-FILE                                   07610005
095884       DISPLAY ' '                                                07620005
095885       DISPLAY '** ABEND     **'                                  07630005
095886       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              07640005
095887       DISPLAY '** PARAGRAPH **  = 1400-READ-TOMORROW-RECORD'     07650006
095888       DISPLAY '** MISSING TOMORROW CONTROL CARD - 155'           07660006
095889       DISPLAY ' '                                                07670005
095890       MOVE +4002 TO ABEND-CODE                                   07680005
095891       CALL 'ILBOABN0' USING ABEND-CODE                           07690005
095892     ELSE                                                         07700005
095893       DISPLAY '** TOMORROW CONTROL CARD  = '                     07710006
095894                CC-TOMORROW-RECORD,  ' **'                        07720006
095895       DISPLAY PC-FIVE-BLANKS, '** EPCC150 TOMORROW       = '     07730006
095896                CC-EPCC112-TOMORROW-DATE, ' **'                   07740006
095897       DISPLAY ' '                                                07750005
095898     END-IF.                                                      07760005
095899                                                                  07770005
095900*1400-EXIT.                                                       07780005
095901                                                                  07790005
095902*--------------------------------------------------------------*  07800006
095903* 1500-CALC-DAYS-DATE.                                            07810006
095904*     CALCULATE THE DATE THAT TODAY PLUS THE NUMBER OF DAYS       07820006
095905*     VALUE COME OUT TO, USING DATE ROUTINE.                      07830006
095906*--------------------------------------------------------------*  07840006
095907 1500-CALC-DAYS-DATE.                                             07850006
095908                                                                  07860006
095909*    * ADD "DAYS" (BEFORE OPENING TO SEND DATA)                   07870006
095910*    * TO "TODAY" (RUN DATE)                                      07880006
095911*    *  TO GET DATE FOR NEW STORES DATE CHECKING                  07890006
095912     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         07900006
095913     SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     07910006
095914     SET  DPG52-LK-DTE-ISO-FMT       TO TRUE.                     07920006
095915     SET  DPG51-INCREMENT-DATE       TO TRUE.                     07930006
095916     MOVE CC-EPCC140-TODAY-DATE      TO DPG52-LK-DATE-INPUT.      07940006
095917     MOVE EP045-DAYS-TILL-STORE-OPN  TO DPG51-INCR-DECR-DAYS-9.   07950006
095918     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    07960006
095919                                             DPG54 DPG55 DPG56.   07970006
095920                                                                          
095921     EVALUATE TRUE                                                07980006
095922         WHEN DPG54-NO-ERROR                                      07990006
095923             DISPLAY 'CALCULATED DATE FOR FUTURE STORES',         08000006
095924                     ' (USING DPKUT500): ',                       08010006
095925                DPG55-DB2-ISO-DATE-FMT                            08020006
095926             MOVE DPG55-DB2-ISO-DATE-FMT TO PV-NEW-DATE           08030006
095927             DISPLAY '     TODAY + DAYS = FUTURE DATE'            08040006
095928                      '   TODAY (', CC-EPCC140-TODAY-DATE         08050006
095929                      ') + DAYS (', EP045-DAYS-TILL-STORE-OPN     08060006
095930                      ') = FUTURE DATE (', PV-NEW-DATE, ')'       08070006
095931         WHEN DPG54-SEVERE-ERROR                                  08080006
095932             DISPLAY ' '                                          08090006
095933             DISPLAY '** ABEND ** IN EPKUT144 '                   08100006
095934             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    08110006
095935             DISPLAY '     TODAY + DAYS = FUTURE DATE'            08120006
095936                      '   TODAY (', CC-EPCC140-TODAY-DATE         08130006
095937                      ') + DAYS (', EP045-DAYS-TILL-STORE-OPN     08140006
095938                      ') + DAYS (', EP045-DAYS-TILL-STORE-OPN     08150006
095939                      ') = FUTURE DATE (', PV-NEW-DATE, ')'       08160006
095940             DISPLAY '** CALLED BY 1500-CALC-DAYS-DATE'           08170006
095941             DISPLAY '** ERROR MESSAGE = '                        08180006
095942                               DPG54-ERROR-MESSAGE                08190006
095943             DISPLAY '** DPG51 = ' DPG51                          08200006
095944             DISPLAY '** DPG52 = ' DPG52                          08210006
095945             DISPLAY '** DPG53 = ' DPG53                          08220006
095946             DISPLAY '** DPG54 = ' DPG54                          08230006
095947             DISPLAY '** DPG55 = ' DPG55                          08240006
095948             DISPLAY '** DPG56 = ' DPG56                          08250006
095949             MOVE '1500-CALC-DAYS-DATE'                           08260006
095950                                  TO PV-PARAGRAPH-NAME            08270006
095951             MOVE 'ERROR CALCULATING NEW STORE DATE'              08280006
095952                                  TO PV-OPERATION-MSG-1           08290006
095953             MOVE DPG54-ERROR-MESSAGE  TO PV-OPERATION-MSG-2      08300006
095954             MOVE 4019 TO ABEND-CODE                              08310006
095955             CALL 'ILBOABN0' USING ABEND-CODE                     08320005
095956     END-EVALUATE.                                                08330006
095957                                                                  08340006
095958*1500-EXIT.                                                       08350006
095959                                                                  08360006
096005*----------------------------------------------------------       08870006
096006* 1710-OPEN-REFRESH-CURSOR.                                       08880006
096007*     OPEN THE REFRESH CURSOR.                                    08890006
096008*----------------------------------------------------------       08900006
096009 1710-OPEN-REFRESH-CURSOR.                                        08910006
096010                                                                  08920006
096011     DISPLAY ' >>>>> PREPARING TO OPEN REFRESH CURSOR *'                  
096012             ' FOR  RFRSH_DTE = ', CC-EPCC140-TODAY-DATE,         05040006
096013             ' OPN_DTE   <= ', CC-EPCC140-TODAY-DATE,             05080006
096014             ' OR OPN_DTE  <= ', PV-NEW-DATE.                     05090006
096015                                                                          
096016     PERFORM                                                      08930006
096017         WITH TEST AFTER                                          08940006
096018         VARYING PV-SQL-SUB                                       08950006
096019         FROM 1 BY 1                                              08960006
096020         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08970006
096021                   OR  SQLCODE = 0)                               08980006
096022                                                                  08990006
096023           EXEC SQL                                               09000006
096024              OPEN REFRESH-CURSOR                                 09010006
096025           END-EXEC                                               09020006
096026                                                                  09030006
096027         EVALUATE TRUE                                            09040006
096028             WHEN SQLCODE = -904                                  09050006
096029             WHEN SQLCODE = -911                                  09060006
096030             WHEN SQLCODE = -913                                  09070006
096031                  CONTINUE                                        09080006
096032             WHEN SQLCODE = 0                                     09090006
096033                  SET PS-NOT-END-OF-REFRESH-CSR TO TRUE           09100006
096034             WHEN SQLWARN0 NOT EQUAL SPACE                        09110006
096035             WHEN SQLCODE NOT EQUAL ZERO                          09120006
096036                  MOVE '1710-OPEN-REFRESH-CURSOR'                 09130006
096037                                     TO PV-PARAGRAPH-NAME         09140006
096038                  MOVE 'ERROR ON OPEN OF REFRESH CURSOR'          09150006
096039                                     TO PV-DB2-OPERATION          09160006
096040                  PERFORM 9900-SQL-ABEND-ROUTINE                  09170006
096041         END-EVALUATE                                             09180006
096042     END-PERFORM.                                                 09190006
096043                                                                  09200006
096044     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09210006
096045        MOVE '1710-OPEN-REFRESH-CURSOR'                           09220006
096046                             TO  PV-PARAGRAPH-NAME                09230006
096047        MOVE 'OPEN RETRIES EXCEEDED'                              09240006
096048                              TO  PV-DB2-OPERATION                09250006
096049        PERFORM 9900-SQL-ABEND-ROUTINE                            09260006
096050     END-IF.                                                      09270006
096051                                                                  09280006
096052*1710-EXIT.                                                       09290006
096053 EJECT.                                                           09300006
096054                                                                  09310006
096055*----------------------------------------------------------       09320006
096056* 1750-FETCH-REFRESH-CURSOR.                                      09330006
096057*     FETCH THE REFRESH CURSOR.                                   09340006
096058*----------------------------------------------------------       09350006
096059 1750-FETCH-REFRESH-CURSOR.                                       09360006
096060                                                                  09370006
096061     PERFORM                                                      09380006
096062         WITH TEST AFTER                                          09390006
096063         VARYING PV-SQL-SUB                                       09400006
096064         FROM 1 BY 1                                              09410006
096065         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09420006
096066                   OR  SQLCODE = 0                                09430006
096067                   OR  SQLCODE = +100)                            09440006
096068                                                                  09450006
096069           EXEC SQL                                               09460006
096070              FETCH REFRESH-CURSOR                                09470006
096071              INTO  :EPT00010-STR-NBR                             09480007
096072           END-EXEC                                               09490006
096073                                                                  09500006
096074          EVALUATE TRUE                                           09510006
096075             WHEN SQLCODE = -904                                  09520006
096076             WHEN SQLCODE = -911                                  09530006
096077             WHEN SQLCODE = -913                                  09540006
096078                  CONTINUE                                        09550006
096079             WHEN SQLCODE = ZERO                                  09560006
096080                  ADD 1 TO PC-CNT-REFRESH-CSR                     09570006
096090             WHEN SQLCODE = +100                                  09580006
096600                  DISPLAY '**FPLU NO MORE STORES TO REFRESH'      09660006
096601                  SET PS-END-OF-REFRESH-CSR TO TRUE               09590006
096602             WHEN SQLWARN0 NOT EQUAL SPACE                        09600006
096603             WHEN SQLCODE NOT EQUAL ZERO                          09610006
096604                  MOVE '1750-FETCH-REFRESH-CURSOR'                09620006
096605                                     TO PV-PARAGRAPH-NAME         09630006
096606                  MOVE 'ERROR ON FETCHING REFRESH CURSOR'         09640006
096607                                     TO PV-DB2-OPERATION          09650006
096608                  DISPLAY 'SQLCODE= ' SQLCODE                     09660006
096700                  PERFORM 9900-SQL-ABEND-ROUTINE                  09670006
096800          END-EVALUATE                                            09680006
096900     END-PERFORM.                                                 09690006
097000                                                                  09700006
097100     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        09710006
097200         MOVE '1750-FETCH-REFRESH-CURSOR'                         09720006
097300                               TO  PV-PARAGRAPH-NAME              09730006
097400         MOVE 'FETCH RETRIES EXCEEDED'                            09740006
097500                               TO  PV-DB2-OPERATION               09750006
097600         PERFORM 9900-SQL-ABEND-ROUTINE                           09760006
097700     END-IF.                                                      09770006
097800                                                                  09780006
097900*1750-EXIT.                                                       09790006
098000 EJECT.                                                           09800006
098100                                                                  09810006
098200*-----------------------------------------------------------      09820006
098300* 1790-CLOSE-REFRESH-CURSOR.                                      09830006
098400*     CLOSE THE REFRESH CURSOR.                                   09840006
098500*-----------------------------------------------------------      09850006
098600 1790-CLOSE-REFRESH-CURSOR.                                       09860006
098700                                                                  09870006
098800     PERFORM                                                      09880006
098900         WITH TEST AFTER                                          09890006
099000         VARYING PV-SQL-SUB                                       09900006
099100         FROM 1 BY 1                                              09910006
099200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09920006
099300                   OR  SQLCODE = 0)                               09930006
099400                                                                  09940006
099500           EXEC SQL                                               09950006
099600              CLOSE REFRESH-CURSOR                                09960006
099700           END-EXEC                                               09970006
099800                                                                  09980006
099900          EVALUATE TRUE                                           09990006
100000             WHEN SQLCODE = -904                                  10000006
100100             WHEN SQLCODE = -911                                  10010006
100200             WHEN SQLCODE = -913                                  10020006
100300             WHEN SQLCODE = 0                                     10030006
100400                  CONTINUE                                        10040006
100500             WHEN SQLWARN0 NOT EQUAL SPACE                        10050006
100600             WHEN SQLCODE NOT EQUAL ZERO                          10060006
100700                  MOVE '1790-CLOSE-REFRESH-CURSOR'                10070006
100800                                      TO PV-PARAGRAPH-NAME        10080006
100900                  MOVE 'ERROR ON CLOSE OF REFRESH CURSOR'         10090006
101000                                      TO PV-DB2-OPERATION         10100006
101100                  PERFORM 9900-SQL-ABEND-ROUTINE                  10110006
101200          END-EVALUATE                                            10120006
101300     END-PERFORM.                                                 10130006
101400                                                                  10140006
101500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         10150006
101600        MOVE '1790-CLOSE-REFRESH-CURSOR'                          10160006
101700                               TO  PV-PARAGRAPH-NAME              10170006
101800        MOVE 'CLOSE RETRIES EXCEEDED'                             10180006
101900                               TO  PV-DB2-OPERATION               10190006
102000        PERFORM 9900-SQL-ABEND-ROUTINE                            10200006
102100     END-IF.                                                      10210006
102200                                                                  10220006
102300*1790-EXIT.                                                       10230006
102400 EJECT.                                                           10240006
102500                                                                  10250006
102600*--------------------------------------------------------------*  10260001
102700* 2000-PROCESS-LIST.                                           *  10270006
102900*  PROCESSES FOR EACH STORE AND CREATES FPLU RECORDS BASED     *  10290006
103000*  UPON STORE GROUP MEMBERSHIPS.                               *  10300006
103300*--------------------------------------------------------------*  10330001
103400 2000-PROCESS-LIST.                                               10340006
103500                                                                  10350001
103600     DISPLAY ' EXTRACTING FOR STORE-',                            11360006
103700                     EPT00010-STR-NBR, '**'                       09480007
103800                                                                          
113600     PERFORM 3200-OPEN-PRCHG.                                     11360006
113700     SET PS-NOT-END-OF-FUTURE-PERM-CSR TO TRUE.                   11370006
113800     PERFORM 3250-FETCH-PRCHG.                                    11380006
113810                                                                          
113900     PERFORM UNTIL PS-END-OF-FUTURE-PERM-CSR                      11390006
114000         PERFORM 2250-HIER                                        10440006
114300         PERFORM 3250-FETCH-PRCHG                                 11430006
114400     END-PERFORM.                                                 11440006
114500     PERFORM 3299-CLOSE-PRCHG.                                    11450006
114600                                                                  10500001
114700     PERFORM 1750-FETCH-REFRESH-CURSOR.                           08820006
114701                                                                  10390006
114702*2000-EXIT.                                                       10530006
114703                                                                  10540001
114704*--------------------------------------------------------------*  10550006
114705* 2250-HIER.                                                   *  10560006
114706*      THIS PROCESS ENVOKES SKU LOGIC AS APPROPRIATE OR JUST   *  10570006
114707*      GOES AHEAD AND WRITES INFO FOR OTHER LEVELS.            *  10570006
114708*--------------------------------------------------------------*  10600006
114709 2250-HIER.                                                       10610006
114710                                                                          
114720     MOVE '2250-HIER '  TO PV-PARAGRAPH-NAME.                     10780004
114730     SET PS-WRITE-PRCHG TO TRUE.                                          
114740                                                                          
114750     IF XST00065-MDSE-HIER-CDE = 'SKU'                            12240004
114760         PERFORM 3000-SKU-WORK                                    10440006
114770     ELSE                                                                 
114780        IF XST00065-MDSE-HIER-CDE = 'STY'                         12240004
114790            MOVE ZEROS TO PV-NON-CL-RTL-PRC                               
114800            PERFORM 3050-STYLE-WORK                               10440006
114900        ELSE                                                              
115000            ADD 1      TO PV-HIER-CODE-COUNT                      02610005
115100            MOVE ZEROS TO PV-NON-CL-RTL-PRC                               
115200        END-IF                                                            
115300     END-IF.                                                              
115400                                                                          
115500     IF PS-WRITE-PRCHG                                                    
115700        PERFORM 7200-FORMAT-SQLSRV-COMMON                         11410006
115800     END-IF.                                                              
115900                                                                  10790001
116000*2250-EXIT.                                                       10530006
116001                                                                  10540001
116002                                                                  10540001
116003*--------------------------------------------------------------*  10550006
116004* 3000-SKU-WORK.                                               *  10560006
116005*      THIS PROCESS CHECKS THE SKU DOWNLOAD EXCLUSION FLAG     *  10570006
116006*--------------------------------------------------------------*  10600006
116007 3000-SKU-WORK.                                                   10610006
116008                                                                          
116009     MOVE '3000-SKU-WORK' TO PV-PARAGRAPH-NAME.                   10780004
116010                                                                  10790001
116011     PERFORM                                                      10800004
116012        WITH TEST AFTER                                           10810004
116013      VARYING PV-SQL-SUB                                          10820004
116014         FROM 1 BY 1                                              10830004
116015        UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                  10840004
116016                    OR  SQLCODE = 0                               10850004
116017                    OR  SQLCODE = +100)                           10860004
116018        EXEC SQL                                                  10870004
116019             SELECT  PLU_DWNLD_EXCL_IND                           10880004
116020                    ,LAST_NCLR_RTL_AMT                            10890004
116021               INTO  :XST00011-PLU-DWNLD-EXCL-IND                 10900005
116022                    ,:XST00011-LAST-NCLR-RTL-AMT                  10910005
116023                           :PV-NULL-NCLR-RTL-AMT                  10920006
116024               FROM  XST_SKU_ATTR  A                              10930004
116025                    ,XST_SKU       S                              10930004
116026              WHERE  SKU_NBR        = :XST00065-SKU-NBR           10940004
116027                AND  A.INTR_UPC_ID  = S.INTR_UPC_ID               10940004
116028               WITH UR                                            10950004
116029        END-EXEC                                                  10960004
116030                                                                  10970004
116031        EVALUATE TRUE                                             10980004
116032           WHEN SQLCODE = -911                                    10990004
116033           WHEN SQLCODE = -913                                    11000004
116034                CONTINUE                                          11010004
116035           WHEN SQLCODE = 0                                       11020004
116036                MOVE XST00011-LAST-NCLR-RTL-AMT TO                        
116037                     PV-NON-CL-RTL-PRC                                    
116038                                                                  11250001
116039                IF XST00011-PLU-DWNLD-EXCL-IND = 'Y'              10650006
116040                   ADD 1 TO PV-EXCLUDE-SKU-COUNT                  10660006
116050                   SET PS-DO-NOT-WRITE-PRCHG TO TRUE              11080005
116060                ELSE                                              10700006
116070                   ADD 1 TO PV-SKU-PASS-COUNT                     02610005
116080                END-IF                                            10700006
116081                                                                          
116082           WHEN SQLCODE = +100                                    11040004
116083                DISPLAY '*** SKU ATTR NOT FOUND FOR -'            11050005
116084                        XST00065-SKU-NBR                          10940004
116085                ADD 1                     TO PV-MISSING-SKU-COUNT 11070005
116086                SET PS-DO-NOT-WRITE-PRCHG TO TRUE                 11080005
116087           WHEN OTHER                                             11130004
116088                MOVE 'ERROR ON SKU ATTR SELECT ' TO               11140004
116089                     PV-DB2-OPERATION                             11150004
116090                PERFORM 9900-SQL-ABEND-ROUTINE                    11160004
116091        END-EVALUATE                                              11170004
116092     END-PERFORM.                                                 11180004
116093                                                                          
116094     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         11190004
116095        MOVE '3000-SELECT-SKU-ATTR' TO  PV-PARAGRAPH-NAME         11200004
116096        MOVE 'SELECT RETRIES EXCEEDED'                            11210004
116097                               TO  PV-DB2-OPERATION               11220004
116098        PERFORM 9900-SQL-ABEND-ROUTINE                            11230004
116099     END-IF.                                                      11240004
116100                                                                  10710006
116101*3000-EXIT.                                                       10720006
116102                                                                  11270001
116103*--------------------------------------------------------------*  07610006
116104* 3050-STYLE-WORK.                                             *  07620006
116105*      THIS PROCESS WORKS ON A STYLE. FIRST IT ATTEMPTS A READ *  07630006
116106*  OF VENDOR STYLE. IF THAT RECORD EXISTS THEN THE DETAIL ADD  *  07640006
116107*  RECORD IS WRITTEN.                                          *  07640006
116108*--------------------------------------------------------------*  07660006
116109 3050-STYLE-WORK.                                                 07670006
116110                                                                  07700006
116120     MOVE '3050-STYLE-WORK ' TO PV-PARAGRAPH-NAME.                07840004
116130                                                                  07850001
116140     PERFORM                                                      07860004
116150        WITH TEST AFTER                                           07870004
116160      VARYING PV-SQL-SUB                                          07880004
116170         FROM 1 BY 1                                              07890004
116180        UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                  07900004
116190                    OR  SQLCODE = 0                               07910004
116200                    OR  SQLCODE = +100)                           07920004
116300         EXEC SQL                                                 07930004
116400              SELECT  DEPT_NBR                                    07940004
116500                     ,MAJ_CL_NBR                                  07950004
116600                     ,SUB_CL_NBR                                  07950004
116700                INTO  :XST00013-DEPT-NBR                          07960005
116800                     ,:XST00013-MAJ-CL-NBR                        07970005
116900                     ,:XST00013-SUB-CL-NBR                        07970005
117000                FROM  XST_VND_STYL                                07990004
117100               WHERE  STYL_ID  = :XST00065-STYL-ID                08000004
117200                WITH UR                                           08010004
117300         END-EXEC                                                 08020004
117400                                                                  08030004
117500         EVALUATE TRUE                                            08040004
117600             WHEN SQLCODE = -911                                  08050004
117700             WHEN SQLCODE = -913                                  08060004
117800                  CONTINUE                                        08070004
117900             WHEN SQLCODE = 0                                     08080004
118000                  ADD 1 TO PV-STYLE-COUNT                         02610005
118100             WHEN SQLCODE = +100                                  08110004
118200                  DISPLAY '*** VENDOR STYLE NOT FOUND FOR -'      08120005
118300                          XST00065-STYL-ID                        10420006
118400                  ADD 1 TO PV-MISSING-STYLE-COUNT                 08140005
118500                  SET PS-DO-NOT-WRITE-PRCHG TO TRUE               11080005
118600             WHEN OTHER                                           08200004
118700                  MOVE 'ERROR ON VND STYL SELECT '                08210004
118800                              TO PV-DB2-OPERATION                 08220004
118900                  PERFORM 9900-SQL-ABEND-ROUTINE                  08230004
119000         END-EVALUATE                                             08240004
119100     END-PERFORM.                                                 08250004
119200                                                                          
119300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08260004
119400        MOVE '3050-SELECT-VND-STYL' TO  PV-PARAGRAPH-NAME         08270004
119500        MOVE 'SELECT RETRIES EXCEEDED'                            08280004
119600                               TO  PV-DB2-OPERATION               08290004
119700        PERFORM 9900-SQL-ABEND-ROUTINE                            08300004
119800     END-IF.                                                      08310004
119900                                                                  08320001
120000*3050-EXIT.                                                       07780006
120001                                                                  08340001
120002*--------------------------------------------------------------*  11600006
120003* 3200-OPEN-PRCHG                                             *   11610006
120004*    TRY TO OPEN THE CURSOR UP TO FIVE TIMES.                  *  11620006
120005*--------------------------------------------------------------*  11630006
120006 3200-OPEN-PRCHG.                                                 11640006
120007                                                                          
120008     MOVE '3200-OPEN-PRCHG' TO PV-PARAGRAPH-NAME.                 11650006
120009                                                                  11660006
120010     PERFORM                                                      11670006
120011         WITH TEST AFTER                                          11680006
120012         VARYING PV-SQL-SUB                                       11690006
120013         FROM 1 BY 1                                              11700006
120014         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 11710006
120015                   OR  SQLCODE = 0)                               11720006
120016             EXEC SQL                                             11730006
120017               OPEN PRCHG-CSR                                     11740006
120018             END-EXEC                                             11750006
120019                                                                  11760006
120020         EVALUATE TRUE                                            11770006
120021           WHEN SQLCODE = -904                                    11780006
120022           WHEN SQLCODE = -911                                    11790006
120023           WHEN SQLCODE = -913                                    11800006
120024             CONTINUE                                             11810006
120025           WHEN SQLCODE = 0                                       11820006
120026             CONTINUE                                             11830006
120027           WHEN SQLWARN0 NOT EQUAL SPACE                          11840006
120028           WHEN SQLCODE NOT EQUAL ZERO                            11850006
120029             MOVE  'ERROR ON OPEN OF CHG CSR'                     11860006
120030                                 TO PV-DB2-OPERATION              11870006
120031             PERFORM 9900-SQL-ABEND-ROUTINE                       11880006
120032         END-EVALUATE                                             11890006
120033     END-PERFORM.                                                 11900006
120034                                                                  11910006
120035     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         11920006
120036        MOVE 'OPEN RETRIES EXCEEDED FOR CHG CSR'                  11930006
120037                                 TO PV-DB2-OPERATION              11940006
120038       PERFORM 9900-SQL-ABEND-ROUTINE                             11950006
120039     END-IF.                                                      11960006
120040                                                                  11970006
120041*3200-EXIT.                                                       11980006
120042                                                                  11990006
120043*--------------------------------------------------------------*  12000001
120100* 3250-FETCH-PRCHG.                                         *     12010001
120200*--------------------------------------------------------------*  12020001
120300 3250-FETCH-PRCHG.                                                12030001
120400                                                                  12040001
120500     MOVE '3250-FETCH-PRCHG  ' TO PV-PARAGRAPH-NAME.              12050001
120600     INITIALIZE PV-NULL-FIELDS                                            
120700                DCLXST00063                                               
120800                DCLXST00064                                               
120801                DCLXST00065.                                              
120802                                                                  12060001
120803      PERFORM                                                     12070004
120804          WITH TEST AFTER                                         12080004
120900          VARYING PV-SQL-SUB                                      12090004
121000          FROM 1 BY 1                                             12100004
121100          UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                12110004
121200                    OR  SQLCODE = 0                               12120004
121300                    OR  SQLCODE = +100)                           12130004
121400           EXEC SQL                                               12140004
121500                FETCH  PRCHG-CSR                                  12150004
121800                 INTO  :XST00064-PRCHG-EFF-DTE                    12180004
121900                      ,:XST00065-UNT-RTL-AMT                      12190004
121910                             :PV-NULL-UNT-RTL                     12210006
122000                      ,:XST00065-GP-PRIC-ID                       12200004
122100                             :PV-NULL-GP-PRIC-ID                  12210006
122200                      ,:XST00065-GP-RTL-QTY                       12220004
122300                             :PV-NULL-GP-RTL-QTY                  12230006
122400                      ,:XST00065-GP-RTL-AMT                       12240004
122500                             :PV-NULL-GP-RTL-AMT                  12250006
122600                      ,:XST00065-MDSE-HIER-CDE                    12240004
122700                      ,:XST00065-DEPT-NBR                         12240004
122800                             :PV-NULL-DEPT                        12250006
122900                      ,:XST00065-MAJ-CL-NBR                       12240004
123000                             :PV-NULL-MAJ-CL                      12250006
123100                      ,:XST00065-SUB-CL-NBR                       12240004
123200                             :PV-NULL-SUB-CL                      12250006
123300                      ,:XST00065-STYL-ID                          12240004
123301                             :PV-NULL-STYLE                       12250006
123302                      ,:XST00065-SKU-NBR                          12260004
123303                             :PV-NULL-SKU                         12250006
123304                      ,:XST00063-PRCHG-TYP-CDE                    12260004
123305                      ,:XST00063-EVNT-CTG-CDE                     03720003
123306                      ,:XST00065-PRICG-GRID-ID                    03720003
123307                             :PV-NULL-GRID-ID                     12250006
123308                      ,:XST00065-CLR-TYP-CDE                      03720003
123309                             :PV-NULL-CLR-TYP                     12250006
123310                      ,:XST00065-LAST-UPD-TMST                    12260004
123311           END-EXEC                                               12270004
123312                                                                  12280001
123313           EVALUATE TRUE                                          12290004
123314              WHEN SQLCODE = -911                                 12300004
123315              WHEN SQLCODE = -913                                 12310004
123316                   CONTINUE                                       12320004
123317              WHEN SQLCODE = 0                                    12330004
123400                   ADD 1 TO PV-PRCHG-FETCHES                      12340004
123500                            PV-FUTURE-PERM-COUNT                  12350004
123800              WHEN SQLCODE = +100                                 12380004
123900                   SET PS-END-OF-FUTURE-PERM-CSR  TO TRUE         12390004
124000              WHEN OTHER                                          12400004
124100                   MOVE 'ERROR ON FETCH OF FUTURE-PERM-CSR'       12410004
124200                            TO PV-DB2-OPERATION                   12420001
124300                   PERFORM 9900-SQL-ABEND-ROUTINE                 12430004
124400           END-EVALUATE                                           12440004
124500     END-PERFORM.                                                 12450004
124510                                                                          
124600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         12460004
124700        MOVE 'FETCH RETRIES EXCEEDED'                             12470004
124800                               TO  PV-DB2-OPERATION               12480004
124900        PERFORM 9900-SQL-ABEND-ROUTINE                            12490004
125000     END-IF.                                                      12500004
125100*    DISPLAY '>> FETCH OK-'                                       12370004
125200*            ' EFF DT=', XST00064-PRCHG-EFF-DTE                   12180004
125300*            ' PRICE=', XST00065-UNT-RTL-AMT                      12190004
125400*            ' HIER=', XST00065-MDSE-HIER-CDE                     12240004
125500*            ' DEPT=', XST00065-DEPT-NBR                          12240004
125600*            ' MAJ=', XST00065-MAJ-CL-NBR                         12240004
125700*            ' SUB=', XST00065-SUB-CL-NBR                         12240004
125800*            ' STYLE=' XST00065-STYL-ID                           12240004
125900*            ' SKU=', XST00065-SKU-NBR                            12260004
125901*            ' TYP=', XST00063-PRCHG-TYP-CDE, '<<'.               12260004
125902                                                                  12510001
125903*3250-EXIT.                                                       12520001
125904                                                                  12530001
125905*--------------------------------------------------------------*  12540001
125906* 3299-CLOSE-PRCHG.                                            *  12550001
125907*    TRY TO CLOSE THE CURSOR UP TO FIVE TIMES.                 *  12560001
125908*--------------------------------------------------------------*  12570001
125909 3299-CLOSE-PRCHG.                                                12580001
125910                                                                  12590001
126000     MOVE '3299-CLOSE-PRCHG ' TO PV-PARAGRAPH-NAME.               12600001
126100                                                                  12610001
126200     PERFORM                                                      12620001
126300         WITH TEST AFTER                                          12630001
126400         VARYING PV-SQL-SUB                                       12640001
126500         FROM 1 BY 1                                              12650001
126600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 12660001
126700                   OR  SQLCODE = 0)                               12670001
126800             EXEC SQL                                             12680001
126900               CLOSE PRCHG-CSR                                    12690001
127000             END-EXEC                                             12700001
127100                                                                  12710001
127200         EVALUATE TRUE                                            12720001
127300           WHEN SQLCODE = -904                                    12730001
127400           WHEN SQLCODE = -911                                    12740001
127500           WHEN SQLCODE = -913                                    12750001
127600             CONTINUE                                             12760001
127700           WHEN SQLCODE = 0                                       12770001
127800             CONTINUE                                             12780001
127900           WHEN SQLWARN0 NOT EQUAL SPACE                          12790001
128000           WHEN SQLCODE NOT EQUAL ZERO                            12800001
128100             MOVE 'ERROR ON CLOSE OF OLD SKU CSR'                 12810001
128200                             TO PV-DB2-OPERATION                  12820001
128300             PERFORM 9900-SQL-ABEND-ROUTINE                       12830001
128400         END-EVALUATE                                             12840001
128500     END-PERFORM.                                                 12850001
128600                                                                  12860001
128700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         12870001
128800       MOVE 'CLOSE RETRIES EXCEEDED FOR FUTURE PERM'              12880001
128900                      TO PV-DB2-OPERATION                         12890001
129000       PERFORM 9900-SQL-ABEND-ROUTINE                             12900001
129100     END-IF.                                                      12910001
129200                                                                  12920001
129300*3299-EXIT.                                                       12930001
129400                                                                  12940001
181100*--------------------------------------------------------------*  16940001
181200* 7200-FORMAT-SQLSRV-COMMON.                                      16950006
181300*    INITIALIZE OUTPUT RECORD FOR ADD DATA                     *  16960006
181400*--------------------------------------------------------------*  16970001
181500 7200-FORMAT-SQLSRV-COMMON.                                       16980006
181600                                                                  16990001
181700     INITIALIZE EP220-XST-SKU-PRICG-RECORD.                       17000004
181800     SET EP220-DEPT-NBR-YES            TO TRUE.                           
181900     SET EP220-MAJ-CL-NBR-YES          TO TRUE.                           
182000     SET EP220-SUB-CL-NBR-YES          TO TRUE.                           
182100     SET EP220-STYL-ID-YES             TO TRUE                            
182200     SET EP220-SKU-NBR-YES             TO TRUE                            
182300     SET EP220-EXCL-MDSE-IND-YES       TO TRUE.                           
182400     SET EP220-N-RCPT-RT-RTL-AMT-Y     TO TRUE.                           
182500     SET EP220-PERM-PRCHG-DIRN-CDE-YES TO TRUE.                           
182600                                                                  17010004
182700     SET EP220-FILE-FULL          TO TRUE.                        17020005
182800                                                                  17010004
182900     MOVE 05000                   TO EP220-STR-GRP-TYP-CDE.       17360005
183000     MOVE EPT00010-STR-NBR        TO EP220-STR-GRP-ID.            17370005
183100     SET EP220-APPLY-NIGHTLY      TO TRUE.                        17030005
183200     SET EP220-RECORD-ADD         TO TRUE.                        17650005
183300                                                                          
183400     SET EP220-SKU-PRICG-ID-NO    TO TRUE.                                
183500                                                                          
183600     MOVE CC-EPCC140-TODAY-DATE   TO EP220-PRICG-EFFECT-DTE.      17390005
183700     MOVE XST00064-PRCHG-EFF-DTE  TO EP220-PRIC-EFF-TMST.         17750005
183800     MOVE PC-3CLOCK               TO EP220-PRIC-EFF-TMST(11:9).   17090005
183900                                                                          
184000     SET EP220-PRIC-EFF-TMST-YES   TO TRUE.                               
184100                                                                          
184200     MOVE XST00065-MDSE-HIER-CDE   TO EP220-MDSE-HIER-CDE.                
184300     SET EP220-MDSE-HIER-CDE-YES   TO TRUE.                               
184400                                                                          
184500     IF PV-NULL-DEPT < 0                                          12250006
184600        MOVE PC-NULLS           TO EP220-DEPT-NBR-NUL             17710005
184700     ELSE                                                         17780006
184800        MOVE XST00065-DEPT-NBR  TO EP220-DEPT-NBR                 17710005
184900     END-IF.                                                      17780006
185000                                                                          
185100     IF PV-NULL-MAJ-CL < 0                                        12250006
185200        MOVE PC-NULLS            TO EP220-MAJ-CL-NBR-NUL          17780006
185300     ELSE                                                         17780006
185400        MOVE XST00065-MAJ-CL-NBR  TO EP220-MAJ-CL-NBR             17730005
185500     END-IF.                                                      17780006
185600                                                                          
185700     IF PV-NULL-SUB-CL < 0                                        12250006
185800        MOVE PC-NULLS             TO EP220-SUB-CL-NBR-NUL         17780006
185900     ELSE                                                         17780006
186000        MOVE XST00065-SUB-CL-NBR  TO EP220-SUB-CL-NBR             17730005
186100     END-IF.                                                      17780006
186200                                                                          
186300     IF PV-NULL-STYLE  < 0                                        12250006
186400        MOVE PC-NULLS              TO EP220-STYL-ID-NUL           17730005
186500     ELSE                                                         17780006
186600        MOVE XST00065-STYL-ID      TO EP220-STYL-ID               17730005
186700                                                                          
186800        MOVE XST00013-DEPT-NBR     TO EP220-DEPT-NBR              07960005
186900                                                                          
187000        MOVE XST00013-MAJ-CL-NBR   TO EP220-MAJ-CL-NBR            07970005
187100                                                                          
187200        MOVE XST00013-SUB-CL-NBR   TO EP220-SUB-CL-NBR            07970005
187300     END-IF.                                                      17780006
187400                                                                          
187500     IF PV-NULL-SKU < 0                                           12250006
187600        MOVE PC-NULLS          TO EP220-SKU-NBR-NUL               17780006
187700     ELSE                                                         17780006
187800        MOVE XST00065-SKU-NBR  TO EP220-SKU-NBR                   17040006
187900     END-IF.                                                      17780006
188000                                                                          
188100     MOVE PC-NULLS       TO EP220-EXCL-MDSE-IND                           
188200                            EP220-N-RCPT-RT-UNT-RTL-AMT-NL.               
188300                                                                          
188400     MOVE 'N'           TO EP220-PERM-PRCHG-DIRN-CDE                      
188500                           EP220-MLT-PRPT-IND.                            
188600                                                                          
188700     SET EP220-MLT-PRPT-IND-YES    TO TRUE.                               
188800                                                                          
188900     MOVE XST00065-LAST-UPD-TMST(1:10)                                    
189000                        TO EP220-LAST-PRCHG-TMST.                         
189100     MOVE PC-COLON      TO EP220-LAST-PRCHG-TMST(14:1)                    
189200                           EP220-LAST-PRCHG-TMST(17:1).                   
189300                                                                          
189400     MOVE XST00065-LAST-UPD-TMST(12:2) TO                                 
189500                       EP220-LAST-PRCHG-TMST(12:2).                       
189600     MOVE XST00065-LAST-UPD-TMST(15:2) TO                                 
189700                       EP220-LAST-PRCHG-TMST(15:2).                       
189800     MOVE XST00065-LAST-UPD-TMST(18:2) TO                                 
189900                       EP220-LAST-PRCHG-TMST(18:2).                       
190000     SET EP220-LAST-PRCHG-TMST-YES TO TRUE.                               
190100                                                                          
190200     PERFORM 7300-FORMAT-SQLSRVR-ADD.                                     
190300                                                                          
190400*7200-EXIT.                                                               
190401                                                                          
190402*--------------------------------------------------------------*  17270004
190403* 7300-FORMAT-SQLSRVR-ADD.                                     *  17580001
190404*    FINISH SETTING UP DATA FOR SQL SERVER TBL                 *  17590001
190405*    SKU_PRICG.                                                *  17600004
190406*--------------------------------------------------------------*  17610004
190407 7300-FORMAT-SQLSRVR-ADD.                                         17630004
190408                                                                  17640001
190409     SET EP220-UNT-RTL-AMT-YES        TO TRUE.                            
190410     SET EP220-GP-PRIC-ID-YES         TO TRUE.                            
190420     SET EP220-GP-RTL-QTY-YES         TO TRUE.                            
190430     SET EP220-GP-RTL-AMT-YES         TO TRUE.                            
190440     SET EP220-LAST-NCLR-RTL-AMT-YES  TO TRUE.                            
190450     SET EP220-PRMPT-FOR-PRIC-IND-YES TO TRUE.                    17910005
190460     SET EP220-LOC-SKU-STAT-CDE-YES   TO TRUE.                            
190470     SET EP220-TKT-CLOR-CDE-YES       TO TRUE.                            
190480                                                                  17640001
190490     SET EP220-PRCHG-APL-TKT-CLR-CD-Y TO TRUE.                            
190500     SET EP220-LO-UNT-RTL-AMT-YES     TO TRUE.                            
190600     SET EP220-HGH-UNT-RTL-AMT-YES    TO TRUE.                            
190700     SET EP220-TKT-CLOR-CDE-YES       TO TRUE.                            
190800                                                                  17640001
190900     MOVE PC-NULLS           TO EP220-LO-UNT-RTL-AMT-NUL                  
191000                                EP220-HGH-UNT-RTL-AMT-NUL.                
191100                                                                          
191200     IF PV-NULL-UNT-RTL     < 0                                           
191300        MOVE ZEROS                   TO EP220-UNT-RTL-AMT                 
191400     ELSE                                                                 
191500        MOVE XST00065-UNT-RTL-AMT    TO EP220-UNT-RTL-AMT                 
191600     END-IF.                                                              
191700                                                                          
191800     IF PV-NULL-GP-PRIC-ID  < 0                                   17770006
191900        MOVE PC-NULLS            TO EP220-GP-PRIC-ID-NUL                  
192000                                    EP220-GP-RTL-QTY-NUL                  
192100                                    EP220-GP-RTL-AMT-NUL                  
192200     ELSE                                                                 
192300        MOVE XST00065-GP-PRIC-ID  TO EP220-GP-PRIC-ID                17840
192400        IF PV-NULL-GP-RTL-QTY  < 0                                        
192500           MOVE PC-NULLS             TO EP220-GP-RTL-QTY-NUL              
192600        ELSE                                                              
192700           MOVE XST00065-GP-RTL-QTY  TO EP220-GP-RTL-QTY             17850
192800        END-IF                                                            
192900        IF PV-NULL-GP-RTL-AMT  < 0                                        
193000           MOVE PC-NULLS            TO EP220-GP-RTL-AMT-NUL               
193100        ELSE                                                              
193200           MOVE XST00065-GP-RTL-AMT  TO EP220-GP-RTL-AMT             17860
193300        END-IF                                                            
193400     END-IF.                                                              
193500                                                                          
193600     MOVE PC-ALL-COLORS   TO EP220-PRCHG-APLBL-TKT-CLOR-CDE.              
193700                                                                          
193800     IF XST00063-PRCHG-TYP-CDE =  'CLR'  OR                       17900006
193900        XST00063-PRCHG-TYP-CDE =  'RCP'  OR                       17900006
194000        XST00063-PRCHG-TYP-CDE =  'MK2'  OR                       17900006
194100        XST00063-PRCHG-TYP-CDE =  'FNL'                           17900006
194200                                                                  17530005
194300********** PRICE CHANGING TO CLEARANCE                   **               
194400********** OR YELLOW-TO-YELLOW FOR MARKDOWN OPTIMIZATION **               
194500                                                                  17530005
194600        IF PV-NON-CL-RTL-PRC = ZEROS                                      
194700           MOVE PC-NULLS     TO EP220-LAST-NCLR-RTL-AMT-NUL               
194800        ELSE                                                              
194900           MOVE PV-NON-CL-RTL-PRC                                 17530005
195000                             TO EP220-LAST-NCLR-RTL-AMT           17530005
195100        END-IF                                                            
195200                                                                          
195300        MOVE PC-CLEARANCE-STAT       TO EP220-LOC-SKU-STAT-CDE    17930006
195400        MOVE 'N'                     TO EP220-PRMPT-FOR-PRIC-IND          
195500        MOVE PC-TCKT-CLR-YELLOW      TO EP220-TKT-CLOR-CDE                
195600     ELSE                                                         18000006
195700                                                                          
195800********** PRICE CHANGING TO (OR REMAINING) ACTIVE **                     
195900                                                                          
196000        IF PV-NULL-UNT-RTL < 0                                            
196100            MOVE PC-NULLS    TO EP220-LAST-NCLR-RTL-AMT-NUL               
196200        ELSE                                                              
196300           MOVE XST00065-UNT-RTL-AMT                              18040006
196400                              TO EP220-LAST-NCLR-RTL-AMT          18040006
196500        END-IF                                                            
196600                                                                  16330006
196700        MOVE PC-ACTIVE-STAT      TO EP220-LOC-SKU-STAT-CDE        18030006
196800        MOVE 'Y'                  TO EP220-PRMPT-FOR-PRIC-IND             
196900        MOVE PC-TCKT-CLR-WHITE      TO EP220-TKT-CLOR-CDE                 
197000                                                                          
197100     END-IF.                                                      18050006
197200                                                                          
197300     PERFORM 8100-WRITE-FPLU-SQL-RECORD.                                  
197400                                                                          
197500*7300-EXIT.                                                       18090004
197600                                                                  18100001
199100*--------------------------------------------------------------*  18110001
199200* 8100-WRITE-FPLU-SQL-RECORD.                                     18120001
199300*--------------------------------------------------------------*  18130001
199400 8100-WRITE-FPLU-SQL-RECORD.                                      18140001
199500                                                                  18150001
199600     MOVE '8100-WRITE-FPLU-SQL-RECORD' TO PV-PARAGRAPH-NAME.      18160001
199700                                                                  18170001
199800     WRITE FPLU-SQLSRV-REC FROM                                   18180007
199900                        EP220-XST-SKU-PRICG-RECORD.               18180007
200000                                                                  18170001
200100     ADD 1               TO PV-SQLSRVR-OUT-RECORDS,               18220005
200200                            PV-CNT-OUTPUT-RECORDS.                18240001
200300*8100-EXIT.                                                       18250001
200400                                                                  18410001
200500*--------------------------------------------------------------*  18420001
200600* 9900-SQL-ABEND-ROUTINE.                                         18430001
200700*     SQL ABEND ROUTINE.                                          18440001
200800*--------------------------------------------------------------*  18450001
200900 9900-SQL-ABEND-ROUTINE.                                          18460001
201000     DISPLAY '** ABEND     **'.                                   18470001
201100     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                18480001
201200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              18490001
201300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               18500001
201400                                                                  18510001
201500     COPY DPPD004.                                                18520001
201600     SET ABEND-4013-DB2-ERROR TO TRUE.                            18530001
201700     CALL 'ILBOABN0' USING ABEND-CODE.                            18540001
201701                                                                  18550001
201702*9900-EXIT.                                                       18560001
201703                                                                  18570001
201704*--------------------------------------------------------------*  18580001
201705* 9999-WRAPUP.                                                    18590001
201706*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      18600001
201707*     ANY DATA COUNTS FROM THE PROGRAM.                           18610001
201708*--------------------------------------------------------------*  18620001
201709 9999-WRAPUP.                                                     18630001
201710                                                                          
201711     CLOSE CC-PREV-NEXT-NEW-DAY,                                  18640005
201713           CC-PRIOR-OPEN,                                         18660005
201714           CC-TODAY,                                              18670005
201715           CC-TOMORROW,                                           18680005
201716           FPLU-SQLSRV-FILE.                                      00800005
201717                                                                  18700001
201718     DISPLAY ' '.                                                 18710001
201719     DISPLAY '*************************************************'. 18720005
201720     DISPLAY ' '.                                                 18730001
201721     DISPLAY 'NUMBER OF EXCLUDED SKUS ENCOUNTERED:    '           18780001
201722              PV-EXCLUDE-SKU-COUNT.                               18790001
201723     DISPLAY 'NUMBER OF MISSING SKUS (DEFAULTED):     '           18800001
201724              PV-MISSING-SKU-COUNT.                               18810001
201725     DISPLAY 'NUMBER OF STYLES UNFOUND VEND STYL:     '           18800001
201726              PV-MISSING-STYLE-COUNT.                             18810001
201727     COMPUTE PV-FOUND-SKU-COUNT = PV-FUTURE-PERM-COUNT -          18820005
201728         PV-EXCLUDE-SKU-COUNT - PV-MISSING-SKU-COUNT              18840005
201729         - PV-MISSING-STYLE-COUNT.                                18840005
201730     DISPLAY 'DETAILS TO REPORT (FPLU -EXCL - MSSING):'           18850005
201731              PV-FOUND-SKU-COUNT.                                 18860005
201732     DISPLAY ' '.                                                 18870001
201733     DISPLAY 'NUMBER OF ALL FUTURE PERM SKU FETCHES:  '           18880003
201734              PV-FUTURE-PERM-COUNT.                               18890001
201735     DISPLAY PC-TEN-BLANKS,                                       18900005
201736             'FUTURE PERM PRICE CHG FETCHES:'                     18910003
201737              PV-PRCHG-FETCHES.                                   18920001
201738     DISPLAY PC-TEN-BLANKS, PC-TEN-BLANKS,                        18900005
201739             '    HIER LEVEL RECS:'                               18910003
201740              PV-HIER-CODE-COUNT                                  02610005
201750     DISPLAY PC-TEN-BLANKS, PC-TEN-BLANKS,                        18900005
201760             '     SKU LEVEL RECS:'                               18910003
201770              PV-SKU-PASS-COUNT                                   02610005
201780     DISPLAY PC-TEN-BLANKS, PC-TEN-BLANKS,                        18900005
201790             '   STYLE LEVEL RECS:'                               18910003
201791              PV-STYLE-COUNT                                      02610005
201792     DISPLAY ' '.                                                 19020001
201793     DISPLAY 'NUMBER OF TOTAL OUTPUT RECORDS WRITTEN: '           19030005
201794              PV-CNT-OUTPUT-RECORDS, ' *'.                        19040005
201795     DISPLAY PC-TEN-BLANKS,                                       19050005
201796             '** PRCHG SQLSERVER O/P RECS:  '                     19060005
201797              PV-SQLSRVR-OUT-RECORDS,                             19070005
201798             ' - SUBTOTAL'.                                       19080001
201803     DISPLAY ' '.                                                 19170001
201804     DISPLAY '*********************************************'.     19180001
201805     DISPLAY '   PROGRAM NAME: ' PC-PROGRAM-NAME, ' END'.         19190005
201806     DISPLAY  PC-ASTERISK-LINE.                                   19200005
201807                                                                  19210005
201808*9999-EXIT.                                                       19220005
