000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    SUKCS580.                                         00040000
000500 AUTHOR.        LARRY SCHLEICHER.                                 00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  DEC, 2001.                                        00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    S580 - VENDOR/DEPT LIST PROGRAM.                           * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF VENDORS/DEPARTMENT.       * 00130000
001400*    THE ASSOCIATED DEPARTMENT NUMBER, DEPARTMENT NAME AND THE  * 00140000
001500*    RANKINGS WILL BE DISPLAYED.  THE APPROPRIATE PROGRAM IS    * 00150000
001600*    INVOKED WHEN THE OPERATOR SELECTS ONE OR MORE ITEMS AND    * 00160000
001700*    PRESSES A FUNCTION KEY.                                    * 00170000
001800*                                                               * 00180000
001900*---------------------------------------------------------------* 00190000
001500*    CHANGES                                                     *00192000
      *    MADE BY: CHERI PARMLEY        PR#5148D                      *00193000
      *    DATE:    10/01/2013                                         *00194000
      *                                                                *00195000
      *    NEW RANKING COLUMN 'RFID' WAS ADDED TO THE SCREEN FOR RFID  *00196000
      *    RANKING.  CHANGES CAN BE FOUND WITH *CLP 10/01/13           *00197000
      *                                                                *00198000
001600*----------------------------------------------------------------*00199000
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00199201
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00199301
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00199401
001130*                                                                 00199502
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00199602
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00199702
263968*---------------------------------------------------------------* 00199801
002000 EJECT                                                            00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600                                                                  00260000
002700 01  DK-DB2-KEYS.                                                 00270000
002800     15  DK-ENT-ID                      PIC S9(09)  VALUE ZERO    00280000
002900                                                    COMP.         00290000
003000     15  DK-DEPT-NBR                    PIC S9(04)  VALUE ZERO    00300000
003100                                                    COMP-3.       00310000
003200     15  DK-VENDOR-DESC                 PIC  X(30)  VALUE SPACES. 00320000
003300                                                                  00330000
003400 01  PC-PROGRAM-CONSTANTS.                                        00340000
003500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00350000
003600                                                    'SU580A  '.   00360000
003700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00370000
003800                                                    'SUKM580 '.   00380000
003900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00390000
004000                                                    'SUKCS580'.   00400000
004100     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00410000
004200     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00420000
004300     05  PC-INTER-APPL-CODES.                                     00430000
004400         10  PC-INTER-APPL-CRIT-SPEC                              00440000
004500                                  PIC  X(01)  VALUE '1'.          00450000
004600         10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '2'.          00460000
004700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00470000
004800                                                    COMP SYNC.    00480000
004900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00490000
005000                                                    COMP SYNC.    00500000
005100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00510000
005200                                                    +1000000      00520000
005300                                                    COMP-3.       00530000
005400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00540000
005500                                                    COMP SYNC.    00550000
005600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00560000
005700                                                    COMP-3.       00570000
005800     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00580000
005900     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00590000
006000     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00600000
006100     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00610000
006200     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00620000
006300     05  PC-01                          PIC  X(02)  VALUE '01'.   00630000
006400*                                                                 00640000
006500     05  PC-TSYMSG-NUMBERS.                                       00650000
006600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00660000
006700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00670000
006800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00680000
006900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00690000
007000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00700000
007100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00710000
007200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00720000
007300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00730000
007400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00740000
007500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00750000
007600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00760000
007700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00770000
007800         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00780000
007900         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00790000
008000         10  PC-TSYMSG-00302            PIC  9(05)  VALUE 00302.  00800000
008100         10  PC-TSYMSG-02844            PIC  9(05)  VALUE 02844.  00810000
008200         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00820000
008300*                                                                 00830000
008400 01  PS-PROGRAM-SWITCHES.                                         00840000
008500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00850000
008600         88  PS-NO-ERROR                            VALUE 'Y'.    00860000
008700         88  PS-ERROR                               VALUE 'N'.    00870000
008800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00880000
008900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00890000
009000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00900000
009100     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00910000
009200         88  PS-DONE                                VALUE 'Y'.    00920000
009300         88  PS-NOT-DONE                            VALUE 'N'.    00930000
009400     05  PS-END-OF-RANKINGS-SW          PIC  X(01)  VALUE 'N'.    00940000
009500         88  PS-END-OF-RANKINGS                     VALUE 'Y'.    00950000
009600         88  PS-NOT-END-OF-RANKINGS                 VALUE 'N'.    00960000
009700     05  PS-ACCESS-SW                   PIC  X(01)  VALUE 'N'.    00970000
009800         88  PS-ACCESS-ALLOWED                      VALUE 'Y'.    00980000
009900         88  PS-ACCESS-NOT-ALLOWED                  VALUE 'N'.    00990000
010000     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   01000000
010100         88  PS-LIST-END                            VALUE  'Y'.   01010000
010200         88  PS-NO-LIST-END                         VALUE  'N'.   01020000
010300*                                                                 01030000
010400 01  PV-PROGRAM-VARIABLES.                                        01040000
010500     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      01050000
010600                                                    COMP SYNC.    01060000
010700     05  PV-SUB                         PIC S9(04)  VALUE +0      01070000
010800                                                    COMP SYNC.    01080000
010900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01090000
011000                                                    COMP SYNC.    01100000
011100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01110000
011200                                                    COMP-3.       01120000
011300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01130000
011400                                                    COMP-3.       01140000
011500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01150000
011600                                                    COMP-3.       01160000
011700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01170000
011800                                                    COMP-3.       01180000
011900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01190000
012000                                                    COMP-3.       01200000
012100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01210000
012200                                                    COMP-3.       01220000
012300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01230000
012400                                                    COMP-3.       01240000
012500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01250000
012600                                                    COMP SYNC.    01260000
012700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01270000
012800                                                    COMP SYNC.    01280000
012900     05  PV-ITEM                        PIC S9(04)  VALUE +0      01290000
013000                                                    COMP SYNC.    01300000
013100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01310000
013200                                                    COMP SYNC.    01320000
013300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01330000
013400                                                    COMP SYNC.    01340000
013500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01350000
013600                                                    COMP SYNC.    01360000
013700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01370000
013800                                                    COMP SYNC.    01380000
013900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01390000
014000                                                    COMP SYNC.    01400000
014100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01410000
014200                                                    COMP SYNC.    01420000
014300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01430000
014400                                                    COMP SYNC.    01440000
014500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01450000
014600                                                    COMP SYNC.    01460000
014700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01470000
014800                                                    COMP SYNC.    01480000
014900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01490000
015000                                                    COMP SYNC.    01500000
015100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01510000
015200                                                    COMP SYNC.    01520000
015300     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01530000
015400                                                    COMP SYNC.    01540000
015500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01550000
015600                                                    COMP SYNC.    01560000
015700     05  PV-BULK-VND-RNKG-CDE           PIC  X(06).               01570000
015800     05  PV-PREPACK-VND-RNKG-CDE        PIC  X(06).               01580000
015900     05  PV-PBS-VND-RNKG-CDE            PIC  X(06).               01590000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   01590100
015900     05  PV-RFID-VND-RNKG-CDE           PIC  X(06).               01591000
      *CLP 10/01/13 END   - PR# 5148D                                   01593000
016000     05  PV-COUNT-DEPT-RANKGS           PIC S9(04)  COMP.         01600000
016100******************************************************************01610000
016200**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01620000
016300**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01630000
016400**  APPLICATION-SPECIFIC COMMAREA.                              **01640000
016500******************************************************************01650000
016600 01  LQW-LIST-QUEUE-WORK-AREA.                                    01660000
016700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01670000
016800     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01680000
016900                                        INDEXED BY LQW-IDX.       01690000
017000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01700000
017100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01710000
017200         10  LQW-SELECTED-SW            PIC  X(01).               01720000
017300             88  LQW-SELECT                         VALUE 'S'.    01730000
017400             88  LQW-DESELECT                       VALUE ' '.    01740000
017500         10  LQW-ACTION                 PIC  X(03).               01750000
017600         10  LQW-DEPT-NBR               PIC S9(04)  COMP-3.       01760000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   01760100
017700         10  LQW-DEPT-NAME              PIC  X(23).               01770000
      *CLP 10/01/13 END   - PR# 5148D                                   01772000
017800         10  LQW-BULK-RANKING           PIC  X(06).               01780000
017900         10  LQW-PREPACK-RANKING        PIC  X(06).               01790000
018000         10  LQW-PBS-RANKING            PIC  X(06).               01800000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   01800100
018000         10  LQW-RFID-RANKING           PIC  X(06).               01802000
      *CLP 10/01/13 END   - PR# 5148D                                   01802100
018100                                                                  01810000
018200     EJECT                                                        01820000
018300*---------------------------------------------------------------* 01830000
018400*  RECORD LAYOUT FOR THE VENDOR SELECTION TEMP STORAGE QUEUE.   * 01840000
018500*---------------------------------------------------------------* 01850000
018600                                                                  01860000
018700     COPY SUWS019.                                                01870000
018800                                                                  01880000
018900*----------------------------------------------------------------*01890000
019000**  SECURITY SUBROUTINE PARAMETERS                                01900000
019100*----------------------------------------------------------------*01910000
019200     COPY DPWS008.                                                01920000
019300     EJECT                                                        01930000
019400*---------------------------------------------------------------* 01940000
019500*    MAP LAYOUT                                                 * 01950000
019600*---------------------------------------------------------------* 01960000
019700                                                                  01970000
019800     COPY SUKM580.                                                01980000
019900*                                                                 01990000
020000 01  MR-OCCURS-LAYOUT                   REDEFINES  SU580AO.       02000000
020100     05  FILLER                         PIC X(91).                02010000
020200     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          02020000
020300         10  MR-SELECTL                 PIC S9(04) COMP.          02030000
020400         10  MR-SELECTA                 PIC  X(01).               02040000
020500         10  MR-SELECTC                 PIC  X(01).               02050000
020600         10  MR-SELECTH                 PIC  X(01).               02060000
020700         10  MR-SELECTI                 PIC  X(01).               02070000
020800                                                                  02080000
020900         10  MR-ACTIONL                 PIC S9(04) COMP.          02090000
021000         10  MR-ACTIONA                 PIC  X(01).               02100000
021100         10  MR-ACTIONC                 PIC  X(01).               02110000
021200         10  MR-ACTIONH                 PIC  X(01).               02120000
021300         10  MR-ACTION                  PIC  X(03).               02130000
021400                                                                  02140000
021500         10  MR-DEPT-NBRL               PIC S9(04) COMP.          02150000
021600         10  MR-DEPT-NBRA               PIC  X(01).               02160000
021700         10  MR-DEPT-NBRC               PIC  X(01).               02170000
021800         10  MR-DEPT-NBRH               PIC  X(01).               02180000
021900         10  MR-DEPT-NBR-X.                                       02190000
022000             15  MR-DEPT-NBR            PIC ZZZ9.                 02200000
022100                                                                  02210000
022200         10  MR-DEPT-NAMEL              PIC S9(04) COMP.          02220000
022300         10  MR-DEPT-NAMEA              PIC  X(01).               02230000
022400         10  MR-DEPT-NAMEC              PIC  X(01).               02240000
022500         10  MR-DEPT-NAMEH              PIC  X(01).               02250000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   02250100
022600         10  MR-DEPT-NAME               PIC  X(23).               02260000
      *CLP 10/01/13 END   - PR# 5148D                                   02260100
022700                                                                  02270000
022800         10  MR-BULK-RANKINGL           PIC S9(04) COMP.          02280000
022900         10  MR-BULK-RANKINGA           PIC  X(01).               02290000
023000         10  MR-BULK-RANKINGC           PIC  X(01).               02300000
023100         10  MR-BULK-RANKINGH           PIC  X(01).               02310000
023200         10  MR-BULK-RANKING            PIC  X(06).               02320000
023300                                                                  02330000
023400         10  MR-PREPACK-RANKINGL        PIC S9(04) COMP.          02340000
023500         10  MR-PREPACK-RANKINGA        PIC  X(01).               02350000
023600         10  MR-PREPACK-RANKINGC        PIC  X(01).               02360000
023700         10  MR-PREPACK-RANKINGH        PIC  X(01).               02370000
023800         10  MR-PREPACK-RANKING         PIC X(06).                02380000
023900                                                                  02390000
024000         10  MR-PBS-RANKINGL            PIC S9(04) COMP.          02400000
024100         10  MR-PBS-RANKINGA            PIC  X(01).               02410000
024200         10  MR-PBS-RANKINGC            PIC  X(01).               02420000
024300         10  MR-PBS-RANKINGH            PIC  X(01).               02430000
024400         10  MR-PBS-RANKING             PIC  X(06).               02440000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   02441000
024000         10  MR-RFID-RANKINGL            PIC S9(04) COMP.         02451000
024100         10  MR-RFID-RANKINGA            PIC  X(01).              02452000
024200         10  MR-RFID-RANKINGC            PIC  X(01).              02453000
024300         10  MR-RFID-RANKINGH            PIC  X(01).              02454000
024400         10  MR-RFID-RANKING             PIC  X(06).              02455000
      *CLP 10/01/13 END   - PR# 5148D                                   02455100
024600                                                                  02460000
024700     EJECT                                                        02470000
024800*---------------------------------------------------------------* 02480000
024900*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02490000
025000*---------------------------------------------------------------* 02500000
025100                                                                  02510000
025200     COPY DPWS015.                                                02520000
025300                                                                  02530000
025400*---------------------------------------------------------------* 02540000
025500*    FUNCTION KEYS COPYBOOK.                                    * 02550000
025600*---------------------------------------------------------------* 02560000
025700                                                                  02570000
025800     COPY DPWS016.                                                02580000
025900                                                                  02590000
026000*---------------------------------------------------------------* 02600000
026100*    NUMERIC EDIT LAYOUT.                                       * 02610000
026200*---------------------------------------------------------------* 02620000
026300                                                                  02630000
026400     COPY DPWS010I.                                               02640000
026500 EJECT                                                            02650000
026600*---------------------------------------------------------------* 02660000
026700*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 02670002
026800*---------------------------------------------------------------* 02680000
026900                                                                  02690000
027000     COPY DPWS030.                                                02700000
027000     COPY DPWS930.                                                02701002
027100 EJECT                                                            02710000
027200*---------------------------------------------------------------* 02720000
027300*    STANDARD COMMAREA.                                         * 02730000
027400*---------------------------------------------------------------* 02740000
027500                                                                  02750000
027600     COPY DPWS020.                                                02760000
027700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02770000
027800                                                                  02780000
027900*---------------------------------------------------------------* 02790000
028000* INTER-APPLICATION COMMAREA.                                   * 02800000
028100*   SUWS017 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02810000
028200*             SPEC SCREEN.                                      * 02820000
028300*   SUWS018 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02830000
028400*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02840000
028500*---------------------------------------------------------------* 02850000
028600                                                                  02860000
028700         10  INTER-APPL-COMM-AREA       PIC X(200).               02870000
028800     COPY SUWS017.                                                02880000
028900     COPY SUWS018.                                                02890000
029000*---------------------------------------------------------------* 02900000
029100*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02910000
029200*---------------------------------------------------------------* 02920000
029300         10  ASC-SPECIFIC-COMMAREA.                               02930000
029400             15  ASC-LIST-KEYS.                                   02940000
029500                 20  ASC-ENT-ID.                                  02950000
029600                     25  ASC-ENT-ID-N                PIC 9(09).   02960000
029800                 20  ASC-VENDOR-DESC                 PIC  X(30).  02980000
029900                 20  ASC-DEPT-NBR.                                02990000
030000                     25  ASC-DEPT-NBR-N              PIC  9(04).  03000000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   03000100
030100                 20  ASC-DEPT-DESC                   PIC  X(23).  03010000
      *CLP 10/01/13 END   - PR# 5148D                                   03010100
030200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03020000
030300                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03030000
030400                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03040000
030500                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03050000
030600                                                                  03060000
030700                 20  ASC-ITEM-ARRAY.                              03070000
030800                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        03080000
030900                         30  ASC-LIST-ITEM-NUMBER                 03090000
031000                                                     PIC S9(09)   03100000
031100                                                     COMP-3.      03110000
031200                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03120000
031300                             88  ASC-VALID-SELECT    VALUE ' '    03130000
031400                                                           'S'    03140000
031500                                                           'B'    03150000
031600                                                           'E'.   03160000
031700                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03170000
031800                             88  ASC-TEMP-SELECT     VALUE 'S'.   03180000
031900                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03190000
032000                             88  ASC-TEMP-END        VALUE 'E'.   03200000
032100                         30  ASC-SELECTED-SW         PIC  X(01).  03210000
032200                             88  ASC-NO-SELECT       VALUE ' '.   03220000
032300                             88  ASC-SELECT          VALUE 'S'.   03230000
032400                             88  ASC-BEGIN           VALUE 'B'.   03240000
032500                             88  ASC-END             VALUE 'E'.   03250000
032600                         30  ASC-ACTION              PIC  X(03).  03260000
032700                         30  ASC-LINE-DEPT-NBR       PIC S9(04)   03270000
032800                                                     COMP-3.      03280000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   03280100
032900                         30  ASC-DEPT-NAME           PIC  X(23).  03290000
      *CLP 10/01/13 END   - PR# 5148D                                   03290100
033000                         30  ASC-BULK-VND-RNKG-CDE   PIC  X(06).  03300000
033100                         30  ASC-PREPACK-VND-RNKG-CDE             03310000
033200                                                     PIC  X(06).  03320000
033300                         30  ASC-PBS-VND-RNKG-CDE    PIC  X(06).  03330000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   03330100
033300                         30  ASC-RFID-VND-RNKG-CDE   PIC  X(06).  03332000
      *CLP 10/01/13 END   - PR# 5148D                                   03334000
033400                                                                  03340000
033500             15  ASC-BLK-SUB                         PIC S9(04)   03350000
033600                                                          COMP    03360000
033700                                                          SYNC.   03370000
033800             15  ASC-ITEM-SUB                        PIC S9(04)   03380000
033900                                                          COMP    03390000
034000                                                          SYNC.   03400000
034100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03410000
034200                                                          COMP-3. 03420000
034300             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03430000
034400                                                          COMP-3. 03440000
034500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03450000
034600                                                          COMP-3. 03460000
034700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03470000
034800                                                          COMP-3. 03480000
034900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03490000
035000                                                          COMP-3. 03500000
035100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03510000
035200                                                          COMP    03520000
035300                                                          SYNC.   03530000
035400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03540000
035500                                                          COMP-3. 03550000
035600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03560000
035700                                                          COMP-3. 03570000
035800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03580000
035900                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03590000
036000                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03600000
036100             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03610000
036200                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03620000
036300                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03630000
036400             15  ASC-LIST-QUEUE-NAME.                             03640000
036500                 20  ASC-LIST-TERM-ID                PIC  X(04).  03650000
036600                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03660000
036700                                                          COMP-3. 03670000
036800                 20  ASC-LIST-SEQ                    PIC  9(01).  03680000
036900             15  ASC-SEL-QUEUE-NAME.                              03690000
037000                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03700000
037100                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03710000
037200                                                          COMP-3. 03720000
037300                 20  ASC-SEL-SEQ                     PIC  9(01).  03730000
037400                                                                  03740000
037500             15  ASC-SEL-QUEUE-NAME-IN.                           03750000
037600                 20  ASC-SEL-TERM-ID-IN  PIC X(04).               03760000
037700                 20  ASC-SEL-TASK-NUMBER-IN                       03770000
037800                                      PIC S9(05) COMP-3.          03780000
037900                 20  ASC-SEL-SEQ-IN      PIC 9(01).               03790000
038000             15  ASC-USE-SELECTION-QUEUE-IND                      03800000
038100                                           PIC  X(01).            03810000
038200                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03820000
038300             15  ASC-START-ITEM-REQUEST.                          03830000
038400                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03840000
038500             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    03850000
038600             15  ASC-SEL-SUB               PIC S9(04)  COMP.      03860000
038700             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      03870000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   03870100
038800         10  FILLER                        PIC  X(1039).          03881000
      *CLP 10/01/13 END   - PR# 5148D                                   03881100
038900     EJECT                                                        03890000
039000*---------------------------------------------------------------* 03900000
039100*    ABEND PROCESSING COPYBOOK.                                 * 03910000
039200*---------------------------------------------------------------* 03920000
039300                                                                  03930000
039400     COPY DPWS013.                                                03940000
039500                                                                  03950000
039600 EJECT                                                            03960000
039700*----------------------------------------------------------------*03970000
039800*    DB2 DCLGEN FOR THE VENDOR RANKING TABLE (SUT_VND_RNKG)       03980000
039900*----------------------------------------------------------------*03990000
040000     EXEC SQL                                                     04000000
040100          INCLUDE SUT00019                                        04010000
040200     END-EXEC.                                                    04020000
040300*----------------------------------------------------------------*04030000
040400*    DB2 DCLGEN FOR THE VENDOR DEPT RANKING TABLE                 04040000
040500*    (SUT_VND_DEPT_RNKG)                                          04050000
040600*----------------------------------------------------------------*04060000
040700     EXEC SQL                                                     04070000
040800          INCLUDE SUT00018                                        04080000
040900     END-EXEC.                                                    04090000
041000*----------------------------------------------------------------*04100000
041100*    DB2 DCLGEN FOR THE VENDOR PO AUDIT PARM TABLE                04110000
041200*    (SUT_PO_AUD_PARM)                                            04120000
041300*----------------------------------------------------------------*04130000
041400     EXEC SQL                                                     04140000
041500          INCLUDE SUT00017                                        04150000
041600     END-EXEC.                                                    04160000
041700*----------------------------------------------------------------*04170000
041800*    DB2 DCLGEN FOR THE VENDOR RANKING CODE TABLE                 04180000
041900*    (SUT_VND_RNKG_CDE)                                           04190000
042000*----------------------------------------------------------------*04200000
042100     EXEC SQL                                                     04210000
042200          INCLUDE SUT00016                                        04220000
042300     END-EXEC.                                                    04230000
042400*----------------------------------------------------------------*04240000
042500*    DB2 DCLGEN FOR THE VENDOR DEPARTMENT TABLE                   04250000
042600*----------------------------------------------------------------*04260000
042700     EXEC SQL                                                     04270000
042800          INCLUDE TVNDDPT                                         04280000
042900     END-EXEC.                                                    04290000
043000*----------------------------------------------------------------*04300000
043100*    DB2 DCLGEN FOR THE MERCHANDISE AREA TABLE                    04310000
043200*----------------------------------------------------------------*04320000
043300     EXEC SQL                                                     04330000
043400          INCLUDE TMDSEAR                                         04340000
043500     END-EXEC.                                                    04350000
043600                                                                  04360000
043700*----------------------------------------------------------------*04370000
043800*    DB2 DCLGEN FOR THE MERCHANDISE DEPARTMENT TABLE              04380000
043900*----------------------------------------------------------------*04390000
044000     EXEC SQL                                                     04400000
044100          INCLUDE TMDSEDP                                         04410000
044200     END-EXEC.                                                    04420000
044300                                                                  04430000
044400*----------------------------------------------------------------*04440000
044500*    DB2 SQL COMMUNICATION AREA                                   04450000
044600*----------------------------------------------------------------*04460000
044700     EXEC SQL                                                     04470000
044800          INCLUDE SQLCA                                           04480000
044900     END-EXEC.                                                    04490000
045000                                                                  04500000
045100                                                                  04510000
045200*---------------------------------------------------------------* 04520000
045300*    CURSOR FOR ALL VENDORS WITH THE SPECIFIED ENT-ID           * 04530000
045400*---------------------------------------------------------------* 04540000
045500                                                                  04550000
045600     EXEC SQL                                                     04560000
045700          DECLARE DEPT-CSR CURSOR                                 04570000
045800          FOR SELECT                                              04580000
045900                A.DEPT_NBR                                        04590000
046000             ,  B.MDSEAR_DESC                                     04600000
046100          FROM                                                    04610000
046200                TVNDDPT A                                         04620000
046300             ,  TMDSEAR B                                         04630000
046400             ,  TMDSEDP C                                         04640000
046500          WHERE                                                   04650000
046600                A.ENT_ID            = :DK-ENT-ID                  04660000
046700            AND A.VND_DEPT_STAT_CD  = 'A'                         04670000
046800            AND A.DEPT_NBR          = B.DEPT_NBR                  04680000
046900            AND B.MDSELV_CDE        = 'DPT'                       04690000
047000            AND B.OPERCO_NBR        = '03'                        04700000
047100            AND (B.STRT_DTE        <= CURRENT DATE AND            04710000
047200                 B.END_DTE          > CURRENT DATE)               04720000
047300            AND B.MDSEAR_DKEY       = C.MDSEAR_DKEY               04730000
047400       ORDER BY A.DEPT_NBR                                        04740000
047500     END-EXEC.                                                    04750000
047600                                                                  04760000
047700*---------------------------------------------------------------* 04770000
047800*    CURSOR FOR ALL THE RANKINGS FOR VENDOR                       04780000
047900*---------------------------------------------------------------* 04790000
048000     EXEC SQL                                                     04800000
048100          DECLARE RANKINGS-CSR CURSOR                             04810000
048200          FOR SELECT                                              04820000
048300                B.VND_RNKG_CDE                                    04830000
048400             ,  B.PKGNG_TYP_CDE                                   04840000
048500          FROM                                                    04850000
048600                SUT_VND_DEPT_RNKG A                               04860000
048700             ,  SUT_PO_AUD_PARM B                                 04870000
048800          WHERE                                                   04880000
048900                A.ENT_ID         = :DK-ENT-ID                     04890000
049000            AND A.DEPT_NBR       = :DK-DEPT-NBR                   04900000
049100            AND A.VND_RNKG_CDE   = B.VND_RNKG_CDE                 04910000
049200            AND A.PKGNG_TYP_CDE  = B.PKGNG_TYP_CDE                04920000
049300            AND B.EFF_BEG_TMST IN                                 04930000
049400            (SELECT MAX(C.EFF_BEG_TMST)                           04940000
049500              FROM SUT_PO_AUD_PARM C                              04950000
049600              WHERE C.VND_RNKG_CDE  = B.VND_RNKG_CDE              04960000
049700                AND C.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE)            04970000
049800     END-EXEC.                                                    04980000
049900                                                                  04990000
050000                                                                  05000000
050100 EJECT                                                            05010000
050200 LINKAGE SECTION.                                                 05020000
050300                                                                  05030000
050400 01  DFHCOMMAREA.                                                 05040000
050500     05  FILLER                         OCCURS  1 TO 4072 TIMES   05050000
050600                                        DEPENDING ON EIBCALEN.    05060000
050700         10  FILLER                     PIC X.                    05070000
050800                                                                  05080000
050900 EJECT                                                            05090000
051000 PROCEDURE DIVISION.                                              05100000
051100******************************************************************05110000
051200**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05120000
051300**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05130000
051400**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05140000
051500******************************************************************05150000
051600 0000-MAIN-MODULE.                                                05160000
051700     INITIALIZE DP030-CICS-API-FIELDS.                            05170000
051800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05180000
051900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05190000
052000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05200000
052100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05210000
052200     MOVE LENGTH OF SU580AI        TO DP030-MAP-LENGTH (1).       05220000
052300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05230000
052400     PERFORM 0001-CALL-CICS-ARCH-API.                             05240000
052500*                                                                 05250000
052600     PERFORM 1000-CONTROL-PROCESSING                              05260000
052700*                                                                 05270000
052800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05280000
052900     PERFORM 0001-CALL-CICS-ARCH-API.                             05290000
053000                                                                  05300000
053100******************************************************************05310000
053200**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05320000
053300**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05330000
053400******************************************************************05340000
053500 0001-CALL-CICS-ARCH-API.                                         05350000
053600*    CALL 'DPKCS030' USING DFHEIBLK                               05360002
053600     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05361002
053700                           DFHCOMMAREA                            05370000
053800                           DP030-CICS-API-FIELDS                  05380000
053900                           DP020-STANDARD-COMMAREA                05390000
054000                           SU580AI.                               05400000
054100*                                                                 05410000
054200     IF  DP030-RC-CALL-SUCCESSFUL                                 05420000
054300         CONTINUE                                                 05430000
054400     ELSE                                                         05440000
054500         SET DP013-NO-ROLLBACK                                    05450000
054600             DP013-XCTL-DISPLAY-RESTART                           05460000
054700             DP013-CICS-ABEND      TO TRUE                        05470000
054800         MOVE '0001-CALL-CICS-ARCH-API'                           05480000
054900                                   TO DP013-PARAGRAPH             05490000
055000*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX05500002
055100*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      05510002
055000         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL. RETURN-CODE O05511002
055100-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05512002
055200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05520000
055300         PERFORM DP013-0000-PROCESS-ABEND                         05530000
055400     END-IF.                                                      05540000
055500*----------------------------------------------------------------*05550000
055600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05560000
055700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05570000
055800*                                                                *05580000
055900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05590000
056000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05600000
056100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05610000
056200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05620000
056300*----------------------------------------------------------------*05630000
056400                                                                  05640000
056500 1000-CONTROL-PROCESSING.                                         05650000
056600                                                                  05660000
056700     EVALUATE TRUE                                                05670000
056800         WHEN DP020-NEXT-ACT-INITIAL                              05680000
056900             INITIALIZE ASC-SPECIFIC-COMMAREA                     05690000
057000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05700000
057100                                      ASC-SEL-TERM-ID             05710000
057200             MOVE DP020-SRC-TASK-NUMBER                           05720000
057300                                   TO ASC-LIST-TASK-NUMBER        05730000
057400                                      ASC-SEL-TASK-NUMBER         05740000
057500             MOVE PC-LIST-QUEUE-SEQ                               05750000
057600                                   TO ASC-LIST-SEQ                05760000
057700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05770000
057800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05780000
057900***-----$TEMPLATE NOTE$-------------------------------------------05790000
058000*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05800000
058100*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05810000
058200*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05820000
058300***---------------------------------------------------------------05830000
058400             IF  PS-COMMAREA-NOT-VALID                            05840000
058500***              MOVE PC-TSYMSG-99901                             05850000
058600***                                TO DP020-MSG-NUMBER            05860000
058700***              SET DP020-MSG-FATAL                              05870000
058800***                                TO TRUE                        05880000
058900                 SET DP020-NEXT-ACT-APPL-ERROR                    05890000
059000                                   TO TRUE                        05900000
059100             ELSE                                                 05910000
059200                 PERFORM 4000-BUILD-INITIAL-PANEL                 05920000
059300             END-IF                                               05930000
059400                                                                  05940000
059500         WHEN DP020-NEXT-ACT-READ-MAP                             05950000
059600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05960000
059700                                   TO PV-TOP-ITEM                 05970000
059800             PERFORM 2000-PROCESS-PANEL                           05980000
059900                                                                  05990000
060000         WHEN DP020-NEXT-ACT-RETURN                               06000000
060100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06010000
060200                                   TO PV-TOP-ITEM                 06020000
060300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06030000
060400             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06040000
060500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06050000
060600*            PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06060000
060700                                                                  06070000
060800         WHEN OTHER                                               06080000
060900             SET DP013-LOGIC-ABEND TO TRUE                        06090000
061000             SET DP013-NO-ROLLBACK TO TRUE                        06100000
061100             MOVE '1000-CONTROL-PROCESSING'                       06110000
061200                                   TO DP013-PARAGRAPH             06120000
061300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06130000
061400                                   TO DP013-MESSAGE-TEXT(1)       06140000
061500             PERFORM DP013-0000-PROCESS-ABEND                     06150000
061600     END-EVALUATE.                                                06160000
061700                                                                  06170000
061800 EJECT                                                            06180000
061900*----------------------------------------------------------------*06190000
062000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06200000
062100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06210000
062200*----------------------------------------------------------------*06220000
062300                                                                  06230000
062400 1100-PROCESS-INTER-APPL-COMM.                                    06240000
062500                                                                  06250000
062600     SET PS-COMMAREA-VALID         TO TRUE.                       06260000
062700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06270000
062800     EVALUATE DP020-INT-APPL-FORMAT-IND                           06280000
062900         WHEN PC-INTER-APPL-CRIT-SPEC                             06290000
063000             MOVE SU017-ENT-ID         TO ASC-ENT-ID-N            06300000
063100                                          DK-ENT-ID               06310000
063200             MOVE SU017-VENDOR-DESC    TO ASC-VENDOR-DESC         06320000
063300             MOVE SU017-DEPT-NBR       TO ASC-DEPT-NBR            06330000
063400                                          DK-DEPT-NBR             06340000
063500                                                                  06350000
063600         WHEN PC-INTER-APPL-LIST                                  06360000
063700             SET ASC-USE-SELECTION-QUEUE TO TRUE                  06370000
063800             MOVE SU018-NUMBER-OF-SELECTED-ITEMS                  06380000
063900                                   TO ASC-NUMBER-OF-SELECTED-ITEMS06390000
064000             MOVE SU018-NUMBER-OF-TS-ITEMS                        06400000
064100                                   TO ASC-NUMBER-OF-TS-ITEMS      06410000
064200             MOVE SU018-SEL-QUEUE-NAME                            06420000
064300                                   TO ASC-SEL-QUEUE-NAME-IN       06430000
064400             PERFORM 1120-PREPARE-LIST-ENTRY                      06440000
064500                                                                  06450000
064600         WHEN OTHER                                               06460000
064700             IF  DP020-NAV-KEY-DATA > SPACE                       06470000
064800                 PERFORM 1110-EDIT-NAV-KEY                        06480000
064900             ELSE                                                 06490000
065000                 MOVE PC-TSYMSG-00148                             06500000
065100                                   TO DP020-MSG-NUMBER            06510000
065200                 SET DP020-MSG-FATAL                              06520000
065300                     DP020-NEXT-ACT-APPL-ERROR                    06530000
065400                                   TO TRUE                        06540000
065500             END-IF                                               06550000
065600     END-EVALUATE.                                                06560000
065700                                                                  06570000
065800******************************************************************06580000
065900** EDIT THE KEY ENTERED BY THE USER INTO THE KEY FIELD OF THE   **06590000
066000** COMMAND LINE.  A VALID MESSAGE NUMBER IS THE ONLY KEY        **06600000
066100** ACCEPTED.                                                    **06610000
066200******************************************************************06620000
066300 1110-EDIT-NAV-KEY.                                               06630000
066400     IF  ASC-ENT-ID > SPACE                                       06640000
066500         MOVE DP020-NAV-KEY-DATA   TO DP010I-UNEDITED-FIELD       06650000
066600         MOVE LENGTH OF ASC-ENT-ID                                06660000
066700                                   TO DP010I-MAXIMUM-DIGITS       06670000
066800         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     06680000
066900         SET DP010I-NEGATIVE-NOT-ALLOWED                          06690000
067000                                   TO TRUE                        06700000
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06711001
263968              USING DP010I-NUMERIC-EDIT-AREA                      06712001
067200         IF  DP010I-ERROR-DETECTED                                06720000
067300             SET PS-ERROR                                         06730000
067400                 DP020-MSG-FATAL   TO TRUE                        06740000
067500*            -- INVALID DATA IN KEY FIELD ---                     06750000
067600             MOVE PC-TSYMSG-00302  TO DP020-MSG-NUMBER            06760000
067700             SET DP020-NEXT-ACT-APPL-ERROR                        06770000
067800                                   TO TRUE                        06780000
067900         ELSE                                                     06790000
068000             MOVE DP010I-NUMERIC-FIELD                            06800000
068100                                   TO ASC-ENT-ID-N                06810000
068200         END-IF                                                   06820000
068300     END-IF.                                                      06830000
068400*----------------------------------------------------------------*06840000
068500* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *06850000
068600* STORAGE QUEUE PASSED FROM THE LIST.                            *06860000
068700*----------------------------------------------------------------*06870000
068800 1120-PREPARE-LIST-ENTRY.                                         06880000
068900     MOVE SU019-MAX-ITEMS          TO ASC-SEL-SUB.                06890000
069000     MOVE ZERO                     TO ASC-SEL-ITEM.               06900000
069100     PERFORM 2300-GET-NEXT-RECORD.                                06910000
069200 EJECT                                                            06920000
069300*----------------------------------------------------------------*06930000
069400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06940000
069500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06950000
069600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06960000
069700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06970000
069800* FUNCTION KEYS CAN GET THIS FAR.                                *06980000
069900*----------------------------------------------------------------*06990000
070000                                                                  07000000
070100 2000-PROCESS-PANEL.                                              07010000
070200     EVALUATE TRUE                                                07020000
070300         WHEN DP020-SRC-AID = DP016-CLEAR                         07030000
070400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07040000
070500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07050000
070600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07060000
070700                                                                  07070000
070800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07080000
070900             MOVE ASC-ENT-ID-N     TO DK-ENT-ID                   07090000
071000             MOVE ASC-DEPT-NBR     TO DK-DEPT-NBR                 07100000
071100             PERFORM 2050-DELETE-LIST-QUEUE                       07110000
071200             PERFORM 4000-BUILD-INITIAL-PANEL                     07120000
071300                                                                  07130000
071400         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07140000
071500             IF ASC-USE-SELECTION-QUEUE                           07150000
071600                 PERFORM 2300-GET-NEXT-RECORD                     07160000
071700                 IF PS-LIST-END                                   07170000
071800                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07180000
071900                     SET PS-NO-LIST-END TO TRUE                   07190000
072000                 ELSE                                             07200000
072100                     PERFORM 2050-DELETE-LIST-QUEUE               07210000
072200                     PERFORM 3200-RESET-ATTRIBUTES                07220000
072300                     PERFORM 4000-BUILD-INITIAL-PANEL             07230000
072400                 END-IF                                           07240000
072500              ELSE                                                07250000
072600*                --- BOTTOM OF LIST ---                           07260000
072610                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07261000
072700                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         07270000
072800                 SET DP020-MSG-INFORMATIONAL TO TRUE              07280000
072900             END-IF                                               07290000
073000                                                                  07300000
073100         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07310000
073200             IF ASC-USE-SELECTION-QUEUE                           07320000
073300                 PERFORM 2310-GET-PREV-RECORD                     07330000
073400                 IF PS-LIST-END                                   07340000
073500                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07350000
073600                     SET PS-NO-LIST-END TO TRUE                   07360000
073700                 ELSE                                             07370000
073800                     PERFORM 2050-DELETE-LIST-QUEUE               07380000
073900                     PERFORM 3200-RESET-ATTRIBUTES                07390000
074000                     PERFORM 4000-BUILD-INITIAL-PANEL             07400000
074100                 END-IF                                           07410000
074200             ELSE                                                 07420000
074300                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         07430000
074400                 SET DP020-MSG-INFORMATIONAL TO TRUE              07440000
074500             END-IF                                               07450000
074600                                                                  07460000
074700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07470000
074800             PERFORM 2140-DESELECT-ALL-ITEMS                      07480000
074900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07490000
075000                                                                  07500000
075100         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07510000
075200             PERFORM 2150-SELECT-ALL-ITEMS                        07520000
075300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07530000
075400                                                                  07540000
075500         WHEN OTHER                                               07550000
075600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07560000
075700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07570000
075800             IF  PS-NO-ERROR                                      07580000
075900                 SET DP030-CONTINUE-GO                            07590000
076000                                 TO TRUE                          07600000
076100                 PERFORM 2100-CHECK-FUNCTION-KEY                  07610000
076200             ELSE                                                 07620000
076300                 SET DP030-OVERRIDE-GO                            07630000
076400                                 TO TRUE                          07640000
076500             END-IF                                               07650000
076600     END-EVALUATE.                                                07660000
076700 EJECT                                                            07670000
076800*----------------------------------------------------------------*07680000
076900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07690000
077000*----------------------------------------------------------------*07700000
077100 2050-DELETE-LIST-QUEUE.                                          07710000
077200                                                                  07720000
077300     EXEC CICS                                                    07730000
077400         DELETEQ TS                                               07740000
077500             QUEUE (ASC-LIST-QUEUE-NAME)                          07750000
077600             RESP  (PV-CICS-RESP)                                 07760000
077700     END-EXEC.                                                    07770000
077800                                                                  07780000
077900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07790000
078000        (PV-CICS-RESP = DFHRESP(QIDERR))                          07800000
078100         CONTINUE                                                 07810000
078200     ELSE                                                         07820000
078300         SET DP013-CICS-ABEND      TO TRUE                        07830000
078400         SET DP013-NO-ROLLBACK     TO TRUE                        07840000
078500                                                                  07850000
078600         MOVE '2050-DELETE-LIST-QUEUE'                            07860000
078700                                   TO DP013-PARAGRAPH             07870000
078800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07880000
078900                                   TO DP013-MESSAGE-TEXT (1)      07890000
079000         PERFORM DP013-0000-PROCESS-ABEND                         07900000
079100     END-IF.                                                      07910000
079200                                                                  07920000
079300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07930000
079400 EJECT                                                            07940000
079500*----------------------------------------------------------------*07950000
079600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07960000
079700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07970000
079800* CICS ARCHITECTURE API.                                         *07980000
079900*----------------------------------------------------------------*07990000
080000 2100-CHECK-FUNCTION-KEY.                                         08000000
080100     EVALUATE TRUE                                                08010000
080200                                                                  08020000
080300* F15 - UPDATE VENDOR RANK   (LOCAL-FUNC-01)                      08030000
080400*                                                                 08040000
080500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08050000
080600             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08060000
080700                 MOVE 'SUVNDRKU' TO DP008-FUNCTION-NAME           08070000
080800                 PERFORM 2105-RACF-ACCESS                         08080000
080900                 IF  PS-ACCESS-NOT-ALLOWED                        08090000
081000                     SET  PS-ERROR                                08100000
081100                          DP020-MSG-FATAL TO TRUE                 08110000
081200                     MOVE PC-TSYMSG-02844 TO DP020-MSG-NUMBER     08120000
081300                     MOVE -1              TO MR-SELECTL (1)       08130000
081400                     SET  DP030-SET-CURSOR-APPL-1 TO TRUE         08140000
081500                     SET DP030-OVERRIDE-GO       TO TRUE          08150000
081600                 END-IF                                           08160000
081700                 IF PS-NO-ERROR                                   08170000
081800                     INITIALIZE SU018-INTER-APPL-COMMAREA         08180000
081900                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            08190000
082000                                TO SU018-NUMBER-OF-SELECTED-ITEMS 08200000
082100                     PERFORM 5000-PREPARE-SEL-QUEUE               08210000
082200                 END-IF                                           08220000
082300             ELSE                                                 08230000
082400                 SET DP030-OVERRIDE-GO                            08240000
082500                                   TO TRUE                        08250000
082600                 MOVE PC-TSYMSG-00057                             08260000
082700                                   TO DP020-MSG-NUMBER            08270000
082800                 SET DP020-MSG-WARNING                            08280000
082900                                   TO TRUE                        08290000
083000             END-IF                                               08300000
083100                                                                  08310000
083200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08320000
083300             MOVE +1               TO PV-TOP-ITEM                 08330000
083400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08340000
083500                                                                  08350000
083600         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08360000
083700             PERFORM 2110-BROWSE-BACKWARD                         08370000
083800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08380000
083900                                                                  08390000
084000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08400000
084100             PERFORM 2120-BROWSE-FORWARD                          08410000
084200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08420000
084300                                                                  08430000
084400         WHEN DP020-SRC-AID = DP016-ENTER                         08440000
084500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08450000
084600             IF  PS-ERROR                                         08460000
084700                 CONTINUE                                         08470000
084800             ELSE                                                 08480000
084900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08490000
085000             END-IF                                               08500000
085100                                                                  08510000
085200         WHEN OTHER                                               08520000
085300             PERFORM 2050-DELETE-LIST-QUEUE                       08530000
085400             PERFORM 4000-BUILD-INITIAL-PANEL                     08540000
085500             PERFORM 3200-RESET-ATTRIBUTES                        08550000
085600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08560000
085700**LS         SET DP013-NO-ROLLBACK                                08570000
085800**LS             DP013-XCTL-DISPLAY-RESTART                       08580000
085900**LS             DP013-CICS-ABEND  TO TRUE                        08590000
086000**LS         MOVE '2100-CHECK-FUNCTION-KEY'                       08600000
086100**LS                               TO DP013-PARAGRAPH             08610000
086200**LS         MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08620000
086300**LS                               TO DP013-MESSAGE-TEXT (1)      08630000
086400**LS         PERFORM DP013-0000-PROCESS-ABEND                     08640000
086500     END-EVALUATE.                                                08650000
086600                                                                  08660000
086700*----------------------------------------------------------------*08670000
086800* CHECK TO SEE IF USER HAS RACF AUTHORIZATION                     08680000
086900*----------------------------------------------------------------*08690000
087000 2105-RACF-ACCESS.                                                08700000
087100                                                                  08710000
087200      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  08720000
087300      SET DP008-ACCESS-TYPE-USE          TO TRUE                  08730000
087400                                                                  08740000
087500      EXEC CICS                                                   08750000
087600         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 08760000
087700              COMMAREA (DP008-SECURITY-COMMAREA)                  08770000
087800              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             08780000
087900      END-EXEC                                                    08790000
088000                                                                  08800000
088100      IF DP008-CALL-SUCCESSFUL                                    08810000
088200         IF DP008-ACCESS-ALLOWED                                  08820000
088300             SET PS-ACCESS-ALLOWED TO TRUE                        08830000
088400         ELSE                                                     08840000
088500             SET PS-ACCESS-NOT-ALLOWED TO TRUE                    08850000
088600         END-IF                                                   08860000
088700     ELSE                                                         08870000
088800         MOVE '2105-RACF-ACCESS'                                  08880000
088900                               TO DP013-PARAGRAPH                 08890000
089000          MOVE 'UNABLE TO ACCESS CICS'                            08900000
089100                               TO DP013-MESSAGE-TEXT (1)          08910000
089200          MOVE SQLCA                 TO DP013-SQLCA               08920000
089300          SET DP013-DB2-ABEND                                     08930000
089400              DP013-XCTL-DISPLAY-RESTART                          08940000
089500                               TO TRUE                            08950000
089600          PERFORM DP013-0000-PROCESS-ABEND                        08960000
089700      END-IF.                                                     08970000
089800                                                                  08980000
089900*                                                                 08990000
090000*----------------------------------------------------------------*09000000
090100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09010000
090200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09020000
090300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09030000
090400*    MESSAGE.                                                    *09040000
090500*----------------------------------------------------------------*09050000
090600                                                                  09060000
090700 2110-BROWSE-BACKWARD.                                            09070000
090800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09080000
090900         GIVING PV-TOP-ITEM.                                      09090000
091000*                                                                 09100000
091100     IF  ((PV-TOP-ITEM < +1)                                      09110000
091200       OR (PV-TOP-ITEM = +1))                                     09120000
091300         MOVE +1                   TO PV-TOP-ITEM                 09130000
091400*        -- TOP OF LIST --                                        09140000
091500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09150000
091600         SET DP020-MSG-INFORMATIONAL TO TRUE                      09160000
091700     END-IF.                                                      09170000
091800                                                                  09180000
091900 EJECT                                                            09190000
092000*----------------------------------------------------------------*09200000
092100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09210000
092200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09220000
092300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09230000
092400*----------------------------------------------------------------*09240000
092500                                                                  09250000
092600 2120-BROWSE-FORWARD.                                             09260000
092700                                                                  09270000
092800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09280000
092900         GIVING PV-TOP-ITEM.                                      09290000
093000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09300000
093100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09310000
093200                                   TO PV-TOP-ITEM                 09320000
093300*        -- BOTTOM OF LIST --                                     09330000
093400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09340000
093500         SET DP020-MSG-INFORMATIONAL                              09350000
093600                                   TO TRUE                        09360000
093700     ELSE                                                         09370000
093800         COMPUTE PV-BOTTOM-ITEM =                                 09380000
093900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09390000
094000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09400000
094100*            -- BOTTOM OF LIST --                                 09410000
094200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09420000
094300             SET DP020-MSG-INFORMATIONAL                          09430000
094400                                   TO TRUE                        09440000
094500         END-IF                                                   09450000
094600     END-IF.                                                      09460000
094700 EJECT                                                            09470000
094800*----------------------------------------------------------------*09480000
094900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09490000
095000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09500000
095100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09510000
095200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09520000
095300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09530000
095400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09540000
095500*----------------------------------------------------------------*09550000
095600                                                                  09560000
095700 2130-CHECK-FOR-JUMP-BROWSE.                                      09570000
095800     SET PS-NO-ERROR               TO TRUE.                       09580000
095900     IF (ASC-START-ITEM-REQUEST = SPACE)                          09590000
096000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09600000
096100                                   TO PV-TOP-ITEM                 09610000
096200     ELSE                                                         09620000
096300         MOVE ASC-START-ITEM-REQUEST                              09630000
096400                                   TO DP010I-UNEDITED-FIELD       09640000
096500         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09650000
096600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09660000
096700         SET DP010I-NEGATIVE-NOT-ALLOWED                          09670000
096800                                   TO TRUE                        09680000
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09691001
263968              USING DP010I-NUMERIC-EDIT-AREA                      09692001
097000                                                                  09700000
097100         IF  NOT DP010I-ERROR-DETECTED                            09710000
097200             MOVE DP010I-NUMERIC-FIELD                            09720000
097300                                   TO  ASC-START-ITEM-REQUEST-N   09730000
097400             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09740000
097500                 IF  ASC-START-ITEM-REQUEST-N >                   09750000
097600                                          ASC-NUMBER-OF-ITEMS-READ09760000
097700                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09770000
097800                     COMPUTE PV-TOP-ITEM =                        09780000
097900                             ASC-NUMBER-OF-ITEMS-READ             09790000
098000                             - PC-ITEMS-PER-PANEL + 1             09800000
098100                     IF  PV-TOP-ITEM < +1                         09810000
098200                         MOVE +1   TO PV-TOP-ITEM                 09820000
098300                         MOVE PC-TSYMSG-00070                     09830000
098400                                   TO DP020-MSG-NUMBER            09840000
098500                         SET DP020-MSG-INFORMATIONAL              09850000
098600                                   TO TRUE                        09860000
098700                     END-IF                                       09870000
098800                 ELSE                                             09880000
098900                     MOVE ASC-START-ITEM-REQUEST-N                09890000
099000                                   TO PV-TOP-ITEM                 09900000
099100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09910000
099200                     COMPUTE PV-BOTTOM-ITEM =                     09920000
099300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09930000
099400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09940000
099500*                        -- BOTTOM OF LIST --                     09950000
099600                         MOVE PC-TSYMSG-00070                     09960000
099700                                   TO DP020-MSG-NUMBER            09970000
099800                         SET DP020-MSG-INFORMATIONAL              09980000
099900                                   TO TRUE                        09990000
100000                     END-IF                                       10000000
100100                 END-IF                                           10010000
100200             ELSE                                                 10020000
100300*                --- VALUE OUT OF RANGE ----                      10030000
100400                 MOVE PC-TSYMSG-00101                             10040000
100500                                   TO DP020-MSG-NUMBER            10050000
100600                 MOVE -1           TO ASTRTITL                    10060000
100700                 SET DP030-SET-CURSOR-APPL-1                      10070000
100800                                   TO TRUE                        10080000
100900                 MOVE DP015-REVERSE                               10090000
101000                                   TO ASTRTITH                    10100000
101100                 MOVE DP015-RED    TO ASTRTITC                    10110000
101200                 MOVE DP015-UNP-NUM-BRT-MDT                       10120000
101300                                   TO ASTRTITA                    10130000
101400                 SET DP020-MSG-FATAL                              10140000
101500                                   TO TRUE                        10150000
101600                 SET PS-ERROR      TO TRUE                        10160000
101700             END-IF                                               10170000
101800                                                                  10180000
101900         ELSE                                                     10190000
102000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10200000
102100             MOVE -1               TO ASTRTITL                    10210000
102200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10220000
102300             MOVE DP015-REVERSE    TO ASTRTITH                    10230000
102400             MOVE DP015-RED        TO ASTRTITC                    10240000
102500             MOVE DP015-UNP-NUM-BRT-MDT                           10250000
102600                                   TO ASTRTITA                    10260000
102700             SET DP020-MSG-FATAL   TO TRUE                        10270000
102800             SET PS-ERROR          TO TRUE                        10280000
102900         END-IF                                                   10290000
103000     END-IF.                                                      10300000
103100 EJECT                                                            10310000
103200*----------------------------------------------------------------*10320000
103300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10330000
103400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10340000
103500*----------------------------------------------------------------*10350000
103600 2140-DESELECT-ALL-ITEMS.                                         10360000
103700     MOVE +1                       TO ASC-BLK-SUB.                10370000
103800                                                                  10380000
103900     PERFORM 2141-CLEAR-SELECTED-INDS                             10390000
104000         VARYING ASC-ITEM-SUB                                     10400000
104100         FROM 1 BY 1                                              10410000
104200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10420000
104300                                                                  10430000
104400     ADD +1                        TO ASC-BLK-SUB.                10440000
104500                                                                  10450000
104600     PERFORM 2141-CLEAR-SELECTED-INDS                             10460000
104700         VARYING ASC-ITEM-SUB                                     10470000
104800         FROM 1 BY 1                                              10480000
104900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10490000
105000                                                                  10500000
105100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10510000
105200                                   TO PV-LIST-ITEM-NUMBER.        10520000
105300                                                                  10530000
105400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10540000
105500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10550000
105600                                                                  10560000
105700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10570000
105800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10580000
105900         MOVE +1                   TO ASC-BLK-SUB                 10590000
106000                                                                  10600000
106100         PERFORM 5100-WRITE-TEMP-STORAGE                          10610000
106200                                                                  10620000
106300         MOVE +1                   TO PV-BLOCK-NUMBER             10630000
106400                                                                  10640000
106500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10650000
106600             PV-FIRST-BLOCK-IN-ARRAY - 1                          10660000
106700                                                                  10670000
106800         PERFORM                                                  10680000
106900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10690000
107000                                                                  10700000
107100             PERFORM 4410-READ-TEMP-STORAGE                       10710000
107200                                                                  10720000
107300             PERFORM 2141-CLEAR-SELECTED-INDS                     10730000
107400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10740000
107500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10750000
107600                                                                  10760000
107700             PERFORM 5100-WRITE-TEMP-STORAGE                      10770000
107800                                                                  10780000
107900             ADD +1                TO PV-BLOCK-NUMBER             10790000
108000                                                                  10800000
108100         END-PERFORM                                              10810000
108200                                                                  10820000
108300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10830000
108400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10840000
108500                                                                  10850000
108600         PERFORM                                                  10860000
108700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10870000
108800                   ASC-HIGHEST-BLOCK-WRITTEN                      10880000
108900                                                                  10890000
109000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10900000
109100                                   TO PV-BLOCK-NUMBER             10910000
109200                                                                  10920000
109300             PERFORM 4410-READ-TEMP-STORAGE                       10930000
109400                                                                  10940000
109500             PERFORM 2141-CLEAR-SELECTED-INDS                     10950000
109600                 VARYING ASC-ITEM-SUB                             10960000
109700                 FROM 1 BY 1                                      10970000
109800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10980000
109900                                                                  10990000
110000             PERFORM 5100-WRITE-TEMP-STORAGE                      11000000
110100                                                                  11010000
110200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11020000
110300                                                                  11030000
110400         END-PERFORM                                              11040000
110500                                                                  11050000
110600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11060000
110700                                   TO PV-BLOCK-NUMBER             11070000
110800                                                                  11080000
110900         PERFORM 4410-READ-TEMP-STORAGE                           11090000
111000     END-IF.                                                      11100000
111100                                                                  11110000
111200                                                                  11120000
111300     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 11130000
111400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.11140000
111500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  11150000
111600                                                                  11160000
111700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11170000
111800                                                                  11180000
111900 EJECT                                                            11190000
112000*----------------------------------------------------------------*11200000
112100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11210000
112200*----------------------------------------------------------------*11220000
112300                                                                  11230000
112400 2141-CLEAR-SELECTED-INDS.                                        11240000
112500                                                                  11250000
112600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11260000
112700             NOT EQUAL ZERO                                       11270000
112800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11280000
112900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11290000
113000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11300000
113100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11310000
113200                                   TO TRUE                        11320000
113300         END-IF                                                   11330000
113400     END-IF.                                                      11340000
113500                                                                  11350000
113600 EJECT                                                            11360000
113700*----------------------------------------------------------------*11370000
113800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11380000
113900*  FOR ALL ITEMS.                                                *11390000
114000*----------------------------------------------------------------*11400000
114100                                                                  11410000
114200 2150-SELECT-ALL-ITEMS.                                           11420000
114300                                                                  11430000
114400     MOVE +1                       TO ASC-BLK-SUB.                11440000
114500                                                                  11450000
114600     PERFORM 2151-SET-SELECTED-INDS                               11460000
114700         VARYING ASC-ITEM-SUB                                     11470000
114800         FROM 1 BY 1                                              11480000
114900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11490000
115000                                                                  11500000
115100     ADD +1                        TO ASC-BLK-SUB.                11510000
115200                                                                  11520000
115300     PERFORM 2151-SET-SELECTED-INDS                               11530000
115400         VARYING ASC-ITEM-SUB                                     11540000
115500         FROM 1 BY 1                                              11550000
115600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11560000
115700                                                                  11570000
115800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11580000
115900                                   TO PV-LIST-ITEM-NUMBER.        11590000
116000                                                                  11600000
116100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11610000
116200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11620000
116300                                                                  11630000
116400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11640000
116500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11650000
116600         MOVE +1                   TO ASC-BLK-SUB                 11660000
116700                                                                  11670000
116800         PERFORM 5100-WRITE-TEMP-STORAGE                          11680000
116900                                                                  11690000
117000         MOVE +1                   TO PV-BLOCK-NUMBER             11700000
117100                                                                  11710000
117200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11720000
117300             PV-FIRST-BLOCK-IN-ARRAY - 1                          11730000
117400                                                                  11740000
117500         PERFORM                                                  11750000
117600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11760000
117700                                                                  11770000
117800             PERFORM 4410-READ-TEMP-STORAGE                       11780000
117900                                                                  11790000
118000             PERFORM 2151-SET-SELECTED-INDS                       11800000
118100                 VARYING ASC-ITEM-SUB                             11810000
118200                 FROM 1 BY 1                                      11820000
118300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11830000
118400                                                                  11840000
118500             PERFORM 5100-WRITE-TEMP-STORAGE                      11850000
118600                                                                  11860000
118700             ADD +1                TO PV-BLOCK-NUMBER             11870000
118800                                                                  11880000
118900         END-PERFORM                                              11890000
119000                                                                  11900000
119100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11910000
119200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11920000
119300                                                                  11930000
119400         PERFORM                                                  11940000
119500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11950000
119600                   ASC-HIGHEST-BLOCK-WRITTEN                      11960000
119700                                                                  11970000
119800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11980000
119900                                   TO PV-BLOCK-NUMBER             11990000
120000                                                                  12000000
120100             PERFORM 4410-READ-TEMP-STORAGE                       12010000
120200                                                                  12020000
120300             PERFORM 2151-SET-SELECTED-INDS                       12030000
120400                 VARYING ASC-ITEM-SUB                             12040000
120500                 FROM 1 BY 1                                      12050000
120600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12060000
120700                                                                  12070000
120800             PERFORM 5100-WRITE-TEMP-STORAGE                      12080000
120900                                                                  12090000
121000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12100000
121100                                                                  12110000
121200         END-PERFORM                                              12120000
121300                                                                  12130000
121400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12140000
121500                                   TO PV-BLOCK-NUMBER             12150000
121600                                                                  12160000
121700         PERFORM 4410-READ-TEMP-STORAGE                           12170000
121800     END-IF.                                                      12180000
121900                                                                  12190000
122000                                                                  12200000
122100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12210000
122200                       ASC-NUMBER-OF-SELECTED-ITEMS.              12220000
122300                                                                  12230000
122400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12240000
122500                                                                  12250000
122600 EJECT                                                            12260000
122700*----------------------------------------------------------------*12270000
122800*    MARK EACH ITEM AS BEING SELECTED.                           *12280000
122900*----------------------------------------------------------------*12290000
123000                                                                  12300000
123100 2151-SET-SELECTED-INDS.                                          12310000
123200                                                                  12320000
123300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12330000
123400             NOT EQUAL ZERO                                       12340000
123500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12350000
123600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12360000
123700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12370000
123800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12380000
123900                               TO  TRUE                           12390000
124000         END-IF                                                   12400000
124100     END-IF.                                                      12410000
124200******************************************************************12420000
124300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12430000
124400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12440000
124500******************************************************************12450000
124600 2200-MOVE-SCREEN-TO-COMMAREA.                                    12460000
124700                                                                  12470000
124800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12480000
124900     MOVE +1                       TO PV-SUB.                     12490000
125000*                                                                 12500000
125100     PERFORM 3100-SET-SUBSCRIPTS.                                 12510000
125200     IF  ASTRTITL > ZERO                                          12520000
125300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12530000
125400     ELSE                                                         12540000
125500         IF  ASTRTITF = DP015-ERASE-EOF                           12550000
125600             INITIALIZE ASC-START-ITEM-REQUEST                    12560000
125700         END-IF                                                   12570000
125800     END-IF.                                                      12580000
125900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12590000
126000         VARYING PV-SUB                                           12600000
126100         FROM 1 BY 1                                              12610000
126200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12620000
126300******************************************************************12630000
126400** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12640000
126500******************************************************************12650000
126600 2210-MOVE-LINES-TO-COMMAREA.                                     12660000
126700     IF  MR-SELECTL (PV-SUB) > ZERO                               12670000
126800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12680000
126900         MOVE MR-SELECTI (PV-SUB)                                 12690000
127000                                   TO ASC-TEMP-SELECTED-SW        12700000
127100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12710000
127200     ELSE                                                         12720000
127300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12730000
127400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12740000
127500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12750000
127600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12760000
127700         END-IF                                                   12770000
127800     END-IF.                                                      12780000
127900     ADD +1                        TO ASC-ITEM-SUB.               12790000
128000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12800000
128100         ADD +1                    TO ASC-BLK-SUB                 12810000
128200         MOVE +1                   TO ASC-ITEM-SUB                12820000
128300     END-IF.                                                      12830000
128400                                                                  12840000
128500 2300-GET-NEXT-RECORD.                                            12850000
128600     ADD +1                        TO ASC-SEL-SUB.                12860000
128700     IF  ASC-SEL-SUB > SU019-MAX-ITEMS                            12870000
128800         ADD +1                    TO ASC-SEL-ITEM                12880000
128900         MOVE +1                   TO ASC-SEL-SUB                 12890000
129000     END-IF.                                                      12900000
129100     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                12910000
129200         PERFORM 9100-READ-SEL-QUEUE                              12920000
129300         IF  SU019-ITEM (ASC-SEL-SUB) > ZERO                      12930000
129400             MOVE SU019-ENT-ID      (ASC-SEL-SUB)                 12940000
129500                                   TO ASC-ENT-ID-N                12950000
129600                                      DK-ENT-ID                   12960000
129700             MOVE SU019-DEPT-NBR    (ASC-SEL-SUB)                 12970000
129800                                   TO ASC-DEPT-NBR-N              12980000
129900                                      DK-DEPT-NBR                 12990000
130000             MOVE SU019-VENDOR-DESC (ASC-SEL-SUB)                 13000000
130100                                   TO ASC-VENDOR-DESC             13010000
130200             MOVE SU019-DEPT-DESC   (ASC-SEL-SUB)                 13020000
130300                                   TO ASC-DEPT-DESC               13030000
130400             SET SU019-INQ (ASC-SEL-SUB)                          13040000
130500                                   TO TRUE                        13050000
130600             PERFORM 9200-REWRITE-LIST-QUEUE                      13060000
130700         ELSE                                                     13070000
130800             SUBTRACT +1 FROM ASC-SEL-SUB                         13080000
130900*            --- BOTTOM OF LIST ---                               13090000
131000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            13100000
131100             SET DP020-MSG-INFORMATIONAL                          13110000
131200                 PS-LIST-END       TO TRUE                        13120000
131300         END-IF                                                   13130000
131400     ELSE                                                         13140000
131500         SUBTRACT +1 FROM ASC-SEL-ITEM                            13150000
131600         MOVE SU019-MAX-ITEMS      TO ASC-SEL-SUB                 13160000
131700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            13170000
131800         SET DP020-MSG-INFORMATIONAL                              13180000
131900             PS-LIST-END           TO TRUE                        13190000
132000     END-IF.                                                      13200000
132100                                                                  13210000
132200 2310-GET-PREV-RECORD.                                            13220000
132300     SUBTRACT +1                 FROM ASC-SEL-SUB.                13230000
132400     IF ASC-SEL-SUB < +1                                          13240000
132500         SUBTRACT +1             FROM ASC-SEL-ITEM                13250000
132600         MOVE SU019-MAX-ITEMS      TO ASC-SEL-SUB                 13260000
132700     END-IF.                                                      13270000
132800                                                                  13280000
132920     MOVE SU018-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME-IN       13292000
133000     IF ASC-SEL-ITEM > ZERO                                       13300000
133100         PERFORM 9100-READ-SEL-QUEUE                              13310000
133200         MOVE SU019-ENT-ID      (ASC-SEL-SUB)                     13320000
133300                               TO ASC-ENT-ID-N                    13330000
133400                                  DK-ENT-ID                       13340000
133500         MOVE SU019-DEPT-NBR    (ASC-SEL-SUB)                     13350000
133600                               TO ASC-DEPT-NBR-N                  13360000
133700                                  DK-DEPT-NBR                     13370000
133800         MOVE SU019-VENDOR-DESC (ASC-SEL-SUB)                     13380000
133900                               TO ASC-VENDOR-DESC                 13390000
134000         MOVE SU019-DEPT-DESC   (ASC-SEL-SUB)                     13400000
134100                               TO ASC-DEPT-DESC                   13410000
134200         SET SU019-INQ (ASC-SEL-SUB) TO TRUE                      13420000
134300         PERFORM 5120-REWRITE-LIST-QUEUE                          13430000
134400     ELSE                                                         13440000
134500             MOVE +1 TO  ASC-SEL-SUB                              13450000
134600                         ASC-SEL-ITEM                             13460000
134700*            --- TOP OF LIST ---                                  13470000
134800             MOVE PC-TSYMSG-00069  TO DP020-MSG-NUMBER            13480000
134900             SET DP020-MSG-INFORMATIONAL                          13490000
135000                 PS-LIST-END       TO TRUE                        13500000
135100     END-IF.                                                      13510000
135200                                                                  13520000
135300******************************************************************13530000
135400** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **13540000
135500** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **13550000
135600******************************************************************13560000
135700 3000-EDIT-DATA-IN-COMMAREA.                                      13570000
135800     SET PS-NO-ERROR               TO TRUE.                       13580000
135900     PERFORM 3200-RESET-ATTRIBUTES.                               13590000
136000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13600000
136100**                                                                13610000
136200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13620000
136300* EDITTING IS DONE FROM THE BOTTOM UP.                            13630000
136400**                                                                13640000
136500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13650000
136600         ASC-ITEMS-DISPLAYED - 1.                                 13660000
136700     PERFORM 3100-SET-SUBSCRIPTS.                                 13670000
136800     PERFORM 3300-EDIT-SELECTIONS                                 13680000
136900         VARYING PV-SUB                                           13690000
137000         FROM PV-SUB BY -1                                        13700000
137100         UNTIL PV-SUB < +1                                        13710000
137200*                                                                 13720000
137300     IF  PS-NO-ERROR                                              13730000
137400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13740000
137500     END-IF.                                                      13750000
137600*                                                                 13760000
137700     IF  ((PS-NO-ERROR)                                           13770000
137800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13780000
137900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13790000
138000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13800000
138100     END-IF.                                                      13810000
138200 EJECT                                                            13820000
138300*----------------------------------------------------------------*13830000
138400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13840000
138500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13850000
138600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13860000
138700*                                                                *13870000
138800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13880000
138900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13890000
139000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13900000
139100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13910000
139200*----------------------------------------------------------------*13920000
139300                                                                  13930000
139400 3100-SET-SUBSCRIPTS.                                             13940000
139500                                                                  13950000
139600     COMPUTE ASC-ITEM-SUB =                                       13960000
139700         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13970000
139800                                                                  13980000
139900     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13990000
140000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14000000
140100                                                                  14010000
140200         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               14020000
140300     ELSE                                                         14030000
140400         MOVE +1                     TO ASC-BLK-SUB               14040000
140500     END-IF.                                                      14050000
140600******************************************************************14060000
140700** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **14070000
140800******************************************************************14080000
140900                                                                  14090000
141000 3200-RESET-ATTRIBUTES.                                           14100000
141100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   14110000
141200     MOVE DP015-GREEN              TO ASTRTITC.                   14120000
141300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   14130000
141400*                                                                 14140000
141500     PERFORM                                                      14150000
141600         VARYING PV-SUB                                           14160000
141700         FROM 1 BY 1                                              14170000
141800         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        14180000
141900         MOVE DP015-UNP-ALP-NOR-OFF                               14190000
142000                                   TO MR-SELECTA (PV-SUB)         14200000
142100         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         14210000
142200         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         14220000
142300     END-PERFORM.                                                 14230000
142400******************************************************************14240000
142500** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **14250000
142600** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **14260000
142700** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **14270000
142800** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **14280000
142900******************************************************************14290000
143000 3300-EDIT-SELECTIONS.                                            14300000
143100     EVALUATE TRUE                                                14310000
143200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14320000
143300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14330000
143400                 CONTINUE                                         14340000
143500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14350000
143600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14360000
143700                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   14370000
143800                 MOVE ASC-TEMP-SELECTED-SW                        14380000
143900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14390000
144000                                TO ASC-SELECTED-SW                14400000
144100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14410000
144200             END-IF                                               14420000
144300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14430000
144400                 = SPACE                                          14440000
144500             EVALUATE TRUE                                        14450000
144600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14460000
144700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14470000
144800                     MOVE SPACE TO ASC-SELECTED-SW                14480000
144900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14490000
145000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14500000
145100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    14510000
145200                     MOVE SPACE TO ASC-SELECTED-SW                14520000
145300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14530000
145400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14540000
145500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      14550000
145600                     MOVE SPACE TO ASC-SELECTED-SW                14560000
145700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14570000
145800             END-EVALUATE                                         14580000
145900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14590000
146000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14600000
146100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14610000
146200             END-IF                                               14620000
146300             PERFORM 3310-EDIT-RANGE                              14630000
146400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14640000
146500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14650000
146600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14660000
146700             END-IF                                               14670000
146800             PERFORM 3310-EDIT-RANGE                              14680000
146900         WHEN OTHER                                               14690000
147000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           14700000
147100             SET DP020-MSG-FATAL    TO TRUE                       14710000
147200             MOVE -1                TO MR-SELECTL (PV-SUB)        14720000
147300             SET DP030-SET-CURSOR-APPL-1                          14730000
147400                                    TO TRUE                       14740000
147500             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        14750000
147600             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14760000
147700             SET PS-ERROR TO TRUE                                 14770000
147800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14780000
147900                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14790000
148000                 MOVE SPACE         TO ASC-SELECTED-SW            14800000
148100                                        (ASC-BLK-SUB ASC-ITEM-SUB)14810000
148200             END-IF                                               14820000
148300     END-EVALUATE.                                                14830000
148400                                                                  14840000
148500     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14850000
148600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14860000
148700     IF  ASC-ITEM-SUB < 1                                         14870000
148800         SUBTRACT +1 FROM ASC-BLK-SUB                             14880000
148900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14890000
149000     END-IF.                                                      14900000
149100******************************************************************14910000
149200** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **14920000
149300** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **14930000
149400** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**14940000
149500** THE ENDING.                                                  **14950000
149600******************************************************************14960000
149700 3310-EDIT-RANGE.                                                 14970000
149800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14980000
149900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14990000
150000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15000000
150100                                   TO ASC-SELECTED-SW             15010000
150200                                        (ASC-BLK-SUB ASC-ITEM-SUB)15020000
150300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15030000
150400         ELSE                                                     15040000
150500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15050000
150600                 CONTINUE                                         15060000
150700             ELSE                                                 15070000
150800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15080000
150900                 MOVE PC-TSYMSG-00054                             15090000
151000                                   TO DP020-MSG-NUMBER            15100000
151100                 SET DP020-MSG-FATAL                              15110000
151200                                   TO TRUE                        15120000
151300                 MOVE -1           TO MR-SELECTL (PV-SUB)         15130000
151400                 SET DP030-SET-CURSOR-APPL-1                      15140000
151500                                   TO TRUE                        15150000
151600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15160000
151700                 MOVE DP015-UNDERLINE                             15170000
151800                                   TO MR-SELECTH (PV-SUB)         15180000
151900                 SET PS-ERROR      TO TRUE                        15190000
152000             END-IF                                               15200000
152100         END-IF                                                   15210000
152200     ELSE                                                         15220000
152300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15230000
152400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15240000
152500                                   TO ASC-SELECTED-SW             15250000
152600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15260000
152700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15270000
152800         ELSE                                                     15280000
152900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15290000
153000                 CONTINUE                                         15300000
153100             ELSE                                                 15310000
153200*                -- ONLY ONE END-OF-RANGE ALLOWED --              15320000
153300                 MOVE PC-TSYMSG-00055                             15330000
153400                                   TO DP020-MSG-NUMBER            15340000
153500                 SET DP020-MSG-FATAL                              15350000
153600                                   TO TRUE                        15360000
153700                 MOVE -1           TO MR-SELECTL (PV-SUB)         15370000
153800                 SET DP030-SET-CURSOR-APPL-1                      15380000
153900                                   TO TRUE                        15390000
154000                 SET PS-ERROR      TO TRUE                        15400000
154100             END-IF                                               15410000
154200         END-IF                                                   15420000
154300     END-IF.                                                      15430000
154400*                                                                 15440000
154500******************************************************************15450000
154600** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **15460000
154700** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **15470000
154800******************************************************************15480000
154900 3400-CHECK-RANGE-SEQUENCE.                                       15490000
155000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15500000
155100       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15510000
155200       AND  ASC-START-OF-SELECTED-RANGE >                         15520000
155300                                         ASC-END-OF-SELECTED-RANGE15530000
155400*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15540000
155500         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 15550000
155600         SET DP020-MSG-FATAL TO TRUE                              15560000
155700         SET PS-ERROR TO TRUE                                     15570000
155800         PERFORM 3410-POSITION-AT-ERROR                           15580000
155900     END-IF.                                                      15590000
156000******************************************************************15600000
156100** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **15610000
156200** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **15620000
156300** SHOULD BE POSITIONED ON A RANGE ERROR.                       **15630000
156400******************************************************************15640000
156500 3410-POSITION-AT-ERROR.                                          15650000
156600     SET DP030-SET-CURSOR-APPL-1                                  15660000
156700                                   TO TRUE.                       15670000
156800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15680000
156900                    - PV-TOP-ITEM + 1.                            15690000
157000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15700000
157100         CONTINUE                                                 15710000
157200     ELSE                                                         15720000
157300         MOVE -1                   TO MR-SELECTL (PV-SUB)         15730000
157400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15740000
157500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15750000
157600     END-IF.                                                      15760000
157700*                                                                 15770000
157800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15780000
157900                    - PV-TOP-ITEM + 1.                            15790000
158000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15800000
158100         CONTINUE                                                 15810000
158200     ELSE                                                         15820000
158300         MOVE -1                   TO MR-SELECTL (PV-SUB)         15830000
158400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15840000
158500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15850000
158600     END-IF.                                                      15860000
158700 EJECT                                                            15870000
158800*----------------------------------------------------------------*15880000
158900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15890000
159000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15900000
159100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15910000
159200*----------------------------------------------------------------*15920000
159300                                                                  15930000
159400 3500-MARK-RANGE-AS-SELECTED.                                     15940000
159500     MOVE +1                       TO  ASC-BLK-SUB.               15950000
159600     PERFORM 3510-MARK-SELECTED-INDS                              15960000
159700         VARYING ASC-ITEM-SUB                                     15970000
159800         FROM 1 BY 1                                              15980000
159900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15990000
160000                                                                  16000000
160100     ADD +1                        TO ASC-BLK-SUB.                16010000
160200     PERFORM 3510-MARK-SELECTED-INDS                              16020000
160300         VARYING ASC-ITEM-SUB                                     16030000
160400         FROM 1 BY 1                                              16040000
160500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16050000
160600                                                                  16060000
160700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16070000
160800                                   TO  PV-LIST-ITEM-NUMBER.       16080000
160900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16090000
161000         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         16100000
161100               PC-ITEMS-PER-PANEL).                               16110000
161200                                                                  16120000
161300     MOVE ASC-START-OF-SELECTED-RANGE                             16130000
161400                                   TO PV-START-OF-SELECTED-RANGE. 16140000
161500     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16150000
161600         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16160000
161700               PC-ITEMS-PER-PANEL).                               16170000
161800                                                                  16180000
161900     MOVE ASC-END-OF-SELECTED-RANGE                               16190000
162000                                   TO  PV-END-OF-SELECTED-RANGE.  16200000
162100     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16210000
162200         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16220000
162300               PC-ITEMS-PER-PANEL).                               16230000
162400     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16240000
162500         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16250000
162600                                                                  16260000
162700     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16270000
162800        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16280000
162900         MOVE +1                   TO ASC-BLK-SUB                 16290000
163000         PERFORM 5100-WRITE-TEMP-STORAGE                          16300000
163100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16310000
163200             PV-FIRST-BLOCK-IN-ARRAY - 1                          16320000
163300                                                                  16330000
163400         PERFORM                                                  16340000
163500             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16350000
163600                   PV-PREV-BLOCK-IN-ARRAY                         16360000
163700             MOVE PV-FIRST-BLOCK-IN-RANGE                         16370000
163800                                   TO PV-BLOCK-NUMBER             16380000
163900             PERFORM 4410-READ-TEMP-STORAGE                       16390000
164000             PERFORM 3510-MARK-SELECTED-INDS                      16400000
164100                 VARYING ASC-ITEM-SUB                             16410000
164200                 FROM 1 BY 1                                      16420000
164300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16430000
164400             PERFORM 5100-WRITE-TEMP-STORAGE                      16440000
164500             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     16450000
164600         END-PERFORM                                              16460000
164700                                                                  16470000
164800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16480000
164900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16490000
165000         PERFORM                                                  16500000
165100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16510000
165200                   PV-LAST-BLOCK-IN-RANGE                         16520000
165300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16530000
165400                                   TO PV-BLOCK-NUMBER             16540000
165500             PERFORM 4410-READ-TEMP-STORAGE                       16550000
165600             PERFORM 3510-MARK-SELECTED-INDS                      16560000
165700                 VARYING ASC-ITEM-SUB                             16570000
165800                 FROM 1 BY 1                                      16580000
165900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16590000
166000             PERFORM 5100-WRITE-TEMP-STORAGE                      16600000
166100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16610000
166200         END-PERFORM                                              16620000
166300                                                                  16630000
166400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16640000
166500                                   TO PV-BLOCK-NUMBER             16650000
166600         PERFORM 4410-READ-TEMP-STORAGE                           16660000
166700     END-IF.                                                      16670000
166800                                                                  16680000
166900     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16690000
167000                                      ASC-END-OF-SELECTED-RANGE.  16700000
167100                                                                  16710000
167200 EJECT                                                            16720000
167300*----------------------------------------------------------------*16730000
167400* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *16740000
167500*----------------------------------------------------------------*16750000
167600                                                                  16760000
167700 3510-MARK-SELECTED-INDS.                                         16770000
167800                                                                  16780000
167900     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16790000
168000                                ASC-ITEM-SUB) >                   16800000
168100         ASC-START-OF-SELECTED-RANGE)                             16810000
168200     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16820000
168300                                ASC-ITEM-SUB) =                   16830000
168400         ASC-START-OF-SELECTED-RANGE)                             16840000
168500                                                                  16850000
168600         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16860000
168700                                    ASC-ITEM-SUB) <               16870000
168800             ASC-END-OF-SELECTED-RANGE)                           16880000
168900         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16890000
169000                                    ASC-ITEM-SUB) =               16900000
169100             ASC-END-OF-SELECTED-RANGE)                           16910000
169200                                                                  16920000
169300             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16930000
169400                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16940000
169500                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16950000
169600                               TO TRUE                            16960000
169700                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16970000
169800                               TO TRUE                            16980000
169900                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16990000
170000             END-IF                                               17000000
170100         END-IF                                                   17010000
170200     END-IF.                                                      17020000
170300                                                                  17030000
170400 EJECT                                                            17040000
170500*----------------------------------------------------------------*17050000
170600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17060000
170700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *17070000
170800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *17080000
170900*    DISPLAY THE PANEL TO USER.                                  *17090000
171000*----------------------------------------------------------------*17100000
171100                                                                  17110000
171200 4000-BUILD-INITIAL-PANEL.                                        17120000
171300                                                                  17130000
171400     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            17140000
171500                                 ASC-BLOCK-ENTRIES (2).           17150000
171600     MOVE +1                 TO ASC-BLK-SUB.                      17160000
171700     SET ASC-ITEMS-LEFT-ON-DB                                     17170000
171800                             TO TRUE.                             17180000
171900                                                                  17190000
172000     MOVE +0                 TO ASC-ITEM-SUB                      17200000
172100                                ASC-NUMBER-OF-ITEMS-READ          17210000
172200                                ASC-NUMBER-OF-SELECTED-ITEMS      17220000
172300                                ASC-HIGHEST-BLOCK-WRITTEN         17230000
172400                                ASC-START-OF-SELECTED-RANGE       17240000
172500                                ASC-END-OF-SELECTED-RANGE         17250000
172600                                ASC-ITEM-AT-TOP-OF-PANEL.         17260000
172700*    PERFORM 4100-PREPARE-CURSOR                                  17270000
172710     MOVE ASC-ENT-ID-N       TO AVENDIDO.                         17271000
172720     MOVE ASC-VENDOR-DESC    TO AVENDNMO.                         17272000
172800                                                                  17280000
172900     PERFORM 4010-OPEN-CURSOR.                                    17290000
173000                                                                  17300000
173100     PERFORM 4300-READ-ITEMS-FROM-DB.                             17310000
173200                                                                  17320000
173300     PERFORM 4020-CLOSE-CURSOR.                                   17330000
173400                                                                  17340000
173500     MOVE +1                   TO  PV-TOP-ITEM.                   17350000
173600     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17360000
173700         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    17370000
173800         SET DP020-MSG-FATAL   TO  TRUE                           17380000
173900         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               17390000
174000     ELSE                                                         17400000
174100         MOVE -1               TO MR-SELECTL (1)                  17410000
174200         SET DP030-SET-CURSOR-APPL-1                              17420000
174300                               TO TRUE                            17430000
174400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17440000
174500     END-IF.                                                      17450000
174600 EJECT                                                            17460000
174700*----------------------------------------------------------------*17470000
174800* OPEN THE TMESSAGE CURSOR.                                      *17480000
174900*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *17490000
175000*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *17500000
175100*   USER.                                                        *17510000
175200*----------------------------------------------------------------*17520000
175300                                                                  17530000
175400 4010-OPEN-CURSOR.                                                17540000
175500     PERFORM                                                      17550000
175600         WITH TEST AFTER                                          17560000
175700         VARYING PV-RETRY-COUNTER                                 17570000
175800         FROM 1 BY 1                                              17580000
175900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17590000
176000                   OR (SQLCODE = ZERO))                           17600000
176100             MOVE 'CURSOR:  DEPT-CSR'                             17610000
176200                               TO DP013-MESSAGE-TEXT (2)          17620000
176300             EXEC SQL                                             17630000
176400                  OPEN DEPT-CSR                                   17640000
176500             END-EXEC                                             17650000
176600                                                                  17660000
176700         EVALUATE TRUE                                            17670000
176800             WHEN SQLCODE = ZERO                                  17680000
176900             WHEN SQLCODE = -904                                  17690000
177000             WHEN SQLCODE = -913                                  17700000
177100                 CONTINUE                                         17710000
177200             WHEN SQLWARN0 NOT = SPACES                           17720000
177300             WHEN SQLCODE < ZERO                                  17730000
177400             WHEN SQLCODE > ZERO                                  17740000
177500                 MOVE '4010-OPEN-CURSOR'                          17750000
177600                                   TO DP013-PARAGRAPH             17760000
177700                 MOVE 'OPEN SYSTEM MESSAGE CURSOR - '             17770000
177800                                   TO DP013-MESSAGE-TEXT (1)      17780000
177900                 MOVE SQLCA        TO DP013-SQLCA                 17790000
178000                 MOVE 'TVNDDPT '   TO DP013-DB2-TABLE-NAME (1)    17800000
178100                 MOVE 'TMDSEAR '   TO DP013-DB2-TABLE-NAME (2)    17810000
178200                 SET DP013-DB2-ABEND                              17820000
178300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17830000
178400                 PERFORM DP013-0000-PROCESS-ABEND                 17840000
178500         END-EVALUATE                                             17850000
178600     END-PERFORM.                                                 17860000
178700*                                                                 17870000
178800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17880000
178900         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             17890000
179000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   17900000
179100                                   TO DP013-MESSAGE-TEXT (1)      17910000
179200         MOVE SQLCA                TO DP013-SQLCA                 17920000
179300         MOVE 'TVNDDPT '           TO DP013-DB2-TABLE-NAME (1)    17930000
179400         MOVE 'TMDSEAR '           TO DP013-DB2-TABLE-NAME (2)    17940000
179500         SET DP013-DB2-ABEND                                      17950000
179600             DP013-XCTL-DISPLAY-RESTART                           17960000
179700                                   TO TRUE                        17970000
179800         PERFORM DP013-0000-PROCESS-ABEND                         17980000
179900     END-IF.                                                      17990000
180000                                                                  18000000
180100 EJECT                                                            18010000
180200*----------------------------------------------------------------*18020000
180300* CLOSE THE TMESSAGE CURSOR.                                     *18030000
180400*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *18040000
180500*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *18050000
180600*   USER.                                                        *18060000
180700*----------------------------------------------------------------*18070000
180800                                                                  18080000
180900 4020-CLOSE-CURSOR.                                               18090000
181000     EXEC SQL                                                     18100000
181100         CLOSE DEPT-CSR                                           18110000
181200     END-EXEC.                                                    18120000
181300*                                                                 18130000
181400     EVALUATE TRUE                                                18140000
181500         WHEN SQLCODE = ZERO                                      18150000
181600             CONTINUE                                             18160000
181700         WHEN SQLWARN0 NOT = SPACES                               18170000
181800         WHEN SQLCODE < ZERO                                      18180000
181900         WHEN SQLCODE > ZERO                                      18190000
182000             MOVE '4020-CLOSE-CURSOR'                             18200000
182100                               TO DP013-PARAGRAPH                 18210000
182200             MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  18220000
182300                               TO DP013-MESSAGE-TEXT (1)          18230000
182400             MOVE SQLCA        TO DP013-SQLCA                     18240000
182500             MOVE 'TVNDDPT '   TO DP013-DB2-TABLE-NAME (1)        18250000
182600             MOVE 'TMDSEAR '   TO DP013-DB2-TABLE-NAME (2)        18260000
182700             SET DP013-DB2-ABEND                                  18270000
182800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18280000
182900             PERFORM DP013-0000-PROCESS-ABEND                     18290000
183000     END-EVALUATE.                                                18300000
183100                                                                  18310000
183200 EJECT                                                            18320000
183300*----------------------------------------------------------------*18330000
183400*    SET UP THE HOST VARIABLES.                                  *18340000
183500*----------------------------------------------------------------*18350000
183600                                                                  18360000
183700*4100-PREPARE-CURSOR.                                             18370000
183800                                                                  18380000
183900                                                                  18390000
184000 EJECT                                                            18400000
184100*----------------------------------------------------------------*18410000
184200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18420000
184300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18430000
184400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18440000
184500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18450000
184600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18460000
184700*                                                                *18470000
184800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *18480000
184900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *18490000
185000*    UPON INITIALIZATION.                                        *18500000
185100*----------------------------------------------------------------*18510000
185200                                                                  18520000
185300 4300-READ-ITEMS-FROM-DB.                                         18530000
185400                                                                  18540000
185500     PERFORM                                                      18550000
185600         VARYING PV-READ-COUNT                                    18560000
185700         FROM 1 BY 1                                              18570000
185800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18580000
185900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18590000
186000                                                                  18600000
186100         PERFORM 4310-FETCH                                       18610000
186200                                                                  18620000
186300         IF  ASC-ITEMS-LEFT-ON-DB                                 18630000
186400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18640000
186500                 ADD +1            TO ASC-ITEM-SUB                18650000
186600             ELSE                                                 18660000
186700                 ADD +1            TO ASC-BLK-SUB                 18670000
186800                 MOVE +1           TO ASC-ITEM-SUB                18680000
186900                                                                  18690000
187000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18700000
187100                     MOVE +1       TO ASC-BLK-SUB                 18710000
187200                     SET ASC-BLOCK-MODIFIED (1)                   18720000
187300                                   TO TRUE                        18730000
187400                     PERFORM 5100-WRITE-TEMP-STORAGE              18740000
187500                     MOVE ASC-BLOCK-ENTRIES                       18750000
187600                               (PC-MAX-BLOCKS-IN-ARRAY)           18760000
187700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18770000
187800                     ADD +1        TO ASC-BLK-SUB                 18780000
187900                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18790000
188000                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18800000
188100                                   TO TRUE                        18810000
188200                 END-IF                                           18820000
188300             END-IF                                               18830000
188400             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18840000
188500             MOVE ASC-NUMBER-OF-ITEMS-READ                        18850000
188600                                   TO ASC-LIST-ITEM-NUMBER        18860000
188700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18870000
188800             MOVE VNDDPT-DEPT-NBR  TO ASC-LINE-DEPT-NBR           18880000
188900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18890000
188910                                       DK-DEPT-NBR                18891000
189000             MOVE MDSEAR-DESC      TO ASC-DEPT-NAME               18900000
189100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18910000
189200             PERFORM 4500-PROCESS-RANKINGS-CURSOR                 18920000
189300             MOVE PV-BULK-VND-RNKG-CDE                            18930000
189400                               TO  ASC-BULK-VND-RNKG-CDE          18940000
189500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18950000
189600             MOVE PV-PREPACK-VND-RNKG-CDE                         18960000
189700                               TO  ASC-PREPACK-VND-RNKG-CDE       18970000
189800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18980000
189900             MOVE PV-PBS-VND-RNKG-CDE                             18990000
190000                               TO  ASC-PBS-VND-RNKG-CDE           19000000
190100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19010000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   19010200
189900             MOVE PV-RFID-VND-RNKG-CDE                            19011000
190000                               TO  ASC-RFID-VND-RNKG-CDE          19012000
190100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19013000
      *CLP 10/01/13 END   - PR# 5148D                                   19013100
190200         END-IF                                                   19020000
190300     END-PERFORM.                                                 19030000
190400                                                                  19040000
190500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19050000
190600         MOVE +1               TO ASC-BLK-SUB                     19060000
190700         PERFORM 5100-WRITE-TEMP-STORAGE                          19070000
190800         ADD +1                TO ASC-BLK-SUB                     19080000
190900         PERFORM 5100-WRITE-TEMP-STORAGE                          19090000
191000                                                                  19100000
191100         MOVE 1                TO ASC-BLK-SUB                     19110000
191200                                  PV-BLOCK-NUMBER                 19120000
191300         PERFORM 4410-READ-TEMP-STORAGE                           19130000
191400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19140000
191500             MOVE 2            TO ASC-BLK-SUB                     19150000
191600                                  PV-BLOCK-NUMBER                 19160000
191700             PERFORM 4410-READ-TEMP-STORAGE                       19170000
191800         END-IF                                                   19180000
191900     END-IF.                                                      19190000
192000 EJECT                                                            19200000
192100*----------------------------------------------------------------*19210000
192200*    FETCH THE MESSAGE CURSOR.                                   *19220000
192300*----------------------------------------------------------------*19230000
192400                                                                  19240000
192500 4310-FETCH.                                                      19250000
192600                                                                  19260000
192700     EXEC SQL                                                     19270000
192800          FETCH DEPT-CSR                                          19280000
192900          INTO  :VNDDPT-DEPT-NBR                                  19290000
193000              , :MDSEAR-DESC                                      19300000
193100     END-EXEC.                                                    19310000
193200                                                                  19320000
193300     EVALUATE TRUE                                                19330000
193400         WHEN SQLCODE = ZERO                                      19340000
193500         WHEN SQLCODE = +100                                      19350000
193600              CONTINUE                                            19360000
193700         WHEN SQLWARN0 NOT = SPACE                                19370000
193800         WHEN SQLCODE NOT = ZERO                                  19380000
193900              MOVE '4310-FETCH-CURSOR'                            19390000
194000                               TO DP013-PARAGRAPH                 19400000
194100              MOVE 'FETCH DEPT CURSOR'                            19410000
194200                               TO DP013-MESSAGE-TEXT (1)          19420000
194300              MOVE SQLCA       TO DP013-SQLCA                     19430000
194400              SET DP013-DB2-ABEND                                 19440000
194500                               TO TRUE                            19450000
194600              PERFORM DP013-0000-PROCESS-ABEND                    19460000
194700     END-EVALUATE.                                                19470000
194800                                                                  19480000
194900     IF  SQLCODE EQUAL +100                                       19490000
195000         SET ASC-NO-ITEMS-LEFT-ON-DB                              19500000
195100                                   TO TRUE                        19510000
195200     END-IF.                                                      19520000
195300                                                                  19530000
195400 EJECT                                                            19540000
195500*----------------------------------------------------------------*19550000
195600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *19560000
195700*----------------------------------------------------------------*19570000
195800                                                                  19580000
195900 4400-MOVE-COMMAREA-TO-SCREEN.                                    19590000
196000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             19600000
196100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          19610000
196200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          19620000
196300             MOVE +1    TO ASC-BLK-SUB                            19630000
196400             PERFORM 5100-WRITE-TEMP-STORAGE                      19640000
196500             ADD +1     TO ASC-BLK-SUB                            19650000
196600             PERFORM 5100-WRITE-TEMP-STORAGE                      19660000
196700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             19670000
196800                 GIVING PV-BLOCK-NUMBER                           19680000
196900                 REMAINDER PV-REMAINDER                           19690000
197000             IF  PV-REMAINDER > ZERO                              19700000
197100                 ADD +1 TO PV-BLOCK-NUMBER                        19710000
197200             END-IF                                               19720000
197300             MOVE +1    TO ASC-BLK-SUB                            19730000
197400             PERFORM 4410-READ-TEMP-STORAGE                       19740000
197500             ADD +1     TO ASC-BLK-SUB                            19750000
197600                           PV-BLOCK-NUMBER                        19760000
197700             PERFORM 4410-READ-TEMP-STORAGE                       19770000
197800     END-IF.                                                      19780000
197900     MOVE +1            TO ASC-BLK-SUB.                           19790000
198000     COMPUTE ASC-ITEM-SUB =                                       19800000
198100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              19810000
198200         + PC-ITEMS-PER-PANEL).                                   19820000
198300*                                                                 19830000
198400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19840000
198500         ADD +1         TO ASC-BLK-SUB                            19850000
198600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            19860000
198700     END-IF.                                                      19870000
198800*                                                                 19880000
198900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           19890000
199000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                19900000
199100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        19910000
199200     PERFORM 4420-FORMAT-LIST-LINES                               19920000
199300         VARYING PV-SUB                                           19930000
199400         FROM PC-ITEMS-PER-PANEL BY -1                            19940000
199500         UNTIL PV-SUB < +1.                                       19950000
199600*                                                                 19960000
199700     COMPUTE ASC-ITEMS-DISPLAYED =                                19970000
199800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19980000
199900     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    19990000
200000                                      ASTRTITO.                   20000000
200100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    20010000
200200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    20020000
200300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20030000
200400                                   TO ASELITO.                    20040000
200500*                                                                 20050000
200600     IF  DP020-MSG-NUMBER-X = SPACE                               20060000
200700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  20070000
200800*            --- MORE ITEMS TO DISPLAY ----                       20080000
200900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            20090000
201000             SET DP020-MSG-INFORMATIONAL TO TRUE                  20100000
201100         END-IF                                                   20110000
201200     END-IF.                                                      20120000
201300*----------------------------------------------------------------*20130000
201400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *20140000
201500*----------------------------------------------------------------*20150000
201600                                                                  20160000
201700 4410-READ-TEMP-STORAGE.                                          20170000
201800                                                                  20180000
201900     EXEC CICS                                                    20190000
202000         READQ TS                                                 20200000
202100             QUEUE (ASC-LIST-QUEUE-NAME)                          20210000
202200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20220000
202300             ITEM  (PV-BLOCK-NUMBER)                              20230000
202400             RESP  (PV-CICS-RESP)                                 20240000
202500     END-EXEC.                                                    20250000
202600                                                                  20260000
202700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       20270000
202800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     20280000
202900         CONTINUE                                                 20290000
203000     ELSE                                                         20300000
203100         SET DP013-CICS-ABEND     TO TRUE                         20310000
203200         SET DP013-NO-ROLLBACK    TO TRUE                         20320000
203300         MOVE '4410-READ-TEMP-STORAGE'                            20330000
203400                                  TO DP013-PARAGRAPH              20340000
203500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20350000
203600                                  TO DP013-MESSAGE-TEXT(1)        20360000
203700         PERFORM DP013-0000-PROCESS-ABEND                         20370000
203800     END-IF.                                                      20380000
203900                                                                  20390000
204000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20400000
204100*                                                                 20410000
204200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20420000
204300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               20430000
204400     END-IF.                                                      20440000
204500 EJECT                                                            20450000
204600*----------------------------------------------------------------*20460000
204700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *20470000
204800*----------------------------------------------------------------*20480000
204900                                                                  20490000
205000 4420-FORMAT-LIST-LINES.                                          20500000
205100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      20510000
205200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20520000
205300         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           20530000
205400         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           20540000
205500         MOVE SPACE              TO MR-SELECTI (PV-SUB)           20550000
205600                                    MR-ACTION (PV-SUB)            20560000
205700                                    MR-DEPT-NBR-X (PV-SUB)        20570000
205800                                    MR-DEPT-NAME (PV-SUB)         20580000
205900                                    MR-BULK-RANKING (PV-SUB)      20590000
206000                                    MR-PREPACK-RANKING (PV-SUB)   20600000
206100                                    MR-PBS-RANKING (PV-SUB)       20610000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   20610100
206100                                    MR-RFID-RANKING (PV-SUB)      20611000
      *CLP 10/01/13 END   - PR# 5148D                                   20611100
206200     ELSE                                                         20620000
206300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20630000
206400                                                   > SPACE        20640000
206500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 20650000
206600                                 TO MR-SELECTI (PV-SUB)           20660000
206700         ELSE                                                     20670000
206800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20680000
206900                                 TO MR-SELECTI (PV-SUB)           20690000
207000         END-IF                                                   20700000
207100*                                                                 20710000
207200         IF  DP030-SET-CURSOR-TRAILER                             20720000
207300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)20730000
207400                 > SPACE)                                         20740000
207500               OR (PV-SUB = 1))                                   20750000
207600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               20760000
207700                MOVE -1          TO MR-SELECTL (PV-SUB)           20770000
207800             END-IF                                               20780000
207900         END-IF                                                   20790000
208000*                                                                 20800000
208100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           20810000
208200             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           20820000
208300                                 TO MR-ACTION (PV-SUB)            20830000
208400             MOVE ASC-LINE-DEPT-NBR (ASC-BLK-SUB ASC-ITEM-SUB)    20840000
208500                                 TO MR-DEPT-NBR (PV-SUB)          20850000
208600             MOVE ASC-DEPT-NAME (ASC-BLK-SUB ASC-ITEM-SUB)        20860000
208700                                 TO MR-DEPT-NAME (PV-SUB)         20870000
208800             MOVE ASC-BULK-VND-RNKG-CDE (ASC-BLK-SUB ASC-ITEM-SUB)20880000
208900                                 TO MR-BULK-RANKING (PV-SUB)      20890000
209000             MOVE ASC-PREPACK-VND-RNKG-CDE                        20900000
209100                                        (ASC-BLK-SUB ASC-ITEM-SUB)20910000
209200                                 TO MR-PREPACK-RANKING (PV-SUB)   20920000
209300             MOVE ASC-PBS-VND-RNKG-CDE  (ASC-BLK-SUB ASC-ITEM-SUB)20930000
209400                                 TO MR-PBS-RANKING (PV-SUB)       20940000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   20940100
209300             MOVE ASC-RFID-VND-RNKG-CDE (ASC-BLK-SUB ASC-ITEM-SUB)20941000
209400                                 TO MR-RFID-RANKING (PV-SUB)      20942000
      *CLP 10/01/13 END   - PR# 5148D                                   20942100
209500         END-IF                                                   20950000
209600     END-IF.                                                      20960000
209700     SUBTRACT +1 FROM ASC-ITEM-SUB                                20970000
209800     IF  ASC-ITEM-SUB < + 1                                       20980000
209900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  20990000
210000         MOVE +1                 TO ASC-BLK-SUB                   21000000
210100     END-IF.                                                      21010000
210200******************************************************************21020000
210300** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **21030000
210400** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **21040000
210500** ISSUE A WARNING.                                             **21050000
210600******************************************************************21060000
210700 4430-CHECK-FOR-BEGIN-AND-END.                                    21070000
210800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       21080000
210900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     21090000
211000*            -- NO END-OF-RANGE SPECFIED ---                      21100000
211100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            21110000
211200             SET DP020-MSG-WARNING TO TRUE                        21120000
211300             PERFORM 4431-POSITION-AT-WARNING                     21130000
211400         END-IF                                                   21140000
211500     ELSE                                                         21150000
211600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     21160000
211700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                21170000
211800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            21180000
211900             SET DP020-MSG-WARNING TO TRUE                        21190000
212000             PERFORM 4431-POSITION-AT-WARNING                     21200000
212100         END-IF                                                   21210000
212200     END-IF.                                                      21220000
212300******************************************************************21230000
212400** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **21240000
212500** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **21250000
212600** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **21260000
212700** POSITION THE CURSOR THERE.                                   **21270000
212800******************************************************************21280000
212900 4431-POSITION-AT-WARNING.                                        21290000
213000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 21300000
213100                    - PV-TOP-ITEM + 1.                            21310000
213200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21320000
213300         CONTINUE                                                 21330000
213400     ELSE                                                         21340000
213500         SET DP030-SET-CURSOR-APPL-1                              21350000
213600                                   TO TRUE                        21360000
213700         MOVE -1                   TO MR-SELECTL (PV-SUB)         21370000
213800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21380000
213900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21390000
214000     END-IF.                                                      21400000
214100*                                                                 21410000
214200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21420000
214300                    - PV-TOP-ITEM + 1.                            21430000
214400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21440000
214500         CONTINUE                                                 21450000
214600     ELSE                                                         21460000
214700         SET DP030-SET-CURSOR-APPL-1                              21470000
214800                                   TO TRUE                        21480000
214900         MOVE -1                   TO MR-SELECTL (PV-SUB)         21490000
215000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21500000
215100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21510000
215200     END-IF.                                                      21520000
215300 4500-PROCESS-RANKINGS-CURSOR.                                    21530000
215400     MOVE 'DEFALT'  TO PV-BULK-VND-RNKG-CDE                       21540000
215500                       PV-PREPACK-VND-RNKG-CDE                    21550000
215600                       PV-PBS-VND-RNKG-CDE                        21560000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   21560100
215600                       PV-RFID-VND-RNKG-CDE.                      21561000
      *CLP 10/01/13 END   - PR# 5148D                                   21561100
215700      SET PS-NOT-END-OF-RANKINGS TO TRUE.                         21570000
215800      PERFORM 4510-OPEN-RANKINGS-CSR.                             21580000
215900      PERFORM 4530-FETCH-RANKINGS-CSR                             21590000
216000          UNTIL PS-END-OF-RANKINGS.                               21600000
216100      PERFORM 4550-CLOSE-RANKINGS-CSR.                            21610000
216200                                                                  21620000
216300 4510-OPEN-RANKINGS-CSR.                                          21630000
216400     PERFORM                                                      21640000
216500         WITH TEST AFTER                                          21650000
216600         VARYING PV-RETRY-COUNTER                                 21660000
216700         FROM 1 BY 1                                              21670000
216800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21680000
216900                   OR (SQLCODE = ZERO))                           21690000
217000                 MOVE 'CURSOR:  ALL-DEPT-CSR'                     21700000
217100                                   TO DP013-MESSAGE-TEXT (2)      21710000
217200             EXEC SQL                                             21720000
217300                  OPEN RANKINGS-CSR                               21730000
217400             END-EXEC                                             21740000
217500                                                                  21750000
217600                                                                  21760000
217700         EVALUATE TRUE                                            21770000
217800             WHEN SQLCODE = ZERO                                  21780000
217900             WHEN SQLCODE = -904                                  21790000
218000             WHEN SQLCODE = -913                                  21800000
218100                 CONTINUE                                         21810000
218200             WHEN SQLWARN0 NOT = SPACES                           21820000
218300             WHEN SQLCODE < ZERO                                  21830000
218400             WHEN SQLCODE > ZERO                                  21840000
218500                 MOVE '4510-OPEN-RANKINGS-CSR'                    21850000
218600                                   TO DP013-PARAGRAPH             21860000
218700                 MOVE 'OPEN THE RANKINGS CURSOR - '               21870000
218800                                   TO DP013-MESSAGE-TEXT (1)      21880000
218900                 MOVE SQLCA        TO DP013-SQLCA                 21890000
219000                 MOVE 'SUT00017'   TO DP013-DB2-TABLE-NAME (1)    21900000
219100                 SET DP013-DB2-ABEND                              21910000
219200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21920000
219300                 PERFORM DP013-0000-PROCESS-ABEND                 21930000
219400         END-EVALUATE                                             21940000
219500     END-PERFORM.                                                 21950000
219600*                                                                 21960000
219700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21970000
219800         MOVE '4510-OPEN-RANKINGS-CSR'                            21980000
219900                                   TO DP013-PARAGRAPH             21990000
220000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   22000000
220100                                   TO DP013-MESSAGE-TEXT (1)      22010000
220200         MOVE SQLCA                TO DP013-SQLCA                 22020000
220300         MOVE 'SUT00017'           TO DP013-DB2-TABLE-NAME (1)    22030000
220400         SET DP013-DB2-ABEND                                      22040000
220500             DP013-XCTL-DISPLAY-RESTART                           22050000
220600                                   TO TRUE                        22060000
220700         PERFORM DP013-0000-PROCESS-ABEND                         22070000
220800     END-IF.                                                      22080000
220900                                                                  22090000
221000 EJECT                                                            22100000
221100 4530-FETCH-RANKINGS-CSR.                                         22110000
221200                                                                  22120000
221300     EXEC SQL                                                     22130000
221400          FETCH RANKINGS-CSR                                      22140000
221500          INTO  :SUT00017-VND-RNKG-CDE                            22150000
221600             ,  :SUT00017-PKGNG-TYP-CDE                           22160000
221700     END-EXEC.                                                    22170000
221800                                                                  22180000
221900     EVALUATE TRUE                                                22190000
222000         WHEN SQLCODE = ZERO                                      22200000
222100             IF SUT00017-PKGNG-TYP-CDE = 'BC'                     22210000
222200                 MOVE SUT00017-VND-RNKG-CDE                       22220000
222300                              TO PV-BULK-VND-RNKG-CDE             22230000
222400             ELSE                                                 22240000
222500                 IF SUT00017-PKGNG-TYP-CDE = 'PP'                 22250000
222600                     MOVE SUT00017-VND-RNKG-CDE                   22260000
222700                                  TO PV-PREPACK-VND-RNKG-CDE      22270000
222800                 ELSE                                             22280000
222900                     IF SUT00017-PKGNG-TYP-CDE = 'PS'             22290000
223000                         MOVE SUT00017-VND-RNKG-CDE               22300000
223100                                      TO PV-PBS-VND-RNKG-CDE      22310000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   22310100
223200                     ELSE                                         22320000
222900                         IF SUT00017-PKGNG-TYP-CDE = 'RF'         22321100
223000                             MOVE SUT00017-VND-RNKG-CDE           22321200
223100                                          TO PV-RFID-VND-RNKG-CDE 22321300
223200                         END-IF                                   22321400
                           END-IF                                       22321500
      *CLP 10/01/13 END   - PR# 5148D                                   22321600
223300                 END-IF                                           22330000
223400             END-IF                                               22340000
223500         WHEN SQLCODE = +100                                      22350000
223600             SET PS-END-OF-RANKINGS TO TRUE                       22360000
223700         WHEN SQLWARN0 NOT = SPACE                                22370000
223800         WHEN SQLCODE NOT = ZERO                                  22380000
223900              MOVE '4530-FETCH-RANKINGS-CSR'                      22390000
224000                               TO DP013-PARAGRAPH                 22400000
224100              MOVE 'FETCH RANKINGS CURSOR'                        22410000
224200                               TO DP013-MESSAGE-TEXT (1)          22420000
224300              MOVE SQLCA       TO DP013-SQLCA                     22430000
224400              SET DP013-DB2-ABEND                                 22440000
224500                               TO TRUE                            22450000
224600              PERFORM DP013-0000-PROCESS-ABEND                    22460000
224700     END-EVALUATE.                                                22470000
224800                                                                  22480000
224900                                                                  22490000
225000*----------------------------------------------------------------*22500000
225100* CLOSE THE RANKINGS CURSOR                                      *22510000
225200*----------------------------------------------------------------*22520000
225300                                                                  22530000
225400 4550-CLOSE-RANKINGS-CSR.                                         22540000
225500     EXEC SQL                                                     22550000
225600         CLOSE RANKINGS-CSR                                       22560000
225700     END-EXEC.                                                    22570000
225800                                                                  22580000
225900*                                                                 22590000
226000     EVALUATE TRUE                                                22600000
226100         WHEN SQLCODE = ZERO                                      22610000
226200             CONTINUE                                             22620000
226300         WHEN SQLWARN0 NOT = SPACES                               22630000
226400         WHEN SQLCODE < ZERO                                      22640000
226500         WHEN SQLCODE > ZERO                                      22650000
226600             MOVE '4550-CLOSE-RANKINGS-CSR'                       22660000
226700                               TO DP013-PARAGRAPH                 22670000
226800             MOVE 'CLOSE THE RANKINGS CURSOR '                    22680000
226900                               TO DP013-MESSAGE-TEXT (1)          22690000
227000             MOVE SQLCA        TO DP013-SQLCA                     22700000
227100             MOVE 'SUT00017'   TO DP013-DB2-TABLE-NAME (1)        22710000
227200             SET DP013-DB2-ABEND                                  22720000
227300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22730000
227400             PERFORM DP013-0000-PROCESS-ABEND                     22740000
227500     END-EVALUATE.                                                22750000
227600                                                                  22760000
227700 EJECT                                                            22770000
227800*----------------------------------------------------------------*22780000
227900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *22790000
228000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *22800000
228100* FOR THE SELECTED ITEMS QUEUE.                                  *22810000
228200*                                                                *22820000
228300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *22830000
228400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *22840000
228500* THE ARRAY IS FULL.                                             *22850000
228600*----------------------------------------------------------------*22860000
228700                                                                  22870000
228800 5000-PREPARE-SEL-QUEUE.                                          22880000
228900                                                                  22890000
229000     MOVE +1                   TO  ASC-BLK-SUB.                   22900000
229100     PERFORM 5100-WRITE-TEMP-STORAGE.                             22910000
229200     ADD +1                    TO  ASC-BLK-SUB.                   22920000
229300     PERFORM 5100-WRITE-TEMP-STORAGE.                             22930000
229400                                                                  22940000
229500     MOVE ASC-SEL-QUEUE-NAME   TO  SU018-SEL-QUEUE-NAME.          22950000
229600     PERFORM 6010-DELETE-SEL-QUEUE.                               22960000
229700                                                                  22970000
229800     SET ASC-UPDATE-TSQ        TO  TRUE.                          22980000
229900                                                                  22990000
230000     SET SU019-IDX             TO  1.                             23000000
230100     MOVE ZERO                 TO SU018-NUMBER-OF-TS-ITEMS.       23010000
230200     INITIALIZE SU019-SELECTED-ITEM-ARRAY.                        23020000
230300                                                                  23030000
230400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           23040000
230500             VARYING PV-ITEM                                      23050000
230600             FROM 1 BY 1                                          23060000
230700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     23070000
230800                                                                  23080000
230900     IF  SU019-IDX > 1                                            23090000
231000         PERFORM 5205-WRITE-SEL-QUEUE                             23100000
231100         ADD +1                TO SU018-NUMBER-OF-TS-ITEMS        23110000
231200     END-IF.                                                      23120000
231300 EJECT                                                            23130000
231400*----------------------------------------------------------------*23140000
231500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *23150000
231600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *23160000
231700*----------------------------------------------------------------*23170000
231800                                                                  23180000
231900 5100-WRITE-TEMP-STORAGE.                                         23190000
232000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23200000
232100                                   TO PV-LIST-ITEM-NUMBER.        23210000
232200     COMPUTE PV-BLOCK-NUMBER =                                    23220000
232300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    23230000
232400                                                                  23240000
232500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             23250000
232600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             23260000
232700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      23270000
232800             PERFORM 5105-REWRITE-ASC-LISTQ                       23280000
232900         END-IF                                                   23290000
233000     ELSE                                                         23300000
233100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23310000
233200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            23320000
233300         PERFORM 5110-WRITE-ASC-LISTQ                             23330000
233400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   23340000
233500     END-IF.                                                      23350000
233600                                                                  23360000
233700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23370000
233800******************************************************************23380000
233900** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **23390000
234000** SPECIFIC COMMAREA.                                           **23400000
234100******************************************************************23410000
234200 5105-REWRITE-ASC-LISTQ.                                          23420000
234300     EXEC CICS                                                    23430000
234400         WRITEQ TS                                                23440000
234500             QUEUE (ASC-LIST-QUEUE-NAME)                          23450000
234600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23460000
234700             ITEM  (PV-BLOCK-NUMBER)                              23470000
234800             REWRITE                                              23480000
234900             RESP  (PV-CICS-RESP)                                 23490000
235000     END-EXEC.                                                    23500000
235100                                                                  23510000
235200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           23520000
235300         CONTINUE                                                 23530000
235400     ELSE                                                         23540000
235500         SET DP013-CICS-ABEND            TO TRUE                  23550000
235600         SET DP013-NO-ROLLBACK           TO TRUE                  23560000
235700         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       23570000
235800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     23580000
235900                                         TO DP013-MESSAGE-TEXT(1) 23590000
236000         PERFORM DP013-0000-PROCESS-ABEND                         23600000
236100     END-IF.                                                      23610000
236200                                                                  23620000
236300******************************************************************23630000
236400** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **23640000
236500** SPECIFIC COMMAREA.                                           **23650000
236600******************************************************************23660000
236700 5110-WRITE-ASC-LISTQ.                                            23670000
236800     EXEC CICS                                                    23680000
236900         WRITEQ TS                                                23690000
237000             QUEUE (ASC-LIST-QUEUE-NAME)                          23700000
237100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23710000
237200             ITEM  (PV-BLOCK-NUMBER)                              23720000
237300             RESP  (PV-CICS-RESP)                                 23730000
237400     END-EXEC.                                                    23740000
237500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      23750000
237600         SET DP013-CICS-ABEND      TO TRUE                        23760000
237700         SET DP013-NO-ROLLBACK     TO TRUE                        23770000
237800         MOVE '5110-WRITE-ASC-LISTQ'                              23780000
237900                                   TO DP013-PARAGRAPH             23790000
238000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           23800000
238100                                   TO DP013-MESSAGE-TEXT(1)       23810000
238200         PERFORM DP013-0000-PROCESS-ABEND                         23820000
238300     END-IF.                                                      23830000
238400 EJECT                                                            23840000
238500*----------------------------------------------------------------*23850000
238600* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *23860000
238700* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *23870000
238800*----------------------------------------------------------------*23880000
238900                                                                  23890000
239000 5120-REWRITE-LIST-QUEUE.                                         23900000
239100     EXEC CICS                                                    23910000
239200          WRITEQ TS                                               23920000
239300              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     23930000
239400              FROM    (SU019-SELECT-RECORD)                       23940000
239500              ITEM    (ASC-SEL-ITEM)                              23950000
239600              RESP    (PV-CICS-RESP)                              23960000
239700              REWRITE                                             23970000
239800     END-EXEC.                                                    23980000
239900                                                                  23990000
240000     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    24000000
240100         SET DP013-CICS-ABEND                                     24010000
240200             DP013-NO-ROLLBACK     TO TRUE                        24020000
240300         MOVE '5120-REWRITE-LIST-QUEUE'                           24030000
240400                                   TO DP013-PARAGRAPH             24040000
240500         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   24050000
240600                                   TO DP013-MESSAGE-TEXT (1)      24060000
240700         PERFORM DP013-0000-PROCESS-ABEND                         24070000
240800     END-IF.                                                      24080000
240900                                                                  24090000
241000                                                                  24100000
241100 5200-FILL-SEL-QUEUE-RECORD.                                      24110000
241200                                                                  24120000
241300     PERFORM 6112-READ-LIST-QUEUE.                                24130000
241400                                                                  24140000
241500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       24150000
241600         PERFORM                                                  24160000
241700         VARYING LQW-IDX                                          24170000
241800         FROM 1 BY 1                                              24180000
241900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            24190000
242000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          24200000
242100                                                                  24210000
242200             IF  LQW-SELECT (LQW-IDX)                             24220000
242220                 MOVE ASC-ENT-ID-N TO SU019-ENT-ID (SU019-IDX)    24222000
242230                 MOVE ASC-VENDOR-DESC                             24223000
242240                             TO SU019-VENDOR-DESC (SU019-IDX)     24224000
242300                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              24230000
242400                                   TO SU019-ITEM (SU019-IDX)      24240000
242500                 MOVE LQW-DEPT-NBR (LQW-IDX)                      24250000
242600                                   TO SU019-DEPT-NBR              24260000
242700                                        (SU019-IDX)               24270000
242800                 MOVE LQW-DEPT-NAME (LQW-IDX)                     24280000
242900                                   TO SU019-DEPT-DESC             24290000
243000                                        (SU019-IDX)               24300000
243100                 MOVE SPACE        TO SU019-ACTION-SW (SU019-IDX) 24310000
243200                 SET SU019-IDX UP BY 1                            24320000
243300                 IF  SU019-IDX > SU019-MAX-ITEMS                  24330000
243400                     PERFORM 5205-WRITE-SEL-QUEUE                 24340000
243500                     ADD +1        TO SU018-NUMBER-OF-TS-ITEMS    24350000
243600                     INITIALIZE SU019-SELECTED-ITEM-ARRAY         24360000
243700                     SET SU019-IDX TO  1                          24370000
243800                 END-IF                                           24380000
243900             END-IF                                               24390000
244000         END-PERFORM                                              24400000
244100     END-IF.                                                      24410000
244200                                                                  24420000
244300*----------------------------------------------------------------*24430000
244400*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *24440000
244500*----------------------------------------------------------------*24450000
244600                                                                  24460000
244700 5205-WRITE-SEL-QUEUE.                                            24470000
244800                                                                  24480000
244900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            24490000
245000                                   TO SU019-SELECTED-ITEMS.       24500000
245100                                                                  24510000
245200     EXEC CICS                                                    24520000
245300          WRITEQ TS                                               24530000
245400              QUEUE (ASC-SEL-QUEUE-NAME)                          24540000
245500              FROM  (SU019-SELECT-RECORD)                         24550000
245600              ITEM  (PV-SEL-QUEUE-ITEM)                           24560000
245700              RESP  (PV-CICS-RESP)                                24570000
245800     END-EXEC.                                                    24580000
245900                                                                  24590000
246000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24600000
246100         CONTINUE                                                 24610000
246200     ELSE                                                         24620000
246300         SET DP013-CICS-ABEND      TO TRUE                        24630000
246400         SET DP013-NO-ROLLBACK     TO TRUE                        24640000
246500         MOVE '5205-WRITE-SEL-QUEUE'                              24650000
246600                                   TO DP013-PARAGRAPH             24660000
246700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          24670000
246800                                   TO DP013-MESSAGE-TEXT(1)       24680000
246900         PERFORM DP013-0000-PROCESS-ABEND                         24690000
247000     END-IF.                                                      24700000
247100 EJECT                                                            24710000
247200******************************************************************24720000
247300** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **24730000
247400** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **24740000
247500** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **24750000
247600** THE USER.                                                    **24760000
247700******************************************************************24770000
247800 6000-REFRESH-PANEL-FROM-TEMP.                                    24780000
247900     IF  ASC-UPDATE-TSQ                                           24790000
248000         SET ASC-NO-TSQ-UPDATE TO TRUE                            24800000
248100         MOVE ZERO                 TO PV-SAVE-ITEM                24810000
248200                                      PV-SEL-QUEUE-ITEM           24820000
248300         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        24830000
248400                                   TO PV-HOLD-SELECTED-ITEMS      24840000
248500         MOVE +1                   TO PV-ITEMS-PROCESSED          24850000
248600         PERFORM 6100-UPDATE-TSQ                                  24860000
248700             UNTIL PV-ITEMS-PROCESSED >                           24870000
248800                                     PV-HOLD-SELECTED-ITEMS       24880000
248900         PERFORM 6010-DELETE-SEL-QUEUE                            24890000
249000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         24900000
249100                    ASC-BLOCK-ENTRIES (2)                         24910000
249200     END-IF.                                                      24920000
249300                                                                  24930000
249400*----------------------------------------------------------------*24940000
249500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *24950000
249600*----------------------------------------------------------------*24960000
249700 6010-DELETE-SEL-QUEUE.                                           24970000
249800                                                                  24980000
249900     EXEC CICS                                                    24990000
250000         DELETEQ TS                                               25000000
250100             QUEUE (ASC-SEL-QUEUE-NAME)                           25010000
250200             RESP  (PV-CICS-RESP)                                 25020000
250300     END-EXEC.                                                    25030000
250400*                                                                 25040000
250500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      25050000
250600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         25060000
250700         CONTINUE                                                 25070000
250800     ELSE                                                         25080000
250900         SET DP013-CICS-ABEND TO TRUE                             25090000
251000         SET DP013-NO-ROLLBACK TO TRUE                            25100000
251100         MOVE '6010-DELETE-SEL-QUEUE'                             25110000
251200                        TO DP013-PARAGRAPH                        25120000
251300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         25130000
251400                        TO DP013-MESSAGE-TEXT (1)                 25140000
251500         PERFORM DP013-0000-PROCESS-ABEND                         25150000
251600     END-IF.                                                      25160000
251700                                                                  25170000
251800*----------------------------------------------------------------*25180000
251900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *25190000
252000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *25200000
252100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *25210000
252200*    THE TEMP QUEUE.                                             *25220000
252300*----------------------------------------------------------------*25230000
252400                                                                  25240000
252500 6100-UPDATE-TSQ.                                                 25250000
252600                                                                  25260000
252700     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             25270000
252800     PERFORM 6105-READ-SEL-QUEUE.                                 25280000
252900     PERFORM                                                      25290000
253000         VARYING SU019-IDX                                        25300000
253100         FROM 1 BY 1                                              25310000
253200         UNTIL ((PV-ITEMS-PROCESSED >                             25320000
253300                              PV-HOLD-SELECTED-ITEMS)             25330000
253400         OR (SU019-IDX GREATER THAN SU019-MAX-ITEMS))             25340000
253500         IF  SU019-ACTION-SW (SU019-IDX) > SPACE                  25350000
253600             PERFORM 6110-PROCESS-ITEMS                           25360000
253700         END-IF                                                   25370000
253800         ADD +1                TO PV-ITEMS-PROCESSED              25380000
253900     END-PERFORM.                                                 25390000
254000     PERFORM 6111-WRITE-LIST-QUEUE.                               25400000
254100*----------------------------------------------------------------*25410000
254200*    READ THE LIST QUEUE RECORD.                                 *25420000
254300*----------------------------------------------------------------*25430000
254400                                                                  25440000
254500 6105-READ-SEL-QUEUE.                                             25450000
254600                                                                  25460000
254700     EXEC CICS                                                    25470000
254800          READQ TS                                                25480000
254900              QUEUE (ASC-SEL-QUEUE-NAME)                          25490000
255000              INTO  (SU019-SELECT-RECORD)                         25500000
255100              ITEM  (PV-SEL-QUEUE-ITEM)                           25510000
255200              RESP  (PV-CICS-RESP)                                25520000
255300     END-EXEC.                                                    25530000
255400*                                                                 25540000
255500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25550000
255600         CONTINUE                                                 25560000
255700     ELSE                                                         25570000
255800         SET DP013-CICS-ABEND      TO  TRUE                       25580000
255900         SET DP013-NO-ROLLBACK     TO  TRUE                       25590000
256000         MOVE '6105-READ-SEL-QUEUE'                               25600000
256100                                   TO  DP013-PARAGRAPH            25610000
256200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           25620000
256300                                   TO  DP013-MESSAGE-TEXT(1)      25630000
256400         PERFORM DP013-0000-PROCESS-ABEND                         25640000
256500     END-IF.                                                      25650000
256600 EJECT                                                            25660000
256700*----------------------------------------------------------------*25670000
256800*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*25680000
256900*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*25690000
257000*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *25700000
257100*----------------------------------------------------------------*25710000
257200                                                                  25720000
257300 6110-PROCESS-ITEMS.                                              25730000
257400                                                                  25740000
257500     COMPUTE PV-ITEM = 1 + ((SU019-ITEM (SU019-IDX) - 1)          25750000
257600                     / PC-ITEMS-PER-PANEL).                       25760000
257700                                                                  25770000
257800     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           25780000
257900         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          25790000
258000             PERFORM 6111-WRITE-LIST-QUEUE                        25800000
258100         END-IF                                                   25810000
258200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    25820000
258300                                                                  25830000
258400         PERFORM 6112-READ-LIST-QUEUE                             25840000
258500         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               25850000
258600             CONTINUE                                             25860000
258700         END-IF                                                   25870000
258800     END-IF.                                                      25880000
258900                                                                  25890000
259000     COMPUTE PV-SUB = (SU019-ITEM (SU019-IDX)                     25900000
259100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              25910000
259200     SET LQW-DESELECT (PV-SUB) TO    TRUE                         25920000
259300     MOVE LQW-SELECTED-SW (PV-SUB)                                25930000
259400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  25940000
259401     MOVE SU019-ENT-ID (1)       TO DK-ENT-ID.                    25940100
259402     MOVE LQW-DEPT-NBR (PV-SUB)  TO DK-DEPT-NBR.                  25940200
259410     PERFORM 4500-PROCESS-RANKINGS-CURSOR.                        25941000
259420     MOVE PV-BULK-VND-RNKG-CDE                                    25942000
259431                       TO LQW-BULK-RANKING (PV-SUB).              25943100
259450     MOVE PV-PREPACK-VND-RNKG-CDE                                 25945000
259460                       TO LQW-PREPACK-RANKING (PV-SUB).           25946000
259480     MOVE PV-PBS-VND-RNKG-CDE                                     25948000
259490                       TO LQW-PBS-RANKING (PV-SUB).               25949000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   25949100
259480     MOVE PV-RFID-VND-RNKG-CDE                                    25949300
259490                       TO LQW-RFID-RANKING (PV-SUB).              25949400
      *CLP 10/01/13 END   - PR# 5148D                                   25949500
259500     EVALUATE TRUE                                                25950000
259600         WHEN SU019-INQ (SU019-IDX)                               25960000
259700              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             25970000
259800                                                                  25980000
259900         WHEN SU019-UPD (SU019-IDX)                               25990000
260000              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             26000000
260100                                                                  26010000
260200         WHEN SU019-DEL (SU019-IDX)                               26020000
260300              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             26030000
260400                                                                  26040000
260500         WHEN SU019-ERR (SU019-IDX)                               26050000
260600              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             26060000
260700     END-EVALUATE.                                                26070000
260800                                                                  26080000
260900     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                26090000
261000                                                                  26100000
261100*----------------------------------------------------------------*26110000
261200*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *26120000
261300*----------------------------------------------------------------*26130000
261400                                                                  26140000
261500 6111-WRITE-LIST-QUEUE.                                           26150000
261600                                                                  26160000
261700     EXEC CICS                                                    26170000
261800         WRITEQ TS                                                26180000
261900             QUEUE (ASC-LIST-QUEUE-NAME)                          26190000
262000             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     26200000
262100             ITEM  (PV-SAVE-ITEM)                                 26210000
262200             REWRITE                                              26220000
262300             RESP  (PV-CICS-RESP)                                 26230000
262400     END-EXEC.                                                    26240000
262500*                                                                 26250000
262600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26260000
262700         CONTINUE                                                 26270000
262800     ELSE                                                         26280000
262900         SET DP013-CICS-ABEND  TO  TRUE                           26290000
263000         SET DP013-NO-ROLLBACK TO  TRUE                           26300000
263100         MOVE '6111-WRITE-LIST-QUEUE'                             26310000
263200                               TO  DP013-PARAGRAPH                26320000
263300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  26330000
263400                               TO  DP013-MESSAGE-TEXT(1)          26340000
263500         PERFORM DP013-0000-PROCESS-ABEND                         26350000
263600     END-IF.                                                      26360000
263700                                                                  26370000
263800 EJECT                                                            26380000
263900*----------------------------------------------------------------*26390000
264000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*26400000
264100*----------------------------------------------------------------*26410000
264200                                                                  26420000
264300 6112-READ-LIST-QUEUE.                                            26430000
264400                                                                  26440000
264500     EXEC CICS                                                    26450000
264600         READQ TS                                                 26460000
264700             QUEUE (ASC-LIST-QUEUE-NAME)                          26470000
264800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     26480000
264900             ITEM  (PV-ITEM)                                      26490000
265000             RESP  (PV-CICS-RESP)                                 26500000
265100     END-EXEC.                                                    26510000
265200*                                                                 26520000
265300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26530000
265400         CONTINUE                                                 26540000
265500     ELSE                                                         26550000
265600         SET DP013-CICS-ABEND        TO TRUE                      26560000
265700         SET DP013-NO-ROLLBACK       TO TRUE                      26570000
265800         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           26580000
265900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    26590000
266000                                     TO DP013-MESSAGE-TEXT(1)     26600000
266100         PERFORM DP013-0000-PROCESS-ABEND                         26610000
266200     END-IF.                                                      26620000
266300                                                                  26630000
266400*----------------------------------------------------------------*26640000
266500* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *26650000
266600*----------------------------------------------------------------*26660000
266700                                                                  26670000
266800 9100-READ-SEL-QUEUE.                                             26680000
266900     EXEC CICS                                                    26690000
267000         READQ TS                                                 26700000
267100             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        26710000
267200             INTO  (SU019-SELECT-RECORD)                          26720000
267300             ITEM  (ASC-SEL-ITEM)                                 26730000
267400             RESP  (PV-CICS-RESPONSE)                             26740000
267500     END-EXEC.                                                    26750000
267600                                                                  26760000
267700     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   26770000
267800         CONTINUE                                                 26780000
267900     ELSE                                                         26790000
268000         SET DP013-LOGIC-ABEND                                    26800000
268100             DP013-NO-ROLLBACK     TO TRUE                        26810000
268200         MOVE '9100-READ-SEL-QUEUE'                               26820000
268300                                   TO DP013-PARAGRAPH             26830000
268400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   26840000
268500                                   TO DP013-MESSAGE-TEXT (1)      26850000
268600         PERFORM DP013-0000-PROCESS-ABEND                         26860000
268700     END-IF.                                                      26870000
268800*----------------------------------------------------------------*26880000
268900* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *26890000
269000*----------------------------------------------------------------*26900000
269100 9200-REWRITE-LIST-QUEUE.                                         26910000
269200     EXEC CICS                                                    26920000
269300          WRITEQ TS                                               26930000
269400              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      26940000
269500              FROM   (SU019-SELECT-RECORD)                        26950000
269600              ITEM   (ASC-SEL-ITEM)                               26960000
269700              RESP   (PV-CICS-RESPONSE)                           26970000
269800              REWRITE                                             26980000
269900     END-EXEC.                                                    26990000
270000                                                                  27000000
270100     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               27010000
270200         SET DP013-CICS-ABEND                                     27020000
270300             DP013-NO-ROLLBACK     TO TRUE                        27030000
270400         MOVE '9200-REWRITE-LIST-QUEUE'                           27040000
270500                                   TO DP013-PARAGRAPH             27050000
270600         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   27060000
270700                                   TO DP013-MESSAGE-TEXT (1)      27070000
270800         PERFORM DP013-0000-PROCESS-ABEND                         27080000
270900     END-IF.                                                      27090000
271000                                                                  27100000
271100 EJECT                                                            27110000
271200*----------------------------------------------------------------*27120000
271300*    ABEND PROCESSOR MODULE                                      *27130000
271400*----------------------------------------------------------------*27140000
271500                                                                  27150000
271600     COPY DPPD013.                                                27160000
