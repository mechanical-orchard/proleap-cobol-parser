000100***************************************************************** 00010009
000200 IDENTIFICATION DIVISION.                                         00020009
000300***************************************************************** 00030009
000400 PROGRAM-ID.    RCKUT120.                                         00040009
000500 AUTHOR.        GERMAN BANDA.                                     00050009
000600 INSTALLATION.  KOHLS.                                            00060009
000700 DATE-WRITTEN   MARCH 2003.                                       00070009
000800 DATE-COMPILED.                                                   00080009
000900***************************************************************** 00090009
001000*  THIS BATCH DB2 PROGRAM READS A FILE CONTAINING ASN PACKSLIP  * 00100009
001100*  INFORMATION, VALIDATES THE EXPECTED                          * 00110009
001200*  ITEM QUANTITY, AND CREATES AN OUTPUT FILE WHEN ANY           * 00120009
001300*  DIFFERENCES ARE DISCOVERED. PACK BY STORE ORDERS ONLY.       * 00130009
001400***************************************************************** 00140009
001807* CHANGE HISTORY                                                *         
001300*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)              *         
001300*     DATE:    11/12/2014                                       *         
001300*      RECOMPILE THE PROGRAM AS THE PO NUMBER FIELD IN THE      *         
001300*      COPYBOOK RCRD052 AND RCRD053 IS INCREASED TO 9 FROM 7.   *         
001400*****************************************************************         
001500 ENVIRONMENT DIVISION.                                            00150009
001600 INPUT-OUTPUT SECTION.                                            00160009
001700                                                                  00170009
001800 FILE-CONTROL.                                                    00180009
001900                                                                  00190009
002000     SELECT INPUT-FILE     ASSIGN TO UT-S-INP01.                  00200009
002100     SELECT OUTPUT-FILE    ASSIGN TO UT-S-OUT01.                  00210009
002200                                                                  00220009
002300***************************************************************** 00230009
002400 DATA DIVISION.                                                   00240009
002500***************************************************************** 00250009
002600 FILE SECTION.                                                    00260009
002700                                                                  00270009
002800 FD  INPUT-FILE                                                   00280009
002900     RECORDING MODE IS F                                          00290009
003000     LABEL RECORDS ARE STANDARD                                   00300009
003100     RECORD CONTAINS 150                                          00310009
003200     BLOCK CONTAINS 0 RECORDS                                     00320009
003300     DATA RECORD IS INPUT-RECORD.                                 00330009
003400 01  INPUT-RECORD                PIC X(150).                      00340009
003500                                                                  00350009
003600 FD  OUTPUT-FILE                                                  00360009
003700     RECORDING MODE IS F                                          00370009
003800     LABEL RECORDS ARE STANDARD                                   00380009
003900     RECORD CONTAINS 300                                          00390009
004000     BLOCK CONTAINS 0 RECORDS                                     00400009
004100     DATA RECORD IS OUTPUT-RECORD.                                00410009
004200 01  OUTPUT-RECORD               PIC X(300).                      00420009
004300                                                                  00421009
004400                                                                  00422009
004500***************************************************************** 00423009
004600 WORKING-STORAGE SECTION.                                         00424009
004700                                                                  00425009
004800 01  PS-PROGRAM-SWITCHES.                                         00426009
004900     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00427009
005000         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00428009
005100         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00429009
005200     05  PS-TPURCHS-SW                PIC X(01)  VALUE 'N'.       00430009
005300         88  PS-TPURCHS-YES                      VALUE 'Y'.       00440009
005400         88  PS-TPURCHS-NO                       VALUE 'N'.       00450009
005500     05  PS-SHUUPC-CSR-SW             PIC X(01)  VALUE 'N'.       00460009
005600         88  PS-SHUUPC-CSR-EOF-YES               VALUE 'Y'.       00470009
005700         88  PS-SHUUPC-CSR-EOF-NO                VALUE 'N'.       00480009
005800     05  PS-PKITEM-CSR-SW             PIC X(01)  VALUE 'N'.       00490009
005900         88  PS-PKITEM-CSR-EOF-YES               VALUE 'Y'.       00500009
006000         88  PS-PKITEM-CSR-EOF-NO                VALUE 'N'.       00510009
006100     05  PS-ERROR-RECORD-SW           PIC X(01)  VALUE 'N'.       00520009
006200         88  PS-ERROR-RECORD-FOUND               VALUE 'Y'.       00530009
006300         88  PS-NO-ERROR-RECORD-FOUND            VALUE 'N'.       00540009
006400                                                                  00550009
006500 01  PC-PROGRAM-CONSTANTS.                                        00560009
006600     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'RCKUT120'.00570009
006700     05  PC-MAX-RETRIES               PIC S9(4)  VALUE +3         00580009
006800                                                 COMP SYNC.       00590009
006900     05  PC-DEFAULT-CC-DATE           PIC X(10)  VALUE            00600009
007000                                                     '9999-09-09'.00610009
007100     05  PC-SYSTEM-DATE               PIC 9(06)  VALUE ZERO.      00620009
007200                                                                  00630009
007300 01  PV-PROGRAM-VARIABLES.                                        00640009
007400     05  PV-RETRY-COUNT               PIC S9(4)  VALUE +0         00650009
007500                                                 COMP SYNC.       00660009
007600     05  PV-SUB                       PIC S9(3)  VALUE +0         00670009
007700                                                 COMP-3.          00680009
007800     05  PV-DISP-PO                   PIC 999999999.              00690009
007900     05  PV-DISP-SEQ                  PIC 9999.                   00700009
008000     05  PV-DISP-LINE1                PIC 99999.                  00710009
008100     05  PV-DISP-LINE2                PIC 99999.                  00720009
008200     05  PV-SQLCODE                   PIC S9(9)  VALUE +0.        00730009
008300     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00740009
008400     05  PV-DISP-COUNT                PIC Z,ZZZ,ZZ9.              00750009
008500     05  PV-DISP-STORE                PIC Z,ZZZ,ZZ9.              00760009
008600     05  PV-DISP-ERRS                 PIC ZZ,ZZ9.                 00770009
008700     05  PV-DISP-ITMS                 PIC ZZ,ZZ9.                 00780009
008800     05  PV-RECORDS-READ              PIC S9(9)  VALUE +0.        00790009
008900     05  PV-PBS-STORES-CHECKED        PIC S9(9)  VALUE +0.        00800009
009000     05  PV-RECORDS-WRITTEN           PIC S9(9)  VALUE +0.        00810009
009100     05  PV-VENDORS-WRITTEN           PIC S9(9)  VALUE +0.        00820009
009200     05  PV-CARTON-MISMATCH           PIC S9(9)  VALUE +0.        00830009
009300     05  PV-VALID-IND-CNT             PIC S9(9)  VALUE +0.        00840009
009400     05  PV-INPKSU-COUNT              PIC S9(9)  VALUE +0 COMP.   00850009
009500     05  PV-PO-NBR-HOLD               PIC S9(9)  COMP.            00860009
009600     05  PV-PO-NBR-HOLD-2             PIC S9(9)  COMP.            00870009
009700     05  PV-SEQ-NBR-HOLD              PIC S9(9)  COMP.            00880009
009800     05  PV-STORE-HOLD                PIC S9(9)  COMP.            00890009
009900     05  PV-PBS-PO-COUNT              PIC S9(9)  VALUE +0 COMP.   00900009
010000     05  PV-PBS-PO-ERR-COUNT          PIC S9(9)  VALUE +0 COMP.   00910009
010100     05  PV-SHUUPC-FETCH-COUNT        PIC S9(9)  VALUE +0.        00920009
010200     05  PV-UPC-RECYCLE-COUNT         PIC  9(4)  VALUE ZEROES.    00930009
010300     05  PV-CURRENT-DATE              PIC X(10)  VALUE SPACES.    00931009
010400                                                                  00932009
010500 01  DK-DATABASE-KEYS.                                            00933009
010600     05  DK-PO-NBR                    PIC S9(9)  VALUE +0 COMP.   00934009
010700     05  DK-PO-NBR-2                  PIC S9(9)  VALUE +0 COMP.   00935009
010800     05  DK-ENT-ID                    PIC S9(9)  VALUE +0 COMP.   00936009
010900     05  DK-SEQ-NBR                   PIC S9(4)  VALUE +0 COMP.   00937009
011000     05  DK-SEQ-NBR-2                 PIC S9(4)  VALUE +0 COMP.   00938009
011100     05  DK-ASN-NBR                   PIC X(30)  VALUE SPACES.    00939009
011200     05  DK-BOL-NBR                   PIC X(30)  VALUE SPACES.    00940009
011300     05  DK-EDI-VEND-ID               PIC X(17)  VALUE SPACES.    00950009
011400                                                                  00960009
011500 01  PV-ABEND-FIELDS.                                             00970009
011600     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         00980009
011700                                                 COMP SYNC.       00990009
011800     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'RCKUT120'.01000009
011900     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01010009
012000     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01020009
012100     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01030009
012200     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    01040009
012300     05  PV-ABEND-STRUCTURE-3         PIC  X(08) VALUE SPACES.    01050009
012400     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01060009
012500     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01070009
012600     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01080009
012700     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01090009
012800     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    01100009
012900                                                                  01110009
013000                                                                  01120009
013100***********************************************************       01130009
013200*  COPYBOOK USED FOR THE INPUT FILE.                      *       01140009
013300***********************************************************       01150009
013400     COPY RCRD052.                                                01160009
013500                                                                  01170009
013600***********************************************************       01180009
013700*  COPYBOOK USED FOR THE OUTPUT FILE.                     *       01190009
013800***********************************************************       01200009
013900     COPY RCRD053.                                                01210009
014000/                                                                 01220010
014100*  LOGISTICS DOMAIN LOCATION MODULE                               01221010
014200*                                                                 01222010
014300     COPY XLWS071.                                                01223010
014400/                                                                 01224010
014500***********************************************************       01230009
014600*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       01240009
014700***********************************************************       01250009
014800     COPY DPWS004.                                                01260009
014900                                                                  01270009
015000***********************************************************       01280009
015100*  DB2 SQL COMMUNICATION AREA                             *       01290009
015200***********************************************************       01300009
015300     EXEC SQL                                                     01310009
015400          INCLUDE SQLCA                                           01320009
015500     END-EXEC.                                                    01330009
015600                                                                  01340009
015700***********************************************************       01350009
015800*  DB2 DCLGEN FOR RC - PACK SLIP                          *       01360009
015900***********************************************************       01370009
016000     EXEC SQL                                                     01380009
016100          INCLUDE TPKSLIP                                         01390009
016200     END-EXEC.                                                    01400009
016300                                                                  01410009
016400***********************************************************       01420009
016500*  DB2 DCLGEN FOR RC - PACK SLIP ITEM                     *       01430009
016600***********************************************************       01440009
016700     EXEC SQL                                                     01450009
016800          INCLUDE TPKITEM                                         01460009
016900     END-EXEC.                                                    01470009
017000                                                                  01480009
017100***********************************************************       01490009
017200*  DB2 DCLGEN FOR PO - PURCHASE TABLE                     *       01500009
017300***********************************************************       01510009
017400     EXEC SQL                                                     01520009
017500          INCLUDE TPURCHS                                         01530009
017600     END-EXEC.                                                    01540009
017700                                                                  01550009
017800***********************************************************       01560009
017900*  DB2 DCLGEN FOR SU - INBOUND EDI PACKLIST/VENDOR        *       01570009
018000*                      SHIPMENT UNIT ASSOCIATION          *       01580009
018100***********************************************************       01590009
018200     EXEC SQL                                                     01600009
018300          INCLUDE TINPKSU                                         01610009
018400     END-EXEC.                                                    01620009
018500                                                                  01630009
018600***********************************************************       01640009
018700*  DB2 DCLGEN FOR SU - SHIPMENT UNIT/UPC ASSOCIATION      *       01650009
018800***********************************************************       01660009
018900     EXEC SQL                                                     01670009
019000          INCLUDE TSHUUPC                                         01680009
019100     END-EXEC.                                                    01690009
019200                                                                  01700009
019300***********************************************************       01710009
019400*  DB2 DCLGEN FOR EX - EXTERNAL ENTERPRISE                *       01720009
019500***********************************************************       01730009
019600     EXEC SQL                                                     01740009
019700          INCLUDE TEXTENT                                         01750009
019800     END-EXEC.                                                    01760009
019900                                                                  01770009
020000***********************************************************       01780009
020100*  DB2 DCLGEN FOR SN - ADVANCE SHIP NOTICE HEADER         *       01790009
020200***********************************************************       01800009
020300     EXEC SQL                                                     01810009
020400          INCLUDE TASNHDR                                         01820009
020500     END-EXEC.                                                    01830009
020600                                                                  01840009
020700******************************************************************01920009
020800* SHUUPC CURSOR                                                  *01930009
020900******************************************************************01940009
021000     EXEC SQL                                                     01950009
021100       DECLARE SHUUPC-CSR CURSOR FOR                              01960009
021200         SELECT B.TRN_NBR                                         01970009
021300              , B.TRN_LNE_NBR                                     01980009
021400              , SUM(B.SHPD_QTY)                                   01990009
021500           FROM TINPKSU A                                         02000009
021600              , TSHUUPC B                                         02010009
021700          WHERE A.PO_NBR        = :DK-PO-NBR                      02020009
021800            AND A.SEQ_NBR       = :DK-SEQ-NBR                     02030009
021900            AND A.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                  02040009
022000            AND B.TRN_TYP_CDE   = 'PO'                            02050009
022100       GROUP BY B.TRN_NBR                                         02060009
022200              , B.TRN_LNE_NBR                                     02070009
022300       HAVING SUM(B.SHPD_QTY)  > 0                                02080009
022400       ORDER BY B.TRN_LNE_NBR                                     02090009
022500     END-EXEC.                                                    02100009
022600                                                                  02110009
022700******************************************************************02120009
022800* PKITEM CURSOR                                                  *02130009
022900******************************************************************02131009
023000     EXEC SQL                                                     02132009
023100       DECLARE PKITEM-CSR CURSOR FOR                              02133009
023200         SELECT A.PKSL_LNE_NBR                                    02134009
023300              , A.PKSL_ITM_QTY                                    02135009
023400           FROM TPKITEM A                                         02136009
023500          WHERE A.PO_NBR        = :DK-PO-NBR                      02137009
023600            AND A.SEQ_NBR       = :DK-SEQ-NBR                     02138009
023700            AND A.VER_STAT_CDE  = 'A'                             02139009
023800            AND A.PKSL_ITM_QTY  >  0                              02140009
023900       ORDER BY A.PKSL_LNE_NBR                                    02150009
024000     END-EXEC.                                                    02160009
024100                                                                  02170009
024200***************************************************************** 02180009
024300 PROCEDURE DIVISION.                                              02190009
024400***************************************************************** 02200009
024500     DISPLAY '**** BEGINNING RCKUT120 ****'.                      02210009
024600     DISPLAY ' '.                                                 02220009
024700                                                                  02230009
024800     OPEN INPUT  INPUT-FILE                                       02240009
024900          OUTPUT OUTPUT-FILE                                      02250009
025000                                                                  02260009
025100                                                                  02270009
025200     PERFORM 1000-READ-INPUT-FILE.                                02280009
025300                                                                  02290009
025400     PERFORM 2000-PROCESS-INPUT-FILE                              02300009
025500       UNTIL PS-EOF-INPUT-YES.                                    02310009
025600                                                                  02320009
025700     CLOSE INPUT-FILE                                             02330009
025800           OUTPUT-FILE.                                           02340009
025900                                                                  02350009
026000     MOVE PV-RECORDS-READ    TO PV-DISP-COUNT.                    02360009
026100     DISPLAY '  INPUT RECORDS READ       = ' PV-DISP-COUNT.       02370009
026200     DISPLAY ' '.                                                 02380009
026300                                                                  02390009
026400     MOVE PV-VALID-IND-CNT   TO PV-DISP-COUNT.                    02400009
026500     DISPLAY '  VALID CARTON LABEL IND   = ' PV-DISP-COUNT.       02410009
026600                                                                  02420009
026700     DISPLAY ' '.                                                 02430009
026800     MOVE PV-RECORDS-WRITTEN TO PV-DISP-COUNT.                    02440009
026900     DISPLAY '  PO/SEQ RECORDS WRITTEN   = ' PV-DISP-COUNT.       02450009
027000     DISPLAY ' '.                                                 02460009
027100                                                                  02470009
027200                                                                  02480009
027300     MOVE PV-PBS-PO-COUNT    TO PV-DISP-COUNT.                    02490009
027400     DISPLAY '  PACK BY STORE PO READ    = ' PV-DISP-COUNT.       02500009
027500     DISPLAY ' '.                                                 02510009
027600                                                                  02520009
027700     MOVE PV-PBS-PO-ERR-COUNT TO PV-DISP-COUNT.                   02530009
027800     DISPLAY '  PACK BY STORE PO IN ERROR =' PV-DISP-COUNT.       02540009
027900     DISPLAY ' '.                                                 02550009
028000                                                                  02560009
028100*    MOVE PV-PBS-STORES-CHECKED TO  PV-DISP-COUNT.                02570009
028200*    DISPLAY '  NUMBER OF STORES CHECKED = ' PV-DISP-COUNT.       02580009
028300*    DISPLAY ' '.                                                 02590009
028400                                                                  02600009
028500     DISPLAY '****  END OF  RCKUT120  ****'.                      02610009
028600                                                                  02620009
028700     GOBACK.                                                      02630009
028800                                                                  02640009
028900***************************************************************** 02650009
029000 1000-READ-INPUT-FILE.                                            02660009
029100***************************************************************** 02670009
029200     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       02680009
029300                                                                  02690009
029400     READ INPUT-FILE                                              02700009
029500       INTO RC052-ASN-RECVR-PKSLIP-RECORD                         02710009
029600         AT END                                                   02720009
029700             SET PS-EOF-INPUT-YES TO TRUE                         02730009
029800                                                                  02740009
029900         NOT AT END                                               02750009
030000             SET PS-EOF-INPUT-NO  TO TRUE                         02760009
030100             ADD +1 TO PV-RECORDS-READ                            02770009
030200     END-READ.                                                    02780009
030300                                                                  02790009
030400***************************************************************** 02800009
030500 2000-PROCESS-INPUT-FILE.                                         02810009
030600***************************************************************** 02820009
030700     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       02830009
030800                                                                  02840009
030900                                                                  02850009
031000* USE INPUT PO# TO GET ENTITY-ID (TPURCHS).                       02860009
031100     MOVE RC052-PO-NBR TO DK-PO-NBR                               02870009
031200                          PV-DISP-PO.                             02880009
031300     SET PS-TPURCHS-YES TO TRUE.                                  02890009
031400     PERFORM 2010-SELECT-TPURCHS.                                 02900009
031500                                                                  02910009
031600* USE ENTITY-ID TO GET VALID-CARTON-LABEL-INDICATOR (TEXTENT).    02920009
031700     IF PS-TPURCHS-NO                                             02930009
031800         MOVE 'N' TO EXTENT-VLD-CART-LBL-IND                      02940009
031900     ELSE                                                         02950009
032000         MOVE PURCHS-ENT-ID TO DK-ENT-ID                          02960009
032100         PERFORM 2020-SELECT-TEXTENT                              02970009
032200     END-IF.                                                      02980009
032300                                                                  02990009
032400* IF VALID-CARTON-LABEL-INDICATOR = 'Y', GET PACK SLIP RECORD.    03000009
032500     IF EXTENT-VLD-CART-LBL-IND = 'Y'                             03010009
032600         ADD +1 TO PV-VALID-IND-CNT                               03020009
032700         MOVE RC052-PO-NBR  TO DK-PO-NBR                          03030009
032800         MOVE RC052-SEQ-NBR TO DK-SEQ-NBR                         03040009
032900                               PV-DISP-SEQ                        03050009
033000         PERFORM 2030-SELECT-TPKSLIP                              03060009
033100         IF SQLCODE = +0                                          03070009
033200             MOVE PKSLIP-ASN-NBR    TO DK-ASN-NBR                 03080009
033300             MOVE PKSLIP-BOL-NBR    TO DK-BOL-NBR                 03090009
033400             MOVE RC052-EDI-VEND-ID TO DK-EDI-VEND-ID             03100009
033500             PERFORM 2040-SELECT-TASNHDR                          03110009
033600                                                                          
033700             IF PKSLIP-STR-DEST-NBR > 0                           03120009
033800                PERFORM 2050-SELECT-LOCATION-TYPE                 03130009
033900                IF XL071-LOC-TYP-CDE = 'DS'                               
034000                   PERFORM 2100-CONTINUE-VALIDATION               03150009
034100                END-IF                                            03160009
034200             END-IF                                               03170009
034300         END-IF                                                   03180009
034400     END-IF.                                                      03190009
034500                                                                  03200009
034600                                                                  03210009
034700* GET NEXT INPUT RECORD.                                          03220009
034800     PERFORM 1000-READ-INPUT-FILE.                                03230009
034900                                                                  03240009
035000***************************************************************** 03250009
035100 2010-SELECT-TPURCHS.                                             03260009
035200***************************************************************** 03270009
035300     MOVE '2010-SELECT-TPURCHS     ' TO PV-ABEND-PARAGRAPH.       03280009
035400                                                                  03290009
035500     EXEC SQL                                                     03300009
035600       SELECT ENT_ID                                              03310009
035700             ,DEPT_NBR                                            03320009
035800             ,CURRENT DATE                                        03330009
035900         INTO :PURCHS-ENT-ID                                      03340009
036000             ,:PURCHS-DEPT-NBR                                    03350009
036100             ,:PV-CURRENT-DATE                                    03360009
036200         FROM TPURCHS                                             03370009
036300        WHERE PO_NBR         = :DK-PO-NBR                         03380009
036400          AND VER_STATUS_CDE = 'A'                                03390009
036500     END-EXEC.                                                    03400009
036600                                                                  03410009
036700     EVALUATE TRUE                                                03420009
036800         WHEN SQLCODE = +0                                        03430009
036900             CONTINUE                                             03440009
037000                                                                  03450009
037100         WHEN SQLCODE = +100                                      03460009
037200             SET PS-TPURCHS-NO TO TRUE                            03470009
037300                                                                  03480009
037400         WHEN SQLWARN0 NOT = SPACE                                03490009
037500         WHEN SQLCODE  NOT = +0                                   03500009
037600             MOVE '2010-SELECT-TPURCHS' TO PV-ABEND-PARAGRAPH     03510009
037700             MOVE PV-DISP-PO            TO PV-ABEND-OPERATION     03520009
037800             MOVE 'GET ENT ID'          TO PV-ABEND-STRUCTURE-1   03530009
037900             MOVE 'TPURCHS'             TO PV-ABEND-STRUCTURE-2   03540009
038000             PERFORM Z999-SQL-ABEND                               03550009
038100     END-EVALUATE.                                                03560009
038200                                                                  03570009
038300***************************************************************** 03580009
038400 2020-SELECT-TEXTENT.                                             03590009
038500***************************************************************** 03600009
038600     MOVE '2020-SELECT-TEXTENT     ' TO PV-ABEND-PARAGRAPH.       03610009
038700                                                                  03620009
038800     EXEC SQL                                                     03630009
038900       SELECT VLD_CART_LBL_IND                                    03640009
039000         INTO :EXTENT-VLD-CART-LBL-IND                            03650009
039100         FROM TEXTENT A                                           03660009
039200        WHERE A.ENT_ID = :DK-ENT-ID                               03670009
P40473        WITH UR                                                           
039300     END-EXEC.                                                    03680009
039400                                                                  03690009
039500     EVALUATE TRUE                                                03700009
039600         WHEN SQLCODE = +0                                        03710009
039700             CONTINUE                                             03720009
039800                                                                  03730009
039900         WHEN SQLCODE = +100                                      03740009
040000             MOVE 'N' TO EXTENT-VLD-CART-LBL-IND                  03750009
040100                                                                  03760009
040200         WHEN SQLWARN0 NOT = SPACE                                03770009
040300         WHEN SQLCODE  NOT = +0                                   03780009
040400             MOVE '2020-SELECT-TEXTENT'  TO PV-ABEND-PARAGRAPH    03790009
040500             MOVE 'GET CARTON LABEL IND' TO PV-ABEND-STRUCTURE-1  03800009
040600             MOVE 'TEXTENT'              TO PV-ABEND-STRUCTURE-2  03810009
040700             PERFORM Z999-SQL-ABEND                               03820009
040800     END-EVALUATE.                                                03830009
040900                                                                  03840009
041000***************************************************************** 03850009
041100 2030-SELECT-TPKSLIP.                                             03860009
041200***************************************************************** 03870009
041300     MOVE '2030-SELECT-TPKSLIP     ' TO PV-ABEND-PARAGRAPH.       03880009
041400                                                                  03890009
041500     EXEC SQL                                                     03900009
041600       SELECT PO_NBR                                              03910009
041700            , SEQ_NBR                                             03920009
041800            , OPER_UNT_ID                                         03930009
041900            , STR_DEST_NBR                                        03940009
042000            , BOL_NBR                                             03950009
042100            , EXPTED_PKG_QTY                                      03960009
042200            , ASN_NBR                                             03970009
042300         INTO :PKSLIP-PO-NBR                                      03980009
042400            , :PKSLIP-SEQ-NBR                                     03990009
042500            , :PKSLIP-OPER-UNT-ID                                 04000009
042600            , :PKSLIP-STR-DEST-NBR                                04010009
042700            , :PKSLIP-BOL-NBR                                     04020009
042800            , :PKSLIP-EXPTED-PKG-QTY                              04030009
042900            , :PKSLIP-ASN-NBR                                     04040009
043000         FROM TPKSLIP A                                           04050009
043100        WHERE A.PO_NBR        = :DK-PO-NBR                        04060009
043200          AND A.SEQ_NBR       = :DK-SEQ-NBR                       04070009
043300          AND A.VER_STAT_CDE  = 'A'                               04080009
043400     END-EXEC.                                                    04090009
043500                                                                  04100009
043600     EVALUATE TRUE                                                04110009
043700         WHEN SQLCODE = +0                                        04120009
043800             CONTINUE                                             04130009
043900                                                                  04140009
044000         WHEN SQLCODE = +100                                      04150009
044100             MOVE ZEROES TO PKSLIP-EXPTED-PKG-QTY                 04160009
044200                                                                  04170009
044300         WHEN SQLWARN0 NOT = SPACE                                04180009
044400         WHEN SQLCODE  NOT = +0                                   04190009
044500             MOVE '2030-SELECT-TPKSLIP' TO PV-ABEND-PARAGRAPH     04200009
044600             MOVE PV-DISP-PO            TO PV-ABEND-OPERATION     04210009
044700             MOVE 'GET PACK SLIP INFO ' TO PV-ABEND-STRUCTURE-1   04220009
044800             MOVE 'TPKSLIP'             TO PV-ABEND-STRUCTURE-2   04230009
044900             PERFORM Z999-SQL-ABEND                               04240009
045000     END-EVALUATE.                                                04250009
045100                                                                  04260009
045200***************************************************************** 04270009
045300 2040-SELECT-TASNHDR.                                             04280009
045400***************************************************************** 04290009
045500     MOVE '2040-SELECT-TASNHDR     ' TO PV-ABEND-PARAGRAPH.       04300009
045600                                                                  04310009
045700     EXEC SQL                                                     04320009
045800       SELECT EDIISA_CNTL_NBR                                     04330009
045900         INTO :ASNHDR-EDIISA-CNTL-NBR                             04340009
046000         FROM TASNHDR A                                           04350009
046100        WHERE A.OPERCO_NBR    = '03'                              04360009
046200          AND A.EDI_VEND_ID   = :DK-EDI-VEND-ID                   04370009
046300          AND A.ASNHDR_NBR    = :DK-ASN-NBR                       04380009
046400     END-EXEC.                                                    04390009
046500                                                                  04400009
046600     EVALUATE TRUE                                                04410009
046700         WHEN SQLCODE = +0                                        04420009
046800             CONTINUE                                             04430009
046900                                                                  04440009
047000         WHEN SQLCODE = +100                                      04450009
047100             MOVE ZEROES TO ASNHDR-EDIISA-CNTL-NBR                04460009
047200                                                                  04470009
047300         WHEN SQLWARN0 NOT = SPACE                                04480009
047400         WHEN SQLCODE  NOT = +0                                   04490009
047500             MOVE '2040-SELECT-TASNHDR' TO PV-ABEND-PARAGRAPH     04500009
047600             MOVE PV-DISP-PO            TO PV-ABEND-OPERATION     04510009
047700             MOVE 'GET ADV SHP NOT HDR' TO PV-ABEND-STRUCTURE-1   04520009
047800             MOVE 'TASNHDR'             TO PV-ABEND-STRUCTURE-2   04530009
047900             PERFORM Z999-SQL-ABEND                               04540009
048000     END-EVALUATE.                                                04550009
048100                                                                  04560009
048200***************************************************************** 04570009
048300 2050-SELECT-LOCATION-TYPE.                                       04580009
048400***************************************************************** 04590009
048500     MOVE '2050-SELECT-LOCATION-TYPE' TO PV-ABEND-PARAGRAPH.      04600009
048600                                                                          
048700     INITIALIZE XL071-COMMAREA-REC.                                       
048800     MOVE PKSLIP-STR-DEST-NBR   TO XL071-LOCATION-NUMBER                  
048900                                                                          
049000     CALL XL071-LOCATION-MODULE USING XL071-COMMAREA-REC.                 
049100                                                                          
049200     EVALUATE TRUE                                                        
049300         WHEN XL071-NO-ERRORS                                             
049400         WHEN XL071-LOC-NOT-FOUND                                         
049500         WHEN XL071-DC-ASGMT-NOT-FND                                      
049600             CONTINUE                                                     
049700         WHEN XL071-BAD-DB2-RETURN                                        
049800             MOVE '2050-SELECT-LOCATION-TYPE'                     04750009
049900                                        TO PV-ABEND-PARAGRAPH             
050000             MOVE PV-DISP-PO            TO PV-ABEND-OPERATION     04760009
050100             MOVE 'VALIDATE STORE NBR ' TO PV-ABEND-STRUCTURE-1   04770009
050200             MOVE 'XLT_LOC'             TO PV-ABEND-STRUCTURE-2   04780009
050300             MOVE XL071-SQLCA           TO SQLCA                          
050400             PERFORM Z999-SQL-ABEND                               04790009
050500     END-EVALUATE.                                                        
050600/                                                                         
050700***************************************************************** 04820009
050800 2100-CONTINUE-VALIDATION.                                        04830009
050900***************************************************************** 04840009
051000     MOVE '2100-CONTINUE-VALIDATION' TO PV-ABEND-PARAGRAPH.       04850009
051100                                                                  04860009
051200*************************                                         04870009
051300* CHECK CARTON QUANTITY *                                         04880009
051400*************************                                         04890009
051500                                                                  04900009
051600* COUNT NUMBER OF ROWS ON TINPKSU FOR PO/SEQ.                     04910009
051700     MOVE RC052-PO-NBR  TO DK-PO-NBR.                             04920009
051800     MOVE RC052-SEQ-NBR TO DK-SEQ-NBR.                            04930009
051900     MOVE ZEROES TO PV-INPKSU-COUNT.                              04940009
052000     PERFORM 2110-COUNT-TINPKSU.                                  04950009
052100     IF RC052-PO-NBR = PV-PO-NBR-HOLD                             04960009
052200        CONTINUE                                                  04970009
052300     ELSE                                                         04980009
052400        MOVE RC052-PO-NBR TO PV-PO-NBR-HOLD                       04990009
052500        ADD +1 TO PV-PBS-PO-COUNT                                 05000009
052600     END-IF                                                       05010009
052700                                                                  05020009
052800***********************                                           05030009
052900* CHECK ITEM QUANTITY *                                           05040009
053000***********************                                           05050009
053100     SET PS-NO-ERROR-RECORD-FOUND                                 05060009
053200         PS-SHUUPC-CSR-EOF-YES                                    05070009
053300         PS-PKITEM-CSR-EOF-YES TO TRUE.                           05080009
053400                                                                  05090009
053500     MOVE ZEROES               TO PV-SHUUPC-FETCH-COUNT.          05100009
053600* OPEN CURSORS.                                                   05110009
053700     PERFORM 2120-OPEN-SHUUPC-CSR.                                05120009
053800     PERFORM 2130-OPEN-PKITEM-CSR.                                05130009
053900                                                                  05140009
054000* GET FIRST ROW FROM EACH CURSOR.                                 05150009
054100     PERFORM 2160-FETCH-SHUUPC-CSR.                               05160009
054200     PERFORM 2170-FETCH-PKITEM-CSR.                               05170009
054300                                                                  05180009
054400* COMPARE CURSORS, WRITE ERRORS WHEN DIFFERENT.                   05190009
054500     PERFORM 2200-COMPARE-CURSORS                                 05200009
054600       UNTIL PS-SHUUPC-CSR-EOF-YES                                05210009
054700         AND PS-PKITEM-CSR-EOF-YES.                               05220009
054800                                                                  05230009
054900                                                                  05240009
055000        IF (RC052-UPC-BAD-CRTN-REC  = 'Y')   AND                  05250009
055100             PS-NO-ERROR-RECORD-FOUND                             05260009
055200           PERFORM 3200-LOAD-EXTR-ERR-UPD-REC                     05270009
055300        END-IF                                                    05280009
055400* CLOSE CURSORS.                                                  05290009
055500     PERFORM 2140-CLOSE-SHUUPC-CSR.                               05300009
055600     PERFORM 2150-CLOSE-PKITEM-CSR.                               05310009
055700                                                                  05320009
055800***************************************************************** 05330009
055900 2110-COUNT-TINPKSU.                                              05340009
056000***************************************************************** 05350009
056100     MOVE '2110-COUNT-TINPKSU      ' TO PV-ABEND-PARAGRAPH.       05360009
056200                                                                  05370009
056300     EXEC SQL                                                     05380009
056400         SELECT COUNT(*)                                          05390009
056500           INTO :PV-INPKSU-COUNT                                  05400009
056600           FROM TINPKSU A                                         05410009
056700          WHERE A.PO_NBR      = :DK-PO-NBR                        05420009
056800            AND A.SEQ_NBR     = :DK-SEQ-NBR                       05430009
056900     END-EXEC.                                                    05440009
057000                                                                  05450009
057100     EVALUATE TRUE                                                05460009
057200         WHEN SQLCODE = +0                                        05470009
057300         WHEN SQLCODE = +100                                      05480009
057400             CONTINUE                                             05490009
057500                                                                  05500009
057600         WHEN SQLWARN0 NOT = SPACE                                05510009
057700         WHEN SQLCODE  NOT = +0                                   05520009
057800             MOVE '2110-COUNT-TINPKSU' TO PV-ABEND-PARAGRAPH      05530009
057900             MOVE PV-DISP-PO           TO PV-ABEND-OPERATION      05540009
058000             MOVE 'COUNT INPKSU ROWS ' TO PV-ABEND-STRUCTURE-1    05550009
058100             MOVE 'TINPKSU'            TO PV-ABEND-STRUCTURE-2    05560009
058200             PERFORM Z999-SQL-ABEND                               05570009
058300     END-EVALUATE.                                                05580009
058400                                                                  05590009
058500***************************************************************** 05600009
058600 2120-OPEN-SHUUPC-CSR.                                            05610009
058700***************************************************************** 05620009
058800     MOVE '2120-OPEN-SHUUPC-CSR    ' TO PV-ABEND-PARAGRAPH.       05630009
058900                                                                  05640009
059000     EXEC SQL                                                     05650009
059100         OPEN SHUUPC-CSR                                          05660009
059200     END-EXEC                                                     05670009
059300                                                                  05680009
059400     EVALUATE TRUE                                                05690009
059500         WHEN SQLCODE = ZERO                                      05700009
059600             SET PS-SHUUPC-CSR-EOF-NO TO TRUE                     05710009
059700                                                                  05720009
059800         WHEN OTHER                                               05730009
059900             PERFORM Z999-SQL-ABEND                               05740009
060000       END-EVALUATE.                                              05750009
060100                                                                  05760009
060200***************************************************************** 05770009
060300 2130-OPEN-PKITEM-CSR.                                            05780009
060400***************************************************************** 05790009
060500     MOVE '2130-OPEN-PKITEM-CSR    ' TO PV-ABEND-PARAGRAPH.       05800009
060600                                                                  05810009
060700     EXEC SQL                                                     05820009
060800         OPEN PKITEM-CSR                                          05830009
060900     END-EXEC                                                     05840009
061000                                                                  05850009
061100     EVALUATE TRUE                                                05860009
061200         WHEN SQLCODE = ZERO                                      05870009
061300             SET PS-PKITEM-CSR-EOF-NO TO TRUE                     05880009
061400                                                                  05890009
061500         WHEN OTHER                                               05900009
061600             PERFORM Z999-SQL-ABEND                               05910009
061700       END-EVALUATE.                                              05920009
061800                                                                  05930009
061900***************************************************************** 05940009
062000 2140-CLOSE-SHUUPC-CSR.                                           05950009
062100***************************************************************** 05960009
062200     MOVE '2140-CLOSE-SHUUPC-CSR   ' TO PV-ABEND-PARAGRAPH.       05970009
062300                                                                  05980009
062400     EXEC SQL                                                     05990009
062500         CLOSE SHUUPC-CSR                                         06000009
062600     END-EXEC                                                     06010009
062700                                                                  06020009
062800     EVALUATE TRUE                                                06030009
062900         WHEN SQLCODE = ZERO                                      06040009
063000             CONTINUE                                             06050009
063100         WHEN OTHER                                               06060009
063200             PERFORM Z999-SQL-ABEND                               06070009
063300       END-EVALUATE.                                              06080009
063400                                                                  06090009
063500***************************************************************** 06100009
063600 2150-CLOSE-PKITEM-CSR.                                           06110009
063700***************************************************************** 06120009
063800     MOVE '2150-CLOSE-PKITEM-CSR   ' TO PV-ABEND-PARAGRAPH.       06130009
063900                                                                  06140009
064000     EXEC SQL                                                     06150009
064100         CLOSE PKITEM-CSR                                         06160009
064200     END-EXEC                                                     06170009
064300                                                                  06180009
064400     EVALUATE TRUE                                                06190009
064500         WHEN SQLCODE = ZERO                                      06200009
064600             CONTINUE                                             06210009
064700         WHEN OTHER                                               06220009
064800             PERFORM Z999-SQL-ABEND                               06230009
064900       END-EVALUATE.                                              06240009
065000                                                                  06250009
065100***************************************************************** 06260009
065200 2160-FETCH-SHUUPC-CSR.                                           06270009
065300***************************************************************** 06280009
065400     MOVE '2160-FETCH-SHUUPC-CSR   ' TO PV-ABEND-PARAGRAPH.       06290009
065500                                                                  06300009
065600     EXEC SQL                                                     06310009
065700         FETCH SHUUPC-CSR                                         06320009
065800          INTO :SHUUPC-TRN-NBR                                    06330009
065900             , :SHUUPC-TRN-LNE-NBR                                06340009
066000             , :SHUUPC-SHPD-QTY                                   06350009
066100             , :SHUUPC-SHIPT-UNT-ID                               06360009
066200     END-EXEC.                                                    06370009
066300                                                                  06380009
066400     EVALUATE TRUE                                                06390009
066500         WHEN SQLCODE = +0                                        06400009
066600             SET PS-SHUUPC-CSR-EOF-NO TO TRUE                     06410009
066700             ADD +1 TO PV-SHUUPC-FETCH-COUNT                      06420009
066800         WHEN SQLCODE = +100                                      06430009
066900             MOVE ZEROES TO SHUUPC-TRN-LNE-NBR                    06440009
067000                            SHUUPC-SHPD-QTY                       06450009
067100             SET PS-SHUUPC-CSR-EOF-YES TO TRUE                    06460009
067200         WHEN SQLWARN0 NOT = SPACE                                06470009
067300         WHEN SQLCODE  NOT = +0                                   06480009
067400             MOVE '2160-FETCH-SHUUPC-CSR' TO PV-ABEND-PARAGRAPH   06490009
067500             MOVE PV-DISP-PO              TO PV-ABEND-OPERATION   06500009
067600             MOVE 'FETCH SHUUPC CURSOR'   TO PV-ABEND-STRUCTURE-1 06510009
067700             MOVE 'TSHUUPC'               TO PV-ABEND-STRUCTURE-2 06520009
067800             PERFORM Z999-SQL-ABEND                               06530009
067900     END-EVALUATE.                                                06540009
068000                                                                  06550009
068100***************************************************************** 06560009
068200 2170-FETCH-PKITEM-CSR.                                           06570009
068300***************************************************************** 06580009
068400     MOVE '2170-FETCH-PKITEM-CSR   ' TO PV-ABEND-PARAGRAPH.       06590009
068500                                                                  06600009
068600     EXEC SQL                                                     06610009
068700         FETCH PKITEM-CSR                                         06620009
068800          INTO :PKITEM-PKSL-LNE-NBR                               06630009
068900             , :PKITEM-PKSL-ITM-QTY                               06640009
069000     END-EXEC.                                                    06650009
069100                                                                  06660009
069200     EVALUATE TRUE                                                06670009
069300         WHEN SQLCODE = +0                                        06680009
069400             SET PS-PKITEM-CSR-EOF-NO  TO TRUE                    06690009
069500                                                                  06700009
069600         WHEN SQLCODE = +100                                      06710009
069700             MOVE ZEROES TO PKITEM-PKSL-LNE-NBR                   06720009
069800                            PKITEM-PKSL-ITM-QTY                   06730009
069900             SET PS-PKITEM-CSR-EOF-YES TO TRUE                    06740009
070000                                                                  06750009
070100         WHEN SQLWARN0 NOT = SPACE                                06760009
070200         WHEN SQLCODE  NOT = +0                                   06770009
070300             MOVE '2160-FETCH-SHUUPC-CSR' TO PV-ABEND-PARAGRAPH   06780009
070400             MOVE PV-DISP-PO              TO PV-ABEND-OPERATION   06790009
070500             MOVE 'FETCH SHUUPC CURSOR'   TO PV-ABEND-STRUCTURE-1 06800009
070600             MOVE 'TSHUUPC'               TO PV-ABEND-STRUCTURE-2 06810009
070700             PERFORM Z999-SQL-ABEND                               06820009
070800     END-EVALUATE.                                                06830009
070900                                                                  06840009
071000***************************************************************** 06850009
071100 2200-COMPARE-CURSORS.                                            06860009
071200***************************************************************** 06870009
071300     MOVE '2200-COMPARE-CURSORS    ' TO PV-ABEND-PARAGRAPH.       06880009
071400                                                                  06890009
071500     IF PS-SHUUPC-CSR-EOF-YES                                     06900009
071600       AND PS-PKITEM-CSR-EOF-NO                                   06910009
071700         IF PV-SHUUPC-FETCH-COUNT > 0                             06920009
071800            INITIALIZE RC053-ASN-RECVR-PKSLIP-ERRREC              06930009
071900            SET RC053-PBS-UPC-NOT-ON-PO-ERR TO TRUE               06940009
072000            PERFORM 3100-LOAD-EXTRACT-ERR-RECORD                  06950009
072100         END-IF                                                   06960009
072200         PERFORM 2170-FETCH-PKITEM-CSR                            06970009
072300     END-IF.                                                      06980009
072400                                                                  06990009
072500     IF PS-SHUUPC-CSR-EOF-NO                                      07000009
072600       AND PS-PKITEM-CSR-EOF-YES                                  07010009
072700         INITIALIZE RC053-ASN-RECVR-PKSLIP-ERRREC                 07020009
072800         SET RC053-PBS-UPC-CTN-ERR TO TRUE                        07030009
072900         PERFORM 3100-LOAD-EXTRACT-ERR-RECORD                     07040009
073000         PERFORM 2160-FETCH-SHUUPC-CSR                            07050009
073100     END-IF.                                                      07060009
073200                                                                  07070009
073300     IF PS-SHUUPC-CSR-EOF-NO                                      07080009
073400       AND PS-PKITEM-CSR-EOF-NO                                   07090009
073500         IF PKITEM-PKSL-LNE-NBR = SHUUPC-TRN-LNE-NBR              07100009
073600             IF PKITEM-PKSL-ITM-QTY NOT = SHUUPC-SHPD-QTY         07110009
073700                 INITIALIZE RC053-ASN-RECVR-PKSLIP-ERRREC         07120009
073800                 SET RC053-PBS-UNITS-ERR  TO TRUE                 07130009
073900                 PERFORM 3100-LOAD-EXTRACT-ERR-RECORD             07140009
074000             END-IF                                               07150009
074100             PERFORM 2160-FETCH-SHUUPC-CSR                        07160009
074200             PERFORM 2170-FETCH-PKITEM-CSR                        07170009
074300         ELSE                                                     07180009
074400         IF PKITEM-PKSL-LNE-NBR > SHUUPC-TRN-LNE-NBR              07190009
074500*** NEW TROUBLE UPC P/S                                           07200009
074600             INITIALIZE RC053-ASN-RECVR-PKSLIP-ERRREC             07210009
074700             IF SHUUPC-TRN-LNE-NBR = ZERO                         07211009
074800                SET RC053-PBS-LNE-ZERO-ERR  TO TRUE               07211109
074900             ELSE                                                 07211209
075000                SET RC053-PBS-UPC-PKSL-ERR  TO TRUE               07211309
075100             END-IF                                               07211409
075200             PERFORM 3100-LOAD-EXTRACT-ERR-RECORD                 07211509
075300             PERFORM 2160-FETCH-SHUUPC-CSR                        07211609
075400         ELSE                                                     07211709
075500         IF PKITEM-PKSL-LNE-NBR < SHUUPC-TRN-LNE-NBR              07211809
075600             INITIALIZE RC053-ASN-RECVR-PKSLIP-ERRREC             07211909
075700*** NEW TROUBLE NO UPC/CARTON                                     07212009
075800             SET RC053-PBS-UPC-CTN-ERR TO TRUE                    07213009
075900             PERFORM 3100-LOAD-EXTRACT-ERR-RECORD                 07214009
076000             PERFORM 2170-FETCH-PKITEM-CSR                        07215009
076100         END-IF                                                   07216009
076200         END-IF                                                   07217009
076300         END-IF                                                   07218009
076400     END-IF.                                                      07219009
076500                                                                  07220009
076600***************************************************************** 07230009
076700 3100-LOAD-EXTRACT-ERR-RECORD.                                    07240009
076800***************************************************************** 07250009
076900     MOVE '3100-LOAD-EXTRACT-ERR   ' TO PV-ABEND-PARAGRAPH.       07260009
077000                                                                  07270009
077100                                                                  07280009
077200     SET PS-ERROR-RECORD-FOUND TO TRUE                            07290009
077300                                                                  07300009
077400     IF (RC052-PO-NBR   = PV-PO-NBR-HOLD) AND                     07310009
077500        ( RC052-SEQ-NBR  = PV-SEQ-NBR-HOLD)                       07320009
077600           CONTINUE                                               07330009
077700     ELSE                                                         07340009
077800         IF RC052-PO-NBR = PV-PO-NBR-HOLD-2                       07350009
077900           CONTINUE                                               07360009
078000         ELSE                                                     07370009
078100            MOVE RC052-PO-NBR TO PV-PO-NBR-HOLD-2                 07380009
078200            ADD +1 TO PV-PBS-PO-ERR-COUNT                         07390009
078300         END-IF                                                   07400009
078400                                                                  07410009
078500         MOVE '2'                      TO RC053-TYPE-CODE         07420009
078600         MOVE RC052-PO-NBR             TO RC053-PO-NBR            07430009
078700                                          PV-PO-NBR-HOLD          07440009
078800                                          DK-PO-NBR-2             07450009
078900         MOVE RC052-SEQ-NBR            TO RC053-SEQ-NBR           07460009
079000                                          PV-SEQ-NBR-HOLD         07470009
079100                                          DK-SEQ-NBR-2            07480009
079200         MOVE SHUUPC-TRN-LNE-NBR       TO RC053-TRN-LINE-NBR      07481009
079300         IF RC053-PBS-UNITS-ERR                                   07482009
079400            PERFORM 4000-SELECT-CRTN-UPC                          07483009
079500         END-IF                                                   07484009
079600                                                                  07484109
079700         MOVE RC052-EDI-VEND-NAME      TO RC053-VENDOR-NAME       07484209
079800         MOVE RC052-CARRIER-SCAC-CODE  TO RC053-SCAC              07484309
079900         MOVE RC052-BILL-OF-LADING-NBR TO RC053-BOL-NBR           07484409
080000                                                                  07484509
080100         MOVE PKSLIP-ASN-NBR           TO RC053-ASN-NBR           07484609
080200         MOVE PKSLIP-OPER-UNT-ID       TO RC053-DC                07484709
080300         MOVE PKSLIP-STR-DEST-NBR      TO RC053-DEST-STORE        07484809
080400                                                                  07484909
080500         MOVE PKSLIP-EXPTED-PKG-QTY    TO RC053-TPKSLIP-EXP-QTY   07485009
080600         MOVE PV-INPKSU-COUNT          TO RC053-TINPKSU-PKG-COUNT 07486009
080700                                                                  07487009
080800         MOVE PURCHS-ENT-ID            TO RC053-TPURCHS-ENT-ID    07488009
080900         MOVE PURCHS-DEPT-NBR          TO RC053-DEPT-NBR          07489009
081000         MOVE ASNHDR-EDIISA-CNTL-NBR   TO RC053-EDIISA-CNTL-NBR   07490009
081100         MOVE SHUUPC-SHPD-QTY          TO RC053-TSHUUPC-SHP-QTY   07500009
081200         MOVE SHUUPC-SHIPT-UNT-ID      TO RC053-SHIPT-UNT-ID      07510009
081300                                                                  07520009
081400         MOVE SHUUPC-UPC-NBR           TO RC053-UPC-NBR           07530009
081500                                                                  07540009
081600         MOVE PKITEM-PKSL-LNE-NBR      TO RC053-PKSL-LINE-NBR     07550009
081700         MOVE PKITEM-PKSL-ITM-QTY      TO RC053-TPKITEM-EXP-QTY   07560009
081800         MOVE RC052-UPC-BAD-CRTN-REC   TO RC053-UPC-BAD-CRTN-REC  07570009
081900         SET RC053-UPC-UPD-NOT-RESLVED TO TRUE                    07580009
082000         MOVE PV-CURRENT-DATE          TO RC053-PBS-CREATE-DATE   07590009
082100         MOVE ZEROES                   TO PV-UPC-RECYCLE-COUNT    07600009
082200         MOVE RC052-UPC-RECYCLE-COUNT  TO PV-UPC-RECYCLE-COUNT    07610009
082300         ADD +1                        TO PV-UPC-RECYCLE-COUNT    07620009
082400         MOVE PV-UPC-RECYCLE-COUNT     TO RC053-UPC-RECYCLE-COUNT 07630009
082500                                                                  07640009
082600         WRITE OUTPUT-RECORD                                      07650009
082700             FROM RC053-ASN-RECVR-PKSLIP-ERRREC                   07660009
082800             ADD +1 TO PV-RECORDS-WRITTEN                         07670009
082900     END-IF.                                                      07680009
083000                                                                  07690009
083100***************************************************************** 07700009
083200 3200-LOAD-EXTR-ERR-UPD-REC.                                      07710009
083300***************************************************************** 07720009
083400     MOVE '3200-LOAD-EXTR-ERR-UPD-REC ' TO PV-ABEND-PARAGRAPH.    07730009
083500                                                                  07740009
083600       MOVE '2'                      TO RC053-TYPE-CODE           07750009
083700       MOVE RC052-PO-NBR             TO RC053-PO-NBR              07760009
083800                                                                  07770009
083900       MOVE RC052-SEQ-NBR            TO RC053-SEQ-NBR             07780009
084000                                                                  07790009
084100       MOVE RC052-EDI-VEND-NAME      TO RC053-VENDOR-NAME         07800009
084200       MOVE RC052-BILL-OF-LADING-NBR TO RC053-BOL-NBR             07810009
084300                                                                  07820009
084400       MOVE PKSLIP-ASN-NBR           TO RC053-ASN-NBR             07830009
084500       MOVE PKSLIP-OPER-UNT-ID       TO RC053-DC                  07840009
084600       MOVE PKSLIP-STR-DEST-NBR      TO RC053-DEST-STORE          07850009
084700       MOVE RC052-UPC-BAD-CRTN-REC   TO RC053-UPC-BAD-CRTN-REC    07860009
084800                                                                  07870009
084900       SET RC053-UPC-UPD-RESOLVED    TO TRUE                      07880009
085000                                                                  07890009
085100       MOVE ZEROES                   TO PV-UPC-RECYCLE-COUNT      07900009
085200       MOVE RC052-UPC-RECYCLE-COUNT  TO PV-UPC-RECYCLE-COUNT      07910009
085300       ADD +1                        TO PV-UPC-RECYCLE-COUNT      07920009
085400       MOVE PV-UPC-RECYCLE-COUNT     TO RC053-UPC-RECYCLE-COUNT   07930009
085500                                                                  07940009
085600       WRITE OUTPUT-RECORD                                        07950009
085700           FROM RC053-ASN-RECVR-PKSLIP-ERRREC                     07960009
085800           ADD +1 TO PV-RECORDS-WRITTEN.                          07970009
085900                                                                  07980009
086000***************************************************************** 07990009
086100 4000-SELECT-CRTN-UPC.                                            08000009
086200***************************************************************** 08010009
086300     MOVE '4000-SELECT-CRTN-UPC    ' TO PV-ABEND-PARAGRAPH.       08020009
086400                                                                  08030009
086500     EXEC SQL                                                     08040009
086600         SELECT DISTINCT(B.UPC_NBR)                               08050009
086700              ,  B.SHIPT_UNT_ID                                   08060009
086800         INTO  :SHUUPC-UPC-NBR                                    08070009
086900              ,:SHUUPC-SHIPT-UNT-ID                               08080009
087000          FROM  TINPKSU A                                         08081009
087100              , TSHUUPC B                                         08082009
087200          WHERE A.PO_NBR        =  B.TRN_NBR                      08083009
087300            AND A.SHIPT_UNT_ID  =  B.SHIPT_UNT_ID                 08084009
087400            AND A.PO_NBR        = :DK-PO-NBR-2                    08085009
087500            AND A.SEQ_NBR       = :DK-SEQ-NBR-2                   08086009
087600            AND B.TRN_LNE_NBR   = :SHUUPC-TRN-LNE-NBR             08086109
087700     END-EXEC.                                                    08086209
087800                                                                  08086309
087900     EVALUATE TRUE                                                08086409
088000         WHEN SQLCODE = +0                                        08086509
088100         WHEN SQLCODE = -811                                      08086609
088200             CONTINUE                                             08086709
088300         WHEN SQLWARN0 NOT = SPACE                                08086809
088400         WHEN SQLCODE  NOT = +0                                   08086909
088500             MOVE DK-SEQ-NBR-2  TO PV-DISP-SEQ                    08087009
088600             MOVE SHUUPC-TRN-LNE-NBR TO PV-DISP-LINE1             08088009
088700             DISPLAY '*** PURCH ORD  = ' PV-DISP-PO               08089009
088800             DISPLAY '*** SEQ NBR    = ' PV-DISP-SEQ              08089109
088900             DISPLAY '*** LINE NMBR  = ' PV-DISP-LINE1            08089209
089000             MOVE '4000-SELECT-CRTN-UPC' TO PV-ABEND-PARAGRAPH    08089309
089100             MOVE PV-DISP-PO            TO PV-ABEND-OPERATION     08089409
089200             MOVE 'SELECT UPC AND CRTN' TO PV-ABEND-STRUCTURE-1   08089509
089300             MOVE 'TSHUUPC'             TO PV-ABEND-STRUCTURE-2   08089609
089400             PERFORM Z999-SQL-ABEND                               08089709
089500     END-EVALUATE.                                                08089809
089600                                                                  08089909
089700***************************************************************** 08090009
089800 Z999-SQL-ABEND.                                                  08090109
089900***************************************************************** 08090209
090000     MOVE SQLCODE TO PV-SQLCODE.                                  08090309
090100     MOVE PV-SQLCODE TO PV-DISP-SQLCODE.                          08090409
090200     DISPLAY '*** DB2 ERROR '.                                    08090509
090300     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  08090609
090400     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08090709
090500     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08090809
090600     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08090909
090700     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       08091009
090800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       08092009
090900     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       08093009
091000     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             08094009
091100                                                                  08095009
091200     IF PV-ABEND-STRUCTURE-2 > SPACES                             08096009
091300         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          08097009
091400     END-IF.                                                      08098009
091500                                                                  08099009
091600     COPY DPPD004.                                                08100009
091700                                                                  08110009
091800     MOVE +4013         TO PV-ABEND-CODE.                         08120009
091900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08130009
