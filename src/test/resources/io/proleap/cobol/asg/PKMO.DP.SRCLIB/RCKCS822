000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.    RCKCS822.                                         00030000
000400                                                                  00040000
000500 AUTHOR.        JOHN HUTCHINSON.                                  00050000
000600                                                                  00060000
000700 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00070000
000800                                                                  00080000
000900 DATE-WRITTEN.  02-17-03.                                         00090000
001000                                                                  00100000
001100 DATE-COMPILED.                                                   00110000
001200                                                                  00120000
001210*                                                                 00121011
001220*********************************************************         00122012
001230* *   IF ANY CHANGES ARE MADE TO THIS PROGRAM         * *         00123012
001240* *   BE SURE TO CHECK THE BATCH PROGRAM (RCKUP822)   * *         00124012
001250* *   TO SEE IF THE SAME CHANGE SHOULD BE MADE        * *         00125012
001260*********************************************************         00126012
001270*                                                                 00127012
001300                                                                  00130000
001400*----------------------------------------------------------------*00140000
001500*----------------------------------------------------------------*00150000
001600*  E822 - PRORATION SIMPLIFICATION - OPEN TO RECEIVE (OTR) MODULE 00160000
001700*                                                                 00170000
001800*  THIS PROGRAM IS A CLONE OF DPKCS277.                           00180000
001900*                                                                 00190000
002000*  CALLED FROM RCKCS821 USING RCWS822 COMMAREA.                   00200002
002100*                                                                 00210000
002200*                                                                 00220000
002300*  THE PURPOSE OF THE OTR MODULE IS TO CALCULATE UNITS OPEN TO    00230000
002400*  RECEIVE FOR A STORE.  MERCHANDISE ANALYSTS CREATE STORE        00240000
002500*  ALLOCATION (DISTRO) PLANS THAT CONTAIN BY PACK OR SKU/LINE     00250000
002600*  THE UNITS OR PACKS EACH STORE SHOULD RECEIVE OFF OF A PURCHASE 00260000
002700*  ORDER. AS THE DC PROCESES RECEIPTS, TRANSCRIPTION AND PRORATION00270000
002800*  PARTIALLY DISTRIBUTE UNITS AGAINST THIS PLAN. THE ORIGINAL PLAN00280000
002900*  MINUS ALL OF THE RECEIPTS (PARTIAL RECEIPTS) MAKES UP THE OTR. 00290000
003000*                                                                 00300000
003100*  IT IS NOT UNCOMMON FOR A VENDOR TO SEND MULTIPLE SHIPMENTS FOR 00310000
003200*  A PURCHASE ORDER. OTR ENSURES STORES ARE NOT DISTRIBUTED MORE  00320000
003300*  THAN IS PLANNED.                                               00330000
003400*----------------------------------------------------------------*00340000
003410* CHANGE HISTORY                                                 *00341012
003430*    CHANGES                                                     *00343011
003440*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)               *00344011
003450*     DATE:    10/15/2014                                        *00345011
003460*                                                                *00346011
003470*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO#  *00347011
003480*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/15/2014     *00348011
003500*----------------------------------------------------------------*00350000
003600                                                                  00360000
003700                                                                  00370000
003800 ENVIRONMENT DIVISION.                                            00380000
003900                                                                  00390000
004000 CONFIGURATION SECTION.                                           00400000
004100                                                                  00410000
004200 SOURCE-COMPUTER.        IBM-3090.                                00420000
004300 OBJECT-COMPUTER.        IBM-3090.                                00430000
004400                                                                  00440000
004500                                                                  00450000
004600*---------------------------*                                     00460000
004700 DATA DIVISION.                                                   00470000
004800*---------------------------*                                     00480000
004900                                                                  00490000
005000*---------------------------*                                     00500000
005100 WORKING-STORAGE SECTION.                                         00510000
005200*---------------------------*                                     00520000
005300                                                                  00530000
005400 01  COUNTERS-AND-STUFF.                                          00540000
005500     05  PV-APP-LINE-NBR         PIC S9(09) VALUE +0 COMP.        00550000
005600     05  PV-PURITM-RATO-QTY      PIC S9(04) VALUE +0 COMP.        00560000
005700     05  PV-RECITM-RATO-QTY      PIC S9(04) VALUE +0 COMP.        00570000
005800     05  PV-ALLPLN-SPLIT-QTY-PK  PIC S9(04) VALUE +0 COMP.        00580000
005900     05  PV-RECEIVED-QTY         PIC S9(09) VALUE +0 COMP.        00590000
006000     05  PV-TOT-RECEIVED-QTY     PIC S9(09) VALUE +0 COMP.        00600000
006100     05  PV-RECEIVED-QTY-PK      PIC S9(09) VALUE +0 COMP.        00610000
006200     05  PV-PO-LNE-NBR           PIC S9(09) VALUE +0 COMP.        00620000
006300     05  PV-STORE-COUNT          PIC S9(09) VALUE +0 COMP.        00630000
006400     05  PV-SUM-STR-DISTRO-QTY   PIC S9(09) VALUE +0 COMP.        00640000
006500     05  PV-SAVE-FIRST-COUNT     PIC S9(09) VALUE +0 COMP.        00650000
006600     05  PV-STR-DISTRO-QTY       PIC S9(09) VALUE +0 COMP.        00660000
006700     05  PV-SQLCODE              PIC S9(09) VALUE +0.             00670000
006800*PS 10/15/2014 CHANGE STARTS                                      00680011
006810     05  PV-DISP-PO-NBR          PIC  9(08) VALUE ZEROS.          00681011
006820*PS 10/15/2014 CHANGE ENDS                                        00682011
006900     05  PV-DISP-REC-SEQ-NBR     PIC  9(04) VALUE ZEROS.          00690000
007000     05  PV-DISP-PO-LNE-NBR      PIC  9(04) VALUE ZEROS.          00700000
007100     05  PV-DISP-OPER-UNT-ID     PIC  9(04) VALUE ZEROS.          00710000
007200     05  PV-DISP-FCLTY-ID        PIC  9(04) VALUE ZEROS.          00720000
007300     05  PV-DISP-STR-NBR         PIC  9(04) VALUE ZEROS.          00730000
007400     05  PV-RETURN-MSG           PIC  X(40) VALUE SPACES.         00740000
007500     05  PV-DISPLAY-SQLCODE      PIC -ZZZZZZZZ9.                  00750000
007600     05  PV-DISPLAY-QTY          PIC  ZZZ9-.                      00760000
007700     05  PV-DISPLAY-QTY1         PIC  ZZZ9-.                      00770000
007800     05  PV-DISPLAY-QTY2         PIC  ZZZ9-.                      00780000
007900     05  PV-DISPLAY-QTY3         PIC  ZZZ9-.                      00790000
008000                                                                  00800000
008100                                                                  00810000
008200 01  PROGRAM-SWITCHES.                                            00820000
008300                                                                  00830000
008400     05  PS-ERRORS-SW            PIC  X(01) VALUE 'N'.            00840000
008500         88  PS-ERRORS-NO                   VALUE 'N'.            00850000
008600         88  PS-ERRORS-YES                  VALUE 'Y'.            00860000
008700                                                                  00870000
008800     05  PS-EOF-PLAN-CSR-SW      PIC  X(01) VALUE 'N'.            00880000
008900         88  PS-PLAN-CSR-START              VALUE 'N'.            00890000
009000         88  PS-PLAN-CSR-EOF                VALUE 'Y'.            00900000
009100                                                                  00910000
009200     05  PS-EOF-BASE-CSR-SW      PIC  X(01) VALUE 'N'.            00920000
009300         88  PS-BASE-CSR-START              VALUE 'N'.            00930000
009400         88  PS-BASE-CSR-EOF                VALUE 'Y'.            00940000
009500                                                                  00950000
009600     05  PS-PRIOR-CURSOR-SW      PIC  X(01) VALUE 'N'.            00960000
009700         88  PS-PRIOR-CURSOR-START          VALUE 'N'.            00970000
009800         88  PS-PRIOR-CURSOR-EOF            VALUE 'Y'.            00980000
009900                                                                  00990000
010000     05  PS-CURSOR-SW            PIC  X(01) VALUE 'N'.            01000000
010100         88  PS-CURSOR-CLOSED               VALUE 'N'.            01010000
010200         88  PS-CURSOR-OPEN                 VALUE 'Y'.            01020000
010300                                                                  01030000
010400     05  PS-LINE-DISTRO-SW       PIC  X(01) VALUE 'Y'.            01040000
010500         88  PS-LINE-HAS-DISTRO-YES         VALUE 'Y'.            01050000
010600         88  PS-LINE-HAS-DISTRO-NO          VALUE 'N'.            01060000
010700                                                                  01070000
010800     05  PS-DRIVER-LINE-SW       PIC  X(01) VALUE 'N'.            01080000
010900         88  PS-DRIVER-LINE-NO              VALUE 'N'.            01090000
011000         88  PS-DRIVER-LINE-YES             VALUE 'Y'.            01100000
011100                                                                  01110000
011200                                                                  01120000
011300 01  PROGRAM-DB2-KEYS.                                            01130000
011400     05  DK-PO-NBR               PIC S9(09) VALUE +0 COMP.        01140000
011500     05  DK-PO-LNE-NBR           PIC S9(09) VALUE +0 COMP.        01150000
011600     05  DK-PO-LINE-NBR          PIC S9(09) VALUE +0 COMP.        01160000
011700     05  DK-DRIVER-LINE-NBR      PIC S9(09) VALUE +0 COMP.        01170000
011800     05  DK-PO-PREPK-ID          PIC S9(04) VALUE +0 COMP.        01180000
011900     05  DK-STORE-NBR            PIC S9(04) VALUE +0 COMP.        01190000
012000                                                                  01200000
012100                                                                  01210000
012200 01  PROGRAM-LITERALS.                                            01220000
012300     05  PC-CURRENT-PROGRAM-NAME PIC  X(08) VALUE 'RCKCS822'.     01230000
012400     05  PC-A                    PIC  X(01) VALUE 'A'.            01240000
012500     05  PC-B                    PIC  X(01) VALUE 'B'.            01250000
012600     05  PC-I                    PIC  X(01) VALUE 'I'.            01260000
012700     05  PC-M                    PIC  X(01) VALUE 'M'.            01270000
012800     05  PC-N                    PIC  X(01) VALUE 'N'.            01280000
012900     05  PC-Y                    PIC  X(01) VALUE 'Y'.            01290000
013000     05  PC-AC                   PIC  X(02) VALUE 'AC'.           01300000
013100     05  PC-AP                   PIC  X(02) VALUE 'AP'.           01310000
013200     05  PC-CM                   PIC  X(02) VALUE 'CM'.           01320000
013300     05  PC-IP                   PIC  X(02) VALUE 'IP'.           01330000
013400     05  PC-RV                   PIC  X(02) VALUE 'RV'.           01340000
013500     05  PC-VE                   PIC  X(02) VALUE 'VE'.           01350000
013600     05  PC-ONE                  PIC S9(04) VALUE +1   COMP.      01360000
013700     05  PC-MAX-ITEM-LINES       PIC S9(04) VALUE +100 COMP.      01370000
013800     05  PC-MAX-PACK-LINES       PIC S9(04) VALUE +100 COMP.      01380000
013900     05  PC-MAX-STORES           PIC S9(04) VALUE +200 COMP.      01390009
014000                                                                  01400000
014100                                                                  01410000
014200* -------------------------------------------------------------- *01420000
014300*    INPUT/INTERFACE DATA                                         01430000
014400* -------------------------------------------------------------- *01440000
014500                                                                  01450000
014600     COPY RCWS822.                                                01460001
014700                                                                  01470000
014800                                                                  01480000
014900* -------------------------------------------------------------- *01490000
015000*    ABEND AREA                                                   01500000
015100* -------------------------------------------------------------- *01510000
015200                                                                  01520000
015300     COPY DPWS013.                                                01530000
015400                                                                  01540000
015500                                                                  01550000
015600* -------------------------------------------------------------- *01560000
015700*    GLOBAL COMMAREA                                              01570000
015800* -------------------------------------------------------------- *01580000
015900                                                                  01590000
016000     COPY DPWS020.                                                01600000
016100                                                                  01610000
016200                                                                  01620000
016300* -------------------------------------------------------------- *01630000
016400*    DB2 SQL COMMUNICATION AREA                                   01640000
016500* -------------------------------------------------------------- *01650000
016600                                                                  01660000
016700     EXEC SQL                                                     01670000
016800          INCLUDE SQLCA                                           01680000
016900     END-EXEC.                                                    01690000
017000                                                                  01700000
017100                                                                  01710000
017200* -------------------------------------------------------------- *01720000
017300*    DB2 DCLGEN FOR MERCHANDISE STORE ALLOCATION PLAN TABLE       01730000
017400* -------------------------------------------------------------- *01740000
017500                                                                  01750000
017600     EXEC SQL                                                     01760000
017700          INCLUDE TALLPLN                                         01770000
017800     END-EXEC.                                                    01780000
017900                                                                  01790000
018000                                                                  01800000
018100* -------------------------------------------------------------- *01810000
018200*    DB2 DCLGEN FOR MERCHANDISE STORE DISTRIBUTION PLAN TABLE     01820000
018300* -------------------------------------------------------------- *01830000
018400                                                                  01840000
018500     EXEC SQL                                                     01850000
018600          INCLUDE TMESTDS                                         01860000
018700     END-EXEC.                                                    01870000
018800                                                                  01880000
018900                                                                  01890000
019000* -------------------------------------------------------------- *01900000
019100*    DB2 DCLGEN FOR PO PURCHASE ITEM TABLE (PO LINE ITEMS)        01910000
019200* -------------------------------------------------------------- *01920000
019300                                                                  01930000
019400     EXEC SQL                                                     01940000
019500          INCLUDE TPURITM                                         01950000
019600     END-EXEC.                                                    01960000
019700                                                                  01970000
019800                                                                  01980000
019900* -------------------------------------------------------------- *01990000
020000*    DB2 DCLGEN FOR RECEIVER TABLE                                02000000
020100* -------------------------------------------------------------- *02010000
020200                                                                  02020000
020300     EXEC SQL                                                     02030000
020400          INCLUDE TRECEIV                                         02040000
020500     END-EXEC.                                                    02050000
020600                                                                  02060000
020700                                                                  02070000
020800* -------------------------------------------------------------- *02080000
020900*    DB2 DCLGEN FOR RECEIVER ITEM                                 02090000
021000* -------------------------------------------------------------- *02100000
021100                                                                  02110000
021200     EXEC SQL                                                     02120000
021300          INCLUDE TRECITM                                         02130000
021400     END-EXEC.                                                    02140000
021500                                                                  02150000
021600                                                                  02160000
021700* -------------------------------------------------------------- *02170000
021800*    DB2 DCLGEN FOR RECEIVE DISTRIBUTION TABLE                    02180000
021900* -------------------------------------------------------------- *02190000
022000                                                                  02200000
022100     EXEC SQL                                                     02210000
022200          INCLUDE TRECDIS                                         02220000
022300     END-EXEC.                                                    02230000
022400                                                                  02240000
022500                                                                  02250000
022600* -------------------------------------------------------------- *02260000
022700*                   BASE NUMBER CURSORS                          *02270000
022800*                 -----------------------                        *02280000
022900*                                                                *02290000
023000*    THESE CURSORS ARE USED TO POPULATE RC822-STORE-NBR OR       *02300001
023100*    RC822-LINE-NBR AND RC822-STORE-DISTRO-QTY FOR EACH STORE    *02310001
023200*    OR LINE.                                                    *02320000
023300*                                                                *02330000
023400*    SUBTRACTING ALL RECEIPTS FROM THIS WILL GIVE THE OTR.       *02340000
023500* -------------------------------------------------------------- *02350000
023600                                                                  02360000
023700                                                                  02370000
023800* -------------------------------------------------------------- *02380000
023900*    THIS CURSOR IS THE BASIS FOR MASTER PLAN (STORE-LEVEL-OTR)  *02390000
024000* -------------------------------------------------------------- *02400000
024100                                                                  02410000
024200     EXEC SQL                                                     02420000
024300                                                                  02430000
024400         DECLARE STORE-TABLE-CSR CURSOR FOR                       02440000
024500                                                                  02450000
024600           SELECT STR_NBR                                         02460000
024700                , STR_DISTRO_QTY                                  02470000
024800                , ALLOC_SEQ_CDE                                   02480000
024900                , RNK_SEQ_NBR                                     02490000
025000                                                                  02500000
025100           FROM TMESTDS                                           02510000
025200                                                                  02520000
025300           WHERE PO_NBR      =  :RC822-PO-NBR                     02530001
025400             AND PO_LNE_NBR  =  :PURITM-PO-LNE-NBR                02540000
025500             AND PLAN_NBR    =  :ALLPLN-PLAN-NBR                  02550000
025600                                                                  02560000
025700           ORDER BY STR_NBR                                       02570000
025800                                                                  02580000
025900     END-EXEC.                                                    02590000
026000                                                                  02600000
026100                                                                  02610000
026200* -------------------------------------------------------------- *02620000
026300*    THIS CURSOR IS THE BASIS FOR                                *02630000
026400*    RC822-LINE-TABLE (LINE-LEVEL-OTR)                           *02640001
026500* -------------------------------------------------------------- *02650000
026600                                                                  02660000
026700     EXEC SQL                                                     02670000
026800                                                                  02680000
026900         DECLARE PLAN-CSR CURSOR FOR                              02690000
027000                                                                  02700000
027100           SELECT A.PO_LNE_NBR                                    02710000
027200                , A.APP_PO_LNE_NBR                                02720000
027300                , A.PREPK_RATO_QTY                                02730000
027400                                                                  02740000
027500           FROM TPURITM A                                         02750000
027600               ,TRECITM B                                         02760000
027700                                                                  02770000
027800           WHERE  A.PO_NBR           =  :RC822-PO-NBR             02780001
027900             AND  B.ORD_NBR          =   A.PO_NBR                 02790000
028000             AND  B.ORD_LNE_NBR      =   A.APP_PO_LNE_NBR         02800000
028100             AND  OPER_UNT_ID        =  :RC822-OPER-UNT-ID        02810001
028200             AND  REC_SEQ_NBR        =  :RC822-REC-SEQ-NBR        02820001
028300             AND  B.PREPK_ID         =  :DK-PO-PREPK-ID           02830000
028400             AND  A.VER_STATUS_CDE   =  :PC-A                     02840000
028500             AND  A.VER_STATUS_CDE   =   B.VER_STATUS_CDE         02850000
028600             AND  A.STATUS_CDE      IN (:PC-AC,                   02860000
028700                                        :PC-AP,                   02870000
028800                                        :PC-CM,                   02880000
028900                                        :PC-RV)                   02890000
029000                                                                  02900000
029100     END-EXEC.                                                    02910000
029200                                                                  02920000
029300                                                                  02930000
029400* -------------------------------------------------------------- *02940000
029500*    THIS CURSOR IS THE BASIS FOR                                *02950000
029600*    RC822-LINE-TABLE (LINE-LEVEL-OTR)                           *02960001
029700* -------------------------------------------------------------- *02970000
029800                                                                  02980000
029900     EXEC SQL                                                     02990000
030000                                                                  03000000
030100         DECLARE PLAN-LINE-CSR CURSOR FOR                         03010000
030200                                                                  03020000
030300           SELECT A.PO_LNE_NBR                                    03030000
030400                , A.APP_PO_LNE_NBR                                03040000
030500                , A.PREPK_RATO_QTY                                03050000
030600                                                                  03060000
030700           FROM TPURITM A                                         03070000
030800                                                                  03080000
030900           WHERE  A.PO_NBR           =  :RC822-PO-NBR             03090001
031000             AND  A.APP_PO_LNE_NBR   =  :RC822-APP-PO-LNE-NBR     03100001
031100             AND  A.VER_STATUS_CDE   =  :PC-A                     03110000
031200             AND  A.STATUS_CDE      IN (:PC-AC,                   03120000
031300                                        :PC-AP,                   03130000
031400                                        :PC-CM,                   03140000
031500                                        :PC-RV)                   03150000
031600                                                                  03160000
031700     END-EXEC.                                                    03170000
031800                                                                  03180000
031900                                                                  03190000
032000* -------------------------------------------------------------- *03200000
032100*                     RECEIPT CURSORS                            *03210000
032200*                 -----------------------                        *03220000
032300*                                                                *03230000
032400*    THESE CURSORS ARE USED TO RETRIEVE THE PRIOR RECEIPTS       *03240000
032500*    TO BE SUBTRACTED FROM RC822-STORE-OTR-QTY.                  *03250001
032600*                                                                *03260000
032700*    'RECEIVER-LEVEL' PRIOR RECEIPTS ARE DEFINED AS ANY 'VE'     *03270000
032800*    RECEIPT OR 'IP'/'CM' RECEIPT CREATED PRIOR TO THE GIVEN     *03280000
032900*    RECEIVER.                                                   *03290000
033000*                                                                *03300000
033100*    'PO-LEVEL' PRIOR RECEIPTS INCLUDE ALL RECEIPTS INCLUDING    *03310000
033200*    THE GIVEN RECEIVER.                                         *03320000
033300* -------------------------------------------------------------- *03330000
033400                                                                  03340000
033500                                                                  03350000
033600* -------------------------------------------------------------- *03360000
033700*    RECEIVER-LEVEL CURSOR                                       *03370000
033800*                                                                *03380000
033900*    THIS IS A LIST OF RECEIVERS FOR A PO, LINE, AND DC THAT ARE *03390000
034000*    EITHER VERIFIED OR HAD BEEN CREATED PRIOR TO THE CURRENT    *03400000
034100*    DATE AND TIME.  USED IN PARAGRAPH 1300-                     *03410000
034200* -------------------------------------------------------------- *03420000
034300                                                                  03430000
034400     EXEC SQL                                                     03440000
034500                                                                  03450000
034600         DECLARE REC-LVL-CSR CURSOR FOR                           03460000
034700                                                                  03470000
034800           SELECT REC_SEQ_NBR                                     03480000
034900                , STATUS_CDE                                      03490000
035000                , PREPK_RATO_QTY                                  03500000
035100                                                                  03510000
035200           FROM TRECITM                                           03520000
035300                                                                  03530000
035400           WHERE  ORD_NBR         =  :RC822-PO-NBR                03540001
035500             AND  ORD_LNE_NBR     =  :DK-PO-LNE-NBR               03550000
035600             AND  OPER_UNT_ID     =  :RC822-OPER-UNT-ID           03560001
035700             AND  REC_SEQ_NBR    ^=  :RC822-REC-SEQ-NBR           03570001
035800             AND  VER_STATUS_CDE  =  :PC-A                        03580000
035900             AND (CRE_TMST       <=  :RECITM-CRE-TMST             03590000
036000              OR  STATUS_CDE      =  :PC-VE)                      03600000
036100                                                                  03610000
036200           ORDER BY REC_SEQ_NBR                                   03620000
036300                                                                  03630000
036400     END-EXEC.                                                    03640000
036500                                                                  03650000
036600                                                                  03660000
036700* -------------------------------------------------------------- *03670000
036800*    PO-LEVEL CURSOR                                             *03680000
036900*                                                                *03690000
037000*    THIS IS A LIST OF RECEIVERS AND THEIR STATUSES FOR A PO,    *03700000
037100*    LINE AND DC REGARDLESS OF CREATION TIME.                    *03710000
037200* -------------------------------------------------------------- *03720000
037300                                                                  03730000
037400     EXEC SQL                                                     03740000
037500                                                                  03750000
037600         DECLARE PO-LVL-CSR CURSOR FOR                            03760000
037700                                                                  03770000
037800           SELECT REC_SEQ_NBR                                     03780000
037900                , STATUS_CDE                                      03790000
038000                , PREPK_RATO_QTY                                  03800000
038100                                                                  03810000
038200           FROM TRECITM                                           03820000
038300                                                                  03830000
038400           WHERE ORD_NBR          =  :RC822-PO-NBR                03840001
038500             AND ORD_LNE_NBR      =  :DK-PO-LNE-NBR               03850000
038600             AND OPER_UNT_ID      =  :RC822-OPER-UNT-ID           03860001
038700             AND VER_STATUS_CDE   =  :PC-A                        03870000
038800             AND STATUS_CDE      IN (:PC-IP,                      03880000
038900                                     :PC-CM,                      03890000
039000                                     :PC-VE)                      03900000
039100           ORDER BY REC_SEQ_NBR                                   03910000
039200                                                                  03920000
039300     END-EXEC.                                                    03930000
039400                                                                  03940000
039500                                                                  03950000
039600*------------------------*                                        03960000
039700 LINKAGE SECTION.                                                 03970000
039800*------------------------*                                        03980000
039900                                                                  03990000
040000 01  DFHCOMMAREA.                                                 04000000
040100     05  FILLER                  OCCURS 18000 TIMES               04010003
040200                                 DEPENDING ON EIBCALEN.           04020000
040300         10  FILLER              PIC X.                           04030000
040400                                                                  04040000
040500                                                                  04050000
040600*------------------------------------------*                      04060000
040700 PROCEDURE DIVISION  USING DFHCOMMAREA.                           04070000
040800*------------------------------------------*                      04080000
040900                                                                  04090000
041000 0001-MAIN-LINE.                                                  04100000
041100                                                                  04110000
041200     MOVE DFHCOMMAREA TO RC822-COMMAREA.                          04120001
041300                                                                  04130000
041400     SET PS-ERRORS-NO TO TRUE.                                    04140000
041500                                                                  04150000
041600     IF RC822-STORE-LEVEL-OTR                                     04160001
041601         IF RC822-PREPACK-PACKAGE AND RC822-PO-PREPK-ID > 0       04160104
041602             PERFORM 0100-VERIFY-STORE-OTR                        04160203
041603         END-IF                                                   04160304
041604     END-IF.                                                      04160404
041605                                                                  04160504
041606                                                                  04160604
041607     EVALUATE TRUE                                                04160704
041608                                                                  04160804
041609       WHEN RC822-STORE-LEVEL-OTR                                 04160904
041610           PERFORM 1000-STORE-LEVEL-OTR                           04161004
041620                                                                  04162004
041630       WHEN RC822-LINE-LEVEL-OTR                                  04163004
041640           PERFORM 2000-LINE-LEVEL-OTR                            04164004
041650                                                                  04165004
041660       WHEN OTHER                                                 04166004
041670           STRING ' INVALID OTR TYPE ' '(' RC822-OTR-TYPE ')'     04167004
041680               DELIMITED BY SIZE INTO PV-RETURN-MSG               04168004
041690           MOVE 2 TO RC822-RETURN-CODE                            04169004
041700           PERFORM DP013-0000-PROCESS-ABEND                       04170004
041800                                                                  04180004
041900     END-EVALUATE.                                                04190004
042000                                                                  04200004
042100                                                                  04210004
042200     PERFORM 0200-STORE-OTR-ROUTINE                               04220004
042300       VARYING RC822-STORE-IDX FROM 1 BY 1                        04230004
042400         UNTIL RC822-STORE-NBR (RC822-STORE-IDX) EQUAL ZERO       04240004
042500          OR   RC822-STORE-IDX > PC-MAX-STORES.                   04250004
042600                                                                  04260004
042700     PERFORM 0300-LINE-OTR-ROUTINE                                04270004
042800       VARYING RC822-ITEM-IDX FROM 1 BY 1                         04280004
042900         UNTIL RC822-LINE-NBR (RC822-ITEM-IDX) EQUAL ZERO         04290004
043000          OR   RC822-ITEM-IDX > PC-MAX-ITEM-LINES.                04300004
043100                                                                  04310004
043200     IF RC822-LINE-LEVEL-OTR                                      04320004
043310         IF RC822-PREPACK-PACKAGE                                 04331008
043320           AND RC822-PO-PREPK-ID > 0                              04332008
043330           AND RC822-PO-PREPK-ID NOT = 99                         04333008
043400             PERFORM 8020-VERIFY-PLAN-ALLOCATION                  04340004
043500         END-IF                                                   04350004
043600     END-IF.                                                      04360004
043700                                                                  04370004
043800     MOVE RC822-COMMAREA TO DFHCOMMAREA.                          04380004
043900                                                                  04390004
044000     GOBACK.                                                      04400004
044100                                                                  04410004
044200                                                                  04420004
044300* -------------------------------------------------------------- *04430004
044400* -------------------------------------------------------------- *04440004
044500                                                                  04450004
044600 0100-VERIFY-STORE-OTR.                                           04460004
044700                                                                  04470004
044800     PERFORM 8000-FETCH-DRIVER-LINE.                              04480004
044900                                                                  04490004
045000     IF RC822-APP-PO-LNE-NBR EQUAL RECITM-ORD-LNE-NBR             04500004
045100         CONTINUE                                                 04510004
045200     ELSE                                                         04520004
045300         MOVE RC822-APP-PO-LNE-NBR TO PV-DISP-PO-LNE-NBR          04530004
045400         STRING ' INVALID PO LINE NBR ' '(' PV-DISP-PO-LNE-NBR ')'04540004
045500           DELIMITED BY SIZE INTO PV-RETURN-MSG                   04550004
045600         MOVE 1 TO RC822-RETURN-CODE                              04560004
045700         PERFORM DP013-0000-PROCESS-ABEND                         04570004
045800     END-IF.                                                      04580004
045900                                                                  04590004
046000                                                                  04600004
046100* -------------------------------------------------------------- *04610004
046200* -------------------------------------------------------------- *04620004
046300                                                                  04630004
046400 0200-STORE-OTR-ROUTINE.                                          04640004
046500                                                                  04650004
046610     IF RC822-PREPACK-PACKAGE AND RC822-PO-PREPK-ID > 0           04661004
046700                                                                  04670004
046800         MOVE RC822-STORE-OTR-PK        (RC822-STORE-IDX)         04680004
046900           TO RC822-STORE-DISTRO-OTR-PK (RC822-STORE-IDX)         04690004
047000                                                                  04700004
047100         IF RC822-STORE-OTR-PK (RC822-STORE-IDX) < +0             04710004
047200             MOVE +0 TO RC822-STORE-OTR-PK (RC822-STORE-IDX)      04720004
047300         END-IF                                                   04730004
047400                                                                  04740004
047500     END-IF.                                                      04750004
047600                                                                  04760004
047700     MOVE RC822-STORE-OTR-QTY    (RC822-STORE-IDX)                04770004
047800       TO RC822-STORE-DISTRO-OTR (RC822-STORE-IDX)                04780004
047900          PV-DISPLAY-QTY.                                         04790004
048000                                                                  04800004
048100     IF RC822-STORE-OTR-QTY (RC822-STORE-IDX) < +0                04810004
048200         MOVE +0 TO RC822-STORE-OTR-QTY (RC822-STORE-IDX)         04820004
048300     END-IF.                                                      04830004
048400                                                                  04840004
048500     MOVE PV-DISPLAY-QTY TO RC822-STORE-DISTRO-OTR-X              04850004
048600                           (RC822-STORE-IDX).                     04860004
048700                                                                  04870004
048800                                                                  04880004
048900* -------------------------------------------------------------- *04890004
049000* -------------------------------------------------------------- *04900004
049100                                                                  04910004
049200 0300-LINE-OTR-ROUTINE.                                           04920004
049300                                                                  04930004
049400     MOVE RC822-LINE-OTR-QTY    (RC822-ITEM-IDX)                  04940004
049500       TO RC822-LINE-DISTRO-OTR (RC822-ITEM-IDX).                 04950004
049600                                                                  04960004
049700     IF RC822-LINE-OTR-QTY (RC822-ITEM-IDX) < +0                  04970004
049800         MOVE +0 TO RC822-LINE-OTR-QTY (RC822-ITEM-IDX)           04980004
049900     END-IF.                                                      04990004
050000                                                                  05000004
050010                                                                  05001004
050020* -------------------------------------------------------------- *05002004
050030* -------------------------------------------------------------- *05003004
050040                                                                  05004004
050050 1000-STORE-LEVEL-OTR.                                            05005004
050060                                                                  05006004
050070*    --------------------------                                   05007004
050080*    GET PURITM LINE NUMBER.                                      05008004
050090*    --------------------------                                   05009004
050100                                                                  05010004
050200     MOVE RC822-PO-NBR          TO DK-PO-NBR.                     05020004
050300     MOVE RC822-APP-PO-LNE-NBR  TO DK-PO-LNE-NBR.                 05030004
050400     MOVE RC822-PO-PREPK-ID     TO DK-PO-PREPK-ID.                05040004
050500                                                                  05050004
050600     PERFORM 1120-GET-TPURITM-RECORD.                             05060004
050700                                                                  05070004
050800                                                                  05080004
050900*    --------------------------                                   05090004
051000*    GET APPROVED LINE NUMBER.                                    05100004
051100*    --------------------------                                   05110004
051200                                                                  05120004
051300     MOVE PURITM-PO-LNE-NBR TO DK-PO-LNE-NBR.                     05130004
051400                                                                  05140004
051500     PERFORM 1100-GET-APP-LINE-NBR.                               05150004
051600                                                                  05160004
051700*    ----------                                                   05170004
051800*    GET PLAN.                                                    05180004
051900*    ----------                                                   05190004
052000                                                                  05200004
052100     IF PS-ERRORS-NO                                              05210004
052200         PERFORM 1110-GET-TALLPLN                                 05220004
052300         MOVE ALLPLN-PLAN-NBR           TO RC822-PLAN-NBR         05230004
052400         MOVE ALLPLN-CURR-SPLIT-QTY     TO RC822-CURR-SPLIT-QTY   05240004
052500         MOVE ALLPLN-ALLOC-OUTR-PK-QTY  TO RC822-ALLOC-OUTR-PK-QTY05250004
052600         MOVE ALLPLN-PK-SIZE-RND-CDE    TO RC822-PK-SIZE-RND-CDE  05260004
052700         MOVE ALLPLN-SHTG-PRRT-OPT-CDE  TO RC822-SHORT-PRORATE-CDE05270004
052800         MOVE ALLPLN-OVRG-PRRT-OPT-CDE  TO RC822-OVER-PRORATE-CDE 05280004
052900         MOVE ALLPLN-EXST-SHTG-THRS-IND TO RC822-USE-EX-RULES-IND 05290004
053010         IF RC822-PREPACK-PACKAGE AND RC822-PO-PREPK-ID > 0       05301004
053020         IF PV-PURITM-RATO-QTY > +0                               05302006
053100             DIVIDE RC822-CURR-SPLIT-QTY  BY PV-PURITM-RATO-QTY   05310004
053200               GIVING RC822-CURR-SPLIT-PK                         05320004
053300         END-IF                                                   05330004
053310         END-IF                                                   05331006
053400     ELSE                                                         05340004
053500         INITIALIZE DCLTALLPLN                                    05350004
053600                    PV-ALLPLN-SPLIT-QTY-PK                        05360004
053700     END-IF.                                                      05370004
053800                                                                  05380004
053900*    -----------------------------------------                    05390004
054000*    MOVE ORIGINAL LINE NUMBER BACK INTO KEY.                     05400004
054100*    -----------------------------------------                    05410004
054200                                                                  05420004
054300     MOVE RC822-APP-PO-LNE-NBR  TO DK-PO-LNE-NBR.                 05430004
054400                                                                  05440004
054500*    -----------------                                            05450004
054600*    LOAD STORE TABLE.                                            05460004
054700*    -----------------                                            05470004
054800                                                                  05480004
054900     IF PS-ERRORS-NO                                              05490004
055000         PERFORM 1200-FILL-BASE-NUMBERS                           05500004
055100     END-IF.                                                      05510004
055200                                                                  05520004
055300*    --------------                                               05530004
055400*    DETERMINE OTR.                                               05540004
055500*    --------------                                               05550004
055600                                                                  05560004
055700     IF PS-ERRORS-NO        AND                                   05570004
055800        PS-LINE-HAS-DISTRO-YES                                    05580004
055900                                                                  05590004
056000         EVALUATE TRUE                                            05600004
056100                                                                  05610004
056200           WHEN RC822-RECEIVER-OTR                                05620004
056300               PERFORM 1300-RCVR-OTR                              05630004
056400                                                                  05640004
056500           WHEN RC822-PO-OTR                                      05650004
056600               PERFORM 1400-PO-OTR                                05660004
056700                                                                  05670004
056800           WHEN OTHER                                             05680004
056900               STRING ' INVALID OTR SCOPE FLAG '                  05690004
057000                      '(' RC822-OTR-SCOPE ')'                     05700004
057100                   DELIMITED BY SIZE INTO PV-RETURN-MSG           05710004
057200               MOVE 3 TO RC822-RETURN-CODE                        05720004
057300               PERFORM DP013-0000-PROCESS-ABEND                   05730004
057400                                                                  05740004
057500         END-EVALUATE                                             05750004
057600     END-IF.                                                      05760004
057700                                                                  05770004
057800                                                                  05780004
057900* -------------------------------------------------------------- *05790004
058000*    THE APP LINE NUMBER MAY NOT BE THE SAME AS THE KEY LINE      05800004
058100*    NUMBER DUE TO PO LINES BEING DELETED. THE RECEIVING SYSTEM   05810004
058200*    IS KEYED BY THE APPROVED LINE NUMBER. THE PO SYSTEM IS       05820004
058300*    KEYED BY THE LINE NUMBER IN THE KEY.                         05830004
058400* -------------------------------------------------------------- *05840004
058500                                                                  05850004
058600 1100-GET-APP-LINE-NBR.                                           05860004
058700                                                                  05870004
058800     EXEC SQL                                                     05880004
058900                                                                  05890004
059000         SELECT A.APP_PO_LNE_NBR                                  05900004
059100              , A.PREPK_RATO_QTY                                  05910004
059200                                                                  05920004
059300           INTO :PV-APP-LINE-NBR                                  05930004
059400              , :PV-PURITM-RATO-QTY                               05940004
059500                                                                  05950004
059600         FROM TPURITM A                                           05960004
059700                                                                  05970004
059800         WHERE   A.PO_NBR          =  :DK-PO-NBR                  05980004
059900           AND   A.VER_STATUS_CDE  =  :PC-A                       05990004
060000                                                                  06000004
060100           AND ((A.PO_PREPK_ID     =  :DK-PO-PREPK-ID AND         06010004
060200                :DK-PO-PREPK-ID    >   0              AND         06020004
060210                :DK-PO-PREPK-ID    <>  99             AND         06021005
060300                 A.PO_LNE_NBR      =  :DK-PO-LNE-NBR)             06030004
060400                                                                  06040004
060500             OR (A.PO_LNE_NBR      =  :DK-PO-LNE-NBR  AND         06050004
060600                :DK-PO-PREPK-ID    =   0)                         06060005
060610                                                                  06061005
060620             OR (A.PO_LNE_NBR      =  :DK-PO-LNE-NBR  AND         06062005
060630                :DK-PO-PREPK-ID    =   99))                       06063005
060700                                                                  06070004
060800     END-EXEC.                                                    06080004
060900                                                                  06090004
061000                                                                  06100004
061100     EVALUATE SQLCODE                                             06110004
061200                                                                  06120004
061300       WHEN +0                                                    06130004
061400           IF DK-PO-PREPK-ID EQUAL ZERO                           06140004
061500               MOVE +1 TO PV-PURITM-RATO-QTY                      06150004
061600           END-IF                                                 06160004
061700                                                                  06170004
061800       WHEN -904                                                  06180004
061900       WHEN -911                                                  06190004
062000       WHEN -913                                                  06200004
062100           MOVE 4  TO RC822-RETURN-CODE                           06210004
062200           PERFORM 9900-SOFT-ABORT                                06220004
062300                                                                  06230004
062400       WHEN OTHER                                                 06240004
062500           MOVE 5  TO RC822-RETURN-CODE                           06250004
062600           PERFORM 9800-PGM-ABEND                                 06260004
062700                                                                  06270004
062800     END-EVALUATE.                                                06280004
062900                                                                  06290004
063000                                                                  06300004
063100* -------------------------------------------------------------- *06310004
063200* -------------------------------------------------------------- *06320004
063300                                                                  06330004
063400 1110-GET-TALLPLN.                                                06340004
063500                                                                  06350004
063600     INITIALIZE DCLTALLPLN.                                       06360004
063700                                                                  06370004
063800     EXEC SQL                                                     06380004
063900                                                                  06390004
064000         SELECT PLAN_NBR                                          06400004
064100              , CURR_SPLIT_QTY                                    06410004
064200              , ALLOC_OUTR_PK_QTY                                 06420004
064300              , PK_SIZE_RND_CDE                                   06430004
064400              , SHTG_PRRT_OPT_CDE                                 06440004
064500              , OVRG_PRRT_OPT_CDE                                 06450004
064600              , EXST_SHTG_THRS_IND                                06460004
064700                                                                  06470004
064800           INTO :ALLPLN-PLAN-NBR                                  06480004
064900              , :ALLPLN-CURR-SPLIT-QTY                            06490004
065000              , :ALLPLN-ALLOC-OUTR-PK-QTY                         06500004
065100              , :ALLPLN-PK-SIZE-RND-CDE                           06510004
065200              , :ALLPLN-SHTG-PRRT-OPT-CDE                         06520004
065300              , :ALLPLN-OVRG-PRRT-OPT-CDE                         06530004
065400              , :ALLPLN-EXST-SHTG-THRS-IND                        06540004
065500                                                                  06550004
065600         FROM TALLPLN                                             06560004
065700                                                                  06570004
065800         WHERE PO_NBR      =  :DK-PO-NBR                          06580004
065900           AND PO_LNE_NBR  =  :DK-PO-LNE-NBR                      06590004
066000           AND DEST_NBR    =  :RC822-OPER-UNT-ID                  06600004
066100                                                                  06610004
066200     END-EXEC.                                                    06620004
066300                                                                  06630004
066400                                                                  06640004
066500     EVALUATE SQLCODE                                             06650004
066600                                                                  06660004
066700       WHEN +0                                                    06670004
066800           SET PS-LINE-HAS-DISTRO-YES TO TRUE                     06680004
066900                                                                  06690004
067000*          ---------------------------                            06700004
067100*          CALCULATE PACKS FROM UNITS.                            06710004
067200*          ---------------------------                            06720004
067300                                                                  06730004
067400           IF PV-PURITM-RATO-QTY > +0                             06740004
067500               DIVIDE ALLPLN-CURR-SPLIT-QTY BY PV-PURITM-RATO-QTY 06750004
067600                 GIVING PV-ALLPLN-SPLIT-QTY-PK                    06760004
067700           ELSE                                                   06770004
067800               MOVE ZERO TO PV-ALLPLN-SPLIT-QTY-PK                06780004
067900               SET  RC822-INVALID-DISTRO TO TRUE                  06790004
068000           END-IF                                                 06800004
068100                                                                  06810004
068200       WHEN +100                                                  06820004
068300           SET PS-LINE-HAS-DISTRO-NO TO TRUE                      06830004
068400           MOVE 6 TO RC822-RETURN-CODE                            06840004
068500           PERFORM 9000-NO-DISTRO-ERROR                           06850004
068600                                                                  06860004
068700       WHEN -904                                                  06870004
068800       WHEN -911                                                  06880004
068900       WHEN -913                                                  06890004
069000           MOVE 7 TO RC822-RETURN-CODE                            06900004
069100           PERFORM 9900-SOFT-ABORT                                06910004
069200                                                                  06920004
069300       WHEN OTHER                                                 06930004
069400           MOVE 8 TO RC822-RETURN-CODE                            06940004
069500           PERFORM 9800-PGM-ABEND                                 06950004
069600                                                                  06960004
069700     END-EVALUATE.                                                06970004
069800                                                                  06980004
069900                                                                  06990004
070000* -------------------------------------------------------------- *07000004
070100*    THIS PARAGRAPH RETRIEVES A RECORD FROM TABLE TPURITM.        07010004
070200* -------------------------------------------------------------- *07020004
070300                                                                  07030004
070400 1120-GET-TPURITM-RECORD.                                         07040004
070500                                                                  07050004
070600     EXEC SQL                                                     07060004
070700                                                                  07070004
070800          SELECT PO_LNE_NBR                                       07080004
070900                                                                  07090004
071000            INTO :PURITM-PO-LNE-NBR                               07100004
071100                                                                  07110004
071200          FROM TPURITM                                            07120004
071300                                                                  07130004
071400          WHERE PO_NBR          =  :DK-PO-NBR                     07140004
071500            AND APP_PO_LNE_NBR  =  :DK-PO-LNE-NBR                 07150004
071600            AND VER_STATUS_CDE  =  :PC-A                          07160004
071700                                                                  07170004
071800     END-EXEC.                                                    07180004
071900                                                                  07190004
072000                                                                  07200004
072100     EVALUATE SQLCODE                                             07210004
072200                                                                  07220004
072300       WHEN +0                                                    07230004
072400           CONTINUE                                               07240004
072500                                                                  07250004
072600       WHEN -904                                                  07260004
072700       WHEN -911                                                  07270004
072800       WHEN -913                                                  07280004
072900           MOVE 9 TO RC822-RETURN-CODE                            07290004
073000           PERFORM 9900-SOFT-ABORT                                07300004
073100                                                                  07310004
073200       WHEN OTHER                                                 07320004
073300           MOVE 10 TO RC822-RETURN-CODE                           07330004
073400           PERFORM 9800-PGM-ABEND                                 07340004
073500                                                                  07350004
073600     END-EVALUATE.                                                07360004
073700                                                                  07370004
073800                                                                  07380004
073900* -------------------------------------------------------------- *07390004
074000* -------------------------------------------------------------- *07400004
074100                                                                  07410004
074200 1200-FILL-BASE-NUMBERS.                                          07420004
074300                                                                  07430004
074400     PERFORM 1210-OPEN-STORE-TABLE-CSR.                           07440004
074500                                                                  07450004
074600*    ----------------------------                                 07460004
074700*    GET FIRST STORE TABLE ENTRY.                                 07470004
074800*    ----------------------------                                 07480004
074900                                                                  07490004
075000     IF PS-ERRORS-NO      AND                                     07500004
075100        PS-LINE-HAS-DISTRO-YES                                    07510004
075200         PERFORM 1220-FETCH-STORE-TABLE-CSR                       07520004
075300         IF PS-BASE-CSR-EOF                                       07530004
075400             SET PS-ERRORS-YES                                    07540004
075500                 PS-LINE-HAS-DISTRO-NO TO TRUE                    07550004
075600             MOVE 11 TO RC822-RETURN-CODE                         07560004
075700             PERFORM 9000-NO-DISTRO-ERROR                         07570004
075800         END-IF                                                   07580004
075900     END-IF.                                                      07590004
076000                                                                  07600004
076100*    --------------------------------------                       07610004
076200*    LOOP THRU ALL MESTDS & LOAD TO TABLE.                        07620004
076300*    --------------------------------------                       07630004
076400                                                                  07640004
076500     IF PS-ERRORS-NO   AND                                        07650004
076600        PS-LINE-HAS-DISTRO-YES                                    07660004
076700         PERFORM 1230-LOAD-TO-STR-TABLE                           07670004
076800           VARYING RC822-STORE-IDX FROM 1 BY 1                    07680004
076900             UNTIL PS-BASE-CSR-EOF                                07690004
077000               OR  PS-ERRORS-YES                                  07700004
077100               OR  RC822-STORE-IDX > PC-MAX-STORES                07710004
077200     END-IF.                                                      07720004
077300                                                                  07730004
077400     IF PS-CURSOR-OPEN                                            07740004
077500         PERFORM 1240-CLOSE-STORE-TABLE-CSR                       07750004
077600     END-IF.                                                      07760004
077700                                                                  07770004
077800                                                                  07780004
077900* -------------------------------------------------------------- *07790004
078000* -------------------------------------------------------------- *07800004
078100                                                                  07810004
078200 1210-OPEN-STORE-TABLE-CSR.                                       07820004
078300                                                                  07830004
078400     EXEC SQL                                                     07840004
078500         OPEN STORE-TABLE-CSR                                     07850004
078600     END-EXEC.                                                    07860004
078700                                                                  07870004
078800                                                                  07880004
078900     EVALUATE SQLCODE                                             07890004
079000                                                                  07900004
079100       WHEN +0                                                    07910004
079200           SET PS-CURSOR-OPEN TO TRUE                             07920004
079300                                                                  07930004
079400       WHEN -904                                                  07940004
079500       WHEN -911                                                  07950004
079600       WHEN -913                                                  07960004
079700           SET PS-CURSOR-CLOSED TO TRUE                           07970004
079800           MOVE 12 TO RC822-RETURN-CODE                           07980004
079900           PERFORM 9900-SOFT-ABORT                                07990004
080000                                                                  08000004
080100       WHEN OTHER                                                 08010004
080200           SET PS-CURSOR-CLOSED                                   08020004
080300               PS-LINE-HAS-DISTRO-NO TO TRUE                      08030004
080400           MOVE 13 TO RC822-RETURN-CODE                           08040004
080500           PERFORM 9000-NO-DISTRO-ERROR                           08050004
080600                                                                  08060004
080700     END-EVALUATE.                                                08070004
080800                                                                  08080004
080900                                                                  08090004
081000* -------------------------------------------------------------- *08100004
081100* -------------------------------------------------------------- *08110004
081200                                                                  08120004
081300 1220-FETCH-STORE-TABLE-CSR.                                      08130004
081400                                                                  08140004
081500                                                                  08150004
081600     EXEC SQL                                                     08160004
081700                                                                  08170004
081800         FETCH STORE-TABLE-CSR                                    08180004
081900                                                                  08190004
082000          INTO :MESTDS-STR-NBR                                    08200004
082100             , :MESTDS-STR-DISTRO-QTY                             08210004
082200             , :MESTDS-ALLOC-SEQ-CDE                              08220004
082300             , :MESTDS-RNK-SEQ-NBR                                08230004
082400                                                                  08240004
082500     END-EXEC.                                                    08250004
082600                                                                  08260004
082700                                                                  08270004
082800     EVALUATE SQLCODE                                             08280004
082900                                                                  08290004
083000       WHEN +0                                                    08300004
083100           ADD MESTDS-STR-DISTRO-QTY TO RC822-SUM-STR-PLAN-QTY    08310004
083200                                        RC822-SUM-STR-OTR-QTY     08320004
083300                                                                  08330004
083400       WHEN +100                                                  08340004
083500           SET PS-BASE-CSR-EOF TO TRUE                            08350004
083600                                                                  08360004
083700       WHEN OTHER                                                 08370004
083800           MOVE 14 TO RC822-RETURN-CODE                           08380004
083900           PERFORM 9000-NO-DISTRO-ERROR                           08390004
084000                                                                  08400004
084100     END-EVALUATE.                                                08410004
084200                                                                  08420004
084300                                                                  08430004
084400* -------------------------------------------------------------- *08440004
084500* -------------------------------------------------------------- *08450004
084600                                                                  08460004
084700 1230-LOAD-TO-STR-TABLE.                                          08470004
084800                                                                  08480004
084900     MOVE MESTDS-STR-NBR                                          08490004
085000       TO RC822-STORE-NBR          (RC822-STORE-IDX).             08500004
085100                                                                  08510004
085200     MOVE MESTDS-RNK-SEQ-NBR                                      08520004
085300       TO RC822-STORE-RNK-SEQ-NBR  (RC822-STORE-IDX).             08530004
085400                                                                  08540004
085500     MOVE MESTDS-STR-DISTRO-QTY                                   08550004
085600       TO RC822-STORE-DISTRO-QTY   (RC822-STORE-IDX)              08560004
085700          RC822-STORE-OTR-QTY      (RC822-STORE-IDX)              08570004
085800          PV-DISPLAY-QTY.                                         08580004
085900                                                                  08590004
086000     MOVE PV-DISPLAY-QTY                                          08600004
086100       TO RC822-STORE-DISTRO-QTY-X (RC822-STORE-IDX)              08610004
086200          RC822-STORE-OTR-QTY-X    (RC822-STORE-IDX).             08620004
086300                                                                  08630004
086400*    -------------------------------------                        08640004
086500*    CALCULATE PACKS FROM UNITS IF PREPACK                        08650004
086600*    -------------------------------------                        08660004
086700                                                                  08670004
086810     IF RC822-PREPACK-PACKAGE AND RC822-PO-PREPK-ID > 0           08681004
086900         IF PV-PURITM-RATO-QTY > +0                               08690004
087000             DIVIDE MESTDS-STR-DISTRO-QTY  BY  PV-PURITM-RATO-QTY 08700004
087100               GIVING  RC822-STORE-DISTRO-PK (RC822-STORE-IDX)    08710004
087200             MOVE RC822-STORE-DISTRO-PK     (RC822-STORE-IDX)     08720004
087300               TO RC822-STORE-OTR-PK        (RC822-STORE-IDX)     08730004
087400             ADD  RC822-STORE-DISTRO-PK     (RC822-STORE-IDX)     08740004
087500              TO  RC822-SUM-STR-PLAN-PK                           08750004
087600             ADD  RC822-STORE-OTR-PK        (RC822-STORE-IDX)     08760004
087700              TO  RC822-SUM-STR-OTR-PK                            08770004
087800         ELSE                                                     08780004
087900             MOVE ALL '*'                                         08790004
088000               TO RC822-STORE-DISTRO-PK-X (RC822-STORE-IDX)       08800004
088100         END-IF                                                   08810004
088200     END-IF.                                                      08820004
088300                                                                  08830004
088400     PERFORM 1220-FETCH-STORE-TABLE-CSR.                          08840004
088500                                                                  08850004
088600                                                                  08860004
088700* -------------------------------------------------------------- *08870004
088800* -------------------------------------------------------------- *08880004
088900                                                                  08890004
089000 1240-CLOSE-STORE-TABLE-CSR.                                      08900004
089100                                                                  08910004
089200     EXEC SQL                                                     08920004
089300         CLOSE STORE-TABLE-CSR                                    08930004
089400     END-EXEC.                                                    08940004
089500                                                                  08950004
089600                                                                  08960004
089700     EVALUATE SQLCODE                                             08970004
089800                                                                  08980004
089900       WHEN +0                                                    08990004
090000           SET PS-CURSOR-CLOSED TO TRUE                           09000004
090100                                                                  09010004
090200       WHEN OTHER                                                 09020004
090300           MOVE 15 TO RC822-RETURN-CODE                           09030004
090400           PERFORM 9000-NO-DISTRO-ERROR                           09040004
090500                                                                  09050004
090600     END-EVALUATE.                                                09060004
090700                                                                  09070004
090800                                                                  09080004
090900* -------------------------------------------------------------- *09090004
091000*    RECEIVER OTR AT THE STORE LEVEL                              09100004
091100* -------------------------------------------------------------- *09110004
091200                                                                  09120004
091300 1300-RCVR-OTR.                                                   09130004
091400                                                                  09140004
091500     MOVE PV-APP-LINE-NBR TO DK-PO-LNE-NBR.                       09150004
091600                                                                  09160004
091700     PERFORM 7000-GET-RECITM-TMST.                                09170004
091800                                                                  09180004
091900     IF PS-ERRORS-NO                                              09190004
092000         PERFORM 7100-OPEN-RECITM-CURSOR                          09200004
092100     END-IF.                                                      09210004
092200                                                                  09220004
092300     IF PS-ERRORS-NO                                              09230004
092400         PERFORM 7110-FETCH-RECITM-CURSOR                         09240004
092500     END-IF.                                                      09250004
092600                                                                  09260004
092700     IF PS-PRIOR-CURSOR-EOF                                       09270004
092800         SET PS-ERRORS-YES TO TRUE                                09280004
092900     END-IF.                                                      09290004
093000                                                                  09300004
093100     IF PS-ERRORS-NO                                              09310004
093200         PERFORM 4000-PROCESS-RECITM-CURSOR                       09320004
093300           UNTIL PS-PRIOR-CURSOR-EOF                              09330004
093400              OR PS-ERRORS-YES                                    09340004
093500     END-IF.                                                      09350004
093600                                                                  09360004
093700     IF PS-CURSOR-OPEN                                            09370004
093800         PERFORM 7120-CLOSE-RECITM-CURSOR                         09380004
093900     END-IF.                                                      09390004
094000                                                                  09400004
094100                                                                  09410004
094200* -------------------------------------------------------------- *09420004
094300*    PO OTR AT THE STORE LEVEL                                    09430004
094400* -------------------------------------------------------------- *09440004
094500                                                                  09450004
094600 1400-PO-OTR.                                                     09460004
094700                                                                  09470004
094800     IF PS-ERRORS-NO                                              09480004
094900         MOVE PV-APP-LINE-NBR TO DK-PO-LNE-NBR                    09490004
095000         PERFORM 7200-OPEN-RECITM-CURSOR                          09500004
095100     END-IF.                                                      09510004
095200                                                                  09520004
095300     IF PS-ERRORS-NO                                              09530004
095400         PERFORM 7210-FETCH-RECITM-CURSOR                         09540004
095500     END-IF.                                                      09550004
095600                                                                  09560004
095700     IF PS-ERRORS-NO                                              09570004
095800         PERFORM 4000-PROCESS-RECITM-CURSOR                       09580004
095900           UNTIL PS-PRIOR-CURSOR-EOF                              09590004
096000              OR PS-ERRORS-YES                                    09600004
096100     END-IF.                                                      09610004
096200                                                                  09620004
096300     IF PS-CURSOR-OPEN                                            09630004
096400         PERFORM 7220-CLOSE-RECITM-CURSOR                         09640004
096500     END-IF.                                                      09650004
096600                                                                  09660004
096700                                                                  09670004
096800* -------------------------------------------------------------- *09680004
096900* -------------------------------------------------------------- *09690004
097000                                                                  09700004
097100 2000-LINE-LEVEL-OTR.                                             09710004
097200                                                                  09720004
097300     MOVE RC822-PO-PREPK-ID TO DK-PO-PREPK-ID.                    09730004
097400                                                                  09740004
097500     IF PS-ERRORS-NO                                              09750004
097600         PERFORM 2100-FILL-BASE-NUMBERS                           09760004
097700     END-IF.                                                      09770004
097800                                                                  09780004
097900     IF PS-ERRORS-NO                                              09790004
098000                                                                  09800004
098100         EVALUATE TRUE                                            09810004
098200                                                                  09820004
098300           WHEN RC822-RECEIVER-OTR                                09830004
098400               PERFORM 2200-PROCESS-RCVR-OTR-RCPTS                09840004
098500                 VARYING RC822-ITEM-IDX FROM 1 BY 1               09850004
098600                   UNTIL RC822-LINE-NBR (RC822-ITEM-IDX) = ZERO   09860004
098700                      OR RC822-FATAL-ERROR                        09870004
098800                                                                  09880004
098900           WHEN RC822-PO-OTR                                      09890004
099000               PERFORM 2300-PROCESS-PO-OTR-RCPTS                  09900004
099100                 VARYING RC822-ITEM-IDX FROM 1 BY 1               09910004
099200                   UNTIL RC822-LINE-NBR (RC822-ITEM-IDX) = ZERO   09920004
099300                      OR RC822-FATAL-ERROR                        09930004
099400                                                                  09940004
099500           WHEN OTHER                                             09950004
099600               MOVE 'INVALID OTR SCOPE FLAG' TO PV-RETURN-MSG     09960004
099700               MOVE 16 TO RC822-RETURN-CODE                       09970004
099800                                                                  09980004
099900         END-EVALUATE                                             09990004
100000                                                                  10000004
100100     END-IF.                                                      10010004
100200                                                                  10020004
100300                                                                  10030004
100400* -------------------------------------------------------------- *10040004
100500* -------------------------------------------------------------- *10050004
100600                                                                  10060004
100700 2100-FILL-BASE-NUMBERS.                                          10070004
100800                                                                  10080004
100900     PERFORM 2110-OPEN-PLAN-CURSOR.                               10090004
101000                                                                  10100004
101100     IF PS-ERRORS-NO                                              10110004
101200         PERFORM 2120-FETCH-PLAN-CURSOR                           10120004
101300     END-IF.                                                      10130004
101400                                                                  10140004
101500     IF PS-PLAN-CSR-EOF                                           10150004
101600         SET PS-ERRORS-YES TO TRUE                                10160004
101700     END-IF.                                                      10170004
101800                                                                  10180004
101900     IF PS-ERRORS-NO                                              10190004
102000         PERFORM 2130-LOAD-PLANS                                  10200004
102100           VARYING RC822-ITEM-IDX FROM 1 BY 1                     10210004
102200             UNTIL PS-PLAN-CSR-EOF                                10220004
102300                OR RC822-SOFT-ABORT                               10230004
102400                OR RC822-ITEM-IDX > PC-MAX-ITEM-LINES             10240004
102500     END-IF.                                                      10250004
102600                                                                  10260004
102700     IF PS-CURSOR-OPEN                                            10270004
102800         PERFORM 2140-CLOSE-PLAN-CURSOR                           10280004
102900     END-IF.                                                      10290004
103000                                                                  10300004
103100                                                                  10310004
103200* -------------------------------------------------------------- *10320004
103300* -------------------------------------------------------------- *10330004
103400                                                                  10340004
103500 2110-OPEN-PLAN-CURSOR.                                           10350004
103600                                                                  10360004
103700     EVALUATE RC822-PO-PREPK-ID                                   10370004
103800                                                                  10380004
103900       WHEN ZERO                                                  10390004
104000                                                                  10400004
104100           EXEC SQL                                               10410004
104200               OPEN PLAN-LINE-CSR                                 10420004
104300           END-EXEC                                               10430004
104400                                                                  10440004
104500       WHEN OTHER                                                 10450004
104600                                                                  10460004
104700           EXEC SQL                                               10470004
104800               OPEN PLAN-CSR                                      10480004
104900           END-EXEC                                               10490004
105000                                                                  10500004
105100     END-EVALUATE.                                                10510004
105200                                                                  10520004
105300                                                                  10530004
105400     EVALUATE SQLCODE                                             10540004
105500                                                                  10550004
105600       WHEN +0                                                    10560004
105700           SET PS-CURSOR-OPEN TO TRUE                             10570004
105800                                                                  10580004
105900       WHEN -904                                                  10590004
106000       WHEN -911                                                  10600004
106100       WHEN -913                                                  10610004
106200           SET PS-CURSOR-CLOSED TO TRUE                           10620004
106300           MOVE 17 TO RC822-RETURN-CODE                           10630004
106400           PERFORM 9900-SOFT-ABORT                                10640004
106500                                                                  10650004
106600       WHEN OTHER                                                 10660004
106700           SET PS-CURSOR-CLOSED TO TRUE                           10670004
106800           MOVE 18 TO RC822-RETURN-CODE                           10680004
106900           PERFORM 9800-PGM-ABEND                                 10690004
107000                                                                  10700004
107100     END-EVALUATE.                                                10710004
107200                                                                  10720004
107300                                                                  10730004
107400* -------------------------------------------------------------- *10740004
107500* -------------------------------------------------------------- *10750004
107600                                                                  10760004
107700 2120-FETCH-PLAN-CURSOR.                                          10770004
107800                                                                  10780004
107900     EVALUATE RC822-PO-PREPK-ID                                   10790004
108000                                                                  10800004
108100       WHEN ZERO                                                  10810004
108200                                                                  10820004
108300           EXEC SQL                                               10830004
108400                                                                  10840004
108500              FETCH PLAN-LINE-CSR                                 10850004
108600                                                                  10860004
108700               INTO :PURITM-PO-LNE-NBR                            10870004
108800                  , :PURITM-APP-PO-LNE-NBR                        10880004
108900                  , :PURITM-PREPK-RATO-QTY                        10890004
109000                                                                  10900004
109100           END-EXEC                                               10910004
109200                                                                  10920004
109300       WHEN OTHER                                                 10930004
109400                                                                  10940004
109500           EXEC SQL                                               10950004
109600                                                                  10960004
109700              FETCH PLAN-CSR                                      10970004
109800                                                                  10980004
109900               INTO :PURITM-PO-LNE-NBR                            10990004
110000                  , :PURITM-APP-PO-LNE-NBR                        11000004
110100                  , :PURITM-PREPK-RATO-QTY                        11010004
110200                                                                  11020004
110300           END-EXEC                                               11030004
110400                                                                  11040004
110500     END-EVALUATE.                                                11050004
110600                                                                  11060004
110700                                                                  11070004
110800     EVALUATE SQLCODE                                             11080004
110900                                                                  11090004
111000       WHEN +0                                                    11100004
111100           CONTINUE                                               11110004
111200                                                                  11120004
111300       WHEN +100                                                  11130004
111400           SET PS-PLAN-CSR-EOF TO TRUE                            11140004
111500                                                                  11150004
111600       WHEN OTHER                                                 11160004
111700           MOVE 19 TO RC822-RETURN-CODE                           11170004
111800           PERFORM 9800-PGM-ABEND                                 11180004
111900                                                                  11190004
112000     END-EVALUATE.                                                11200004
112100                                                                  11210004
112200                                                                  11220004
112300* -------------------------------------------------------------- *11230004
112400* -------------------------------------------------------------- *11240004
112500                                                                  11250004
112600 2130-LOAD-PLANS.                                                 11260004
112700                                                                  11270004
112800     MOVE RC822-PO-NBR          TO DK-PO-NBR.                     11280004
112900     MOVE PURITM-PO-LNE-NBR     TO DK-PO-LNE-NBR.                 11290004
113000     MOVE PURITM-APP-PO-LNE-NBR TO RC822-LINE-NBR (RC822-ITEM-IDX)11300004
113100                                                                  11310004
113200     IF RC822-BULK-PACKAGE                                        11320004
113300         MOVE +1 TO PV-PURITM-RATO-QTY                            11330004
113400     ELSE                                                         11340004
113500         MOVE PURITM-PREPK-RATO-QTY TO PV-PURITM-RATO-QTY         11350004
113600     END-IF.                                                      11360004
113700                                                                  11370004
113800     PERFORM 1110-GET-TALLPLN.                                    11380004
113900                                                                  11390004
114000     IF SQLCODE = +0                                              11400004
114100         PERFORM 2150-SUM-ALL-STORES                              11410004
114200                                                                  11420004
114300         EVALUATE TRUE                                            11430004
114400                                                                  11440004
114500           WHEN SQLCODE = +0                                      11450004
114600           WHEN SQLCODE = +100                                    11460004
114700           WHEN SQLCODE = -305                                    11470004
114800               MOVE MESTDS-STR-DISTRO-QTY                         11480004
114900                 TO RC822-LINE-DISTRO-QTY    (RC822-ITEM-IDX)     11490004
115000                    RC822-LINE-OTR-QTY       (RC822-ITEM-IDX)     11500004
115100                    PV-DISPLAY-QTY                                11510004
115200               MOVE PV-DISPLAY-QTY                                11520004
115300                 TO RC822-LINE-DISTRO-QTY-X  (RC822-ITEM-IDX)     11530004
115400                    RC822-LINE-OTR-QTY-X     (RC822-ITEM-IDX)     11540004
115500                                                                  11550004
115600           WHEN PS-LINE-HAS-DISTRO-NO                             11560004
115700               MOVE ALL '*'                                       11570004
115800                 TO RC822-LINE-OTR-QTY-X     (RC822-ITEM-IDX)     11580004
115900               MOVE +0                                            11590004
116000                 TO PV-DISPLAY-QTY                                11600004
116100                    RC822-LINE-OTR-QTY       (RC822-ITEM-IDX)     11610004
116200                    RC822-LINE-DISTRO-QTY    (RC822-ITEM-IDX)     11620004
116300               MOVE PV-DISPLAY-QTY                                11630004
116400                 TO RC822-LINE-DISTRO-QTY-X  (RC822-ITEM-IDX)     11640004
116500                                                                  11650004
116600           WHEN OTHER                                             11660004
116700               MOVE ALL '*'                                       11670004
116800                 TO RC822-LINE-OTR-QTY-X     (RC822-ITEM-IDX)     11680004
116900               MOVE +0                                            11690004
117000                 TO PV-DISPLAY-QTY                                11700004
117100                    RC822-LINE-OTR-QTY       (RC822-ITEM-IDX)     11710004
117200                    RC822-LINE-DISTRO-QTY    (RC822-ITEM-IDX)     11720004
117300               MOVE PV-DISPLAY-QTY                                11730004
117400                 TO RC822-LINE-DISTRO-QTY-X  (RC822-ITEM-IDX)     11740004
117500         END-EVALUATE                                             11750004
117600     END-IF.                                                      11760004
117700                                                                  11770004
117800     IF PS-ERRORS-NO AND (NOT RC822-SOFT-ABORT)                   11780004
117900         PERFORM 2120-FETCH-PLAN-CURSOR                           11790004
118000     END-IF.                                                      11800004
118100                                                                  11810004
118200                                                                  11820004
118300* -------------------------------------------------------------- *11830004
118400* -------------------------------------------------------------- *11840004
118500                                                                  11850004
118600 2140-CLOSE-PLAN-CURSOR.                                          11860004
118700                                                                  11870004
118800     EVALUATE RC822-PO-PREPK-ID                                   11880004
118900                                                                  11890004
119000       WHEN ZERO                                                  11900004
119100                                                                  11910004
119200           EXEC SQL                                               11920004
119300              CLOSE PLAN-LINE-CSR                                 11930004
119400           END-EXEC                                               11940004
119500                                                                  11950004
119600       WHEN OTHER                                                 11960004
119700                                                                  11970004
119800           EXEC SQL                                               11980004
119900              CLOSE PLAN-CSR                                      11990004
120000           END-EXEC                                               12000004
120100                                                                  12010004
120200     END-EVALUATE.                                                12020004
120300                                                                  12030004
120400                                                                  12040004
120500     EVALUATE SQLCODE                                             12050004
120600                                                                  12060004
120700       WHEN +0                                                    12070004
120800           SET PS-CURSOR-CLOSED TO TRUE                           12080004
120900                                                                  12090004
121000       WHEN OTHER                                                 12100004
121100           MOVE 20 TO RC822-RETURN-CODE                           12110004
121200           PERFORM 9800-PGM-ABEND                                 12120004
121300                                                                  12130004
121400     END-EVALUATE.                                                12140004
121500                                                                  12150004
121600                                                                  12160004
121700* -------------------------------------------------------------- *12170004
121800* -------------------------------------------------------------- *12180004
121900                                                                  12190004
122000 2150-SUM-ALL-STORES.                                             12200004
122100                                                                  12210004
122200     MOVE +0 TO MESTDS-STR-DISTRO-QTY.                            12220004
122300                                                                  12230004
122400     IF RC822-STR-NBR EQUAL ZERO                                  12240004
122500                                                                  12250004
122600         EXEC SQL                                                 12260004
122700                                                                  12270004
122800             SELECT SUM(STR_DISTRO_QTY)                           12280004
122900                                                                  12290004
123000               INTO :MESTDS-STR-DISTRO-QTY                        12300004
123100                                                                  12310004
123200             FROM TMESTDS                                         12320004
123300                                                                  12330004
123400             WHERE PO_NBR      =  :DK-PO-NBR                      12340004
123500               AND PO_LNE_NBR  =  :DK-PO-LNE-NBR                  12350004
123600               AND PLAN_NBR    =  :ALLPLN-PLAN-NBR                12360004
123700                                                                  12370004
123800         END-EXEC                                                 12380004
123900     ELSE                                                         12390004
124000         EXEC SQL                                                 12400004
124100                                                                  12410004
124200             SELECT STR_DISTRO_QTY                                12420004
124300                                                                  12430004
124400               INTO :MESTDS-STR-DISTRO-QTY                        12440004
124500                                                                  12450004
124600             FROM TMESTDS                                         12460004
124700                                                                  12470004
124800             WHERE PO_NBR      =  :DK-PO-NBR                      12480004
124900               AND PO_LNE_NBR  =  :DK-PO-LNE-NBR                  12490004
125000               AND PLAN_NBR    =  :ALLPLN-PLAN-NBR                12500004
125100               AND STR_NBR     =  :RC822-STR-NBR                  12510004
125200                                                                  12520004
125300         END-EXEC                                                 12530004
125400                                                                  12540004
125500     END-IF.                                                      12550004
125600                                                                  12560004
125700                                                                  12570004
125800     EVALUATE SQLCODE                                             12580004
125900                                                                  12590004
126000       WHEN +0                                                    12600004
126100                                                                  12610004
126200           IF RC822-STR-NBR EQUAL ZERO AND                        12620004
126300             (MESTDS-STR-DISTRO-QTY NOT = ALLPLN-CURR-SPLIT-QTY)  12630004
126400               MOVE ALLPLN-CURR-SPLIT-QTY TO MESTDS-STR-DISTRO-QTY12640004
126500           END-IF                                                 12650004
126600                                                                  12660004
126700       WHEN +100                                                  12670004
126800       WHEN -305                                                  12680004
126900                                                                  12690004
127000           IF RC822-STR-NBR EQUAL ZERO                            12700004
127100               MOVE ALLPLN-CURR-SPLIT-QTY TO MESTDS-STR-DISTRO-QTY12710004
127200           ELSE                                                   12720004
127300               MOVE 21 TO RC822-RETURN-CODE                       12730004
127400               SET PS-LINE-HAS-DISTRO-NO TO TRUE                  12740004
127500               PERFORM 9000-NO-DISTRO-ERROR                       12750004
127600           END-IF                                                 12760004
127700                                                                  12770004
127800       WHEN -904                                                  12780004
127900       WHEN -911                                                  12790004
128000       WHEN -913                                                  12800004
128100           MOVE 22 TO RC822-RETURN-CODE                           12810004
128200           PERFORM 9900-SOFT-ABORT                                12820004
128300                                                                  12830004
128400       WHEN OTHER                                                 12840004
128500           MOVE 23 TO RC822-RETURN-CODE                           12850004
128600           SET PS-LINE-HAS-DISTRO-NO TO TRUE                      12860004
128700           PERFORM 9000-NO-DISTRO-ERROR                           12870004
128800                                                                  12880004
128900     END-EVALUATE.                                                12890004
129000                                                                  12900004
129100                                                                  12910004
129200* -------------------------------------------------------------- *12920004
129300*    RECEIVER OTR AT THE LINE LEVEL                               12930004
129400* -------------------------------------------------------------- *12940004
129500                                                                  12950004
129600 2200-PROCESS-RCVR-OTR-RCPTS.                                     12960004
129700                                                                  12970004
129800*    ---------------------------------------------------          12980004
129900*    ALL '*' INDICATES A 'NO DISTRO' ERROR FOR THE LINE           12990004
130000*    ---------------------------------------------------          13000004
130100                                                                  13010004
130200     IF RC822-LINE-OTR-QTY-X (RC822-ITEM-IDX) EQUAL ALL '*'       13020004
130300         SET PS-ERRORS-YES TO TRUE                                13030004
130400     ELSE                                                         13040004
130500         SET PS-ERRORS-NO                                         13050004
130600             PS-PRIOR-CURSOR-START TO TRUE                        13060004
130700         MOVE RC822-LINE-NBR (RC822-ITEM-IDX) TO DK-PO-LNE-NBR    13070004
130800         PERFORM 7000-GET-RECITM-TMST                             13080004
130900     END-IF                                                       13090004
131000                                                                  13100004
131100     IF PS-ERRORS-NO AND (NOT RC822-FATAL-ERROR)                  13110004
131200         PERFORM 7100-OPEN-RECITM-CURSOR                          13120004
131300     END-IF.                                                      13130004
131400                                                                  13140004
131500     IF PS-ERRORS-NO AND (NOT RC822-FATAL-ERROR)                  13150004
131600         PERFORM 7110-FETCH-RECITM-CURSOR                         13160004
131700     END-IF.                                                      13170004
131800                                                                  13180004
131900     IF PS-PRIOR-CURSOR-EOF                                       13190004
132000         SET PS-ERRORS-YES TO TRUE                                13200004
132100     END-IF.                                                      13210004
132200                                                                  13220004
132300     IF PS-ERRORS-NO                                              13230004
132400         PERFORM 6000-PROCESS-RECITM-CURSOR                       13240004
132500           UNTIL PS-PRIOR-CURSOR-EOF                              13250004
132600             OR  PS-ERRORS-YES                                    13260004
132700             OR  RC822-FATAL-ERROR                                13270004
132800     END-IF.                                                      13280004
132900                                                                  13290004
133000     IF PS-CURSOR-OPEN                                            13300004
133100         PERFORM 7120-CLOSE-RECITM-CURSOR                         13310004
133200     END-IF.                                                      13320004
133300                                                                  13330004
133400                                                                  13340004
133500* -------------------------------------------------------------- *13350004
133600*    PO OTR AT THE LINE LEVEL                                     13360004
133700* -------------------------------------------------------------- *13370004
133800                                                                  13380004
133900 2300-PROCESS-PO-OTR-RCPTS.                                       13390004
134000                                                                  13400004
134100*    ---------------------------------------------------          13410004
134200*    ALL '*' INDICATES A 'NO DISTRO' ERROR FOR THE LINE           13420004
134300*    ---------------------------------------------------          13430004
134400                                                                  13440004
134500     IF RC822-LINE-OTR-QTY-X (RC822-ITEM-IDX) EQUAL ALL '*'       13450004
134600         SET PS-ERRORS-YES TO TRUE                                13460004
134700     ELSE                                                         13470004
134800         SET PS-ERRORS-NO TO TRUE                                 13480004
134900         MOVE RC822-LINE-NBR (RC822-ITEM-IDX) TO DK-PO-LNE-NBR    13490004
135000         PERFORM 7200-OPEN-RECITM-CURSOR                          13500004
135100     END-IF.                                                      13510004
135200                                                                  13520004
135300     IF PS-ERRORS-NO                                              13530004
135400         SET PS-PRIOR-CURSOR-START TO TRUE                        13540004
135500         PERFORM 7210-FETCH-RECITM-CURSOR                         13550004
135600     END-IF.                                                      13560004
135700                                                                  13570004
135800     IF PS-ERRORS-NO                                              13580004
135900         PERFORM 6000-PROCESS-RECITM-CURSOR                       13590004
136000            UNTIL PS-PRIOR-CURSOR-EOF                             13600004
136100              OR  PS-ERRORS-YES                                   13610004
136200              OR  RC822-FATAL-ERROR                               13620004
136300     END-IF.                                                      13630004
136400                                                                  13640004
136500     IF PS-CURSOR-OPEN                                            13650004
136600         PERFORM 7220-CLOSE-RECITM-CURSOR                         13660004
136700     END-IF.                                                      13670004
136800                                                                  13680004
136900                                                                  13690004
137000* -------------------------------------------------------------- *13700004
137100* -------------------------------------------------------------- *13710004
137200                                                                  13720004
137300 4000-PROCESS-RECITM-CURSOR.                                      13730004
137400                                                                  13740004
137500     PERFORM 4100-APPLY-PRIOR-RECEIPTS                            13750004
137600       VARYING RC822-STORE-IDX FROM 1 BY 1                        13760004
137700         UNTIL RC822-STORE-NBR (RC822-STORE-IDX) EQUAL ZERO       13770004
137800            OR RC822-STORE-IDX > PC-MAX-STORES.                   13780004
137900                                                                  13790004
138000     IF PS-ERRORS-NO                                              13800004
138100         IF RC822-RECEIVER-OTR                                    13810004
138200             PERFORM 7110-FETCH-RECITM-CURSOR                     13820004
138300         ELSE                                                     13830004
138400             PERFORM 7210-FETCH-RECITM-CURSOR                     13840004
138500         END-IF                                                   13850004
138600     END-IF.                                                      13860004
138700                                                                  13870004
138800                                                                  13880004
138900* -------------------------------------------------------------- *13890004
139000*    THIS PARAGRAPH RETRIEVES THE RECDIS RECORD FOR A GIVEN STORE.13900004
139100*    IT THEN ADDS INTO THE STORE ARRAY THE CORRECT STORE RECEIPTS 13910004
139200*    DEPENDING UPON THE STATUS CODE OF THE RECITM.                13920004
139300* -------------------------------------------------------------- *13930004
139400                                                                  13940004
139500 4100-APPLY-PRIOR-RECEIPTS.                                       13950004
139600                                                                  13960004
139700     MOVE RC822-STORE-NBR (RC822-STORE-IDX) TO RECDIS-STR-NBR.    13970004
139800                                                                  13980004
139900     IF RECITM-STATUS-CDE EQUAL PC-VE                             13990004
140000                                                                  14000004
140100         EXEC SQL                                                 14010004
140200                                                                  14020004
140300             SELECT AP_VERIFY_ITM_QTY                             14030004
140400                                                                  14040004
140500               INTO :PV-RECEIVED-QTY                              14050004
140600                                                                  14060004
140700             FROM TRECDIS                                         14070004
140800                                                                  14080004
140900             WHERE ORD_NBR         =  :RC822-PO-NBR               14090004
141000               AND ORD_LNE_NBR     =  :DK-PO-LNE-NBR              14100004
141100               AND REC_SEQ_NBR     =  :RECITM-REC-SEQ-NBR         14110004
141200               AND OPER_UNT_ID     =  :RC822-OPER-UNT-ID          14120004
141300               AND FCLTY_ID        =  :PC-ONE                     14130013
141400               AND STR_NBR         =  :RECDIS-STR-NBR             14140004
141500               AND STR_FCLTY_ID    =  :PC-ONE                     14150004
141600                                                                  14160004
141700         END-EXEC                                                 14170004
141800     ELSE                                                         14180004
141900                                                                  14190004
142000         EXEC SQL                                                 14200004
142100                                                                  14210004
142200             SELECT EXPTED_ITM_QTY                                14220004
142300                                                                  14230004
142400               INTO :PV-RECEIVED-QTY                              14240004
142500                                                                  14250004
142600             FROM TRECDIS                                         14260004
142700                                                                  14270004
142800             WHERE ORD_NBR         =  :RC822-PO-NBR               14280004
142900               AND ORD_LNE_NBR     =  :DK-PO-LNE-NBR              14290004
143000               AND REC_SEQ_NBR     =  :RECITM-REC-SEQ-NBR         14300004
143100               AND OPER_UNT_ID     =  :RC822-OPER-UNT-ID          14310004
143200               AND FCLTY_ID        =  :PC-ONE                     14320013
143300               AND STR_NBR         =  :RECDIS-STR-NBR             14330004
143400               AND STR_FCLTY_ID    =  :PC-ONE                     14340004
143500                                                                  14350004
143600         END-EXEC                                                 14360004
143700                                                                  14370004
143800     END-IF.                                                      14380004
143900                                                                  14390004
144000                                                                  14400004
144100     EVALUATE SQLCODE                                             14410004
144200                                                                  14420004
144300       WHEN +0                                                    14430004
144400                                                                  14440004
144500           ADD PV-RECEIVED-QTY TO PV-TOT-RECEIVED-QTY             14450004
144600                                                                  14460004
144700           SUBTRACT PV-RECEIVED-QTY                               14470004
144800             FROM   RC822-STORE-OTR-QTY (RC822-STORE-IDX)         14480004
144900                    RC822-SUM-STR-OTR-QTY                         14490004
145000                                                                  14500004
145100* -------------------------------------------------------------- *14510004
145200*    CALCULATE PACK QUANTITY.                                    *14520004
145300*                                                                *14530004
145400*    NOTE:                                                       *14540004
145500*                                                                *14550004
145600*    ON A NON DRIVER LINE RECEIVER RATIO QUANTITY IS DEFAULTED   *14560004
145700*    TO THE PURITM RATIO.                                        *14570004
145800* -------------------------------------------------------------- *14580004
145900                                                                  14590004
146010           IF RC822-PREPACK-PACKAGE AND RC822-PO-PREPK-ID > 0     14601004
146100               IF PV-RECITM-RATO-QTY > +0                         14610004
146200                                                                  14620004
146300                  DIVIDE PV-RECEIVED-QTY                          14630004
146400                    BY   PV-RECITM-RATO-QTY                       14640004
146500                    GIVING  PV-RECEIVED-QTY-PK                    14650004
146600                                                                  14660004
146700                   SUBTRACT PV-RECEIVED-QTY-PK                    14670004
146800                     FROM   RC822-STORE-OTR-PK (RC822-STORE-IDX)  14680004
146900                            RC822-SUM-STR-OTR-PK                  14690004
147000               ELSE                                               14700004
147100                   MOVE ALL '*'                                   14710004
147200                     TO RC822-STORE-OTR-PK-X (RC822-STORE-IDX)    14720004
147300                   MOVE +0 TO PV-RECEIVED-QTY-PK                  14730004
147400               END-IF                                             14740004
147500           END-IF                                                 14750004
147600                                                                  14760004
147700           IF RC822-STORE-OTR-QTY (RC822-STORE-IDX) > +0          14770004
147800               MOVE RC822-STORE-OTR-QTY (RC822-STORE-IDX)         14780004
147900                 TO PV-DISPLAY-QTY                                14790004
148000           ELSE                                                   14800004
148100               MOVE +0 TO PV-DISPLAY-QTY                          14810004
148200           END-IF                                                 14820004
148300                                                                  14830004
148400           MOVE PV-DISPLAY-QTY                                    14840004
148500             TO RC822-STORE-OTR-QTY-X (RC822-STORE-IDX)           14850004
148600                                                                  14860004
148700       WHEN +100                                                  14870004
148800           MOVE +0 TO PV-RECEIVED-QTY                             14880004
148900                                                                  14890004
149000       WHEN -904                                                  14900004
149100       WHEN -911                                                  14910004
149200       WHEN -913                                                  14920004
149300           MOVE 24 TO RC822-RETURN-CODE                           14930004
149400           PERFORM 9900-SOFT-ABORT                                14940004
149500                                                                  14950004
149600       WHEN OTHER                                                 14960004
149700           MOVE 25 TO RC822-RETURN-CODE                           14970004
149800           PERFORM 9800-PGM-ABEND                                 14980004
149900                                                                  14990004
150000     END-EVALUATE.                                                15000004
150100                                                                  15010004
150200                                                                  15020004
150300* -------------------------------------------------------------- *15030004
150400* -------------------------------------------------------------- *15040004
150500                                                                  15050004
150600 6000-PROCESS-RECITM-CURSOR.                                      15060004
150700                                                                  15070004
150800     PERFORM 6110-APPLY-PRIOR-RECEIPTS.                           15080004
150900                                                                  15090004
151000     IF PS-ERRORS-NO                                              15100004
151100         IF RC822-RECEIVER-OTR                                    15110004
151200             PERFORM 7110-FETCH-RECITM-CURSOR                     15120004
151300         ELSE                                                     15130004
151400             PERFORM 7210-FETCH-RECITM-CURSOR                     15140004
151500         END-IF                                                   15150004
151600     END-IF.                                                      15160004
151700                                                                  15170004
151800                                                                  15180004
151900* -------------------------------------------------------------- *15190004
152000* -------------------------------------------------------------- *15200004
152100                                                                  15210004
152200 6110-APPLY-PRIOR-RECEIPTS.                                       15220004
152300                                                                  15230004
152400     MOVE RC822-LINE-NBR (RC822-ITEM-IDX) TO RECDIS-ORD-LNE-NBR.  15240004
152500                                                                  15250004
152600     EVALUATE TRUE                                                15260004
152700                                                                  15270004
152800       WHEN RECITM-STATUS-CDE EQUAL PC-VE                         15280004
152900                                                                  15290004
153000           IF RC822-STR-NBR EQUAL ZERO                            15300004
153100                                                                  15310004
153200               EXEC SQL                                           15320004
153300                                                                  15330004
153400                   SELECT SUM(AP_VERIFY_ITM_QTY)                  15340004
153500                                                                  15350004
153600                     INTO :PV-RECEIVED-QTY                        15360004
153700                                                                  15370004
153800                   FROM TRECDIS                                   15380004
153900                                                                  15390004
154000                   WHERE ORD_NBR         =  :RC822-PO-NBR         15400004
154100                     AND ORD_LNE_NBR     =  :RECDIS-ORD-LNE-NBR   15410004
154200                     AND REC_SEQ_NBR     =  :RECITM-REC-SEQ-NBR   15420004
154300                     AND OPER_UNT_ID     =  :RC822-OPER-UNT-ID    15430004
154400                     AND FCLTY_ID        =  :PC-ONE               15440013
154500                     AND STR_FCLTY_ID    =  :PC-ONE               15450004
154600                                                                  15460004
154700               END-EXEC                                           15470004
154800           ELSE                                                   15480004
154900                                                                  15490004
155000               EXEC SQL                                           15500004
155100                                                                  15510004
155200                   SELECT AP_VERIFY_ITM_QTY                       15520004
155300                                                                  15530004
155400                     INTO :PV-RECEIVED-QTY                        15540004
155500                                                                  15550004
155600                   FROM TRECDIS                                   15560004
155700                                                                  15570004
155800                   WHERE ORD_NBR         =  :RC822-PO-NBR         15580004
155900                     AND ORD_LNE_NBR     =  :RECDIS-ORD-LNE-NBR   15590004
156000                     AND REC_SEQ_NBR     =  :RECITM-REC-SEQ-NBR   15600004
156100                     AND OPER_UNT_ID     =  :RC822-OPER-UNT-ID    15610004
156200                     AND FCLTY_ID        =  :RC822-FCLTY-ID       15620004
156300                     AND STR_NBR         =  :RC822-STR-NBR        15630004
156400                     AND STR_FCLTY_ID    =  :PC-ONE               15640004
156600                                                                  15660004
156700               END-EXEC                                           15670004
156800                                                                  15680004
156900           END-IF                                                 15690004
157000                                                                  15700004
157100       WHEN RECITM-STATUS-CDE EQUAL PC-IP OR PC-CM                15710004
157200                                                                  15720004
157300           IF RC822-STR-NBR EQUAL ZERO                            15730004
157400                                                                  15740004
157500               EXEC SQL                                           15750004
157600                                                                  15760004
157700                   SELECT SUM(EXPTED_ITM_QTY)                     15770004
157800                                                                  15780004
157900                     INTO :PV-RECEIVED-QTY                        15790004
158000                                                                  15800004
158100                   FROM TRECDIS                                   15810004
158200                                                                  15820004
158300                   WHERE ORD_NBR         =  :RC822-PO-NBR         15830004
158400                     AND ORD_LNE_NBR     =  :RECDIS-ORD-LNE-NBR   15840004
158500                     AND REC_SEQ_NBR     =  :RECITM-REC-SEQ-NBR   15850004
158600                     AND OPER_UNT_ID     =  :RC822-OPER-UNT-ID    15860004
158700                     AND FCLTY_ID        =  :RC822-FCLTY-ID       15870004
158900                     AND STR_FCLTY_ID    =  :PC-ONE               15890004
159000                                                                  15900004
159100               END-EXEC                                           15910004
159200                                                                  15920004
159300           ELSE                                                   15930004
159400                                                                  15940004
159500               EXEC SQL                                           15950004
159600                                                                  15960004
159700                   SELECT EXPTED_ITM_QTY                          15970004
159800                                                                  15980004
159900                     INTO :PV-RECEIVED-QTY                        15990004
160000                                                                  16000004
160100                   FROM TRECDIS                                   16010004
160200                                                                  16020004
160300                   WHERE ORD_NBR         =  :RC822-PO-NBR         16030004
160400                     AND ORD_LNE_NBR     =  :RECDIS-ORD-LNE-NBR   16040004
160500                     AND REC_SEQ_NBR     =  :RECITM-REC-SEQ-NBR   16050004
160600                     AND OPER_UNT_ID     =  :RC822-OPER-UNT-ID    16060004
160700                     AND FCLTY_ID        =  :RC822-FCLTY-ID       16070004
160800                     AND STR_NBR         =  :RC822-STR-NBR        16080004
161000                     AND STR_FCLTY_ID    =  :PC-ONE               16100004
161100                                                                  16110004
161200               END-EXEC                                           16120004
161300                                                                  16130004
161400           END-IF                                                 16140004
161500                                                                  16150004
161600     END-EVALUATE.                                                16160004
161700                                                                  16170004
161800                                                                  16180004
161900     EVALUATE SQLCODE                                             16190004
162000                                                                  16200004
162100       WHEN +0                                                    16210004
162200                                                                  16220004
162300           SUBTRACT PV-RECEIVED-QTY                               16230004
162400             FROM   RC822-LINE-OTR-QTY (RC822-ITEM-IDX)           16240004
162500                                                                  16250004
162600           IF RC822-LINE-OTR-QTY (RC822-ITEM-IDX) > +0            16260004
162700               MOVE RC822-LINE-OTR-QTY (RC822-ITEM-IDX)           16270004
162800                 TO PV-DISPLAY-QTY                                16280004
162900           ELSE                                                   16290004
163000               MOVE +0 TO PV-DISPLAY-QTY                          16300004
163100           END-IF                                                 16310004
163200                                                                  16320004
163300           MOVE PV-DISPLAY-QTY                                    16330004
163400             TO RC822-LINE-OTR-QTY-X (RC822-ITEM-IDX)             16340004
163500                                                                  16350004
163600       WHEN +100                                                  16360004
163700       WHEN -305                                                  16370004
163800           MOVE +0 TO PV-RECEIVED-QTY                             16380004
163900                                                                  16390004
164000       WHEN -904                                                  16400004
164100       WHEN -911                                                  16410004
164200       WHEN -913                                                  16420004
164300           MOVE 28 TO RC822-RETURN-CODE                           16430004
164400           PERFORM 9900-SOFT-ABORT                                16440004
164500                                                                  16450004
164600       WHEN OTHER                                                 16460004
164700           MOVE 29 TO RC822-RETURN-CODE                           16470004
164800           PERFORM 9800-PGM-ABEND                                 16480004
164900                                                                  16490004
165000     END-EVALUATE.                                                16500004
165100                                                                  16510004
165200                                                                  16520004
165300* -------------------------------------------------------------- *16530004
165400*    THIS PARAGRAPH RETRIEVES THE EARLIEST TIMESTAMP FOR A PO     16540004
165500*    AND RECEIVER WITHIN A DC.                                    16550004
165600* -------------------------------------------------------------- *16560004
165700                                                                  16570004
165800 7000-GET-RECITM-TMST.                                            16580004
165900                                                                  16590004
166000     EXEC SQL                                                     16600004
166100                                                                  16610004
166200         SELECT CRE_TMST                                          16620004
166300                                                                  16630004
166400           INTO :RECITM-CRE-TMST                                  16640004
166500                                                                  16650004
166600         FROM TRECITM                                             16660004
166700                                                                  16670004
166800         WHERE ORD_NBR      =  :RC822-PO-NBR                      16680004
166900           AND REC_SEQ_NBR  =  :RC822-REC-SEQ-NBR                 16690004
167000           AND ORD_LNE_NBR  =  :DK-PO-LNE-NBR                     16700004
167100           AND OPER_UNT_ID  =  :RC822-OPER-UNT-ID                 16710004
167200                                                                  16720004
167300     END-EXEC.                                                    16730004
167400                                                                  16740004
167500                                                                  16750004
167600     EVALUATE SQLCODE                                             16760004
167700                                                                  16770004
167800       WHEN +0                                                    16780004
167900           CONTINUE                                               16790004
168000                                                                  16800004
168100       WHEN +100                                                  16810004
168200                                                                  16820004
168300           EXEC SQL                                               16830004
168400               SET :RECITM-CRE-TMST = CURRENT TIMESTAMP           16840004
168500           END-EXEC                                               16850004
168600                                                                  16860004
168700       WHEN -904                                                  16870004
168800       WHEN -911                                                  16880004
168900       WHEN -913                                                  16890004
169000           MOVE 32 TO RC822-RETURN-CODE                           16900004
169100           PERFORM 9900-SOFT-ABORT                                16910004
169200                                                                  16920004
169300       WHEN OTHER                                                 16930004
169400           MOVE 33 TO RC822-RETURN-CODE                           16940004
169500           PERFORM 9800-PGM-ABEND                                 16950004
169600                                                                  16960004
169700     END-EVALUATE.                                                16970004
169800                                                                  16980004
169900                                                                  16990004
170000* -------------------------------------------------------------- *17000004
170100* -------------------------------------------------------------- *17010004
170200                                                                  17020004
170300 7100-OPEN-RECITM-CURSOR.                                         17030004
170400                                                                  17040004
170500     EXEC SQL                                                     17050004
170600         OPEN REC-LVL-CSR                                         17060004
170700     END-EXEC.                                                    17070004
170800                                                                  17080004
170900                                                                  17090004
171000     EVALUATE SQLCODE                                             17100004
171100                                                                  17110004
171200       WHEN +0                                                    17120004
171300           SET PS-CURSOR-OPEN TO TRUE                             17130004
171400                                                                  17140004
171500       WHEN -904                                                  17150004
171600       WHEN -911                                                  17160004
171700       WHEN -913                                                  17170004
171800           SET PS-CURSOR-CLOSED TO TRUE                           17180004
171900           MOVE 34 TO RC822-RETURN-CODE                           17190004
172000           PERFORM 9900-SOFT-ABORT                                17200004
172100                                                                  17210004
172200       WHEN OTHER                                                 17220004
172300           SET PS-CURSOR-CLOSED TO TRUE                           17230004
172400           MOVE 35 TO RC822-RETURN-CODE                           17240004
172500           PERFORM 9800-PGM-ABEND                                 17250004
172600                                                                  17260004
172700     END-EVALUATE.                                                17270004
172800                                                                  17280004
172900                                                                  17290004
173000* -------------------------------------------------------------- *17300004
173100* -------------------------------------------------------------- *17310004
173200                                                                  17320004
173300 7110-FETCH-RECITM-CURSOR.                                        17330004
173400                                                                  17340004
173500     EXEC SQL                                                     17350004
173600                                                                  17360004
173700         FETCH REC-LVL-CSR                                        17370004
173800                                                                  17380004
173900          INTO :RECITM-REC-SEQ-NBR                                17390004
174000             , :RECITM-STATUS-CDE                                 17400004
174100             , :RECITM-PREPK-RATO-QTY                             17410004
174200                                                                  17420004
174300     END-EXEC.                                                    17430004
174400                                                                  17440004
174500                                                                  17450004
174600     EVALUATE SQLCODE                                             17460004
174700                                                                  17470004
174800       WHEN +0                                                    17480004
174900           IF RECITM-PREPK-RATO-QTY = +0                          17490004
175000              PERFORM 8010-FETCH-PURITM-RATIO                     17500004
175100              MOVE PURITM-PREPK-RATO-QTY                          17510004
175200                                TO RECITM-PREPK-RATO-QTY          17520004
175300           END-IF                                                 17530004
175400           MOVE RECITM-PREPK-RATO-QTY TO PV-RECITM-RATO-QTY       17540004
175500                                                                  17550004
175600       WHEN +100                                                  17560004
175700           SET PS-PRIOR-CURSOR-EOF TO TRUE                        17570004
175800                                                                  17580004
175810       WHEN OTHER                                                 17581004
175820           MOVE 36 TO RC822-RETURN-CODE                           17582004
175830           PERFORM 9800-PGM-ABEND                                 17583004
175840                                                                  17584004
175850     END-EVALUATE.                                                17585004
175860                                                                  17586004
175870                                                                  17587004
175880* -------------------------------------------------------------- *17588004
175890* -------------------------------------------------------------- *17589004
175900                                                                  17590004
176000 7120-CLOSE-RECITM-CURSOR.                                        17600004
176100                                                                  17610004
176200     EXEC SQL                                                     17620004
176300         CLOSE REC-LVL-CSR                                        17630004
176400     END-EXEC.                                                    17640004
176500                                                                  17650004
176600                                                                  17660004
176700     EVALUATE SQLCODE                                             17670004
176800                                                                  17680004
176900       WHEN +0                                                    17690004
177000           SET PS-CURSOR-CLOSED TO TRUE                           17700004
177100                                                                  17710004
177200       WHEN OTHER                                                 17720004
177300           MOVE 37 TO RC822-RETURN-CODE                           17730004
177400           PERFORM 9800-PGM-ABEND                                 17740004
177500                                                                  17750004
177600     END-EVALUATE.                                                17760004
177700                                                                  17770004
177800                                                                  17780004
177900* -------------------------------------------------------------- *17790004
178000* -------------------------------------------------------------- *17800004
178100                                                                  17810004
178200 7200-OPEN-RECITM-CURSOR.                                         17820004
178300                                                                  17830004
178400     EXEC SQL                                                     17840004
178500         OPEN PO-LVL-CSR                                          17850004
178600     END-EXEC.                                                    17860004
178700                                                                  17870004
178800                                                                  17880004
178900     EVALUATE SQLCODE                                             17890004
179000                                                                  17900004
179100       WHEN +0                                                    17910004
179200           SET PS-CURSOR-OPEN TO TRUE                             17920004
179300                                                                  17930004
179400       WHEN -904                                                  17940004
179500       WHEN -911                                                  17950004
179600       WHEN -913                                                  17960004
179700           SET PS-CURSOR-CLOSED TO TRUE                           17970004
179800           MOVE 38 TO RC822-RETURN-CODE                           17980004
179900           PERFORM 9900-SOFT-ABORT                                17990004
180000                                                                  18000004
180100       WHEN OTHER                                                 18010004
180200           SET PS-CURSOR-CLOSED TO TRUE                           18020004
180300           MOVE 39 TO RC822-RETURN-CODE                           18030004
180400           PERFORM 9800-PGM-ABEND                                 18040004
180500                                                                  18050004
180600     END-EVALUATE.                                                18060004
180700                                                                  18070004
180800                                                                  18080004
180900* -------------------------------------------------------------- *18090004
181000* -------------------------------------------------------------- *18100004
181100                                                                  18110004
181200 7210-FETCH-RECITM-CURSOR.                                        18120004
181300                                                                  18130004
181400     EXEC SQL                                                     18140004
181500                                                                  18150004
181600         FETCH PO-LVL-CSR                                         18160004
181700                                                                  18170004
181800          INTO :RECITM-REC-SEQ-NBR                                18180004
181900             , :RECITM-STATUS-CDE                                 18190004
182000             , :RECITM-PREPK-RATO-QTY                             18200004
182100                                                                  18210004
182200     END-EXEC.                                                    18220004
182300                                                                  18230004
182400                                                                  18240004
182500     EVALUATE SQLCODE                                             18250004
182600                                                                  18260004
182700       WHEN +0                                                    18270004
182800           IF RECITM-PREPK-RATO-QTY = +0                          18280004
182900              PERFORM 8010-FETCH-PURITM-RATIO                     18290004
183000              MOVE PURITM-PREPK-RATO-QTY                          18300004
183100                                TO RECITM-PREPK-RATO-QTY          18310004
183200           END-IF                                                 18320004
183300           MOVE RECITM-PREPK-RATO-QTY TO PV-RECITM-RATO-QTY       18330004
183400                                                                  18340004
183500       WHEN +100                                                  18350004
183600           SET PS-PRIOR-CURSOR-EOF TO TRUE                        18360004
183700                                                                  18370004
183800       WHEN OTHER                                                 18380004
183900           MOVE 40 TO RC822-RETURN-CODE                           18390004
184000           PERFORM 9800-PGM-ABEND                                 18400004
184100                                                                  18410004
184200     END-EVALUATE.                                                18420004
184300                                                                  18430004
184400                                                                  18440004
184500* -------------------------------------------------------------- *18450004
184600* -------------------------------------------------------------- *18460004
184700                                                                  18470004
184800 7220-CLOSE-RECITM-CURSOR.                                        18480004
184900                                                                  18490004
185000     EXEC SQL                                                     18500004
185100         CLOSE PO-LVL-CSR                                         18510004
185200     END-EXEC.                                                    18520004
185300                                                                  18530004
185400                                                                  18540004
185500     EVALUATE SQLCODE                                             18550004
185600                                                                  18560004
185700       WHEN +0                                                    18570004
185800           SET PS-CURSOR-CLOSED TO TRUE                           18580004
185900                                                                  18590004
186000       WHEN OTHER                                                 18600004
186100           MOVE 41 TO RC822-RETURN-CODE                           18610004
186200           PERFORM 9800-PGM-ABEND                                 18620004
186300                                                                  18630004
186400     END-EVALUATE.                                                18640004
186500                                                                  18650004
186600                                                                  18660004
186700* -------------------------------------------------------------- *18670004
186800* -------------------------------------------------------------- *18680004
186900                                                                  18690004
187000 8000-FETCH-DRIVER-LINE.                                          18700004
187100                                                                  18710004
187200     EXEC SQL                                                     18720004
187300                                                                  18730004
187400         SELECT DISTINCT                                          18740004
187500                PREPK_RATO_QTY                                    18750004
187600              , ORD_LNE_NBR                                       18760004
187700                                                                  18770004
187800           INTO :RECITM-PREPK-RATO-QTY                            18780004
187900              , :RECITM-ORD-LNE-NBR                               18790004
188000                                                                  18800004
188100         FROM TRECITM                                             18810004
188200                                                                  18820004
188300         WHERE ORD_NBR            =  :RC822-PO-NBR                18830004
188400           AND REC_SEQ_NBR        =  :RC822-REC-SEQ-NBR           18840004
188500           AND OPER_UNT_ID        =  :RC822-OPER-UNT-ID           18850004
188600           AND PREPK_ID           =  :RC822-PO-PREPK-ID           18860004
188700           AND PREPK_DRV_LNE_CDE  =  :PC-A                        18870004
188800                                                                  18880004
188900     END-EXEC.                                                    18890004
189000                                                                  18900004
189100                                                                  18910004
189200     EVALUATE SQLCODE                                             18920004
189300                                                                  18930004
189400       WHEN +0                                                    18940004
189500           SET PS-DRIVER-LINE-YES  TO TRUE                        18950004
189600           MOVE RECITM-ORD-LNE-NBR TO DK-DRIVER-LINE-NBR          18960004
189700                                                                  18970004
189800* -------------------------------------------------------------- *18980004
189900*    NO DRIVER LINE CAN OCCUR IF THE RECEIVER IS A NON PREPACK   *18990004
190000*    RECEIVER OR THE PREPACK LINE RECEIVER HAS BEEN DELETED.     *19000004
190100*    THE RATIO QTY IS DEFAULTED TO THE PURITM RATIO.             *19010004
190200* -------------------------------------------------------------- *19020004
190300                                                                  19030004
190400       WHEN +100                                                  19040004
190500           PERFORM 8010-FETCH-PURITM-RATIO                        19050004
190600           MOVE PURITM-PREPK-RATO-QTY  TO RECITM-PREPK-RATO-QTY   19060004
190700           MOVE +0                     TO RECITM-ORD-LNE-NBR      19070004
190800           SET PS-DRIVER-LINE-NO       TO TRUE                    19080004
190900                                                                  19090004
191000       WHEN -904                                                  19100004
191100       WHEN -911                                                  19110004
191200       WHEN -913                                                  19120004
191300           MOVE 42 TO RC822-RETURN-CODE                           19130004
191400           PERFORM 9900-SOFT-ABORT                                19140004
191500                                                                  19150004
191600       WHEN OTHER                                                 19160004
191700           MOVE 43 TO RC822-RETURN-CODE                           19170004
191800           PERFORM 9800-PGM-ABEND                                 19180004
191900                                                                  19190004
192000     END-EVALUATE.                                                19200004
192100                                                                  19210004
192200                                                                  19220004
192300* -------------------------------------------------------------- *19230004
192400* -------------------------------------------------------------- *19240004
192500                                                                  19250004
192600 8010-FETCH-PURITM-RATIO.                                         19260004
192700                                                                  19270004
192800     EXEC SQL                                                     19280004
192900                                                                  19290004
193000         SELECT DISTINCT                                          19300004
193100                PREPK_RATO_QTY                                    19310004
193200                                                                  19320004
193300           INTO :PURITM-PREPK-RATO-QTY                            19330004
193400                                                                  19340004
193500         FROM TPURITM                                             19350004
193600                                                                  19360004
193700         WHERE PO_NBR          =  :RC822-PO-NBR                   19370004
193800           AND PO_LNE_NBR      =  :DK-PO-LNE-NBR                  19380004
193900           AND VER_STATUS_CDE  =  :PC-A                           19390004
194000           AND PO_PREPK_ID     =  :RC822-PO-PREPK-ID              19400004
194100                                                                  19410004
194200     END-EXEC.                                                    19420004
194300                                                                  19430004
194400                                                                  19440004
194500     EVALUATE SQLCODE                                             19450004
194600                                                                  19460004
194700       WHEN +0                                                    19470004
194800           CONTINUE                                               19480004
194900                                                                  19490004
195000       WHEN +100                                                  19500004
195100           MOVE ZERO  TO PURITM-PREPK-RATO-QTY                    19510004
195200                                                                  19520004
195300       WHEN -904                                                  19530004
195400       WHEN -911                                                  19540004
195500       WHEN -913                                                  19550004
195600           MOVE 44 TO RC822-RETURN-CODE                           19560004
195700           PERFORM 9900-SOFT-ABORT                                19570004
195800                                                                  19580004
195900       WHEN OTHER                                                 19590004
196000           MOVE 45 TO RC822-RETURN-CODE                           19600004
196100           PERFORM 9800-PGM-ABEND                                 19610004
196200                                                                  19620004
196300     END-EVALUATE.                                                19630004
196400                                                                  19640004
196500                                                                  19650004
196600* -------------------------------------------------------------- *19660004
196700* -------------------------------------------------------------- *19670004
196800                                                                  19680004
196900 8020-VERIFY-PLAN-ALLOCATION.                                     19690004
197000                                                                  19700004
197100     SET RC822-PACK-IDX TO RECITM-ORD-LNE-NBR.                    19710004
197200                                                                  19720004
197300     MOVE PC-Y TO RC822-STORE-VAL-OOR-IND.                        19730004
197400                                                                  19740004
197500     PERFORM                                                      19750004
197600       VARYING RC822-STORE-IDX FROM 1 BY 1                        19760004
197700         UNTIL RC822-STORE-NBR (RC822-STORE-IDX) EQUAL ZERO       19770004
197800            OR RC822-STORE-IDX > PC-MAX-STORES                    19780004
197900                                                                  19790004
198000         PERFORM 8030-VERIFY-PACK-COMPONENTS                      19800004
198100           VARYING RC822-PACK-IDX FROM 1 BY 1                     19810004
198200             UNTIL RC822-PACK-IDX > PC-MAX-PACK-LINES             19820004
198300                OR RC822-PO-LINE-NBR (RC822-PACK-IDX) EQUAL ZERO  19830004
198400                OR RC822-STORE-VAL-OOR-IND EQUAL PC-N             19840004
198500                                                                  19850004
198600     END-PERFORM.                                                 19860004
198700                                                                  19870004
198800     MOVE PC-Y TO RC822-STORE-GOOD-PLAN-IND.                      19880004
198900                                                                  19890004
199000     PERFORM 8040-SELECT-STORE-COUNT                              19900004
199100       VARYING RC822-PACK-IDX FROM 1 BY 1                         19910004
199200         UNTIL RC822-PO-LINE-NBR (RC822-PACK-IDX) EQUAL ZERO      19920004
199300            OR RC822-PACK-IDX > PC-MAX-PACK-LINES.                19930004
199400                                                                  19940004
199500                                                                  19950004
199600* -------------------------------------------------------------- *19960004
199700* -------------------------------------------------------------- *19970004
199800                                                                  19980004
199900 8030-VERIFY-PACK-COMPONENTS.                                     19990004
200000                                                                  20000004
200100     IF RC822-APP-PO-LINE-NBR (RC822-PACK-IDX) NOT EQUAL          20010004
200200        RC822-APP-PO-LNE-NBR                                      20020004
200300                                                                  20030004
200400         MOVE RC822-PO-LINE-NBR (RC822-PACK-IDX) TO DK-PO-LINE-NBR20040004
200500         MOVE RC822-STORE-NBR  (RC822-STORE-IDX) TO DK-STORE-NBR  20050004
200600                                                                  20060004
200700         PERFORM 8050-SUM-STORE-DISTRO-QTY                        20070004
200800                                                                  20080004
200900     END-IF.                                                      20090004
201000                                                                  20100004
201100     IF RC822-PO-PACK-RATO-QTY (RC822-PACK-IDX) > +0              20110007
201110      IF RC822-STORE-DISTRO-PK (RC822-STORE-IDX) NOT EQUAL        20111007
201200       (PV-SUM-STR-DISTRO-QTY /                                   20120004
201300        RC822-PO-PACK-RATO-QTY (RC822-PACK-IDX))                  20130004
201400         MOVE PC-N TO RC822-STORE-VAL-OOR-IND                     20140004
201500      END-IF                                                      20150007
201510     END-IF                                                       20151007
201600                                                                  20160004
201700     MOVE RC822-PO-PACK-RATO-QTY (RC822-PACK-IDX)                 20170004
201800       TO PV-DISPLAY-QTY1.                                        20180004
201900                                                                  20190004
202000     MOVE RC822-STORE-DISTRO-QTY (RC822-STORE-IDX)                20200004
202100       TO PV-DISPLAY-QTY2.                                        20210004
202200                                                                  20220004
202300     MOVE RC822-STORE-DISTRO-PK  (RC822-STORE-IDX)                20230004
202400       TO PV-DISPLAY-QTY3.                                        20240004
202500                                                                  20250004
202600                                                                  20260004
202700* -------------------------------------------------------------- *20270004
202800* -------------------------------------------------------------- *20280004
202900                                                                  20290004
203000 8040-SELECT-STORE-COUNT.                                         20300004
203100                                                                  20310004
203200     MOVE RC822-PO-LINE-NBR (RC822-PACK-IDX) TO DK-PO-LINE-NBR.   20320004
203300                                                                  20330004
203400     EXEC SQL                                                     20340004
203500                                                                  20350004
203600         SELECT COUNT(DISTINCT STR_NBR)                           20360004
203700                                                                  20370004
203800           INTO :PV-STORE-COUNT                                   20380004
203900                                                                  20390004
204000         FROM TMESTDS                                             20400004
204100                                                                  20410004
204200         WHERE PO_NBR      =  :RC822-PO-NBR                       20420004
204300           AND PO_LNE_NBR  =  :DK-PO-LINE-NBR                     20430004
204400           AND PLAN_NBR    =  :ALLPLN-PLAN-NBR                    20440004
204500                                                                  20450004
204600     END-EXEC.                                                    20460004
204700                                                                  20470004
204800                                                                  20480004
204900     EVALUATE SQLCODE                                             20490004
205000                                                                  20500004
205100       WHEN +0                                                    20510004
205200                                                                  20520004
205300           IF RC822-PACK-IDX EQUAL 1                              20530004
205400               MOVE PV-STORE-COUNT TO PV-SAVE-FIRST-COUNT         20540004
205500           END-IF                                                 20550004
205600                                                                  20560004
205700           IF PV-SAVE-FIRST-COUNT EQUAL PV-STORE-COUNT            20570004
205800               CONTINUE                                           20580004
205900           ELSE                                                   20590004
206000               MOVE PC-N TO RC822-STORE-GOOD-PLAN-IND             20600004
206100           END-IF                                                 20610004
206200                                                                  20620004
206300       WHEN +100                                                  20630004
206400           MOVE ZEROS TO PV-STORE-COUNT                           20640004
206500                                                                  20650004
206600       WHEN -904                                                  20660004
206700       WHEN -911                                                  20670004
206800       WHEN -913                                                  20680004
206900           MOVE 46 TO RC822-RETURN-CODE                           20690004
207000           PERFORM 9900-SOFT-ABORT                                20700004
207100                                                                  20710004
207200       WHEN OTHER                                                 20720004
207300           MOVE 47 TO RC822-RETURN-CODE                           20730004
207400           PERFORM 9800-PGM-ABEND                                 20740004
207500                                                                  20750004
207600     END-EVALUATE.                                                20760004
207700                                                                  20770004
207800                                                                  20780004
207900* -------------------------------------------------------------- *20790004
208000* -------------------------------------------------------------- *20800004
208100                                                                  20810004
208200 8050-SUM-STORE-DISTRO-QTY.                                       20820004
208300                                                                  20830004
208400     EXEC SQL                                                     20840004
208500                                                                  20850004
208600         SELECT SUM(STR_DISTRO_QTY)                               20860004
208700                                                                  20870004
208800           INTO :PV-SUM-STR-DISTRO-QTY                            20880004
208900                                                                  20890004
209000         FROM TMESTDS                                             20900004
209100                                                                  20910004
209200         WHERE PO_NBR      =  :RC822-PO-NBR                       20920004
209300           AND PO_LNE_NBR  =  :DK-PO-LINE-NBR                     20930004
209400           AND PLAN_NBR    =  :RC822-PLAN-NBR                     20940004
209500           AND STR_NBR     =  :DK-STORE-NBR                       20950004
209600                                                                  20960004
209700     END-EXEC.                                                    20970004
209800                                                                  20980004
209900                                                                  20990004
210000     EVALUATE SQLCODE                                             21000004
210100                                                                  21010004
210200       WHEN +0                                                    21020004
210300           CONTINUE                                               21030004
210400                                                                  21040004
210500       WHEN -904                                                  21050004
210600       WHEN -911                                                  21060004
210700       WHEN -913                                                  21070004
210800           MOVE 48 TO RC822-RETURN-CODE                           21080004
210900           PERFORM 9900-SOFT-ABORT                                21090004
211000                                                                  21100004
211100       WHEN OTHER                                                 21110004
211200           MOVE 49 TO RC822-RETURN-CODE                           21120004
211300           PERFORM 9800-PGM-ABEND                                 21130004
211400                                                                  21140004
211500     END-EVALUATE.                                                21150004
211600                                                                  21160004
211700                                                                  21170004
211800* -------------------------------------------------------------- *21180004
211900* -------------------------------------------------------------- *21190004
212000                                                                  21200004
212100 9000-NO-DISTRO-ERROR.                                            21210004
212200                                                                  21220004
212300     SET RC822-NO-DISTRO                                          21230004
212400         RC822-WARNING-ERROR TO TRUE.                             21240004
212500                                                                  21250004
212600     IF RC822-STORE-LEVEL-OTR                                     21260004
212700         PERFORM                                                  21270004
212800           VARYING RC822-STORE-IDX FROM 1 BY 1                    21280004
212900             UNTIL RC822-STORE-IDX > PC-MAX-STORES                21290004
213000                                                                  21300004
213100             MOVE ALL '*'                                         21310004
213200               TO RC822-STORE-OTR-QTY-X (RC822-STORE-IDX)         21320004
213300                                                                  21330004
213400         END-PERFORM                                              21340004
213500     ELSE                                                         21350004
213600         MOVE ALL '*' TO RC822-LINE-OTR-QTY-X (RC822-ITEM-IDX)    21360004
213700     END-IF.                                                      21370004
213800                                                                  21380004
213900                                                                  21390004
214000* -------------------------------------------------------------- *21400004
214100*    WHEN A FATAL ERROR OCCURS, PASS THE ERROR SWITCHES BACK TO   21410004
214200*    THE HOST PROGRAM AND WRITE TO THE CICS MESSAGE LOG.          21420004
214300* -------------------------------------------------------------- *21430004
214400                                                                  21440004
214500 9800-PGM-ABEND.                                                  21450004
214600                                                                  21460004
214700     PERFORM                                                      21470004
214800       VARYING RC822-ITEM-ERR-IDX FROM 1 BY 1                     21480004
214900         UNTIL RC822-ITEM-ERR-IDX > PC-MAX-ITEM-LINES             21490004
215000                                                                  21500004
215100         MOVE SPACES                                              21510004
215200           TO RC822-LINE-OTR-QTY-X    (RC822-ITEM-ERR-IDX)        21520004
215300              RC822-LINE-DISTRO-QTY-X (RC822-ITEM-ERR-IDX)        21530004
215400              RC822-LINE-DISTRO-OTR-X (RC822-ITEM-ERR-IDX)        21540004
215500         MOVE +0                                                  21550004
215600           TO RC822-LINE-OTR-QTY      (RC822-ITEM-ERR-IDX)        21560004
215700              RC822-LINE-DISTRO-QTY   (RC822-ITEM-ERR-IDX)        21570004
215800              RC822-LINE-DISTRO-OTR   (RC822-ITEM-ERR-IDX)        21580004
215900                                                                  21590004
216000     END-PERFORM.                                                 21600004
216100                                                                  21610004
216200     PERFORM                                                      21620004
216300       VARYING RC822-STORE-ERR-IDX FROM 1 BY 1                    21630004
216400         UNTIL RC822-STORE-ERR-IDX > PC-MAX-STORES                21640004
216500                                                                  21650004
216600          MOVE SPACES                                             21660004
216700            TO RC822-STORE-OTR-QTY-X       (RC822-STORE-ERR-IDX)  21670004
216800               RC822-STORE-OTR-PK-X        (RC822-STORE-ERR-IDX)  21680004
216900               RC822-STORE-DISTRO-PK-X     (RC822-STORE-ERR-IDX)  21690004
217000               RC822-STORE-DISTRO-QTY-X    (RC822-STORE-ERR-IDX)  21700004
217100               RC822-STORE-DISTRO-OTR-X    (RC822-STORE-ERR-IDX)  21710004
217200               RC822-STORE-DISTRO-OTR-PK-X (RC822-STORE-ERR-IDX)  21720004
217300          MOVE +0                                                 21730004
217400            TO RC822-STORE-OTR-QTY         (RC822-STORE-ERR-IDX)  21740004
217500               RC822-STORE-OTR-PK          (RC822-STORE-ERR-IDX)  21750004
217600               RC822-STORE-DISTRO-PK       (RC822-STORE-ERR-IDX)  21760004
217700               RC822-STORE-DISTRO-OTR      (RC822-STORE-ERR-IDX)  21770004
217800               RC822-STORE-DISTRO-OTR-PK   (RC822-STORE-ERR-IDX)  21780004
217900               RC822-STORE-RNK-SEQ-NBR     (RC822-STORE-ERR-IDX)  21790004
218000                                                                  21800004
218100     END-PERFORM.                                                 21810004
218200                                                                  21820004
218300     SET PS-ERRORS-YES                                            21830004
218400         RC822-FATAL-ERROR                                        21840004
218500         RC822-CROAK        TO TRUE.                              21850004
218600                                                                  21860004
218700     PERFORM 9950-FORMAT-ERROR-MSG.                               21870004
218800                                                                  21880004
218900     SET DP013-LINK-RETURN                                        21890004
219000         DP013-NO-ROLLBACK  TO TRUE.                              21900004
219100                                                                  21910004
219200     PERFORM DP013-0000-PROCESS-ABEND.                            21920004
219300                                                                  21930004
219400                                                                  21940004
219500* -------------------------------------------------------------- *21950004
219600*    THE DB2 RESOURCE IS NOT AVAILABLE, PASS THE ERROR SWITCHES  *21960004
219700*    BACK TO THE HOST PROGRAM AND WRITE TO THE CICS MESSAGE LOG  *21970004
219800* -------------------------------------------------------------- *21980004
219900                                                                  21990004
220000 9900-SOFT-ABORT.                                                 22000004
220100                                                                  22010004
220200     SET PS-ERRORS-YES                                            22020004
220300         RC822-FATAL-ERROR                                        22030004
220400         RC822-SOFT-ABORT   TO TRUE.                              22040004
220500                                                                  22050004
220600     PERFORM 9950-FORMAT-ERROR-MSG.                               22060004
220700                                                                  22070004
220800     SET DP013-LINK-RETURN                                        22080004
220900         DP013-NO-ROLLBACK TO TRUE.                               22090004
221000                                                                  22100004
221100     PERFORM DP013-0000-PROCESS-ABEND.                            22110004
221200                                                                  22120004
221300                                                                  22130004
221400* -------------------------------------------------------------- *22140004
221500* -------------------------------------------------------------- *22150004
221600                                                                  22160004
221700 9950-FORMAT-ERROR-MSG.                                           22170004
221800                                                                  22180004
221900     IF RC822-APP-PO-LNE-NBR EQUAL ZERO                           22190004
222000         MOVE DK-PO-LNE-NBR        TO PV-DISP-PO-LNE-NBR          22200004
222100     ELSE                                                         22210004
222200         MOVE RC822-APP-PO-LNE-NBR TO PV-DISP-PO-LNE-NBR          22220004
222300     END-IF.                                                      22230004
222400                                                                  22240004
222500     MOVE SQLCODE            TO  PV-SQLCODE.                      22250004
222600     MOVE PV-SQLCODE         TO  PV-DISPLAY-SQLCODE.              22260004
222700     MOVE RC822-PO-NBR       TO  PV-DISP-PO-NBR.                  22270004
222800     MOVE RC822-REC-SEQ-NBR  TO  PV-DISP-REC-SEQ-NBR.             22280004
222900     MOVE RC822-OPER-UNT-ID  TO  PV-DISP-OPER-UNT-ID.             22290004
223000     MOVE RC822-FCLTY-ID     TO  PV-DISP-FCLTY-ID.                22300004
223100     MOVE RC822-STR-NBR      TO  PV-DISP-STR-NBR.                 22310004
223200                                                                  22320004
223300     STRING '** RCKCS822 ** ERROR; '                              22330004
223400            PV-RETURN-MSG                                         22340004
223500         DELIMITED BY SIZE INTO DP013-MESSAGE-TEXT (1).           22350004
223600                                                                  22360004
223700     STRING  ' RC822-RC = ' RC822-RETURN-CODE                     22370004
223800             '; SQLCODE = ' PV-DISPLAY-SQLCODE                    22380004
223900         DELIMITED BY SIZE INTO DP013-MESSAGE-TEXT (2).           22390004
224000                                                                  22400004
224100     MOVE '  PO    REC  LNE OPER FCLTY STR'                       22410004
224200       TO DP013-MESSAGE-TEXT (3).                                 22420004
224300                                                                  22430004
224400     STRING                                                       22440004
224500         PV-DISP-PO-NBR      '-'                                  22450004
224600         PV-DISP-REC-SEQ-NBR '-'                                  22460004
224700         PV-DISP-PO-LNE-NBR  '-'                                  22470004
224800         PV-DISP-OPER-UNT-ID '-'                                  22480004
224900         PV-DISP-FCLTY-ID    '-'                                  22490004
225000         PV-DISP-STR-NBR                                          22500004
225100         DELIMITED BY SIZE INTO DP013-MESSAGE-TEXT (4).           22510004
225200                                                                  22520004
225300                                                                  22530004
225400* -------------------------------------------------------------- *22540004
225500*    ABEND PROCESSOR MODULE                                      *22550004
225600* -------------------------------------------------------------- *22560004
225700                                                                  22570004
225800     COPY DPPD013.                                                22580004
225900                                                                  22590004
226000                                                                  22600004
226100                                                                  22610004
226200* -------------------------------------------------------------- *22620004
226300* -------------------------------------------------------------- *22630004
