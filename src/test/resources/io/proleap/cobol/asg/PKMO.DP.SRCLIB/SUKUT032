000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400 PROGRAM-ID.    SUKUT032.                                         00040001
000500 AUTHOR.        PATRICK BURKE.                                    00050001
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN   MAY 2000.                                         00070001
000800 DATE-COMPILED.                                                   00080001
000900***************************************************************** 00090001
001000*  THIS PROGRAM REVALIDATES THE RECEIVER SEQUENCE NUMBER ON THE * 00100003
001100*  WEEKLY MISDIRECT EXTRACT FILE.                               * 00110003
001200***************************************************************** 00120001
001300                                                                  00130003
001400***************************************************************** 00140001
001500 ENVIRONMENT DIVISION.                                            00150001
001600***************************************************************** 00160001
001700 INPUT-OUTPUT SECTION.                                            00170001
001800                                                                  00180001
001900 FILE-CONTROL.                                                    00190001
002000     SELECT WEEKLY-EXTRACT-FILE                                   00200005
002100         ASSIGN TO INP01.                                         00210005
002200     SELECT UPDATED-EXTRACT-FILE                                  00220005
002300         ASSIGN TO OUT01.                                         00230005
002400                                                                  00240001
002500***************************************************************** 00250001
002600 DATA DIVISION.                                                   00260001
002700***************************************************************** 00270001
002800 FILE SECTION.                                                    00280001
002900*                                                                 00290001
003000 FD  WEEKLY-EXTRACT-FILE                                          00300004
003100     RECORDING MODE IS F                                          00310001
003200     LABEL RECORDS ARE STANDARD                                   00320001
003300     BLOCK CONTAINS 0 RECORDS.                                    00330001
003400 01  WEEKLY-EXTRACT-RECORD             PIC X(200).                00340004
003500*                                                                 00350001
003600 FD  UPDATED-EXTRACT-FILE                                         00360008
003700     RECORDING MODE IS F                                          00370004
003800     LABEL RECORDS ARE STANDARD                                   00380004
003900     BLOCK CONTAINS 0 RECORDS.                                    00390004
004000 01  UPDATED-EXTRACT-RECORD            PIC X(200).                00400008
004100*                                                                 00410004
004200***************************************************************** 00420001
004300 WORKING-STORAGE SECTION.                                         00430001
004400                                                                  00440001
004500 01  PS-PROGRAM-SWITCHES.                                         00450001
004510     05  PS-EOF-EXTRACT-SW            PIC X(01)  VALUE 'N'.       00451008
004520         88  PS-EOF-EXTRACT                      VALUE 'Y'.       00452008
004530         88  PS-NOT-EOF-EXTRACT                  VALUE 'N'.       00453008
004600     05  PS-PKSLIP-FOUND-SW           PIC X(01)  VALUE 'N'.       00460008
004700         88  PS-PKSLIP-FOUND                     VALUE 'Y'.       00470008
004800         88  PS-PKSLIP-NOT-FOUND                 VALUE 'N'.       00480008
004900     05  PS-VALID-RECORD-SW           PIC X(01)  VALUE 'N'.       00490008
005000         88  PS-VALID-RECORD                     VALUE 'Y'.       00500008
005100         88  PS-NOT-VALID-RECORD                 VALUE 'N'.       00510008
005200*                                                                 00520001
005300 01  PV-PROGRAM-VARIABLES.                                        00530001
005500                                                                  00550008
005600     05  PV-REC-SEQ-NBR               PIC S9(09).                 00560008
005700     05  PV-PO-NBR                    PIC S9(09).                 00570008
005800                                                                  00580008
005900     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      00590001
006000                                                                  00600008
006100     05  PV-RECORDS-UNCHANGED         PIC S9(09) VALUE ZERO       00610005
006200                                                  COMP SYNC.      00620001
006300     05  PV-RECORDS-CHANGED           PIC S9(09) VALUE ZERO       00630005
006400                                                  COMP SYNC.      00640001
006500     05  PV-TOTAL-INPUT-READ          PIC S9(09) VALUE ZERO       00650017
006501                                                  COMP SYNC.      00650117
006510     05  PV-UPDATES-WRITTEN           PIC S9(09) VALUE ZERO       00651017
006520                                                  COMP SYNC.      00652017
006530     05  PV-RECORDS-NOT-FOUND         PIC S9(09) VALUE ZERO       00653020
006540                                                  COMP SYNC.      00654020
006600                                                                  00660001
007000 01 PC-PROGRAM-CONSTANTS.                                         00700001
007100     05 PC-PROGRAM-NAME               PIC X(08)  VALUE 'SUKUT032'.00710004
007200     05  PC-DEFAULT-CC-DATE          PIC X(10) VALUE '9999-09-09'.00720001
007300                                                                  00730001
007400 01  PV-ABEND-FIELDS.                                             00740001
007500     05  ABEND-CODE                   PIC S9(04) VALUE +0         00750011
007600                                                 COMP SYNC.       00760001
007700     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT032'.00770005
007800     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00780001
007900     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    00790001
008000******************************************************************00800001
008100*  USED FOR DB2 ERROR MESSAGE BUILDING                            00810001
008200******************************************************************00820001
008300     COPY DPWS004.                                                00830023
008400                                                                  00840001
008500******************************************************************00850001
008600*   DB2 SQL COMMUNICATION AREA                                    00860001
008700******************************************************************00870001
008800     EXEC SQL                                                     00880001
008900          INCLUDE SQLCA                                           00890001
009000     END-EXEC.                                                    00900001
009100                                                                  00910001
009200******************************************************************00920001
009300*   DB2 TABLE DECLARATION - PACKSLIP TABLE                        00930004
009400******************************************************************00940001
009500     EXEC SQL                                                     00950001
009600          INCLUDE TPKSLIP                                         00960001
009700     END-EXEC.                                                    00970001
009800                                                                  00980001
009900******************************************************************00990001
010000*   DB2 TABLE DECLARATION - PACKSLIP/VENDOR SHIPMENT UNIT TABLE   01000004
010100******************************************************************01010001
010200     EXEC SQL                                                     01020001
010300          INCLUDE TINPKSU                                         01030001
010400     END-EXEC.                                                    01040001
010500                                                                  01050001
010600***********************************************************       01060001
010700*  COPYBOOK USED IN CREATING EXTRACT FILE.                *       01070001
010800***********************************************************       01080001
010900     COPY SURD008.                                                01090022
011000                                                                  01100001
011100 EJECT                                                            01110001
011200***********************************************************       01120001
011300 PROCEDURE DIVISION.                                              01130001
011400***********************************************************       01140001
011500 0000-PROGRAM-MAINLINE.                                           01150004
011600*                                                                 01160001
011700     PERFORM 1000-INITIALIZATION.                                 01170001
011800*                                                                 01180001
011900     PERFORM 2000-PROCESS-EXTRACT-FILE                            01190004
012000         UNTIL PS-EOF-EXTRACT.                                    01200004
012100*                                                                 01210001
012200     PERFORM 9000-EOJ-ROUTINE.                                    01220004
012300*                                                                 01230001
012400     GOBACK.                                                      01240001
012500*                                                                 01250001
012600******************************************************************01260001
012700*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01270001
012800******************************************************************01280001
012900 1000-INITIALIZATION.                                             01290001
013000                                                                  01300001
013100     OPEN INPUT  WEEKLY-EXTRACT-FILE.                             01310004
013200     OPEN OUTPUT UPDATED-EXTRACT-FILE.                            01320008
013300                                                                  01330001
013400     PERFORM 8000-READ-EXTRACT-FILE                               01340011
013500     IF PS-EOF-EXTRACT                                            01350004
013600         DISPLAY 'EXTRACT FILE INP01 IS EMPTY'                    01360004
013700     END-IF.                                                      01370004
013800*                                                                 01380004
013900***************************************************************** 01390001
014000 2000-PROCESS-EXTRACT-FILE.                                       01400004
014100***************************************************************** 01410001
014200*                                                                 01420001
014300         PERFORM 7000-SELECT-TPKSLIP                              01430004
014600              PERFORM 3000-CHECK-TPKSLIP                          01460004
014700                 IF PS-VALID-RECORD                               01470007
014800                    ADD 1 TO PV-RECORDS-UNCHANGED                 01480007
014900                 ELSE                                             01490007
015000                    ADD 1 TO PV-RECORDS-CHANGED                   01500007
015100                 END-IF.                                          01510020
015700                                                                  01570004
015710     PERFORM 8100-WRITE-UPDATE-RECORD.                            01571020
015800     PERFORM 8000-READ-EXTRACT-FILE.                              01580011
015900*                                                                 01590007
019010***************************************************************** 01901007
019100 3000-CHECK-TPKSLIP.                                              01910006
019110***************************************************************** 01911007
019200*                                                                 01920007
019300         IF PKSLIP-REC-SEQ-NBR = PV-REC-SEQ-NBR                   01930007
019400             SET PS-VALID-RECORD      TO TRUE                     01940019
019410         ELSE                                                     01941019
019420             SET PS-NOT-VALID-RECORD  TO TRUE                     01942021
019500             MOVE PKSLIP-REC-SEQ-NBR  TO SU008-REC-SEQ-NBR        01950019
019700         END-IF.                                                  01970004
019800*                                                                 01980007
020200***************************************************************** 02020001
022500 7000-SELECT-TPKSLIP.                                             02250007
022510***************************************************************** 02251007
022600*                                                                 02260007
022700     INITIALIZE DCLTPKSLIP.                                       02270007
022800                                                                  02280007
022900     EXEC SQL                                                     02290007
023000         SELECT                                                   02300007
023100                B.REC_SEQ_NBR                                     02310007
023300          INTO                                                    02330007
023400                :PKSLIP-REC-SEQ-NBR                               02340014
023600          FROM                                                    02360007
023610                TPKSLIP B                                         02361014
023700              , TINPKSU A                                         02370014
023800         WHERE                                                    02380007
023900                A.SHIPT_UNT_ID       = :SU008-SHIPT-UNT-ID        02390016
024000           AND  A.PO_NBR             = B.PO_NBR                   02400008
024010           AND  A.SEQ_NBR            = B.SEQ_NBR                  02401008
024020           AND  B.VER_STAT_CDE       = 'A'                        02402008
024100     END-EXEC                                                     02410007
024200                                                                  02420007
024300     EVALUATE TRUE                                                02430007
024400         WHEN SQLCODE = ZERO                                      02440007
024500             SET PS-PKSLIP-FOUND  TO TRUE                         02450007
024600         WHEN SQLCODE = +100                                      02460007
024700             SET PS-PKSLIP-NOT-FOUND  TO TRUE                     02470007
024710             ADD 1 TO PV-RECORDS-NOT-FOUND                        02471020
024800         WHEN SQLCODE NOT EQUAL ZERO                              02480007
024900         WHEN SQLWARN0 NOT = SPACES                               02490007
025000             DISPLAY '** ABEND - SUKUT032 **'                     02500007
025100             DISPLAY '** 7000-SELECT-TPKSLIP **'                  02510007
025200             PERFORM 9300-SQL-WARNING                             02520007
025300     END-EVALUATE.                                                02530007
025400*                                                                 02540007
025500***************************************************************** 02550005
025600 8000-READ-EXTRACT-FILE.                                          02560008
025700***************************************************************** 02570005
025800*                                                                 02580007
025900     READ WEEKLY-EXTRACT-FILE                                     02590005
026000          INTO SU008-EXTRACT-RECORD                               02600005
026100     AT END                                                       02610005
026200         SET PS-EOF-EXTRACT           TO TRUE                     02620005
026300     NOT AT END                                                   02630005
026400         MOVE SU008-REC-SEQ-NBR       TO PV-REC-SEQ-NBR           02640007
026500         MOVE SU008-PO-NBR            TO PV-PO-NBR                02650007
026800         ADD 1                        TO PV-TOTAL-INPUT-READ      02680005
026900     END-READ.                                                    02690005
027000*                                                                 02700007
027010***************************************************************** 02701007
027100 8100-WRITE-UPDATE-RECORD.                                        02710007
027110***************************************************************** 02711007
027120*                                                                 02712007
027200     WRITE UPDATED-EXTRACT-RECORD                                 02720008
027300         FROM SU008-EXTRACT-RECORD                                02730007
027400     ADD 1                            TO PV-UPDATES-WRITTEN.      02740007
027500*                                                                 02750007
027710***************************************************************** 02771007
027800 9000-EOJ-ROUTINE.                                                02780004
027810***************************************************************** 02781007
027900*                                                                 02790007
028000     CLOSE WEEKLY-EXTRACT-FILE                                    02800008
028100           UPDATED-EXTRACT-FILE.                                  02810012
028200                                                                  02820004
028300     DISPLAY '**********************************'.                02830004
028400     DISPLAY '** SUKUT032 SUMMARY **'.                            02840007
028500     DISPLAY 'TOTAL INPUT RECS       = ' PV-TOTAL-INPUT-READ.     02850004
028600     DISPLAY 'TOTAL RECS WRITTEN     = ' PV-UPDATES-WRITTEN.      02860004
028700     DISPLAY 'TOTAL RECS CHANGED     = ' PV-RECORDS-CHANGED.      02870008
028710     DISPLAY 'TOTAL RECS UNCHANGED   = ' PV-RECORDS-UNCHANGED.    02871018
028800     DISPLAY '**********************************'.                02880004
028900                                                                  02890004
029000*                                                                 02900007
030910***************************************************************** 03091007
031000 9300-SQL-WARNING.                                                03100004
031001***************************************************************** 03100107
031010*                                                                 03101007
031200     CLOSE WEEKLY-EXTRACT-FILE                                    03120008
031300           UPDATED-EXTRACT-FILE.                                  03130012
031400                                                                  03140004
031500     DISPLAY '9300-SQL-WARNING'.                                  03150004
031800     DISPLAY '** ABEND **       ** = SQLWARNING'.                 03180004
031900     DISPLAY '** PROGRAM        ** = SUKUT032'.                   03190007
032000     DISPLAY 'TOTAL INPUT RECS  ** = ' PV-TOTAL-INPUT-READ.       03200010
032100     DISPLAY 'TOTAL RECS WRITTEN ** = ' PV-UPDATES-WRITTEN.       03210010
032110     DISPLAY 'TOTAL RECS CHANGED ** = ' PV-RECORDS-CHANGED.       03211010
032200     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  03220004
032300     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  03230004
032400     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  03240004
032500     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  03250004
032600     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  03260004
032700     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  03270004
032800     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  03280004
032900     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  03290004
033000                                                                  03300004
033100     MOVE +4013                       TO ABEND-CODE.              03310004
033200     CALL 'ILBOABN0' USING ABEND-CODE.                            03320004
