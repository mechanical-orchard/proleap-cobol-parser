000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT288.                                        00020000
000300 AUTHOR.         NANCY EILBES.                                    00030000
000400 DATE-WRITTEN.   JUNE 2006.                                       00040000
000500*----------------------------------------------------------------*00050000
000600*  COBOL 2 WITH DB2 SQL                                          *00060000
000700*                                                                *00070000
000800*  EXTRACT RECEIVING FOR MISSED PROFIT ASSIST DEDUCTIONS         *00080000
000900*                                                                *00090000
001000*  PROGRAM OVERVIEW:                                             *00100000
001100*                                                                *00110000
001200*  THIS PROGRAM READS THE EXTRACT FILE OF POSSIBLE MISSED ALW    *00120000
001300*  DEDUCTIONS AND GETS THE RECEIPTS NEEDED TO ALLOW THE REPORT   *00130000
001400*  TO PRESENT THE FULL PICTURE OF RECEIPTS FOR A PO.  THIS MEANS *00140000
001500*  RETRIEVING UNMATCHED RECEIPTS AND THOSE MATCHED IN A PRIOR    *00150000
001600*  FISCAL MONTH.                                                 *00160000
002400*                                                                *00170000
002500*   DB2 TABLES:                                                  *00180000
002600*  1. AP CONTROL TABLE                          (TAPCNTL)        *00190000
002700*  2. DATE ATTRIBUTE TABLE                      (TDTATTR)        *00200000
002800*  3. RECEIVING HEADER TABLE                    (TRECEIV)        *00210000
002900*  4. RECEIVING DISTRIBUTION TABLE              (TRECDIS)        *00220000
003000*  5. PURCHASE ITEM TABLE                       (TPURITM)        *00230000
003500*                                                                *00240000
003600*   INPUT:                                                       *00250000
003700*  1. MISSED PROFIT ASSIST PO RECORDS           (APRD090)        *00260000
003800*                                                                *00270000
003900*   OUTPUT:                                                      *00280000
004000*  1. MISSED PROFIT ASSIST RECEIPT RECORDS      (APRD090)        *00290000
004100*                                                                *00300000
004200*----------------------------------------------------------------*00310000
004300* CHANGE LOG:                                                    *00320000
004400* DATE  06/13/2006                                               *00330000
004500*      CHANGE MADE: INITIAL VERSION                              *00340000
004600*      MADE BY: NANCY EILBES            WR/IR #: WR30028         *00350000
004700*                                                                *00360000
004710* DATE  02/04/2008                                               *00370000
004720*      CHANGE MADE: MODIFIED RECEIVING CURSORS TO REPLACE        *00380000
004721*      C.UNT_COST_AMT WITH C.PRD_1ST_COST_AMT.                   *00390000
004730*      MADE BY: IRMA NAVA               WR/IR #: WR32664         *00400000
004740*                                                                *00410000
004800*----------------------------------------------------------------*00420000
004900/                                                                 00430000
005000 ENVIRONMENT DIVISION.                                            00440000
005100 CONFIGURATION SECTION.                                           00450000
005200 INPUT-OUTPUT SECTION.                                            00460000
005300 FILE-CONTROL.                                                    00470000
005400                                                                  00480000
005500     SELECT MISSED-POS-FILE ASSIGN TO UT-S-INP01.                 00490000
005600     SELECT MISSED-RECEIPTS-FILE ASSIGN TO UT-S-OUT01.            00500000
005700                                                                  00510000
005800 DATA DIVISION.                                                   00520000
005900 FILE SECTION.                                                    00530000
006000 FD  MISSED-POS-FILE                                              00540000
006100     RECORDING MODE IS F                                          00550000
006200     LABEL RECORDS ARE STANDARD                                   00560000
006300     BLOCK CONTAINS 0 RECORDS                                     00570000
006400     DATA RECORD IS MISSED-POS-RECORD.                            00580000
006500 01  MISSED-POS-RECORD           PIC X(120).                      00590000
006600                                                                  00600000
006700 FD  MISSED-RECEIPTS-FILE                                         00610000
006800     RECORDING MODE IS F                                          00620000
006900     LABEL RECORDS ARE STANDARD                                   00630000
007000     BLOCK CONTAINS 0 RECORDS                                     00640000
007100     DATA RECORD IS MISSED-RECEIPTS-RECORD.                       00650000
007200 01  MISSED-RECEIPTS-RECORD      PIC X(120).                      00660000
007300                                                                  00670000
007400 WORKING-STORAGE SECTION.                                         00680000
007500                                                                  00690000
007600 01  PROGRAM-WORKAREA.                                            00700000
007700     05  FILLER                  PIC  X(30)           VALUE       00710000
007800         '** BEGINING OF APKUT288 W/S **'.                        00720000
007900                                                                  00730000
008000     05  PV-CURRENT-PARAGRAPH    PIC  X(30)           VALUE SPACE.00740000
008100     05  PV-PROGRAM-NAME         PIC  X(08)           VALUE       00750000
008200         'APKUT288'.                                              00760000
008300     05  INPUT-COUNT             PIC 9(09)            VALUE  0.   00770000
008400     05  OUTPUT-COUNT            PIC 9(09)            VALUE  0.   00780000
008500     05  PV-ONE                  PIC X(1) VALUE SPACES.           00790000
008600     05  DISPLAY-PO-NBR          PIC 9(9) VALUE ZEROS.            00800000
008700     05  DISPLAY-RCVR-SEQ-NBR    PIC 9(9) VALUE ZEROS.            00810000
008800     05  PV-PO-NBR-9             PIC S9(9) VALUE ZEROS.           00820000
008900     05  PO-BEING-PROCESSED      PIC S9(9) VALUE ZEROS COMP.      00830000
009210     05  PV-RECVR-QTY            PIC S9(9) VALUE ZERO COMP-3.     00840000
009220     05  PV-RECVR-AMT            PIC S9(9)V999 VALUE ZERO COMP-3. 00850000
009230     05  PV-VERFYD-DTE           PIC X(10).                       00860000
009600                                                                  00870000
011900 01  PROGRAM-SWITCHES-SUBS.                                       00880000
012000     05  PV-EOF-SW               PIC  X(01)           VALUE 'N'.  00890000
012100         88  END-OF-POS                               VALUE 'Y'.  00900000
012200     05  PS-OUT-OF-RECEIPTS-SW   PIC X(01)            VALUE 'N'.  00910000
012300         88  OUT-OF-RECEIPTS                          VALUE 'Y'.  00920000
012400         88  MORE-RECEIPTS                            VALUE 'N'.  00930000
013100                                                                  00940000
013200 01  CONTROL-CARD.                                                00950000
013300     05  CC-RQST-BATCH-DTE         PIC X(10).                     00960000
013400         88  CC-TODAYS-BATCH           VALUE 'TODAY     '.        00970000
013410                                                                  00980000
013420*----------------------------------------------------------------*00990000
013430*  INPUT RECORD AREA                                              01000000
013440*----------------------------------------------------------------*01010000
013450     COPY APRD090 REPLACING AP090- BY PO090-.                     01020000
013460                                                                  01030000
013470*----------------------------------------------------------------*01040000
013480*  OUTPUT RECORD AREA                                             01050000
013490*----------------------------------------------------------------*01060000
013500     COPY APRD090.                                                01070000
013600                                                                  01080000
013700*----------------------------------------------------------------*01090000
013800*  AP CONTROL TABLE                                              *01100000
013900*----------------------------------------------------------------*01110000
014000     EXEC SQL                                                     01120000
014100          INCLUDE TAPCNTL                                         01130000
014200     END-EXEC.                                                    01140000
014300                                                                  01150000
014400*----------------------------------------------------------------*01160000
014500*  DATE ATTRIBUTE TABLE                                          *01170000
014600*----------------------------------------------------------------*01180000
014700     EXEC SQL                                                     01190000
014800          INCLUDE TDTATTR                                         01200000
014900     END-EXEC.                                                    01210000
015000                                                                  01220000
015100*----------------------------------------------------------------*01230000
015200*  RECEIVING HEADER TABLE                                        *01240000
015300*----------------------------------------------------------------*01250000
015400     EXEC SQL                                                     01260000
015500          INCLUDE TRECEIV                                         01270000
015600     END-EXEC.                                                    01280000
015700                                                                  01290000
015800*----------------------------------------------------------------*01300000
015900*  RECEIVING DISTRIBUTION TABLE                                  *01310000
016000*----------------------------------------------------------------*01320000
016100     EXEC SQL                                                     01330000
016200          INCLUDE TRECDIS                                         01340000
016300     END-EXEC.                                                    01350000
016400                                                                  01360000
016500*----------------------------------------------------------------*01370000
016600*  PURCHASE ORDER ITEM TABLE                                     *01380000
016700*----------------------------------------------------------------*01390000
016800     EXEC SQL                                                     01400000
016900          INCLUDE TPURITM                                         01410000
017000     END-EXEC.                                                    01420000
017100                                                                  01430000
020000*----------------------------------------------------------------*01440000
020100*    DB2 AREA FOR SYSDUMMY1                                      *01450000
020200*----------------------------------------------------------------*01460000
020300     EXEC SQL                                                     01470000
020400          INCLUDE SYSDUMMY                                        01480000
020500     END-EXEC.                                                    01490000
020600                                                                  01500000
020700*                                                                 01510000
020800*    SQL COMMUNICATIONS AREA DCLGEN                               01520000
020900*                                                                 01530000
021000     EXEC SQL                                                     01540000
021100         INCLUDE SQLCA                                            01550000
021200     END-EXEC.                                                    01560000
021300                                                                  01570000
021400*----------------------------------------------------------------*01580000
021500* RECEIVING_CSR WILL RETURN A TOTAL OF ALL RECEIPTS BY SEQUENCE  *01590000
021600* NUMBER, AND AP_PRC_DTE.  ONLY RECEIPTS THAT WERE JOURNALIZED   *01600000
021700* IN A PRIOR FISCAL MONTH OR THOSE UNJOURNALIZED ARE RETURNED.   *01610000
021900*----------------------------------------------------------------*01620000
022000     EXEC SQL                                                     01630000
022100       DECLARE RECEIVING_CSR CURSOR FOR                           01640000
022200         SELECT A.REC_SEQ_NBR                                     01650000
022300              , DATE(A.VERFYD_TMST)                               01660000
022410              , B.AP_PRC_DTE                                      01670000
022500              , SUM(B.AP_VERIFY_ITM_QTY)                          01680000
022510*IYN          , SUM(B.AP_VERIFY_ITM_QTY * C.UNT_COST_AMT)         01690000
022520              , SUM(B.AP_VERIFY_ITM_QTY * C.PRD_1ST_COST_AMT)     01700000
022600          FROM TRECEIV A                                          01710000
022700             , TRECDIS B                                          01720000
022710             , TPURITM C                                          01730000
022800         WHERE A.ORD_NBR            = :PO-BEING-PROCESSED         01740000
022900           AND A.ORD_NBR            = B.ORD_NBR                   01750000
022901           AND A.REC_SEQ_NBR        = B.REC_SEQ_NBR               01760000
022910           AND B.ORD_NBR            = C.PO_NBR                    01770000
022911           AND B.ORD_LNE_NBR        = C.APP_PO_LNE_NBR            01780000
022920           AND A.STATUS_CDE         = 'VE'                        01790000
022930           AND A.FS_POST_TMST      ^= '9999-09-09-09.09.09.999999'01800000
022940           AND A.VER_STATUS_CDE     = 'A'                         01810000
023300      GROUP BY A.REC_SEQ_NBR                                      01820000
023310             , A.VERFYD_TMST                                      01830000
023320             , B.AP_PRC_DTE                                       01840000
023330*IYN        HAVING SUM(B.AP_VERIFY_ITM_QTY * C.UNT_COST_AMT) > 0  01850000
023340            HAVING SUM(B.AP_VERIFY_ITM_QTY * C.PRD_1ST_COST_AMT)  01860000
023350             > 0                                                  01870000
023360****                                                              01880000
023400     END-EXEC.                                                    01890000
023500                                                                  01900000
024900*----------------------------------------------------------------*01910000
025000*  ABEND DATA AREAS                                              *01920000
025100*----------------------------------------------------------------*01930000
025200 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01940000
025300                                             COMP SYNC.           01950000
025400     88  AC-BAD-DATA                         VALUE +4003.         01960000
025500     88  AC-TABLE-OVERFLOW                   VALUE +4004.         01970000
025600     88  AC-DB2-ERROR                        VALUE +4013.         01980000
025700     88  AC-DATE-ERROR                       VALUE +4019.         01990000
025800                                                                  02000000
025900                                                                  02010000
026000 01  ABEND-AREAS.                                                 02020000
026100     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02030000
026200             '*****       ABEND'.                                 02040000
026300     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02050000
026400             '*****   PROGRAM: APKUT288'.                         02060000
026500     05  AA-PARAGRAPH-LIT.                                        02070000
026600         10  FILLER              PIC  X(17)  VALUE                02080000
026700             '***** PARAGRAPH: '.                                 02090000
026800         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02100000
026900     05  AA-MESSAGE-LINE.                                         02110000
027000         10  FILLER              PIC  X(06)  VALUE '*****'.       02120000
027100         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        02130000
027200     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02140000
027300             '*****    DB2 ERROR'.                                02150000
027400     05  AA-DB2-OPERATION-LIT.                                    02160000
027500         10  FILLER              PIC  X(17)  VALUE                02170000
027600             '***** OPERATION: '.                                 02180000
027700         10  AA-DB2-OPERATION.                                    02190000
027800             15  AA-DB2-OP-1     PIC  X(50)  VALUE SPACES.        02200000
027900             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02210000
028000     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        02220000
028100     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        02230000
028200     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        02240000
028300                                                                  02250000
028400     COPY DPWS004.                                                02260000
028500                                                                  02270000
028600 01  FILLER                      PIC  X(25)  VALUE                02280000
028700     '** END OF APKUT288 W/S **'.                                 02290000
028800                                                                  02300000
028900 PROCEDURE DIVISION.                                              02310000
029000                                                                  02320000
029100***************************************************************** 02330000
029200*  MAIN DRIVER PARAGRAPH                                          02340000
029300***************************************************************** 02350000
029400 A100-MAIN.                                                       02360000
029500                                                                  02370000
029600     PERFORM B100-INTIALIZE.                                      02380000
029700                                                                  02390000
029800     PERFORM B200-PROCESS-DATA                                    02400000
029900       UNTIL END-OF-POS.                                          02410000
030000                                                                  02420000
030100     PERFORM B300-END-PROGRAM.                                    02430000
030200                                                                  02440000
030300     GOBACK.                                                      02450000
030400                                                                  02460000
030500***************************************************************** 02470000
030600*  PROGRAM INITIALIZATION                                         02480000
030700***************************************************************** 02490000
030800 B100-INTIALIZE.                                                  02500000
030900                                                                  02510000
031000     MOVE 'B100-INTIALIZE'       TO   PV-CURRENT-PARAGRAPH.       02520000
031100                                                                  02530000
031200     DISPLAY '**********************************************'.    02540000
031300     DISPLAY '**        APKUT288 BEGINS HERE              **'.    02550000
031400     DISPLAY '**********************************************'.    02560000
031500                                                                  02570000
031600     OPEN INPUT  MISSED-POS-FILE                                  02580000
031700          OUTPUT MISSED-RECEIPTS-FILE.                            02590000
031800                                                                  02600000
031900     INITIALIZE DCLTAPCNTL                                        02610000
032000                DCLTDTATTR                                        02620000
032100                DCLTRECEIV                                        02630000
032200                DCLTRECDIS                                        02640000
032300                DCLTPURITM                                        02650000
032700                AP090-RECORD.                                     02660000
032800                                                                  02670000
032900     ACCEPT CONTROL-CARD.                                         02680000
033000     DISPLAY '*** CONTROL CARD FOR THIS RUN ***'                  02690000
033100     DISPLAY CONTROL-CARD.                                        02700000
033200     DISPLAY '*** END OF CONTROL CARD ***'                        02710000
033300                                                                  02720000
033400     PERFORM S100-SELECT-PROCESS-DATES.                           02730000
033500                                                                  02740000
033600     PERFORM R100-READ-MISSED-POS.                                02750000
033700                                                                  02760000
033800******************************************************************02770000
033900* PROCESS THE PO FROM THE INPUT FILE TO DETERMINE IF IT QUALIFIES*02780000
034000* FOR THE MISSED ALLOWANCE REPORT.                               *02790000
034100******************************************************************02800000
034200 B200-PROCESS-DATA.                                               02810000
034300                                                                  02820000
034400     MOVE PO090-PO-NBR TO PV-PO-NBR-9.                            02830000
034410     MOVE PV-PO-NBR-9  TO PO-BEING-PROCESSED.                     02840000
034420     SET MORE-RECEIPTS TO TRUE.                                   02850000
034440                                                                  02860000
034441     PERFORM Y100-OPEN-RECEIVING-CSR.                             02870000
034443     PERFORM R200-FETCH-RECEIPTS.                                 02880000
034444                                                                  02890000
034445     IF OUT-OF-RECEIPTS                                           02900000
034446        CONTINUE                                                  02910000
034447     ELSE                                                         02920000
034450        PERFORM C100-PROCESS-RECEIPTS                             02930000
034460     END-IF.                                                      02940000
034470                                                                  02950000
034480     PERFORM Y200-CLOSE-RECEIVING-CSR.                            02960000
036500                                                                  02970000
037074     PERFORM R100-READ-MISSED-POS.                                02980000
037075                                                                  02990000
037076***************************************************************** 03000000
037077*  END OF PROCESSING.  CLOSE FILES.  DISPLAY COUNTS.              03010000
037078***************************************************************** 03020000
037079 B300-END-PROGRAM.                                                03030000
037080                                                                  03040000
037081     MOVE 'B300-END-PROGRAM'     TO   PV-CURRENT-PARAGRAPH.       03050000
037090                                                                  03060000
037100     CLOSE  MISSED-POS-FILE                                       03070000
037200            MISSED-RECEIPTS-FILE.                                 03080000
037300                                                                  03090000
037400     DISPLAY '***** APKUT288 COUNTS *****'.                       03100000
037500     DISPLAY 'RECORDS READ    = ' INPUT-COUNT.                    03110000
037600     DISPLAY 'RECORDS WRITTEN = ' OUTPUT-COUNT.                   03120000
037700     DISPLAY '***************************'.                       03130000
037800                                                                  03140000
040800                                                                  03150000
041000                                                                  03160000
044500*----------------------------------------------------------------*03170000
044600*  FORMAT ALL REPORT OUTPUT RECORDS.                              03180000
044700*----------------------------------------------------------------*03190000
044800 C100-PROCESS-RECEIPTS.                                           03200000
044900                                                                  03210000
045000     INITIALIZE AP090-RECORD.                                     03220000
045100                                                                  03230000
045400     MOVE PO090-VENDOR-NBR       TO AP090-VENDOR-NBR.             03240000
045500     MOVE PO090-VENDOR-NAME      TO AP090-VENDOR-NAME.            03250000
045510     MOVE PO090-DEPT-NBR         TO AP090-DEPT-NBR.               03260000
045600     MOVE PO090-PO-NBR           TO AP090-PO-NBR.                 03270000
045700                                                                  03280000
045990     SET AP090-RECEIVER-DATA     TO TRUE.                         03290000
045991                                                                  03300000
045992     PERFORM UNTIL OUT-OF-RECEIPTS                                03310000
045994        MOVE RECEIV-REC-SEQ-NBR  TO AP090-RECVR-SEQ-NBR           03320000
045995        MOVE PV-RECVR-QTY        TO AP090-RECVR-QTY               03330000
045996        MOVE PV-RECVR-AMT        TO AP090-RECVR-AMT               03340000
045997        MOVE PV-VERFYD-DTE       TO AP090-RECVR-VERFYD-DTE        03350000
045999        IF  RECDIS-AP-PRC-DTE = '9999-09-09'                      03360000
046000        OR  RECDIS-AP-PRC-DTE > APCNTL-BTCH-PRC-DTE               03370000
046001            SET AP090-UNMATCHED TO TRUE                           03380000
046002        ELSE                                                      03390000
046003            IF  RECDIS-AP-PRC-DTE > DTATTR-FSCL-MN-BEG-DTE        03400000
046004            AND RECDIS-AP-PRC-DTE <= APCNTL-BTCH-PRC-DTE          03410000
046005                SET AP090-CURRENT-PERIOD TO TRUE                  03420000
046006            ELSE                                                  03430000
046007                SET AP090-PREVIOUS-PERIOD TO TRUE                 03440000
046008            END-IF                                                03450000
046009        END-IF                                                    03460000
046010        PERFORM W100-WRITE-REPORT-RECORD                          03470000
046011        PERFORM R200-FETCH-RECEIPTS                               03480000
046020     END-PERFORM.                                                 03490000
046100                                                                  03500000
047805                                                                  03510000
048000*----------------------------------------------------------------*03520000
048100*  READ THE INPUT FILE.                                           03530000
048200*----------------------------------------------------------------*03540000
048300 R100-READ-MISSED-POS.                                            03550000
048400                                                                  03560000
048500     MOVE 'R100-READ-MISSED-POS'                                  03570000
048600                                 TO   PV-CURRENT-PARAGRAPH.       03580000
048700                                                                  03590000
048800     READ MISSED-POS-FILE INTO PO090-RECORD                       03600000
048900         AT END                                                   03610000
049000             SET END-OF-POS TO TRUE.                              03620000
049100                                                                  03630000
049200     IF NOT END-OF-POS                                            03640000
049300        ADD +1 TO INPUT-COUNT                                     03650000
049400     END-IF.                                                      03660000
049500                                                                  03670000
049600*----------------------------------------------------------------*03680000
049700*  RETRIEVES THE INVOICE DATA FOR THE PO BEING PROCESSED.         03690000
049800*----------------------------------------------------------------*03700000
049900 R200-FETCH-RECEIPTS.                                             03710000
050000                                                                  03720000
050100     EXEC SQL                                                     03730000
050200         FETCH RECEIVING_CSR                                      03740000
050300         INTO :RECEIV-REC-SEQ-NBR                                 03750000
050310             ,:PV-VERFYD-DTE                                      03760000
050320             ,:RECDIS-AP-PRC-DTE                                  03770000
050400             ,:PV-RECVR-QTY                                       03780000
050500             ,:PV-RECVR-AMT                                       03790000
050700     END-EXEC.                                                    03800000
050800                                                                  03810000
050900     EVALUATE TRUE                                                03820000
051000         WHEN SQLCODE = ZERO                                      03830000
051100              CONTINUE                                            03840000
051200                                                                  03850000
051300         WHEN SQLCODE = +100                                      03860000
051400              SET OUT-OF-RECEIPTS TO TRUE                         03870000
051500                                                                  03880000
051600         WHEN SQLWARN0 NOT = SPACES                               03890000
051700         WHEN SQLCODE  NOT = ZERO                                 03900000
051800             MOVE 'R200-FETCH-RECEIPTS'    TO AA-PARAGRAPH-NAME   03910000
051900             MOVE 'UNSUCCESSFUL FETCH WITH RECEIPTS_CSR'          03920000
052000                                           TO AA-DB2-OPERATION    03930000
052100             MOVE 'TRECEIV'                TO AA-DB2-TABLE-1      03940000
052200             MOVE 'TRECDIS'                TO AA-DB2-TABLE-2      03950000
052210             MOVE 'TPURITM'                TO AA-DB2-TABLE-3      03960000
052400             PERFORM Z998-DB2-ABEND                               03970000
052500     END-EVALUATE.                                                03980000
052600                                                                  03990000
054311                                                                  04000000
054312*----------------------------------------------------------------*04010000
054313*  SELECT THE BEGIN AND END DATES FOR THE CURRENT FISCAL MONTH.   04020000
054314*----------------------------------------------------------------*04030000
054315 S100-SELECT-PROCESS-DATES.                                       04040000
054316                                                                  04050000
054317     IF  CC-TODAYS-BATCH                                          04060000
054318         EXEC SQL                                                 04070000
054319             SELECT A.BTCH_PRC_DTE                                04080000
054320                  , B.FSCL_MN_BEG_DTE                             04090000
054330                  , B.FSCL_MN_END_DTE                             04100000
054340               INTO :APCNTL-BTCH-PRC-DTE                          04110000
054350                  , :DTATTR-FSCL-MN-BEG-DTE                       04120000
054360                  , :DTATTR-FSCL-MN-END-DTE                       04130000
054370               FROM TAPCNTL  A                                    04140000
054380                  , TDTATTR  B                                    04150000
054390              WHERE A.BTCH_PRC_DTE  =  B.KY_DTE                   04160000
054400         END-EXEC                                                 04170000
054500                                                                  04180000
054600     ELSE                                                         04190000
054700         MOVE CC-RQST-BATCH-DTE TO APCNTL-BTCH-PRC-DTE            04200000
054800                                                                  04210000
054900         EXEC SQL                                                 04220000
055000             SELECT B.FSCL_MN_BEG_DTE                             04230000
055100                  , B.FSCL_MN_END_DTE                             04240000
055200               INTO                                               04250000
055300                    :DTATTR-FSCL-MN-BEG-DTE                       04260000
055400                  , :DTATTR-FSCL-MN-END-DTE                       04270000
055500               FROM                                               04280000
055600                    TDTATTR  B                                    04290000
055700              WHERE B.KY_DTE = :APCNTL-BTCH-PRC-DTE               04300000
055800         END-EXEC                                                 04310000
055810     END-IF.                                                      04320000
055820                                                                  04330000
055830     EVALUATE TRUE                                                04340000
055840         WHEN SQLCODE = ZERO                                      04350000
055841         DISPLAY 'BATCH DATE BEING USED = ' APCNTL-BTCH-PRC-DTE   04360000
055860                                                                  04370000
055870         WHEN SQLWARN0 NOT = SPACES                               04380000
055880         WHEN SQLCODE NOT  = ZERO                                 04390000
055890            MOVE 'S100-SELECT-PROCESS-DATES'                      04400000
055900                                TO AA-PARAGRAPH-NAME              04410000
056000            MOVE 'UNSUCCESSFUL SELECT OF DATES'                   04420000
056100                                TO AA-DB2-OPERATION               04430000
056200            MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                 04440000
056300            MOVE 'TDTATRR'      TO AA-DB2-TABLE-2                 04450000
056400            PERFORM Z998-DB2-ABEND                                04460000
056500     END-EVALUATE.                                                04470000
056600                                                                  04480000
070600*----------------------------------------------------------------*04490000
070700*  OPENS THE INVOICE CURSOR.                                      04500000
070800*----------------------------------------------------------------*04510000
070900 Y100-OPEN-RECEIVING-CSR.                                         04520000
071000                                                                  04530000
071100     EXEC SQL                                                     04540000
071200         OPEN RECEIVING_CSR                                       04550000
071300     END-EXEC.                                                    04560000
071400                                                                  04570000
071500     EVALUATE TRUE                                                04580000
071600         WHEN SQLCODE = ZERO                                      04590000
071700              CONTINUE                                            04600000
071800                                                                  04610000
071900         WHEN SQLWARN0 NOT = SPACES                               04620000
072000         WHEN SQLCODE  NOT = ZERO                                 04630000
072100             MOVE 'Y100-OPEN-RECEIVING-CSR' TO AA-PARAGRAPH-NAME  04640000
072200             MOVE 'UNSUCCESSFUL OPEN ON RECEIVING_CSR'            04650000
072300                                           TO AA-DB2-OPERATION    04660000
072400             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                04670000
072500             PERFORM Z998-DB2-ABEND                               04680000
072600     END-EVALUATE.                                                04690000
072700                                                                  04700000
072800*----------------------------------------------------------------*04710000
072900*  CLOSES THE RECEIVING CURSOR.                                   04720000
073000*----------------------------------------------------------------*04730000
073100 Y200-CLOSE-RECEIVING-CSR.                                        04740000
073200                                                                  04750000
073300       EXEC SQL                                                   04760000
073400           CLOSE RECEIVING_CSR                                    04770000
073500       END-EXEC.                                                  04780000
073600                                                                  04790000
073700       EVALUATE TRUE                                              04800000
073800           WHEN SQLCODE = ZERO                                    04810000
073900                CONTINUE                                          04820000
074000                                                                  04830000
074100           WHEN SQLWARN0 NOT = SPACES                             04840000
074200           WHEN SQLCODE  NOT = ZERO                               04850000
074300               MOVE 'Y200-CLOSE-RECEIVING-CSR'                    04860000
074400                                         TO AA-PARAGRAPH-NAME     04870000
074500               MOVE 'UNSUCCESSFUL CLOSE ON RECEIVING_CSR'         04880000
074600                                         TO AA-DB2-OPERATION      04890000
074700               MOVE 'TINVOIC'      TO AA-DB2-TABLE-1              04900000
074800               PERFORM Z998-DB2-ABEND                             04910000
074900       END-EVALUATE.                                              04920000
079500                                                                  04930000
079600*----------------------------------------------------------------*04940000
079700*  WRITE RECORDS TO REPORT FILE.                                  04950000
079800*----------------------------------------------------------------*04960000
079900 W100-WRITE-REPORT-RECORD.                                        04970000
080000                                                                  04980000
080100     WRITE MISSED-RECEIPTS-RECORD FROM AP090-RECORD.              04990000
080200     ADD +1 TO OUTPUT-COUNT.                                      05000000
080300                                                                  05010000
080400*----------------------------------------------------------------*05020000
080500*  ABEND ROUTINE FOR DB2 ERRORS                                   05030000
080600*----------------------------------------------------------------*05040000
080700 Z998-DB2-ABEND.                                                  05050000
080710                                                                  05060000
080720     CLOSE  MISSED-POS-FILE                                       05070000
080730            MISSED-RECEIPTS-FILE.                                 05080000
080740                                                                  05090000
080750     MOVE PO-BEING-PROCESSED TO DISPLAY-PO-NBR.                   05100000
080760     DISPLAY 'PO NBR = ' DISPLAY-PO-NBR.                          05110000
080770     DISPLAY AA-ABEND-LIT.                                        05120000
080780     DISPLAY AA-DB2-ERROR-LIT.                                    05130000
080790     DISPLAY AA-PROGRAM-LIT.                                      05140000
080800     DISPLAY AA-PARAGRAPH-LIT.                                    05150000
080900     DISPLAY AA-DB2-OPERATION-LIT.                                05160000
081000     DISPLAY AA-DB2-TABLE-1.                                      05170000
081100     DISPLAY AA-DB2-TABLE-2.                                      05180000
081200     DISPLAY AA-DB2-TABLE-3.                                      05190000
081300     SET AC-DB2-ERROR TO TRUE.                                    05200000
081400                                                                  05210000
081500     COPY DPPD004.                                                05220000
081600                                                                  05230000
081700     CALL 'ILBOABN0' USING ABEND-CODE.                            05240000
081800*---------------------------------------------------------------  05250000
081900*    ABEND ROUTINE                                                05260000
082000*---------------------------------------------------------------  05270000
082100 Z999-ABEND.                                                      05280000
082200                                                                  05290000
082300     CLOSE  MISSED-POS-FILE                                       05300000
082400            MISSED-RECEIPTS-FILE.                                 05310000
082500                                                                  05320000
082600     DISPLAY AA-ABEND-LIT.                                        05330000
082700     DISPLAY AA-PROGRAM-LIT.                                      05340000
082800     DISPLAY AA-PARAGRAPH-LIT.                                    05350000
082900     DISPLAY AA-MESSAGE-LINE.                                     05360000
083000     CALL 'ILBOABN0' USING ABEND-CODE.                            05370000
