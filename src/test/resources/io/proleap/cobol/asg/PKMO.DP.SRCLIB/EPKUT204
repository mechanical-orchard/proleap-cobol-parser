000500*----------------------------------------------------------       00050001
000600 IDENTIFICATION DIVISION.                                         00060001
000700*----------------------------------------------------------       00070001
000800 PROGRAM-ID.    EPKUT204.                                         00080001
000900 AUTHOR.        MEDHA CHOUDHURY.                                  00090001
001000 DATE-WRITTEN.  NOVEMBER 08, 2007.                                00100001
001100                                                                  00110001
001200*----------------------------------------------------------       00120001
001300*    BATCH CONTROL CARD POPULATOR FOR CORRECTIONS OFFER FILE      00130001
001400*    PROCESSING                                                   00140001
001500*----------------------------------------------------------       00150001
001600* THIS PROGRAM WILL CREATE A BATCH CONTROL CARD WITH              00160001
001700* TIMESTAMPS WHICH WILL BE USED BY AN EXTRACT PROGRAM EPKUT205    00170001
001800* TO EXTRACT ALL THE CHANGES DONE TO THE OFFERS TABLE.            00180001
002300*----------------------------------------------------------       00230001
002400* HISTORY LOG:                                                    00240001
002500*                                                                 00250001
002600*----------------------------------------------------------       00260001
002700* DATE:                                                           00270001
002800* WR/IR#:                                                         00280001
002900* PROGRAMMER:                                                     00290001
003000* DESCRIPTION:                                                    00300001
003100*                                                                 00310001
003200*----------------------------------------------------------       00320001
003300 ENVIRONMENT DIVISION.                                            00330001
003400*----------------------------------------------------------       00340001
003500 CONFIGURATION SECTION.                                           00350001
003600 SOURCE-COMPUTER. IBM-3090.                                       00360001
003700 OBJECT-COMPUTER. IBM-3090.                                       00370001
003800                                                                  00380001
003900 INPUT-OUTPUT SECTION.                                            00390001
004000                                                                  00400001
004100 FILE-CONTROL.                                                    00410001
004200                                                                  00420001
004300     SELECT CC-TIMESTAMP-FILE                                     00430002
004400       ASSIGN TO INP01.                                           00440011
004500                                                                  00450001
004600     SELECT TEMP-TIMESTAMP-FILE                                   00460011
004700       ASSIGN TO OUT01.                                           00470011
004800                                                                  00480011
004900*----------------------------------------------------------       00490001
005000 DATA DIVISION.                                                   00500001
005100*----------------------------------------------------------       00510001
005200 FILE SECTION.                                                    00520001
005300                                                                  00530001
005400 FD  CC-TIMESTAMP-FILE                                            00540002
005500     RECORDING MODE IS F                                          00550001
005600     LABEL RECORDS ARE STANDARD                                   00560001
005700     RECORD CONTAINS 80 CHARACTERS                                00570001
005800     DATA RECORD IS CC-TIMESTAMP-RECORD.                          00580002
005900                                                                  00590001
006000 01  CC-TIMESTAMP-RECORD          PIC X(80).                      00600002
006100                                                                  00610001
006200 FD  TEMP-TIMESTAMP-FILE                                          00620011
006300     RECORDING MODE IS F                                          00630011
006400     LABEL RECORDS ARE STANDARD                                   00640011
006500     RECORD CONTAINS 80 CHARACTERS                                00650011
006600     DATA RECORD IS TEMP-TIMESTAMP-RECORD.                        00660011
006700                                                                  00670011
006800 01  TEMP-TIMESTAMP-RECORD          PIC X(80).                    00680011
006900                                                                  00690011
007000*----------------------------------------------------------       00700001
007100 WORKING-STORAGE SECTION.                                         00710001
007200                                                                  00720001
007300 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      00730001
007400                                                  COMP SYNC.      00740001
007500     88  AC-INPUT-CONTROL-CARD-ERROR              VALUE +4003.    00750001
007700     88  AC-DB2-ERROR                             VALUE +4013.    00770013
008000     88  AC-CAL-SUB-ERROR                         VALUE +4019.    00800016
008100*----------------------------------------------------------       00810001
008200* PC- PROGRAM CONSTANTS                                           00820001
008300*----------------------------------------------------------       00830001
008400 01  PC-PROGRAM-CONSTANTS.                                        00840001
008500     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'EPKUT204'. 00850001
008600     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00860001
008700                                                                  00870001
008800*----------------------------------------------------------       00880001
008900* PV- PROGRAM VARIABLES                                           00890001
009000*----------------------------------------------------------       00900001
009100 01  PV-PROGRAM-VARIABLES.                                        00910001
009200     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACES.     00920001
009300     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACES.     00930001
009400     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACES.     00940001
009500     05  PV-DB2-OPERATION             PIC X(30) VALUE SPACES.     00950001
009600     05  PV-SQL-SUB                   PIC S9(4) VALUE +0 COMP.    00960001
009700     05  PV-TIMESTAMP                 PIC X(26) VALUE SPACES.     00970003
010401                                                                  01040115
010402     05  PV-DB2-TIMESTAMP.                                        01040215
010403         10  PV-DB2-YYYY             PIC X(04) VALUE SPACES.      01040315
010404         10  PV-DB2-FILLER-1         PIC X(01) VALUE '-'.         01040415
010405         10  PV-DB2-MO               PIC X(02) VALUE SPACES.      01040515
010406         10  PV-DB2-FILLER-2         PIC X(01) VALUE '-'.         01040615
010407         10  PV-DB2-DD               PIC X(02) VALUE SPACES.      01040715
010408         10  PV-DB2-FILLER-3         PIC X(01) VALUE '-'.         01040815
010409         10  PV-DB2-HH               PIC X(02) VALUE SPACES.      01040915
010410         10  PV-DB2-FILLER-4         PIC X(01) VALUE ':'.         01041015
010411         10  PV-DB2-MM               PIC X(02) VALUE SPACES.      01041115
010412         10  PV-DB2-FILLER-5         PIC X(01) VALUE ':'.         01041215
010413         10  PV-DB2-SS               PIC X(02) VALUE SPACES.      01041315
010414         10  PV-DB2-FILLER-6         PIC X(01) VALUE ':'.         01041415
010415         10  PV-DB2-MS               PIC X(06) VALUE SPACES.      01041515
010416                                                                  01041615
010417     05  PV-WORK-DATE.                                            01041715
010418         10  PV-WORK-YYYY            PIC X(04) VALUE SPACES.      01041815
010419         10  PV-WORK-FILLER-1        PIC X(01) VALUE '-'.         01041915
010420         10  PV-WORK-MO              PIC X(02) VALUE SPACES.      01042015
010421         10  PV-WORK-FILLER-2        PIC X(01) VALUE '-'.         01042115
010422         10  PV-WORK-DY              PIC X(02) VALUE SPACES.      01042215
010423                                                                  01042315
010424     05  PV-WORK-TIME.                                            01042418
010425         10  PV-WORK-HH              PIC X(02) VALUE SPACES.      01042518
010426         10  PV-WORK-MM              PIC X(02) VALUE SPACES.      01042618
010427         10  PV-WORK-SS              PIC X(02) VALUE SPACES.      01042718
010428                                                                  01042818
010433 01  PV-CC-CONTROL-CARD.                                          01043303
010434     05  PV-CC-CONTROL-CARD-DISPLY.                               01043403
010440         10  PV-CC-CONTROL-NAME-START   PIC X(09)                 01044009
010450                                           VALUE 'B-TMSTMP:'.     01045007
010460         10  PV-CC-PREV-TIMESTAMP       PIC X(26) VALUE SPACES.   01046003
010470         10  PV-CC-FILLER-1             PIC X(1) VALUE SPACES.    01047007
010480         10  PV-CC-CONTROL-NAME-END     PIC X(09)                 01048009
010491                                           VALUE 'E-TMSTMP:'.     01049107
010492         10  PV-CC-CRNT-TIMESTAMP       PIC X(26) VALUE SPACES.   01049207
010493         10  PV-CC-LAST-EXEC            PIC X(8)                  01049309
010494                                           VALUE 'RUN IND:'.      01049409
010495         10  PV-CC-LAST-EXEC-IND        PIC X(1) VALUE SPACES.    01049509
010496*---------------------------------------------------------------* 01049616
010497* PS- PROGRAM SWITCHES                                          * 01049716
010498*---------------------------------------------------------------* 01049816
010499 01  PS-PROGRAM-SWITCHES.                                         01049916
010500                                                                  01050016
010501     05  PS-TIME-ROUTINE-SW          PIC X(01) VALUE 'N'.         01050116
010502         88  PS-TIME-VALID                     VALUE 'Y'.         01050216
010503         88  PS-TIME-NOT-VALID                 VALUE 'N'.         01050316
010504                                                                  01050416
010510*----------------------------------------------------------       01051001
010600* CONTROL CARD EPCC251 LAYOUT                                     01060005
010700*----------------------------------------------------------       01070001
010800     COPY EPRD251.                                                01080001
011400                                                                  01140001
011500*----------------------------------------------------------       01150001
011600* DATE ROUTINE COPY MEMBERS                                       01160001
011700*----------------------------------------------------------       01170001
011800     COPY DPWS500.                                                01180001
011900                                                                  01190001
012000*----------------------------------------------------------       01200001
012100* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01210001
012200*----------------------------------------------------------       01220001
012300     COPY DPWS004.                                                01230001
012400                                                                  01240001
012500*----------------------------------------------------------       01250001
012600* DB2 ABEND COPYBOOK                                              01260001
012700*----------------------------------------------------------       01270001
012800     COPY SQLCA2.                                                 01280001
012900                                                                  01290001
013000*----------------------------------------------------------       01300001
013100* DB2 COMMUNICATIONS AREA                                         01310001
013200*----------------------------------------------------------       01320001
013300     EXEC SQL                                                     01330001
013400          INCLUDE SQLCA                                           01340001
013500     END-EXEC.                                                    01350001
013600                                                                  01360001
014500*----------------------------------------------------------       01450001
014600 PROCEDURE DIVISION.                                              01460001
014700*----------------------------------------------------------       01470001
014800 0000-MAINLINE.                                                   01480001
014900                                                                  01490001
015000     PERFORM 1000-INITIALIZATION.                                 01500001
015100                                                                  01510001
015200     PERFORM 2000-PROCESS-CNTL-CARDS.                             01520001
015300                                                                  01530001
015400     PERFORM 9999-WRAPUP.                                         01540001
015600                                                                  01560001
015700     GOBACK.                                                      01570001
015800                                                                  01580001
015900*0000-EXIT.                                                       01590001
016000 EJECT.                                                           01600001
016100                                                                  01610001
016200*----------------------------------------------------------       01620001
016300* 1000-INITIALIZATION.                                            01630001
016400*     INITIALIZES VARIABLES, OPENS ANY FILES, AND READS           01640001
016500*     THE INPUT FILES, SAVES VARIABLES, AND CLOSES THE INPUT      01650001
016600*     FILES.                                                      01660001
016700*----------------------------------------------------------       01670001
016800 1000-INITIALIZATION.                                             01680001
016900                                                                  01690001
017000     INITIALIZE EP251-CC-CONTROL-CARD                             01700001
017100                PV-CC-CONTROL-CARD.                               01710006
017110                                                                  01711003
017120     DISPLAY '****************************************'.          01712019
017130     DISPLAY '**          EPKUT204 STARTED          **'.          01713019
017140     DISPLAY '****************************************'.          01714019
017150                                                                  01715019
017200     OPEN INPUT CC-TIMESTAMP-FILE.                                01720003
017300                                                                  01730003
017400     PERFORM 1100-READ-INPUT-TIMESTAMP.                           01740003
017500                                                                  01750003
017510     PERFORM 1200-VALIDATE-CNTL-CARD.                             01751015
017520                                                                  01752015
017600     IF EP251-CC-CRNT-TIMESTAMP = SPACES                          01760003
017700        DISPLAY 'EMPTY CONTROL CARD'                              01770003
017900        MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH-NAME           01790003
018000        MOVE 'CONTROL CARD IS EMPTY' TO PV-OPERATION-MSG-1        01800003
018100        SET AC-INPUT-CONTROL-CARD-ERROR TO TRUE                   01810003
018200        PERFORM 9000-ABEND                                        01820003
018300     END-IF.                                                      01830003
018400                                                                  01840003
018410     MOVE EP251-CC-CONTROL-CARD                                   01841003
018420       TO PV-CC-CONTROL-CARD.                                     01842011
018430                                                                  01843003
018440     CLOSE CC-TIMESTAMP-FILE.                                     01844003
018450*1000-EXIT.                                                       01845012
018460 EJECT.                                                           01846012
018500                                                                  01850003
018600*----------------------------------------------------------       01860003
018700* 1100-READ-BATCH-DTE-CARD.                                       01870003
018800*     READS IN THE BATCH CONTROL CARD FROM PREVIOUS RUN           01880003
018900*     (EPCC251).                                                  01890003
019000*----------------------------------------------------------       01900003
019100 1100-READ-INPUT-TIMESTAMP.                                       01910006
019200                                                                  01920003
019300     READ CC-TIMESTAMP-FILE                                       01930003
019409         INTO EP251-CC-CONTROL-CARD                               01940903
019410           AT END                                                 01941015
019411             SET AC-INPUT-CONTROL-CARD-ERROR                      01941115
019412               TO TRUE                                            01941215
019413             MOVE 'INPUT CONTROL CARD EPCC251 IS EMPTY'           01941315
019414               TO PV-OPERATION-MSG-1                              01941415
019415             MOVE '1100-READ-INPUT-TIMESTAMP     '                01941515
019416               TO PV-PARAGRAPH-NAME                               01941615
019417             PERFORM 9000-ABEND                                   01941717
019418     END-READ.                                                    01941803
019419                                                                  01941913
019420                                                                  01942014
019421     DISPLAY '--------------------------------------------------'.01942114
019422     DISPLAY '        TIMESTAMP RANGE IN THE CONTROL CARD       '.01942214
019423     DISPLAY EP251-CC-CONTROL-CARD-DISPLY.                        01942314
019424     DISPLAY '--------------------------------------------------'.01942414
019425                                                                  01942514
019426*1100-EXIT.                                                       01942603
019427 EJECT.                                                           01942703
019428*----------------------------------------------------------       01942815
019429* 1200-VALIDATE-CNTL-CARD.                                        01942915
019430*     VALIDATE THE TIMESTAMP IN INPUT CONTROL CARD                01943015
019431*     (EPCC251).                                                  01943115
019432*----------------------------------------------------------       01943215
019433 1200-VALIDATE-CNTL-CARD.                                         01943315
019434                                                                  01943415
019435*     *** ABEND IF EITHER ARE EMPTY ***                           01943515
019436                                                                  01943615
019437     IF  EP251-CC-PREV-TIMESTAMP = SPACES                         01943715
019438      OR EP251-CC-CRNT-TIMESTAMP = SPACES                         01943815
019439           MOVE '1200-VALIDATE-CNTL-CARD  '                       01943915
019440             TO PV-PARAGRAPH-NAME                                 01944015
019441           MOVE 'CORR DATE CARD RANGE MISSING'                    01944115
019442             TO PV-OPERATION-MSG-1                                01944215
019443           SET AC-INPUT-CONTROL-CARD-ERROR                        01944315
019444             TO TRUE                                              01944415
019445           PERFORM 9000-ABEND                                     01944517
019446     END-IF.                                                      01944615
019447                                                                  01944715
019448***  VALIDATE THE DATE PORTION FROM  EP251-CC-PREV-TIMESTAMP      01944816
019449                                                                  01944916
019450     MOVE EP251-CC-PREV-TIMESTAMP  TO PV-DB2-TIMESTAMP.           01945016
019451                                                                  01945116
019453     MOVE PV-DB2-YYYY  TO PV-WORK-YYYY.                           01945317
019454                                                                  01945417
019455     MOVE PV-DB2-MO    TO PV-WORK-MO.                             01945517
019456                                                                  01945617
019457     MOVE PV-DB2-DD    TO PV-WORK-DY                              01945716
019458                                                                  01945817
019459                                                                  01945916
019460     PERFORM 3000-VALIDATE-DATE-INPUT.                            01946016
019461                                                                  01946116
019462*  EXTRACT THE TIME PART OF EP252-CC-PREV-TIMESTAMP FOR VALIDATION01946216
019463                                                                  01946316
019464     MOVE PV-DB2-HH TO PV-WORK-HH.                                01946417
019465                                                                  01946517
019466     MOVE PV-DB2-MM TO PV-WORK-MM.                                01946617
019467                                                                  01946717
019468     MOVE PV-DB2-SS TO PV-WORK-SS.                                01946817
019469                                                                  01946917
019470                                                                  01947016
019471     PERFORM 3100-VALIDATE-TIME-INPUT.                            01947116
019472                                                                  01947216
019473     IF PS-TIME-NOT-VALID                                         01947316
019474       MOVE '1200-VALIDATE-CNTL-CARD   '  TO PV-PARAGRAPH-NAME    01947416
019475       MOVE 'PREV TIMESTAMP TIME NOT VALID' TO PV-OPERATION-MSG-1 01947516
019476       SET AC-INPUT-CONTROL-CARD-ERROR  TO TRUE                   01947618
019477       PERFORM 9000-ABEND                                         01947717
019478     END-IF.                                                      01947816
019479                                                                  01947916
019480*  VALIDATE THE DATE PORTION FROM  EP251-CC-CRNT-TIMESTAMP   *****01948016
019481                                                                  01948116
019482     MOVE EP251-CC-CRNT-TIMESTAMP TO PV-DB2-TIMESTAMP.            01948216
019483                                                                  01948316
019484     MOVE PV-DB2-YYYY TO PV-WORK-YYYY.                            01948417
019485                                                                  01948517
019486     MOVE PV-DB2-MO   TO PV-WORK-MO.                              01948617
019487                                                                  01948717
019488     MOVE PV-DB2-DD   TO PV-WORK-DY.                              01948817
019489                                                                  01948917
019490                                                                  01949016
019491     PERFORM 3000-VALIDATE-DATE-INPUT.                            01949116
019492                                                                  01949216
019493*  EXTRACT THE TIME PART OF EP251-CC-CRNT-TIMESTAMP FOR VALIDATION01949316
019494                                                                  01949416
019495     MOVE PV-DB2-HH  TO PV-WORK-HH.                               01949517
019496                                                                  01949617
019497     MOVE PV-DB2-MM  TO PV-WORK-MM.                               01949717
019498                                                                  01949817
019499     MOVE PV-DB2-SS  TO PV-WORK-SS.                               01949917
019500                                                                  01950017
019501                                                                  01950116
019502     PERFORM 3100-VALIDATE-TIME-INPUT.                            01950216
019503                                                                  01950316
019504     IF PS-TIME-NOT-VALID                                         01950416
019505       MOVE '1200-VALIDATE-CNTL-CARD   '   TO PV-PARAGRAPH-NAME   01950516
019506       MOVE 'CURR TIMESTAMP TIME NOT VALID' TO PV-OPERATION-MSG-1 01950616
019507       SET AC-INPUT-CONTROL-CARD-ERROR  TO TRUE                   01950718
019508       PERFORM 9000-ABEND                                         01950817
019509     END-IF.                                                      01950916
019511                                                                  01951115
019512*1200-EXIT.                                                       01951215
019513 EJECT.                                                           01951315
019514*----------------------------------------------------------       01951403
019515* 2000-PROCESS-CNTL-CARDS                                         01951503
019516*     UPDATES EPCC251 CONTROL CARD FOR PROCESSING                 01951603
019517*----------------------------------------------------------       01951703
019518 2000-PROCESS-CNTL-CARDS.                                         01951803
019519                                                                  01951903
019520     PERFORM 2100-OPEN-CONTROL-CARD.                              01952003
019521                                                                  01952103
019522     PERFORM 2200-SELECT-DB2-TIMESTAMP.                           01952203
019523                                                                  01952303
019524     PERFORM 2300-UPDATE-CONTROL-CARD.                            01952403
019525                                                                  01952503
019526*2000-EXIT.                                                       01952603
019527 EJECT.                                                           01952703
019528                                                                  01952803
019529*----------------------------------------------------------       01952903
019530* 2100-OPEN-CONTROL-CARDS                                         01953003
019531*     OPENS FILE IN OUTPUT MODE                                   01953103
019532*----------------------------------------------------------       01953203
019533 2100-OPEN-CONTROL-CARD.                                          01953303
019534                                                                  01953403
019535     OPEN OUTPUT TEMP-TIMESTAMP-FILE.                             01953511
019536                                                                  01953603
019537     INITIALIZE EP251-CC-CONTROL-CARD.                            01953703
019538                                                                  01953803
019539*2100-EXIT.                                                       01953903
019540 EJECT.                                                           01954003
019541                                                                  01954103
019542*----------------------------------------------------------       01954203
019543* 2200-SELECT-DB2-TIMESTAMP.                                      01954303
019544*     RETRIEVE TIMESTAMP FROM DB2.                                01954403
019545*----------------------------------------------------------       01954503
019546 2200-SELECT-DB2-TIMESTAMP.                                       01954603
019547                                                                  01954703
019548     EXEC SQL                                                     01954803
019549          SELECT CURRENT TIMESTAMP                                01954903
019550          INTO  :PV-TIMESTAMP                                     01955003
019551          FROM   SYSIBM.SYSDUMMY1                                 01955103
019552     END-EXEC.                                                    01955203
019553                                                                  01955303
019554     IF SQLCODE NOT EQUAL ZERO                                    01955403
019555        MOVE '2200-SELECT-DB2-TIME' TO PV-PARAGRAPH-NAME          01955503
019556        MOVE 'CANNOT GET CURRENT TIMESTAMP'                       01955603
019557                                      TO PV-DB2-OPERATION         01955703
019558        PERFORM 9100-SQL-ABEND                                    01955803
019559     END-IF.                                                      01955903
019560                                                                  01956003
019561*2200-EXIT.                                                       01956103
019562 EJECT.                                                           01956203
019563                                                                  01956303
019564*----------------------------------------------------------       01956403
019565* 2300-UPDATE-CONTROL-CARD.                                       01956503
019566*     UPDATE THE VALUES IN CONTROL CAR AND WRITE IT OUT.          01956603
019567*     THIS PARAGRAPH ALSO CHECKS IF THE LAST EXECUTION OF THE     01956707
019568*     CORRECTIONS PROCESS WAS SUCCESSFUL (IND = Y)                01956807
019569*     IF IT FAILED (N) IT WOULD MOVE THE PREV TIMESTAMP FROM      01956907
019570*     THE CONTROL CARD SO THAT ANY CHANGES ARE NOT MISSED.        01957007
019571*----------------------------------------------------------       01957103
019572 2300-UPDATE-CONTROL-CARD.                                        01957203
019573                                                                  01957303
019574     MOVE PV-CC-CONTROL-NAME-START TO EP251-CC-CONTROL-NAME-START.01957412
019575                                                                  01957510
019576     MOVE PV-CC-CONTROL-NAME-END TO EP251-CC-CONTROL-NAME-END.    01957612
019577                                                                  01957710
019578     MOVE PV-CC-LAST-EXEC       TO  EP251-CC-LAST-EXEC.           01957812
019579                                                                  01957910
019580     IF PV-CC-LAST-EXEC-IND = 'N'                                 01958010
019581        MOVE PV-CC-PREV-TIMESTAMP TO EP251-CC-PREV-TIMESTAMP      01958110
019582     ELSE                                                         01958210
019583        MOVE PV-CC-CRNT-TIMESTAMP TO EP251-CC-PREV-TIMESTAMP      01958310
019584     END-IF.                                                      01958410
019585                                                                  01958510
019586     MOVE PV-TIMESTAMP TO EP251-CC-CRNT-TIMESTAMP.                01958610
019587                                                                  01958710
019588     MOVE 'N' TO EP251-CC-LAST-EXEC-IND.                          01958810
019589                                                                  01958910
019590     WRITE TEMP-TIMESTAMP-RECORD                                  01959011
019591        FROM EP251-CC-CONTROL-CARD.                               01959110
019592                                                                  01959210
019593     CLOSE TEMP-TIMESTAMP-FILE.                                   01959311
019594                                                                  01959410
019595*2300-EXIT.                                                       01959510
019596 EJECT.                                                           01959610
019597                                                                  01959710
019598***************************************************************** 01959816
019599* 3000-VALIDATE-DATE-INPUT.                                     * 01959916
019600*     VALIDATE THE DATE INPUT BY CALLING THE KOHLS CALENDAR     * 01960016
019601*     ROUTINE AND CHECKING TO SEE WHETHER IT THROWS AN ERROR.   * 01960116
019602***************************************************************** 01960216
019603 3000-VALIDATE-DATE-INPUT.                                        01960316
019604     MOVE '3000-VALIDATE-DATE-INPUT      '                        01960416
019605       TO PV-PARAGRAPH-NAME.                                      01960516
019606                                                                  01960616
019607     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01960716
019608     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     01960816
019609     SET DPG52-LK-DTE-ISO-FMT  TO TRUE.                           01960916
019611                                                                  01961116
019612     MOVE PV-WORK-DATE TO DPG52-LK-DATE-INPUT.                    01961216
019613                                                                  01961316
019614     CALL DP500-KOHLS-CALENDAR-ROUTINE                            01961416
019615       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 01961516
019616                                                                  01961616
019617     EVALUATE TRUE                                                01961716
019618       WHEN DPG54-NO-ERROR                                        01961816
019619         CONTINUE                                                 01961916
019620       WHEN OTHER                                                 01962016
019621         DISPLAY ' '                                              01962116
019622         DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'        01962216
019623         DISPLAY '** CALLED BY 3000-VALIDATE-DATE-INPUT'          01962316
019624         DISPLAY '** ERROR MESSAGE = '  DPG54-ERROR-MESSAGE       01962416
019625         DISPLAY '** DPG52 = ' DPG52                              01962516
019626         MOVE '3000-VALIDATE-DATE-INPUT ' TO PV-PARAGRAPH-NAME    01962616
019627         MOVE 'INVALID DATE PASSED IN CC' TO PV-OPERATION-MSG-1   01962716
019628         MOVE DPG54-ERROR-MESSAGE  TO PV-OPERATION-MSG-2          01962816
019629         SET AC-CAL-SUB-ERROR    TO TRUE                          01962916
019630         PERFORM 9000-ABEND                                       01963016
019631     END-EVALUATE.                                                01963116
019632                                                                  01963216
019633*3000-EXIT.                                                       01963316
019634 EJECT.                                                           01963416
019635                                                                  01963516
019636***************************************************************** 01963616
019637* 3100-VALIDATE-TIME-INPUT.                                     * 01963716
019638***************************************************************** 01963816
019639 3100-VALIDATE-TIME-INPUT.                                        01963916
019640                                                                  01964016
019641     SET PS-TIME-NOT-VALID  TO TRUE.                              01964116
019642                                                                  01964216
019643     IF PV-WORK-HH >= ZERO                                        01964316
019644       AND PV-WORK-HH < 24                                        01964416
019645         AND PV-WORK-MM >= 0                                      01964516
019646           AND PV-WORK-MM < 60                                    01964616
019647             AND PV-WORK-SS >= 0                                  01964716
019648               AND PV-WORK-SS < 60                                01964816
019649                 SET PS-TIME-VALID  TO TRUE                       01964916
019650     ELSE                                                         01965016
019651       SET PS-TIME-NOT-VALID  TO TRUE                             01965116
019652     END-IF.                                                      01965216
019653                                                                  01965316
019654*3100-EXIT.                                                       01965416
019655 EJECT.                                                           01965516
019656                                                                  01965616
019657*----------------------------------------------------------       01965710
019658* 9000-ABEND.                                                     01965810
019659*     ABEND PROGRAM WHEN A NON DB2 ERROR OCCURS.                  01965910
019660*----------------------------------------------------------       01966010
019661 9000-ABEND.                                                      01966110
019662                                                                  01966210
019663     DISPLAY '** ABEND           **'                              01966310
019664     DISPLAY '** PROGRAM         **' PC-PROGRAM-NAME.             01966410
019665     DISPLAY '** PARAGRAPH       **' PV-PARAGRAPH-NAME.           01966510
019666     DISPLAY '** OPERATION       **' PV-OPERATION-MSG-1.          01966610
019667     DISPLAY '**                 **' PV-OPERATION-MSG-2.          01966710
019668     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         01966810
019669                                                                  01966910
019670*9000-EXIT.                                                       01967010
019671 EJECT.                                                           01967110
019672                                                                  01967210
019673*----------------------------------------------------------       01967310
019674* 9100-SQL-ABEND.                                                 01967410
019675*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE        01967510
019676*     OCCURS.                                                     01967610
019677*----------------------------------------------------------       01967710
019678 9100-SQL-ABEND.                                                  01967810
019679                                                                  01967910
019680     SET AC-DB2-ERROR TO TRUE.                                    01968010
019681                                                                  01968110
019682     DISPLAY '** ABEND     **'.                                   01968210
019683     DISPLAY '** PROGRAM   **' PC-PROGRAM-NAME.                   01968310
019684     DISPLAY '** PARAGRAPH **' PV-PARAGRAPH-NAME.                 01968410
019685     DISPLAY '** OPERATION **' PV-DB2-OPERATION.                  01968510
019686                                                                  01968610
019687     COPY DPPD004.                                                01968710
019688     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         01968810
019689                                                                  01968910
019690*9100-EXIT.                                                       01969010
019691 EJECT.                                                           01969110
019692                                                                  01969210
019693*----------------------------------------------------------       01969310
019694* 9999-WRAPUP.                                                    01969410
019695*     DISPLAYS ANY NEEDED INFORMATION                             01969510
019696*----------------------------------------------------------       01969610
019697 9999-WRAPUP.                                                     01969710
019698                                                                  01969810
019699     DISPLAY '***********************************************'.   01969911
019700     DISPLAY '**     EOJ STATISTICS FOR EPKUT204           **'    01970011
019701     DISPLAY '***********************************************'.   01970111
019702                                                                  01970211
019703     DISPLAY ' '.                                                 01970314
019704     DISPLAY '--------------------------------------------------'.01970414
019705     DISPLAY '   NEW  TIMESTAMP RANGE IN THE CONTROL CARD       '.01970514
019706     DISPLAY EP251-CC-CONTROL-CARD-DISPLY.                        01970614
019707     DISPLAY '--------------------------------------------------'.01970714
019708                                                                  01970810
019710*9999-EXIT.                                                       01971010
019800 EJECT.                                                           01980010
