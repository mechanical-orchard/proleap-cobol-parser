000100 IDENTIFICATION DIVISION.                                         00010055
000200 PROGRAM-ID.     APKUT066.                                        00020055
000300 AUTHOR.         R BERNOSKI.                                      00030055
000400*DATE-WRITTEN.   DECEMBER 30, 1997.                               00040055
000500*DATE-COMPILED.                                                   00050055
000600****************************************************************  00060061
000700* COBOL 2 WITH SQL                                             *  00070061
000800*--------------------------------------------------------------*  00080061
000900* PURGE AGED INVOICES WITH DELETE STATUS                       *  00090061
001000*--------------------------------------------------------------*  00100061
001200* INPUT:                                                       *  00120061
001300* 1. INVOICE TABLE                             (TINVOIC)       *  00130061
001400* 2. AP CONTROL TABLE                          (TAPCNTL)       *  00140061
001500*                                                              *  00150061
001600* OUTPUT:                                                      *  00160061
001700* 1. FILE OF INVOICES TO BE DELETED           (APRD067)        *  00170061
001900*--------------------------------------------------------------*  00190061
002000* CHANGE LOG:                                               *     00200055
002100*                                                           *     00210055
002200* 07/12/94    INITIAL VERSION.                              *     00220055
002300* 05/26/98    CHANGED THE PURGE CRITERIA FOR MI'S AND EI'S  *     00230055
002400*             TO 1 YEAR INSTEAD OF 90 DAYS.                 *     00240055
002500* MADE BY:  ROBIN BERNOSKI                     WR#:  6196   *     00250055
002600*                                                           *     00260055
002700* 05/26/98    CHANGED THE PURGE CRITERIA FOR RI'S FROM 1    *     00270055
002800*             YEAR TO 3 YEARS.                              *     00280055
002900* MADE BY:  ROBIN BERNOSKI                     WR#: 10258   *     00290055
003000*                                                           *     00300055
003010* 06/17/2002                                                *     00301056
003020*    ARK PO PROJECT PHASE 1.  RECOMPILE FROM PRODUCTION.    *     00302056
003030* MADE BY: KEVIN CATLIN                    WR# 23500        *     00303056
003040*                                                           *     00304056
003050* 06/20/2002                                                *     00305058
003060*    ARK PO PROJECT PHASE 1.  REMOVED ALL REFERENCES TO     *     00306057
003061*    TABLE TPAYREQ.                                         *     00306157
003070* MADE BY: KEVIN CATLIN                    WR# 23500        *     00307057
003080*                                                           *     00308057
003090* 03/11/2007                                                *     00309063
003091*    MATCH BY DC -- ALTERED THE TINVOIC_CSR SELECT          *     00309159
003092*    STATEMENT TO INCLUDE THE DC_NBR AND MTCH_LVL_CDE FIELDS*     00309259
003093*    AND CHANGED THE FETCH STATEMENT ACCORDINGLY.  IN       *     00309359
003094*    PARAGRAPH B200-PROCESSING, ADDED THE FIELDS            *     00309459
003095*    INVOIC-DC-NBR AND INVOIC-MTCH-LVL-CDE TO BE MOVED TO   *     00309559
003096*    THE APRD067 OUTPUT COPYBOOK.                           *     00309659
003097* MADE BY: KRYSTEN LEARY                   WR# 21578        *     00309759
003098*                                                           *     00309864
003099* DATE  11/14/2014                                          *     00309964
003100*      RECOMPILED THE PROGRAM. CHANGES WERE MADE TO APRD067 *     00310064
003101*      COPYBOOK.                                            *     00310164
003102*      MADE BY: COGNIZANT              WR/IR: CHG0094517    *     00310264
003103*************************************************************     00311064
003200                                                                  00320055
003300 ENVIRONMENT DIVISION.                                            00330055
003500 INPUT-OUTPUT SECTION.                                            00350055
003600                                                                  00360055
003700 FILE-CONTROL.                                                    00370055
003900     SELECT APOUT-APULL-FILE      ASSIGN TO UT-S-OUT01.           00390061
004100                                                                  00410055
004200 DATA DIVISION.                                                   00420055
004400 FILE SECTION.                                                    00440055
004500                                                                  00450055
004600 FD  APOUT-APULL-FILE                                             00460055
004700         LABEL RECORDS  ARE STANDARD                              00470055
004800         RECORDING MODE IS  F                                     00480055
004900         DATA RECORD    IS  APOUT-APULL-RECORD.                   00490055
005100 01  APOUT-APULL-RECORD            PIC X(80).                     00510055
005200                                                                  00520055
005400 WORKING-STORAGE SECTION.                                         00540055
005500                                                                  00550055
005600 01  FILLER                        PIC X(25) VALUE                00560055
005700                             'WS FOR APKUT066 BEGINS==>'.         00570055
005800                                                                  00580055
005900 01  DATE-TIME-TMST.                                              00590055
006000     05 DT-DATE                    PIC X(10) VALUE SPACES.        00600055
006100     05 DT-TIME                    PIC X(16) VALUE                00610055
006200                                       '-00.00.00.000000'.        00620055
006300 01  DT-TMST                       PIC X(26) VALUE SPACES.        00630055
006400                                                                  00640055
006500 01  INVOICE-TMST.                                                00650055
006600     05 INV-DATE                   PIC X(10) VALUE SPACES.        00660055
006700     05 INV-TIME                   PIC X(16) VALUE                00670055
006800                                       '-00.00.00.000000'.        00680055
006900                                                                  00690055
007000 01  INV-TMST                      PIC X(26) VALUE SPACES.        00700055
007100                                                                  00710055
007200 01  REMAINDER-TMST.                                              00720055
007300     05 RI-DATE                    PIC X(10) VALUE SPACES.        00730055
007400     05 RI-TIME                    PIC X(16) VALUE                00740055
007500                                       '-00.00.00.000000'.        00750055
007600                                                                  00760055
007700 01  RI-TMST                       PIC X(26) VALUE SPACES.        00770055
007800                                                                  00780055
007900 01  WS-RETRY-COUNTER              PIC S9(4) COMP VALUE ZERO.     00790055
008000 01  WS-RETRY-MAX                  PIC S9(4) COMP VALUE 3.        00800055
008100                                                                  00810055
008200 01  WS-SWITCH-AREA.                                              00820055
008300     05  WS-FETCH-END-SW           PIC X(03)  VALUE 'NO '.        00830055
008400         88  WS-END-OF-FETCH                  VALUE 'YES'.        00840055
008500         88  WS-NOT-END-OF-FETCH              VALUE 'NO '.        00850055
008600                                                                  00860055
008900 01  WS-PROGRAM-COUNTERS.                                         00890055
009000     05  WS-APOUT-REC-CNT        PIC S9(09)   VALUE ZEROS.        00900055
009100     05  WS-ROWS-FETCHED         PIC S9(05) VALUE ZEROS.          00910055
009200     05  WS-RECORDS-WRITTEN      PIC S9(05) VALUE ZEROES.         00920055
009300                                                                  00930055
009310*--------------------------------------------------------------*  00931061
009320* SQLCA FORMATTED MESSAGE AREA                                 *  00932061
009330*--------------------------------------------------------------*  00933061
009400     COPY DPWS004.                                                00940055
009500                                                                  00950055
009510*--------------------------------------------------------------*  00951061
009520* OUTPUT FILE LAYOUT                                           *  00952061
009530*--------------------------------------------------------------*  00953061
009600     COPY APRD067.                                                00960055
009700                                                                  00970055
009800 01  FILLER                      PIC X(35)  VALUE                 00980055
009900     'END OF AP WORK RECORD AREA       **'.                       00990055
010000                                                                  01000055
010010*--------------------------------------------------------------*  01001061
010020* ABEND AREA                                                   *  01002061
010030*--------------------------------------------------------------*  01003061
010100 01  WS-ABEND-FIELDS.                                             01010055
010200     05  WS-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT066'. 01020055
010300     05  WS-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     01030055
010400     05  WS-ABEND-OPERATION           PIC X(50) VALUE SPACES.     01040055
010500     05  WS-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     01050055
010600     05  WS-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     01060055
010700     05  WS-ABEND-STATUS              PIC XX    VALUE SPACES.     01070055
010800                                                                  01080055
010900 01  ABEND-CODE                    PIC S9(4) COMP SYNC            01090055
011000                                             VALUE ZEROS.         01100055
011100     88 AP-TABLE-FULL              VALUE +4004.                   01110055
011200     88 AP-EMPTY-FILE              VALUE +4005.                   01120055
011300     88 AP-DB2-ERROR               VALUE +4013.                   01130055
011400                                                                  01140055
011500*--------------------------------------------------------------*  01150061
011600* COMMUNICATIONS AREA FOR DB2                                  *  01160061
011700*--------------------------------------------------------------*  01170061
011800     COPY SQLCA2.                                                 01180055
012000                                                                  01200055
012100     EXEC SQL                                                     01210055
012200          INCLUDE SQLCA                                           01220055
012300     END-EXEC.                                                    01230055
012400                                                                  01240055
012410*--------------------------------------------------------------*  01241061
012420* INVOICE TABLE                                                *  01242061
012500*--------------------------------------------------------------*  01250061
012600     EXEC SQL                                                     01260055
012700          INCLUDE TINVOIC                                         01270055
012800     END-EXEC.                                                    01280055
012900                                                                  01290055
013010*--------------------------------------------------------------*  01301061
013020* AP CONTROL TABLE                                             *  01302061
013030*--------------------------------------------------------------*  01303061
013100     EXEC SQL                                                     01310055
013200          INCLUDE TAPCNTL                                         01320055
013300     END-EXEC.                                                    01330055
013400                                                                  01340055
013600*--------------------------------------------------------------*  01360061
013700* TINVOIC_CSR CURSOR                                           *  01370061
013800*--------------------------------------------------------------*  01380061
014100     EXEC SQL                                                     01410055
014200          DECLARE TINVOIC_CSR CURSOR FOR                          01420055
014300            SELECT                                                01430055
014400               PO_NBR                                             01440057
014500              ,INVC_ID                                            01450057
014600              ,PAYT_REQ_SEQ_NBR                                   01460057
014700              ,INVC_TYP_CDE                                       01470057
014800              ,GRO_COST_AMT                                       01480057
014900              ,STR_NBR                                            01490057
015000              ,STATUS_CDE                                         01500057
015100              ,STATUS_CHG_TMST                                    01510057
015110              ,DC_NBR                                             01511060
015120              ,MTCH_LVL_CDE                                       01512060
015200            FROM                                                  01520055
015300               TINVOIC                                            01530057
015500            WHERE                                                 01550055
015600                   STATUS_CDE       =  'DE'                       01560057
015700              AND  INVC_TYP_CDE    IN  ('WO')                     01570057
015800              AND  STATUS_CHG_TMST  <  :DT-TMST                   01580057
016000                                                                  01600055
016100          UNION ALL                                               01610055
016200                                                                  01620055
016300            SELECT                                                01630055
016400               PO_NBR                                             01640057
016500              ,INVC_ID                                            01650057
016600              ,PAYT_REQ_SEQ_NBR                                   01660057
016700              ,INVC_TYP_CDE                                       01670057
016800              ,GRO_COST_AMT                                       01680057
016900              ,STR_NBR                                            01690057
017000              ,STATUS_CDE                                         01700057
017100              ,STATUS_CHG_TMST                                    01710057
017110              ,DC_NBR                                             01711059
017120              ,MTCH_LVL_CDE                                       01712059
017200            FROM                                                  01720055
017300               TINVOIC                                            01730057
017500            WHERE                                                 01750055
017600                   STATUS_CDE       =  'DE'                       01760057
017700              AND  INVC_TYP_CDE    IN  ('MI','EI')                01770057
017800              AND  STATUS_CHG_TMST  <  :INV-TMST                  01780057
018000                                                                  01800055
018100          UNION ALL                                               01810055
018200                                                                  01820055
018300            SELECT                                                01830055
018400               PO_NBR                                             01840057
018500              ,INVC_ID                                            01850057
018600              ,PAYT_REQ_SEQ_NBR                                   01860057
018700              ,INVC_TYP_CDE                                       01870057
018800              ,GRO_COST_AMT                                       01880057
018900              ,STR_NBR                                            01890057
019000              ,STATUS_CDE                                         01900057
019100              ,STATUS_CHG_TMST                                    01910057
019110              ,DC_NBR                                             01911059
019120              ,MTCH_LVL_CDE                                       01912059
019200            FROM                                                  01920055
019300               TINVOIC                                            01930057
019500            WHERE                                                 01950055
019600                   STATUS_CDE       =  'DE'                       01960057
019700              AND  INVC_TYP_CDE    IN  ('RI')                     01970057
019800              AND  STATUS_CHG_TMST  <  :RI-TMST                   01980057
020000     END-EXEC.                                                    02000055
020200                                                                  02020055
020300 01  FILLER                        PIC X(25) VALUE                02030055
020400          '<====WS FOR APKUT066 ENDS'.                            02040055
020700                                                                  02070055
020800*-------------------------*                                       02080061
020900 PROCEDURE DIVISION.                                              02090055
021000*-------------------------*                                       02100061
021100 A100-MAINLINE.                                                   02110055
021200                                                                  02120055
021300     PERFORM B100-HOUSEKEEPING                                    02130055
021400     PERFORM B200-PROCESSING                                      02140055
021500             UNTIL WS-END-OF-FETCH                                02150055
021700     PERFORM B300-END-OF-JOB                                      02170055
021900     GOBACK.                                                      02190055
022100                                                                  02210055
022400*--------------------------------------------------------------*  02240061
022500* CALCULATE DATE USED FOR DELETING INOVICES BASED ON THE       *  02250061
022600* BTCH_PRC_DTE FROM TAPCNTL TABLE.                             *  02260061
022700*--------------------------------------------------------------*  02270061
022710 B100-HOUSEKEEPING.                                               02271061
022800                                                                  02280061
022900     OPEN  OUTPUT  APOUT-APULL-FILE.                              02290055
023000                                                                  02300055
023100     INITIALIZE DCLTINVOIC                                        02310057
023300                DCLTAPCNTL.                                       02330057
023400                                                                  02340055
023500     EXEC SQL                                                     02350055
023600         SELECT (BTCH_PRC_DTE - 90 DAYS)                          02360055
023700               ,(BTCH_PRC_DTE -  1 YEAR)                          02370055
023800               ,(BTCH_PRC_DTE -  3 YEARS)                         02380055
023900         INTO   :DT-DATE                                          02390055
024000               ,:INV-DATE                                         02400055
024100               ,:RI-DATE                                          02410055
024200         FROM   TAPCNTL                                           02420055
024300     END-EXEC.                                                    02430055
024400                                                                  02440055
024500     MOVE DATE-TIME-TMST TO DT-TMST                               02450055
024600     MOVE INVOICE-TMST TO INV-TMST                                02460055
024700     MOVE REMAINDER-TMST TO RI-TMST                               02470055
024800                                                                  02480055
024900     DISPLAY DT-TMST                                              02490055
025000     DISPLAY INV-TMST                                             02500055
025100     DISPLAY RI-TMST                                              02510055
025200                                                                  02520055
025300     PERFORM Y100-OPEN-CURSOR.                                    02530055
025400     PERFORM R100-FETCH-INVOIC.                                   02540055
025500     IF   WS-END-OF-FETCH                                         02550055
025600          DISPLAY '**********************************'            02560055
025700          DISPLAY '*   EMPTY INVOICE TABLE          *'            02570055
025800          DISPLAY '*   PROGRAM ** = APKUT066        *'            02580055
025900          DISPLAY '**********************************'            02590055
026000     END-IF.                                                      02600055
026100                                                                  02610055
026500*--------------------------------------------------------------*  02650061
026600* FORMAT INVOICES TO OUTPUT LAYOUT                             *  02660061
026700*--------------------------------------------------------------*  02670061
026710 B200-PROCESSING.                                                 02671061
026800                                                                  02680061
026900     MOVE INVOIC-PAYT-REQ-SEQ-NBR TO AP067-PAYT-REQ-SEQ-NBR.      02690055
027000     MOVE INVOIC-PO-NBR           TO AP067-PO-NBR.                02700057
027100     MOVE INVOIC-INVC-ID          TO AP067-INVC-ID.               02710055
027200     MOVE INVOIC-STATUS-CDE       TO AP067-STATUS-CDE.            02720055
027300     MOVE INVOIC-GRO-COST-AMT     TO AP067-GRO-COST-AMT.          02730055
027400     MOVE INVOIC-STR-NBR          TO AP067-STR-NBR.               02740055
027500     MOVE INVOIC-STATUS-CHG-TMST  TO AP067-STATUS-CHG-TMST.       02750059
027600     MOVE INVOIC-INVC-TYP-CDE     TO AP067-INVC-TYP-CDE.          02760059
027610     MOVE INVOIC-DC-NBR           TO AP067-DC-NBR.                02761059
027620     MOVE INVOIC-MTCH-LVL-CDE     TO AP067-MTCH-LVL-CDE.          02762059
027700                                                                  02770055
027900     PERFORM W100-WRITE-OUTPUT                                    02790055
028000     PERFORM R100-FETCH-INVOIC.                                   02800055
028100                                                                  02810055
028400*--------------------------------------------------------------*  02840061
028500* FINISH THE ERROR PROCESS, REPORT ON NECESSARY TOTALS, AND    *  02850061
028600* CLOSE ALL FILES                                              *  02860061
028700*--------------------------------------------------------------*  02870061
028710 B300-END-OF-JOB.                                                 02871061
028800                                                                  02880061
028900     DISPLAY 'ROWS FETCHED = ' WS-ROWS-FETCHED                    02890055
029000     DISPLAY 'RECORDS WRITTEN = ' WS-RECORDS-WRITTEN              02900055
029100                                                                  02910055
029200     PERFORM Y200-CLOSE-CURSOR                                    02920055
029300     CLOSE APOUT-APULL-FILE.                                      02930055
029400                                                                  02940055
029500*--------------------------------------------------------------*  02950061
029510* FETCH TINVOIC_CSR CURSOR                                     *  02951061
029530*--------------------------------------------------------------*  02953061
029600 R100-FETCH-INVOIC.                                               02960055
029700                                                                  02970055
029800     PERFORM WITH TEST AFTER                                      02980055
029900        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      02990055
030000        UNTIL   WS-RETRY-COUNTER > WS-RETRY-MAX OR                03000055
030100                SQLCODE = ZERO OR                                 03010055
030200                SQLCODE = +100                                    03020055
030300        EXEC SQL                                                  03030055
030400            FETCH TINVOIC_CSR                                     03040055
030500            INTO :INVOIC-PO-NBR                                   03050057
030600               , :INVOIC-INVC-ID                                  03060055
030700               , :INVOIC-PAYT-REQ-SEQ-NBR                         03070057
030800               , :INVOIC-INVC-TYP-CDE                             03080057
030900               , :INVOIC-GRO-COST-AMT                             03090055
031000               , :INVOIC-STR-NBR                                  03100057
031100               , :INVOIC-STATUS-CDE                               03110057
031200               , :INVOIC-STATUS-CHG-TMST                          03120057
031210               , :INVOIC-DC-NBR                                   03121059
031220               , :INVOIC-MTCH-LVL-CDE                             03122059
031300        END-EXEC                                                  03130055
031400                                                                  03140055
031500                                                                  03150055
031600        EVALUATE TRUE                                             03160055
031700            WHEN SQLCODE = ZERO                                   03170055
031800                 ADD 1 TO WS-ROWS-FETCHED                         03180055
031900            WHEN SQLCODE = +100                                   03190055
032000                 SET WS-END-OF-FETCH TO TRUE                      03200055
032100            WHEN SQLCODE = -904                                   03210055
032200            WHEN SQLCODE = -913                                   03220055
032300              CONTINUE                                            03230055
032400            WHEN SQLWARN0 NOT = SPACES                            03240055
032500            WHEN SQLCODE  NOT = ZERO                              03250055
032600              MOVE 'R100-FETCH                    '               03260055
032700                            TO WS-ABEND-PARAGRAPH                 03270055
032800              MOVE 'UNSUCCESSFUL FETCH  INVOIC'                   03280055
032900                            TO WS-ABEND-OPERATION                 03290055
033000              MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1             03300055
033100              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             03310057
033200              PERFORM Z999-SQL-ERROR                              03320055
033300           END-EVALUATE                                           03330055
033400     END-PERFORM.                                                 03340055
033500                                                                  03350055
033600     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           03360055
033700         MOVE 'R100-FETCH                    '                    03370055
033800                       TO WS-ABEND-PARAGRAPH                      03380055
033900         MOVE 'MAX RETRIES EXCEEDED ON FETCH  INVOIC'             03390055
034000                         TO WS-ABEND-OPERATION                    03400055
034100         PERFORM Z999-SQL-ERROR                                   03410055
034200     END-IF.                                                      03420055
034300                                                                  03430055
034310*--------------------------------------------------------------*  03431061
034320* WRITE OUTPUT RECORD                                          *  03432061
034330*--------------------------------------------------------------*  03433061
034400 W100-WRITE-OUTPUT.                                               03440055
034500                                                                  03450055
034600     WRITE APOUT-APULL-RECORD     FROM AP067-RECORD.              03460055
034800     ADD 1                        TO WS-RECORDS-WRITTEN.          03480061
034900                                                                  03490055
034910*--------------------------------------------------------------*  03491061
034920* OPEN TINVOIC_CSR CURSOR                                      *  03492061
034930*--------------------------------------------------------------*  03493061
035000 Y100-OPEN-CURSOR.                                                03500055
035100                                                                  03510055
035200     PERFORM WITH TEST AFTER                                      03520055
035300             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 03530055
035400             UNTIL   WS-RETRY-COUNTER > WS-RETRY-MAX OR           03540055
035500                     SQLCODE = ZERO                               03550055
035600                                                                  03560055
035700             EXEC SQL                                             03570055
035800                OPEN TINVOIC_CSR                                  03580055
035900             END-EXEC                                             03590055
036000                                                                  03600055
036100             EVALUATE TRUE                                        03610055
036200                 WHEN SQLCODE = ZERO                              03620055
036300                 WHEN SQLCODE = -904                              03630055
036400                 WHEN SQLCODE = -913                              03640055
036500                      CONTINUE                                    03650055
036600                                                                  03660055
036700                 WHEN SQLWARN0 NOT = SPACES                       03670055
036800                 WHEN SQLCODE  NOT = ZERO                         03680055
036900                      MOVE 'Y100-OPEN-CURSOR             '        03690055
037000                                    TO WS-ABEND-PARAGRAPH         03700055
037100                      MOVE 'UNSUCCESSFUL OPEN   INVOIC'           03710055
037200                                    TO WS-ABEND-OPERATION         03720055
037300                      MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1     03730055
037400                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     03740057
037500                      PERFORM Z999-SQL-ERROR                      03750055
037600             END-EVALUATE                                         03760055
037700     END-PERFORM.                                                 03770055
037800                                                                  03780055
037900     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           03790055
038000         MOVE 'Y100-OPEN-CURSOR             '                     03800055
038100                       TO WS-ABEND-PARAGRAPH                      03810055
038200         MOVE 'MAX RETRIES EXCEEDED ON OPEN   INVOIC'             03820055
038300                         TO WS-ABEND-OPERATION                    03830055
038400         PERFORM Z999-SQL-ERROR.                                  03840055
038500                                                                  03850055
038510*--------------------------------------------------------------*  03851061
038520* CLOSE TINVOIC_CSR CURSOR                                     *  03852061
038530*--------------------------------------------------------------*  03853061
038600 Y200-CLOSE-CURSOR.                                               03860055
038700                                                                  03870055
038800     PERFORM WITH TEST AFTER                                      03880055
038900             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 03890055
039000             UNTIL   WS-RETRY-COUNTER > WS-RETRY-MAX OR           03900055
039100                     SQLCODE = ZERO                               03910055
039200                                                                  03920055
039300             EXEC SQL                                             03930055
039400                CLOSE TINVOIC_CSR                                 03940055
039500             END-EXEC                                             03950055
039600                                                                  03960055
039700             EVALUATE TRUE                                        03970055
039800                 WHEN SQLCODE = ZERO                              03980055
039900                 WHEN SQLCODE = -904                              03990055
040000                 WHEN SQLCODE = -913                              04000055
040100                      CONTINUE                                    04010055
040200                                                                  04020055
040300                 WHEN SQLWARN0 NOT = SPACES                       04030055
040400                 WHEN SQLCODE  NOT = ZERO                         04040055
040500                      MOVE 'Y200-CLOSE-CURSOR             '       04050055
040600                                    TO WS-ABEND-PARAGRAPH         04060055
040700                      MOVE 'UNSUCCESSFUL CLOSE  INVOIC'           04070055
040800                                    TO WS-ABEND-OPERATION         04080055
040900                      MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1     04090055
041000                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     04100057
041100                      PERFORM Z999-SQL-ERROR                      04110055
041200             END-EVALUATE                                         04120055
041300     END-PERFORM.                                                 04130055
041400                                                                  04140055
041500     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           04150055
041600         MOVE 'Y200-CLOSE-CURSOR             '                    04160055
041700                       TO WS-ABEND-PARAGRAPH                      04170055
041800         MOVE 'MAX RETRIES EXCEEDED ON CLOSE  INVOIC'             04180055
041900                         TO WS-ABEND-OPERATION                    04190055
042000         PERFORM Z999-SQL-ERROR.                                  04200055
042100                                                                  04210055
042110*--------------------------------------------------------------*  04211061
042120* PROCESS DB2 ABENDS                                           *  04212061
042130*--------------------------------------------------------------*  04213061
042200 Z999-SQL-ERROR.                                                  04220055
042700                                                                  04270061
042800     DISPLAY '*** DB2 ERROR '.                                    04280055
042900     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 04290055
043000     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               04300055
043100     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               04310055
043200     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             04320055
043300     IF WS-ABEND-STRUCTURE-2 > SPACES                             04330055
043400         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         04340055
043500                                                                  04350055
043600     SET AP-DB2-ERROR              TO TRUE.                       04360055
043700                                                                  04370055
043800     COPY DPPD004.                                                04380055
043900     CALL 'ILBOABN0' USING ABEND-CODE.                            04390055
044000                                                                  04400055
