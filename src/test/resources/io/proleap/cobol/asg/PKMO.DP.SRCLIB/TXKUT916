000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.               TXKUT916.                              00020022
000300 AUTHOR.                   JIM LEIKNESS.                          00030000
000400 INSTALLATION.             KOHLS DEPARTMENT STORES.               00040000
000500 DATE-WRITTEN.             APRIL 2003.                            00050001
000600 DATE-COMPILED.                                                   00060000
000610                                                                  00061045
000700*----------------------------------------------------------------*00070000
000800*  PROGRAM NARRATIVE:                                            *00080000
000900*     THIS PROGRAM EXPANDS THE ITEM TAXABILITY CHANGE FILE THAT  *00090023
001000*     LISTS TAXABILITY OF EACH ITEM IN EACH STATE TO CONTAIN A   *00100023
001010*     RECORD FOR EACH STORE ACTIVE ON THE NEW PROMO SYSTEM       *00101023
001050*                                                                *00105023
001100*  CHANGES: NAME              -  DATE                            *00110000
001200*       DESCRIPTION                                              *00120000
001300*----------------------------------------------------------------*00130000
001310                                                                  00131045
001400 ENVIRONMENT DIVISION.                                            00140000
001600                                                                  00160000
001700 CONFIGURATION SECTION.                                           00170000
001800                                                                  00180000
001900 SOURCE-COMPUTER.    IBM-3090.                                    00190000
002000 OBJECT-COMPUTER.    IBM-3090.                                    00200000
002100                                                                  00210000
002200                                                                  00220000
002300 INPUT-OUTPUT SECTION.                                            00230000
002400                                                                  00240000
002500 FILE-CONTROL.                                                    00250000
002600                                                                  00260000
002710     SELECT EP45-CONTROL-FILE            ASSIGN TO INP01.         00271001
002720     SELECT EP112-CONTROL-FILE           ASSIGN TO INP02.         00272031
002721     SELECT EP140-CONTROL-FILE           ASSIGN TO INP03.         00272136
002730     SELECT ITEM-TAX-FILE                ASSIGN TO INP04.         00273036
002800     SELECT TAX-OUTPUT-FILE              ASSIGN TO OUT01.         00280001
003000                                                                  00300000
003100 DATA DIVISION.                                                   00310000
003200                                                                  00320000
003300 FILE SECTION.                                                    00330000
003400                                                                  00340000
003910 FD  EP45-CONTROL-FILE                                            00391001
003920     RECORDING MODE IS F                                          00392000
003930     BLOCK CONTAINS 0                                             00393000
003940     LABEL RECORDS ARE STANDARD.                                  00394000
003950 01  EP45-CONTROL-RECORD              PIC X(80).                  00395001
003951                                                                  00395129
003960 FD  EP112-CONTROL-FILE                                           00396029
003970     RECORDING MODE IS F                                          00397029
003980     BLOCK CONTAINS 0                                             00398029
003990     LABEL RECORDS ARE STANDARD.                                  00399029
003991 01  EP112-CONTROL-RECORD              PIC X(80).                 00399129
004000                                                                  00400000
004010 FD  EP140-CONTROL-FILE                                           00401029
004020     RECORDING MODE IS F                                          00402000
004030     BLOCK CONTAINS 0                                             00403000
004040     LABEL RECORDS ARE STANDARD.                                  00404000
004050 01  EP140-CONTROL-RECORD             PIC X(80).                  00405031
004051                                                                  00405101
004052 FD  ITEM-TAX-FILE                                                00405201
004053     RECORDING MODE IS F                                          00405301
004054     BLOCK CONTAINS 0                                             00405401
004055     LABEL RECORDS ARE STANDARD.                                  00405501
004056 01  ITEM-TAX-RECORD                  PIC X(60).                  00405668
004060                                                                  00406000
004100 FD  TAX-OUTPUT-FILE                                              00410000
004200     RECORDING MODE IS F                                          00420000
004300     BLOCK CONTAINS 0                                             00430000
004400     LABEL RECORDS ARE STANDARD.                                  00440000
004500 01  TAX-OUTPUT-RECORD                PIC X(20).                  00450070
004600                                                                  00460000
004700                                                                  00470000
004800 WORKING-STORAGE SECTION.                                         00480000
004801                                                                  00480100
005300 01  PC-PROGRAM-CONSTANTS.                                        00530000
005700     05  PC-PROGRAM-NAME              PIC X(08)    VALUE          00570000
005800         'TXKUT916'.                                              00580022
005900     05  PC-ABEND-MSSG                PIC X(12)    VALUE          00590000
006000         '** ABEND ** '.                                          00600000
006100     05  PC-DB-ERROR-PREFIX           PIC X(09)    VALUE          00610000
006200         'DB2 ERROR'.                                             00620000
006300     05  PC-DB-ATTEMPTING-MSSG        PIC X(14)    VALUE          00630000
006400         'ATTEMPTING TO '.                                        00640000
006500     05  PC-INTERNAL-TBL-MAX          PIC S9(04)   COMP           00650048
006600                                                   VALUE +1000.   00660048
007000                                                                  00700000
007100 01  PS-PROCESS-SWITCHES.                                         00710000
007200     05  PS-TRANSACTION-DETAIL-SW     PIC X(01)    VALUE 'N'.     00720000
007300         88  PS-NOT-END-OF-TRANS-DETAIL            VALUE 'N'.     00730000
007400         88  PS-END-OF-TRANSACTION-DETAIL          VALUE 'Y'.     00740000
007410     05  PS-STR-LOC-SW                PIC X(01)    VALUE 'N'.     00741011
007420         88  PS-NOT-END-OF-STR-LOC                 VALUE 'N'.     00742011
007430         88  PS-END-OF-STR-LOC                     VALUE 'Y'.     00743011
007500     05  PS-END-OF-CONTROL-FILE-SW    PIC X(01)    VALUE 'N'.     00750000
007600         88  PS-END-OF-CONTROL-FILE                VALUE 'Y'.     00760000
007610     05  PS-END-OF-ITEM-TAX-FILE-SW    PIC X(01)   VALUE 'N'.     00761005
007620         88  PS-END-OF-ITEM-TAX-FILE               VALUE 'Y'.     00762005
007630     05  PS-END-OF-CRNT-DTE-FILE-SW    PIC X(01)   VALUE 'N'.     00763005
007640         88  PS-END-OF-CRNT-DTE-FILE               VALUE 'Y'.     00764005
007650     05  PS-END-OF-EPCC112-SW          PIC X(01)   VALUE 'N'.     00765029
007660         88  PS-END-OF-EPCC112-FILE                VALUE 'Y'.     00766029
007670     05  PS-END-OF-EPCC140-SW          PIC X(01)   VALUE 'N'.     00767029
007680         88  PS-END-OF-EPCC140-FILE                VALUE 'Y'.     00768029
007700                                                                  00770000
007710 01  PV-PROGRAM-VARIABLES.                                        00771003
007730     05  PV-PARAGRAPH-NAME            PIC X(50)    VALUE SPACES.  00773003
007740     05  PV-DB2-ERROR-MSSG            PIC X(50)    VALUE SPACES.  00774003
007751     05  PV-TODAYS-DATE               PIC X(10)    VALUE SPACES.  00775165
007752     05  PV-VALID-DATE                PIC X(10)    VALUE SPACES.  00775231
007753     05  PV-NEW-DATE                  PIC X(10)    VALUE SPACES.  00775331
007755     05  PV-STATE-HOLD                PIC X(02)    VALUE SPACES.  00775532
007760     05  PV-ST-LOC-CNTR               PIC S9(04) COMP             00776005
007770                                                   VALUE ZEROS.   00777003
007771     05  PV-STR-COUNTER               PIC S9(04) COMP             00777105
007772                                                   VALUE ZEROS.   00777205
007773     05  PV-STR-SKIPPED               PIC S9(04) COMP             00777307
007774                                                   VALUE ZEROS.   00777407
007780     05  PV-RECS-READ                 PIC S9(09) COMP             00778026
007790                                                   VALUE ZEROS.   00779003
007791     05  PV-RECS-WRITTEN              PIC S9(09) COMP             00779126
007792                                                   VALUE ZEROS.   00779203
007793                                                                  00779303
007794 01  ABEND-CODE                       PIC  S9(04) COMP            00779414
007795                                                   VALUE ZEROS.   00779503
007796     88  ABEND-4003-INVALID-CC-DATE                VALUE +4003.   00779603
007797     88  ABEND-4004-TBL-OVERFLOW-ERROR             VALUE +4004.   00779755
007799     88  ABEND-4013-DB2-ERROR                      VALUE +4013.   00779950
007800                                                                  00780050
007801 01 ST-TABLE.                                                     00780150
007802    05  ST-LOC-TBL OCCURS 1000 TIMES INDEXED BY X1.               00780250
007803       10 T-LOC-NBR                   PIC  S9(04) COMP.           00780303
007804                                                                  00780403
007805 01 IV-INDICATOR-VARIABLES.                                       00780514
007806    05  IV-EPT-RFRSH-DTE              PIC  S9(04) COMP            00780614
007807                                                   VALUE ZERO.    00780714
007808                                                                  00780814
008800*----------------------------------------------------------------*00880000
008900*    COPYBOOK FOR DPKUT500                                        00890018
009000*----------------------------------------------------------------*00900000
009100     COPY DPWS500.                                                00910000
009101                                                                  00910145
009110*----------------------------------------------------------------*00911000
009120*    COPYBOOK FOR CONTROL CARD EPCC045                            00912018
009130*----------------------------------------------------------------*00913000
009140     COPY EPRD045.                                                00914000
009141                                                                  00914145
009142*----------------------------------------------------------------*00914201
009143*    COPYBOOK FOR CONTROL CARD EPCC112                            00914329
009144*----------------------------------------------------------------*00914401
009145     COPY EPWS112.                                                00914529
009146                                                                  00914645
009148*----------------------------------------------------------------*00914829
009149*    COPYBOOK FOR CONTROL CARD EPCC140                            00914929
009150*----------------------------------------------------------------*00915029
009151     COPY EPWS140.                                                00915129
009152                                                                  00915245
009153*----------------------------------------------------------------*00915300
009160*    COPYBOOK FOR INPUT RECORD LAYOUT                             00916003
009170*----------------------------------------------------------------*00917000
009180     COPY TXRD911.                                                00918001
009181                                                                  00918145
009190*----------------------------------------------------------------*00919003
009200*    COPYBOOK FOR OUTPUT RECORD LAYOUT                            00920003
009201*----------------------------------------------------------------*00920103
009202     COPY TXRD915.                                                00920203
009203                                                                  00920345
009210*----------------------------------------------------------------*00921000
009300*    STANDARD DB2 ERROR HANDLING AREA                             00930018
009400*----------------------------------------------------------------*00940000
009500     COPY DPWS004.                                                00950000
009510                                                                  00951045
009600*----------------------------------------------------------------*00960000
009700*    DCLGEN FOR THE LOCATION TABLE (XST_LOC)                      00970018
009800*----------------------------------------------------------------*00980000
009900     EXEC SQL                                                     00990000
010000         INCLUDE XST00001                                         01000000
010100     END-EXEC.                                                    01010000
010110                                                                  01011045
010200*----------------------------------------------------------------*01020000
010300*    DCLGEN FOR THE LOCATION ATTRIBUTE TABLE (XST_LOC_ATTR)       01030018
010400*----------------------------------------------------------------*01040000
010500     EXEC SQL                                                     01050000
010600         INCLUDE XST00025                                         01060000
010700     END-EXEC.                                                    01070000
010710                                                                  01071045
010800*----------------------------------------------------------------*01080000
010900*    DCLGEN FOR THE EPT_STR_FIL_RFRSH                             01090001
011000*----------------------------------------------------------------*01100000
011100     EXEC SQL                                                     01110000
011200         INCLUDE EPT00010                                         01120001
011300     END-EXEC.                                                    01130000
011310                                                                  01131045
011400*----------------------------------------------------------------*01140000
011500*    STANDARD DB2 COMMUNICATIONS AREA                             01150007
011600*----------------------------------------------------------------*01160000
011700     EXEC SQL                                                     01170000
011800         INCLUDE SQLCA                                            01180000
011900     END-EXEC.                                                    01190000
012000                                                                  01200045
014310*----------------------------------------------------------------*01431000
014320*    CURSOR DECLARE -                                             01432001
014321*                                                                 01432171
014322*  NOTE: DURING THE PILOT NEW STORES WILL NOT BE ON THE PLU TAX   01432271
014323*        SYSTEM.  WHEN THE PILOT IS COMPLETE WE WILL LOOK FOR POS 01432371
014324*        CAPABILITY LEVELS 5 OR > 11.                             01432471
014330*----------------------------------------------------------------*01433000
014340     EXEC SQL                                                     01434000
014350       DECLARE LOC-CSR CURSOR FOR                                 01435052
014352         SELECT  LOC.LOC_NBR                                      01435251
014353                ,LOC.ST_CDE                                       01435351
014356                ,LOC.OPN_DTE                                      01435651
014357                ,LOC.CLO_DTE                                      01435751
014360           FROM  XST_LOC  LOC,                                    01436051
014361                 XST_LOC_ATTR  ATT                                01436151
014362          WHERE  LOC.LOC_NBR = ATT.LOC_NBR                        01436251
014363            AND  LOC.ST_CDE = :PV-STATE-HOLD                      01436351
014365            AND  LOC.LOC_TYP_CDE = 'DS'                           01436551
014367            AND (ATT.POS_CAP_LVL_ID = 5 OR                        01436774
014368                 ATT.POS_CAP_LVL_ID > 11)                         01436874
014370         ORDER BY LOC.ST_CDE, LOC.LOC_NBR                         01437071
014380                                                                  01438071
014399     END-EXEC.                                                    01439900
014400                                                                  01440000
014410******************************************************************01441006
014500 PROCEDURE DIVISION.                                              01450000
014600******************************************************************01460006
014900                                                                  01490000
015000     PERFORM  1000-INITIALIZE.                                    01500007
015010                                                                  01501003
015100     PERFORM  1200-CALC-NEW-OPEN-DTE.                             01510007
015110                                                                  01511003
015120     PERFORM  7000-READ-ITEM-TAX-FILE.                            01512006
015130                                                                  01513006
015400     PERFORM  2000-PROCESS                                        01540007
015500         UNTIL PS-END-OF-ITEM-TAX-FILE.                           01550013
015510                                                                  01551000
015801     DISPLAY 'TOTAL RECORDS READ = '    PV-RECS-READ              01580107
015802     DISPLAY 'TOTAL RECORDS WRITTEN = ' PV-RECS-WRITTEN           01580207
015803     DISPLAY 'TOTAL STORES SKIPPED  = ' PV-STR-SKIPPED            01580307
015804                                                                  01580407
015810     CLOSE EP45-CONTROL-FILE                                      01581004
015820           EP112-CONTROL-FILE                                     01582029
015821           EP140-CONTROL-FILE                                     01582129
015830           ITEM-TAX-FILE                                          01583004
015900           TAX-OUTPUT-FILE.                                       01590000
016000                                                                  01600000
016100     GOBACK.                                                      01610000
016110                                                                  01611000
016200*----------------------------------------------------------------*01620000
016300*   1000-INITIALIZE                                               01630034
016400*----------------------------------------------------------------*01640000
016500 1000-INITIALIZE.                                                 01650000
016600                                                                  01660000
016601     DISPLAY 'PROGRAM : ' PC-PROGRAM-NAME                         01660163
016602                                                                  01660263
016610     OPEN INPUT  EP45-CONTROL-FILE                                01661005
016611                 EP112-CONTROL-FILE                               01661129
016612                 EP140-CONTROL-FILE                               01661229
016613                 ITEM-TAX-FILE                                    01661328
016614          OUTPUT TAX-OUTPUT-FILE.                                 01661404
016615                                                                  01661504
016616*------- CONTROL CARD EPCC140 FORMAT : CCYY-MM-DD -------------*  01661630
016617*----------------------- TODAYS DATE --------------------------*  01661763
016618                                                                  01661863
016619     READ EP140-CONTROL-FILE INTO CC-EPCC140-CONTROL-CARD         01661930
016621         AT END SET PS-END-OF-EPCC140-FILE  TO TRUE.              01662129
016622     DISPLAY 'EPCC140 DATE: ' CC-EPCC140-TODAY-DATE.              01662251
016623     MOVE CC-EPCC140-TODAY-DATE TO PV-VALID-DATE.                 01662329
016624                                                                  01662429
016625     PERFORM  1100-VALIDATE-DATE.                                 01662529
016626                                                                  01662629
016628     MOVE CC-EPCC140-TODAY-DATE TO PV-TODAYS-DATE.                01662865
016630                                                                  01663045
016631*------- CONTROL CARD EPCC112 FORMAT : CCYY-MM-DD -------------*  01663130
016632*------------------  TOMORROW'S DATE --------------------------*  01663263
016633                                                                  01663363
016634     READ EP112-CONTROL-FILE INTO CC-EPCC112-CONTROL-CARD         01663429
016635         AT END SET PS-END-OF-EPCC112-FILE  TO TRUE.              01663529
016636     DISPLAY 'EPCC112 DATE: ' CC-EPCC112-TOMORROW-DATE            01663651
016637     MOVE CC-EPCC112-TOMORROW-DATE TO PV-VALID-DATE               01663729
016638                                                                  01663829
016639     PERFORM  1100-VALIDATE-DATE                                  01663929
016642                                                                  01664245
016643*------- CONTROL CARD EPCC045 --CONTAINS THE NUMBER OF DAYS----*  01664363
016644*---------BEFORE OPENING THAT FILES ARE SENT TO THE STORE------*  01664463
016645                                                                  01664529
016646     READ EP45-CONTROL-FILE INTO EP045-ADVDAYS-TO-SND-RECORD      01664628
016647         AT END SET PS-END-OF-CONTROL-FILE TO TRUE.               01664728
016648                                                                  01664851
016649     DISPLAY 'EP045-DAYS-TILL-STORE-OPN : '                       01664951
016650              EP045-DAYS-TILL-STORE-OPN                           01665051
016651                                                                  01665151
016652     PERFORM 1200-CALC-NEW-OPEN-DTE.                              01665229
016653                                                                  01665329
016654     DISPLAY 'NEW OPEN DATE : ' PV-NEW-DATE.                      01665429
016655                                                                  01665528
016656*----------------------------------------------------------------*01665604
016657* 1100-VALIDATE-DATE -CHECKS CONTROL CARD DATE FOR VALID DATE     01665735
016658*----------------------------------------------------------------*01665804
016659 1100-VALIDATE-DATE.                                              01665904
016660                                                                  01666004
016661     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         01666104
016662     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     01666204
016663     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     01666304
016664                                                                  01666404
016665     MOVE PV-VALID-DATE TO DPG52-LK-DATE-INPUT.                   01666529
016666                                                                  01666605
016667     CALL DP500-KOHLS-CALENDAR-ROUTINE                            01666705
016668          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01666805
016669                                                                  01666905
016670     EVALUATE TRUE                                                01667005
016671         WHEN DPG54-NO-ERROR                                      01667105
016672             CONTINUE                                             01667205
016673         WHEN OTHER                                               01667305
016674             DISPLAY '** ABEND **'                                01667405
016675             DISPLAY PC-PROGRAM-NAME          ' - INVALID'        01667505
016676                       'PROCESS DATE PROVIDED'                    01667605
016677             DISPLAY '1100-VALIDATE-DATE '                        01667705
016678                                                                  01667805
016679             MOVE +4003 TO ABEND-CODE                             01667905
016680             CALL 'ILBOABN0' USING ABEND-CODE                     01668005
016681     END-EVALUATE.                                                01668105
016682                                                                  01668229
016683     INITIALIZE PV-VALID-DATE.                                    01668329
016684                                                                  01668405
016685*----------------------------------------------------------------*01668505
016686* 1200-CALC-NEW-OPEN-DTE - ADDS NO. OF DAYS IN EPCC045 TO         01668634
016687*                          TODAY'S DATE (EPCC140).                01668734
016688*----------------------------------------------------------------*01668834
016689 1200-CALC-NEW-OPEN-DTE.                                          01668934
016690                                                                  01669034
016691     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         01669134
016692     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     01669234
016693     SET DPG51-INCREMENT-DATE    TO TRUE.                         01669334
016694                                                                  01669434
016695     MOVE EP045-DAYS-TILL-STORE-OPN TO DPG51-INCR-DECR-DAYS-9.    01669534
016696                                                                  01669634
016697     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     01669734
016698     MOVE CC-EPCC140-TODAY-DATE TO DPG52-LK-DATE-INPUT.           01669830
016699                                                                  01669930
016700     CALL DP500-KOHLS-CALENDAR-ROUTINE                            01670005
016701          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01670105
016702                                                                  01670205
016703     EVALUATE TRUE                                                01670305
016704         WHEN DPG54-NO-ERROR                                      01670405
016705             CONTINUE                                             01670505
016706         WHEN OTHER                                               01670605
016707             DISPLAY DPG54-ERROR-MESSAGE                          01670705
016708             DISPLAY '** ABEND **'                                01670805
016709             DISPLAY PC-PROGRAM-NAME          ' - INVALID'        01670905
016710                       'NEW OPEN DATE PROVIDED'                   01671005
016711             DISPLAY '1200-CALC-NEW-OPEN-DTE'                     01671105
016712             MOVE +4003 TO ABEND-CODE                             01671205
016713             CALL 'ILBOABN0' USING ABEND-CODE                     01671305
016714     END-EVALUATE.                                                01671405
016715                                                                  01671505
016720     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-NEW-DATE.                  01672033
016800                                                                  01680005
025210*----------------------------------------------------------------*02521000
025300* 2000-PROCESS                                                    02530000
025301*                                                                 02530125
025302*     ON A CHANGE OF STATE (OR THE FIRST RECORD) THE PROGRAM      02530225
025303*   OPENS A CURSOR (IN PARAGRAPH 3000-LOAD-LOC-TBL) AND THEN      02530325
025304*   WRITES AN ITEM RECORD FOR EACH STORE IN THAT STATE. IT        02530425
025305*   CONTINUES TO WRITE ITEM RECORDS FOR STORES IN A STATE         02530560
025306*   THAT DID NOT REQUEST A FULL REFRESH.                          02530660
025307*                                                                 02530725
025400*----------------------------------------------------------------*02540000
025500 2000-PROCESS.                                                    02550000
026102                                                                  02610200
026103     IF TX911-STATE-CODE NOT = PV-STATE-HOLD                      02610305
026104       MOVE TX911-STATE-CODE TO PV-STATE-HOLD                     02610405
026106       PERFORM 3000-LOAD-LOC-TBL                                  02610607
026107     END-IF.                                                      02610749
026108                                                                  02610849
026109     SET X1 TO +1.                                                02610955
026110                                                                  02611034
026122     PERFORM UNTIL X1 > PV-ST-LOC-CNTR                            02612249
026124        MOVE T-LOC-NBR (X1)     TO  TX915-LOC-NBR                 02612463
026125        MOVE TX911-INTR-UPC-ID  TO  TX915-INTR-UPC-ID             02612563
026126        MOVE TX911-SKU-NBR      TO  TX915-SKU-NBR                 02612663
026127        MOVE TX911-TX-PARM-CDE  TO  TX915-TX-PARM-CDE             02612763
026128        MOVE TX911-REC-TYPE     TO  TX915-REC-TYPE                02612863
026129        PERFORM 8000-WRITE-TAX-FILE                               02612949
026130        SET X1 UP BY +1                                           02613049
026139     END-PERFORM.                                                 02613955
026140                                                                  02614034
026143     PERFORM  7000-READ-ITEM-TAX-FILE.                            02614307
026144                                                                  02614420
026147*----------------------------------------------------------------*02614700
026148* 3000-LOAD-LOC-TBL  - LOADS INTERNAL TABLE WITH THE STORES FROM  02614843
026149*   THE STATE THAT IS ON THE INPUT RECORD EXCEPT THOSE THAT       02614963
026150*   REQUEST A FULL REFRESH.                                       02615063
026151*----------------------------------------------------------------*02615163
026152 3000-LOAD-LOC-TBL.                                               02615263
026153                                                                  02615363
026154     PERFORM 4000-OPEN-LOC-CSR.                                   02615463
026155                                                                  02615563
026156     SET X1 TO +1.                                                02615663
026157                                                                  02615763
026158     INITIALIZE PV-ST-LOC-CNTR.                                   02615863
026159                                                                  02615963
026160     PERFORM 5000-FETCH-LOC-CSR.                                  02616063
026161                                                                  02616163
026162     PERFORM UNTIL PS-END-OF-STR-LOC                              02616263
026163       IF ((CC-EPCC112-TOMORROW-DATE >= XST00001-OPN-DTE) AND     02616363
026164           (CC-EPCC112-TOMORROW-DATE < XST00001-CLO-DTE))         02616463
026165       OR ((CC-EPCC112-TOMORROW-DATE < XST00001-OPN-DTE)          02616563
026166         AND (PV-NEW-DATE >= XST00001-OPN-DTE)                    02616663
026167         AND (PV-NEW-DATE <= XST00001-CLO-DTE))                   02616763
026168                                                                  02616863
026169            PERFORM 3500-SELECT-RFRSH-DTE                         02616963
026198                                                                  02619857
026199*----------- IV-EPT-RFRSH-DTE WILL EQUAL -1 WHEN THE REFRESH ----*02619964
026200*----------- DATE IS NULL ON THE DATABASE -----------------------*02620064
026201                                                                  02620164
026202            IF (SQLCODE = 0 AND                                   02620257
026203                (EPT00010-RFRSH-DTE = PV-TODAYS-DATE              02620365
026204                 OR IV-EPT-RFRSH-DTE = -1))                       02620456
026206                                                                  02620664
026207              ADD +1 TO PV-STR-SKIPPED                            02620756
026208            ELSE                                                  02620856
026209              MOVE XST00001-LOC-NBR TO T-LOC-NBR (X1)             02620956
026210              ADD +1 TO PV-ST-LOC-CNTR                            02621056
026211              SET X1 UP BY +1                                     02621156
026212              IF X1 > PC-INTERNAL-TBL-MAX                         02621256
026213                 DISPLAY '** ABEND **'                            02621356
026214                 DISPLAY PC-PROGRAM-NAME                          02621456
026215                       '  TABLE OVERFLOW ERROR'                   02621556
026216                 DISPLAY '3000-LOAD-LOC-TBL '                     02621656
026217                                                                  02621756
026218                 MOVE +4004 TO ABEND-CODE                         02621856
026219                 CALL 'ILBOABN0' USING ABEND-CODE                 02621956
026220              END-IF                                              02622056
026221            END-IF                                                02622156
026222       END-IF                                                     02622256
026223                                                                  02622356
026224       PERFORM 5000-FETCH-LOC-CSR                                 02622456
026225                                                                  02622556
026226     END-PERFORM.                                                 02622656
026227                                                                  02622756
026228     PERFORM 6000-CLOSE-LOC-CSR.                                  02622856
026229                                                                  02622956
026230     SET PS-NOT-END-OF-STR-LOC TO TRUE.                           02623056
026231                                                                  02623156
026232*-----------------------------------------------------------------02623260
026233* 3500-SELECT-RFRSH-DTE    - SELECTS RFRSH DATE FROM THE          02623363
026234*    EPT_STR_FIL_RFRSH.  USES THE INDICATOR VARIABLE              02623463
026235*    IV-EPT-RFRSH-DTE IN CASES WHERE THE STORE IS ON THE TABLE    02623563
026236*    BUT THE REFRESH DATE IS NULL.                                02623663
026237*                                                                 02623763
026238*-----------------------------------------------------------------02623863
026239 3500-SELECT-RFRSH-DTE.                                           02623963
026240                                                                  02624063
026241            MOVE 0 TO IV-EPT-RFRSH-DTE                            02624163
026242                                                                  02624263
026243            EXEC SQL                                              02624363
026244               SELECT RFRSH_DTE                                   02624463
026245                 INTO :EPT00010-RFRSH-DTE                         02624563
026246                      :IV-EPT-RFRSH-DTE                           02624663
026247                 FROM EPT_STR_FIL_RFRSH                           02624763
026248                WHERE STR_NBR = :XST00001-LOC-NBR                 02624863
026249                  AND RFRSH_TYP_CDE = 'PL'                        02624963
026250            END-EXEC                                              02625063
026251                                                                  02625163
026252            EVALUATE TRUE                                         02625263
026253                WHEN SQLCODE = +0                                 02625363
026254                  CONTINUE                                        02625463
026255                WHEN SQLCODE = +100                               02625563
026256                  CONTINUE                                        02625663
026257                WHEN OTHER                                        02625763
026258                  MOVE '3500-SELECT-RFRSH-DTE'                    02625863
026259                                 TO PV-PARAGRAPH-NAME             02625963
026260                  MOVE 'SELECT FROM EPT_STR_FIL_RFRSH.'           02626063
026261                                 TO PV-DB2-ERROR-MSSG             02626163
026262                  PERFORM 9000-DB2-ERROR                          02626263
026263            END-EVALUATE.                                         02626363
026264                                                                  02626463
026265*----------------------------------------------------------------*02626563
026266* 4000-OPEN-LOC-CSR    - OPENS CURSOR                             02626663
026267*----------------------------------------------------------------*02626763
026268 4000-OPEN-LOC-CSR.                                               02626863
026269                                                                  02626963
026270     EXEC SQL                                                     02627063
026271         OPEN LOC-CSR                                             02627163
026272     END-EXEC.                                                    02627263
026273                                                                  02627363
026274     EVALUATE TRUE                                                02627463
026275       WHEN SQLCODE NOT = 0                                       02627563
026276       WHEN SQLWARN0    = 'W'                                     02627663
026277         MOVE '4000-OPEN-LOC-CSR'                                 02627763
026278                           TO PV-PARAGRAPH-NAME                   02627863
026279         MOVE 'OPEN LOCATION CURSOR ERROR.'                       02627963
026280                           TO PV-DB2-ERROR-MSSG                   02628063
026281         PERFORM 9000-DB2-ERROR                                   02628163
026282     END-EVALUATE.                                                02628263
026283                                                                  02628363
026284*----------------------------------------------------------------*02628463
026285* 5000-FETCH LOC-CSR  - FETCHES STORE FOR LOAD OF INTERNAL        02628563
026286*                            TABLE.                               02628663
026287*----------------------------------------------------------------*02628763
026288 5000-FETCH-LOC-CSR.                                              02628863
026289                                                                  02628963
026290                                                                  02629063
026291     EXEC SQL                                                     02629163
026292         FETCH LOC-CSR                                            02629263
026293           INTO :XST00001-LOC-NBR                                 02629363
026294               ,:XST00001-ST-CDE                                  02629463
026295               ,:XST00001-OPN-DTE                                 02629563
026296               ,:XST00001-CLO-DTE                                 02629663
026297     END-EXEC.                                                    02629763
026298                                                                  02629863
026299     EVALUATE TRUE                                                02629963
026300         WHEN SQLCODE = +0                                        02630063
026301           CONTINUE                                               02630163
026302         WHEN SQLCODE = +100                                      02630263
026303           SET PS-END-OF-STR-LOC TO TRUE                          02630363
026304         WHEN OTHER                                               02630463
026305             MOVE '5000-FETCH-LOC-CSR'                            02630563
026306                               TO PV-PARAGRAPH-NAME               02630663
026307             MOVE 'FETCH FROM STR ITEM CURSOR ERROR.'             02630763
026308                               TO PV-DB2-ERROR-MSSG               02630863
026309             PERFORM 9000-DB2-ERROR                               02630963
026310     END-EVALUATE.                                                02631063
026311                                                                  02631163
026312*----------------------------------------------------------------*02631263
026313*  6000-CLOSE LOC-CSR                                             02631363
026314*----------------------------------------------------------------*02631463
026315 6000-CLOSE-LOC-CSR.                                              02631563
026316     EXEC SQL                                                     02631663
026317       CLOSE LOC-CSR                                              02631763
026318     END-EXEC.                                                    02631863
026319                                                                  02631963
026320     EVALUATE TRUE                                                02632063
026321       WHEN SQLCODE NOT = 0                                       02632163
026322       WHEN SQLWARN0    = 'W'                                     02632263
026323           MOVE '6000-CLOSE-LOC-CSR'                              02632363
026324                             TO PV-PARAGRAPH-NAME                 02632463
026325           MOVE 'CLOSE FAILED FOR LOCATION CURSOR'                02632563
026326                             TO PV-DB2-ERROR-MSSG                 02632663
026327           PERFORM 9000-DB2-ERROR                                 02632763
026328     END-EVALUATE.                                                02632863
026329                                                                  02632963
026330*----------------------------------------------------------------*02633063
026331* 7000-READ-ITEM-TAX-FILE                                         02633163
026332*----------------------------------------------------------------*02633263
026333 7000-READ-ITEM-TAX-FILE.                                         02633363
026334                                                                  02633463
026335     READ ITEM-TAX-FILE INTO TX911-TAX-ITEM-RECORD                02633563
026336         AT END SET PS-END-OF-ITEM-TAX-FILE TO TRUE               02633666
026337         NOT AT END ADD +1 TO PV-RECS-READ.                       02633766
026338                                                                  02633866
026340*----------------------------------------------------------------*02634000
026400* 8000-WRITE-TAX-FILE                                             02640000
026500*----------------------------------------------------------------*02650000
026600 8000-WRITE-TAX-FILE.                                             02660000
026700                                                                  02670000
026800     WRITE TAX-OUTPUT-RECORD FROM TX915-TAX-ITEM-RECORD.          02680005
026900                                                                  02690000
026910     ADD +1 TO PV-RECS-WRITTEN                                    02691000
026920                                                                  02692000
027000     INITIALIZE TX915-TAX-ITEM-RECORD.                            02700005
027010                                                                  02701000
027100*----------------------------------------------------------------*02710000
027200* 9000-DB2 ERROR                                                  02720000
027700*----------------------------------------------------------------*02770000
027800 9000-DB2-ERROR.                                                  02780000
027900                                                                  02790000
028000     DISPLAY PC-ABEND-MSSG  PC-PROGRAM-NAME.                      02800000
028100     DISPLAY PC-DB-ERROR-PREFIX                                   02810000
028200     DISPLAY PC-DB-ATTEMPTING-MSSG PV-DB2-ERROR-MSSG.             02820000
028300     COPY DPPD004.                                                02830000
028400     SET ABEND-4013-DB2-ERROR TO TRUE.                            02840000
028500     CALL 'ILBOABN0' USING ABEND-CODE.                            02850000
028600     EJECT                                                        02860000
