      ******************************************************************        
       IDENTIFICATION DIVISION.                                                 
      ******************************************************************        
                                                                                
       PROGRAM-ID.              TFKUT200.                                       
       AUTHOR.                  M JOHNSON.                                      
       INSTALLATION.            KOHLS DEPARTMENT STORES.                        
       DATE-WRITTEN.            10/29/2004.                                     
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      * PROGRAM DESCRIPTION:                                                    
      * --------------------                                                    
      * DUPLICATE TRANSFER TO RTV EXTRACT                                       
      *                                                                         
      * PROGRAM OBJECTIVE:                                                      
      * ------------------                                                      
      * FIND DUPLICATE TRANFERS THAT ARE OF TYPE 00, 01, 02 (DEF/DAMAGE         
      * - SORT1, DEF/DAMAGE - SORT2, CALLBACK), CREATED IN THE PRIOR            
      * FISCAL MONTH, THAT HAVE THE SAME FROM LOC, TO LOC, TOTAL                
      * QUANTITY AND TOTAL EXTENDED RETAIL WHERE THERE IS AT LEAST ONE          
      * TRANSFER WHERE THE  MAXIMUM STATUS IS POSITIVELY RECEIVED               
      * AND AT LEAST ONE ASSUMPTIVELY RECEIVED.                                 
      * TRANSFERS THAT ARE VOIDED ARE REJECTED                                  
      ******************************************************************        
      * CHANGE LOG:                                                             
      * -----------                                                             
      * WR/PM    DATE       PGMR        DESCRIPTION OF CHANGES                  
      * -------- ---------- ----------- --------------------------------        
      * 25943    10-29-2004 M JOHNSON   ORIGINAL IMPLEMENTATION                 
      *                                                                         
      * 00707989 11-05-2004 M JOHNSON   REENGINEERED PROCESS TO IDENTIFY        
      *                                 DUPLICATE TRANSFERS WITH SAME           
      *                                 FROM LOC, TO LOC, TOTAL QTY AND         
      *                                 TOTAL EXTENDED RETAIL AMT               
      *                                                                         
      * 3403     02-24-2012 C PARMLEY   COMPILE ONLY CHANGE TO TTFITEM          
      ******************************************************************        
                                                                                
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
      ******************************************************************        
                                                                                
      ******************************************************************        
       CONFIGURATION SECTION.                                                   
                                                                                
      ******************************************************************        
       INPUT-OUTPUT SECTION.                                                    
                                                                                
      ******************************************************************        
       FILE-CONTROL.                                                            
                                                                                
           SELECT DUPLICATE-XFER-DTL                                            
               ASSIGN TO OUT01.                                                 
                                                                                
      /*****************************************************************        
       DATA DIVISION.                                                           
      ******************************************************************        
                                                                                
      ******************************************************************        
       FILE SECTION.                                                            
                                                                                
       FD  DUPLICATE-XFER-DTL                                                   
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  DUPLICATE-XFER-RPT-DTL      PIC  X(135).                             
                                                                                
      ******************************************************************        
       WORKING-STORAGE SECTION.                                                 
                                                                                
      ******************************************************************        
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-FIRSTXFER-OPEN-SW    PIC  X(01)          VALUE 'C'.           
               88  PS-FIRSTXFER-OPEN                       VALUE 'O'.           
           05  PS-FISRTXFER-EOF-SW     PIC  X(01)          VALUE 'N'.           
               88  PS-FISRTXFER-EOF                        VALUE 'Y'.           
           05  PS-MIN-TTFSTAT-RCD-FND-SW                                        
                                       PIC  X(01)          VALUE 'N'.           
               88  PS-MIN-TTFSTAT-RCD-FND                  VALUE 'Y'.           
           05  PS-MAX-TTFSTAT-RCD-FND-SW                                        
                                       PIC  X(01)          VALUE 'N'.           
               88  PS-MAX-TTFSTAT-RCD-FND                  VALUE 'Y'.           
           05  PS-SUM-TTFITEM-RCD-FND-SW                                        
                                       PIC  X(01)          VALUE 'N'.           
               88  PS-SUM-TTFITEM-RCD-FND                  VALUE 'Y'.           
           05  PS-XFER-STAT-CDE-PSTVLY-RCD-SW                                   
                                       PIC  X(01)          VALUE 'N'.           
               88  PS-XFER-STAT-CDE-PSTVLY-RCD             VALUE 'Y'.           
           05  PS-XFER-STAT-CD-ASMTVLY-RCD-SW                                   
                                       PIC  X(01)          VALUE 'N'.           
               88  PS-XFER-STAT-CD-ASMTVLY-RCD             VALUE 'Y'.           
                                                                                
      ******************************************************************        
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-PROGRAM-NAME         PIC  X(08)          VALUE                
               'TFKUT200'.                                                      
           05  PC-LINE-MAX             PIC S9(03)          VALUE +66            
                                                           COMP-3.              
           05  PC-XFER-STAT-CDE-COMPLETED                                       
                                       PIC  X(02)          VALUE 'CM'.          
           05  PC-XFER-STAT-CDE-ASMPTVLY-RCVD                                   
                                       PIC  X(02)          VALUE 'AR'.          
           05  PC-XFER-STAT-CDE-PSTVLY-RCVD                                     
                                       PIC  X(02)          VALUE 'PR'.          
           05  PC-XFER-STAT-CDE-VOID   PIC  X(02)          VALUE 'VD'.          
                                                                                
      ******************************************************************        
       01  PT-PROGRAM-TOTALS.                                                   
           05  PT-FIRSTXFER-RCD-FND    PIC S9(09)          VALUE ZEROS          
                                                           COMP-3.              
           05  PT-RCD-WRTTN            PIC S9(09)          VALUE ZEROS          
                                                           COMP-3.              
           05  PT-DISPLAY-CNTR         PIC S9(09)          VALUE +0             
                                                           COMP-3.              
               88  PT-DISPLAY-CNTR-CNT                     VALUE                
                   5000000.                                                     
      *            5000.                                                        
                                                                                
      ******************************************************************        
       01  CC-DATES.                                                            
           05  CC-PROCESS-DATE         PIC X(10)           VALUE SPACE.         
                                                                                
      ******************************************************************        
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-DTATTR-DATE          PIC  X(10)          VALUE SPACE.         
           05  PV-PARAGRAPH-NAME       PIC  X(25)          VALUE SPACE.         
           05  PV-ABEND-MESSAGE        PIC  X(50)          VALUE SPACE.         
           05  PV-OPER-ATTEMPTED       PIC  X(30)          VALUE SPACE.         
                                                                                
           05  PV-DTE-FSCL-PERIOD.                                              
               10  PV-FSCL-YR-NBR      PIC  X(04)          VALUE SPACE.         
               10  PV-FSCL-MN-NBR      PIC  X(02)          VALUE SPACE.         
           05  PV-FSCL-MN-BEG-TMST     PIC  X(26)          VALUE SPACE.         
           05  FILLER REDEFINES PV-FSCL-MN-BEG-TMST.                            
               10  PV-FSCL-MN-BEG-DTE  PIC  X(10).                              
               10  FILLER              PIC  X(16).                              
                   88  PV-FSCL-MN-BEG-TIME                 VALUE                
                       '-00.00.00.000000'.                                      
           05  PV-FSCL-MN-END-TMST     PIC  X(26)          VALUE SPACE.         
           05  FILLER REDEFINES PV-FSCL-MN-END-TMST.                            
               10  PV-FSCL-MN-END-DTE  PIC  X(10).                              
               10  FILLER              PIC  X(16).                              
                   88  PV-FSCL-MN-END-TIME                 VALUE                
                       '-00.00.00.000000'.                                      
           05  PV-PREV-FR-STR-NBR      PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  PV-XFER-DKEY-ID         PIC S9(09)          VALUE +0             
                                                           COMP.                
           05  PV-FR-STR-NBR           PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  PV-TO-STR-NBR           PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  PV-CMPT-XFER-END-TMST   PIC  X(26)          VALUE SPACE.         
           05  PV-CMPT-XFER-END-DTE    PIC  X(10)          VALUE SPACE.         
           05  PV-XFER-QTY             PIC S9(09)          VALUE +0             
                                                           COMP.                
           05  PV-EXTD-RTL-PRICE       PIC S9(09)V9(02)    VALUE +0             
                                                           COMP-3.              
           05  PV-DRT-INDEX            PIC S9(05)          VALUE +0             
                                                           COMP SYNC.           
           05  PV-DRT-RCD-CNT          PIC S9(05)          VALUE +0             
                                                           COMP SYNC.           
           05  PV-DRT-MAX-RCDS         PIC S9(05)          VALUE +5000          
                                                           COMP SYNC.           
           05  PV-DRT-FIND-INDEX       PIC S9(05)          VALUE +0             
                                                           COMP SYNC.           
           05  PV-DRT-MATCH-INDEX      PIC S9(05)          VALUE +0             
                                                           COMP SYNC.           
           05  PV-RDT-INDEX            PIC S9(05)          VALUE +0             
                                                           COMP SYNC.           
           05  PV-RDT-RCD-CNT          PIC S9(05)          VALUE +0             
                                                           COMP SYNC.           
           05  PV-RDT-MAX-RCDS         PIC S9(05)          VALUE +500           
                                                           COMP SYNC.           
           05  PV-INDEX                PIC S9(05)          VALUE +0             
                                                           COMP SYNC.           
           05  PV-MIN-XFER-STAT-TMST   PIC  X(26)          VALUE SPACE.         
           05  PV-MIN-XFER-STAT-CDE    PIC  X(02)          VALUE SPACE.         
           05  PV-MIN-XFER-STAT-DESC   PIC  X(20)          VALUE SPACE.         
           05  PV-MAX-XFER-STAT-TMST   PIC  X(26)          VALUE SPACE.         
           05  PV-MAX-XFER-STAT-CDE    PIC  X(02)          VALUE SPACE.         
           05  PV-MAX-XFER-STAT-DESC   PIC  X(20)          VALUE SPACE.         
           05  PV-RCPT-XFER-DKEY-ID    PIC S9(09)          VALUE +0             
                                                           COMP.                
                                                                                
      ******************************************************************        
       01  ABEND-CODE                  PIC S9(04)          VALUE +4003          
                                                           COMP SYNC.           
                                                                                
      ******************************************************************        
       01  NI-NULL-INDICATORS.                                                  
           05  NI-XFER-SEQ-NBR         PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  NI-CMPT-XFER-BEG-TMST   PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  NI-XFER-QTY             PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  NI-EXTD-RTL-PRICE       PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  NI-CLBK-NBR             PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  NI-XFER-DKEY-ID         PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  NI-RCV-XFER-BEG-TMST    PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  NI-LD-END-DTE           PIC S9(04)          VALUE +0             
                                                           COMP.                
                                                                                
      ******************************************************************        
       01  SDT-SYSTEM-DATE-TIME.                                                
           05  SDT-YYYYMMDD            PIC  X(10)          VALUE SPACE.         
           05  FILLER REDEFINES SDT-YYYYMMDD.                                   
               10  SDT-YYYYMMDD-CCYY.                                           
                   15  SDT-YYYYMMDD-CC PIC  X(02).                              
                   15  SDT-YYYYMMDD-YY PIC  X(02).                              
               10  FILLER              PIC  X(01).                              
               10  SDT-YYYYMMDD-MM     PIC  X(02).                              
               10  FILLER              PIC  X(01).                              
               10  SDT-YYYYMMDD-DD     PIC  X(02).                              
           05  SDT-HHMMSS              PIC  X(08)          VALUE SPACE.         
           05  FILLER REDEFINES SDT-HHMMSS.                                     
               10  SDT-HHMMSS-HH       PIC  X(02).                              
               10  FILLER              PIC  X(01).                              
               10  SDT-HHMMSS-MM       PIC  X(02).                              
               10  FILLER              PIC  X(01).                              
               10  SDT-HHMMSS-SS       PIC  X(02).                              
                                                                                
      ******************************************************************        
      * THIS TABLE IS USED TO STORE ALL TRANSFERS FOR PROCESSING FROM           
      * LOCATION AND TO LOCATION                                                
      ******************************************************************        
       01  DRDT-DUP-RCD-DTL-TBL.                                                
           05  DRDT-DUP-RCD-DTL        OCCURS 5000 TIMES.                       
               10  DRDT-DUP-FLAG       PIC  X(01)          VALUE SPACE.         
               10  DRDT-XFER-DKEY-ID   PIC S9(09)          VALUE +0             
                                                           COMP.                
               10  DRDT-FR-LOC-NBR     PIC S9(04)          VALUE +0             
                                                           COMP.                
               10  DRDT-TO-LOC-NBR     PIC S9(04)          VALUE +0             
                                                           COMP.                
               10  DRDT-XFER-SEQ-NBR   PIC S9(09)          VALUE +0             
                                                           COMP.                
               10  DRDT-MIN-XFER-STAT-CDE                                       
                                       PIC  X(02)          VALUE SPACE.         
               10  DRDT-MIN-XFER-STAT-DESC                                      
                                       PIC  X(20)          VALUE SPACE.         
               10  DRDT-MAX-XFER-STAT-CDE                                       
                                       PIC  X(02)          VALUE SPACE.         
               10  DRDT-MAX-XFER-STAT-DESC                                      
                                       PIC  X(20)          VALUE SPACE.         
               10  DRDT-CMPT-XFER-END-TMST                                      
                                       PIC  X(26)          VALUE SPACE.         
               10  DRDT-XFER-DTE-RCVD  PIC  X(10)          VALUE SPACE.         
               10  DRDT-XFER-TOTAL-QTY PIC S9(09)          VALUE +0             
                                                           COMP.                
               10  DRDT-XFER-EXTD-RTL-PRICE                                     
                                       PIC S9(09)V9(02)    VALUE +0             
                                                           COMP-3.              
               10  DRDT-TYPE-XFER      PIC  X(02)          VALUE SPACE.         
               10  DRDT-TYPE-DESC      PIC  X(18)          VALUE SPACE.         
               10  DRDT-CLBK-NBR       PIC S9(04)          VALUE +0             
                                                           COMP.                
                                                                                
      ******************************************************************        
      * IF A ROW IS DUPLICATE FOR A FROM STORE, TO STORE, TOTAL QTY             
      * AND TOTAL EXTENDED RETAIL ARE EQUAL TO THE FIRST ROW IT IS              
      * PLACED IN HERE.   WHEN PROCESSING THE DRDT-DUP-RCD-DTL-TBL              
      * THE FIRST RECORD IS PLACED IN HERE.                                     
      ******************************************************************        
       01  RDT-RPT-DTL-TBL.                                                     
           05  RDT-DUP-RCD-DTL         OCCURS 500 TIMES.                        
               10  RDT-XFER-DKEY-ID    PIC S9(09)          VALUE +0             
                                                           COMP.                
               10  RDT-FR-LOC-NBR      PIC S9(04)          VALUE +0             
                                                           COMP.                
               10  RDT-TO-LOC-NBR      PIC S9(04)          VALUE +0             
                                                           COMP.                
               10  RDT-XFER-SEQ-NBR    PIC S9(09)          VALUE +0             
                                                           COMP.                
               10  RDT-MIN-XFER-STAT-CDE                                        
                                       PIC  X(02)          VALUE SPACE.         
               10  RDT-MIN-XFER-STAT-DESC                                       
                                       PIC  X(20)          VALUE SPACE.         
               10  RDT-MAX-XFER-STAT-CDE                                        
                                       PIC  X(02)          VALUE SPACE.         
               10  RDT-MAX-XFER-STAT-DESC                                       
                                       PIC  X(20)          VALUE SPACE.         
               10  RDT-CMPT-XFER-END-TMST                                       
                                       PIC  X(26)          VALUE SPACE.         
               10  RDT-XFER-DTE-RCVD   PIC  X(10)          VALUE SPACE.         
               10  RDT-XFER-TOTAL-QTY  PIC S9(09)          VALUE +0             
                                                           COMP.                
               10  RDT-XFER-EXTD-RTL-PRICE                                      
                                       PIC S9(09)V9(02)    VALUE +0             
                                                           COMP-3.              
               10  RDT-TYPE-XFER       PIC  X(02)          VALUE SPACE.         
               10  RDT-TYPE-DESC       PIC  X(18)          VALUE SPACE.         
               10  RDT-CLBK-NBR        PIC S9(04)          VALUE +0             
                                                           COMP.                
                                                                                
      ******************************************************************        
      * DUPLICATE XFER DETAIL RCD LAYOUT                                        
      ******************************************************************        
           COPY TFRD050.                                                        
                                                                                
      *****************************************************************         
      *                                                                         
      *****************************************************************         
           COPY DPWS500.                                                        
                                                                                
      *****************************************************************         
      * DB2 - DATE ATTRIBUTE TABLE                                              
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TDTATTR                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DB2 - XFER MASTER TABLE                                                 
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TTFMSTR                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DB2 - XFER STATUS TABLE                                                 
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TTFSTAT                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DB2 - XFER LINE ITEM TABLE                                              
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TTFITEM                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DB2 - XFER RECEIPT TABLE                                                
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TTFRCPT                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DB2 - XFER STATUS CODE TABLE                                            
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TTFSTCD                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DB2 - XFER TYPE CODE TABLE                                              
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TTFTYCD                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DB2 - XST_LOC_DIST - LOC DIST CODE TABLE                                
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE XST00002                                                 
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * CURSOR USED TO FIND ALL TRANSFER MASTERS THIS CURSOR SELECTS ALL        
      * TRANSFER MASTERS THAT ARE OF TYPE 00, 01, 02 (DEF/DAMAGE -              
      * SORT1, DEF/DAMAGE - SORT2, CALLBACK), CREATED IN THE PRIOR              
      * FISCAL MONTH                                                            
      * IT ALSO CONTROLS THE FLOW OF THE PROGRAM AT THE END THE PROGRAM         
      * IS COMPLETE                                                             
      *****************************************************************         
           EXEC SQL                                                             
             DECLARE FIRSTXFER CURSOR FOR                                       
             SELECT FR_STR_NBR,                                                 
                    XFER_SEQ_NBR,                                               
                    XFER_DKEY_ID,                                               
                    M.XFER_TYP_CDE,                                             
                    CMPT_XFER_END_TMST,                                         
                    CMPT_XFER_BEG_TMST,                                         
                    TO_STR_NBR,                                                 
                    CLBK_NBR,                                                   
                    TYP_1ST_LNE_DESC                                            
             FROM TTFMSTR M INNER JOIN TTFTYCD TC                               
             ON M.XFER_TYP_CDE IN ('00','01','02')                              
             AND (CMPT_XFER_END_TMST BETWEEN                                    
               :PV-FSCL-MN-BEG-TMST                                             
               AND :PV-FSCL-MN-END-TMST)                                        
             AND M.XFER_TYP_CDE = TC.XFER_TYP_CDE                               
             ORDER BY FR_STR_NBR,                                               
                     TO_STR_NBR,                                                
                     CMPT_XFER_END_TMST                                         
             WITH UR                                                            
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DB2 STANDARD COPYBOOK                                                   
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  EXTENSION TO THE SQL COMMUNICATIONS AREA FOR EDITING                   
      *  SQL CODES FOR DISPLAY                                                  
      *****************************************************************         
           COPY SQLCA2.                                                         
                                                                                
      ******************************************************************        
       LINKAGE SECTION.                                                         
                                                                                
      /*****************************************************************        
       PROCEDURE DIVISION.                                                      
      ******************************************************************        
                                                                                
      ******************************************************************        
      *  MAIN PROCESSING.                                                       
      ******************************************************************        
       0000-MAIN-MODULE.                                                        
                                                                                
           DISPLAY '**********************************'.                        
           DISPLAY '* START OF TFKUT200               '.                        
           DISPLAY '**********************************'.                        
                                                                                
           PERFORM 0100-INITIALIZE.                                             
                                                                                
           PERFORM 7140-OPEN-FIRSTXFER-CSR.                                     
           IF PS-FIRSTXFER-OPEN                                                 
               PERFORM 7141-FETCH-FIRSTXFER-ROW                                 
               PERFORM 1000-PROCESS-FIRSTXFER-DTL                               
                 UNTIL PS-FISRTXFER-EOF                                         
               PERFORM 7142-CLOSE-FIRSTXFER-CSR                                 
      * PROCESS LAST LOCATION IN THE DRDT-DUP-RCD-DTL-TBL                       
               PERFORM 2100-FIND-DUP-XFERS                                      
                 VARYING PV-DRT-FIND-INDEX                                      
                   FROM 1 BY 1                                                  
                   UNTIL PV-DRT-FIND-INDEX > PV-DRT-RCD-CNT                     
           END-IF.                                                              
                                                                                
           PERFORM 0900-DISPLAY-PROGRAM-TOTALS.                                 
                                                                                
           GOBACK.                                                              
                                                                                
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       0100-INITIALIZE.                                                         
                                                                                
           PERFORM 7600-SELECT-DATE-TIME.                                       
                                                                                
           DISPLAY '* TFKUT200 - RUN DATE: ' SDT-YYYYMMDD ' - '                 
              SDT-HHMMSS.                                                       
                                                                                
      *  ACCEPT CONTROL CARD TO GET DATES FOR DB2 READS                         
           ACCEPT                      CC-PROCESS-DATE.                         
           IF CC-PROCESS-DATE = SPACE                                           
               MOVE SDT-YYYYMMDD       TO CC-PROCESS-DATE                       
           END-IF.                                                              
                                                                                
           DISPLAY '* TFKUT200 - PROCESS DATE ' CC-PROCESS-DATE.                
                                                                                
      *  GET PROCESS DATE FISCAL YEAR AND FISCAL MONTH                          
           PERFORM 7000-SELECT-TDTATTR-DTL.                                     
                                                                                
      *  USE DATE ROUTINE TO GET FISCAL MONTH BEGIN END DATES TWO               
      *  PERIODS BEFORE PROCESS DATE PERIOD                                     
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                      
           SET DPG51-FISCAL-454-CALENDAR                                        
                                       TO TRUE.                                 
           SET DPG51-DECREMENT-DATE    TO TRUE.                                 
           MOVE 2                      TO DPG51-INCR-DECR-FISCAL-PRD-9.         
           SET DPG52-LK-DTE-FISC-PRD-CC                                         
                                       TO TRUE.                                 
           MOVE PV-DTE-FSCL-PERIOD     TO DPG52-LK-DATE-INPUT.                  
                                                                                
           PERFORM 6000-DATE-ROUTINE.                                           
                                                                                
           DISPLAY '* TFKUT200 - ' DPG51-INCR-DECR-FISCAL-PRD-9                 
             ' PERIODS AGO FISCAL MONTH BEGIN DATE '                            
             PV-FSCL-MN-BEG-DTE.                                                
           DISPLAY '* TFKUT200 - ' DPG51-INCR-DECR-FISCAL-PRD-9                 
             ' PERIODS AGO FISCAL MONTH END DATE '                              
             PV-FSCL-MN-END-DTE.                                                
           SET PV-FSCL-MN-BEG-TIME     TO TRUE.                                 
           SET PV-FSCL-MN-END-TIME     TO TRUE.                                 
                                                                                
           OPEN OUTPUT DUPLICATE-XFER-DTL.                                      
                                                                                
      ******************************************************************        
       0900-DISPLAY-PROGRAM-TOTALS.                                             
                                                                                
           CLOSE DUPLICATE-XFER-DTL.                                            
                                                                                
           DISPLAY '**********************************'.                        
           DISPLAY '* TFKUT200 PROGRAM STATISTICS:    '.                        
           DISPLAY '**********************************'.                        
           DISPLAY '* TOTAL XFERS READ: ' PT-FIRSTXFER-RCD-FND.                 
           DISPLAY '* DUP XFERS WRITTEN: ' PT-RCD-WRTTN.                        
           DISPLAY '**********************************'.                        
           DISPLAY '**********************************'.                        
           DISPLAY '* END OF TFKUT200                 '.                        
           DISPLAY '**********************************'.                        
                                                                                
      /*****************************************************************        
      *                                                                         
      ******************************************************************        
       1000-PROCESS-FIRSTXFER-DTL.                                              
                                                                                
           IF TFMSTR-FR-STR-NBR NOT = PV-FR-STR-NBR                             
           OR TFMSTR-TO-STR-NBR NOT = PV-TO-STR-NBR                             
               IF PV-FR-STR-NBR > 0                                             
               OR PV-TO-STR-NBR > 0                                             
      *  IF CHANGE EVALUATE TABLE FOR DUPS                                      
                 PERFORM 2100-FIND-DUP-XFERS                                    
                   VARYING PV-DRT-FIND-INDEX                                    
                     FROM 1 BY 1                                                
                     UNTIL PV-DRT-FIND-INDEX > PV-DRT-RCD-CNT                   
                                                                                
                 INITIALIZE            DRDT-DUP-RCD-DTL-TBL                     
                                       PV-DRT-RCD-CNT                           
               END-IF                                                           
               MOVE TFMSTR-FR-STR-NBR  TO PV-FR-STR-NBR                         
               MOVE TFMSTR-TO-STR-NBR  TO PV-TO-STR-NBR                         
           END-IF.                                                              
                                                                                
           MOVE TFMSTR-XFER-DKEY-ID    TO PV-XFER-DKEY-ID.                      
           PERFORM 7220-SELECT-MIN-TTFSTAT-RCD.                                 
           IF PS-MIN-TTFSTAT-RCD-FND                                            
               PERFORM 7230-SELET-MAX-TTFSTAT-RCD                               
               IF PS-MAX-TTFSTAT-RCD-FND                                        
                 IF TFSTAT-XFER-STAT-CDE = PC-XFER-STAT-CDE-VOID                
                   CONTINUE                                                     
                 ELSE                                                           
                   PERFORM 7300-SELECT-TTFITEM-SUM                              
                   IF PS-SUM-TTFITEM-RCD-FND                                    
                     PERFORM 2000-FILL-XFER-TBL                                 
                   END-IF                                                       
                 END-IF                                                         
               END-IF                                                           
           END-IF.                                                              
                                                                                
           PERFORM 7141-FETCH-FIRSTXFER-ROW.                                    
                                                                                
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       2000-FILL-XFER-TBL.                                                      
                                                                                
           ADD +1                      TO PV-DRT-RCD-CNT.                       
           IF PV-DRT-RCD-CNT <= PV-DRT-MAX-RCDS                                 
               MOVE TFMSTR-XFER-DKEY-ID                                         
                                       TO DRDT-XFER-DKEY-ID                     
                                          (PV-DRT-RCD-CNT)                      
               MOVE TFMSTR-FR-STR-NBR  TO DRDT-FR-LOC-NBR                       
                                          (PV-DRT-RCD-CNT)                      
               MOVE TFMSTR-XFER-SEQ-NBR                                         
                                       TO DRDT-XFER-SEQ-NBR                     
                                          (PV-DRT-RCD-CNT)                      
               MOVE TFMSTR-TO-STR-NBR  TO DRDT-TO-LOC-NBR                       
                                          (PV-DRT-RCD-CNT)                      
                                                                                
               MOVE PV-MIN-XFER-STAT-CDE                                        
                                       TO DRDT-MIN-XFER-STAT-CDE                
                                          (PV-DRT-RCD-CNT)                      
               MOVE PV-MIN-XFER-STAT-DESC                                       
                                       TO DRDT-MIN-XFER-STAT-DESC               
                                          (PV-DRT-RCD-CNT)                      
               MOVE PV-MAX-XFER-STAT-CDE                                        
                                       TO DRDT-MAX-XFER-STAT-CDE                
                                          (PV-DRT-RCD-CNT)                      
               MOVE PV-MAX-XFER-STAT-DESC                                       
                                       TO DRDT-MAX-XFER-STAT-DESC               
                                          (PV-DRT-RCD-CNT)                      
                                                                                
               MOVE TFMSTR-CMPT-XFER-END-TMST                                   
                                       TO DRDT-CMPT-XFER-END-TMST               
                                          (PV-DRT-RCD-CNT)                      
                                                                                
               MOVE PV-XFER-QTY        TO DRDT-XFER-TOTAL-QTY                   
                                          (PV-DRT-RCD-CNT)                      
               MOVE PV-EXTD-RTL-PRICE  TO DRDT-XFER-EXTD-RTL-PRICE              
                                          (PV-DRT-RCD-CNT)                      
               MOVE TFMSTR-XFER-TYP-CDE                                         
                                       TO DRDT-TYPE-XFER                        
                                          (PV-DRT-RCD-CNT)                      
               MOVE TFTYCD-TYP-1ST-LNE-DESC                                     
                                       TO DRDT-TYPE-DESC                        
                                          (PV-DRT-RCD-CNT)                      
               MOVE TFMSTR-CLBK-NBR    TO DRDT-CLBK-NBR                         
                                          (PV-DRT-RCD-CNT)                      
           ELSE                                                                 
      *    IF PV-DRT-RCD-CNT > PV-DRT-MAX-RCDS                                  
               DISPLAY '* TFKUT200 - ' PV-DRT-RCD-CNT ' > '                     
                 PV-DRT-MAX-RCDS                                                
               MOVE +4004              TO ABEND-CODE                            
               MOVE '2000-FILL-XFER-TBL'                                        
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'PV-DRT-RCD-CNT > PV-DRT-MAX-RCDS'                          
                                       TO PV-OPER-ATTEMPTED                     
               PERFORM 9999-ABEND                                               
           END-IF.                                                              
                                                                                
      ******************************************************************        
       2100-FIND-DUP-XFERS.                                                     
                                                                                
      * PLACE THE FIRST DRDT-DUP-RCD-DTL-TBL RECORD INTO THE                    
      * RDT-RPT-DTL-TBL                                                         
           IF DRDT-DUP-FLAG (PV-DRT-FIND-INDEX) = 'M'                           
               CONTINUE                                                         
           ELSE                                                                 
               INITIALIZE              PS-XFER-STAT-CDE-PSTVLY-RCD-SW           
                                       PS-XFER-STAT-CD-ASMTVLY-RCD-SW           
                                       RDT-RPT-DTL-TBL                          
                                       PV-RDT-RCD-CNT                           
      * PLACE THE FIRST DRDT-DUP-RCD-DTL-TBL RECORD INTO THE                    
      * RDT-RPT-DTL-TBL                                                         
               PERFORM 5100-STORE-FMT-RPT-BASE                                  
               MOVE PV-DRT-FIND-INDEX  TO PV-INDEX                              
               ADD +1                  TO PV-INDEX                              
               PERFORM 3000-MATCH-XFER-QTY-RTL                                  
                 VARYING PV-DRT-MATCH-INDEX                                     
                 FROM PV-INDEX BY +1                                            
                 UNTIL PV-DRT-MATCH-INDEX > PV-DRT-RCD-CNT                      
               IF PS-XFER-STAT-CDE-PSTVLY-RCD                                   
               AND PS-XFER-STAT-CD-ASMTVLY-RCD                                  
      * THERE IS AT LEAST ONE TRANSFER WHERE THE MAXIMUM STATUS IS              
      * POSITIVELY RECEIVED AND AT LEAST ONE ASSUMPTIVELY RECEIVED              
                 PERFORM 3100-FMT-DUP-XFER-RPT-DTL                              
                   VARYING PV-RDT-INDEX                                         
                   FROM 1 BY 1                                                  
                   UNTIL PV-RDT-INDEX > PV-RDT-RCD-CNT                          
               END-IF                                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       3000-MATCH-XFER-QTY-RTL.                                                 
                                                                                
           IF DRDT-XFER-TOTAL-QTY (PV-DRT-MATCH-INDEX) =                        
             DRDT-XFER-TOTAL-QTY (PV-DRT-FIND-INDEX)                            
           AND DRDT-XFER-EXTD-RTL-PRICE (PV-DRT-MATCH-INDEX) =                  
             DRDT-XFER-EXTD-RTL-PRICE (PV-DRT-FIND-INDEX)                       
               PERFORM 5000-STORE-FMT-DUP-DTL                                   
               MOVE 'M'                TO DRDT-DUP-FLAG                         
                                          (PV-DRT-MATCH-INDEX)                  
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *  IF ONE ROW IN THIS TABLE IS NOT POSITIVELY RECEIVED. OUTPUT            
      *  THE TABLE                                                              
      ******************************************************************        
      * THERE IS AT LEAST ONE TRANSFER WHERE THE MAXIMUM STATUS IS              
      * POSITIVELY RECEIVED AND AT LEAST ONE ASSUMPTIVELY RECEIVED              
      ******************************************************************        
      * THERE IS AT LEAST ONE TRANSFER WHERE THE MAXIMUM STATUS IS              
      * POSITIVELY RECEIVED AND AT LEAST ONE ASSUMPTIVELY RECEIVED              
      * AND THE TOTAL QTY AND TOTAL EXTENDED RETAIL ARE EQUAL.                  
      ******************************************************************        
       3100-FMT-DUP-XFER-RPT-DTL.                                               
                                                                                
           INITIALIZE                  TF050-XFER-DUP-REC.                      
                                                                                
           IF RDT-FR-LOC-NBR (PV-RDT-INDEX) NOT = PV-PREV-FR-STR-NBR            
               MOVE RDT-FR-LOC-NBR (PV-RDT-INDEX)                               
                                       TO XST00002-LOC-NBR                      
               PERFORM 7500-SELECT-XST-LOC-DIST                                 
               MOVE XST00002-LOC-NBR   TO PV-PREV-FR-STR-NBR                    
           END-IF.                                                              
                                                                                
           MOVE XST00002-DIST-NBR      TO TF050-DIST-NBR.                       
                                                                                
           MOVE RDT-FR-LOC-NBR (PV-RDT-INDEX)                                   
                                       TO TF050-FR-LOC-NBR.                     
           MOVE RDT-XFER-SEQ-NBR (PV-RDT-INDEX)                                 
                                       TO TF050-XFER-SEQ-NBR.                   
           MOVE RDT-TO-LOC-NBR (PV-RDT-INDEX)                                   
                                       TO TF050-TO-LOC-NBR.                     
           MOVE RDT-CMPT-XFER-END-TMST (PV-RDT-INDEX)                           
                                       TO TF050-CMPT-XFER-END-TMST              
                                                                                
           IF RDT-MAX-XFER-STAT-CDE (PV-RDT-INDEX) =                            
             PC-XFER-STAT-CDE-ASMPTVLY-RCVD                                     
               MOVE RDT-MIN-XFER-STAT-CDE (PV-RDT-INDEX)                        
                                       TO RDT-MAX-XFER-STAT-CDE                 
                                          (PV-RDT-INDEX)                        
               MOVE RDT-MIN-XFER-STAT-DESC (PV-RDT-INDEX)                       
                                       TO RDT-MAX-XFER-STAT-DESC                
                                          (PV-RDT-INDEX)                        
           END-IF.                                                              
                                                                                
           IF (RDT-MAX-XFER-STAT-CDE (PV-RDT-INDEX) =                           
             PC-XFER-STAT-CDE-COMPLETED)                                        
               MOVE SPACE              TO TF050-RCV-XFER-BEG-DTE-MAX            
           ELSE                                                                 
               MOVE RDT-XFER-DKEY-ID (PV-RDT-INDEX)                             
                                       TO PV-RCPT-XFER-DKEY-ID                  
               PERFORM 7400-SELECT-TTFRCPT-MAX-DTE                              
               MOVE TFRCPT-RCV-XFER-BEG-TMST                                    
                                       TO TF050-RCV-XFER-BEG-DTE-MAX            
           END-IF.                                                              
                                                                                
           MOVE RDT-TYPE-XFER (PV-RDT-INDEX)                                    
                                       TO TF050-XFER-TYP-CDE.                   
           MOVE RDT-TYPE-DESC (PV-RDT-INDEX)                                    
                                       TO TF050-TYP-1ST-LNE-DESC.               
                                                                                
           MOVE RDT-MAX-XFER-STAT-CDE (PV-RDT-INDEX)                            
                                       TO TF050-XFER-STAT-CDE.                  
           MOVE RDT-MAX-XFER-STAT-DESC (PV-RDT-INDEX)                           
                                       TO TF050-XFER-STAT-DESC.                 
           MOVE RDT-XFER-TOTAL-QTY (PV-RDT-INDEX)                               
                                       TO TF050-XFER-QTY-TOTAL.                 
           MOVE RDT-XFER-EXTD-RTL-PRICE (PV-RDT-INDEX)                          
                                       TO TF050-XFER-RTL-TOTAL.                 
           MOVE RDT-CLBK-NBR (PV-RDT-INDEX)                                     
                                       TO TF050-CLBK-NBR.                       
           MOVE PV-FSCL-MN-BEG-DTE     TO TF050-PERIOD-BGN-DTE.                 
           MOVE PV-FSCL-MN-END-DTE     TO TF050-PERIOD-END-DTE.                 
                                                                                
           PERFORM 8200-WRITE-DUP-XFER-DTL.                                     
                                                                                
      ******************************************************************        
      *                                                                         
      ******************************************************************        
      * IF A ROW IS DUPLICATE FOR A FROM STORE, TO STORE, TOTAL QTY             
      * AND TOTAL EXTENDED RETAIL ARE EQUAL TO THE FIRST ROW IT IS              
      * PLACED IN HERE.   WHEN PROCESSING THE DRDT-DUP-RCD-DTL-TBL              
      * THE FIRST RECORD IS PLACED IN HERE.                                     
      ******************************************************************        
       5000-STORE-FMT-DUP-DTL.                                                  
                                                                                
           ADD +1                      TO PV-RDT-RCD-CNT.                       
           IF PV-RDT-RCD-CNT <= PV-RDT-MAX-RCDS                                 
               MOVE DRDT-XFER-DKEY-ID (PV-DRT-MATCH-INDEX)                      
                                       TO RDT-XFER-DKEY-ID                      
                                          (PV-RDT-RCD-CNT)                      
               MOVE DRDT-FR-LOC-NBR (PV-DRT-MATCH-INDEX)                        
                                       TO RDT-FR-LOC-NBR                        
                                          (PV-RDT-RCD-CNT)                      
               MOVE DRDT-XFER-SEQ-NBR (PV-DRT-MATCH-INDEX)                      
                                       TO RDT-XFER-SEQ-NBR                      
                                          (PV-RDT-RCD-CNT)                      
               MOVE DRDT-TO-LOC-NBR (PV-DRT-MATCH-INDEX)                        
                                       TO RDT-TO-LOC-NBR                        
                                          (PV-RDT-RCD-CNT)                      
                                                                                
               MOVE DRDT-MIN-XFER-STAT-CDE (PV-DRT-MATCH-INDEX)                 
                                       TO RDT-MIN-XFER-STAT-CDE                 
                                          (PV-RDT-RCD-CNT)                      
               MOVE DRDT-MIN-XFER-STAT-DESC (PV-DRT-MATCH-INDEX)                
                                       TO RDT-MIN-XFER-STAT-DESC                
                                          (PV-RDT-RCD-CNT)                      
                                                                                
               MOVE DRDT-MAX-XFER-STAT-CDE (PV-DRT-MATCH-INDEX)                 
                                       TO RDT-MAX-XFER-STAT-CDE                 
                                          (PV-RDT-RCD-CNT)                      
               MOVE DRDT-MAX-XFER-STAT-DESC (PV-DRT-MATCH-INDEX)                
                                       TO RDT-MAX-XFER-STAT-DESC                
                                          (PV-RDT-RCD-CNT)                      
                                                                                
               MOVE DRDT-CMPT-XFER-END-TMST (PV-DRT-MATCH-INDEX)                
                                       TO RDT-CMPT-XFER-END-TMST                
                                          (PV-RDT-RCD-CNT)                      
                                                                                
               MOVE DRDT-XFER-TOTAL-QTY (PV-DRT-MATCH-INDEX)                    
                                       TO RDT-XFER-TOTAL-QTY                    
                                          (PV-RDT-RCD-CNT)                      
                                                                                
               MOVE DRDT-XFER-EXTD-RTL-PRICE (PV-DRT-MATCH-INDEX)               
                                       TO RDT-XFER-EXTD-RTL-PRICE               
                                          (PV-RDT-RCD-CNT)                      
                                                                                
               MOVE DRDT-TYPE-XFER (PV-DRT-MATCH-INDEX)                         
                                       TO RDT-TYPE-XFER                         
                                          (PV-RDT-RCD-CNT)                      
                                                                                
               MOVE DRDT-TYPE-DESC (PV-DRT-MATCH-INDEX)                         
                                       TO RDT-TYPE-DESC                         
                                          (PV-RDT-RCD-CNT)                      
               MOVE DRDT-CLBK-NBR (PV-DRT-MATCH-INDEX)                          
                                       TO RDT-CLBK-NBR                          
                                          (PV-RDT-RCD-CNT)                      
                                                                                
               IF RDT-MAX-XFER-STAT-CDE (PV-RDT-RCD-CNT) =                      
                 PC-XFER-STAT-CDE-ASMPTVLY-RCVD                                 
                   SET PS-XFER-STAT-CD-ASMTVLY-RCD                              
                                       TO TRUE                                  
               ELSE                                                             
               IF RDT-MAX-XFER-STAT-CDE (PV-RDT-RCD-CNT) =                      
                 PC-XFER-STAT-CDE-PSTVLY-RCVD                                   
                   SET PS-XFER-STAT-CDE-PSTVLY-RCD                              
                                       TO TRUE                                  
               END-IF                                                           
               END-IF                                                           
           ELSE                                                                 
      *    IF PV-RDT-RCD-CNT > PV-RDT-MAX-RCDS                                  
               DISPLAY '* TFKUT200 - ' PV-DRT-RCD-CNT ' > '                     
                 PV-DRT-MAX-RCDS                                                
               MOVE +4004              TO ABEND-CODE                            
               MOVE '5000-STORE-FMT-DUP-DTL'                                    
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'PV-RDT-RCD-CNT > PV-RDT-MAX-RCDS'                          
                                       TO PV-OPER-ATTEMPTED                     
               PERFORM 9999-ABEND                                               
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * PLACE THE FIRST DRDT-DUP-RCD-DTL-TBL RECORD INTO THE                    
      * RDT-RPT-DTL-TBL                                                         
      ******************************************************************        
       5100-STORE-FMT-RPT-BASE.                                                 
                                                                                
           ADD +1                      TO PV-RDT-RCD-CNT.                       
           MOVE DRDT-XFER-DKEY-ID (PV-DRT-FIND-INDEX)                           
                                       TO RDT-XFER-DKEY-ID                      
                                          (PV-RDT-RCD-CNT).                     
           MOVE DRDT-FR-LOC-NBR (PV-DRT-FIND-INDEX)                             
                                       TO RDT-FR-LOC-NBR                        
                                          (PV-RDT-RCD-CNT).                     
           MOVE DRDT-XFER-SEQ-NBR (PV-DRT-FIND-INDEX)                           
                                       TO RDT-XFER-SEQ-NBR                      
                                          (PV-RDT-RCD-CNT).                     
           MOVE DRDT-TO-LOC-NBR (PV-DRT-FIND-INDEX)                             
                                       TO RDT-TO-LOC-NBR                        
                                          (PV-RDT-RCD-CNT).                     
                                                                                
           MOVE DRDT-MIN-XFER-STAT-CDE (PV-DRT-FIND-INDEX)                      
                                       TO RDT-MIN-XFER-STAT-CDE                 
                                          (PV-RDT-RCD-CNT).                     
           MOVE DRDT-MIN-XFER-STAT-DESC (PV-DRT-FIND-INDEX)                     
                                       TO RDT-MIN-XFER-STAT-DESC                
                                          (PV-RDT-RCD-CNT).                     
                                                                                
           MOVE DRDT-MAX-XFER-STAT-CDE (PV-DRT-FIND-INDEX)                      
                                       TO RDT-MAX-XFER-STAT-CDE                 
                                          (PV-RDT-RCD-CNT).                     
           MOVE DRDT-MAX-XFER-STAT-DESC (PV-DRT-FIND-INDEX)                     
                                       TO RDT-MAX-XFER-STAT-DESC                
                                          (PV-RDT-RCD-CNT).                     
                                                                                
           MOVE DRDT-CMPT-XFER-END-TMST (PV-DRT-FIND-INDEX)                     
                                       TO RDT-CMPT-XFER-END-TMST                
                                          (PV-RDT-RCD-CNT).                     
                                                                                
           MOVE DRDT-XFER-TOTAL-QTY (PV-DRT-FIND-INDEX)                         
                                       TO RDT-XFER-TOTAL-QTY                    
                                          (PV-RDT-RCD-CNT).                     
                                                                                
           MOVE DRDT-XFER-EXTD-RTL-PRICE (PV-DRT-FIND-INDEX)                    
                                       TO RDT-XFER-EXTD-RTL-PRICE               
                                          (PV-RDT-RCD-CNT).                     
                                                                                
           MOVE DRDT-TYPE-XFER (PV-DRT-FIND-INDEX)                              
                                       TO RDT-TYPE-XFER                         
                                          (PV-RDT-RCD-CNT).                     
                                                                                
           MOVE DRDT-TYPE-DESC (PV-DRT-FIND-INDEX)                              
                                       TO RDT-TYPE-DESC                         
                                          (PV-RDT-RCD-CNT).                     
           MOVE DRDT-CLBK-NBR (PV-DRT-FIND-INDEX)                               
                                       TO RDT-CLBK-NBR                          
                                          (PV-RDT-RCD-CNT).                     
           IF RDT-MAX-XFER-STAT-CDE (PV-RDT-RCD-CNT) =                          
             PC-XFER-STAT-CDE-ASMPTVLY-RCVD                                     
               SET PS-XFER-STAT-CD-ASMTVLY-RCD                                  
                                       TO TRUE                                  
           ELSE                                                                 
           IF RDT-MAX-XFER-STAT-CDE (PV-RDT-RCD-CNT) =                          
             PC-XFER-STAT-CDE-PSTVLY-RCVD                                       
               SET PS-XFER-STAT-CDE-PSTVLY-RCD                                  
                                       TO TRUE                                  
           END-IF                                                               
           END-IF.                                                              
                                                                                
      ******************************************************************        
       6000-DATE-ROUTINE.                                                       
                                                                                
           CALL DP500-KOHLS-CALENDAR-ROUTINE                                    
               USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                       
                                                                                
           EVALUATE TRUE                                                        
             WHEN DPG54-NO-ERROR                                                
               MOVE DPG56-FIRST-FP-DB2-ISO-FMT                                  
                                       TO PV-FSCL-MN-BEG-DTE                    
               MOVE DPG56-LAST-FP-DB2-ISO-FMT                                   
                                       TO PV-FSCL-MN-END-DTE                    
             WHEN OTHER                                                         
               DISPLAY 'DATE ERROR ' DPG54-ERROR-IND                            
               DISPLAY DPG54-CALENDAR-TYPE-IND                                  
               DISPLAY DPG54-DATE-VALID-IND                                     
               DISPLAY DPG54-INCR-DECR-IND                                      
               DISPLAY DPG54-ERROR-MESSAGE                                      
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *  GET PROCESS DATE FISCAL YEAR AND FISCAL MONTH                          
      ******************************************************************        
       7000-SELECT-TDTATTR-DTL.                                                 
                                                                                
           EXEC SQL                                                             
               SELECT KY_DTE,                                                   
                      FSCL_YR_NBR,                                              
                      FSCL_MN_NBR                                               
               INTO :DTATTR-KY-DTE,                                             
                    :PV-FSCL-YR-NBR,                                            
                    :PV-FSCL-MN-NBR                                             
               FROM TDTATTR                                                     
               WHERE KY_DTE = :CC-PROCESS-DATE                                  
               WITH UR                                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = +0                                                  
               CONTINUE                                                         
             WHEN OTHER                                                         
               MOVE '7000-SELECT-TDTATTR-DTL'                                   
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'SELECT TDTATTR'   TO PV-OPER-ATTEMPTED                     
               PERFORM 9998-DB2-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
       7140-OPEN-FIRSTXFER-CSR.                                                 
                                                                                
           EXEC SQL                                                             
               OPEN FIRSTXFER                                                   
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = +0                                                  
               SET PS-FIRSTXFER-OPEN   TO TRUE                                  
             WHEN OTHER                                                         
               INITIALIZE              PS-FIRSTXFER-OPEN-SW                     
               MOVE '7140-OPEN-FIRSTXFER-CSR'                                   
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'OPEN FIRSTXFER'   TO PV-OPER-ATTEMPTED                     
               PERFORM 9998-DB2-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
       7141-FETCH-FIRSTXFER-ROW.                                                
                                                                                
           EXEC SQL                                                             
             FETCH FIRSTXFER                                                    
             INTO  :TFMSTR-FR-STR-NBR,                                          
                   :TFMSTR-XFER-SEQ-NBR:NI-XFER-SEQ-NBR,                        
                   :TFMSTR-XFER-DKEY-ID,                                        
                   :TFMSTR-XFER-TYP-CDE,                                        
                   :TFMSTR-CMPT-XFER-END-TMST,                                  
                   :TFMSTR-CMPT-XFER-BEG-TMST:NI-CMPT-XFER-BEG-TMST,            
                   :TFMSTR-TO-STR-NBR,                                          
                   :TFMSTR-CLBK-NBR:NI-CLBK-NBR,                                
                   :TFTYCD-TYP-1ST-LNE-DESC                                     
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = +0                                                  
               ADD +1                  TO PT-FIRSTXFER-RCD-FND                  
             WHEN SQLCODE = +100                                                
               SET PS-FISRTXFER-EOF    TO TRUE                                  
             WHEN OTHER                                                         
               MOVE '7141-FETCH-FIRSTXFER-ROW'                                  
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'FETCH FIRSTXFER'  TO PV-OPER-ATTEMPTED                     
               PERFORM 9998-DB2-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
       7142-CLOSE-FIRSTXFER-CSR.                                                
                                                                                
           EXEC SQL                                                             
               CLOSE FIRSTXFER                                                  
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = +0                                                  
               INITIALIZE              PS-FIRSTXFER-OPEN-SW                     
             WHEN OTHER                                                         
               INITIALIZE              PS-FIRSTXFER-OPEN-SW                     
               MOVE '7142-CLOSE-FIRSTXFER-CSR'                                  
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'CLOSE FIRSTXFER'  TO PV-OPER-ATTEMPTED                     
               PERFORM 9998-DB2-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
       7220-SELECT-MIN-TTFSTAT-RCD.                                             
                                                                                
           EXEC SQL                                                             
               SELECT XFER_DKEY_ID,                                             
                      XFER_STAT_TMST,                                           
                      XFER_STAT_TMST,                                           
                      MN.XFER_STAT_CDE,                                         
                      MN.XFER_STAT_CDE,                                         
                      XFER_STAT_DESC                                            
               INTO :TFSTAT-XFER-DKEY-ID,                                       
                    :TFSTAT-XFER-STAT-TMST,                                     
                    :PV-MIN-XFER-STAT-TMST,                                     
                    :TFSTAT-XFER-STAT-CDE,                                      
                    :PV-MIN-XFER-STAT-CDE,                                      
                    :PV-MIN-XFER-STAT-DESC                                      
               FROM TTFSTAT MN INNER JOIN TTFSTCD SC                            
               ON XFER_DKEY_ID = :PV-XFER-DKEY-ID                               
               AND XFER_STAT_TMST =                                             
                 (SELECT MIN(XFER_STAT_TMST)                                    
                  FROM TTFSTAT                                                  
                  WHERE XFER_DKEY_ID = :PV-XFER-DKEY-ID)                        
               AND MN.XFER_STAT_CDE = SC.XFER_STAT_CDE                          
               WITH UR                                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = +0                                                  
               SET PS-MIN-TTFSTAT-RCD-FND                                       
                                       TO TRUE                                  
             WHEN SQLCODE = +100                                                
               INITIALIZE              PS-MIN-TTFSTAT-RCD-FND-SW                
             WHEN OTHER                                                         
               INITIALIZE              PS-MIN-TTFSTAT-RCD-FND-SW                
               MOVE '7220-SELECT-MIN-TTFSTAT-RCD'                               
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'SELECT TTFSTAT'   TO PV-OPER-ATTEMPTED                     
               PERFORM 9998-DB2-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
       7230-SELET-MAX-TTFSTAT-RCD.                                              
                                                                                
           EXEC SQL                                                             
               SELECT XFER_DKEY_ID,                                             
                      XFER_STAT_TMST,                                           
                      XFER_STAT_TMST,                                           
                      MX.XFER_STAT_CDE,                                         
                      MX.XFER_STAT_CDE,                                         
                      XFER_STAT_DESC                                            
               INTO :TFSTAT-XFER-DKEY-ID,                                       
                    :TFSTAT-XFER-STAT-TMST,                                     
                    :PV-MAX-XFER-STAT-TMST,                                     
                    :TFSTAT-XFER-STAT-CDE,                                      
                    :PV-MAX-XFER-STAT-CDE,                                      
                    :PV-MAX-XFER-STAT-DESC                                      
               FROM TTFSTAT MX INNER JOIN TTFSTCD SC                            
               ON XFER_DKEY_ID = :PV-XFER-DKEY-ID                               
               AND XFER_STAT_TMST =                                             
                 (SELECT MAX(XFER_STAT_TMST)                                    
                  FROM TTFSTAT                                                  
                  WHERE XFER_DKEY_ID = :PV-XFER-DKEY-ID)                        
               AND MX.XFER_STAT_CDE = SC.XFER_STAT_CDE                          
               WITH UR                                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = +0                                                  
               SET PS-MAX-TTFSTAT-RCD-FND                                       
                                       TO TRUE                                  
             WHEN SQLCODE = +100                                                
               INITIALIZE              PS-MAX-TTFSTAT-RCD-FND-SW                
             WHEN OTHER                                                         
               INITIALIZE              PS-MAX-TTFSTAT-RCD-FND-SW                
               MOVE '7230-SELET-MAX-TTFSTAT-RCD'                                
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'SELECT TTFSTAT'   TO PV-OPER-ATTEMPTED                     
               PERFORM 9998-DB2-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
       7300-SELECT-TTFITEM-SUM.                                                 
                                                                                
           EXEC SQL                                                             
             SELECT XFER_DKEY_ID,                                               
                    SUM(XFER_QTY),                                              
                    SUM(XFER_QTY * XFER_PRIC_AMT)                               
             INTO :TFITEM-XFER-DKEY-ID,                                         
                  :PV-XFER-QTY:NI-XFER-QTY,                                     
                  :PV-EXTD-RTL-PRICE:NI-EXTD-RTL-PRICE                          
             FROM TTFITEM                                                       
             GROUP BY XFER_DKEY_ID                                              
             HAVING XFER_DKEY_ID = :PV-XFER-DKEY-ID                             
             WITH UR                                                            
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = +0                                                  
               SET PS-SUM-TTFITEM-RCD-FND                                       
                                       TO TRUE                                  
             WHEN SQLCODE = +100                                                
               INITIALIZE              PS-SUM-TTFITEM-RCD-FND-SW                
             WHEN OTHER                                                         
               INITIALIZE              PS-SUM-TTFITEM-RCD-FND-SW                
               MOVE '7300-SELECT-TTFITEM-SUM'                                   
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'SELECT TTFITEM'   TO PV-OPER-ATTEMPTED                     
               PERFORM 9998-DB2-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
       7400-SELECT-TTFRCPT-MAX-DTE.                                             
                                                                                
           EXEC SQL                                                             
             SELECT XFER_DKEY_ID,                                               
                    RCV_XFER_BEG_TMST                                           
             INTO :TFRCPT-XFER-DKEY-ID:NI-XFER-DKEY-ID,                         
                  :TFRCPT-RCV-XFER-BEG-TMST:NI-RCV-XFER-BEG-TMST                
             FROM TTFRCPT                                                       
             WHERE XFER_DKEY_ID = :PV-RCPT-XFER-DKEY-ID                         
             AND RCV_XFER_BEG_TMST =                                            
               (SELECT MAX(RCV_XFER_BEG_TMST)                                   
                FROM TTFRCPT                                                    
                WHERE XFER_DKEY_ID = :PV-RCPT-XFER-DKEY-ID)                     
             WITH UR                                                            
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = +0                                                  
             WHEN SQLCODE = +100                                                
               CONTINUE                                                         
             WHEN OTHER                                                         
               MOVE '7400-SELECT-TTFRCPT-MAX-DTE'                               
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'SELECT TTFRCPT'   TO PV-OPER-ATTEMPTED                     
               PERFORM 9998-DB2-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
       7500-SELECT-XST-LOC-DIST.                                                
                                                                                
           EXEC SQL                                                             
             SELECT LOC_NBR,                                                    
                    DIST_NBR,                                                   
                    BEG_DTE,                                                    
                    END_DTE                                                     
             INTO :XST00002-LOC-NBR,                                            
                  :XST00002-DIST-NBR,                                           
                  :XST00002-BEG-DTE,                                            
                  :XST00002-END-DTE:NI-LD-END-DTE                               
             FROM XST_LOC_DIST                                                  
             WHERE LOC_NBR = :XST00002-LOC-NBR                                  
             AND (CURRENT DATE >= BEG_DTE                                       
               AND (CURRENT DATE <= END_DTE                                     
               OR END_DTE IS NULL))                                             
             WITH UR                                                            
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = +0                                                  
               IF XST00002-END-DTE = SPACE                                      
               OR NI-LD-END-DTE = -1                                            
                 MOVE '9999-12-31'     TO XST00002-END-DTE                      
               END-IF                                                           
             WHEN OTHER                                                         
               MOVE '7500-SELECT-XST-LOC-DIST'                                  
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'SELECT XST_LOC_DIST'                                       
                                       TO PV-OPER-ATTEMPTED                     
               PERFORM 9998-DB2-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
       7600-SELECT-DATE-TIME.                                                   
                                                                                
           EXEC SQL                                                             
             SELECT CURRENT DATE,                                               
                    CURRENT TIME                                                
             INTO :SDT-YYYYMMDD,                                                
                  :SDT-HHMMSS                                                   
             FROM SYSIBM.SYSDUMMY1                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = +0                                                  
               CONTINUE                                                         
             WHEN OTHER                                                         
               MOVE '7600-SELECT-DATE-TIME'                                     
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'SELECT SYSDUMMY1' TO PV-OPER-ATTEMPTED                     
               PERFORM 9998-DB2-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      /*****************************************************************        
      * 8200-WRITE-DUP-XFER-DTL                                                 
      ******************************************************************        
       8200-WRITE-DUP-XFER-DTL.                                                 
                                                                                
           WRITE DUPLICATE-XFER-RPT-DTL                                         
             FROM TF050-XFER-DUP-REC.                                           
                                                                                
           ADD +1                      TO PT-RCD-WRTTN.                         
                                                                                
      /*****************************************************************        
      *  FORMAT A DB2 ERROR MESSAGE & ABEND THE PROGRAM                *        
      ******************************************************************        
       9998-DB2-ABEND.                                                          
                                                                                
           DISPLAY '**********************************'.                        
           DISPLAY '** ABEND **'.                                               
           DISPLAY '** PARAGRAPH **  = ' PV-PARAGRAPH-NAME.                     
           DISPLAY '** OPERATION **  = ' PV-OPER-ATTEMPTED.                     
           DISPLAY '** TFKUT200 - SQL ERROR'.                                   
           MOVE SQLCODE TO SQLCODE2.                                            
           MOVE SQLERRD(3) TO SQLERRD3.                                         
           DISPLAY '**       SQLCODE = ' SQLCODE2.                              
           DISPLAY '**      SQLWARN0 = ' SQLWARN0.                              
           DISPLAY '**      SQLWARN1 = ' SQLWARN1.                              
           DISPLAY '**      SQLWARN2 = ' SQLWARN2.                              
           DISPLAY '**      SQLWARN3 = ' SQLWARN3.                              
           DISPLAY '**      SQLWARN4 = ' SQLWARN4.                              
           DISPLAY '**      SQLWARN5 = ' SQLWARN5.                              
           DISPLAY '**      SQLWARN6 = ' SQLWARN6.                              
           DISPLAY '**      SQLWARN7 = ' SQLWARN7.                              
           DISPLAY '**********************************'.                        
                                                                                
           MOVE +4013 TO ABEND-CODE.                                            
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
      ******************************************************************        
      *  THIS ROUTINE FORCES AN ABEND DUE TO A NON-DB2 RELATED PROBLEM.         
      ******************************************************************        
       9999-ABEND.                                                              
                                                                                
           DISPLAY '**********************************'.                        
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   **  = ' PC-PROGRAM-NAME.                      
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.                    
           DISPLAY '**  OPERATION **  = ' PV-OPER-ATTEMPTED.                    
           DISPLAY '**********************************'.                        
           CALL 'ILBOABN0'  USING ABEND-CODE.                                   
                                                                                
