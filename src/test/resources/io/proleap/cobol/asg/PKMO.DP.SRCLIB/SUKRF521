000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKRF521.                                00050000
000600 AUTHOR.                 MICHAEL WALTERS.                         00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            SEPTEMBER, 1997.                         00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM DISPLAYS THE CARTON AUDIT ASSOCIATE LOCATION       00120000
001300* SCREEN.                                                         00130000
001400******************************************************************00140000
263968*---------------------------------------------------------------* 00141006
263968* CHANGED 11/16/2021    BY JIM HUNTER      WR: CHG0263968         00142006
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00143006
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00144006
263968*---------------------------------------------------------------* 00145006
263968* CHANGED 02/14/2023    BY JEAN KURK       WR: CHG0281369         00146007
263968* REMOVED COPYBOOK FOR UPC CHECK DIGIT ROUTINE                    00147007
263968*---------------------------------------------------------------* 00149007
001500                                                                  00150000
001600******************************************************************00160000
001700 ENVIRONMENT DIVISION.                                            00170000
001800******************************************************************00180000
001900                                                                  00190000
002000******************************************************************00200000
002100 DATA DIVISION.                                                   00210000
002200******************************************************************00220000
002300                                                                  00230000
002400******************************************************************00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600******************************************************************00260000
002700 01  CA-COMMAREA.                                                 00270000
002800     COPY SUWS006.                                                00280006
002900    05  CA-PROGRAM-COMMAREA.                                      00290000
003000        10 CA-SCANNED-UPC                PIC X(15).               00300000
003100        10 CA-RETURN-MSG                 PIC X(19).               00310000
003200        10 CA-RETURN-ERROR-IND           PIC X(01) VALUE 'N'.     00320000
003300           88  CA-RETURN-ERROR                     VALUE 'Y'.     00330000
003400           88  CA-NO-RETURN-ERROR                  VALUE 'N'.     00340000
003500                                                                  00350000
003600 01  DK-DB2-KEYS.                                                 00360000
003700     05  DK-AUDIT-CNTL-NBR               PIC S9(09) COMP.         00370000
003800     05  DK-SHIP-UNIT-NBR                PIC S9(18) COMP-3.       00380000
003900     05  DK-GROUP-CODE                   PIC  X(03).              00390000
004000     05  DK-GROUP-SEQ-NBR                PIC S9(04) COMP.         00400000
004100*                                                                 00410000
004200 01  PC-PROGRAM-CONSTANTS.                                        00420000
004300     05  PC-CARTON-AUDIT-GROUP-CODE      PIC  X(03)  VALUE ' CA'. 00430000
004400     05  PC-NO-UPC-VILN-SEQ              PIC S9(04)  VALUE 0.     00440000
004500     05  PC-01                           PIC  X(02)  VALUE '01'.  00450000
004600     05  PC-INPROCESS                    PIC  X(02)  VALUE 'IP'.  00460000
004700     05  PC-COMPLETE                     PIC  X(02)  VALUE 'CM'.  00470000
004800     05  PC-POSTPONED                    PIC  X(02)  VALUE 'PP'.  00480000
004900     05  PC-STARTED-STATUS               PIC  X(18)  VALUE        00490000
005000         'IS ALREADY STARED '.                                    00500000
005100     05  PC-CLOSED-STATUS                PIC  X(18)  VALUE        00510000
005200         'IS ALREADY CLOSED '.                                    00520000
005300     05  PC-REPORT-PGM                   PIC  X(08)  VALUE        00530000
005400         'SUKRP002'.                                              00540000
005500     05  PC-RETURN-PGM                   PIC  X(08)  VALUE        00550000
005600         'SUKRF518'.                                              00560000
005700     05  PC-RANDOM-NBR-GENERATOR         PIC  X(08)  VALUE        00570000
005800         'DPKUT902'.                                              00580000
005900     05  PC-PRTR-VALIDATION-PGM          PIC  X(08)  VALUE        00590000
006000         'DPKCS060'.                                              00600000
006100     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00610000
006200         'SUKRF521'.                                              00620000
006300     05  PC-UPC-INFO-SCREEN              PIC  X(08)  VALUE        00630000
006400         'SUKRF513'.                                              00640000
006500     05  PC-SKU-ENTER-SCREEN             PIC  X(08)  VALUE        00650000
006600         'SUKRF521'.                                              00660000
006700     05  PC-DATA-INFO-SCREEN             PIC  X(08)  VALUE        00670000
006800         'SUKRF519'.                                              00680000
006900     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'S521'.00690000
006910     05  PC-TRANS-UNAVAILABLE-MSG   PIC X(19) VALUE               00691004
006920                                           'TRANS NOT AVAILABLE'. 00692004
007000                                                                  00700000
007100                                                                  00710000
007200 01  PS-PROGRAM-SWITCHES.                                         00720000
007300     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   00730000
007400         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   00740000
007500         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   00750000
007600     05  PS-AUDIT-NBR-IND                PIC  X(01)  VALUE 'N'.   00760000
007700         88  PS-AUDIT-NBR-NOT-EXISTS                 VALUE 'N'.   00770000
007800         88  PS-AUDIT-NBR-EXISTS                     VALUE 'Y'.   00780000
007900                                                                  00790000
008000 01  PV-PROGRAM-VARIABLES.                                        00800000
008010     05  PV-SKU-NBR-X                    PIC  X(08).              00801003
008020     05  PV-SKU-NBR REDEFINES PV-SKU-NBR-X                        00802003
008030                                         PIC  9(08).              00803003
008100     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   00810000
008200                                                     COMP SYNC.   00820000
008300     05  PV-CLOSED-DAYS                  PIC S9(04)  VALUE ZERO   00830000
008400                                                     COMP.        00840000
008500     05  PV-CLOSED-HOURS                 PIC S9(02)  VALUE ZERO   00850000
008600                                                     COMP.        00860000
008700     05  PV-CLOSED-MINUTES               PIC S9(02)  VALUE ZERO   00870000
008800                                                     COMP.        00880000
008900     05  PV-TOTAL-CLOSED-MINUTES         PIC S9(09)  VALUE ZERO   00890000
009000                                                     COMP.        00900000
009100     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 00910000
009200     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 00920000
009300     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00930000
009400                                                     COMP SYNC.   00940000
009500     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 00950000
009600     05  PV-OPER-UNT-ID                  PIC S9(04)  VALUE ZEROS  00960000
009700                                                     COMP.        00970000
009800     05  PV-FCLTY-ID                     PIC S9(04)  VALUE ZEROS  00980000
009900                                                     COMP.        00990000
010000     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   01000000
010100                                                     COMP.        01010000
010200     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   01020000
010300                                                     COMP SYNC.   01030000
010400     05  PV-DISPLAY-KEYS.                                         01040000
010500         10 FILLER                       PIC X(12)                01050000
010600            VALUE 'KEY VALUES: '.                                 01060000
010700         10 PV-DISP-AUD-CNTL-NBR         PIC 9(09).               01070000
010800         10 FILLER                       PIC X(04)                01080000
010900            VALUE ' -- '.                                         01090000
011000         10 PV-DISP-SHIPT-UNT-ID         PIC 9(18).               01100000
011100         10 FILLER                       PIC X(04)                01110000
011200            VALUE ' -- '.                                         01120000
011300         10 PV-DISP-UPC-NBR              PIC 9(15).               01130000
011400         10 FILLER                       PIC X(04)                01140000
011500            VALUE ' -- '.                                         01150000
011600         10 PV-DISP-SCN-TMST             PIC X(26).               01160000
011700*                                                                 01170000
011800 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  01180000
011900     05  TS-INFO-QUEUE-NAME.                                      01190000
012000         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 01200000
012100         10  FILLER                      PIC  X(04)  VALUE 'INFO'.01210000
012200                                                                  01220000
012300******************************************************************01230000
012400*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01240000
012500******************************************************************01250000
012600     COPY DFHAID.                                                 01260000
012700                                                                  01270000
012800*                                                                 01280000
012900*  TEMPORARY STORAGE QUEUE LAYOUT FOR LOGON/UNIT RELATED          01290000
013000*  INFORMATION CAPTURED BY THE NAVIGATOR AT LOGON TIME            01300000
013100*                                                                 01310000
013200*    COPY DPWS026.                                                01320006
013300                                                                  01330000
013400******************************************************************01340000
013500*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                01350000
013600******************************************************************01360000
013700     COPY DPWS013.                                                01370006
013800                                                                  01380000
014400******************************************************************01440000
014500*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01450000
014600*****************************************************************.01460000
014700     COPY DPWS010I.                                               01470006
014800                                                                  01480000
014900******************************************************************01490000
015000*  GENERATED DSECT FOR THE SUKM521 MAPSET                         01500000
015100******************************************************************01510000
015200     COPY SUKM521.                                                01520006
015300                                                                  01530000
015400******************************************************************01540000
015500*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01550000
015600******************************************************************01560000
015700     COPY DPWS015.                                                01570006
015800                                                                  01580000
015810*----------------------------------------------------------------*01581004
015820* HELP SCREEN COMMAREA                                            01582004
015830     COPY PCWS192.                                                01583004
015840*----------------------------------------------------------------*01584004
015850* HELP SCREEN WORK AREA                                           01585004
015860     COPY PCWS188.                                                01586004
015870                                                                  01587004
015900******************************************************************01590000
016000*  RANDOM NUMBER AREA.                                            01600000
016100******************************************************************01610000
016200     COPY DPWS902.                                                01620006
016300                                                                  01630000
016400******************************************************************01640000
016500*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      01650000
016600*  TO BE DISPLAYED ON THE LRT                                     01660000
016700******************************************************************01670000
016800     COPY SUWS005.                                                01680006
016900                                                                  01690000
017000******************************************************************01700000
017100 LINKAGE SECTION.                                                 01710000
017200******************************************************************01720000
017300 01  DFHCOMMAREA.                                                 01730000
017400     05  FILLER                         OCCURS  1 TO 4072 TIMES   01740000
017500                                        DEPENDING ON EIBCALEN.    01750000
017600         10  FILLER                     PIC X.                    01760000
017700                                                                  01770000
017800                                                                  01780000
017900******************************************************************01790000
018000 PROCEDURE DIVISION.                                              01800000
018100******************************************************************01810000
018200 0000-PROGRAM-MAINLINE.                                           01820000
018300     MOVE DFHCOMMAREA  TO  CA-COMMAREA.                           01830000
018400     MOVE LOW-VALUES   TO  SU521AI.                               01840000
018500                                                                  01850000
018600     EVALUATE TRUE                                                01860000
018700*        IF CONTROL IS BEING RETURN TO THIS PROGRAM WITH AN       01870000
018800*        ERROR, JUST DISPLAY THE SCREEN WITH THE ERROR MSG        01880000
018900         WHEN CA-RETURN-ERROR                                     01890000
019000             SET SU006-PROCESS-SCREEN                             01900000
019100                 CA-NO-RETURN-ERROR    TO  TRUE                   01910000
019200             MOVE CA-RETURN-MSG        TO AMSGLNO                 01920000
019300                                                                  01930000
019400             MOVE SU006-NUMERIC-SKU    TO ASKUO                   01940003
019700                                                                  01970000
019800             PERFORM 8000-SEND-MAP                                01980000
019900             PERFORM 8200-RETURN-TRANID                           01990000
020000                                                                  02000000
020010****************************************************************  02001005
020020* DPKRF278 IS THE PGM FOR THE HELP SCREEN.                        02002005
020030****************************************************************  02003005
020040         WHEN EIBTRNID = 'Z278'                                   02004005
020050             MOVE DFHCOMMAREA          TO PC192-COMMAREA          02005005
020060             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA             02006005
020070             SET SU006-PROCESS-SCREEN  TO TRUE                    02007005
020080             MOVE +0                   TO  SU006-PGM-MSG-NBR      02008005
020090             MOVE ZERO   TO SU006-NUMERIC-SKU                     02009005
020091             MOVE SU006-UPC-X          TO  AUPCO                  02009105
020092             MOVE SU006-SHIP-UNIT-NBR-X TO ACARTONO               02009205
020093             PERFORM 8000-SEND-MAP                                02009305
020094             PERFORM 8200-RETURN-TRANID                           02009405
020095                                                                  02009505
020100         WHEN EIBCALEN = ZERO                                     02010000
020200         WHEN EIBAID = DFHCLEAR                                   02020000
020300         WHEN SU006-INITIALIZE-SCREEN                             02030000
020400             INITIALIZE CA-PROGRAM-COMMAREA                       02040000
020500             SET SU006-PROCESS-SCREEN  TO  TRUE                   02050000
020600             MOVE +0                   TO  SU006-PGM-MSG-NBR      02060000
020700             MOVE ZERO   TO SU006-NUMERIC-SKU                     02070003
020800             MOVE SU006-UPC-X          TO  AUPCO                  02080000
020900             MOVE SU006-SHIP-UNIT-NBR-X TO ACARTONO               02090000
021000                                                                  02100000
021100             PERFORM 8000-SEND-MAP                                02110000
021200             PERFORM 8200-RETURN-TRANID                           02120000
021300                                                                  02130000
021400*        SKU LOOKUP KEY WAS PRESSED                               02140000
021500         WHEN EIBAID = DFHENTER                                   02150000
021600         WHEN EIBAID = DFHPF2                                     02160000
021700             PERFORM 1200-RECEIVE-MAP                             02170000
021800             PERFORM 1300-EDIT-SELECTION                          02180000
021900                                                                  02190000
022000*            GO TO UPC INFO SCREEN                                02200000
022100             MOVE PC-UPC-INFO-SCREEN    TO  PV-TRANSFER-PROGRAM   02210000
022200             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                02220000
022300                                                                  02230000
022400*            RETURN TO PREVIOUS SCREEN                            02240000
022500         WHEN EIBAID = DFHPF3                                     02250000
022600             MOVE PC-RETURN-PGM         TO  PV-TRANSFER-PROGRAM   02260000
022700             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                02270000
022800                                                                  02280000
022900*        NO SKU F-KEY WAS PRESSED - GO TO THE DATA INFO SCREEN    02290000
023000         WHEN EIBAID = DFHPF4                                     02300000
023100             MOVE PC-DATA-INFO-SCREEN   TO  PV-TRANSFER-PROGRAM   02310000
023200             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                02320000
023300                                                                  02330000
023310         WHEN EIBAID = DFHPF1                                     02331004
023320              PERFORM 1400-HELP-SCREEN                            02332004
023330                                                                  02333004
023400         WHEN OTHER                                               02340000
023500             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO         02350000
023600                                                                  02360000
023700     END-EVALUATE.                                                02370000
023800                                                                  02380000
023900     PERFORM 8100-SEND-DATA-ONLY.                                 02390000
024000     PERFORM 8200-RETURN-TRANID.                                  02400000
024100                                                                  02410000
024200     GOBACK.                                                      02420000
024300*                                                                 02430000
024400*                                                                 02440000
024500 1200-RECEIVE-MAP.                                                02450000
024600     EXEC CICS                                                    02460000
024700         RECEIVE                                                  02470000
024800             MAP     ('SU521A')                                   02480000
024900             MAPSET  ('SUKM521')                                  02490000
025000             RESP    (PV-CICS-RESPONSE)                           02500000
025100     END-EXEC.                                                    02510000
025200                                                                  02520000
025300     EVALUATE TRUE                                                02530000
025400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02540000
025500              PERFORM 1210-RECEIVE-SCREEN-FIELDS                  02550000
025600         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                02560000
025700              CONTINUE                                            02570000
025800         WHEN OTHER                                               02580000
025900              MOVE '1200-RECEIVE-MAP'                             02590000
026000                                     TO DP013-PARAGRAPH           02600000
026100              MOVE 'UNABLE TO RECEIVE MAP'                        02610000
026200                                     TO DP013-MESSAGE-TEXT (1)    02620000
026300              SET DP013-LOGIC-ABEND  TO TRUE                      02630000
026400              SET DP013-NO-ROLLBACK  TO TRUE                      02640000
026500              PERFORM 9999-WRITE-CICS-LOG-MSG                     02650000
026600     END-EVALUATE.                                                02660000
026700*                                                                 02670000
026800 1210-RECEIVE-SCREEN-FIELDS.                                      02680000
026900*                                                                 02690000
027000     IF  ASKUL    > ZERO                                          02700001
027100         MOVE ASKUI                  TO PV-SKU-NBR-X              02710003
027110         MOVE PV-SKU-NBR             TO SU006-NUMERIC-SKU         02711003
027200     ELSE IF  ASKUF    = DP015-ERASE-EOF                          02720001
027300         MOVE SPACES                 TO PV-SKU-NBR-X              02730003
027301                                        ASKUO                     02730103
027310         MOVE ZERO                   TO SU006-NUMERIC-SKU         02731003
027500     END-IF.                                                      02750000
029000*                                                                 02900000
029100**************************************************************    02910000
029200* EDIT ALL ENTERABLE FIELDS (SKU DEPT, CLASS, SEQ)           *    02920000
029300**************************************************************    02930000
029400 1300-EDIT-SELECTION.                                             02940000
029500                                                                  02950000
029600*    CHECK TO MAKE SURE THE SKU IS NUMERIC                        02960001
029700     MOVE PV-SKU-NBR-X               TO DP010I-UNEDITED-FIELD.    02970003
029800     MOVE 8                          TO DP010I-MAXIMUM-DIGITS.    02980001
029900     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  02990000
030000     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     03000000
030100                                                                  03010000
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03021006
263968          USING DP010I-NUMERIC-EDIT-AREA.                         03022006
030300                                                                  03030000
030400     IF  DP010I-ERROR-DETECTED                                    03040000
030500         MOVE PM-NUMERIC-VALUE-REQUIRED-MSG                       03050000
030600                                     TO AMSGLNO                   03060000
030700         MOVE -1                     TO ASKUL                     03070001
030800         PERFORM 8100-SEND-DATA-ONLY                              03080000
030900         PERFORM 8200-RETURN-TRANID                               03090000
031000     ELSE                                                         03100000
031100         MOVE DP010I-NUMERIC-FIELD   TO SU006-SKU-NBR             03110001
031200     END-IF.                                                      03120000
031300                                                                  03130000
031400 1400-HELP-SCREEN.                                                03140004
031500     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      03150004
031600     MOVE 'SUKRF521'                  TO PC192-PROGRAM-NAME       03160004
031700     COPY PCPD188.                                                03170004
031800     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      03180004
031900     PERFORM 4200-XCTL-TO-HELP.                                   03190004
035000                                                                  03500000
035100                                                                  03510000
035200***************************************************************** 03520000
035300*   2100-XCTL-TO-SELECTED-PROGRAM.                              * 03530000
035400* TRANSFER CONTROL TO ANOTHER PROGRAM                           * 03540000
035500***************************************************************** 03550000
035600 2100-XCTL-TO-SELECTED-PROGRAM.                                   03560000
035700     SET SU006-INITIALIZE-SCREEN   TO  TRUE.                      03570000
035800     MOVE LENGTH OF CA-COMMAREA    TO  PV-COMMAREA-LENGTH.        03580000
035900     MOVE PC-CURRENT-PROGRAM-NAME  TO  SU006-LAST-PROGRAM.        03590000
036000                                                                  03600000
036100     EXEC CICS                                                    03610000
036200         XCTL                                                     03620000
036300             PROGRAM   (PV-TRANSFER-PROGRAM)                      03630000
036400             COMMAREA  (CA-COMMAREA)                              03640000
036500             LENGTH    (PV-COMMAREA-LENGTH)                       03650000
036600             RESP      (PV-CICS-RESPONSE)                         03660000
036700     END-EXEC.                                                    03670000
036800                                                                  03680000
036900     EVALUATE TRUE                                                03690000
037000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03700000
037100              CONTINUE                                            03710000
037200         WHEN OTHER                                               03720000
037300              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                03730000
037400                                     TO DP013-PARAGRAPH           03740000
037500              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03750000
037600                                     TO DP013-MESSAGE-TEXT (1)    03760000
037700              MOVE PV-TRANSFER-PROGRAM                            03770000
037800                                     TO DP013-MESSAGE-TEXT (2)    03780000
037900              SET DP013-CICS-ABEND   TO TRUE                      03790000
038000              SET DP013-NO-ROLLBACK  TO TRUE                      03800000
038100              PERFORM 9999-WRITE-CICS-LOG-MSG                     03810000
038200              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     03820000
038300                                     TO AMSGLNO                   03830000
038400              SET SU006-PROCESS-SCREEN TO TRUE                    03840000
038500              PERFORM 8100-SEND-DATA-ONLY                         03850000
038600              PERFORM 8200-RETURN-TRANID                          03860000
038700     END-EVALUATE.                                                03870000
038800                                                                  03880000
038810 4200-XCTL-TO-HELP.                                               03881004
038820                                                                  03882004
038830     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      03883004
038840     SET  SU006-INITIALIZE-SCREEN     TO TRUE.                    03884004
038850     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    03885004
038860                                                                  03886004
038870     EXEC CICS                                                    03887004
038880         XCTL                                                     03888004
038890             PROGRAM   (PV-TRANSFER-PROGRAM)                      03889004
038891             COMMAREA  (PC192-COMMAREA)                           03889104
038892             LENGTH    (PV-COMMAREA-LENGTH)                       03889204
038893             RESP      (PV-CICS-RESPONSE)                         03889304
038894     END-EXEC.                                                    03889404
038895                                                                  03889504
038896     EVALUATE TRUE                                                03889604
038897         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03889704
038898              CONTINUE                                            03889804
038899         WHEN OTHER                                               03889904
038900             MOVE '4200-XCTL-TO-HELP '                            03890004
038901                 TO DP013-PARAGRAPH                               03890104
038902             MOVE 'SUKRF521 - UNABLE TO XCTL TO PROGRAM: '        03890204
038903                 TO DP013-MESSAGE-TEXT (1)                        03890304
038904             MOVE PV-TRANSFER-PROGRAM                             03890404
038905                 TO DP013-MESSAGE-TEXT (2)                        03890504
038906             SET DP013-CICS-ABEND  TO TRUE                        03890604
038907             SET DP013-ROLLBACK TO TRUE                           03890704
038908             PERFORM 9999-WRITE-CICS-LOG-MSG                      03890804
038909             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             03890904
038910             SET SU006-PROCESS-SCREEN TO TRUE                     03891004
038911             PERFORM 8000-SEND-MAP                                03891104
038912             PERFORM 8200-RETURN-TRANID                           03891204
038913     END-EVALUATE.                                                03891304
038920                                                                  03892000
039000******************************************************************03900000
039100*  8000-SEND-MAP                                                 *03910000
039200*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *03920000
039300******************************************************************03930000
039400 8000-SEND-MAP.                                                   03940000
039500     EXEC CICS                                                    03950000
039600         SEND                                                     03960000
039700             MAP     ('SU521A')                                   03970000
039800             MAPSET  ('SUKM521')                                  03980000
039900             ERASE                                                03990000
040000             RESP    (PV-CICS-RESPONSE)                           04000000
040100     END-EXEC.                                                    04010000
040200                                                                  04020000
040300     EVALUATE TRUE                                                04030000
040400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04040000
040500             CONTINUE                                             04050000
040600         WHEN OTHER                                               04060000
040700             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            04070000
040800             MOVE 'UNABLE TO SEND MAP'                            04080000
040900                                    TO DP013-MESSAGE-TEXT (1)     04090000
041000             SET DP013-CICS-ABEND   TO TRUE                       04100000
041100             SET DP013-NO-ROLLBACK  TO TRUE                       04110000
041200             PERFORM 9999-WRITE-CICS-LOG-MSG                      04120000
041300     END-EVALUATE.                                                04130000
041400*                                                                 04140000
041500 8100-SEND-DATA-ONLY.                                             04150000
041600                                                                  04160000
041700     EXEC CICS                                                    04170000
041800         SEND                                                     04180000
041900             MAP       ('SU521A')                                 04190000
042000             MAPSET    ('SUKM521')                                04200000
042100             CURSOR                                               04210000
042200             DATAONLY                                             04220000
042300             RESP      (PV-CICS-RESPONSE)                         04230000
042400     END-EXEC.                                                    04240000
042500                                                                  04250000
042600     EVALUATE TRUE                                                04260000
042700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04270000
042800             CONTINUE                                             04280000
042900         WHEN OTHER                                               04290000
043000             MOVE '8100-SEND-DATA-ONLY'                           04300000
043100                                    TO DP013-PARAGRAPH            04310000
043200             MOVE 'UNABLE TO SEND DATA'                           04320000
043300                                    TO DP013-MESSAGE-TEXT (1)     04330000
043400             SET DP013-CICS-ABEND   TO TRUE                       04340000
043500             SET DP013-NO-ROLLBACK  TO TRUE                       04350000
043600             PERFORM 9999-WRITE-CICS-LOG-MSG                      04360000
043700     END-EVALUATE.                                                04370000
043800*                                                                 04380000
043900 8200-RETURN-TRANID.                                              04390000
044000     MOVE LENGTH OF CA-COMMAREA  TO  PV-COMMAREA-LENGTH.          04400000
044100                                                                  04410000
044200     EXEC CICS                                                    04420000
044300         RETURN                                                   04430000
044400             TRANSID   (PC-CURRENT-TRANID)                        04440000
044500             COMMAREA  (CA-COMMAREA)                              04450000
044600             LENGTH    (PV-COMMAREA-LENGTH)                       04460000
044700             RESP      (PV-CICS-RESPONSE)                         04470000
044800     END-EXEC.                                                    04480000
044900                                                                  04490000
045000     EVALUATE TRUE                                                04500000
045100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04510000
045200             CONTINUE                                             04520000
045300         WHEN OTHER                                               04530000
045400             MOVE '8200-RETURN-TRANID'                            04540000
045500                                    TO DP013-PARAGRAPH            04550000
045600             MOVE 'UNABLE TO RETURN TO TRANID'                    04560000
045700                                    TO DP013-MESSAGE-TEXT (1)     04570000
045800             SET DP013-CICS-ABEND   TO TRUE                       04580000
045900             SET DP013-NO-ROLLBACK  TO TRUE                       04590000
046000             PERFORM 9999-WRITE-CICS-LOG-MSG                      04600000
046100     END-EVALUATE.                                                04610000
046200*                                                                 04620000
046300*                                                                 04630000
046400 9999-WRITE-CICS-LOG-MSG.                                         04640000
046500     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            04650000
046600     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           04660000
046700     INITIALIZE DP013-SRC-TASK-NUMBER                             04670000
046800                DP013-STACK.                                      04680000
046900     SET DP013-LINK-RETURN           TO TRUE.                     04690000
047000                                                                  04700000
047100     EXEC CICS                                                    04710000
047200         LINK                                                     04720000
047300             PROGRAM   (DP013-NAME)                               04730000
047400             COMMAREA  (DP013-PARAMETERS)                         04740000
047500             LENGTH    (DP013-LENGTH)                             04750000
047600     END-EXEC.                                                    04760000
047700                                                                  04770000
047800*----------------------------------------------------------------*04780000
047900*    ABEND PROCESSOR MODULE                                      *04790000
048000*----------------------------------------------------------------*04800000
048100                                                                  04810000
048200     COPY DPPD014.                                                04820006
048300                                                                  04830000
