000100 IDENTIFICATION DIVISION.                                         00010005
000200 PROGRAM-ID.    APKCS338.                                         00020005
000300 AUTHOR.        MARY KING.                                        00030005
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040005
000500 DATE-WRITTEN.  06/17/96.                                         00050005
000600 DATE-COMPILED.                                                   00060005
000700                                                                  00070005
000800*---------------------------------------------------------------* 00080005
000900*    TRANID      - A338                                         * 00090005
001000*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * 00100005
001100*    MAPSET      - APKM338                                      * 00110005
001200*                                                               * 00120005
001300*    THIS SCREEN ALLOWS USERS TO SET UP OR INACTIVATE DIFFERENT * 00130005
001400*    TOLERANCE AMOUNTS (TOLERANCE PERCENT AND DOLLAR LIMIT USED * 00140005
001500*    IN MATCHED REPORTING) BY VENDOR.                           * 00150005
001600*---------------------------------------------------------------* 00160005
001700* CHANGE LOG:                                                   * 00170005
001800* DATE  09/01/2021                                                00180005
001900*            - CHANGE CALL OF  DPKUT100  TO                     * 00190005
002000*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00200005
002100*              MAKING THE CALL DYNAMIC VS STATIC                * 00210005
002200*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053      * 00220005
002300*                                                                *00230005
002400* DATE  10/24/2022                                              * 00240005
002500*     ADD COPYBOOK DPWS930                                      * 00250005
002600*     CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API  * 00260005
002700*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864      * 00270005
002800*---------------------------------------------------------------* 00280005
002900                                                                  00290005
003000 ENVIRONMENT DIVISION.                                            00300005
003100 DATA DIVISION.                                                   00310005
003200/                                                                 00320005
003300 WORKING-STORAGE SECTION.                                         00330005
003400                                                                  00340005
003500 01  DK-DB2-KEYS.                                                 00350005
003600     05  DK-ENT-ID                    PIC S9(09) VALUE +0         00360005
003700                                                 COMP.            00370005
003800     05  DK-DUN-NBR                   PIC X(09).                  00380005
003900                                                                  00390005
004000 01  PC-PROGRAM-CONSTANTS.                                        00400005
004100     05  PC-TRANS-ID                  PIC X(04)  VALUE 'A338'.    00410005
004200     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE 'APKCS338'.00420005
004300     05  PC-CURRENT-MAP-NAME          PIC X(08)  VALUE 'AP338A  '.00430005
004400     05  PC-CURRENT-MAPSET-NAME       PIC X(08)  VALUE 'APKM338 '.00440005
004500     05  PC-DEFAULT-TIMESTAMP           PIC  X(26)  VALUE         00450005
004600                                    '0001-01-01-01.01.01.000000'. 00460005
004700     05  PC-TSYMSG-NUMBERS.                                       00470005
004800         10  PC-TSYMSG-00007          PIC 9(05)  VALUE 00007.     00480005
004900         10  PC-TSYMSG-00008          PIC 9(05)  VALUE 00008.     00490005
005000         10  PC-TSYMSG-00034          PIC 9(05)  VALUE 00034.     00500005
005100         10  PC-TSYMSG-00059          PIC 9(05)  VALUE 00059.     00510005
005200         10  PC-TSYMSG-01095          PIC 9(05)  VALUE 01095.     00520005
005300         10  PC-TSYMSG-01169          PIC 9(05)  VALUE 01169.     00530005
005400         10  PC-TSYMSG-01309          PIC 9(05)  VALUE 01309.     00540005
005500         10  PC-TSYMSG-01310          PIC 9(05)  VALUE 01310.     00550005
005600         10  PC-TSYMSG-01311          PIC 9(05)  VALUE 01311.     00560005
005700         10  PC-TSYMSG-01312          PIC 9(05)  VALUE 01312.     00570005
005800         10  PC-TSYMSG-01313          PIC 9(05)  VALUE 01313.     00580005
005900         10  PC-TSYMSG-01314          PIC 9(05)  VALUE 01314.     00590005
006000     05  PC-IND-DESCRIPTIONS.                                     00600005
006100         10  PC-IND-DESC-SPECIFIC     PIC X(50)  VALUE            00610005
006200             '- SPECIFIC TOLERANCE VALUES BELOW ARE USED'.        00620005
006300         10  PC-IND-DESC-INACTIVE     PIC X(50)  VALUE            00630005
006400             '- INACTIVE; DEFAULT TOLERANCE VALUES ARE USED'.     00640005
006500         10  PC-IND-DESC-2            PIC X(50)  VALUE            00650005
006600             '  (ENTER ''A'' TO ACTIVATE OR ''I'' TO INACTIVATE)'.00660005
006700                                                                  00670005
006800 01  PV-PROGRAM-VARIABLES.                                        00680005
006900     05  PV-3V99                        PIC 9(3).99.              00690005
007000     05  PV-3V99-X REDEFINES                                      00700005
007100         PV-3V99                        PIC X(06).                00710005
007200     05  PV-4V99                        PIC 9(4).99.              00720005
007300     05  PV-4V99-X REDEFINES                                      00730005
007400         PV-4V99                        PIC X(07).                00740005
007500                                                                  00750005
007600 01  PS-PROGRAM-SWITCHES.                                         00760005
007700     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00770005
007800         88  PS-ERROR                            VALUE 'Y'.       00780005
007900         88  PS-NO-ERROR                         VALUE 'N'.       00790005
008000     05  PS-COMMAREA-SW               PIC  X(01) VALUE 'N'.       00800005
008100         88  PS-COMMAREA-VALID                   VALUE 'Y'.       00810005
008200         88  PS-COMMAREA-NOT-VALID               VALUE 'N'.       00820005
008300     05  PS-FOUND-SW                  PIC X(01)  VALUE 'N'.       00830005
008400         88  PS-FOUND                            VALUE 'Y'.       00840005
008500         88  PS-NOT-FOUND                        VALUE 'N'.       00850005
008600/                                                                 00860005
008700*----------------------------------------------------------------*00870005
008800*    MAP LAYOUT                                                  *00880005
008900*----------------------------------------------------------------*00890005
009000                                                                  00900005
009100     COPY APKM338.                                                00910005
009200/                                                                 00920005
009300*----------------------------------------------------------------*00930005
009400*    ATTRIBUTE SETTINGS COPYBOOK.                                *00940005
009500*----------------------------------------------------------------*00950005
009600                                                                  00960005
009700     COPY DPWS015.                                                00970005
009800/                                                                 00980005
009900*----------------------------------------------------------------*00990005
010000*    FUNCTION KEYS COPYBOOK                                      *01000005
010100*----------------------------------------------------------------*01010005
010200                                                                  01020005
010300     COPY DPWS016.                                                01030005
010400/                                                                 01040005
010500*----------------------------------------------------------------*01050005
010600*    THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHIT.   *01060005
010700*    APPLICATION PROGRAMMING INTERFACE MODULE -- DPKCS030.       *01070005
010800*----------------------------------------------------------------*01080005
010900     COPY DPWS030.                                                01090005
011000     COPY DPWS930.                                                01100005
011100/                                                                 01110005
011200*----------------------------------------------------------------*01120005
011300*    STANDARD COMMAREA.                                          *01130005
011400*----------------------------------------------------------------*01140005
011500                                                                  01150005
011600     COPY DPWS020.                                                01160005
011700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01170005
011800                                                                  01180005
011900*----------------------------------------------------------------*01190005
012000*    INTER-APPLICATION COMMAREA.                                 *01200005
012100*----------------------------------------------------------------*01210005
012200                                                                  01220005
012300         10  INTER-APPL-COMM-AREA PIC X(200).                     01230005
012400     COPY APWS302.                                                01240005
012500*----------------------------------------------------------------*01250005
012600*    SPECIFIC COMMMAREA FOR APKCS338.                            *01260005
012700*----------------------------------------------------------------*01270005
012800         10  ASC-SPECIFIC-COMMAREA.                               01280005
012900             15  ASC-INT-APPL-FORMAT-IND      PIC X(01).          01290005
013000                 88  ASC-INTER-APPL-ADD           VALUE ' '.      01300005
013100                 88  ASC-INTER-APPL-UPDATE        VALUE '1'.      01310005
013200             15  ASC-REQUEST-SW               PIC X(03).          01320005
013300                 88  ASC-INSERT-REQUESTED         VALUE 'INS'.    01330005
013400                 88  ASC-UPDATE-REQUESTED         VALUE 'UPD'.    01340005
013500             15  ASC-FIELDS-MODIFIED-SW       PIC X(01).          01350005
013600                 88  ASC-FIELDS-UNCHANGED         VALUE ' '.      01360005
013700                 88  ASC-FIELDS-MODIFIED          VALUE 'Y'.      01370005
013800             15  ASC-KEY-FIELDS.                                  01380005
013900                 20  ASC-KEY-DUN-NBR          PIC X(09).          01390005
014000                 20  ASC-KEY-ENT-ID           PIC S9(9) COMP.     01400005
014100             15  ASC-DECIMAL-FIELDS.                              01410005
014200                 20  ASC-INVC-RCV-VAR-AMT-X   PIC X(7).           01420005
014300                 20  ASC-INVC-RCV-VAR-PCT-X   PIC X(6).           01430005
014400             15  ASC-SCREEN-FIELDS.                               01440005
014500                 20  ASC-DUN-NBR              PIC X(09).          01450005
014600                 20  ASC-ENT-NAME-DESC        PIC X(30).          01460005
014700                 20  ASC-INVC-RCV-VAR-IND     PIC X(1).           01470005
014800                     88  STATUS-SPECIFIED         VALUE 'S'.      01480005
014900                     88  STATUS-INACTIVE          VALUE 'I'.      01490005
015000                 20  ASC-IND-DESC1            PIC X(50).          01500005
015100                 20  ASC-IND-DESC2            PIC X(50).          01510005
015200                 20  ASC-INVC-RCV-VAR-PCT     PIC 9(3)V99.        01520005
015300                 20  ASC-INVC-RCV-VAR-AMT     PIC 9(4)V99.        01530005
015400             15  ASC-OLD-SCREEN-VALUES.                           01540005
015500                 20  ASC-INVC-RCV-VAR-IND-OLD PIC X(1).           01550005
015600                 20  ASC-INVC-RCV-VAR-PCT-OLD PIC 9(3)V99.        01560005
015700                 20  ASC-INVC-RCV-VAR-AMT-OLD PIC 9(4)V99.        01570005
015800             15  ASC-TYPE-OF-ADD-UPDATE       PIC X(01).          01580005
015900                 88  ASC-NOT-FOUND-AT-ALL     VALUE 'N'.          01590005
016000                 88  ASC-NOT-FOUND-FOR-IND    VALUE 'X'.          01600005
016100                 88  ASC-FOUND                VALUE 'Y'.          01610005
016200/                                                                 01620005
016300*---------------------------------------------------------------* 01630005
016400*  WORK AREA FOR NUMERIC EDIT ROUTINE - DPKUT100                * 01640005
016500*---------------------------------------------------------------* 01650005
016600     COPY DPWS010I.                                               01660005
016700/                                                                 01670005
016800*----------------------------------------------------------------*01680005
016900*    ABEND PROCESSING COPYBOOK.                                  *01690005
017000*----------------------------------------------------------------*01700005
017100                                                                  01710005
017200     COPY DPWS013.                                                01720005
017300/                                                                 01730005
017400*----------------------------------------------------------------*01740005
017500*    DB2 SQL COMMUNICATION AREA                                   01750005
017600*----------------------------------------------------------------*01760005
017700     EXEC SQL                                                     01770005
017800          INCLUDE SQLCA                                           01780005
017900     END-EXEC.                                                    01790005
018000/                                                                 01800005
018100*----------------------------------------------------------------*01810005
018200*    DB2 DCLGEN FOR VENDOR EXTERNAL ENTERPRISE TABLE              01820005
018300*----------------------------------------------------------------*01830005
018400     EXEC SQL                                                     01840005
018500          INCLUDE TEXTENT                                         01850005
018600     END-EXEC.                                                    01860005
018700/                                                                 01870005
018800*----------------------------------------------------------------*01880005
018900*    DB2 DCLGEN FOR VENDOR EXTERNAL ENTERPRISE NAME TABLE         01890005
019000*----------------------------------------------------------------*01900005
019100     EXEC SQL                                                     01910005
019200          INCLUDE TENTNME                                         01920005
019300     END-EXEC.                                                    01930005
019400/                                                                 01940005
019500*----------------------------------------------------------------*01950005
019600*    DB2 DCLGEN FOR VENDOR SPECIFICATION TABLE.                   01960005
019700*----------------------------------------------------------------*01970005
019800     EXEC SQL                                                     01980005
019900          INCLUDE TAPVNDS                                         01990005
020000     END-EXEC.                                                    02000005
020100/                                                                 02010005
020200 LINKAGE SECTION.                                                 02020005
020300                                                                  02030005
020400 01  DFHCOMMAREA.                                                 02040005
020500     05  FILLER                       OCCURS  1 TO 4072 TIMES     02050005
020600                                      DEPENDING ON EIBCALEN.      02060005
020700         10  FILLER                   PIC X.                      02070005
020800/                                                                 02080005
020900 PROCEDURE DIVISION.                                              02090005
021000                                                                  02100005
021100*----------------------------------------------------------------*02110005
021200*    THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. *02120005
021300*    THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  *02130005
021400*    MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            *02140005
021500*                                                                *02150005
021600*    THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  *02160005
021700*    LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       *02170005
021800*----------------------------------------------------------------*02180005
021900 0000-MAIN-MODULE.                                                02190005
022000                                                                  02200005
022100     INITIALIZE DP030-CICS-API-FIELDS.                            02210005
022200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02220005
022300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02230005
022400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02240005
022500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02250005
022600     MOVE LENGTH OF AP338AI        TO DP030-MAP-LENGTH (1).       02260005
022700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02270005
022800     PERFORM 0001-CALL-CICS-ARCH-API.                             02280005
022900                                                                  02290005
023000     PERFORM 1000-CONTROL-PROCESSING.                             02300005
023100                                                                  02310005
023200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02320005
023300     PERFORM 0001-CALL-CICS-ARCH-API.                             02330005
023400                                                                  02340005
023500/                                                                 02350005
023600 0001-CALL-CICS-ARCH-API.                                         02360005
023700                                                                  02370005
023800     CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     02380005
023900                                     DFHCOMMAREA                  02390005
024000                                     DP030-CICS-API-FIELDS        02400005
024100                                     DP020-STANDARD-COMMAREA      02410005
024200                                     AP338AI.                     02420005
024300                                                                  02430005
024400     IF  DP030-RC-CALL-SUCCESSFUL                                 02440005
024500         CONTINUE                                                 02450005
024600     ELSE                                                         02460005
024700         SET DP013-NO-ROLLBACK                                    02470005
024800             DP013-XCTL-DISPLAY-RESTART                           02480005
024900             DP013-CICS-ABEND      TO TRUE                        02490005
025000         MOVE 'BEFORE 0000-MAIN-MODULE'                           02500005
025100                                   TO DP013-PARAGRAPH             02510005
025200         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02520005
025300-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02530005
025400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02540005
025500         PERFORM DP013-0000-PROCESS-ABEND                         02550005
025600     END-IF.                                                      02560005
025700                                                                  02570005
025800/                                                                 02580005
025900*----------------------------------------------------------------*02590005
026000*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02600005
026100*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02610005
026200*----------------------------------------------------------------*02620005
026300                                                                  02630005
026400 1000-CONTROL-PROCESSING.                                         02640005
026500                                                                  02650005
026600     EVALUATE TRUE                                                02660005
026700         WHEN DP020-NEXT-ACT-INITIAL                              02670005
026800              INITIALIZE ASC-SPECIFIC-COMMAREA                    02680005
026900              PERFORM 1100-PROCESS-INTER-APPL-COMM                02690005
027000              IF  PS-COMMAREA-NOT-VALID                           02700005
027100*                -- THIS WILL RETURN TO CALLING APPLICATION       02710005
027200*                -- WHEN API IS CALLED                            02720005
027300                 SET DP020-NEXT-ACT-APPL-ERROR                    02730005
027400                                   TO TRUE                        02740005
027500              ELSE                                                02750005
027600                  PERFORM 4000-BUILD-INITIAL-PANEL                02760005
027700                  PERFORM 3200-RESET-ATTRIBUTES                   02770005
027800                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            02780005
027900              END-IF                                              02790005
028000                                                                  02800005
028100         WHEN DP020-NEXT-ACT-READ-MAP                             02810005
028200              PERFORM 2000-PROCESS-PANEL                          02820005
028300                                                                  02830005
028400         WHEN DP020-NEXT-ACT-RETURN                               02840005
028500              CONTINUE                                            02850005
028600                                                                  02860005
028700         WHEN OTHER                                               02870005
028800              SET DP013-LOGIC-ABEND                               02880005
028900                  DP013-NO-ROLLBACK TO TRUE                       02890005
029000              MOVE '1000-CONTROL-PROCESSING'                      02900005
029100                                    TO DP013-PARAGRAPH            02910005
029200              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  02920005
029300                                    TO DP013-MESSAGE-TEXT(1)      02930005
029400              MOVE DP020-NEXT-APPL-ACTIVITY                       02940005
029500                                    TO DP013-MESSAGE-TEXT(2)      02950005
029600              PERFORM DP013-0000-PROCESS-ABEND                    02960005
029700     END-EVALUATE.                                                02970005
029800/                                                                 02980005
029900*----------------------------------------------------------------*02990005
030000* EDIT DATA IN INTER-APPL COMMAREA.                              *03000005
030100*----------------------------------------------------------------*03010005
030200                                                                  03020005
030300 1100-PROCESS-INTER-APPL-COMM.                                    03030005
030400                                                                  03040005
030500     SET PS-COMMAREA-VALID         TO TRUE.                       03050005
030600                                                                  03060005
030700     MOVE AP302-INTER-APPL-FORMAT-IND                             03070005
030800                                    TO ASC-INT-APPL-FORMAT-IND.   03080005
030900     EVALUATE TRUE                                                03090005
031000         WHEN ASC-INTER-APPL-ADD                                  03100005
031100             SET ASC-INSERT-REQUESTED    TO TRUE                  03110005
031200         WHEN ASC-INTER-APPL-UPDATE                               03120005
031300             SET ASC-UPDATE-REQUESTED    TO TRUE                  03130005
031400         WHEN OTHER                                               03140005
031500*           -- ADD OR UPDATE WAS NOT REQUESTED --                 03150005
031600             MOVE PC-TSYMSG-01309        TO DP020-MSG-NUMBER      03160005
031700             SET DP020-MSG-FATAL                                  03170005
031800                 DP020-NEXT-ACT-APPL-ERROR                        03180005
031900                 PS-COMMAREA-NOT-VALID   TO TRUE                  03190005
032000     END-EVALUATE.                                                03200005
032100                                                                  03210005
032200     EVALUATE TRUE                                                03220005
032300                                                                  03230005
032400         WHEN AP302-DUN-NBR = SPACES                              03240005
032500*            -- VENDOR NBR REQUIRED --                            03250005
032600             MOVE PC-TSYMSG-01311      TO DP020-MSG-NUMBER        03260005
032700             SET DP020-MSG-FATAL       TO TRUE                    03270005
032800             SET PS-COMMAREA-NOT-VALID TO TRUE                    03280005
032900                                                                  03290005
033000         WHEN OTHER                                               03300005
033100             MOVE AP302-DUN-NBR   TO ASC-KEY-DUN-NBR              03310005
033200                                     DK-DUN-NBR                   03320005
033300             SET PS-NOT-FOUND     TO TRUE                         03330005
033400             PERFORM 1110-GET-ENT-ID                              03340005
033500                                                                  03350005
033600             IF PS-NOT-FOUND                                      03360005
033700*            -- VENDOR NBR IS INVALID --                          03370005
033800                 MOVE PC-TSYMSG-01095      TO DP020-MSG-NUMBER    03380005
033900                 SET DP020-MSG-FATAL       TO TRUE                03390005
034000                 SET PS-COMMAREA-NOT-VALID TO TRUE                03400005
034100                                                                  03410005
034200             ELSE                                                 03420005
034300                 MOVE EXTENT-ENT-ID        TO ASC-KEY-ENT-ID      03430005
034400                                              DK-ENT-ID           03440005
034500                 SET PS-NOT-FOUND      TO TRUE                    03450005
034600                 SET ASC-NOT-FOUND-AT-ALL TO TRUE                 03460005
034700                 PERFORM 4020-GET-APVNDS                          03470005
034800                 IF PS-NOT-FOUND                                  03480005
034900                    IF ASC-UPDATE-REQUESTED                       03490005
035000*            -- APVNDS ROW NOT FOUND FOR AN UPDATE --             03500005
035100                       MOVE PC-TSYMSG-01310 TO DP020-MSG-NUMBER   03510005
035200                       SET DP020-MSG-FATAL       TO TRUE          03520005
035300                       SET PS-COMMAREA-NOT-VALID TO TRUE          03530005
035400                    END-IF                                        03540005
035500                 ELSE                                             03550005
035600                    IF ASC-INSERT-REQUESTED                       03560005
035700*            -- APVNDS ROW FOUND FOR AN INSERT --                 03570005
035800                       MOVE PC-TSYMSG-01312 TO DP020-MSG-NUMBER   03580005
035900                       SET DP020-MSG-FATAL       TO TRUE          03590005
036000                       SET PS-COMMAREA-NOT-VALID TO TRUE          03600005
036100                    END-IF                                        03610005
036200                 END-IF                                           03620005
036300             END-IF                                               03630005
036400                                                                  03640005
036500     END-EVALUATE.                                                03650005
036600/                                                                 03660005
036700*----------------------------------------------------------------*03670005
036800*    GET THE ENT ID                                              *03680005
036900*----------------------------------------------------------------*03690005
037000 1110-GET-ENT-ID.                                                 03700005
037100                                                                  03710005
037200     EXEC SQL                                                     03720005
037300          SELECT ENT_ID                                           03730005
037400            INTO :EXTENT-ENT-ID                                   03740005
037500            FROM TEXTENT                                          03750005
037600           WHERE DUN_NBR    = :DK-DUN-NBR                         03760005
037700             AND STATUS_CDE = 'A'                                 03770005
037800     END-EXEC.                                                    03780005
037900                                                                  03790005
038000     EVALUATE TRUE                                                03800005
038100         WHEN SQLCODE = +0                                        03810005
038200              SET PS-FOUND TO TRUE                                03820005
038300                                                                  03830005
038400         WHEN SQLCODE = +100                                      03840005
038500              CONTINUE                                            03850005
038600                                                                  03860005
038700         WHEN SQLWARN0 NOT = SPACES                               03870005
038800         WHEN SQLCODE < +0                                        03880005
038900         WHEN SQLCODE > +0                                        03890005
039000              MOVE '1110-GET-ENT-ID'                              03900005
039100                              TO DP013-PARAGRAPH                  03910005
039200              MOVE 'UNSUCCESSFUL SELECT ENTERPRISE ID'            03920005
039300                              TO DP013-MESSAGE-TEXT (1)           03930005
039400              MOVE SQLCA      TO DP013-SQLCA                      03940005
039500              MOVE 'TEXTENT ' TO DP013-DB2-TABLE-NAME (1)         03950005
039600              SET DP013-DB2-ABEND                                 03960005
039700                  DP013-XCTL-DISPLAY-RESTART                      03970005
039800                              TO TRUE                             03980005
039900              PERFORM DP013-0000-PROCESS-ABEND                    03990005
040000     END-EVALUATE.                                                04000005
040100/                                                                 04010005
040200*----------------------------------------------------------------*04020005
040300*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*04030005
040400*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*04040005
040500*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *04050005
040600*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *04060005
040700*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *04070005
040800*----------------------------------------------------------------*04080005
040900                                                                  04090005
041000 2000-PROCESS-PANEL.                                              04100005
041100                                                                  04110005
041200     EVALUATE TRUE                                                04120005
041300                                                                  04130005
041400         WHEN DP020-SRC-AID = DP016-CLEAR                         04140005
041500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04150005
041600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04160005
041700                                                                  04170005
041800         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04180005
041900             PERFORM 4000-BUILD-INITIAL-PANEL                     04190005
042000             PERFORM 3200-RESET-ATTRIBUTES                        04200005
042100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04210005
042200                                                                  04220005
042300         WHEN OTHER                                               04230005
042400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04240005
042500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04250005
042600             IF  PS-NO-ERROR                                      04260005
042700                 SET DP030-CONTINUE-GO                            04270005
042800                                   TO TRUE                        04280005
042900                 PERFORM 2100-CHECK-FUNCTION-KEY                  04290005
043000             ELSE                                                 04300005
043100                 SET DP030-OVERRIDE-GO                            04310005
043200                                   TO TRUE                        04320005
043300             END-IF                                               04330005
043400     END-EVALUATE.                                                04340005
043500                                                                  04350005
043600/                                                                 04360005
043700*----------------------------------------------------------------*04370005
043800*    ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED    *04380005
043900*    FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED*04390005
044000*    FROM THE CICS ARCHITECTURE API.                             *04400005
044100*----------------------------------------------------------------*04410005
044200                                                                  04420005
044300 2100-CHECK-FUNCTION-KEY.                                         04430005
044400                                                                  04440005
044500     EVALUATE TRUE                                                04450005
044600         WHEN DP020-SRC-AID = DP016-ENTER                         04460005
044700             CONTINUE                                             04470005
044800                                                                  04480005
044900*   FOR AN INSERT                                                 04490005
045000         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               04500005
045100             SET DP030-CONTINUE-GO TO TRUE                        04510005
045200             SET PS-NOT-FOUND TO TRUE                             04520005
045300             SET ASC-NOT-FOUND-AT-ALL TO TRUE                     04530005
045400             PERFORM 4020-GET-APVNDS                              04540005
045500             IF PS-FOUND                                          04550005
045600*-- ALREADY EXISTS --                                             04560005
045700                 MOVE PC-TSYMSG-01312 TO DP020-MSG-NUMBER         04570005
045800                 SET DP020-MSG-FATAL  TO TRUE                     04580005
045900             ELSE                                                 04590005
046000                 PERFORM 5000-INSERT-PROCESSING                   04600005
046100*-- ADD SUCCESSFUL --                                             04610005
046200                 MOVE PC-TSYMSG-00034  TO DP020-MSG-NUMBER        04620005
046300                 SET DP020-MSG-INFORMATIONAL TO TRUE              04630005
046400             END-IF                                               04640005
046500                                                                  04650005
046600*   FOR AN UPDATE                                                 04660005
046700         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               04670005
046800             SET DP030-CONTINUE-GO TO TRUE                        04680005
046900             SET PS-NOT-FOUND TO TRUE                             04690005
047000             SET ASC-NOT-FOUND-AT-ALL TO TRUE                     04700005
047100             PERFORM 4020-GET-APVNDS                              04710005
047200             IF PS-FOUND                                          04720005
047300                 SET ASC-FIELDS-UNCHANGED TO TRUE                 04730005
047400                 PERFORM 3600-CHECK-IF-FIELDS-CHANGED             04740005
047500                 IF ASC-FIELDS-UNCHANGED                          04750005
047600*-- ALREADY EXISTS --                                             04760005
047700                     MOVE PC-TSYMSG-01169 TO DP020-MSG-NUMBER     04770005
047800                     SET DP020-MSG-FATAL  TO TRUE                 04780005
047900                 ELSE                                             04790005
048000                     PERFORM 5100-UPDATE-PROCESSING               04800005
048100*-- UPDATE SUCCESSFUL --                                          04810005
048200                     MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER    04820005
048300                     SET DP020-MSG-INFORMATIONAL TO TRUE          04830005
048400                 END-IF                                           04840005
048500             END-IF                                               04850005
048600                                                                  04860005
048700         WHEN OTHER                                               04870005
048800             SET DP013-NO-ROLLBACK                                04880005
048900                 DP013-XCTL-DISPLAY-RESTART                       04890005
049000                 DP013-CICS-ABEND  TO TRUE                        04900005
049100             MOVE '2100-CHECK-FUNCTION-KEY'                       04910005
049200                                   TO DP013-PARAGRAPH             04920005
049300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04930005
049400                                   TO DP013-MESSAGE-TEXT (1)      04940005
049500             PERFORM DP013-0000-PROCESS-ABEND                     04950005
049600     END-EVALUATE.                                                04960005
049700                                                                  04970005
049800/                                                                 04980005
049900*----------------------------------------------------------------*04990005
050000*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *05000005
050100*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *05010005
050200*----------------------------------------------------------------*05020005
050300 2200-MOVE-SCREEN-TO-COMMAREA.                                    05030005
050400                                                                  05040005
050500     IF  AVARINDL > ZERO                                          05050005
050600         IF AVARINDI = 'A'                                        05060005
050700             MOVE 'S'              TO ASC-INVC-RCV-VAR-IND        05070005
050800         ELSE                                                     05080005
050900             MOVE AVARINDI         TO ASC-INVC-RCV-VAR-IND        05090005
051000         END-IF                                                   05100005
051100     ELSE                                                         05110005
051200         IF  AVARINDF = DP015-ERASE-EOF                           05120005
051300             MOVE SPACES           TO ASC-INVC-RCV-VAR-IND        05130005
051400         END-IF                                                   05140005
051500     END-IF.                                                      05150005
051600                                                                  05160005
051700     IF  AVARPCTL > ZERO                                          05170005
051800         MOVE AVARPCTI             TO ASC-INVC-RCV-VAR-PCT-X      05180005
051900     ELSE                                                         05190005
052000         IF  AVARPCTF = DP015-ERASE-EOF                           05200005
052100             MOVE ZEROS            TO ASC-INVC-RCV-VAR-PCT        05210005
052200                                      PV-3V99                     05220005
052300             MOVE PV-3V99-X        TO ASC-INVC-RCV-VAR-PCT-X      05230005
052400         END-IF                                                   05240005
052500     END-IF.                                                      05250005
052600                                                                  05260005
052700     IF  ADLRLIML > ZERO                                          05270005
052800         MOVE ADLRLIMI             TO ASC-INVC-RCV-VAR-AMT-X      05280005
052900     ELSE                                                         05290005
053000         IF  ADLRLIMF = DP015-ERASE-EOF                           05300005
053100             MOVE ZEROS            TO ASC-INVC-RCV-VAR-AMT        05310005
053200                                      PV-4V99                     05320005
053300             MOVE PV-4V99-X        TO ASC-INVC-RCV-VAR-AMT-X      05330005
053400         END-IF                                                   05340005
053500     END-IF.                                                      05350005
053600                                                                  05360005
053700     MOVE ASC-KEY-DUN-NBR          TO DK-DUN-NBR.                 05370005
053800     MOVE ASC-KEY-ENT-ID           TO DK-ENT-ID.                  05380005
053900/                                                                 05390005
054000*----------------------------------------------------------------*05400005
054100*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *05410005
054200*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *05420005
054300*----------------------------------------------------------------*05430005
054400 3000-EDIT-DATA-IN-COMMAREA.                                      05440005
054500                                                                  05450005
054600     PERFORM 3200-RESET-ATTRIBUTES.                               05460005
054700                                                                  05470005
054800     IF  ASC-INVC-RCV-VAR-AMT-X  > SPACES                         05480005
054900         MOVE ASC-INVC-RCV-VAR-AMT-X                              05490005
055000                                  TO DP010I-UNEDITED-FIELD        05500005
055100         MOVE 4                   TO DP010I-MAXIMUM-DIGITS        05510005
055200         MOVE 2                   TO DP010I-MAXIMUM-DECIMALS      05520005
055300         SET  DP010I-NEGATIVE-NOT-ALLOWED                         05530005
055400                                         TO TRUE                  05540005
055500         CALL DP010I-NUMERIC-EDIT-ROUTINE                         05550005
055600                         USING DP010I-NUMERIC-EDIT-AREA           05560005
055700         IF DP010I-ERROR-DETECTED                                 05570005
055800             SET DP020-MSG-FATAL         TO TRUE                  05580005
055900             MOVE DP015-UNP-ALP-BRT-OFF  TO ADLRLIMA              05590005
056000             MOVE DP015-RED              TO ADLRLIMC              05600005
056100             MOVE DP015-REVERSE          TO ADLRLIMH              05610005
056200             MOVE -1                     TO ADLRLIML              05620005
056300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05630005
056400             SET PS-ERROR                TO TRUE                  05640005
056500             IF DP010I-DIGIT-COUNT   > 4                          05650005
056600             OR DP010I-DECIMAL-COUNT > 2                          05660005
056700*        --  NUMBER OUT OF RANGE --                               05670005
056800                 MOVE PC-TSYMSG-01314    TO DP020-MSG-NUMBER      05680005
056900             ELSE                                                 05690005
057000*        --  MUST BE NUMERIC --                                   05700005
057100                 MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER      05710005
057200             END-IF                                               05720005
057300         ELSE                                                     05730005
057400             MOVE DP010I-NUMERIC-FIELD                            05740005
057500                                     TO ASC-INVC-RCV-VAR-AMT      05750005
057600                                        PV-4V99                   05760005
057700             MOVE PV-4V99-X          TO ASC-INVC-RCV-VAR-AMT-X    05770005
057800         END-IF                                                   05780005
057900     ELSE                                                         05790005
058000         SET DP020-MSG-FATAL         TO TRUE                      05800005
058100*    --  REQUIRED ENTRY  --                                       05810005
058200         MOVE DP015-UNP-ALP-BRT-OFF                               05820005
058300                                     TO ADLRLIMA                  05830005
058400         MOVE DP015-RED              TO ADLRLIMC                  05840005
058500         MOVE DP015-REVERSE          TO ADLRLIMH                  05850005
058600         MOVE -1                     TO ADLRLIML                  05860005
058700         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      05870005
058800         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          05880005
058900         SET PS-ERROR                TO TRUE                      05890005
059000     END-IF.                                                      05900005
059100                                                                  05910005
059200     IF  ASC-INVC-RCV-VAR-PCT-X > SPACES                          05920005
059300         MOVE ASC-INVC-RCV-VAR-PCT-X                              05930005
059400                              TO DP010I-UNEDITED-FIELD            05940005
059500         MOVE 3               TO DP010I-MAXIMUM-DIGITS            05950005
059600         MOVE 2               TO DP010I-MAXIMUM-DECIMALS          05960005
059700         SET  DP010I-NEGATIVE-NOT-ALLOWED                         05970005
059800                              TO TRUE                             05980005
059900         CALL DP010I-NUMERIC-EDIT-ROUTINE                         05990005
060000                         USING DP010I-NUMERIC-EDIT-AREA           06000005
060100         IF DP010I-ERROR-DETECTED                                 06010005
060200             SET DP020-MSG-FATAL         TO TRUE                  06020005
060300             MOVE DP015-UNP-ALP-BRT-OFF  TO AVARPCTA              06030005
060400             MOVE DP015-RED              TO AVARPCTC              06040005
060500             MOVE DP015-REVERSE          TO AVARPCTH              06050005
060600             MOVE -1                     TO AVARPCTL              06060005
060700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06070005
060800             SET PS-ERROR                TO TRUE                  06080005
060900             IF DP010I-DIGIT-COUNT   > 3                          06090005
061000             OR DP010I-DECIMAL-COUNT > 2                          06100005
061100*        --  NUMBER OUT OF RANGE --                               06110005
061200                 MOVE PC-TSYMSG-01314    TO DP020-MSG-NUMBER      06120005
061300             ELSE                                                 06130005
061400*        --  MUST BE NUMERIC --                                   06140005
061500                 MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER      06150005
061600             END-IF                                               06160005
061700         ELSE                                                     06170005
061800             MOVE DP010I-NUMERIC-FIELD                            06180005
061900                                     TO ASC-INVC-RCV-VAR-PCT      06190005
062000                                        PV-3V99                   06200005
062100             MOVE PV-3V99-X          TO ASC-INVC-RCV-VAR-PCT-X    06210005
062200         END-IF                                                   06220005
062300     ELSE                                                         06230005
062400         SET DP020-MSG-FATAL         TO TRUE                      06240005
062500*    --  REQUIRED ENTRY  --                                       06250005
062600         MOVE DP015-UNP-ALP-BRT-OFF  TO AVARPCTA                  06260005
062700         MOVE DP015-RED              TO AVARPCTC                  06270005
062800         MOVE DP015-REVERSE          TO AVARPCTH                  06280005
062900         MOVE -1                     TO AVARPCTL                  06290005
063000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      06300005
063100         IF PS-NO-ERROR                                           06310005
063200             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          06320005
063300         END-IF                                                   06330005
063400         SET PS-ERROR                TO TRUE                      06340005
063500     END-IF.                                                      06350005
063600                                                                  06360005
063700     IF  ASC-INVC-RCV-VAR-IND    > SPACES                         06370005
063800        IF STATUS-SPECIFIED OR STATUS-INACTIVE                    06380005
063900            CONTINUE                                              06390005
064000        ELSE                                                      06400005
064100            SET DP020-MSG-FATAL         TO TRUE                   06410005
064200*        --  STATUS MUST BE 'A' OR 'I' --                         06420005
064300            MOVE DP015-UNP-ALP-BRT-OFF  TO AVARINDA               06430005
064400            MOVE DP015-RED              TO AVARINDC               06440005
064500            MOVE DP015-REVERSE          TO AVARINDH               06450005
064600            MOVE -1                     TO AVARINDL               06460005
064700            SET DP030-SET-CURSOR-APPL-1 TO TRUE                   06470005
064800            MOVE PC-TSYMSG-01313        TO DP020-MSG-NUMBER       06480005
064900            SET PS-ERROR                TO TRUE                   06490005
065000        END-IF                                                    06500005
065100     ELSE                                                         06510005
065200         SET DP020-MSG-FATAL            TO TRUE                   06520005
065300*        --  REQUIRED ENTRY  --                                   06530005
065400         MOVE DP015-UNP-ALP-BRT-OFF                               06540005
065500                                        TO AVARINDA               06550005
065600         MOVE DP015-RED                 TO AVARINDC               06560005
065700         MOVE DP015-REVERSE             TO AVARINDH               06570005
065800         MOVE -1                        TO AVARINDL               06580005
065900         SET DP030-SET-CURSOR-APPL-1    TO TRUE                   06590005
066000         MOVE PC-TSYMSG-00007           TO DP020-MSG-NUMBER       06600005
066100         SET PS-ERROR                   TO TRUE                   06610005
066200     END-IF.                                                      06620005
066300/                                                                 06630005
066400*----------------------------------------------------------------*06640005
066500*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *06650005
066600*----------------------------------------------------------------*06660005
066700                                                                  06670005
066800 3200-RESET-ATTRIBUTES.                                           06680005
066900                                                                  06690005
067000     MOVE DP015-UNP-ALP-NOR-OFF TO AVARINDA                       06700005
067100                                   AVARPCTA                       06710005
067200                                   ADLRLIMA.                      06720005
067300                                                                  06730005
067400     MOVE DP015-GREEN           TO AVARINDC                       06740005
067500                                   AVARPCTC                       06750005
067600                                   ADLRLIMC.                      06760005
067700                                                                  06770005
067800                                                                  06780005
067900     MOVE DP015-UNDERLINE       TO AVARINDH                       06790005
068000                                   AVARPCTH                       06800005
068100                                   ADLRLIMH.                      06810005
068200/                                                                 06820005
068300 3600-CHECK-IF-FIELDS-CHANGED.                                    06830005
068400                                                                  06840005
068500     IF ASC-INVC-RCV-VAR-IND     = ASC-INVC-RCV-VAR-IND-OLD       06850005
068600     AND ASC-INVC-RCV-VAR-PCT    = ASC-INVC-RCV-VAR-PCT-OLD       06860005
068700     AND ASC-INVC-RCV-VAR-AMT    = ASC-INVC-RCV-VAR-AMT-OLD       06870005
068800         CONTINUE                                                 06880005
068900     ELSE                                                         06890005
069000         SET ASC-FIELDS-MODIFIED  TO TRUE                         06900005
069100     END-IF.                                                      06910005
069200/                                                                 06920005
069300 4000-BUILD-INITIAL-PANEL.                                        06930005
069400                                                                  06940005
069500     INITIALIZE ASC-SCREEN-FIELDS                                 06950005
069600                DCLTAPVNDS                                        06960005
069700                DCLTENTNME                                        06970005
069800                DK-DB2-KEYS.                                      06980005
069900                                                                  06990005
070000     MOVE -1                         TO AVARINDL.                 07000005
070100     SET PS-NO-ERROR                 TO TRUE.                     07010005
070200     SET DP030-SET-CURSOR-APPL-1     TO TRUE.                     07020005
070300                                                                  07030005
070400     MOVE ASC-KEY-DUN-NBR            TO DK-DUN-NBR                07040005
070500                                        ASC-DUN-NBR.              07050005
070600     MOVE ASC-KEY-ENT-ID             TO DK-ENT-ID.                07060005
070700                                                                  07070005
070800     PERFORM 4010-GET-VENDOR-NAME.                                07080005
070900     MOVE ENTNME-ENT-NAME-DESC       TO ASC-ENT-NAME-DESC.        07090005
071000                                                                  07100005
071100     SET PS-NOT-FOUND TO TRUE.                                    07110005
071200     SET ASC-NOT-FOUND-AT-ALL TO TRUE.                            07120005
071300     PERFORM 4020-GET-APVNDS.                                     07130005
071400     IF PS-FOUND                                                  07140005
071500         PERFORM 4200-MOVE-DATABASE-TO-COMMAREA                   07150005
071600     ELSE                                                         07160005
071700*      A NOT FOUND WILL OCCUR ONLY FOR AN ADD.  AN UPDATE WITH    07170005
071800*      NO ROW ON TAPVNDS WILL HAVE ERRORED OUT IN COMMAREA EDIT.  07180005
071900         MOVE SPACE                TO ASC-INVC-RCV-VAR-IND        07190005
072000                                      ASC-INVC-RCV-VAR-IND-OLD    07200005
072100         MOVE SPACE                TO ASC-IND-DESC1               07210005
072200         MOVE PC-IND-DESC-2        TO ASC-IND-DESC2               07220005
072300         MOVE ZEROS                TO ASC-INVC-RCV-VAR-PCT        07230005
072400                                      ASC-INVC-RCV-VAR-PCT-OLD    07240005
072500                                      PV-3V99                     07250005
072600         MOVE PV-3V99-X            TO ASC-INVC-RCV-VAR-PCT-X      07260005
072700         MOVE ZEROS                TO ASC-INVC-RCV-VAR-AMT        07270005
072800                                      ASC-INVC-RCV-VAR-AMT-OLD    07280005
072900                                      PV-4V99                     07290005
073000         MOVE PV-4V99-X            TO ASC-INVC-RCV-VAR-AMT-X      07300005
073100     END-IF.                                                      07310005
073200                                                                  07320005
073300/                                                                 07330005
073400*----------------------------------------------------------------*07340005
073500*    GET THE VENDOR NAME                                         *07350005
073600*----------------------------------------------------------------*07360005
073700 4010-GET-VENDOR-NAME.                                            07370005
073800                                                                  07380005
073900     EXEC SQL                                                     07390005
074000          SELECT ENT_NAME_DESC                                    07400005
074100            INTO :ENTNME-ENT-NAME-DESC                            07410005
074200            FROM TENTNME                                          07420005
074300           WHERE ENT_ID     = :DK-ENT-ID                          07430005
074400             AND TYPE_CDE   = '01'                                07440005
074500     END-EXEC.                                                    07450005
074600                                                                  07460005
074700     EVALUATE TRUE                                                07470005
074800         WHEN SQLCODE = +0                                        07480005
074900              CONTINUE                                            07490005
075000                                                                  07500005
075100         WHEN SQLCODE = +100                                      07510005
075200              MOVE 'VENDOR NAME NOT FOUND'                        07520005
075300                                    TO ENTNME-ENT-NAME-DESC       07530005
075400         WHEN SQLWARN0 NOT = SPACES                               07540005
075500         WHEN SQLCODE < +0                                        07550005
075600         WHEN SQLCODE > +0                                        07560005
075700              MOVE '4010-GET-VENDOR-NAME'                         07570005
075800                              TO DP013-PARAGRAPH                  07580005
075900              MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'          07590005
076000                              TO DP013-MESSAGE-TEXT (1)           07600005
076100              MOVE SQLCA      TO DP013-SQLCA                      07610005
076200              MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)         07620005
076300              SET DP013-DB2-ABEND                                 07630005
076400                  DP013-XCTL-DISPLAY-RESTART                      07640005
076500                              TO TRUE                             07650005
076600              PERFORM DP013-0000-PROCESS-ABEND                    07660005
076700     END-EVALUATE.                                                07670005
076800/                                                                 07680005
076900*----------------------------------------------------------------*07690005
077000*    RETRIEVE THE ROW FROM TAPVNDS IF IT EXISTS.                 *07700005
077100*----------------------------------------------------------------*07710005
077200 4020-GET-APVNDS.                                                 07720005
077300                                                                  07730005
077400     EXEC SQL                                                     07740005
077500          SELECT ENT_ID                                           07750005
077600                ,INVC_RCV_VAR_PCT                                 07760005
077700                ,INVC_RCV_VAR_AMT                                 07770005
077800                ,INVC_RCV_VAR_IND                                 07780005
077900            INTO :APVNDS-ENT-ID                                   07790005
078000                ,:APVNDS-INVC-RCV-VAR-PCT                         07800005
078100                ,:APVNDS-INVC-RCV-VAR-AMT                         07810005
078200                ,:APVNDS-INVC-RCV-VAR-IND                         07820005
078300            FROM TAPVNDS                                          07830005
078400           WHERE ENT_ID     = :DK-ENT-ID                          07840005
078500     END-EXEC.                                                    07850005
078600                                                                  07860005
078700     EVALUATE TRUE                                                07870005
078800         WHEN SQLCODE = +0                                        07880005
078900              IF APVNDS-INVC-RCV-VAR-IND = ' '                    07890005
079000                 SET ASC-NOT-FOUND-FOR-IND TO TRUE                07900005
079100              ELSE                                                07910005
079200                 SET PS-FOUND              TO TRUE                07920005
079300                 SET ASC-FOUND             TO TRUE                07930005
079400              END-IF                                              07940005
079500                                                                  07950005
079600         WHEN SQLCODE = +100                                      07960005
079700              CONTINUE                                            07970005
079800                                                                  07980005
079900         WHEN SQLWARN0 NOT = SPACES                               07990005
080000         WHEN SQLCODE < +0                                        08000005
080100         WHEN SQLCODE > +0                                        08010005
080200              MOVE '4010-GET-VENDOR-NAME'                         08020005
080300                              TO DP013-PARAGRAPH                  08030005
080400              MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'          08040005
080500                              TO DP013-MESSAGE-TEXT (1)           08050005
080600              MOVE SQLCA      TO DP013-SQLCA                      08060005
080700              MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)         08070005
080800              SET DP013-DB2-ABEND                                 08080005
080900                  DP013-XCTL-DISPLAY-RESTART                      08090005
081000                              TO TRUE                             08100005
081100              PERFORM DP013-0000-PROCESS-ABEND                    08110005
081200     END-EVALUATE.                                                08120005
081300/                                                                 08130005
081400*---------------------------------------------------------------- 08140005
081500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.      08150005
081600*---------------------------------------------------------------- 08160005
081700                                                                  08170005
081800 4200-MOVE-DATABASE-TO-COMMAREA.                                  08180005
081900                                                                  08190005
082000     IF APVNDS-INVC-RCV-VAR-IND = 'S'                             08200005
082100*       VENDOR TOLERANCES ARE SPECIFIED                           08210005
082200         MOVE PC-IND-DESC-SPECIFIC    TO ASC-IND-DESC1            08220005
082300     ELSE                                                         08230005
082400*       VENDOR TOLERANCES ARE INACTIVE                            08240005
082500         MOVE PC-IND-DESC-INACTIVE    TO ASC-IND-DESC1            08250005
082600     END-IF.                                                      08260005
082700                                                                  08270005
082800     MOVE APVNDS-INVC-RCV-VAR-IND     TO ASC-INVC-RCV-VAR-IND     08280005
082900                                         ASC-INVC-RCV-VAR-IND-OLD.08290005
083000     MOVE PC-IND-DESC-2               TO ASC-IND-DESC2.           08300005
083100     MOVE APVNDS-INVC-RCV-VAR-PCT     TO ASC-INVC-RCV-VAR-PCT     08310005
083200                                         ASC-INVC-RCV-VAR-PCT-OLD 08320005
083300                                         PV-3V99.                 08330005
083400     MOVE PV-3V99-X                   TO ASC-INVC-RCV-VAR-PCT-X.  08340005
083500     MOVE APVNDS-INVC-RCV-VAR-AMT     TO ASC-INVC-RCV-VAR-AMT     08350005
083600                                         ASC-INVC-RCV-VAR-AMT-OLD 08360005
083700                                         PV-4V99.                 08370005
083800     MOVE PV-4V99-X                   TO ASC-INVC-RCV-VAR-AMT-X.  08380005
083900/                                                                 08390005
084000*----------------------------------------------------------------*08400005
084100*    RESTORE THE DATA ON THE SCREEN FROM THE COMMAREA.           *08410005
084200*----------------------------------------------------------------*08420005
084300 4400-MOVE-COMMAREA-TO-SCREEN.                                    08430005
084400                                                                  08440005
084500     MOVE ASC-KEY-DUN-NBR          TO AVNDNBRO.                   08450005
084600     MOVE ASC-ENT-NAME-DESC        TO AVNDNMEO.                   08460005
084700     IF ASC-INVC-RCV-VAR-IND = 'S'                                08470005
084800         MOVE 'A'                  TO AVARINDO                    08480005
084900     ELSE                                                         08490005
085000         MOVE ASC-INVC-RCV-VAR-IND TO AVARINDO                    08500005
085100     END-IF.                                                      08510005
085200     MOVE ASC-IND-DESC1            TO AINDSC1O.                   08520005
085300     MOVE ASC-IND-DESC2            TO AINDSC2O.                   08530005
085400     MOVE ASC-INVC-RCV-VAR-PCT     TO AVARPCTO                    08540005
085500                                      PV-3V99.                    08550005
085600     MOVE PV-3V99-X                TO ASC-INVC-RCV-VAR-PCT-X.     08560005
085700     MOVE ASC-INVC-RCV-VAR-AMT     TO ADLRLIMO                    08570005
085800                                      PV-4V99.                    08580005
085900     MOVE PV-4V99-X                TO ASC-INVC-RCV-VAR-AMT-X.     08590005
086000                                                                  08600005
086100                                                                  08610005
086200/                                                                 08620005
086300*----------------------------------------------------------------*08630005
086400*    PREPARE TO INSERT TO TAPVNDS                                *08640005
086500*----------------------------------------------------------------*08650005
086600                                                                  08660005
086700 5000-INSERT-PROCESSING.                                          08670005
086800                                                                  08680005
086900                                                                  08690005
087000      MOVE ASC-KEY-ENT-ID          TO APVNDS-ENT-ID.              08700005
087100      MOVE ASC-INVC-RCV-VAR-IND    TO APVNDS-INVC-RCV-VAR-IND.    08710005
087200      MOVE ASC-INVC-RCV-VAR-PCT    TO APVNDS-INVC-RCV-VAR-PCT.    08720005
087300      MOVE ASC-INVC-RCV-VAR-AMT    TO APVNDS-INVC-RCV-VAR-AMT.    08730005
087400                                                                  08740005
087500     IF ASC-NOT-FOUND-FOR-IND                                     08750005
087600        PERFORM 6100-UPDATE-TAPVNDS                               08760005
087700     ELSE                                                         08770005
087800        MOVE PC-DEFAULT-TIMESTAMP TO APVNDS-PAYT-CNTL-CHG-TMST    08780005
087900        PERFORM 6000-INSERT-TAPVNDS.                              08790005
088000                                                                  08800005
088100     MOVE ASC-INVC-RCV-VAR-IND     TO ASC-INVC-RCV-VAR-IND-OLD.   08810005
088200     MOVE ASC-INVC-RCV-VAR-PCT     TO ASC-INVC-RCV-VAR-PCT-OLD.   08820005
088300     MOVE ASC-INVC-RCV-VAR-AMT     TO ASC-INVC-RCV-VAR-AMT-OLD.   08830005
088400                                                                  08840005
088500     IF STATUS-SPECIFIED                                          08850005
088600         MOVE PC-IND-DESC-SPECIFIC TO ASC-IND-DESC1               08860005
088700     ELSE                                                         08870005
088800         MOVE PC-IND-DESC-INACTIVE TO ASC-IND-DESC1               08880005
088900     END-IF.                                                      08890005
089000/                                                                 08900005
089100*----------------------------------------------------------------*08910005
089200*    PREPARE TO UPDATE TAPVNDS                                   *08920005
089300*----------------------------------------------------------------*08930005
089400 5100-UPDATE-PROCESSING.                                          08940005
089500                                                                  08950005
089600      MOVE ASC-KEY-ENT-ID       TO APVNDS-ENT-ID.                 08960005
089700      MOVE ASC-INVC-RCV-VAR-IND TO APVNDS-INVC-RCV-VAR-IND.       08970005
089800      MOVE ASC-INVC-RCV-VAR-PCT TO APVNDS-INVC-RCV-VAR-PCT.       08980005
089900      MOVE ASC-INVC-RCV-VAR-AMT TO APVNDS-INVC-RCV-VAR-AMT.       08990005
090000                                                                  09000005
090100     PERFORM 6100-UPDATE-TAPVNDS.                                 09010005
090200                                                                  09020005
090300     MOVE ASC-INVC-RCV-VAR-IND  TO ASC-INVC-RCV-VAR-IND-OLD.      09030005
090400     MOVE ASC-INVC-RCV-VAR-PCT  TO ASC-INVC-RCV-VAR-PCT-OLD.      09040005
090500     MOVE ASC-INVC-RCV-VAR-AMT  TO ASC-INVC-RCV-VAR-AMT-OLD.      09050005
090600                                                                  09060005
090700     IF STATUS-SPECIFIED                                          09070005
090800         MOVE PC-IND-DESC-SPECIFIC TO ASC-IND-DESC1               09080005
090900     ELSE                                                         09090005
091000         MOVE PC-IND-DESC-INACTIVE TO ASC-IND-DESC1               09100005
091100     END-IF.                                                      09110005
091200/                                                                 09120005
091300*----------------------------------------------------------------*09130005
091400*    INSERT A VENDOR TOLERANCE ROW                               *09140005
091500*----------------------------------------------------------------*09150005
091600                                                                  09160005
091700 6000-INSERT-TAPVNDS.                                             09170005
091800                                                                  09180005
091900     EXEC SQL                                                     09190005
092000          INSERT INTO TAPVNDS                                     09200005
092100                (ENT_ID                                           09210005
092200                ,INVC_RCV_VAR_PCT                                 09220005
092300                ,INVC_RCV_VAR_AMT                                 09230005
092400                ,INVC_RCV_VAR_IND                                 09240005
092500                ,PAYT_CNTL_CHG_TMST)                              09250005
092600          VALUES (:APVNDS-ENT-ID                                  09260005
092700                 ,:APVNDS-INVC-RCV-VAR-PCT                        09270005
092800                 ,:APVNDS-INVC-RCV-VAR-AMT                        09280005
092900                 ,:APVNDS-INVC-RCV-VAR-IND                        09290005
093000                 ,:APVNDS-PAYT-CNTL-CHG-TMST)                     09300005
093100     END-EXEC.                                                    09310005
093200                                                                  09320005
093300     EVALUATE TRUE                                                09330005
093400         WHEN SQLCODE = +0                                        09340005
093500              CONTINUE                                            09350005
093600                                                                  09360005
093700         WHEN SQLWARN0 NOT = SPACES                               09370005
093800         WHEN SQLCODE < +0                                        09380005
093900         WHEN SQLCODE > +0                                        09390005
094000              MOVE '6000-INSERT-TAPVNDS'                          09400005
094100                              TO DP013-PARAGRAPH                  09410005
094200              MOVE 'UNSUCCESSFUL INSERT FOR TAPVNDS'              09420005
094300                              TO DP013-MESSAGE-TEXT (1)           09430005
094400              MOVE SQLCA      TO DP013-SQLCA                      09440005
094500              MOVE 'TAPVNDS ' TO DP013-DB2-TABLE-NAME (1)         09450005
094600              SET DP013-DB2-ABEND                                 09460005
094700                  DP013-XCTL-DISPLAY-RESTART                      09470005
094800                              TO TRUE                             09480005
094900              PERFORM DP013-0000-PROCESS-ABEND                    09490005
095000     END-EVALUATE.                                                09500005
095100/                                                                 09510005
095200*----------------------------------------------------------------*09520005
095300*    UPDATE A VENDOR TOLERANCE ROW                               *09530005
095400*----------------------------------------------------------------*09540005
095500                                                                  09550005
095600 6100-UPDATE-TAPVNDS.                                             09560005
095700                                                                  09570005
095800     EXEC SQL                                                     09580005
095900          UPDATE TAPVNDS                                          09590005
096000              SET INVC_RCV_VAR_PCT = :APVNDS-INVC-RCV-VAR-PCT     09600005
096100                 ,INVC_RCV_VAR_AMT = :APVNDS-INVC-RCV-VAR-AMT     09610005
096200                 ,INVC_RCV_VAR_IND = :APVNDS-INVC-RCV-VAR-IND     09620005
096300          WHERE ENT_ID = :APVNDS-ENT-ID                           09630005
096400     END-EXEC.                                                    09640005
096500                                                                  09650005
096600     EVALUATE TRUE                                                09660005
096700         WHEN SQLCODE = +0                                        09670005
096800              CONTINUE                                            09680005
096900                                                                  09690005
097000         WHEN SQLWARN0 NOT = SPACES                               09700005
097100         WHEN SQLCODE < +0                                        09710005
097200         WHEN SQLCODE > +0                                        09720005
097300              MOVE '6100-UPDATE-TAPVNDS'                          09730005
097400                              TO DP013-PARAGRAPH                  09740005
097500              MOVE 'UNSUCCESSFUL UPDATE FOR TAPVNDS'              09750005
097600                              TO DP013-MESSAGE-TEXT (1)           09760005
097700              MOVE SQLCA      TO DP013-SQLCA                      09770005
097800              MOVE 'TAPVNDS ' TO DP013-DB2-TABLE-NAME (1)         09780005
097900              SET DP013-DB2-ABEND                                 09790005
098000                  DP013-XCTL-DISPLAY-RESTART                      09800005
098100                              TO TRUE                             09810005
098200              PERFORM DP013-0000-PROCESS-ABEND                    09820005
098300     END-EVALUATE.                                                09830005
098400/                                                                 09840005
098500*----------------------------------------------------------------*09850005
098600*    ABEND PROCESSOR MODULE                                      *09860005
098700*----------------------------------------------------------------*09870005
098800                                                                  09880005
098900     COPY DPPD013.                                                09890005
