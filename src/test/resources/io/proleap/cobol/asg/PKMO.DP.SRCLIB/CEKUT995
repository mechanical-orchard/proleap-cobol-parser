000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.             CEKUT995.                                00030000
000400 AUTHOR.                 RON KRIER.                               00040000
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050000
000600 DATE-WRITTEN.           MAY 2, 2016.                             00060000
000700 DATE-COMPILED.                                                   00070000
000800***************************************************************** 00080000
000900*  THIS IS A SPECIAL PROGRAM TO ASSIST IN THE PROCESSING OF     * 00090000
001000*  CENTRAL STOCK PULLS THAT ARE PART OF THE EXPEDITED FREIGHT   * 00100000
001010*  PROGRAM TO GET MERCHANDISE TO THE STORES IN A SHORT PERIOD   * 00101000
001100*  OF TIME.                                                     * 00110000
001500*  THIS PROGRAM WAS COPIED FROM RCKUT978 AND THEN CHANGED.      * 00150000
001600***************************************************************** 00160000
001700*  THIS PROGRAM WILL TAKE IN A FILE THAT WILL CONTAIN ONE TO    * 00170000
001800*  MANY RECORDS WHICH WILL CONTAIN A PULL NUMBER TO BE          * 00180000
001900*  PROCESSED.  THE PULL NUMBER WILL THEN BE USED TO DRIVE A     * 00190000
002000*  CURSOR WHICH WILL GO OUT AND FIND ALL OF THE TCEPLMF DATA    * 00200000
002100*  FOR THE PULL BETWEEN THE START DATE/TIME AND END DATE/TIME   * 00210000
002200*  AND THAT INFORMATION WILL BE SUMMARIZED BY THE CURSOR AND    * 00220000
002300*  USED TO BUILD THE DATA THAT WILL RELIEVE STORE EXPECTED      * 00230000
002400*  AND THEN ALSO PUT THE DATA INTO AND TAKE OUT OF STORE        * 00240000
002500*  IN-TRANSIT.  THIS IS DONE SO THAT THE INVENTORY WILL LOOK    * 00250000
002600*  RIGHT AND THE GOODS WILL BE USED TO FULFILL FROM THE STORE.  * 00260000
002700*                                                               * 00270000
003200*  THE INPUT FILE WILL ALSO HAVE 2 SETS OF DATE/TIME.  THE      * 00320000
003300*  FIRST SET BEING USED TO DEFINE THE DATE AND TIME FROM WHICH  * 00330000
003400*  THE PULL DATA WILL BE EXTRACTED FROM AND THE SECOND SET      * 00340000
003500*  BEING THE END DATE AND TIME (BASICALLY BOOK END DATE/TIME TO * 00350000
003600*  PULL DATA FROM THE TCEPLMF TABLE).                           * 00360000
003610*                                                               * 00361000
003700*  ONE OUTPUT FILE WILL THEN BE FED THRU JOB THE BOTTOM PART    * 00370000
003800*  OF CEK010 TO PROCESS THE STORE EXPECTED DATA.  THIS FILE     * 00380000
003900*  WILL USE THE PCRD010 COPYBOOK AND CREATE NEGATIVE QUANTITY   * 00390000
004000*  DATA IN THE CS RECORD TYPE FOR SE.                           * 00400000
004010*                                                               * 00401000
004100*  THE SECOND OUTPUT FILL WHEN BE PASSED ALONG TO GVK300 JOB    * 00410000
004200*  TO UPDATE IN-TRANSIT DATA WITHIN THE GIV SYSTEM.  THIS FILE  * 00420000
004300*  TO FEED GIV WILL HAVE 2 RECORDS PER PULL/LINE/STORE          * 00430000
004400*  IN THE PCRD010 FORMAT.  THE FIRST RECORD WILL INCREASE       * 00440000
004500*  IN-TRANSIT AND THE SECOND RECORD WILL DECREASE IN-TRANSIT    * 00450000
004600*  (THIS WILL CAUSE GIV TO UPDATE THE ON HAND IN GIV).          * 00460000
004700*                                                               * 00470000
005000*  A THIRD OUTPUT FILE IS CREATED WHICH WILL BE A COMMA         * 00500000
005100*  DELIMITED FILE WHICH WILL CONTAIN A RECORD FOR EACH          * 00510000
005200*  PULL/LINE/STORE COMBINATION AND WILL CONTAIN THE QUANTITY    * 00520000
005300*  USED TO GENERATE THE DATA FOR THE OTHER TWO FILES.           * 00530000
005400*  THIS FILE WILL BE SENT TO INVENTORY CONTROL FOR THEIR OWN    * 00540000
005500*  USE IF NEEDED.                                               * 00550000
005600*                                                               * 00560000
007000***************************************************************** 00700000
007100 ENVIRONMENT DIVISION.                                            00710000
007200 CONFIGURATION SECTION.                                           00720000
007300                                                                  00730000
007400 SOURCE-COMPUTER.        IBM-3090.                                00740000
007500 OBJECT-COMPUTER.        IBM-3090.                                00750000
007600                                                                  00760000
007700***************************************************************** 00770000
007800 INPUT-OUTPUT SECTION.                                            00780000
007900                                                                  00790000
008000 FILE-CONTROL.                                                    00800000
008100                                                                  00810000
008200     SELECT INPUT-FILE                                            00820000
008300         ASSIGN TO INP01.                                         00830000
008400                                                                  00840000
008500     SELECT SE-OUTPUT-FILE                                        00850000
008600         ASSIGN TO OUT01.                                         00860000
008700                                                                  00870000
008800     SELECT INTRANSIT-OUTPUT-FILE                                 00880000
008900         ASSIGN TO OUT02.                                         00890000
009000                                                                  00900000
009100     SELECT ADJUST-OUTPUT-FILE                                    00910000
009200         ASSIGN TO OUT03.                                         00920000
009300                                                                  00930000
009400***************************************************************** 00940000
009500 DATA DIVISION.                                                   00950000
009600***************************************************************** 00960000
009700 FILE SECTION.                                                    00970000
009800                                                                  00980000
009900 FD  INPUT-FILE                                                   00990000
010000     RECORDING MODE IS F                                          01000000
010100     BLOCK CONTAINS 0  RECORDS.                                   01010000
010200 01  INPUT-RECORD                    PIC X(70).                   01020000
010300                                                                  01030000
010400 FD  SE-OUTPUT-FILE                                               01040000
010500     RECORDING MODE IS F                                          01050000
010600     BLOCK CONTAINS 0  RECORDS.                                   01060000
010700 01  SE-OUTPUT-RECORD                PIC X(100).                  01070001
010800                                                                  01080000
010900 FD  INTRANSIT-OUTPUT-FILE                                        01090000
011000     RECORDING MODE IS F                                          01100000
011100     BLOCK CONTAINS 0  RECORDS.                                   01110000
011200 01  INTRANSIT-OUTPUT-RECORD         PIC X(100).                  01120000
011300                                                                  01130000
011400 FD  ADJUST-OUTPUT-FILE                                           01140000
011500     RECORDING MODE IS F                                          01150000
011600     BLOCK CONTAINS 0  RECORDS.                                   01160000
011700 01  ADJUST-OUTPUT-RECORD            PIC X(110).                  01170000
011800                                                                  01180000
011900***************************************************************** 01190000
012000 WORKING-STORAGE SECTION.                                         01200000
012100                                                                  01210000
012200 01  PROGRAM-SWITCHES.                                            01220000
012300     05  PS-EOF-INPUT-SW              PIC X(01) VALUE 'N'.        01230000
012400         88  PS-EOF-INPUT                       VALUE 'Y'.        01240000
012500         88  PS-NOT-EOF-INPUT                   VALUE 'N'.        01250000
012600     05  PS-VALID-STORE-SW            PIC X(01) VALUE 'N'.        01260000
012700         88  PS-VALID-STORE                     VALUE 'Y'.        01270000
012800         88  PS-NOT-VALID-STORE                 VALUE 'N'.        01280000
012900     05  PS-VALID-SKU-SW              PIC X(01) VALUE 'N'.        01290000
013000         88  PS-VALID-SKU                       VALUE 'Y'.        01300000
013100         88  PS-NOT-VALID-SKU                   VALUE 'N'.        01310000
013200     05  PS-LOCATION-DS-SW            PIC X(01) VALUE 'N'.        01320000
013300         88  PS-LOCATION-DS                     VALUE 'Y'.        01330000
013400         88  PS-LOCATION-DS-NO                  VALUE 'N'.        01340000
013500     05  PS-IT-EXISTS-SW              PIC X(01) VALUE 'N'.        01350000
013600         88  PS-IT-EXISTS                       VALUE 'Y'.        01360000
013700         88  PS-IT-EXISTS-NO                    VALUE 'N'.        01370000
013800     05  PS-CLEAN-EXISTS-SW           PIC X(01) VALUE 'N'.        01380000
013900         88  PS-CLEAN-EXISTS                    VALUE 'Y'.        01390000
014000         88  PS-CLEAN-EXISTS-NO                 VALUE 'N'.        01400000
014010     05  PS-SE-BALANCED-SW            PIC X(01) VALUE 'N'.        01401006
014020         88  PS-SE-BALANCED                     VALUE 'Y'.        01402006
014030         88  PS-SE-BALANCED-NO                  VALUE 'N'.        01403006
014040     05  PS-SE-PARTIAL-SW             PIC X(01) VALUE 'N'.        01404009
014050         88  PS-SE-PARTIAL-YES                  VALUE 'Y'.        01405010
014060         88  PS-SE-PARTIAL-NO                   VALUE 'N'.        01406009
014100     05  PS-END-OF-PULL-CSR-SW        PIC X(01) VALUE 'N'.        01410000
014200         88  PS-END-OF-PULL-CSR                 VALUE 'Y'.        01420000
014300                                                                  01430000
014400 01  PC-PROGRAM-CONSTANTS.                                        01440000
014500     05  PC-CEKUT995                 PIC X(08) VALUE              01450000
014600                                               'CEKUT995'.        01460000
014700     05  PC-DEFAULT-TMST             PIC X(26)  VALUE             01470000
014800                                    '9999-09-09-09.09.09.999999'. 01480000
014900     05  PC-SLASH                    PIC X(01) VALUE '/'.         01490000
015000     05  PC-DASH                     PIC X(01) VALUE '-'.         01500000
015100                                                                  01510000
015200                                                                  01520000
015300 01  PV-PROGRAM-VARIABLES.                                        01530000
015400                                                                  01540000
015500     05  PV-INBD-CART-CNT             PIC S9(09) COMP VALUE ZERO. 01550000
015600     05  PV-OTBD-CART-CNT             PIC S9(09) COMP VALUE ZERO. 01560000
015700     05  PV-INBD-SHPD-QTY             PIC S9(09) COMP VALUE ZERO. 01570000
015800     05  PV-OTBD-SHPD-QTY             PIC S9(09) COMP VALUE ZERO. 01580000
015900     05  PV-NO-CHECKIN-CNT            PIC S9(09) COMP VALUE ZERO. 01590000
016000     05  PV-NO-CHECKIN-QTY            PIC S9(09) COMP VALUE ZERO. 01600000
016010     05  PV-STORE-EXP-QTY             PIC S9(09) COMP VALUE ZERO. 01601006
016020     05  PV-CEPLMF-MFST-UNT-QTY       PIC S9(09) COMP VALUE ZERO. 01602006
016030     05  PV-PC010-IN-TRNST-QTY        PIC S9(09) COMP VALUE ZERO. 01603006
016100                                                                  01610000
016200     05  PV-CLEAN-COUNT               PIC 9(09)  VALUE ZERO.      01620000
016201     05  PV-BALANCE-COUNT             PIC 9(09)  VALUE ZERO.      01620106
016202     05  PV-PARTIAL-QTY-COUNT         PIC 9(09)  VALUE ZERO.      01620206
016203     05  PV-FETCH-COUNT               PIC 9(09)  VALUE ZERO.      01620306
016204     05  PV-FETCH-COUNT2              PIC 9(09)  VALUE ZERO.      01620406
016205     05  PV-READ-COUNT                PIC 9(09)  VALUE ZERO.      01620506
016206     05  PV-READ-COUNT-2              PIC 9(09)  VALUE ZERO.      01620606
016207     05  PV-WRITE-COUNT-SE            PIC 9(09)  VALUE ZERO.      01620706
016208     05  PV-WRITE-COUNT-INTRANSIT     PIC 9(09)  VALUE ZERO.      01620806
016209     05  PV-WRITE-COUNT-ADJUST        PIC 9(09)  VALUE ZERO.      01620906
016210     05  PV-NOT-DS-LOCATION-CNT       PIC 9(09)  VALUE ZERO.      01621006
016211     05  PV-INTRANSIT-EXISTS-CNT      PIC 9(09)  VALUE ZERO.      01621106
016212                                                                  01621206
016220     05  PV-SQLCODE                  PIC 9(09) VALUE ZERO.        01622000
016230     05  PV-DISP-SQLCODE             PIC -999.                    01623000
016240     05  PV-NULL-IND                    PIC S9(04)  VALUE ZEROS   01624000
016250                                                    COMP SYNC.    01625000
016260     05  PV-NULL-IND-1                  PIC S9(04)  VALUE ZEROS   01626000
016270                                                    COMP SYNC.    01627000
016280                                                                  01628000
016290 01  PV-ABEND-FIELDS.                                             01629000
016300     05  PV-ABEND-CODE               PIC S9(4) VALUE +0           01630000
016400                                               COMP SYNC.         01640000
016500     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'CEKUT995'.  01650000
016600     05  PV-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.      01660000
016700     05  PV-ABEND-OPERATION          PIC X(50) VALUE SPACES.      01670000
016800     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      01680000
016900     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      01690000
017000     05  PV-DB2-OPERATION-MESSAGE-2  PIC X(79) VALUE SPACES.      01700000
017100     05  PV-DB2-OPERATION-MESSAGE-3  PIC X(79) VALUE SPACES.      01710000
017200     05  PV-DB2-OPERATION-MESSAGE-4  PIC X(79) VALUE SPACES.      01720000
017300     05  PV-DB2-TABLE-NAME-1         PIC X(08) VALUE SPACES.      01730000
017400     05  PV-DB2-TABLE-NAME-2         PIC X(08) VALUE SPACES.      01740000
017500                                                                  01750000
017600     05  PV-DISPLAY-OPER             PIC  9(04) VALUE ZEROES.     01760000
017700     05  PV-DISPLAY-SQLCODE          PIC  9(03)- VALUE ZEROES.    01770000
017800     05  PV-DB2-TABLE-NAME1          PIC  X(15) VALUE SPACES.     01780000
017900                                                                  01790000
018000     05  PV-DISPLAY-FETCH-COUNT1     PIC ZZZ,ZZZ,ZZ9.             01800000
018100     05  PV-DISPLAY-FETCH-COUNT2     PIC ZZZ,ZZZ,ZZ9.             01810000
018200     05  PV-DISPLAY-READ-COUNT1      PIC ZZZ,ZZZ,ZZ9.             01820000
018300     05  PV-DISPLAY-READ-COUNT2      PIC ZZZ,ZZZ,ZZ9.             01830000
018400     05  PV-DISPLAY-WRITE-COUNT      PIC ZZZ,ZZZ,ZZ9.             01840000
018500     05  PV-DISPLAY-PERCENT1         PIC ZZZ.99.                  01850000
018600     05  PV-DISPLAY-PERCENT2         PIC ZZZ.                     01860000
018700     05  PV-DISP-PO                  PIC Z(09).                   01870000
018800     05  PV-DISP-RCVR                PIC 9999.                    01880000
018900     05  PV-DISP-LOC-NBR             PIC 9999.                    01890000
019000     05  PV-DISP-LINE                PIC 9999.                    01900000
019100     05  PV-DISP-SKU                 PIC 9(08).                   01910000
019200     05  PV-DISP-INTR-UPC            PIC Z(15).                   01920000
019210     05  PV-DISP-QTY1                PIC ZZZ,ZZ9.                 01921006
019220     05  PV-DISP-QTY2                PIC ZZZ,ZZ9.                 01922006
019230     05  PV-DISP-QTY3                PIC ZZZ,ZZ9-.                01923006
019300                                                                  01930000
019400     05  PV-DEPT-NBR                 PIC X(04).                   01940000
019500     05  PV-DEPT-NM                  PIC X(20).                   01950000
019600     05  PV-SKU-DESC                 PIC X(30).                   01960000
019700                                                                  01970000
019800     05  PV-PREV-LOC-NBR             PIC S9(4) COMP VALUE ZEROES. 01980000
019900     05  PV-CURRENT-TMST             PIC X(26).                   01990001
019910     05  PV-SHIPPED-TMST             PIC X(26).                   01991001
020000     05  PV-UNLOADED-TMST            PIC X(26).                   02000000
020100     05  PV-FROM-TMST.                                            02010000
020200         10  PV-FROM-TMST-DATE       PIC X(10).                   02020000
020300         10  PV-FROM-FILLER1         PIC X(01)   VALUE '-'.       02030000
020400         10  PV-FROM-TMST-TIME       PIC X(08).                   02040000
020500         10  PV-FROM-FILLER2         PIC X(07)   VALUE '.000000'. 02050000
020600     05  PV-TO-TMST.                                              02060000
020700         10  PV-TO-TMST-DATE         PIC X(10).                   02070000
020800         10  PV-TO-FILLER1           PIC X(01)   VALUE '-'.       02080000
020900         10  PV-TO-TMST-TIME         PIC X(08).                   02090000
021000         10  PV-TO-FILLER2           PIC X(07)   VALUE '.000000'. 02100000
021100                                                                  02110000
021200                                                                  02120000
021300 01  IR-INPUT-RECORD.                                             02130000
021400     05  IR-PULL-NBR                 PIC  9(8)      VALUE ZEROES. 02140000
021500     05  FILLER                      PIC  X(1)      VALUE SPACES. 02150000
021600     05  IR-DC-NBR                   PIC  9(4)      VALUE ZEROES. 02160000
021700     05  FILLER                      PIC  X(01)     VALUE SPACES. 02170000
021800     05  IR-FROM-DATE                PIC  X(10).                  02180000
021900     05  FILLER                      PIC  X(01)     VALUE SPACES. 02190000
022000     05  IR-FROM-TIME                PIC  X(08).                  02200000
022100     05  FILLER                      PIC  X(01)     VALUE SPACES. 02210000
022200     05  IR-TO-DATE                  PIC  X(10).                  02220000
022300     05  FILLER                      PIC  X(01)     VALUE SPACES. 02230000
022400     05  IR-TO-TIME                  PIC  X(08).                  02240000
022500     05  FILLER                      PIC  X(17)     VALUE SPACES. 02250000
022600                                                                  02260000
022700 01  OHR-OUTPUT-HEADER-RECORD.                                    02270000
022800     05  OHR-DEPT-NBR        PIC  X(04)     VALUE 'DEPT'.         02280000
022900     05  FILLER              PIC  X(01)     VALUE ','.            02290000
023000     05  OHR-DEPT-DESC       PIC  X(20)     VALUE 'DEPT NAME'.    02300000
023100     05  FILLER              PIC  X(01)     VALUE ','.            02310000
023200     05  OHR-PULL-NBR        PIC  X(08)     VALUE 'PULL NBR'.     02320000
023300     05  FILLER              PIC  X(01)     VALUE ','.            02330000
023400     05  OHR-REC-SEQ-NBR     PIC  X(04)     VALUE 'RECV'.         02340000
023500     05  FILLER              PIC  X(01)     VALUE ','.            02350000
023600     05  OHR-PULL-LNE-NBR    PIC  X(04)     VALUE 'LINE'.         02360000
023700     05  FILLER              PIC  X(01)     VALUE ','.            02370000
023800     05  OHR-STORE-NBR       PIC  X(04)     VALUE 'STOR'.         02380000
023900     05  FILLER              PIC  X(01)     VALUE ','.            02390000
024000     05  OHR-SKU-NBR         PIC  X(08)     VALUE 'SKU     '.     02400000
024100     05  FILLER              PIC  X(01)     VALUE ','.            02410000
024200     05  OHR-SKU-DESC        PIC  X(30)     VALUE 'SKU DESC'.     02420000
024300     05  FILLER              PIC  X(01)     VALUE ','.            02430000
024400     05  OHR-QTY             PIC  X(08)     VALUE 'UNITS   '.     02440000
024500     05  FILLER              PIC  X(01)     VALUE ','.            02450000
024600     05  CL-IND              PIC  X(02)     VALUE 'CL'.           02460000
024700     05  FILLER              PIC  X(01)     VALUE ','.            02470000
024710     05  OHR-COMMENT         PIC  X(07)     VALUE 'COMMENT'.      02471009
024720     05  FILLER              PIC  X(01)     VALUE ','.            02472009
024900                                                                  02490000
025000 01  OR-OUTPUT-RECORD.                                            02500000
025100     05  OR-DEPT-NBR                 PIC  X(04)     VALUE SPACES. 02510000
025200     05  FILLER                      PIC  X(01)     VALUE ','.    02520000
025300     05  OR-DEPT-NM                  PIC  X(20)     VALUE SPACES. 02530000
025400     05  FILLER                      PIC  X(01)     VALUE ','.    02540000
025500     05  OR-PULL-NBR                 PIC  9(08)     VALUE ZEROES. 02550000
025600     05  FILLER                      PIC  X(01)     VALUE ','.    02560000
025700     05  OR-REC-SEQ-NBR              PIC  9(04)     VALUE ZEROES. 02570000
025800     05  FILLER                      PIC  X(01)     VALUE ','.    02580000
025900     05  OR-PULL-LNE-NBR             PIC  9(04)     VALUE ZEROES. 02590000
026000     05  FILLER                      PIC  X(01)     VALUE ','.    02600000
026100     05  OR-STORE-NBR                PIC  9(04)     VALUE ZEROES. 02610000
026200     05  FILLER                      PIC  X(01)     VALUE ','.    02620000
026300     05  OR-SKU-NBR                  PIC  9(08).                  02630000
026400     05  FILLER                      PIC  X(01)     VALUE ','.    02640000
026500     05  OR-SKU-DESC                 PIC  X(30).                  02650000
026600     05  FILLER                      PIC  X(01)     VALUE ','.    02660000
026700     05  OR-QTY                      PIC  9(08).                  02670000
026800     05  FILLER                      PIC  X(01)     VALUE ','.    02680000
026900     05  OR-CLEAN-SW                 PIC  X(02).                  02690000
027000         88  OR-CLEAN-EXISTS                        VALUE 'CL'.   02700000
027100         88  OR-CLEAN-EXISTS-NO                     VALUE '  '.   02710000
027200     05  FILLER                      PIC  X(01)     VALUE ','.    02720000
027210     05  OR-COMMENT-SW               PIC  X(07).                  02721009
027220         88  OR-COMMENT-SE-BAL-YES                VALUE 'SE BAL '.02722009
027230         88  OR-COMMENT-NO                        VALUE '       '.02723009
027231         88  OR-COMMENT-SE-PARTIAL                VALUE 'PARTIAL'.02723109
027240     05  FILLER                      PIC  X(01)     VALUE ','.    02724009
027400                                                                  02740000
027500 01  DK-DB-KEYS.                                                  02750000
027600     05  DK-DC-NBR                   PIC S9(4) COMP VALUE ZEROES. 02760000
027700     05  DK-PULL-NBR                 PIC S9(9) COMP VALUE ZEROES. 02770000
027800     05  DK-FROM-TMST                PIC  X(26)     VALUE SPACES. 02780000
027900     05  DK-TO-TMST                  PIC  X(26)     VALUE SPACES. 02790000
028000     05  DK-SE-INTR_UPC_ID           PIC S9(9) COMP VALUE ZEROS.  02800000
028100     05  DK-SE-LOC-NBR               PIC S9(4) COMP VALUE ZEROS.  02810000
028200     05  DK-SE-PO-NBR                PIC S9(9) COMP VALUE ZEROES. 02820000
028300     05  DK-SE-RCVR-SEQ-NBR          PIC S9(9) COMP VALUE ZEROS.  02830000
028400                                                                  02840000
029000******************************************************************02900000
029100* OUTPUT INTRANSIT RECORD LAYOUT                                  02910000
029200******************************************************************02920000
029300     COPY PCRD010.                                                02930000
029400                                                                  02940000
029500******************************************************************02950000
029600*  USED FOR DB2 ERROR MESSAGE BUILDING                            02960000
029700******************************************************************02970000
029800     COPY DPWS004.                                                02980000
029900                                                                  02990000
030000******************************************************************03000000
030100*   DB2 SQL COMMUNICATION AREA                                    03010000
030200******************************************************************03020000
030300     EXEC SQL                                                     03030000
030400          INCLUDE SQLCA                                           03040000
030500     END-EXEC.                                                    03050000
030600                                                                  03060000
030700*---------------------------------------------------------------* 03070000
030800*  PCT_TRN_CLSN_DTL                                               03080000
030900*---------------------------------------------------------------* 03090000
031000     EXEC SQL                                                     03100000
031100         INCLUDE PCT00015                                         03110000
031200     END-EXEC.                                                    03120000
031300                                                                  03130000
031400*---------------------------------------------------------------* 03140000
031500*  XLT_LOC                                                        03150000
031600*---------------------------------------------------------------* 03160000
031700     EXEC SQL                                                     03170000
031800         INCLUDE XLT00010                                         03180000
031900     END-EXEC.                                                    03190000
032000                                                                  03200000
032100*---------------------------------------------------------------* 03210000
032200*  XLT_UPC                                                        03220000
032300*---------------------------------------------------------------* 03230000
032400     EXEC SQL                                                     03240000
032500         INCLUDE XLT00006                                         03250000
032600     END-EXEC.                                                    03260000
032700                                                                  03270000
032800*---------------------------------------------------------------* 03280000
032900*  XLT_SKU                                                        03290000
033000*---------------------------------------------------------------* 03300000
033100     EXEC SQL                                                     03310000
033200         INCLUDE XLT00003                                         03320000
033300     END-EXEC.                                                    03330000
033400                                                                  03340000
033500*---------------------------------------------------------------* 03350000
033600*  XLT_VND_STYL                                                   03360000
033700*---------------------------------------------------------------* 03370000
033800     EXEC SQL                                                     03380000
033900         INCLUDE XLT00004                                         03390000
034000     END-EXEC.                                                    03400000
034100                                                                  03410000
034200*---------------------------------------------------------------* 03420000
034300*  XLT_DEPT                                                       03430000
034400*---------------------------------------------------------------* 03440000
034500     EXEC SQL                                                     03450000
034600         INCLUDE XLT00002                                         03460000
034700     END-EXEC.                                                    03470000
034800                                                                  03480000
034900*---------------------------------------------------------------* 03490000
035000*  TCEPLRQ                                                        03500000
035100*---------------------------------------------------------------* 03510000
035200     EXEC SQL                                                     03520000
035300         INCLUDE TCEPLRQ                                          03530000
035400     END-EXEC.                                                    03540000
035500                                                                  03550000
035600*---------------------------------------------------------------* 03560000
035700*  TCEPLIT                                                        03570000
035800*---------------------------------------------------------------* 03580000
035900     EXEC SQL                                                     03590000
036000         INCLUDE TCEPLIT                                          03600000
036100     END-EXEC.                                                    03610000
036200                                                                  03620000
036300*---------------------------------------------------------------* 03630000
036400*  TCEPLMF                                                        03640000
036500*---------------------------------------------------------------* 03650000
036600     EXEC SQL                                                     03660000
036700         INCLUDE TCEPLMF                                          03670000
036800     END-EXEC.                                                    03680000
036900                                                                  03690000
038400*---------------------------------------------------------------* 03840000
038500*  DRIVING CURSOR                                                 03850000
038600*---------------------------------------------------------------* 03860000
038700     EXEC SQL                                                     03870000
038800          DECLARE PULL-CSR CURSOR FOR                             03880000
038810          SELECT A.CNSTK_REQ_PL_NBR , A.PL_LNE_NBR , A.STR_NBR    03881000
038820               , D.INTR_UPC_ID , D.SKU_NBR , D.SKU_DESC           03882000
038830               , F.DEPT_NBR , F.DEPT_NM , SUM(A.MFST_UNT_QTY)     03883000
038840            FROM TCEPLMF A                                        03884000
038850               , TCEPLRQ B                                        03885000
038860               , TCEPLIT C                                        03886000
038870               , XLT_SKU D                                        03887000
038880               , XLT_VND_STYL E                                   03888000
038890               , XLT_DEPT F                                       03889000
038900           WHERE A.CNSTK_REQ_PL_NBR = :DK-PULL-NBR                03890000
039000             AND B.CNSTK_REQ_PL_NBR = A.CNSTK_REQ_PL_NBR          03900000
039100             AND C.CNSTK_REQ_PL_NBR = A.CNSTK_REQ_PL_NBR          03910000
039200             AND C.PL_LNE_NBR = A.PL_LNE_NBR                      03920000
039300             AND D.ITM_NBR = C.ITM_NBR                            03930000
039400             AND E.STYL_ID = D.STYL_ID                            03940000
039500             AND F.DEPT_NBR = E.DEPT_NBR                          03950000
039600             AND A.MFST_TMST >= :DK-FROM-TMST                     03960000
039700             AND A.MFST_TMST <= :DK-TO-TMST                       03970000
039800           GROUP BY A.CNSTK_REQ_PL_NBR , A.PL_LNE_NBR , A.STR_NBR 03980000
039900                  , D.INTR_UPC_ID , D.SKU_NBR , D.SKU_DESC        03990000
039910                  , F.DEPT_NBR , F.DEPT_NM                        03991000
044600           ORDER BY A.CNSTK_REQ_PL_NBR , A.PL_LNE_NBR , A.STR_NBR 04460000
044800     WITH UR                                                      04480000
044900     END-EXEC.                                                    04490000
045000                                                                  04500000
045100                                                                  04510000
045200******************************************************************04520000
045300 PROCEDURE DIVISION.                                              04530000
045400     DISPLAY '**** START OF CEKUT995 ****'.                       04540000
045500                                                                  04550000
045600*OPEN FILES.                                                      04560000
045700     OPEN INPUT  INPUT-FILE.                                      04570000
045800     OPEN OUTPUT SE-OUTPUT-FILE.                                  04580000
045900     OPEN OUTPUT INTRANSIT-OUTPUT-FILE.                           04590000
046000     OPEN OUTPUT ADJUST-OUTPUT-FILE.                              04600000
046100                                                                  04610000
046200     WRITE ADJUST-OUTPUT-RECORD                                   04620000
046300      FROM OHR-OUTPUT-HEADER-RECORD.                              04630000
046400     ADD +1 TO PV-WRITE-COUNT-ADJUST.                             04640000
046500                                                                  04650000
046600     SET   PS-NOT-EOF-INPUT       TO  TRUE.                       04660000
046700                                                                  04670000
046800     PERFORM 1000-INITIALIZATION.                                 04680000
046900                                                                  04690000
047000     PERFORM 2000-PROCESS-INPUT                                   04700000
047100       UNTIL PS-EOF-INPUT.                                        04710000
047200                                                                  04720000
047300                                                                  04730000
047400     DISPLAY '***'                                                04740000
047500     DISPLAY '*** INPUT COUNT           :  ' PV-READ-COUNT        04750000
047600     DISPLAY '*** '                                               04760000
047700     DISPLAY '*** OUTPUT SE COUNT       :  '                      04770000
047800             PV-WRITE-COUNT-SE                                    04780000
047900     DISPLAY '*** '                                               04790000
048000     DISPLAY '*** OUTPUT INTRANSIT COUNT:  '                      04800000
048100             PV-WRITE-COUNT-INTRANSIT                             04810000
048200     DISPLAY '***'.                                               04820000
048300     DISPLAY '*** OUTPUT ADJUST COUNT   :  '                      04830000
048400             PV-WRITE-COUNT-ADJUST                                04840000
048500     DISPLAY '***'.                                               04850000
048600     DISPLAY '*** CURSOR FETCH COUNT    :  '                      04860000
048700             PV-FETCH-COUNT                                       04870000
048800     DISPLAY '***'.                                               04880000
048900     DISPLAY '*** CLEAN ENTRIES FOUND   :  '                      04890000
049000             PV-CLEAN-COUNT                                       04900000
049010     DISPLAY '***'.                                               04901006
049020     DISPLAY '*** BALANCED ENTRIES FOUND:  '                      04902006
049030             PV-BALANCE-COUNT                                     04903006
049100     DISPLAY '***'.                                               04910000
049110     DISPLAY '*** PARTIAL SE RELIEF DONE:  '                      04911006
049120             PV-PARTIAL-QTY-COUNT                                 04912006
049130     DISPLAY '***'.                                               04913006
049200                                                                  04920000
049300*CLOSE FILES.                                                     04930000
049400     CLOSE INPUT-FILE.                                            04940000
049500     CLOSE SE-OUTPUT-FILE.                                        04950000
049600     CLOSE INTRANSIT-OUTPUT-FILE.                                 04960000
049700     CLOSE ADJUST-OUTPUT-FILE.                                    04970000
049800                                                                  04980000
049900     GOBACK.                                                      04990000
050000                                                                  05000000
050100******************************************************************05010000
050200*  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               *05020000
050300******************************************************************05030000
050400 1000-INITIALIZATION.                                             05040000
050500     DISPLAY '1000-INITIALIZE '.                                  05050000
050600                                                                  05060000
050700     EXEC SQL                                                     05070000
050800          SELECT                                                  05080000
050900                 CURRENT TIMESTAMP                                05090000
051000               , CURRENT TIMESTAMP + 1 MINUTE                     05100000
051010               , CURRENT TIMESTAMP + 2 MINUTE                     05101001
051100            INTO :PV-CURRENT-TMST                                 05110001
051110               , :PV-SHIPPED-TMST                                 05111001
051200               , :PV-UNLOADED-TMST                                05120000
051300            FROM SYSIBM.SYSDUMMY1                                 05130000
051400     END-EXEC.                                                    05140000
051500                                                                  05150000
051600     PERFORM 7000-READ-INPUT.                                     05160000
051700                                                                  05170000
051800                                                                  05180000
051900******************************************************************05190000
052000**  READ INPUT-FILE, VALIDATE IF DATA IS TO BE PROCESSED TO       05200000
052100**  OUPUT FILE AND IF SO, THEN PROCESS.  IF NOT, JUST READ        05210000
052200**  NEXT RECORD.                                                  05220000
052300******************************************************************05230000
052400 2000-PROCESS-INPUT.                                              05240000
052500                                                                  05250000
052600     DISPLAY 'INPUT RECORD BEING PROCESSED: '.                    05260000
052700     DISPLAY IR-INPUT-RECORD.                                     05270000
052800                                                                  05280000
052900     MOVE IR-PULL-NBR             TO  DK-PULL-NBR.                05290000
053100     MOVE IR-FROM-DATE            TO  PV-FROM-TMST-DATE.          05310000
053200     MOVE IR-FROM-TIME            TO  PV-FROM-TMST-TIME.          05320000
053300     MOVE PV-FROM-TMST            TO  DK-FROM-TMST.               05330000
053400     MOVE IR-TO-DATE              TO  PV-TO-TMST-DATE.            05340000
053500     MOVE IR-TO-TIME              TO  PV-TO-TMST-TIME.            05350000
053600     MOVE PV-TO-TMST              TO  DK-TO-TMST.                 05360000
053700                                                                  05370000
053800     MOVE 'N' TO PS-END-OF-PULL-CSR-SW.                           05380000
053900                                                                  05390000
054000     PERFORM 4000-OPEN-PULL-CSR.                                  05400000
054100                                                                  05410000
054200     PERFORM 4200-PROCESS-CSR                                     05420000
054300       UNTIL  PS-END-OF-PULL-CSR.                                 05430000
054400                                                                  05440000
054500     PERFORM 4500-CLOSE-PULL-CSR.                                 05450000
054600                                                                  05460000
054700     PERFORM 7000-READ-INPUT.                                     05470000
054800*---------------------------------------------------------------- 05480000
054900*                                                                 05490000
055000*---------------------------------------------------------------- 05500000
055100 2020-POPULATE-PCRD010-SHIPPED.                                   05510000
055200                                                                  05520000
056200     SET  PC010-SHIPPD-DC             TO  TRUE.                   05620001
056500     SET  PC010-SHIPPED-FROM-DC       TO  TRUE.                   05650000
056600     SET  PC010-NOT-UNLOADED-AT-STORE TO  TRUE.                   05660000
056700     SET  PC010-TRN-IN-TRANSIT        TO  TRUE.                   05670000
056710     MOVE CEPLMF-MFST-UNT-QTY         TO  PC010-IN-TRNST-QTY.     05671002
056900     MOVE PV-SHIPPED-TMST             TO  PC010-EVENT-TMST.       05690000
057100     MOVE ' '                         TO  PC010-OTB-TYP-CDE.      05710000
057200                                                                  05720000
057300*---------------------------------------------------------------- 05730000
057400*                                                                 05740000
057500*---------------------------------------------------------------- 05750000
057600 2030-POPULATE-PCRD010-UNLOADED.                                  05760000
057700                                                                  05770000
057800     SET  PC010-UNLOAD-ST             TO  TRUE.                   05780000
057900     SET  PC010-NOT-SHIPPED-FROM-DC   TO  TRUE.                   05790000
058000     SET  PC010-UNLOADED-AT-STORE     TO  TRUE.                   05800000
058100     MOVE PV-UNLOADED-TMST            TO  PC010-EVENT-TMST.       05810000
058200     MULTIPLY  PC010-IN-TRNST-QTY                                 05820000
058300           BY  -1                                                 05830000
058400       GIVING  PC010-IN-TRNST-QTY.                                05840000
058500                                                                  05850000
058600*---------------------------------------------------------------- 05860000
058700*                                                                 05870000
058800*---------------------------------------------------------------- 05880000
058900 2040-POPULATE-ADJUST-RECORD.                                     05890000
059000                                                                  05900000
059100     INITIALIZE OR-OUTPUT-RECORD.                                 05910000
059200     MOVE CEPLMF-CNSTK-REQ-PL-NBR     TO  OR-PULL-NBR.            05920003
059300     MOVE 0                           TO  OR-REC-SEQ-NBR.         05930001
059400     MOVE CEPLMF-PL-LNE-NBR           TO  OR-PULL-LNE-NBR.        05940003
059500     MOVE CEPLMF-STR-NBR              TO  OR-STORE-NBR.           05950002
059600     MOVE XLT00003-SKU-NBR            TO  OR-SKU-NBR.             05960001
059700     MOVE CEPLMF-MFST-UNT-QTY         TO  OR-QTY.                 05970002
059800     MOVE XLT00004-DEPT-NBR           TO  OR-DEPT-NBR.            05980001
059810     MOVE XLT00002-DEPT-NM            TO  PV-DEPT-NM.             05981001
059900     INSPECT PV-DEPT-NM REPLACING ALL                             05990000
060000         ',' BY SPACES.                                           06000000
060100     MOVE PV-DEPT-NM                  TO  OR-DEPT-NM.             06010000
060110     MOVE XLT00003-SKU-DESC           TO  PV-SKU-DESC.            06011001
060200     INSPECT PV-SKU-DESC REPLACING ALL                            06020000
060300         ',' BY SPACES.                                           06030000
060400     MOVE PV-SKU-DESC                 TO  OR-SKU-DESC.            06040000
060500     IF  PS-CLEAN-EXISTS                                          06050000
060510         SET OR-CLEAN-EXISTS    TO TRUE                           06051000
060520     ELSE                                                         06052000
060530         SET OR-CLEAN-EXISTS-NO TO TRUE                           06053000
060540     END-IF.                                                      06054000
060541     IF  PS-SE-BALANCED                                           06054109
060542         SET OR-COMMENT-SE-BAL-YES TO TRUE                        06054209
060543     ELSE                                                         06054309
060544         IF  PS-SE-PARTIAL-YES                                    06054409
060545             SET OR-COMMENT-SE-PARTIAL TO TRUE                    06054509
060546         ELSE                                                     06054609
060547             SET OR-COMMENT-NO         TO TRUE                    06054709
060548         END-IF                                                   06054809
060549     END-IF.                                                      06054909
060550                                                                  06055000
060560 4000-OPEN-PULL-CSR.                                              06056000
060570                                                                  06057000
060580     MOVE '4000-OPEN-PULL-CSR'                                    06058000
060590         TO PV-ABEND-PARAGRAPH.                                   06059000
060600     MOVE 'OPEN PO CURSOR'                                        06060000
060700         TO PV-ABEND-OPERATION.                                   06070000
060800                                                                  06080000
060900     EXEC SQL                                                     06090000
061000         OPEN PULL-CSR                                            06100000
061100     END-EXEC.                                                    06110000
061200                                                                  06120000
061300     EVALUATE TRUE                                                06130000
061400         WHEN SQLWARN0 NOT = SPACE                                06140000
061500         WHEN SQLCODE < ZERO                                      06150000
061600         WHEN SQLCODE > ZERO                                      06160000
061700             DISPLAY IR-INPUT-RECORD                              06170000
061800             MOVE  SQLCODE               TO PV-DISP-SQLCODE       06180000
061900             DISPLAY 'SQL CODE IS: ' PV-DISP-SQLCODE              06190000
062000             PERFORM 9900-DB2-ABEND                               06200000
062100         WHEN SQLCODE = ZERO                                      06210000
062200             CONTINUE                                             06220000
062300     END-EVALUATE.                                                06230000
062400                                                                  06240000
062500 4200-PROCESS-CSR.                                                06250000
062600                                                                  06260000
062700     PERFORM 4300-FETCH-PULL-CSR.                                 06270000
062800                                                                  06280000
062900     IF  PS-END-OF-PULL-CSR                                       06290000
063000         CONTINUE                                                 06300000
063100     ELSE                                                         06310000
063200         PERFORM 4800-PROCESS-DATA                                06320000
063300     END-IF.                                                      06330000
063400                                                                  06340000
063500 4300-FETCH-PULL-CSR.                                             06350000
063600                                                                  06360000
063700     MOVE '4300-FETCH-PULL-CSR'                                   06370000
063800         TO PV-ABEND-PARAGRAPH.                                   06380000
063900     MOVE 'FETCH THE PULL-CSR'                                    06390000
064000         TO PV-ABEND-OPERATION.                                   06400000
064100                                                                  06410000
064200     EXEC SQL                                                     06420000
064300         FETCH  PULL-CSR                                          06430000
064400          INTO  :CEPLMF-CNSTK-REQ-PL-NBR                          06440002
064500             ,  :CEPLMF-PL-LNE-NBR                                06450002
064600             ,  :CEPLMF-STR-NBR                                   06460002
064800             ,  :XLT00006-INTR-UPC-ID                             06480000
064900             ,  :XLT00003-SKU-NBR                                 06490000
064910             ,  :XLT00003-SKU-DESC                                06491000
064920             ,  :XLT00004-DEPT-NBR                                06492000
064930             ,  :XLT00002-DEPT-NM                                 06493000
065000             ,  :CEPLMF-MFST-UNT-QTY                              06500002
065500     END-EXEC.                                                    06550000
065600                                                                  06560000
065700     EVALUATE TRUE                                                06570000
065800         WHEN SQLCODE = +100                                      06580000
065900             SET PS-END-OF-PULL-CSR  TO  TRUE                     06590000
066000         WHEN SQLWARN0 NOT = SPACE                                06600000
066100         WHEN SQLCODE < ZERO                                      06610000
066200         WHEN SQLCODE > ZERO                                      06620000
066300             DISPLAY IR-INPUT-RECORD                              06630000
066400             MOVE  SQLCODE               TO PV-DISP-SQLCODE       06640000
066500             DISPLAY 'SQL CODE IS: ' PV-DISP-SQLCODE              06650000
066600             PERFORM 9900-DB2-ABEND                               06660000
066700         WHEN SQLCODE = ZERO                                      06670000
066800             ADD +1 TO PV-FETCH-COUNT                             06680000
066900                       PV-FETCH-COUNT2                            06690000
067000             IF  PV-FETCH-COUNT2 = 500                            06700000
067100                 MOVE PV-FETCH-COUNT TO                           06710000
067200                      PV-DISPLAY-FETCH-COUNT1                     06720000
067300                 DISPLAY 'PROGRAM PROGRESS FETCH: '               06730000
067310                         PV-DISPLAY-FETCH-COUNT1                  06731000
067320                 MOVE +0 TO PV-FETCH-COUNT2                       06732000
067330             END-IF                                               06733000
067340     END-EVALUATE.                                                06734000
067350                                                                  06735000
067360 4500-CLOSE-PULL-CSR.                                             06736000
067370                                                                  06737000
067380     MOVE '4500-CLOSE-PULL-CSR'                                   06738000
067390         TO PV-ABEND-PARAGRAPH.                                   06739000
067400     MOVE 'CLOSE PO CURSOR'                                       06740000
067500         TO PV-ABEND-OPERATION.                                   06750000
067600                                                                  06760000
067700     EXEC SQL                                                     06770000
067800         CLOSE PULL-CSR                                           06780000
067900     END-EXEC.                                                    06790000
068000                                                                  06800000
068100     EVALUATE TRUE                                                06810000
068200         WHEN SQLWARN0 NOT = SPACE                                06820000
068300         WHEN SQLCODE < ZERO                                      06830000
068400         WHEN SQLCODE > ZERO                                      06840000
068500             DISPLAY IR-INPUT-RECORD                              06850000
068600             MOVE  SQLCODE               TO PV-DISP-SQLCODE       06860000
068700             DISPLAY 'SQL CODE IS: ' PV-DISP-SQLCODE              06870000
068800             PERFORM 9900-DB2-ABEND                               06880000
068900         WHEN SQLCODE = ZERO                                      06890000
069000             CONTINUE                                             06900000
069100     END-EVALUATE.                                                06910000
069200                                                                  06920000
069300 4800-PROCESS-DATA.                                               06930000
069400                                                                  06940000
069500     INITIALIZE PC010-PCT-INTRANSIT-REC.                          06950001
069501     MOVE XLT00006-INTR-UPC-ID TO PC010-INTR-UPC-ID.              06950101
069503     SET PC010-CNTL-STOCK-RECEIPT TO TRUE.                        06950301
069504     SET PC010-TRN-STR-EXPECTED TO TRUE.                          06950401
069505     MOVE 'CEKUT995' TO  PC010-UPD-USR-ID.                        06950501
069510     MOVE IR-PULL-NBR TO PC010-PO-NBR.                            06951001
069511     MOVE CEPLMF-STR-NBR TO PC010-STR-NBR.                        06951104
069520     MOVE ZERO TO PC010-RCVR-SEQ-NBR.                             06952001
069530     MOVE ZERO TO PC010-TRIP-ID.                                  06953001
069540     MOVE ZERO TO PC010-STAT-CDE-DS.                              06954001
069550     MOVE ZERO TO PC010-STAT-CDE-SU.                              06955001
069560     MOVE ZERO TO PC010-UPC-NBR.                                  06956001
069561     MOVE PV-CURRENT-TMST TO PC010-EVENT-TMST.                    06956101
069562     MOVE ZERO TO PC010-TRN-LNE-NBR.                              06956201
069563                                                                  06956301
069564     MOVE CEPLMF-MFST-UNT-QTY TO PC010-IN-TRNST-QTY.              06956402
069565     MULTIPLY  PC010-IN-TRNST-QTY                                 06956501
069566           BY  -1                                                 06956601
069567       GIVING  PC010-IN-TRNST-QTY.                                06956701
069568                                                                  06956801
071700*    CHECK PCT_TRN_CLSN_DTL                                       07170000
071800     SET PS-CLEAN-EXISTS-NO TO TRUE.                              07180000
071810     SET PS-SE-BALANCED-NO TO TRUE.                               07181011
071820     SET PS-SE-PARTIAL-NO TO TRUE.                                07182011
071830     MOVE ZERO TO PV-STORE-EXP-QTY.                               07183011
071900     MOVE XLT00006-INTR-UPC-ID  TO DK-SE-INTR_UPC_ID.             07190000
072000     MOVE CEPLMF-STR-NBR        TO DK-SE-LOC-NBR.                 07200002
072100     MOVE CEPLMF-CNSTK-REQ-PL-NBR TO DK-SE-PO-NBR.                07210002
072200     MOVE ZERO                  TO DK-SE-RCVR-SEQ-NBR.            07220001
072300     PERFORM 6000-CHECK-SE-CLEAN.                                 07230000
072400                                                                  07240000
072500     IF  PS-CLEAN-EXISTS                                          07250000
072600         NEXT SENTENCE                                            07260000
072700     ELSE                                                         07270000
072710         PERFORM 6100-CHECK-SE-BALANCE                            07271005
072720         IF  PS-SE-BALANCED                                       07272005
072730             NEXT SENTENCE                                        07273005
072740         ELSE                                                     07274005
072750             IF  PV-STORE-EXP-QTY > 0                             07275006
072760                 IF  PV-STORE-EXP-QTY < CEPLMF-MFST-UNT-QTY       07276006
072761                     MOVE CEPLMF-MFST-UNT-QTY TO                  07276106
072762                          PV-CEPLMF-MFST-UNT-QTY                  07276206
072766                     MOVE PV-STORE-EXP-QTY TO                     07276615
072767                          PC010-IN-TRNST-QTY                      07276715
072768                     MOVE PC010-IN-TRNST-QTY TO                   07276806
072769                          PV-PC010-IN-TRNST-QTY                   07276906
072770                     MOVE PC010-IN-TRNST-QTY TO                   07277006
072771                          CEPLMF-MFST-UNT-QTY                     07277106
072772                     MULTIPLY PC010-IN-TRNST-QTY                  07277206
072773                           BY -1                                  07277306
072774                       GIVING PC010-IN-TRNST-QTY                  07277406
072775                     ADD +1 TO PV-PARTIAL-QTY-COUNT               07277506
072776                     SET PS-SE-PARTIAL-YES TO TRUE                07277609
072777                     MOVE DK-SE-INTR_UPC_ID  TO PV-DISP-INTR-UPC  07277706
072778                     MOVE DK-SE-LOC-NBR      TO PV-DISP-LOC-NBR   07277806
072779                     MOVE DK-SE-PO-NBR       TO PV-DISP-PO        07277906
072780                     MOVE DK-SE-RCVR-SEQ-NBR TO PV-DISP-RCVR      07278006
072781                     DISPLAY 'SE PARTIAL OF CS QTY FOR:  '        07278106
072782                             'SKU - ' XLT00003-SKU-NBR            07278206
072783                             ' LOC - ' PV-DISP-LOC-NBR            07278306
072784                             ' PO - ' PV-DISP-PO                  07278406
072785                             ' RCVR - ' PV-DISP-RCVR              07278506
072786                             ' INTR UPC - ' PV-DISP-INTR-UPC      07278606
072787                     MOVE PV-CEPLMF-MFST-UNT-QTY TO               07278706
072788                          PV-DISP-QTY1                            07278806
072789                     MOVE PV-STORE-EXP-QTY       TO               07278906
072790                          PV-DISP-QTY2                            07279006
072791                     MOVE PC010-IN-TRNST-QTY  TO                  07279106
072792                          PV-DISP-QTY3                            07279206
072793                     DISPLAY '     QTY INFO FOR ABOVE :  '        07279306
072794                             'PULL QTY - ' PV-DISP-QTY1           07279406
072795                             ' SE BAL QTY - '  PV-DISP-QTY2       07279506
072796                             ' SE PROCESS QTY - ' PV-DISP-QTY3    07279606
072797                     PERFORM 8000-WRITE-OUTPUT-RECEIPT            07279706
072798                     PERFORM 2020-POPULATE-PCRD010-SHIPPED        07279806
072799                     PERFORM 8010-WRITE-PCRD010                   07279906
072800                     PERFORM 2030-POPULATE-PCRD010-UNLOADED       07280006
072801                     PERFORM 8010-WRITE-PCRD010                   07280106
072802                 ELSE                                             07280206
072803                     PERFORM 8000-WRITE-OUTPUT-RECEIPT            07280306
072804                     PERFORM 2020-POPULATE-PCRD010-SHIPPED        07280406
072805                     PERFORM 8010-WRITE-PCRD010                   07280506
072806                     PERFORM 2030-POPULATE-PCRD010-UNLOADED       07280606
072807                     PERFORM 8010-WRITE-PCRD010                   07280706
072808                 END-IF                                           07280806
072809             ELSE                                                 07280906
072810                 PERFORM 8000-WRITE-OUTPUT-RECEIPT                07281006
072900                 PERFORM 2020-POPULATE-PCRD010-SHIPPED            07290006
073000                 PERFORM 8010-WRITE-PCRD010                       07300006
073100                 PERFORM 2030-POPULATE-PCRD010-UNLOADED           07310006
073200                 PERFORM 8010-WRITE-PCRD010                       07320006
073201             END-IF                                               07320106
073210         END-IF                                                   07321005
073300     END-IF.                                                      07330000
073400                                                                  07340000
073500     PERFORM 2040-POPULATE-ADJUST-RECORD.                         07350000
073600     PERFORM 8020-WRITE-ADJUST.                                   07360000
073700                                                                  07370000
073800******************************************************************07380000
073900*                                                                *07390000
074000******************************************************************07400000
074100 6000-CHECK-SE-CLEAN.                                             07410000
074200                                                                  07420000
074300     MOVE '6000-CHECK-SE-CLEAN'                                   07430000
074400         TO PV-ABEND-PARAGRAPH.                                   07440000
074500     MOVE 'SELECT PCT_TRN_CLSN_DTL'                               07450000
074600         TO PV-ABEND-OPERATION.                                   07460000
074700                                                                  07470000
074800     EXEC SQL                                                     07480000
074900          SELECT TRN_CLSN_CDE                                     07490000
075000          INTO  :PCT00015-TRN-CLSN-CDE                            07500000
075100          FROM   PCT_TRN_CLSN_DTL                                 07510000
075200          WHERE  INTR_UPC_ID   = :DK-SE-INTR_UPC_ID               07520000
075300           AND   LOC_NBR       = :DK-SE-LOC-NBR                   07530000
075400           AND   TRN_CLSN_CDE  = 'SE'                             07540000
075500           AND   TRN_TYP_CDE   = 'CL'                             07550000
075600           AND   PO_NBR        = :DK-SE-PO-NBR                    07560000
075700           AND   RCVR_SEQ_NBR  = :DK-SE-RCVR-SEQ-NBR              07570000
075800          FETCH FIRST 1 ROW ONLY                                  07580000
075900          WITH UR                                                 07590000
076000     END-EXEC.                                                    07600000
076100                                                                  07610000
076200     EVALUATE TRUE                                                07620000
076300         WHEN SQLCODE = ZERO                                      07630000
076400         WHEN SQLCODE = -811                                      07640000
076500             SET PS-CLEAN-EXISTS     TO  TRUE                     07650000
076600             ADD 1 TO PV-CLEAN-COUNT                              07660000
076700             MOVE DK-SE-INTR_UPC_ID  TO PV-DISP-INTR-UPC          07670000
076800             MOVE DK-SE-LOC-NBR      TO PV-DISP-LOC-NBR           07680000
076900             MOVE DK-SE-PO-NBR       TO PV-DISP-PO                07690000
076910             MOVE DK-SE-RCVR-SEQ-NBR TO PV-DISP-RCVR              07691000
076920             DISPLAY 'CLEAN FOUND FOR:  '                         07692000
076930                     'SKU - ' XLT00003-SKU-NBR                    07693000
076940                     ' LOC - ' PV-DISP-LOC-NBR                    07694000
076950                     ' PO - ' PV-DISP-PO                          07695000
076960                     ' RCVR - ' PV-DISP-RCVR                      07696000
076970                     ' INTR UPC - ' PV-DISP-INTR-UPC              07697000
076980         WHEN SQLCODE = +100                                      07698000
076990             SET PS-CLEAN-EXISTS-NO  TO  TRUE                     07699000
077000         WHEN SQLWARN0 NOT = SPACE                                07700000
077100         WHEN SQLCODE < ZERO                                      07710000
077200         WHEN SQLCODE > ZERO                                      07720000
077210             DISPLAY 'ABEND INFO - KEY DATA'                      07721000
077220             DISPLAY 'SKU NUMBER IS: '  XLT00003-SKU-NBR          07722000
077230             MOVE CEPLMF-STR-NBR        TO PV-DISP-LOC-NBR        07723002
077240             DISPLAY 'LOC NUMBER IS: '  PV-DISP-LOC-NBR           07724000
077250             MOVE CEPLMF-CNSTK-REQ-PL-NBR TO PV-DISP-PO           07725002
077260             DISPLAY 'PO NUMBER IS : '  PV-DISP-PO                07726000
077270             MOVE ZERO                  TO PV-DISP-RCVR           07727001
077280             DISPLAY 'REC NUMBER IS: '  PV-DISP-RCVR              07728000
077290             MOVE XLT00006-INTR-UPC-ID  TO PV-DISP-INTR-UPC       07729000
077300             DISPLAY 'INTR UPC IS  :  ' PV-DISP-INTR-UPC          07730000
077400             MOVE  SQLCODE               TO PV-DISP-SQLCODE       07740000
077500             DISPLAY 'SQL CODE IS: ' PV-DISP-SQLCODE              07750000
077600             PERFORM 9900-DB2-ABEND                               07760000
077700         WHEN SQLCODE = ZERO                                      07770000
077800             CONTINUE                                             07780000
077900     END-EVALUATE.                                                07790000
078000                                                                  07800000
078020******************************************************************07802005
078030*                                                                *07803005
078040******************************************************************07804005
078050 6100-CHECK-SE-BALANCE.                                           07805005
078060                                                                  07806005
078070     MOVE '6100-CHECK-SE-BALANCE'                                 07807005
078080         TO PV-ABEND-PARAGRAPH.                                   07808005
078090     MOVE 'SELECT PCT_TRN_CLSN_DTL'                               07809005
078091         TO PV-ABEND-OPERATION.                                   07809105
078092     INITIALIZE PV-NULL-IND.                                      07809206
078093                                                                  07809305
078094     EXEC SQL                                                     07809405
078095          SELECT SUM(TRN_CLSN_PRCG_QTY)                           07809506
078096            INTO :PV-STORE-EXP-QTY :PV-NULL-IND                   07809606
078098            FROM PCT_TRN_CLSN_DTL                                 07809806
078099           WHERE INTR_UPC_ID   = :DK-SE-INTR_UPC_ID               07809906
078100             AND LOC_NBR       = :DK-SE-LOC-NBR                   07810006
078101             AND TRN_CLSN_CDE  = 'SE'                             07810106
078102             AND TRN_TYP_CDE NOT IN                               07810206
078103                 ('UM', 'NS', 'MM', 'AM', 'SM')                   07810306
078104             AND PO_NBR        = :DK-SE-PO-NBR                    07810406
078105             AND RCVR_SEQ_NBR  = :DK-SE-RCVR-SEQ-NBR              07810506
078107          WITH UR                                                 07810706
078108     END-EXEC.                                                    07810806
078109                                                                  07810906
078110     EVALUATE TRUE                                                07811006
078111         WHEN SQLCODE = ZERO                                      07811106
078112              IF PV-NULL-IND < 0                                  07811206
078113                  SET PS-SE-BALANCED-NO   TO  TRUE                07811306
078114                  MOVE ZEROES  TO  PV-STORE-EXP-QTY               07811406
078115              ELSE                                                07811506
078116                  IF  PV-STORE-EXP-QTY = 0                        07811606
078117                      SET PS-SE-BALANCED TO TRUE                  07811706
078118                      ADD 1 TO PV-BALANCE-COUNT                   07811806
078119                      MOVE DK-SE-INTR_UPC_ID  TO PV-DISP-INTR-UPC 07811906
078120                      MOVE DK-SE-LOC-NBR      TO PV-DISP-LOC-NBR  07812006
078121                      MOVE DK-SE-PO-NBR       TO PV-DISP-PO       07812106
078122                      MOVE DK-SE-RCVR-SEQ-NBR TO PV-DISP-RCVR     07812206
078123                      DISPLAY 'SE BALANCE IS ZERO FOR:  '         07812306
078124                              'SKU - ' XLT00003-SKU-NBR           07812406
078125                              ' LOC - ' PV-DISP-LOC-NBR           07812506
078126                              ' PO - ' PV-DISP-PO                 07812606
078127                              ' RCVR - ' PV-DISP-RCVR             07812706
078128                              ' INTR UPC - ' PV-DISP-INTR-UPC     07812806
078129                  ELSE                                            07812906
078130                      SET PS-SE-BALANCED-NO   TO  TRUE            07813006
078131                  END-IF                                          07813106
078140              END-IF                                              07814006
078142         WHEN SQLCODE = +100                                      07814206
078143             SET PS-SE-BALANCED-NO   TO  TRUE                     07814306
078144         WHEN SQLWARN0 NOT = SPACE                                07814406
078145         WHEN SQLCODE < ZERO                                      07814506
078146         WHEN SQLCODE > ZERO                                      07814606
078147             DISPLAY 'ABEND INFO - KEY DATA'                      07814706
078148             DISPLAY 'SKU NUMBER IS: '  XLT00003-SKU-NBR          07814806
078149             MOVE CEPLMF-STR-NBR        TO PV-DISP-LOC-NBR        07814906
078150             DISPLAY 'LOC NUMBER IS: '  PV-DISP-LOC-NBR           07815006
078151             MOVE CEPLMF-CNSTK-REQ-PL-NBR TO PV-DISP-PO           07815106
078152             DISPLAY 'PO NUMBER IS : '  PV-DISP-PO                07815206
078153             MOVE ZERO                  TO PV-DISP-RCVR           07815306
078154             DISPLAY 'REC NUMBER IS: '  PV-DISP-RCVR              07815406
078155             MOVE XLT00006-INTR-UPC-ID  TO PV-DISP-INTR-UPC       07815506
078156             DISPLAY 'INTR UPC IS  :  ' PV-DISP-INTR-UPC          07815606
078157             MOVE  SQLCODE               TO PV-DISP-SQLCODE       07815706
078158             DISPLAY 'SQL CODE IS: ' PV-DISP-SQLCODE              07815806
078159             PERFORM 9900-DB2-ABEND                               07815906
078160         WHEN SQLCODE = ZERO                                      07816006
078161             CONTINUE                                             07816106
078162     END-EVALUATE.                                                07816206
078163                                                                  07816306
078170******************************************************************07817005
078200*                                                                *07820000
078300******************************************************************07830000
078400 7000-READ-INPUT.                                                 07840000
078500                                                                  07850000
078600     READ INPUT-FILE                                              07860000
078700     INTO IR-INPUT-RECORD                                         07870000
078800        AT END                                                    07880000
078900           SET  PS-EOF-INPUT  TO TRUE.                            07890000
079000                                                                  07900000
079100     IF  PS-EOF-INPUT                                             07910000
079200         NEXT SENTENCE                                            07920000
079300     ELSE                                                         07930000
079400         ADD 1 TO  PV-READ-COUNT                                  07940000
079500         ADD 1 TO  PV-READ-COUNT-2                                07950000
079600         IF  PV-READ-COUNT-2 = 500                                07960000
079700             DISPLAY 'READ COUNT:'                                07970000
079800                     PV-READ-COUNT                                07980000
079900             MOVE ZEROES  TO PV-READ-COUNT-2                      07990000
080000         END-IF                                                   08000000
080100     END-IF.                                                      08010000
080200                                                                  08020000
080300                                                                  08030000
080400******************************************************************08040000
080500*                                                                *08050000
080600******************************************************************08060000
080700 8000-WRITE-OUTPUT-RECEIPT.                                       08070000
080800                                                                  08080000
080900     WRITE SE-OUTPUT-RECORD                                       08090000
081000      FROM PC010-PCT-INTRANSIT-REC.                               08100000
081100     ADD +1 TO PV-WRITE-COUNT-SE.                                 08110000
081200                                                                  08120000
081300                                                                  08130000
081400******************************************************************08140000
081500*                                                                *08150000
081600******************************************************************08160000
081700 8010-WRITE-PCRD010.                                              08170000
081800                                                                  08180000
081900     WRITE INTRANSIT-OUTPUT-RECORD                                08190000
082000      FROM PC010-PCT-INTRANSIT-REC.                               08200000
082100     ADD +1 TO PV-WRITE-COUNT-INTRANSIT.                          08210000
082200                                                                  08220000
082300******************************************************************08230000
082400*                                                                *08240000
082500******************************************************************08250000
082600 8020-WRITE-ADJUST.                                               08260000
082700                                                                  08270000
082800     WRITE ADJUST-OUTPUT-RECORD                                   08280000
082900      FROM OR-OUTPUT-RECORD.                                      08290000
083000     ADD +1 TO PV-WRITE-COUNT-ADJUST.                             08300000
083100                                                                  08310000
083200                                                                  08320000
083300******************************************************************08330000
083400*  ABEND ROUTINE                                                 *08340000
083500******************************************************************08350000
083600 9900-DB2-ABEND.                                                  08360000
083700                                                                  08370000
083800     MOVE SQLCODE TO PV-SQLCODE.                                  08380000
083900     DISPLAY '*** DB2 ERROR '.                                    08390000
084000     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       08400000
084100     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08410000
084200     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08420000
084300     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08430000
084400     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       08440000
084500     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       08450000
084600     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME-1.              08460000
084700     DISPLAY '*** TABLE 2   = ' PV-DB2-TABLE-NAME-2.              08470000
084800                                                                  08480000
084900     COPY DPPD004.                                                08490000
085000                                                                  08500000
085100     MOVE +4013 TO PV-ABEND-CODE.                                 08510000
085200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08520000
085300                                                                  08530000
085400 9999-ABEND.                                                      08540000
085500                                                                  08550000
085600     DISPLAY '***************'.                                   08560000
085700     DISPLAY '** ABEND     **'.                                   08570000
085800     DISPLAY '** PROGRAM   ** = ' PV-ABEND-PROGRAM.               08580000
085900     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             08590000
086000     DISPLAY '***************'.                                   08600000
086100                                                                  08610000
086200     MOVE +4008                  TO PV-ABEND-CODE.                08620000
086300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08630000
086400                                                                  08640000
086500******************************************************************08650000
086600*                 E N D   O F   P R O G R A M                    *08660000
086700******************************************************************08670000
