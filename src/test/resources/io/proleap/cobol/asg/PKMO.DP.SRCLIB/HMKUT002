       IDENTIFICATION DIVISION.                                         00010027
       PROGRAM-ID.    HMKUT002.                                         00020027
       AUTHOR.        JON FIEDLER.                                      00030027
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040027
       DATE-WRITTEN.  05-11-2001.                                       00050027
       DATE-COMPILED.                                                   00060027
      ******************************************************************00070027
      * HMKUT002 -                                                      00080027
      * THIS PROGRAM WILL CREATE AN EXTRACT FILE FOR MBS DATA INTEGRITY 00090027
      * CHECK.                                                          00100027
      ******************************************************************00110027
C14666* 07/10/12 - RAVIKUMAR GUNTHA     - CRQ000000014666               00111027
C14666*   RECOMPILED THE PROGRAM DUE TO A CHANGE IN TDPTSHK DCLGEN      00112028
C14666***************************************************************** 00113027
                                                                        00120027
       ENVIRONMENT DIVISION.                                            00130027
                                                                        00140027
       CONFIGURATION SECTION.                                           00150027
                                                                        00160027
       SOURCE-COMPUTER.        IBM-3090.                                00170027
       OBJECT-COMPUTER.        IBM-3090.                                00180027
                                                                        00190027
       INPUT-OUTPUT SECTION.                                            00200027
       FILE-CONTROL.                                                    00210027
                                                                        00220027
           SELECT MBS-EXTR-FILE                                         00230027
               ASSIGN TO OUT01.                                         00240027
                                                                        00250027
           SELECT MBS-REPORT-FILE                                       00260027
               ASSIGN TO OUT02.                                         00270027
                                                                        00271027
      ******************************************************************00272027
       DATA DIVISION.                                                   00273027
      ******************************************************************00274027
                                                                        00275027
       FILE SECTION.                                                    00276027
                                                                        00277027
       FD  MBS-EXTR-FILE                                                00278027
           RECORDING MODE IS F                                          00279027
           LABEL RECORDS ARE STANDARD                                   00280027
           BLOCK CONTAINS 0 RECORDS.                                    00290027
                                                                        00300027
       01  MBS-EXTR-REC     PIC X(33).                                  00310027
                                                                        00320027
                                                                        00330027
       FD  MBS-REPORT-FILE                                              00340027
           RECORDING MODE IS F                                          00350027
           LABEL RECORDS ARE STANDARD                                   00360027
           BLOCK CONTAINS 0 RECORDS.                                    00370027
                                                                        00380027
       01  MBS-REPORT-REC   PIC X(36).                                  00390027
                                                                        00400027
      ******************************************************************00410027
       WORKING-STORAGE SECTION.                                         00420027
      ******************************************************************00430027
                                                                        00440027
                                                                        00450027
       01  PS-PROGRAM-SWITCHES.                                         00460027
           05  PS-EXTRACT-DONE         PIC X       VALUE 'N'.           00470027
               88  PS-EXTRACT-IS-DONE              VALUE 'Y'.           00480027
               88  PS-EXTRACT-IS-NOT-DONE          VALUE 'N'.           00490027
           05  PS-EXTRACT2-DONE        PIC X       VALUE 'N'.           00500027
               88  PS-EXTRACT2-IS-DONE             VALUE 'Y'.           00510027
               88  PS-EXTRACT2-IS-NOT-DONE         VALUE 'N'.           00520027
                                                                        00530027
       01  PA-PROGRAM-ACCUMULATORS                 COMP-3.              00540027
           05  PA-EXTRT-RWS-FETCHED1   PIC S9(13)  VALUE ZERO.          00550027
           05  PA-EXTRT-RWS-FETCHED2   PIC S9(13)  VALUE ZERO.          00560027
           05  PA-OUTPUT-RECS-WRITTEN  PIC S9(13)  VALUE ZERO.          00570027
                                                                        00580027
       01  PV-PROGRAM-VARIABLES.                                        00590027
           05  PV-PREV-GMA-NBR         PIC X(02).                       00600027
           05  PV-PREV-DMA-NBR         PIC X(02).                       00610027
           05  PV-PREV-DEPT-NBR        PIC X(03).                       00620027
           05  PV-PREV-MAJ-CL-NBR      PIC X(02).                       00630027
           05  PV-PREV-SUB-CL-NBR      PIC X(03).                       00640027
           05  PV-GMA-NBR              PIC X(02).                       00650027
           05  PV-DMA-NBR              PIC X(02).                       00660027
           05  PV-DEPT-NBR             PIC X(03).                       00670027
           05  PV-MAJ-CL-NBR           PIC X(02).                       00680027
           05  PV-SUB-CL-NBR           PIC X(03).                       00690027
           05  PV-RSPLVL-CDE           PIC X(03).                       00700027
           05  PV-DKEY                 PIC S999999V USAGE COMP-3.       00710027
           05  PV-TOTAL-ERRORS         PIC 9(07)    VALUE 0.            00720027
                                                                        00730027
       01  CD-COUNTER-DISPLAY.                                          00740027
           05  CD-COUNT-HOLD1          PIC Z,ZZZ,ZZZ,ZZZ,ZZ9.           00750027
                                                                        00760027
       01 ABEND-AREAS.                                                  00770027
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           00780027
                                                   COMP SYNC.           00790027
               88  AC-BAD-DATA                     VALUE +4003.         00800027
               88  AC-DB2-ERROR                    VALUE +4013.         00810027
           05  AA-ABEND-LIT            PIC X(40)   VALUE                00820027
                 '*****       ABEND'.                                   00830027
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                00840027
                   '*****   PROGRAM: HMKUT002'.                         00850027
           05  AA-PARAGRAPH-LIT.                                        00860027
               10  FILLER              PIC X(17)   VALUE                00870027
                   '***** PARAGRAPH: '.                                 00880027
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        00890027
           05  AA-MESSAGE-LINE.                                         00900027
               10  FILLER              PIC X(06)   VALUE '*****'.       00910027
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        00920027
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                00930027
                   '*****    DB2 ERROR'.                                00940027
           05  AA-DB2-OPERATION-LIT.                                    00950027
               10  FILLER              PIC X(17)   VALUE                00960027
                   '***** OPERATION: '.                                 00970027
               10  AA-DB2-OPERATION.                                    00980027
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        00990027
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        01000027
                                                                        01010027
       EJECT                                                            01020027
                                                                        01030027
      ******************************************************************01040027
      *  DB2 ERROR MESSAGES FORMAT AREA.                                01050027
      ******************************************************************01060027
           COPY DPWS004.                                                01070027
                                                                        01080027
      ******************************************************************01090027
      * MBS EXTRACT RECORD                                              01100027
      ******************************************************************01110027
           COPY HMRD002.                                                01120027
                                                                        01130027
      ******************************************************************01140027
      * MBS/RMS REPORT RECORD                                           01150027
      ******************************************************************01160027
           COPY HMRD004.                                                01170027
                                                                        01180027
      ******************************************************************01190027
      *  DB2 ERRORS                                                     01200027
      ******************************************************************01210027
           COPY SQLCA2.                                                 01220027
                                                                        01230027
      ******************************************************************01240027
      *  DB2 COMMUNICATION AREA                                         01250027
      ******************************************************************01260027
           EXEC SQL                                                     01270027
                INCLUDE SQLCA                                           01280027
           END-EXEC.                                                    01290027
                                                                        01300027
      ******************************************************************01310027
      *  TMDSEAR TABLE                                                  01320027
      ******************************************************************01330027
           EXEC SQL                                                     01340027
                INCLUDE TMDSEAR                                         01350027
           END-EXEC.                                                    01360027
                                                                        01370027
      ******************************************************************01380027
      *  TRSPBAR TABLE                                                  01390027
      ******************************************************************01400027
           EXEC SQL                                                     01410027
                INCLUDE TRSPBAR                                         01420027
           END-EXEC.                                                    01430027
                                                                        01440027
      ******************************************************************01450027
      *  TMDSEDP TABLE                                                  01460027
      ******************************************************************01470027
           EXEC SQL                                                     01480027
                INCLUDE TMDSEDP                                         01490027
           END-EXEC.                                                    01500027
                                                                        01510027
      ******************************************************************01520027
      *  TDPTSHK TABLE                                                  01530027
      ******************************************************************01540027
           EXEC SQL                                                     01550027
                INCLUDE TDPTSHK                                         01560027
           END-EXEC.                                                    01570027
                                                                        01580027
      ******************************************************************01590027
      *  TMDSECL TABLE                                                  01600027
      ******************************************************************01610027
           EXEC SQL                                                     01620027
                INCLUDE TMDSECL                                         01630027
           END-EXEC.                                                    01640027
                                                                        01650027
      ******************************************************************01660027
      *  DB2 DEPT/SUBCLASS CURSOR                                       01670027
      ******************************************************************01680027
           EXEC SQL                                                     01690027
               DECLARE DEPT_SCL_CURSOR CURSOR FOR                       01700027
               SELECT GMA_NBR                                           01710027
                     ,DMA_NBR                                           01720027
                     ,DEPT_NBR                                          01730027
                     ,MAJ_CL_NBR                                        01740027
                     ,SUB_CL_NBR                                        01750027
                     ,MDSEAR_DKEY                                       01760027
                     ,MDSELV_CDE                                        01770027
               FROM TMDSEAR                                             01780027
               WHERE MDSELV_CDE IN ('DPT','SCL')                        01790027
                 AND END_DTE <> '9999-09-09'                            01800027
               ORDER BY 1,2,3,4,5                                       01810027
               FOR FETCH ONLY                                           01820027
           END-EXEC.                                                    01830027
                                                                        01840027
      ***************************************************************** 01850027
      *  DB2 MAIN EXTRACT CURSOR                                        01860027
      ******************************************************************01870027
           EXEC SQL                                                     01880027
               DECLARE EXTRACT_CURSOR CURSOR FOR                        01890027
               SELECT GMA_NBR                                           01900027
                     ,DMA_NBR                                           01910027
                     ,DEPT_NBR                                          01920027
                     ,MAJ_CL_NBR                                        01930027
                     ,SUB_CL_NBR                                        01940027
                     ,MDSEAR_DKEY                                       01950027
                     ,MDSELV_CDE                                        01960027
               FROM TMDSEAR                                             01970027
               WHERE MDSELV_CDE <> 'CO'                                 01980027
               AND END_DTE = '9999-09-09'                               01990027
               ORDER BY 1,2,3,4,5                                       02000027
               FOR FETCH ONLY                                           02010027
           END-EXEC.                                                    02020027
                                                                        02030027
       EJECT                                                            02040027
                                                                        02050027
      ******************************************************************02060027
       PROCEDURE DIVISION.                                              02070027
      ******************************************************************02080027
                                                                        02090027
      ******************************************************************02100027
       A000-MAIN-MODULE.                                                02110027
      ******************************************************************02120027
                                                                        02130027
           PERFORM B000-INITIALIZE.                                     02140027
                                                                        02150027
           PERFORM B100-PROCESS-DATA.                                   02160027
                                                                        02170027
           PERFORM B900-EOJ-ROUTINE.                                    02180027
                                                                        02190027
           STOP RUN.                                                    02200027
                                                                        02210027
       EJECT                                                            02220027
                                                                        02230027
      ******************************************************************02240027
       B000-INITIALIZE.                                                 02250027
      ******************************************************************02260027
                                                                        02270027
           OPEN OUTPUT MBS-EXTR-FILE                                    02280027
                       MBS-REPORT-FILE.                                 02290027
                                                                        02300027
       EJECT                                                            02310027
                                                                        02320027
      ******************************************************************02330027
       B100-PROCESS-DATA.                                               02340027
      ******************************************************************02350027
                                                                        02360027
      ******************************************************************02370027
      * FIRST CURSOR -- MAIN EXTRACT TMDSEAR STRUCTURE CHECK            02380027
           PERFORM Z210-OPEN-CURSOR-EXTRACT.                            02390027
                                                                        02400027
           PERFORM Z220-FETCH-EXTRACT.                                  02410027
                                                                        02420027
           PERFORM                                                      02430027
             UNTIL PS-EXTRACT-IS-DONE                                   02440027
               PERFORM C050-STRUCTURE-CHECK                             02450027
               PERFORM Z220-FETCH-EXTRACT                               02460027
           END-PERFORM.                                                 02470027
                                                                        02480027
           PERFORM Z230-CLOSE-CURSOR-EXTRACT.                           02490027
                                                                        02500027
      ******************************************************************02510027
      * SECOND CURSOR -- DEPT AND SCL RELATED TABLES CHECK              02520027
           PERFORM Z215-OPN-DPT-SCL-CSR.                                02530027
                                                                        02540027
           PERFORM Z225-FETCH-DPT-SCL-CSR.                              02550027
                                                                        02560027
           PERFORM                                                      02570027
             UNTIL PS-EXTRACT2-IS-DONE                                  02580027
               IF HM002-HIER-LVL = 'DPT'                                02590027
                  PERFORM C450-CHECK-DPT-RLTD-TBLS                      02600027
               ELSE                                                     02610027
                  PERFORM Z130-TMDSECL-CHECK                            02620027
               END-IF                                                   02630027
               PERFORM Z225-FETCH-DPT-SCL-CSR                           02640027
           END-PERFORM.                                                 02650027
                                                                        02660027
           PERFORM Z235-CLSE-CRSR-DPT-SCL.                              02670027
                                                                        02680027
       EJECT                                                            02690027
                                                                        02700027
      ***************************************************************** 02710027
       C050-STRUCTURE-CHECK.                                            02720027
      ***************************************************************** 02730027
                                                                        02740027
           IF PV-GMA-NBR NOT = PV-PREV-GMA-NBR                          02750027
              PERFORM C200-CHECK-GMA                                    02760027
              PERFORM C100-MOVE-CURRENT-VALUES                          02770027
           ELSE                                                         02780027
              IF PV-DMA-NBR NOT = PV-PREV-DMA-NBR                       02790027
                 PERFORM C250-CHECK-DMA                                 02800027
                 PERFORM C100-MOVE-CURRENT-VALUES                       02810027
              ELSE                                                      02820027
                 IF PV-DEPT-NBR NOT = PV-PREV-DEPT-NBR                  02830027
                    PERFORM C300-CHECK-DEPT                             02840027
                    PERFORM C100-MOVE-CURRENT-VALUES                    02850027
                 ELSE                                                   02860027
                    IF PV-MAJ-CL-NBR NOT = PV-PREV-MAJ-CL-NBR           02870027
                       PERFORM C350-CHECK-MCL                           02880027
                       PERFORM C100-MOVE-CURRENT-VALUES                 02890027
                    ELSE                                                02900027
                       IF PV-SUB-CL-NBR NOT = PV-PREV-SUB-CL-NBR        02910027
                          PERFORM C400-CHECK-SCL                        02920027
                          PERFORM C100-MOVE-CURRENT-VALUES              02930027
                       END-IF                                           02940027
                    END-IF                                              02950027
                 END-IF                                                 02960027
               END-IF                                                   02970027
            END-IF.                                                     02980027
                                                                        02990027
      ******************************************************************03000027
       C100-MOVE-CURRENT-VALUES.                                        03010027
      ******************************************************************03020027
                                                                        03030027
            MOVE PV-GMA-NBR TO PV-PREV-GMA-NBR.                         03040027
            MOVE PV-DMA-NBR TO PV-PREV-DMA-NBR.                         03050027
            MOVE PV-DEPT-NBR TO PV-PREV-DEPT-NBR.                       03060027
            MOVE PV-MAJ-CL-NBR TO PV-PREV-MAJ-CL-NBR.                   03070027
            MOVE PV-SUB-CL-NBR TO PV-PREV-SUB-CL-NBR.                   03080027
                                                                        03090027
      ******************************************************************03100027
       C200-CHECK-GMA.                                                  03110027
      ******************************************************************03120027
                                                                        03130027
            IF HM002-HIER-LVL = 'GMA'                                   03140027
               PERFORM C900-WRITE-EXTRACT                               03150027
               MOVE 'GMM' TO PV-RSPLVL-CDE                              03160027
               PERFORM Z100-TRSPBAR-CHECK                               03170027
               IF SQLCODE = +100                                        03180027
                  ADD 1 TO PV-TOTAL-ERRORS                              03190027
                  MOVE 9 TO HM004-MSG-NBR                               03200027
                  PERFORM C950-WRITE-REPORT-REC                         03210027
               END-IF                                                   03220027
            ELSE                                                        03230027
               ADD 1 TO PV-TOTAL-ERRORS                                 03240027
               DISPLAY 'MISSING GMA ROW'                                03250027
               DISPLAY 'DKEY   ' PV-DKEY                                03260027
               DISPLAY ' '                                              03270027
               MOVE 1 TO HM004-MSG-NBR                                  03280027
               PERFORM C950-WRITE-REPORT-REC                            03290027
               PERFORM C250-CHECK-DMA                                   03300027
            END-IF.                                                     03310027
                                                                        03320027
      ******************************************************************03330027
       C250-CHECK-DMA.                                                  03340027
      ******************************************************************03350027
                                                                        03360027
            IF HM002-HIER-LVL = 'DMA'                                   03370027
               PERFORM C900-WRITE-EXTRACT                               03380027
               MOVE 'DMM' TO PV-RSPLVL-CDE                              03390027
               PERFORM Z100-TRSPBAR-CHECK                               03400027
               IF SQLCODE = +100                                        03410027
                  ADD 1 TO PV-TOTAL-ERRORS                              03420027
                  MOVE 10 TO HM004-MSG-NBR                              03430027
                  PERFORM C950-WRITE-REPORT-REC                         03440027
               END-IF                                                   03450027
            ELSE                                                        03460027
               ADD 1 TO PV-TOTAL-ERRORS                                 03470027
               DISPLAY 'MISSING DMA ROW'                                03480027
               DISPLAY 'DKEY   ' PV-DKEY                                03490027
               DISPLAY ' '                                              03500027
               MOVE 2 TO HM004-MSG-NBR                                  03510027
               PERFORM C950-WRITE-REPORT-REC                            03520027
               PERFORM C300-CHECK-DEPT                                  03530027
            END-IF.                                                     03540027
                                                                        03550027
      ******************************************************************03560027
       C300-CHECK-DEPT.                                                 03570027
      ******************************************************************03580027
                                                                        03590027
            IF HM002-HIER-LVL = 'DPT'                                   03600027
               PERFORM C900-WRITE-EXTRACT                               03610027
               PERFORM C450-CHECK-DPT-RLTD-TBLS                         03620027
               MOVE 'BYR' TO PV-RSPLVL-CDE                              03630027
               PERFORM Z100-TRSPBAR-CHECK                               03640027
               IF SQLCODE = +100                                        03650027
                  ADD 1 TO PV-TOTAL-ERRORS                              03660027
                  MOVE 11 TO HM004-MSG-NBR                              03670027
                  PERFORM C950-WRITE-REPORT-REC                         03680027
               END-IF                                                   03690027
            ELSE                                                        03700027
               ADD 1 TO PV-TOTAL-ERRORS                                 03710027
               DISPLAY 'MISSING DPT ROW'                                03720027
               DISPLAY 'DKEY   ' PV-DKEY                                03730027
               DISPLAY ' '                                              03740027
               MOVE 3 TO HM004-MSG-NBR                                  03750027
               PERFORM C950-WRITE-REPORT-REC                            03760027
               PERFORM C350-CHECK-MCL                                   03770027
            END-IF.                                                     03780027
                                                                        03790027
      ******************************************************************03800027
       C350-CHECK-MCL.                                                  03810027
      ******************************************************************03820027
                                                                        03830027
            IF HM002-HIER-LVL = 'MCL'                                   03840027
               PERFORM C900-WRITE-EXTRACT                               03850027
            ELSE                                                        03860027
               ADD 1 TO PV-TOTAL-ERRORS                                 03870027
               DISPLAY 'MISSING MCL ROW'                                03880027
               DISPLAY 'DKEY   ' PV-DKEY                                03890027
               DISPLAY ' '                                              03900027
               MOVE 4 TO HM004-MSG-NBR                                  03910027
               PERFORM C950-WRITE-REPORT-REC                            03920027
               PERFORM C400-CHECK-SCL                                   03930027
            END-IF.                                                     03940027
                                                                        03950027
      ******************************************************************03960027
       C400-CHECK-SCL.                                                  03970027
      ******************************************************************03980027
                                                                        03990027
            IF HM002-HIER-LVL = 'SCL'                                   04000027
               PERFORM C900-WRITE-EXTRACT                               04010027
               PERFORM Z130-TMDSECL-CHECK                               04020027
               IF SQLCODE = +100                                        04030027
                  MOVE 8 TO HM004-MSG-NBR                               04040027
                  PERFORM C950-WRITE-REPORT-REC                         04050027
               END-IF                                                   04060027
            ELSE                                                        04070027
               ADD 1 TO PV-TOTAL-ERRORS                                 04080027
               DISPLAY 'MISSING SCL ROW'                                04090027
               DISPLAY 'DKEY   ' PV-DKEY                                04091027
               DISPLAY ' '                                              04092027
               MOVE 5 TO HM004-MSG-NBR                                  04093027
               PERFORM C950-WRITE-REPORT-REC                            04094027
            END-IF.                                                     04095027
                                                                        04096027
                                                                        04097027
      ******************************************************************04098027
       C450-CHECK-DPT-RLTD-TBLS.                                        04099027
      ******************************************************************04100027
                                                                        04110027
           PERFORM Z110-TMDSEDP-CHECK.                                  04120027
                                                                        04130027
           IF SQLCODE = 100                                             04140027
              ADD 1 TO PV-TOTAL-ERRORS                                  04150027
              MOVE 6 TO HM004-MSG-NBR                                   04151027
              PERFORM C950-WRITE-REPORT-REC.                            04152027
                                                                        04153027
           PERFORM Z120-TDPTSHK-CHECK.                                  04154027
                                                                        04155027
           IF SQLCODE = +100                                            04156027
              ADD 1 TO PV-TOTAL-ERRORS                                  04157027
              MOVE 7 TO HM004-MSG-NBR                                   04158027
              PERFORM C950-WRITE-REPORT-REC.                            04159027
                                                                        04160027
      ******************************************************************04170027
       C900-WRITE-EXTRACT.                                              04180027
      ******************************************************************04190027
                                                                        04200027
           MOVE PV-GMA-NBR TO HM002-GMA-NBR.                            04210027
           MOVE PV-DMA-NBR TO HM002-DMA-NBR.                            04220027
           MOVE PV-DEPT-NBR TO HM002-DEPT-NBR.                          04230027
           MOVE PV-MAJ-CL-NBR TO HM002-MAJ-CL-NBR.                      04240027
           MOVE PV-SUB-CL-NBR TO HM002-SUB-CL-NBR.                      04250027
           MOVE PV-DKEY TO HM002-DKEY.                                  04260027
                                                                        04270027
           WRITE MBS-EXTR-REC                                           04280027
               FROM HM002-MBS-RMS-INTG-REC.                             04290027
           ADD 1                       TO PA-OUTPUT-RECS-WRITTEN.       04300027
                                                                        04310027
       EJECT                                                            04320027
                                                                        04330027
      ******************************************************************04340027
       C950-WRITE-REPORT-REC.                                           04350027
      ******************************************************************04360027
                                                                        04370027
           MOVE 'MBS' TO HM004-SYSTEM.                                  04380027
           MOVE HM002-HIER-LVL TO HM004-HIER-LVL.                       04390027
           MOVE PV-GMA-NBR TO HM004-GMA-NBR.                            04400027
           MOVE PV-DMA-NBR TO HM004-DMA-NBR.                            04410027
           MOVE PV-DEPT-NBR TO HM004-DEPT-NBR.                          04420027
           MOVE PV-MAJ-CL-NBR TO HM004-MAJ-CL-NBR.                      04430027
           MOVE PV-SUB-CL-NBR TO HM004-SUB-CL-NBR.                      04440027
           MOVE PV-DKEY TO HM004-DKEY.                                  04450027
                                                                        04460027
           WRITE MBS-REPORT-REC                                         04470027
               FROM HM004-MBS-RMS-INTG-REC.                             04480027
                                                                        04490027
      ******************************************************************04500027
       B900-EOJ-ROUTINE.                                                04510027
      ******************************************************************04520027
                                                                        04530027
           DISPLAY ' '.                                                 04540027
           DISPLAY '  PROGRAM HMKUT002 PROCESSING SUMMARY'.             04550027
           DISPLAY '  -----------------------------------'.             04560027
           DISPLAY ' '.                                                 04570027
                                                                        04580027
           MOVE PA-EXTRT-RWS-FETCHED1 TO CD-COUNT-HOLD1.                04590027
           DISPLAY 'FIRST EXTRACT ROWS FETCHED  =    ' CD-COUNT-HOLD1.  04600027
                                                                        04610027
           MOVE PA-EXTRT-RWS-FETCHED2 TO CD-COUNT-HOLD1.                04620027
           DISPLAY 'SECOND EXTRACT ROWS FETCHED =    ' CD-COUNT-HOLD1.  04630027
                                                                        04640027
           DISPLAY 'TOTAL DATA INTEGRITY ISSUES =              '        04650027
                 PV-TOTAL-ERRORS.                                       04660027
           DISPLAY ' '.                                                 04670027
                                                                        04680027
           CLOSE MBS-EXTR-FILE                                          04690027
                 MBS-REPORT-FILE.                                       04700027
                                                                        04710027
       EJECT                                                            04720027
                                                                        04730027
      ******************************************************************04740027
       Z100-TRSPBAR-CHECK.                                              04750027
      ******************************************************************04760027
                                                                        04770027
           EXEC SQL                                                     04780027
               SELECT  MDSEAR_DKEY                                      04790027
               INTO   :RSPBAR-MDSEAR-DKEY                               04800027
               FROM   TRSPBAR                                           04810027
               WHERE  MDSEAR_DKEY = :PV-DKEY                            04820027
                 AND  RSPLVL_CDE =:PV-RSPLVL-CDE                        04830027
                 AND  (CURRENT DATE BETWEEN WORKER_STRT_DTE             04840027
                       AND WORKER_END_DTE)                              04850027
           END-EXEC.                                                    04860027
                                                                        04870027
           EVALUATE TRUE                                                04880027
               WHEN SQLCODE = ZERO                                      04890027
                     CONTINUE                                           04900027
               WHEN SQLCODE = -811                                      04910027
                     CONTINUE                                           04920027
               WHEN SQLCODE = +100                                      04930027
                     DISPLAY 'Z100-TRSPBAR-CHECK'                       04940027
                     DISPLAY 'NO MATCHING ROW ON TRSPBAR'               04950027
                     DISPLAY 'DKEY         '  PV-DKEY                   04960027
                     DISPLAY 'RSPLVL CDE   ' PV-RSPLVL-CDE              04970027
                     DISPLAY ' '                                        04980027
               WHEN SQLWARN0 NOT = SPACES                               04990027
               WHEN SQLCODE  NOT = ZERO                                 05000027
                   MOVE 'Z100-TRSPBAR-CHECK'                            05010027
                                      TO AA-PARAGRAPH-NAME              05020027
                   MOVE 'ERROR WHILE DOING TRSPBAR CHECK'               05030027
                                      TO  AA-MESSAGE                    05040027
                   MOVE 'SELECT FROM TRSPBAR'                           05050027
                                      TO  AA-DB2-OPERATION              05060027
                   PERFORM Z998-SQL-ERROR                               05070027
           END-EVALUATE.                                                05080027
                                                                        05090027
      ******************************************************************05100027
       Z110-TMDSEDP-CHECK.                                              05110027
      ******************************************************************05120027
                                                                        05130027
           EXEC SQL                                                     05140027
               SELECT  MDSEAR_DKEY                                      05150027
               INTO   :MDSEDP-MDSEAR-DKEY                               05160027
               FROM   TMDSEDP                                           05170027
               WHERE  MDSEAR_DKEY = :PV-DKEY                            05180027
           END-EXEC.                                                    05190027
                                                                        05200027
           EVALUATE TRUE                                                05210027
               WHEN SQLCODE = ZERO                                      05220027
                     CONTINUE                                           05230027
               WHEN SQLCODE = -811                                      05240027
                     CONTINUE                                           05250027
               WHEN SQLCODE = +100                                      05260027
                     DISPLAY 'Z110-TMDSEDP-CHECK'                       05270027
                     DISPLAY 'DPT ROW HAS NO MATCHING ROW ON TMDSEDP'   05280027
                     DISPLAY 'DKEY   '   PV-DKEY                        05290027
                     DISPLAY ' '                                        05300027
               WHEN SQLWARN0 NOT = SPACES                               05310027
               WHEN SQLCODE  NOT = ZERO                                 05320027
                   MOVE 'Z110-TMDSEDP-CHECK'                            05330027
                                      TO AA-PARAGRAPH-NAME              05340027
                   MOVE 'ERROR WHILE DOING TMDSEDP CHECK'               05350027
                                      TO  AA-MESSAGE                    05360027
                   MOVE 'SELECT FROM TMDSEDP'                           05370027
                                      TO  AA-DB2-OPERATION              05380027
                   PERFORM Z998-SQL-ERROR                               05390027
           END-EVALUATE.                                                05400027
                                                                        05410027
      ******************************************************************05420027
       Z120-TDPTSHK-CHECK.                                              05430027
      ******************************************************************05440027
                                                                        05450027
           EXEC SQL                                                     05460027
               SELECT  MDSEAR_DKEY                                      05470027
               INTO   :DPTSHK-MDSEAR-DKEY                               05480027
               FROM   TDPTSHK                                           05490027
               WHERE  MDSEAR_DKEY = :PV-DKEY                            05500027
           END-EXEC.                                                    05510027
                                                                        05520027
           EVALUATE TRUE                                                05530027
               WHEN SQLCODE = ZERO                                      05540027
                     CONTINUE                                           05550027
               WHEN SQLCODE = -811                                      05560027
                     CONTINUE                                           05570027
               WHEN SQLCODE = +100                                      05580027
                     DISPLAY 'Z120-TDPTSHK-CHECK'                       05590027
                     DISPLAY 'DPT ROW HAS NO MATCHING ROW ON TDPTSHK'   05600027
                     DISPLAY 'DKEY  ' PV-DKEY                           05610027
                     DISPLAY ' '                                        05620027
               WHEN SQLWARN0 NOT = SPACES                               05630027
               WHEN SQLCODE  NOT = ZERO                                 05640027
                   MOVE 'Z120-TDPTSHK-CHECK'                            05650027
                                      TO AA-PARAGRAPH-NAME              05660027
                   MOVE 'ERROR WHILE DOING TDPTSHK CHECK'               05670027
                                      TO  AA-MESSAGE                    05680027
                   MOVE 'SELECT FROM TDPTSHK'                           05690027
                                      TO  AA-DB2-OPERATION              05700027
                   PERFORM Z998-SQL-ERROR                               05710027
           END-EVALUATE.                                                05720027
                                                                        05730027
      ******************************************************************05740027
       Z130-TMDSECL-CHECK.                                              05750027
      ******************************************************************05760027
                                                                        05770027
           EXEC SQL                                                     05780027
               SELECT  MDSEAR_DKEY                                      05790027
               INTO   :MDSECL-MDSEAR-DKEY                               05800027
               FROM   TMDSECL                                           05810027
               WHERE  MDSEAR_DKEY = :PV-DKEY                            05820027
           END-EXEC.                                                    05830027
                                                                        05840027
           EVALUATE TRUE                                                05850027
               WHEN SQLCODE = ZERO                                      05860027
                     CONTINUE                                           05870027
               WHEN SQLCODE = -811                                      05880027
                     CONTINUE                                           05890027
               WHEN SQLCODE = +100                                      05900027
                     DISPLAY 'Z130-TMDSECL-CHECK'                       05910027
                     DISPLAY 'SCL ROW HAS NO MATCHING ROWS ON TMDSECL'  05920027
                     DISPLAY 'DKEY   ' PV-DKEY                          05930027
                     DISPLAY ' '                                        05940027
               WHEN SQLWARN0 NOT = SPACES                               05950027
               WHEN SQLCODE  NOT = ZERO                                 05960027
                   MOVE 'Z130-TMDSECL-CHECK'                            05970027
                                      TO AA-PARAGRAPH-NAME              05980027
                   MOVE 'ERROR WHILE DOING TMDSECL CHECK'               05990027
                                      TO  AA-MESSAGE                    06000027
                   MOVE 'SELECT FROM TMDSECL'                           06010027
                                      TO  AA-DB2-OPERATION              06020027
                   PERFORM Z998-SQL-ERROR                               06030027
           END-EVALUATE.                                                06040027
                                                                        06050027
      ******************************************************************06060027
       Z210-OPEN-CURSOR-EXTRACT.                                        06070027
      ******************************************************************06080027
                                                                        06090027
           EXEC SQL                                                     06100027
               OPEN EXTRACT_CURSOR                                      06110027
           END-EXEC.                                                    06120027
                                                                        06130027
           EVALUATE TRUE                                                06140027
               WHEN SQLCODE < 0                                         06150027
                   MOVE 'Z210-OPEN-CURSOR-EXTRACT'                      06160027
                                       TO AA-PARAGRAPH-NAME             06170027
                   MOVE 'EXTRACT ERROR'                                 06180027
                                       TO AA-MESSAGE                    06190027
                   MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              06200027
                   PERFORM Z998-SQL-ERROR                               06210027
               WHEN SQLCODE > 0                                         06220027
               WHEN SQLWARN0 NOT = SPACES                               06230027
                   MOVE 'Z210-OPEN-CURSOR-EXTRACT'                      06240027
                                       TO AA-PARAGRAPH-NAME             06250027
                   MOVE 'EXTRACT WARNING'                               06260027
                                       TO AA-MESSAGE                    06270027
                   MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              06280027
                   PERFORM Z998-SQL-ERROR                               06290027
           END-EVALUATE.                                                06300027
                                                                        06310027
       EJECT                                                            06320027
                                                                        06330027
      ******************************************************************06340027
       Z215-OPN-DPT-SCL-CSR.                                            06350027
      ******************************************************************06360027
                                                                        06370027
           EXEC SQL                                                     06380027
               OPEN DEPT_SCL_CURSOR                                     06390027
           END-EXEC.                                                    06400027
                                                                        06410027
           EVALUATE TRUE                                                06420027
               WHEN SQLCODE < 0                                         06430027
                   MOVE 'Z215-DPT-SCLR-CSR'                             06440027
                                       TO AA-PARAGRAPH-NAME             06450027
                   MOVE 'EXTRACT ERROR'                                 06460027
                                       TO AA-MESSAGE                    06470027
                   MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              06480027
                   PERFORM Z998-SQL-ERROR                               06490027
               WHEN SQLCODE = +0                                        06500027
                   CONTINUE                                             06510027
               WHEN ((SQLCODE > 0) AND (SQLCODE NOT = +100))            06520027
               WHEN SQLWARN0 NOT = SPACES                               06530027
                   MOVE 'Z215-OPN-DEPT-SCL-CSR'                         06540027
                                       TO AA-PARAGRAPH-NAME             06550027
                   MOVE 'EXTRACT WARNING'                               06560027
                                       TO AA-MESSAGE                    06570027
                   MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              06580027
                   PERFORM Z998-SQL-ERROR                               06590027
           END-EVALUATE.                                                06600027
                                                                        06610027
       EJECT                                                            06620027
                                                                        06630027
      ******************************************************************06640027
       Z220-FETCH-EXTRACT.                                              06650027
      ******************************************************************06660027
                                                                        06670027
           EXEC SQL                                                     06680027
               FETCH EXTRACT_CURSOR                                     06690027
                INTO :PV-GMA-NBR                                        06700027
                   ,:PV-DMA-NBR                                         06710027
                   ,:PV-DEPT-NBR                                        06720027
                   ,:PV-MAJ-CL-NBR                                      06730027
                   ,:PV-SUB-CL-NBR                                      06740027
                   ,:PV-DKEY                                            06750027
                   ,:HM002-HIER-LVL                                     06760027
           END-EXEC.                                                    06770027
                                                                        06780027
           EVALUATE TRUE                                                06790027
               WHEN SQLCODE = 0                                         06800027
                   ADD +1              TO PA-EXTRT-RWS-FETCHED1         06810027
               WHEN SQLCODE = +100                                      06820027
                   MOVE 'Y'            TO PS-EXTRACT-DONE               06830027
               WHEN SQLCODE < 0                                         06840027
                   MOVE 'Z220-FETCH-EXTRACT'                            06850027
                                       TO AA-PARAGRAPH-NAME             06860027
                   MOVE 'EXTRACT ERROR'                                 06870027
                                       TO AA-MESSAGE                    06880027
                   MOVE 'FETCH'        TO AA-DB2-OPERATION              06890027
                   PERFORM Z998-SQL-ERROR                               06900027
               WHEN ((SQLCODE > 0) AND (SQLCODE NOT = +100))            06910027
               WHEN SQLWARN0 NOT = SPACES                               06920027
                   MOVE 'Z220-FETCH-EXTRACT'                            06930027
                                       TO AA-PARAGRAPH-NAME             06940027
                   MOVE 'EXTRACT WARNING'                               06950027
                                       TO AA-MESSAGE                    06960027
                   MOVE 'FETCH'        TO AA-DB2-OPERATION              06970027
                   PERFORM Z998-SQL-ERROR                               06980027
           END-EVALUATE.                                                06990027
                                                                        07000027
       EJECT                                                            07010027
                                                                        07020027
      ******************************************************************07030027
       Z225-FETCH-DPT-SCL-CSR.                                          07040027
      ******************************************************************07050027
                                                                        07060027
           EXEC SQL                                                     07070027
               FETCH DEPT_SCL_CURSOR                                    07080027
                INTO :PV-GMA-NBR                                        07090027
                   ,:PV-DMA-NBR                                         07100027
                   ,:PV-DEPT-NBR                                        07110027
                   ,:PV-MAJ-CL-NBR                                      07120027
                   ,:PV-SUB-CL-NBR                                      07130027
                   ,:PV-DKEY                                            07140027
                   ,:HM002-HIER-LVL                                     07150027
           END-EXEC.                                                    07160027
                                                                        07170027
           EVALUATE TRUE                                                07180027
               WHEN SQLCODE = 0                                         07190027
                   ADD +1              TO PA-EXTRT-RWS-FETCHED2         07200027
               WHEN SQLCODE = +100                                      07210027
                   MOVE 'Y'            TO PS-EXTRACT2-DONE              07220027
               WHEN SQLCODE < 0                                         07230027
                   MOVE 'Z225-FETCH-DEPT-SCL-CSR'                       07240027
                                       TO AA-PARAGRAPH-NAME             07250027
                   MOVE 'EXTRACT ERROR'                                 07260027
                                       TO AA-MESSAGE                    07270027
                   MOVE 'FETCH'        TO AA-DB2-OPERATION              07280027
                   PERFORM Z998-SQL-ERROR                               07290027
               WHEN ((SQLCODE > 0) AND (SQLCODE NOT = +100))            07300027
               WHEN SQLWARN0 NOT = SPACES                               07310027
                   MOVE 'Z225-FETCH-DEPT-SCL-CSR'                       07320027
                                       TO AA-PARAGRAPH-NAME             07330027
                   MOVE 'EXTRACT WARNING'                               07340027
                                       TO AA-MESSAGE                    07350027
                   MOVE 'FETCH'        TO AA-DB2-OPERATION              07360027
                   PERFORM Z998-SQL-ERROR                               07370027
           END-EVALUATE.                                                07380027
                                                                        07390027
       EJECT                                                            07400027
                                                                        07410027
      ******************************************************************07420027
       Z230-CLOSE-CURSOR-EXTRACT.                                       07430027
      ******************************************************************07440027
                                                                        07450027
           EXEC SQL                                                     07460027
               CLOSE EXTRACT_CURSOR                                     07470027
           END-EXEC.                                                    07480027
                                                                        07490027
           EVALUATE TRUE                                                07500027
               WHEN SQLCODE < 0                                         07510027
                   MOVE 'Z230-CLOSE-CURSOR-EXTRACT'                     07520027
                                       TO AA-PARAGRAPH-NAME             07530027
                   MOVE 'EXTRACT ERROR'                                 07540027
                                       TO AA-MESSAGE                    07550027
                   MOVE 'CLOSE CURSOR' TO AA-DB2-OPERATION              07560027
                   PERFORM Z998-SQL-ERROR                               07570027
               WHEN SQLCODE > 0                                         07580027
               WHEN SQLWARN0 NOT = SPACES                               07590027
                   MOVE 'Z230-CLOSE-CURSOR-EXTRACT'                     07600027
                                       TO AA-PARAGRAPH-NAME             07610027
                   MOVE 'EXTRACT WARNING'                               07620027
                                       TO AA-MESSAGE                    07630027
                   MOVE 'CLOSE CURSOR' TO AA-DB2-OPERATION              07640027
                   PERFORM Z998-SQL-ERROR                               07650027
           END-EVALUATE.                                                07660027
                                                                        07670027
       EJECT                                                            07680027
                                                                        07690027
      ******************************************************************07700027
       Z235-CLSE-CRSR-DPT-SCL.                                          07710027
      ******************************************************************07720027
                                                                        07730027
           EXEC SQL                                                     07740027
               CLOSE DEPT_SCL_CURSOR                                    07750027
           END-EXEC.                                                    07760027
                                                                        07770027
           EVALUATE TRUE                                                07780027
               WHEN SQLCODE < 0                                         07790027
                   MOVE 'Z235-CLSE-CRSR-DEPT-SCL'                       07800027
                                       TO AA-PARAGRAPH-NAME             07810027
                   MOVE 'EXTRACT ERROR'                                 07820027
                                       TO AA-MESSAGE                    07830027
                   MOVE 'CLOSE CURSOR' TO AA-DB2-OPERATION              07840027
                   PERFORM Z998-SQL-ERROR                               07850027
               WHEN SQLCODE > 0                                         07860027
               WHEN SQLWARN0 NOT = SPACES                               07870027
                   MOVE 'Z235-CLSE-CRSR-DEPT-SCL'                       07880027
                                       TO AA-PARAGRAPH-NAME             07890027
                   MOVE 'EXTRACT WARNING'                               07900027
                                       TO AA-MESSAGE                    07910027
                   MOVE 'CLOSE CURSOR' TO AA-DB2-OPERATION              07920027
                   PERFORM Z998-SQL-ERROR                               07930027
           END-EVALUATE.                                                07940027
                                                                        07950027
       EJECT                                                            07960027
                                                                        07970027
                                                                        07980027
      ******************************************************************07990027
       Z998-SQL-ERROR.                                                  08000027
      ******************************************************************08010027
                                                                        08020027
                                                                        08030027
           CLOSE MBS-EXTR-FILE.                                         08040027
                                                                        08050027
           DISPLAY AA-ABEND-LIT.                                        08060027
           DISPLAY AA-DB2-ERROR-LIT.                                    08070027
           DISPLAY AA-PROGRAM-LIT.                                      08080027
           DISPLAY AA-PARAGRAPH-LIT.                                    08090027
           DISPLAY AA-MESSAGE-LINE.                                     08100027
           DISPLAY AA-DB2-OPERATION-LIT.                                08110027
           SET AC-DB2-ERROR TO TRUE.                                    08120027
           MOVE +4013                  TO ABEND-CODE.                   08130027
                                                                        08140027
           COPY DPPD004.                                                08150027
           CALL 'ILBOABN0' USING ABEND-CODE.                            08160027
                                                                        08170027
