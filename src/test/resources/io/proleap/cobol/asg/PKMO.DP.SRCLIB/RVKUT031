000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    RVKUT031.                                         00040000
000500 AUTHOR.        GERMAN BANDA.                                     00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   JANUARY 2008.                                     00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS PROGRAM WILL COMPARE THE  ITEM FILE FROM THE PREVIOUS     00100000
001100*  RUN (OLD ITEM FILE) TO THE CURRENT ITEM FILE.  THE PROGRAM     00110000
001200*  WILL WRITE OUT ADD/CHANGES AND WRITE NEW ITEM FILE IN THE      00120000
001300*  SAME LAYOUT (VLRD052)                                          00130000
001400***************************************************************** 00140000
001500 ENVIRONMENT DIVISION.                                            00150000
001600 INPUT-OUTPUT SECTION.                                            00160000
001700                                                                  00170000
001800 FILE-CONTROL.                                                    00180000
001900                                                                  00190000
002000     SELECT OLD-ITM-FILE                                          00200000
002010         ASSIGN TO INP01.                                         00201000
002100                                                                  00210000
002200     SELECT CURR-ITM-FILE                                         00220000
002201         ASSIGN TO INP02.                                         00220100
002202                                                                  00220200
002203     SELECT NEW-ITM-FILE                                          00220300
002204         ASSIGN TO OUT01.                                         00220400
002205                                                                  00220500
002206     SELECT RV-MARKER-FILE                                        00220600
002207         ASSIGN TO OUT02.                                         00220700
002208                                                                  00220800
002209***************************************************************** 00220900
002300 DATA DIVISION.                                                   00230000
002400***************************************************************** 00240000
002500 FILE SECTION.                                                    00250000
002600                                                                  00260000
002700 FD  OLD-ITM-FILE                                                 00270000
002800     RECORDING MODE IS F                                          00280000
002810     BLOCK CONTAINS 0 RECORDS                                     00281000
002900     LABEL RECORDS ARE STANDARD.                                  00290000
003000                                                                  00300000
003300 01  OLD-ITM-RECORD               PIC X(296).                     00330000
003700                                                                  00370000
003701 FD  CURR-ITM-FILE                                                00370100
003702     RECORDING MODE IS F                                          00370200
003703     BLOCK CONTAINS 0 RECORDS                                     00370300
003704     LABEL RECORDS ARE STANDARD.                                  00370400
003705                                                                  00370500
003706 01  CURR-ITM-RECORD              PIC X(296).                     00370600
003707                                                                  00370700
003800                                                                  00380000
003801 FD  NEW-ITM-FILE                                                 00380100
003802     RECORDING MODE IS F                                          00380200
003803     BLOCK CONTAINS 0 RECORDS                                     00380300
003804     LABEL RECORDS ARE STANDARD.                                  00380400
003805                                                                  00380500
003806 01  NEW-ITM-RECORD               PIC X(296).                     00380600
003807                                                                  00380700
003808 FD  RV-MARKER-FILE                                               00380800
003809     RECORDING MODE IS F                                          00380900
003810     LABEL RECORDS ARE STANDARD                                   00381000
003811     BLOCK CONTAINS 0 RECORDS.                                    00381100
003812 01  RV-MARKER-RECORD                   PIC  X(78).               00381200
003820                                                                  00382000
003900***************************************************************** 00390000
004000 WORKING-STORAGE SECTION.                                         00400000
004100                                                                  00410000
004110***************************************************************** 00411000
004120*    INPUT CONTROL CARD                                           00412000
004130***************************************************************** 00413000
004140 01  CC-CONTROL-CARD.                                             00414000
004150     05  CC-SCHEDULE-DATE.                                        00415000
004160         10  CC-CCYY                 PIC X(04).                   00416000
004170         10  CC-MM                   PIC X(02).                   00417000
004180         10  CC-DD                   PIC X(02).                   00418000
004190                                                                  00419000
004200 01  PS-PROGRAM-SWITCHES.                                         00420000
004300     05  PS-EOF-INPUT1-SW             PIC X(01)  VALUE 'N'.       00430000
004400         88  PS-EOF-INPUT1-YES                   VALUE 'Y'.       00440000
004500         88  PS-EOF-INPUT1-NO                    VALUE 'N'.       00450000
004501     05  PS-EOF-INPUT2-SW             PIC X(01)  VALUE 'N'.       00450100
004502         88  PS-EOF-INPUT2-YES                   VALUE 'Y'.       00450200
004503         88  PS-EOF-INPUT2-NO                    VALUE 'N'.       00450300
004504     05  PS-EMAIL-SW                  PIC X(01)  VALUE 'N'.       00450400
004505         88  PS-EMAIL-YES                        VALUE 'Y'.       00450500
004506         88  PS-EMAIL-NO                         VALUE 'N'.       00450600
004600                                                                  00460000
004700 01  PC-PROGRAM-CONSTANTS.                                        00470000
004800     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'RVKUT031'.00480000
005000                                                                  00500000
005100 01  PV-PROGRAM-VARIABLES.                                        00510000
005900     05  PV-RECORDS-READ-1            PIC  9(09) VALUE  0.        00590000
005910     05  PV-RECORDS-READ-2            PIC  9(09) VALUE  0.        00591000
006000     05  PV-RECORDS-WRITTEN           PIC  9(09) VALUE  0.        00600000
006100     05  PV-DELETE-RECORDS            PIC  9(09) VALUE  0.        00610000
006200     05  PV-ADD-RECORDS               PIC  9(09) VALUE  0.        00620000
006300     05  PV-CHANGE-RECORDS            PIC  9(09) VALUE  0.        00630000
006700     05  PV-MATCHING-ITEMS            PIC  9(9).                  00670000
006800     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00680000
006810     05  PV-HOLD-OLD-SKU              PIC  X(10).                 00681000
006820     05  PV-RUN-DATE-GENCO            PIC  X(08) VALUE SPACES.    00682000
006830     05  PV-RUN-TIME-GENCO            PIC  X(06) VALUE SPACES.    00683000
006840***** FILE NAME CONSISTS OF RUN-DATE-VNDAGRMT.DAT                 00684000
006850*****     EXAMPLE: 20061107_VNDAGRMT.DAT                          00685000
006860     05  PV-FILE-NAME.                                            00686000
006870         10  PV-CREATE-DATE           PIC  X(08) VALUE SPACES.    00687000
006880         10  PV-UNDERSCORE            PIC  X(01) VALUE '_'.       00688000
006890         10  PV-ITEM-DAT              PIC  X(12) VALUE SPACES.    00689000
006900                                                                  00690000
007000                                                                  00700000
007100 01  PV-ABEND-FIELDS.                                             00710000
007200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         00720000
007300                                                 COMP SYNC.       00730000
007400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'RVKUT031'.00740000
007500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00750000
007600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00760000
007700     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00770000
007900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00790000
008000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00800000
008100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00810000
008200                                                                  00820000
008300 01  PV-OLD-ITM-INPT.                                             00830000
008400     05  PV-OLD-ITM-INDICATOR         PIC  X(01).                 00840000
008500     05  PV-OLD-SKU-UPC-NBR           PIC  X(25).                 00850000
008610     05  PV-OLD-ITM-FILLER            PIC  X(270).                00861000
008800                                                                  00880000
008801 01  PV-NEW-ITM-INPT.                                             00880100
008802     05  PV-NEW-ITM-INDICATOR         PIC  X(01).                 00880200
008803     05  PV-NEW-SKU-UPC-NBR           PIC  X(25).                 00880300
008805     05  PV-NEW-ITM-FILLER            PIC  X(270).                00880500
008807                                                                  00880700
008808***  MARKER FILE LAYOUT                                           00880800
008809     COPY RVRD029.                                                00880900
008810                                                                  00881000
008820***  DATE ROUTINE COPYBOOK                                        00882002
008830     COPY DPWS500.                                                00883002
008840                                                                  00884002
010800***************************************************************** 01080000
010900 PROCEDURE DIVISION.                                              01090000
011000***************************************************************** 01100000
011100     DISPLAY '**** BEGINNING RVKUT031 ****'.                      01110000
011200     DISPLAY ' '.                                                 01120000
011300                                                                  01130000
011301     OPEN INPUT  OLD-ITM-FILE                                     01130100
011302                 CURR-ITM-FILE                                    01130200
011303          OUTPUT NEW-ITM-FILE                                     01130300
011304                 RV-MARKER-FILE.                                  01130400
011305                                                                  01130500
011310     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           01131000
011320                                                                  01132000
011330     DISPLAY 'CONTROL CARD ====>  ' CC-CONTROL-CARD.              01133000
011340                                                                  01134000
011350     PERFORM 1050-VALIDATE-CONTROL-CARD.                          01135000
011360                                                                  01136000
011370******* TIME IS CONTAINED CURRENT-DATE IN POSITION 9 FOR 8        01137000
011380     MOVE FUNCTION CURRENT-DATE(9:8) TO PV-RUN-TIME-GENCO.        01138000
011390                                                                  01139000
011391     DISPLAY '******  RUN TIME  => '  PV-RUN-TIME-GENCO.          01139100
011392                                                                  01139200
011603     PERFORM 1000-READ-OLD-ITM-INPT.                              01160300
011604     PERFORM 1100-READ-NEW-ITM-INPT.                              01160400
011700                                                                  01170000
012100     PERFORM 2000-PROCESS-INPUT-FILE                              01210000
012200       UNTIL PS-EOF-INPUT1-YES AND                                01220000
012210             PS-EOF-INPUT2-YES.                                   01221000
012300                                                                  01230000
012310     PERFORM 8500-CREATE-MARKER.                                  01231000
012320                                                                  01232000
012400     CLOSE OLD-ITM-FILE                                           01240000
012500           CURR-ITM-FILE                                          01250000
012501           RV-MARKER-FILE                                         01250100
012502           NEW-ITM-FILE.                                          01250200
012503                                                                  01250300
012600     DISPLAY '  INPUT OLD ITEM REC     = ' PV-RECORDS-READ-1.     01260000
012700     DISPLAY '  INPUT NEW ITEM REC     = ' PV-RECORDS-READ-2.     01270000
012800     DISPLAY ' '.                                                 01280000
012810     DISPLAY '  ADD RECORDS WRITTEN    = ' PV-ADD-RECORDS.        01281000
012820     DISPLAY '  DELETE RECORDS WRITTEN = ' PV-DELETE-RECORDS.     01282000
012830     DISPLAY '  CHANGE RECORDS WRITTEN = ' PV-CHANGE-RECORDS.     01283000
012840     DISPLAY '  OUTPUT RECORDS WRITTEN = ' PV-RECORDS-WRITTEN.    01284000
012900     DISPLAY '****  END OF  RVKUT031  ****'.                      01290000
013000                                                                  01300000
013302     GOBACK.                                                      01330200
013303                                                                  01330300
013304                                                                  01330400
013400***************************************************************** 01340000
013500*  READ A VSM SKU RECORD                                          01350000
013600***************************************************************** 01360000
013700 1000-READ-OLD-ITM-INPT.                                          01370000
013800                                                                  01380000
013900     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       01390000
014000                                                                  01400000
014001*    DISPLAY '1000-READ-INPUT-FILE        '                       01400100
014002                                                                  01400200
014010     INITIALIZE PV-OLD-ITM-INPT.                                  01401000
014020                                                                  01402000
014100     READ OLD-ITM-FILE                                            01410000
014200          INTO PV-OLD-ITM-INPT                                    01420000
014300            AT END                                                01430000
014400               SET PS-EOF-INPUT1-YES TO TRUE                      01440000
014900     END-READ.                                                    01490000
015000                                                                  01500000
015100     IF PS-EOF-INPUT1-YES                                         01510000
015200        CONTINUE                                                  01520000
015300     ELSE                                                         01530000
015400        ADD +1 TO PV-RECORDS-READ-1                               01540000
015401     END-IF.                                                      01540100
015402                                                                  01540200
015403******************************************************************01540300
015404**  VALIDATE THE DATE FROM THE SCHEDULE                           01540400
015405******************************************************************01540500
015406 1050-VALIDATE-CONTROL-CARD.                                      01540600
015407     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01540700
015408     SET DPG51-FISCAL-454-CALENDAR                                01540800
015409         DPG51-DO-NOT-INCR-DECR-DATE                              01540900
015410         DPG52-LK-DTE-ISO           TO TRUE.                      01541000
015411                                                                  01541100
015412     MOVE CC-SCHEDULE-DATE     TO DPG52-LK-DATE-INPUT.            01541200
015413                                                                  01541300
015414     CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      01541400
015415             DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 01541500
015416                                                                  01541600
015417     IF DPG54-NO-ERROR                                            01541700
015418         MOVE CC-SCHEDULE-DATE     TO PV-RUN-DATE-GENCO           01541800
015419     ELSE                                                         01541900
015420         DISPLAY '** ABEND **'                                    01542000
015421         DISPLAY '** PROGRAM = RVKUT031 -- CALLED MODULE '        01542100
015422                  'DPKUT500 **'                                   01542200
015423         DISPLAY '** PARAGRAPH = 1050-VALIDATE-CONTROL-CARD **'   01542300
015424         DISPLAY '** INVALID SCHEDULE DATE: ' CC-SCHEDULE-DATE    01542400
015425         DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '        01542500
015426         DISPLAY DPG54-ERROR-MESSAGE                              01542600
015427         MOVE +4003 TO PV-ABEND-CODE                              01542700
015428         CALL 'ILBOABN0' USING PV-ABEND-CODE                      01542800
015429     END-IF.                                                      01542900
015430                                                                  01543000
015431***************************************************************** 01543100
015432*  READ A LOGISTIC SKU RECORD                                     01543200
015433***************************************************************** 01543300
015434 1100-READ-NEW-ITM-INPT.                                          01543400
015435                                                                  01543500
015436     MOVE '1100-READ-NEW-ITM-INPT' TO PV-ABEND-PARAGRAPH.         01543600
015437                                                                  01543700
015438*    DISPLAY '1100-READ-NEW-ITM-INPT      '                       01543800
015439                                                                  01543900
015440     INITIALIZE PV-NEW-ITM-INPT.                                  01544000
015441                                                                  01544100
015442     READ CURR-ITM-FILE                                           01544200
015443          INTO PV-NEW-ITM-INPT                                    01544300
015444            AT END                                                01544400
015445               SET PS-EOF-INPUT2-YES TO TRUE                      01544500
015446     END-READ.                                                    01544600
015447                                                                  01544700
015448     IF PS-EOF-INPUT2-YES                                         01544800
015449        CONTINUE                                                  01544900
015450     ELSE                                                         01545000
015451        ADD +1 TO PV-RECORDS-READ-2                               01545100
015452     END-IF.                                                      01545200
015453                                                                  01545300
015454***************************************************************** 01545400
015455*  COMPARE THE OLD AND CURRENT FILES                              01545500
015460***************************************************************** 01546000
015500 2000-PROCESS-INPUT-FILE.                                         01550000
015600                                                                  01560000
015700     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       01570000
015710                                                                  01571000
015800*    DISPLAY '2000-PROCESS-INPUT-FILE     '                       01580000
015810                                                                  01581000
015900     IF PS-EOF-INPUT1-YES                                         01590000
015910** END OF OLD FILE -  WRITE NEW 'A' RECORD ADD?                   01591000
016000         AND PS-EOF-INPUT2-NO                                     01600000
016100           PERFORM 2100-WRITE-NEW-ITM-ADD                         01610000
016101           PERFORM 1100-READ-NEW-ITM-INPT                         01610800
016103     END-IF.                                                      01610200
016104                                                                  01610300
016105     IF PS-EOF-INPUT2-YES                                         01610400
016106       AND PS-EOF-INPUT1-NO                                       01610500
016107** END OF CURRENT FILE WRITE NEW RECORD 'D' RECORD DELETE?        01610600
016108* AGAIN, SKIP THE WRITING OF THE DELETE RECORD                            
016109*          PERFORM 2150-WRITE-NEW-ITM-DEL                         01610700
016110           PERFORM 1000-READ-OLD-ITM-INPT                         01610100
016112     END-IF.                                                      01610900
016113                                                                  01611000
016114     IF PS-EOF-INPUT1-NO                                          01611100
016115        AND PS-EOF-INPUT2-NO                                      01611200
016116           PERFORM 2001-PROCESS-INPUT-FILE                        01611300
016117     END-IF.                                                      01611400
016118                                                                  01611500
016119***************************************************************** 01611600
016120 2001-PROCESS-INPUT-FILE.                                         01611700
016121                                                                  01611800
016122     MOVE '2001-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       01611900
016123                                                                  01612000
016124*    DISPLAY '2001-PROCESS-INPUT-FILE     '                       01612100
016125*    DISPLAY 'OLD ITEM SKU  ' PV-OLD-ITM-SKU-NBR                  01612200
016126*    DISPLAY 'NEW ITEM SKU  ' PV-NEW-ITM-SKU-NBR                  01612300
016127                                                                  01612400
016130     IF PV-OLD-SKU-UPC-NBR < PV-NEW-SKU-UPC-NBR                   01613000
016150***DEL OLD ITEM                                                   01615000
016160*  SKIP THE WRITTING OF THE DELETE RECORD BECAUSE GENCO DOESN'T   01615103
016161*  DELETE SKUS OR UPCS                                            01615203
016162*          PERFORM 2150-WRITE-NEW-ITM-DEL                         01616003
016170           PERFORM 1000-READ-OLD-ITM-INPT                         01617000
016180     ELSE                                                         01618000
016181       IF PV-OLD-SKU-UPC-NBR = PV-NEW-SKU-UPC-NBR                 01618100
016182****WRITE CHANGE RECORD                                           01618200
016300           IF PV-OLD-ITM-INPT  = PV-NEW-ITM-INPT                  01630000
016800              PERFORM 1000-READ-OLD-ITM-INPT                      01680000
016900              PERFORM 1100-READ-NEW-ITM-INPT                      01690000
017000           ELSE                                                   01700000
017010              PERFORM 2160-WRITE-NEW-ITM-CHG                      01701000
017020              PERFORM 1000-READ-OLD-ITM-INPT                      01702000
017030              PERFORM 1100-READ-NEW-ITM-INPT                      01703000
017100           END-IF                                                 01710000
019102       ELSE                                                       01910200
019103         IF PV-OLD-SKU-UPC-NBR > PV-NEW-SKU-UPC-NBR               01910300
019113            PERFORM 2100-WRITE-NEW-ITM-ADD                        01911300
019114            PERFORM 1100-READ-NEW-ITM-INPT                        01911400
019120         END-IF                                                   01912000
019121       END-IF                                                     01912100
019130     END-IF.                                                      01913000
019200                                                                  01920000
021600***************************************************************** 02160000
021700*  WRITE ITEM RECORD -  ADD                                       02170000
021800***************************************************************** 02180000
021900 2100-WRITE-NEW-ITM-ADD.                                          02190000
022000                                                                  02200000
022010*    DISPLAY '2100-WRITE-NEW-ITM-ADD      '                       02201000
022020                                                                  02202000
022100     WRITE NEW-ITM-RECORD FROM                                    02210000
022200         PV-NEW-ITM-INPT                                          02220000
039400     END-WRITE.                                                   03940000
039401     ADD +1                 TO PV-RECORDS-WRITTEN                 03940100
039402                               PV-ADD-RECORDS.                    03940200
039406***************************************************************** 03940600
039407*  WRITE ITEM RECORD -  DELETE                                    03940700
039409***************************************************************** 03940900
039410 2150-WRITE-NEW-ITM-DEL.                                          03941000
039411     MOVE 'D'  TO       PV-OLD-ITM-INDICATOR.                     03941100
039412*    DISPLAY '2150-WRITE-NEW-ITM-DEL      '                       03941200
039413                                                                  03941300
039420     WRITE NEW-ITM-RECORD FROM                                    03942000
039421         PV-OLD-ITM-INPT                                          03942100
039422     END-WRITE.                                                   03942200
039423     ADD +1                 TO PV-RECORDS-WRITTEN                 03942300
039424                               PV-DELETE-RECORDS.                 03942400
039425***************************************************************** 03942500
039426*  WRITE ITEM RECORD -  CHANGE                                    03942600
039427***************************************************************** 03942700
039428 2160-WRITE-NEW-ITM-CHG.                                          03942800
039429     MOVE 'C'  TO       PV-NEW-ITM-INDICATOR.                     03942900
039430                                                                  03943000
039431*    DISPLAY '2160-WRITE-NEW-ITM-CHG      '                       03943100
039432                                                                  03943200
039433     WRITE NEW-ITM-RECORD FROM                                    03943300
039434         PV-NEW-ITM-INPT                                          03943400
039435     END-WRITE.                                                   03943500
039436     ADD +1                 TO PV-RECORDS-WRITTEN                 03943600
039437                               PV-CHANGE-RECORDS.                 03943700
039440                                                                  03944000
039450***************************************************************** 03945000
039460*  CREATE MARKER FILE                                             03946000
039470***************************************************************** 03947000
039480 8500-CREATE-MARKER.                                              03948000
039490     MOVE PV-RUN-DATE-GENCO TO PV-CREATE-DATE.                    03949000
039500     MOVE 'ITEM.DAT'        TO PV-ITEM-DAT.                       03950000
039600     MOVE PV-FILE-NAME    TO RV029-FILE-NAME.                     03960000
039700     MOVE PV-RECORDS-WRITTEN TO RV029-RECORD-COUNT.               03970000
039800     MOVE PV-RUN-DATE-GENCO  TO RV029-BUILD-DATE.                 03980000
039900     MOVE PV-RUN-TIME-GENCO  TO RV029-BUILD-TIME.                 03990000
040000     MOVE 'X'             TO RV029-ANCHOR-CONSTANT.               04000000
040100                                                                  04010000
040200     WRITE RV-MARKER-RECORD FROM RV029-MARKER-RECORD.             04020000
040300                                                                  04030000
