00001 *                                                                 02/05/92
00002 *                                                                 MBKCS101
00003 *                                                                    LV059
00004  IDENTIFICATION DIVISION.                                         MBKCS101
00005                                                                   MBKCS101
00006  PROGRAM-ID.    MBKCS101.                                            CL119
00007  AUTHOR.        BOB LOOS - STRATAGEM.                                CL*28
00008  INSTALLATION.  KOHLS DEPARTMENT STORES.                          MBKCS101
00009  DATE-WRITTEN.  06-12-91.                                            CL*28
00010  DATE-COMPILED.                                                   MBKCS101
00011                                                                   MBKCS101
00012 ***************************************************************** MBKCS101
00013 *    M101 - MERCHANDISE AREA - SELECTION CRITERIA                    CL122
00014 *                                                                    CL**3
00015 *    THIS PROGRAM ALLOWS THE USER TO CHOOSE THE TYPE OF              CL*23
00016 *    CRITERIA THAT HE OR SHE WANTS TO USE TO GENERATE THE MERCH-     CL*30
00017 *    ANDISE AREA LIST. THE CRITERIA IS SELECTED BY ENTERING          CL*30
00018 *    THE APPROPRIATE VALUES ON THE MERCHANDISE AREA FILTER           CL**8
00019 ***************************************************************** MBKCS101
262978* CHANGED 10/21/2021    BY JIM HUNTER      WR: CHG0262978                 
262978* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
262978* MAKING THE CALL DYNAMIC VS STATIC.                                      
262978******************************************************************        
00020                                                                   MBKCS101
00021 *                                                                 MBKCS101
00022 *                                                                 MBKCS101
00023 *                                                                 MBKCS101
00024  ENVIRONMENT DIVISION.                                            MBKCS101
00025 *                                                                 MBKCS101
00026 *                                                                 MBKCS101
00027 *                                                                 MBKCS101
00028  DATA DIVISION.                                                   MBKCS101
00029 *                                                                 MBKCS101
00030 *                                                                 MBKCS101
00031  WORKING-STORAGE SECTION.                                         MBKCS101
00032                                                                      CL**5
00033  01  PC-PROGRAM-CONSTANTS.                                           CL**5
00034      05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.MBKCS101
00035      05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072  MBKCS101
00036                                                      COMP SYNC.   MBKCS101
00037      05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE        MBKCS101
00038      'MB101A  '.                                                     CL119
00039      05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE        MBKCS101
00040      'MBKM101 '.                                                     CL119
00041      05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE        MBKCS101
00042      'MBKCS101'.                                                     CL119
00043      05  PC-MBLMERCH                    PIC X(08)    VALUE           CL*30
00044      'MBLMERCH'.                                                     CL*30
00045      05  PC-MAX-RETRIES                 PIC S9(04)   VALUE +3        CL181
00046                                                      COMP SYNC.      CL*34
00047      05  PC-MERCH-ADD-MNEMONIC          PIC X(08)                    CL*32
00048                                             VALUE 'MBAMDSEA'.        CL*32
00049      05  PC-HISTORY-DEFAULT             PIC X(01)    VALUE 'N'.      CL233
00050      05  PC-ZERO-VALUE                  PIC X(01)    VALUE '0'.      CL*66
00051      05  PC-OPER-COMPANY                PIC X(02)    VALUE '03'.     CL*66
00052      05  PC-TSYMSG-NUMBERS.                                          CL102
00053          10 PC-TSYMSG-00005             PIC 9(05)    VALUE 00005.    CL102
00054          10 PC-TSYMSG-00007             PIC 9(05)    VALUE 00007.    CL221
00055          10 PC-TSYMSG-00010             PIC 9(05)    VALUE 00010.    CL155
00056          10 PC-TSYMSG-00030             PIC 9(05)    VALUE 00030.    CL109
00057          10 PC-TSYMSG-00032             PIC 9(05)    VALUE 00032.    CL109
00058          10 PC-TSYMSG-00045             PIC 9(05)    VALUE 00045.    CL104
00059          10 PC-TSYMSG-00062             PIC 9(05)    VALUE 00062.    CL124
00060          10 PC-TSYMSG-00076             PIC 9(05)    VALUE 00076.    CL104
00061          10 PC-TSYMSG-00077             PIC 9(05)    VALUE 00077.    CL104
00062          10 PC-TSYMSG-00078             PIC 9(05)    VALUE 00078.    CL104
00063          10 PC-TSYMSG-00079             PIC 9(05)    VALUE 00079.    CL104
00064          10 PC-TSYMSG-00080             PIC 9(05)    VALUE 00080.    CL104
00065          10 PC-TSYMSG-00081             PIC 9(05)    VALUE 00081.    CL105
00066          10 PC-TSYMSG-00082             PIC 9(05)    VALUE 00082.    CL112
00067          10 PC-TSYMSG-00137             PIC 9(05)    VALUE 00137.    CL255
00068          10 PC-TSYMSG-00138             PIC 9(05)    VALUE 00138.    CL255
00069  01  PK-PRIMARY-KEYS.                                                CL184
00070      05  PK-MDSELV-GMA-CODE             PIC X(03)    VALUE 'GMA'.    CL184
00071      05  PK-MDSELV-DMA-CODE             PIC X(03)    VALUE 'DMA'.    CL184
00072      05  PK-MDSELV-DPT-CODE             PIC X(03)    VALUE 'DPT'.    CL184
00073      05  PK-MDSELV-MCL-CODE             PIC X(03)    VALUE 'MCL'.    CL184
00074      05  PK-MDSELV-SCL-CODE             PIC X(03)    VALUE 'SCL'.    CL184
00075      05  PK-END-DTE                     PIC X(10)    VALUE SPACES.   CL234
00076                                                                      CL102
00077  01  PM-PROGRAM-MESSAGES.                                         MBKCS101
00078      05  PM-PROGRAM-MESSAGE-1           PIC X(78)    VALUE           CL**3
00079      'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                   CL**3
00080                                                                      CL**5
00081  01  PS-PROGRAM-SWITCHES.                                         MBKCS101
00082      05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.   MBKCS101
00083          88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.   MBKCS101
00084          88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.   MBKCS101
00085          88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.   MBKCS101
00086          88  PS-SEND-DATA-ONLY                       VALUE '4'.   MBKCS101
00087          88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.   MBKCS101
00088          88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.   MBKCS101
00089      05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.   MBKCS101
00090          88  PS-ERROR                                VALUE 'Y'.   MBKCS101
00091          88  PS-NO-ERROR                             VALUE 'N'.   MBKCS101
00092      05  PS-SPECIF-GMA-SW               PIC X(01)    VALUE 'N'.      CL110
00093          88  PS-SPECIF-GMA                           VALUE 'Y'.      CL110
00094          88  PS-NO-SPECIF-GMA                        VALUE 'N'.      CL110
00095      05  PS-SPECIF-DMA-SW               PIC X(01)    VALUE 'N'.      CL110
00096          88  PS-SPECIF-DMA                           VALUE 'Y'.      CL110
00097          88  PS-NO-SPECIF-DMA                        VALUE 'N'.      CL110
00098      05  PS-SPECIF-DPT-SW               PIC X(01)    VALUE 'N'.      CL110
00099          88  PS-SPECIF-DPT                           VALUE 'Y'.      CL110
00100          88  PS-NO-SPECIF-DPT                        VALUE 'N'.      CL110
00101      05  PS-SPECIF-MCL-SW               PIC X(01)    VALUE 'N'.      CL110
00102          88  PS-SPECIF-MCL                           VALUE 'Y'.      CL110
00103          88  PS-NO-SPECIF-MCL                        VALUE 'N'.      CL110
00104      05  PS-SPECIF-SCL-SW               PIC X(01)    VALUE 'N'.      CL110
00105          88  PS-SPECIF-SCL                           VALUE 'Y'.      CL110
00106          88  PS-NO-SPECIF-SCL                        VALUE 'N'.      CL110
00107      05  PS-NEED-ROW-SW                 PIC X(01)    VALUE 'N'.      CL221
00108          88  PS-NEED-ROW                             VALUE 'Y'.      CL202
00109          88  PS-NO-ROW-NEEDED                        VALUE 'N'.      CL202
00110      05  PS-ROW-SW                      PIC X(01)    VALUE 'N'.      CL182
00111          88  PS-ROW-NOT-FOUND                        VALUE 'Y'.      CL182
00112          88  PS-ROW-FOUND                            VALUE 'N'.      CL182
00113                                                                   MBKCS101
00114  01  PV-PROGRAM-VARIABLES.                                        MBKCS101
00115      05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0     MBKCS101
00116                                                      COMP SYNC.   MBKCS101
00117      05  PV-RETRY-COUNTER               PIC S9(04)   VALUE +0        CL181
00118                                                      COMP SYNC.      CL181
00119  EJECT                                                            MBKCS101
00120 ***************************************************************** MBKCS101
00121 *    STANDARD COMMAREA.                                           MBKCS101
00122 ***************************************************************** MBKCS101
00123                                                                   MBKCS101
00124      COPY DPWS020.                                                   CL171
00125      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                MBKCS101
00126                                                                   MBKCS101
00127 ***************************************************************** MBKCS101
00128 *    INTER-APPLICATION COMMAREA.                                  MBKCS101
00129 ***************************************************************** MBKCS101
00130                                                                   MBKCS101
00131          10  INTER-APPL-COMM-AREA       PIC X(200).               MBKCS101
00132                                                                      CL*32
00133      COPY MBWS005.                                                   CL*59
00134                                                                   MBKCS101
00135 ***************************************************************** MBKCS101
00136 *    SPECIFIC COMMMAREA FOR MBKCS101.                                CL119
00137 ***************************************************************** MBKCS101
00138                                                                   MBKCS101
00139      COPY MBWS001.                                                   CL*59
00140                                                                   MBKCS101
00141 ***************************************************************** MBKCS101
00142 *    ABEND PROCESSING COPYBOOK.                                   MBKCS101
00143 ***************************************************************** MBKCS101
00144                                                                   MBKCS101
00145      COPY DPWS013.                                                   CL232
00146                                                                   MBKCS101
00147 ***************************************************************** MBKCS101
00148 *    ATTRIBUTE SETTINGS COPYBOOK.                                 MBKCS101
00149 ***************************************************************** MBKCS101
00150                                                                   MBKCS101
00151      COPY DPWS015.                                                MBKCS101
00152                                                                   MBKCS101
00153 ***************************************************************** MBKCS101
00154 *    CURRENT DATE AND TIME COPYBOOK.                              MBKCS101
00155 ***************************************************************** MBKCS101
00156                                                                   MBKCS101
00157      COPY DPWS017.                                                   CL*14
00158                                                                   MBKCS101
00159 ***************************************************************** MBKCS101
00160 *    TOGGLE FUNCTION KEY LINES COPYBOOK.                          MBKCS101
00161 ***************************************************************** MBKCS101
00162                                                                   MBKCS101
00163      COPY DPWS009.                                                   CL*14
                                                                        MBKCS101
      *****************************************************************         
      *    SYSTEM MESSAGE FIELDS                                                
      *****************************************************************         
                                                                                
           COPY DPWS006.                                                        
                                                                                
00165 ***************************************************************** MBKCS101
00166 *    FUNCTION KEYS COPYBOOK.                                      MBKCS101
00167 ***************************************************************** MBKCS101
00168                                                                   MBKCS101
00169      COPY DPWS016.                                                   CL*14
00170                                                                   MBKCS101
00171 *****************************************************************    CL172
00172 *    NUMERIC DATE EDIT ROUTINE WORKING STORAGE                       CL172
00173 *****************************************************************    CL172
00174                                                                      CL172
00175      COPY DPWS010I.                                                  CL172
00176                                                                      CL172
00177 ***************************************************************** MBKCS101
00178 *    DPKUT045 COPYBOOK.                                           MBKCS101
00179 ***************************************************************** MBKCS101
00180                                                                   MBKCS101
00181      COPY DPWS045.                                                   CL*14
00182                                                                      CL*75
00183      COPY DPRD507I.                                                  CL*76
00184  EJECT                                                               CL*50
00185 *****************************************************************    CL214
00186 *    DB2 COMMUNICATION AREA                                          CL214
00187 *****************************************************************    CL214
00188                                                                      CL214
00189      EXEC SQL                                                        CL214
00190          INCLUDE SQLCA                                               CL214
00191      END-EXEC.                                                       CL214
00192 *****************************************************************    CL214
00193 *    MERCHANDISE AREA TABLE                                          CL214
00194 *****************************************************************    CL214
00195                                                                      CL214
00196      EXEC SQL                                                        CL214
00197          INCLUDE TMDSEAR                                             CL214
00198      END-EXEC.                                                       CL214
00199                                                                   MBKCS101
00200 *****************************************************************    CL**1
00201 *    CURSOR FOR SUBCLASS LEVEL PROCESSING                            CL**1
00202 *****************************************************************    CL**1
00203      EXEC SQL                                                        CL**1
00204          DECLARE SUB_CURSOR CURSOR FOR                               CL**1
00205              SELECT GMA_NBR,                                         CL**1
00206                     DMA_NBR,                                         CL**1
00207                     DEPT_NBR,                                        CL**1
00208                     MAJ_CL_NBR,                                      CL**1
00209                     SUB_CL_NBR                                       CL**1
00210              FROM TMDSEAR                                            CL**1
00211              WHERE ((DEPT_NBR = :MB001-DEPT-NUMBER-X)     AND        CL**1
00212                     (MAJ_CL_NBR = :MB001-MCLASS-NUMBER-X) AND        CL**1
00213                     (SUB_CL_NBR = :MB001-SCLASS-NUMBER-X) AND        CL**1
00214                     (END_DTE    > :PK-END-DTE))                      CL**1
00215      END-EXEC.                                                       CL*27
00216 *****************************************************************    CL**1
00217 *    CURSOR FOR MAJOR CLASS LEVEL PROCESSING                         CL**1
00218 *****************************************************************    CL**1
00219      EXEC SQL                                                        CL**1
00220          DECLARE MAJ_CURSOR CURSOR FOR                               CL**1
00221              SELECT GMA_NBR,                                         CL**1
00222                     DMA_NBR,                                         CL**1
00223                     DEPT_NBR,                                        CL**1
00224                     MAJ_CL_NBR                                       CL**1
00225              FROM TMDSEAR                                            CL**1
00226              WHERE ((DEPT_NBR = :MB001-DEPT-NUMBER-X)     AND        CL**1
00227                     (MAJ_CL_NBR = :MB001-MCLASS-NUMBER-X) AND        CL**1
00228                     (MDSELV_CDE = :PK-MDSELV-MCL-CODE)    AND        CL**1
00229                     (END_DTE    > :PK-END-DTE))                      CL**1
00230      END-EXEC.                                                       CL*27
00231 *****************************************************************    CL**2
00232 *    CURSOR FOR DEPARTMENT LEVEL PROCESSING                          CL**2
00233 *****************************************************************    CL**2
00234      EXEC SQL                                                        CL**2
00235         DECLARE DEPT_CURSOR CURSOR FOR                               CL**2
00236              SELECT GMA_NBR,                                         CL**2
00237                     DMA_NBR,                                         CL**2
00238                     DEPT_NBR                                         CL**2
00239              FROM TMDSEAR                                            CL**2
00240              WHERE ((DEPT_NBR = :MB001-DEPT-NUMBER-X)  AND           CL**2
00241                     (MDSELV_CDE = :PK-MDSELV-DPT-CODE) AND           CL**2
00242                     (END_DTE    > :PK-END-DTE))                      CL**2
00243      END-EXEC.                                                       CL**2
00244 *****************************************************************    CL**2
00245 *    CURSOR FOR DMA LEVEL PROCESSING                                 CL**2
00246 *****************************************************************    CL**2
00247      EXEC SQL                                                        CL**2
00248         DECLARE DMA_CURSOR CURSOR FOR                                CL**2
00249              SELECT GMA_NBR,                                         CL**2
00250                     DMA_NBR                                          CL**2
00251              FROM TMDSEAR                                            CL**2
00252              WHERE ((DMA_NBR = :MB001-DMA-NUMBER-X)    AND           CL**2
00253                     (MDSELV_CDE = :PK-MDSELV-DMA-CODE) AND           CL**2
00254                     (END_DTE    > :PK-END-DTE))                      CL**2
00255      END-EXEC.                                                       CL*27
00256 *****************************************************************    CL**2
00257 *    CURSOR FOR GMA LEVEL PROCESSING                                 CL**2
00258 *****************************************************************    CL**2
00259      EXEC SQL                                                        CL**2
00260         DECLARE GMA_CURSOR CURSOR FOR                                CL**2
00261              SELECT GMA_NBR                                          CL**2
00262              FROM TMDSEAR                                            CL**2
00263              WHERE ((GMA_NBR = :MB001-GMA-NUMBER-X)    AND           CL**2
00264                     (MDSELV_CDE = :PK-MDSELV-GMA-CODE) AND           CL**2
00265                     (END_DTE    > :PK-END-DTE))                      CL**2
00266      END-EXEC.                                                       CL*27
00267 ***************************************************************** MBKCS101
00268 *    STANDARD ATTENTION IDENTIFIER LIST                           MBKCS101
00269 ***************************************************************** MBKCS101
00270                                                                   MBKCS101
00271      COPY DFHAID.                                                 MBKCS101
00272                                                                   MBKCS101
00273 ***************************************************************** MBKCS101
00274 *    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST        MBKCS101
00275 ***************************************************************** MBKCS101
00276                                                                   MBKCS101
00277      COPY DFHBMSCA.                                               MBKCS101
00278                                                                   MBKCS101
00279 ***************************************************************** MBKCS101
00280 *    MAP LAYOUT                                                   MBKCS101
00281 ***************************************************************** MBKCS101
00282                                                                   MBKCS101
00283      COPY MBKM101.                                                   CL123
00284                                                                      CL**6
00285  01  MD-MAP-DATA-AREA REDEFINES MB101AO.                             CL119
00286      05  FILLER                         PIC X(439).                  CL229
00287  EJECT                                                            MBKCS101
00288  LINKAGE SECTION.                                                 MBKCS101
00289                                                                   MBKCS101
00290  01  DFHCOMMAREA.                                                    CL*27
00291      05  FILLER                         OCCURS  1 TO 4072 TIMES      CL*27
00292                                         DEPENDING ON EIBCALEN.       CL*27
00293          10  FILLER                     PIC X.                       CL*27
00294                                                                      CL*27
00295 *                                                                 MBKCS101
00296 *                                                                 MBKCS101
00297 *                                                                 MBKCS101
00298  PROCEDURE DIVISION.                                              MBKCS101
00299                                                                   MBKCS101
00300  0000-MAIN-MODULE.                                                   CL**8
00301                                                                   MBKCS101
00302 ******************************************************************MBKCS101
00303 *    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.           MBKCS101
00304 ******************************************************************MBKCS101
00305                                                                   MBKCS101
00306      PERFORM DP015-0000-CHECK-COMMAREA.                           MBKCS101
00307                                                                   MBKCS101
00308 ******************************************************************   CL**8
00309 *    DP020-SRC-RETURN-W-TRAN-ID WILL BE TRUE IF THIS PROGRAM WAS     CL**8
00310 *    SENT A STANDARD COMMAREA. IF NOT SET TRUE (MEANING OTHER        CL**8
00311 *    THAN A STANDARD COMMAREA WAS SENT TO THIS PROGRAM, THIS         CL**8
00312 *    PROGRAM WILL RETURN TO CISS.                                    CL**8
00313 ******************************************************************   CL**8
00314      IF DP020-SRC-RETURN-W-TRAN-ID                                MBKCS101
00315          PERFORM 1000-CONTROL-PROCESSING                             CL*11
00316      END-IF.                                                      MBKCS101
00317                                                                   MBKCS101
00318      PERFORM DP003-0000-RETURN-TO-CICS.                           MBKCS101
00319  EJECT                                                            MBKCS101
00320  1000-CONTROL-PROCESSING.                                            CL**8
00321                                                                   MBKCS101
00322 ******************************************************************MBKCS101
00323 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT    MBKCS101
00324 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                    MBKCS101
00325 *                                                                 MBKCS101
00326 *    PERFORMED BY 0000-MAIN-MODULE.                                  CL**8
00327 ******************************************************************MBKCS101
00328                                                                      CL**3
00329      EVALUATE TRUE                                                MBKCS101
00330                                                                   MBKCS101
00331          WHEN DP020-NEXT-ACT-INITIAL                              MBKCS101
00332              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                    CL**3
00333                                                                   MBKCS101
00334              PERFORM 1100-INITIALIZE-COMMAREA                        CL**8
00335              PERFORM 5100-SAVE-INITIAL-INTERAPPL                     CL*41
00336              PERFORM 2000-BUILD-INITIAL-PANEL                        CL*37
00337                                                                   MBKCS101
00338          WHEN DP020-NEXT-ACT-READ-MAP                             MBKCS101
00339              PERFORM 3000-PROCESS-PANEL                              CL*10
00340                                                                      CL**3
00341          WHEN DP020-NEXT-ACT-RETURN                                  CL**3
00342              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                    CL**3
00343              PERFORM 4000-DISPLAY-PANEL                              CL*20
00344                                                                      CL**3
00345          WHEN DP020-NEXT-ACT-ERROR                                MBKCS101
00346                                                                      CL*21
00347              IF DP020-NAV-MNEMONIC = SPACES                          CL*15
00348                  MOVE SPACES              TO ANAVCMDO                CL*34
00349                  MOVE DP015-GREEN         TO ANAVCMDC                CL*34
00350                  MOVE DP015-UNDERLINE     TO ANAVCMDH                CL*34
00351              ELSE                                                    CL*15
00352                  MOVE DP015-RED           TO ANAVCMDC                CL*34
00353                  MOVE DP015-REVERSE       TO ANAVCMDH                CL*34
00354              END-IF                                                  CL*16
00355                                                                      CL*21
00356              MOVE LOW-VALUES TO DP020-INTER-APPL-DATA-AREA           CL*31
00357              SET PS-ERROR                 TO TRUE                    CL*38
00358              SET PS-SEND-DATA-ONLY-FRSET  TO TRUE                    CL*38
00359                                                                      CL*38
00360              MOVE -1                      TO ANAVCMDL                CL**4
00361              PERFORM 4000-DISPLAY-PANEL                              CL*20
00362                                                                      CL**4
00363          WHEN OTHER                                               MBKCS101
00364              SET DP013-LOGIC-ABEND        TO TRUE                    CL*34
00365              SET DP013-NO-ROLLBACK        TO TRUE                    CL*34
00366                                                                   MBKCS101
00367              MOVE 'B100-CONTROL-PROCESSING' TO                    MBKCS101
00368                   DP013-PARAGRAPH                                 MBKCS101
00369                                                                      CL**4
00370              MOVE PM-PROGRAM-MESSAGE-1      TO                       CL**3
00371                   DP013-MESSAGE-TEXT(1)                           MBKCS101
00372                                                                   MBKCS101
00373              PERFORM DP013-0000-PROCESS-ABEND                     MBKCS101
00374                                                                   MBKCS101
00375      END-EVALUATE.                                                MBKCS101
00376  EJECT                                                            MBKCS101
00377  1100-INITIALIZE-COMMAREA.                                           CL*20
00378                                                                      CL*20
00379 ******************************************************************   CL*20
00380 *    INITIALIZE THE INTER APPLICATION COMMAREA AND THE               CL*20
00381 *    APPLICATION SPECIFIC COMMAREA.                                  CL*20
00382 *                                                                    CL*20
00383 *    PERFORMED BY 1000-CONTROL-PROCESSING.                           CL*20
00384 *    PERFORMED BY 3100-CHECK-LOACA-FKEYS.                            CL138
00385 ******************************************************************   CL*20
00386                                                                      CL*20
00387      MOVE LOW-VALUES            TO DP020-INTER-APPL-DATA-AREA.       CL*57
00388      MOVE PC-OPER-COMPANY       TO MB001-CO-NUMBER-X.                CL*66
00389      MOVE SPACES                TO MB001-GMA-NUMBER-X                CL*57
00390                                    MB001-DMA-NUMBER-X                CL*57
00391                                    MB001-DEPT-NUMBER-X               CL*57
00392                                    MB001-MCLASS-NUMBER-X             CL*57
00393                                    MB001-SCLASS-NUMBER-X             CL230
00394                                    MB001-HIST-FLAG.                  CL230
00395                                                                      CL*20
00396  EJECT                                                               CL*20
00397  2000-BUILD-INITIAL-PANEL.                                           CL*37
00398                                                                   MBKCS101
00399 ******************************************************************MBKCS101
00400 *    PERFORMED ON THE FIRST PASS IF THIS PROGRAM                     CL*38
00401 *                                                                 MBKCS101
00402 *    PERFORMED BY 1000-CONTROL-PROCESSING.                           CL138
00403 *    PERFORMED BY 3100-CHECK-LOCAL-FKEYS.                            CL138
00404 ******************************************************************MBKCS101
00405                                                                      CL230
00406      MOVE PC-HISTORY-DEFAULT TO AHISTO                               CL238
00407                                 MB001-HIST-FLAG.                     CL238
00408                                                                      CL*38
00409      PERFORM 4000-DISPLAY-PANEL.                                     CL*38
00410  EJECT                                                               CL*37
00411                                                                      CL196
00412                                                                      CL196
00413  3000-PROCESS-PANEL.                                                 CL*37
00414                                                                      CL*37
00415 ******************************************************************   CL*37
00416 *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED     CL*37
00417 *    ON WHAT FUNCTION KEY WAS SELECTED.                              CL*37
00418 *                                                                    CL*37
00419 *    PERFORMED BY 1000-CONTROL-PROCESSING.                           CL138
00420 ******************************************************************   CL*37
00421                                                                      CL*37
00422      SET PS-SEND-DATA-ONLY-FRSET TO TRUE                          MBKCS101
00423                                                                   MBKCS101
00424      PERFORM DP007-0000-GET-PANEL.                                   CL**5
00425                                                                      CL**5
00426      IF (DP020-SRC-AID NOT = DP016-PF5)  AND                         CL**5
00427         (DP020-SRC-AID NOT = DP016-CLEAR)                            CL**5
00428          PERFORM 3200-MOVE-SCREEN-TO-COMMAREA                        CL*10
00429      END-IF.                                                         CL**5
00430                                                                      CL**5
00431      PERFORM 3100-CHECK-LOCAL-FKEYS.                                 CL*10
00432  EJECT                                                            MBKCS101
00433                                                                      CL196
00434  3100-CHECK-LOCAL-FKEYS.                                             CL*20
00435                                                                      CL*10
00436 ******************************************************************   CL*10
00437 *    PERFORM THE APPROPRIATE PARAGRAPH BASED ON WHICH FUNCTION       CL*10
00438 *    KEY THE USER HIT.                                               CL*10
00439 *                                                                    CL*10
00440 *    PERFORMED BY 3000-PROCESS-PANEL.                                CL*10
00441 ******************************************************************   CL*10
00442                                                                      CL*10
00443      EVALUATE TRUE                                                   CL*10
00444                                                                      CL*10
00445          WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID) OR                  CL*98
00446               DP020-FK-RETURN(DP020-SRC-AID)                         CL*99
00447               PERFORM 5000-SETUP-INTER-APPL                          CL*60
00448               PERFORM DP015-1000-START-NAVIGATOR                     CL*60
00449                                                                      CL*60
00450          WHEN  DP020-FK-EDIT-GOTO(DP020-SRC-AID)                     CL*98
00451                PERFORM 3300-EDIT-DATA-IN-COMMAREA                    CL*92
00452                IF PS-NO-ERROR                                        CL223
00453                   PERFORM 3175-EDIT-AND-GOTO-PROCESS                 CL*35
00454                END-IF                                                CL223
00455                IF PS-NO-ERROR                                        CL210
00456                   PERFORM 5000-SETUP-INTER-APPL                      CL210
00457                   PERFORM DP015-1000-START-NAVIGATOR                 CL210
00458                ELSE                                                  CL210
00459                   PERFORM 4100-MOVE-COMMAREA-TO-SCREEN               CL210
00460                   PERFORM 4000-DISPLAY-PANEL                         CL210
00461                END-IF                                                CL210
00462                                                                      CL199
00463                                                                      CL*32
00464          WHEN DP020-FK-REFRESH(DP020-SRC-AID)                        CL*32
00465              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                    CL*35
00466              INITIALIZE ANAVCMDO ANAVKEYO                            CL154
00467              PERFORM 1100-INITIALIZE-COMMAREA                        CL*32
00468              MOVE SPACES TO DP020-NAV-KEY-DATA                       CL142
00469              PERFORM 2000-BUILD-INITIAL-PANEL                        CL*58
00470                                                                      CL*32
00471          WHEN DP020-SRC-AID = DP016-ENTER                            CL*10
00472              IF (DP020-NAV-MNEMONIC = SPACES)     OR                 CL*10
00473                 (DP020-NAV-MNEMONIC = LOW-VALUES)                    CL*10
00474                  PERFORM 3300-EDIT-DATA-IN-COMMAREA                  CL*81
00475                  PERFORM 4100-MOVE-COMMAREA-TO-SCREEN                CL*83
00476                  PERFORM 4000-DISPLAY-PANEL                          CL*52
00477              ELSE                                                    CL*10
00478                  MOVE LOW-VALUES TO DP020-INTER-APPL-DATA-AREA       CL*55
00479                  PERFORM DP015-1000-START-NAVIGATOR                  CL125
00480              END-IF                                                  CL*10
00481                                                                      CL196
00482                                                                      CL198
00483                                                                      CL*10
00484          WHEN DP020-SRC-AID = DP016-PA2                              CL*33
00485              SET PS-SEND-DATA-ONLY TO TRUE                           CL*33
00486              MOVE -1               TO ANAVCMDL                       CL*33
00487              PERFORM DP017-0000-GET-CURR-DATE-TIME                   CL*79
00488              PERFORM DP009-0000-LOAD-FK-LINES                        CL*79
00489              PERFORM DP008-0000-WRITE-PANEL                          CL*79
00490                                                                      CL*33
00491          WHEN DP020-SRC-AID = DP016-CLEAR                            CL*33
00492              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                    CL*35
00493              PERFORM 3300-EDIT-DATA-IN-COMMAREA                      CL*33
00494              PERFORM 4000-DISPLAY-PANEL                              CL*33
00495                                                                      CL*33
00496          WHEN OTHER                                                  CL*33
00497              PERFORM 3300-EDIT-DATA-IN-COMMAREA                      CL*37
00498              MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER                CL102
00499              SET DP020-MSG-FATAL TO TRUE                             CL*37
00500              PERFORM 4000-DISPLAY-PANEL                              CL*37
00501                                                                      CL*10
00502      END-EVALUATE.                                                   CL*10
00503  EJECT                                                               CL*10
00504  3175-EDIT-AND-GOTO-PROCESS.                                         CL*35
00505 ******************************************************************   CL*35
00506 *                                                                    CL*35
00507 *                                                                    CL*35
00508 ******************************************************************   CL*35
00509      EVALUATE TRUE                                                   CL*35
00510                                                                      CL*37
00511          WHEN DP020-SRC-AID = DP016-PF14                             CL*38
00512          WHEN DP020-SRC-AID = DP016-PF15                             CL*35
00513             PERFORM 3385-INQ-UPD-EDITS                               CL*35
00514                                                                      CL*36
00515      END-EVALUATE.                                                   CL*35
00516                                                                      CL173
00517  3150-INIT-ATTRIBUTE-BYTE.                                           CL172
00518 ******************************************************************   CL173
00519 *    INITIALIZE THE ENTERABLE FIELDS TO GREEN                        CL173
00520 *                                                                    CL173
00521 ******************************************************************   CL173
00522      MOVE DP015-GREEN     TO AGMAC                                   CL172
00523                              ADMAC                                   CL172
00524                              ADEPTC                                  CL172
00525                              AMCLASSC                                CL172
00526                              ASCLASSC                                CL241
00527                              AHISTC.                                 CL241
00528                                                                      CL172
00529      MOVE DP015-UNDERLINE TO AGMAH                                   CL172
00530                              ADMAH                                   CL172
00531                              ADEPTH                                  CL172
00532                              AMCLASSH                                CL172
00533                              ASCLASSH                                CL241
00534                              AHISTH.                                 CL241
00535  EJECT                                                               CL172
00536                                                                      CL173
00537  3200-MOVE-SCREEN-TO-COMMAREA.                                       CL*20
00538                                                                   MBKCS101
00539 ******************************************************************MBKCS101
00540 *    MOVE THE FIELDS FROM THE MAP TO THE COMMAREA IF ANYTHING        CL*20
00541 *    WAS ENTERED IN THAT FIELD.                                      CL*20
00542 *                                                                    CL*20
00543 *    PERFORMED BY 3000-PROCESS-PANEL.                                CL*11
00544 ******************************************************************MBKCS101
00545                                                                   MBKCS101
00546      IF AGMAL > 0                                                    CL*33
00547         MOVE AGMAI                  TO MB001-GMA-NUMBER-X            CL*30
00548      ELSE                                                            CL**5
00549         IF AGMAF = DP015-ERASE-EOF                                   CL232
00550            MOVE SPACES              TO MB001-GMA-NUMBER-X            CL*30
00551         END-IF                                                       CL*30
00552      END-IF.                                                         CL**5
00553                                                                      CL*33
00554      IF ADMAL > 0                                                    CL*33
00555         MOVE ADMAI                  TO MB001-DMA-NUMBER-X            CL*30
00556      ELSE                                                            CL*33
00557         IF ADMAF = DP015-ERASE-EOF                                   CL232
00558            MOVE SPACES              TO MB001-DMA-NUMBER-X            CL*30
00559         END-IF                                                       CL102
00560      END-IF.                                                         CL*33
00561                                                                      CL*33
00562      IF ADEPTL > 0                                                   CL*33
00563         MOVE ADEPTI                  TO MB001-DEPT-NUMBER-X          CL*30
00564      ELSE                                                            CL*30
00565         IF ADEPTF = DP015-ERASE-EOF                                  CL232
00566            MOVE SPACES               TO MB001-DEPT-NUMBER-X          CL*30
00567         END-IF                                                       CL*30
00568      END-IF.                                                         CL*33
00569                                                                      CL*33
00570      IF AMCLASSL > 0                                                 CL*33
00571         MOVE AMCLASSI                TO MB001-MCLASS-NUMBER-X        CL*30
00572      ELSE                                                            CL*30
00573         IF AMCLASSF = DP015-ERASE-EOF                                CL232
00574            MOVE SPACES               TO MB001-MCLASS-NUMBER-X        CL*30
00575         END-IF                                                       CL*30
00576      END-IF.                                                         CL*33
00577                                                                      CL*33
00578      IF ASCLASSL > 0                                                 CL*33
00579         MOVE ASCLASSI                TO MB001-SCLASS-NUMBER-X        CL*30
00580      ELSE                                                            CL*30
00581         IF ASCLASSF = DP015-ERASE-EOF                                CL232
00582            MOVE SPACES               TO MB001-SCLASS-NUMBER-X        CL*30
00583         END-IF                                                       CL*30
00584                                                                      CL*33
00585      END-IF.                                                         CL*33
00586                                                                      CL*33
00587      IF AHISTL   > 0                                                 CL230
00588         MOVE AHISTI                  TO MB001-HIST-FLAG              CL230
00589      ELSE                                                            CL230
00590         IF AHISTF   = DP015-ERASE-EOF                                CL232
00591            MOVE SPACES               TO MB001-HIST-FLAG              CL230
00592         END-IF                                                       CL230
00593                                                                      CL230
00594      END-IF.                                                         CL230
00595  EJECT                                                            MBKCS101
00596  3300-EDIT-DATA-IN-COMMAREA.                                         CL*10
00597                                                                      CL**5
00598 ******************************************************************   CL**5
00599 *    EDIT THE GMA, DMA, DEPARTMENT, MAJOR CLASS AND SUBCLASS.        CL*38
00600 *    IN ORDER TO BE VALID, ANY AND OR ALL OF THE ABOVE MUST          CL**3
00601 *    CONTAIN NUMERIC VALUES, AN '*', OR BE SPACES.                   CL*38
00602 *                                                                    CL*20
00603 *    PERFORMED BY 1000-CONTROL-PROCESSING.                           CL*10
00604 *    PERFORMED BY 3000-PROCESS-PANEL.                                CL*10
00605 *    PERFORMED BY 3100-CHECK-LOCAL-FKEYS.                            CL*10
00606 ******************************************************************   CL**5
00607                                                                      CL**5
00608      IF NOT DP020-NEXT-ACT-ERROR                                     CL*59
00609         SET PS-NO-ERROR TO TRUE                                      CL*62
00610         MOVE DP015-GREEN     TO ANAVCMDC                             CL151
00611                                 ANAVKEYC                             CL152
00612         MOVE DP015-UNDERLINE TO ANAVCMDH                             CL151
00613                                 ANAVKEYH                             CL152
00614      END-IF.                                                         CL*59
00615                                                                      CL*26
00616      PERFORM 3150-INIT-ATTRIBUTE-BYTE.                               CL231
00617                                                                      CL231
00618      IF NOT MB001-HIST-VALID-VALUES                                  CL231
00619          MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER                CL231
00620          MOVE DP015-RED           TO AHISTC                          CL231
00621          MOVE DP015-REVERSE       TO AHISTH                          CL231
00622          MOVE -1                  TO AHISTL                          CL231
00623          SET DP020-MSG-FATAL      TO TRUE                            CL231
00624          SET PS-ERROR             TO TRUE                            CL231
00625      END-IF.                                                         CL231
00626                                                                      CL231
00627                                                                      CL*59
00628      PERFORM 3400-GENERAL-EDIT-GMA.                                  CL178
00629                                                                      CL*38
00630      PERFORM 3410-GENERAL-EDIT-DMA.                                  CL178
00631                                                                      CL178
00632      PERFORM 3420-GENERAL-EDIT-DPT.                                  CL178
00633                                                                      CL178
00634      PERFORM 3430-GENERAL-EDIT-MCL.                                  CL178
00635                                                                      CL178
00636      PERFORM 3440-GENERAL-EDIT-SCL.                                  CL178
00637                                                                      CL180
00638      PERFORM 3600-EDIT-FOR-SPACES.                                   CL180
00639                                                                      CL230
00640      PERFORM 3610-EDIT-GMA-VALUE.                                    CL*58
00641                                                                      CL180
00642                                                                      CL178
00643                                                                      CL142
00644  EJECT                                                               CL**5
00645                                                                      CL196
00646  3350-VALIDATE-SCREEN-DATA.                                          CL196
00647                                                                      CL196
00648 ******************************************************************   CL196
00649 *    THIS ROUTINE IS CALLED WHEN A USER PRESSES A PFKEY :            CL196
00650 *    FOR LIST FUNCTION,                                              CL196
00651 *    FOR ADD  FUNCTION,                                              CL196
00652 *    FOR INQ  FUNCTION,                                              CL196
00653 *    FOR UPD  FUNCTION                                               CL196
00654 *    THIS ROUTINE WILL VALIDATE THE ENTRIES ON THE SCREEN            CL196
00655 *    AGAINST THE DB2 MERCHANDISE AREA TABLE.                         CL196
00656 ******************************************************************   CL196
00657                                                                      CL196
00658      IF (PS-SPECIF-SCL)                                              CL213
00659          PERFORM 3500-VALIDATE-SCL                                   CL196
00660      ELSE                                                            CL196
00661          IF (PS-SPECIF-MCL)                                          CL213
00662              PERFORM 3510-VALIDATE-MCL                               CL196
00663          ELSE                                                        CL196
00664              IF (PS-SPECIF-DPT)                                      CL213
00665                  PERFORM 3520-VALIDATE-DPT                           CL196
00666              ELSE                                                    CL196
00667                  IF (PS-SPECIF-DMA)                                  CL213
00668                      PERFORM 3530-VALIDATE-DMA                       CL196
00669                  ELSE                                                CL196
00670                      IF (PS-SPECIF-GMA)                              CL213
00671                          PERFORM 3540-VALIDATE-GMA                   CL196
00672                      END-IF                                          CL196
00673                  END-IF                                              CL196
00674              END-IF                                                  CL196
00675          END-IF                                                      CL196
00676      END-IF.                                                         CL196
00677                                                                      CL253
00678  3360-CHECK-FOR-ALL-FIELDS.                                          CL253
00679 ******************************************************************   CL253
00680 *    THIS PARAGRAPH PERFORMS VALIDATIONS FOR THE UPDATE FUNCTION     CL253
00681 *    ONLY.                                                           CL253
00682 *    1) VERIFY THAT NO '*' ARE IN ANY FIELDS.                        CL253
00683 ******************************************************************   CL253
00684                                                                      CL253
00685      IF MB001-ALL-SCLASSES                                           CL253
00686         MOVE DP015-RED                  TO ASCLASSC                  CL253
00687         MOVE DP015-REVERSE              TO ASCLASSH                  CL253
00688         MOVE PC-TSYMSG-00137 TO DP020-MSG-NUMBER                     CL254
00689         MOVE -1                          TO ASCLASSL                 CL253
00690         SET DP020-MSG-FATAL              TO TRUE                     CL253
00691         SET PS-ERROR                     TO TRUE                     CL253
00692      END-IF.                                                         CL253
00693                                                                      CL253
00694      IF MB001-ALL-MCLASSES                                           CL253
00695          MOVE DP015-RED                 TO AMCLASSC                  CL253
00696          MOVE DP015-REVERSE             TO AMCLASSH                  CL253
00697          MOVE PC-TSYMSG-00137 TO DP020-MSG-NUMBER                    CL254
00698          MOVE -1                         TO AMCLASSL                 CL253
00699          SET DP020-MSG-FATAL             TO TRUE                     CL253
00700          SET PS-ERROR                    TO TRUE                     CL253
00701      END-IF.                                                         CL253
00702                                                                      CL253
00703      IF MB001-ALL-DEPARTMENTS                                        CL253
00704          MOVE DP015-RED          TO ADEPTC                           CL253
00705          MOVE DP015-REVERSE      TO ADEPTH                           CL253
00706          MOVE PC-TSYMSG-00137 TO DP020-MSG-NUMBER                    CL254
00707          MOVE -1                  TO ADEPTL                          CL253
00708          SET DP020-MSG-FATAL      TO TRUE                            CL253
00709          SET PS-ERROR             TO TRUE                            CL253
00710      END-IF.                                                         CL253
00711                                                                      CL253
00712      IF MB001-ALL-DMAS                                               CL253
00713          MOVE DP015-RED      TO ADMAC                                CL253
00714          MOVE DP015-REVERSE  TO ADMAH                                CL253
00715          MOVE PC-TSYMSG-00137 TO DP020-MSG-NUMBER                    CL254
00716          MOVE -1              TO ADMAL                               CL253
00717          SET DP020-MSG-FATAL  TO TRUE                                CL253
00718          SET PS-ERROR         TO TRUE                                CL253
00719      END-IF.                                                         CL253
00720                                                                      CL253
00721      IF MB001-ALL-GMAS                                               CL253
00722          MOVE DP015-RED   TO AGMAC                                   CL253
00723          MOVE DP015-REVERSE TO AGMAH                                 CL253
00724          MOVE PC-TSYMSG-00137 TO DP020-MSG-NUMBER                    CL254
00725          MOVE -1           TO AGMAL                                  CL253
00726          SET DP020-MSG-FATAL TO TRUE                                 CL253
00727          SET PS-ERROR      TO TRUE                                   CL253
00728      END-IF.                                                         CL253
00729                                                                      CL200
00730                                                                      CL253
00731  3385-INQ-UPD-EDITS.                                                 CL253
00732                                                                      CL253
00733 ******************************************************************   CL253
00734 *    THIS PARAGRAPH PERFORMS VALIDATIONS FOR THE INQUIRY AND         CL253
00735 *    UPDATE FUNCTIONS.                                               CL253
00736 *    1) VERIFY THAT NO '*' ARE IN ANY FIELDS.                        CL253
00737 *    2) VERIFY THAT LEVEL SPECIFIED EXISTS.                          CL253
00738 ******************************************************************   CL253
00739                                                                      CL233
00740                                                                      CL253
00741      IF NOT (MB001-NO-DISPLAY-HIST)                                  CL253
00742         MOVE DP015-RED          TO AHISTC                            CL253
00743         MOVE DP015-REVERSE      TO AHISTH                            CL253
00744         MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER                  CL253
00745         MOVE -1                 TO AHISTL                            CL253
00746         SET DP020-MSG-FATAL                                          CL253
00747             PS-ERROR            TO TRUE                              CL253
00748      END-IF.                                                         CL253
00749                                                                      CL253
00750      PERFORM 3360-CHECK-FOR-ALL-FIELDS.                              CL253
00751                                                                      CL253
00752                                                                      CL253
00753      IF PS-NO-ERROR                                                  CL253
00754                                                                      CL*30
00755          PERFORM DP017-0000-GET-CURR-DATE-TIME                       CL*30
00756          SET DP017-EDITED-YMD-DATE-DASH-1                            CL*30
00757              DP017-EDITED-YMD-DATE-DASH-2 TO TRUE                    CL*30
00758          MOVE DP017-EDITED-DATE-YYYYMMDD TO PK-END-DTE               CL*30
00759                                                                      CL*30
00760          PERFORM 3350-VALIDATE-SCREEN-DATA                           CL*30
00761                                                                      CL*30
00762      END-IF.                                                         CL253
00763                                                                      CL233
00764                                                                      CL234
00765  3400-GENERAL-EDIT-GMA.                                              CL178
00766 ******************************************************************   CL178
00767 *    EDIT THE GMA FOR SPACES, ASTERISKS, AND NUMERIC FIELDS.         CL178
00768 *    FOR NUMERIC ONLY AS OF 12/17/91.                                CL*57
00769 *                                                                    CL*57
00770 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL178
00771 ******************************************************************   CL178
00772                                                                      CL178
00773 *    IF MB001-GMA-NUMBER-X = SPACES                                  CL*57
00774 *       CONTINUE                                                     CL*57
00775 *    ELSE                                                            CL*57
00776         IF MB001-ALL-GMAS                                            CL*58
00777            MOVE '**'                  TO MB001-GMA-NUMBER-X          CL*58
00778         ELSE                                                         CL*58
00779             MOVE MB001-GMA-NUMBER-X    TO DP010I-UNEDITED-FIELD      CL178
00780             MOVE +2                    TO DP010I-MAXIMUM-DIGITS      CL178
00781             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  CL178
262978            CALL DP010I-NUMERIC-EDIT-ROUTINE                              
262978                 USING DP010I-NUMERIC-EDIT-AREA                           
00783             IF DP010I-ERROR-DETECTED                                 CL178
00784                 MOVE DP015-RED          TO AGMAC                     CL178
00785                 MOVE DP015-REVERSE      TO AGMAH                     CL178
00786                 IF PS-NO-ERROR                                       CL178
00787                     MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         CL178
00788                     MOVE -1              TO AGMAL                    CL178
00789                     SET DP020-MSG-FATAL  TO TRUE                     CL178
00790                     SET PS-ERROR         TO TRUE                     CL178
00791                 END-IF                                               CL178
00792             ELSE                                                     CL178
00793                 MOVE DP010I-NUMERIC-FIELD TO MB001-GMA-NUMBER        CL178
00794                 SET PS-SPECIF-GMA       TO TRUE                      CL178
00795                 IF MB001-GMA-NUMBER-X = '00'                         CL178
00796                    MOVE DP015-RED          TO AGMAC                  CL178
00797                    MOVE DP015-REVERSE      TO AGMAH                  CL178
00798                    IF PS-NO-ERROR                                    CL178
00799                       MOVE PC-TSYMSG-00010 TO DP020-MSG-NUMBER       CL178
00800                       MOVE -1              TO AGMAL                  CL178
00801                       SET DP020-MSG-FATAL  TO TRUE                   CL178
00802                       SET PS-ERROR         TO TRUE                   CL178
00803                    END-IF                                            CL178
00804                 END-IF                                               CL178
00805             END-IF                                                   CL*58
00806         END-IF.                                                      CL*58
00807 *    END-IF.                                                         CL*57
00808  EJECT                                                               CL*40
00809                                                                      CL178
00810  3410-GENERAL-EDIT-DMA.                                              CL178
00811 ******************************************************************   CL178
00812 *    EDIT THE DMA FOR SPACES, ASTERISKS, AND NUMERIC FIELDS.         CL178
00813 *                                                                    CL178
00814 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL178
00815 ******************************************************************   CL178
00816                                                                      CL178
00817      IF MB001-DMA-NUMBER-X = SPACES                                  CL178
00818         CONTINUE                                                     CL178
00819      ELSE                                                            CL178
00820         IF MB001-ALL-DMAS                                            CL178
00821            MOVE '**'                      TO MB001-DMA-NUMBER-X      CL178
00822         ELSE                                                         CL178
00823            MOVE MB001-DMA-NUMBER-X        TO DP010I-UNEDITED-FIELD   CL178
00824            MOVE +2                    TO DP010I-MAXIMUM-DIGITS       CL178
00825            SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                   CL178
262978           CALL DP010I-NUMERIC-EDIT-ROUTINE                               
262978                USING DP010I-NUMERIC-EDIT-AREA                            
00827            IF DP010I-ERROR-DETECTED                                  CL178
00828               MOVE DP015-RED                  TO ADMAC               CL178
00829               MOVE DP015-REVERSE              TO ADMAH               CL178
00830               IF PS-NO-ERROR                                         CL178
00831                  MOVE PC-TSYMSG-00005         TO DP020-MSG-NUMBER    CL178
00832                  MOVE -1                      TO ADMAL               CL178
00833                  SET DP020-MSG-FATAL          TO TRUE                CL178
00834                  SET PS-ERROR                 TO TRUE                CL178
00835               END-IF                                                 CL178
00836            ELSE                                                      CL178
00837                MOVE DP010I-NUMERIC-FIELD  TO MB001-DMA-NUMBER        CL178
00838                SET PS-SPECIF-DMA               TO TRUE               CL178
00839                IF MB001-DMA-NUMBER-X = '00'                          CL178
00840                   MOVE DP015-RED           TO ADMAC                  CL178
00841                   MOVE DP015-REVERSE       TO ADMAH                  CL178
00842                   IF PS-NO-ERROR                                     CL178
00843                      MOVE PC-TSYMSG-00010  TO DP020-MSG-NUMBER       CL178
00844                      MOVE -1               TO ADMAL                  CL178
00845                      SET DP020-MSG-FATAL   TO TRUE                   CL178
00846                      SET PS-ERROR          TO TRUE                   CL178
00847                   END-IF                                             CL178
00848                END-IF                                                CL178
00849            END-IF                                                    CL178
00850         END-IF                                                       CL178
00851      END-IF.                                                         CL178
00852      EJECT                                                           CL178
00853                                                                      CL178
00854  3420-GENERAL-EDIT-DPT.                                              CL178
00855 ******************************************************************   CL178
00856 *    EDIT THE DPT FOR SPACES, ASTERISKS, AND NUMERIC FIELDS.         CL178
00857 *                                                                    CL178
00858 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL178
00859 ******************************************************************   CL178
00860                                                                      CL178
00861      IF MB001-DEPT-NUMBER-X = SPACES                                 CL178
00862         CONTINUE                                                     CL178
00863      ELSE                                                            CL178
00864         IF MB001-ALL-DEPARTMENTS                                     CL178
00865            MOVE '***'                 TO MB001-DEPT-NUMBER-X         CL178
00866         ELSE                                                         CL178
00867            MOVE MB001-DEPT-NUMBER-X   TO DP010I-UNEDITED-FIELD       CL178
00868            MOVE +3                    TO DP010I-MAXIMUM-DIGITS       CL178
00869            SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                   CL178
262978           CALL DP010I-NUMERIC-EDIT-ROUTINE                               
262978                USING DP010I-NUMERIC-EDIT-AREA                            
00871            IF DP010I-ERROR-DETECTED                                  CL178
00872               MOVE DP015-RED             TO ADEPTC                   CL178
00873               MOVE DP015-REVERSE         TO ADEPTH                   CL178
00874               IF PS-NO-ERROR                                         CL178
00875                  MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER         CL178
00876                  MOVE -1                 TO ADEPTL                   CL178
00877                  SET DP020-MSG-FATAL     TO TRUE                     CL178
00878                  SET PS-ERROR            TO TRUE                     CL178
00879               END-IF                                                 CL178
00880            ELSE                                                      CL178
00881               MOVE DP010I-NUMERIC-FIELD  TO MB001-DEPT-NUMBER        CL178
00882               SET PS-SPECIF-DPT          TO TRUE                     CL178
00883               IF MB001-DEPT-NUMBER-X = '000'                         CL178
00884                  MOVE DP015-RED          TO ADEPTC                   CL178
00885                  MOVE DP015-REVERSE      TO ADEPTH                   CL178
00886                  IF PS-NO-ERROR                                      CL178
00887                     MOVE PC-TSYMSG-00010 TO DP020-MSG-NUMBER         CL178
00888                     MOVE -1              TO ADEPTL                   CL178
00889                     SET DP020-MSG-FATAL  TO TRUE                     CL178
00890                     SET PS-ERROR         TO TRUE                     CL178
00891                  END-IF                                              CL178
00892               END-IF                                                 CL178
00893            END-IF                                                    CL178
00894         END-IF                                                       CL178
00895      END-IF.                                                         CL178
00896      EJECT                                                           CL178
00897                                                                      CL178
00898  3430-GENERAL-EDIT-MCL.                                              CL178
00899 ******************************************************************   CL178
00900 *    EDIT THE MCL FOR SPACES, ASTERISKS, AND NUMERIC FIELDS.         CL178
00901 *                                                                    CL178
00902 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL178
00903 ******************************************************************   CL178
00904                                                                      CL178
00905      IF MB001-MCLASS-NUMBER-X = SPACES                               CL178
00906         CONTINUE                                                     CL178
00907      ELSE                                                            CL178
00908         IF MB001-ALL-MCLASSES                                        CL178
00909            MOVE '**'  TO MB001-MCLASS-NUMBER-X                       CL178
00910         ELSE                                                         CL178
00911            MOVE MB001-MCLASS-NUMBER-X   TO DP010I-UNEDITED-FIELD     CL178
00912            MOVE +2                      TO DP010I-MAXIMUM-DIGITS     CL178
00913            SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                   CL178
262978           CALL DP010I-NUMERIC-EDIT-ROUTINE                               
262978                USING DP010I-NUMERIC-EDIT-AREA                            
00915            IF DP010I-ERROR-DETECTED                                  CL178
00916               MOVE DP015-RED                  TO AMCLASSC            CL178
00917               MOVE DP015-REVERSE              TO AMCLASSH            CL178
00918               IF PS-NO-ERROR                                         CL178
00919                  MOVE PC-TSYMSG-00005         TO DP020-MSG-NUMBER    CL178
00920                  MOVE -1                      TO AMCLASSL            CL178
00921                  SET DP020-MSG-FATAL          TO TRUE                CL178
00922                  SET PS-ERROR                 TO TRUE                CL178
00923               END-IF                                                 CL178
00924            ELSE                                                      CL178
00925               MOVE DP010I-NUMERIC-FIELD       TO                     CL178
00926                         MB001-MCLASS-NUMBER                          CL178
00927               SET PS-SPECIF-MCL               TO TRUE                CL178
00928               IF MB001-MCLASS-NUMBER-X = '00'                        CL178
00929                   MOVE DP015-RED           TO AMCLASSC               CL178
00930                   MOVE DP015-REVERSE       TO AMCLASSH               CL178
00931                   IF PS-NO-ERROR                                     CL178
00932                      MOVE PC-TSYMSG-00010  TO DP020-MSG-NUMBER       CL178
00933                      MOVE -1               TO AMCLASSL               CL178
00934                      SET DP020-MSG-FATAL   TO TRUE                   CL178
00935                      SET PS-ERROR          TO TRUE                   CL178
00936                   END-IF                                             CL178
00937               ELSE                                                   CL178
00938                   IF MB001-ALL-DEPARTMENTS                           CL178
00939                       MOVE DP015-RED         TO ADEPTC               CL178
00940                       MOVE DP015-REVERSE     TO ADEPTH               CL178
00941                       IF PS-NO-ERROR                                 CL178
00942                          MOVE PC-TSYMSG-00005 TO                     CL178
00943                               DP020-MSG-NUMBER                       CL178
00944                          MOVE -1                  TO ADEPTL          CL178
00945                          SET DP020-MSG-FATAL      TO TRUE            CL178
00946                          SET PS-ERROR             TO TRUE            CL178
00947                       END-IF                                         CL178
00948                   END-IF                                             CL178
00949               END-IF                                                 CL178
00950            END-IF                                                    CL178
00951         END-IF                                                       CL178
00952      END-IF.                                                         CL178
00953      EJECT                                                           CL178
00954                                                                      CL178
00955  3440-GENERAL-EDIT-SCL.                                              CL178
00956 ******************************************************************   CL178
00957 *    EDIT THE SCL FOR SPACES, ASTERISKS, AND NUMERIC FIELDS.         CL178
00958 *                                                                    CL178
00959 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL178
00960 ******************************************************************   CL178
00961                                                                      CL178
00962      IF MB001-SCLASS-NUMBER-X = SPACES                               CL178
00963         CONTINUE                                                     CL178
00964      ELSE                                                            CL178
00965         IF MB001-ALL-SCLASSES                                        CL178
00966            MOVE '***'                      TO                        CL178
00967                 MB001-SCLASS-NUMBER-X                                CL178
00968         ELSE                                                         CL178
00969            MOVE MB001-SCLASS-NUMBER-X   TO DP010I-UNEDITED-FIELD     CL178
00970            MOVE +3                      TO DP010I-MAXIMUM-DIGITS     CL178
00971            SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                   CL178
262978           CALL DP010I-NUMERIC-EDIT-ROUTINE                               
262978                USING DP010I-NUMERIC-EDIT-AREA                            
00973            IF DP010I-ERROR-DETECTED                                  CL178
00974               MOVE DP015-RED                   TO ASCLASSC           CL178
00975               MOVE DP015-REVERSE               TO ASCLASSH           CL178
00976               IF PS-NO-ERROR                                         CL178
00977                  MOVE PC-TSYMSG-00005          TO DP020-MSG-NUMBER   CL178
00978                  MOVE -1                       TO ASCLASSL           CL178
00979                  SET DP020-MSG-FATAL           TO TRUE               CL178
00980                  SET PS-ERROR                  TO TRUE               CL178
00981               END-IF                                                 CL178
00982            ELSE                                                      CL178
00983               MOVE DP010I-NUMERIC-FIELD        TO                    CL178
00984                   MB001-SCLASS-NUMBER-R                              CL178
00985               SET PS-SPECIF-SCL                TO TRUE               CL178
00986               IF MB001-SCLASS-NUMBER-X = '000'                       CL178
00987                   MOVE DP015-RED          TO ASCLASSC                CL178
00988                   MOVE DP015-REVERSE      TO ASCLASSH                CL178
00989                   IF PS-NO-ERROR                                     CL178
00990                      MOVE PC-TSYMSG-00010 TO DP020-MSG-NUMBER        CL178
00991                      MOVE -1              TO ASCLASSL                CL178
00992                      SET DP020-MSG-FATAL TO TRUE                     CL178
00993                      SET PS-ERROR         TO TRUE                    CL178
00994                   END-IF                                             CL178
00995               ELSE                                                   CL178
00996                   IF MB001-ALL-DEPARTMENTS                           CL178
00997                      MOVE DP015-RED            TO ADEPTC             CL178
00998                      MOVE DP015-REVERSE        TO ADEPTH             CL178
00999                      IF PS-NO-ERROR                                  CL178
01000                         MOVE PC-TSYMSG-00005 TO                      CL178
01001                           DP020-MSG-NUMBER                           CL178
01002                         MOVE -1                TO ADEPTL             CL178
01003                         SET DP020-MSG-FATAL TO TRUE                  CL178
01004                         SET PS-ERROR           TO TRUE               CL178
01005                      END-IF                                          CL178
01006                   ELSE                                               CL178
01007                      IF MB001-ALL-MCLASSES                           CL178
01008                         MOVE DP015-RED               TO AMCLASSC     CL178
01009                         MOVE DP015-REVERSE           TO AMCLASSH     CL178
01010                         IF PS-NO-ERROR                               CL178
01011                            MOVE PC-TSYMSG-00005      TO              CL178
01012                                DP020-MSG-NUMBER                      CL178
01013                            MOVE -1                   TO AMCLASSL     CL178
01014                            SET DP020-MSG-FATAL       TO TRUE         CL178
01015                            SET PS-ERROR              TO TRUE         CL178
01016                         END-IF                                       CL178
01017                      END-IF                                          CL178
01018                   END-IF                                             CL178
01019               END-IF                                                 CL178
01020            END-IF                                                    CL178
01021         END-IF                                                       CL178
01022      END-IF.                                                         CL178
01023      EJECT                                                           CL178
01024                                                                      CL178
01025  3500-VALIDATE-SCL.                                                  CL181
01026                                                                      CL181
01027 ******************************************************************   CL181
01028 *    SUB CLASS WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.    CL181
01029 *    VALIDATE THAT SPECIFIC DATA ENTERED IS VALID.                   CL181
01030 *    DETERMINE WHETHER SPECIFIED SUBCLASS EXISTS, AND DETERMINE      CL202
01031 *    WHETHER AN ERROR HAS OCCURRED.                                  CL202
01032 *                                                                    CL181
01033 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL181
01034 ******************************************************************   CL181
01035                                                                      CL181
01036      PERFORM 9001-OPEN-SCL-CURSOR.                                   CL**3
01037                                                                      CL**3
01038      PERFORM 3505-GET-SCL-DB2.                                       CL185
01039                                                                      CL**3
01040      PERFORM 9002-CLOSE-SCL-CURSOR.                                  CL**3
01041                                                                      CL**3
01042      IF (PS-ROW-NOT-FOUND)                                           CL*48
01043                                                                      CL*48
01044 *        SUBCLASS DOES NOT EXIST WITHIN DEPARTMENT                   CL*48
01045                                                                      CL*48
01046           MOVE PC-TSYMSG-00079 TO DP020-MSG-NUMBER                   CL*48
01047           MOVE DP015-RED       TO ASCLASSC                           CL*48
01048           MOVE DP015-REVERSE   TO ASCLASSH                           CL*48
01049           MOVE -1              TO ASCLASSL                           CL*48
01050           SET DP020-MSG-FATAL                                        CL*48
01051               PS-ERROR     TO TRUE                                   CL*48
01052      ELSE                                                            CL*48
01053          IF (PS-SPECIF-DMA) AND                                      CL*48
01054             (MDSEAR-DMA-NBR NOT = MB001-DMA-NUMBER)                  CL*48
01055                                                                      CL*48
01056 *        DPT COMBINATION DOESN'T EXIST WITHIN DMA                    CL*48
01057                                                                      CL*48
01058               MOVE PC-TSYMSG-00077 TO DP020-MSG-NUMBER               CL*48
01059               MOVE DP015-RED       TO ADEPTC                         CL*48
01060               MOVE DP015-REVERSE   TO ADEPTH                         CL*48
01061               MOVE -1              TO ADEPTL                         CL*48
01062               SET DP020-MSG-FATAL                                    CL*48
01063                   PS-ERROR TO TRUE                                   CL*48
01064          END-IF                                                      CL*48
01065          IF (PS-SPECIF-GMA) AND                                      CL*48
01066             (MDSEAR-GMA-NBR NOT = MB001-GMA-NUMBER)                  CL*48
01067                                                                      CL*48
01068 *        DPT DOESN'T EXIST WITHIN GMA                                CL*48
01069                                                                      CL*48
01070               MOVE PC-TSYMSG-00081 TO DP020-MSG-NUMBER               CL*48
01071               MOVE DP015-RED       TO ADEPTC                         CL*48
01072               MOVE DP015-REVERSE   TO ADEPTH                         CL*48
01073               MOVE -1              TO ADEPTL                         CL*48
01074               SET DP020-MSG-FATAL                                    CL*48
01075                   PS-ERROR TO TRUE                                   CL*48
01076          END-IF                                                      CL*48
01077                                                                      CL*48
01078      END-IF.                                                         CL*48
01079   EJECT                                                              CL*48
01080                                                                      CL182
01081  3505-GET-SCL-DB2.                                                   CL185
01082                                                                      CL182
01083 ******************************************************************   CL182
01084 *    SUB CLASS WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.    CL182
01085 *    VALIDATE THAT SPECIFIC DATA ENTERED IS VALID.                   CL182
01086 *                                                                    CL182
01087 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL182
01088 ******************************************************************   CL182
01089                                                                      CL182
01090      PERFORM WITH TEST AFTER                                         CL182
01091          VARYING PV-RETRY-COUNTER                                    CL182
01092          FROM 1 BY 1                                                 CL182
01093          UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)                 CL182
01094                  OR (SQLCODE = 0)                                    CL182
01095                  OR (SQLCODE = +100))                                CL182
01096                                                                      CL182
01097                                                                      CL182
01098          EXEC SQL                                                    CL182
01099              FETCH  SUB_CURSOR                                       CL**1
01100              INTO :MDSEAR-GMA-NBR,                                   CL**1
01101                   :MDSEAR-DMA-NBR,                                   CL**1
01102                   :MDSEAR-DEPT-NBR,                                  CL**1
01103                   :MDSEAR-MAJ-CL-NBR,                                CL**1
01104                   :MDSEAR-SUB-CL-NBR                                 CL**1
01105          END-EXEC                                                    CL182
01106                                                                      CL182
01107          EVALUATE TRUE                                               CL182
01108              WHEN SQLCODE = ZERO                                     CL182
01109                  SET PS-ROW-FOUND TO TRUE                            CL182
01110              WHEN SQLCODE = -904                                     CL182
01111              WHEN SQLCODE = -913                                     CL182
01112                   CONTINUE                                           CL182
01113              WHEN SQLCODE = +100                                     CL182
01114                  SET PS-ROW-NOT-FOUND TO TRUE                        CL182
01115              WHEN SQLWARN0 NOT = SPACES                              CL182
01116              WHEN SQLCODE < 0                                        CL182
01117              WHEN SQLCODE > 0                                        CL182
01118                  MOVE '3505-GET-SCL-DB2' TO DP013-PARAGRAPH          CL185
01119                  MOVE 'SELECT SUBCLASS INFORMATION' TO               CL182
01120                                              DP013-MESSAGE-TEXT(1)   CL182
01121                  STRING 'DPT ' MB001-DEPT-NUMBER-X                   CL182
01122                         ' MCL ' MB001-MCLASS-NUMBER-X                CL182
01123                         ' SCL ' MB001-SCLASS-NUMBER-X                CL182
01124                         DELIMITED BY SIZE                            CL182
01125                         INTO DP013-MESSAGE-TEXT(2)                   CL182
01126                  MOVE SQLCA TO DP013-SQLCA                           CL182
01127                  MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)           CL182
01128                  SET DP013-DB2-ABEND TO TRUE                         CL182
01129                  SET DP013-NO-ROLLBACK TO TRUE                       CL182
01130                  SET DP013-XCTL-DISPLAY-RESTART TO TRUE              CL182
01131                  PERFORM DP013-0000-PROCESS-ABEND                    CL182
01132          END-EVALUATE                                                CL182
01133      END-PERFORM.                                                    CL182
01134                                                                      CL182
01135                                                                      CL182
01136      IF PV-RETRY-COUNTER > PC-MAX-RETRIES                            CL182
01137          MOVE '3505-GET-SCL-DB2' TO DP013-PARAGRAPH                  CL185
01138          MOVE 'SELECT SUBCLASS INFORMATION' TO                       CL182
01139                                      DP013-MESSAGE-TEXT(1)           CL182
01140          MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                    CL222
01141                                      DP013-MESSAGE-TEXT(2)           CL182
01142          STRING 'DPT ' MB001-DEPT-NUMBER-X                           CL182
01143                 ' MCL ' MB001-MCLASS-NUMBER-X                        CL182
01144                 ' SCL ' MB001-SCLASS-NUMBER-X                        CL182
01145                 DELIMITED BY SIZE                                    CL182
01146                 INTO DP013-MESSAGE-TEXT(3)                           CL182
01147          MOVE SQLCA TO DP013-SQLCA                                   CL182
01148          MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)                   CL182
01149          SET DP013-DB2-ABEND                                         CL222
01150              DP013-NO-ROLLBACK                                       CL222
01151              DP013-XCTL-DISPLAY-RESTART TO TRUE                      CL222
01152          PERFORM DP013-0000-PROCESS-ABEND                            CL182
01153      END-IF.                                                         CL182
01154                                                                      CL183
01155  3510-VALIDATE-MCL.                                                  CL183
01156                                                                      CL183
01157 ******************************************************************   CL183
01158 *    MAJ CLASS WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.    CL183
01159 *    VALIDATE THAT SPECIFIC DATA ENTERED IS VALID.                   CL183
01160 *                                                                    CL183
01161 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL183
01162 ******************************************************************   CL183
01163                                                                      CL183
01164      PERFORM 9003-OPEN-MCL-CURSOR.                                   CL*13
01165                                                                      CL*12
01166      PERFORM 3515-GET-MCL-DB2.                                       CL185
01167                                                                      CL*12
01168      PERFORM 9004-CLOSE-MCL-CURSOR.                                  CL*13
01169                                                                      CL*12
01170      IF (PS-ROW-NOT-FOUND)                                           CL*49
01171                                                                      CL*49
01172 *     MAJOR CLASS DOES NOT EXIST WITHIN DEPARTMENT                   CL*49
01173                                                                      CL*49
01174          MOVE PC-TSYMSG-00078 TO DP020-MSG-NUMBER                    CL*49
01175          MOVE DP015-RED       TO AMCLASSC                            CL*49
01176          MOVE DP015-REVERSE   TO AMCLASSH                            CL*49
01177          MOVE -1              TO AMCLASSL                            CL*49
01178          SET DP020-MSG-FATAL                                         CL*49
01179              PS-ERROR         TO TRUE                                CL*49
01180      ELSE                                                            CL*49
01181 *     ROW EXISTS                                                     CL*49
01182          IF (PS-SPECIF-DMA) AND                                      CL*49
01183             (MDSEAR-DMA-NBR NOT = MB001-DMA-NUMBER)                  CL*49
01184                                                                      CL*49
01185 *     DPT - MAJOR CLASS DOES NOT EXIST WITHIN DMA                    CL*49
01186                                                                      CL*49
01187              MOVE PC-TSYMSG-00077 TO DP020-MSG-NUMBER                CL*49
01188              MOVE DP015-RED       TO ADEPTC                          CL*49
01189              MOVE DP015-REVERSE   TO ADEPTH                          CL*49
01190              MOVE -1              TO ADEPTL                          CL*49
01191              SET DP020-MSG-FATAL                                     CL*49
01192                  PS-ERROR         TO TRUE                            CL*49
01193          END-IF                                                      CL*49
01194          IF (PS-SPECIF-GMA) AND                                      CL*49
01195             (MDSEAR-GMA-NBR NOT = MB001-GMA-NUMBER)                  CL*49
01196                                                                      CL*49
01197 *     DPT - MAJOR CLASS DOES NOT EXIST WITHIN GMA                    CL*49
01198                                                                      CL*49
01199              MOVE PC-TSYMSG-00081 TO DP020-MSG-NUMBER                CL*49
01200              MOVE DP015-RED       TO ADEPTC                          CL*49
01201              MOVE DP015-REVERSE   TO ADEPTH                          CL*49
01202              MOVE -1              TO ADEPTL                          CL*49
01203              SET DP020-MSG-FATAL                                     CL*49
01204                  PS-ERROR         TO TRUE                            CL*49
01205          END-IF                                                      CL*49
01206      END-IF.                                                         CL*49
01207                                                                      CL207
01208      EJECT                                                           CL183
01209                                                                      CL183
01210  3515-GET-MCL-DB2.                                                   CL185
01211                                                                      CL183
01212 ******************************************************************   CL183
01213 *    MAJ CLASS WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.    CL185
01214 *    VALIDATE THAT SPECIFIC DATA ENTERED IS VALID.                   CL183
01215 *                                                                    CL183
01216 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL183
01217 ******************************************************************   CL183
01218                                                                      CL183
01219      PERFORM WITH TEST AFTER                                         CL183
01220          VARYING PV-RETRY-COUNTER                                    CL183
01221          FROM 1 BY 1                                                 CL183
01222          UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)                 CL183
01223                  OR (SQLCODE = 0)                                    CL183
01224                  OR (SQLCODE = +100))                                CL183
01225                                                                      CL183
01226                                                                      CL183
01227          EXEC SQL                                                    CL183
01228              FETCH MAJ_CURSOR                                        CL**1
01229              INTO :MDSEAR-GMA-NBR,                                   CL**1
01230                   :MDSEAR-DMA-NBR,                                   CL**1
01231                   :MDSEAR-DEPT-NBR,                                  CL**1
01232                   :MDSEAR-MAJ-CL-NBR                                 CL**1
01233          END-EXEC                                                    CL183
01234                                                                      CL183
01235          EVALUATE TRUE                                               CL183
01236              WHEN SQLCODE = ZERO                                     CL183
01237                  SET PS-ROW-FOUND TO TRUE                            CL183
01238              WHEN SQLCODE = -904                                     CL183
01239              WHEN SQLCODE = -913                                     CL183
01240                   CONTINUE                                           CL183
01241              WHEN SQLCODE = +100                                     CL183
01242                  SET PS-ROW-NOT-FOUND TO TRUE                        CL183
01243              WHEN SQLWARN0 NOT = SPACES                              CL183
01244              WHEN SQLCODE < 0                                        CL183
01245              WHEN SQLCODE > 0                                        CL183
01246                  MOVE '3515-GET-MCL-DB2' TO                          CL185
01247                                           DP013-PARAGRAPH            CL183
01248                  MOVE 'SELECT MAJCLASS INFORMATION' TO               CL185
01249                                           DP013-MESSAGE-TEXT(1)      CL183
01250                  STRING 'DPT '  MB001-DEPT-NUMBER-X                  CL183
01251                         ' MCL ' MB001-MCLASS-NUMBER-X                CL183
01252                         ' LEVEL ' PK-MDSELV-MCL-CODE                 CL185
01253                         DELIMITED BY SIZE                            CL183
01254                         INTO DP013-MESSAGE-TEXT(2)                   CL183
01255                  MOVE SQLCA TO DP013-SQLCA                           CL183
01256                  MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)           CL183
01257                  SET DP013-DB2-ABEND TO TRUE                         CL183
01258                  SET DP013-NO-ROLLBACK TO TRUE                       CL183
01259                  SET DP013-XCTL-DISPLAY-RESTART TO TRUE              CL183
01260                  PERFORM DP013-0000-PROCESS-ABEND                    CL183
01261          END-EVALUATE                                                CL183
01262      END-PERFORM.                                                    CL183
01263                                                                      CL183
01264                                                                      CL183
01265      IF PV-RETRY-COUNTER > PC-MAX-RETRIES                            CL183
01266          MOVE '3515-GET-MCL-DB2' TO DP013-PARAGRAPH                  CL185
01267          MOVE 'SELECT SUBCLASS INFORMATION' TO                       CL183
01268                                      DP013-MESSAGE-TEXT(1)           CL183
01269          MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                    CL222
01270                                      DP013-MESSAGE-TEXT(2)           CL183
01271          STRING 'DPT ' MB001-DEPT-NUMBER-X                           CL183
01272                 ' MCL ' MB001-MCLASS-NUMBER-X                        CL183
01273                 ' LEVEL ' PK-MDSELV-MCL-CODE                         CL185
01274                 DELIMITED BY SIZE                                    CL183
01275                 INTO DP013-MESSAGE-TEXT(3)                           CL183
01276          MOVE SQLCA TO DP013-SQLCA                                   CL183
01277          MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)                   CL183
01278          SET DP013-DB2-ABEND                                         CL222
01279              DP013-NO-ROLLBACK                                       CL222
01280              DP013-XCTL-DISPLAY-RESTART TO TRUE                      CL222
01281          PERFORM DP013-0000-PROCESS-ABEND                            CL183
01282      END-IF.                                                         CL183
01283      EJECT                                                           CL186
01284                                                                      CL186
01285  3520-VALIDATE-DPT.                                                  CL186
01286                                                                      CL186
01287 ******************************************************************   CL186
01288 *    DEPT      WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.    CL186
01289 *    VALIDATE THAT SPECIFIC DATA ENTERED IS VALID.                   CL186
01290 *                                                                    CL186
01291 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL186
01292 ******************************************************************   CL186
01293                                                                      CL186
01294      PERFORM 9005-OPEN-DPT-CURSOR.                                   CL*13
01295                                                                      CL*12
01296      PERFORM 3525-GET-DPT-DB2.                                       CL186
01297                                                                      CL*12
01298      PERFORM 9006-CLOSE-DPT-CURSOR.                                  CL*13
01299                                                                      CL204
01300                                                                      CL204
01301      IF PS-ROW-FOUND                                                 CL*50
01302          IF (MDSEAR-DMA-NBR NOT = MB001-DMA-NUMBER) AND              CL*50
01303             (PS-SPECIF-DMA)                                          CL*50
01304                                                                      CL*50
01305 *         DEPT DOES NOT EXIST WITHIN DMA                             CL*53
01306                                                                      CL*50
01307              MOVE PC-TSYMSG-00077 TO DP020-MSG-NUMBER                CL*50
01308              MOVE DP015-RED       TO ADEPTC                          CL*50
01309              MOVE DP015-REVERSE   TO ADEPTH                          CL*50
01310              MOVE -1              TO ADEPTL                          CL*50
01311              SET DP020-MSG-FATAL                                     CL*50
01312                  PS-ERROR         TO TRUE                            CL*50
01313          ELSE                                                        CL*50
01314              IF (MDSEAR-GMA-NBR NOT = MB001-GMA-NUMBER) AND          CL*50
01315                 (PS-SPECIF-GMA)                                      CL*50
01316                                                                      CL*50
01317 *         DEPT DOES NOT EXIST WITHIN GMA                             CL*53
01318                                                                      CL*50
01319                  MOVE PC-TSYMSG-00081 TO DP020-MSG-NUMBER            CL*50
01320                  MOVE DP015-RED       TO ADEPTC                      CL*50
01321                  MOVE DP015-REVERSE   TO ADEPTH                      CL*50
01322                  MOVE -1              TO ADEPTL                      CL*50
01323                  SET DP020-MSG-FATAL                                 CL*50
01324                      PS-ERROR         TO TRUE                        CL*50
01325              END-IF                                                  CL*50
01326          END-IF                                                      CL*50
01327      ELSE                                                            CL*50
01328 *         DEPT DOES NOT EXIST                                        CL*54
01329          MOVE PC-TSYMSG-00032 TO DP020-MSG-NUMBER                    CL*50
01330          MOVE DP015-RED       TO ADEPTC                              CL*50
01331          MOVE DP015-REVERSE   TO ADEPTH                              CL*50
01332          MOVE -1              TO ADEPTL                              CL*50
01333          SET DP020-MSG-FATAL                                         CL*50
01334              PS-ERROR         TO TRUE                                CL*50
01335      END-IF.                                                         CL*50
01336      EJECT                                                           CL186
01337                                                                      CL186
01338  3525-GET-DPT-DB2.                                                   CL187
01339                                                                      CL186
01340 ******************************************************************   CL186
01341 *    DEPARTMENT WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.   CL187
01342 *    VALIDATE THAT SPECIFIC DATA ENTERED IS VALID.                   CL186
01343 *                                                                    CL186
01344 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL186
01345 ******************************************************************   CL186
01346                                                                      CL186
01347      PERFORM WITH TEST AFTER                                         CL186
01348          VARYING PV-RETRY-COUNTER                                    CL186
01349          FROM 1 BY 1                                                 CL186
01350          UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)                 CL186
01351                  OR (SQLCODE = 0)                                    CL186
01352                  OR (SQLCODE = +100))                                CL186
01353                                                                      CL186
01354                                                                      CL186
01355          EXEC SQL                                                    CL186
01356              FETCH DEPT_CURSOR                                       CL**2
01357              INTO :MDSEAR-GMA-NBR,                                   CL**2
01358                   :MDSEAR-DMA-NBR,                                   CL**2
01359                   :MDSEAR-DEPT-NBR                                   CL**2
01360          END-EXEC                                                    CL186
01361                                                                      CL186
01362          EVALUATE TRUE                                               CL186
01363              WHEN SQLCODE = ZERO                                     CL186
01364                  SET PS-ROW-FOUND TO TRUE                            CL186
01365              WHEN SQLCODE = -904                                     CL186
01366              WHEN SQLCODE = -913                                     CL186
01367                   CONTINUE                                           CL186
01368              WHEN SQLCODE = +100                                     CL186
01369                  SET PS-ROW-NOT-FOUND TO TRUE                        CL186
01370              WHEN SQLWARN0 NOT = SPACES                              CL186
01371              WHEN SQLCODE < 0                                        CL186
01372              WHEN SQLCODE > 0                                        CL186
01373                  MOVE '3525-GET-DPT-DB2' TO                          CL187
01374                                           DP013-PARAGRAPH            CL186
01375                  MOVE 'SELECT DEPARTMENT ROW ' TO                    CL187
01376                                           DP013-MESSAGE-TEXT(1)      CL186
01377                  STRING 'DPT '  MB001-DEPT-NUMBER-X                  CL186
01378                         ' LEVEL ' PK-MDSELV-DPT-CODE                 CL187
01379                         DELIMITED BY SIZE                            CL186
01380                         INTO DP013-MESSAGE-TEXT(2)                   CL186
01381                  MOVE SQLCA TO DP013-SQLCA                           CL186
01382                  MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)           CL186
01383                  SET DP013-DB2-ABEND TO TRUE                         CL186
01384                  SET DP013-NO-ROLLBACK TO TRUE                       CL186
01385                  SET DP013-XCTL-DISPLAY-RESTART TO TRUE              CL186
01386                  PERFORM DP013-0000-PROCESS-ABEND                    CL186
01387          END-EVALUATE                                                CL186
01388      END-PERFORM.                                                    CL186
01389                                                                      CL186
01390                                                                      CL186
01391      IF PV-RETRY-COUNTER > PC-MAX-RETRIES                            CL186
01392          MOVE '3525-GET-DPT-DB2' TO DP013-PARAGRAPH                  CL187
01393          MOVE 'SELECT DEPARTMENT INFO' TO                            CL187
01394                                      DP013-MESSAGE-TEXT(1)           CL186
01395          MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                    CL222
01396                                      DP013-MESSAGE-TEXT(2)           CL186
01397          STRING 'DPT ' MB001-DEPT-NUMBER-X                           CL186
01398                 ' LEVEL ' PK-MDSELV-MCL-CODE                         CL186
01399                 DELIMITED BY SIZE                                    CL186
01400                 INTO DP013-MESSAGE-TEXT(3)                           CL186
01401          MOVE SQLCA TO DP013-SQLCA                                   CL186
01402          MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)                   CL186
01403          SET DP013-DB2-ABEND TO TRUE                                 CL186
01404          SET DP013-NO-ROLLBACK TO TRUE                               CL186
01405          SET DP013-XCTL-DISPLAY-RESTART TO TRUE                      CL186
01406          PERFORM DP013-0000-PROCESS-ABEND                            CL186
01407      END-IF.                                                         CL186
01408      EJECT                                                           CL188
01409                                                                      CL188
01410  3530-VALIDATE-DMA.                                                  CL188
01411                                                                      CL188
01412 ******************************************************************   CL188
01413 *    DMA       WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.    CL188
01414 *    VALIDATE THAT SPECIFIC DATA ENTERED IS VALID.                   CL188
01415 *                                                                    CL188
01416 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL188
01417 ******************************************************************   CL188
01418                                                                      CL188
01419      PERFORM 9007-OPEN-DMA-CURSOR.                                   CL*29
01420                                                                      CL*29
01421      PERFORM 3535-GET-DMA-DB2.                                       CL188
01422                                                                      CL*29
01423      PERFORM 9008-CLOSE-DMA-CURSOR.                                  CL*29
01424                                                                      CL205
01425      IF PS-ROW-FOUND                                                 CL*51
01426                                                                      CL*51
01427 *      DMA DOES NOT EXIST WITHIN GMA                                 CL*51
01428                                                                      CL*51
01429         IF (MDSEAR-GMA-NBR NOT = MB001-GMA-NUMBER) AND               CL*51
01430            (PS-SPECIF-GMA)                                           CL*51
01431             MOVE PC-TSYMSG-00076 TO DP020-MSG-NUMBER                 CL*51
01432             MOVE DP015-RED       TO ADMAC                            CL*51
01433             MOVE DP015-REVERSE   TO ADMAH                            CL*51
01434             MOVE -1              TO ADMAL                            CL*51
01435             SET DP020-MSG-FATAL                                      CL*51
01436                 PS-ERROR         TO TRUE                             CL*51
01437         END-IF                                                       CL*51
01438      ELSE                                                            CL*51
01439                                                                      CL*51
01440 *      DMA DOES NOT EXIST WITHIN GMA                                 CL*51
01441                                                                      CL*51
01442         MOVE PC-TSYMSG-00076 TO DP020-MSG-NUMBER                     CL*51
01443         MOVE DP015-RED       TO ADMAC                                CL*51
01444         MOVE DP015-REVERSE   TO ADMAH                                CL*51
01445         MOVE -1              TO ADMAL                                CL*51
01446         SET DP020-MSG-FATAL                                          CL*51
01447             PS-ERROR         TO TRUE                                 CL*51
01448      END-IF.                                                         CL*51
01449      EJECT                                                           CL*51
01450                                                                      CL188
01451  3535-GET-DMA-DB2.                                                   CL191
01452                                                                      CL188
01453 ******************************************************************   CL188
01454 *    DMA        WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.   CL191
01455 *    VALIDATE THAT SPECIFIC DATA ENTERED IS VALID.                   CL188
01456 *                                                                    CL188
01457 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL188
01458 ******************************************************************   CL188
01459                                                                      CL188
01460      PERFORM WITH TEST AFTER                                         CL188
01461          VARYING PV-RETRY-COUNTER                                    CL188
01462          FROM 1 BY 1                                                 CL188
01463          UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)                 CL188
01464                  OR (SQLCODE = 0)                                    CL188
01465                  OR (SQLCODE = +100))                                CL188
01466                                                                      CL188
01467                                                                      CL188
01468          EXEC SQL                                                    CL188
01469              FETCH DMA_CURSOR                                        CL**2
01470              INTO :MDSEAR-GMA-NBR,                                   CL**2
01471                   :MDSEAR-DMA-NBR                                    CL**2
01472          END-EXEC                                                    CL234
01473                                                                      CL188
01474          EVALUATE TRUE                                               CL188
01475              WHEN SQLCODE = ZERO                                     CL188
01476                  SET PS-ROW-FOUND TO TRUE                            CL188
01477              WHEN SQLCODE = -904                                     CL188
01478              WHEN SQLCODE = -913                                     CL188
01479                   CONTINUE                                           CL188
01480              WHEN SQLCODE = +100                                     CL188
01481                  SET PS-ROW-NOT-FOUND TO TRUE                        CL188
01482              WHEN SQLWARN0 NOT = SPACES                              CL188
01483              WHEN SQLCODE < 0                                        CL188
01484              WHEN SQLCODE > 0                                        CL188
01485                  MOVE '3535-GET-DMA-DB2' TO                          CL191
01486                                           DP013-PARAGRAPH            CL188
01487                  MOVE 'SELECT DMA ROW '  TO                          CL191
01488                                           DP013-MESSAGE-TEXT(1)      CL188
01489                  STRING 'DMA '  MB001-DMA-NUMBER-X                   CL191
01490                         ' LEVEL ' PK-MDSELV-DMA-CODE                 CL191
01491                         DELIMITED BY SIZE                            CL188
01492                         INTO DP013-MESSAGE-TEXT(2)                   CL188
01493                  MOVE SQLCA TO DP013-SQLCA                           CL188
01494                  MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)           CL188
01495                  SET DP013-DB2-ABEND TO TRUE                         CL188
01496                  SET DP013-NO-ROLLBACK TO TRUE                       CL188
01497                  SET DP013-XCTL-DISPLAY-RESTART TO TRUE              CL188
01498                  PERFORM DP013-0000-PROCESS-ABEND                    CL188
01499          END-EVALUATE                                                CL188
01500      END-PERFORM.                                                    CL188
01501                                                                      CL188
01502                                                                      CL188
01503      IF PV-RETRY-COUNTER > PC-MAX-RETRIES                            CL188
01504          MOVE '3535-GET-DMA-DB2' TO DP013-PARAGRAPH                  CL191
01505          MOVE 'SELECT DMA ROW'   TO DP013-MESSAGE-TEXT(1)            CL191
01506          MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                    CL222
01507                                      DP013-MESSAGE-TEXT(2)           CL188
01508          STRING 'DMA ' MB001-DMA-NUMBER-X                            CL191
01509                 ' LEVEL ' PK-MDSELV-DMA-CODE                         CL191
01510                 DELIMITED BY SIZE                                    CL188
01511                 INTO DP013-MESSAGE-TEXT(3)                           CL188
01512          MOVE SQLCA TO DP013-SQLCA                                   CL188
01513          MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)                   CL188
01514          SET DP013-DB2-ABEND TO TRUE                                 CL188
01515          SET DP013-NO-ROLLBACK TO TRUE                               CL188
01516          SET DP013-XCTL-DISPLAY-RESTART TO TRUE                      CL188
01517          PERFORM DP013-0000-PROCESS-ABEND                            CL188
01518      END-IF.                                                         CL188
01519      EJECT                                                           CL192
01520                                                                      CL192
01521  3540-VALIDATE-GMA.                                                  CL192
01522                                                                      CL192
01523 ******************************************************************   CL192
01524 *    GMA       WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.    CL192
01525 *    VALIDATE THAT SPECIFIC DATA ENTERED IS VALID.                   CL192
01526 *                                                                    CL192
01527 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL192
01528 ******************************************************************   CL192
01529                                                                      CL192
01530      PERFORM 9009-OPEN-GMA-CURSOR.                                   CL*29
01531                                                                      CL*29
01532      PERFORM 3545-GET-GMA-DB2.                                       CL192
01533                                                                      CL*29
01534      PERFORM 9010-CLOSE-GMA-CURSOR.                                  CL*29
01535                                                                      CL*29
01536      IF (PS-ROW-NOT-FOUND)                                           CL*52
01537                                                                      CL205
01538 ****      GMA DOES NOT EXIST                                         CL192
01539                                                                      CL205
01540          MOVE PC-TSYMSG-00030 TO DP020-MSG-NUMBER                    CL192
01541          MOVE DP015-RED           TO AGMAC                           CL194
01542          MOVE DP015-REVERSE       TO AGMAH                           CL194
01543          MOVE -1                  TO AGMAL                           CL194
01544          SET DP020-MSG-FATAL                                         CL192
01545              PS-ERROR             TO TRUE                            CL192
01546      END-IF.                                                         CL*52
01547                                                                      CL192
01548  3545-GET-GMA-DB2.                                                   CL193
01549                                                                      CL192
01550 ******************************************************************   CL192
01551 *    GMA        WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.   CL193
01552 *    VALIDATE THAT SPECIFIC DATA ENTERED IS VALID.                   CL192
01553 *                                                                    CL192
01554 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL192
01555 ******************************************************************   CL192
01556                                                                      CL192
01557      PERFORM WITH TEST AFTER                                         CL192
01558          VARYING PV-RETRY-COUNTER                                    CL192
01559          FROM 1 BY 1                                                 CL192
01560          UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)                 CL192
01561                  OR (SQLCODE = 0)                                    CL192
01562                  OR (SQLCODE = +100))                                CL192
01563                                                                      CL192
01564                                                                      CL192
01565          EXEC SQL                                                    CL192
01566              FETCH GMA_CURSOR                                        CL**2
01567              INTO :MDSEAR-GMA-NBR                                    CL**2
01568          END-EXEC                                                    CL192
01569                                                                      CL192
01570          EVALUATE TRUE                                               CL192
01571              WHEN SQLCODE = ZERO                                     CL192
01572                  SET PS-ROW-FOUND TO TRUE                            CL192
01573              WHEN SQLCODE = -904                                     CL192
01574              WHEN SQLCODE = -913                                     CL192
01575                   CONTINUE                                           CL192
01576              WHEN SQLCODE = +100                                     CL192
01577                  SET PS-ROW-NOT-FOUND TO TRUE                        CL192
01578              WHEN SQLWARN0 NOT = SPACES                              CL192
01579              WHEN SQLCODE < 0                                        CL192
01580              WHEN SQLCODE > 0                                        CL192
01581                  MOVE '3545-GET-GMA-DB2' TO                          CL192
01582                                           DP013-PARAGRAPH            CL192
01583                  MOVE 'SELECT GMA ROW '  TO                          CL192
01584                                           DP013-MESSAGE-TEXT(1)      CL192
01585                  STRING 'GMA '  MB001-GMA-NUMBER-X                   CL192
01586                         ' LEVEL ' PK-MDSELV-GMA-CODE                 CL192
01587                         DELIMITED BY SIZE                            CL192
01588                         INTO DP013-MESSAGE-TEXT(2)                   CL192
01589                  MOVE SQLCA TO DP013-SQLCA                           CL192
01590                  MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)           CL192
01591                  SET DP013-DB2-ABEND TO TRUE                         CL192
01592                  SET DP013-NO-ROLLBACK TO TRUE                       CL192
01593                  SET DP013-XCTL-DISPLAY-RESTART TO TRUE              CL192
01594                  PERFORM DP013-0000-PROCESS-ABEND                    CL192
01595          END-EVALUATE                                                CL192
01596      END-PERFORM.                                                    CL192
01597                                                                      CL192
01598                                                                      CL192
01599      IF PV-RETRY-COUNTER > PC-MAX-RETRIES                            CL192
01600          MOVE '3535-GET-GMA-DB2' TO DP013-PARAGRAPH                  CL192
01601          MOVE 'SELECT GMA ROW'   TO DP013-MESSAGE-TEXT(1)            CL192
01602          MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                    CL222
01603                                      DP013-MESSAGE-TEXT(2)           CL192
01604          STRING 'GMA ' MB001-GMA-NUMBER-X                            CL192
01605                 ' LEVEL ' PK-MDSELV-GMA-CODE                         CL192
01606                 DELIMITED BY SIZE                                    CL192
01607                 INTO DP013-MESSAGE-TEXT(3)                           CL192
01608          MOVE SQLCA TO DP013-SQLCA                                   CL192
01609          MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)                   CL192
01610          SET DP013-DB2-ABEND TO TRUE                                 CL192
01611          SET DP013-NO-ROLLBACK TO TRUE                               CL192
01612          SET DP013-XCTL-DISPLAY-RESTART TO TRUE                      CL192
01613          PERFORM DP013-0000-PROCESS-ABEND                            CL192
01614      END-IF.                                                         CL192
01615      EJECT                                                           CL*58
01616  3600-EDIT-FOR-SPACES.                                               CL*71
01617                                                                      CL*70
01618 ******************************************************************   CL*70
01619 *    EDIT EACH SCREEN FIELD FOR SPACES. ENTRIES ARE NOT ALLOWED      CL*70
01620 *    IF A PREVIOUS FIELD IS SPACES.                                  CL*70
01621 *                                                                    CL*70
01622 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL*70
01623 ******************************************************************   CL*70
01624                                                                      CL*70
01625      EVALUATE TRUE                                                   CL*70
01626                                                                      CL*70
01627          WHEN MB001-GMA-NUMBER-X = SPACES                            CL*70
01628               MOVE DP015-RED            TO AGMAC                     CL*88
01629               MOVE DP015-REVERSE        TO AGMAH                     CL*88
01630               MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER          CL102
01631               MOVE -1                   TO AGMAL                     CL*88
01632               SET DP020-MSG-FATAL       TO TRUE                      CL*88
01633               SET PS-ERROR              TO TRUE                      CL*88
01634                                                                      CL*70
01635          WHEN (MB001-DEPT-NUMBER-X NOT = SPACES AND                  CL103
01636                MB001-DMA-NUMBER-X = SPACES)                          CL103
01637               MOVE DP015-RED            TO ADEPTC                    CL*88
01638               MOVE DP015-REVERSE        TO ADEPTH                    CL*88
01639               IF PS-NO-ERROR                                         CL*77
01640                  MOVE PC-TSYMSG-00080   TO DP020-MSG-NUMBER          CL102
01641                  MOVE -1                TO ADEPTL                    CL*88
01642                  SET DP020-MSG-FATAL    TO TRUE                      CL*88
01643                  SET PS-ERROR           TO TRUE                      CL*88
01644               END-IF                                                 CL*77
01645                                                                      CL*77
01646          WHEN (MB001-MCLASS-NUMBER-X NOT = SPACES AND                CL103
01647                MB001-DEPT-NUMBER-X = SPACES)                         CL103
01648               MOVE DP015-RED          TO AMCLASSC                    CL102
01649               MOVE DP015-REVERSE      TO AMCLASSH                    CL102
01650               IF PS-NO-ERROR                                         CL*70
01651                  MOVE PC-TSYMSG-00080 TO DP020-MSG-NUMBER            CL102
01652                  MOVE -1              TO AMCLASSL                    CL102
01653                  SET DP020-MSG-FATAL  TO TRUE                        CL102
01654                  SET PS-ERROR         TO TRUE                        CL102
01655               END-IF                                                 CL*70
01656                                                                      CL*70
01657          WHEN (MB001-SCLASS-NUMBER-X NOT = SPACES AND                CL103
01658                MB001-MCLASS-NUMBER-X = SPACES)                       CL103
01659               MOVE DP015-RED         TO ASCLASSC                     CL*72
01660               MOVE DP015-REVERSE     TO ASCLASSH                     CL*72
01661               IF PS-NO-ERROR                                         CL*70
01662                  MOVE PC-TSYMSG-00080 TO DP020-MSG-NUMBER            CL102
01663                  MOVE -1              TO ASCLASSL                    CL102
01664                  SET DP020-MSG-FATAL  TO TRUE                        CL102
01665                  SET PS-ERROR         TO TRUE                        CL102
01666               END-IF                                                 CL*70
01667                                                                      CL*70
01668      END-EVALUATE.                                                   CL*70
01669      EJECT                                                           CL*58
01670  3610-EDIT-GMA-VALUE.                                                CL*58
01671                                                                      CL*58
01672 ******************************************************************   CL*58
01673 *    THE GMA CAN BE ASTERISKS ONLY IF DMA AND/OR DEPT ARE A VALID    CL*58
01674 *    NUMBER.                                                         CL*58
01675 *                                                                    CL*58
01676 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL*58
01677 ******************************************************************   CL*58
01678                                                                      CL*58
01679      IF  MB001-ALL-GMAS                                              CL*58
01680          IF (PS-SPECIF-DMA OR PS-SPECIF-DPT)                         CL*58
01681              CONTINUE                                                CL*58
01682          ELSE                                                        CL*58
01683              MOVE DP015-RED           TO AGMAC                       CL*58
01684              MOVE DP015-REVERSE       TO AGMAH                       CL*58
01685              IF  PS-NO-ERROR                                         CL*58
01686                  MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER            CL*58
01687                  MOVE -1              TO AGMAL                       CL*58
01688                  SET DP020-MSG-FATAL  TO TRUE                        CL*58
01689                  SET PS-ERROR         TO TRUE                        CL*58
01690              END-IF                                                  CL*58
01691          END-IF                                                      CL*58
01692      END-IF.                                                         CL*58
01693                                                                      CL*70
01694  EJECT                                                               CL*70
01695  4000-DISPLAY-PANEL.                                                 CL111
01696                                                                      CL**3
01697 ******************************************************************   CL**3
01698 *    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.          CL**3
01699 *                                                                    CL**3
01700 *    PERFORMED BY 1000-CONTROL-PROCESSING.                           CL*10
01701 *    PERFORMED BY 2000-BUILD-INITIAL-PANEL.                          CL138
01702 *    PERFORMED BY 3000-PROCESS-PANEL.                                CL138
01703 *    PERFORMED BY 3100-CHECK-LOCAL-FKEYS.                            CL*10
01704 ******************************************************************   CL**3
01705                                                                      CL**3
01706      PERFORM DP017-0000-GET-CURR-DATE-TIME.                          CL**3
01707      MOVE DP017-EDITED-TIME-HMS                                      CL*56
01708                                TO  ATIMEO.                           CL*56
01709                                                                      CL**3
01710      IF PS-SEND-MAP-N-DATA-FRSET                                     CL**3
01711          PERFORM DP002-0000-FORMAT-TITLE-LINES                       CL**3
01712          PERFORM 4100-MOVE-COMMAREA-TO-SCREEN                        CL*82
01713      END-IF.                                                         CL**3
01714                                                                      CL**3
01715      PERFORM DP005-0000-FORMAT-MSG-LINES.                            CL166
01716                                                                      CL107
01717      IF (DP020-SRC-AID = DP016-PA2) OR                               CL**4
01718         (PS-SEND-MAP-N-DATA-FRSET)                                   CL**4
01719          PERFORM DP009-0000-LOAD-FK-LINES                            CL**3
01720      END-IF.                                                         CL**3
01721                                                                      CL**3
01722      IF PS-NO-ERROR                                                  CL**3
01723          MOVE -1 TO AGMAL                                            CL**7
01724      END-IF                                                          CL**3
01725                                                                      CL136
01726      PERFORM DP008-0000-WRITE-PANEL.                                 CL**3
01727                                                                      CL**3
01728  EJECT                                                               CL**3
01729  4100-MOVE-COMMAREA-TO-SCREEN.                                       CL*20
01730                                                                      CL**4
01731 ******************************************************************   CL**4
01732 *    MOVE THE FIELDS FROM THE COMMAREA TO THE SCREEN.                CL**4
01733 *                                                                    CL**4
01734 *    PERFORMED BY 3100-CHECK-LOCAL-FKEYS.                            CL138
01735 *    PERFORMED BY 4000-DISPLAY-PANEL.                                CL138
01736 ******************************************************************   CL**4
01737                                                                      CL**4
01738      MOVE MB001-CO-NUMBER-X     TO ACOO.                             CL*12
01739      MOVE MB001-GMA-NUMBER-X    TO AGMAO.                            CL*12
01740      MOVE MB001-DMA-NUMBER-X    TO ADMAO.                            CL*12
01741      MOVE MB001-DEPT-NUMBER-X   TO ADEPTO.                           CL*12
01742      MOVE MB001-MCLASS-NUMBER-X TO AMCLASSO.                         CL*12
01743      MOVE MB001-SCLASS-NUMBER-X TO ASCLASSO.                         CL*12
01744      MOVE MB001-HIST-FLAG       TO AHISTO.                           CL240
01745                                                                      CL*87
01746      IF PS-NO-ERROR                                                  CL*95
01747          MOVE DP015-GREEN       TO AGMAC                             CL*95
01748                                    ADMAC                             CL*87
01749                                    ADEPTC                            CL*87
01750                                    AMCLASSC                          CL*87
01751                                    ASCLASSC                          CL*95
01752                                                                      CL*87
01753          MOVE DP015-UNDERLINE   TO AGMAH                             CL*95
01754                                    ADMAH                             CL*87
01755                                    ADEPTH                            CL*87
01756                                    AMCLASSH                          CL*87
01757                                    ASCLASSH                          CL*95
01758                                                                      CL*87
01759      END-IF.                                                         CL*95
01760                                                                      CL108
01761  EJECT                                                               CL**4
01762  5000-SETUP-INTER-APPL.                                              CL*31
01763                                                                      CL*31
01764 ******************************************************************   CL*31
01765 *    SETUP THE INTER APPLICATION COMMAREA WITH DATA FROM THE         CL*31
01766 *    SPECIFIC COMMAREA AND SET THE INTER APPLICATION FORMAT CODE.    CL*31
01767 *                                                                    CL*31
01768 *    PERFORMED BY 3100-CHECK-LOCAL-FKEYS                             CL*31
01769 ******************************************************************   CL*31
01770                                                                      CL*31
01771      IF MB001-DMA-NUMBER-X = SPACES                                  CL*42
01772         MOVE PK-MDSELV-GMA-CODE TO MB005-MDSEAR-LEVEL                CL*42
01773      ELSE                                                            CL*42
01774        IF MB001-DEPT-NUMBER-X = SPACES                               CL*42
01775           MOVE PK-MDSELV-DMA-CODE TO MB005-MDSEAR-LEVEL              CL*42
01776        ELSE                                                          CL*42
01777           IF MB001-MCLASS-NUMBER-X = SPACES                          CL*42
01778              MOVE PK-MDSELV-DPT-CODE TO MB005-MDSEAR-LEVEL           CL*42
01779           ELSE                                                       CL*42
01780             IF MB001-SCLASS-NUMBER-X = SPACES                        CL*42
01781                 MOVE PK-MDSELV-MCL-CODE TO MB005-MDSEAR-LEVEL        CL*44
01782             ELSE                                                     CL*42
01783                 MOVE PK-MDSELV-SCL-CODE TO MB005-MDSEAR-LEVEL        CL*44
01784             END-IF                                                   CL*43
01785           END-IF                                                     CL*43
01786        END-IF                                                        CL*43
01787      END-IF.                                                         CL*42
01788                                                                      CL*41
01789      MOVE MB001-CO-NUMBER-X         TO MB005-CO-NUMBER.              CL171
01790      MOVE MB001-GMA-NUMBER-X        TO MB005-GMA-NUMBER.             CL171
01791      MOVE MB001-DMA-NUMBER-X        TO MB005-DMA-NUMBER.             CL171
01792      MOVE MB001-DEPT-NUMBER-X       TO MB005-DEPT-NUMBER.            CL171
01793      MOVE MB001-MCLASS-NUMBER-X     TO MB005-MCLASS-NUMBER.          CL171
01794      MOVE MB001-SCLASS-NUMBER-X     TO MB005-SCLASS-NUMBER.          CL171
01795      MOVE MB001-HIST-FLAG           TO MB005-HISTORY-INDICATOR.      CL245
01796                                                                      CL*31
01797      SET DP020-MB-MERCH-AREA-SELECT TO TRUE.                         CL139
01798  EJECT                                                               CL*31
01799  5100-SAVE-INITIAL-INTERAPPL.                                        CL*41
01800                                                                      CL*41
01801 ******************************************************************   CL*41
01802 *    SAVE THE INTER-APPLICATION COMMAREA ON THE FIRST CYCLE          CL*41
01803 *    OF THIS TRANSACTION.                                            CL*41
01804 *                                                                    CL*41
01805 *    PERFORMED BY 1000-CONTROL-PROCESSING                            CL*41
01806 ******************************************************************   CL*41
01807                                                                      CL*41
01808      MOVE LOW-VALUES TO INTER-APPL-COMM-AREA.                        CL*41
01809                                                                      CL*41
01810  EJECT                                                               CL*41
01811  5100-UPDATE-INTER-APPL.                                             CL*36
01812                                                                      CL*34
01813 ******************************************************************   CL*34
01814 *    WHEN RETURNING FROM ANOTHER TRANSACTION, SAVE THE FIELDS        CL*34
01815 *    PASSED IN THE INTER APPLICATION COMMAREA, ONLY IF THE           CL*34
01816 *    INTER APPLICATION FORMAT CODE IS VALID FOR THIS TRANSACTION.    CL*34
01817 *                                                                    CL*34
01818 *    PERFORMED BY 1000-CONTROL-PROCESSING                            CL*34
01819 ******************************************************************   CL*34
01820                                                                      CL*34
01821      IF DP020-MB-MERCH-AREA-LIST                                     CL128
01822         MOVE MB005-CO-NUMBER       TO MB001-CO-NUMBER-X              CL171
01823         MOVE MB005-GMA-NUMBER      TO MB001-GMA-NUMBER-X             CL171
01824         MOVE MB005-DMA-NUMBER      TO MB001-DMA-NUMBER-X             CL171
01825         MOVE MB005-DEPT-NUMBER     TO MB001-DEPT-NUMBER-X            CL171
01826         MOVE MB005-MCLASS-NUMBER   TO MB001-MCLASS-NUMBER-X          CL171
01827         MOVE MB005-SCLASS-NUMBER   TO MB001-SCLASS-NUMBER-X          CL171
01828      ELSE                                                            CL128
01829         INITIALIZE MB005-INTER-APPL-COMMAREA                         CL171
01830         INITIALIZE MB001-SPECIFIC-COMMAREA                           CL128
01831      END-IF.                                                         CL128
01832                                                                      CL*34
01833  EJECT                                                               CL*34
01834  9001-OPEN-SCL-CURSOR.                                               CL**3
01835                                                                      CL**4
01836 ******************************************************************   CL**4
01837 *    OPEN SUBCLASS CURSOR                                            CL**4
01838 ******************************************************************   CL**4
01839                                                                      CL**4
01840      EXEC SQL                                                        CL*18
01841          OPEN      SUB_CURSOR                                        CL*18
01842      END-EXEC                                                        CL*18
01843                                                                      CL*28
01844      EVALUATE TRUE                                                   CL*18
01845          WHEN SQLCODE = ZERO                                         CL*18
01846              CONTINUE                                                CL*18
01847          WHEN SQLWARN0 NOT = SPACES                                  CL*18
01848          WHEN SQLCODE < 0                                            CL*18
01849          WHEN SQLCODE > 0                                            CL*18
01850              MOVE '9001-OPEN-SCL-CURSOR' TO DP013-PARAGRAPH          CL*18
01851              MOVE 'OPEN CURSOR FOR SUBCLASS' TO                      CL*18
01852                                          DP013-MESSAGE-TEXT(1)       CL*18
01853              STRING 'DPT ' MB001-DEPT-NUMBER-X                       CL*18
01854                     ' MCL ' MB001-MCLASS-NUMBER-X                    CL*18
01855                     ' SCL ' MB001-SCLASS-NUMBER-X                    CL*18
01856                     DELIMITED BY SIZE                                CL*18
01857                     INTO DP013-MESSAGE-TEXT(2)                       CL*18
01858              MOVE SQLCA TO DP013-SQLCA                               CL*18
01859              MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)               CL*18
01860              SET DP013-DB2-ABEND TO TRUE                             CL*18
01861              SET DP013-NO-ROLLBACK TO TRUE                           CL*18
01862              SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*18
01863              PERFORM DP013-0000-PROCESS-ABEND                        CL*18
01864      END-EVALUATE.                                                   CL*28
01865                                                                      CL**5
01866  9002-CLOSE-SCL-CURSOR.                                              CL**3
01867                                                                      CL**4
01868 ******************************************************************   CL**4
01869 *   CLOSE SUBCLASS CURSOR                                            CL**4
01870 ******************************************************************   CL**4
01871                                                                      CL**4
01872      EXEC SQL                                                        CL*18
01873          CLOSE SUB_CURSOR                                            CL*18
01874      END-EXEC                                                        CL*18
01875                                                                      CL*19
01876      EVALUATE TRUE                                                   CL*18
01877          WHEN SQLCODE = ZERO                                         CL*18
01878              CONTINUE                                                CL*18
01879          WHEN SQLWARN0 NOT = SPACES                                  CL*18
01880          WHEN SQLCODE < 0                                            CL*18
01881          WHEN SQLCODE > 0                                            CL*18
01882              MOVE '9002-CLOSE-SCL-CURSOR' TO DP013-PARAGRAPH         CL*18
01883              MOVE 'CLOSE CURSOR FOR SUBCLASS' TO                     CL*18
01884                                          DP013-MESSAGE-TEXT(1)       CL*18
01885              MOVE SQLCA TO DP013-SQLCA                               CL*18
01886              MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)               CL*18
01887              SET DP013-DB2-ABEND TO TRUE                             CL*18
01888              SET DP013-NO-ROLLBACK TO TRUE                           CL*18
01889              SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*18
01890              PERFORM DP013-0000-PROCESS-ABEND                        CL*18
01891      END-EVALUATE.                                                   CL*23
01892  EJECT                                                               CL**3
01893  9003-OPEN-MCL-CURSOR.                                               CL**3
01894                                                                      CL**5
01895 ******************************************************************   CL**5
01896 *    MAJ CLASS WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.    CL**5
01897 *    OPEN MAJOR CLASS CURSOR                                         CL**5
01898 ******************************************************************   CL**5
01899                                                                      CL**5
01900      EXEC SQL                                                        CL*20
01901          OPEN MAJ_CURSOR                                             CL*20
01902      END-EXEC                                                        CL*20
01903                                                                      CL*28
01904      EVALUATE TRUE                                                   CL*20
01905          WHEN SQLCODE = ZERO                                         CL*20
01906              CONTINUE                                                CL*20
01907          WHEN SQLWARN0 NOT = SPACES                                  CL*20
01908          WHEN SQLCODE < 0                                            CL*20
01909          WHEN SQLCODE > 0                                            CL*20
01910              MOVE '9003-OPEN-MCL-CURSOR' TO                          CL*20
01911                                       DP013-PARAGRAPH                CL*20
01912              MOVE 'OPEN MAJ. CLASS CURSOR' TO                        CL*20
01913                                       DP013-MESSAGE-TEXT(1)          CL*20
01914              STRING 'DPT '      MB001-DEPT-NUMBER-X                  CL*20
01915                     ' MCL ' MB001-MCLASS-NUMBER-X                    CL*20
01916                     ' LEVEL ' PK-MDSELV-MCL-CODE                     CL*20
01917                     DELIMITED BY SIZE                                CL*20
01918                     INTO DP013-MESSAGE-TEXT(2)                       CL*20
01919              MOVE SQLCA TO DP013-SQLCA                               CL*20
01920              MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)               CL*20
01921              SET DP013-DB2-ABEND TO TRUE                             CL*20
01922              SET DP013-NO-ROLLBACK TO TRUE                           CL*20
01923              SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*20
01924              PERFORM DP013-0000-PROCESS-ABEND                        CL*20
01925      END-EVALUATE.                                                   CL*23
01926                                                                      CL*23
01927  9004-CLOSE-MCL-CURSOR.                                              CL**3
01928 ******************************************************************   CL**6
01929 *    MAJ CLASS WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.    CL**6
01930 *    CLOSE MAJOR CLASS CURSOR                                        CL**6
01931 ******************************************************************   CL**6
01932                                                                      CL**6
01933      EXEC SQL                                                        CL*21
01934          CLOSE MAJ_CURSOR                                            CL*21
01935      END-EXEC                                                        CL*21
01936                                                                      CL*22
01937      EVALUATE TRUE                                                   CL*21
01938          WHEN SQLCODE = ZERO                                         CL*21
01939              CONTINUE                                                CL*21
01940          WHEN SQLWARN0 NOT = SPACES                                  CL*21
01941          WHEN SQLCODE < 0                                            CL*21
01942          WHEN SQLCODE > 0                                            CL*21
01943              MOVE '9004-CLOSE-MCL-CURSOR' TO                         CL*21
01944                                       DP013-PARAGRAPH                CL*21
01945              MOVE 'CLOSE MAJ. CLASS CURSOR' TO                       CL*21
01946                                       DP013-MESSAGE-TEXT(1)          CL*21
01947              STRING 'DPT '      MB001-DEPT-NUMBER-X                  CL*21
01948                     ' MCL ' MB001-MCLASS-NUMBER-X                    CL*21
01949                     ' LEVEL ' PK-MDSELV-MCL-CODE                     CL*21
01950                     DELIMITED BY SIZE                                CL*21
01951                     INTO DP013-MESSAGE-TEXT(2)                       CL*21
01952              MOVE SQLCA TO DP013-SQLCA                               CL*21
01953              MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)               CL*21
01954              SET DP013-DB2-ABEND TO TRUE                             CL*21
01955              SET DP013-NO-ROLLBACK TO TRUE                           CL*21
01956              SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*21
01957              PERFORM DP013-0000-PROCESS-ABEND                        CL*21
01958      END-EVALUATE.                                                   CL*23
01959  EJECT                                                               CL**3
01960  9005-OPEN-DPT-CURSOR.                                               CL**3
01961                                                                      CL**7
01962 ******************************************************************   CL**7
01963 *    DEPARTMENT WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.   CL**7
01964 *    OPEN DEPARTMENT CURSOR                                          CL**7
01965 ******************************************************************   CL**7
01966                                                                      CL**7
01967      EXEC SQL                                                        CL*23
01968          OPEN DEPT_CURSOR                                            CL*23
01969      END-EXEC                                                        CL*23
01970                                                                      CL*23
01971      EVALUATE TRUE                                                   CL*23
01972          WHEN SQLCODE = ZERO                                         CL*23
01973              CONTINUE                                                CL*23
01974          WHEN SQLWARN0 NOT = SPACES                                  CL*23
01975          WHEN SQLCODE < 0                                            CL*23
01976          WHEN SQLCODE > 0                                            CL*23
01977              MOVE '9005-OPEN-DPT-CURSOR' TO                          CL*23
01978                                       DP013-PARAGRAPH                CL*23
01979              MOVE 'OPEN CURSOR -DEPT     ' TO                        CL*23
01980                                       DP013-MESSAGE-TEXT(1)          CL*23
01981              STRING 'DPT '      MB001-DEPT-NUMBER-X                  CL*23
01982                     ' LEVEL ' PK-MDSELV-DPT-CODE                     CL*23
01983                     DELIMITED BY SIZE                                CL*23
01984                     INTO DP013-MESSAGE-TEXT(2)                       CL*23
01985              MOVE SQLCA TO DP013-SQLCA                               CL*23
01986              MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)               CL*23
01987              SET DP013-DB2-ABEND TO TRUE                             CL*23
01988              SET DP013-NO-ROLLBACK TO TRUE                           CL*23
01989              SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*23
01990              PERFORM DP013-0000-PROCESS-ABEND                        CL*23
01991      END-EVALUATE.                                                   CL*23
01992  9006-CLOSE-DPT-CURSOR.                                              CL**3
01993 ******************************************************************   CL**9
01994 *    DEPARTMENT WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.   CL**9
01995 *    CLOSE DEPARTMENT CURSOR                                         CL**9
01996 ******************************************************************   CL**9
01997                                                                      CL**9
01998      EXEC SQL                                                        CL*23
01999          CLOSE DEPT_CURSOR                                           CL*23
02000      END-EXEC                                                        CL*23
02001                                                                      CL*23
02002      EVALUATE TRUE                                                   CL*23
02003          WHEN SQLCODE = ZERO                                         CL*23
02004              CONTINUE                                                CL*23
02005          WHEN SQLWARN0 NOT = SPACES                                  CL*23
02006          WHEN SQLCODE < 0                                            CL*23
02007          WHEN SQLCODE > 0                                            CL*23
02008              MOVE '9006-CLOSE-DPT-CURSOR' TO                         CL*23
02009                                       DP013-PARAGRAPH                CL*23
02010              MOVE 'CLOSE CURSOR DEPARTMENT' TO                       CL*23
02011                                       DP013-MESSAGE-TEXT(1)          CL*23
02012              STRING 'DPT '      MB001-DEPT-NUMBER-X                  CL*23
02013                     ' LEVEL ' PK-MDSELV-DPT-CODE                     CL*23
02014                     DELIMITED BY SIZE                                CL*23
02015                     INTO DP013-MESSAGE-TEXT(2)                       CL*23
02016              MOVE SQLCA TO DP013-SQLCA                               CL*23
02017              MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)               CL*23
02018              SET DP013-DB2-ABEND TO TRUE                             CL*23
02019              SET DP013-NO-ROLLBACK TO TRUE                           CL*23
02020              SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*23
02021              PERFORM DP013-0000-PROCESS-ABEND                        CL*23
02022      END-EVALUATE.                                                   CL*28
02023                                                                      CL**9
02024  EJECT                                                               CL**3
02025  9007-OPEN-DMA-CURSOR.                                               CL**3
02026                                                                      CL*11
02027 ******************************************************************   CL*11
02028 *    DMA        WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.   CL*11
02029 *    OPEN DMA CURSOR                                                 CL*14
02030 *                                                                    CL*11
02031 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL*11
02032 ******************************************************************   CL*11
02033                                                                      CL*11
02034          EXEC SQL                                                    CL*11
02035              OPEN DMA_CURSOR                                         CL*16
02036          END-EXEC                                                    CL*11
02037                                                                      CL*11
02038          EVALUATE TRUE                                               CL*11
02039              WHEN SQLCODE = ZERO                                     CL*11
02040                  CONTINUE                                            CL*24
02041              WHEN SQLWARN0 NOT = SPACES                              CL*11
02042              WHEN SQLCODE < 0                                        CL*11
02043              WHEN SQLCODE > 0                                        CL*11
02044                  MOVE '9007-OPEN-DMA-CURSOR' TO                      CL*14
02045                                           DP013-PARAGRAPH            CL*11
02046                  MOVE 'OPEN CURSOR DMA'  TO                          CL*14
02047                                           DP013-MESSAGE-TEXT(1)      CL*11
02048                  STRING 'DMA '  MB001-DMA-NUMBER-X                   CL*11
02049                         ' LEVEL ' PK-MDSELV-DMA-CODE                 CL*11
02050                         DELIMITED BY SIZE                            CL*11
02051                         INTO DP013-MESSAGE-TEXT(2)                   CL*11
02052                  MOVE SQLCA TO DP013-SQLCA                           CL*11
02053                  MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)           CL*11
02054                  SET DP013-DB2-ABEND TO TRUE                         CL*11
02055                  SET DP013-NO-ROLLBACK TO TRUE                       CL*11
02056                  SET DP013-XCTL-DISPLAY-RESTART TO TRUE              CL*11
02057                  PERFORM DP013-0000-PROCESS-ABEND                    CL*11
02058          END-EVALUATE.                                               CL*28
02059      EJECT                                                           CL*11
02060                                                                      CL*11
02061  9008-CLOSE-DMA-CURSOR.                                              CL**3
02062                                                                      CL*14
02063 ******************************************************************   CL*14
02064 *    DMA        WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.   CL*14
02065 *    CLOSE DMA CURSOR                                                CL*14
02066 *                                                                    CL*14
02067 *    PERFORMED BY 3300-EDIT-DATA-IN-COMMAREA                         CL*14
02068 ******************************************************************   CL*14
02069      EXEC SQL                                                        CL*26
02070          CLOSE DMA_CURSOR                                            CL*26
02071      END-EXEC                                                        CL*26
02072                                                                      CL*28
02073      EVALUATE TRUE                                                   CL*26
02074          WHEN SQLCODE = ZERO                                         CL*26
02075              CONTINUE                                                CL*26
02076          WHEN SQLWARN0 NOT = SPACES                                  CL*26
02077          WHEN SQLCODE < 0                                            CL*26
02078          WHEN SQLCODE > 0                                            CL*26
02079              MOVE '9008-CLOSE-DMA-CURSOR' TO                         CL*26
02080                                       DP013-PARAGRAPH                CL*26
02081              MOVE 'CLOSE CURSOR DMA'      TO                         CL*26
02082                                       DP013-MESSAGE-TEXT(1)          CL*26
02083              STRING 'DMA '      MB001-DMA-NUMBER-X                   CL*26
02084                     ' LEVEL ' PK-MDSELV-DMA-CODE                     CL*26
02085                     DELIMITED BY SIZE                                CL*26
02086                     INTO DP013-MESSAGE-TEXT(2)                       CL*26
02087              MOVE SQLCA TO DP013-SQLCA                               CL*26
02088              MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)               CL*26
02089              SET DP013-DB2-ABEND TO TRUE                             CL*26
02090              SET DP013-NO-ROLLBACK TO TRUE                           CL*26
02091              SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*26
02092              PERFORM DP013-0000-PROCESS-ABEND                        CL*26
02093      END-EVALUATE.                                                   CL*26
02094  EJECT                                                               CL**3
02095  9009-OPEN-GMA-CURSOR.                                               CL**3
02096                                                                      CL*16
02097 ******************************************************************   CL*16
02098 *    GMA        WAS THE LAST SPECIFIC VALUE ENTERED ON THE SCREEN.   CL*16
02099 *    OPEN GMA CURSOR                                                 CL*16
02100 ******************************************************************   CL*16
02101                                                                      CL*16
02102        EXEC SQL                                                      CL*26
02103            OPEN GMA_CURSOR                                           CL*26
02104        END-EXEC                                                      CL*26
02105                                                                      CL*26
02106        EVALUATE TRUE                                                 CL*26
02107            WHEN SQLCODE = ZERO                                       CL*26
02108                CONTINUE                                              CL*26
02109            WHEN SQLWARN0 NOT = SPACES                                CL*26
02110            WHEN SQLCODE < 0                                          CL*26
02111            WHEN SQLCODE > 0                                          CL*26
02112                MOVE '9009-OPEN-GMA-CURSOR' TO                        CL*26
02113                                         DP013-PARAGRAPH              CL*26
02114                MOVE 'OPEN GMA CURSOR'    TO                          CL*26
02115                                         DP013-MESSAGE-TEXT(1)        CL*26
02116                STRING 'GMA '    MB001-GMA-NUMBER-X                   CL*26
02117                       ' LEVEL ' PK-MDSELV-GMA-CODE                   CL*26
02118                       DELIMITED BY SIZE                              CL*26
02119                       INTO DP013-MESSAGE-TEXT(2)                     CL*26
02120                MOVE SQLCA TO DP013-SQLCA                             CL*26
02121                MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)             CL*26
02122                SET DP013-DB2-ABEND TO TRUE                           CL*26
02123                SET DP013-NO-ROLLBACK TO TRUE                         CL*26
02124                SET DP013-XCTL-DISPLAY-RESTART TO TRUE                CL*26
02125                PERFORM DP013-0000-PROCESS-ABEND                      CL*26
02126        END-EVALUATE.                                                 CL*26
02127  9010-CLOSE-GMA-CURSOR.                                              CL**3
02128                                                                      CL*17
02129      EXEC SQL                                                        CL*18
02130          CLOSE GMA_CURSOR                                            CL*18
02131      END-EXEC                                                        CL*18
02132                                                                      CL*28
02133      EVALUATE TRUE                                                   CL*28
02134          WHEN SQLCODE = ZERO                                         CL*18
02135              CONTINUE                                                CL*18
02136          WHEN SQLWARN0 NOT = SPACES                                  CL*18
02137          WHEN SQLCODE < 0                                            CL*18
02138          WHEN SQLCODE > 0                                            CL*18
02139              MOVE '9010-CLOSE-GMA-CURSOR' TO                         CL*18
02140                                       DP013-PARAGRAPH                CL*18
02141              MOVE 'CLOSE GMA CURSOR'      TO                         CL*18
02142                                       DP013-MESSAGE-TEXT(1)          CL*18
02143              STRING 'GMA '      MB001-GMA-NUMBER-X                   CL*18
02144                     ' LEVEL ' PK-MDSELV-GMA-CODE                     CL*18
02145                     DELIMITED BY SIZE                                CL*18
02146                     INTO DP013-MESSAGE-TEXT(2)                       CL*18
02147              MOVE SQLCA TO DP013-SQLCA                               CL*18
02148              MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)               CL*18
02149              SET DP013-DB2-ABEND TO TRUE                             CL*18
02150              SET DP013-NO-ROLLBACK TO TRUE                           CL*18
02151              SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*18
02152              PERFORM DP013-0000-PROCESS-ABEND                        CL*18
02153      END-EVALUATE.                                                   CL*18
02154  EJECT                                                               CL**3
02155 ******************************************************************MBKCS101
02156 *    FILL IN SCREEN HEADER MODULE                                 MBKCS101
02157 ******************************************************************MBKCS101
02158                                                                   MBKCS101
02159      COPY DPPD002.                                                   CL*14
02160  EJECT                                                            MBKCS101
02161 ******************************************************************MBKCS101
02162 *    RETURN TO CICS MODULE                                        MBKCS101
02163 ******************************************************************MBKCS101
02164                                                                   MBKCS101
02165      COPY DPPD003.                                                   CL*14
02166  EJECT                                                            MBKCS101
02167 ******************************************************************MBKCS101
02168 *    FORMAT MESSAGE LINES MODULE                                  MBKCS101
02169 ******************************************************************MBKCS101
02170                                                                   MBKCS101
02171      COPY DPPD005.                                                   CL114
02172  EJECT                                                            MBKCS101
02173 ******************************************************************MBKCS101
02174 *    GET PANEL MODULE                                             MBKCS101
02175 ******************************************************************MBKCS101
02176                                                                   MBKCS101
02177      COPY DPPD007.                                                   CL*14
02178  EJECT                                                            MBKCS101
02179 ******************************************************************MBKCS101
02180 *    WRITE PANEL MODULE                                           MBKCS101
02181 ******************************************************************MBKCS101
02182                                                                   MBKCS101
02183      COPY DPPD008.                                                   CL*14
02184  EJECT                                                            MBKCS101
02185 ******************************************************************MBKCS101
02186 *    TOGGLE THE FUNCTION KEY LINE MODULE                          MBKCS101
02187 ******************************************************************MBKCS101
02188                                                                   MBKCS101
02189      COPY DPPD009.                                                   CL*14
02190  EJECT                                                            MBKCS101
02191 ******************************************************************MBKCS101
02192 *    ABEND PROCESSOR MODULE                                       MBKCS101
02193 ******************************************************************MBKCS101
02194                                                                   MBKCS101
02195      COPY DPPD013.                                                   CL*14
02196  EJECT                                                            MBKCS101
02197 ******************************************************************MBKCS101
02198 *    CHECK COMMUNICATION AREA MODULE                              MBKCS101
02199 ******************************************************************MBKCS101
02200                                                                   MBKCS101
02201      COPY DPPD015.                                                   CL*14
02202  EJECT                                                            MBKCS101
02203 ******************************************************************MBKCS101
02204 *    UPDATE TIME AND DATE MODULE                                  MBKCS101
02205 ******************************************************************MBKCS101
02206                                                                   MBKCS101
02207      COPY DPPD017.                                                   CL*14
02208  EJECT                                                            MBKCS101
