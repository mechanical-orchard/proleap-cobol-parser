000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    MBKCS113.                                         00040001
000500 AUTHOR.        MIKE FURLICK.                                     00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  10-10-91.                                         00070001
000800 DATE-COMPILED.                                                   00080001
000900                                                                  00090001
001000*----------------------------------------------------------------*00100001
001100*    R113 - MERCHANDISE DEPARTMENT INQUIRY                       *00110001
001200*                                                                *00120001
001300*    THIS PROGRAM DISPLAYS THE BUSINESS GROUP, DISCOUNT CODE,    *00130001
001400*    A/R DESCRIPTION, A/R LAST CHANGED, AND LAST CHANGED DATE    *00140001
001500*    FOR THE SELECTED DEPARTMENT. THE GMA, DMA, AND DEPARTMENT   *00150001
001600*    (CODES AND DESCRIPTIONS) ARE ALSO DISPLAYED.                *00160001
001700*    PF20 "PAGES" TO THE NEXT SET OF READ CRITERIA SUPPLIED BY   *00170001
001800*    MBKCS112 (MERCHANDISE DEPARTMENT LIST).                     *00180001
001900*                                                                *00190001
002000*----------------------------------------------------------------*00200001
002100*    06/20/94 - AJR WR2602 GROUP PRICING                         *00210001
002200*    REMOVED THE OWNERSHIP INDICATOR.  ALL GROUP PRICED ITEMS    *00220001
002300*    WILL BE OWNED AT THE LOW (GROUP EACH PRICE).                *00230001
002400*----------------------------------------------------------------*00240001
002500*                                                                *00250001
002600*----------------------------------------------------------------*00260001
002700*    06/12/95 - DMH WR9999 SHRINK ENHANCEMENTS                   *00270001
002800*    DISPLAY THE SHRINK PERCENTAGES FOR BOTH THE CURRENT AND     *00280001
002900*    PREVIOUS FISCAL PERIODS.                                    *00290001
003000*----------------------------------------------------------------*00300001
003100*----------------------------------------------------------------*00310001
003200*    06/28/96 - WR #3931 FS INDICATOR                            *00320001
003300*    ADD TWO NEW FIELDS FOR INQUIRY ONLY...                      *00330001
003400*       RPT # OF DAYS BEFORE SHIPMENT                            *00340001
003500*       RPT # OF DAYS AFTER CLEARANCE                            *00350001
003600*----------------------------------------------------------------*00360001
003610*----------------------------------------------------------------*00370001
003620*    08/17/98 - DGM WR #5701                                     *00380001
003621*               REMOVED DP060 LOGIC AND SHRINK FOR PREVIOUS      *00390001
003630*    FISCAL PERIOD.  ALSO ADDED LOGIC TO USE NEW MLCNTL TABLE    *00400001
003640*    IN ORDER TO DISPLAY THE SHRINK PERCENT FOR THE CURRENT OPEN *00410001
003650*    FISCAL PERIOD.                                              *00420001
003660*----------------------------------------------------------------*00430001
C14666*----------------------------------------------------------------*00440001
C14666*    07/10/12   CRQ000000014666         RAVIKUMAR GUNTHA         *00450006
C14666*    - REMOVED FIELDS 'EFFECTIVE FOR FISCAL PERIOD' AND          *00460001
C14666*     'LAST CHANGED'.                                            *00470003
C14666*    - MOVE PLANNED FREIGHT PERCENT UP ONE ROW.                  *00480001
C14666*    - ADDED LOCATION TYPE AND B&M, ECOM HEADERS.                *00490001
C14666*    - ADDED PLANNED SHRINK PERCENT LABLE                        *00500001
C14666*    - EXPANDED SHRINK PERCENT BY 1 POSITION AFTER DECIMAL AND   *00510001
C14666*      ALLOW -VES AND ADDED ECOM PERCENT                         *00520001
C14666*    - ADDED LAST CHANGE DATE FOR B&M AND ECOM                   *00530001
C14666*    - ADDED LAST CHANGE USER FOR B&M AND ECOM                   *00540001
C14666*    - CHANGES MADE TO DISPLAY SHRINK PERCENT FROM THE CURRENT   *00550003
C14666*      FISCAL MONTH INSTEAD OF ML OPEN MONTH                     *00560003
C14666*----------------------------------------------------------------*00570001
003700                                                                  00580001
003800                                                                  00590001
003900                                                                  00600001
004000 ENVIRONMENT DIVISION.                                            00610001
004100                                                                  00620001
004200                                                                  00630001
004300                                                                  00640001
004400 DATA DIVISION.                                                   00650001
004500                                                                  00660001
004600                                                                  00670001
004700 WORKING-STORAGE SECTION.                                         00680001
004800                                                                  00690001
004900 01  PC-PROGRAM-CONSTANTS.                                        00700001
005000     05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.00710001
005100     05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072  00720001
005200                                                     COMP SYNC.   00730001
005300     05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE        00740001
005400     'MB113A  '.                                                  00750001
005500     05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE        00760001
005600     'MBKM113 '.                                                  00770001
005700     05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE        00780001
005800     'MBKCS113'.                                                  00790001
005900     05  PC-ZERO                        PIC X(3)     VALUE '000'. 00800001
006000     05  PC-DPT                         PIC X(3)     VALUE 'DPT'. 00810001
006100     05  PC-DMA                         PIC X(3)     VALUE 'DMA'. 00820001
006200     05  PC-GMA                         PIC X(3)     VALUE 'GMA'. 00830001
006300     05  PC-1                           PIC X(1)     VALUE '1'.   00840001
006400     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00850001
006500                                                     COMP-3.      00860001
006600 01  PC-COMPANY                         PIC XX       VALUE '03'.  00870001
006700                                                                  00880001
006800 01  PC-TSYMSG-NUMBERS.                                           00890001
006900     05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.  00900001
007000     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00910001
007100     05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.  00920001
007200     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00930001
007300     05  PC-TSYMSG-00051                PIC 9(5)    VALUE 00051.  00940001
007400     05  PC-TSYMSG-00052                PIC 9(5)    VALUE 00052.  00950001
007500     05  PC-TSYMSG-00053                PIC 9(5)    VALUE 00053.  00960001
007600     05  PC-TSYMSG-00054                PIC 9(5)    VALUE 00054.  00970001
007700     05  PC-TSYMSG-00055                PIC 9(5)    VALUE 00055.  00980001
007800     05  PC-TSYMSG-00057                PIC 9(5)    VALUE 00057.  00990001
007900     05  PC-TSYMSG-00061                PIC 9(5)    VALUE 00061.  01000001
008000     05  PC-TSYMSG-00062                PIC 9(5)    VALUE 00062.  01010001
008100     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  01020001
008200     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  01030001
008300     05  PC-TSYMSG-99901                PIC 9(5)    VALUE 99901.  01040001
008400                                                                  01050001
008500 01  PM-PROGRAM-MESSAGES.                                         01060001
008600     05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE        01070001
008700     'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                01080001
008800     05  PM-PROGRAM-MESSAGE-22          PIC X(78)    VALUE        01090001
008900     'LOGIC ERROR IN TRYING TO READ MD LIST QUEUE - RESP = '.     01100001
009000     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-22.                  01110001
009100         10  FILLER                     PIC X(61).                01120001
009200         10  PM-RESP-22                 PIC 9999.                 01130001
009300         10  FILLER                     PIC X(13).                01140001
009400                                                                  01150001
009500 01  PS-PROGRAM-SUBSCRIPTS.                                       01160001
009600     05  PS-SUB                         PIC S9(04)   VALUE +0     01170001
009700                                                     COMP SYNC.   01180001
009800     05  PS-DP-SUB1                     PIC S9(04)   VALUE +0     01190001
009900                                                     COMP SYNC.   01200001
010000     05  PS-DP-SUB2                     PIC S9(04)   VALUE +0     01210001
010100                                                     COMP SYNC.   01220001
010200     05  PS-ITEM-SUB                    PIC S9(09)   VALUE +0     01230001
010300                                                     COMP-3.      01240001
010400                                                                  01250001
010500 01  PS-PROGRAM-SWITCHES.                                         01260001
010600     05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.   01270001
010700         88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.   01280001
010800         88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.   01290001
010900         88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.   01300001
011000         88  PS-SEND-DATA-ONLY                       VALUE '4'.   01310001
011100         88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.   01320001
011200         88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.   01330001
011300     05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.   01340001
011400         88  PS-ERROR                                VALUE 'Y'.   01350001
011500         88  PS-NO-ERROR                             VALUE 'N'.   01360001
011600     05  PS-INTER-APPL-VALID-SW         PIC X(01)    VALUE 'N'.   01370001
011700         88  PS-INTER-APPL-VALID                     VALUE 'Y'.   01380001
011800         88  PS-INTER-APPL-NOT-VALID                 VALUE 'N'.   01390001
011900     05  PS-PROCESSING-SW               PIC X(01)    VALUE 'N'.   01400001
012000         88  PS-CONTINUE                             VALUE 'Y'.   01410001
012100         88  PS-DONT-PROCESS                         VALUE 'N'.   01420001
012200     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.   01430001
012300         88  PS-COMMAREA-VALID                       VALUE 'Y'.   01440001
012400         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   01450001
012500/                                                                 01460001
012600 01  PV-PROGRAM-VARIABLES.                                        01470001
012700     05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0     01480001
012800                                                     COMP SYNC.   01490001
012900     05  PV-RESP                        PIC S9(04)   VALUE +0     01500001
013000                                                     COMP SYNC.   01510001
013100     05  PV-ITEM                        PIC S9(04)   VALUE +0     01520001
013200                                                     COMP SYNC.   01530001
013300     05  PV-DP-ITEM                     PIC S9(04)   VALUE +0     01540001
013400                                                     COMP SYNC.   01550001
013500     05  PV-NULL-IND                    PIC S9(04)   VALUE +0     01560001
013600                                                     COMP SYNC.   01570001
013700     05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.01580001
013800     05  PV-SQL-SUB                     PIC S9(4)    COMP.        01590001
013900     05  PV-RETRY-COUNTER               PIC S9(3)    COMP-3.      01600001
014000     05  PV-WORK-DATE.                                            01610001
014100         10  PV-WD-MM                   PIC XX.                   01620001
014200         10  FILLER                     PIC X        VALUE '/'.   01630001
014300         10  PV-WD-DD                   PIC XX.                   01640001
014400         10  FILLER                     PIC X        VALUE '/'.   01650001
014500         10  PV-WD-YY                   PIC XX.                   01660001
C14666     05  PV-WORK-DATE1.                                           01670001
C14666         10  PV-WRK-MM                  PIC XX.                   01680001
C14666         10  FILLER                     PIC X        VALUE '/'.   01690001
C14666         10  PV-WRK-DD                  PIC XX.                   01700001
C14666         10  FILLER                     PIC X        VALUE '/'.   01710001
C14666         10  PV-WRK-CCYY                PIC XXXX.                 01720001
014600     05  PV-WORK-DATE-CCYY.                                       01730001
014700         10  PV-WD-CCYY                 PIC X(04).                01740001
014800         10  FILLER                     PIC X(06).                01750001
014900     05  PV-PLAN-FRGT-PCT               PIC SV999.                01760001
015000     05  PV-PLAN-FRGT-PCT2  REDEFINES  PV-PLAN-FRGT-PCT           01770001
015100                                        PIC S99V9.                01780001
015200     05  PV-SHRINK-WORK-AREA.                                     01790001
015300         10  FILLER                     PIC X(4).                 01800001
015400         10  FILLER                     PIC X(4).                 01810001
015500         10  FILLER                     PIC X(26).                01820001
C14666         10  PV-SHRINK-PCT  OCCURS 12   PIC S99V99  COMP-3.       01830001
C14666         10  FILLER                     PIC X(1).                 01840001
C14666         10  PV-SHNK-PCT-CHG-DTE        PIC X(10).                01850001
C14666         10  PV-LAST-UPD-BY-USR         PIC X(8).                 01860001
015700     05  PV-SHRINK-SUB                  PIC S9(4)  COMP.          01870001
015800     05  PV-WORK-CCYY                   PIC 9(4).                 01880001
015900                                                                  01890001
016000 01  PV-DB2-DATE.                                                 01900001
C14666     05  PV-DD-YEAR.                                              01910001
C14666         10  PV-DD-CC                   PIC XX.                   01920001
C14666         10  PV-DD-YY                   PIC XX.                   01930001
016300     05  FILLER                         PIC X.                    01940001
016400     05  PV-DD-MM                       PIC XX.                   01950001
016500     05  FILLER                         PIC X.                    01960001
016600     05  PV-DD-DD                       PIC XX.                   01970001
016700/                                                                 01980001
016800***************************************************************** 01990001
016900*    STANDARD COMMAREA.                                           02000001
017000***************************************************************** 02010001
017100                                                                  02020001
017200     COPY DPWS020.                                                02030001
017300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02040001
017400                                                                  02050001
017500***************************************************************** 02060001
017600*    INTER-APPLICATION COMMAREA.                                  02070001
017700***************************************************************** 02080001
017800                                                                  02090001
017900         10  INTER-APPL-COMM-AREA       PIC X(200).               02100001
018000     COPY MBWS005.                                                02110001
018100***************************************************************** 02120001
018200*    SPECIFIC COMMMAREA FOR MBKCS113.                             02130001
018300***************************************************************** 02140001
018400         10  MB113-SPECIFIC-COMMAREA.                             02150001
018500             15  MB113-APPL-CURSOR-POSITION          PIC S9(04)   02160001
018600                                                     COMP.        02170001
018700             15  MB113-DP-SUB                        PIC S9(4)    02180001
018800                                                         COMP.    02190001
018900             15  MB113-DP-ITEM                       PIC S9(4)    02200001
019000                                                         COMP.    02210001
019100             15  MB113-LAST-KEY.                                  02220001
019200                 20  MB113-LAST-GMA-NBR              PIC X(02).   02230001
019300                 20  MB113-LAST-DMA-NBR              PIC X(02).   02240001
019400                 20  MB113-LAST-DEPT-NBR             PIC X(03).   02250001
019500             15  MB113-GMA-DESC                      PIC X(25).   02260001
019600             15  MB113-DMA-DESC                      PIC X(25).   02270001
019700             15  MB113-DEPT-DESC                     PIC X(25).   02280001
019800             15  MB113-BGP-DESC                      PIC X(25).   02290001
019900             15  MB113-BUSINESS-GROUP                PIC X(3).    02300001
020000             15  MB113-DISCOUNT-CODE                 PIC XX.      02310001
020100             15  MB113-AR-DESC                       PIC X(25).   02320001
020200             15  MB113-CONS-IND                      PIC X.       02330001
020300             15  MB113-SKU-LVL-UPD-IND               PIC X.       02340001
020400             15  MB113-PLAN-FRGT-PCT                 PIC Z9.9.    02350001
C14666             15  MB113-BM-SHRINK-PCT-CURRX.                       02360001
C14666                 20  MB113-BM-SHRINK-PCT-CURR        PIC --9.99.  02370004
C14666             15  MB113-ECOM-SHRINK-PCT-CURRX.                     02380001
C14666                 20  MB113-ECOM-SHRINK-PCT-CURR      PIC --9.99.  02390004
C14666             15  MB113-BM-SHNK-LAST-CHG-DTE          PIC X(10).   02400001
C14666             15  MB113-ECOM-SHNK-LAST-CHC-DTE        PIC X(10).   02410001
C14666             15  MB113-BM-SHNK-LAST-CHG-USR          PIC X(08).   02420001
C14666             15  MB113-ECOM-SHNK-LAST-CHC-USR        PIC X(08).   02430001
C14666*            15  MB113-SHRINK-FIS-CURR               PIC X(2).    02440001
C14666*            15  MB113-SHRINK-FIS-CURR-N                          02450001
C14666*                    REDEFINES MB113-SHRINK-FIS-CURR PIC 9(2).    02460001
C14666*            15  MB113-FIS-MONTH-NM                  PIC X(9).    02470001
021100             15  MB113-AR-CHANGE-DATE                PIC X(8).    02480001
C14666*            15  MB113-CHANGE-DATE                   PIC X(8).    02490001
021300             15  MB113-DAYS-BEF-SHIP-NBR             PIC 9(3).    02500001
021400             15  MB113-DAYS-AFT-CLR-NBR              PIC 9(3).    02510001
021500             15  MB113-STORE-ZN-ID                   PIC X(5).    02520001
021600             15  MB113-STORE-ZN-DESC                 PIC X(20).   02530001
021700             15  MB113-TEMP-QUEUE-NAME.                           02540001
021800                 20  MB113-TERM-ID                   PIC X(4).    02550001
021900                 20  MB113-TASK-NUMBER               PIC S9(7)    02560001
022000                                                         COMP-3.  02570001
022100             15  MB113-LIST-SWITCH                   PIC X.       02580001
022200                 88  MB113-LIST-EXISTS               VALUE 'Y'.   02590001
022300                 88  MB113-IS-NO-LIST                VALUE 'N'.   02600001
022400             15  MB113-SAVE-INTER-APPL-COMMAREA      PIC X(192).  02610001
022500             15  MB113-SAVE-LIST-RECORD              PIC X(2100). 02620001
022600*                                                                 02630001
022700     EJECT                                                        02640001
022800***************************************************************** 02650001
022900*    MERCHANDISE DEPARTMENT LIST RECORD LAYOUT.                   02660001
023000***************************************************************** 02670001
023100 01 DP-LIST-RECORD.                                               02680001
023200     COPY MBWS003.                                                02690001
023300                                                                  02700001
023400*                                                                 02710001
023500     EJECT                                                        02720001
023600***************************************************************** 02730001
023700*    ABEND PROCESSING COPYBOOK.                                   02740001
023800***************************************************************** 02750001
023900                                                                  02760001
024000     COPY DPWS013.                                                02770001
024100                                                                  02780001
024200     EJECT                                                        02790001
024300***************************************************************** 02800001
024400*    ATTRIBUTE SETTINGS COPYBOOK.                                 02810001
024500***************************************************************** 02820001
024600                                                                  02830001
024700     COPY DPWS015.                                                02840001
024800                                                                  02850001
024900***************************************************************** 02860001
025000*    CURRENT DATE AND TIME COPYBOOK.                              02870001
025100***************************************************************** 02880001
025200                                                                  02890001
025300     COPY DPWS017.                                                02900001
025400                                                                  02910001
025500***************************************************************** 02920001
025600*    TOGGLE FUNCTION KEY LINES COPYBOOK.                          02930001
025700***************************************************************** 02940001
025800                                                                  02950001
025900     COPY DPWS009.                                                02960001
026000                                                                  02970001
026100***************************************************************** 02980001
026200*    FUNCTION KEYS COPYBOOK.                                      02990001
026300***************************************************************** 03000001
026400                                                                  03010001
026500     COPY DPWS016.                                                03020001
026600                                                                  03030001
026700***************************************************************** 03040001
026800*    VARIABLE MESSAGE AREA.                                       03050001
026900***************************************************************** 03060001
027000                                                                  03070001
027100     COPY DPWS006.                                                03080001
027200                                                                  03090001
027300***************************************************************** 03100001
027400*    DPKUT045 COPYBOOK.                                           03110001
027500***************************************************************** 03120001
027600                                                                  03130001
027700     COPY DPWS045.                                                03140001
027800                                                                  03150001
027900***************************************************************** 03160001
028000*    NUMERIC EDIT LAYOUT.                                         03170001
028100***************************************************************** 03180001
028200                                                                  03190001
028300     COPY DPWS010I.                                               03200001
028400                                                                  03210001
028500***************************************************************** 03220001
028600*    MESSAGE RECORD LAYOUT                                        03230001
028700***************************************************************** 03240001
028800                                                                  03250001
028900     COPY DPRD507I.                                               03260001
029000                                                                  03270001
029100***************************************************************** 03280001
029200*    STANDARD ATTENTION IDENTIFIER LIST                           03290001
029300***************************************************************** 03300001
029400                                                                  03310001
029500     COPY DFHAID.                                                 03320001
029600                                                                  03330001
029700***************************************************************** 03340001
029800*    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST        03350001
029900***************************************************************** 03360001
030000                                                                  03370001
030100     COPY DFHBMSCA.                                               03380001
030200                                                                  03390001
030300***************************************************************** 03400001
030400*    MAP LAYOUT                                                   03410001
030500***************************************************************** 03420001
030600                                                                  03430001
030700     COPY MBKM113.                                                03440001
030800 01  MD-MAP-DATA-AREA  REDEFINES MB113AO PIC X(1200).             03450001
030900*                                                                 03460001
031000 EJECT                                                            03470001
031100*                                                                 03480001
031200*    DB2 AREA FOR MERCHANDISE AREA                                03490001
031300*                                                                 03500001
031400     EXEC SQL                                                     03510001
031500          INCLUDE TMDSEAR                                         03520001
031600     END-EXEC.                                                    03530001
031700*                                                                 03540001
031800*    DB2 AREA FOR MERCHANDISE DEPARTMENT                          03550001
031900*                                                                 03560001
032000     EXEC SQL                                                     03570001
032100          INCLUDE TMDSEDP                                         03580001
032200     END-EXEC.                                                    03590001
032300*                                                                 03600001
032400*    DB2 AREA FOR DEPARTMENT SHRINK                               03610001
032500*                                                                 03620001
032600     EXEC SQL                                                     03630001
032700          INCLUDE TDPTSHK                                         03640001
032800     END-EXEC.                                                    03650001
032900*                                                                 03660001
033000*    DB2 AREA FOR BUSINESS GROUP                                  03670001
033100*                                                                 03680001
033200     EXEC SQL                                                     03690001
033300          INCLUDE TMDSEBG                                         03700001
033400     END-EXEC.                                                    03710001
033500*                                                                 03720001
033600*    DB2 AREA FOR THE STORE ZONE MASTER TABLE                     03730001
033700*                                                                 03740001
033800     EXEC SQL                                                     03750001
033900          INCLUDE TSTRZN                                          03760001
034000     END-EXEC.                                                    03770001
034100*                                                                 03780001
034200*    DB2 AREA FOR THE MERCH LEDGER CONTROL TABLE                  03790001
034300*                                                                 03800001
C14666*    EXEC SQL                                                     03810001
C14666*         INCLUDE TMLCNTL                                         03820001
C14666*    END-EXEC.                                                    03830001
038600*                                                                 03840001
038700*    DB2 AREA FOR THE MERCH LEDGER DATE TABLE                     03850001
038800*                                                                 03860001
038900     EXEC SQL                                                     03870001
039000          INCLUDE TDTATTR                                         03880001
039100     END-EXEC.                                                    03890001
039200*                                                                 03900001
039300*    DB2 AREA FOR COMMUNICATIONS                                  03910001
039400*                                                                 03920001
039500     EXEC SQL                                                     03930001
039600          INCLUDE SQLCA                                           03940001
039700     END-EXEC.                                                    03950001
039800*                                                                 03960001
039900 EJECT                                                            03970001
040000 LINKAGE SECTION.                                                 03980001
040100                                                                  03990001
040200 01  DFHCOMMAREA.                                                 04000001
040300     05  FILLER                         OCCURS  1 TO 4072 TIMES   04010001
040400                                        DEPENDING ON EIBCALEN.    04020001
040500         10  FILLER                     PIC X.                    04030001
040600                                                                  04040001
040700*                                                                 04050001
040800*                                                                 04060001
040900*                                                                 04070001
041000 PROCEDURE DIVISION.                                              04080001
041100                                                                  04090001
041200                                                                  04100001
041300 0000-MAIN-MODULE.                                                04110001
041400                                                                  04120001
041500******************************************************************04130001
041600*    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.           04140001
041700******************************************************************04150001
041800                                                                  04160001
041900     PERFORM DP015-0000-CHECK-COMMAREA.                           04170001
042000                                                                  04180001
042100     IF DP020-SRC-RETURN-W-TRAN-ID                                04190001
042200         PERFORM 1000-CONTROL-PROCESSING                          04200001
042300     END-IF.                                                      04210001
042400                                                                  04220001
042500     PERFORM DP003-0000-RETURN-TO-CICS.                           04230001
042600 EJECT                                                            04240001
042700******************************************************************04250001
042800*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT    04260001
042900*    COURSE OF ACTION IS FOR THIS TRANSACTION.                    04270001
043000*                                                                 04280001
043100*    PERFORMED BY 0000-MAIN-MODULE.                               04290001
043200******************************************************************04300001
043300*                                                                 04310001
043400 1000-CONTROL-PROCESSING.                                         04320001
043500*                                                                 04330001
043600     SET PS-CONTINUE           TO  TRUE.                          04340001
043700*                                                                 04350001
043800     EVALUATE TRUE                                                04360001
043900         WHEN DP020-NEXT-ACT-INITIAL                              04370001
044000             PERFORM 4100-VALIDATE-COMMAREA                       04380001
044100             IF  PS-COMMAREA-NOT-VALID                            04390001
044200                 MOVE PC-TSYMSG-99901                             04400001
044300                               TO  DP020-MSG-NUMBER               04410001
044400                 MOVE DP016-PF3                                   04420001
044500                               TO  DP020-SRC-AID                  04430001
044600                 SET DP020-MSG-FATAL                              04440001
044700                               TO  TRUE                           04450001
044800                 PERFORM DP015-1000-START-NAVIGATOR               04460001
044900             ELSE                                                 04470001
045000                 INITIALIZE MB113-SPECIFIC-COMMAREA               04480001
045100                 SET PS-SEND-MAP-N-DATA-FRSET                     04490001
045200                               TO  TRUE                           04500001
045300                 SET DP020-NEXT-ACT-READ-MAP                      04510001
045400                               TO  TRUE                           04520001
045500                 PERFORM 2000-BUILD-INITIAL-PANEL                 04530001
045600             END-IF                                               04540001
045700*                                                                 04550001
045800         WHEN DP020-NEXT-ACT-READ-MAP                             04560001
045900             PERFORM 3000-PROCESS-PANEL                           04570001
046000*                                                                 04580001
046100         WHEN DP020-NEXT-ACT-RETURN                               04590001
046200             SET PS-SEND-MAP-N-DATA-FRSET                         04600001
046300                               TO  TRUE                           04610001
046400             MOVE MB113-SAVE-INTER-APPL-COMMAREA                  04620001
046500                               TO  MB005-INTER-APPL-COMMAREA      04630001
046600             PERFORM 3400-MOVE-COMMAREA-TO-SCREEN                 04640001
046700             PERFORM 2200-DISPLAY-PANEL                           04650001
046800*                                                                 04660001
046900         WHEN DP020-NEXT-ACT-ERROR                                04670001
047000             MOVE DP020-MSG-MESSAGE TO PV-MESSAGE                 04680001
047100             IF DP020-NAV-MNEMONIC = SPACES                       04690001
047200                 MOVE SPACES   TO  ANAVCMDO                       04700001
047300                 MOVE DP015-UNDERLINE                             04710001
047400                               TO  ANAVCMDH                       04720001
047500                 MOVE DP015-GREEN                                 04730001
047600                               TO  ANAVCMDC                       04740001
047700             ELSE                                                 04750001
047800                 MOVE DP015-REVERSE                               04760001
047900                               TO  ANAVCMDH                       04770001
048000                 MOVE DP015-RED                                   04780001
048100                               TO  ANAVCMDC                       04790001
048200             END-IF                                               04800001
048300*                                                                 04810001
048400             MOVE PV-MESSAGE   TO  DP020-MSG-MESSAGE              04820001
048500                                                                  04830001
048600             SET DP020-MSG-FATAL                                  04840001
048700                               TO  TRUE                           04850001
048800             SET PS-SEND-DATA-ONLY-FRSET                          04860001
048900                               TO  TRUE                           04870001
049000             PERFORM 2200-DISPLAY-PANEL                           04880001
049100*                                                                 04890001
049200         WHEN OTHER                                               04900001
049300             SET DP013-LOGIC-ABEND TO TRUE                        04910001
049400             SET DP013-NO-ROLLBACK TO TRUE                        04920001
049500             MOVE 'B100-CONTROL-PROCESSING'                       04930001
049600                               TO  DP013-PARAGRAPH                04940001
049700             MOVE PM-PROGRAM-MESSAGE-12                           04950001
049800                               TO  DP013-MESSAGE-TEXT(1)          04960001
049900             PERFORM DP013-0000-PROCESS-ABEND                     04970001
050000     END-EVALUATE.                                                04980001
050100*                                                                 04990001
050200 EJECT                                                            05000001
050300******************************************************************05010001
050400*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST      05020001
050500*    ENTRY.                                                       05030001
050600*                                                                 05040001
050700*    PERFORMED BY 1000-CONTROL-PROCESSING.                        05050001
050800******************************************************************05060001
050900*                                                                 05070001
051000 2000-BUILD-INITIAL-PANEL.                                        05080001
051100*                                                                 05090001
051200     MOVE 1                    TO  MB113-DP-ITEM                  05100001
051300                                   MB113-DP-SUB.                  05110001
051400     IF  DP020-MB-MERCH-DEPT-LIST                                 05120001
051500         PERFORM 2150-READ-LIST-QUEUE                             05130001
051600         MOVE MB003-KEY-DATA (1)                                  05140001
051700                               TO  MB113-LAST-KEY                 05150001
051800         SET MB113-LIST-EXISTS TO  TRUE                           05160001
051900         MOVE DP-LIST-RECORD   TO  MB113-SAVE-LIST-RECORD         05170001
052000     ELSE                                                         05180001
052100         MOVE MB005-REQUEST-DATA                                  05190001
052200                               TO  MB113-LAST-KEY                 05200001
052300         SET MB113-IS-NO-LIST  TO  TRUE                           05210001
052400     END-IF.                                                      05220001
052500*                                                                 05230001
052600     PERFORM 2100-RETRIEVE-DATA-FOR-PANEL.                        05240001
052700*                                                                 05250001
052800     PERFORM 2200-DISPLAY-PANEL.                                  05260001
052900*                                                                 05270001
053000 EJECT                                                            05280001
053100******************************************************************05290001
053200*    DETERMINE WHAT LEVEL OF DATA WAS PASSED AND PERFORM THE      05300001
053300*    READ FOR EACH LEVEL.                                         05310001
053400*                                                                 05320001
053500*    PERFORMED BY 2000, 2160, 3000                                05330001
053600******************************************************************05340001
053700*                                                                 05350001
053800 2100-RETRIEVE-DATA-FOR-PANEL.                                    05360001
053900                                                                  05370001
054000*                                                                 05380001
054100*    SET UP THE HOST VARIABLES.                                   05390001
054200*                                                                 05400001
054300     MOVE MB113-LAST-GMA-NBR   TO  MDSEAR-GMA-NBR.                05410001
054400     MOVE MB113-LAST-DMA-NBR   TO  MDSEAR-DMA-NBR.                05420001
054500     MOVE MB113-LAST-DEPT-NBR  TO  MDSEAR-DEPT-NBR.               05430001
054600     MOVE ZERO                 TO  MDSEAR-MAJ-CL-NBR.             05440001
054700     MOVE ZERO                 TO  MDSEAR-SUB-CL-NBR.             05450001
054800     MOVE PC-DPT               TO  MDSEAR-MDSELV-CDE.             05460001
054900*                                                                 05470001
055000*    NOW, READ THE ROW AND MOVE THE LOWEST LEVEL DETAIL INFO      05480001
055100*    TO THE COMM AREA.                                            05490001
055200*                                                                 05500001
055300     PERFORM 2120-READ-MDSEDP.                                    05510001
055400     PERFORM 2170-GET-SHRINK-MONTH-INFO.                          05520001
055500     MOVE MDSEAR-DESC          TO  MB113-DEPT-DESC.               05530001
055600     MOVE MDSEDP-MDSEBG-NBR    TO  MB113-BUSINESS-GROUP.          05540001
055700     MOVE MDSEDP-DPTDIS-CDE    TO  MB113-DISCOUNT-CODE.           05550001
055800     MOVE MDSEDP-ARDEPT-DESC   TO  MB113-AR-DESC.                 05560001
055900     MOVE MDSEDP-CONS-IND      TO  MB113-CONS-IND.                05570001
056000     MOVE MDSEDP-DAYS-BEF-SHIP-NBR TO                             05580001
056100                                   MB113-DAYS-BEF-SHIP-NBR.       05590001
056200     MOVE MDSEDP-DAYS-AFT-CLR-NBR TO                              05600001
056300                                   MB113-DAYS-AFT-CLR-NBR.        05610001
056400     MOVE MDSEDP-SKU-LVL-UPD-IND                                  05620001
056500                               TO  MB113-SKU-LVL-UPD-IND.         05630001
056600     MOVE MDSEDP-PLAN-FRGT-PCT TO  PV-PLAN-FRGT-PCT.              05640001
056700     MOVE PV-PLAN-FRGT-PCT2    TO  MB113-PLAN-FRGT-PCT.           05650001
056800     MOVE MDSEDP-STR-ZN-ID     TO  MB113-STORE-ZN-ID.             05660001
056900     PERFORM 2125-SELECT-STRZN.                                   05670001
057000     MOVE STRZN-STR-ZN-DESC    TO  MB113-STORE-ZN-DESC.           05680001
057100*                                                                 05690001
C14666*    MOVE MDSEDP-CHG-DTE       TO  PV-DB2-DATE.                   05700001
C14666*    MOVE PV-DD-YY             TO  PV-WD-YY.                      05710001
C14666*    MOVE PV-DD-MM             TO  PV-WD-MM.                      05720001
C14666*    MOVE PV-DD-DD             TO  PV-WD-DD.                      05730001
C14666*    MOVE PV-WORK-DATE         TO  MB113-CHANGE-DATE              05740001
057700*                                                                 05750001
057800     MOVE MDSEDP-ARDEPT-CHG-DTE                                   05760001
057900                               TO  PV-DB2-DATE.                   05770001
058000     MOVE PV-DD-YY             TO  PV-WD-YY.                      05780001
058100     MOVE PV-DD-MM             TO  PV-WD-MM.                      05790001
058200     MOVE PV-DD-DD             TO  PV-WD-DD.                      05800001
058300     MOVE PV-WORK-DATE         TO  MB113-AR-CHANGE-DATE           05810001
058400                                                                  05820001
058500*                                                                 05830001
058600*    NOW OBTAIN THE DMA DESCRIPTION.                              05840001
058700*                                                                 05850001
058800     MOVE PC-DMA               TO  MDSEAR-MDSELV-CDE.             05860001
058900     MOVE PC-ZERO              TO  MDSEAR-DEPT-NBR.               05870001
059000     PERFORM 2110-READ-MDSEAR.                                    05880001
059100     MOVE MDSEAR-DESC          TO  MB113-DMA-DESC.                05890001
059200*                                                                 05900001
059300*    FINALLY, THE GMA.                                            05910001
059400*                                                                 05920001
059500     MOVE PC-GMA               TO  MDSEAR-MDSELV-CDE.             05930001
059600     MOVE PC-ZERO              TO  MDSEAR-DMA-NBR.                05940001
059700     PERFORM 2110-READ-MDSEAR.                                    05950001
059800     MOVE MDSEAR-DESC          TO  MB113-GMA-DESC.                05960001
059900*                                                                 05970001
060000*    NOW OBTAIN THE BUSINESS GROUP DESCRIPTION.                   05980001
060100*                                                                 05990001
060200     PERFORM 2130-READ-MDSEBG.                                    06000001
060300*                                                                 06010001
060400     PERFORM 3400-MOVE-COMMAREA-TO-SCREEN.                        06020001
060500*                                                                 06030001
060600 EJECT                                                            06040001
060700******************************************************************06050001
060800*    READ THE TMDSEAR TABLE HERE.                                 06060001
060900*                                                                 06070001
061000*    PERFORMED BY 2100.                                           06080001
061100******************************************************************06090001
061200*                                                                 06100001
061300 2110-READ-MDSEAR.                                                06110001
061400*                                                                 06120001
061500     PERFORM                                                      06130001
061600         WITH TEST AFTER                                          06140001
061700         VARYING PV-SQL-SUB                                       06150001
061800         FROM 1 BY 1                                              06160001
061900         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             06170001
062000            OR SQLCODE = 0                                        06180001
062100            OR SQLCODE = +100                                     06190001
062200*                                                                 06200001
062300         EXEC SQL                                                 06210001
062400              SELECT                                              06220001
062500                     MDSEAR_DESC                                  06230001
062600              INTO                                                06240001
062700                     :MDSEAR-DESC                                 06250001
062800              FROM                                                06260001
062900                     TMDSEAR                                      06270001
063000              WHERE                                               06280001
063100                     OPERCO_NBR     = :PC-COMPANY                 06290001
063200                AND  GMA_NBR        = :MDSEAR-GMA-NBR             06300001
063300                AND  DMA_NBR        = :MDSEAR-DMA-NBR             06310001
063400                AND  DEPT_NBR       = :MDSEAR-DEPT-NBR            06320001
063500                AND  MAJ_CL_NBR     = :MDSEAR-MAJ-CL-NBR          06330001
063600                AND  SUB_CL_NBR     = :MDSEAR-SUB-CL-NBR          06340001
063700                AND  MDSELV_CDE     = :MDSEAR-MDSELV-CDE          06350001
063800         END-EXEC                                                 06360001
063900*                                                                 06370001
064000         EVALUATE TRUE                                            06380001
064100             WHEN SQLCODE = -904                                  06390001
064200             WHEN SQLCODE = -913                                  06400001
064300             WHEN SQLCODE = ZERO                                  06410001
064400                  CONTINUE                                        06420001
064500             WHEN SQLWARN0 NOT EQUAL SPACE                        06430001
064600             WHEN SQLCODE NOT EQUAL ZERO                          06440001
064700                  MOVE '2110-READ-MDSEAR'                         06450001
064800                               TO  DP013-PARAGRAPH                06460001
064900                  MOVE 'READ MDSEAR'                              06470001
065000                               TO  DP013-MESSAGE-TEXT (1)         06480001
065100                  MOVE SQLCA   TO  DP013-SQLCA                    06490001
065200                  SET DP013-DB2-ABEND                             06500001
065300                               TO  TRUE                           06510001
065400                  PERFORM DP013-0000-PROCESS-ABEND                06520001
065500         END-EVALUATE                                             06530001
065600     END-PERFORM.                                                 06540001
065700*                                                                 06550001
065800     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   06560001
065900         MOVE '2110-READ-MDSEAR'                                  06570001
066000                               TO  DP013-PARAGRAPH                06580001
066100         MOVE 'MAX RETRIES EXCEEDED FOR READ MDSEAR'              06590001
066200                               TO  DP013-MESSAGE-TEXT (1)         06600001
066300         MOVE SQLCA            TO  DP013-SQLCA                    06610001
066400         SET DP013-DB2-ABEND   TO  TRUE                           06620001
066500         PERFORM DP013-0000-PROCESS-ABEND                         06630001
066600     END-IF.                                                      06640001
066700*                                                                 06650001
066800 EJECT                                                            06660001
066900******************************************************************06670001
067000*    READ THE TMDSEDP TABLE HERE.                                 06680001
067100*                                                                 06690001
067200*    PERFORMED BY 2100.                                           06700001
067300******************************************************************06710001
067400*                                                                 06720001
067500 2120-READ-MDSEDP.                                                06730001
067600                                                                  06740001
067700     MOVE ZERO                 TO  MDSEDP-PLAN-FRGT-PCT.          06750001
067800                                                                  06760001
067900     PERFORM                                                      06770001
068000         WITH TEST AFTER                                          06780001
068100         VARYING PV-SQL-SUB                                       06790001
068200         FROM 1 BY 1                                              06800001
068300         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             06810001
068400            OR SQLCODE = 0                                        06820001
068500            OR SQLCODE = +100                                     06830001
068600                                                                  06840001
068700         EXEC SQL                                                 06850001
068800              SELECT                                              06860001
068900                     A.MDSEAR_DKEY,                               06870001
069000                     A.MDSEAR_DESC,                               06880001
069100                     D.CHG_DTE,                                   06890001
069200                     D.MDSEBG_NBR,                                06900001
069300                     D.DPTDIS_CDE,                                06910001
069400                     D.ARDEPT_CHG_DTE,                            06920001
069500                     D.ARDEPT_DESC,                               06930001
069600                     D.CONS_IND,                                  06940001
069700                     D.PLAN_FRGT_PCT,                             06950001
069800                     D.SKU_LVL_UPD_IND,                           06960001
069900                     D.DAYS_BEF_SHIP_NBR,                         06970001
070000                     D.DAYS_AFT_CLR_NBR,                          06980001
070100                     D.STR_ZN_ID                                  06990001
070200              INTO                                                07000001
070300                     :MDSEAR-DKEY,                                07010001
070400                     :MDSEAR-DESC,                                07020001
070500                     :MDSEDP-CHG-DTE,                             07030001
070600                     :MDSEDP-MDSEBG-NBR,                          07040001
070700                     :MDSEDP-DPTDIS-CDE,                          07050001
070800                     :MDSEDP-ARDEPT-CHG-DTE,                      07060001
070900                     :MDSEDP-ARDEPT-DESC,                         07070001
071000                     :MDSEDP-CONS-IND,                            07080001
071100                     :MDSEDP-PLAN-FRGT-PCT      :PV-NULL-IND,     07090001
071200                     :MDSEDP-SKU-LVL-UPD-IND,                     07100001
071300                     :MDSEDP-DAYS-BEF-SHIP-NBR,                   07110001
071400                     :MDSEDP-DAYS-AFT-CLR-NBR,                    07120001
071500                     :MDSEDP-STR-ZN-ID                            07130001
071600              FROM                                                07140001
071700                     TMDSEAR A,                                   07150001
071800                     TMDSEDP D                                    07160001
071900              WHERE                                               07170001
072000                     A.OPERCO_NBR   = :PC-COMPANY                 07180001
072100                AND  A.GMA_NBR      = :MDSEAR-GMA-NBR             07190001
072200                AND  A.DMA_NBR      = :MDSEAR-DMA-NBR             07200001
072300                AND  A.DEPT_NBR     = :MDSEAR-DEPT-NBR            07210001
072400                AND  A.MAJ_CL_NBR   = :MDSEAR-MAJ-CL-NBR          07220001
072500                AND  A.SUB_CL_NBR   = :MDSEAR-SUB-CL-NBR          07230001
072600                AND  A.MDSEAR_DKEY  = D.MDSEAR_DKEY               07240001
072700         END-EXEC                                                 07250001
072800                                                                  07260001
072900         EVALUATE TRUE                                            07270001
073000             WHEN SQLCODE = -904                                  07280001
073100             WHEN SQLCODE = -913                                  07290001
073200             WHEN SQLCODE = ZERO                                  07300001
073300                  CONTINUE                                        07310001
073400             WHEN SQLWARN0 NOT EQUAL SPACE                        07320001
073500             WHEN SQLCODE NOT EQUAL ZERO                          07330001
073600                  MOVE '2120-READ-MDSEDP'                         07340001
073700                               TO  DP013-PARAGRAPH                07350001
073800                  MOVE 'READ MDSEDP'                              07360001
073900                               TO  DP013-MESSAGE-TEXT (1)         07370001
074000                  MOVE SQLCA   TO  DP013-SQLCA                    07380001
074100                  SET DP013-DB2-ABEND                             07390001
074200                               TO  TRUE                           07400001
074300                  PERFORM DP013-0000-PROCESS-ABEND                07410001
074400         END-EVALUATE                                             07420001
074500     END-PERFORM.                                                 07430001
074600                                                                  07440001
074700     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   07450001
074800         MOVE '2120-READ-MDSECL'                                  07460001
074900                               TO  DP013-PARAGRAPH                07470001
075000         MOVE 'MAX RETRIES EXCEEDED FOR READ MDSECL'              07480001
075100                               TO  DP013-MESSAGE-TEXT (1)         07490001
075200         MOVE SQLCA            TO  DP013-SQLCA                    07500001
075300         SET DP013-DB2-ABEND   TO  TRUE                           07510001
075400         PERFORM DP013-0000-PROCESS-ABEND                         07520001
075500     END-IF.                                                      07530001
075600                                                                  07540001
075700/                                                                 07550001
075800 2125-SELECT-STRZN.                                               07560001
075900                                                                  07570001
076000                                                                  07580001
076100     PERFORM                                                      07590001
076200         WITH TEST AFTER                                          07600001
076300         VARYING PV-SQL-SUB                                       07610001
076400         FROM 1 BY 1                                              07620001
076500         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             07630001
076600            OR SQLCODE = 0                                        07640001
076700            OR SQLCODE = +100                                     07650001
076800                                                                  07660001
076900         EXEC SQL                                                 07670001
077000              SELECT STR_ZN_DESC                                  07680001
077100              INTO  :STRZN-STR-ZN-DESC                            07690001
077200              FROM   TSTRZN                                       07700001
077300              WHERE  STR_ZN_ID     = :MDSEDP-STR-ZN-ID            07710001
077400         END-EXEC                                                 07720001
077500                                                                  07730001
077600         EVALUATE TRUE                                            07740001
077700             WHEN SQLCODE = +100                                  07750001
077800                  MOVE SPACES TO STRZN-STR-ZN-DESC                07760001
077900             WHEN SQLCODE = -904                                  07770001
078000             WHEN SQLCODE = -913                                  07780001
078100             WHEN SQLCODE = ZERO                                  07790001
078200                  CONTINUE                                        07800001
078300             WHEN SQLWARN0 NOT EQUAL SPACE                        07810001
078400             WHEN SQLCODE NOT EQUAL ZERO                          07820001
078500                  MOVE '2125-SELECT-STRZN'                        07830001
078600                               TO  DP013-PARAGRAPH                07840001
078700                  MOVE 'READ TSTRZN'                              07850001
078800                               TO  DP013-MESSAGE-TEXT (1)         07860001
078900                  MOVE SQLCA   TO  DP013-SQLCA                    07870001
079000                  SET DP013-DB2-ABEND                             07880001
079100                               TO  TRUE                           07890001
079200                  PERFORM DP013-0000-PROCESS-ABEND                07900001
079300         END-EVALUATE                                             07910001
079400     END-PERFORM.                                                 07920001
079500                                                                  07930001
079600     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   07940001
079700         MOVE '2125-SELECT-STRZN'                                 07950001
079800                               TO  DP013-PARAGRAPH                07960001
079900         MOVE 'MAX RETRIES EXCEEDED FOR READ TSTRZN'              07970001
080000                               TO  DP013-MESSAGE-TEXT (1)         07980001
080100         MOVE SQLCA            TO  DP013-SQLCA                    07990001
080200         SET DP013-DB2-ABEND   TO  TRUE                           08000001
080300         PERFORM DP013-0000-PROCESS-ABEND                         08010001
080400     END-IF.                                                      08020001
080500                                                                  08030001
080600/                                                                 08040001
080700******************************************************************08050001
080800*    READ THE TMDSEAR TABLE HERE.                                 08060001
080900*                                                                 08070001
081000*    PERFORMED BY 2100.                                           08080001
081100******************************************************************08090001
081200                                                                  08100001
081300 2130-READ-MDSEBG.                                                08110001
081400                                                                  08120001
081500     PERFORM                                                      08130001
081600         WITH TEST AFTER                                          08140001
081700         VARYING PV-SQL-SUB                                       08150001
081800         FROM 1 BY 1                                              08160001
081900         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             08170001
082000            OR SQLCODE = 0                                        08180001
082100            OR SQLCODE = +100                                     08190001
082200                                                                  08200001
082300         EXEC SQL                                                 08210001
082400              SELECT                                              08220001
082500                     MDSEBG_DESC                                  08230001
082600              INTO                                                08240001
C14666                     :MDSEBG-MDSEBG-DESC                          08250001
082800              FROM                                                08260001
082900                     TMDSEBG                                      08270001
083000              WHERE                                               08280001
083100                     MDSEBG_NBR     = :MB113-BUSINESS-GROUP       08290001
083200         END-EXEC                                                 08300001
083300*                                                                 08310001
083400         EVALUATE TRUE                                            08320001
083500             WHEN SQLCODE = -904                                  08330001
083600             WHEN SQLCODE = -913                                  08340001
083700             WHEN SQLCODE = +100                                  08350001
083800             WHEN SQLCODE = ZERO                                  08360001
083900                  CONTINUE                                        08370001
084000             WHEN SQLWARN0 NOT EQUAL SPACE                        08380001
084100             WHEN SQLCODE NOT EQUAL ZERO                          08390001
084200                  MOVE '2130-READ-MDSEBG'                         08400001
084300                               TO  DP013-PARAGRAPH                08410001
084400                  MOVE 'READ MDSEAR'                              08420001
084500                               TO  DP013-MESSAGE-TEXT (1)         08430001
084600                  MOVE SQLCA   TO  DP013-SQLCA                    08440001
084700                  SET DP013-DB2-ABEND                             08450001
084800                               TO  TRUE                           08460001
084900                  PERFORM DP013-0000-PROCESS-ABEND                08470001
085000         END-EVALUATE                                             08480001
085100     END-PERFORM.                                                 08490001
085200                                                                  08500001
085300     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   08510001
085400         MOVE '2130-READ-MDSEBG'                                  08520001
085500                               TO  DP013-PARAGRAPH                08530001
085600         MOVE 'MAX RETRIES EXCEEDED FOR READ MDSEBG'              08540001
085700                               TO  DP013-MESSAGE-TEXT (1)         08550001
085800         MOVE SQLCA            TO  DP013-SQLCA                    08560001
085900         SET DP013-DB2-ABEND   TO  TRUE                           08570001
086000         PERFORM DP013-0000-PROCESS-ABEND                         08580001
086100     END-IF.                                                      08590001
086200                                                                  08600001
086300     IF  SQLCODE EQUAL +100                                       08610001
086400         MOVE SPACES           TO  MB113-BGP-DESC                 08620001
086500     ELSE                                                         08630001
C14666         MOVE MDSEBG-MDSEBG-DESC TO  MB113-BGP-DESC               08640001
086700     END-IF.                                                      08650001
086800                                                                  08660001
086900 EJECT                                                            08670001
087000******************************************************************08680001
087100*    READ THE TEMPORARY STORAGE QUEUE THAT CONTAINS THE SELECTED  08690001
087200*    MERCHANDISE DEPARTMENTS FROM MBKCS123 (MERCH DEPT DISCNT LST)08700001
087300*                                                                 08710001
087400*    PERFORMED BY 2000, 2160                                      08720001
087500******************************************************************08730001
087600*                                                                 08740001
087700 2150-READ-LIST-QUEUE.                                            08750001
087800*                                                                 08760001
087900     EXEC CICS                                                    08770001
088000         READQ TS                                                 08780001
088100         QUEUE(MB005-LIST-QUEUE-NAME)                             08790001
088200         INTO(DP-LIST-RECORD)                                     08800001
088300         LENGTH(MB005-LIST-QUEUE-LENGTH)                          08810001
088400         ITEM(MB113-DP-ITEM)                                      08820001
088500         RESP(PV-RESP)                                            08830001
088600     END-EXEC.                                                    08840001
088700*                                                                 08850001
088800     IF  PV-RESP EQUAL DFHRESP(NORMAL)                            08860001
088900         CONTINUE                                                 08870001
089000     ELSE                                                         08880001
089100         MOVE PV-RESP          TO  PM-RESP-22                     08890001
089200         SET DP013-LOGIC-ABEND TO  TRUE                           08900001
089300         SET DP013-NO-ROLLBACK TO  TRUE                           08910001
089400         MOVE '2150-READ-LIST-QUEUE'                              08920001
089500                               TO  DP013-PARAGRAPH                08930001
089600         MOVE PM-PROGRAM-MESSAGE-22                               08940001
089700                               TO  DP013-MESSAGE-TEXT (1)         08950001
089800         PERFORM DP013-0000-PROCESS-ABEND                         08960001
089900     END-IF.                                                      08970001
090000*                                                                 08980001
090100 EJECT                                                            08990001
090200******************************************************************09000001
090300*    READ THE TEMP STORAGE QUEUE, GET THE NEXT DEPARTMENT.        09010001
090400*    IF AT END, ISSUE MESSAGE, OTHERWISE CONTINUE PROCESSING.     09020001
090500*                                                                 09030001
090600*    PERFORMED BY 3000                                            09040001
090700******************************************************************09050001
090800*                                                                 09060001
090900 2160-GET-NEXT-MDSEAR.                                            09070001
091000*                                                                 09080001
091100     ADD 1                     TO  MB113-DP-SUB.                  09090001
091200     IF  MB113-DP-SUB GREATER THAN MB003-MAX-ITEMS                09100001
091300         ADD 1                 TO  MB113-DP-ITEM                  09110001
091400         MOVE 1                TO  MB113-DP-SUB                   09120001
091500         PERFORM 2150-READ-LIST-QUEUE                             09130001
091600         MOVE DP-LIST-RECORD   TO  MB113-SAVE-LIST-RECORD         09140001
091700     ELSE                                                         09150001
091800         MOVE MB113-SAVE-LIST-RECORD                              09160001
091900                               TO  DP-LIST-RECORD                 09170001
092000     END-IF.                                                      09180001
092100*                                                                 09190001
092200     IF  MB003-KEY-DATA (MB113-DP-SUB) GREATER THAN SPACES        09200001
092300         MOVE MB003-KEY-DATA (MB113-DP-SUB)                       09210001
092400                               TO  MB113-LAST-KEY                 09220001
092500         PERFORM 2100-RETRIEVE-DATA-FOR-PANEL                     09230001
092600     ELSE                                                         09240001
092700         SUBTRACT 1          FROM  MB113-DP-SUB                   09250001
092800         MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER               09260001
092900         SET DP020-MSG-INFORMATIONAL                              09270001
093000                               TO  TRUE                           09280001
093100     END-IF.                                                      09290001
093200                                                                  09300001
093300*----------------------------------------------------------------*09310001
093400*    LOAD CURRENT DATE IN THE WORK AREA. PERFORM THE DATE INCLUDE*09320001
093500*    TO LOAD THE FISCAL/CALENDAR MONTH TABLE.  USE THE FISCAL    *09330001
093600*    PERIOD NUMBER TO OBTAIN THE CORRECT SHRINK PERCENT.         *09340001
093700*                                                                *09350001
093800*    PERFORMED BY 2100                                           *09360001
093900*----------------------------------------------------------------*09370001
094000                                                                  09380001
094100 2170-GET-SHRINK-MONTH-INFO.                                      09390001
094200                                                                  09400001
094300*** GET FISCAL MONTH INFO BASED ON LEDGER CONTROL TABLE           09410001
094400     PERFORM 2172-GET-FISCAL-MONTH-INFO.                          09420001
094500                                                                  09430001
094600*** MOVE TABLE VALUES TO TSQ FIELDS                               09440001
C14666*    MOVE MLCNTL-OPN-FSCL-MN-NBR  TO  MB113-SHRINK-FIS-CURR       09450001
C14666*    MOVE DTATTR-FSCL-MN-NM       TO  MB113-FIS-MONTH-NM.         09460001
094900     MOVE DTATTR-CAL-MN-NBR       TO  PV-SHRINK-SUB.              09470001
095000                                                                  09480001
095100*** GET SHRINK PERCENT BASED ON THE CALENDAR MONTH NUMBER         09490001
095200*** FOR THE CURRENT FISCAL MONTH                                  09500001
C14666     INITIALIZE DCLTDPTSHK.                                       09510001
C14666     MOVE 'N'                     TO  DPTSHK-E-BUS-IND.           09520001
095300     PERFORM 2174-GET-SHRINK-ROW.                                 09530001
095400                                                                  09540001
095500*** MOVE SHRINK DCLGEN TO WS / TABLE FOR MONTH SHRINK PCTS        09550001
095600     MOVE DCLTDPTSHK              TO  PV-SHRINK-WORK-AREA.        09560001
095700                                                                  09570001
095800*** MOVE SHRINK VALUES TO TSQ FIELDS                              09580001
095900     MOVE PV-SHRINK-PCT (PV-SHRINK-SUB)                           09590001
C14666                                  TO  MB113-BM-SHRINK-PCT-CURR.   09600001
C14666     MOVE PV-SHNK-PCT-CHG-DTE     TO  PV-DB2-DATE.                09610001
C14666     MOVE PV-DD-YEAR              TO  PV-WRK-CCYY.                09620001
C14666     MOVE PV-DD-MM                TO  PV-WRK-MM.                  09630001
C14666     MOVE PV-DD-DD                TO  PV-WRK-DD.                  09640001
C14666     MOVE PV-WORK-DATE1           TO  MB113-BM-SHNK-LAST-CHG-DTE  09650001
C14666     MOVE PV-LAST-UPD-BY-USR      TO  MB113-BM-SHNK-LAST-CHG-USR  09660001
C14666                                                                  09670001
C14666     MOVE 'Y'                     TO DPTSHK-E-BUS-IND.            09680001
C14666                                                                  09690001
C14666*    GET SHRINK PERCENT BASED ON THE CALENDAR MONTH NUMBER        09700001
C14666*    FOR THE CURRENT FISCAL MONTH                                 09710001
C14666     PERFORM 2174-GET-SHRINK-ROW.                                 09720001
C14666                                                                  09730001
C14666*    MOVE SHRINK DCLGEN TO WS / TABLE FOR MONTH SHRINK PCTS       09740001
C14666     MOVE DCLTDPTSHK            TO  PV-SHRINK-WORK-AREA.          09750001
C14666                                                                  09760001
C14666*    MOVE SHRINK VALUES TO TSQ FIELDS                             09770001
C14666     MOVE PV-SHRINK-PCT (PV-SHRINK-SUB)                           09780001
C14666                                TO  MB113-ECOM-SHRINK-PCT-CURR.   09790001
C14666     MOVE PV-SHNK-PCT-CHG-DTE   TO  PV-DB2-DATE.                  09800001
C14666     MOVE PV-DD-YEAR            TO  PV-WRK-CCYY.                  09810001
C14666     MOVE PV-DD-MM              TO  PV-WRK-MM.                    09820001
C14666     MOVE PV-DD-DD              TO  PV-WRK-DD.                    09830001
C14666     MOVE PV-WORK-DATE1         TO  MB113-ECOM-SHNK-LAST-CHC-DTE. 09840001
C14666     MOVE PV-LAST-UPD-BY-USR    TO  MB113-ECOM-SHNK-LAST-CHC-USR. 09850001
096100                                                                  09860001
096200*----------------------------------------------------------------*09870001
C14666*    GET CALENDAR MONTH NUMBER, FISCAL YEAR BASED ON CURRENT DATE*09880005
096600*                                                                *09910001
096700*    PERFORMED BY 2170                                           *09920001
096800*----------------------------------------------------------------*09930001
096900                                                                  09940001
097000 2172-GET-FISCAL-MONTH-INFO.                                      09950001
097100                                                                  09960001
097200     PERFORM                                                      09970001
097300         WITH TEST AFTER                                          09980001
097400         VARYING PV-SQL-SUB                                       09990001
097500         FROM 1 BY 1                                              10000001
097600         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             10010001
097700            OR SQLCODE = 0                                        10020001
097800                                                                  10030001
097900         EXEC SQL                                                 10040001
C14666              SELECT CAL_MN_NBR                                   10050001
098300                    ,FSCL_YR_NBR                                  10060001
C14666              INTO   :DTATTR-CAL-MN-NBR                           10070001
098700                    ,:DTATTR-FSCL-YR-NBR                          10080001
C14666              FROM   TDTATTR                                      10090001
C14666              WHERE KY_DTE = CURRENT DATE                         10100002
099100         END-EXEC                                                 10110001
099200*                                                                 10120001
099300         EVALUATE TRUE                                            10130001
099400             WHEN SQLCODE = -904                                  10140001
099500             WHEN SQLCODE = -913                                  10150001
099600             WHEN SQLCODE = ZERO                                  10160001
099700                  CONTINUE                                        10170001
099800             WHEN SQLWARN0 NOT EQUAL SPACE                        10180001
099900             WHEN SQLCODE NOT EQUAL ZERO                          10190001
100000                  MOVE '2172-GET-FISCAL-MONTH-INFO'               10200001
100100                               TO  DP013-PARAGRAPH                10210001
100200                  MOVE 'SELECT TMLCNTL/TDTATTR'                   10220001
100300                               TO  DP013-MESSAGE-TEXT (1)         10230001
100400                  MOVE SQLCA   TO  DP013-SQLCA                    10240001
100500                  SET DP013-DB2-ABEND                             10250001
100600                               TO  TRUE                           10260001
100700                  PERFORM DP013-0000-PROCESS-ABEND                10270001
100800         END-EVALUATE                                             10280001
100900     END-PERFORM.                                                 10290001
101000                                                                  10300001
101100     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   10310001
101200         MOVE '2172-GET-FISCAL-MONTH-INFO'                        10320001
101300                               TO  DP013-PARAGRAPH                10330001
101400         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   10340001
101500                               TO  DP013-MESSAGE-TEXT (1)         10350001
101600         MOVE SQLCA            TO  DP013-SQLCA                    10360001
101700         SET DP013-DB2-ABEND   TO  TRUE                           10370001
101800         PERFORM DP013-0000-PROCESS-ABEND                         10380001
101900     END-IF.                                                      10390001
102000                                                                  10400001
102100*----------------------------------------------------------------*10410001
102200*    INITIALIZE THE DCLGEN AREA, LOAD THE KEY AND READ THE       *10420001
102300*    DEPARTMENT SHRINK TABLE.                                    *10430001
102400*                                                                *10440001
102500*    PERFORMED BY 2170                                           *10450001
102600*----------------------------------------------------------------*10460001
102700                                                                  10470001
102800 2174-GET-SHRINK-ROW.                                             10480001
102900                                                                  10490001
C14666*    INITIALIZE DCLTDPTSHK.                                       10500001
103100     MOVE MDSEAR-DKEY            TO  DPTSHK-MDSEAR-DKEY.          10510001
103200     MOVE DTATTR-FSCL-YR-NBR     TO  DPTSHK-SHRINK-YR-NBR.        10520001
103300                                                                  10530001
103400     PERFORM                                                      10540001
103500         WITH TEST AFTER                                          10550001
103600         VARYING PV-SQL-SUB                                       10560001
103700         FROM 1 BY 1                                              10570001
103800         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             10580001
103900            OR SQLCODE = 0                                        10590001
104000            OR SQLCODE = +100                                     10600001
104100                                                                  10610001
104200         EXEC SQL                                                 10620001
104300              SELECT                                              10630001
104400                     CHG_TMST                                     10640001
104500                   , JAN_SHRINK_PCT                               10650001
104600                   , FEB_SHRINK_PCT                               10660001
104700                   , MAR_SHRINK_PCT                               10670001
104800                   , APR_SHRINK_PCT                               10680001
104900                   , MAY_SHRINK_PCT                               10690001
105000                   , JUN_SHRINK_PCT                               10700001
105100                   , JUL_SHRINK_PCT                               10710001
105200                   , AUG_SHRINK_PCT                               10720001
105300                   , SEP_SHRINK_PCT                               10730001
105400                   , OCT_SHRINK_PCT                               10740001
105500                   , NOV_SHRINK_PCT                               10750001
105600                   , DEC_SHRINK_PCT                               10760001
C14666                   , SHNK_PCT_CHG_DTE                             10770001
C14666                   , LAST_UPD_BY_USR                              10780001
105700              INTO                                                10790001
105800                     :DPTSHK-CHG-TMST                             10800001
105900                   , :DPTSHK-JAN-SHRINK-PCT                       10810001
106000                   , :DPTSHK-FEB-SHRINK-PCT                       10820001
106100                   , :DPTSHK-MAR-SHRINK-PCT                       10830001
106200                   , :DPTSHK-APR-SHRINK-PCT                       10840001
106300                   , :DPTSHK-MAY-SHRINK-PCT                       10850001
106400                   , :DPTSHK-JUN-SHRINK-PCT                       10860001
106500                   , :DPTSHK-JUL-SHRINK-PCT                       10870001
106600                   , :DPTSHK-AUG-SHRINK-PCT                       10880001
106700                   , :DPTSHK-SEP-SHRINK-PCT                       10890001
106800                   , :DPTSHK-OCT-SHRINK-PCT                       10900001
106900                   , :DPTSHK-NOV-SHRINK-PCT                       10910001
107000                   , :DPTSHK-DEC-SHRINK-PCT                       10920001
C14666                   , :DPTSHK-SHNK-PCT-CHG-DTE                     10930001
C14666                   , :DPTSHK-LAST-UPD-BY-USR                      10940001
107100              FROM                                                10950001
107200                     TDPTSHK                                      10960001
107300              WHERE                                               10970001
107400                     MDSEAR_DKEY    = :DPTSHK-MDSEAR-DKEY         10980001
107500                AND  SHRINK_YR_NBR  = :DPTSHK-SHRINK-YR-NBR       10990001
C14666                AND  E_BUS_IND      = :DPTSHK-E-BUS-IND           11000001
107600         END-EXEC                                                 11010001
107700                                                                  11020001
107800         EVALUATE TRUE                                            11030001
107900             WHEN SQLCODE = ZERO                                  11040001
108000             WHEN SQLCODE = +100                                  11050001
108100             WHEN SQLCODE = -904                                  11060001
108200             WHEN SQLCODE = -913                                  11070001
108300                  CONTINUE                                        11080001
108400             WHEN SQLWARN0 NOT EQUAL SPACE                        11090001
108500             WHEN SQLCODE NOT EQUAL ZERO                          11100001
108600                  MOVE '2174-GET-SHRINK-ROW'                      11110001
108700                               TO  DP013-PARAGRAPH                11120001
108800                  MOVE 'READ DPTSHK'                              11130001
108900                               TO  DP013-MESSAGE-TEXT (1)         11140001
109000                  MOVE SQLCA   TO  DP013-SQLCA                    11150001
109100                  SET DP013-DB2-ABEND                             11160001
109200                               TO  TRUE                           11170001
109300                  PERFORM DP013-0000-PROCESS-ABEND                11180001
109400         END-EVALUATE                                             11190001
109500     END-PERFORM.                                                 11200001
109600                                                                  11210001
109700     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   11220001
109800         MOVE '2174-GET-SHRINK-ROW'                               11230001
109900                               TO  DP013-PARAGRAPH                11240001
110000         MOVE 'MAX RETRIES EXCEEDED FOR READ DPTSHK'              11250001
110100                               TO  DP013-MESSAGE-TEXT (1)         11260001
110200         MOVE SQLCA            TO  DP013-SQLCA                    11270001
110300         SET DP013-DB2-ABEND   TO  TRUE                           11280001
110400         PERFORM DP013-0000-PROCESS-ABEND                         11290001
110500     END-IF.                                                      11300001
110600                                                                  11310001
110700/                                                                 11320001
110800******************************************************************11330001
110900*    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.       11340001
111000*                                                                 11350001
111100*    PERFORMED BY 1000-CONTROL-PROCESSING.                        11360001
111200*    PERFORMED BY 3000-PROCESS-PANEL.                             11370001
111300******************************************************************11380001
111400*                                                                 11390001
111500 2200-DISPLAY-PANEL.                                              11400001
111600*                                                                 11410001
111700     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       11420001
111800     MOVE DP017-EDITED-TIME-HMS                                   11430001
111900                               TO  ATIMEO.                        11440001
112000     MOVE -1                   TO  ANAVCMDL.                      11450001
112100*                                                                 11460001
112200     IF  PS-SEND-MAP-N-DATA-FRSET                                 11470001
112300         PERFORM DP002-0000-FORMAT-TITLE-LINES                    11480001
112400         PERFORM DP009-0000-LOAD-FK-LINES                         11490001
112500     END-IF.                                                      11500001
112600*                                                                 11510001
112700     PERFORM DP005-0000-FORMAT-MSG-LINES.                         11520001
112800                                                                  11530001
112900     PERFORM DP008-0000-WRITE-PANEL.                              11540001
113000*                                                                 11550001
113100 EJECT                                                            11560001
113200******************************************************************11570001
113300*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED  11580001
113400*    ON WHAT FUNCTION KEY WAS SELECTED.                           11590001
113500*                                                                 11600001
113600*    PERFORMED BY 1000-CONTROL-PROCESSING.                        11610001
113700******************************************************************11620001
113800*                                                                 11630001
113900 3000-PROCESS-PANEL.                                              11640001
114000*                                                                 11650001
114100     PERFORM DP007-0000-GET-PANEL.                                11660001
114200     SET PS-SEND-DATA-ONLY-FRSET                                  11670001
114300                               TO TRUE.                           11680001
114400     PERFORM 3100-CHECK-LOCAL-FKEYS.                              11690001
114500*                                                                 11700001
114600 EJECT                                                            11710001
114700******************************************************************11720001
114800*   DETERMINE THE PROCESSING PATH HERE.                           11730001
114900*                                                                 11740001
115000*   PERFORMED BY 3000.                                            11750001
115100******************************************************************11760001
115200*                                                                 11770001
115300 3100-CHECK-LOCAL-FKEYS.                                          11780001
115400*                                                                 11790001
115500     EVALUATE TRUE                                                11800001
115600*                                                                 11810001
115700         WHEN DP020-SRC-AID = DP016-CLEAR                         11820001
115800         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     11830001
115900             MOVE SPACES       TO  ANAVCMDO                       11840001
116000                                   ANAVKEYO                       11850001
116100             SET PS-SEND-MAP-N-DATA-FRSET                         11860001
116200                               TO  TRUE                           11870001
116300             PERFORM 3400-MOVE-COMMAREA-TO-SCREEN                 11880001
116400             PERFORM 2200-DISPLAY-PANEL                           11890001
116500*                                                                 11900001
116600*    "NEXT" PROCESSING - POSITION TO NEXT MERCH AREA CODE         11910001
116700*                                                                 11920001
116800         WHEN DP020-FK-NEXT-SELECTION(DP020-SRC-AID)              11930001
116900             IF  MB113-LIST-EXISTS                                11940001
117000                 PERFORM 2160-GET-NEXT-MDSEAR                     11950001
117100             ELSE                                                 11960001
117200                 MOVE PC-TSYMSG-00070                             11970001
117300                               TO  DP020-MSG-NUMBER               11980001
117400                 SET DP020-MSG-INFORMATIONAL                      11990001
117500                               TO  TRUE                           12000001
117600             END-IF                                               12010001
117700             PERFORM 2200-DISPLAY-PANEL                           12020001
117800*                                                                 12030001
117900         WHEN DP020-SRC-AID = DP016-PA2                           12040001
118000             PERFORM DP009-0000-LOAD-FK-LINES                     12050001
118100             PERFORM DP017-0000-GET-CURR-DATE-TIME                12060001
118200             SET PS-SEND-DATA-ONLY                                12070001
118300                               TO  TRUE                           12080001
118400             MOVE -1           TO  ANAVCMDL                       12090001
118500             PERFORM DP008-0000-WRITE-PANEL                       12100001
118600*                                                                 12110001
118700         WHEN DP020-FK-RETURN(DP020-SRC-AID)                      12120001
118800         WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID)                  12130001
118900              PERFORM 4000-NAVIGATE                               12140001
119000*                                                                 12150001
119100         WHEN DP020-SRC-AID = DP016-ENTER                         12160001
119200             IF  DP020-NAV-MNEMONIC GREATER THAN SPACES           12170001
119300                 PERFORM 4000-NAVIGATE                            12180001
119400             ELSE                                                 12190001
119500                 PERFORM 2200-DISPLAY-PANEL                       12200001
119600             END-IF                                               12210001
119700*                                                                 12220001
119800         WHEN OTHER                                               12230001
119900             MOVE PC-TSYMSG-00045                                 12240001
120000                               TO  DP020-MSG-NUMBER               12250001
120100             SET DP020-MSG-FATAL                                  12260001
120200                               TO  TRUE                           12270001
120300             MOVE -1           TO  ANAVCMDL                       12280001
120400             PERFORM 2200-DISPLAY-PANEL                           12290001
120500     END-EVALUATE.                                                12300001
120600*                                                                 12310001
120700 EJECT                                                            12320001
120800******************************************************************12330001
120900*    HERE WE SIMPLY MOVE DATA ENTERED ON THE SCREEN TO THE COMM   12340001
121000*    AREA.                                                        12350001
121100*                                                                 12360001
121200*    PERFORMED BY 3000                                            12370001
121300******************************************************************12380001
121400*                                                                 12390001
121500*3200-MOVE-SCREEN-TO-COMMAREA.                                    12400001
121600*                                                                 12410001
121700 EJECT                                                            12420001
121800******************************************************************12430001
121900*    HERE WE SIMPLY ENSURE THE DATA IS CORRECT.  IF NOT, ISSUE    12440001
122000*    APPROPRIATE ERRORS.                                          12450001
122100*                                                                 12460001
122200*    PERFORMED BY 3000                                            12470001
122300******************************************************************12480001
122400*                                                                 12490001
122500*3300-EDIT-DATA-IN-COMMAREA.                                      12500001
122600*                                                                 12510001
122700 EJECT                                                            12520001
122800******************************************************************12530001
122900*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.           12540001
123000*                                                                 12550001
123100*    PERFORMED BY 2000, 2160.                                     12560001
123200******************************************************************12570001
123300                                                                  12580001
123400 3400-MOVE-COMMAREA-TO-SCREEN.                                    12590001
123500                                                                  12600001
123600     MOVE PC-COMPANY           TO  AOPERCOO.                      12610001
123700     MOVE MB113-LAST-GMA-NBR   TO  AGMAO.                         12620001
123800     MOVE MB113-LAST-DMA-NBR   TO  ADMAO.                         12630001
123900     MOVE MB113-LAST-DEPT-NBR  TO  ADEPTO.                        12640001
124000                                                                  12650001
124100     MOVE MB113-GMA-DESC       TO  AGMADESO.                      12660001
124200     MOVE MB113-DMA-DESC       TO  ADMADESO.                      12670001
124300     MOVE MB113-DEPT-DESC      TO  ADPTDESO.                      12680001
124400     MOVE MB113-BGP-DESC       TO  ABGPDESO.                      12690001
124500                                                                  12700001
124600     MOVE MB113-BUSINESS-GROUP TO  ABUSGPO.                       12710001
124700     MOVE MB113-DISCOUNT-CODE  TO  ADPTDISO.                      12720001
124800     MOVE MB113-AR-DESC        TO  AARDESCO.                      12730001
124900     MOVE MB113-CONS-IND       TO  ACONINDO.                      12740001
125000     MOVE MB113-DAYS-BEF-SHIP-NBR                                 12750001
125100                               TO  ASHPRPTO.                      12760001
125200     MOVE MB113-DAYS-AFT-CLR-NBR                                  12770001
125300                               TO  ACLRRPTO.                      12780001
125400     MOVE MB113-SKU-LVL-UPD-IND                                   12790001
125500                               TO  ASKUINDO.                      12800001
125600     MOVE MB113-PLAN-FRGT-PCT  TO  AFRTPCTO.                      12810001
125700     MOVE MB113-STORE-ZN-ID    TO  ASTRZNEO.                      12820001
125800     MOVE MB113-STORE-ZN-DESC  TO  AZNDESCO.                      12830001
125900                                                                  12840001
126000*** 06/12/95 DMH                                                  12850001
C14666     MOVE MB113-BM-SHRINK-PCT-CURRX    TO ABMSHCRO.               12860001
C14666     MOVE MB113-ECOM-SHRINK-PCT-CURRX  TO AECSHCRO.               12870001
C14666     MOVE MB113-BM-SHNK-LAST-CHG-DTE   TO ABMLCDTO.               12880001
C14666     MOVE MB113-ECOM-SHNK-LAST-CHC-DTE TO AECLCDTO.               12890001
C14666     MOVE MB113-BM-SHNK-LAST-CHG-USR   TO ABMLCURO.               12900001
C14666     MOVE MB113-ECOM-SHNK-LAST-CHC-USR TO AECLCURO.               12910001
C14666*    MOVE MB113-SHRINK-FIS-CURR  TO AFISCURO.                     12920001
C14666*    MOVE MB113-FIS-MONTH-NM     TO AFISMONO.                     12930001
126400     MOVE MB113-AR-CHANGE-DATE   TO AARCHGO.                      12940001
C14666*    MOVE MB113-CHANGE-DATE      TO ADPTCHGO.                     12950001
126600                                                                  12960001
126700 EJECT                                                            12970001
126800******************************************************************12980001
126900*    IF THE USER HITS A KEY THAT REQUIRES US TO GO TO ANOTHER     12990001
127000*    TRANSACTION, SAVE THE INTER APPLICATION COMMUNICATIONS AREA  13000001
127100*    AND START THE NAVIGATOR.                                     13010001
127200*                                                                 13020001
127300*    PERFORMED BY 3000                                            13030001
127400******************************************************************13040001
127500*                                                                 13050001
127600 4000-NAVIGATE.                                                   13060001
127700*                                                                 13070001
127800     IF  MB113-LIST-EXISTS                                        13080001
127900         COMPUTE MB005-NUMBER-PROCESSED-ITEMS =                   13090001
128000             ((MB113-DP-ITEM - 1) * MB003-MAX-ITEMS) +            13100001
128100               MB113-DP-SUB                                       13110001
128200     END-IF.                                                      13120001
128300*                                                                 13130001
128400     MOVE MB005-INTER-APPL-COMMAREA                               13140001
128500                               TO  MB113-SAVE-INTER-APPL-COMMAREA.13150001
128600     PERFORM DP015-1000-START-NAVIGATOR.                          13160001
128700*                                                                 13170001
128800 EJECT                                                            13180001
128900******************************************************************13190001
129000*    ENSURE PROPER ENTRY INTO THIS PROGRAM.                       13200001
129100*                                                                 13210001
129200*    PERFORMED BY 1000                                            13220001
129300******************************************************************13230001
129400*                                                                 13240001
129500 4100-VALIDATE-COMMAREA.                                          13250001
129600*                                                                 13260001
129700     IF (DP020-MB-MERCH-DEPT-SELECT                               13270001
129800     OR  DP020-MB-MERCH-DEPT-LIST                                 13280001
129900     OR  DP020-MB-MERCH-AREA-INQUIRY)                             13290001
130000         SET PS-COMMAREA-VALID TO  TRUE                           13300001
130100     ELSE                                                         13310001
130200         SET PS-COMMAREA-NOT-VALID                                13320001
130300                               TO  TRUE                           13330001
130400     END-IF.                                                      13340001
130500*                                                                 13350001
130600 EJECT                                                            13360001
130700******************************************************************13370001
130800*    FILL IN SCREEN HEADER MODULE                                 13380001
130900******************************************************************13390001
131000                                                                  13400001
131100     COPY DPPD002.                                                13410001
131200 EJECT                                                            13420001
131300******************************************************************13430001
131400*    RETURN TO CICS MODULE                                        13440001
131500******************************************************************13450001
131600                                                                  13460001
131700     COPY DPPD003.                                                13470001
131800 EJECT                                                            13480001
131900******************************************************************13490001
132000*    FORMAT MESSAGE LINES MODULE                                  13500001
132100******************************************************************13510001
132200                                                                  13520001
132300     COPY DPPD005.                                                13530001
132400 EJECT                                                            13540001
132500******************************************************************13550001
132600*    GET PANEL MODULE                                             13560001
132700******************************************************************13570001
132800                                                                  13580001
132900     COPY DPPD007.                                                13590001
133000 EJECT                                                            13600001
133100******************************************************************13610001
133200*    WRITE PANEL MODULE                                           13620001
133300******************************************************************13630001
133400                                                                  13640001
133500     COPY DPPD008.                                                13650001
133600 EJECT                                                            13660001
133700******************************************************************13670001
133800*    TOGGLE THE FUNCTION KEY LINE MODULE                          13680001
133900******************************************************************13690001
134000                                                                  13700001
134100     COPY DPPD009.                                                13710001
134200 EJECT                                                            13720001
134300******************************************************************13730001
134400*    ABEND PROCESSOR MODULE                                       13740001
134500******************************************************************13750001
134600                                                                  13760001
134700     COPY DPPD013.                                                13770001
134800 EJECT                                                            13780001
134900******************************************************************13790001
135000*    CHECK COMMUNICATION AREA MODULE                              13800001
135100******************************************************************13810001
135200                                                                  13820001
135300     COPY DPPD015.                                                13830001
135400 EJECT                                                            13840001
135500******************************************************************13850001
135600*    UPDATE TIME AND DATE MODULE                                  13860001
135700******************************************************************13870001
135800                                                                  13880001
135900     COPY DPPD017.                                                13890001
