000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    POKCS066.                                         00020000
000300 AUTHOR.        JIM SCHNEIDER.                                    00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  01-20-95.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*    W066 - EDI DATA TRANSMISSION INQUIRY                       * 00090000
001000*                                                               * 00100000
001100*    THIS PROGRAM LISTS THE DATES AND TIMES AT VARIOUS POINTS   * 00110000
001200*    IN THE EDI TRANSMISSION PROCESS.                           * 00120000
001300*                                                               * 00130000
001400*---------------------------------------------------------------* 00140000
C98147* 11/20/14  LINDA FRIESS                  - CHG0098147            00150016
C98147*    - EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND COMMAREA         00160016
C98147*      AND IN PARAGRAPH 4000                                      00170016
C98147*----------------------------------------------------------------*00180016
076319* DATE  10/27/2021                                                00181018
076320*            - CHANGE CALL OF 'DPKUT100' TO                     * 00182018
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00183018
076322*              MAKING THE CALL DYNAMIC VS STATIC                * 00184018
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00185019
076312*                                                               * 00186018
076318*---------------------------------------------------------------* 00187018
CICS  *  CHANGED 11/14/2022    BY BARB SCHULTZ    WR: CHG0278485        00188021
CICS  *                                                               * 00189020
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00189120
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00189220
CICS  *---------------------------------------------------------------* 00189520
001500                                                                  00190000
001600 ENVIRONMENT DIVISION.                                            00200000
001700                                                                  00210000
001800 DATA DIVISION.                                                   00220000
001900                                                                  00230000
002000 WORKING-STORAGE SECTION.                                         00240000
002100                                                                  00250000
002200 01  PC-PROGRAM-CONSTANTS.                                        00260000
002300     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00270000
002400                                                    'PO066A  '.   00280000
002500     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00290000
002600                                                    'POKM066 '.   00300000
002700     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00310000
002800                                                    'POKCS066'.   00320000
003100     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.      00330000
003200     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.    00340000
003300     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00350000
003400                                                    COMP SYNC.    00360000
003500     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00370000
003600                                                    COMP SYNC.    00380000
003700     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00390000
003800                                                    +1000000      00400000
003900                                                    COMP-3.       00410000
004000     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00420000
004100                                                    COMP SYNC.    00430000
004200 01  PC-TSYMSG-NUMBERS.                                           00440000
004300     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00450000
004400     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00460000
004500     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00470000
004600     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00480000
004700     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.  00490000
004800     05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.  00500000
004900     05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.  00510000
005000     05  PC-TSYMSG-00302                PIC 9(5)    VALUE 00302.  00520000
005100     05  PC-TSYMSG-00984                PIC 9(5)    VALUE 00984.  00530000
005200                                                                  00540000
005300 01  PS-PROGRAM-SUBSCRIPTS.                                       00550000
005400     05  PS-SUB                         PIC S9(04)   VALUE +0     00560000
005500                                                     COMP SYNC.   00570000
005600                                                                  00580000
005700 01  PS-PROGRAM-SWITCHES.                                         00590000
005800     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.   00600000
005900         88  PS-NO-ERROR                             VALUE 'Y'.   00610000
006000         88  PS-ERROR                                VALUE 'N'.   00620000
006100     EJECT                                                        00630000
006200                                                                  00640000
006300 01  PV-PROGRAM-VARIABLES.                                        00650000
006400     05  PV-REMAINDER                   PIC S9(04)   VALUE +0     00660000
006500                                                     COMP SYNC.   00670000
006600     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0     00680000
006700                                                     COMP-3.      00690000
006800     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     00700000
006900                                                     COMP-3.      00710000
007000     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     00720000
007100                                                     COMP-3.      00730000
007200     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     00740000
007300                                                     COMP SYNC.   00750000
007400     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     00760000
007500                                                     COMP SYNC.   00770000
007600     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     00780000
007700                                                     COMP SYNC.   00790000
007800     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     00800000
007900                                                     COMP SYNC.   00810000
008000     05  PV-SQL-SUB                     PIC S9(4)    COMP.        00820000
008100     05  PV-DB2-COUNT                   PIC S9(09)   VALUE +0     00830000
008200                                                     COMP-3.      00840000
008300     05  PV-TRN-DTL-TXT                 PIC X(30)    VALUE SPACES.00850000
008400     05  PV-HOLD-PO-NUMBER              PIC X(30)    VALUE SPACES.00860000
008500     05  PV-TALLY                       PIC S9(04)   COMP         00870000
008600                                                     VALUE +0.    00880000
008700     05  PV-PRE-CONV-DATE               PIC X(10).                00890000
008800                                                                  00900000
008900     05  PV-DATE-10.                                              00910000
009000         10  PV-CENTURY-10              PIC 9(02).                00920000
009100         10  PV-YEAR-10                 PIC 9(02).                00930000
009200         10  FILLER                     PIC X(01)    VALUE SPACES.00940000
009300         10  PV-MONTH-10                PIC 9(02).                00950000
009400         10  FILLER                     PIC X(01)    VALUE SPACES.00960000
009500         10  PV-DAY-10                  PIC 9(02).                00970000
009600                                                                  00980000
009700     05  PV-DATE-8.                                               00990000
009800         10  PV-MONTH-8                 PIC X(02).                01000000
009900         10  FILLER                     PIC X(01)    VALUE '/'.   01010000
010000         10  PV-DAY-8                   PIC X(02).                01020000
010100         10  FILLER                     PIC X(01)    VALUE '/'.   01030000
010200         10  PV-YEAR-8                  PIC X(02).                01040000
010300                                                                  01050000
010400     05  PV-TIME.                                                 01060000
010500         10 PV-HOUR                     PIC 9(02).                01070000
010600         10 PV-COLON                    PIC X(01).                01080000
010700         10 PV-MINUTE                   PIC 9(02).                01090000
010800                                                                  01100000
010900 01  PV-DB2-CRITERIA-AREA.                                        01110000
011000     15  PV-DB2-MESSAGE-NUMBER          PIC S9(05)  VALUE ZERO    01120000
011100                                                    COMP-3.       01130000
011200                                                                  01140000
011300 EJECT                                                            01150000
011400*---------------------------------------------------------------* 01160000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01170020
011600*---------------------------------------------------------------* 01180000
011700                                                                  01190000
011800     COPY DPWS030.                                                01200000
CICS       COPY DPWS930.                                                01201020
011900 EJECT                                                            01210000
012000*---------------------------------------------------------------* 01220000
012100*    STANDARD COMMAREA.                                         * 01230000
012200*---------------------------------------------------------------* 01240000
012300                                                                  01250000
012400     COPY DPWS020.                                                01260000
012500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01270000
012600                                                                  01280000
012700*---------------------------------------------------------------* 01290000
012800*    INTER-APPLICATION COMMAREA.                                * 01300000
012900*---------------------------------------------------------------* 01310000
013000                                                                  01320000
013100         10  INTER-APPL-COMM-AREA       PIC X(200).               01330000
013200     COPY POWS017.                                                01340000
013300                                                                  01350000
013400*---------------------------------------------------------------* 01360000
013500*    SPECIFIC COMMMAREA FOR POKCS066.                           * 01370000
013600*---------------------------------------------------------------* 01380000
013700         10  ASC-SPECIFIC-COMMAREA.                               01390000
013800             15  ASC-LIST-KEYS.                                   01400000
013900                 20  ASC-KEY-PO-NUMBER               PIC S9(09)   01410000
014000                                                         COMP.    01420000
C98147                 20  ASC-PO-NUMBER                   PIC 9(08).   01430014
014200                 20  ASC-NETWORK-NAME                PIC X(15).   01440000
014320                 20  ASC-ENT-NAME-DESC               PIC X(30).   01450009
014400                 20  ASC-BLNKT-RLS-IND               PIC X(01).   01460001
014600                 20  ASC-PACK-BY-STORE-IND           PIC X(01).   01470000
014700             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                01480000
014800                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  01490000
014900                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   01500000
015000                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   01510000
015100                 20  ASC-ITEM-ENTRIES OCCURS 12 TIMES.            01520000
015200                     25  ASC-LIST-ITEM-NUMBER        PIC S9(09)   01530000
015300                                                     COMP-3.      01540000
015400                     25  ASC-CRE-DATE                PIC X(8).    01550000
015500                     25  ASC-CRE-TIME                PIC X(5).    01560000
015600                     25  ASC-MAILBOX-REC-DATE        PIC X(8).    01570000
015700                     25  ASC-MAILBOX-REC-TIME        PIC X(5).    01580000
015800                     25  ASC-MAILBOX-PU-DATE         PIC X(8).    01590000
015900                     25  ASC-MAILBOX-PU-TIME         PIC X(5).    01600000
016000                     25  ASC-VEND-ACK-IND            PIC X(1).    01610000
016100                     25  ASC-PROD-TEST-IND           PIC X(1).    01620000
016200                                                                  01630000
016300             15  ASC-BLK-SUB                         PIC S9(04)   01640000
016400                                                         COMP     01650000
016500                                                         SYNC.    01660000
016600             15  ASC-ITEM-SUB                        PIC S9(04)   01670000
016700                                                         COMP     01680000
016800                                                         SYNC.    01690000
016900             15  ASC-SEL-SUB                         PIC S9(04)   01700000
017000                                                         COMP.    01710000
017100             15  ASC-SEL-ITEM                        PIC S9(04)   01720000
017200                                                         COMP.    01730000
017300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   01740000
017400                                                         COMP-3.  01750000
017500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   01760000
017600                                                         COMP-3.  01770000
017700             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   01780000
017800                                                         COMP-3.  01790000
017900             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   01800000
018000                                                         COMP-3.  01810000
018100             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   01820000
018200                                                         COMP-3.  01830000
018300             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   01840000
018400                                                         COMP-3.  01850000
018500             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   01860000
018600                                                         COMP     01870000
018700                                                         SYNC.    01880000
018800             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   01890000
018900                                                         COMP-3.  01900000
019000             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   01910000
019100                                                         COMP-3.  01920000
019200             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  01930000
019300                 88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'. 01940000
019400                 88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'. 01950000
019500             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  01960000
019600                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 01970000
019700             15  ASC-DESC-LINE-IND                   PIC  X(01).  01980000
019800                 88  ASC-DESC-LINE-DONE                VALUE 'Y'. 01990000
019900             15  ASC-CORR-LINE-IND                   PIC  X(01).  02000000
020000                 88  ASC-CORR-LINE-DONE                VALUE 'Y'. 02010000
020100             15  ASC-LIST-QUEUE-NAME.                             02020000
020200                 20  ASC-LIST-TERM-ID                PIC  X(04).  02030000
020300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   02040000
020400                                                         COMP-3.  02050000
020500                 20  ASC-LIST-SEQ                    PIC  9(01).  02060000
020600             15  ASC-SEL-QUEUE-NAME.                              02070000
020700                 20  ASC-SEL-TERM-ID                 PIC  X(04).  02080000
020800                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   02090000
020900                                                          COMP-3. 02100000
021000                 20  ASC-SEL-SEQ                     PIC  9(01).  02110000
021100             15  ASC-DTL-QUEUE-NAME.                              02120000
021200                 20  ASC-DTL-TERM-ID                 PIC  X(04).  02130000
021300                 20  ASC-DTL-TASK-NUMBER             PIC S9(05)   02140000
021400                                                         COMP-3.  02150000
021500                 20  ASC-DTL-SEQ                     PIC  9(01).  02160000
021600                                                                  02170000
021700             15  ASC-START-ITEM-REQUEST.                          02180000
021800                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  02190000
021900                                                                  02200000
022000     EJECT                                                        02210000
022100                                                                  02220000
022200*---------------------------------------------------------------* 02230000
022300*    ABEND PROCESSING COPYBOOK.                                 * 02240000
022400*---------------------------------------------------------------* 02250000
022500                                                                  02260000
022600     COPY DPWS013.                                                02270000
022700                                                                  02280000
022800     EJECT                                                        02290000
022900*---------------------------------------------------------------* 02300000
023000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02310000
023100*---------------------------------------------------------------* 02320000
023200                                                                  02330000
023300     COPY DPWS015.                                                02340000
023400                                                                  02350000
023500*---------------------------------------------------------------* 02360000
023600*    FUNCTION KEYS COPYBOOK.                                    * 02370000
023700*---------------------------------------------------------------* 02380000
023800                                                                  02390000
023900     COPY DPWS016.                                                02400000
024000                                                                  02410000
024100*---------------------------------------------------------------* 02420000
024200*    NUMERIC EDIT LAYOUT.                                       * 02430000
024300*---------------------------------------------------------------* 02440000
024400                                                                  02450000
024500     COPY DPWS010I.                                               02460000
024600                                                                  02470000
024700*---------------------------------------------------------------* 02480000
024800*    MAP LAYOUT                                                 * 02490000
024900*---------------------------------------------------------------* 02500000
025000                                                                  02510000
025100     COPY POKM066.                                                02520000
025200                                                                  02530000
025300 01  MR-OCCURS-LAYOUT           REDEFINES  PO066AO.               02540000
025400     05  FILLER                 PIC X(48).                        02550000
025500                                                                  02560000
025600     05  MR-ENT-NAME-DESC-L     PIC S9(04) COMP.                  02570000
025700     05  MR-ENT-NAME-DESC-A     PIC  X(01).                       02580000
025800     05  MR-ENT-NAME-DESC-C     PIC  X(01).                       02590000
025900     05  MR-ENT-NAME-DESC-H     PIC  X(01).                       02600000
026000     05  MR-ENT-NAME-DESC       PIC  X(30).                       02610000
026100                                                                  02620005
026300     05  MR-BLNKT-RLS-IND-L     PIC S9(04) COMP.                  02630005
026400     05  MR-BLNKT-RLS-IND-A     PIC  X(01).                       02640005
026500     05  MR-BLNKT-RLS-IND-C     PIC  X(01).                       02650005
026600     05  MR-BLNKT-RLS-IND-H     PIC  X(01).                       02660005
026700     05  MR-BLNKT-RLS-IND       PIC  X(01).                       02670005
026900                                                                  02680000
027000     05  MR-PO-NBR-L            PIC S9(04) COMP.                  02690000
027100     05  MR-PO-NBR-A            PIC  X(01).                       02700000
027200     05  MR-PO-NBR-C            PIC  X(01).                       02710000
027300     05  MR-PO-NBR-H            PIC  X(01).                       02720000
C98147     05  MR-PO-NBR-X.                                             02730015
C98147         10  MR-PO-NBR          PIC  Z(08).                       02740015
027500                                                                  02750000
027600     05  MR-NTWK-NAME-L         PIC S9(04) COMP.                  02760000
027700     05  MR-NTWK-NAME-A         PIC  X(01).                       02770000
027800     05  MR-NTWK-NAME-C         PIC  X(01).                       02780000
027900     05  MR-NTWK-NAME-H         PIC  X(01).                       02790000
028000     05  MR-NTWK-NAME           PIC  X(15).                       02800000
028100                                                                  02810001
028200     05  MR-PACK-STOR-L         PIC S9(04) COMP.                  02820000
028300     05  MR-PACK-STOR-A         PIC  X(01).                       02830000
028400     05  MR-PACK-STOR-C         PIC  X(01).                       02840000
028500     05  MR-PACK-STOR-H         PIC  X(01).                       02850000
028600     05  MR-PACK-STOR           PIC  X(01).                       02860000
028700                                                                  02870000
028800     05  MR-SCROLL-AREA OCCURS 12 TIMES.                          02880000
028900         10  MR-CRE-DTE-L       PIC S9(04) COMP.                  02890000
029000         10  MR-CRE-DTE-A       PIC  X(01).                       02900000
029100         10  MR-CRE-DTE-C       PIC  X(01).                       02910000
029200         10  MR-CRE-DTE-H       PIC  X(01).                       02920000
029300         10  MR-CRE-DTE         PIC  X(08).                       02930000
029400                                                                  02940000
029500         10  MR-CRE-TME-L       PIC S9(04) COMP.                  02950000
029600         10  MR-CRE-TME-A       PIC  X(01).                       02960000
029700         10  MR-CRE-TME-C       PIC  X(01).                       02970000
029800         10  MR-CRE-TME-H       PIC  X(01).                       02980000
029900         10  MR-CRE-TME         PIC  X(05).                       02990000
030000                                                                  03000000
030100         10  MR-MLBX-REC-DTE-L  PIC S9(04) COMP.                  03010000
030200         10  MR-MLBX-REC-DTE-A  PIC  X(01).                       03020000
030300         10  MR-MLBX-REC-DTE-C  PIC  X(01).                       03030000
030400         10  MR-MLBX-REC-DTE-H  PIC  X(01).                       03040000
030500         10  MR-MLBX-REC-DTE    PIC  X(08).                       03050000
030600                                                                  03060000
030700         10  MR-MLBX-REC-TME-L  PIC S9(04) COMP.                  03070000
030800         10  MR-MLBX-REC-TME-A  PIC  X(01).                       03080000
030900         10  MR-MLBX-REC-TME-C  PIC  X(01).                       03090000
031000         10  MR-MLBX-REC-TME-H  PIC  X(01).                       03100000
031100         10  MR-MLBX-REC-TME    PIC  X(05).                       03110000
031200                                                                  03120000
031300         10  MR-MLBX-PU-DTE-L   PIC S9(04) COMP.                  03130000
031400         10  MR-MLBX-PU-DTE-A   PIC  X(01).                       03140000
031500         10  MR-MLBX-PU-DTE-C   PIC  X(01).                       03150000
031600         10  MR-MLBX-PU-DTE-H   PIC  X(01).                       03160000
031700         10  MR-MLBX-PU-DTE     PIC  X(08).                       03170000
031800                                                                  03180000
031900         10  MR-MLBX-PU-TME-L   PIC S9(04) COMP.                  03190000
032000         10  MR-MLBX-PU-TME-A   PIC  X(01).                       03200000
032100         10  MR-MLBX-PU-TME-C   PIC  X(01).                       03210000
032200         10  MR-MLBX-PU-TME-H   PIC  X(01).                       03220000
032300         10  MR-MLBX-PU-TME     PIC  X(05).                       03230000
032400                                                                  03240000
032500         10  MR-VNDR-ACK-IND-L  PIC S9(04) COMP.                  03250000
032600         10  MR-VNDR-ACK-IND-A  PIC  X(01).                       03260000
032700         10  MR-VNDR-ACK-IND-C  PIC  X(01).                       03270000
032800         10  MR-VNDR-ACK-IND-H  PIC  X(01).                       03280000
032900         10  MR-VNDR-ACK-IND    PIC  X(01).                       03290000
033000                                                                  03300000
033100         10  MR-PROD-TEST-IND-L PIC S9(04) COMP.                  03310000
033200         10  MR-PROD-TEST-IND-A PIC  X(01).                       03320000
033300         10  MR-PROD-TEST-IND-C PIC  X(01).                       03330000
033400         10  MR-PROD-TEST-IND-H PIC  X(01).                       03340000
033500         10  MR-PROD-TEST-IND   PIC  X(01).                       03350000
033600                                                                  03360000
033700 EJECT                                                            03370000
033800*---------------------------------------------------------------* 03380000
033900*    COPYBOOK FOR CALENDAR ROUTINE.                             * 03390000
034000*---------------------------------------------------------------* 03400000
034100                                                                  03410000
034200     COPY DPWS500.                                                03420000
034300 EJECT                                                            03430000
034400*---------------------------------------------------------------* 03440000
034500*    DB2 AREA FOR TPURCHS TABLE                                 * 03450000
034600*---------------------------------------------------------------* 03460000
034700     EXEC SQL                                                     03470000
034800          INCLUDE TPURCHS                                         03480000
034900     END-EXEC.                                                    03490000
035000*---------------------------------------------------------------* 03500000
035100*    DB2 AREA FOR TPOAGMT TABLE                                 * 03510000
035200*---------------------------------------------------------------* 03520000
035300     EXEC SQL                                                     03530000
035400          INCLUDE TPOAGMT                                         03540000
035500     END-EXEC.                                                    03550000
035600*---------------------------------------------------------------* 03560000
035700*    DB2 AREA FOR TTRDPRT TABLE                                 * 03570000
035800*---------------------------------------------------------------* 03580000
035900     EXEC SQL                                                     03590000
036000          INCLUDE TTRDPRT                                         03600000
036100     END-EXEC.                                                    03610000
036200*---------------------------------------------------------------* 03620000
036300*    DB2 AREA FOR TTRDTRN TABLE                                 * 03630000
036400*---------------------------------------------------------------* 03640000
036500*    EXEC SQL                                                     03650000
036600*         INCLUDE TTRDTRN                                         03660000
036700*    END-EXEC.                                                    03670000
036800*---------------------------------------------------------------* 03680000
036900*    DB2 AREA FOR TINTTRN TABLE                                 * 03690000
037000*---------------------------------------------------------------* 03700000
037100     EXEC SQL                                                     03710000
037200          INCLUDE TINTTRN                                         03720000
037300     END-EXEC.                                                    03730000
037400*---------------------------------------------------------------* 03740000
037500*    DB2 AREA FOR TFGTRST TABLE                                 * 03750000
037600*---------------------------------------------------------------* 03760000
037700     EXEC SQL                                                     03770000
037800          INCLUDE TFGTRST                                         03780000
037900     END-EXEC.                                                    03790000
038000*---------------------------------------------------------------* 03800000
038100*    DB2 AREA FOR TNETWRK TABLE                                 * 03810000
038200*---------------------------------------------------------------* 03820000
038300     EXEC SQL                                                     03830000
038400          INCLUDE TNETWRK                                         03840000
038500     END-EXEC.                                                    03850000
038600*---------------------------------------------------------------* 03860000
038700*    DB2 AREA FOR COMMUNICATIONS                                * 03870000
038800*---------------------------------------------------------------* 03880000
038900     EXEC SQL                                                     03890000
039000          INCLUDE SQLCA                                           03900000
039100     END-EXEC.                                                    03910000
039200                                                                  03920000
039300     EXEC SQL                                                     03930000
039400          DECLARE EDI-CSR CURSOR FOR                              03940000
039500          SELECT                                                  03950000
039600              C.PROD_TEST_IND,                                    03960000
039700              C.CRE_DTE,                                          03970000
039800              C.CRE_TME,                                          03980000
039900              C.MAILBOX_REC_DTE,                                  03990000
040000              C.MAILBOX_REC_TME,                                  04000000
040100              C.MAILBOX_PU_DTE,                                   04010000
040200              C.MAILBOX_PU_TME,                                   04020000
040300              C.TP_DKEY_TMST,                                     04030000
040400              D.VEND_ACK_IND,                                     04040000
040500              F.NETWK_ID,                                         04050000
040600              F.NETWK_NME,                                        04060006
040611              E.DEST_KNOWN_IND                                    04070006
040700          FROM                                                    04080000
040800              TTRDPRT A,                                          04090000
040900*             TTRDTRN B,                                          04100000
041000              TINTTRN C,                                          04110000
041100              TFGTRST D,                                          04120000
041200              TPURCHS E,                                          04130000
041300              TNETWRK F                                           04140000
041400          WHERE E.PO_NBR         = :ASC-KEY-PO-NUMBER AND         04150000
041500                E.VER_STATUS_CDE = 'A'                AND         04160000
041600                A.ENT_ID         = E.ENT_ID           AND         04170000
041700*               B.TP_DKEY        = A.TP_DKEY          AND         04180000
041800*               B.TRAN_SET_CDE   = '850'              AND         04190000
041900*               B.DIR_IND        = 'S'                AND         04200000
042000*               B.INACTV_DTE     > CURRENT DATE       AND         04210000
042100                C.TP_DKEY        = A.TP_DKEY          AND         04220000
042200*               C.PROD_TEST_IND  = B.PROD_TEST_IND    AND         04230000
042300                C.DIR_IND        = 'S'                AND         04240000
042400                D.TP_DKEY        = C.TP_DKEY          AND         04250000
042500                D.TP_DKEY_TMST   = C.TP_DKEY_TMST     AND         04260000
042600                D.TRN_DTL_TXT    = :PV-TRN-DTL-TXT    AND         04270000
042700                D.TRN_SET_CDE    = '850'              AND         04280000
042800                F.NETWK_ID       = A.NETWK_ID                     04290000
042900          ORDER BY                                                04300000
043000                C.TP_DKEY_TMST DESC                               04310000
043100     END-EXEC.                                                    04320000
043200                                                                  04330000
043300 EJECT                                                            04340000
043400 LINKAGE SECTION.                                                 04350000
043500                                                                  04360000
043600 01  DFHCOMMAREA.                                                 04370000
043700     05  FILLER                         OCCURS  1 TO 4072 TIMES   04380000
043800                                        DEPENDING ON EIBCALEN.    04390000
043900         10  FILLER                     PIC X.                    04400000
044000                                                                  04410000
044100 EJECT                                                            04420000
044200 PROCEDURE DIVISION.                                              04430000
044300                                                                  04440000
044400***************************************************************** 04450000
044500** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 04460000
044600** THE SETUP AND PERFORM OF PARAGRAPH 9000-CALL-CICS-ARCH-API  ** 04470000
044700** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 04480000
044800**                                                             ** 04490000
044900** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 04500000
045000** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 04510000
045100***************************************************************** 04520000
045200 0000-MAIN-MODULE.                                                04530000
045300                                                                  04540000
045400     INITIALIZE DP030-CICS-API-FIELDS.                            04550000
045500                                                                  04560000
045600     MOVE +1                      TO DP030-NUMBER-OF-MAPS.        04570000
045700     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           04580000
045800     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          04590000
045900                                                                  04600000
046000     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        04610000
046100                                                                  04620000
046200     MOVE LENGTH OF PO066AI       TO DP030-MAP-LENGTH (1).        04630000
046300     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      04640000
046400                                                                  04650000
046500     PERFORM 9000-CALL-CICS-ARCH-API.                             04660000
046600     PERFORM 1000-CONTROL-PROCESSING.                             04670000
046700                                                                  04680000
046800     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      04690000
046900     PERFORM 9000-CALL-CICS-ARCH-API.                             04700000
047000                                                                  04710000
047100*----------------------------------------------------------------*04720000
047200*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04730000
047300*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04740000
047400*----------------------------------------------------------------*04750000
047500                                                                  04760000
047600 1000-CONTROL-PROCESSING.                                         04770000
047700                                                                  04780000
047800     EVALUATE TRUE                                                04790000
047900         WHEN DP020-NEXT-ACT-INITIAL                              04800000
048000             INITIALIZE ASC-SPECIFIC-COMMAREA                     04810000
048100             MOVE SPACE             TO ASC-START-ITEM-REQUEST     04820000
048200             MOVE EIBTRMID          TO ASC-DTL-TERM-ID            04830000
048300             MOVE DP020-SRC-TASK-NUMBER                           04840000
048400                                    TO ASC-DTL-TASK-NUMBER        04850000
048500             MOVE PC-DTL-QUEUE-SEQ  TO ASC-DTL-SEQ                04860000
048600             PERFORM 2050-DELETE-DETAIL-QUEUE                     04870000
048700             PERFORM 4000-BUILD-INITIAL-PANEL                     04880000
048800                                                                  04890000
048900         WHEN DP020-NEXT-ACT-READ-MAP                             04900000
049000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04910000
049100                               TO PV-TOP-ITEM                     04920000
049200             PERFORM 2000-PROCESS-PANEL                           04930000
049300                                                                  04940000
049400         WHEN DP020-NEXT-ACT-RETURN                               04950000
049500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04960000
049600                               TO PV-TOP-ITEM                     04970000
049700             MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL        04980000
049800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04990000
049900                                                                  05000000
050000         WHEN OTHER                                               05010000
050100             SET DP013-LOGIC-ABEND TO TRUE                        05020000
050200             SET DP013-NO-ROLLBACK TO TRUE                        05030000
050300             MOVE '1000-CONTROL-PROCESSING'                       05040000
050400                               TO  DP013-PARAGRAPH                05050000
050500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05060000
050600                               TO  DP013-MESSAGE-TEXT(1)          05070000
050700             PERFORM DP013-0000-PROCESS-ABEND                     05080000
050800     END-EVALUATE.                                                05090000
050900                                                                  05100000
051000 EJECT                                                            05110000
051100                                                                  05120000
051200*----------------------------------------------------------------*05130000
051300*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *05140000
051400*    ON WHAT FUNCTION KEY WAS SELECTED.                          *05150000
051500*----------------------------------------------------------------*05160000
051600                                                                  05170000
051700 2000-PROCESS-PANEL.                                              05180000
051800                                                                  05190000
051900     EVALUATE TRUE                                                05200000
052000         WHEN DP020-SRC-AID = DP016-CLEAR                         05210000
052100             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                05220000
052200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05230000
052300             PERFORM 3200-RESET-ATTRIBUTES                        05240000
052400                                                                  05250000
052500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05260000
052600             PERFORM 2050-DELETE-DETAIL-QUEUE                     05270000
052700             PERFORM 4000-BUILD-INITIAL-PANEL                     05280000
052800             PERFORM 3200-RESET-ATTRIBUTES                        05290000
052900                                                                  05300000
053000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05310000
053100             MOVE +1 TO PV-TOP-ITEM                               05320000
053200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05330000
053300             PERFORM 3200-RESET-ATTRIBUTES                        05340000
053400                                                                  05350000
053500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05360000
053600             PERFORM 2110-BROWSE-BACKWARD                         05370000
053700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05380000
053800             PERFORM 3200-RESET-ATTRIBUTES                        05390000
053900                                                                  05400000
054000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05410000
054100             PERFORM 2120-BROWSE-FORWARD                          05420000
054200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05430000
054300             PERFORM 3200-RESET-ATTRIBUTES                        05440000
054400                                                                  05450000
054500         WHEN DP020-SRC-AID = DP016-ENTER                         05460000
054600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   05470000
054700             IF  PS-ERROR                                         05480000
054800                 CONTINUE                                         05490000
054900             ELSE                                                 05500000
055000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05510000
055100                 PERFORM 3200-RESET-ATTRIBUTES                    05520000
055200             END-IF                                               05530000
055300                                                                  05540000
055400         WHEN OTHER                                               05550000
055500             SET DP013-NO-ROLLBACK TO TRUE                        05560000
055600             SET DP013-XCTL-DISPLAY-RESTART TO TRUE               05570000
055700             SET DP013-CICS-ABEND TO TRUE                         05580000
055800             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    05590000
055900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05600000
056000                                   TO DP013-MESSAGE-TEXT (1)      05610000
056100             PERFORM DP013-0000-PROCESS-ABEND                     05620000
056200                                                                  05630000
056300     END-EVALUATE.                                                05640000
056400 EJECT                                                            05650000
056500*----------------------------------------------------------------*05660000
056600*    DELETE THE TEMPORARY STORAGE QUEUE.                         *05670000
056700*----------------------------------------------------------------*05680000
056800                                                                  05690000
056900 2050-DELETE-DETAIL-QUEUE.                                        05700000
057000                                                                  05710000
057100     EXEC CICS                                                    05720000
057200         DELETEQ TS                                               05730000
057300             QUEUE (ASC-DTL-QUEUE-NAME)                           05740000
057400             RESP  (PV-CICS-RESP)                                 05750000
057500     END-EXEC.                                                    05760000
057600                                                                  05770000
057700     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05780000
057800        (PV-CICS-RESP = DFHRESP(QIDERR))                          05790000
057900         CONTINUE                                                 05800000
058000     ELSE                                                         05810000
058100         SET DP013-CICS-ABEND TO TRUE                             05820000
058200         SET DP013-NO-ROLLBACK TO TRUE                            05830000
058300                                                                  05840000
058400         MOVE '2050-DELETE-DETAIL-QUEUE' TO DP013-PARAGRAPH       05850000
058500         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'  05860000
058600                        TO DP013-MESSAGE-TEXT (1)                 05870000
058700         PERFORM DP013-0000-PROCESS-ABEND                         05880000
058800     END-IF.                                                      05890000
058900                                                                  05900000
059000     MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                        05910000
059100 EJECT                                                            05920000
059200*----------------------------------------------------------------*05930000
059300*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *05940000
059400*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *05950000
059500*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *05960000
059600*    MESSAGE.                                                    *05970000
059700*----------------------------------------------------------------*05980000
059800                                                                  05990000
059900 2110-BROWSE-BACKWARD.                                            06000000
060000                                                                  06010000
060100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06020000
060200         GIVING PV-TOP-ITEM.                                      06030000
060300                                                                  06040000
060400     IF  PV-TOP-ITEM < +1                                         06050000
060500         MOVE +1              TO PV-TOP-ITEM                      06060000
060600*        -- TOP OF LIST --                                        06070000
060700         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                 06080000
060800         SET DP020-MSG-INFORMATIONAL TO TRUE                      06090000
060900     END-IF.                                                      06100000
061000                                                                  06110000
061100 EJECT                                                            06120000
061200                                                                  06130000
061300*----------------------------------------------------------------*06140000
061400*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06150000
061500*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06160000
061600*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06170000
061700*----------------------------------------------------------------*06180000
061800                                                                  06190000
061900 2120-BROWSE-FORWARD.                                             06200000
062000                                                                  06210000
062100     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06220000
062200         GIVING PV-TOP-ITEM.                                      06230000
062300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06240000
062400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06250000
062500                                   TO PV-TOP-ITEM                 06260000
062600*        -- BOTTOM OF LIST --                                     06270000
062700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06280000
062800         SET DP020-MSG-INFORMATIONAL                              06290000
062900                                   TO TRUE                        06300000
063000     ELSE                                                         06310000
063100         COMPUTE PV-BOTTOM-ITEM =                                 06320000
063200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06330000
063300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06340000
063400*            -- BOTTOM OF LIST --                                 06350000
063500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06360000
063600             SET DP020-MSG-INFORMATIONAL                          06370000
063700                                   TO TRUE                        06380000
063800         END-IF                                                   06390000
063900     END-IF.                                                      06400000
064000 EJECT                                                            06410000
064100*----------------------------------------------------------------*06420000
064200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06430000
064300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06440000
064400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06450000
064500*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *06460000
064600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06470000
064700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *06480000
064800*----------------------------------------------------------------*06490000
064900                                                                  06500000
065000 2130-CHECK-FOR-JUMP-BROWSE.                                      06510000
065100                                                                  06520000
065200     IF ASTRTITL > ZERO                                           06530000
065300         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      06540000
065400     ELSE                                                         06550000
065500         IF ASTRTITF = DP015-ERASE-EOF                            06560000
065600             INITIALIZE ASC-START-ITEM-REQUEST                    06570000
065700         END-IF                                                   06580000
065800     END-IF.                                                      06590000
065900                                                                  06600000
066000     SET PS-NO-ERROR               TO TRUE.                       06610000
066100     IF (ASC-START-ITEM-REQUEST = SPACE)                          06620000
066200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06630000
066300                                   TO PV-TOP-ITEM                 06640000
066400     ELSE                                                         06650000
066500         MOVE ASC-START-ITEM-REQUEST                              06660000
066600                                   TO DP010I-UNEDITED-FIELD       06670000
066700         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       06680000
066800         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     06690000
066900         SET DP010I-NEGATIVE-NOT-ALLOWED                          06700000
067000                                   TO TRUE                        06710000
264220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06721017
264230                         USING DP010I-NUMERIC-EDIT-AREA           06722017
067200                                                                  06730000
067300         IF  NOT DP010I-ERROR-DETECTED                            06740000
067400             MOVE DP010I-NUMERIC-FIELD                            06750000
067500                                   TO  ASC-START-ITEM-REQUEST-N   06760000
067600             IF  ASC-START-ITEM-REQUEST-N > ZERO                  06770000
067700                 IF  ASC-START-ITEM-REQUEST-N >                   06780000
067800                                          ASC-NUMBER-OF-ITEMS-READ06790000
067900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         06800000
068000                     COMPUTE PV-TOP-ITEM =                        06810000
068100                             ASC-NUMBER-OF-ITEMS-READ             06820000
068200                             - PC-ITEMS-PER-PANEL + 1             06830000
068300                     IF  PV-TOP-ITEM < +1                         06840000
068400                         MOVE +1   TO PV-TOP-ITEM                 06850000
068500                         MOVE PC-TSYMSG-00070                     06860000
068600                                   TO DP020-MSG-NUMBER            06870000
068700                         SET DP020-MSG-INFORMATIONAL              06880000
068800                                   TO TRUE                        06890000
068900                     END-IF                                       06900000
069000                 ELSE                                             06910000
069100                     MOVE ASC-START-ITEM-REQUEST-N                06920000
069200                                   TO PV-TOP-ITEM                 06930000
069300                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      06940000
069400                     COMPUTE PV-BOTTOM-ITEM =                     06950000
069500                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     06960000
069600                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ06970000
069700*                        -- BOTTOM OF LIST --                     06980000
069800                         MOVE PC-TSYMSG-00070                     06990000
069900                                   TO DP020-MSG-NUMBER            07000000
070000                         SET DP020-MSG-INFORMATIONAL              07010000
070100                                   TO TRUE                        07020000
070200                     END-IF                                       07030000
070300                 END-IF                                           07040000
070400             ELSE                                                 07050000
070500*                --- VALUE OUT OF RANGE ----                      07060000
070600                 MOVE PC-TSYMSG-00101                             07070000
070700                                   TO DP020-MSG-NUMBER            07080000
070800                 MOVE -1           TO ASTRTITL                    07090000
070900                 SET DP030-SET-CURSOR-APPL-1                      07100000
071000                                   TO TRUE                        07110000
071100                 MOVE DP015-REVERSE                               07120000
071200                                   TO ASTRTITH                    07130000
071300                 MOVE DP015-RED    TO ASTRTITC                    07140000
071400                 MOVE DP015-UNP-NUM-BRT-MDT                       07150000
071500                                   TO ASTRTITA                    07160000
071600                 SET DP020-MSG-FATAL                              07170000
071700                                   TO TRUE                        07180000
071800                 SET PS-ERROR      TO TRUE                        07190000
071900             END-IF                                               07200000
072000                                                                  07210000
072100         ELSE                                                     07220000
072200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07230000
072300             MOVE -1               TO ASTRTITL                    07240000
072400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07250000
072500             MOVE DP015-REVERSE    TO ASTRTITH                    07260000
072600             MOVE DP015-RED        TO ASTRTITC                    07270000
072700             MOVE DP015-UNP-NUM-BRT-MDT                           07280000
072800                                   TO ASTRTITA                    07290000
072900             SET DP020-MSG-FATAL   TO TRUE                        07300000
073000             SET PS-ERROR          TO TRUE                        07310000
073100         END-IF                                                   07320000
073200     END-IF.                                                      07330000
073300 EJECT                                                            07340000
073400                                                                  07350000
073500*----------------------------------------------------------------*07360000
073600*    RESET ATTRIBUTES.                                           *07370000
073700*----------------------------------------------------------------*07380000
073800                                                                  07390000
073900 3200-RESET-ATTRIBUTES.                                           07400000
074000                                                                  07410000
074100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   07420000
074200     MOVE DP015-GREEN              TO ASTRTITC.                   07430000
074300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   07440000
074400     MOVE -1                       TO ASTRTITL.                   07450000
074500     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07460000
074600                                                                  07470000
074700 EJECT                                                            07480000
074800                                                                  07490000
074900*----------------------------------------------------------------*07500000
075000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *07510000
075100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *07520000
075200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *07530000
075300*    DISPLAY THE PANEL TO USER.                                  *07540000
075400*----------------------------------------------------------------*07550000
075500                                                                  07560000
075600 4000-BUILD-INITIAL-PANEL.                                        07570000
075700                                                                  07580000
075800     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            07590000
075900                                 ASC-BLOCK-ENTRIES (2).           07600000
076000     MOVE +1                 TO  ASC-BLK-SUB.                     07610000
076100     SET ASC-ITEMS-LEFT-ON-DB                                     07620000
076200                             TO  TRUE.                            07630000
076300                                                                  07640000
076400     MOVE +0                 TO  ASC-ITEM-SUB                     07650000
076500                                 ASC-NUMBER-OF-ITEMS-READ         07660000
076600                                 ASC-NUMBER-OF-SELECTED-ITEMS     07670000
076700                                 ASC-HIGHEST-BLOCK-WRITTEN        07680000
076800                                 ASC-START-OF-SELECTED-RANGE      07690000
076900                                 ASC-END-OF-SELECTED-RANGE        07700000
077000                                 ASC-ITEM-AT-TOP-OF-PANEL.        07710000
077100                                                                  07720000
077200     MOVE SPACE              TO  ASC-DESC-LINE-IND                07730000
077300                                 ASC-CORR-LINE-IND.               07740000
077400                                                                  07750000
077500     MOVE PO017-PO-NBR       TO ASC-KEY-PO-NUMBER.                07760000
077520     MOVE PO017-ENT-NAME-DESC TO ASC-ENT-NAME-DESC.               07770009
077600                                                                  07780000
077700     PERFORM 4100-SELECT-TPOAGMT.                                 07790000
077800     IF PV-DB2-COUNT > 0                                          07800000
077900         MOVE 'Y' TO ASC-PACK-BY-STORE-IND                        07810000
078000     ELSE                                                         07820000
078100         MOVE 'N' TO ASC-PACK-BY-STORE-IND.                       07830000
078200                                                                  07840000
078700     MOVE +0 TO PV-TALLY.                                         07850000
C98147     MOVE ASC-KEY-PO-NUMBER TO PV-HOLD-PO-NUMBER                  07860014
C98147                               ASC-PO-NUMBER.                     07870014
C98147     MOVE SPACE TO PV-TRN-DTL-TXT.                                07880014
079100                                                                  07890000
079200     INSPECT PV-HOLD-PO-NUMBER                                    07900000
079300         TALLYING PV-TALLY                                        07910000
079400         FOR                                                      07920000
079500             LEADING ZEROES.                                      07930000
079600                                                                  07940000
079700     MOVE PV-HOLD-PO-NUMBER(1 + PV-TALLY:30 - PV-TALLY) TO        07950000
079800          PV-TRN-DTL-TXT.                                         07960000
080000                                                                  07970000
080100     PERFORM 4200-OPEN-EDI-CURSOR.                                07980000
080200     PERFORM 4210-READ-ITEMS-FROM-DB.                             07990000
080300     PERFORM 4300-CLOSE-EDI-CURSOR.                               08000000
080400                                                                  08010000
080500     MOVE +1                 TO  PV-TOP-ITEM.                     08020000
080600     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          08030000
080700         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    08040000
080800         SET DP020-MSG-FATAL   TO  TRUE                           08050000
080900         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               08060000
081000     ELSE                                                         08070000
081100         MOVE -1             TO ASTRTITL                          08080000
081200         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08090000
081300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     08100000
081400     END-IF.                                                      08110000
081500 EJECT                                                            08120000
081600                                                                  08130000
081700*----------------------------------------------------------------*08140000
081800*    SELECT ROW FROM TPOAGMT TABLE. IF ROWS ARE FOUND WE KNOW    *08150000
081900*    THE PACK BY STORE INDICATOR SHOULD BE SET TO 'Y'. IF NO     *08160000
082000*    ROWS ARE RETURNED, THE PACK BY STORE INDICATOR IS SET TO 'N'*08170000
082100*----------------------------------------------------------------*08180000
082200 4100-SELECT-TPOAGMT.                                             08190000
082300                                                                  08200000
082400     MOVE ZEROES TO PV-DB2-COUNT.                                 08210000
082500                                                                  08220000
082600     EXEC SQL                                                     08230000
082700          SELECT COUNT(*)                                         08240000
082800          INTO :PV-DB2-COUNT                                      08250000
082900          FROM TPOAGMT                                            08260000
083000          WHERE PO_NBR = :ASC-KEY-PO-NUMBER AND                   08270000
083100                VER_STATUS_CDE = 'A' AND                          08280000
083200                AGRMT_TYP_ID = '4' AND                            08290000
083300                TYP_CDE =  4                                      08300000
083400     END-EXEC                                                     08310000
083500                                                                  08320000
083600     EVALUATE TRUE                                                08330000
083700         WHEN SQLCODE = +0                                        08340000
083800         WHEN SQLCODE = +100                                      08350000
083900              CONTINUE                                            08360000
084000         WHEN SQLCODE = -904                                      08370000
084100         WHEN SQLCODE = -911                                      08380000
084200         WHEN SQLCODE = -913                                      08390000
084300              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       08400000
084400              SET PS-ERROR                                        08410000
084500                  DP020-NEXT-ACT-APPL-ERROR                       08420000
084600                  DP020-MSG-FATAL                                 08430000
084700                      TO TRUE                                     08440000
084800              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 08450000
084900              PERFORM 9000-CALL-CICS-ARCH-API                     08460000
085000                                                                  08470000
085100         WHEN SQLWARN0 NOT = SPACES                               08480000
085200         WHEN SQLCODE < +0                                        08490000
085300         WHEN SQLCODE > +0                                        08500000
085400              MOVE '4100-SELECT-TPOAGMT'                          08510000
085500                              TO DP013-PARAGRAPH                  08520000
085600              MOVE 'UNSUCCESSFUL SELECT ON TPOAGMT'               08530000
085700                              TO DP013-MESSAGE-TEXT (1)           08540000
085800              MOVE SQLCA      TO DP013-SQLCA                      08550000
085900              MOVE 'TPOAGMT ' TO DP013-DB2-TABLE-NAME (1)         08560000
086000              SET DP013-DB2-ABEND                                 08570000
086100                  DP013-XCTL-DISPLAY-RESTART                      08580000
086200                              TO TRUE                             08590000
086300              PERFORM DP013-0000-PROCESS-ABEND                    08600000
086400     END-EVALUATE.                                                08610000
086500                                                                  08620000
086600*----------------------------------------------------------------*08630000
086700*    OPEN EDI CURSOR.                                             08640000
086800*----------------------------------------------------------------*08650000
086900 4200-OPEN-EDI-CURSOR.                                            08660000
087000                                                                  08670000
087100     EXEC SQL                                                     08680000
087200          OPEN EDI-CSR                                            08690000
087300     END-EXEC                                                     08700000
087400                                                                  08710000
087500     EVALUATE TRUE                                                08720000
087600         WHEN SQLCODE = ZERO                                      08730000
087700                 CONTINUE                                         08740000
087800                                                                  08750000
087900         WHEN SQLCODE = -904                                      08760000
088000         WHEN SQLCODE = -911                                      08770000
088100         WHEN SQLCODE = -913                                      08780000
088200              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       08790000
088300              SET PS-ERROR                                        08800000
088400                  DP020-NEXT-ACT-APPL-ERROR                       08810000
088500                  DP020-MSG-FATAL                                 08820000
088600                      TO TRUE                                     08830000
088700              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 08840000
088800              PERFORM 9000-CALL-CICS-ARCH-API                     08850000
088900                                                                  08860000
089000         WHEN SQLWARN0 NOT = SPACES                               08870000
089100         WHEN SQLCODE < ZERO                                      08880000
089200         WHEN SQLCODE > ZERO                                      08890000
089300             MOVE '4200-OPEN-EDI-CURSOR'                          08900000
089400                               TO DP013-PARAGRAPH                 08910000
089500             MOVE 'OPEN EDI CURSOR - '                            08920000
089600                               TO DP013-MESSAGE-TEXT (1)          08930000
089700             MOVE SQLCA        TO DP013-SQLCA                     08940000
089800             MOVE 'TTRDPRT '   TO DP013-DB2-TABLE-NAME (1)        08950000
089900*            MOVE 'TTRDTRN '   TO DP013-DB2-TABLE-NAME (2)        08960000
090000             MOVE 'TINTTRN '   TO DP013-DB2-TABLE-NAME (2)        08970000
090100             MOVE 'TFGTRST '   TO DP013-DB2-TABLE-NAME (3)        08980000
090200             MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (4)        08990000
090300             SET DP013-DB2-ABEND                                  09000000
090400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09010000
090500             PERFORM DP013-0000-PROCESS-ABEND                     09020000
090600     END-EVALUATE.                                                09030000
090700                                                                  09040000
090800*----------------------------------------------------------------*09050000
090900*    THIS PARAGRAPH FETCHES ALL ROWS FROM THE EDI-CURSOR AND      09060000
091000*    WRITES THEM OUT TO THE SCREEN.                               09070000
091100*----------------------------------------------------------------*09080000
091200 4210-READ-ITEMS-FROM-DB.                                         09090000
091300                                                                  09100000
091400     PERFORM                                                      09110000
091500         VARYING PV-READ-COUNT                                    09120000
091600         FROM 1 BY 1                                              09130000
091700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    09140000
091800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         09150000
091900                                                                  09160000
092000         PERFORM 4220-FETCH-EDI-CURSOR                            09170000
092100                                                                  09180000
092200         IF  ASC-ITEMS-LEFT-ON-DB                                 09190000
092300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                09200000
092400                 ADD +1            TO ASC-ITEM-SUB                09210000
092500             ELSE                                                 09220000
092600                 ADD +1            TO ASC-BLK-SUB                 09230000
092700                 MOVE +1           TO ASC-ITEM-SUB                09240000
092800                                                                  09250000
092900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         09260000
093000                     MOVE +1       TO ASC-BLK-SUB                 09270000
093100                     SET ASC-BLOCK-MODIFIED (1)                   09280000
093200                                   TO TRUE                        09290000
093300                     PERFORM 5100-WRITE-TEMP-STORAGE              09300000
093400                     MOVE ASC-BLOCK-ENTRIES                       09310000
093500                               (PC-MAX-BLOCKS-IN-ARRAY)           09320000
093600                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 09330000
093700                     ADD +1        TO ASC-BLK-SUB                 09340000
093800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   09350000
093900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      09360000
094000                                   TO TRUE                        09370000
094100                 END-IF                                           09380000
094200             END-IF                                               09390000
094300             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    09400000
094400             MOVE ASC-NUMBER-OF-ITEMS-READ                        09410000
094500                                   TO ASC-LIST-ITEM-NUMBER        09420000
094600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09430000
094700             PERFORM 4230-OUTPUT-DATE-TIME                        09440000
094800             MOVE FGTRST-VEND-ACK-IND                             09450000
094900               TO ASC-VEND-ACK-IND      (ASC-BLK-SUB ASC-ITEM-SUB)09460000
095000             MOVE INTTRN-PROD-TEST-IND                            09470000
095100               TO ASC-PROD-TEST-IND     (ASC-BLK-SUB ASC-ITEM-SUB)09480000
095200         END-IF                                                   09490000
095300     END-PERFORM.                                                 09500000
095400                                                                  09510000
095413** IF THE DESTINATION IS KNOWN, DO NOT SEND A BLANKET PO          09520008
095414** ELSE, THE DESTINATION IS NOT KNOWN, SEND A BLANKET PO          09530008
095415     IF PURCHS-DEST-KNOWN-IND = 'Y'                               09540006
095416        MOVE 'N' TO ASC-BLNKT-RLS-IND                             09550006
095417     ELSE                                                         09560006
095418         IF PURCHS-DEST-KNOWN-IND = 'N'                           09570007
095419            MOVE 'Y' TO ASC-BLNKT-RLS-IND                         09580007
095420         ELSE                                                     09590007
095421            MOVE ' ' TO ASC-BLNKT-RLS-IND                         09600007
095422         END-IF                                                   09610007
095423     END-IF.                                                      09620006
095430                                                                  09630006
095500     MOVE NETWRK-NETWK-NME TO ASC-NETWORK-NAME.                   09640000
095600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          09650000
095700         MOVE +1               TO ASC-BLK-SUB                     09660000
095800         PERFORM 5100-WRITE-TEMP-STORAGE                          09670000
095900         ADD +1                TO ASC-BLK-SUB                     09680000
096000         PERFORM 5100-WRITE-TEMP-STORAGE                          09690000
096100                                                                  09700000
096200         MOVE 1                TO ASC-BLK-SUB                     09710000
096300                                  PV-BLOCK-NUMBER                 09720000
096400         PERFORM 4410-READ-TEMP-STORAGE                           09730000
096500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             09740000
096600             MOVE 2            TO ASC-BLK-SUB                     09750000
096700                                  PV-BLOCK-NUMBER                 09760000
096800             PERFORM 4410-READ-TEMP-STORAGE                       09770000
096900         END-IF                                                   09780000
097000     END-IF.                                                      09790000
097100 EJECT                                                            09800000
097200                                                                  09810000
097300*----------------------------------------------------------------*09820000
097400*    FETCH EDI CURSOR.                                            09830000
097500*----------------------------------------------------------------*09840000
097600 4220-FETCH-EDI-CURSOR.                                           09850000
097700                                                                  09860000
097800     EXEC SQL                                                     09870000
097900         FETCH EDI-CSR                                            09880000
098000          INTO :INTTRN-PROD-TEST-IND,                             09890000
098100               :INTTRN-CRE-DTE,                                   09900000
098200               :INTTRN-CRE-TME,                                   09910000
098300               :INTTRN-MAILBOX-REC-DTE,                           09920000
098400               :INTTRN-MAILBOX-REC-TME,                           09930000
098500               :INTTRN-MAILBOX-PU-DTE,                            09940000
098600               :INTTRN-MAILBOX-PU-TME,                            09950000
098700               :INTTRN-TP-DKEY-TMST,                              09960000
098800               :FGTRST-VEND-ACK-IND,                              09970000
098900               :NETWRK-NETWK-ID,                                  09980000
099000               :NETWRK-NETWK-NME,                                 09990006
099010               :PURCHS-DEST-KNOWN-IND                             10000006
099100     END-EXEC.                                                    10010000
099200                                                                  10020000
099300     EVALUATE TRUE                                                10030000
099400         WHEN SQLCODE = ZERO                                      10040000
099500              CONTINUE                                            10050000
099600         WHEN SQLCODE = +100                                      10060000
099700              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 10070000
099800         WHEN SQLCODE = -904                                      10080000
099900         WHEN SQLCODE = -911                                      10090000
100000         WHEN SQLCODE = -913                                      10100000
100100              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       10110000
100200              SET PS-ERROR                                        10120000
100300                  DP020-NEXT-ACT-APPL-ERROR                       10130000
100400                  DP020-MSG-FATAL                                 10140000
100500                      TO TRUE                                     10150000
100600              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 10160000
100700              PERFORM 9000-CALL-CICS-ARCH-API                     10170000
100800                                                                  10180000
100900         WHEN SQLWARN0 NOT = SPACE                                10190000
101000         WHEN SQLCODE NOT = ZERO                                  10200000
101100              MOVE '4220-FETCH-EDI-CURSOR'                        10210000
101200                                   TO DP013-PARAGRAPH             10220000
101300              MOVE 'FETCH EDI CURSOR'                             10230000
101400                                   TO DP013-MESSAGE-TEXT (1)      10240000
101500              MOVE SQLCA           TO DP013-SQLCA                 10250000
101600              SET DP013-DB2-ABEND                                 10260000
101700                                   TO TRUE                        10270000
101800              PERFORM DP013-0000-PROCESS-ABEND                    10280000
101900     END-EVALUATE.                                                10290000
102000                                                                  10300000
102100*----------------------------------------------------------------*10310000
102200*    THIS PARAGRAPH FIRST SPACES OUT THE DATE AND TIME FIELDS     10320000
102300*    IF THEY EQUAL 9999-09-09 AND 09-09 RESPECTIVELY. THE DATE    10330000
102400*    FIELDS ARE THEN CONVERTED FROM THE DB2 FORMAT TO MM/DD/YY.   10340000
102500*    ADDITIONAL EDITS OF INTTRN-MAILBOX-REC-TME AND               10350000
102600*    INTTRN-MAILBOX-PU-TME ARE NEEDED BECAUSE SEARS (NETWK-ID = 2)10360000
102700*    USES THE EASTERN STANDARD TIME FOR THESE FIELDS AND THEY NEED10370000
102800*    TO BE CONVERTED TO CENTRAL STANDARD TIME. MOST OF THE TIME   10380000
102900*    AN HOUR WILL BE SUBTRACTED FROM THE TIME FIELD. BUT IF THE   10390000
103000*    TIME IS BETWEEN 12-12:59 AM (0-0:59 MILITARY TIME), 23 IS    10400000
103100*    MOVED TO THE HOUR FIELD (TIMES ARE DISPLAYED IN MILITARY     10410000
103200*    TIME) AND THE DATE IS ROLLED BACK ONE DAY. IF THE DAY        10420000
103300*    HAPPENS TO BE THE FIRST DAY OF THE MONTH, THE CALENDAR       10430000
103400*    ROUTINE IS USED TO ROLL BACK ONE DAY.                        10440000
103500*----------------------------------------------------------------*10450000
103600 4230-OUTPUT-DATE-TIME.                                           10460000
103700                                                                  10470000
103800     MOVE INTTRN-CRE-TME         TO PV-TIME.                      10480000
103900     MOVE ':'                    TO PV-COLON.                     10490000
104000     IF (INTTRN-CRE-DTE = '9999-09-09') AND                       10500000
104100        (PV-TIME = '09:09')                                       10510000
104200         MOVE SPACES                                              10520000
104300           TO ASC-CRE-DATE         (ASC-BLK-SUB ASC-ITEM-SUB)     10530000
104400              ASC-CRE-TIME         (ASC-BLK-SUB ASC-ITEM-SUB)     10540000
104500     ELSE                                                         10550000
104600         MOVE INTTRN-CRE-DTE         TO PV-DATE-10                10560000
104700         PERFORM 4240-DB2-DATE-REFORMAT                           10570000
104800         MOVE PV-DATE-8                                           10580000
104900           TO ASC-CRE-DATE         (ASC-BLK-SUB ASC-ITEM-SUB)     10590000
105000         MOVE PV-TIME                                             10600000
105100           TO ASC-CRE-TIME         (ASC-BLK-SUB ASC-ITEM-SUB)     10610000
105200     END-IF.                                                      10620000
105300                                                                  10630000
105400     MOVE INTTRN-MAILBOX-REC-TME TO PV-TIME.                      10640000
105500     MOVE ':'                    TO PV-COLON.                     10650000
105600     IF (INTTRN-MAILBOX-REC-DTE = '9999-09-09') AND               10660000
105700        (PV-TIME = '09:09')                                       10670000
105800         MOVE SPACES                                              10680000
105900           TO ASC-MAILBOX-REC-DATE (ASC-BLK-SUB ASC-ITEM-SUB)     10690000
106000              ASC-MAILBOX-REC-TIME (ASC-BLK-SUB ASC-ITEM-SUB)     10700000
106100     ELSE                                                         10710000
106200         IF NETWRK-NETWK-ID = '2'                                 10720000
106300             MOVE INTTRN-MAILBOX-REC-DTE TO PV-DATE-10            10730000
106400             IF PV-HOUR = ZEROES                                  10740000
106500                 MOVE 23 TO PV-HOUR                               10750000
106600                 IF PV-DAY-10 = 01                                10760000
106700                     MOVE INTTRN-MAILBOX-REC-DTE                  10770000
106800                       TO PV-PRE-CONV-DATE                        10780000
106900                     PERFORM 4250-DATE-CONVERSION-ROUTINE         10790000
107000                 ELSE                                             10800000
107100                     SUBTRACT 1 FROM PV-DAY-10                    10810000
107200                 END-IF                                           10820000
107300             ELSE                                                 10830000
107400                 SUBTRACT 1 FROM PV-HOUR                          10840000
107500             END-IF                                               10850000
107600         ELSE                                                     10860000
107700             MOVE INTTRN-MAILBOX-REC-DTE TO PV-DATE-10            10870000
107800         END-IF                                                   10880000
107900                                                                  10890000
108000         PERFORM 4240-DB2-DATE-REFORMAT                           10900000
108100         MOVE PV-DATE-8                                           10910000
108200           TO ASC-MAILBOX-REC-DATE (ASC-BLK-SUB ASC-ITEM-SUB)     10920000
108300         MOVE PV-TIME                                             10930000
108400           TO ASC-MAILBOX-REC-TIME (ASC-BLK-SUB ASC-ITEM-SUB)     10940000
108500     END-IF.                                                      10950000
108600                                                                  10960000
108700     MOVE INTTRN-MAILBOX-PU-TME  TO PV-TIME.                      10970000
108800     MOVE ':'                    TO PV-COLON.                     10980000
108900     IF (INTTRN-MAILBOX-PU-DTE = '9999-09-09') AND                10990000
109000        (PV-TIME = '09:09')                                       11000000
109100         MOVE SPACES                                              11010000
109200           TO ASC-MAILBOX-PU-DATE (ASC-BLK-SUB ASC-ITEM-SUB)      11020000
109300              ASC-MAILBOX-PU-TIME (ASC-BLK-SUB ASC-ITEM-SUB)      11030000
109400     ELSE                                                         11040000
109500         IF NETWRK-NETWK-ID = '2'                                 11050000
109600             MOVE INTTRN-MAILBOX-PU-DTE TO PV-DATE-10             11060000
109700             IF PV-HOUR = ZEROES                                  11070000
109800                 MOVE 23 TO PV-HOUR                               11080000
109900                 IF PV-DAY-10 = 01                                11090000
110000                     MOVE INTTRN-MAILBOX-PU-DTE                   11100000
110100                       TO PV-PRE-CONV-DATE                        11110000
110200                     PERFORM 4250-DATE-CONVERSION-ROUTINE         11120000
110300                 ELSE                                             11130000
110400                     SUBTRACT 1 FROM PV-DAY-10                    11140000
110500                 END-IF                                           11150000
110600              ELSE                                                11160000
110700                 SUBTRACT 1 FROM PV-HOUR                          11170000
110800              END-IF                                              11180000
110900         ELSE                                                     11190000
111000             MOVE INTTRN-MAILBOX-PU-DTE TO PV-DATE-10             11200000
111100         END-IF                                                   11210000
111200         PERFORM 4240-DB2-DATE-REFORMAT                           11220000
111300         MOVE PV-DATE-8                                           11230000
111400           TO ASC-MAILBOX-PU-DATE (ASC-BLK-SUB ASC-ITEM-SUB)      11240000
111500         MOVE PV-TIME                                             11250000
111600           TO ASC-MAILBOX-PU-TIME (ASC-BLK-SUB ASC-ITEM-SUB)      11260000
111700     END-IF.                                                      11270000
111800                                                                  11280000
111900*----------------------------------------------------------------*11290000
112000*    CONVERTS CCYY-MM-DD DATE FORMAT TO MM/DD/YY.                 11300000
112100*----------------------------------------------------------------*11310000
112200 4240-DB2-DATE-REFORMAT.                                          11320000
112300                                                                  11330000
112400     MOVE PV-MONTH-10 TO PV-MONTH-8.                              11340000
112500     MOVE PV-DAY-10   TO PV-DAY-8.                                11350000
112600     MOVE PV-YEAR-10  TO PV-YEAR-8.                               11360000
112700                                                                  11370000
112800*----------------------------------------------------------------*11380000
112900*    THE CALENDAR ROUTINE IS USED TO ROLL THE DATE BACK ONE DAY.  11390000
113000*----------------------------------------------------------------*11400000
113100 4250-DATE-CONVERSION-ROUTINE.                                    11410000
113200                                                                  11420000
113300     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     11430000
113400     SET DPG51-DECREMENT-DATE        TO TRUE.                     11440000
113500     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     11450000
113600     MOVE 1                          TO DPG51-INCR-DECR-DAYS-9.   11460000
113700     MOVE PV-PRE-CONV-DATE           TO DPG52-LK-DATE-INPUT.      11470000
113800                                                                  11480000
113910     CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      11490011
114000               DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                11500011
114100                                                                  11510000
114200     IF  (DPG54-NO-ERROR                                          11520000
114300      OR  DPG54-WARNING-ERROR)                                    11530000
114400      AND DPG54-DATE-VALID                                        11540000
114500          MOVE DPG55-DB2-ISO-DATE-FMT                             11550000
114600            TO PV-DATE-10.                                        11560000
114700                                                                  11570000
114800*----------------------------------------------------------------*11580000
114900*    CLOSE EDI CURSOR.                                            11590000
115000*----------------------------------------------------------------*11600000
115100 4300-CLOSE-EDI-CURSOR.                                           11610000
115200                                                                  11620000
115300     EXEC SQL                                                     11630000
115400         CLOSE EDI-CSR                                            11640000
115500     END-EXEC.                                                    11650000
115600                                                                  11660000
115700     EVALUATE TRUE                                                11670000
115800         WHEN SQLCODE = ZERO                                      11680000
115900             CONTINUE                                             11690000
116000         WHEN SQLCODE = -904                                      11700000
116100         WHEN SQLCODE = -911                                      11710000
116200         WHEN SQLCODE = -913                                      11720000
116300              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       11730000
116400              SET PS-ERROR                                        11740000
116500                  DP020-NEXT-ACT-APPL-ERROR                       11750000
116600                  DP020-MSG-FATAL                                 11760000
116700                      TO TRUE                                     11770000
116800              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 11780000
116900              PERFORM 9000-CALL-CICS-ARCH-API                     11790000
117000                                                                  11800000
117100         WHEN SQLWARN0 NOT = SPACES                               11810000
117200         WHEN SQLCODE < ZERO                                      11820000
117300         WHEN SQLCODE > ZERO                                      11830000
117400             MOVE '4300-CLOSE-EDI-CURSOR'                         11840000
117500                                   TO DP013-PARAGRAPH             11850000
117600             MOVE 'CLOSE EDI CURSOR '                             11860000
117700                                   TO DP013-MESSAGE-TEXT (1)      11870000
117800             MOVE SQLCA            TO DP013-SQLCA                 11880000
117900             MOVE 'TTRDPRT '   TO DP013-DB2-TABLE-NAME (1)        11890000
118000*            MOVE 'TTRDTRN '   TO DP013-DB2-TABLE-NAME (2)        11900000
118100             MOVE 'TINTTRN '   TO DP013-DB2-TABLE-NAME (2)        11910000
118200             MOVE 'TFGTRST '   TO DP013-DB2-TABLE-NAME (3)        11920000
118300             MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (4)        11930000
118400             SET DP013-DB2-ABEND                                  11940000
118500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               11950000
118600             PERFORM DP013-0000-PROCESS-ABEND                     11960000
118700     END-EVALUATE.                                                11970000
118800                                                                  11980000
118900*----------------------------------------------------------------*11990000
119000*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *12000000
119100*----------------------------------------------------------------*12010000
119200                                                                  12020000
119300 4400-MOVE-COMMAREA-TO-SCREEN.                                    12030000
119400                                                                  12040000
119500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             12050000
119600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          12060000
119700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          12070000
119800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             12080000
119900                 GIVING PV-BLOCK-NUMBER                           12090000
120000                 REMAINDER PV-REMAINDER                           12100000
120100             IF  PV-REMAINDER > ZERO                              12110000
120200                 ADD +1 TO PV-BLOCK-NUMBER                        12120000
120300             END-IF                                               12130000
120400             MOVE +1    TO ASC-BLK-SUB                            12140000
120500             PERFORM 4410-READ-TEMP-STORAGE                       12150000
120600             ADD +1     TO ASC-BLK-SUB                            12160000
120700                           PV-BLOCK-NUMBER                        12170000
120800             PERFORM 4410-READ-TEMP-STORAGE                       12180000
120900     END-IF.                                                      12190000
121000     MOVE +1                       TO ASC-BLK-SUB.                12200000
121100     COMPUTE ASC-ITEM-SUB =                                       12210000
121200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              12220000
121300         + PC-ITEMS-PER-PANEL).                                   12230000
121400                                                                  12240000
121500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12250000
121600         ADD +1   TO ASC-BLK-SUB                                  12260000
121700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12270000
121800     END-IF.                                                      12280000
121900                                                                  12290000
122000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           12300000
122100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                12310000
122200     PERFORM 4415-FORMAT-HEADING-LIST-LINES.                      12320000
122300     PERFORM 4420-FORMAT-LIST-LINES                               12330000
122400         VARYING PS-SUB                                           12340000
122500         FROM PC-ITEMS-PER-PANEL BY -1                            12350000
122600         UNTIL PS-SUB < +1.                                       12360000
122700                                                                  12370000
122800     COMPUTE ASC-ITEMS-DISPLAYED =                                12380000
122900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          12390000
123000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    12400000
123100                                      ASTRTITO.                   12410000
123200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    12420000
123300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    12430000
123400                                                                  12440000
123500     IF  DP020-MSG-NUMBER-X = SPACE                               12450000
123600         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  12460000
123700*            --- MORE ITEMS TO DISPLAY ----                       12470000
123800             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            12480000
123900             SET DP020-MSG-INFORMATIONAL TO TRUE                  12490000
124000         END-IF                                                   12500000
124100     END-IF.                                                      12510000
124200                                                                  12520000
124300*----------------------------------------------------------------*12530000
124400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *12540000
124500*----------------------------------------------------------------*12550000
124600                                                                  12560000
124700 4410-READ-TEMP-STORAGE.                                          12570000
124800                                                                  12580000
124900     EXEC CICS                                                    12590000
125000         READQ TS                                                 12600000
125100             QUEUE (ASC-DTL-QUEUE-NAME)                           12610000
125200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               12620000
125300             ITEM  (PV-BLOCK-NUMBER)                              12630000
125400             RESP  (PV-CICS-RESP)                                 12640000
125500     END-EXEC.                                                    12650000
125600                                                                  12660000
125700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       12670000
125800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     12680000
125900         CONTINUE                                                 12690000
126000     ELSE                                                         12700000
126100         SET DP013-CICS-ABEND TO  TRUE                            12710000
126200         SET DP013-NO-ROLLBACK TO  TRUE                           12720000
126300         MOVE '4410-READ-TEMP-STORAGE'                            12730000
126400                               TO  DP013-PARAGRAPH                12740000
126500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      12750000
126600                               TO  DP013-MESSAGE-TEXT(1)          12760000
126700         PERFORM DP013-0000-PROCESS-ABEND                         12770000
126800     END-IF.                                                      12780000
126900                                                                  12790000
127000*    SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             12800000
127100                                                                  12810000
127200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         12820000
127300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               12830000
127400     END-IF.                                                      12840000
127500 EJECT                                                            12850000
127600                                                                  12860000
127700*----------------------------------------------------------------*12870000
127800*    WRITES HEADING INFORMATION (NON-SCROLLABLE) TO THE SCREEN.  *12880000
127900*----------------------------------------------------------------*12890000
128000                                                                  12900000
128100 4415-FORMAT-HEADING-LIST-LINES.                                  12910000
128200                                                                  12920000
128310     MOVE ASC-ENT-NAME-DESC     TO MR-ENT-NAME-DESC.              12930009
128400     MOVE ASC-PO-NUMBER         TO MR-PO-NBR.                     12940000
128500     MOVE ASC-NETWORK-NAME      TO MR-NTWK-NAME.                  12950000
128600     MOVE ASC-PACK-BY-STORE-IND TO MR-PACK-STOR.                  12960000
128800     MOVE ASC-BLNKT-RLS-IND     TO MR-BLNKT-RLS-IND.              12970001
129000                                                                  12980000
129100*----------------------------------------------------------------*12990000
129200*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *13000000
129300*----------------------------------------------------------------*13010000
129400                                                                  13020000
129500 4420-FORMAT-LIST-LINES.                                          13030000
129600                                                                  13040000
129700     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      13050000
129800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                13060000
129900         MOVE SPACE              TO MR-CRE-DTE       (PS-SUB)     13070000
130000                                    MR-CRE-TME       (PS-SUB)     13080000
130100                                    MR-MLBX-REC-DTE  (PS-SUB)     13090000
130200                                    MR-MLBX-REC-TME  (PS-SUB)     13100000
130300                                    MR-MLBX-PU-DTE   (PS-SUB)     13110000
130400                                    MR-MLBX-PU-TME   (PS-SUB)     13120000
130500                                    MR-VNDR-ACK-IND  (PS-SUB)     13130000
130600                                    MR-PROD-TEST-IND (PS-SUB)     13140000
130700     ELSE                                                         13150000
130800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           13160000
130900             MOVE ASC-CRE-DATE          (ASC-BLK-SUB ASC-ITEM-SUB)13170000
131000               TO MR-CRE-DTE            (PS-SUB)                  13180000
131100             MOVE ASC-CRE-TIME          (ASC-BLK-SUB ASC-ITEM-SUB)13190000
131200               TO MR-CRE-TME            (PS-SUB)                  13200000
131300             MOVE ASC-MAILBOX-REC-DATE  (ASC-BLK-SUB ASC-ITEM-SUB)13210000
131400               TO MR-MLBX-REC-DTE       (PS-SUB)                  13220000
131500             MOVE ASC-MAILBOX-REC-TIME  (ASC-BLK-SUB ASC-ITEM-SUB)13230000
131600               TO MR-MLBX-REC-TME       (PS-SUB)                  13240000
131700             MOVE ASC-MAILBOX-PU-DATE   (ASC-BLK-SUB ASC-ITEM-SUB)13250000
131800               TO MR-MLBX-PU-DTE        (PS-SUB)                  13260000
131900             MOVE ASC-MAILBOX-PU-TIME   (ASC-BLK-SUB ASC-ITEM-SUB)13270000
132000               TO MR-MLBX-PU-TME        (PS-SUB)                  13280000
132100             MOVE ASC-VEND-ACK-IND      (ASC-BLK-SUB ASC-ITEM-SUB)13290000
132200               TO MR-VNDR-ACK-IND       (PS-SUB)                  13300000
132300             MOVE ASC-PROD-TEST-IND     (ASC-BLK-SUB ASC-ITEM-SUB)13310000
132400               TO MR-PROD-TEST-IND      (PS-SUB)                  13320000
132500         END-IF                                                   13330000
132600     END-IF.                                                      13340000
132700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13350000
132800     IF  ASC-ITEM-SUB < + 1                                       13360000
132900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  13370000
133000         MOVE +1                 TO ASC-BLK-SUB                   13380000
133100     END-IF.                                                      13390000
133200                                                                  13400000
140200/                                                                 13410007
140300*----------------------------------------------------------------*13420000
140400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *13430000
140500*----------------------------------------------------------------*13440000
140600                                                                  13450000
140700 5100-WRITE-TEMP-STORAGE.                                         13460000
140800                                                                  13470000
140900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     13480000
141000                               TO  PV-LIST-ITEM-NUMBER.           13490000
141100     COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                           13500000
141200         ASC-HIGHEST-BLOCK-WRITTEN + 1.                           13510000
141300                                                                  13520000
141400     EXEC CICS                                                    13530000
141500         WRITEQ TS                                                13540000
141600             QUEUE (ASC-DTL-QUEUE-NAME)                           13550000
141700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               13560000
141800             ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                     13570000
141900             RESP  (PV-CICS-RESP)                                 13580000
142000     END-EXEC.                                                    13590000
142100                                                                  13600000
142200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      13610000
142300         SET DP013-CICS-ABEND                                     13620000
142400                       TO  TRUE                                   13630000
142500         SET DP013-NO-ROLLBACK                                    13640000
142600                       TO  TRUE                                   13650000
142700         MOVE '5100-WRITE-TEMP-STORAGE'                           13660000
142800                       TO  DP013-PARAGRAPH                        13670000
142900         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'       13680000
143000                       TO  DP013-MESSAGE-TEXT(1)                  13690000
143100         PERFORM DP013-0000-PROCESS-ABEND                         13700000
143200     END-IF.                                                      13710000
143300     ADD +1            TO  ASC-HIGHEST-BLOCK-WRITTEN.             13720000
143400                                                                  13730000
143500 EJECT                                                            13740000
143600                                                                  13750000
143700*----------------------------------------------------------------*13760000
143800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *13770000
143900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *13780000
144000*----------------------------------------------------------------*13790000
144100                                                                  13800000
144200 9000-CALL-CICS-ARCH-API.                                         13810000
144300                                                                  13820000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      13830020
144500                                    DFHCOMMAREA                   13840020
144600                                    DP030-CICS-API-FIELDS         13850020
144700                                    DP020-STANDARD-COMMAREA       13860020
144800                                    PO066AI.                      13870020
144900                                                                  13880000
145000     IF  DP030-RC-CALL-SUCCESSFUL                                 13890000
145100         CONTINUE                                                 13900000
145200     ELSE                                                         13910000
145300         SET DP013-NO-ROLLBACK TO TRUE                            13920000
145400         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   13930000
145500         SET DP013-CICS-ABEND TO TRUE                             13940000
CICS           MOVE '9000-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        13950020
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O13960020
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      13970020
145900         MOVE DP030-RETURN-CODE                                   13980000
146000                               TO DP013-MESSAGE-TEXT (3)          13990000
146100         PERFORM DP013-0000-PROCESS-ABEND                         14000000
146200     END-IF.                                                      14010000
146300                                                                  14020000
146400*----------------------------------------------------------------*14030000
146500*    ABEND PROCESSOR MODULE                                      *14040000
146600*----------------------------------------------------------------*14050000
146700                                                                  14060000
146800     COPY DPPD013.                                                14070000
