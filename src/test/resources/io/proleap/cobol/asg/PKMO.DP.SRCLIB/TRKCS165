000100*-----------------------*                                         05/02/95
000200 IDENTIFICATION DIVISION.                                         DPKCS036
000300*-----------------------*                                            LV002
000400 PROGRAM-ID.    TRKCS165.                                         DPKCS036
000500 AUTHOR.        NIRMAL KUMAR.                                     DPKCS036
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          DPKCS036
000700 DATE-WRITTEN.  04/98.                                            DPKCS036
000800 DATE-COMPILED.                                                   DPKCS036
000900                                                                  DPKCS036
001000*---------------------------------------------------------------* DPKCS036
001100*    Y165 - SAILING LIST.                                       * DPKCS036
001200*                                                               * DPKCS036
001300*    THIS PROGRAM GENERATES A LIST OF ALL THE VESSELS IN WHICH  * DPKCS036
001400*    THE PURCHASE ORDER IS ON. THE APPROPRIATE PROGRAM IS       * DPKCS036
001500*    INVOKED WHEN THE OPERATOR SELECTS AN ITEM AND PRESSES A    * DPKCS036
001600*    FUNCTION KEY.                                              * DPKCS036
001700*                                                               * DPKCS036
001800*---------------------------------------------------------------* DPKCS036
001810*****************************************************************         
001820* DATE  05/16/2011                                                        
001830*  CHANGE MADE: THE NEW SYSTEM OF RECORD FOR OUTER PACK QTY WILL          
001840*  BE RMS AND PUBLISHED TO TPURITM.  CHANGED OUTR-PCK-CSR                 
001850*  TO SELECT  OUTR_PK_QTY FROM TPURITM AND REMOVED JOIN TO TUPC           
001860*  AND TSKXREF.                                                           
001870*  MADE BY: GERMAN BANDA                                                  
001880*****************************************************************         
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001900                                                                  DPKCS036
002000 ENVIRONMENT DIVISION.                                            DPKCS036
002100                                                                  DPKCS036
002200 DATA DIVISION.                                                   DPKCS036
002300                                                                  DPKCS036
002400 WORKING-STORAGE SECTION.                                         DPKCS036
002500                                                                  DPKCS036
002600 01  DK-DB2-KEYS.                                                 DPKCS036
002700     15  DK-PO-NBR                      PIC S9(09) COMP.          DPKCS036
002800                                                                  DPKCS036
002900 01  PC-PROGRAM-CONSTANTS.                                        DPKCS036
003000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         DPKCS036
003100                                                    'TR165A  '.   DPKCS036
003200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         DPKCS036
003300                                                    'TRKM165 '.   DPKCS036
003400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         DPKCS036
003500                                                    'TRKCS165'.   DPKCS036
003600     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      DPKCS036
003700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      DPKCS036
003800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +08     DPKCS036
003900                                                    COMP SYNC.    DPKCS036
004000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      DPKCS036
004100                                                    COMP SYNC.    DPKCS036
004200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         DPKCS036
004300                                                    +1000000      DPKCS036
004400                                                    COMP-3.       DPKCS036
004500     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      DPKCS036
004600                                                    COMP SYNC.    DPKCS036
004700     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       DPKCS036
004800                                                    COMP-3.       DPKCS036
004900     05  PC-INIT-DATE                   PIC  X(10)  VALUE         DPKCS036
005000                                                    '0001-01-01'. DPKCS036
005100     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  DPKCS036
005200                                                                  DPKCS036
005300     05  PC-TSYMSG-NUMBERS.                                       DPKCS036
005400         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  DPKCS036
005500         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  DPKCS036
005600         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  DPKCS036
005700         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  DPKCS036
005800         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  DPKCS036
005900         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  DPKCS036
006000         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  DPKCS036
006100         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  DPKCS036
006200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  DPKCS036
006300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  DPKCS036
006400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  DPKCS036
006500         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  DPKCS036
006600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  DPKCS036
006700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  DPKCS036
006800                                                                  DPKCS036
006900 01  PS-PROGRAM-SWITCHES.                                         DPKCS036
007000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    DPKCS036
007100         88  PS-NO-ERROR                            VALUE 'Y'.    DPKCS036
007200         88  PS-ERROR                               VALUE 'N'.    DPKCS036
007300     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    DPKCS036
007400         88  PS-COMMAREA-VALID                      VALUE 'Y'.    DPKCS036
007500         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    DPKCS036
007600                                                                  DPKCS036
007700 01  PV-PROGRAM-VARIABLES.                                        DPKCS036
007800     05  PV-DEPT-NBR                    PIC  X(04).                       
007900     05  PV-DEPT-NBR-N REDEFINES                                          
007901         PV-DEPT-NBR                    PIC S9(04).                       
007902     05  PV-SUB                         PIC S9(04)  VALUE +0      DPKCS036
007903                                                    COMP SYNC.    DPKCS036
008000     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      DPKCS036
008100                                                    COMP SYNC.    DPKCS036
008200     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      DPKCS036
008300                                                    COMP-3.       DPKCS036
008400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      DPKCS036
008500                                                    COMP-3.       DPKCS036
008600     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      DPKCS036
008700                                                    COMP-3.       DPKCS036
008800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      DPKCS036
008900                                                    COMP-3.       DPKCS036
009000     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      DPKCS036
009100                                                    COMP-3.       DPKCS036
009200     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      DPKCS036
009300                                                    COMP-3.       DPKCS036
009400     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      DPKCS036
009500                                                    COMP-3.       DPKCS036
009600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      DPKCS036
009700                                                    COMP SYNC.    DPKCS036
009800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      DPKCS036
009900                                                    COMP SYNC.    DPKCS036
010000     05  PV-ITEM                        PIC S9(04)  VALUE +0      DPKCS036
010100                                                    COMP SYNC.    DPKCS036
010200     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      DPKCS036
010300                                                    COMP SYNC.    DPKCS036
010400     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      DPKCS036
010500                                                    COMP SYNC.    DPKCS036
010600     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      DPKCS036
010700                                                    COMP SYNC.    DPKCS036
010800     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      DPKCS036
010900                                                    COMP SYNC.    DPKCS036
011000     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      DPKCS036
011100                                                    COMP SYNC.    DPKCS036
011200     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      DPKCS036
011300                                                    COMP SYNC.    DPKCS036
011400     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      DPKCS036
011500                                                    COMP SYNC.    DPKCS036
011600     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      DPKCS036
011700                                                    COMP SYNC.    DPKCS036
011800     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      DPKCS036
011900                                                    COMP SYNC.    DPKCS036
012000     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      DPKCS036
012100                                                    COMP SYNC.    DPKCS036
012200     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      DPKCS036
012300                                                    COMP SYNC.    DPKCS036
012400     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      DPKCS036
012500                                                    COMP SYNC.    DPKCS036
012600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      DPKCS036
012700                                                    COMP SYNC.    DPKCS036
012800     05  PV-ITEM-CART-CNT               PIC S9(04)  VALUE +0      DPKCS036
012900                                                    COMP.         DPKCS036
013000     05  PV-PO-CART-CNT                 PIC S9(05)  VALUE +0      DPKCS036
013100                                                    COMP.         DPKCS036
013200     05  PV-AD-DTE-IND                  PIC S9(04)  VALUE +0      DPKCS036
013300                                                    COMP.         DPKCS036
013400     05  PV-VSL-NAME                    PIC  X(25)  VALUE SPACE.  DPKCS036
013500     05  PV-CART-CNT                    PIC S9(09)  COMP.         DPKCS036
013600     05  PV-UNIT-CNT                    PIC S9(09)  COMP.         DPKCS036
013700     05  PV-TRIP-ID                     PIC  X(10)  VALUE SPACE.  DPKCS036
013800     05  PV-ATD                         PIC  X(10)  VALUE SPACE.  DPKCS036
013900     05  PV-ETA                         PIC  X(10)  VALUE SPACE.  DPKCS036
013910     05  PV-FOB                         PIC  X(10)  VALUE SPACE.  DPKCS036
013920     05  PV-ATA                         PIC  X(10)  VALUE SPACE.  DPKCS036
014000     05  PV-DATE-BREAK.                                           DPKCS036
014100         10 FILLER                      PIC  X(02).               DPKCS036
014200         10 PV-DB-YY                    PIC  X(02).               DPKCS036
014300         10 FILLER                      PIC  X(01).               DPKCS036
014400         10 PV-DB-MM                    PIC  X(02).               DPKCS036
014500         10 FILLER                      PIC  X(01).               DPKCS036
014600         10 PV-DB-DD                    PIC  X(02).               DPKCS036
014700                                                                  DPKCS036
014800     05 PV-DATE-DISPLAY.                                          DPKCS036
014900         10 PV-DD-MM                    PIC  X(02).               DPKCS036
015000         10 FILLER                      PIC  X(01)  VALUE '/'.    DPKCS036
015100         10 PV-DD-DD                    PIC  X(02).               DPKCS036
015200         10 FILLER                      PIC  X(01)  VALUE '/'.    DPKCS036
015300         10 PV-DD-YY                    PIC  X(02).               DPKCS036
015400                                                                  DPKCS036
015500*----------------------------------------------------------------*DPKCS036
015600*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *DPKCS036
015700*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *DPKCS036
015800*   APPLICATION-SPECIFIC COMMAREA.                               *DPKCS036
015900*----------------------------------------------------------------*DPKCS036
016000 01  LQW-LIST-QUEUE-WORK-AREA.                                    DPKCS036
016100     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  DPKCS036
016200     05  LQW-ITEM-ENTRIES               OCCURS 8 TIMES            DPKCS036
016300                                        INDEXED BY LQW-IDX.       DPKCS036
016400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       DPKCS036
016500         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               DPKCS036
016600         10  LQW-SELECTED-SW            PIC  X(01).               DPKCS036
016700             88  LQW-SELECT                         VALUE 'S'.    DPKCS036
016800             88  LQW-DESELECT                       VALUE ' '.    DPKCS036
016900         10  LQW-ACTION                 PIC  X(03).               DPKCS036
017000         10  LQW-VSL-NAME               PIC  X(25).               DPKCS036
017100         10  LQW-VOY-NO                 PIC  X(10).                       
017200         10  LQW-TRIP-CDE               PIC  X(01).               DPKCS036
017300         10  LQW-FOB-DTE                PIC  X(05).                       
017400         10  LQW-ATD                    PIC  X(05).               DPKCS036
017500         10  LQW-ETA                    PIC  X(05).               DPKCS036
017600         10  LQW-ATA                    PIC  X(05).               DPKCS036
017700         10  LQW-FOB                    PIC  X(03).               DPKCS036
017800         10  LQW-POE                    PIC  X(03).               DPKCS036
017900         10  LQW-UNTS                   PIC  9(09).               DPKCS036
018000         10  LQW-CNTS                   PIC  9(06).               DPKCS036
018100                                                                  DPKCS036
018200     EJECT                                                        DPKCS036
018300*---------------------------------------------------------------* DPKCS036
018400*  RECORD LAYOUT FOR THE PO SELECTION TEMP STORAGE QUEUE.       * DPKCS036
018500*---------------------------------------------------------------* DPKCS036
018600                                                                  DPKCS036
018700     COPY TRWS106.                                                DPKCS036
018800                                                                  DPKCS036
018900     EJECT                                                        DPKCS036
019000*---------------------------------------------------------------* DPKCS036
019100*    MAP LAYOUT                                                 * DPKCS036
019200*---------------------------------------------------------------* DPKCS036
019300                                                                  DPKCS036
019400     COPY TRKM165.                                                DPKCS036
019500                                                                  DPKCS036
019600 01  MR-OCCURS-LAYOUT                   REDEFINES  TR165AO.       DPKCS036
019700     05  FILLER                         PIC X(260).               DPKCS036
019800                                                                  DPKCS036
019900     05  MR-SCROLL-AREA                 OCCURS 8 TIMES.           DPKCS036
020000         10  MR-SELECTL                 PIC S9(04) COMP.          DPKCS036
020100         10  MR-SELECTA                 PIC  X(01).               DPKCS036
020200         10  MR-SELECTC                 PIC  X(01).               DPKCS036
020300         10  MR-SELECTH                 PIC  X(01).               DPKCS036
020400         10  MR-SELECTI                 PIC  X(01).               DPKCS036
020500                                                                  DPKCS036
020600         10  MR-ACTIONL                 PIC S9(04) COMP.          DPKCS036
020700         10  MR-ACTIONA                 PIC  X(01).               DPKCS036
020800         10  MR-ACTIONC                 PIC  X(01).               DPKCS036
020900         10  MR-ACTIONH                 PIC  X(01).               DPKCS036
021000         10  MR-ACTION                  PIC  X(03).               DPKCS036
021100                                                                  DPKCS036
021200         10  MR-VSL-NAMEL               PIC S9(04) COMP.          DPKCS036
021300         10  MR-VSL-NAMEA               PIC  X(01).               DPKCS036
021400         10  MR-VSL-NAMEC               PIC  X(01).               DPKCS036
021500         10  MR-VSL-NAMEH               PIC  X(01).               DPKCS036
021600         10  MR-VSL-NAME                PIC  X(20).               DPKCS036
021700                                                                  DPKCS036
021800         10  MR-TRIP-CDEL               PIC S9(04) COMP.          DPKCS036
021900         10  MR-TRIP-CDEA               PIC  X(01).               DPKCS036
022000         10  MR-TRIP-CDEC               PIC  X(01).               DPKCS036
022100         10  MR-TRIP-CDEH               PIC  X(01).               DPKCS036
022200         10  MR-TRIP-CDE                PIC  X(01).               DPKCS036
022300                                                                  DPKCS036
022400         10  MR-FOB-DTL                 PIC S9(04) COMP.          DPKCS036
022500         10  MR-FOB-DTA                 PIC  X(01).               DPKCS036
022600         10  MR-FOB-DTC                 PIC  X(01).               DPKCS036
022700         10  MR-FOB-DTH                 PIC  X(01).               DPKCS036
022800         10  MR-FOB-DT                  PIC  X(05).               DPKCS036
022900                                                                  DPKCS036
023000         10  MR-ATDL                    PIC S9(04) COMP.          DPKCS036
023100         10  MR-ATDA                    PIC  X(01).               DPKCS036
023200         10  MR-ATDC                    PIC  X(01).               DPKCS036
023300         10  MR-ATDH                    PIC  X(01).               DPKCS036
023400         10  MR-ATD                     PIC  X(05).               DPKCS036
023500                                                                  DPKCS036
023600         10  MR-ETAL                    PIC S9(04) COMP.          DPKCS036
023700         10  MR-ETAA                    PIC  X(01).               DPKCS036
023800         10  MR-ETAC                    PIC  X(01).               DPKCS036
023900         10  MR-ETAH                    PIC  X(01).               DPKCS036
024000         10  MR-ETA                     PIC  X(05).               DPKCS036
024100                                                                  DPKCS036
024200         10  MR-ATAL                    PIC S9(04) COMP.          DPKCS036
024300         10  MR-ATAA                    PIC  X(01).               DPKCS036
024400         10  MR-ATAC                    PIC  X(01).               DPKCS036
024500         10  MR-ATAH                    PIC  X(01).               DPKCS036
024600         10  MR-ATA                     PIC  X(05).               DPKCS036
024700                                                                  DPKCS036
024800         10  MR-FOBL                    PIC S9(04) COMP.          DPKCS036
024900         10  MR-FOBA                    PIC  X(01).               DPKCS036
025000         10  MR-FOBC                    PIC  X(01).               DPKCS036
025100         10  MR-FOBH                    PIC  X(01).               DPKCS036
025200         10  MR-FOB                     PIC  X(03).               DPKCS036
025300                                                                  DPKCS036
025400         10  MR-POEL                    PIC S9(04) COMP.          DPKCS036
025500         10  MR-POEA                    PIC  X(01).               DPKCS036
025600         10  MR-POEC                    PIC  X(01).               DPKCS036
025700         10  MR-POEH                    PIC  X(01).               DPKCS036
025800         10  MR-POE                     PIC  X(03).               DPKCS036
025900                                                                  DPKCS036
026000         10  MR-UNTL                    PIC S9(04) COMP.          DPKCS036
026100         10  MR-UNTA                    PIC  X(01).               DPKCS036
026200         10  MR-UNTC                    PIC  X(01).               DPKCS036
026300         10  MR-UNTH                    PIC  X(01).               DPKCS036
026400         10  MR-UNT                     PIC  Z(08)9.              DPKCS036
026410         10  MR-UNT-X REDEFINES MR-UNT  PIC  X(09).                       
026500                                                                  DPKCS036
026600         10  MR-CNTL                    PIC S9(04) COMP.          DPKCS036
026700         10  MR-CNTA                    PIC  X(01).               DPKCS036
026800         10  MR-CNTC                    PIC  X(01).               DPKCS036
026900         10  MR-CNTH                    PIC  X(01).               DPKCS036
027000         10  MR-CNT                     PIC  Z(05)9.              DPKCS036
027010         10  MR-CNT-X REDEFINES MR-CNT  PIC  X(06).                       
027100                                                                  DPKCS036
027200     05  FILLER                         PIC  X(12).               DPKCS036
027300                                                                  DPKCS036
027400 EJECT                                                            DPKCS036
027500*---------------------------------------------------------------* DPKCS036
027600*    ATTRIBUTE SETTINGS COPYBOOK.                               * DPKCS036
027700*---------------------------------------------------------------* DPKCS036
027800                                                                  DPKCS036
027900     COPY DPWS015.                                                DPKCS036
028000                                                                  DPKCS036
028100*---------------------------------------------------------------* DPKCS036
028200*    FUNCTION KEYS COPYBOOK.                                    * DPKCS036
028300*---------------------------------------------------------------* DPKCS036
028400                                                                  DPKCS036
028500     COPY DPWS016.                                                DPKCS036
028600                                                                  DPKCS036
028700*---------------------------------------------------------------* DPKCS036
028800*    NUMERIC EDIT LAYOUT.                                       * DPKCS036
028900*---------------------------------------------------------------* DPKCS036
029000                                                                  DPKCS036
029100     COPY DPWS010I.                                               DPKCS036
029200                                                                  DPKCS036
029300*---------------------------------------------------------------* DPKCS036
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * DPKCS036
029500*---------------------------------------------------------------* DPKCS036
029600                                                                  DPKCS036
029700     COPY DPWS030.                                                DPKCS036
CICS       COPY DPWS930.                                                DPKCS036
029900 EJECT                                                            DPKCS036
030000*---------------------------------------------------------------* DPKCS036
030100*    STANDARD COMMAREA.                                         * DPKCS036
030200*---------------------------------------------------------------* DPKCS036
030300                                                                  DPKCS036
030400     COPY DPWS020.                                                DPKCS036
030500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                DPKCS036
030600                                                                  DPKCS036
030700*---------------------------------------------------------------* DPKCS036
030800* INTER-APPLICATION COMMAREA.                                   * DPKCS036
030900*   TRWS105 - IS THE INPUT LAYOUT FOR THIS PROGRAM.             * DPKCS036
031000*   TRWS107 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED          * DPKCS036
031100*             FROM THIS PROGRAM TO A LOCAL-GO FUNCTION.         * DPKCS036
031200*---------------------------------------------------------------* DPKCS036
031300                                                                  DPKCS036
031400         10  INTER-APPL-COMM-AREA       PIC X(200).               DPKCS036
031500     COPY TRWS105.                                                DPKCS036
031600     COPY TRWS107.                                                DPKCS036
031700                                                                  DPKCS036
031800*---------------------------------------------------------------* DPKCS036
031900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * DPKCS036
032000*---------------------------------------------------------------* DPKCS036
032100         10  ASC-SPECIFIC-COMMAREA.                               DPKCS036
032200             15  ASC-LIST-KEYS.                                   DPKCS036
032300                 20  ASC-KEY-PO-NBR                  PIC S9(09)   DPKCS036
032400                                                          COMP.   DPKCS036
032500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                DPKCS036
032600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  DPKCS036
032700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   DPKCS036
032800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   DPKCS036
032900                                                                  DPKCS036
033000                 20  ASC-ITEM-ARRAY.                              DPKCS036
033100                     25  ASC-ITEM-ENTRIES OCCURS 8 TIMES.         DPKCS036
033200                         30  ASC-LIST-ITEM-NUMBER                 DPKCS036
033300                                                     PIC S9(09)   DPKCS036
033400                                                     COMP-3.      DPKCS036
033500                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  DPKCS036
033600                             88  ASC-VALID-SELECT    VALUE ' '    DPKCS036
033700                                                           'S'    DPKCS036
033800                                                           'B'    DPKCS036
033900                                                           'E'.   DPKCS036
034000                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   DPKCS036
034100                             88  ASC-TEMP-SELECT     VALUE 'S'.   DPKCS036
034200                             88  ASC-TEMP-BEGIN      VALUE 'B'.   DPKCS036
034300                             88  ASC-TEMP-END        VALUE 'E'.   DPKCS036
034400                         30  ASC-SELECTED-SW         PIC  X(01).  DPKCS036
034500                             88  ASC-NO-SELECT       VALUE ' '.   DPKCS036
034600                             88  ASC-SELECT          VALUE 'S'.   DPKCS036
034700                             88  ASC-BEGIN           VALUE 'B'.   DPKCS036
034800                             88  ASC-END             VALUE 'E'.   DPKCS036
034900                         30  ASC-ACTION              PIC  X(03).  DPKCS036
035000                         30  ASC-VSL-NAME            PIC  X(25).  DPKCS036
035100                         30  ASC-VOY-NO              PIC  X(10).          
035200                         30  ASC-TRIP-CDE            PIC  X(01).  DPKCS036
035300                         30  ASC-FOB-DT              PIC  X(05).  DPKCS036
035400                         30  ASC-ATD                 PIC  X(05).  DPKCS036
035500                         30  ASC-ETA                 PIC  X(05).  DPKCS036
035600                         30  ASC-ATA                 PIC  X(05).  DPKCS036
035700                         30  ASC-FOB                 PIC  X(03).  DPKCS036
035800                         30  ASC-POE                 PIC  X(03).  DPKCS036
035900                         30  ASC-UNTS                PIC  9(09).  DPKCS036
036000                         30  ASC-CNTS                PIC  9(06).  DPKCS036
036100                                                                  DPKCS036
036200             15  ASC-BLK-SUB                         PIC S9(04)   DPKCS036
036300                                                          COMP    DPKCS036
036400                                                          SYNC.   DPKCS036
036500             15  ASC-ITEM-SUB                        PIC S9(04)   DPKCS036
036600                                                          COMP    DPKCS036
036700                                                          SYNC.   DPKCS036
036800             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   DPKCS036
036900                                                          COMP-3. DPKCS036
037000             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   DPKCS036
037100                                                          COMP-3. DPKCS036
037200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   DPKCS036
037300                                                          COMP-3. DPKCS036
037400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   DPKCS036
037500                                                          COMP-3. DPKCS036
037600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   DPKCS036
037700                                                          COMP-3. DPKCS036
037800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   DPKCS036
037900                                                          COMP    DPKCS036
038000                                                          SYNC.   DPKCS036
038100             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   DPKCS036
038200                                                          COMP-3. DPKCS036
038300             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   DPKCS036
038400                                                          COMP-3. DPKCS036
038500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  DPKCS036
038600                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   DPKCS036
038700                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   DPKCS036
038800             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  DPKCS036
038900                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   DPKCS036
039000                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   DPKCS036
039100             15  ASC-LIST-QUEUE-NAME.                             DPKCS036
039200                 20  ASC-LIST-TERM-ID                PIC  X(04).  DPKCS036
039300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   DPKCS036
039400                                                          COMP-3. DPKCS036
039500                 20  ASC-LIST-SEQ                    PIC  9(01).  DPKCS036
039600             15  ASC-SEL-QUEUE-NAME.                              DPKCS036
039700                 20  ASC-SEL-TERM-ID                 PIC  X(04).  DPKCS036
039800                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   DPKCS036
039900                                                          COMP-3. DPKCS036
040000                 20  ASC-SEL-SEQ                     PIC  9(01).  DPKCS036
040100             15  ASC-START-ITEM-REQUEST.                          DPKCS036
040200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  DPKCS036
040201             15  ASC-TOT-UNITS                       PIC  S9(08).       99
040210             15  ASC-TOT-CARTONS                     PIC  S9(05).       99
040300                                                                  DPKCS036
040400 EJECT                                                            DPKCS036
040500*---------------------------------------------------------------* DPKCS036
040600*    ABEND PROCESSING COPYBOOK.                                 * DPKCS036
040700*---------------------------------------------------------------* DPKCS036
040800                                                                  DPKCS036
040900     COPY DPWS013.                                                DPKCS036
041000                                                                  DPKCS036
041100 EJECT                                                            DPKCS036
041200*---------------------------------------------------------------* DPKCS036
041300*    DB2 AREA FOR TIMCNTK                                       * DPKCS036
041400*---------------------------------------------------------------* DPKCS036
041500     EXEC SQL                                                     DPKCS036
041600          INCLUDE TIMCNTK                                         DPKCS036
041700     END-EXEC.                                                    DPKCS036
041800*---------------------------------------------------------------* DPKCS036
041900*    DB2 AREA FOR TIMCNPO                                       * DPKCS036
042000*---------------------------------------------------------------* DPKCS036
042100     EXEC SQL                                                     DPKCS036
042200          INCLUDE TIMCNPO                                         DPKCS036
042300     END-EXEC.                                                    DPKCS036
042400*---------------------------------------------------------------* DPKCS036
042500*    DB2 AREA FOR TPURCHS                                       * DPKCS036
042600*---------------------------------------------------------------* DPKCS036
042700     EXEC SQL                                                     DPKCS036
042800          INCLUDE TPURCHS                                         DPKCS036
042900     END-EXEC.                                                    DPKCS036
043000*---------------------------------------------------------------* DPKCS036
043100*    DB2 AREA FOR TPURITM                                       * DPKCS036
043200*---------------------------------------------------------------* DPKCS036
043300     EXEC SQL                                                     DPKCS036
043400          INCLUDE TPURITM                                         DPKCS036
043500     END-EXEC.                                                    DPKCS036
043600*---------------------------------------------------------------* DPKCS036
043700*    DB2 AREA FOR TPLNSHP                                       * DPKCS036
043800*---------------------------------------------------------------* DPKCS036
043900     EXEC SQL                                                     DPKCS036
044000          INCLUDE TPLNSHP                                         DPKCS036
044100     END-EXEC.                                                    DPKCS036
044200*---------------------------------------------------------------* DPKCS036
044300*    DB2 AREA FOR TENTNME                                       * DPKCS036
044400*---------------------------------------------------------------* DPKCS036
044500     EXEC SQL                                                     DPKCS036
044600          INCLUDE TENTNME                                         DPKCS036
044700     END-EXEC.                                                    DPKCS036
044701*----------------------------------------------------------------*02500099
044702*    DB2 AREA FOR THE TSKXREF TABLE                              *02510099
044703*----------------------------------------------------------------*02520099
044704     EXEC SQL                                                     02530099
044705          INCLUDE TSKXREF                                         02540099
044706     END-EXEC.                                                    02550099
044707*----------------------------------------------------------------*02500099
044708*    DB2 AREA FOR THE TUPC TABLE                                 *02510099
044709*----------------------------------------------------------------*02520099
044710     EXEC SQL                                                     02530099
044711          INCLUDE TUPC                                            02540099
044712     END-EXEC.                                                    02550099
045400*---------------------------------------------------------------* DPKCS036
045500*    DB2 AREA FOR TIMFOB                                        * DPKCS036
045600*---------------------------------------------------------------* DPKCS036
045700     EXEC SQL                                                     DPKCS036
045800          INCLUDE TIMFOB                                          DPKCS036
045900     END-EXEC.                                                    DPKCS036
046000*---------------------------------------------------------------* DPKCS036
046100*    DB2 AREA FOR TIMPOE                                        * DPKCS036
046200*---------------------------------------------------------------* DPKCS036
046300     EXEC SQL                                                     DPKCS036
046400          INCLUDE TIMPOE                                          DPKCS036
046500     END-EXEC.                                                    DPKCS036
046510*---------------------------------------------------------------*         
046520*    DB2 AREA FOR XLT_SKU                                       *         
046530*---------------------------------------------------------------*         
046540     EXEC SQL                                                             
046550          INCLUDE XLT00003                                                
046560     END-EXEC.                                                            
046570*---------------------------------------------------------------*         
046580*    DB2 AREA FOR XLT_VND_STYL                                  *         
046590*---------------------------------------------------------------*         
046591     EXEC SQL                                                             
046592          INCLUDE XLT00004                                                
046593     END-EXEC.                                                            
046600*---------------------------------------------------------------* DPKCS036
046700*    DB2 AREA FOR COMMUNICATIONS                                * DPKCS036
046800*---------------------------------------------------------------* DPKCS036
046900     EXEC SQL                                                     DPKCS036
047000          INCLUDE SQLCA                                           DPKCS036
047100     END-EXEC.                                                    DPKCS036
047200*----------------------------------------------------------------*DPKCS036
047300*    CURSOR FOR VESSEL/VOYAGE DETAILS FOR A REQUESTED PO         *DPKCS036
047400*----------------------------------------------------------------*DPKCS036
047500                                                                  DPKCS036
047600     EXEC SQL                                                     DPKCS036
047700          DECLARE VSL-CSR CURSOR                                  DPKCS036
047800          FOR SELECT DISTINCT                                     DPKCS036
047900                A.MOM_IMPRT_TRIP_ID                               DPKCS036
048000              , A.MOM_TRIP_TYP_CDE                                DPKCS036
048100              , A.FDR_TRIP_TYP_CDE                                DPKCS036
048200              , A.FDR_FOB_CDE                                     DPKCS036
048300              , A.MOM_FOB_CDE                                     DPKCS036
048400              , A.FDR_DPRTR_TMST                                  DPKCS036
048500              , A.MOM_DPRTR_TMST                                  DPKCS036
048600              , A.MOM_DEST_POE_CDE                                        
048700              , A.MOM_POE_DELY_TMST                                       
048710              , A.ACTL_POE_DELY_TMST                                      
048800              , B.PO_RCVD_DELY_TMST                                       
049000          FROM                                                    DPKCS036
049100                TIMCNTK A                                         DPKCS036
049200              , TIMCNPO B                                         DPKCS036
049300          WHERE                                                   DPKCS036
049400                B.PO_NBR         = :DK-PO-NBR                     DPKCS036
049500          AND   B.CONTNR_ID      =  A.CONTNR_ID                   DPKCS036
049600          AND   B.CONTNR_SEQ_NBR =  A.CONTNR_SEQ_NBR              DPKCS036
049700          ORDER BY                                                DPKCS036
049800                A.MOM_POE_DELY_TMST  DESC                         DPKCS036
049900     END-EXEC.                                                    DPKCS036
050000                                                                  DPKCS036
050100 EJECT                                                            DPKCS036
050200*----------------------------------------------------------------*        
050300*    CURSOR DECLARATION FOR SELECTING OUTER PACK QUANTITY        *        
050400*----------------------------------------------------------------*        
050500                                                                          
050600     EXEC SQL                                                     02960099
050700          DECLARE  OUTR-PCK-CSR CURSOR                            02970099
050800             FOR   SELECT                                         02980099
050900                   A.UNT_QTY                                      03000099
051000                ,  A.OUTR_PK_QTY                                  02990099
051100             FROM  TPURITM  A                                     03010099
051400             WHERE A.PO_NBR         = :DK-PO-NBR                          
051800             AND   A.VER_STATUS_CDE = 'A'                         03050099
051801             FOR   FETCH ONLY                                     03060099
051802     END-EXEC.                                                    03070099
051803                                                                          
051900 EJECT                                                                    
051901*---------------------------------------------------------------*         
051902*    CURSOR DECLARATION FOR SELECTING POE CODE.                 *         
051903*---------------------------------------------------------------*         
051904                                                                          
051905     EXEC SQL                                                             
051906          DECLARE  POE-CSR CURSOR                                         
051907              FOR  SELECT DISTINCT                                        
051908                   POE_CDE                                                
051909             FROM  TIMPOE                                                 
051910            WHERE  POE_STD_EDI_CDE = :IMCNTK-MOM-DEST-POE-CDE             
051911              AND  STAT_CDE        = 'A'                                  
051912         ORDER BY  POE_CDE                                                
051913     END-EXEC.                                                            
051914                                                                          
051920 EJECT                                                            04110099
052000*----------------------------------------------------------------*DPKCS036
052100 LINKAGE SECTION.                                                 DPKCS036
052200                                                                  DPKCS036
052300 01  DFHCOMMAREA.                                                 DPKCS036
052400     05  FILLER                         OCCURS  1 TO 4072 TIMES   DPKCS036
052500                                        DEPENDING ON EIBCALEN.    DPKCS036
052600         10  FILLER                     PIC X.                    DPKCS036
052700                                                                  DPKCS036
052800 EJECT                                                            DPKCS036
052900*----------------------------------------------------------------*DPKCS036
053000 PROCEDURE DIVISION.                                              DPKCS036
053100*----------------------------------------------------------------*DPKCS036
053200*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *DPKCS036
053300*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *DPKCS036
053400*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *DPKCS036
053500*----------------------------------------------------------------*DPKCS036
053600 0000-MAIN-MODULE.                                                DPKCS036
053700                                                                  DPKCS036
053800     INITIALIZE DP030-CICS-API-FIELDS.                            DPKCS036
053900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       DPKCS036
054000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          DPKCS036
054100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         DPKCS036
054200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       DPKCS036
054300     MOVE LENGTH OF TR165AI        TO DP030-MAP-LENGTH (1).       DPKCS036
054400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     DPKCS036
054500     PERFORM 0001-CALL-CICS-ARCH-API.                             DPKCS036
054600*                                                                 DPKCS036
054700     PERFORM 1000-CONTROL-PROCESSING                              DPKCS036
054800*                                                                 DPKCS036
054900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     DPKCS036
055000     PERFORM 0001-CALL-CICS-ARCH-API.                             DPKCS036
055100                                                                  DPKCS036
055200*----------------------------------------------------------------*DPKCS036
055300*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *DPKCS036
055400*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *DPKCS036
055500*----------------------------------------------------------------*DPKCS036
055600 0001-CALL-CICS-ARCH-API.                                         DPKCS036
055700                                                                  DPKCS036
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      DPKCS036
055900                                    DFHCOMMAREA                           
056000                                    DP030-CICS-API-FIELDS                 
056100                                    DP020-STANDARD-COMMAREA               
056200                                    TR165AI.                              
056300*                                                                 DPKCS036
056400     IF  DP030-RC-CALL-SUCCESSFUL                                 DPKCS036
056500         CONTINUE                                                 DPKCS036
056600     ELSE                                                         DPKCS036
056700         SET DP013-NO-ROLLBACK                                    DPKCS036
056800             DP013-XCTL-DISPLAY-RESTART                           DPKCS036
056900             DP013-CICS-ABEND      TO TRUE                        DPKCS036
057000         MOVE '0001-CALL-CICS-ARCH-API'                           DPKCS036
057100                                   TO DP013-PARAGRAPH             DPKCS036
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE ODPKCS036
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      DPKCS036
057400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      DPKCS036
057500         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
057600     END-IF.                                                      DPKCS036
057700                                                                  DPKCS036
057800 EJECT                                                            DPKCS036
057900*----------------------------------------------------------------*DPKCS036
058000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *DPKCS036
058100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *DPKCS036
058200*                                                                *DPKCS036
058300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *DPKCS036
058400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *DPKCS036
058500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *DPKCS036
058600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *DPKCS036
058700*----------------------------------------------------------------*DPKCS036
058800 1000-CONTROL-PROCESSING.                                         DPKCS036
058900                                                                  DPKCS036
059000     EVALUATE TRUE                                                DPKCS036
059100         WHEN DP020-NEXT-ACT-INITIAL                              DPKCS036
059200             INITIALIZE ASC-SPECIFIC-COMMAREA                     DPKCS036
059300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            DPKCS036
059400                                      ASC-SEL-TERM-ID             DPKCS036
059500             MOVE DP020-SRC-TASK-NUMBER                           DPKCS036
059600                                   TO ASC-LIST-TASK-NUMBER        DPKCS036
059700                                      ASC-SEL-TASK-NUMBER         DPKCS036
059800             MOVE PC-LIST-QUEUE-SEQ                               DPKCS036
059900                                   TO ASC-LIST-SEQ                DPKCS036
060000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 DPKCS036
060100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 DPKCS036
060200*-------$TEMPLATE NOTE$------------------------------------------*DPKCS036
060300* IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION, *DPKCS036
060400* SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO   *DPKCS036
060500* TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED. *DPKCS036
060600*----------------------------------------------------------------*DPKCS036
060700             IF  PS-COMMAREA-NOT-VALID                            DPKCS036
060800                 SET DP020-NEXT-ACT-APPL-ERROR                    DPKCS036
060900                                   TO TRUE                        DPKCS036
061000             ELSE                                                 DPKCS036
061100                 PERFORM 4000-BUILD-INITIAL-PANEL                 DPKCS036
061200             END-IF                                               DPKCS036
061300                                                                  DPKCS036
061400         WHEN DP020-NEXT-ACT-READ-MAP                             DPKCS036
061500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        DPKCS036
061600                                   TO PV-TOP-ITEM                 DPKCS036
061700             PERFORM 2000-PROCESS-PANEL                           DPKCS036
061800                                                                  DPKCS036
061900         WHEN DP020-NEXT-ACT-RETURN                               DPKCS036
062000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        DPKCS036
062100                                   TO PV-TOP-ITEM                 DPKCS036
062200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
062300             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 DPKCS036
062400             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   DPKCS036
062500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
062600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                      CL**2
062700                                                                  DPKCS036
062800         WHEN OTHER                                               DPKCS036
062900             SET DP013-LOGIC-ABEND TO TRUE                        DPKCS036
063000             SET DP013-NO-ROLLBACK TO TRUE                        DPKCS036
063100             MOVE '1000-CONTROL-PROCESSING'                       DPKCS036
063200                                   TO DP013-PARAGRAPH             DPKCS036
063300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    DPKCS036
063400                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
063500             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
063600     END-EVALUATE.                                                DPKCS036
063700                                                                  DPKCS036
063800 EJECT                                                            DPKCS036
063900*----------------------------------------------------------------*DPKCS036
064000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *DPKCS036
064100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *DPKCS036
064200*----------------------------------------------------------------*DPKCS036
064300 1100-PROCESS-INTER-APPL-COMM.                                    DPKCS036
064400                                                                  DPKCS036
064500     SET PS-COMMAREA-VALID         TO TRUE.                               
064600     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     DPKCS036
064700     IF  DP020-NAV-KEY-DATA > SPACE                                       
064800         MOVE DP020-NAV-KEY-DATA   TO ASC-KEY-PO-NBR                      
064900                                      DK-PO-NBR                           
065000     ELSE                                                                 
065100         MOVE TR105-PO-NBR         TO ASC-KEY-PO-NBR                      
065200                                      DK-PO-NBR                           
065300     END-IF.                                                              
065400                                                                  DPKCS036
065500 EJECT                                                            DPKCS036
065600*----------------------------------------------------------------*DPKCS036
065700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITING OF THE DATA    *DPKCS036
065800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *DPKCS036
065900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *DPKCS036
066000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *DPKCS036
066100* FUNCTION KEYS CAN GET THIS FAR.                                *DPKCS036
066200*----------------------------------------------------------------*DPKCS036
066300 2000-PROCESS-PANEL.                                              DPKCS036
066400                                                                  DPKCS036
066500     EVALUATE TRUE                                                DPKCS036
066600         WHEN DP020-SRC-AID = DP016-CLEAR                         DPKCS036
066700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
066800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
066900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
067000                                                                  DPKCS036
067100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    DPKCS036
067200             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   DPKCS036
067300             PERFORM 2050-DELETE-LIST-QUEUE                       DPKCS036
067400             PERFORM 4000-BUILD-INITIAL-PANEL                     DPKCS036
067500                                                                  DPKCS036
067600         WHEN OTHER                                               DPKCS036
067700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 DPKCS036
067800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
067900             IF  PS-NO-ERROR                                      DPKCS036
068000                 SET DP030-CONTINUE-GO                            DPKCS036
068100                                 TO TRUE                          DPKCS036
068200                 PERFORM 2100-CHECK-FUNCTION-KEY                  DPKCS036
068300             ELSE                                                 DPKCS036
068400                 SET DP030-OVERRIDE-GO                            DPKCS036
068500                                 TO TRUE                          DPKCS036
068600             END-IF                                               DPKCS036
068700     END-EVALUATE.                                                DPKCS036
068800                                                                  DPKCS036
068900 EJECT                                                            DPKCS036
069000*----------------------------------------------------------------*DPKCS036
069100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *DPKCS036
069200*----------------------------------------------------------------*DPKCS036
069300 2050-DELETE-LIST-QUEUE.                                          DPKCS036
069400                                                                  DPKCS036
069500     EXEC CICS                                                    DPKCS036
069600         DELETEQ TS                                               DPKCS036
069700             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
069800             RESP  (PV-CICS-RESP)                                 DPKCS036
069900     END-EXEC.                                                    DPKCS036
070000                                                                  DPKCS036
070100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       DPKCS036
070200        (PV-CICS-RESP = DFHRESP(QIDERR))                          DPKCS036
070300         CONTINUE                                                 DPKCS036
070400     ELSE                                                         DPKCS036
070500         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
070600         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
070700                                                                  DPKCS036
070800         MOVE '2050-DELETE-LIST-QUEUE'                            DPKCS036
070900                                   TO DP013-PARAGRAPH             DPKCS036
071000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    DPKCS036
071100                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
071200         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
071300     END-IF.                                                      DPKCS036
071400                                                                  DPKCS036
071500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  DPKCS036
071600                                                                  DPKCS036
071700 EJECT                                                            DPKCS036
071800*----------------------------------------------------------------*DPKCS036
071900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*DPKCS036
072000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *DPKCS036
072100* CICS ARCHITECTURE API.                                         *DPKCS036
072200*----------------------------------------------------------------*DPKCS036
072300 2100-CHECK-FUNCTION-KEY.                                         DPKCS036
072400                                                                  DPKCS036
072500     EVALUATE TRUE                                                DPKCS036
072600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              DPKCS036
072700            IF  ASC-NUMBER-OF-SELECTED-ITEMS = 1                  DPKCS036
072800                INITIALIZE TR107-INTER-APPL-COMMAREA              DPKCS036
072900                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                 DPKCS036
073000                                TO TR107-NUMBER-OF-SELECTED-ITEMS DPKCS036
073100                MOVE ASC-KEY-PO-NBR                               DPKCS036
073200                                TO TR107-PO-NBR                   DPKCS036
073300                PERFORM 5000-PREPARE-SEL-QUEUE                    DPKCS036
073400            ELSE                                                  DPKCS036
073500                IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1              DPKCS036
073600                    SET DP030-OVERRIDE-GO     TO TRUE             DPKCS036
073700                    MOVE PC-TSYMSG-00047      TO DP020-MSG-NUMBER DPKCS036
073800                    SET DP020-MSG-WARNING     TO TRUE             DPKCS036
073900                ELSE                                              DPKCS036
074000                    IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0          DPKCS036
074100                        SET DP030-OVERRIDE-GO TO TRUE             DPKCS036
074200                        MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER DPKCS036
074300                        SET DP020-MSG-WARNING TO TRUE             DPKCS036
074400                    END-IF                                        DPKCS036
074500                END-IF                                            DPKCS036
074600            END-IF                                                DPKCS036
074700                                                                  DPKCS036
074800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  DPKCS036
074900             MOVE +1               TO PV-TOP-ITEM                 DPKCS036
075000             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   DPKCS036
075100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
075200             PERFORM 3200-RESET-ATTRIBUTES                        DPKCS036
075300                                                                  DPKCS036
075400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   DPKCS036
075500             PERFORM 2110-BROWSE-BACKWARD                         DPKCS036
075600             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   DPKCS036
075700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
075800             PERFORM 3200-RESET-ATTRIBUTES                        DPKCS036
075900                                                                  DPKCS036
076000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   DPKCS036
076100             PERFORM 2120-BROWSE-FORWARD                          DPKCS036
076200             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   DPKCS036
076300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
076400                                                                  DPKCS036
076500         WHEN DP020-SRC-AID = DP016-ENTER                         DPKCS036
076600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   DPKCS036
076700             IF  PS-ERROR                                         DPKCS036
076800                 CONTINUE                                         DPKCS036
076900             ELSE                                                 DPKCS036
077000                 MOVE ASC-KEY-PO-NBR                              DPKCS036
077100                                   TO DK-PO-NBR                   DPKCS036
077200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             DPKCS036
077300                 PERFORM 3200-RESET-ATTRIBUTES                    DPKCS036
077400             END-IF                                               DPKCS036
077500                                                                  DPKCS036
077600         WHEN OTHER                                               DPKCS036
077700             SET DP013-NO-ROLLBACK                                DPKCS036
077800                 DP013-XCTL-DISPLAY-RESTART                       DPKCS036
077900                 DP013-CICS-ABEND  TO TRUE                        DPKCS036
078000             MOVE '2100-CHECK-FUNCTION-KEY'                       DPKCS036
078100                                   TO DP013-PARAGRAPH             DPKCS036
078200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      DPKCS036
078300                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
078400             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
078500     END-EVALUATE.                                                DPKCS036
078600                                                                  DPKCS036
078700 EJECT                                                            DPKCS036
078800*----------------------------------------------------------------*DPKCS036
078900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *DPKCS036
079000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *DPKCS036
079100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *DPKCS036
079200*    MESSAGE.                                                    *DPKCS036
079300*----------------------------------------------------------------*DPKCS036
079400 2110-BROWSE-BACKWARD.                                            DPKCS036
079500                                                                  DPKCS036
079600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
079700         GIVING PV-TOP-ITEM.                                      DPKCS036
079800*                                                                 DPKCS036
079900     IF  ((PV-TOP-ITEM < +1)                                      DPKCS036
080000       OR (PV-TOP-ITEM = +1))                                     DPKCS036
080100         MOVE +1                   TO PV-TOP-ITEM                 DPKCS036
080200*------- TOP OF LIST --------                                     DPKCS036
080300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            DPKCS036
080400         SET DP020-MSG-INFORMATIONAL TO TRUE                      DPKCS036
080500     END-IF.                                                      DPKCS036
080600                                                                  DPKCS036
080700 EJECT                                                            DPKCS036
080800*----------------------------------------------------------------*DPKCS036
080900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *DPKCS036
081000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *DPKCS036
081100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *DPKCS036
081200*----------------------------------------------------------------*DPKCS036
081300 2120-BROWSE-FORWARD.                                             DPKCS036
081400                                                                  DPKCS036
081500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              DPKCS036
081600         GIVING PV-TOP-ITEM.                                      DPKCS036
081700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   DPKCS036
081800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            DPKCS036
081900                                   TO PV-TOP-ITEM                 DPKCS036
082000*------- BOTTOM OF LIST ----------                                DPKCS036
082100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            DPKCS036
082200         SET DP020-MSG-INFORMATIONAL                              DPKCS036
082300                                   TO TRUE                        DPKCS036
082400     ELSE                                                         DPKCS036
082500         COMPUTE PV-BOTTOM-ITEM =                                 DPKCS036
082600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 DPKCS036
082700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            DPKCS036
082800*----------- BOTTOM OF LIST ---------                             DPKCS036
082900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            DPKCS036
083000             SET DP020-MSG-INFORMATIONAL                          DPKCS036
083100                                   TO TRUE                        DPKCS036
083200         END-IF                                                   DPKCS036
083300     END-IF.                                                      DPKCS036
083400                                                                  DPKCS036
083500 EJECT                                                            DPKCS036
083600*----------------------------------------------------------------*DPKCS036
083700*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *DPKCS036
083800*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *DPKCS036
083900*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *DPKCS036
084000*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *DPKCS036
084100*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *DPKCS036
084200*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *DPKCS036
084300*----------------------------------------------------------------*DPKCS036
084400 2130-CHECK-FOR-JUMP-BROWSE.                                      DPKCS036
084500                                                                  DPKCS036
084600     SET PS-NO-ERROR               TO TRUE.                       DPKCS036
084700     IF (ASC-START-ITEM-REQUEST = SPACE)                          DPKCS036
084800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            DPKCS036
084900                                   TO PV-TOP-ITEM                 DPKCS036
085000     ELSE                                                         DPKCS036
085100         MOVE ASC-START-ITEM-REQUEST                              DPKCS036
085200                                   TO DP010I-UNEDITED-FIELD       DPKCS036
085300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       DPKCS036
085400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     DPKCS036
085500         SET DP010I-NEGATIVE-NOT-ALLOWED                          DPKCS036
085600                                   TO TRUE                        DPKCS036
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
085800                                                                  DPKCS036
085900         IF  NOT DP010I-ERROR-DETECTED                            DPKCS036
086000             MOVE DP010I-NUMERIC-FIELD                            DPKCS036
086100                                   TO  ASC-START-ITEM-REQUEST-N   DPKCS036
086200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  DPKCS036
086300                 IF  ASC-START-ITEM-REQUEST-N >                   DPKCS036
086400                                          ASC-NUMBER-OF-ITEMS-READDPKCS036
086500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         DPKCS036
086600                     COMPUTE PV-TOP-ITEM =                        DPKCS036
086700                             ASC-NUMBER-OF-ITEMS-READ             DPKCS036
086800                             - PC-ITEMS-PER-PANEL + 1             DPKCS036
086900                     IF  PV-TOP-ITEM < +1                         DPKCS036
087000                         MOVE +1   TO PV-TOP-ITEM                 DPKCS036
087100                         MOVE PC-TSYMSG-00070                     DPKCS036
087200                                   TO DP020-MSG-NUMBER            DPKCS036
087300                         SET DP020-MSG-INFORMATIONAL              DPKCS036
087400                                   TO TRUE                        DPKCS036
087500                     END-IF                                       DPKCS036
087600                 ELSE                                             DPKCS036
087700                     MOVE ASC-START-ITEM-REQUEST-N                DPKCS036
087800                                   TO PV-TOP-ITEM                 DPKCS036
087900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      DPKCS036
088000                     COMPUTE PV-BOTTOM-ITEM =                     DPKCS036
088100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     DPKCS036
088200                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READDPKCS036
088300*----------------------- BOTTOM OF LIST --------------            DPKCS036
088400                         MOVE PC-TSYMSG-00070                     DPKCS036
088500                                   TO DP020-MSG-NUMBER            DPKCS036
088600                         SET DP020-MSG-INFORMATIONAL              DPKCS036
088700                                   TO TRUE                        DPKCS036
088800                     END-IF                                       DPKCS036
088900                 END-IF                                           DPKCS036
089000             ELSE                                                 DPKCS036
089100*--------------- VALUE OUT OF RANGE -------                       DPKCS036
089200                 MOVE PC-TSYMSG-00101                             DPKCS036
089300                                   TO DP020-MSG-NUMBER            DPKCS036
089400                 MOVE -1           TO ASTRTITL                    DPKCS036
089500                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
089600                                   TO TRUE                        DPKCS036
089700                 MOVE DP015-REVERSE                               DPKCS036
089800                                   TO ASTRTITH                    DPKCS036
089900                 MOVE DP015-RED    TO ASTRTITC                    DPKCS036
090000                 MOVE DP015-UNP-NUM-BRT-MDT                       DPKCS036
090100                                   TO ASTRTITA                    DPKCS036
090200                 SET DP020-MSG-FATAL                              DPKCS036
090300                                   TO TRUE                        DPKCS036
090400                 SET PS-ERROR      TO TRUE                        DPKCS036
090500             END-IF                                               DPKCS036
090600                                                                  DPKCS036
090700         ELSE                                                     DPKCS036
090800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            DPKCS036
090900             MOVE -1               TO ASTRTITL                    DPKCS036
091000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  DPKCS036
091100             MOVE DP015-REVERSE    TO ASTRTITH                    DPKCS036
091200             MOVE DP015-RED        TO ASTRTITC                    DPKCS036
091300             MOVE DP015-UNP-NUM-BRT-MDT                           DPKCS036
091400                                   TO ASTRTITA                    DPKCS036
091500             SET DP020-MSG-FATAL   TO TRUE                        DPKCS036
091600             SET PS-ERROR          TO TRUE                        DPKCS036
091700         END-IF                                                   DPKCS036
091800     END-IF.                                                      DPKCS036
091900                                                                  DPKCS036
092000 EJECT                                                            DPKCS036
092100*----------------------------------------------------------------*DPKCS036
092200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *DPKCS036
092300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *DPKCS036
092400*----------------------------------------------------------------*DPKCS036
092500 2140-DESELECT-ALL-ITEMS.                                         DPKCS036
092600                                                                  DPKCS036
092700     MOVE +1                       TO ASC-BLK-SUB.                DPKCS036
092800                                                                  DPKCS036
092900     PERFORM 2141-CLEAR-SELECTED-INDS                             DPKCS036
093000         VARYING ASC-ITEM-SUB                                     DPKCS036
093100         FROM 1 BY 1                                              DPKCS036
093200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
093300                                                                  DPKCS036
093400     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
093500                                                                  DPKCS036
093600     PERFORM 2141-CLEAR-SELECTED-INDS                             DPKCS036
093700         VARYING ASC-ITEM-SUB                                     DPKCS036
093800         FROM 1 BY 1                                              DPKCS036
093900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
094000                                                                  DPKCS036
094100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
094200                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
094300                                                                  DPKCS036
094400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
094500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
094600                                                                  DPKCS036
094700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     DPKCS036
094800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      DPKCS036
094900         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
095000                                                                  DPKCS036
095100         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
095200                                                                  DPKCS036
095300         MOVE +1                   TO PV-BLOCK-NUMBER             DPKCS036
095400                                                                  DPKCS036
095500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
095600             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
095700                                                                  DPKCS036
095800         PERFORM                                                  DPKCS036
095900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       DPKCS036
096000                                                                  DPKCS036
096100             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
096200                                                                  DPKCS036
096300             PERFORM 2141-CLEAR-SELECTED-INDS                     DPKCS036
096400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 DPKCS036
096500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
096600                                                                  DPKCS036
096700             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
096800                                                                  DPKCS036
096900             ADD +1                TO PV-BLOCK-NUMBER             DPKCS036
097000         END-PERFORM                                              DPKCS036
097100                                                                  DPKCS036
097200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
097300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
097400                                                                  DPKCS036
097500         PERFORM                                                  DPKCS036
097600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
097700                   ASC-HIGHEST-BLOCK-WRITTEN                      DPKCS036
097800                                                                  DPKCS036
097900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
098000                                   TO PV-BLOCK-NUMBER             DPKCS036
098100                                                                  DPKCS036
098200             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
098300                                                                  DPKCS036
098400             PERFORM 2141-CLEAR-SELECTED-INDS                     DPKCS036
098500                 VARYING ASC-ITEM-SUB                             DPKCS036
098600                 FROM 1 BY 1                                      DPKCS036
098700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
098800                                                                  DPKCS036
098900             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
099000                                                                  DPKCS036
099100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
099200         END-PERFORM                                              DPKCS036
099300                                                                  DPKCS036
099400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
099500                                   TO PV-BLOCK-NUMBER             DPKCS036
099600                                                                  DPKCS036
099700         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
099800     END-IF.                                                      DPKCS036
099900                                                                  DPKCS036
100000     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMSDPKCS036
100100                                      ASC-START-OF-SELECTED-RANGE DPKCS036
100200                                      ASC-END-OF-SELECTED-RANGE.  DPKCS036
100300                                                                  DPKCS036
100400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        DPKCS036
100500                                                                  DPKCS036
100600 EJECT                                                            DPKCS036
100700*----------------------------------------------------------------*DPKCS036
100800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *DPKCS036
100900*----------------------------------------------------------------*DPKCS036
101000 2141-CLEAR-SELECTED-INDS.                                        DPKCS036
101100                                                                  DPKCS036
101200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
101300             NOT EQUAL ZERO                                       DPKCS036
101400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
101500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
101600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    DPKCS036
101700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  DPKCS036
101800                                   TO TRUE                        DPKCS036
101900         END-IF                                                   DPKCS036
102000     END-IF.                                                      DPKCS036
102100                                                                  DPKCS036
102200 EJECT                                                            DPKCS036
102300*----------------------------------------------------------------*DPKCS036
102400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *DPKCS036
102500*  FOR ALL ITEMS.                                                *DPKCS036
102600*----------------------------------------------------------------*DPKCS036
102700 2150-SELECT-ALL-ITEMS.                                           DPKCS036
102800                                                                  DPKCS036
102900     MOVE +1                       TO ASC-BLK-SUB.                DPKCS036
103000                                                                  DPKCS036
103100     PERFORM 2151-SET-SELECTED-INDS                               DPKCS036
103200         VARYING ASC-ITEM-SUB                                     DPKCS036
103300         FROM 1 BY 1                                              DPKCS036
103400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
103500                                                                  DPKCS036
103600     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
103700                                                                  DPKCS036
103800     PERFORM 2151-SET-SELECTED-INDS                               DPKCS036
103900         VARYING ASC-ITEM-SUB                                     DPKCS036
104000         FROM 1 BY 1                                              DPKCS036
104100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
104200                                                                  DPKCS036
104300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
104400                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
104500                                                                  DPKCS036
104600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
104700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
104800                                                                  DPKCS036
104900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     DPKCS036
105000        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    DPKCS036
105100         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
105200                                                                  DPKCS036
105300         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
105400                                                                  DPKCS036
105500         MOVE +1                   TO PV-BLOCK-NUMBER             DPKCS036
105600                                                                  DPKCS036
105700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
105800             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
105900                                                                  DPKCS036
106000         PERFORM                                                  DPKCS036
106100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       DPKCS036
106200                                                                  DPKCS036
106300             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
106400                                                                  DPKCS036
106500             PERFORM 2151-SET-SELECTED-INDS                       DPKCS036
106600                 VARYING ASC-ITEM-SUB                             DPKCS036
106700                 FROM 1 BY 1                                      DPKCS036
106800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
106900                                                                  DPKCS036
107000             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
107100                                                                  DPKCS036
107200             ADD +1                TO PV-BLOCK-NUMBER             DPKCS036
107300                                                                  DPKCS036
107400         END-PERFORM                                              DPKCS036
107500                                                                  DPKCS036
107600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
107700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
107800                                                                  DPKCS036
107900         PERFORM                                                  DPKCS036
108000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
108100                   ASC-HIGHEST-BLOCK-WRITTEN                      DPKCS036
108200                                                                  DPKCS036
108300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
108400                                   TO PV-BLOCK-NUMBER             DPKCS036
108500                                                                  DPKCS036
108600             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
108700                                                                  DPKCS036
108800             PERFORM 2151-SET-SELECTED-INDS                       DPKCS036
108900                 VARYING ASC-ITEM-SUB                             DPKCS036
109000                 FROM 1 BY 1                                      DPKCS036
109100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
109200                                                                  DPKCS036
109300             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
109400                                                                  DPKCS036
109500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
109600                                                                  DPKCS036
109700         END-PERFORM                                              DPKCS036
109800                                                                  DPKCS036
109900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
110000                                   TO PV-BLOCK-NUMBER             DPKCS036
110100                                                                  DPKCS036
110200         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
110300     END-IF.                                                      DPKCS036
110400                                                                  DPKCS036
110500                                                                  DPKCS036
110600     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             DPKCS036
110700                       ASC-NUMBER-OF-SELECTED-ITEMS.              DPKCS036
110800                                                                  DPKCS036
110900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        DPKCS036
111000                                                                  DPKCS036
111100 EJECT                                                            DPKCS036
111200*----------------------------------------------------------------*DPKCS036
111300*    MARK EACH ITEM AS BEING SELECTED.                           *DPKCS036
111400*----------------------------------------------------------------*DPKCS036
111500 2151-SET-SELECTED-INDS.                                          DPKCS036
111600                                                                  DPKCS036
111700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
111800             NOT EQUAL ZERO                                       DPKCS036
111900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
112000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
112100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
112200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  DPKCS036
112300                               TO  TRUE                           DPKCS036
112400         END-IF                                                   DPKCS036
112500     END-IF.                                                      DPKCS036
112600                                                                  DPKCS036
112700 EJECT                                                            DPKCS036
112800*----------------------------------------------------------------*DPKCS036
112900*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *DPKCS036
113000*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *DPKCS036
113100*----------------------------------------------------------------*DPKCS036
113200 2200-MOVE-SCREEN-TO-COMMAREA.                                    DPKCS036
113300                                                                  DPKCS036
113400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             DPKCS036
113500     MOVE +1                       TO PV-SUB.                     DPKCS036
113600*                                                                 DPKCS036
113700     PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
113800     IF  ASTRTITL > ZERO                                          DPKCS036
113900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          DPKCS036
114000     ELSE                                                         DPKCS036
114100         IF  ASTRTITF = DP015-ERASE-EOF                           DPKCS036
114200             INITIALIZE ASC-START-ITEM-REQUEST                    DPKCS036
114300         END-IF                                                   DPKCS036
114400     END-IF.                                                      DPKCS036
114500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          DPKCS036
114600         VARYING PV-SUB                                           DPKCS036
114700         FROM 1 BY 1                                              DPKCS036
114800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      DPKCS036
114900                                                                  DPKCS036
115000 EJECT                                                            DPKCS036
115100*----------------------------------------------------------------*DPKCS036
115200*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *DPKCS036
115300*----------------------------------------------------------------*DPKCS036
115400 2210-MOVE-LINES-TO-COMMAREA.                                     DPKCS036
115500                                                                  DPKCS036
115600     IF  MR-SELECTL (PV-SUB) > ZERO                               DPKCS036
115700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             DPKCS036
115800         MOVE MR-SELECTI (PV-SUB)                                 DPKCS036
115900                                   TO ASC-TEMP-SELECTED-SW        DPKCS036
116000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      DPKCS036
116100     ELSE                                                         DPKCS036
116200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                DPKCS036
116300                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     DPKCS036
116400                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        DPKCS036
116500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      DPKCS036
116600         END-IF                                                   DPKCS036
116700     END-IF.                                                      DPKCS036
116800     ADD +1                        TO ASC-ITEM-SUB.               DPKCS036
116900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
117000         ADD  +1                   TO ASC-BLK-SUB                 DPKCS036
117100         MOVE +1                   TO ASC-ITEM-SUB                DPKCS036
117200     END-IF.                                                      DPKCS036
117300                                                                  DPKCS036
117400 EJECT                                                            DPKCS036
117500*----------------------------------------------------------------*DPKCS036
117600*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *DPKCS036
117700*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *DPKCS036
117800*----------------------------------------------------------------*DPKCS036
117900 3000-EDIT-DATA-IN-COMMAREA.                                      DPKCS036
118000                                                                  DPKCS036
118100     SET PS-NO-ERROR               TO TRUE.                       DPKCS036
118200     PERFORM 3200-RESET-ATTRIBUTES.                               DPKCS036
118300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     DPKCS036
118400*----------------------------------------------------------------*DPKCS036
118500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED. *            DPKCS036
118600* EDITTING IS DONE FROM THE BOTTOM UP. *                          DPKCS036
118700*----------------------------------------------------------------*DPKCS036
118800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       DPKCS036
118900         ASC-ITEMS-DISPLAYED - 1.                                 DPKCS036
119000     PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
119100     PERFORM 3300-EDIT-SELECTIONS                                 DPKCS036
119200         VARYING PV-SUB                                           DPKCS036
119300         FROM PV-SUB BY -1                                        DPKCS036
119400         UNTIL PV-SUB < +1                                        DPKCS036
119500*                                                                 DPKCS036
119600     IF  PS-NO-ERROR                                              DPKCS036
119700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        DPKCS036
119800     END-IF.                                                      DPKCS036
119900*                                                                 DPKCS036
120000     IF  ((PS-NO-ERROR)                                           DPKCS036
120100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   DPKCS036
120200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    DPKCS036
120300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  DPKCS036
120400     END-IF.                                                      DPKCS036
120500                                                                  DPKCS036
120600 EJECT                                                            DPKCS036
120700*----------------------------------------------------------------*DPKCS036
120800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *DPKCS036
120900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*DPKCS036
121000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *DPKCS036
121100*                                                                *DPKCS036
121200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *DPKCS036
121300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *DPKCS036
121400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *DPKCS036
121500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *DPKCS036
121600*----------------------------------------------------------------*DPKCS036
121700 3100-SET-SUBSCRIPTS.                                             DPKCS036
121800                                                                  DPKCS036
121900     COMPUTE ASC-ITEM-SUB =                                       DPKCS036
122000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        DPKCS036
122100                                                                  DPKCS036
122200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         DPKCS036
122300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
122400                                                                  DPKCS036
122500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               DPKCS036
122600     ELSE                                                         DPKCS036
122700         MOVE +1                     TO ASC-BLK-SUB               DPKCS036
122800     END-IF.                                                      DPKCS036
122900                                                                  DPKCS036
123000 EJECT                                                            DPKCS036
123100*----------------------------------------------------------------*DPKCS036
123200*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *DPKCS036
123300*----------------------------------------------------------------*DPKCS036
123400 3200-RESET-ATTRIBUTES.                                           DPKCS036
123500                                                                  DPKCS036
123600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   DPKCS036
123700     MOVE DP015-GREEN              TO ASTRTITC.                   DPKCS036
123800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   DPKCS036
123900*                                                                 DPKCS036
124000     PERFORM                                                      DPKCS036
124100         VARYING PV-SUB                                           DPKCS036
124200         FROM 1 BY 1                                              DPKCS036
124300         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   DPKCS036
124400                         ASC-ITEMS-DISPLAYED)                     DPKCS036
124500         MOVE DP015-UNP-ALP-NOR-OFF                               DPKCS036
124600                                   TO MR-SELECTA (PV-SUB)         DPKCS036
124700         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         DPKCS036
124800         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         DPKCS036
124900     END-PERFORM.                                                 DPKCS036
125000                                                                  DPKCS036
125100 EJECT                                                            DPKCS036
125200*----------------------------------------------------------------*DPKCS036
125300*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *DPKCS036
125400*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *DPKCS036
125500*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *DPKCS036
125600*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *DPKCS036
125700*----------------------------------------------------------------*DPKCS036
125800 3300-EDIT-SELECTIONS.                                            DPKCS036
125900                                                                  DPKCS036
126000     EVALUATE TRUE                                                DPKCS036
126100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     DPKCS036
126200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
126300                 CONTINUE                                         DPKCS036
126400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
126500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
126600                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   DPKCS036
126700                 MOVE ASC-TEMP-SELECTED-SW                        DPKCS036
126800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
126900                                TO ASC-SELECTED-SW                DPKCS036
127000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
127100             END-IF                                               DPKCS036
127200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     DPKCS036
127300                 = SPACE                                          DPKCS036
127400             EVALUATE TRUE                                        DPKCS036
127500                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       DPKCS036
127600                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSDPKCS036
127700                     MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
127800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
127900                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
128000                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    DPKCS036
128100                     MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
128200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
128300                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
128400                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      DPKCS036
128500                     MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
128600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
128700             END-EVALUATE                                         DPKCS036
128800         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
128900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
129000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
129100             END-IF                                               DPKCS036
129200             PERFORM 3310-EDIT-RANGE                              DPKCS036
129300         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
129400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
129500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
129600             END-IF                                               DPKCS036
129700             PERFORM 3310-EDIT-RANGE                              DPKCS036
129800         WHEN OTHER                                               DPKCS036
129900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           DPKCS036
130000             SET DP020-MSG-FATAL    TO TRUE                       DPKCS036
130100             MOVE -1                TO MR-SELECTL (PV-SUB)        DPKCS036
130200             SET DP030-SET-CURSOR-APPL-1                          DPKCS036
130300                                    TO TRUE                       DPKCS036
130400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        DPKCS036
130500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        DPKCS036
130600             SET PS-ERROR TO TRUE                                 DPKCS036
130700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
130800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     DPKCS036
130900                 MOVE SPACE         TO ASC-SELECTED-SW            DPKCS036
131000                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
131100             END-IF                                               DPKCS036
131200     END-EVALUATE.                                                DPKCS036
131300                                                                  DPKCS036
131400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 DPKCS036
131500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               DPKCS036
131600     IF  ASC-ITEM-SUB < 1                                         DPKCS036
131700         SUBTRACT +1 FROM ASC-BLK-SUB                             DPKCS036
131800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                DPKCS036
131900     END-IF.                                                      DPKCS036
132000                                                                  DPKCS036
132100 EJECT                                                            DPKCS036
132200*----------------------------------------------------------------*DPKCS036
132300*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *DPKCS036
132400*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *DPKCS036
132500*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *DPKCS036
132600*  THE ENDING.                                                   *DPKCS036
132700*----------------------------------------------------------------*DPKCS036
132800 3310-EDIT-RANGE.                                                 DPKCS036
132900                                                                  DPKCS036
133000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                DPKCS036
133100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   DPKCS036
133200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
133300                                   TO ASC-SELECTED-SW             DPKCS036
133400                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
133500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE DPKCS036
133600         ELSE                                                     DPKCS036
133700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     DPKCS036
133800                 CONTINUE                                         DPKCS036
133900             ELSE                                                 DPKCS036
134000*--------------- ONLY ONE BEGINNING-OF-RANGE-ALLOWED ---          DPKCS036
134100                 MOVE PC-TSYMSG-00054                             DPKCS036
134200                                   TO DP020-MSG-NUMBER            DPKCS036
134300                 SET DP020-MSG-FATAL                              DPKCS036
134400                                   TO TRUE                        DPKCS036
134500                 MOVE -1           TO MR-SELECTL (PV-SUB)         DPKCS036
134600                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
134700                                   TO TRUE                        DPKCS036
134800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         DPKCS036
134900                 MOVE DP015-UNDERLINE                             DPKCS036
135000                                   TO MR-SELECTH (PV-SUB)         DPKCS036
135100                 SET PS-ERROR      TO TRUE                        DPKCS036
135200             END-IF                                               DPKCS036
135300         END-IF                                                   DPKCS036
135400     ELSE                                                         DPKCS036
135500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     DPKCS036
135600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
135700                                   TO ASC-SELECTED-SW             DPKCS036
135800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   DPKCS036
135900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   DPKCS036
136000         ELSE                                                     DPKCS036
136100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       DPKCS036
136200                 CONTINUE                                         DPKCS036
136300             ELSE                                                 DPKCS036
136400*--------------- ONLY ONE END-OF-RANGE ALLOWED -------            DPKCS036
136500                 MOVE PC-TSYMSG-00055                             DPKCS036
136600                                   TO DP020-MSG-NUMBER            DPKCS036
136700                 SET DP020-MSG-FATAL                              DPKCS036
136800                                   TO TRUE                        DPKCS036
136900                 MOVE -1           TO MR-SELECTL (PV-SUB)         DPKCS036
137000                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
137100                                   TO TRUE                        DPKCS036
137200                 SET PS-ERROR      TO TRUE                        DPKCS036
137300             END-IF                                               DPKCS036
137400         END-IF                                                   DPKCS036
137500     END-IF.                                                      DPKCS036
137600                                                                  DPKCS036
137700 EJECT                                                            DPKCS036
137800*----------------------------------------------------------------*DPKCS036
137900*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *DPKCS036
138000*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *DPKCS036
138100*----------------------------------------------------------------*DPKCS036
138200 3400-CHECK-RANGE-SEQUENCE.                                       DPKCS036
138300                                                                  DPKCS036
138400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       DPKCS036
138500       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      DPKCS036
138600       AND  ASC-START-OF-SELECTED-RANGE >                         DPKCS036
138700                                         ASC-END-OF-SELECTED-RANGEDPKCS036
138800*------- END-OF-RANGE BEFORE BEGINNING-OF-RANGE--                 DPKCS036
138900         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 DPKCS036
139000         SET DP020-MSG-FATAL TO TRUE                              DPKCS036
139100         SET PS-ERROR TO TRUE                                     DPKCS036
139200         PERFORM 3410-POSITION-AT-ERROR                           DPKCS036
139300     END-IF.                                                      DPKCS036
139400                                                                  DPKCS036
139500 EJECT                                                            DPKCS036
139600*----------------------------------------------------------------*DPKCS036
139700*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *DPKCS036
139800*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *DPKCS036
139900*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *DPKCS036
140000*----------------------------------------------------------------*DPKCS036
140100 3410-POSITION-AT-ERROR.                                          DPKCS036
140200                                                                  DPKCS036
140300     SET DP030-SET-CURSOR-APPL-1                                  DPKCS036
140400                                   TO TRUE.                       DPKCS036
140500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 DPKCS036
140600                    - PV-TOP-ITEM + 1.                            DPKCS036
140700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
140800         CONTINUE                                                 DPKCS036
140900     ELSE                                                         DPKCS036
141000         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
141100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
141200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         DPKCS036
141300     END-IF.                                                      DPKCS036
141400*                                                                 DPKCS036
141500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   DPKCS036
141600                    - PV-TOP-ITEM + 1.                            DPKCS036
141700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
141800         CONTINUE                                                 DPKCS036
141900     ELSE                                                         DPKCS036
142000         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
142100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
142200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         DPKCS036
142300     END-IF.                                                      DPKCS036
142400                                                                  DPKCS036
142500 EJECT                                                            DPKCS036
142600*----------------------------------------------------------------*DPKCS036
142700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *DPKCS036
142800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *DPKCS036
142900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *DPKCS036
143000*----------------------------------------------------------------*DPKCS036
143100 3500-MARK-RANGE-AS-SELECTED.                                     DPKCS036
143200                                                                  DPKCS036
143300     MOVE +1                       TO  ASC-BLK-SUB.               DPKCS036
143400     PERFORM 3510-MARK-SELECTED-INDS                              DPKCS036
143500         VARYING ASC-ITEM-SUB                                     DPKCS036
143600         FROM 1 BY 1                                              DPKCS036
143700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
143800                                                                  DPKCS036
143900     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
144000     PERFORM 3510-MARK-SELECTED-INDS                              DPKCS036
144100         VARYING ASC-ITEM-SUB                                     DPKCS036
144200         FROM 1 BY 1                                              DPKCS036
144300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
144400                                                                  DPKCS036
144500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
144600                                   TO  PV-LIST-ITEM-NUMBER.       DPKCS036
144700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
144800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         DPKCS036
144900               PC-ITEMS-PER-PANEL).                               DPKCS036
145000                                                                  DPKCS036
145100     MOVE ASC-START-OF-SELECTED-RANGE                             DPKCS036
145200                                   TO PV-START-OF-SELECTED-RANGE. DPKCS036
145300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            DPKCS036
145400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  DPKCS036
145500               PC-ITEMS-PER-PANEL).                               DPKCS036
145600                                                                  DPKCS036
145700     MOVE ASC-END-OF-SELECTED-RANGE                               DPKCS036
145800                                   TO  PV-END-OF-SELECTED-RANGE.  DPKCS036
145900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             DPKCS036
146000         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    DPKCS036
146100               PC-ITEMS-PER-PANEL).                               DPKCS036
146200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             DPKCS036
146300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             DPKCS036
146400                                                                  DPKCS036
146500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    DPKCS036
146600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        DPKCS036
146700         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
146800         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
146900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
147000             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
147100                                                                  DPKCS036
147200         PERFORM                                                  DPKCS036
147300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      DPKCS036
147400                   PV-PREV-BLOCK-IN-ARRAY                         DPKCS036
147500             MOVE PV-FIRST-BLOCK-IN-RANGE                         DPKCS036
147600                                   TO PV-BLOCK-NUMBER             DPKCS036
147700             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
147800             PERFORM 3510-MARK-SELECTED-INDS                      DPKCS036
147900                 VARYING ASC-ITEM-SUB                             DPKCS036
148000                 FROM 1 BY 1                                      DPKCS036
148100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
148200             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
148300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     DPKCS036
148400         END-PERFORM                                              DPKCS036
148500                                                                  DPKCS036
148600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
148700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
148800         PERFORM                                                  DPKCS036
148900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
149000                   PV-LAST-BLOCK-IN-RANGE                         DPKCS036
149100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
149200                                   TO PV-BLOCK-NUMBER             DPKCS036
149300             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
149400             PERFORM 3510-MARK-SELECTED-INDS                      DPKCS036
149500                 VARYING ASC-ITEM-SUB                             DPKCS036
149600                 FROM 1 BY 1                                      DPKCS036
149700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
149800             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
149900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
150000         END-PERFORM                                              DPKCS036
150100                                                                  DPKCS036
150200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
150300                                   TO PV-BLOCK-NUMBER             DPKCS036
150400         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
150500     END-IF.                                                      DPKCS036
150600                                                                  DPKCS036
150700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE DPKCS036
150800                                      ASC-END-OF-SELECTED-RANGE.  DPKCS036
150900                                                                  DPKCS036
151000 EJECT                                                            DPKCS036
151100*----------------------------------------------------------------*DPKCS036
151200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *DPKCS036
151300*----------------------------------------------------------------*DPKCS036
151400 3510-MARK-SELECTED-INDS.                                         DPKCS036
151500                                                                  DPKCS036
151600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         DPKCS036
151700                                ASC-ITEM-SUB) >                   DPKCS036
151800         ASC-START-OF-SELECTED-RANGE)                             DPKCS036
151900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         DPKCS036
152000                                ASC-ITEM-SUB) =                   DPKCS036
152100         ASC-START-OF-SELECTED-RANGE)                             DPKCS036
152200                                                                  DPKCS036
152300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     DPKCS036
152400                                    ASC-ITEM-SUB) <               DPKCS036
152500             ASC-END-OF-SELECTED-RANGE)                           DPKCS036
152600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     DPKCS036
152700                                    ASC-ITEM-SUB) =               DPKCS036
152800             ASC-END-OF-SELECTED-RANGE)                           DPKCS036
152900                                                                  DPKCS036
153000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
153100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   DPKCS036
153200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   DPKCS036
153300                               TO TRUE                            DPKCS036
153400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              DPKCS036
153500                               TO TRUE                            DPKCS036
153600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
153700             END-IF                                               DPKCS036
153800         END-IF                                                   DPKCS036
153900     END-IF.                                                      DPKCS036
154000                                                                  DPKCS036
154100 EJECT                                                            DPKCS036
154200*----------------------------------------------------------------*DPKCS036
154300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *DPKCS036
154400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *DPKCS036
154500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *DPKCS036
154600*    DISPLAY THE PANEL TO USER.                                  *DPKCS036
154700*----------------------------------------------------------------*DPKCS036
154800 4000-BUILD-INITIAL-PANEL.                                        DPKCS036
154900                                                                  DPKCS036
155000     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             DPKCS036
155010                                ASC-BLOCK-ENTRIES (2)             DPKCS036
155100                                ASC-TOT-UNITS                     DPKCS036
155110                                ASC-TOT-CARTONS.                          
155200     MOVE +1                 TO ASC-BLK-SUB.                      DPKCS036
155300     SET ASC-ITEMS-LEFT-ON-DB                                     DPKCS036
155400                             TO TRUE.                             DPKCS036
155500                                                                  DPKCS036
155600     MOVE +0                 TO ASC-ITEM-SUB                      DPKCS036
155700                                ASC-NUMBER-OF-ITEMS-READ          DPKCS036
155800                                ASC-NUMBER-OF-SELECTED-ITEMS      DPKCS036
155900                                ASC-HIGHEST-BLOCK-WRITTEN         DPKCS036
156000                                ASC-START-OF-SELECTED-RANGE       DPKCS036
156100                                ASC-END-OF-SELECTED-RANGE         DPKCS036
156200                                ASC-ITEM-AT-TOP-OF-PANEL.         DPKCS036
156300     PERFORM 4010-OPEN-CURSOR.                                    DPKCS036
156400                                                                  DPKCS036
156500     PERFORM 4300-READ-ITEMS-FROM-DB.                             DPKCS036
156600                                                                  DPKCS036
156700     PERFORM 4020-CLOSE-CURSOR.                                   DPKCS036
156800                                                                  DPKCS036
156900     MOVE +1                   TO  PV-TOP-ITEM.                   DPKCS036
157000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          DPKCS036
157100         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    DPKCS036
157200         SET DP020-MSG-FATAL   TO  TRUE                           DPKCS036
157300*------- PURCHASE ORDER DOES NOT EXIST -----                              
157400         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               DPKCS036
157500     ELSE                                                         DPKCS036
157600         MOVE -1               TO MR-SELECTL (1)                  DPKCS036
157700         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
157800                               TO TRUE                            DPKCS036
157900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     DPKCS036
158000     END-IF.                                                      DPKCS036
158100                                                                  DPKCS036
158200 EJECT                                                            DPKCS036
158300*----------------------------------------------------------------*DPKCS036
158400*   OPEN THE VESSEL CURSOR                                       *DPKCS036
158500*----------------------------------------------------------------*DPKCS036
158600 4010-OPEN-CURSOR.                                                DPKCS036
158700                                                                  DPKCS036
158800     PERFORM                                                      DPKCS036
158900         WITH TEST AFTER                                          DPKCS036
159000         VARYING PV-RETRY-COUNTER                                 DPKCS036
159100         FROM 1 BY 1                                              DPKCS036
159200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               DPKCS036
159300                   OR (SQLCODE = ZERO))                           DPKCS036
159400*                                                                 DPKCS036
159500         MOVE 'CURSOR:  VSL-CSR' TO DP013-MESSAGE-TEXT (2)        DPKCS036
159600                                                                  DPKCS036
159700         EXEC SQL                                                 DPKCS036
159800              OPEN VSL-CSR                                        DPKCS036
159900         END-EXEC                                                 DPKCS036
160000*                                                                 DPKCS036
160100         EVALUATE TRUE                                            DPKCS036
160200             WHEN SQLCODE = ZERO                                  DPKCS036
160300             WHEN SQLCODE = -904                                  DPKCS036
160400             WHEN SQLCODE = -913                                  DPKCS036
160500                 CONTINUE                                         DPKCS036
160600             WHEN SQLWARN0 NOT = SPACES                           DPKCS036
160700             WHEN SQLCODE < ZERO                                  DPKCS036
160800             WHEN SQLCODE > ZERO                                  DPKCS036
160900                 MOVE '4010-OPEN-CURSOR'                          DPKCS036
161000                                   TO DP013-PARAGRAPH             DPKCS036
161100                 MOVE 'OPEN VESSEL CURSOR - '                     DPKCS036
161200                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
161300                 MOVE SQLCA        TO DP013-SQLCA                 DPKCS036
161400                 MOVE 'TIMCNTK '   TO DP013-DB2-TABLE-NAME (1)    DPKCS036
161500                 SET DP013-DB2-ABEND                              DPKCS036
161600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           DPKCS036
161700                 PERFORM DP013-0000-PROCESS-ABEND                 DPKCS036
161800         END-EVALUATE                                             DPKCS036
161900     END-PERFORM.                                                 DPKCS036
162000*                                                                 DPKCS036
162100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        DPKCS036
162200         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             DPKCS036
162300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   DPKCS036
162400                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
162500         MOVE SQLCA                TO DP013-SQLCA                 DPKCS036
162600         MOVE 'TIMCNTK '           TO DP013-DB2-TABLE-NAME (1)    DPKCS036
162700         SET DP013-DB2-ABEND                                      DPKCS036
162800             DP013-XCTL-DISPLAY-RESTART                           DPKCS036
162900                                   TO TRUE                        DPKCS036
163000         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
163100     END-IF.                                                      DPKCS036
163200                                                                  DPKCS036
163300 EJECT                                                            DPKCS036
163400*----------------------------------------------------------------*DPKCS036
163500*   CLOSE THE VESSEL CURSOR.                                     *DPKCS036
163600*----------------------------------------------------------------*DPKCS036
163700 4020-CLOSE-CURSOR.                                               DPKCS036
163800                                                                  DPKCS036
163900     EXEC SQL                                                     DPKCS036
164000          CLOSE VSL-CSR                                           DPKCS036
164100     END-EXEC.                                                    DPKCS036
164200*                                                                 DPKCS036
164300     EVALUATE TRUE                                                DPKCS036
164400         WHEN SQLCODE = ZERO                                      DPKCS036
164500             CONTINUE                                             DPKCS036
164600         WHEN SQLWARN0 NOT = SPACES                               DPKCS036
164700         WHEN SQLCODE < ZERO                                      DPKCS036
164800         WHEN SQLCODE > ZERO                                      DPKCS036
164900             MOVE '4020-CLOSE-CURSOR'                             DPKCS036
165000                               TO DP013-PARAGRAPH                 DPKCS036
165100             MOVE 'CLOSE VESSEL CURSOR '                          DPKCS036
165200                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
165300             MOVE SQLCA        TO DP013-SQLCA                     DPKCS036
165400             MOVE 'TIMCNTK '   TO DP013-DB2-TABLE-NAME (1)        DPKCS036
165500             SET DP013-DB2-ABEND                                  DPKCS036
165600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               DPKCS036
165700             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
165800     END-EVALUATE.                                                DPKCS036
165900                                                                  DPKCS036
166000 EJECT                                                            DPKCS036
166100*----------------------------------------------------------------*DPKCS036
166200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *DPKCS036
166300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *DPKCS036
166400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *DPKCS036
166500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *DPKCS036
166600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *DPKCS036
166700*                                                                *DPKCS036
166800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *DPKCS036
166900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *DPKCS036
167000*    UPON INITIALIZATION.                                        *DPKCS036
167100*----------------------------------------------------------------*DPKCS036
167200 4300-READ-ITEMS-FROM-DB.                                         DPKCS036
167300                                                                  DPKCS036
167400     PERFORM                                                      DPKCS036
167500         VARYING PV-READ-COUNT                                    DPKCS036
167600         FROM 1 BY 1                                              DPKCS036
167700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    DPKCS036
167800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         DPKCS036
167900                                                                  DPKCS036
168000         PERFORM 4310-FETCH                                       DPKCS036
168100                                                                  DPKCS036
168200         IF  ASC-ITEMS-LEFT-ON-DB                                 DPKCS036
168300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                DPKCS036
168400                 ADD +1            TO ASC-ITEM-SUB                DPKCS036
168500             ELSE                                                 DPKCS036
168600                 ADD +1            TO ASC-BLK-SUB                 DPKCS036
168700                 MOVE +1           TO ASC-ITEM-SUB                DPKCS036
168800                                                                  DPKCS036
168900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         DPKCS036
169000                     MOVE +1       TO ASC-BLK-SUB                 DPKCS036
169100                     SET ASC-BLOCK-MODIFIED (1)                   DPKCS036
169200                                   TO TRUE                        DPKCS036
169300                     PERFORM 5100-WRITE-TEMP-STORAGE              DPKCS036
169400                     MOVE ASC-BLOCK-ENTRIES                       DPKCS036
169500                               (PC-MAX-BLOCKS-IN-ARRAY)           DPKCS036
169600                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) DPKCS036
169700                     ADD +1        TO ASC-BLK-SUB                 DPKCS036
169800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   DPKCS036
169900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      DPKCS036
170000                                   TO  TRUE                       DPKCS036
170100                 END-IF                                           DPKCS036
170200             END-IF                                               DPKCS036
170300             ADD +1                TO  ASC-NUMBER-OF-ITEMS-READ   DPKCS036
170400             MOVE ASC-NUMBER-OF-ITEMS-READ                        DPKCS036
170500                                   TO  ASC-LIST-ITEM-NUMBER       DPKCS036
170600                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
170700             MOVE IMCNTK-MOM-IMPRT-TRIP-ID                                
170800                                   TO  PV-TRIP-ID                         
170900                                       ASC-VOY-NO                         
171000                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
171100             MOVE IMCNTK-MOM-TRIP-TYP-CDE                         DPKCS036
171200                                   TO  ASC-TRIP-CDE               DPKCS036
171300                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
171400             PERFORM 4340-FOB-CDE-CHECK                                   
171500             PERFORM 4350-POE-CDE-CHECK                                   
171600*                                                                 DPKCS036
172901                                                                          
172902             MOVE IMCNTK-MOM-DPRTR-TMST (1:10) TO PV-ATD                  
172904             IF IMCNTK-FDR-DPRTR-TMST (1:10)                              
172905                                   =   SPACES OR PC-INIT-DATE             
172906                IF IMCNTK-MOM-DPRTR-TMST (1:10)                           
172907                                   =   SPACES OR PC-INIT-DATE             
172908                   MOVE SPACES  TO  ASC-ATD                               
172909                                   (ASC-BLK-SUB ASC-ITEM-SUB)             
172912                ELSE                                                      
172913                    STRING  IMCNTK-MOM-DPRTR-TMST(6:2) '/'                
172914                            IMCNTK-MOM-DPRTR-TMST(9:2)                    
172915                            DELIMITED BY SIZE                             
172916                                       INTO ASC-ATD                       
172917                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
172920                END-IF                                                    
172921             ELSE                                                         
172922                STRING  IMCNTK-FDR-DPRTR-TMST(6:2) '/'                    
172923                        IMCNTK-FDR-DPRTR-TMST(9:2)                        
172924                        DELIMITED BY SIZE                                 
172925                                   INTO ASC-ATD                           
172926                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
172994             END-IF                                                       
173000*                                                                         
173100             MOVE IMCNTK-MOM-POE-DELY-TMST (1:10)                         
173200                                   TO  PV-ETA                             
173300             IF IMCNTK-MOM-POE-DELY-TMST (1:10)                           
173400                                   =   SPACES OR PC-INIT-DATE             
173500                MOVE SPACES        TO  ASC-ETA                            
173600                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
173700             ELSE                                                         
173800                STRING  IMCNTK-MOM-POE-DELY-TMST(6:2) '/'                 
173900                        IMCNTK-MOM-POE-DELY-TMST(9:2)                     
174000                        DELIMITED BY SIZE                                 
174100                                   INTO ASC-ETA                           
174200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
174300             END-IF                                                       
174400*                                                                         
174500             MOVE IMCNPO-PO-RCVD-DELY-TMST (1:10) TO PV-FOB               
174501                                                                          
174502             IF IMCNPO-PO-RCVD-DELY-TMST (1:10)                           
174600                                   =   SPACES OR PC-INIT-DATE             
174700                MOVE SPACES        TO  ASC-FOB-DT                         
174800                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
174900             ELSE                                                         
175000                STRING  IMCNPO-PO-RCVD-DELY-TMST(6:2) '/'                 
175100                        IMCNPO-PO-RCVD-DELY-TMST(9:2)                     
175200                        DELIMITED BY SIZE                                 
175300                                   INTO ASC-FOB-DT                        
175400                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
175500             END-IF                                                       
175501*                                                                         
175502             MOVE IMCNTK-ACTL-POE-DELY-TMST (1:10) TO PV-ATA              
175503                                                                          
175504             IF IMCNTK-ACTL-POE-DELY-TMST (1:10)                          
175505                                   =   SPACES OR PC-INIT-DATE             
175506                MOVE SPACES        TO  ASC-ATA                            
175507                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
175508             ELSE                                                         
175509                STRING IMCNTK-ACTL-POE-DELY-TMST (6:2) '/'                
175510                       IMCNTK-ACTL-POE-DELY-TMST (9:2)                    
175511                        DELIMITED BY SIZE                                 
175512                                   INTO ASC-ATA                           
175513                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
175514             END-IF                                                       
175700*            MOVE SPACES           TO  ASC-ATA                            
175800*                                      (ASC-BLK-SUB ASC-ITEM-SUB)         
175900             PERFORM 4390-SELECT-VSL-NAME                                 
176000             PERFORM 4395-SELECT-UNT-CNT                                  
176100         END-IF                                                   DPKCS036
176200     END-PERFORM.                                                 DPKCS036
176300                                                                  DPKCS036
176400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          DPKCS036
176500         MOVE +1               TO ASC-BLK-SUB                     DPKCS036
176600         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
176700         ADD +1                TO ASC-BLK-SUB                     DPKCS036
176800         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
176900                                                                  DPKCS036
177000         MOVE 1                TO ASC-BLK-SUB                     DPKCS036
177100                                  PV-BLOCK-NUMBER                 DPKCS036
177200         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
177300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             DPKCS036
177400             MOVE 2            TO ASC-BLK-SUB                     DPKCS036
177500                                  PV-BLOCK-NUMBER                 DPKCS036
177600             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
177700         END-IF                                                   DPKCS036
177800     END-IF.                                                      DPKCS036
177900                                                                  DPKCS036
178000 EJECT                                                            DPKCS036
178100*----------------------------------------------------------------*DPKCS036
178200*    FETCH THE VESSEL CURSOR.                                    *DPKCS036
178300*----------------------------------------------------------------*DPKCS036
178400 4310-FETCH.                                                      DPKCS036
178500                                                                  DPKCS036
178600     EXEC SQL                                                     DPKCS036
178700          FETCH  VSL-CSR                                          DPKCS036
178800          INTO  :IMCNTK-MOM-IMPRT-TRIP-ID                         DPKCS036
178900              , :IMCNTK-MOM-TRIP-TYP-CDE                          DPKCS036
179000              , :IMCNTK-FDR-TRIP-TYP-CDE                          DPKCS036
179100              , :IMCNTK-FDR-FOB-CDE                               DPKCS036
179200              , :IMCNTK-MOM-FOB-CDE                               DPKCS036
179300              , :IMCNTK-FDR-DPRTR-TMST                            DPKCS036
179400              , :IMCNTK-MOM-DPRTR-TMST                            DPKCS036
179500              , :IMCNTK-MOM-DEST-POE-CDE                          DPKCS036
179600              , :IMCNTK-MOM-POE-DELY-TMST                         DPKCS036
179610              , :IMCNTK-ACTL-POE-DELY-TMST                                
179700              , :IMCNPO-PO-RCVD-DELY-TMST                         DPKCS036
179800*--------------- PROVISION FOR ATA FROM CUSTOMS LOAD              DPKCS036
179900     END-EXEC.                                                    DPKCS036
180000*                                                                 DPKCS036
180100     EVALUATE TRUE                                                DPKCS036
180200         WHEN SQLCODE = ZERO                                      DPKCS036
180300         WHEN SQLCODE = +100                                      DPKCS036
180400              CONTINUE                                            DPKCS036
180500         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
180600         WHEN SQLCODE NOT = ZERO                                  DPKCS036
180700              MOVE '4310-FETCH-CURSOR'                            DPKCS036
180800                               TO DP013-PARAGRAPH                 DPKCS036
180900              MOVE 'FETCH VESSEL CURSOR'                          DPKCS036
181000                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
181100              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
181200              SET DP013-DB2-ABEND                                 DPKCS036
181300                               TO TRUE                            DPKCS036
181400              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
181500     END-EVALUATE.                                                DPKCS036
181600*                                                                 DPKCS036
181700     IF  SQLCODE EQUAL +100                                       DPKCS036
181800         SET ASC-NO-ITEMS-LEFT-ON-DB                              DPKCS036
181900                                   TO TRUE                        DPKCS036
182000     END-IF.                                                      DPKCS036
182100                                                                  DPKCS036
182200 EJECT                                                            DPKCS036
182300*----------------------------------------------------------------*DPKCS036
182400*        FORMAT THE DB2 DATE TO MM/DD/YY.                        *DPKCS036
182500*----------------------------------------------------------------*DPKCS036
182600 4320-FORMAT-DATE.                                                DPKCS036
182700                                                                  DPKCS036
182800     MOVE PV-DB-MM          TO  PV-DD-MM.                         DPKCS036
182900     MOVE PV-DB-DD          TO  PV-DD-DD.                         DPKCS036
183000     MOVE PV-DB-YY          TO  PV-DD-YY.                         DPKCS036
183100                                                                  DPKCS036
183200 EJECT                                                            DPKCS036
183300*----------------------------------------------------------------*        
183400*   CHECK FOR TRIP-TYPE-CODE AND MOVE FOB CODE                   *        
183500*----------------------------------------------------------------*        
183600 4340-FOB-CDE-CHECK.                                                      
183700                                                                          
183800     EVALUATE TRUE                                                        
183900          WHEN  ((IMCNTK-FDR-TRIP-TYP-CDE  = 'A') OR                      
184000                (IMCNTK-MOM-TRIP-TYP-CDE  = 'A'))                         
184100                IF IMCNTK-FDR-FOB-CDE = SPACES                            
184200                   MOVE IMCNTK-MOM-FOB-CDE TO ASC-FOB                     
184300                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
184400                ELSE                                                      
184500                   MOVE IMCNTK-FDR-FOB-CDE TO ASC-FOB                     
184600                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
184700                END-IF                                                    
184800                                                                          
184900          WHEN  ((IMCNTK-FDR-TRIP-TYP-CDE  = 'O' OR 'M') OR               
185000                (IMCNTK-MOM-TRIP-TYP-CDE  = 'O' OR 'M'))                  
185100                IF IMCNTK-FDR-FOB-CDE = SPACES                            
185200                   PERFORM 4360-SELECT-MOM-FOB-CDE                        
185300                ELSE                                                      
185400                   PERFORM 4370-SELECT-FDR-FOB-CDE                        
185500                END-IF                                                    
185600                MOVE IMFOB-FOB-CDE      TO ASC-FOB                        
185700                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
185800                                                                          
185900          WHEN  OTHER                                                     
186000                MOVE SPACES             TO ASC-FOB                        
186100                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
186200     END-EVALUATE.                                                        
186300                                                                          
186400 EJECT                                                                    
186500*----------------------------------------------------------------*        
186600*   CHECK FOR TRIP-TYPE-CODE AND MOVE POE CODE                   *        
186700*----------------------------------------------------------------*        
186800 4350-POE-CDE-CHECK.                                                      
186900                                                                          
187000     EVALUATE TRUE                                                        
187501          WHEN  IMCNTK-MOM-TRIP-TYP-CDE  = 'O' OR 'M' OR 'A'              
187502                PERFORM 4380-OPEN-POE-CURSOR                              
187503                PERFORM 4384-FETCH-POE-CURSOR                             
187504                PERFORM 4382-CLOSE-POE-CURSOR                             
187505                MOVE IMPOE-POE-CDE      TO ASC-POE                        
187506                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
187510                                                                          
188100          WHEN  OTHER                                                     
188200                MOVE SPACES             TO ASC-POE                        
188300                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
188400     END-EVALUATE.                                                        
188500                                                                          
188600 EJECT                                                                    
188700*----------------------------------------------------------------*        
188800*      SELECT MOM FOB CODE FROM TIMFOB                           *        
188900*----------------------------------------------------------------*        
189000 4360-SELECT-MOM-FOB-CDE.                                                 
189100                                                                          
189200     EXEC SQL                                                             
189300         SELECT DISTINCT                                                  
189400                A.FOB_CDE                                                 
189500         INTO  :IMFOB-FOB-CDE                                             
189600         FROM   TIMFOB A                                                  
189700         WHERE  A.FOB_STD_EDI_CDE = :IMCNTK-MOM-FOB-CDE                   
189800           AND  A.STAT_CDE        = 'A'                                   
189900     END-EXEC.                                                            
190000*                                                                         
190100     EVALUATE TRUE                                                        
190200         WHEN SQLCODE = ZERO                                              
190300              CONTINUE                                                    
190400         WHEN SQLCODE = +100                                              
190500         WHEN SQLCODE = -811                                              
190600              MOVE SPACES          TO IMFOB-FOB-CDE                       
190700         WHEN SQLWARN0 NOT = SPACE                                        
190800         WHEN SQLCODE NOT = ZERO                                          
190900              MOVE '4360-SELECT-MOM-FOB-CDE'                              
191000                               TO DP013-PARAGRAPH                         
191100              MOVE 'SQL ERROR SELECTING MOM FOB CODE'                     
191200                               TO DP013-MESSAGE-TEXT (1)                  
191300              MOVE SQLCA       TO DP013-SQLCA                             
191400              SET DP013-DB2-ABEND                                         
191500                               TO TRUE                                    
191600              PERFORM DP013-0000-PROCESS-ABEND                            
191700     END-EVALUATE.                                                        
191800                                                                          
191900 EJECT                                                                    
192000*----------------------------------------------------------------*        
192100*      SELECT FDR FOB CODE FROM TIMFOB                           *        
192200*----------------------------------------------------------------*        
192300 4370-SELECT-FDR-FOB-CDE.                                                 
192400                                                                          
192500     EXEC SQL                                                             
192600         SELECT DISTINCT                                                  
192700                A.FOB_CDE                                                 
192800         INTO  :IMFOB-FOB-CDE                                             
192900         FROM   TIMFOB A                                                  
193000         WHERE  A.FOB_STD_EDI_CDE = :IMCNTK-FDR-FOB-CDE                   
193100           AND  A.STAT_CDE        = 'A'                                   
193200     END-EXEC.                                                            
193300*                                                                         
193400     EVALUATE TRUE                                                        
193500         WHEN SQLCODE = ZERO                                              
193600              CONTINUE                                                    
193700         WHEN SQLCODE = +100                                              
193800         WHEN SQLCODE = -811                                              
193900              MOVE SPACES          TO IMFOB-FOB-CDE                       
194000         WHEN SQLWARN0 NOT = SPACE                                        
194100         WHEN SQLCODE NOT = ZERO                                          
194200              MOVE '4370-SELECT-FDR-FOB-CDE'                              
194300                               TO DP013-PARAGRAPH                         
194400              MOVE 'SQL ERROR SELECTING FDR FOB CODE'                     
194500                               TO DP013-MESSAGE-TEXT (1)                  
194600              MOVE SQLCA       TO DP013-SQLCA                             
194700              SET DP013-DB2-ABEND                                         
194800                               TO TRUE                                    
194900              PERFORM DP013-0000-PROCESS-ABEND                            
195000     END-EVALUATE.                                                        
195100                                                                          
195200 EJECT                                                                    
195201*----------------------------------------------------------------*        
195202*   OPEN THE POE CODE CURSOR                                     *        
195203*----------------------------------------------------------------*        
195204 4380-OPEN-POE-CURSOR.                                                    
195205                                                                          
195206     PERFORM                                                              
195207         WITH TEST AFTER                                                  
195208         VARYING PV-RETRY-COUNTER                                         
195209         FROM 1 BY 1                                                      
195210         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
195211                   OR (SQLCODE = ZERO))                                   
195212                                                                          
195213         MOVE 'CURSOR:  POE-CSR'     TO DP013-MESSAGE-TEXT (2)            
195214                                                                          
195215         EXEC SQL                                                         
195216              OPEN POE-CSR                                                
195217         END-EXEC                                                         
195218                                                                          
195219         EVALUATE TRUE                                                    
195220             WHEN SQLCODE = ZERO                                          
195221             WHEN SQLCODE = -904                                          
195222             WHEN SQLCODE = -913                                          
195223                 CONTINUE                                                 
195224             WHEN SQLWARN0 NOT = SPACES                                   
195225             WHEN SQLCODE < ZERO                                          
195226             WHEN SQLCODE > ZERO                                          
195227                 MOVE '4380-OPEN-POE-CURSOR'                              
195228                                   TO DP013-PARAGRAPH                     
195229                 MOVE 'OPEN POE CURSOR - '                                
195230                                   TO DP013-MESSAGE-TEXT (1)              
195231                 MOVE SQLCA        TO DP013-SQLCA                         
195232                 MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)            
195233                 SET DP013-DB2-ABEND                                      
195234                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
195235                 PERFORM DP013-0000-PROCESS-ABEND                         
195236         END-EVALUATE                                                     
195237     END-PERFORM.                                                         
195238*                                                                         
195239     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
195240         MOVE '4382-OPEN-POE-CURSOR' TO DP013-PARAGRAPH                   
195241         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
195242                                   TO DP013-MESSAGE-TEXT (1)              
195243         MOVE SQLCA                TO DP013-SQLCA                         
195244         MOVE 'TIMPOE  '           TO DP013-DB2-TABLE-NAME (1)            
195245         SET DP013-DB2-ABEND                                              
195246             DP013-XCTL-DISPLAY-RESTART                                   
195247                                   TO TRUE                                
195248         PERFORM DP013-0000-PROCESS-ABEND                                 
195249     END-IF.                                                              
195250                                                                          
195251 EJECT                                                                    
195252*----------------------------------------------------------------*        
195253*   CLOSE THE POE CODE CURSOR                                    *        
195254*----------------------------------------------------------------*        
195255 4382-CLOSE-POE-CURSOR.                                                   
195256                                                                          
195257     EXEC SQL                                                             
195258          CLOSE POE-CSR                                                   
195259     END-EXEC.                                                            
195260                                                                          
195261     EVALUATE TRUE                                                        
195262         WHEN SQLCODE = ZERO                                              
195263             CONTINUE                                                     
195264         WHEN SQLWARN0 NOT = SPACES                                       
195265         WHEN SQLCODE < ZERO                                              
195266         WHEN SQLCODE > ZERO                                              
195267             MOVE '4382-CLOSE-POE-CURSOR'                                 
195268                               TO DP013-PARAGRAPH                         
195269             MOVE 'CLOSE POE CURSOR '                                     
195270                               TO DP013-MESSAGE-TEXT (1)                  
195271             MOVE SQLCA        TO DP013-SQLCA                             
195272             MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)                
195273             SET DP013-DB2-ABEND                                          
195274                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
195275             PERFORM DP013-0000-PROCESS-ABEND                             
195276     END-EVALUATE.                                                        
195277                                                                          
195278 EJECT                                                                    
195279*----------------------------------------------------------------*11340099
195280*    FETCH THE POE CODE CURSOR                                   *11350099
195281*----------------------------------------------------------------*11360099
195282 4384-FETCH-POE-CURSOR.                                           11370099
195283                                                                  11380099
195284     EXEC SQL                                                     11390099
195285          FETCH POE-CSR                                           11400099
195286          INTO  :IMPOE-POE-CDE                                    11410099
195287     END-EXEC.                                                    11520099
195288                                                                  11530099
195289     EVALUATE TRUE                                                11540099
195290         WHEN SQLCODE = ZERO                                      11550099
195291         WHEN SQLCODE = -811                                              
195292              CONTINUE                                            11570099
195293         WHEN SQLCODE = +100                                      11560099
195294              MOVE SPACES TO IMPOE-POE-CDE                                
195295         WHEN SQLWARN0 NOT = SPACE                                11580099
195296         WHEN SQLCODE NOT = ZERO                                  11590099
195297              MOVE '4384-FETCH-POE-CURSOR'                        11600099
195298                               TO DP013-PARAGRAPH                 11610099
195299              MOVE 'FETCH POE CURSOR'                             11620099
195300                               TO DP013-MESSAGE-TEXT (1)          11630099
195301              MOVE SQLCA       TO DP013-SQLCA                     11640099
195302              SET DP013-DB2-ABEND                                 11650099
195303                               TO TRUE                            11660099
195304              PERFORM DP013-0000-PROCESS-ABEND                    11670099
195305     END-EVALUATE.                                                11680099
195310                                                                  11690099
195400 EJECT                                                            11750099
198400*----------------------------------------------------------------*        
198500*      SELECT VESSEL NAME FROM TIMCNTK                           *        
198600*----------------------------------------------------------------*        
198700 4390-SELECT-VSL-NAME.                                                    
198800                                                                          
198900     PERFORM                                                              
199000         WITH TEST AFTER                                                  
199100         VARYING PV-RETRY-COUNTER                                         
199200         FROM 1 BY 1                                                      
199300         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                        
199400             OR (SQLCODE = +0) OR (SQLCODE = -811)                        
199500             OR (SQLCODE = +100)                                          
199600                                                                          
199700         EXEC SQL                                                         
199800            SELECT MIN (B.MOM_IMPRT_VEH_NM)                               
199900            INTO  :PV-VSL-NAME                                            
200000            FROM   TIMCNPO A                                              
200100               ,   TIMCNTK B                                              
200200            WHERE  PO_NBR                    = :DK-PO-NBR                 
200300              AND  A.CONTNR_ID               =  B.CONTNR_ID               
200400              AND  A.CONTNR_SEQ_NBR          =  B.CONTNR_SEQ_NBR          
200500              AND  B.MOM_IMPRT_TRIP_ID       = :PV-TRIP-ID                
200600              AND  DATE(B.MOM_DPRTR_TMST)    = :PV-ATD                    
200700              AND  DATE(B.MOM_POE_DELY_TMST) = :PV-ETA                    
200800         END-EXEC                                                         
200900*                                                                         
201000         EVALUATE TRUE                                                    
201100             WHEN SQLCODE = +100                                          
201200                   MOVE SPACES         TO ASC-VSL-NAME                    
201300                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
201400             WHEN SQLCODE = -811                                          
201500             WHEN SQLCODE = +0                                            
201600                   MOVE PV-VSL-NAME    TO ASC-VSL-NAME                    
201700                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
201800             WHEN SQLCODE = -904                                          
201900             WHEN SQLCODE = -913                                          
202000                  CONTINUE                                                
202100                                                                          
202200             WHEN SQLWARN0 NOT = SPACES                                   
202300             WHEN SQLCODE < +0                                            
202400             WHEN SQLCODE > +0                                            
202500                  MOVE '4390-SELECT-VSL-NAME'                             
202600                                  TO DP013-PARAGRAPH                      
202700                  MOVE 'SQL ERROR SELECTING VESSEL NAME'                  
202800                                  TO DP013-MESSAGE-TEXT (1)               
202900                  MOVE SQLCA      TO DP013-SQLCA                          
203000                  MOVE 'TIMCNTK' TO DP013-DB2-TABLE-NAME (1)              
203100                  SET DP013-DB2-ABEND                                     
203200                      DP013-XCTL-DISPLAY-RESTART                          
203300                                  TO TRUE                                 
203400                  PERFORM DP013-0000-PROCESS-ABEND                        
203500         END-EVALUATE                                                     
203600     END-PERFORM.                                                         
203700                                                                          
203800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
203900         MOVE '4390-SELECT-VSL-NAME'                                      
204000                                  TO DP013-PARAGRAPH                      
204100         MOVE 'MAX RETRIES EXCEEDED ON SELECT VESSEL NAME'                
204200                                  TO DP013-MESSAGE-TEXT (1)               
204300         MOVE SQLCA               TO DP013-SQLCA                          
204400         MOVE 'TIMCNTK '          TO DP013-DB2-TABLE-NAME (1)             
204500         SET DP013-DB2-ABEND                                              
204600             DP013-XCTL-DISPLAY-RESTART                                   
204700                                  TO TRUE                                 
204800         PERFORM DP013-0000-PROCESS-ABEND                                 
204900     END-IF.                                                              
205000 EJECT                                                                    
205100*----------------------------------------------------------------*        
205200*      SELECT UNIT AND CARTON COUNT FROM TIMCNPO/TIMCNTK         *        
205300*----------------------------------------------------------------*        
205400 4395-SELECT-UNT-CNT.                                                     
205500                                                                          
205600     PERFORM                                                              
205700         WITH TEST AFTER                                                  
205800         VARYING PV-RETRY-COUNTER                                         
205900         FROM 1 BY 1                                                      
206000         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                        
206100             OR (SQLCODE = +0) OR (SQLCODE = -811)                        
206200             OR (SQLCODE = +100) OR (SQLCODE = -304)                      
206300                                                                          
206400         EXEC SQL                                                         
206500            SELECT SUM (A.PO_CART_CNT),                                   
206600                   SUM (A.PO_UNT_QTY)                                     
206700            INTO  :PV-CART-CNT,                                           
206800                  :PV-UNIT-CNT                                            
206900            FROM   TIMCNPO A                                              
207000               ,   TIMCNTK B                                              
207100            WHERE  PO_NBR                    = :DK-PO-NBR                 
207200              AND  A.CONTNR_ID               =  B.CONTNR_ID               
207300              AND  A.CONTNR_SEQ_NBR          =  B.CONTNR_SEQ_NBR          
207400              AND  B.MOM_IMPRT_TRIP_ID       = :PV-TRIP-ID                
207500              AND  DATE(B.MOM_DPRTR_TMST)    = :PV-ATD                    
207600              AND  DATE(B.MOM_POE_DELY_TMST) = :PV-ETA                    
207610              AND  DATE(A.PO_RCVD_DELY_TMST) = :PV-FOB                    
207700         END-EXEC                                                         
207800*                                                                         
207900         EVALUATE TRUE                                                    
208000             WHEN SQLCODE = +100                                          
208100             WHEN SQLCODE = -304                                          
208200                   MOVE 0              TO ASC-UNTS                        
208300                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
208400                   MOVE 0              TO ASC-CNTS                        
208500                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
208600             WHEN SQLCODE = -811                                          
208700             WHEN SQLCODE = +0                                            
208800                   MOVE PV-CART-CNT    TO ASC-CNTS                        
208900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
208910                   ADD PV-CART-CNT     TO ASC-TOT-CARTONS                 
209000                   MOVE PV-UNIT-CNT    TO ASC-UNTS                        
209100                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
209110                   ADD PV-UNIT-CNT     TO ASC-TOT-UNITS                   
209200             WHEN SQLCODE = -904                                          
209300             WHEN SQLCODE = -913                                          
209400                  CONTINUE                                                
209500                                                                          
209600             WHEN SQLWARN0 NOT = SPACES                                   
209700             WHEN SQLCODE < +0                                            
209800             WHEN SQLCODE > +0                                            
209900                  MOVE '4395-SELECT-UNT-CNT'                              
210000                                  TO DP013-PARAGRAPH                      
210100                  MOVE 'SQL ERROR SELECTING UNTS/CNTS SUMS'               
210200                                  TO DP013-MESSAGE-TEXT (1)               
210300                  MOVE SQLCA      TO DP013-SQLCA                          
210400                  MOVE 'TIMCNTK' TO DP013-DB2-TABLE-NAME (1)              
210500                  SET DP013-DB2-ABEND                                     
210600                      DP013-XCTL-DISPLAY-RESTART                          
210700                                  TO TRUE                                 
210800                  PERFORM DP013-0000-PROCESS-ABEND                        
210900         END-EVALUATE                                                     
211000     END-PERFORM.                                                         
211100                                                                          
211200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
211300         MOVE '4395-SELECT-UNT-CNT'                                       
211400                                  TO DP013-PARAGRAPH                      
211500         MOVE 'MAX RETRIES EXCEEDED ON SELECT UNTS/CNTS SUM'              
211600                                  TO DP013-MESSAGE-TEXT (1)               
211700         MOVE SQLCA               TO DP013-SQLCA                          
211800         MOVE 'TIMCNTK '          TO DP013-DB2-TABLE-NAME (1)             
211900         SET DP013-DB2-ABEND                                              
212000             DP013-XCTL-DISPLAY-RESTART                                   
212100                                  TO TRUE                                 
212200         PERFORM DP013-0000-PROCESS-ABEND                                 
212300     END-IF.                                                              
212400*----------------------------------------------------------------*DPKCS036
212500*    MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.  *DPKCS036
212600*----------------------------------------------------------------*DPKCS036
212700 4400-MOVE-COMMAREA-TO-SCREEN.                                    DPKCS036
212800                                                                  DPKCS036
212900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             DPKCS036
213000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          DPKCS036
213100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          DPKCS036
213200             MOVE +1    TO ASC-BLK-SUB                            DPKCS036
213300             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
213400             ADD +1     TO ASC-BLK-SUB                            DPKCS036
213500             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
213600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             DPKCS036
213700                 GIVING PV-BLOCK-NUMBER                           DPKCS036
213800                 REMAINDER PV-REMAINDER                           DPKCS036
213900             IF  PV-REMAINDER > ZERO                              DPKCS036
214000                 ADD +1 TO PV-BLOCK-NUMBER                        DPKCS036
214100             END-IF                                               DPKCS036
214200             MOVE +1    TO ASC-BLK-SUB                            DPKCS036
214300             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
214400             ADD +1     TO ASC-BLK-SUB                            DPKCS036
214500                           PV-BLOCK-NUMBER                        DPKCS036
214600             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
214700     END-IF.                                                      DPKCS036
214800     MOVE +1            TO ASC-BLK-SUB.                           DPKCS036
214900     COMPUTE ASC-ITEM-SUB =                                       DPKCS036
215000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              DPKCS036
215100         + PC-ITEMS-PER-PANEL).                                   DPKCS036
215200*                                                                 DPKCS036
215300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
215400         ADD +1         TO ASC-BLK-SUB                            DPKCS036
215500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
215600     END-IF.                                                      DPKCS036
215700*                                                                 DPKCS036
215800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           DPKCS036
215900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                DPKCS036
216000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        DPKCS036
216100     PERFORM 4420-FORMAT-LIST-LINES                               DPKCS036
216200         VARYING PV-SUB                                           DPKCS036
216300         FROM PC-ITEMS-PER-PANEL BY -1                            DPKCS036
216400         UNTIL PV-SUB < +1.                                       DPKCS036
216500*                                                                 DPKCS036
216600     COMPUTE ASC-ITEMS-DISPLAYED =                                DPKCS036
216700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          DPKCS036
216800     PERFORM 4401-SELECT-PO-DETAILS.                              DPKCS036
216900     PERFORM 4402-SELECT-AD-DTE.                                          
217000     PERFORM 4403-SELECT-VND-STYL.                                        
217100     PERFORM 4404-OPEN-OUTR-PCK-CSR.                                      
217200     PERFORM 4405-FETCH-OUTR-PCK.                                         
217300     PERFORM 4406-CLOSE-OUTR-PCK-CSR.                                     
217400     PERFORM 4407-MOVE-PO-DTLS-TO-SCR.                            DPKCS036
217500*                                                                 DPKCS036
217600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
217700                                      ASTRTITO.                   DPKCS036
217800     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    DPKCS036
217900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    DPKCS036
218000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            DPKCS036
218100                                   TO ASELITO.                    DPKCS036
218101     MOVE ASC-TOT-CARTONS          TO ATOTCNTO.                   16620099
218110     MOVE ASC-TOT-UNITS            TO ATOTUNTO.                   16620099
218200*                                                                 DPKCS036
218300     IF  DP020-MSG-NUMBER-X = SPACE                               DPKCS036
218400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  DPKCS036
218500*----------- MORE ITEMS TO DISPLAY ----                           DPKCS036
218600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            DPKCS036
218700             SET DP020-MSG-INFORMATIONAL TO TRUE                  DPKCS036
218800         END-IF                                                   DPKCS036
218900     END-IF.                                                      DPKCS036
219000                                                                  DPKCS036
219100 EJECT                                                            DPKCS036
219200*----------------------------------------------------------------*DPKCS036
219300*    SELECT PO DETAILS.                                          *DPKCS036
219400*----------------------------------------------------------------*DPKCS036
219500 4401-SELECT-PO-DETAILS.                                          DPKCS036
219600                                                                  DPKCS036
219700     PERFORM                                                              
219800         WITH TEST AFTER                                                  
219900         VARYING PV-RETRY-COUNTER                                         
220000         FROM 1 BY 1                                                      
220100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
220200            OR  (SQLCODE = ZERO)                                          
220300            OR  (SQLCODE = +100))                                         
220400                                                                          
220500         EXEC SQL                                                         
220600              SELECT A.DEPT_NBR,                                          
220700                     A.OTB_PER_NBR,                                       
220800                     A.TOT_UNT_QTY,                                       
220810                     A.PROD_CNTRY_CDE,                                    
220900                     B.ENT_NAME_DESC,                                     
221000                     C.CAN_IFNOT_SHIP_DTE,                                
221100                     C.EXT_CAN_DTE,                                       
221200                     C.STRT_FCTRY_DTE,                                    
221300                     C.LAST_FCTRY_DTE,                                    
221400                     C.DONT_SHIP_BEF_DTE,                                 
221500                     C.FOB_CDE,                                           
221600                     C.POE_CDE                                            
221700              INTO  :PURCHS-DEPT-NBR,                                     
221800                    :PURCHS-OTB-PER-NBR,                                  
221900                    :PURCHS-TOT-UNT-QTY,                                  
221910                    :PURCHS-PROD-CNTRY-CDE,                               
222000                    :ENTNME-ENT-NAME-DESC,                                
222100                    :PLNSHP-CAN-IFNOT-SHIP-DTE,                           
222200                    :PLNSHP-EXT-CAN-DTE,                                  
222300                    :PLNSHP-STRT-FCTRY-DTE,                               
222400                    :PLNSHP-LAST-FCTRY-DTE,                               
222500                    :PLNSHP-DONT-SHIP-BEF-DTE,                            
222600                    :PLNSHP-FOB-CDE,                                      
222700                    :PLNSHP-POE-CDE                                       
222800              FROM   TPURCHS A,                                           
222900                     TENTNME B,                                           
223000                     TPLNSHP C                                            
223100              WHERE  A.PO_NBR         = :DK-PO-NBR                        
223200                AND  A.VER_STATUS_CDE = 'A'                               
223300                AND  B.ENT_ID         =  A.ENT_ID                         
223400                AND  B.TYPE_CDE       = '01'                              
223500                AND  C.PO_NBR         =  A.PO_NBR                         
223600                AND  C.VER_STATUS_CDE =  A.VER_STATUS_CDE                 
223700         END-EXEC                                                         
223800*                                                                         
223900         EVALUATE TRUE                                                    
224000             WHEN SQLCODE = ZERO                                          
224100             WHEN SQLCODE = +100                                          
224200             WHEN SQLCODE = -904                                          
224300             WHEN SQLCODE = -913                                          
224400                 CONTINUE                                                 
224500             WHEN SQLWARN0 NOT = SPACES                                   
224600             WHEN SQLCODE < ZERO                                          
224700             WHEN SQLCODE > ZERO                                          
224800                 MOVE '4401-SELECT-PO-DETAILS'                            
224900                                   TO DP013-PARAGRAPH                     
225000                 MOVE 'SQL ERROR SELECTING PO DETAILS'                    
225100                                   TO DP013-MESSAGE-TEXT (1)              
225200                 MOVE SQLCA        TO DP013-SQLCA                         
225300                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)            
225400                 SET DP013-DB2-ABEND                                      
225500                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
225600                 PERFORM DP013-0000-PROCESS-ABEND                         
225700         END-EVALUATE                                                     
225800     END-PERFORM.                                                         
225900*                                                                         
226000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
226100         MOVE '4401-SELECT-PO-DETAILS'    TO DP013-PARAGRAPH              
226200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'          
226300                                   TO DP013-MESSAGE-TEXT (1)              
226400         MOVE SQLCA                TO DP013-SQLCA                         
226500         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)            
226600         SET DP013-DB2-ABEND                                              
226700             DP013-XCTL-DISPLAY-RESTART                                   
226800                                   TO TRUE                                
226900         PERFORM DP013-0000-PROCESS-ABEND                                 
227000     END-IF.                                                              
227100                                                                  DPKCS036
227200 EJECT                                                            DPKCS036
227300*----------------------------------------------------------------*        
227400*    SELECT AD DATE FROM TPURITM                                 *        
227500*----------------------------------------------------------------*        
227600 4402-SELECT-AD-DTE.                                                      
227700                                                                          
227800     PERFORM                                                              
227900         WITH TEST AFTER                                                  
228000         VARYING PV-RETRY-COUNTER                                         
228100         FROM 1 BY 1                                                      
228200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
228300            OR  (SQLCODE = ZERO)                                          
228400            OR  (SQLCODE = +100))                                         
228500                                                                          
228600         EXEC SQL                                                         
228700              SELECT                                                      
228800                     MIN(AD_EVNT_DTE)                                     
228900              INTO  :PURITM-AD-EVNT-DTE :PV-AD-DTE-IND                    
229000              FROM   TPURITM                                              
229100              WHERE  PO_NBR         = :DK-PO-NBR                          
229200                AND  VER_STATUS_CDE = 'A'                                 
229300                AND  AD_EVNT_DTE   ^= '0001-01-01'                        
229400         END-EXEC                                                         
229500*                                                                         
229600         EVALUATE TRUE                                                    
229700             WHEN SQLCODE = ZERO                                          
229800             WHEN SQLCODE = +100                                          
229900             WHEN SQLCODE = -904                                          
230000             WHEN SQLCODE = -913                                          
230100                  CONTINUE                                                
230200             WHEN SQLWARN0 NOT = SPACE                                    
230300             WHEN SQLCODE NOT = ZERO                                      
230400                  MOVE '4402-SELECT-AD-DTE'                               
230500                                   TO DP013-PARAGRAPH                     
230600                  MOVE 'SQL ERROR SELECTING AD DATE'                      
230700                                   TO DP013-MESSAGE-TEXT (1)              
230800                  MOVE SQLCA       TO DP013-SQLCA                         
230900                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)            
231000                  SET DP013-DB2-ABEND                                     
231100                      DP013-XCTL-DISPLAY-RESTART TO TRUE                  
231200                  PERFORM DP013-0000-PROCESS-ABEND                        
231300         END-EVALUATE                                                     
231400     END-PERFORM.                                                         
231500*                                                                         
231600     IF SQLCODE EQUAL + 0                                                 
231700        MOVE PURITM-AD-EVNT-DTE    TO PV-DATE-BREAK                       
231800        PERFORM 4320-FORMAT-DATE                                          
231900        MOVE PV-DATE-DISPLAY       TO AADDTO                              
232000     ELSE                                                                 
232100        MOVE SPACES                TO AADDTO                              
232200     END-IF.                                                              
232300*                                                                         
232400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
232500         MOVE '4402-SELECT-AD-DTE' TO DP013-PARAGRAPH                     
232600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT AD-DA        
232700-             'TE'                 TO DP013-MESSAGE-TEXT (1)              
232800         MOVE SQLCA                TO DP013-SQLCA                         
232900         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)            
233000         SET DP013-DB2-ABEND                                              
233100             DP013-XCTL-DISPLAY-RESTART                                   
233200                                   TO TRUE                                
233300         PERFORM DP013-0000-PROCESS-ABEND                                 
233400     END-IF.                                                              
233500                                                                          
233600 EJECT                                                                    
233610*----------------------------------------------------------------*        
233620*     SELECT VENDOR STYLE NAME FROM XLT_VND_STYL TABLE           *        
233630*----------------------------------------------------------------*        
233640 4403-SELECT-VND-STYL.                                                    
233650                                                                          
233660     PERFORM                                                              
233670         WITH TEST AFTER                                                  
233680         VARYING PV-RETRY-COUNTER                                         
233690         FROM 1 BY 1                                                      
233691         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
233692            OR  (SQLCODE = ZERO)                                          
233693            OR  (SQLCODE = +100)                                          
233694            OR  (SQLCODE = -811))                                         
233695                                                                          
233696         EXEC SQL                                                         
233697              SELECT   DISTINCT                                           
233698                       VS_NBR                                             
233699                INTO   :XLT00004-VS-NBR                                   
233700                FROM   TPURITM A                                          
233701                   ,   XLT_SKU B                                          
233702                   ,   XLT_VND_STYL C                                     
233703               WHERE   A.PO_NBR       = :DK-PO-NBR                        
233704                 AND   A.VER_STATUS_CDE = 'A'                             
233705                 AND   A.ITM_NBR = B.ITM_NBR                              
233706                 AND   B.STYL_ID = C.STYL_ID                              
233707         END-EXEC                                                         
233708                                                                          
233709         EVALUATE TRUE                                                    
233710             WHEN SQLCODE = ZERO                                          
233711             WHEN SQLCODE = +100                                          
233712             WHEN SQLCODE = -811                                          
233713             WHEN SQLCODE = -904                                          
233714             WHEN SQLCODE = -913                                          
233715                 CONTINUE                                                 
233716             WHEN SQLWARN0 NOT = SPACES                                   
233717             WHEN SQLCODE < ZERO                                          
233718             WHEN SQLCODE > ZERO                                          
233719                 MOVE '4403-SELECT-VND-STYL'                              
233720                                     TO DP013-PARAGRAPH                   
233721                 MOVE 'SQL ERROR SELECTING VENDOR STYLE'                  
233722                                     TO DP013-MESSAGE-TEXT (1)            
233723                 MOVE SQLCA          TO DP013-SQLCA                       
233724                 MOVE 'XLT_VND_STYL' TO DP013-DB2-TABLE-NAME (1)          
233725                 SET DP013-DB2-ABEND                                      
233726                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
233727                 PERFORM DP013-0000-PROCESS-ABEND                         
233728         END-EVALUATE                                                     
233729     END-PERFORM.                                                         
233730*                                                                         
233731     IF  SQLCODE EQUAL +0                                                 
233732         MOVE XLT00004-VS-NBR       TO AVNDSTYO                           
233733     ELSE                                                                 
233734         IF  SQLCODE EQUAL -811                                           
233735             MOVE '*MULTIPLES*'     TO AVNDSTYO                           
233736         END-IF                                                           
233737     END-IF.                                                              
233738*                                                                         
233739     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
233740         MOVE '4403-SELECT-VND-STYL'    TO DP013-PARAGRAPH                
233741         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT VENDO        
233742-             'R STYLE'            TO DP013-MESSAGE-TEXT (1)              
233743         MOVE SQLCA                TO DP013-SQLCA                         
233744         MOVE 'XLT_VND_STYL'       TO DP013-DB2-TABLE-NAME (1)            
233745         SET DP013-DB2-ABEND                                              
233746             DP013-XCTL-DISPLAY-RESTART                                   
233747                                   TO TRUE                                
233748         PERFORM DP013-0000-PROCESS-ABEND                                 
233749     END-IF.                                                              
233750                                                                          
233751 EJECT                                                                    
240200*----------------------------------------------------------------*        
240300*    OPEN THE OUTER PACK CURSOR.                                 *        
240400*----------------------------------------------------------------*        
240500 4404-OPEN-OUTR-PCK-CSR.                                                  
240600                                                                  DPKCS036
240700     PERFORM                                                              
240800         WITH TEST AFTER                                                  
240900         VARYING PV-RETRY-COUNTER                                         
241000         FROM 1 BY 1                                                      
241100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
241200            OR  (SQLCODE = ZERO))                                         
241300*                                                                         
241400         MOVE 'CURSOR:  OUTR-PCK-CSR' TO DP013-MESSAGE-TEXT (2)           
241500                                                                          
241600         EXEC SQL                                                         
241700              OPEN OUTR-PCK-CSR                                           
241800         END-EXEC                                                         
241900*                                                                         
242000         EVALUATE TRUE                                                    
242100             WHEN SQLCODE = ZERO                                          
242200             WHEN SQLCODE = -904                                          
242300             WHEN SQLCODE = -913                                          
242400                 CONTINUE                                                 
242500             WHEN SQLWARN0 NOT = SPACES                                   
242600             WHEN SQLCODE < ZERO                                          
242700             WHEN SQLCODE > ZERO                                          
242800                 MOVE '4404-OPEN-OUTR-PCK-CSR'                            
242900                                   TO DP013-PARAGRAPH                     
243000                 MOVE 'OPEN OUTER-PACK CURSOR - '                         
243100                                   TO DP013-MESSAGE-TEXT (1)              
243200                 MOVE SQLCA        TO DP013-SQLCA                         
243300                 MOVE 'TUPC    '   TO DP013-DB2-TABLE-NAME (1)            
243400                 SET DP013-DB2-ABEND                                      
243500                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
243600                 PERFORM DP013-0000-PROCESS-ABEND                         
243700         END-EVALUATE                                                     
243800     END-PERFORM.                                                         
243900*                                                                         
244000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
244100         MOVE '4404-OPEN-OUTR-PCK-CSR'   TO DP013-PARAGRAPH               
244200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
244300                                   TO DP013-MESSAGE-TEXT (1)              
244400         MOVE SQLCA                TO DP013-SQLCA                         
244500         MOVE 'TUPC    '           TO DP013-DB2-TABLE-NAME (1)            
244600         SET DP013-DB2-ABEND                                              
244700             DP013-XCTL-DISPLAY-RESTART                                   
244800                                   TO TRUE                                
244900         PERFORM DP013-0000-PROCESS-ABEND                                 
245000     END-IF.                                                              
245100                                                                          
245200 EJECT                                                                    
245300*----------------------------------------------------------------*        
245400*    FETCH THE OUTER PACK QUANTITY.                              *        
245500*----------------------------------------------------------------*        
245600 4405-FETCH-OUTR-PCK.                                                     
245700                                                                          
245800     PERFORM                                                              
245900         WITH TEST AFTER                                                  
246000         VARYING PV-RETRY-COUNTER                                         
246100         FROM 1 BY 1                                                      
246200         UNTIL (SQLCODE = +100)                                           
246300                                                                          
246301         EXEC SQL                                                 07910099
246302              FETCH OUTR-PCK-CSR                                  07920099
246303              INTO  :PURITM-UNT-QTY                               07940099
246304                 ,  :PURITM-OUTR-PK-QTY                           07930099
246305         END-EXEC                                                 07950099
246900*                                                                         
247000         EVALUATE TRUE                                                    
247100             WHEN SQLCODE = ZERO                                          
247200             WHEN SQLCODE = +100                                          
247300                  CONTINUE                                                
247400             WHEN SQLWARN0 NOT = SPACE                                    
247500             WHEN SQLCODE NOT = ZERO                                      
247600                  MOVE '4405-FETCH-OUTR-PCK'                              
247700                                   TO DP013-PARAGRAPH                     
247800                  MOVE 'FETCH OUTER-PACK CURSOR'                          
247900                                   TO DP013-MESSAGE-TEXT (1)              
248000                  MOVE SQLCA       TO DP013-SQLCA                         
248100                  SET DP013-DB2-ABEND                                     
248200                                   TO TRUE                                
248300                  PERFORM DP013-0000-PROCESS-ABEND                        
248400         END-EVALUATE                                                     
248500*                                                                         
248600         IF  SQLCODE EQUAL +0                                             
248700             IF PURITM-OUTR-PK-QTY = 0                                    
248800                DIVIDE 1 INTO PURITM-UNT-QTY                              
248900                GIVING PV-ITEM-CART-CNT ROUNDED                           
249000             ELSE                                                         
249100                DIVIDE PURITM-OUTR-PK-QTY INTO PURITM-UNT-QTY             
249200                GIVING PV-ITEM-CART-CNT ROUNDED                           
249300             END-IF                                                       
249400             ADD PV-ITEM-CART-CNT TO PV-PO-CART-CNT                       
249500         END-IF                                                           
249600     END-PERFORM.                                                         
249700                                                                          
249800 EJECT                                                                    
249900*----------------------------------------------------------------*        
250000*    CLOSE THE OUTER PACK CURSOR                                 *        
250100*----------------------------------------------------------------*        
250200 4406-CLOSE-OUTR-PCK-CSR.                                                 
250300                                                                          
250400     EXEC SQL                                                             
250500          CLOSE OUTR-PCK-CSR                                              
250600     END-EXEC.                                                            
250700*                                                                         
250800     EVALUATE TRUE                                                        
250900         WHEN SQLCODE = ZERO                                              
251000             CONTINUE                                                     
251100         WHEN SQLWARN0 NOT = SPACES                                       
251200         WHEN SQLCODE < ZERO                                              
251300         WHEN SQLCODE > ZERO                                              
251400             MOVE '4406-CLOSE-OUTR-PCK-CSR'                               
251500                               TO DP013-PARAGRAPH                         
251600             MOVE 'CLOSE OUTER-PACK CURSOR '                              
251700                               TO DP013-MESSAGE-TEXT (1)                  
251800             MOVE SQLCA        TO DP013-SQLCA                             
251900             MOVE 'TUPC    '   TO DP013-DB2-TABLE-NAME (1)                
252000             SET DP013-DB2-ABEND                                          
252100                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
252200             PERFORM DP013-0000-PROCESS-ABEND                             
252300     END-EVALUATE.                                                        
252400                                                                          
252500 EJECT                                                                    
252600*----------------------------------------------------------------*DPKCS036
252700*    MOVE PO DETAILS TO SCREEN.                                  *DPKCS036
252800*----------------------------------------------------------------*DPKCS036
252900 4407-MOVE-PO-DTLS-TO-SCR.                                        DPKCS036
253000                                                                          
253100     MOVE ASC-KEY-PO-NBR            TO APONBRO.                   DPKCS036
253101     MOVE PURCHS-DEPT-NBR           TO PV-DEPT-NBR-N.                     
253102     MOVE PV-DEPT-NBR-N             TO ADEPTO.                    16560099
253300     MOVE PURCHS-OTB-PER-NBR        TO AOTBO.                     DPKCS036
253400     MOVE PURCHS-TOT-UNT-QTY        TO AUNTSO.                    DPKCS036
253410     MOVE PURCHS-PROD-CNTRY-CDE     TO ACNTRYO.                           
253500     MOVE ENTNME-ENT-NAME-DESC      TO AVNDNMEO.                  DPKCS036
253600     MOVE PLNSHP-FOB-CDE            TO AFOBPO.                    DPKCS036
253700     MOVE PLNSHP-POE-CDE            TO APOEO.                     DPKCS036
253800     MOVE PV-PO-CART-CNT            TO ACTNSO.                            
253900*                                                                         
254000     IF PLNSHP-CAN-IFNOT-SHIP-DTE   =  PC-INIT-DATE                       
254100        MOVE SPACES                 TO ACANDTO                            
254200     ELSE                                                                 
254300        MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                                    
254400                                    TO PV-DATE-BREAK                      
254500        PERFORM 4320-FORMAT-DATE                                          
254600        MOVE PV-DATE-DISPLAY        TO ACANDTO                            
254700     END-IF.                                                              
254800*                                                                         
254900     IF PLNSHP-EXT-CAN-DTE          =  PC-INIT-DATE                       
255000        MOVE SPACES                 TO AXCANDTO                           
255100     ELSE                                                                 
255200        MOVE PLNSHP-EXT-CAN-DTE     TO PV-DATE-BREAK                      
255300        PERFORM 4320-FORMAT-DATE                                          
255400        MOVE PV-DATE-DISPLAY        TO AXCANDTO                           
255500     END-IF.                                                              
255600*                                                                         
255700     IF PLNSHP-STRT-FCTRY-DTE       =  PC-INIT-DATE                       
255800        MOVE SPACES                 TO ASTXFDTO                           
255900     ELSE                                                                 
256000        MOVE PLNSHP-STRT-FCTRY-DTE  TO PV-DATE-BREAK                      
256100        PERFORM 4320-FORMAT-DATE                                          
256200        MOVE PV-DATE-DISPLAY        TO ASTXFDTO                           
256300     END-IF.                                                              
256400*                                                                         
256500     IF PLNSHP-LAST-FCTRY-DTE       =  PC-INIT-DATE                       
256600        MOVE SPACES                 TO ALTXFDTO                           
256700     ELSE                                                                 
256800        MOVE PLNSHP-LAST-FCTRY-DTE  TO PV-DATE-BREAK                      
256900        PERFORM 4320-FORMAT-DATE                                          
257000        MOVE PV-DATE-DISPLAY        TO ALTXFDTO                           
257100     END-IF.                                                              
257200*                                                                         
257300     IF PLNSHP-DONT-SHIP-BEF-DTE    =  PC-INIT-DATE                       
257400        MOVE SPACES                 TO ADSHBEFO                           
257500     ELSE                                                                 
257600        MOVE PLNSHP-DONT-SHIP-BEF-DTE                                     
257700                                    TO PV-DATE-BREAK                      
257800        PERFORM 4320-FORMAT-DATE                                          
257900        MOVE PV-DATE-DISPLAY        TO ADSHBEFO                           
258000     END-IF.                                                              
258100                                                                          
258200 EJECT                                                                    
258300*----------------------------------------------------------------*DPKCS036
258400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *DPKCS036
258500*----------------------------------------------------------------*DPKCS036
258600 4410-READ-TEMP-STORAGE.                                          DPKCS036
258700                                                                  DPKCS036
258800     EXEC CICS                                                    DPKCS036
258900         READQ TS                                                 DPKCS036
259000             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
259100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
259200             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
259300             RESP  (PV-CICS-RESP)                                 DPKCS036
259400     END-EXEC.                                                    DPKCS036
259500*                                                                 DPKCS036
259600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       DPKCS036
259700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     DPKCS036
259800         CONTINUE                                                 DPKCS036
259900     ELSE                                                         DPKCS036
260000         SET DP013-CICS-ABEND     TO TRUE                         DPKCS036
260100         SET DP013-NO-ROLLBACK    TO TRUE                         DPKCS036
260200         MOVE '4410-READ-TEMP-STORAGE'                            DPKCS036
260300                                  TO DP013-PARAGRAPH              DPKCS036
260400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      DPKCS036
260500                                  TO DP013-MESSAGE-TEXT(1)        DPKCS036
260600         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
260700     END-IF.                                                      DPKCS036
260800                                                                  DPKCS036
260900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
261000*                                                                 DPKCS036
261100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         DPKCS036
261200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               DPKCS036
261300     END-IF.                                                      DPKCS036
261400                                                                  DPKCS036
261500 EJECT                                                            DPKCS036
261600*----------------------------------------------------------------*DPKCS036
261700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *DPKCS036
261800*----------------------------------------------------------------*DPKCS036
261900 4420-FORMAT-LIST-LINES.                                          DPKCS036
262000                                                                  DPKCS036
262100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      DPKCS036
262200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                DPKCS036
262300         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA    (PV-SUB)        DPKCS036
262400         MOVE DP015-HL-OFF       TO MR-SELECTH    (PV-SUB)        DPKCS036
262500         MOVE SPACES             TO MR-SELECTI    (PV-SUB)        DPKCS036
262600         MOVE SPACES             TO MR-SELECTI    (PV-SUB)        DPKCS036
262700                                    MR-ACTION     (PV-SUB)        DPKCS036
262800                                    MR-VSL-NAME   (PV-SUB)        DPKCS036
262900                                    MR-TRIP-CDE   (PV-SUB)        DPKCS036
263000                                    MR-ATD        (PV-SUB)        DPKCS036
263100                                    MR-ETA        (PV-SUB)        DPKCS036
263200                                    MR-ATA        (PV-SUB)        DPKCS036
263300                                    MR-FOB        (PV-SUB)        DPKCS036
263400                                    MR-POE        (PV-SUB)        DPKCS036
263500                                    MR-FOB-DT     (PV-SUB)                
263600                                    MR-UNT-X      (PV-SUB)        DPKCS036
263700                                    MR-CNT-X      (PV-SUB)        DPKCS036
263800     ELSE                                                         DPKCS036
263900         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
264000                                                   > SPACE        DPKCS036
264100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
264200                                 TO MR-SELECTI (PV-SUB)           DPKCS036
264300         ELSE                                                     DPKCS036
264400             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
264500                                 TO MR-SELECTI (PV-SUB)           DPKCS036
264600         END-IF                                                   DPKCS036
264700*                                                                 DPKCS036
264800         IF  DP030-SET-CURSOR-TRAILER                             DPKCS036
264900             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
265000                 > SPACE)                                         DPKCS036
265100               OR (PV-SUB = 1))                                   DPKCS036
265200                SET DP030-SET-CURSOR-APPL-1 TO TRUE               DPKCS036
265300                MOVE -1          TO MR-SELECTL (PV-SUB)           DPKCS036
265400             END-IF                                               DPKCS036
265500         END-IF                                                   DPKCS036
265600*                                                                 DPKCS036
265700         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           DPKCS036
265800             MOVE ASC-ACTION   (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
265900                               TO MR-ACTION (PV-SUB)              DPKCS036
266000             MOVE ASC-VSL-NAME (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
266100                               TO MR-VSL-NAME (PV-SUB)            DPKCS036
266200             MOVE ASC-TRIP-CDE (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
266300                               TO MR-TRIP-CDE (PV-SUB)            DPKCS036
266400             MOVE ASC-ATD      (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
266500                               TO MR-ATD    (PV-SUB)              DPKCS036
266600             MOVE ASC-ETA      (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
266700                               TO MR-ETA    (PV-SUB)              DPKCS036
266800             MOVE ASC-ATA      (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
266900                               TO MR-ATA    (PV-SUB)              DPKCS036
267000             MOVE ASC-FOB      (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
267100                               TO MR-FOB    (PV-SUB)              DPKCS036
267200             MOVE ASC-POE      (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
267300                               TO MR-POE    (PV-SUB)              DPKCS036
267400             MOVE ASC-FOB-DT   (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
267500                               TO MR-FOB-DT (PV-SUB)              DPKCS036
267600             MOVE ASC-UNTS     (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
267700                               TO MR-UNT    (PV-SUB)              DPKCS036
267800             MOVE ASC-CNTS     (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
267900                               TO MR-CNT    (PV-SUB)              DPKCS036
268000         END-IF                                                   DPKCS036
268100     END-IF.                                                      DPKCS036
268200     SUBTRACT +1 FROM ASC-ITEM-SUB                                DPKCS036
268300     IF  ASC-ITEM-SUB < + 1                                       DPKCS036
268400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  DPKCS036
268500         MOVE +1                 TO ASC-BLK-SUB                   DPKCS036
268600     END-IF.                                                      DPKCS036
268700                                                                  DPKCS036
268800 EJECT                                                            DPKCS036
268900*----------------------------------------------------------------*DPKCS036
269000*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *DPKCS036
269100*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *DPKCS036
269200*  ISSUE A WARNING.                                              *DPKCS036
269300*----------------------------------------------------------------*DPKCS036
269400 4430-CHECK-FOR-BEGIN-AND-END.                                    DPKCS036
269500                                                                  DPKCS036
269600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       DPKCS036
269700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     DPKCS036
269800*----------- NO END-OF-RANGE SPECFIED ---                         DPKCS036
269900             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            DPKCS036
270000             SET DP020-MSG-WARNING TO TRUE                        DPKCS036
270100             PERFORM 4431-POSITION-AT-WARNING                     DPKCS036
270200         END-IF                                                   DPKCS036
270300     ELSE                                                         DPKCS036
270400         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     DPKCS036
270500*----------- NO BEGINNING-OF-RANGE SPECFIED ---                   DPKCS036
270600             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            DPKCS036
270700             SET DP020-MSG-WARNING TO TRUE                        DPKCS036
270800             PERFORM 4431-POSITION-AT-WARNING                     DPKCS036
270900         END-IF                                                   DPKCS036
271000     END-IF.                                                      DPKCS036
271100                                                                  DPKCS036
271200 EJECT                                                            DPKCS036
271300*----------------------------------------------------------------*DPKCS036
271400*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *DPKCS036
271500*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *DPKCS036
271600*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *DPKCS036
271700*  POSITION THE CURSOR THERE.                                    *DPKCS036
271800*----------------------------------------------------------------*DPKCS036
271900 4431-POSITION-AT-WARNING.                                        DPKCS036
272000                                                                  DPKCS036
272100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 DPKCS036
272200                    - PV-TOP-ITEM + 1.                            DPKCS036
272300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
272400         CONTINUE                                                 DPKCS036
272500     ELSE                                                         DPKCS036
272600         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
272700                                   TO TRUE                        DPKCS036
272800         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
272900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
273000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         DPKCS036
273100     END-IF.                                                      DPKCS036
273200*                                                                 DPKCS036
273300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   DPKCS036
273400                    - PV-TOP-ITEM + 1.                            DPKCS036
273500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
273600         CONTINUE                                                 DPKCS036
273700     ELSE                                                         DPKCS036
273800         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
273900                                   TO TRUE                        DPKCS036
274000         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
274100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
274200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         DPKCS036
274300     END-IF.                                                      DPKCS036
274400                                                                  DPKCS036
274500 EJECT                                                            DPKCS036
274600*----------------------------------------------------------------*DPKCS036
274700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *DPKCS036
274800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *DPKCS036
274900* FOR THE SELECTED ITEMS QUEUE.                                  *DPKCS036
275000*                                                                *DPKCS036
275100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *DPKCS036
275200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *DPKCS036
275300* THE ARRAY IS FULL.                                             *DPKCS036
275400*----------------------------------------------------------------*DPKCS036
275500 5000-PREPARE-SEL-QUEUE.                                          DPKCS036
275600                                                                  DPKCS036
275700     MOVE +1                   TO  ASC-BLK-SUB.                   DPKCS036
275800     PERFORM 5100-WRITE-TEMP-STORAGE.                             DPKCS036
275900     ADD +1                    TO  ASC-BLK-SUB.                   DPKCS036
276000     PERFORM 5100-WRITE-TEMP-STORAGE.                             DPKCS036
276100     MOVE ASC-SEL-QUEUE-NAME   TO  TR107-SEL-QUEUE-NAME.          DPKCS036
276200     PERFORM 6010-DELETE-SEL-QUEUE.                               DPKCS036
276300                                                                  DPKCS036
276400     SET ASC-UPDATE-TSQ        TO  TRUE.                          DPKCS036
276500                                                                  DPKCS036
276600     SET TR106-IDX             TO  1.                             DPKCS036
276700     MOVE ZERO                 TO TR107-NUMBER-OF-TS-ITEMS.       DPKCS036
276800     INITIALIZE TR106-SELECTED-ITEM-ARRAY.                        DPKCS036
276900                                                                  DPKCS036
277000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           DPKCS036
277100             VARYING PV-ITEM                                      DPKCS036
277200             FROM 1 BY 1                                          DPKCS036
277300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     DPKCS036
277400                                                                  DPKCS036
277500     IF  TR106-IDX > 1                                            DPKCS036
277600         PERFORM 5205-WRITE-SEL-QUEUE                             DPKCS036
277700         ADD +1                    TO TR107-NUMBER-OF-TS-ITEMS    DPKCS036
277800     END-IF.                                                      DPKCS036
277900                                                                  DPKCS036
278000 EJECT                                                            DPKCS036
278100*----------------------------------------------------------------*DPKCS036
278200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *DPKCS036
278300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *DPKCS036
278400*----------------------------------------------------------------*DPKCS036
278500 5100-WRITE-TEMP-STORAGE.                                         DPKCS036
278600                                                                  DPKCS036
278700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     DPKCS036
278800                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
278900     COMPUTE PV-BLOCK-NUMBER =                                    DPKCS036
279000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
279100                                                                  DPKCS036
279200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
279300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
279400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      DPKCS036
279500             PERFORM 5105-REWRITE-ASC-LISTQ                       DPKCS036
279600         END-IF                                                   DPKCS036
279700     ELSE                                                         DPKCS036
279800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       DPKCS036
279900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            DPKCS036
280000         PERFORM 5110-WRITE-ASC-LISTQ                             DPKCS036
280100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   DPKCS036
280200     END-IF.                                                      DPKCS036
280300                                                                  DPKCS036
280400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
280500                                                                  DPKCS036
280600 EJECT                                                            DPKCS036
280700*----------------------------------------------------------------*DPKCS036
280800*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *DPKCS036
280900*  SPECIFIC COMMAREA.                                            *DPKCS036
281000*----------------------------------------------------------------*DPKCS036
281100 5105-REWRITE-ASC-LISTQ.                                          DPKCS036
281200                                                                  DPKCS036
281300     EXEC CICS                                                    DPKCS036
281400         WRITEQ TS                                                DPKCS036
281500             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
281600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
281700             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
281800             REWRITE                                              DPKCS036
281900             RESP  (PV-CICS-RESP)                                 DPKCS036
282000     END-EXEC.                                                    DPKCS036
282100                                                                  DPKCS036
282200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           DPKCS036
282300         CONTINUE                                                 DPKCS036
282400     ELSE                                                         DPKCS036
282500         SET DP013-CICS-ABEND            TO TRUE                  DPKCS036
282600         SET DP013-NO-ROLLBACK           TO TRUE                  DPKCS036
282700         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       DPKCS036
282800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     DPKCS036
282900                                         TO DP013-MESSAGE-TEXT(1) DPKCS036
283000         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
283100     END-IF.                                                      DPKCS036
283200                                                                  DPKCS036
283300 EJECT                                                            DPKCS036
283400*----------------------------------------------------------------*DPKCS036
283500*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *DPKCS036
283600*  SPECIFIC COMMAREA.                                            *DPKCS036
283700*----------------------------------------------------------------*DPKCS036
283800 5110-WRITE-ASC-LISTQ.                                            DPKCS036
283900                                                                  DPKCS036
284000     EXEC CICS                                                    DPKCS036
284100         WRITEQ TS                                                DPKCS036
284200             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
284300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
284400             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
284500             RESP  (PV-CICS-RESP)                                 DPKCS036
284600     END-EXEC.                                                    DPKCS036
284700                                                                  DPKCS036
284800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      DPKCS036
284900         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
285000         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
285100         MOVE '5110-WRITE-ASC-LISTQ'                              DPKCS036
285200                                   TO DP013-PARAGRAPH             DPKCS036
285300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           DPKCS036
285400                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
285500         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
285600     END-IF.                                                      DPKCS036
285700                                                                  DPKCS036
285800 EJECT                                                            DPKCS036
285900*----------------------------------------------------------------*DPKCS036
286000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *DPKCS036
286100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *DPKCS036
286200*----------------------------------------------------------------*DPKCS036
286300 5200-FILL-SEL-QUEUE-RECORD.                                      DPKCS036
286400                                                                  DPKCS036
286500     PERFORM 6112-READ-LIST-QUEUE.                                DPKCS036
286600                                                                  DPKCS036
286700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       DPKCS036
286800         PERFORM                                                  DPKCS036
286900         VARYING LQW-IDX                                          DPKCS036
287000         FROM 1 BY 1                                              DPKCS036
287100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            DPKCS036
287200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          DPKCS036
287300                                                                  DPKCS036
287400             IF  LQW-SELECT (LQW-IDX)                             DPKCS036
287500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              DPKCS036
287600                                   TO TR106-ITEM (TR106-IDX)      DPKCS036
287700                 MOVE ASC-KEY-PO-NBR                              DPKCS036
287800                                   TO TR106-PO-NBR                DPKCS036
287900                                        (TR106-IDX)               DPKCS036
288000                 MOVE LQW-VSL-NAME (LQW-IDX)                              
288100                                   TO TR107-VSL-NAME                      
288200                                      TR106-VSL-NAME                      
288300                                        (TR106-IDX)                       
288400                 MOVE LQW-VOY-NO   (LQW-IDX)                              
288500                                   TO TR107-VOY-NO                        
288600                                      TR106-VOY-NO                        
288700                                        (TR106-IDX)                       
288800                 MOVE 'I'          TO TR106-ACTION-SW (TR106-IDX) DPKCS036
288900                 SET TR106-IDX UP BY 1                            DPKCS036
289000                 IF  TR106-IDX > TR106-MAX-ITEMS                  DPKCS036
289100                     PERFORM 5205-WRITE-SEL-QUEUE                 DPKCS036
289200                     ADD +1        TO TR107-NUMBER-OF-TS-ITEMS    DPKCS036
289300                     INITIALIZE TR106-SELECTED-ITEM-ARRAY         DPKCS036
289400                     SET TR106-IDX TO  1                          DPKCS036
289500                 END-IF                                           DPKCS036
289600             END-IF                                               DPKCS036
289700         END-PERFORM                                              DPKCS036
289800     END-IF.                                                      DPKCS036
289900                                                                  DPKCS036
290000 EJECT                                                            DPKCS036
290100*----------------------------------------------------------------*DPKCS036
290200*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *DPKCS036
290300*----------------------------------------------------------------*DPKCS036
290400 5205-WRITE-SEL-QUEUE.                                            DPKCS036
290500                                                                  DPKCS036
290600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            DPKCS036
290700                                   TO TR106-SELECTED-ITEMS.       DPKCS036
290800                                                                  DPKCS036
290900     EXEC CICS                                                    DPKCS036
291000          WRITEQ TS                                               DPKCS036
291100             QUEUE (ASC-SEL-QUEUE-NAME)                           DPKCS036
291200             FROM  (TR106-PO-SEL-REC)                             DPKCS036
291300             ITEM  (PV-SEL-QUEUE-ITEM)                            DPKCS036
291400             RESP  (PV-CICS-RESP)                                 DPKCS036
291500     END-EXEC.                                                    DPKCS036
291600                                                                  DPKCS036
291700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
291800         CONTINUE                                                 DPKCS036
291900     ELSE                                                         DPKCS036
292000         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
292100         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
292200         MOVE '5205-WRITE-SEL-QUEUE'                              DPKCS036
292300                                   TO DP013-PARAGRAPH             DPKCS036
292400         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          DPKCS036
292500                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
292600         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
292700     END-IF.                                                      DPKCS036
292800                                                                  DPKCS036
292900 EJECT                                                            DPKCS036
293000*----------------------------------------------------------------*DPKCS036
293100*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *DPKCS036
293200*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *DPKCS036
293300*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *DPKCS036
293400*  THE USER.                                                     *DPKCS036
293500*----------------------------------------------------------------*DPKCS036
293600 6000-REFRESH-PANEL-FROM-TEMP.                                    DPKCS036
293700                                                                  DPKCS036
293800     IF  ASC-UPDATE-TSQ                                           DPKCS036
293900         SET ASC-NO-TSQ-UPDATE TO TRUE                            DPKCS036
294000         MOVE ZERO                 TO PV-SAVE-ITEM                DPKCS036
294100                                      PV-SEL-QUEUE-ITEM           DPKCS036
294200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        DPKCS036
294300                                   TO PV-HOLD-SELECTED-ITEMS      DPKCS036
294400         MOVE +1                   TO PV-ITEMS-PROCESSED          DPKCS036
294500         PERFORM 6100-UPDATE-TSQ                                  DPKCS036
294600             UNTIL PV-ITEMS-PROCESSED >                           DPKCS036
294700                                     PV-HOLD-SELECTED-ITEMS       DPKCS036
294800         PERFORM 6010-DELETE-SEL-QUEUE                            DPKCS036
294900         INITIALIZE ASC-BLOCK-ENTRIES (1)                         DPKCS036
295000                    ASC-BLOCK-ENTRIES (2)                         DPKCS036
295100     END-IF.                                                      DPKCS036
295200                                                                  DPKCS036
295300 EJECT                                                            DPKCS036
295400*----------------------------------------------------------------*DPKCS036
295500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *DPKCS036
295600*----------------------------------------------------------------*DPKCS036
295700 6010-DELETE-SEL-QUEUE.                                           DPKCS036
295800                                                                  DPKCS036
295900     EXEC CICS                                                    DPKCS036
296000         DELETEQ TS                                               DPKCS036
296100             QUEUE (ASC-SEL-QUEUE-NAME)                           DPKCS036
296200             RESP  (PV-CICS-RESP)                                 DPKCS036
296300     END-EXEC.                                                    DPKCS036
296400*                                                                 DPKCS036
296500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      DPKCS036
296600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         DPKCS036
296700         CONTINUE                                                 DPKCS036
296800     ELSE                                                         DPKCS036
296900         SET DP013-CICS-ABEND TO TRUE                             DPKCS036
297000         SET DP013-NO-ROLLBACK TO TRUE                            DPKCS036
297100         MOVE '6010-DELETE-SEL-QUEUE'                             DPKCS036
297200                        TO DP013-PARAGRAPH                        DPKCS036
297300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         DPKCS036
297400                        TO DP013-MESSAGE-TEXT (1)                 DPKCS036
297500         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
297600     END-IF.                                                      DPKCS036
297700                                                                  DPKCS036
297800 EJECT                                                            DPKCS036
297900*----------------------------------------------------------------*DPKCS036
298000*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *DPKCS036
298100*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *DPKCS036
298200*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *DPKCS036
298300*    THE TEMP QUEUE.                                             *DPKCS036
298400*----------------------------------------------------------------*DPKCS036
298500 6100-UPDATE-TSQ.                                                 DPKCS036
298600                                                                  DPKCS036
298700     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             DPKCS036
298800     PERFORM 6105-READ-SEL-QUEUE.                                 DPKCS036
298900     PERFORM                                                      DPKCS036
299000         VARYING TR106-IDX                                        DPKCS036
299100         FROM 1 BY 1                                              DPKCS036
299200         UNTIL ((PV-ITEMS-PROCESSED >                             DPKCS036
299300                              PV-HOLD-SELECTED-ITEMS)             DPKCS036
299400         OR (TR106-IDX GREATER THAN TR106-MAX-ITEMS))             DPKCS036
299500         IF  TR106-ACTION-SW (TR106-IDX) > SPACE                  DPKCS036
299600             PERFORM 6110-PROCESS-ITEMS                           DPKCS036
299700         END-IF                                                   DPKCS036
299800         ADD +1                TO PV-ITEMS-PROCESSED              DPKCS036
299900     END-PERFORM.                                                 DPKCS036
300000     PERFORM 6111-WRITE-LIST-QUEUE.                               DPKCS036
300100                                                                  DPKCS036
300200 EJECT                                                            DPKCS036
300300*----------------------------------------------------------------*DPKCS036
300400*    READ THE LIST QUEUE RECORD.                                 *DPKCS036
300500*----------------------------------------------------------------*DPKCS036
300600 6105-READ-SEL-QUEUE.                                             DPKCS036
300700                                                                  DPKCS036
300800     EXEC CICS                                                    DPKCS036
300900          READQ TS                                                DPKCS036
301000             QUEUE (ASC-SEL-QUEUE-NAME)                           DPKCS036
301100             INTO  (TR106-PO-SEL-REC)                             DPKCS036
301200             ITEM  (PV-SEL-QUEUE-ITEM)                            DPKCS036
301300             RESP  (PV-CICS-RESP)                                 DPKCS036
301400     END-EXEC.                                                    DPKCS036
301500*                                                                 DPKCS036
301600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
301700         CONTINUE                                                 DPKCS036
301800     ELSE                                                         DPKCS036
301900         SET DP013-CICS-ABEND      TO  TRUE                       DPKCS036
302000         SET DP013-NO-ROLLBACK     TO  TRUE                       DPKCS036
302100         MOVE '6105-READ-SEL-QUEUE'                               DPKCS036
302200                                   TO  DP013-PARAGRAPH            DPKCS036
302300         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           DPKCS036
302400                                   TO  DP013-MESSAGE-TEXT(1)      DPKCS036
302500         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
302600     END-IF.                                                      DPKCS036
302700                                                                  DPKCS036
302800 EJECT                                                            DPKCS036
302900*----------------------------------------------------------------*DPKCS036
303000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*DPKCS036
303100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*DPKCS036
303200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *DPKCS036
303300*----------------------------------------------------------------*DPKCS036
303400 6110-PROCESS-ITEMS.                                              DPKCS036
303500                                                                  DPKCS036
303600     COMPUTE PV-ITEM = 1 + ((TR106-ITEM (TR106-IDX) - 1)          DPKCS036
303700                     / PC-ITEMS-PER-PANEL).                       DPKCS036
303800                                                                  DPKCS036
303900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           DPKCS036
304000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          DPKCS036
304100             PERFORM 6111-WRITE-LIST-QUEUE                        DPKCS036
304200         END-IF                                                   DPKCS036
304300         MOVE PV-ITEM          TO PV-SAVE-ITEM                    DPKCS036
304400                                                                  DPKCS036
304500         PERFORM 6112-READ-LIST-QUEUE                             DPKCS036
304600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               DPKCS036
304700             CONTINUE                                             DPKCS036
304800         END-IF                                                   DPKCS036
304900     END-IF.                                                      DPKCS036
305000                                                                  DPKCS036
305100     COMPUTE PV-SUB = (TR106-ITEM (TR106-IDX)                     DPKCS036
305200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              DPKCS036
305300     SET LQW-DESELECT (PV-SUB) TO    TRUE.                        DPKCS036
305400     MOVE LQW-SELECTED-SW (PV-SUB)                                DPKCS036
305500                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  DPKCS036
305600                                                                  DPKCS036
305700     IF TR106-INQ (TR106-IDX)                                     DPKCS036
305800        MOVE PC-INQ            TO LQW-ACTION (PV-SUB)             DPKCS036
305900     END-IF.                                                      DPKCS036
306000                                                                  DPKCS036
306100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                DPKCS036
306200                                                                  DPKCS036
306300 EJECT                                                            DPKCS036
306400*----------------------------------------------------------------*DPKCS036
306500*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *DPKCS036
306600*----------------------------------------------------------------*DPKCS036
306700 6111-WRITE-LIST-QUEUE.                                           DPKCS036
306800                                                                  DPKCS036
306900     EXEC CICS                                                    DPKCS036
307000         WRITEQ TS                                                DPKCS036
307100             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
307200             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     DPKCS036
307300             ITEM  (PV-SAVE-ITEM)                                 DPKCS036
307400             REWRITE                                              DPKCS036
307500             RESP  (PV-CICS-RESP)                                 DPKCS036
307600     END-EXEC.                                                    DPKCS036
307700*                                                                 DPKCS036
307800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
307900         CONTINUE                                                 DPKCS036
308000     ELSE                                                         DPKCS036
308100         SET DP013-CICS-ABEND  TO  TRUE                           DPKCS036
308200         SET DP013-NO-ROLLBACK TO  TRUE                           DPKCS036
308300         MOVE '6111-WRITE-LIST-QUEUE'                             DPKCS036
308400                               TO  DP013-PARAGRAPH                DPKCS036
308500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  DPKCS036
308600                               TO  DP013-MESSAGE-TEXT(1)          DPKCS036
308700         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
308800     END-IF.                                                      DPKCS036
308900                                                                  DPKCS036
309000 EJECT                                                            DPKCS036
309100*----------------------------------------------------------------*DPKCS036
309200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*DPKCS036
309300*----------------------------------------------------------------*DPKCS036
309400 6112-READ-LIST-QUEUE.                                            DPKCS036
309500                                                                  DPKCS036
309600     EXEC CICS                                                    DPKCS036
309700         READQ TS                                                 DPKCS036
309800             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
309900             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     DPKCS036
310000             ITEM  (PV-ITEM)                                      DPKCS036
310100             RESP  (PV-CICS-RESP)                                 DPKCS036
310200     END-EXEC.                                                    DPKCS036
310300*                                                                 DPKCS036
310400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
310500         CONTINUE                                                 DPKCS036
310600     ELSE                                                         DPKCS036
310700         SET DP013-CICS-ABEND        TO TRUE                      DPKCS036
310800         SET DP013-NO-ROLLBACK       TO TRUE                      DPKCS036
310900         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           DPKCS036
311000         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    DPKCS036
311100                                     TO DP013-MESSAGE-TEXT(1)     DPKCS036
311200         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
311300     END-IF.                                                      DPKCS036
311400                                                                  DPKCS036
311500 EJECT                                                            DPKCS036
311600*----------------------------------------------------------------*DPKCS036
311700*    ABEND PROCESSOR MODULE                                      *DPKCS036
311800*----------------------------------------------------------------*DPKCS036
311900                                                                  DPKCS036
312000     COPY DPPD013.                                                DPKCS036
