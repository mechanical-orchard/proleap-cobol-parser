000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT443.                                        00020000
000300 AUTHOR.         JEAN KURK.                                       00030000
000400 DATE-WRITTEN.   08/27/2021.                                      00040000
000500 DATE-COMPILED.                                                   00050000
000600*----------------------------------------------------------------*00060000
000700*    COBOL 2 WITH SQL                                            *00070000
000800*    ADD SEPHORA INDICATOR TO DAILY UNJOURNALIZED RECORDS FILE   *00080000
000900*                                                                *00090000
001400* INPUT:                                                         *00107000
001500*  1. DAILY UNJOURNALIZED RECS FILE      (APRD042)               *00108000
001800*                                                                *00123000
001900* OUTPUT:                                                        *00124000
002000*  1. DAILY UNJOURNALIZED RECS FILE WITH SEPHORA INDICATOR       *00125000
001500*                                        (APRD042)               *00125100
002100*                                                                *00126000
002300*----------------------------------------------------------------*00127000
002400*                                                                *00128000
002500* CHANGE LOG:                                                    *00129000
002600* DATE  08/27/2021                                               *00130000
002610*     CHANGE MADE: INITIAL VERSION.                              *00140000
002620*     MADE BY: JEAN KURK               WR/IR #: CHG0260549       *00150000
002630*                                                                *00160000
002700*----------------------------------------------------------------*00170000
002800                                                                  00180000
002900 ENVIRONMENT DIVISION.                                            00190000
003000 CONFIGURATION SECTION.                                           00200000
003100 SOURCE-COMPUTER.    IBM-3090.                                    00210000
003200 OBJECT-COMPUTER.    IBM-3090.                                    00220000
003300                                                                  00230000
003400 INPUT-OUTPUT SECTION.                                            00240000
003500 FILE-CONTROL.                                                    00250000
003600     SELECT UNJRNL-INPUT        ASSIGN TO UT-S-INP01.             00260000
003600     SELECT UNJRNL-OUTPUT       ASSIGN TO UT-S-OUT01.             00261000
003700                                                                  00270000
003800 DATA DIVISION.                                                   00280000
003900 FILE SECTION.                                                    00290000
004000                                                                  00300000
004100 FD  UNJRNL-INPUT                                                 00310000
004200     RECORDING MODE IS F                                          00320000
004300     LABEL RECORDS ARE STANDARD                                   00330005
004300     BLOCK CONTAINS 0 RECORDS                                     00331005
004500     DATA RECORD IS UNJRNL-INPUT-REC.                             00333000
004600 01  UNJRNL-INPUT-REC                 PIC X(120).                 00340000
004800                                                                  00350000
004100 FD  UNJRNL-OUTPUT                                                00351000
004200     RECORDING MODE IS F                                          00352000
004300     LABEL RECORDS ARE STANDARD                                   00353005
004300     BLOCK CONTAINS 0 RECORDS                                     00353105
004500     DATA RECORD IS UNJRNL-OUTPUT-REC.                            00353200
004600 01  UNJRNL-OUTPUT-REC                PIC X(120).                 00354000
004800                                                                  00355000
004900                                                                  00361000
005000 WORKING-STORAGE SECTION.                                         00370000
005100                                                                  00380000
005200 01  PV-PROGRAM-VARIABLES.                                        00390000
005300     05  FILLER                     PIC  X(30)  VALUE             00400003
005400                '** BEGINING OF APKUT443 W/S **'.                 00410003
005500     05  PV-CURRENT-PARAGRAPH       PIC  X(35).                   00420003
005600     05  PV-PROGRAM-NAME            PIC  X(08)  VALUE 'APKUT443'. 00430003
005610     05  HOLD-VENDOR-NBR            PIC  9(09)  VALUE 0.          00440003
005610     05  DK-PO-NBR                  PIC S9(9) COMP.               00450003
005610     05  PV-DISPLAY-COUNT           PIC ZZZ,ZZZ,ZZ9.              00460003
006600                                                                  00470000
006700 01  PS-PROGRAM-SWITCHES.                                         00480000
006800     05  PS-INPUT-EOF-SW            PIC X(01) VALUE 'N'.          00490003
006900         88  INPUT-EOF-YES                    VALUE 'Y'.          00500003
007000         88  INPUT-EOF-NO                     VALUE 'N'.          00510003
007200                                                                  00520000
007300 01  PC-PROGRAM-COUNTERS.                                         00530000
008000     05  PC-WRITE-COUNT             PIC  9(09)  VALUE 0.          00540003
008400     05  PC-READ-COUNT              PIC  9(09)  VALUE 0.          00560003
013100                                                                  00580000
013200*----------------------------------------------------------------*00590000
013300*  COMMUNICATIONS AREA2 FOR DB2                                  *00600000
013400*----------------------------------------------------------------*00610000
013500     COPY SQLCA2.                                                 00620000
013700                                                                  00640000
013800     EXEC SQL                                                     00650000
013900          INCLUDE SQLCA                                           00660000
014000     END-EXEC.                                                    00670000
014100                                                                  00680000
015600*----------------------------------------------------------------*00970000
015700*  VENDOR CAPABILITIES - VNT_VND_CPBL                            *00980000
015800*----------------------------------------------------------------*00990000
015900     EXEC SQL                                                     01000000
016000          INCLUDE VNT00001                                        01010000
016100     END-EXEC.                                                    01020000
016200                                                                  01030000
015600*----------------------------------------------------------------*01040000
015700*  MERCHANDISE AREA                                              *01050000
015800*----------------------------------------------------------------*01060000
015900     EXEC SQL                                                     01070000
016000          INCLUDE TMDSEAR                                         01080000
016100     END-EXEC.                                                    01090000
016200                                                                  01100000
015600*----------------------------------------------------------------*01101000
015700*  PURCHASE ORDER                                                *01102000
015800*----------------------------------------------------------------*01103000
015900     EXEC SQL                                                     01104000
016000          INCLUDE TPURCHS                                         01105000
016100     END-EXEC.                                                    01106000
016200                                                                  01107000
066700*--------------------------------------------------------------*  01110000
066800* COPYBOOK FOR SEPHORA LOGIC                                   *  01120000
066900*--------------------------------------------------------------*  01130000
067000     COPY APWS021.                                                01140000
067100                                                                  01150000
066700*--------------------------------------------------------------*  01160000
066800* COPYBOOK FOR OUTPUT RECORD                                   *  01170000
066900*--------------------------------------------------------------*  01180000
067000     COPY APRD042.                                                01190004
067100                                                                  01200000
018500*----------------------------------------------------------------*01560000
018600*  ABEND DATA AREAS                                              *01570000
018700*----------------------------------------------------------------*01580000
018800 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01590000
018900                                             COMP SYNC.           01600000
019000     88  AC-BAD-DATA                         VALUE +4003.         01610000
019100     88  AC-DB2-ERROR                        VALUE +4013.         01620000
019300                                                                  01630000
019400 01  ABEND-AREAS.                                                 01640000
019500     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01650000
019600             '*****       ABEND'.                                 01660000
019700     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01670000
019800             '*****   PROGRAM: APKUT443'.                         01680000
019900     05  AA-PARAGRAPH-LIT.                                        01690000
020000         10  FILLER              PIC  X(17)  VALUE                01700000
020100             '***** PARAGRAPH: '.                                 01710000
020200         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01720000
020600     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01760000
020700             '*****    DB2 ERROR'.                                01770000
020800     05  AA-DB2-OPERATION-LIT.                                    01780000
020900         10  FILLER              PIC  X(17)  VALUE                01790000
021000             '***** OPERATION: '.                                 01800000
021100         10  AA-DB2-OPERATION.                                    01810000
021200             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        01820000
021300             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01830000
021400     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01840000
021500     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01850000
021900                                                                  01880000
022000                                                                  01890000
022100     COPY DPWS004.                                                01900000
022200 01  FILLER                      PIC  X(25)  VALUE                01910000
022300     '** END OF APKUT443 W/S **'.                                 01920000
022400                                                                  01930000
022500 PROCEDURE DIVISION.                                              01940000
022600 A100-MAIN.                                                       01950000
022700                                                                  01960000
022800     MOVE 'A100-MAIN' TO PV-CURRENT-PARAGRAPH.                    01970000
022900                                                                  01980000
023000     PERFORM B100-INITIALIZE.                                     01990000
023100                                                                  02000000
023200     PERFORM B200-WRITE-FILE                                      02010000
023300         UNTIL INPUT-EOF-YES.                                     02020000
023400                                                                  02030000
023500     PERFORM B300-END-PROGRAM.                                    02040000
023600                                                                  02050000
023700     GOBACK.                                                      02060000
023800                                                                  02070000
023900*----------------------------------------------------------------*02080000
024000*    INITIALIZATION PROCESSING                                   *02090000
024100*    CALLED FROM A100-MAIN                                       *02100000
024200*----------------------------------------------------------------*02110000
024300 B100-INITIALIZE.                                                 02120000
024400                                                                  02130000
024500     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              02140000
024600                                                                  02150000
024700     OPEN INPUT  UNJRNL-INPUT                                     02160000
024700          OUTPUT UNJRNL-OUTPUT.                                   02161000
024800                                                                  02170000
024900     INITIALIZE DCLTMDSEAR                                        02180000
024900                DCLTPURCHS                                        02190000
025100                DCLVNT00001.                                      02230000
025200                                                                  02240000
129500*    GET SEPHORA DATA                                             02250000
129500     MOVE PV-PROGRAM-NAME      TO SA-PROGRAM-NAME.                02260000
129500     PERFORM S100-GET-SEPHORA-DEPT.                               02270000
026320                                                                  02280000
026400     PERFORM R100-READ-INPUT.                                     02290000
026600                                                                  02310000
026700*----------------------------------------------------------------*02320000
026800*    MOVES DATA FROM THE DB2 TABLE AREAS TO THE REPORT.          *02330000
026900*    CALLED FROM A100-MAIN                                       *02340000
027000*----------------------------------------------------------------*02350000
027100 B200-WRITE-FILE.                                                 02360000
027200                                                                  02370000
027300     MOVE 'B200-CREATE-FILE'       TO PV-CURRENT-PARAGRAPH.       02380000
027300                                                                  02400000
027300     IF AP042-VND-NBR NOT = HOLD-VENDOR-NBR                       02410000
027400         MOVE AP042-PO-NBR         TO DK-PO-NBR                   02430001
027400         PERFORM Y100-GET-ENTID                                   02430104
027400         MOVE PURCHS-ENT-ID        TO PV-ENT-ID                   02431001
027400         MOVE AP042-DEPT-NBR       TO PV-DEPT-NBR                 02440004
027400         PERFORM S500-CHECK-FOR-SEPHORA                           02450000
026522         MOVE AP042-VND-NBR        TO HOLD-VENDOR-NBR             02451001
027400     END-IF.                                                      02460000
027400                                                                  02470000
216700     IF PS-SEPHORA-ALL                                            02480000
216700         SET AP042-IS-SEPHORA      TO TRUE                        02490005
216700     ELSE                                                         02500000
216700         SET AP042-IS-NOT-SEPHORA  TO TRUE                        02510005
216700     END-IF.                                                      02520000
028400                                                                  02590000
028200     PERFORM W100-WRITE-OUTPUT-FILE.                              02600001
028500     PERFORM R100-READ-INPUT.                                     02610000
028600                                                                  02620000
028700*----------------------------------------------------------------*02630000
028800*    ENDING PROCESSING: DISPLAYS COUNT OF VENDORS AND CLOSES     *02640000
028900*    THE FILES.                                                  *02650000
029000*    CALLED FROM A100-MAIN                                       *02660000
029100*----------------------------------------------------------------*02670000
029200 B300-END-PROGRAM.                                                02680000
029300                                                                  02690000
029400     MOVE 'B300-END-PROGRAM' TO PV-CURRENT-PARAGRAPH.             02700000
029500                                                                  02710000
029600     DISPLAY 'INPUT RECORDS  = ' PC-READ-COUNT.                   02720000
029600     DISPLAY 'OUTPUT RECORDS = ' PC-WRITE-COUNT.                  02730000
029700                                                                  02740000
030000     CLOSE UNJRNL-INPUT                                           02770000
030000           UNJRNL-OUTPUT.                                         02771000
030100                                                                  02780000
030200*----------------------------------------------------------------*02790000
030300*    READS THE UNJOURNALIZED RECORDS FROM THE INPUT FILE.        *02800000
030600*----------------------------------------------------------------*02830000
030700 R100-READ-INPUT.                                                 02840000
030800                                                                  02850000
030900     MOVE 'R100-READ-INPUT' TO PV-CURRENT-PARAGRAPH.              02860000
031000                                                                  02870000
025800     READ UNJRNL-INPUT INTO AP042-EXTRACT-FILE                    02871000
025900        AT END                                                    02872000
026000            SET INPUT-EOF-YES TO TRUE                             02873000
026100        NOT AT END                                                02874000
026200            ADD 1 TO PC-READ-COUNT                                02875004
026300     END-READ.                                                    02876000
036900                                                                  03160000
037000*----------------------------------------------------------------*03170000
037100*    WRITES THE UNJOURNALIZED RECORDS WITH THE SEPHORA INDICATOR *03180000
037200*----------------------------------------------------------------*03190000
037300 W100-WRITE-OUTPUT-FILE.                                          03200000
037400                                                                  03210000
037500     MOVE 'W100-WRITE-OUTPUT-FILE' TO PV-CURRENT-PARAGRAPH.       03220000
038000                                                                  03240000
038100     WRITE UNJRNL-OUTPUT-REC FROM AP042-EXTRACT-FILE.             03250004
038200     ADD 1  TO PC-WRITE-COUNT.                                    03260000
050800                                                                  03900000
451110*----------------------------------------------------------------*03901001
451120* Y100-GET-ENTID                                                 *03902001
451120*    READ THE TPURCHS TABLE TO GET THE ENT-ID                    *03903001
451170*----------------------------------------------------------------*03907001
451180 Y100-GET-ENTID.                                                  03908001
451190                                                                  03909201
037500     MOVE 'Y100-GET-ENT-ID'        TO PV-CURRENT-PARAGRAPH.       03909302
451190                                                                  03909402
451191     EXEC SQL                                                     03909501
451192         SELECT ENT_ID                                            03909601
451195           INTO :PURCHS-ENT-ID                                    03909706
451198           FROM TPURCHS                                           03909801
451201          WHERE PO_NBR            = :DK-PO-NBR                    03909901
451202            AND VER_STATUS_CDE    = 'A'                           03910001
451206     END-EXEC.                                                    03910101
451207                                                                  03910201
451208     EVALUATE TRUE                                                03910301
451209         WHEN SQLCODE = ZERO                                      03910401
451209             CONTINUE                                             03910502
451214         WHEN OTHER                                               03910901
451215             MOVE PV-CURRENT-PARAGRAPH    TO AA-PARAGRAPH-NAME    03911002
451217             MOVE 'UNSUCCESSFUL SELECT'   TO AA-DB2-OP-1          03911202
451218             MOVE 'TPURCHS'               TO AA-DB2-TABLE-1       03911302
451221             PERFORM Z998-DB2-ABEND                               03911402
451222     END-EVALUATE.                                                03912801
502200                                                                  03912901
050900*----------------------------------------------------------------*03913000
051000*    ABEND ROUTINE FOR DB2 ERRORS                                *03920000
051100*----------------------------------------------------------------*03930000
051200 Z998-DB2-ABEND.                                                  03940000
051300                                                                  03950000
030000     CLOSE UNJRNL-INPUT                                           03961002
030000           UNJRNL-OUTPUT.                                         03962002
051500     DISPLAY AA-ABEND-LIT.                                        03970000
051600     DISPLAY AA-DB2-ERROR-LIT.                                    03980000
051700     DISPLAY AA-PROGRAM-LIT.                                      03990000
051800     DISPLAY AA-PARAGRAPH-LIT.                                    04000000
051900     DISPLAY AA-DB2-OPERATION-LIT.                                04010000
052000     DISPLAY AA-DB2-TABLE-1.                                      04020000
052100     DISPLAY AA-DB2-TABLE-2.                                      04030000
052400     SET AC-DB2-ERROR TO TRUE.                                    04060000
052500                                                                  04070000
052600     COPY DPPD004.                                                04080000
052700                                                                  04090000
052800     CALL 'ILBOABN0' USING ABEND-CODE.                            04100000
052900                                                                  04110000
066700*--------------------------------------------------------------*  04120000
066800* COPYBOOK FOR SEPHORA PROCESSES                               *  04130000
066900*--------------------------------------------------------------*  04140000
067000     COPY APPD021.                                                04150000
067100                                                                  04160000
