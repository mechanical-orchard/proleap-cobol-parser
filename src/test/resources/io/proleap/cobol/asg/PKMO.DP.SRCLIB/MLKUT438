000100 ID DIVISION.                                                     00010011
000200                                                                  00020011
000300 PROGRAM-ID.      MLKUT438.                                       00030011
000400 AUTHOR.          TESS BESTE.                                     00040011
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050011
000600 DATE-WRITTEN     06/1999.                                        00060011
000700 DATE-COMPILED.                                                   00070011
000800******************************************************************00080011
000900*                                                                 00090011
001000*  MLKUT438 - CREATE MONTHLY OPEN-TO-BUY EXTRACT FOR COMBINED     00100011
001100*             LEDGER.                                             00110011
001200*                                                                 00120011
001800*  THIS PROGRAM READS AN OPEN-TO-BUY EXRACT FILE, REFORMATS IT,   00180011
001900*  AND CREATES ANOTHER EXTRACT FILE THAT IS USED TO LOAD THE      00190011
002000*  MONTHLY DEPARTMENT OPEN-TO-BUY TABLE (TMNDOTB), WHICH IS THE   00200011
002100*  SOURCE OF THE MONTHLY OPEN-TO-BUY DATA ON THE COMBINED LEDGER  00210011
002200*  REPORT.                                                        00220011
002300*                                                                 00230011
002400*  BOTH THE INPUT AND OUTPUT EXTRACT FILES ARE AT A DEPARTMENT    00240011
002500*  LEVEL AND CONTAIN MONTHLY DATA FOR THE CURRENT OTB MONTHS.     00250011
002600*  EACH RECORD ON THE INPUT EXTRACT FILE CONTAINS 3 OCCURRENCES   00260011
002700*  (ONE FOR EACH OTB MONTH) OF ONE PARTICULAR PIECE OF            00270011
002800*  INFORMATION (SALES RETAIL AMOUNT, FOR EXAMPLE).  EACH RECORD   00280011
002900*  ON THE OUTPUT FILE CONTAINS ALL THE NECESSARY PIECES OF        00290011
003000*  INFORMATION FOR ONE MONTH.                                     00300011
003100*                                                                 00310011
003200*  TO CONVERT A RECORD FROM THE INPUT FORMAT TO THE OUTPUT        00320011
003300*  FORMAT, ALL THE INFORMATION FOR A DEPARTMENT IS TABLED BY      00330011
003400*  MONTH AS IT IS READ.  WHEN THE DEPARTMENT NUMBER CHANGES,      00340011
003500*  3 OUTPUT RECORDS ARE WRITTEN FROM THE TABLED DATA  - ONE       00350011
003600*  RECORD FOR EACH OTB MONTH.                                     00360011
003700*                                                                 00370011
003800*  THE FIRST OTB MONTH IS DETERMINED BY READING A DATE FROM THE   00380011
003900*  OTB RUNDATE FILE.  THE FISCAL MONTH END DATE AND FISCAL MONTH  00390011
004000*  NUMBER ARE THEN RETRIEVED FOR THAT MONTH AND THE NEXT TWO      00400011
004100*  MONTHS.  THESE 3 DATES ARE USED TO BUILD THE OUTPUT FILE.      00410011
004200******************************************************************00420011
004210*    WR/PITS#     DATE        DESCRIPTION                        *00421017
004220*    --------   --------     ---------------------------------   *00422017
004230*  WR10586    05/03/00     ADDED CODE TO PROCESS ADDITIONAL      *00423037
004500*    OTB INFORMATION THAT WILL BE USED FOR THE M/L STATISTICS    *00450017
004600*    REPORT.  ALSO CHANGED CODE TO LOOK AT 88-LEVELS FOR         *00460017
004700*    DETERMINING DATA TYPE, RETAIL OR COST, AND RECORD TYPE.     *00470021
99999 *  WR# 99999  08/17/2000   ROD JANSSEN                           *00480137
99999 *    PLANNING/OTB EXTRACT CHANGES DUE TO AIM PROJECT.            *00480227
99999 *    (ADJUSTMENTS TO UNSTRING VARIABLES AND NEW ROWS)            *00480327
31355 *  WR# 31355  11/17/2000   ROD JANSSEN                           *00480537
31355 *    E-COMMERCE COMBINED LEDGER REPORT MODIFICATION.......       *00480637
W04031*  WR# 99999  04/03/2001   ROD JANSSEN                           *00480737
W04031*    CHANGE ALL RECORD TYPE VERBIAGE TO UPPER CASE.              *00480837
C71482*  C71482     08/04/2017 J SELWITSCHKA                            00480942
C71482*    EP UPGRADE. DO NOT ABEND IF INPUT FILE IS EMPTY.             00481042
004900******************************************************************00490015
005000                                                                  00500011
005100 ENVIRONMENT DIVISION.                                            00510011
005200                                                                  00520011
005300 CONFIGURATION SECTION.                                           00530011
005400                                                                  00540011
005500 SOURCE-COMPUTER.        IBM-3090.                                00550011
005600 OBJECT-COMPUTER.        IBM-3090.                                00560011
005700                                                                  00570011
005800 INPUT-OUTPUT SECTION.                                            00580011
005900                                                                  00590011
006000 FILE-CONTROL.                                                    00600011
006100                                                                  00610011
006200     SELECT  DPT-OTB-FILE                                         00620011
006300         ASSIGN TO INP01.                                         00630011
006400                                                                  00640011
006500     SELECT  OTB-RUNDATE-FILE                                     00650011
006600         ASSIGN TO INP02.                                         00660011
006700                                                                  00670011
006800     SELECT MNTHLY-OTB-EXTRACT-FILE                               00680011
006900         ASSIGN TO OUT01.                                         00690011
007000                                                                  00700011
007100 DATA DIVISION.                                                   00710011
007200                                                                  00720011
007300 FILE SECTION.                                                    00730011
007400                                                                  00740011
007500 FD  DPT-OTB-FILE                                                 00750011
007600     RECORDING MODE F                                             00760011
007700     LABEL RECORDS ARE STANDARD                                   00770011
007800     BLOCK CONTAINS  0 RECORDS                                    00780011
007900     RECORD CONTAINS 400 CHARACTERS                               00790011
008000     DATA RECORD IS DPT-OTB-REC.                                  00800011
008100                                                                  00810011
008200 01  DPT-OTB-REC                 PIC X(400).                      00820011
008300                                                                  00830011
008400 FD  OTB-RUNDATE-FILE                                             00840011
008500     RECORDING MODE F                                             00850011
008600     LABEL RECORDS ARE STANDARD                                   00860011
008700     BLOCK CONTAINS  0 RECORDS                                    00870011
008800     RECORD CONTAINS 10  CHARACTERS                               00880011
008900     DATA RECORD IS OTB-RUNDATE-REC.                              00890011
009000                                                                  00900011
009100 01  OTB-RUNDATE-REC             PIC X(10).                       00910011
009200                                                                  00920011
009300 FD  MNTHLY-OTB-EXTRACT-FILE                                      00930011
009400     RECORDING MODE IS F                                          00940011
009500     LABEL RECORDS ARE STANDARD                                   00950011
009600     BLOCK CONTAINS 0 RECORDS.                                    00960011
009700                                                                  00970011
009800 01  MNTHLY-OTB-EXTRACT-REC      PIC X(125).                      00980012
009900                                                                  00990011
010000 WORKING-STORAGE SECTION.                                         01000011
010100                                                                  01010011
010200 01  FMD-FSCL-MN-DATA.                                            01020011
010300     05  FMD-FSCL-MN-END-DTE-1   PIC X(10).                       01030011
010400     05  FMD-FSCL-MN-NBR-1       PIC X(02).                       01040011
010500     05  FMD-FSCL-MN-END-DTE-2   PIC X(10).                       01050011
010600     05  FMD-FSCL-MN-NBR-2       PIC X(02).                       01060011
010700     05  FMD-FSCL-MN-END-DTE-3   PIC X(10).                       01070011
010800     05  FMD-FSCL-MN-NBR-3       PIC X(02).                       01080011
010900                                                                  01090011
011000 01  FMT-FSCL-MN-TABLE REDEFINES FMD-FSCL-MN-DATA.                01100011
011100     05  FMT-FSCL-MN-ENTRY       OCCURS 3.                        01110011
011200         10  FMT-FSCL-MN-END-DTE PIC X(10).                       01120011
011300         10  FMT-FSCL-MN-NBR     PIC X(02).                       01130011
011400                                                                  01140011
011500                                                                  01150011
011600*  THIS TABLE IS USED TO HOLD ALL INPUT DATA FOR A DEPARTMENT     01160011
011700*  BY MONTH.  WHEN A BREAK OCCURS ON DEPARTMENT NUMBER, THE       01170011
011800*  OUTPUT RECORDS ARE BUILT FROM THIS TABLE.                      01180011
011900 01  ODT-OPEN-TO-BUY-DATA-TABLE.                                  01190011
012000     05  ODT-OPEN-TO-BUY-DATA-TBL-ENTRY                           01200011
012100                                 OCCURS 3.                        01210011
012200         10  ODT-SLS-RTL-AMT     PIC S9(09)V99  COMP-3 VALUE +0.  01220001
012300         10  ODT-MKDN-RTL-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01230001
012400         10  ODT-RCPT-RTL-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01240001
012500         10  ODT-SHNK-RTL-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01250001
012600         10  ODT-END-INV-RTL-AMT PIC S9(09)V99  COMP-3 VALUE +0.  01260001
012700         10  ODT-SLS-COST-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01270001
012800         10  ODT-TOT-ORD-RTL-AMT PIC S9(09)V99  COMP-3 VALUE +0.  01280001
012900         10  ODT-APP-ORD-RTL-AMT PIC S9(09)V99  COMP-3 VALUE +0.  01290001
013000         10  ODT-APP-ORD-COST-AMT                                 01300001
013100                                 PIC S9(09)V99  COMP-3 VALUE +0.  01310001
013300         10  ODT-RCPT-NET-COST-AMT                                01330011
013400                                 PIC S9(09)V99  COMP-3 VALUE +0.  01340011
013500         10  ODT-PADJ-NET-COST-AMT                                01350011
013600                                 PIC S9(09)V99  COMP-3 VALUE +0.  01360011
013700         10  ODT-GRO-MRGN-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01370012
013800         10  ODT-PADJ-RTL-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01380011
013900         10  ODT-BEG-INV-RTL-AMT PIC S9(09)V99  COMP-3 VALUE +0.  01390011
014200                                                                  01420011
014300 01  PS-PROGRAM-SWITCHES.                                         01430011
014400     05  PS-END-OF-DPT-OTB-FILE-SW    PIC X     VALUE 'N'.        01440011
014500         88  PS-END-OF-DPT-OTB-FILE             VALUE 'Y'.        01450011
014600                                                                  01460011
014700     05  PS-END-OF-OTB-RUNDATE-FILE-SW PIC X VALUE 'N'.           01470011
014800         88  PS-END-OF-OTB-RUNDATE-FILE         VALUE 'Y'.        01480011
014900                                                                  01490011
015000                                                                  01500011
015100 01  PV-PROGRAM-VARIABLES.                                        01510011
015200     05  PV-OTB-RUNDATE-REC      PIC X(10).                       01520011
015300     05  PV-DEL-ID1              PIC X          VALUE ','.        01530011
015400     05  PV-DEL-ID2              PIC X          VALUE '_'.        01540011
015500     05  PV-UNSTR-PTR            PIC S9(04)     COMP SYNC         01550011
015600                                                VALUE ZERO.       01560011
015700     05  PV-PARAGRAPH-NAME       PIC X(30)      VALUE SPACE.      01570011
015800     05  PV-DB2-OPER-ATTEMPTED   PIC X(30)      VALUE SPACE.      01580011
015900     05  PV-PGM-NAME             PIC X(08)      VALUE 'MLKUT438'. 01590011
016000     05  PV-ABEND-CODE           PIC S9(04)     COMP SYNC         01600011
016100                                                VALUE ZERO.       01610011
016200     05  PV-PREV-DEPT-NBR        PIC X(03).                       01620011
016300     05  PV-AMT                  PIC S9(09)V9(06).                01630011
016500     05  PV-DATA-TYPE            PIC X(05)      VALUE SPACE.      01650013
99999          88 OAP-DATA                            VALUE 'OAP'.      01660027
99999 *****    88 APOTB-DATA                          VALUE 'APOTB'.    01661027
016700     05  PV-RETAIL-OR-COST-DATA  PIC X(03)      VALUE SPACE.      01670014
               88 RETAIL-DATA                         VALUE 'DLR'.      01691030
               88 COST-DATA                           VALUE 'CST'.      01692030
31355      05  PV-CHNL-CDE             PIC X(01)      VALUE 'P'.        01693033
31355          88 TOTAL-ALL-COMPANY                   VALUE 'A'.        01694033
31355          88 PHYSICAL-STORE                      VALUE 'P'.        01695033
31355          88 E-STORE                             VALUE 'V'.        01696034
31355                                                                   01697033
017000******************************************************************01700014
017100*** W A R N I N G   -  LOWER CASE USED IN PROGRAM for record type 01710019
017200*** W A R N I N G   -  LOWER CASE USED IN PROGRAM for record type 01720019
017300******************************************************************01730014
017400     05  PV-REC-TYPE             PIC X(09)      VALUE SPACE.      01740014
017500         88 SALES-REC                           VALUE 'SLS'.      01750014
W04031         88 CURWRITE-REC                        VALUE 'CURWRITE'. 01760037
W04031         88 NET-RECEIPTS-REC                    VALUE 'NETREC'.   01770037
W04031         88 PURCHASE-ADJ-REC                    VALUE 'RECADJ'.   01780037
99999          88 EOP-INVENTORY-REC                   VALUE 'EOP'.      01790027
W04031         88 RECEIPTS-REC                        VALUE 'RECEIPTS'. 01800037
W04031         88 MARKDOWN-REC                        VALUE 'TMKD'.     01810037
W04031         88 SHRINK-REC                          VALUE 'SHR'.      01820037
W04031         88 PURCHASES-REC                       VALUE 'PURCH'.    01830037
018400         88 GROSS-MARGIN-REC                    VALUE 'GM'.       01840014
99999          88 BOP-INVENTORY-REC                   VALUE 'BOP'.      01850027
W04031***                                                               01850137
W04031***      88 CURWRITE-REC                        VALUE 'CURWRITE'. 01850337
W04031***      88 NET-RECEIPTS-REC                    VALUE 'NETREC'.   01850437
W04031***      88 PURCHASE-ADJ-REC                    VALUE 'RECADJ'.   01850537
W04031***      88 RECEIPTS-REC                        VALUE 'RECEIPTS'. 01850637
W04031***      88 MARKDOWN-REC                        VALUE 'TMKD'.     01850737
W04031***      88 SHRINK-REC                          VALUE 'SHR'.      01850837
W04031***      88 PURCHASES-REC                       VALUE 'PURCH'.    01850937
W04031***                                                               01851037
99999      05  PV-TOTAL-COMPANY        PIC X(04)      VALUE SPACE.      01851127
99999          88 TOTAL-1                             VALUE 'TOT1'.     01851227
99999      05  PV-STORE-TYPE           PIC X(07)      VALUE SPACE.      01851327
99999          88 TOTAL-COMPANY                       VALUE 'TOTALCO'.  01851427
99999          88 VIRTUAL-STORE                       VALUE 'VIRTSTR'.  01852027
99999          88 RETAIL-STORE                        VALUE 'PHYSSTR'.  01860027
018800                                                                  01880011
018900 01  SS-SUBSCRIPTS.                                               01890011
019000     05  SS-MONTH                PIC S9(04)     COMP SYNC.        01900011
019100     05  SS-MONTH-MAX            PIC S9(04)     COMP SYNC         01910011
019200                                                VALUE +3.         01920011
019300 01  US-UNSTRING-AREA.                                            01930011
019400     05  US-DEPT-NBR-6-CHAR.                                      01940011
019500         10  FILLER              PIC X(03).                       01950011
019600         10  US-DEPT-NBR         PIC X(03).                       01960011
99999      05  US-TOTAL-COMPANY        PIC X(04)        VALUE SPACES.   01961027
99999      05  US-STORE-TYPE           PIC X(07)        VALUE SPACES.   01962027
019700     05  US-REC-TYPE             PIC X(09)        VALUE SPACE.    01970011
019800     05  US-DATA-TYPE            PIC X(05)        VALUE SPACE.    01980011
019900     05  US-RTL-CST              PIC X(03)        VALUE SPACE.    01990011
020000     05  US-MONTHLY-AMT          OCCURS 3                         02000011
020100                                 PIC S9(09)V9(04) VALUE ZERO.     02010011
020200                                                                  02020011
020300*************************************************************     02030011
020400* INPUT AREA FOR DEPARTMENT OPEN-TO-BUY RECORD.             *     02040011
020500*************************************************************     02050011
020600 01  PV-DPT-OTB-REC              PIC X(400).                      02060011
020700                                                                  02070011
020800*************************************************************     02080011
020900* COPYBOOK FOR OUTPUT MONTHLY OPEN-TO-BUY EXTRACT RECORD.   *     02090011
021000*************************************************************     02100011
021100     COPY MLRD127.                                                02110011
021200                                                                  02120011
021300*************************************************************     02130011
021400* COPYBOOK FOR NUMERIC EDIT ROUTINE                         *     02140011
021500*************************************************************     02150011
021600     COPY DPWS010I.                                               02160011
021700                                                                  02170011
021800*************************************************************     02180011
021900*  DATE ATTRIBUTE TABLE                                     *     02190011
022000*************************************************************     02200011
022100     EXEC SQL                                                     02210011
022200         INCLUDE TDTATTR                                          02220011
022300     END-EXEC.                                                    02230011
022400                                                                  02240011
022500*************************************************************     02250011
022600* DB2 ERROR MESSAGE AREA                                    *     02260011
022700*************************************************************     02270011
022800     COPY DPWS004.                                                02280011
022900                                                                  02290011
023000*************************************************************     02300011
023100* DB2 COMMUNICATION AREA                                    *     02310011
023200*************************************************************     02320011
023300     EXEC SQL                                                     02330011
023400         INCLUDE SQLCA                                            02340011
023500     END-EXEC.                                                    02350011
023600                                                                  02360011
023700 EJECT                                                            02370011
023800                                                                  02380011
023900 PROCEDURE DIVISION.                                              02390011
024000                                                                  02400011
024100                                                                  02410011
024200 1000-MAINLINE.                                                   02420011
024300                                                                  02430011
024400     PERFORM 1100-INITIALIZATION.                                 02440011
024500                                                                  02450011
024600     PERFORM 7000-READ-DPT-OTB-FILE.                              02460011
024700                                                                  02470011
024800     IF NOT PS-END-OF-DPT-OTB-FILE                                02480011
024900         PERFORM 2100-UNSTRING-DPT-OTB-REC                        02490011
025000         MOVE US-DEPT-NBR  TO PV-PREV-DEPT-NBR                    02500011
025100         PERFORM 2000-PROCESS-DEPT-DATA                           02510011
025200             UNTIL PS-END-OF-DPT-OTB-FILE                         02520011
025300         PERFORM 2300-BUILD-AND-WRITE-EXTRACT                     02530011
025400     ELSE                                                         02540041
C71482*        DISPLAY '** ABEND **'                                    02550042
025600         DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  02560011
025700         DISPLAY '** PARAGRAPH 1000-MAINLINE  **'                 02570011
025800         DISPLAY                                                  02580011
025900             '** THE INPUT DEPARTMENT OPEN-TO-BUY FILE WAS EMPTY.'02590011
C71482*        MOVE +4008 TO PV-ABEND-CODE                              02600042
C71482*        PERFORM 9999-ABEND                                       02610042
026200     END-IF.                                                      02620011
026300                                                                  02630011
026400     CLOSE OTB-RUNDATE-FILE                                       02640011
026500           DPT-OTB-FILE                                           02650011
026600           MNTHLY-OTB-EXTRACT-FILE.                               02660011
026700                                                                  02670011
026800     STOP RUN.                                                    02680011
026900                                                                  02690011
027000                                                                  02700011
027100 1100-INITIALIZATION.                                             02710011
027200                                                                  02720011
027300*    OPEN THE FILES.                                              02730011
027400     OPEN INPUT  OTB-RUNDATE-FILE                                 02740011
027500          INPUT  DPT-OTB-FILE                                     02750011
027600          OUTPUT MNTHLY-OTB-EXTRACT-FILE.                         02760011
027700                                                                  02770011
027800     PERFORM 7050-READ-OTB-RUNDATE-FILE.                          02780011
027900                                                                  02790011
028000     IF PS-END-OF-OTB-RUNDATE-FILE                                02800011
028100         DISPLAY '** ABEND **'                                    02810011
028200         DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  02820011
028300         DISPLAY '** PARAGRAPH 1100-INITIALIZATION **'            02830011
028400         DISPLAY '** OTB RUNDATE FILE IS EMPTY.'                  02840011
028500         MOVE +4003 TO PV-ABEND-CODE                              02850011
028600         PERFORM 9999-ABEND                                       02860011
028700     END-IF.                                                      02870011
028800                                                                  02880011
028900     DISPLAY 'OTB RUNDATE RECORD: ' PV-OTB-RUNDATE-REC.           02890011
029000                                                                  02900011
029100     MOVE  PV-OTB-RUNDATE-REC TO DTATTR-KY-DTE.                   02910011
029200                                                                  02920011
029300*    GET THE FISCAL-MONTH-END-DATE AND FISCAL-MONTH-NUMBER FOR    02930011
029400*    THE OTB RUNDATE AND THE NEXT 2 MONTHS.                       02940011
029500     PERFORM 8100-GET-OTB-MONTHS.                                 02950011
029600                                                                  02960011
029700                                                                  02970011
029800 2000-PROCESS-DEPT-DATA.                                          02980011
029900                                                                  02990011
030000     IF US-DEPT-NBR NOT = PV-PREV-DEPT-NBR                        03000011
030100         PERFORM 2300-BUILD-AND-WRITE-EXTRACT                     03010011
030200         INITIALIZE ODT-OPEN-TO-BUY-DATA-TABLE                    03020011
030300         MOVE US-DEPT-NBR   TO PV-PREV-DEPT-NBR                   03030011
030400     END-IF.                                                      03040011
030500                                                                  03050011
030600     PERFORM 2200-LOAD-DATA-INTO-TABLE.                           03060011
030700                                                                  03070011
030800     PERFORM 7000-READ-DPT-OTB-FILE.                              03080011
030900                                                                  03090011
031000     IF NOT PS-END-OF-DPT-OTB-FILE                                03100011
031100         PERFORM 2100-UNSTRING-DPT-OTB-REC                        03110011
031200     END-IF.                                                      03120011
031300                                                                  03130011
031400                                                                  03140011
031500******************************************************************03150011
031600*  THE INPUT RECORDS ARE NOT IN A FIXED FORMAT.  THE FIELDS ARE   03160011
031700*  DELIMITED BY COMMAS AND THE NUMERIC FIELDS ARE IN A CHARACTER  03170011
031800*  FORMAT.  THIS PARAGRAPH UNSTRINGS THE DATA AND CONVERTS THE    03180011
031900*  COST AND RETAIL AMOUNTS INTO A NUMERIC FORMAT.                 03190011
032000******************************************************************03200011
032100 2100-UNSTRING-DPT-OTB-REC.                                       03210011
032200                                                                  03220011
032300*     UNSTRING THE DEPARTMENT NUMBER.                             03230011
032400      MOVE +1       TO PV-UNSTR-PTR                               03240011
032500      UNSTRING PV-DPT-OTB-REC                                     03250011
032600          DELIMITED BY PV-DEL-ID1                                 03260011
032700                    OR PV-DEL-ID2                                 03270011
032800          INTO         US-DEPT-NBR-6-CHAR                         03280011
032900          POINTER      PV-UNSTR-PTR                               03290011
033000      END-UNSTRING.                                               03300011
99999 *     UNSTRING THE TOTALS BY COMPANY.                             03300127
  |         UNSTRING PV-DPT-OTB-REC                                     03300226
  |             DELIMITED BY PV-DEL-ID1                                 03300325
  |                       OR PV-DEL-ID2                                 03300425
  |             INTO         US-TOTAL-COMPANY                           03300625
  |             POINTER      PV-UNSTR-PTR                               03300725
  |         END-UNSTRING.                                               03300825
  |   *     UNSTRING THE STORE TYPE.                                    03300925
  |         UNSTRING PV-DPT-OTB-REC                                     03301026
  |             DELIMITED BY PV-DEL-ID1                                 03301125
  |                       OR PV-DEL-ID2                                 03301225
  |             INTO         US-STORE-TYPE                              03301425
  |             POINTER      PV-UNSTR-PTR                               03301525
99999       END-UNSTRING.                                               03302027
033100*     UNSTRING THE RECORD TYPE.                                   03310011
033200      UNSTRING PV-DPT-OTB-REC                                     03320011
033300          DELIMITED BY PV-DEL-ID1                                 03330011
033400                    OR PV-DEL-ID2                                 03340011
033500          INTO         US-REC-TYPE                                03350011
033600          POINTER      PV-UNSTR-PTR                               03360011
033700      END-UNSTRING.                                               03370011
W04031*     UNSTRING THE RTL/CST INDICATOR.                             03371038
W04031      UNSTRING PV-DPT-OTB-REC                                     03372038
W04031          DELIMITED BY PV-DEL-ID1                                 03373038
W04031                    OR PV-DEL-ID2                                 03374038
W04031          INTO         US-RTL-CST                                 03375038
W04031          POINTER      PV-UNSTR-PTR                               03376038
W04031      END-UNSTRING.                                               03377038
033800*     UNSTRING THE DATA TYPE.                                     03380011
033900      UNSTRING PV-DPT-OTB-REC                                     03390011
034000          DELIMITED BY PV-DEL-ID1                                 03400011
034100                    OR PV-DEL-ID2                                 03410011
034200          INTO         US-DATA-TYPE                               03420011
034300          POINTER      PV-UNSTR-PTR                               03430011
034400      END-UNSTRING.                                               03440011
W04031***   UNSTRING THE RTL/CST INDICATOR.                             03450038
W04031***   UNSTRING PV-DPT-OTB-REC                                     03460038
W04031***       DELIMITED BY PV-DEL-ID1                                 03470038
W04031***                 OR PV-DEL-ID2                                 03480038
W04031***       INTO         US-RTL-CST                                 03490038
W04031***       POINTER      PV-UNSTR-PTR                               03500038
W04031***   END-UNSTRING.                                               03510038
035200*     UNSTRING THE MONTHLY AMT FIELDS AND CONVERT THEM TO NUMERIC 03520011
035300*     VALUES.                                                     03530011
035400      PERFORM VARYING SS-MONTH FROM 1 BY 1                        03540011
035500        UNTIL SS-MONTH > SS-MONTH-MAX                             03550011
035600                                                                  03560011
035700         MOVE SPACE TO DP010I-UNEDITED-FIELD                      03570011
035800         UNSTRING PV-DPT-OTB-REC                                  03580011
035900             DELIMITED BY PV-DEL-ID1                              03590011
036000                       OR PV-DEL-ID2                              03600011
036100             INTO         DP010I-UNEDITED-FIELD                   03610011
036200             POINTER      PV-UNSTR-PTR                            03620011
036300         END-UNSTRING                                             03630011
036400         MOVE 12          TO DP010I-MAXIMUM-DIGITS                03640011
036500         MOVE 4           TO DP010I-MAXIMUM-DECIMALS              03650011
036600         SET DP010I-NEGATIVE-ALLOWED TO TRUE                      03660011
036700                                                                  03670011
036800         PERFORM 2150-NUMERIC-CONVERSION                          03680011
036900                                                                  03690011
037000         MOVE DP010I-NUMERIC-FIELD TO PV-AMT                      03700011
037100         COMPUTE US-MONTHLY-AMT (SS-MONTH) = PV-AMT * 100         03710011
037200     END-PERFORM.                                                 03720011
037300                                                                  03730011
037400                                                                  03740011
037500 2150-NUMERIC-CONVERSION.                                         03750011
037600                                                                  03760011
037700     CALL DP010I-NUMERIC-EDIT-ROUTINE USING                       03770011
037800                                      DP010I-NUMERIC-EDIT-AREA.   03780011
037900                                                                  03790011
038000     IF DP010I-NO-ERROR-DETECTED                                  03800011
038100         NEXT SENTENCE                                            03810011
038200     ELSE                                                         03820011
038300         IF DP010I-INVALID-CHARACTER                              03830011
038400             MOVE ZEROES TO DP010I-NUMERIC-FIELD                  03840011
038500         ELSE                                                     03850011
038600             DISPLAY '** ABEND **'                                03860011
038700             DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'              03870011
038800             DISPLAY '** PARAGRAPH 2150-NUMERIC-CONVERSION **'    03880011
038900             DISPLAY '** ERROR IN CALLED NUMERIC EDIT ROUTINE.'   03890011
039000             DISPLAY '** ERROR INDICATOR = ' DP010I-ERROR-IND     03900011
039100             DISPLAY '** INPUT RECORD = ' PV-DPT-OTB-REC          03910011
039200             MOVE +4008 TO PV-ABEND-CODE                          03920011
039300             PERFORM 9999-ABEND                                   03930011
039400         END-IF                                                   03940011
039500     END-IF.                                                      03950011
039600                                                                  03960011
039700                                                                  03970011
039800******************************************************************03980011
039900*  THIS PARAGRAPH EVALUATES THE 'UNSTRUNG' INPUT DATA TO DETERMINE03990011
040000*  WHAT TYPE OF RECORD IS BEING PROCESSED.  IF THE RECORD IS ONE  04000011
040100*  OF THE TYPES THAT SHOULD BE EXTRACTED, THE COST/RETAIL AMOUNTS 04010011
040200*  ARE LOADED BY MONTH INTO A WORKING STORAGE TABLE.              04020011
040300******************************************************************04030011
040400 2200-LOAD-DATA-INTO-TABLE.                                       04040011
040500                                                                  04050011
040600     MOVE US-DATA-TYPE           TO PV-DATA-TYPE.                 04060014
040700     MOVE US-RTL-CST             TO PV-RETAIL-OR-COST-DATA.       04070014
040800     MOVE US-REC-TYPE            TO PV-REC-TYPE.                  04080014
99999      MOVE US-TOTAL-COMPANY       TO PV-TOTAL-COMPANY.             04080127
99999      MOVE US-STORE-TYPE          TO PV-STORE-TYPE.                04081027
040900                                                                  04090014
99999      EVALUATE TRUE                                                04100036
  |          WHEN TOTAL-1                                               04110036
  |        EVALUATE TRUE                                                04111036
99999        WHEN TOTAL-COMPANY OR                                      04112036
31355             VIRTUAL-STORE OR                                      04112136
31355             RETAIL-STORE                                          04112236
041000     EVALUATE TRUE                                                04113025
99999        WHEN OAP-DATA                                              04114027
041200         EVALUATE TRUE                                            04120018
041300           WHEN COST-DATA                                         04130014
041400             EVALUATE TRUE                                        04140018
041500               WHEN SALES-REC                                     04150014
041600                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04160011
041700                     UNTIL SS-MONTH > SS-MONTH-MAX                04170011
041800                       MOVE US-MONTHLY-AMT   (SS-MONTH)           04180011
041900                         TO ODT-SLS-COST-AMT (SS-MONTH)           04190011
042000                   END-PERFORM                                    04200011
042100               WHEN CURWRITE-REC                                  04210014
042200                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04220011
042300                     UNTIL SS-MONTH > SS-MONTH-MAX                04230011
042400                       MOVE US-MONTHLY-AMT       (SS-MONTH)       04240011
042500                         TO ODT-APP-ORD-COST-AMT (SS-MONTH)       04250011
042600                   END-PERFORM                                    04260011
042800               WHEN NET-RECEIPTS-REC                              04280020
042900                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04290012
043000                     UNTIL SS-MONTH > SS-MONTH-MAX                04300012
043100                       MOVE US-MONTHLY-AMT        (SS-MONTH)      04310012
043200                         TO ODT-RCPT-NET-COST-AMT (SS-MONTH)      04320012
043300                   END-PERFORM                                    04330012
043400               WHEN PURCHASE-ADJ-REC                              04340016
043500                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04350012
043600                     UNTIL SS-MONTH > SS-MONTH-MAX                04360012
043700                       MOVE US-MONTHLY-AMT        (SS-MONTH)      04370012
043800                         TO ODT-PADJ-NET-COST-AMT (SS-MONTH)      04380012
043900                   END-PERFORM                                    04390012
044100             END-EVALUATE                                         04410011
044200           WHEN RETAIL-DATA                                       04420014
044300             EVALUATE TRUE                                        04430018
99999                WHEN EOP-INVENTORY-REC                             04440027
044500                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04450011
044600                     UNTIL SS-MONTH > SS-MONTH-MAX                04460011
044700                       MOVE US-MONTHLY-AMT      (SS-MONTH)        04470011
044800                         TO ODT-END-INV-RTL-AMT (SS-MONTH)        04480011
044900                   END-PERFORM                                    04490011
045000               WHEN RECEIPTS-REC                                  04500014
045100                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04510011
045200                     UNTIL SS-MONTH > SS-MONTH-MAX                04520011
045300                       MOVE US-MONTHLY-AMT   (SS-MONTH)           04530011
045400                         TO ODT-RCPT-RTL-AMT (SS-MONTH)           04540011
045500                   END-PERFORM                                    04550011
045600               WHEN SALES-REC                                     04560014
045700                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04570011
045800                     UNTIL SS-MONTH > SS-MONTH-MAX                04580011
045900                       MOVE US-MONTHLY-AMT  (SS-MONTH)            04590011
046000                         TO ODT-SLS-RTL-AMT (SS-MONTH)            04600011
046100                   END-PERFORM                                    04610011
046200               WHEN MARKDOWN-REC                                  04620015
046300                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04630011
046400                     UNTIL SS-MONTH > SS-MONTH-MAX                04640011
046500                       MOVE US-MONTHLY-AMT   (SS-MONTH)           04650011
046600                         TO ODT-MKDN-RTL-AMT (SS-MONTH)           04660011
046700                   END-PERFORM                                    04670011
046800               WHEN SHRINK-REC                                    04680014
046900                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04690011
047000                     UNTIL SS-MONTH > SS-MONTH-MAX                04700011
047100                       MOVE US-MONTHLY-AMT   (SS-MONTH)           04710011
047200                         TO ODT-SHNK-RTL-AMT (SS-MONTH)           04720011
047300                   END-PERFORM                                    04730011
047400               WHEN PURCHASES-REC                                 04740014
047500                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04750011
047600                     UNTIL SS-MONTH > SS-MONTH-MAX                04760011
047700                       MOVE US-MONTHLY-AMT      (SS-MONTH)        04770011
047800                         TO ODT-TOT-ORD-RTL-AMT (SS-MONTH)        04780011
047900                   END-PERFORM                                    04790011
048000               WHEN CURWRITE-REC                                  04800014
048100                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04810011
048200                     UNTIL SS-MONTH > SS-MONTH-MAX                04820011
048300                       MOVE US-MONTHLY-AMT      (SS-MONTH)        04830011
048400                         TO ODT-APP-ORD-RTL-AMT (SS-MONTH)        04840011
048500                   END-PERFORM                                    04850011
048700               WHEN GROSS-MARGIN-REC                              04870014
048800                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04880012
048900                     UNTIL SS-MONTH > SS-MONTH-MAX                04890012
049000                       MOVE US-MONTHLY-AMT      (SS-MONTH)        04900012
049100                         TO ODT-GRO-MRGN-AMT    (SS-MONTH)        04910012
049200                   END-PERFORM                                    04920012
049300               WHEN PURCHASE-ADJ-REC                              04930016
049400                   PERFORM VARYING SS-MONTH FROM 1 BY 1           04940012
049500                     UNTIL SS-MONTH > SS-MONTH-MAX                04950012
049600                       MOVE US-MONTHLY-AMT      (SS-MONTH)        04960012
049700                         TO ODT-PADJ-RTL-AMT    (SS-MONTH)        04970012
049800                   END-PERFORM                                    04980012
99999                WHEN BOP-INVENTORY-REC                             04990027
050000                   PERFORM VARYING SS-MONTH FROM 1 BY 1           05000012
050100                     UNTIL SS-MONTH > SS-MONTH-MAX                05010012
050200                       MOVE US-MONTHLY-AMT      (SS-MONTH)        05020012
050300                         TO ODT-BEG-INV-RTL-AMT (SS-MONTH)        05030012
050400                   END-PERFORM                                    05040012
050600             END-EVALUATE                                         05060011
050700         END-EVALUATE                                             05070011
050800     END-EVALUATE                                                 05080025
99999      END-EVALUATE                                                 05081027
99999      END-EVALUATE.                                                05082027
050900                                                                  05090011
051000                                                                  05100011
051100******************************************************************05110011
051200*  THIS PARAGRAPH USES THE DATA THAT WAS TABLED FOR THE           05120011
051300*  DEPARTMENT TO BUILD AND WRITE ONE OUTPUT RECORD FOR EACH OTB   05130011
051400*  MONTH.                                                         05140011
051500******************************************************************05150011
051600 2300-BUILD-AND-WRITE-EXTRACT.                                    05160011
31355 *** BUILD THE PHYSICAL STORE RECORD....                           05175033
31355 **                                                                05176039
31355 **   IF RETAIL-STORE                                              05176139
               MOVE PV-PREV-DEPT-NBR     TO ML127-DEPT-NBR              05177039
               MOVE 'P'                  TO ML127-CHNL-CDE              05178039
                                                                        05179039
               PERFORM VARYING SS-MONTH FROM 1 BY 1                     05179139
                 UNTIL SS-MONTH > SS-MONTH-MAX                          05179239
                   MOVE FMT-FSCL-MN-NBR       (SS-MONTH)                05179339
                     TO ML127-FSCL-MN-NBR                               05179439
                   MOVE FMT-FSCL-MN-END-DTE   (SS-MONTH)                05179539
                     TO ML127-FSCL-MN-END-DTE                           05179639
                   MOVE ODT-SLS-RTL-AMT       (SS-MONTH)                05179739
                     TO ML127-SLS-RTL-AMT                               05179839
                   MOVE ODT-MKDN-RTL-AMT      (SS-MONTH)                05179939
                     TO ML127-MKDN-RTL-AMT                              05180039
                   MOVE ODT-RCPT-RTL-AMT      (SS-MONTH)                05180139
                     TO ML127-RCPT-RTL-AMT                              05180239
                   MOVE ODT-SHNK-RTL-AMT      (SS-MONTH)                05180339
                     TO ML127-SHNK-RTL-AMT                              05180439
                   MOVE ODT-END-INV-RTL-AMT   (SS-MONTH)                05180539
                     TO ML127-END-INV-RTL-AMT                           05180639
                   MOVE ODT-SLS-COST-AMT      (SS-MONTH)                05180739
                     TO ML127-SLS-COST-AMT                              05180839
                   MOVE ODT-TOT-ORD-RTL-AMT   (SS-MONTH)                05180939
                     TO ML127-TOT-ORD-RTL-AMT                           05181039
                   MOVE ODT-APP-ORD-RTL-AMT   (SS-MONTH)                05181139
                     TO ML127-APP-ORD-RTL-AMT                           05181239
                   MOVE ODT-APP-ORD-COST-AMT  (SS-MONTH)                05181339
                     TO ML127-APP-ORD-COST-AMT                          05181439
                   MOVE ODT-RCPT-NET-COST-AMT (SS-MONTH)                05181539
                     TO ML127-RCPT-NET-COST-AMT                         05181639
                   MOVE ODT-PADJ-NET-COST-AMT (SS-MONTH)                05181739
                     TO ML127-PADJ-NET-COST-AMT                         05181839
                   MOVE ODT-GRO-MRGN-AMT      (SS-MONTH)                05181939
                     TO ML127-GRO-MRGN-AMT                              05182039
                   MOVE ODT-PADJ-RTL-AMT      (SS-MONTH)                05182139
                     TO ML127-PADJ-RTL-AMT                              05182239
                   MOVE ODT-BEG-INV-RTL-AMT   (SS-MONTH)                05182339
                     TO ML127-BOM-INV-RTL-AMT                           05182439
                   PERFORM  7100-WRITE-MNTHLY-OTB-EXTRACT               05182539
W04031         END-PERFORM.                                             05182639
31355 **   END-IF.                                                      05182739
  |   **                                                                05182839
  |   *** BUILD THE VIRTUAL STORE RECORD....                            05182933
  |   **                                                                05183039
  |   **   IF VIRTUAL-STORE                                             05183139
  |   **       MOVE PV-PREV-DEPT-NBR     TO ML127-DEPT-NBR              05183239
  |   **       MOVE 'V'                  TO ML127-CHNL-CDE              05183339
  |   **                                                                05183439
  |   **       PERFORM VARYING SS-MONTH FROM 1 BY 1                     05183539
  |   **         UNTIL SS-MONTH > SS-MONTH-MAX                          05183639
  |   **           MOVE FMT-FSCL-MN-NBR       (SS-MONTH)                05183739
  |   **             TO ML127-FSCL-MN-NBR                               05183839
  |   **           MOVE FMT-FSCL-MN-END-DTE   (SS-MONTH)                05183939
  |   **             TO ML127-FSCL-MN-END-DTE                           05184039
  |   **           MOVE ODT-SLS-RTL-AMT       (SS-MONTH)                05184139
  |   **             TO ML127-SLS-RTL-AMT                               05184239
  |   **           MOVE ODT-MKDN-RTL-AMT      (SS-MONTH)                05184339
  |   **             TO ML127-MKDN-RTL-AMT                              05184439
  |   **           MOVE ODT-RCPT-RTL-AMT      (SS-MONTH)                05184539
  |   **             TO ML127-RCPT-RTL-AMT                              05184639
  |   **           MOVE ODT-SHNK-RTL-AMT      (SS-MONTH)                05184739
  |   **             TO ML127-SHNK-RTL-AMT                              05184839
  |   **           MOVE ODT-END-INV-RTL-AMT   (SS-MONTH)                05184939
  |   **             TO ML127-END-INV-RTL-AMT                           05185039
  |   **           MOVE ODT-SLS-COST-AMT      (SS-MONTH)                05185139
  |   **             TO ML127-SLS-COST-AMT                              05185239
  |   **           MOVE ODT-TOT-ORD-RTL-AMT   (SS-MONTH)                05185339
  |   **             TO ML127-TOT-ORD-RTL-AMT                           05185439
  |   **           MOVE ODT-APP-ORD-RTL-AMT   (SS-MONTH)                05185539
  |   **             TO ML127-APP-ORD-RTL-AMT                           05185639
  |   **           MOVE ODT-APP-ORD-COST-AMT  (SS-MONTH)                05185739
  |   **             TO ML127-APP-ORD-COST-AMT                          05185839
  |   **           MOVE ODT-RCPT-NET-COST-AMT (SS-MONTH)                05185939
  |   **             TO ML127-RCPT-NET-COST-AMT                         05186039
  |   **           MOVE ODT-PADJ-NET-COST-AMT (SS-MONTH)                05186139
  |   **             TO ML127-PADJ-NET-COST-AMT                         05186239
  |   **           MOVE ODT-GRO-MRGN-AMT      (SS-MONTH)                05186339
  |   **             TO ML127-GRO-MRGN-AMT                              05186439
  |   **           MOVE ODT-PADJ-RTL-AMT      (SS-MONTH)                05186539
  |   **             TO ML127-PADJ-RTL-AMT                              05186639
  |   **           MOVE ODT-BEG-INV-RTL-AMT   (SS-MONTH)                05186739
  |   **             TO ML127-BOM-INV-RTL-AMT                           05186839
  |   **           PERFORM  7100-WRITE-MNTHLY-OTB-EXTRACT               05186939
  |   **       END-PERFORM                                              05187039
  |   **   END-IF.                                                      05187139
  |   **                                                                05187239
31355 *** BUILD THE TOTAL COMPANY RECORD......                          05187333
31355                                                                   05187433
31355      MOVE PV-PREV-DEPT-NBR     TO ML127-DEPT-NBR.                 05187533
31355      MOVE 'A'                  TO ML127-CHNL-CDE.                 05188033
051900                                                                  05190011
052000     PERFORM VARYING SS-MONTH FROM 1 BY 1                         05200011
052100       UNTIL SS-MONTH > SS-MONTH-MAX                              05210011
052200         MOVE FMT-FSCL-MN-NBR       (SS-MONTH)                    05220011
052300           TO ML127-FSCL-MN-NBR                                   05230011
052400         MOVE FMT-FSCL-MN-END-DTE   (SS-MONTH)                    05240011
052500           TO ML127-FSCL-MN-END-DTE                               05250011
052600         MOVE ODT-SLS-RTL-AMT       (SS-MONTH)                    05260011
052700           TO ML127-SLS-RTL-AMT                                   05270011
052800         MOVE ODT-MKDN-RTL-AMT      (SS-MONTH)                    05280011
052900           TO ML127-MKDN-RTL-AMT                                  05290011
053000         MOVE ODT-RCPT-RTL-AMT      (SS-MONTH)                    05300011
053100           TO ML127-RCPT-RTL-AMT                                  05310011
053200         MOVE ODT-SHNK-RTL-AMT      (SS-MONTH)                    05320011
053300           TO ML127-SHNK-RTL-AMT                                  05330011
053400         MOVE ODT-END-INV-RTL-AMT   (SS-MONTH)                    05340011
053500           TO ML127-END-INV-RTL-AMT                               05350011
053600         MOVE ODT-SLS-COST-AMT      (SS-MONTH)                    05360011
053700           TO ML127-SLS-COST-AMT                                  05370011
053800         MOVE ODT-TOT-ORD-RTL-AMT   (SS-MONTH)                    05380011
053900           TO ML127-TOT-ORD-RTL-AMT                               05390011
054000         MOVE ODT-APP-ORD-RTL-AMT   (SS-MONTH)                    05400011
054100           TO ML127-APP-ORD-RTL-AMT                               05410011
054200         MOVE ODT-APP-ORD-COST-AMT  (SS-MONTH)                    05420011
054300           TO ML127-APP-ORD-COST-AMT                              05430011
054500         MOVE ODT-RCPT-NET-COST-AMT (SS-MONTH)                    05450012
054600           TO ML127-RCPT-NET-COST-AMT                             05460012
054700         MOVE ODT-PADJ-NET-COST-AMT (SS-MONTH)                    05470012
054800           TO ML127-PADJ-NET-COST-AMT                             05480012
054900         MOVE ODT-GRO-MRGN-AMT      (SS-MONTH)                    05490012
055000           TO ML127-GRO-MRGN-AMT                                  05500012
055100         MOVE ODT-PADJ-RTL-AMT      (SS-MONTH)                    05510012
055200           TO ML127-PADJ-RTL-AMT                                  05520012
055300         MOVE ODT-BEG-INV-RTL-AMT   (SS-MONTH)                    05530012
055400           TO ML127-BOM-INV-RTL-AMT                               05540012
055600         PERFORM  7100-WRITE-MNTHLY-OTB-EXTRACT                   05560011
055700     END-PERFORM.                                                 05570011
055800                                                                  05580011
055900                                                                  05590011
056000 7000-READ-DPT-OTB-FILE.                                          05600011
056100                                                                  05610011
056200     READ DPT-OTB-FILE                                            05620011
056300         INTO PV-DPT-OTB-REC                                      05630011
056400             AT END SET PS-END-OF-DPT-OTB-FILE TO TRUE.           05640011
056500                                                                  05650011
056600                                                                  05660011
056700 7050-READ-OTB-RUNDATE-FILE.                                      05670011
056800                                                                  05680011
056900     READ OTB-RUNDATE-FILE                                        05690011
057000         INTO PV-OTB-RUNDATE-REC                                  05700011
057100             AT END SET PS-END-OF-OTB-RUNDATE-FILE TO TRUE.       05710011
057200                                                                  05720011
057300                                                                  05730011
057400 7100-WRITE-MNTHLY-OTB-EXTRACT.                                   05740011
057500                                                                  05750011
057600     WRITE MNTHLY-OTB-EXTRACT-REC  FROM                           05760011
057700           ML127-MNTHLY-OTB-EXTRACT-REC.                          05770011
057800                                                                  05780011
057900                                                                  05790011
058000******************************************************************05800011
058100*  THIS PARAGRAPH RETRIEVES THE FISCAL-MONTH-END-DATE AND FISCAL- 05810011
058200*  MONTH-NUMBER FOR ALL 3 OTB MONTHS.  THESE VALUES WILL BE USED  05820011
058300*  TO BUILD THE OUTPUT RECORDS.                                   05830011
058400******************************************************************05840011
058500 8100-GET-OTB-MONTHS.                                             05850011
058600                                                                  05860011
058700     EXEC SQL                                                     05870011
058800          SELECT                                                  05880011
058900              A.FSCL_MN_END_DTE                                   05890011
059000             ,A.FSCL_MN_NBR                                       05900011
059100             ,B.FSCL_MN_END_DTE                                   05910011
059200             ,B.FSCL_MN_NBR                                       05920011
059300             ,C.FSCL_MN_END_DTE                                   05930011
059400             ,C.FSCL_MN_NBR                                       05940011
059500          INTO                                                    05950011
059600              :FMD-FSCL-MN-END-DTE-1                              05960011
059700             ,:FMD-FSCL-MN-NBR-1                                  05970011
059800             ,:FMD-FSCL-MN-END-DTE-2                              05980011
059900             ,:FMD-FSCL-MN-NBR-2                                  05990011
060000             ,:FMD-FSCL-MN-END-DTE-3                              06000011
060100             ,:FMD-FSCL-MN-NBR-3                                  06010011
060200          FROM                                                    06020011
060300              TDTATTR A                                           06030011
060400             ,TDTATTR B                                           06040011
060500             ,TDTATTR C                                           06050011
060600          WHERE                                                   06060011
060700              A.KY_DTE      = :DTATTR-KY-DTE                      06070011
060800          AND A.NFM_END_DTE = B.KY_DTE                            06080011
060900          AND B.NFM_END_DTE = C.KY_DTE                            06090011
061000     END-EXEC.                                                    06100011
061100                                                                  06110011
061200     EVALUATE TRUE                                                06120011
061300         WHEN SQLCODE = ZERO                                      06130011
061400             CONTINUE                                             06140011
061500         WHEN OTHER                                               06150011
061600             DISPLAY '** DTATTR-KY-DTE: ' DTATTR-KY-DTE           06160011
061700             MOVE    '8100-GET-OTB-MONTHS'                        06170011
061800                                          TO PV-PARAGRAPH-NAME    06180011
061900             MOVE    'SELECT ROWS FROM TDTATTR'                   06190011
062000                                          TO PV-DB2-OPER-ATTEMPTED06200011
062100             PERFORM 9998-SQL-ABEND                               06210011
062200     END-EVALUATE.                                                06220011
062300                                                                  06230011
062400                                                                  06240011
062500 9998-SQL-ABEND.                                                  06250011
062600                                                                  06260011
062700     MOVE +4013 TO PV-ABEND-CODE.                                 06270011
062800     DISPLAY ' '.                                                 06280011
062900     DISPLAY '** ABEND **         ** = SQLERROR'.                 06290011
063000     DISPLAY '** PROGRAM          ** = ' PV-PGM-NAME.             06300011
063100     DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.       06310011
063200     DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.   06320011
063300*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         06330011
063400*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        06340011
063500     COPY DPPD004.                                                06350011
063600     PERFORM 9999-ABEND.                                          06360011
063700                                                                  06370011
063800                                                                  06380011
063900 9999-ABEND.                                                      06390011
064000                                                                  06400011
064100     CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        06410011
