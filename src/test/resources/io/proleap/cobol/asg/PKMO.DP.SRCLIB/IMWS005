      *----------------------------------------------------------------*09/17/04
      *            IMWS005 - STORE SELECTION WORKING STORAGE           *        
      *                                                                *        
      *   IMWS005 WILL BE USED WITH IMPD005 TO CREATE A WORKING        *        
      *   STORAGE STORE TABLE THAT WILL BE USED TO DETERMINE IF THAT   *        
      *   STORE SHOULD BE USED FOR PROCESSING NEW PERM PRICE CHANGES.  *        
      *                                                                *        
      *----------------------------------------------------------------*        
      *   04/23/08  P. KEBER  WR#99999   CHANGE IM005_STR_CSR TO USE            
      *             FINANCIAL CLOSE DATE INSTEAD OF STORE CLOSE DATE.           
      *----------------------------------------------------------------*        
      *                                                                         
       01  IM005-PROGRAM-CONSTANTS.                                             
           05  IM005-PC-PROGRAM-NAME       PIC  X(08)  VALUE SPACES.            
           05  IM005-PC-MAX-RETRIES        PIC S9(04)  VALUE +2 COMP.           
           05  IM005-PC-MAX-STORES         PIC S9(04)  VALUE +9999 COMP.        
      *                                                                         
       01  IM005-PROGRAM-SWITCHES.                                              
           05  IM005-PS-ABEND-ERROR-SW     PIC X(01)   VALUE 'N'.               
               88  IM005-PS-ABEND-ERROR                VALUE 'Y'.               
               88  IM005-PS-NO-ABEND-ERROR             VALUE 'N'.               
           05  IM005-PS-MORE-ROWS-SW       PIC X(01)   VALUE 'N'.               
               88  IM005-PS-NO-MORE-ROWS               VALUE 'Y'.               
               88  IM005-PS-MORE-ROWS                  VALUE 'N'.               
      *                                                                         
       01  IM005-PROGRAM-VARIABLES.                                             
           05  IM005-PV-ABEND-SQLCODE      PIC S9(09)  VALUE +0 COMP.           
           05  IM005-PV-ABEND-CODE         PIC S9(04)  VALUE +0 COMP.           
           05  IM005-PV-STR-GP-TYP-CDE     PIC S9(04)  VALUE +0 COMP.           
           05  IM005-PV-STR-GP-ID          PIC S9(04)  VALUE +0 COMP.           
           05  IM005-PV-MAX-STORE          PIC S9(04)  VALUE +0 COMP.           
           05  IM005-PV-MAX-STR-GP-STR     PIC S9(04)  VALUE +0 COMP.           
           05  IM005-PV-RETRY-COUNT        PIC S9(04)  VALUE +0 COMP.           
           05  IM005-PV-ABEND-PARAGRAPH    PIC  X(30)  VALUE SPACES.            
           05  IM005-PV-ABEND-MESSAGE      PIC  X(30)  VALUE SPACES.            
           05  IM005-PV-EFF-DTE            PIC  X(10)  VALUE SPACES.            
      *                                                                         
       01  IM005-PROCESS-STORE-TABLE       VALUE LOW-VALUES.                    
           05  IM005-PROCESS-STORE-DATA    OCCURS 9999 TIMES                    
                                           INDEXED BY IM005-STORE-INDEX.        
               10  IM005-PROCESS-STORE-IND PIC  X.                              
      *                                                                         
       01  IM005-GROUP-STORE-TABLE.                                             
           05  IM005-GROUP-STORE-DATA      OCCURS 9999 TIMES                    
                                           INDEXED BY IM005-GP-STR-IDX.         
      ***      CONTAINS ENTRIES FOR IM005-PV-MAX-STR-GP-STR STORES              
               10  IM005-STR-GRP-STORE     PIC S9(04)  COMP.                    
      *                                                                         
      *                                                                         
      *   SET UP CURSOR FOR STORES TO BE PROCESSED                              
      *                                                                         
            EXEC SQL                                                            
                DECLARE IM005_STR_CSR CURSOR FOR                                
                   SELECT DISTINCT L.LOC_NBR                                    
                    FROM  XMT_LOC L                                             
                         ,XMT_DC_LOC_ASGMT D                                    
                    WHERE D.LOC_NBR = L.LOC_NBR                                 
                      AND L.FINCL_CLO_DTE > :IM005-PV-EFF-DTE                   
                      AND (L.OPN_DTE <= :IM005-PV-EFF-DTE                       
                           OR :IM005-PV-EFF-DTE >=                              
                               (SELECT MAX(X.EFF_BEG_DTE)                       
                                FROM XMT_DC_LOC_ASGMT X                         
                                WHERE X.LOC_NBR = D.LOC_NBR                     
                                AND X.EFF_BEG_DTE <= :IM005-PV-EFF-DTE))        
                     ORDER BY L.LOC_NBR                                         
            END-EXEC.                                                           
      *                                                                         
      *                                                                         
      *   SET UP CURSOR FOR STORE GROUP STORES                                  
      *                                                                         
            EXEC SQL                                                            
                DECLARE IM005_STR_GRP_CSR CURSOR FOR                            
                   SELECT LOC_NBR                                               
                    FROM  XMT_STR_GP_MBSHP                                      
                    WHERE STR_GP_TYP_CDE = :IM005-PV-STR-GP-TYP-CDE             
                      AND STR_GP_ID      = :IM005-PV-STR-GP-ID                  
                      AND EFF_BEG_DTE   <= :IM005-PV-EFF-DTE                    
                      AND (EFF_END_DTE IS NULL                                  
                           OR EFF_END_DTE  >= :IM005-PV-EFF-DTE)                
                     ORDER BY LOC_NBR                                           
            END-EXEC.                                                           
