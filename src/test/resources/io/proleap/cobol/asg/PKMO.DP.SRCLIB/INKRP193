      **********************************************************                
       IDENTIFICATION DIVISION.                                                 
      **********************************************************                
       PROGRAM-ID.      INKRP193.                                               
       AUTHOR.          SCOTT JACKSON.                                          
       DATE-WRITTEN.    OCTOBER, 2003                                           
                                                                                
      ******************************************************************        
      * PURPOSE. CREATE REPORT OF ALL ENTRIES ASSOCIATED WITH A RECORD *        
      *          SELECTED VIA A PHYSICAL INVENTORY ONLINE APPLICATION. *        
      *          INPUT CRITERIA WILL BE EITHER A SKU OR A SKU/UPC      *        
      *          COMBINATION.                                          *        
      ******************************************************************        
      *       DB2 TABLES: TSUMINV, TADJADD, TADJDTL,                            
      *                                                                         
      *         REPORT #: INKRP193-1                                            
      *                                                                *        
      *CHANGE HISTORY:                                                          
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES                   
      * ------- ---------- ----------- --------------------------------         
W26603*   CHANGES MADE:   S. JACKSON          WR26603 AS ENHANCEMENT            
W26603*      ADDED NUMBER OF LINES ALLOWABLE TO 80 (ALSO CHANGE PROC            
W26603*      PAGEDEF). RETRIEVE ADJ_TYPE_CDE TO DISPLAY ON REPORT.              
W26682* W26682 07-02-2004 ROD JANSSEN ADD THE ADJUSTMENT REASON CODE            
W26682*                               TO THE REPORT.                            
W26600* W26600 06-29-2004 ROD JANSSEN INV STORE EXPANSION.                      
W28545* W28545 08-10-2006 ADD COMMON PRICE LOOK UP COPYBOOKS TO REPLACE         
W28545*                   EXISTING LOGIC. - B.GRAHAM - STRATAGEM                
W28545* F28545 09-12-2006 -B. GRAHAM - STRATAGEM                      *         
W28545*      CHG PASS DATE FROM IN400-PV-EFF-BEG-DTE-IN TO            *         
W28545*                         IN400-PV-EFF-DTE-IN                   *         
W28545*****************************************************************         
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT STORE-CONTROL-FILE                                            
               ASSIGN TO INP01.                                                 
                                                                                
           SELECT DFLT-PRTR-FILE                                                
               ASSIGN TO OUT01.                                                 
                                                                                
           SELECT PRINT-FILE                                                    
               ASSIGN TO RPT01.                                                 
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  STORE-CONTROL-FILE                                                   
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS                                             
           RECORDING  MODE IS F                                                 
           DATA RECORD IS STORE-CONTROL-RECORD.                                 
       01  STORE-CONTROL-RECORD         PIC X(80).                              
                                                                                
       FD  DFLT-PRTR-FILE                                                       
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS                                             
           RECORDING  MODE IS F                                                 
           DATA RECORD IS DFLT-PRTR-RECORD.                                     
       01  DFLT-PRTR-RECORD             PIC X(80).                              
                                                                                
       FD  PRINT-FILE                                                           
           LABEL RECORDS ARE OMITTED                                            
           RECORD CONTAINS 90 CHARACTERS                                        
           RECORDING  MODE IS F                                                 
           DATA RECORD IS REPORT-RECORD.                                        
       01  PRINT-RECORD        PIC X(90).                                       
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  CD-CPU-DATE.                                                         
           05  CD-CPU-DATE-YY               PIC 9(2)       VALUE ZEROS.         
           05  CD-CPU-DATE-MM               PIC 9(2)       VALUE ZEROS.         
           05  CD-CPU-DATE-DD               PIC 9(2)       VALUE ZEROS.         
                                                                                
       01  CT-CPU-TIME.                                                         
           05  CD-CPU-TIME-HH               PIC 9(2)       VALUE ZEROS.         
           05  CD-CPU-TIME-MM               PIC 9(2)       VALUE ZEROS.         
           05  CD-CPU-TIME-SS               PIC 9(2)       VALUE ZEROS.         
           05  CD-CPU-TIME-HS               PIC 9(2)       VALUE ZEROS.         
                                                                                
       01  PA-PROGRAM-ACCUMULATORS.                                             
           05  PA-LINE-CNT                  PIC  9(3)   VALUE ZERO.             
           05  PA-PAGE-CNT                  PIC  9(3)   VALUE ZERO.             
           05  PA-TOTAL-QTY                 PIC  S9(9)      COMP.               
           05  PA-TOTAL-EXTD-AMT            PIC  S9(9)V9(2) COMP-3.             
           05  PA-SUB-QTY                   PIC  S9(9)      COMP.               
           05  PA-SUB-EXTD-AMT              PIC  S9(9)V9(2) COMP-3.             
           05  PA-DETAIL-CSR-COUNT          PIC  9(3)   VALUE ZERO.             
                                                                                
       01  PC-PROGRAM-CONTROLS.                                                 
W26603     05  PC-LINE-MAX                  PIC  9(3) VALUE  70.                
W26603*    05  PC-LINE-MAX                  PIC  9(3) VALUE  80.                
W26603*    05  PC-NEW-PAGE                  PIC S9(3) VALUE +99 COMP-3.         
           05  PC-PROGRAM-NAME              PIC X(08) VALUE 'INKRP193'.         
           05  PC-1                         PIC 9(02) VALUE 1.                  
           05  PC-MAX-RETRIES               PIC S9(3) VALUE +3 COMP-3.          
           05  PC-SKU-REPORT                PIC  X(3) VALUE 'SKU'.              
           05  PC-UPC-REPORT                PIC  X(3) VALUE 'UPC'.              
           05  PC-INV-SERVICE               PIC  X(3) VALUE 'SUM'.              
           05  PC-ADJUST-ADD                PIC  X(3) VALUE 'ADD'.              
           05  PC-ADJUST-DETAIL             PIC  X(3) VALUE 'DTL'.              
                                                                                
      *** FOR SYSTEM TEST:                                                      
      *    05  PC-CURRENT-DATE             PIC X(10) VALUE '2003-10-30'.        
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-END-OF-STORES-SW          PIC X(01)      VALUE 'N'.           
               88  PS-END-OF-STORES                        VALUE 'Y'.           
           05  PS-EOF-CSR-SW                PIC X(01)      VALUE 'N'.           
               88  PS-NO-EOF-CSR                           VALUE 'N'.           
               88  PS-EOF-CSR                              VALUE 'Y'.           
           05  PS-EOF-DTL-SW                PIC X(01)      VALUE 'N'.           
               88  PS-NO-EOF-DETAIL-CSR                    VALUE 'N'.           
               88  PS-EOF-DETAIL-CSR                       VALUE 'Y'.           
           05  PS-PROCESS-COMPLETE-SW       PIC X(01)      VALUE 'N'.           
               88  PS-PROCESS-COMPLETE                     VALUE 'Y'.           
      /                                                                         
       01  PV-PROGRAM-VARIABLES.                                                
                                                                                
W26682     05  PV-CTL-SUB                   PIC S9(05) COMP VALUE ZEROS.        
W26682     05  PV-CTL-END-PT                PIC S9(05) COMP VALUE ZEROS.        
W26600     05  PV-HOLD-STORE4.                                                  
W26600         10 PV-HOLD-STORE             PIC X(04)  VALUE SPACE.             
W26600***  05  PV-HOLD-STORE4.                                                  
W26600***      10 FILLER                    PIC  X(1)  VALUE SPACE.             
W26600***      10 PV-HOLD-STORE             PIC  X(3)  VALUE SPACE.             
           05  PV-HOLD-STORE-NBR            PIC  S9(4)      COMP.               
           05  PV-HOLD-AREA-NBR             PIC  S9(9) COMP  VALUE ZERO.        
           05  PV-HOLD-SKU-NBR              PIC  S9(8)V     COMP-3.             
           05  PV-HOLD-UPC-NBR              PIC  S9(15)V    COMP-3.             
           05  PV-HOLD-RETAIL               PIC  S9(7)V9(2) COMP-3.             
           05  PV-HOLD-QTY                  PIC  S9(9)      COMP.               
           05  PV-HOLD-EXTD-AMT             PIC  S9(9)V9(2) COMP-3.             
           05  PV-HOLD-DEPT-NBR             PIC  S9(4)V     COMP-3.             
           05  PV-HOLD-MAJ-CL-NBR           PIC  S9(4)V     COMP-3.             
           05  PV-HOLD-SUB-CL-NBR           PIC  S9(4)V     COMP-3.             
           05  PV-HOLD-DKEY-NBR             PIC  S9(9)      COMP.               
                                                                                
W26600     05  PV-HOLD-USERID               PIC   X(7)     VALUE SPACE.         
W26600                                                                          
           05  PV-SQL-SUB                   PIC   9(3)      VALUE ZERO.         
           05  PV-TEMP-SKU                  PIC  S9(8) COMP VALUE ZERO.         
           05  PV-WORK-SKU                  PIC   9(8) VALUE ZERO.              
           05  PV-TEMP-SKU-NBR.                                                 
               10  PV-TEMP-DEPT             PIC  9(3)  VALUE ZERO.              
               10  PV-TEMP-SUBCLASS         PIC  9(2)  VALUE ZERO.              
               10  PV-TEMP-SEQUENCE         PIC  9(3)  VALUE ZERO.              
           05  PV-TEMP-UPC                  PIC S9(15) COMP VALUE ZERO.         
           05  PV-TEMP-QTY                  PIC S9(06) COMP VALUE ZERO.         
           05  PV-TEMP-RETAIL               PIC S9(6)V9(2)  COMP-3.             
           05  PV-TEMP-EXTD-RETAIL          PIC S9(6)V9(2)  COMP-3.             
           05  PV-FROM-TABLE                PIC  X(03) VALUE SPACE.             
W26682     05  PV-REASON-TXT                PIC  X(20) VALUE SPACE.             
           05  PV-TIMESTAMP.                                                    
               10  PV-TIMESTAMP-DATE       PIC X(10)       VALUE SPACES.        
               10  FILLER REDEFINES PV-TIMESTAMP-DATE.                          
                   15  PV-TIMESTAMP-DATE-CCYY                                   
                                           PIC X(04).                           
                   15  FILLER              PIC X(01).                           
                   15  PV-TIMESTAMP-DATE-MM                                     
                                           PIC X(02).                           
                   15  FILLER              PIC X(01).                           
                   15  PV-TIMESTAMP-DATE-DD                                     
                                           PIC X(02).                           
               10  FILLER                  PIC X(01)       VALUE '-'.           
               10  PV-TIMESTAMP-TIME       PIC X(08)       VALUE SPACES.        
               10  FILLER REDEFINES PV-TIMESTAMP-TIME.                          
                   15  PV-TIMESTAMP-TIME-HR                                     
                                           PIC X(02).                           
                   15  FILLER              PIC X(01).                           
                   15  PV-TIMESTAMP-TIME-MIN                                    
                                           PIC X(02).                           
                   15  FILLER              PIC X(01).                           
                   15  PV-TIMESTAMP-TIME-SEC                                    
                                           PIC X(02).                           
               10  FILLER                  PIC X(01)       VALUE '.'.           
               10  FILLER                  PIC X(06)       VALUE                
                   '999999'.                                                    
           05  PV-MDY-DATE.                                                     
               10  PV-MDY-MM           PIC X(2).                                
               10  FILLER              PIC X     VALUE '/'.                     
               10  PV-MDY-DD           PIC X(2).                                
               10  FILLER              PIC X     VALUE '/'.                     
               10  PV-MDY-CCYY         PIC X(4).                                
                                                                                
                                                                                
W26682 01  PV-REASON-TBL.                                                       
W26682     05  PV-REASON-ELEMENTS           OCCURS 20 TIMES.                    
W26682         10  PV-REASON-BYTE           PIC X(01).                          
W26682                                                                          
       01  CC-CONTROL-CARD.                                                     
           05  CC-CONTROL-TYPE              PIC  X(3)   VALUE SPACES.           
           05  FILLER                       PIC  X(1)   VALUE SPACES.           
           05  CC-STORE-NBR                 PIC  9(4)   VALUE ZERO.             
           05  FILLER                       PIC  X(1)   VALUE SPACES.           
           05  CC-AREA-NBR                  PIC  9(7)   VALUE ZERO.             
           05  FILLER                       PIC  X(1)   VALUE SPACES.           
           05  CC-SKU-NBR                   PIC  9(8)   VALUE ZERO.             
           05  FILLER                       PIC  X(1)   VALUE SPACES.           
W28545     05  CC-RETAIL-AMT                PIC  X(9)   VALUE SPACES.           
           05  CC-RETAIL-AMT-NUM REDEFINES                                      
W28545         CC-RETAIL-AMT                PIC  9(7)V99.                       
W26600     05  CC-FILLER                    PIC  X(1)   VALUE SPACES.           
W26600     05  CC-USER-ID                   PIC  X(7)   VALUE SPACES.           
           05  CC-FILLER                    PIC  X(1)   VALUE SPACES.           
           05  CC-DFLT-PRTR-IND             PIC  X(1)   VALUE SPACES.           
W28545     05  CC-FILLER                    PIC  X(1)   VALUE SPACES.           
W28545     05  CC-DB2-ACTL-INV-DTE          PIC  X(10)  VALUE SPACES.           
                                                                                
      **************************************************                        
      *  HEADER RECORD                                                          
      **************************************************                        
                                                                                
       01  PR-HEADER-REC.                                                       
           05  PR-HEADER-NEW-PAGE                PIC X(02) VALUE SPACE.         
           05  PR-HEAD-RUN-DATE.                                                
               10  PR-HEAD-RUN-MONTH             PIC 9(02) VALUE ZERO.          
               10  FILLER                        PIC X(01) VALUE '/'.           
               10  PR-HEAD-RUN-DAY               PIC 9(02) VALUE ZERO.          
               10  FILLER                        PIC X(01) VALUE '/'.           
               10  PR-HEAD-RUN-YEAR              PIC 9(02) VALUE ZERO.          
           05  FILLER                            PIC X(02) VALUE SPACE.         
           05  PR-HEAD-RUN-DATE.                                                
               10  PR-HEAD-RUN-HOUR              PIC 9(02) VALUE ZERO.          
               10  FILLER                        PIC X(01) VALUE ':'.           
               10  PR-HEAD-RUN-MINUTE            PIC 9(02) VALUE ZERO.          
           05  FILLER                            PIC X(13) VALUE SPACE.         
           05  FILLER                            PIC X(18)                      
               VALUE 'PHYSICAL INVENTORY'.                                      
           05  FILLER                            PIC X(10) VALUE SPACE.         
           05  PR-HEAD-PROGRAM-NAME              PIC X(08) VALUE SPACE.         
           05  FILLER                            PIC X(01) VALUE '-'.           
           05  PR-HEAD-REPORT-NUMBER             PIC 9(01) VALUE ZERO.          
           05  PR-HEAD-REPORT-NUMBER-CHAR REDEFINES                             
               PR-HEAD-REPORT-NUMBER             PIC X(01).                     
           05  FILLER                            PIC X(02) VALUE SPACE.         
           05  FILLER                            PIC X(04) VALUE 'PAGE'.        
           05  PR-HEAD-PAGE-NUMBER               PIC Z9 VALUE ZERO.             
                                                                                
                                                                                
       01  PRINT-DATA.                                                          
           05  PR-PRINT-H1.                                                     
               10 FILLER                    PIC X(23)      VALUE SPACES.        
               10 FILLER                    PIC X(34)      VALUE                
                                   'ADJUSTMENT DETAIL SKU / UPC REPORT'.        
               10 FILLER                    PIC X(23)      VALUE SPACES.        
W26600     05  PR-REQUESTED-BY.                                                 
W26600         10 FILLER                    PIC X(15)      VALUE                
W26600                             'REQUESTED BY:  '.                           
W26600         10 PR-USER-NAME              PIC X(50)      VALUE SPACES.        
W26600         10 FILLER                    PIC X(15)      VALUE SPACES.        
           05  PR-PRINT-STORE.                                                  
               10 FILLER                    PIC X(08)      VALUE                
                                                          'STORE : '.           
               10 FILLER                    PIC X(02)      VALUE SPACES.        
               10 PR-PRINT-STORE-NBR        PIC X(04)      VALUE SPACES.        
               10 FILLER                    PIC X(01)      VALUE SPACES.        
               10 PR-PRINT-STORE-NAME       PIC X(20)      VALUE SPACES.        
               10 FILLER                    PIC X(45)      VALUE SPACES.        
           05  PR-EMPTY-LINE.                                                   
               10 FILLER                    PIC X(80)      VALUE SPACES.        
           05  PR-NO-DETAIL.                                                    
               10 FILLER                    PIC X(08)      VALUE SPACES.        
               10 FILLER                    PIC X(47)      VALUE                
                    'NO ADJUSTMENTS WERE FOUND FOR SPECIFIED REQUEST'.          
               10 FILLER                    PIC X(35)      VALUE SPACES.        
           05  PR-PRINT-AREA.                                                   
               10 FILLER                    PIC X(08)      VALUE                
                                                          'AREA  : '.           
               10 PR-PRINT-AREA-NBR         PIC 9(06)      VALUE ZEROES.        
               10 FILLER                    PIC X(46)      VALUE SPACES.        
      *    05  PR-PRINT-SKU.                                                    
      *        10 FILLER                    PIC X(08)      VALUE                
      *                                                   'SKU   : '.           
      *        10 PR-PRINT-SKU-NBR          PIC X(08)      VALUE ZEROES.        
      *        10 FILLER                    PIC X(44)      VALUE SPACES.        
           05  PR-PRINT-H2.                                                     
               10 FILLER                    PIC X(05)      VALUE                
                                            ' DEPT'.                            
               10 FILLER                    PIC X(05)      VALUE                
                                            '-SCL '.                            
               10 FILLER                    PIC X(01)      VALUE SPACES.        
               10 FILLER                    PIC X(10)      VALUE                
                                            'SKU NUMBER'.                       
               10 FILLER                    PIC X(15)      VALUE                
                                            '     UPC NUMBER'.                  
               10 FILLER                    PIC X(04)      VALUE SPACES.        
               10 FILLER                    PIC X(07)      VALUE                
                                            'RETAIL '.                          
               10 FILLER                    PIC X(08)      VALUE                
                                            '     QTY'.                         
               10 FILLER                    PIC X(06)      VALUE SPACES.        
               10 FILLER                    PIC X(08)      VALUE                
                                            'EXTD RTL'.                         
               10 FILLER                    PIC X(02)      VALUE SPACES.        
               10 FILLER                    PIC X(06)      VALUE                
                                            'SOURCE'.                           
               10 FILLER                    PIC X(02)      VALUE SPACES.        
               10 FILLER                    PIC X(11)      VALUE                
                                            '    DATE'.                         
                                                                                
           05  PR-DETAIL-REC.                                                   
               10 FILLER                    PIC X(01)      VALUE SPACES.        
               10 PR-DEPT-NBR               PIC 9(04)      VALUE ZEROES.        
               10 FILLER                    PIC X(01)      VALUE '-'.           
               10 PR-SCL-NBR                PIC 9(04)      VALUE ZEROES.        
               10 FILLER                    PIC X(02)      VALUE SPACES.        
               10 PR-SKU-NBR                PIC 9(8)       VALUE ZEROES.        
               10 FILLER                    PIC X(1)       VALUE SPACES.        
               10 PR-UPC-NBR                PIC ZZZZZZZZZZZZZZ9.                
PM3403*        10 FILLER                    PIC X(2)       VALUE SPACES.        
PM3403*        10 PR-RETAIL                 PIC Z,ZZZ.99- VALUE ZEROES.         
PM3403         10 FILLER                    PIC X(1)       VALUE SPACES.        
PM3403         10 PR-RETAIL                 PIC ZZ,ZZZ.99- VALUE ZEROES.        
               10 FILLER                    PIC X(01)      VALUE SPACES.        
               10 PR-QTY                    PIC ZZZ,ZZ9-   VALUE ZEROES.        
               10 FILLER                    PIC X(01)      VALUE SPACES.        
               10 PR-EXTD-RETAIL            PIC Z,ZZZ,ZZZ.99-                   
                                                           VALUE ZEROES.        
               10 FILLER                    PIC X(01)      VALUE SPACES.        
W26682         10 PR-SOURCE-TABLE           PIC X(08)      VALUE SPACES.        
               10 FILLER                    PIC X(01)      VALUE SPACES.        
               10 PR-DATE                   PIC X(10)      VALUE SPACES.        
               10 FILLER                    PIC X(01)      VALUE SPACES.        
           05  PR-SUB-REC.                                                      
               10 FILLER                    PIC X(10)      VALUE                
                  'SUB-TOTAL:'.                                                 
               10 FILLER                    PIC X(09)      VALUE SPACES.        
               10 FILLER                    PIC X(5)       VALUE SPACES.        
               10 FILLER                    PIC X(11)      VALUE SPACES.        
               10 FILLER                    PIC X(13)      VALUE SPACES.        
               10 PR-SUB-QUANTITY           PIC ZZZ,ZZ9-.                       
      *        10 FILLER                    PIC X(01)      VALUE SPACES.        
               10 PR-SUB-EXTD-RETAIL        PIC ZZ,ZZZ,ZZ9.99-.                 
               10 FILLER                    PIC X(07)      VALUE SPACES.        
           05  PR-SUB-LINE.                                                     
               10 FILLER                    PIC X(47)     VALUE SPACES.         
               10 FILLER                    PIC X(09)      VALUE                
                                                           '---------'.         
               10 FILLER                    PIC X(02)      VALUE SPACES.        
               10 FILLER                    PIC X(11)      VALUE                
                                                          '-----------'.        
               10 FILLER                    PIC X(08)      VALUE SPACES.        
           05  PR-TOT-REC.                                                      
               10 FILLER                    PIC X(12)      VALUE                
                  'GRAND TOTAL:'.                                               
               10 FILLER                    PIC X(07)      VALUE SPACES.        
               10 FILLER                    PIC X(5)       VALUE SPACES.        
               10 FILLER                    PIC X(11)      VALUE SPACES.        
               10 FILLER                    PIC X(11)      VALUE SPACES.        
               10 PR-TOT-QUANTITY           PIC Z,ZZZ,ZZ9-.                     
               10 PR-TOT-EXTD-RETAIL        PIC ZZ,ZZZ,ZZ9.99-.                 
               10 FILLER                    PIC X(05)      VALUE SPACES.        
                                                                                
      ***************************************************************           
      **  OUTPUT - EMAIL MESSAGE                                                
      ***************************************************************           
       01  EM-MESSAGE-DETAIL.                                                   
           05  FILLER                  PIC X(21)  VALUE                         
               'NO DEFAULT PRINTER:  '.                                         
           05  EM-USERID               PIC X(07)  VALUE SPACES.                 
           05  FILLER                  PIC X(02)  VALUE SPACES.                 
           05  EM-USER-NAME            PIC X(50)  VALUE SPACES.                 
                                                                                
       01  ABEND-CODE                       PIC S9(04)     VALUE +0             
                                                           COMP SYNC.           
           88  ABEND-4001-WRITE-ERROR                      VALUE +4001.         
           88  ABEND-4002-READ-ERROR                       VALUE +4002.         
           88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003.         
           88  ABEND-4004-TABLE-ERROR                      VALUE +4004.         
           88  ABEND-4005-OPEN-ERROR                       VALUE +4005.         
           88  ABEND-4006-CLOSE-ERROR                      VALUE +4006.         
           88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007.         
           88  ABEND-4008-DATS-ERROR                       VALUE +4008.         
           88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009.         
           88  ABEND-4013-DB2-ERROR                        VALUE +4013.         
           88  ABEND-4019-DATE-ROUTINE                     VALUE +4019.         
                                                                                
      *                                                                         
      * DB2 COMMUNICATION AREA.                                                 
      *                                                                         
           EXEC SQL                                                             
               INCLUDE XMT00001                                                 
           END-EXEC.                                                            
      *                                                                         
      *---------------------------------------------------------------*         
      *    DB2 AREA FOR SUMMARIZED INVENTORY DATA TABLE               *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
                INCLUDE TSUMINV                                                 
           END-EXEC.                                                            
      *---------------------------------------------------------------*         
      *    DB2 AREA FOR ADJUSTMENT ADD TABLE                          *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
                INCLUDE TADJADD                                                 
           END-EXEC.                                                            
      *---------------------------------------------------------------*         
      *    DB2 AREA FOR ADJUSTMENT DETAIL TABLE                       *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
                INCLUDE TADJDTL                                                 
           END-EXEC.                                                            
      *---------------------------------------------------------------*         
      *    DB2 AREA AND WS AREA FOR COMMON PRICING INWS400            *         
      *---------------------------------------------------------------*         
                                                                                
           COPY INWS400.                                                        
                                                                                
W26600*---------------------------------------------------------------*         
W26600*    DB2 AREA FOR USER TABLE                                    *         
W26600*---------------------------------------------------------------*         
W26600     EXEC SQL                                                             
W26600          INCLUDE TUSER                                                   
W26600     END-EXEC.                                                            
      *---------------------------------------------------------------*         
      *    DB2 AREA FOR COMMUNICATIONS                                *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
                INCLUDE SQLCA                                                   
           END-EXEC.                                                            
                                                                                
           COPY SQLCA2.                                                         
                                                                                
      *---------------------------------------------------------------*         
      *    TSUMINV UNION WITH TADJADD, TADJDTL CURSOR DECLARATION.    *         
      *    THIS REPORT IS AT A STORE / AREA LEVEL AND CAN BE          *         
      *    REQUESTED FROM INKCS010 OR INKCS011                        *         
      *---------------------------------------------------------------*         
                                                                                
           EXEC SQL                                                             
                DECLARE SUMMARY_CSR1 CURSOR                                     
                FOR SELECT                                                      
                      SKU_NBR                                                   
                    , UPC_NBR                                                   
                    , INV_UNIT_PR_AMT                                           
                    , INV_QTY                                                   
                    , EXTD_AMT                                                  
                    , DKEY_NBR                                                  
                    , CHG_TMST                                                  
                    , 'SUM'                                                     
W26682              , ''                                                        
                FROM  TSUMINV                                                   
W26600          WHERE LOC_NBR      =   :PV-HOLD-STORE-NBR                       
                  AND AREA_NBR     =   :PV-HOLD-AREA-NBR                        
              UNION                                                             
                SELECT                                                          
                      SKU_NBR                                                   
                    , UPC_NBR                                                   
                    , ADJ_UNIT_PR_AMT                                           
                    , ADJ_QTY                                                   
                    , ADJ_EXTD_AMT                                              
                    , DKEY_NBR                                                  
                    , CHG_TMST                                                  
                    , 'ADD'                                                     
W26682              , ADJ_RSN_TXT                                               
                FROM  TADJADD                                                   
W26600          WHERE LOC_NBR      =   :PV-HOLD-STORE-NBR                       
                  AND AREA_NBR     =   :PV-HOLD-AREA-NBR                        
      *       UNION                                                             
      *         SELECT                                                          
      *               SKU_NBR                                                   
      *             , UPC_NBR                                                   
      *             , ADJ_UNIT_PR_AMT                                           
      *             , ADJ_QTY                                                   
      *             , ADJ_EXTD_AMT                                              
      *             , 'DTL'                                                     
W26682*             , ADJ_RSN_TXT                                               
      *         FROM  TADJDTL                                                   
W26600*         WHERE LOC_NBR      =   :PV-HOLD-STORE-NBR                       
      *           AND AREA_NBR     =   :PV-HOLD-AREA-NBR                        
                ORDER BY 1, 2                                                   
           END-EXEC.                                                            
                                                                                
                                                                                
      *---------------------------------------------------------------*         
      *    TSUMINV UNION WITH TADJADD CURSOR DECLARATION.             *         
      *    SELECT SKU / RETAIL SPECIFIC ROWS (FROM INKCS013)          *         
      *---------------------------------------------------------------*         
                                                                                
           EXEC SQL                                                             
                DECLARE SUMMARY_CSR2 CURSOR                                     
                FOR SELECT                                                      
                      SKU_NBR                                                   
                    , UPC_NBR                                                   
                    , INV_UNIT_PR_AMT                                           
                    , INV_QTY                                                   
                    , EXTD_AMT                                                  
                    , DKEY_NBR                                                  
                    , CHG_TMST                                                  
                    , 'SUM'                                                     
W26682              , ''                                                        
                FROM  TSUMINV                                                   
W26600          WHERE LOC_NBR         =  :PV-HOLD-STORE-NBR                     
                  AND AREA_NBR        =  :PV-HOLD-AREA-NBR                      
                  AND SKU_NBR         =  :PV-HOLD-SKU-NBR                       
                  AND INV_UNIT_PR_AMT =  :PV-HOLD-RETAIL                        
              UNION                                                             
                SELECT                                                          
                      SKU_NBR                                                   
                    , UPC_NBR                                                   
                    , ADJ_UNIT_PR_AMT                                           
                    , ADJ_QTY                                                   
                    , ADJ_EXTD_AMT                                              
                    , DKEY_NBR                                                  
                    , CHG_TMST                                                  
                    , 'ADD'                                                     
W26682              , ADJ_RSN_TXT                                               
                FROM  TADJADD                                                   
W26600          WHERE LOC_NBR         =  :PV-HOLD-STORE-NBR                     
                  AND AREA_NBR        =  :PV-HOLD-AREA-NBR                      
                  AND SKU_NBR         =  :PV-HOLD-SKU-NBR                       
                  AND ADJ_UNIT_PR_AMT =  :PV-HOLD-RETAIL                        
           END-EXEC.                                                            
                                                                                
                                                                                
      *---------------------------------------------------------------*         
      *    TADJDTL CURSOR DECLARATION.                                *         
      *    SELECT ADJUSTMENT DETAIL ROWS BASED ON DKEY_NBR            *         
      *---------------------------------------------------------------*         
                                                                                
           EXEC SQL                                                             
                DECLARE DETAIL_CSR  CURSOR                                      
                                                                                
                FOR SELECT                                                      
                      SKU_NBR                                                   
                    , UPC_NBR                                                   
                    , ADJ_UNIT_PR_AMT                                           
                    , ADJ_QTY                                                   
                    , ADJ_EXTD_AMT                                              
                    , 'DTL'                                                     
W26682              , ADJ_RSN_TXT                                               
                FROM  TADJDTL                                                   
W26600          WHERE LOC_NBR         =  :PV-HOLD-STORE-NBR                     
                  AND AREA_NBR        =  :PV-HOLD-AREA-NBR                      
                  AND DKEY_NBR        =  :PV-HOLD-DKEY-NBR                      
                ORDER BY SKU_NBR, UPC_NBR, CRE_TMST                             
           END-EXEC.                                                            
                                                                                
                                                                                
      ****************************************************************          
       PROCEDURE DIVISION.                                                      
      ****************************************************************          
                                                                                
       0001-MAINLINE.                                                           
                                                                                
           PERFORM 1000-INITIALIZE.                                             
                                                                                
           IF PS-END-OF-STORES                                                  
               PERFORM 2000-PROCESS-NO-DATA                                     
           ELSE                                                                 
               PERFORM 2100-PROCESS-RECORDS                                     
                   UNTIL PS-PROCESS-COMPLETE                                    
           END-IF.                                                              
                                                                                
           PERFORM 8500-END-PROCESSING.                                         
                                                                                
           STOP RUN.                                                            
                                                                                
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
                                                                                
       1000-INITIALIZE.                                                         
                                                                                
           OPEN INPUT  STORE-CONTROL-FILE                                       
                OUTPUT DFLT-PRTR-FILE                                           
                       PRINT-FILE.                                              
                                                                                
           INITIALIZE PV-PROGRAM-VARIABLES                                      
                      PA-PROGRAM-ACCUMULATORS.                                  
                                                                                
           PERFORM 1100-PREPARE-REPORT.                                         
                                                                                
           MOVE PC-1                   TO PR-HEAD-REPORT-NUMBER.                
           MOVE PC-PROGRAM-NAME        TO PR-HEAD-PROGRAM-NAME.                 
                                                                                
W26600     STRING USER-USR-1ST-NM  DELIMITED BY "  "                            
W26600            SPACE DELIMITED  SIZE                                         
W26600            USER-USR-LAST-NM  DELIMITED BY "  "                           
W26600       INTO PR-USER-NAME                                                  
W26600     END-STRING.                                                          
W26600                                                                          
           MOVE PR-USER-NAME           TO EM-USER-NAME.                         
           IF CC-DFLT-PRTR-IND = 'N'                                            
             PERFORM 7200-PRINT-ERROR-REPORT                                    
           END-IF.                                                              
                                                                                
           PERFORM 7000-PRINT-HEADINGS.                                         
                                                                                
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       1100-PREPARE-REPORT.                                                     
           ACCEPT CT-CPU-TIME FROM TIME.                                        
           MOVE CD-CPU-TIME-HH         TO PR-HEAD-RUN-HOUR.                     
           MOVE CD-CPU-TIME-MM         TO PR-HEAD-RUN-MINUTE.                   
                                                                                
           ACCEPT CD-CPU-DATE FROM DATE.                                        
                                                                                
           DISPLAY 'CURRENT-DATE=>' CD-CPU-DATE.                                
                                                                                
      *** FOR SYSTEM TEST:                                                      
      *    DISPLAY 'TEST CURRENT DATE: ' PC-CURRENT-DATE.                       
                                                                                
           MOVE CD-CPU-DATE-MM         TO PR-HEAD-RUN-MONTH.                    
           MOVE CD-CPU-DATE-DD         TO PR-HEAD-RUN-DAY.                      
           MOVE CD-CPU-DATE-YY         TO PR-HEAD-RUN-YEAR.                     
                                                                                
           PERFORM 1200-PREPARE-HEADER.                                         
      *                                                                         
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
                                                                                
       1200-PREPARE-HEADER.                                                     
      *                                                                         
           PERFORM 8000-READ-STORE-CONTROL.                                     
                                                                                
           IF PS-END-OF-STORES                                                  
               CONTINUE                                                         
           ELSE                                                                 
               MOVE CC-STORE-NBR                TO PV-HOLD-STORE4               
                                                   PV-HOLD-STORE-NBR            
                                                   PR-PRINT-STORE-NBR           
               MOVE CC-AREA-NBR                 TO PV-HOLD-AREA-NBR             
                                                   PR-PRINT-AREA-NBR            
               MOVE CC-SKU-NBR                  TO PV-HOLD-SKU-NBR              
               MOVE CC-RETAIL-AMT-NUM           TO PV-HOLD-RETAIL               
W26600         MOVE CC-USER-ID                  TO PV-HOLD-USERID               
                                                   EM-USERID                    
W26600         PERFORM 6300-GET-USER-NAME                                       
                                                                                
               MOVE PV-HOLD-STORE-NBR           TO XMT00001-LOC-NBR             
               PERFORM 6000-GET-STORE-NAME                                      
                                                                                
           END-IF.                                                              
           DISPLAY 'CC-CONTROL-TYPE ' CC-CONTROL-TYPE.                          
           DISPLAY 'CC-STORE-NBR ' CC-STORE-NBR                                 
           DISPLAY 'CC-AREA-NBR  ' CC-AREA-NBR                                  
           DISPLAY 'CC-SKU-NBR  ' CC-SKU-NBR                                    
           DISPLAY 'CC-RETAIL-AMT ' CC-RETAIL-AMT                               
W28545     DISPLAY 'CC-USER-ID ' CC-USER-ID                                     
W26600     DISPLAY 'CC-DFLT-PRTR-IND 'CC-DFLT-PRTR-IND                          
           DISPLAY 'CC-DB2-ACTL-INV-DTE ' CC-DB2-ACTL-INV-DTE.                  
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
      *                                                                         
       2000-PROCESS-NO-DATA.                                                    
           WRITE PRINT-RECORD                                                   
               FROM PR-NO-DETAIL                                                
               AFTER ADVANCING 2 LINES.                                         
                                                                                
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       2100-PROCESS-RECORDS.                                                    
                                                                                
           IF CC-CONTROL-TYPE = PC-SKU-REPORT                                   
              PERFORM 3000-PROCESS-SKUS                                         
           ELSE                                                                 
              IF CC-CONTROL-TYPE = PC-UPC-REPORT                                
                  PERFORM 4000-PROCESS-UPCS                                     
              ELSE                                                              
                  DISPLAY 'NO REPORT WAS SELECTED'                              
              END-IF                                                            
           END-IF.                                                              
                                                                                
           SET PS-PROCESS-COMPLETE TO TRUE.                                     
                                                                                
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
      *                                                                         
       3000-PROCESS-SKUS.                                                       
                                                                                
           PERFORM 3100-OPEN-CSR1-CSR.                                          
           PERFORM 3200-FETCH-CSR1-RECORDS                                      
               UNTIL PS-EOF-CSR.                                                
           PERFORM 3300-CLOSE-CSR1-CSR.                                         
                                                                                
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       3100-OPEN-CSR1-CSR.                                                      
           PERFORM                                                              
              WITH TEST AFTER                                                   
              VARYING PV-SQL-SUB FROM 1 BY 1                                    
              UNTIL PV-SQL-SUB > PC-MAX-RETRIES OR                              
                    SQLCODE = 0 OR                                              
                    SQLCODE = 100                                               
                                                                                
                  EXEC SQL                                                      
                      OPEN SUMMARY_CSR1                                         
                  END-EXEC                                                      
                                                                                
              EVALUATE TRUE                                                     
                  WHEN SQLCODE = ZERO                                           
                  WHEN SQLCODE  = +100                                          
                       CONTINUE                                                 
                  WHEN SQLCODE = -911                                           
                    IF PV-SQL-SUB > PC-MAX-RETRIES                              
                      DISPLAY 'MAX RETRIES EXCEEDED ON OPEN CURSOR'             
                      PERFORM 9900-SQL-ERROR                                    
                    END-IF                                                      
                  WHEN SQLCODE > ZERO                                           
                  WHEN SQLWARN0 = 'W'                                           
                       DISPLAY 'WARNING ON OPEN OF CSR1'                        
                       PERFORM 9100-SQL-WARNING                                 
                  WHEN OTHER                                                    
                       DISPLAY 'ERROR ON OPEN OF CSR1'                          
                       PERFORM 9900-SQL-ERROR                                   
              END-EVALUATE                                                      
           END-PERFORM.                                                         
                                                                                
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
                                                                                
       3200-FETCH-CSR1-RECORDS.                                                 
                                                                                
           PERFORM                                                              
              WITH TEST AFTER                                                   
              VARYING PV-SQL-SUB FROM 1 BY 1                                    
              UNTIL PV-SQL-SUB > PC-MAX-RETRIES OR                              
                    SQLCODE = 0 OR                                              
                    SQLCODE = 100                                               
                                                                                
                  EXEC SQL                                                      
                      FETCH SUMMARY_CSR1                                        
                  INTO                                                          
                       :SUMINV-SKU-NBR                                          
                      ,:SUMINV-UPC-NBR                                          
                      ,:SUMINV-INV-UNIT-PR-AMT                                  
                      ,:SUMINV-INV-QTY                                          
                      ,:SUMINV-EXTD-AMT                                         
                      ,:SUMINV-DKEY-NBR                                         
                      ,:SUMINV-CHG-TMST                                         
                      ,:PV-FROM-TABLE                                           
W26682                ,:PV-REASON-TXT                                           
                  END-EXEC                                                      
                                                                                
              EVALUATE TRUE                                                     
                  WHEN SQLCODE = ZERO                                           
                       PERFORM 3400-PROCESS-ROW                                 
                       PERFORM 5000-PROCESS-DETAIL-ENTRIES                      
                  WHEN SQLCODE = +100                                           
                       MOVE 'Y' TO PS-EOF-CSR-SW                                
                  WHEN SQLCODE  = -911                                          
                       IF PV-SQL-SUB > PC-MAX-RETRIES                           
                          DISPLAY 'MAX RETRIES EXCEEDED ON SUMMARY_CSR1'        
                          PERFORM 9900-SQL-ERROR                                
                       END-IF                                                   
                  WHEN SQLCODE  > ZERO                                          
                  WHEN SQLWARN0 = 'W'                                           
                       DISPLAY 'WARNING ON FETCH OF SUMMARY_CSR1'               
                       PERFORM 9100-SQL-WARNING                                 
                  WHEN OTHER                                                    
                       DISPLAY 'ERROR ON FETCH OF SUMMARY_CSR1'                 
                       PERFORM 9900-SQL-ERROR                                   
              END-EVALUATE                                                      
           END-PERFORM.                                                         
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       3300-CLOSE-CSR1-CSR.                                                     
                                                                                
               EXEC SQL                                                         
                   CLOSE SUMMARY_CSR1                                           
               END-EXEC                                                         
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN SQLCODE  > ZERO                                             
               WHEN SQLWARN0 = 'W'                                              
                    DISPLAY 'WARNING ON CLOSE OF SUMMARY_CSR1'                  
                    PERFORM 9100-SQL-WARNING                                    
               WHEN OTHER                                                       
                    DISPLAY 'ERROR ON CLOSE OF SUMMARY_CSR1'                    
                    PERFORM 9900-SQL-ERROR                                      
           END-EVALUATE.                                                        
      /                                                                         
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       3400-PROCESS-ROW.                                                        
      *                                                                         
           MOVE SUMINV-SKU-NBR           TO PV-TEMP-SKU                         
                                            PV-WORK-SKU.                        
           MOVE PV-TEMP-SKU              TO PR-SKU-NBR.                         
           MOVE PV-WORK-SKU              TO PV-TEMP-SKU-NBR.                    
                                                                                
           MOVE SUMINV-UPC-NBR           TO PV-TEMP-UPC.                        
           MOVE PV-TEMP-UPC              TO PR-UPC-NBR.                         
                                                                                
           MOVE SUMINV-INV-UNIT-PR-AMT   TO PV-TEMP-RETAIL.                     
           MOVE PV-TEMP-RETAIL           TO PR-RETAIL.                          
                                                                                
           MOVE SUMINV-INV-QTY           TO PV-TEMP-QTY.                        
           MOVE PV-TEMP-QTY              TO PR-QTY.                             
                                                                                
           MOVE SUMINV-EXTD-AMT          TO PV-TEMP-EXTD-RETAIL.                
           MOVE PV-TEMP-EXTD-RETAIL      TO PR-EXTD-RETAIL.                     
                                                                                
           MOVE SUMINV-CHG-TMST          TO PV-TIMESTAMP.                       
           MOVE PV-TIMESTAMP-DATE-MM     TO PV-MDY-MM.                          
           MOVE PV-TIMESTAMP-DATE-DD     TO PV-MDY-DD.                          
           MOVE PV-TIMESTAMP-DATE-CCYY   TO PV-MDY-CCYY.                        
           MOVE PV-MDY-DATE              TO PR-DATE.                            
                                                                                
           EVALUATE PV-FROM-TABLE                                               
               WHEN PC-INV-SERVICE                                              
                   MOVE 'INVSRVC' TO PR-SOURCE-TABLE                            
               WHEN PC-ADJUST-ADD                                               
                   MOVE 'ADD'     TO PR-SOURCE-TABLE                            
W26682             PERFORM 10000-EDIT-REASON-TXT                                
W26682                 THRU 10000-EDIT-REASON-TXT-EXIT                          
               WHEN PC-ADJUST-DETAIL                                            
                   MOVE 'ADJUST'  TO PR-SOURCE-TABLE                            
W26682             PERFORM 10000-EDIT-REASON-TXT                                
W26682                 THRU 10000-EDIT-REASON-TXT-EXIT                          
           END-EVALUATE.                                                        
                                                                                
      **   ACCUMULATE TOTALS                                                    
           COMPUTE PA-SUB-QTY      = PA-SUB-QTY      + SUMINV-INV-QTY.          
           COMPUTE PA-TOTAL-QTY    = PA-TOTAL-QTY    + SUMINV-INV-QTY.          
                                                                                
           COMPUTE PA-SUB-EXTD-AMT    =                                         
                                PA-SUB-EXTD-AMT   + SUMINV-EXTD-AMT.            
           COMPUTE PA-TOTAL-EXTD-AMT =                                          
                                PA-TOTAL-EXTD-AMT + SUMINV-EXTD-AMT.            
                                                                                
      **   SKU ATTRIBUTE PROCESSING                                             
           PERFORM 3500-PROCESS-SKU                                             
      *                                                                         
      **   PRINT A REPORT LINE                                                  
           PERFORM 7100-PRINT-DETAIL-LINE.                                      
      *                                                                         
      *                                                                         
      ******************************************************************        
      *    GET THE SKU ATTRIBUTES (EITHER FROM TSUMINV OR COMMON PRICING        
      *    INPD400)                                                             
      ******************************************************************        
      *                                                                         
       3500-PROCESS-SKU.                                                        
      *                                                                         
      *    A DUMMY SKU HAS A SEQUENCE NUMBER OF 000                             
           IF  PV-TEMP-SEQUENCE = 0                                             
               MOVE PV-TEMP-DEPT       TO PR-DEPT-NBR                           
               MOVE PV-TEMP-SUBCLASS   TO PR-SCL-NBR                            
           ELSE                                                                 
               IF PV-FROM-TABLE = 'SUM'                                         
                   PERFORM 6100-GET-TSUMINV-ATTR                                
                   MOVE SUMINV-DEPT-NBR   TO PR-DEPT-NBR                        
                   MOVE SUMINV-SUB-CL-NBR TO PR-SCL-NBR                         
               ELSE                                                             
                   PERFORM 6200-GET-INPD400-ATTR                                
                   MOVE IN400-ATT-DEPT-OUT  TO  PR-DEPT-NBR                     
                   MOVE IN400-ATT-SCL-OUT   TO  PR-SCL-NBR                      
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
      *                                                                         
       4000-PROCESS-UPCS.                                                       
                                                                                
           PERFORM 4100-OPEN-CSR2-CSR.                                          
           PERFORM 4200-FETCH-CSR2-RECORDS                                      
               UNTIL PS-EOF-CSR.                                                
           PERFORM 4300-CLOSE-CSR2-CSR.                                         
                                                                                
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       4100-OPEN-CSR2-CSR.                                                      
           PERFORM                                                              
              WITH TEST AFTER                                                   
              VARYING PV-SQL-SUB FROM 1 BY 1                                    
              UNTIL PV-SQL-SUB > PC-MAX-RETRIES OR                              
                    SQLCODE = 0 OR                                              
                    SQLCODE = 100                                               
                                                                                
                  EXEC SQL                                                      
                      OPEN SUMMARY_CSR2                                         
                  END-EXEC                                                      
                                                                                
              EVALUATE TRUE                                                     
                  WHEN SQLCODE = ZERO                                           
                  WHEN SQLCODE  = +100                                          
                       CONTINUE                                                 
                  WHEN SQLCODE = -911                                           
                    IF PV-SQL-SUB > PC-MAX-RETRIES                              
                      DISPLAY 'MAX RETRIES EXCEEDED ON OPEN CURSOR'             
                      PERFORM 9900-SQL-ERROR                                    
                    END-IF                                                      
                  WHEN SQLCODE > ZERO                                           
                  WHEN SQLWARN0 = 'W'                                           
                       DISPLAY 'WARNING ON OPEN OF CSR2'                        
                       PERFORM 9100-SQL-WARNING                                 
                  WHEN OTHER                                                    
                       DISPLAY 'ERROR ON OPEN OF CSR2'                          
                       PERFORM 9900-SQL-ERROR                                   
              END-EVALUATE                                                      
           END-PERFORM.                                                         
                                                                                
                                                                                
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       4200-FETCH-CSR2-RECORDS.                                                 
                                                                                
           PERFORM                                                              
              WITH TEST AFTER                                                   
              VARYING PV-SQL-SUB FROM 1 BY 1                                    
              UNTIL PV-SQL-SUB > PC-MAX-RETRIES OR                              
                    SQLCODE = 0 OR                                              
                    SQLCODE = 100                                               
                                                                                
                  EXEC SQL                                                      
                      FETCH SUMMARY_CSR2                                        
                  INTO                                                          
                       :SUMINV-SKU-NBR                                          
                      ,:SUMINV-UPC-NBR                                          
                      ,:SUMINV-INV-UNIT-PR-AMT                                  
                      ,:SUMINV-INV-QTY                                          
                      ,:SUMINV-EXTD-AMT                                         
                      ,:SUMINV-DKEY-NBR                                         
                      ,:SUMINV-CHG-TMST                                         
                      ,:PV-FROM-TABLE                                           
W26682                ,:PV-REASON-TXT                                           
                  END-EXEC                                                      
                                                                                
              EVALUATE TRUE                                                     
                  WHEN SQLCODE = ZERO                                           
                       PERFORM 3400-PROCESS-ROW                                 
                       PERFORM 5000-PROCESS-DETAIL-ENTRIES                      
                  WHEN SQLCODE = +100                                           
                       MOVE 'Y' TO PS-EOF-CSR-SW                                
                  WHEN SQLCODE  = -911                                          
                       IF PV-SQL-SUB > PC-MAX-RETRIES                           
                          DISPLAY 'MAX RETRIES EXCEEDED ON SUMMARY_CSR1'        
                          PERFORM 9900-SQL-ERROR                                
                       END-IF                                                   
                  WHEN SQLCODE  > ZERO                                          
                  WHEN SQLWARN0 = 'W'                                           
                       DISPLAY 'WARNING ON FETCH OF SUMMARY_CSR2'               
                       PERFORM 9100-SQL-WARNING                                 
                  WHEN OTHER                                                    
                       DISPLAY 'ERROR ON FETCH OF SUMMARY_CSR2'                 
                       PERFORM 9900-SQL-ERROR                                   
              END-EVALUATE                                                      
           END-PERFORM.                                                         
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       4300-CLOSE-CSR2-CSR.                                                     
                                                                                
               EXEC SQL                                                         
                   CLOSE SUMMARY_CSR2                                           
               END-EXEC                                                         
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN SQLCODE  > ZERO                                             
               WHEN SQLWARN0 = 'W'                                              
                    DISPLAY 'WARNING ON CLOSE OF SUMMARY_CSR2'                  
                    PERFORM 9100-SQL-WARNING                                    
               WHEN OTHER                                                       
                    DISPLAY 'ERROR ON CLOSE OF SUMMARY_CSR2'                    
                    PERFORM 9900-SQL-ERROR                                      
           END-EVALUATE.                                                        
      *                                                                         
      *****************************************************************         
      * 5000-PROCESS-DETAIL-ENTRIES.                                            
      *****************************************************************         
       5000-PROCESS-DETAIL-ENTRIES.                                             
      *                                                                         
           MOVE SUMINV-DKEY-NBR     TO PV-HOLD-DKEY-NBR.                        
           MOVE ZEROES              TO PA-DETAIL-CSR-COUNT.                     
           SET PS-NO-EOF-DETAIL-CSR TO TRUE.                                    
      *                                                                         
           PERFORM 5100-OPEN-DETAIL-CSR.                                        
           PERFORM 5200-FETCH-DETAIL-RECORDS                                    
               UNTIL PS-EOF-DETAIL-CSR.                                         
           PERFORM 5300-CLOSE-DETAIL-CSR.                                       
      *                                                                         
      *                                                                         
           PERFORM 5400-PRINT-TOTALS.                                           
      *                                                                         
      *****************************************************************         
      * 5100-OPEN-DETAIL-CSR                                                    
      *****************************************************************         
                                                                                
       5100-OPEN-DETAIL-CSR.                                                    
           PERFORM                                                              
              WITH TEST AFTER                                                   
              VARYING PV-SQL-SUB FROM 1 BY 1                                    
              UNTIL PV-SQL-SUB > PC-MAX-RETRIES OR                              
                    SQLCODE = 0 OR                                              
                    SQLCODE = 100                                               
                                                                                
                  EXEC SQL                                                      
                      OPEN DETAIL_CSR                                           
                  END-EXEC                                                      
                                                                                
              EVALUATE TRUE                                                     
                  WHEN SQLCODE = ZERO                                           
                  WHEN SQLCODE  = +100                                          
                       CONTINUE                                                 
                  WHEN SQLCODE = -911                                           
                    IF PV-SQL-SUB > PC-MAX-RETRIES                              
                      DISPLAY 'MAX RETRIES EXCEEDED ON OPEN CURSOR'             
                      PERFORM 9900-SQL-ERROR                                    
                    END-IF                                                      
                  WHEN SQLCODE > ZERO                                           
                  WHEN SQLWARN0 = 'W'                                           
                       DISPLAY 'WARNING ON OPEN OF DETAIL CSR'                  
                       PERFORM 9100-SQL-WARNING                                 
                  WHEN OTHER                                                    
                       DISPLAY 'ERROR ON OPEN OF DETAIL CSR'                    
                       PERFORM 9900-SQL-ERROR                                   
              END-EVALUATE                                                      
           END-PERFORM.                                                         
                                                                                
      *                                                                         
      *****************************************************************         
      * 5200-FETCH-DETAIL-RECORDS **                                            
      ******************************                                            
      * TO MAINTAIN CONSISTENCY WITH THE SUMMARY_CSR* CURSORS, THE              
      * FETCHED VARIABLE WILL BE READ INTO THE TSUMINV HOST VARIABLE            
      * NAMES (IE. :SUMINV-***). THESE VARIABLES ARE USED IN THE                
      * PROCESSING OF INDIVIDUAL ROWS (3400-PROCESS-ROWS) AND SUBTOTALS.        
      * THESE FIELDS DEFINITIONS ARE DEFINED CONSISTENTLY ON THE VARIOUS        
      * DB2 TABLES (TSUMINV, TADJADD, TADJDTL) .                                
      *****************************************************************         
                                                                                
       5200-FETCH-DETAIL-RECORDS.                                               
                                                                                
           PERFORM                                                              
              WITH TEST AFTER                                                   
              VARYING PV-SQL-SUB FROM 1 BY 1                                    
              UNTIL PV-SQL-SUB > PC-MAX-RETRIES OR                              
                    SQLCODE = 0 OR                                              
                    SQLCODE = 100                                               
                                                                                
                  EXEC SQL                                                      
                      FETCH DETAIL_CSR                                          
                  INTO                                                          
                       :SUMINV-SKU-NBR                                          
                      ,:SUMINV-UPC-NBR                                          
                      ,:SUMINV-INV-UNIT-PR-AMT                                  
                      ,:SUMINV-INV-QTY                                          
                      ,:SUMINV-EXTD-AMT                                         
                      ,:PV-FROM-TABLE                                           
W26682                ,:PV-REASON-TXT                                           
                  END-EXEC                                                      
                                                                                
              EVALUATE TRUE                                                     
                  WHEN SQLCODE = ZERO                                           
                       COMPUTE PA-DETAIL-CSR-COUNT =                            
                              (PA-DETAIL-CSR-COUNT + 1)                         
                       PERFORM 3400-PROCESS-ROW                                 
                  WHEN SQLCODE = +100                                           
                       MOVE 'Y' TO PS-EOF-DTL-SW                                
                  WHEN SQLCODE  = -911                                          
                       IF PV-SQL-SUB > PC-MAX-RETRIES                           
                          DISPLAY 'MAX RETRIES EXCEEDED ON DETAIL_CSR'          
                          PERFORM 9900-SQL-ERROR                                
                       END-IF                                                   
                  WHEN SQLCODE  > ZERO                                          
                  WHEN SQLWARN0 = 'W'                                           
                       DISPLAY 'WARNING ON FETCH OF DETAIL_CSR'                 
                       PERFORM 9100-SQL-WARNING                                 
                  WHEN OTHER                                                    
                       DISPLAY 'ERROR ON FETCH OF DETAIL_CSR'                   
                       PERFORM 9900-SQL-ERROR                                   
              END-EVALUATE                                                      
           END-PERFORM.                                                         
                                                                                
      *****************************************************************         
      * 5300-CLOSE-DETAIL-CSR                                                   
      *****************************************************************         
       5300-CLOSE-DETAIL-CSR.                                                   
                                                                                
               EXEC SQL                                                         
                   CLOSE DETAIL_CSR                                             
               END-EXEC                                                         
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN SQLCODE  > ZERO                                             
               WHEN SQLWARN0 = 'W'                                              
                    DISPLAY 'WARNING ON CLOSE OF DETAIL_CSR'                    
                    PERFORM 9100-SQL-WARNING                                    
               WHEN OTHER                                                       
                    DISPLAY 'ERROR ON CLOSE OF DETAIL_CSR'                      
                    PERFORM 9900-SQL-ERROR                                      
           END-EVALUATE.                                                        
      *                                                                         
      *                                                                         
      *****************************************************************         
      * 5400-PRINT-TOTALS.   PRODUCE SUB-TOTAL LINES                            
      *****************************************************************         
       5400-PRINT-TOTALS.                                                       
      *    SEPARATE UNIQUE SKU / RETAIL ON REPORT                               
           IF PA-DETAIL-CSR-COUNT > 0                                           
W26682                                                                          
W26682         IF PA-LINE-CNT > (PC-LINE-MAX - 3)                               
W26682             PERFORM 7000-PRINT-HEADINGS                                  
W26682         END-IF                                                           
W26682                                                                          
               WRITE PRINT-RECORD                                               
                   FROM PR-SUB-LINE                                             
                       AFTER ADVANCING 1 LINE                                   
                                                                                
               MOVE PA-SUB-QTY          TO PR-SUB-QUANTITY                      
               MOVE PA-SUB-EXTD-AMT     TO PR-SUB-EXTD-RETAIL                   
                                                                                
               WRITE PRINT-RECORD                                               
                   FROM PR-SUB-REC                                              
                       AFTER ADVANCING 1 LINE                                   
                                                                                
               WRITE PRINT-RECORD                                               
                   FROM PR-EMPTY-LINE                                           
                   AFTER ADVANCING 1 LINE                                       
                                                                                
               ADD 3 TO PA-LINE-CNT                                             
                                                                                
           ELSE                                                                 
W26682                                                                          
W26682         IF PA-LINE-CNT > (PC-LINE-MAX - 1)                               
W26682             PERFORM 7000-PRINT-HEADINGS                                  
W26682         END-IF                                                           
W26682                                                                          
               WRITE PRINT-RECORD                                               
                   FROM PR-EMPTY-LINE                                           
                   AFTER ADVANCING 1 LINES                                      
                                                                                
               ADD 1 TO PA-LINE-CNT                                             
                                                                                
           END-IF.                                                              
                                                                                
           MOVE ZEROES TO PA-SUB-QTY                                            
                          PA-SUB-EXTD-AMT.                                      
                                                                                
      *****************************************************************         
      * 6000-GET-STORE-NAME  READS THE DB2 STORE TABLE                          
      *****************************************************************         
       6000-GET-STORE-NAME.                                                     
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
                         OR SQLCODE = 0                                         
                         OR SQLCODE = +100)                                     
                                                                                
               EXEC SQL                                                         
                   SELECT LOC_NM                                                
                   INTO :XMT00001-LOC-NM                                        
                   FROM XMT_LOC                                                 
                   WHERE LOC_NBR = :XMT00001-LOC-NBR                            
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +100                                          
                       DISPLAY '*** INKRP193 ABEND ***'                         
                       DISPLAY '**** NO MATCH FOR STORE '                       
                                                PV-HOLD-STORE                   
                       DISPLAY '**** ON DB2 XMT STORE TABLE'                    
                       PERFORM 9900-SQL-ERROR                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = 0                                             
                     MOVE XMT00001-LOC-NM  TO PR-PRINT-STORE-NAME               
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       DISPLAY '6000-GET-STORE-NAME'                            
                       DISPLAY 'READING STORE TABLE'                            
                       PERFORM 9900-SQL-ERROR                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
      *                                                                         
      *****************************************************************         
      * 6100-GET-TSUMINV-ATTR.                                                  
      *****************************************************************         
       6100-GET-TSUMINV-ATTR.                                                   
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
                         OR SQLCODE = 0                                         
                         OR SQLCODE = +100)                                     
                                                                                
               EXEC SQL                                                         
                   SELECT DEPT_NBR                                              
                         ,SUB_CL_NBR                                            
                   INTO :SUMINV-DEPT-NBR                                        
                       ,:SUMINV-SUB-CL-NBR                                      
                   FROM TSUMINV                                                 
W26600             WHERE LOC_NBR         = :PV-HOLD-STORE-NBR                   
                     AND AREA_NBR        = :PV-HOLD-AREA-NBR                    
                     AND SKU_NBR         = :SUMINV-SKU-NBR                      
                     AND UPC_NBR         = :SUMINV-UPC-NBR                      
                     AND INV_UNIT_PR_AMT = :SUMINV-INV-UNIT-PR-AMT              
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN SQLCODE = +100                                          
                       DISPLAY '*** INKRP193 ABEND ***'                         
                       DISPLAY '**** NO MATCH FOR STORE '                       
                                                PV-HOLD-STORE                   
                       DISPLAY '**** ON DB2 TSUMINV TABLE'                      
                       PERFORM 9900-SQL-ERROR                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       DISPLAY '6100-GET-TSUMINV-ATTR'                          
                       DISPLAY 'READING SUMINV TABLE'                           
                       PERFORM 9900-SQL-ERROR                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
      *                                                                         
W28545*****************************************************************         
W28545* 6200-GET-INPD400-ATTR.   COMMON PRICING                                 
W28545*****************************************************************         
W28545 6200-GET-INPD400-ATTR.                                                   
W28545                                                                          
W28545     INITIALIZE IN400-PV-INPUT-AREA.                                      
W28545                                                                          
F28545     MOVE CC-DB2-ACTL-INV-DTE     TO IN400-PV-EFF-DTE-IN.                 
W28545     MOVE 'SKU'                   TO IN400-PV-LOOKUP-TYPE-IN.             
W28545     MOVE PV-WORK-SKU             TO IN400-PV-SKU-IN-NUM.                 
W28545     MOVE PV-HOLD-STORE-NBR       TO IN400-PV-LOC-IN-NUM.                 
W28545                                                                          
W28545     PERFORM IN400-LOOKUP-RETAIL.                                         
W28545                                                                          
W28545     IF IN400-PV-FOUND                                                    
W28545         CONTINUE                                                         
W28545     ELSE                                                                 
W28545         IF IN400-PV-NOT-FOUND                                            
W28545             DISPLAY '*** INKRP193 ABEND ***'                             
W28545             DISPLAY '**** NOT FOUND RETURNED FROM INPD400 '              
W28545             DISPLAY '*** INPD400 RETURN IS '                             
W28545                                         IN400-PV-RETURN-CDE              
W28545             DISPLAY '**** PARA 6200-GET-INPD400-ATTR '                   
W28545             PERFORM 9900-SQL-ERROR                                       
W28545     ELSE                                                                 
W28545         DISPLAY '*** INKRP193 ABEND ***'                                 
W28545         DISPLAY '*** PARA 6200-GET-INPD400-ATTR '                        
W28545         DISPLAY '*** INPD400 RETURN IS ' IN400-PV-RETURN-CDE             
W28545         PERFORM 9900-SQL-ERROR                                           
W28545                                                                          
W28545     END-IF.                                                              
      /                                                                         
      *                                                                         
W26600*****************************************************************         
W26600* 6300-GET-USER-NAME.                                                     
W26600*****************************************************************         
W26600 6300-GET-USER-NAME.                                                      
W26600                                                                          
W26600     PERFORM                                                              
W26600         WITH TEST AFTER                                                  
W26600         VARYING PV-SQL-SUB                                               
W26600         FROM 1 BY 1                                                      
W26600         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
W26600                   OR SQLCODE = 0                                         
W26600                   OR SQLCODE = +100)                                     
W26600                                                                          
W26600         EXEC SQL                                                         
W26600             SELECT USR_LAST_NM                                           
W26600                   ,USR_1ST_NM                                            
W26600             INTO :USER-USR-LAST-NM                                       
W26600                 ,:USER-USR-1ST-NM                                        
W26600             FROM TUSER                                                   
W26600             WHERE USER_CODE = :PV-HOLD-USERID                            
W26600         END-EXEC                                                         
W26600                                                                          
W26600         EVALUATE TRUE                                                    
W26600             WHEN SQLCODE = 0                                             
W26600                 CONTINUE                                                 
W26600             WHEN SQLCODE = +100                                          
W26600                 MOVE PV-HOLD-USERID TO USER-USR-1ST-NM                   
W26600             WHEN SQLCODE = -904                                          
W26600             WHEN SQLCODE = -911                                          
W26600             WHEN SQLWARN NOT = SPACES                                    
W26600             WHEN SQLCODE NOT = ZERO                                      
W26600                 DISPLAY '6300-GET-USER-NAME'                             
W26600                 DISPLAY 'READING USER TABLE'                             
W26600                 PERFORM 9900-SQL-ERROR                                   
W26600         END-EVALUATE                                                     
W26600     END-PERFORM.                                                         
W26600*                                                                         
W26600                                                                          
       7000-PRINT-HEADINGS.                                                     
           ADD 1 TO PA-PAGE-CNT.                                                
           MOVE PA-PAGE-CNT TO PR-HEAD-PAGE-NUMBER.                             
           MOVE '11' TO PA-LINE-CNT.                                            
                                                                                
           WRITE PRINT-RECORD                                                   
               FROM PR-HEADER-REC                                               
               AFTER ADVANCING PAGE.                                            
                                                                                
           WRITE PRINT-RECORD                                                   
               FROM PR-PRINT-H1                                                 
               AFTER ADVANCING 2 LINES.                                         
                                                                                
W26600     WRITE PRINT-RECORD                                                   
W26600         FROM PR-REQUESTED-BY                                             
W26600         AFTER ADVANCING 3 LINES.                                         
W26600                                                                          
           WRITE PRINT-RECORD                                                   
               FROM PR-PRINT-STORE                                              
               AFTER ADVANCING 3 LINES.                                         
                                                                                
           WRITE PRINT-RECORD                                                   
               FROM PR-PRINT-AREA                                               
               AFTER ADVANCING 1 LINES.                                         
                                                                                
           WRITE PRINT-RECORD                                                   
               FROM PR-PRINT-H2                                                 
               AFTER ADVANCING 3 LINES.                                         
                                                                                
           MOVE SPACES TO PRINT-RECORD.                                         
           WRITE PRINT-RECORD                                                   
               AFTER ADVANCING 1 LINE.                                          
      /                                                                         
      *****************************************************************         
      * PRINT A RECORD                                                          
      *****************************************************************         
       7100-PRINT-DETAIL-LINE.                                                  
                                                                                
           ADD 1 TO PA-LINE-CNT.                                                
                                                                                
           IF PA-LINE-CNT > PC-LINE-MAX                                         
              PERFORM 7000-PRINT-HEADINGS.                                      
                                                                                
           WRITE PRINT-RECORD                                                   
               FROM PR-DETAIL-REC                                               
               AFTER ADVANCING 1 LINE.                                          
                                                                                
      *****************************************************************         
      * PRINT ERROR REPORT                                                      
      *****************************************************************         
       7200-PRINT-ERROR-REPORT.                                                 
                                                                                
           DISPLAY '7200  ' EM-USER-NAME.                                       
           WRITE DFLT-PRTR-RECORD                                               
               FROM EM-MESSAGE-DETAIL                                           
               AFTER ADVANCING 1 LINE.                                          
                                                                                
      *****************************************************************         
      * READ CONTROL CARD WHICH SPECIFIES THE REPORT PARAMETERS                 
      *****************************************************************         
                                                                                
       8000-READ-STORE-CONTROL.                                                 
      *                                                                         
           READ STORE-CONTROL-FILE                                              
                INTO CC-CONTROL-CARD                                            
            AT END                                                              
               SET PS-END-OF-STORES TO TRUE                                     
           END-READ.                                                            
                                                                                
       8500-END-PROCESSING.                                                     
                                                                                
           MOVE PA-TOTAL-QTY      TO PR-TOT-QUANTITY.                           
           MOVE PA-TOTAL-EXTD-AMT TO PR-TOT-EXTD-RETAIL.                        
                                                                                
W26682     IF PA-LINE-CNT > (PC-LINE-MAX - 3)                                   
W26682        PERFORM 7000-PRINT-HEADINGS                                       
W26682     END-IF.                                                              
W26682                                                                          
           WRITE PRINT-RECORD                                                   
               FROM PR-TOT-REC                                                  
               AFTER ADVANCING 3 LINES.                                         
                                                                                
           CLOSE PRINT-FILE.                                                    
           CLOSE DFLT-PRTR-FILE.                                                
           CLOSE STORE-CONTROL-FILE.                                            
                                                                                
       9100-SQL-WARNING.                                                        
            MOVE SQLCODE               TO SQLCODE2.                             
            MOVE SQLERRD(3)            TO SQLERRD3.                             
                                                                                
            DISPLAY '** ABEND **       ** = SQLWARNING'.                        
            DISPLAY '** PROGRAM        ** = INKRP193'.                          
            DISPLAY '** SQLCODE        ** = ' SQLCODE2.                         
            DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                         
            DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                         
            DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                         
            DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                         
            DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                         
            DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                         
            DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                         
            DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                         
            DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                         
                                                                                
            SET ABEND-4013-DB2-ERROR   TO TRUE                                  
            CALL 'ILBOABN0' USING ABEND-CODE.                                   
                                                                                
       9900-SQL-ERROR.                                                          
            MOVE SQLCODE               TO SQLCODE2.                             
            MOVE SQLERRD(3)            TO SQLERRD3.                             
                                                                                
            DISPLAY '** ABEND **       ** = SQLERROR'.                          
            DISPLAY '** PROGRAM        ** = INKRP193'.                          
            DISPLAY '** SQLCODE        ** = ' SQLCODE2.                         
            DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                         
            DISPLAY '** SQLERRM        ** = ' SQLERRM.                          
            DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                         
                                                                                
            SET ABEND-4013-DB2-ERROR   TO TRUE.                                 
            CALL 'ILBOABN0' USING ABEND-CODE.                                   
                                                                                
W26682/*****************************************************************        
W26682* 10000-EDIT-REASON-TXT.                                                  
W26682******************************************************************        
W26682 10000-EDIT-REASON-TXT.                                                   
W26682*** INITIALIZE FIELDS.....                                                
W26682                                                                          
W26682     MOVE ZEROS               TO PV-CTL-SUB.                              
W26682     MOVE ZEROS               TO PV-CTL-END-PT.                           
W26682                                                                          
W26682     MOVE PV-REASON-TXT       TO PV-REASON-TBL.                           
W26682                                                                          
W26682 10000-CHECK-FOR-BEGIN.                                                   
W26682*** FIND THE BEGINNING POINT FOR THE ADJUSTMENT REASON.....               
W26682                                                                          
W26682     ADD 1               TO PV-CTL-SUB.                                   
W26682                                                                          
W26682     IF PV-CTL-SUB IS GREATER THAN 20                                     
W26682         GO TO 10000-EDIT-REASON-TXT-EXIT.                                
W26682                                                                          
W26682     IF PV-REASON-BYTE (PV-CTL-SUB) EQUAL SPACE                           
W26682         GO TO 10000-CHECK-FOR-BEGIN.                                     
W26682                                                                          
W26682 10000-MOVE-REASON.                                                       
W26682*** MOVE THE REASON TO THE DETAIL LINE....                                
W26682                                                                          
W26682     COMPUTE PV-CTL-END-PT    = 20 - PV-CTL-SUB.                          
W26682                                                                          
W26682     IF PV-CTL-END-PT IS LESS THAN 8                                      
W26682         MOVE PV-REASON-TBL (PV-CTL-SUB:PV-CTL-END-PT)                    
W26682                              TO PR-SOURCE-TABLE                          
W26682     ELSE                                                                 
W26682         MOVE PV-REASON-TBL (PV-CTL-SUB:8)                                
W26682                              TO PR-SOURCE-TABLE                          
W26682     END-IF.                                                              
W26682                                                                          
W26682 10000-EDIT-REASON-TXT-EXIT.                                              
W26682     EXIT.                                                                
W26882                                                                          
W28545****************************************************************          
W28545*    COMMON PRICING PROCEDURE DIVISION INCLUDE                 *          
W28545****************************************************************          
W28545                                                                          
W28545     COPY INPD400.                                                        
W28545                                                                          
