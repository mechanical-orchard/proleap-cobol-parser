000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.      DFKUT011.                                       00030000
000400 AUTHOR.          STEVEN NOWAK.                                   00040000
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050000
000600 DATE-WRITTEN     03/15/2010.                                     00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*  THIS PROGRAM IS SIMILAR TO DFKUT003 BUT AT THE DMA LEVEL.      00100000
001100*  THIS PROGRAM CREATES THE DAILY FLASH SALES FOR ALL STORES      00110000
001200*  EXCEPT FOR STORE 873 (ECOM) LOCATION ANALYSIS EXTRACT FILE.    00120000
001300*                                                                 00130000
001400*  IT WILL BE A .CSV FILE SENT TO WAYNE OSTLING.                  00140000
001500*                                                                 00150000
001600*  THIS PROGRAM LOOKS AT MTD, QTD, AND STD COMP DATES.            00160000
001700*  PROGRAM INCLUDES YTD INFORMATION AND TOTAL SALES ALONG WITH    00170000
001800*  WITH THE COMP SALES INFORMATION.                               00180000
001900******************************************************************00190000
002000                                                                  00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200 CONFIGURATION SECTION.                                           00220000
002300                                                                  00230000
002400 SOURCE-COMPUTER.        IBM-3090.                                00240000
002500 OBJECT-COMPUTER.        IBM-3090.                                00250000
002600                                                                  00260000
002700 INPUT-OUTPUT SECTION.                                            00270000
002800 FILE-CONTROL.                                                    00280000
002900                                                                  00290000
003000     SELECT DATE-CONTROL-FILE ASSIGN TO INP01.                    00300000
003100     SELECT DAILY-FLASH-SALES ASSIGN TO OUT01.                    00310000
003200                                                                  00320000
003300 DATA DIVISION.                                                   00330000
003400 FILE SECTION.                                                    00340000
003500                                                                  00350000
003600 FD  DATE-CONTROL-FILE                                            00360000
003700     LABEL RECORDS ARE STANDARD                                   00370000
003800     RECORDING MODE IS F                                          00380000
003900     BLOCK CONTAINS 0 RECORDS                                     00390000
004000     DATA RECORD IS DATE-CONTROL-REC.                             00400000
004100                                                                  00410000
004200 01  DATE-CONTROL-REC                 PIC  X(80).                 00420000
004300                                                                  00430000
004400 FD  DAILY-FLASH-SALES                                            00440000
004500     RECORDING MODE F                                             00450000
004600     LABEL RECORDS ARE OMITTED                                    00460000
004700     BLOCK CONTAINS 0 RECORDS                                     00470000
004800     RECORD CONTAINS 475 CHARACTERS                               00480000
004900     DATA RECORD IS SALES-EXTRACT.                                00490000
005000                                                                  00500000
005100 01  SALES-EXTRACT                    PIC  X(475).                00510000
005200                                                                  00520000
005300                                                                  00530000
005400******************************************************************00540000
005500*                       WORKING STORAGE                           00550000
005600******************************************************************00560000
005700 WORKING-STORAGE SECTION.                                         00570000
005800                                                                  00580000
005900 01  W-START                          PIC  X(40)                  00590000
006000     VALUE 'DFKUT011 - WORKING STORAGE BEGINS HERE'.              00600000
006100                                                                  00610000
006200******************************************************************00620000
006300*                         SWITCHES                                00630000
006400******************************************************************00640000
006500 01  PS-PROGRAM-SWITCHES.                                         00650000
006600     05  PS-END-OF-STORE-SW           PIC  X(01) VALUE 'N'.       00660000
006700         88 PS-END-OF-STORE-YES                  VALUE 'Y'.       00670000
006800     05  PS-END-OF-FILE-SW            PIC  X(01) VALUE 'N'.       00680000
006900         88 PS-END-OF-FILE-YES                   VALUE 'Y'.       00690000
007000     05  PS-END-OF-DATE-SW            PIC  X(01) VALUE 'N'.       00700000
007100         88 PS-END-OF-DATE-YES                   VALUE 'Y'.       00710000
007200     05  PS-FOUND-TY-DATA-SW          PIC  X(01) VALUE 'N'.       00720000
007300         88 PS-FOUND-TY-DATA-YES                 VALUE 'Y'.       00730000
007400     05  PS-FOUND-LY-DATA-SW          PIC  X(01) VALUE 'N'.       00740000
007500         88 PS-FOUND-LY-DATA-YES                 VALUE 'Y'.       00750000
007600     05  PS-END-OF-CURSOR-SW          PIC  X(01) VALUE 'N'.       00760000
007700         88 PS-END-OF-CURSOR-YES                 VALUE 'Y'.       00770000
007800                                                                  00780000
007900******************************************************************00790000
008000*                        CONSTANTS                                00800000
008100******************************************************************00810000
008200 01  PC-CONSTANTS.                                                00820000
008300     05  PC-PGM-NAME                  PIC  X(08) VALUE 'DFKUT007'.00830000
008400     05  PC-JOB-NAME                  PIC  X(08) VALUE 'SIK125'.  00840000
008500                                                                  00850000
008600******************************************************************00860000
008700*                      PROGRAM VARIABLES                          00870000
008800******************************************************************00880000
008900 01  PV-PROGRAM-VARIABLES.                                        00890000
009000     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     00900000
009100     05  PV-OPERATION-MSG             PIC  X(30) VALUE SPACE.     00910000
009200     05  PV-SQLCODE                   PIC S9(04) VALUE ZERO.      00920000
009300     05  PV-COMP-DATE                 PIC  X(10) VALUE SPACE.     00930000
009400     05  PV-DATE                      PIC  X(10) VALUE SPACE.     00940000
009500                                                                  00950000
009600******************************************************************00960000
009700*                        ACCUMULATORS                             00970000
009800******************************************************************00980000
009900 01  PA-PROGRAM-ACCUMS.                                           00990000
010000     05  PA-STR-READ                  PIC  9(11) VALUE ZEROES.    01000000
010100                                                                  01010000
010110******************************************************************01011000
010120*                         CONTROL CARD                            01012000
010130******************************************************************01013000
010140 01  CC-CONTROL-CARD.                                             01014000
010150     05  CC-STR-NBR                   PIC  9(04) VALUE ZEROES.    01015000
010160                                                                  01016000
010200******************************************************************01017000
010300*                            TABLES                               01018000
010400******************************************************************01019000
010500 01  PS-DMM-TABLE.                                                01020000
010600     05  PS-DMM-ENTRY OCCURS 200 TIMES                            01030000
010700                                   INDEXED BY PS-DMM-INDEX.       01040000
010800         15  PS-DMM-NBR          PIC  9(04)    VALUE ZEROES.      01050000
010900         15  PS-DMM-DESC         PIC  X(25)    VALUE SPACES.      01060000
011000         15  PS-CMP-DLY-TY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01070000
011100         15  PS-CMP-WTD-TY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01080000
011200         15  PS-CMP-MTD-TY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01090000
011300         15  PS-CMP-QTD-TY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01100000
011400         15  PS-CMP-STD-TY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01110000
011500         15  PS-CMP-YTD-TY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01120000
011600         15  PS-CMP-DLY-LY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01130000
011700         15  PS-CMP-WTD-LY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01140000
011800         15  PS-CMP-MTD-LY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01150000
011900         15  PS-CMP-QTD-LY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01160000
012000         15  PS-CMP-STD-LY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01170000
012100         15  PS-CMP-YTD-LY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01180000
012200         15  PS-TOT-DLY-TY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01190000
012300         15  PS-TOT-WTD-TY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01200000
012400         15  PS-TOT-MTD-TY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01210000
012500         15  PS-TOT-QTD-TY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01220000
012600         15  PS-TOT-STD-TY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01230000
012700         15  PS-TOT-YTD-TY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01240000
012800         15  PS-TOT-DLY-LY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01250000
012900         15  PS-TOT-WTD-LY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01260000
013000         15  PS-TOT-MTD-LY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01270000
013100         15  PS-TOT-QTD-LY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01280000
013200         15  PS-TOT-STD-LY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01290000
013300         15  PS-TOT-YTD-LY-SLS   PIC S9(11)V99 VALUE ZEROS COMP-3.01300000
013400                                                                  01310000
013500******************************************************************01320000
013600*               SYSTEM TIME AND DATE VARIABLES                    01330000
013700******************************************************************01340000
013800 01  SYS-DATE-TIME.                                               01350000
013900     05  SYS-DATE                     PIC  X(08) VALUE SPACES.    01360000
014000     05  SYS-TIME                     PIC  X(08) VALUE SPACES.    01370000
014100                                                                  01380000
014200 01  ST-BEG-TIME.                                                 01390000
014300     05  ST-BEG-HR                    PIC  9(02) VALUE ZEROS.     01400000
014400     05  FILLER                       PIC  X(01) VALUE ':'.       01410000
014500     05  ST-BEG-MN                    PIC  9(02) VALUE ZEROS.     01420000
014600                                                                  01430000
014700 01  ST-END-TIME.                                                 01440000
014800     05  ST-END-HR                    PIC  9(02) VALUE ZEROS.     01450000
014900     05  FILLER                       PIC  X(01) VALUE ':'.       01460000
015000     05  ST-END-MN                    PIC  9(02) VALUE ZEROS.     01470000
015100                                                                  01480000
015200 01  SD-EDIT-DATE.                                                01490000
015300     05  SD-MONTH                     PIC  9(02) VALUE ZEROS.     01500000
015400     05  FILLER                       PIC  X(01) VALUE '-'.       01510000
015500     05  SD-DAY                       PIC  9(02) VALUE ZEROS.     01520000
015600     05  FILLER                       PIC  X(01) VALUE '-'.       01530000
015700     05  SD-CENT                      PIC  9(02) VALUE ZEROS.     01540000
015800     05  SD-YEAR                      PIC  9(02) VALUE ZEROS.     01550000
015900                                                                  01560000
016000******************************************************************01570000
016100*                        ERROR HANDLING                           01580000
016200******************************************************************01590000
016300 01  AC-ABEND-CODE                    PIC S9(04) VALUE ZERO       01600000
016400                                                 COMP SYNC.       01610000
016500     88  AC-CONTROL-CARD-ERROR                   VALUE +4003.     01620000
016600     88  AC-DB2-ERROR                            VALUE +4013.     01630000
016700     88  AC-CALENDAR-ROUTINE-ERROR               VALUE +4019.     01640000
016800                                                                  01650000
016900******************************************************************01660000
017000*                          HEADERS                                01670000
017100******************************************************************01680000
017200 01  COLUMN-HEADINGS.                                             01690000
017300     05  FILLER            PIC  X(04) VALUE 'DMM,'.               01700000
017400     05  FILLER            PIC  X(16) VALUE 'DMM DESCRIPTION,'.   01710000
017500     05  FILLER            PIC  X(19) VALUE 'CMP DLY TY SALES $,'.01720000
017600     05  FILLER            PIC  X(19) VALUE 'CMP DLY LY SALES $,'.01730000
017700     05  FILLER            PIC  X(19) VALUE 'CMP WTD TY SALES $,'.01740000
017800     05  FILLER            PIC  X(19) VALUE 'CMP WTD LY SALES $,'.01750000
017900     05  FILLER            PIC  X(19) VALUE 'CMP MTD TY SALES $,'.01760000
018000     05  FILLER            PIC  X(19) VALUE 'CMP MTD LY SALES $,'.01770000
018100     05  FILLER            PIC  X(19) VALUE 'CMP QTD TY SALES $,'.01780000
018200     05  FILLER            PIC  X(19) VALUE 'CMP QTD LY SALES $,'.01790000
018300     05  FILLER            PIC  X(19) VALUE 'CMP STD TY SALES $,'.01800000
018400     05  FILLER            PIC  X(19) VALUE 'CMP STD LY SALES $,'.01810000
018500     05  FILLER            PIC  X(19) VALUE 'CMP YTD TY SALES $,'.01820000
018600     05  FILLER            PIC  X(19) VALUE 'CMP YTD LY SALES $,'.01830000
018700     05  FILLER            PIC  X(19) VALUE 'TOT DLY TY SALES $,'.01840000
018800     05  FILLER            PIC  X(19) VALUE 'TOT DLY LY SALES $,'.01850000
018900     05  FILLER            PIC  X(19) VALUE 'TOT WTD TY SALES $,'.01860000
019000     05  FILLER            PIC  X(19) VALUE 'TOT WTD LY SALES $,'.01870000
019100     05  FILLER            PIC  X(19) VALUE 'TOT MTD TY SALES $,'.01880000
019200     05  FILLER            PIC  X(19) VALUE 'TOT MTD LY SALES $,'.01890000
019300     05  FILLER            PIC  X(19) VALUE 'TOT QTD TY SALES $,'.01900000
019400     05  FILLER            PIC  X(19) VALUE 'TOT QTD LY SALES $,'.01910000
019500     05  FILLER            PIC  X(19) VALUE 'TOT STD TY SALES $,'.01920000
019600     05  FILLER            PIC  X(19) VALUE 'TOT STD LY SALES $,'.01930000
019700     05  FILLER            PIC  X(19) VALUE 'TOT YTD TY SALES $,'.01940000
019800     05  FILLER            PIC  X(19) VALUE 'TOT YTD LY SALES $ '.01950000
019900                                                                  01960000
020000******************************************************************01970000
020100*                         DETAIL LINES                            01980000
020200******************************************************************01990000
020300 01  DL-DETAIL-LINE.                                              02000000
020400     05  DL-DMA-NBR                PIC  9999         VALUE ZEROES.02010000
020500     05  FILLER                    PIC  X(01)        VALUE ','.   02020000
020600     05  DL-DMA-DSCRPTN            PIC  X(25)        VALUE SPACES.02030000
020700     05  FILLER                    PIC  X(01)        VALUE ','.   02040000
020800     05  DL-CMP-DLY-TY-SLS         PIC  -999999999   VALUE ZERO.  02050000
020900     05  FILLER                    PIC  X(01)        VALUE ','.   02060000
021000     05  DL-CMP-DLY-LY-SLS         PIC  -999999999   VALUE ZERO.  02070000
021100     05  FILLER                    PIC  X(01)        VALUE ','.   02080000
021200     05  DL-CMP-WTD-TY-SLS         PIC  -999999999   VALUE ZERO.  02090000
021300     05  FILLER                    PIC  X(01)        VALUE ','.   02100000
021400     05  DL-CMP-WTD-LY-SLS         PIC  -999999999   VALUE ZERO.  02110000
021500     05  FILLER                    PIC  X(01)        VALUE ','.   02120000
021600     05  DL-CMP-MTD-TY-SLS         PIC  -9999999999  VALUE ZERO.  02130000
021700     05  FILLER                    PIC  X(01)        VALUE ','.   02140000
021800     05  DL-CMP-MTD-LY-SLS         PIC  -9999999999  VALUE ZERO.  02150000
021900     05  FILLER                    PIC  X(01)        VALUE ','.   02160000
022000     05  DL-CMP-QTD-TY-SLS         PIC  -9999999999  VALUE ZERO.  02170000
022100     05  FILLER                    PIC  X(01)        VALUE ','.   02180000
022200     05  DL-CMP-QTD-LY-SLS         PIC  -9999999999  VALUE ZERO.  02190000
022300     05  FILLER                    PIC  X(01)        VALUE ','.   02200000
022400     05  DL-CMP-STD-TY-SLS         PIC  -99999999999 VALUE ZERO.  02210000
022500     05  FILLER                    PIC  X(01)        VALUE ','.   02220000
022600     05  DL-CMP-STD-LY-SLS         PIC  -99999999999 VALUE ZERO.  02230000
022700     05  FILLER                    PIC  X(01)        VALUE ','.   02240000
022800     05  DL-CMP-YTD-TY-SLS         PIC  -99999999999 VALUE ZERO.  02250000
022900     05  FILLER                    PIC  X(01)        VALUE ','.   02260000
023000     05  DL-CMP-YTD-LY-SLS         PIC  -99999999999 VALUE ZERO.  02270000
023100     05  FILLER                    PIC  X(01)        VALUE ','.   02280000
023200     05  DL-TOT-DLY-TY-SLS         PIC  -999999999   VALUE ZERO.  02290000
023300     05  FILLER                    PIC  X(01)        VALUE ','.   02300000
023400     05  DL-TOT-DLY-LY-SLS         PIC  -999999999   VALUE ZERO.  02310000
023500     05  FILLER                    PIC  X(01)        VALUE ','.   02320000
023600     05  DL-TOT-WTD-TY-SLS         PIC  -999999999   VALUE ZERO.  02330000
023700     05  FILLER                    PIC  X(01)        VALUE ','.   02340000
023800     05  DL-TOT-WTD-LY-SLS         PIC  -999999999   VALUE ZERO.  02350000
023900     05  FILLER                    PIC  X(01)        VALUE ','.   02360000
024000     05  DL-TOT-MTD-TY-SLS         PIC  -9999999999  VALUE ZERO.  02370000
024100     05  FILLER                    PIC  X(01)        VALUE ','.   02380000
024200     05  DL-TOT-MTD-LY-SLS         PIC  -9999999999  VALUE ZERO.  02390000
024300     05  FILLER                    PIC  X(01)        VALUE ','.   02400000
024400     05  DL-TOT-QTD-TY-SLS         PIC  -9999999999  VALUE ZERO.  02410000
024500     05  FILLER                    PIC  X(01)        VALUE ','.   02420000
024600     05  DL-TOT-QTD-LY-SLS         PIC  -9999999999  VALUE ZERO.  02430000
024700     05  FILLER                    PIC  X(01)        VALUE ','.   02440000
024800     05  DL-TOT-STD-TY-SLS         PIC  -99999999999 VALUE ZERO.  02450000
024900     05  FILLER                    PIC  X(01)        VALUE ','.   02460000
025000     05  DL-TOT-STD-LY-SLS         PIC  -99999999999 VALUE ZERO.  02470000
025100     05  FILLER                    PIC  X(01)        VALUE ','.   02480000
025200     05  DL-TOT-YTD-TY-SLS         PIC  -99999999999 VALUE ZERO.  02490000
025300     05  FILLER                    PIC  X(01)        VALUE ','.   02500000
025400     05  DL-TOT-YTD-LY-SLS         PIC  -99999999999 VALUE ZERO.  02510000
025500     05  FILLER                    PIC  X(03)        VALUE '   '. 02520000
025600                                                                  02530000
025700                                                                  02540000
025800******************************************************************02550000
025900* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02560000
026000******************************************************************02570000
026100     COPY DPWS004.                                                02580000
026200                                                                  02590000
026300******************************************************************02600000
026400* DB2 MESSAGE AREA                                                02610000
026500******************************************************************02620000
026600     COPY SQLCA2.                                                 02630000
026700                                                                  02640000
026800******************************************************************02650000
026900* DB2 COMMUNICATION AREA                                          02660000
027000******************************************************************02670000
027100     EXEC SQL                                                     02680000
027200        INCLUDE SQLCA                                             02690000
027300     END-EXEC.                                                    02700000
027400                                                                  02710000
027500******************************************************************02720000
027600* LOCATION TABLE - XST_LOC                                        02730001
027700******************************************************************02740000
027800     EXEC SQL                                                     02750000
027900        INCLUDE XST00001                                          02760001
028000     END-EXEC.                                                    02770000
028100                                                                  02780000
027500******************************************************************02781001
027600* DAILY FLASH MERCHANDISE HIERARCHY TABLE - XSTW_DF_MDSE_HIER     02782001
027700******************************************************************02783001
027800     EXEC SQL                                                     02784001
027900        INCLUDE XST00126                                          02785001
028000     END-EXEC.                                                    02786001
028100                                                                  02787001
028200******************************************************************02790000
028300* DAILY FLASH MERCHANDISE HIERARCHY TABLE - XSTW_DF_LOC_HIER      02800000
028400******************************************************************02810000
028500     EXEC SQL                                                     02820000
028600        INCLUDE XST00125                                          02830000
028700     END-EXEC.                                                    02840000
028800                                                                  02850000
028900******************************************************************02860000
029000* DAILY FLASH SALE TABLE - DFT_DLY_FLSH_SUM                       02870000
029100******************************************************************02880000
029200     EXEC SQL                                                     02890000
029300        INCLUDE DFT00000                                          02900000
029400     END-EXEC.                                                    02910000
029500                                                                  02920000
029600******************************************************************02930000
029700* HISTORY FLASH SALE TABLE - DFT_ML_FINCL_SUM                     02940000
029800******************************************************************02950000
029900     EXEC SQL                                                     02960000
030000        INCLUDE DFT00002                                          02970000
030100     END-EXEC.                                                    02980000
030200                                                                  02990000
030300******************************************************************03000000
030400* DB2 TABLE DATE ATTRIBUTE                                        03010000
030500******************************************************************03020000
030600     EXEC SQL                                                     03030000
030700        INCLUDE TDTATTR                                           03040000
030800     END-EXEC.                                                    03050000
030900                                                                  03060000
031000******************************************************************03070000
031100* STORE CURSOR                                                    03080000
031200******************************************************************03090000
031300     EXEC SQL                                                     03100000
031400        DECLARE STR-CURSOR CURSOR FOR                             03110000
031500         SELECT A.LOC_NBR                                         03120000
031600              , A.DIST_NBR                                        03130000
031700              , A.REGN_NBR                                        03140000
031800              , A.TERR_NBR                                        03150000
031900              , A.ST_CDE                                          03160000
032000              , A.MN_SLS_INCL_DTE                                 03170000
032100              , A.QTR_SLS_INCL_DTE                                03180000
032200              , A.SEA_SLS_INCL_DTE                                03190000
032300              , A.YR_SLS_INCL_DTE                                 03200000
032400                                                                  03210000
032500          FROM XSTW_DF_LOC_HIER A                                 03220000
032500              ,XST_LOC          B                                 03221002
032600                                                                  03230000
032700         WHERE  A.OPN_DTE <= :PV-DATE                             03240000
032800           AND (A.CLO_DTE >= :PV-DATE OR                          03250000
032900                A.CLO_DTE IS NULL)                                03260000
033000                                                                  03270000
033100           AND A.LOC_NBR = B.LOC_NBR                              03280000
033100           AND B.E_BUS_IND = 'N'                                  03281000
033200                                                                  03290000
033300         ORDER BY A.LOC_NBR                                       03300000
033400                  FOR READ ONLY                                   03310000
033500               WITH UR                                            03320000
033600     END-EXEC.                                                    03330000
033700                                                                  03340000
033800                                                                  03350000
033900******************************************************************03360000
034000* DEPT CURSOR                                                     03370000
034100******************************************************************03380000
034200     EXEC SQL                                                     03390000
034300        DECLARE DEPT-CURSOR CURSOR FOR                            03400000
034400        SELECT  DMA_NBR                                           03410000
034500              , DMA_NM                                            03420000
034600              , A.DEPT_NBR                                        03430000
034700              , COALESCE(SUM(DLY_DOL_AMT),0)                      03440000
034800              , COALESCE(SUM(WTD_DOL_AMT),0)                      03450000
034900              , COALESCE(SUM(MTD_DOL_AMT),0)                      03460000
035000              , COALESCE(SUM(QTD_DOL_AMT),0)                      03470000
035100              , COALESCE(SUM(S_T_D_DOL_AMT),0)                    03480000
035200              , COALESCE(SUM(YTD_DOL_AMT),0)                      03490000
035300                                                                  03500000
035400          FROM DFT_DLY_FLSH_SUM A                                 03510000
035500             , XSTW_DF_MDSE_HIER B                                03520000
035600                                                                  03530000
035700         WHERE A.DEPT_NBR = B.DEPT_NBR                            03540000
035800           AND SLS_DTE    = :DTATTR-KY-DTE                        03550000
035900           AND STR_NBR    = :DFT00000-STR-NBR                     03560000
036000                                                                  03570000
036100       GROUP BY DMA_NBR                                           03580000
036200              , DMA_NM                                            03590000
036300              , A.DEPT_NBR                                        03600000
036400                                                                  03610000
036500         WITH UR                                                  03620000
036600     END-EXEC.                                                    03630000
036700                                                                  03640000
036800                                                                  03650000
036900                                                                  03660000
037000 PROCEDURE DIVISION.                                              03670000
037100******************************************************************03680000
037200* MAINLINE                                                        03690000
037300******************************************************************03700000
037400 0000-MAINLINE.                                                   03710000
037500                                                                  03720000
037600     PERFORM 1000-INITIALIZATION.                                 03730000
037700                                                                  03740000
037800     PERFORM 2000-OPEN-STR-CURSOR.                                03750000
037900     PERFORM 2100-FETCH-STR-CURSOR.                               03760000
038000     PERFORM 3000-PROCESS-STORES                                  03770000
038100         UNTIL PS-END-OF-STORE-YES.                               03780000
038200     PERFORM 2200-CLOSE-STR-CURSOR.                               03790000
038300                                                                  03800000
038400     SET PS-DMM-INDEX TO 1.                                       03810000
038500     PERFORM 6000-PREP-DETAIL-ROW                                 03820000
038600         UNTIL PS-DMM-INDEX > 200                                 03830000
038700                                                                  03840000
038800     PERFORM 9900-EOJ-ROUTINE.                                    03850000
038900                                                                  03860000
039000     STOP RUN.                                                    03870000
039100                                                                  03880000
039200                                                                  03890000
039300******************************************************************03900000
039400* OPEN FILES, PROCESS CONTROL CARD, FORMAT REPORT HEADINGS.       03910000
039500******************************************************************03920000
039600 1000-INITIALIZATION.                                             03930000
039700                                                                  03940000
039800     OPEN INPUT DATE-CONTROL-FILE                                 03950000
039900         OUTPUT DAILY-FLASH-SALES.                                03960000
040000                                                                  03970000
040100     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 03980000
040200                                                                  03990000
040300     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            04000000
040400     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            04010000
040500                                                                  04020000
040600     MOVE SYS-DATE (1:2) TO SD-CENT.                              04030000
040700     MOVE SYS-DATE (3:2) TO SD-YEAR.                              04040000
040800     MOVE SYS-DATE (5:2) TO SD-MONTH.                             04050000
040900     MOVE SYS-DATE (7:2) TO SD-DAY.                               04060000
041000                                                                  04070000
041100     PERFORM 1100-READ-CNTL-FILE.                                 04080000
041200     PERFORM 1200-WRITE-HEADINGS.                                 04090000
041300     PERFORM 1300-GET-LY-COMP-DATE.                               04100000
041400                                                                  04110000
041500                                                                  04120000
041600******************************************************************04130000
041700* READ THE DATE CONTROL CARD FILE                                 04140000
041800******************************************************************04150000
041900 1100-READ-CNTL-FILE.                                             04160000
042000                                                                  04170000
042100     READ DATE-CONTROL-FILE INTO PV-DATE                          04180000
042200         AT END SET PS-END-OF-DATE-YES TO TRUE.                   04190000
042300                                                                  04200000
042400     IF  PS-END-OF-DATE-YES                                       04210000
042500         MOVE '1100-READ-CNTL-FILE' TO PV-PARAGRAPH-NAME          04220000
042600         MOVE 'NO CONTROL CARD '    TO PV-OPERATION-MSG           04230000
042700         PERFORM 9000-ABEND                                       04240000
042800     END-IF.                                                      04250000
042900                                                                  04260000
043000     CLOSE DATE-CONTROL-FILE.                                     04270000
043100                                                                  04280000
043200     MOVE PV-DATE TO DTATTR-KY-DTE                                04290000
043300                     DFT00000-SLS-DTE.                            04300000
043400                                                                  04310000
043500                                                                  04320000
043600******************************************************************04330000
043700* WRITE THE COLUMN HEADINGS                                       04340000
043800******************************************************************04350000
043900 1200-WRITE-HEADINGS.                                             04360000
044000                                                                  04370000
044100     WRITE SALES-EXTRACT FROM COLUMN-HEADINGS.                    04380000
044200                                                                  04390000
044300     INITIALIZE SALES-EXTRACT.                                    04400000
044400                                                                  04410000
044500                                                                  04420000
044600******************************************************************04430000
044700* GET LAST YEAR FISCAL DAY FOR INPUT DATE                         04440000
044800******************************************************************04450000
044900 1300-GET-LY-COMP-DATE.                                           04460000
045000                                                                  04470000
045100     EXEC SQL                                                     04480000
045200         SELECT LY_THIS_DAY_KY_DTE                                04490000
045300           INTO :PV-COMP-DATE                                     04500000
045400           FROM  TDTATTR                                          04510000
045500          WHERE KY_DTE = :DTATTR-KY-DTE                           04520000
045600           WITH UR                                                04530000
045700     END-EXEC.                                                    04540000
045800                                                                  04550000
045900     EVALUATE TRUE                                                04560000
046000         WHEN SQLCODE = 0                                         04570000
046100             CONTINUE                                             04580000
046200                                                                  04590000
046300         WHEN OTHER                                               04600000
046400             DISPLAY '                '                           04610000
046500             DISPLAY 'DTATTR-KY-DTE = ' DTATTR-KY-DTE             04620000
046600                                                                  04630000
046700             MOVE SQLCODE                 TO PV-SQLCODE           04640000
046800             MOVE '1300-GET-LY-COMP-DATE' TO PV-PARAGRAPH-NAME    04650000
046900             MOVE 'ERROR ON GETTING LAST YEAR FISCAL DAY'         04660000
047000                                          TO PV-OPERATION-MSG     04670000
047100             PERFORM 9100-SQL-ABEND                               04680000
047200     END-EVALUATE.                                                04690000
047300                                                                  04700000
047400                                                                  04710000
047500******************************************************************04720000
047600* OPEN STR CURSOR                                                 04730000
047700******************************************************************04740000
047800 2000-OPEN-STR-CURSOR.                                            04750000
047900                                                                  04760000
048000     EXEC SQL                                                     04770000
048100          OPEN STR-CURSOR                                         04780000
048200     END-EXEC.                                                    04790000
048300                                                                  04800000
048400     EVALUATE TRUE                                                04810000
048500         WHEN SQLCODE = ZERO                                      04820000
048600              CONTINUE                                            04830000
048700                                                                  04840000
048800         WHEN SQLWARN0 NOT EQUAL SPACE                            04850000
048900         WHEN SQLCODE NOT EQUAL ZERO                              04860000
049000             MOVE SQLCODE                TO PV-SQLCODE            04870000
049100             MOVE '2000-OPEN-STR-CURSOR' TO PV-PARAGRAPH-NAME     04880000
049200             MOVE 'ERROR ON OPEN OF STR-CURSOR'                   04890000
049300                                         TO PV-OPERATION-MSG      04900000
049400             PERFORM 9100-SQL-ABEND                               04910000
049500     END-EVALUATE.                                                04920000
049600                                                                  04930000
049700                                                                  04940000
049800******************************************************************04950000
049900* FETCH STR CURSOR                                                04960000
050000******************************************************************04970000
050100 2100-FETCH-STR-CURSOR.                                           04980000
050200                                                                  04990000
050300     EXEC SQL                                                     05000000
050400         FETCH STR-CURSOR                                         05010000
050500          INTO :XST00125-LOC-NBR                                  05020000
050600              ,:XST00125-DIST-NBR                                 05030000
050700              ,:XST00125-REGN-NBR                                 05040000
050800              ,:XST00125-TERR-NBR                                 05050000
050900              ,:XST00125-ST-CDE                                   05060000
051000              ,:XST00125-MN-SLS-INCL-DTE                          05070000
051100              ,:XST00125-QTR-SLS-INCL-DTE                         05080000
051200              ,:XST00125-SEA-SLS-INCL-DTE                         05090000
051300              ,:XST00125-YR-SLS-INCL-DTE                          05100000
051400     END-EXEC.                                                    05110000
051500                                                                  05120000
051600     EVALUATE TRUE                                                05130000
051700        WHEN SQLCODE = ZERO                                       05140000
051800            ADD 1 TO PA-STR-READ                                  05150000
051900                                                                  05160000
052000        WHEN SQLCODE = +100                                       05170000
052100            SET PS-END-OF-STORE-YES TO TRUE                       05180000
052200                                                                  05190000
052300        WHEN OTHER                                                05200000
052400            MOVE SQLCODE                  TO PV-SQLCODE           05210000
052500            MOVE '2100-FETCH-STR-CURSOR ' TO PV-PARAGRAPH-NAME    05220000
052600            MOVE 'ERROR ON FETCH OF STR-CURSOR'                   05230000
052700                                          TO PV-OPERATION-MSG     05240000
052800            PERFORM 9100-SQL-ABEND                                05250000
052900     END-EVALUATE.                                                05260000
053000                                                                  05270000
053100                                                                  05280000
053200******************************************************************05290000
053300* CLOSE STR CURSOR                                                05300000
053400******************************************************************05310000
053500 2200-CLOSE-STR-CURSOR.                                           05320000
053600                                                                  05330000
053700     EXEC SQL                                                     05340000
053800          CLOSE STR-CURSOR                                        05350000
053900     END-EXEC.                                                    05360000
054000                                                                  05370000
054100     EVALUATE TRUE                                                05380000
054200         WHEN SQLCODE = ZERO                                      05390000
054300              CONTINUE                                            05400000
054400                                                                  05410000
054500         WHEN SQLWARN0 NOT EQUAL SPACE                            05420000
054600         WHEN SQLCODE NOT EQUAL ZERO                              05430000
054700             MOVE SQLCODE                 TO PV-SQLCODE           05440000
054800             MOVE '2200-CLOSE-STR-CURSOR' TO PV-PARAGRAPH-NAME    05450000
054900             MOVE 'ERROR ON CLOSE OF STR-CURSOR'                  05460000
055000                                          TO PV-OPERATION-MSG     05470000
055100             PERFORM 9100-SQL-ABEND                               05480000
055200     END-EVALUATE.                                                05490000
055300                                                                  05500000
055400                                                                  05510000
055500******************************************************************05520000
055600* PROCESS STORES                                                  05530000
055700******************************************************************05540000
055800 3000-PROCESS-STORES.                                             05550000
055900                                                                  05560000
056000     MOVE XST00125-LOC-NBR TO DFT00000-STR-NBR.                   05570000
056100                                                                  05580000
056200     MOVE 'N' TO PS-FOUND-TY-DATA-SW.                             05590000
056300     MOVE 'N' TO PS-END-OF-CURSOR-SW.                             05600000
056400                                                                  05610000
056500     PERFORM 4000-OPEN-DEPT-CURSOR.                               05620000
056600     PERFORM 4100-FETCH-DEPT-CURSOR.                              05630000
056700     PERFORM 5000-GET-SALES                                       05640000
056800         UNTIL PS-END-OF-CURSOR-YES.                              05650000
056900     PERFORM 4200-CLOSE-DEPT-CURSOR.                              05660000
057000                                                                  05670000
057100     PERFORM 2100-FETCH-STR-CURSOR.                               05680000
057200                                                                  05690000
057300                                                                  05700000
057400******************************************************************05710000
057500* OPEN DEPT CURSOR                                                05720000
057600******************************************************************05730000
057700 4000-OPEN-DEPT-CURSOR.                                           05740000
057800                                                                  05750000
057900     EXEC SQL                                                     05760000
058000          OPEN DEPT-CURSOR                                        05770000
058100     END-EXEC.                                                    05780000
058200                                                                  05790000
058300     EVALUATE TRUE                                                05800000
058400         WHEN SQLCODE = ZERO                                      05810000
058500              CONTINUE                                            05820000
058600                                                                  05830000
058700         WHEN SQLWARN0 NOT EQUAL SPACE                            05840000
058800         WHEN SQLCODE NOT EQUAL ZERO                              05850000
058900             MOVE SQLCODE                 TO PV-SQLCODE           05860000
059000             MOVE '4000-OPEN-DEPT-CURSOR' TO PV-PARAGRAPH-NAME    05870000
059100             MOVE 'ERROR ON OPEN OF DEPT-CURSOR'                  05880000
059200                                          TO PV-OPERATION-MSG     05890000
059300             PERFORM 9100-SQL-ABEND                               05900000
059400     END-EVALUATE.                                                05910000
059500                                                                  05920000
059600                                                                  05930000
059700******************************************************************05940000
059800* FETCH DEPT CURSOR                                               05950000
059900******************************************************************05960000
060000 4100-FETCH-DEPT-CURSOR.                                          05970000
060100                                                                  05980000
060200     EXEC SQL                                                     05990000
060300          FETCH DEPT-CURSOR                                       06000000
060400          INTO :XST00126-DMA-NBR                                  06010000
060500              ,:XST00126-DMA-NM                                   06020000
060600              ,:DFT00000-DEPT-NBR                                 06030000
060700              ,:DFT00000-DLY-DOL-AMT                              06040000
060800              ,:DFT00000-WTD-DOL-AMT                              06050000
060900              ,:DFT00000-MTD-DOL-AMT                              06060000
061000              ,:DFT00000-QTD-DOL-AMT                              06070000
061100              ,:DFT00000-S-T-D-DOL-AMT                            06080000
061200              ,:DFT00000-YTD-DOL-AMT                              06090000
061300     END-EXEC.                                                    06100000
061400                                                                  06110000
061500     EVALUATE TRUE                                                06120000
061600         WHEN SQLCODE = ZERO                                      06130000
061700             SET  PS-FOUND-TY-DATA-YES TO TRUE                    06140000
061800                                                                  06150000
061900         WHEN SQLCODE = +100                                      06160000
062000             MOVE 'N' TO PS-FOUND-TY-DATA-SW                      06170000
062100             SET PS-END-OF-CURSOR-YES TO TRUE                     06180000
062200                                                                  06190000
062300         WHEN SQLWARN0 NOT EQUAL SPACE                            06200000
062400         WHEN SQLCODE NOT EQUAL ZERO                              06210000
062500             DISPLAY '                   '                        06220000
062600             DISPLAY 'DTATTR-KY-DTE    = ' DTATTR-KY-DTE          06230000
062700             DISPLAY 'DFT00000-STR-NBR = ' DFT00000-STR-NBR       06240000
062800                                                                  06250000
062900             MOVE SQLCODE                  TO PV-SQLCODE          06260000
063000             MOVE '4100-FETCH-DEPT-CURSOR' TO PV-PARAGRAPH-NAME   06270000
063100             MOVE 'ERROR ON FETCH OF DEPT-CURSOR'                 06280000
063200                                           TO PV-OPERATION-MSG    06290000
063300             PERFORM 9100-SQL-ABEND                               06300000
063400     END-EVALUATE.                                                06310000
063500                                                                  06320000
063600                                                                  06330000
063700******************************************************************06340000
063800* CLOSE DEPT CURSOR                                               06350000
063900******************************************************************06360000
064000 4200-CLOSE-DEPT-CURSOR.                                          06370000
064100                                                                  06380000
064200     EXEC SQL                                                     06390000
064300          CLOSE DEPT-CURSOR                                       06400000
064400     END-EXEC.                                                    06410000
064500                                                                  06420000
064600     EVALUATE TRUE                                                06430000
064700         WHEN SQLCODE = ZERO                                      06440000
064800              CONTINUE                                            06450000
064900                                                                  06460000
065000         WHEN SQLWARN0 NOT EQUAL SPACE                            06470000
065100         WHEN SQLCODE NOT EQUAL ZERO                              06480000
065200             MOVE SQLCODE                  TO PV-SQLCODE          06490000
065300             MOVE '4200-CLOSE-DEPT-CURSOR' TO PV-PARAGRAPH-NAME   06500000
065400             MOVE 'ERROR ON CLOSE OF DEPT-CURSOR'                 06510000
065500                                           TO PV-OPERATION-MSG    06520000
065600             PERFORM 9100-SQL-ABEND                               06530000
065700     END-EVALUATE.                                                06540000
065800                                                                  06550000
065900                                                                  06560000
066000******************************************************************06570000
066100* GET SALES                                                       06580000
066200******************************************************************06590000
066300 5000-GET-SALES.                                                  06600000
066400                                                                  06610000
066500     IF  PS-FOUND-TY-DATA-YES                                     06620000
066600         SET PS-DMM-INDEX       TO XST00126-DMA-NBR               06630000
066700                                                                  06640000
066800         MOVE XST00126-DMA-NBR  TO PS-DMM-NBR (PS-DMM-INDEX)      06650000
066900         MOVE XST00126-DMA-NM   TO PS-DMM-DESC (PS-DMM-INDEX)     06660000
067000                                                                  06670000
067100         PERFORM 5100-PROCESS-TY-SALES                            06680000
067200                                                                  06690000
067300         PERFORM 5200-GET-LY-SALE                                 06700000
067400                                                                  06710000
067500         IF  PS-FOUND-LY-DATA-YES                                 06720000
067600             PERFORM 5300-PROCESS-LY-SALES                        06730000
067700         END-IF                                                   06740000
067800                                                                  06750000
067900     END-IF.                                                      06760000
068000                                                                  06770000
068100                                                                  06780000
068200     PERFORM 4100-FETCH-DEPT-CURSOR.                              06790000
068300                                                                  06800000
068400                                                                  06810000
068500******************************************************************06820000
068600* PROCESS THIS-YEAR SALES                                         06830000
068700******************************************************************06840000
068800 5100-PROCESS-TY-SALES.                                           06850000
068900                                                                  06860000
069000     PERFORM 5110-ACCUM-TY-DATA.                                  06870000
069100                                                                  06880000
069200     IF  PV-DATE >= XST00125-YR-SLS-INCL-DTE                      06890000
069300         PERFORM 5111-ACCUM-TY-YR-SLS                             06900000
069400     ELSE                                                         06910000
069500       IF  PV-DATE >= XST00125-SEA-SLS-INCL-DTE                   06920000
069600           PERFORM 5112-ACCUM-TY-SEA-SLS                          06930000
069700       ELSE                                                       06940000
069800         IF  PV-DATE >= XST00125-QTR-SLS-INCL-DTE                 06950000
069900             PERFORM 5113-ACCUM-TY-QTR-SLS                        06960000
070000         ELSE                                                     06970000
070100           IF  PV-DATE >= XST00125-MN-SLS-INCL-DTE                06980000
070200               PERFORM 5114-ACCUM-TY-MN-SLS                       06990000
070300                                                                  07000000
070400           END-IF                                                 07010000
070500         END-IF                                                   07020000
070600       END-IF                                                     07030000
070700     END-IF.                                                      07040000
070800                                                                  07050000
070900                                                                  07060000
071000******************************************************************07070000
071100* ACCUMULATE THIS-YEAR DATA                                       07080000
071200******************************************************************07090000
071300 5110-ACCUM-TY-DATA.                                              07100000
071400                                                                  07110000
071500     ADD DFT00000-DLY-DOL-AMT   TO PS-TOT-DLY-TY-SLS              07120000
071600                                                (PS-DMM-INDEX).   07130000
071700     ADD DFT00000-WTD-DOL-AMT   TO PS-TOT-WTD-TY-SLS              07140000
071800                                                (PS-DMM-INDEX).   07150000
071900     ADD DFT00000-MTD-DOL-AMT   TO PS-TOT-MTD-TY-SLS              07160000
072000                                                (PS-DMM-INDEX).   07170000
072100     ADD DFT00000-QTD-DOL-AMT   TO PS-TOT-QTD-TY-SLS              07180000
072200                                                (PS-DMM-INDEX).   07190000
072300     ADD DFT00000-S-T-D-DOL-AMT TO PS-TOT-STD-TY-SLS              07200000
072400                                                (PS-DMM-INDEX).   07210000
072500     ADD DFT00000-YTD-DOL-AMT   TO PS-TOT-YTD-TY-SLS              07220000
072600                                                (PS-DMM-INDEX).   07230000
072700                                                                  07240000
072800                                                                  07250000
072900******************************************************************07260000
073000* ACCUMULATE YEAR SALES                                           07270000
073100******************************************************************07280000
073200 5111-ACCUM-TY-YR-SLS.                                            07290000
073300                                                                  07300000
073400     ADD DFT00000-DLY-DOL-AMT   TO                                07310000
073500                          PS-CMP-DLY-TY-SLS (PS-DMM-INDEX).       07320000
073600     ADD DFT00000-WTD-DOL-AMT   TO                                07330000
073700                          PS-CMP-WTD-TY-SLS (PS-DMM-INDEX).       07340000
073800     ADD DFT00000-MTD-DOL-AMT   TO                                07350000
073900                          PS-CMP-MTD-TY-SLS (PS-DMM-INDEX).       07360000
074000     ADD DFT00000-QTD-DOL-AMT   TO                                07370000
074100                          PS-CMP-QTD-TY-SLS (PS-DMM-INDEX).       07380000
074200     ADD DFT00000-S-T-D-DOL-AMT TO PS-CMP-STD-TY-SLS              07390000
074300                                            (PS-DMM-INDEX).       07400000
074400     ADD DFT00000-YTD-DOL-AMT   TO PS-CMP-YTD-TY-SLS              07410000
074500                                            (PS-DMM-INDEX).       07420000
074600                                                                  07430000
074700                                                                  07440000
074800******************************************************************07450000
074900* ACCUMULATE SEASON SALES                                         07460000
075000******************************************************************07470000
075100 5112-ACCUM-TY-SEA-SLS.                                           07480000
075200                                                                  07490000
075300     ADD DFT00000-DLY-DOL-AMT  TO PS-CMP-DLY-TY-SLS               07500000
075400                                            (PS-DMM-INDEX).       07510000
075500     ADD DFT00000-WTD-DOL-AMT  TO PS-CMP-WTD-TY-SLS               07520000
075600                                            (PS-DMM-INDEX).       07530000
075700     ADD DFT00000-MTD-DOL-AMT  TO PS-CMP-MTD-TY-SLS               07540000
075800                                            (PS-DMM-INDEX).       07550000
075900     ADD DFT00000-QTD-DOL-AMT  TO PS-CMP-QTD-TY-SLS               07560000
076000                                            (PS-DMM-INDEX).       07570000
076100     ADD DFT00000-S-T-D-DOL-AMT TO PS-CMP-STD-TY-SLS              07580000
076200                                            (PS-DMM-INDEX).       07590000
076300                                                                  07600000
076400                                                                  07610000
076500******************************************************************07620000
076600* ACCUMULATE QUARTER SALES                                        07630000
076700******************************************************************07640000
076800 5113-ACCUM-TY-QTR-SLS.                                           07650000
076900                                                                  07660000
077000     ADD DFT00000-DLY-DOL-AMT  TO                                 07670000
077100                      PS-CMP-DLY-TY-SLS (PS-DMM-INDEX).           07680000
077200     ADD DFT00000-WTD-DOL-AMT  TO                                 07690000
077300                      PS-CMP-WTD-TY-SLS (PS-DMM-INDEX).           07700000
077400     ADD DFT00000-MTD-DOL-AMT  TO                                 07710000
077500                      PS-CMP-MTD-TY-SLS (PS-DMM-INDEX).           07720000
077600     ADD DFT00000-QTD-DOL-AMT  TO                                 07730000
077700                      PS-CMP-QTD-TY-SLS (PS-DMM-INDEX).           07740000
077800                                                                  07750000
077900                                                                  07760000
078000******************************************************************07770000
078100* ACCUMULATE MONTH SALES                                          07780000
078200******************************************************************07790000
078300 5114-ACCUM-TY-MN-SLS.                                            07800000
078400                                                                  07810000
078500     ADD DFT00000-DLY-DOL-AMT  TO                                 07820000
078600                  PS-CMP-DLY-TY-SLS (PS-DMM-INDEX).               07830000
078700     ADD DFT00000-WTD-DOL-AMT  TO                                 07840000
078800                  PS-CMP-WTD-TY-SLS (PS-DMM-INDEX).               07850000
078900     ADD DFT00000-MTD-DOL-AMT  TO                                 07860000
079000                  PS-CMP-MTD-TY-SLS (PS-DMM-INDEX).               07870000
079100                                                                  07880000
079200                                                                  07890000
079300******************************************************************07900000
079400* GET LAST YEAR SALES                                             07910000
079500******************************************************************07920000
079600 5200-GET-LY-SALE.                                                07930000
079700                                                                  07940000
079800     MOVE 'N' TO PS-FOUND-LY-DATA-SW.                             07950000
079900                                                                  07960000
080000     EXEC SQL                                                     07970000
080100         SELECT COALESCE(SUM(DLY_DOL_AMT),0)                      07980000
080200              , COALESCE(SUM(WTD_DOL_AMT),0)                      07990000
080300              , COALESCE(SUM(MTD_DOL_AMT),0)                      08000000
080400              , COALESCE(SUM(QTD_DOL_AMT),0)                      08010000
080500              , COALESCE(SUM(S_T_D_DOL_AMT),0)                    08020000
080600              , COALESCE(SUM(YTD_DOL_AMT),0)                      08030000
080700                                                                  08040000
080800          INTO :DFT00002-DLY-DOL-AMT                              08050000
080900              ,:DFT00002-WTD-DOL-AMT                              08060000
081000              ,:DFT00002-MTD-DOL-AMT                              08070000
081100              ,:DFT00002-QTD-DOL-AMT                              08080000
081200              ,:DFT00002-S-T-D-DOL-AMT                            08090000
081300              ,:DFT00002-YTD-DOL-AMT                              08100000
081400                                                                  08110000
081500          FROM DFT_ML_FINCL_SUM                                   08120000
081600                                                                  08130000
081700         WHERE SLS_DTE  = :PV-COMP-DATE                           08140000
081800           AND DEPT_NBR = :DFT00000-DEPT-NBR                      08150000
081900           AND STR_NBR  = :DFT00000-STR-NBR                       08160000
082000               WITH UR                                            08170000
082100     END-EXEC.                                                    08180000
082200                                                                  08190000
082300     EVALUATE TRUE                                                08200000
082400        WHEN SQLCODE = ZERO                                       08210000
082500            SET PS-FOUND-LY-DATA-YES TO TRUE                      08220000
082600                                                                  08230000
082700        WHEN SQLCODE = +100                                       08240000
082800            CONTINUE                                              08250000
082900                                                                  08260000
083000        WHEN OTHER                                                08270000
083100            DISPLAY '                    '                        08280000
083200            DISPLAY 'PV-COMP-DATE      = ' PV-COMP-DATE           08290000
083300            DISPLAY 'DFT00000-STR-NBR  = ' DFT00000-STR-NBR       08300000
083400            DISPLAY 'DFT00000-DEPT-NBR = ' DFT00000-DEPT-NBR      08310000
083500                                                                  08320000
083600            MOVE SQLCODE               TO PV-SQLCODE              08330000
083700            MOVE '5200-GET-LY-SALE'    TO PV-PARAGRAPH-NAME       08340000
083800            MOVE 'ERROR GETTING LAST YEAR SALE'                   08350000
083900                                         TO PV-OPERATION-MSG      08360000
084000            PERFORM 9100-SQL-ABEND                                08370000
084100     END-EVALUATE.                                                08380000
084200                                                                  08390000
084300                                                                  08400000
084400******************************************************************08410000
084500* PROCESS LAST-YEAR SALES                                         08420000
084600******************************************************************08430000
084700 5300-PROCESS-LY-SALES.                                           08440000
084800                                                                  08450000
084900     PERFORM 5310-ACCUM-LY-DATA                                   08460000
085000                                                                  08470000
085100     IF  PV-DATE >= XST00125-YR-SLS-INCL-DTE                      08480000
085200         PERFORM 5311-ACCUM-LY-YR-SLS                             08490000
085300     ELSE                                                         08500000
085400       IF  PV-DATE >= XST00125-SEA-SLS-INCL-DTE                   08510000
085500           PERFORM 5312-ACCUM-LY-SEA-SLS                          08520000
085600       ELSE                                                       08530000
085700         IF  PV-DATE >= XST00125-QTR-SLS-INCL-DTE                 08540000
085800             PERFORM 5313-ACCUM-LY-QTR-SLS                        08550000
085900         ELSE                                                     08560000
086000           IF  PV-DATE >= XST00125-MN-SLS-INCL-DTE                08570000
086100               PERFORM 5314-ACCUM-LY-MN-SLS                       08580000
086200                                                                  08590000
086300           END-IF                                                 08600000
086400         END-IF                                                   08610000
086500       END-IF                                                     08620000
086600     END-IF.                                                      08630000
086700                                                                  08640000
086800                                                                  08650000
086900******************************************************************08660000
087000* ACCUMULATE LAST-YEAR DATA                                       08670000
087100******************************************************************08680000
087200 5310-ACCUM-LY-DATA.                                              08690000
087300                                                                  08700000
087400     ADD DFT00002-DLY-DOL-AMT   TO PS-TOT-DLY-LY-SLS              08710000
087500                                            (PS-DMM-INDEX).       08720000
087600     ADD DFT00002-WTD-DOL-AMT   TO PS-TOT-WTD-LY-SLS              08730000
087700                                            (PS-DMM-INDEX).       08740000
087800     ADD DFT00002-MTD-DOL-AMT   TO PS-TOT-MTD-LY-SLS              08750000
087900                                            (PS-DMM-INDEX).       08760000
088000     ADD DFT00002-QTD-DOL-AMT   TO PS-TOT-QTD-LY-SLS              08770000
088100                                            (PS-DMM-INDEX).       08780000
088200     ADD DFT00002-S-T-D-DOL-AMT TO PS-TOT-STD-LY-SLS              08790000
088300                                            (PS-DMM-INDEX).       08800000
088400     ADD DFT00002-YTD-DOL-AMT   TO PS-TOT-YTD-LY-SLS              08810000
088500                                            (PS-DMM-INDEX).       08820000
088600                                                                  08830000
088700                                                                  08840000
088800******************************************************************08850000
088900* ACCUMULATE YEAR SALES                                           08860000
089000******************************************************************08870000
089100 5311-ACCUM-LY-YR-SLS.                                            08880000
089200                                                                  08890000
089300     ADD DFT00002-DLY-DOL-AMT   TO PS-CMP-DLY-LY-SLS              08900000
089400                                        (PS-DMM-INDEX).           08910000
089500     ADD DFT00002-WTD-DOL-AMT   TO PS-CMP-WTD-LY-SLS              08920000
089600                                        (PS-DMM-INDEX).           08930000
089700     ADD DFT00002-MTD-DOL-AMT   TO PS-CMP-MTD-LY-SLS              08940000
089800                                        (PS-DMM-INDEX).           08950000
089900     ADD DFT00002-QTD-DOL-AMT   TO PS-CMP-QTD-LY-SLS              08960000
090000                                        (PS-DMM-INDEX).           08970000
090100     ADD DFT00002-S-T-D-DOL-AMT TO PS-CMP-STD-LY-SLS              08980000
090200                                        (PS-DMM-INDEX).           08990000
090300     ADD DFT00002-YTD-DOL-AMT   TO PS-CMP-YTD-LY-SLS              09000000
090400                                        (PS-DMM-INDEX).           09010000
090500                                                                  09020000
090600                                                                  09030000
090700******************************************************************09040000
090800* ACCUMULATE SEASON SALES                                         09050000
090900******************************************************************09060000
091000 5312-ACCUM-LY-SEA-SLS.                                           09070000
091100                                                                  09080000
091200     ADD DFT00002-DLY-DOL-AMT   TO PS-CMP-DLY-LY-SLS              09090000
091300                                        (PS-DMM-INDEX).           09100000
091400     ADD DFT00002-WTD-DOL-AMT   TO PS-CMP-WTD-LY-SLS              09110000
091500                                        (PS-DMM-INDEX).           09120000
091600     ADD DFT00002-MTD-DOL-AMT   TO PS-CMP-MTD-LY-SLS              09130000
091700                                        (PS-DMM-INDEX).           09140000
091800     ADD DFT00002-QTD-DOL-AMT   TO PS-CMP-QTD-LY-SLS              09150000
091900                                        (PS-DMM-INDEX).           09160000
092000     ADD DFT00002-S-T-D-DOL-AMT TO PS-CMP-STD-LY-SLS              09170000
092100                                        (PS-DMM-INDEX).           09180000
092200                                                                  09190000
092300                                                                  09200000
092400******************************************************************09210000
092500* ACCUMULATE QUARTER SALES                                        09220000
092600******************************************************************09230000
092700 5313-ACCUM-LY-QTR-SLS.                                           09240000
092800                                                                  09250000
092900     ADD DFT00002-DLY-DOL-AMT TO PS-CMP-DLY-LY-SLS                09260000
093000                                        (PS-DMM-INDEX).           09270000
093100     ADD DFT00002-WTD-DOL-AMT TO PS-CMP-WTD-LY-SLS                09280000
093200                                        (PS-DMM-INDEX).           09290000
093300     ADD DFT00002-MTD-DOL-AMT TO PS-CMP-MTD-LY-SLS                09300000
093400                                        (PS-DMM-INDEX).           09310000
093500     ADD DFT00002-QTD-DOL-AMT TO PS-CMP-QTD-LY-SLS                09320000
093600                                        (PS-DMM-INDEX).           09330000
093700                                                                  09340000
093800                                                                  09350000
093900******************************************************************09360000
094000* ACCUMULATE MONTH SALES                                          09370000
094100******************************************************************09380000
094200 5314-ACCUM-LY-MN-SLS.                                            09390000
094300                                                                  09400000
094400     ADD DFT00002-DLY-DOL-AMT TO PS-CMP-DLY-LY-SLS                09410000
094500                                        (PS-DMM-INDEX).           09420000
094600     ADD DFT00002-WTD-DOL-AMT TO PS-CMP-WTD-LY-SLS                09430000
094700                                        (PS-DMM-INDEX).           09440000
094800     ADD DFT00002-MTD-DOL-AMT TO PS-CMP-MTD-LY-SLS                09450000
094900                                        (PS-DMM-INDEX).           09460000
095000                                                                  09470000
095100                                                                  09480000
095200******************************************************************09490000
095300* PREP DETAIL ROW                                                 09500000
095400******************************************************************09510000
095500 6000-PREP-DETAIL-ROW.                                            09520000
095600                                                                  09530000
095700     IF  PS-DMM-NBR (PS-DMM-INDEX) > 0                            09540000
095800                                                                  09550000
095900         MOVE PS-DMM-NBR (PS-DMM-INDEX) TO DL-DMA-NBR             09560000
096000         MOVE PS-DMM-DESC(PS-DMM-INDEX) TO DL-DMA-DSCRPTN         09570000
096100                                                                  09580000
096200         COMPUTE DL-CMP-DLY-TY-SLS ROUNDED =                      09590000
096300                              PS-CMP-DLY-TY-SLS (PS-DMM-INDEX)    09600000
096400         COMPUTE DL-CMP-DLY-LY-SLS ROUNDED =                      09610000
096500                              PS-CMP-DLY-LY-SLS (PS-DMM-INDEX)    09620000
096600         COMPUTE DL-CMP-WTD-TY-SLS ROUNDED =                      09630000
096700                              PS-CMP-WTD-TY-SLS (PS-DMM-INDEX)    09640000
096800         COMPUTE DL-CMP-WTD-LY-SLS ROUNDED =                      09650000
096900                              PS-CMP-WTD-LY-SLS (PS-DMM-INDEX)    09660000
097000         COMPUTE DL-CMP-MTD-TY-SLS ROUNDED =                      09670000
097100                              PS-CMP-MTD-TY-SLS (PS-DMM-INDEX)    09680000
097200         COMPUTE DL-CMP-MTD-LY-SLS ROUNDED =                      09690000
097300                              PS-CMP-MTD-LY-SLS (PS-DMM-INDEX)    09700000
097400         COMPUTE DL-CMP-QTD-TY-SLS ROUNDED =                      09710000
097500                              PS-CMP-QTD-TY-SLS (PS-DMM-INDEX)    09720000
097600         COMPUTE DL-CMP-QTD-LY-SLS ROUNDED =                      09730000
097700                              PS-CMP-QTD-LY-SLS (PS-DMM-INDEX)    09740000
097800         COMPUTE DL-CMP-STD-TY-SLS ROUNDED =                      09750000
097900                              PS-CMP-STD-TY-SLS (PS-DMM-INDEX)    09760000
098000         COMPUTE DL-CMP-STD-LY-SLS ROUNDED =                      09770000
098100                              PS-CMP-STD-LY-SLS (PS-DMM-INDEX)    09780000
098200         COMPUTE DL-CMP-YTD-TY-SLS ROUNDED =                      09790000
098300                              PS-CMP-YTD-TY-SLS (PS-DMM-INDEX)    09800000
098400         COMPUTE DL-CMP-YTD-LY-SLS ROUNDED =                      09810000
098500                              PS-CMP-YTD-LY-SLS (PS-DMM-INDEX)    09820000
098600         COMPUTE DL-TOT-DLY-TY-SLS ROUNDED =                      09830000
098700                              PS-TOT-DLY-TY-SLS (PS-DMM-INDEX)    09840000
098800         COMPUTE DL-TOT-DLY-LY-SLS ROUNDED =                      09850000
098900                              PS-TOT-DLY-LY-SLS (PS-DMM-INDEX)    09860000
099000         COMPUTE DL-TOT-WTD-TY-SLS ROUNDED =                      09870000
099100                              PS-TOT-WTD-TY-SLS (PS-DMM-INDEX)    09880000
099200         COMPUTE DL-TOT-WTD-LY-SLS ROUNDED =                      09890000
099300                              PS-TOT-WTD-LY-SLS (PS-DMM-INDEX)    09900000
099400         COMPUTE DL-TOT-MTD-TY-SLS ROUNDED =                      09910000
099500                              PS-TOT-MTD-TY-SLS (PS-DMM-INDEX)    09920000
099600         COMPUTE DL-TOT-MTD-LY-SLS ROUNDED =                      09930000
099700                              PS-TOT-MTD-LY-SLS (PS-DMM-INDEX)    09940000
099800         COMPUTE DL-TOT-QTD-TY-SLS ROUNDED =                      09950000
099900                              PS-TOT-QTD-TY-SLS (PS-DMM-INDEX)    09960000
100000         COMPUTE DL-TOT-QTD-LY-SLS ROUNDED =                      09970000
100100                              PS-TOT-QTD-LY-SLS (PS-DMM-INDEX)    09980000
100200         COMPUTE DL-TOT-STD-TY-SLS ROUNDED =                      09990000
100300                              PS-TOT-STD-TY-SLS (PS-DMM-INDEX)    10000000
100400         COMPUTE DL-TOT-STD-LY-SLS ROUNDED =                      10010000
100500                              PS-TOT-STD-LY-SLS (PS-DMM-INDEX)    10020000
100600         COMPUTE DL-TOT-YTD-TY-SLS ROUNDED =                      10030000
100700                              PS-TOT-YTD-TY-SLS (PS-DMM-INDEX)    10040000
100800         COMPUTE DL-TOT-YTD-LY-SLS ROUNDED =                      10050000
100900                              PS-TOT-YTD-LY-SLS (PS-DMM-INDEX)    10060000
101000                                                                  10070000
101100         PERFORM 7000-WRITE-DMM-ROW                               10080000
101200                                                                  10090000
101300         SET PS-DMM-INDEX UP BY 1                                 10100000
101400                                                                  10110000
101500     ELSE                                                         10120000
101600         SET PS-DMM-INDEX UP BY 1                                 10130000
101700                                                                  10140000
101800     END-IF.                                                      10150000
101900                                                                  10160000
102000                                                                  10170000
102100******************************************************************10180000
102200* WRITE DMM ROW                                                   10190000
102300******************************************************************10200000
102400 7000-WRITE-DMM-ROW.                                              10210000
102500                                                                  10220000
102600     WRITE SALES-EXTRACT FROM DL-DETAIL-LINE.                     10230000
102700                                                                  10240000
102800     INITIALIZE DL-DETAIL-LINE.                                   10250000
102900                                                                  10260000
103000                                                                  10270000
103100******************************************************************10280000
103200* ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                      10290000
103300******************************************************************10300000
103400 9000-ABEND.                                                      10310000
103500                                                                  10320000
103600     PERFORM 9900-EOJ-ROUTINE.                                    10330000
103700                                                                  10340000
103800     DISPLAY '                     '.                             10350000
103900     DISPLAY '** ABEND           **'.                             10360000
104000     DISPLAY '** PROGRAM         ** = ' PC-PGM-NAME.              10370000
104100     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        10380000
104200     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         10390000
104300                                                                  10400000
104400     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         10410000
104500                                                                  10420000
104600                                                                  10430000
104700******************************************************************10440000
104800* ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.    10450000
104900******************************************************************10460000
105000 9100-SQL-ABEND.                                                  10470000
105100                                                                  10480000
105200     PERFORM 9900-EOJ-ROUTINE.                                    10490000
105300                                                                  10500000
105400     DISPLAY '                 '.                                 10510000
105500     DISPLAY '** ABEND       **'.                                 10520000
105600     DISPLAY '** PROGRAM     ** = ' PC-PGM-NAME.                  10530000
105700     DISPLAY '** SQLCODE     ** = ' PV-SQLCODE.                   10540000
105800     DISPLAY '** DATE        ** = ' PV-DATE.                      10550000
105900     DISPLAY '** PARAGRAPH   ** = ' PV-PARAGRAPH-NAME.            10560000
106000     DISPLAY '** OPERATION   ** = ' PV-OPERATION-MSG.             10570000
106100                                                                  10580000
106200******************************************************************10590000
106300* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     10600000
106400* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      10610000
106500******************************************************************10620000
106600     COPY DPPD004.                                                10630000
106700                                                                  10640000
106800     SET AC-DB2-ERROR TO TRUE.                                    10650000
106900                                                                  10660000
107000     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         10670000
107100                                                                  10680000
107200                                                                  10690000
107300******************************************************************10700000
107400* PREFORMS TASK TERMINATION PROCESSING                            10710000
107500******************************************************************10720000
107600 9900-EOJ-ROUTINE.                                                10730000
107700                                                                  10740000
107800     CLOSE DAILY-FLASH-SALES.                                     10750000
107900                                                                  10760000
108000     PERFORM 9999-CONTROLS.                                       10770000
108100                                                                  10780000
108200                                                                  10790000
108300******************************************************************10800000
108400* DISPLAY CONTROLS FROM THE PROGRAM                               10810000
108500******************************************************************10820000
108600 9999-CONTROLS.                                                   10830000
108700                                                                  10840000
108800     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 10850000
108900                                                                  10860000
109000     MOVE SYS-TIME (1:2) TO ST-END-HR.                            10870000
109100     MOVE SYS-TIME (3:2) TO ST-END-MN.                            10880000
109200                                                                  10890000
109300     DISPLAY '                    '.                              10900000
109400     DISPLAY '**********************'.                            10910000
109500     DISPLAY '   DFKUT011 CONTROLS  '.                            10920000
109600     DISPLAY '**********************'.                            10930000
109700     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         10940000
109800     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          10950000
109900     DISPLAY 'END TIME  = ' ST-END-TIME.                          10960000
110000     DISPLAY '======================'.                            10970000
110100     DISPLAY 'TY DATE = '  PV-DATE.                               10980000
110200     DISPLAY 'LY DATE = '  PV-COMP-DATE.                          10990000
110300     DISPLAY '          '.                                        11000000
110310     DISPLAY 'STR READ = ' PA-STR-READ.                           11010000
110320     DISPLAY '          '.                                        11020000
110400                                                                  11030000
110500                                                                  11040000
