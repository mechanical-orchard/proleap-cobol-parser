000100 IDENTIFICATION DIVISION.                                         00010021
000200 TITLE 'REMOVE SEPHORA STORE NOT READY FOR CLEAN PROCESS'.        00020021
000300                                                                  00030021
000400 PROGRAM-ID.             PCKUT118.                                00040021
000500 AUTHOR.                 DENISE HAHN.                             00050021
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060021
000700 DATE-WRITTEN            MAY 2021.                                00070021
000800 DATE-COMPILED.                                                   00080021
000900                                                                  00090021
001000 ENVIRONMENT DIVISION.                                            00100021
001100 CONFIGURATION SECTION.                                           00110021
001200                                                                  00120021
001300 SOURCE-COMPUTER.        IBM-3090.                                00130021
001400 OBJECT-COMPUTER.        IBM-3090.                                00140021
001500                                                                  00150021
001600 INPUT-OUTPUT SECTION.                                            00160021
001700                                                                  00170021
001800 FILE-CONTROL.                                                    00180021
001900                                                                  00190021
002000     SELECT INVENTORY-STORE-FILE-IN                               00200021
002100         ASSIGN TO INP01.                                         00210021
002200                                                                  00220021
002300     SELECT INVENTORY-STORE-FILE-OUT                              00230021
002400         ASSIGN TO OUT01.                                         00240021
002500                                                                  00250021
002600                                                                  00260021
002700 DATA DIVISION.                                                   00270021
002800 FILE SECTION.                                                    00280021
002900                                                                  00290021
003000                                                                  00300021
003100 FD  INVENTORY-STORE-FILE-IN                                      00310021
003200     RECORDING MODE IS F                                          00320021
003300     LABEL RECORDS ARE STANDARD                                   00330021
003400     BLOCK CONTAINS 0 RECORDS.                                    00340021
003500                                                                  00350021
003600 01  INVENTORY-STORE-RECORD-IN        PIC  X(035).                00360021
003700                                                                  00370021
003800 FD  INVENTORY-STORE-FILE-OUT                                     00380021
003900     RECORDING MODE IS F                                          00390021
004000     LABEL RECORDS ARE STANDARD                                   00400021
004100     BLOCK CONTAINS 0 RECORDS.                                    00410021
004200                                                                  00420021
004300 01  INVENTORY-STORE-RECORD-OUT       PIC  X(035).                00430021
004400                                                                  00440021
004500                                                                  00450021
004600 WORKING-STORAGE SECTION.                                         00460021
004700                                                                  00470021
004800 01  FILLER.                                                      00480021
004900     05  FILLER                      PIC  X(36)    VALUE          00490021
005000         ' ***** WORKING STORAGE PGM=PCKUT118 '.                  00500021
005100     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00510021
005200                                                                  00520021
005300 01  PS-SWITCHES.                                                 00530021
005400     05  PS-EOF-PC041-SW              PIC X(01) VALUE 'N'.        00540021
005500         88  PS-EOF-PC041-YES                   VALUE 'Y'.        00550021
005600         88  PS-EOF-PC041-NO                    VALUE 'N'.        00560021
005700                                                                  00570021
005800     05  PS-END-CSR-SW                PIC X(01) VALUE 'N'.        00580021
005900         88  PS-END-CSR-YES                     VALUE 'Y'.        00590021
006000         88  PS-END-CSR-NO                      VALUE 'N'.        00600021
006100     05  PS-ERROR-SW                  PIC X(01) VALUE 'N'.        00610021
006200         88  PS-ERROR-YES                       VALUE 'Y'.        00620021
006300         88  PS-ERROR-NO                        VALUE 'N'.        00630021
006400     05  PS-SEPHORA-DEPT-SW           PIC X(01) VALUE 'N'.        00640021
006500         88  PS-SEPHORA-DEPT-YES                VALUE 'Y'.        00650021
006600         88  PS-SEPHORA-DEPT-NO                 VALUE 'N'.        00660021
006700     05  PS-SEPHORA-SUPP-DC-SW        PIC X(01) VALUE 'N'.        00670021
006800         88  PS-SEPHORA-SUPP-DC-YES             VALUE 'Y'.        00680021
006900         88  PS-SEPHORA-SUPP-DC-NO              VALUE 'N'.        00690021
007000                                                                  00700021
007100 01  PV-SYSIN-AREA.                                               00710021
007200     05  PV-SYSIN-DATE                PIC X(10).                  00720021
007300     05  FILLER                       PIC X(70).                  00730021
007400                                                                  00740021
007500 01  PC-CONSTANTS.                                                00750021
007600     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00760021
007700                                                   'PCKUT118'.    00770021
007800     05  PC-ILBOABN0                 PIC  X(08)    VALUE          00780021
007900                                                   'ILBOABN0'.    00790021
008000                                                                  00800021
008100 01  PV-MSG-HEADER.                                               00810021
008200     05  FILLER                       PIC X(33) VALUE             00820021
008300         'NBR   NAME                     '.                       00830021
008400     05  FILLER                       PIC X(42) VALUE             00840021
008500         'OPEN DATE   SE-START DT  GO-LIVE         '.             00850021
008510     05  FILLER                       PIC X(23) VALUE             00851021
008520         ' COUNT   PHASE         '.                               00852021
008530                                                                  00853021
008540 01  PV-PROGRAM-VARIABLES.                                        00854021
008550     05  PV-ATTR_ELEM_SEQ_NBR         PIC S9(09) COMP             00855021
008560                                                 VALUE ZEROES.    00856021
008570     05  PV-ATTR-ELEM-STR-NBR         PIC S9(10)V9(5) COMP-3      00857021
008580                                                 VALUE ZEROES.    00858021
008590     05  PV-ATTR-ELEM-PHASE           PIC S9(10)V9(5) COMP-3      00859021
008600                                                 VALUE ZEROES.    00860021
008700     05  PV-ATTR-SE-START-DATE        PIC  X(10) VALUE SPACES.    00870021
008800     05  PV-ATTR-GO-LIVE-DATE         PIC  X(10) VALUE SPACES.    00880021
008900     05  PV-ATTR-ACTIVE-CODE          PIC  X(02) VALUE SPACES.    00890021
009000     05  PV-SEPH-DEPT-CNT             PIC S9(09) COMP.            00900021
009100     05  PV-NOT-SEPH-CNT              PIC S9(09) COMP.            00910021
009200     05  PV-SEPH-CNTRL-STOCK-CNT      PIC S9(09) COMP.            00920021
009300     05  PV-SEPH-BYPASS-SE-CNT        PIC S9(09) COMP.            00930021
009310     05  PV-SEPH-SE-CNT               PIC S9(09) COMP.            00931021
009320     05  PV-PREV-INTR-UPC-ID          PIC S9(09) COMP.            00932021
009321                                                                  00932121
009322     05  PV-STORE-COUNT               PIC S9(05) COMP-3           00932221
009323                                              VALUE ZERO.         00932321
009324     05  PV-READ-PC041-COUNTER        PIC S9(09) COMP-3           00932421
009325                                              VALUE ZERO.         00932521
009326     05  PV-WRITE-1-COUNTER           PIC S9(09) COMP-3           00932621
009327                                              VALUE ZERO.         00932721
009328                                                                  00932821
009329     05  PV-DISP-SQL                  PIC -999.                   00932921
009330     05  PV-DISP-INTR-UPC-ID          PIC 9(09).                  00933021
009340     05  PV-DISP-PO-NBR               PIC Z(9).                   00934021
009350     05  PV-DISP-RCVR                 PIC Z(4).                   00935021
009360     05  PV-DISP-STR                  PIC Z(4).                   00936021
009370     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZ9.            00937021
009380                                                                  00938021
009390*                                                                 00939021
009400 01  PV-MISC-STUFF.                                               00940021
009500     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACES.    00950021
009600     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(60) VALUE SPACE.     00960021
009700     05  PV-SQL-CODE                  PIC  9(04) VALUE ZERO.      00970021
009800     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       00980021
009900                                                   COMP SYNC.     00990021
010000     05  PV-ABEND-OPERATION           PIC X(20) VALUE SPACES.     01000021
010100     05  PV-ABEND-STRUCTURE-1         PIC X(20) VALUE SPACES.     01010021
010200                                                                  01020021
010300 01  DK-DB2-KEYS.                                                 01030021
010400     05  DK-INTR-UPC-ID               PIC  S9(9) COMP.            01040021
010500     05  DK-PO-NBR                    PIC  S9(9) COMP.            01050021
010600     05  DK-RCVR                      PIC  S9(9) COMP.            01060021
010700     05  DK-STR                       PIC  S9(4) COMP.            01070021
010800                                                                  01080021
010900 01  ABEND-CODE                       PIC S9(04)     VALUE +0     01090021
011000                                                     COMP SYNC.   01100021
011100     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01110021
011200     88  ABEND-4002-READ-ERROR                       VALUE +4002. 01120021
011300     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01130021
011400     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01140021
011500     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01150021
011600     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01160021
011700     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01170021
011800     88  ABEND-4008-DATS-ERROR                       VALUE +4008. 01180021
011900     88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 01190021
012000     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01200021
012100                                                                  01210021
012200*    OUT OF BALANCE FILE                                          01220021
012300     COPY PCRD041.                                                01230021
012400*                                                                 01240021
012500*-----------------------------------------------------------------01250021
012600*    LOCATION MASTER - XLT_LOC                                    01260021
012700*-----------------------------------------------------------------01270021
012800     EXEC SQL                                                     01280021
012900         INCLUDE XLT00010                                         01290021
013000     END-EXEC.                                                    01300021
013100                                                                  01310021
013200*-----------------------------------------------------------------01320021
013300*    STORE-DC-ASGMT - XLT_DC_LOC_ASGMT                            01330021
013400*-----------------------------------------------------------------01340021
013500     EXEC SQL                                                     01350021
013600         INCLUDE XLT00014                                         01360021
013700     END-EXEC.                                                    01370021
013800                                                                  01380021
013900*-----------------------------------------------------------------01390021
014000*    RECEIVER                                                     01400021
014100*-----------------------------------------------------------------01410021
014200     EXEC SQL                                                     01420021
014300         INCLUDE TRECEIV                                          01430021
014400     END-EXEC.                                                    01440021
014500                                                                  01450021
014600*-----------------------------------------------------------------01460021
014700*    WST_INTGRTN_TYP                                              01470021
014800*-----------------------------------------------------------------01480021
014900     EXEC SQL                                                     01490021
015000         INCLUDE WST00008                                         01500021
015100     END-EXEC.                                                    01510021
015200                                                                  01520021
015300*-----------------------------------------------------------------01530021
015400*    WST_ATTR_DEFN                                                01540021
015500*-----------------------------------------------------------------01550021
015600     EXEC SQL                                                     01560021
015700         INCLUDE WST00009                                         01570021
015800     END-EXEC.                                                    01580021
015900                                                                  01590021
016000*-----------------------------------------------------------------01600021
016100*    WST_ATTR_ELEM                                                01610021
016200*-----------------------------------------------------------------01620021
016300     EXEC SQL                                                     01630021
016400         INCLUDE WST00010                                         01640021
016500     END-EXEC.                                                    01650021
016600                                                                  01660021
016700*-----------------------------------------------------------------01670021
016800*    XLT_SKU                                                      01680021
016900*-----------------------------------------------------------------01690021
017000     EXEC SQL                                                     01700021
017100         INCLUDE XLT00003                                         01710021
017200     END-EXEC.                                                    01720021
017300                                                                  01730021
017400*-----------------------------------------------------------------01740021
017500*    XLT_VND_STYL                                                 01750021
017600*-----------------------------------------------------------------01760021
017700     EXEC SQL                                                     01770021
017800         INCLUDE XLT00004                                         01780021
017900     END-EXEC.                                                    01790021
018000                                                                  01800021
018100*-----------------------------------------------------------------01810021
018200*    XLT_DEPT                                                     01820021
018300*-----------------------------------------------------------------01830021
018400*    EXEC SQL                                                     01840021
018500*        INCLUDE XLT00002                                         01850021
018600*    END-EXEC.                                                    01860021
018700*                                                                 01870021
018800*-----------------------------------------------------------------01880021
018900*                                                                 01890021
019000*-----------------------------------------------------------------01900021
019100     EXEC SQL                                                     01910021
019200         INCLUDE SQLCA                                            01920021
019300     END-EXEC.                                                    01930021
019400                                                                  01940021
019500     COPY SQLCA2.                                                 01950021
019600                                                                  01960021
019700     EXEC SQL                                                     01970021
019800         DECLARE STORE-CSR CURSOR FOR                             01980021
019900         SELECT                                                   01990021
020000                H.LOC_NBR                                         02000021
020100              , H.OPN_DTE                                         02010021
020200              , H.CLO_DTE                                         02020021
020300              , H.LOC_NM                                          02030021
020400              , C.ATTR_ELEM_SEQ_NBR                               02040021
020500              , C.ATTR_ELEM_NBR        AS STORE_NUMBER            02050021
020600              , D.ATTR_ELEM_NBR        AS PHASE_NUMBER            02060021
020700              , DATE(E.ATTR_ELEM_TMST) AS SE_START_DATE           02070021
020800              , DATE(F.ATTR_ELEM_TMST) AS GO_LIVE_DATE            02080021
020900              , G.ATTR_ELEM_TXT        AS ACTIVE_CODE             02090021
021000         FROM                                                     02100021
021100              WST_INTGRTN_TYP  A                                  02110021
021200            , WST_ATTR_DEFN    B                                  02120021
021300            , WST_ATTR_ELEM    C      -- STORE NUMBER             02130021
021400            , WST_ATTR_ELEM    D      -- PHASE NUMBER             02140021
021500            , WST_ATTR_ELEM    E      -- SE CLEAN START DATE      02150021
021600            , WST_ATTR_ELEM    F      -- GO LIVE DATE             02160021
021700            , WST_ATTR_ELEM    G      -- AC/IN  ACTIVE/INACTIVE   02170021
021800            , XLT_LOC          H                                  02180021
021900         WHERE                                                    02190021
022000               A.INTGRTN_TYP_CDE   = 'SEPHSESTRT'                 02200021
022100           AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE            02210021
022200           AND B.ATTR_DEFN_SEQ_NBR = 1                            02220021
022300           AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE            02230021
022400           AND C.ATTR_DEFN_SEQ_NBR = 1                            02240021
022500           AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE            02250021
022600           AND D.ATTR_DEFN_SEQ_NBR = 2                            02260021
022700           AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE            02270021
022800           AND E.ATTR_DEFN_SEQ_NBR = 3                            02280021
022900           AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE            02290021
023000           AND F.ATTR_DEFN_SEQ_NBR = 4                            02300021
023100           AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE            02310021
023200           AND G.ATTR_DEFN_SEQ_NBR = 5                            02320021
023300                                                                  02330021
023400           AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR          02340021
023500           AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR          02350021
023600           AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR          02360021
023700           AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR          02370021
023800                                                                  02380021
023900           AND C.ATTR_ELEM_NBR             =  H.LOC_NBR           02390021
024000           AND DATE(E.ATTR_ELEM_TMST)     <= :PV-SYSIN-DATE       02400021
024100           AND H.OPN_DTE                  <= :PV-SYSIN-DATE       02410021
024200           AND H.CLO_DTE                   > :PV-SYSIN-DATE       02420021
024300           AND H.LOC_TYP_CDE               = 'DS'                 02430021
024310         UNION ALL                                                02431024
024320         SELECT AA.LOC_NBR                                        02432021
024330              , AA.OPN_DTE                                        02433021
024340              , AA.CLO_DTE                                        02434021
024350              , AA.LOC_NM                                         02435021
024360              , 999                                               02436021
024370              , AA.LOC_NBR        AS STORE_NUMBER                 02437021
024380              , 999               AS PHASE_NUMBER                 02438021
024390              , :PV-SYSIN-DATE    AS SE_START_DATE                02439021
024391              , :PV-SYSIN-DATE    AS GO_LIVE_DATE                 02439121
024392              , 'AC'              AS ACTIVE_CODE                  02439221
024395           FROM XLT_LOC AA                                        02439522
024396          WHERE OPN_DTE        <= CURRENT DATE                    02439621
024397            AND CLO_DTE        >= CURRENT DATE                    02439721
024398            AND LOC_TYP_CDE IN ('DS','CS','RV')                   02439821
024399            AND NOT AA.LOC_NBR IN                                 02439921
024400         (SELECT CCC.ATTR_ELEM_NBR        AS STORE_NUMBER         02440021
024401         FROM                                                     02440121
024402              WST_INTGRTN_TYP  AAA                                02440221
024403            , WST_ATTR_DEFN    BBB                                02440321
024404            , WST_ATTR_ELEM    CCC      -- STORE NUMBER           02440421
024405            , WST_ATTR_ELEM    DDD      -- PHASE NUMBER           02440521
024406            , WST_ATTR_ELEM    EEE      -- SE CLEAN START         02440621
024407            , WST_ATTR_ELEM    FFF      -- GO LIVE DATE           02440721
024408            , WST_ATTR_ELEM    GGG      -- AC/IN  ACTIVE CODE     02440821
024409            , XLT_LOC          HHH                                02440921
024410         WHERE                                                    02441021
024411               AAA.INTGRTN_TYP_CDE   = 'SEPHSESTRT'               02441121
024412           AND AAA.INTGRTN_TYP_CDE   = BBB.INTGRTN_TYP_CDE        02441221
024413           AND BBB.ATTR_DEFN_SEQ_NBR = 1                          02441321
024414           AND BBB.INTGRTN_TYP_CDE   = CCC.INTGRTN_TYP_CDE        02441421
024415           AND CCC.ATTR_DEFN_SEQ_NBR = 1                          02441521
024416           AND BBB.INTGRTN_TYP_CDE   = DDD.INTGRTN_TYP_CDE        02441623
024417           AND DDD.ATTR_DEFN_SEQ_NBR = 2                          02441721
024418           AND BBB.INTGRTN_TYP_CDE   = EEE.INTGRTN_TYP_CDE        02441821
024419           AND EEE.ATTR_DEFN_SEQ_NBR = 3                          02441921
024420           AND BBB.INTGRTN_TYP_CDE   = FFF.INTGRTN_TYP_CDE        02442021
024421           AND FFF.ATTR_DEFN_SEQ_NBR = 4                          02442121
024422           AND BBB.INTGRTN_TYP_CDE   = GGG.INTGRTN_TYP_CDE        02442221
024424           AND GGG.ATTR_DEFN_SEQ_NBR = 5                          02442421
024426           AND CCC.ATTR_ELEM_SEQ_NBR = DDD.ATTR_ELEM_SEQ_NBR      02442621
024427           AND CCC.ATTR_ELEM_SEQ_NBR = EEE.ATTR_ELEM_SEQ_NBR      02442721
024428           AND CCC.ATTR_ELEM_SEQ_NBR = FFF.ATTR_ELEM_SEQ_NBR      02442821
024429           AND CCC.ATTR_ELEM_SEQ_NBR = GGG.ATTR_ELEM_SEQ_NBR      02442921
024431           AND CCC.ATTR_ELEM_NBR     = HHH.LOC_NBR                02443121
024432           AND HHH.LOC_TYP_CDE       = 'DS'                       02443221
024433         )                                                        02443321
024490         ORDER BY 1                                               02449021
024500          WITH UR                                                 02450021
024600     END-EXEC.                                                    02460021
024700                                                                  02470021
024800     COPY DPWS004.                                                02480021
024900                                                                  02490021
025000*  SEPHORA SE START                                               02500021
025100 01  PT-LOC-TABLE.                                                02510021
025200     05  PT-LOC-ELEMENT OCCURS 9999 TIMES INDEXED BY PT-LOC-IDX.  02520021
025300         10  PT-STORE                 PIC S9(04) COMP.            02530021
025400         10  PT-PHASE-NBR             PIC  9(04).                 02540021
025500         10  PT-GO-LIVE-DATE          PIC  X(10).                 02550021
025600         10  PT-SE-CLEAN-START-DATE   PIC  X(10).                 02560021
025700         10  PT-STORE-COUNT           PIC S9(08) COMP.            02570021
025800         10  PT-OPN-DTE               PIC  X(10).                 02580021
025900         10  PT-CLO-DTE               PIC  X(10).                 02590021
026000         10  PT-LOC-NM                PIC  X(40).                 02600021
026100                                                                  02610021
026200 PROCEDURE DIVISION.                                              02620021
026300                                                                  02630021
026400     PERFORM 1000-INITIALIZATION.                                 02640021
026500                                                                  02650021
026600     PERFORM 2000-PROCESS                                         02660021
026700       UNTIL PS-EOF-PC041-YES OR                                  02670021
026800             PS-ERROR-YES.                                        02680021
026900                                                                  02690021
027000     PERFORM 9000-QUIT.                                           02700021
027100                                                                  02710021
027200     GOBACK.                                                      02720021
027300                                                                  02730021
027400 1000-INITIALIZATION.                                             02740021
027500     MOVE '1000-INITIALIZATION         '  TO PV-ABEND-PARAGRAPH.  02750021
027600                                                                  02760021
027700     DISPLAY 'START PCKUT118'                                     02770021
027800                                                                  02780021
027900     ACCEPT PV-SYSIN-DATE FROM SYSIN                              02790021
028000                                                                  02800021
028100     IF PV-SYSIN-DATE = SPACES OR LOW-VALUES                      02810021
028200         DISPLAY 'SYSIN DATE REQUIRED'                            02820021
028300         DISPLAY 'OUTPUT FILES WILL BE EMPTY'                     02830021
028400         SET PS-ERROR-YES                                         02840021
028500             PS-EOF-PC041-YES         TO TRUE                     02850021
028600     ELSE                                                         02860021
028700         DISPLAY ' RUN DATE IS: ' PV-SYSIN-DATE                   02870021
028800     END-IF                                                       02880021
028900                                                                  02890021
029000     IF PS-ERROR-NO                                               02900021
029100         PERFORM 1100-BUILD-SE-LOC-START                          02910021
029200     END-IF                                                       02920021
029300                                                                  02930021
029400                                                                  02940021
029500     OPEN INPUT INVENTORY-STORE-FILE-IN                           02950021
029600     OPEN OUTPUT INVENTORY-STORE-FILE-OUT.                        02960021
029700                                                                  02970021
029800     PERFORM 8000-READ-INV-STORES.                                02980021
029900                                                                  02990021
030000                                                                  03000021
030100*----------------------------------------------------------------*03010021
030200*                                                                *03020021
030300*                                                                *03030021
030400*----------------------------------------------------------------*03040021
030500 1100-BUILD-SE-LOC-START.                                         03050021
030600     INITIALIZE PT-LOC-TABLE                                      03060021
030700     PERFORM 7000-OPEN-STORE-CSR.                                 03070021
030800     PERFORM 7010-FETCH-STORE-CSR.                                03080021
030900                                                                  03090021
031000     PERFORM                                                      03100021
031100       UNTIL PS-END-CSR-YES                                       03110021
031200         MOVE XLT00010-LOC-NBR        TO PT-STORE                 03120021
031300                                         (XLT00010-LOC-NBR)       03130021
031400         MOVE XLT00010-OPN-DTE        TO PT-OPN-DTE               03140021
031500                                         (XLT00010-LOC-NBR)       03150021
031600         IF XLT00010-CLO-DTE < '9999-09-09'                       03160021
031700             MOVE XLT00010-CLO-DTE    TO PT-CLO-DTE               03170021
031800                                         (XLT00010-LOC-NBR)       03180021
031900         END-IF                                                   03190021
032000         MOVE XLT00010-LOC-NM         TO PT-LOC-NM                03200021
032100                                         (XLT00010-LOC-NBR)       03210021
032200         MOVE PV-ATTR-ELEM-PHASE      TO PT-PHASE-NBR             03220021
032300                                         (XLT00010-LOC-NBR)       03230021
032400         MOVE PV-ATTR-GO-LIVE-DATE    TO PT-GO-LIVE-DATE          03240021
032500                                         (XLT00010-LOC-NBR)       03250021
032600         MOVE PV-ATTR-SE-START-DATE   TO PT-SE-CLEAN-START-DATE   03260021
032700                                         (XLT00010-LOC-NBR)       03270021
032800         MOVE ZEROES                  TO PT-STORE-COUNT           03280021
032900                                         (XLT00010-LOC-NBR)       03290021
033000                                                                  03300021
033100         PERFORM 7010-FETCH-STORE-CSR                             03310021
033200     END-PERFORM.                                                 03320021
033300                                                                  03330021
033400     PERFORM 7020-CLOSE-STORE-CSR.                                03340021
033500                                                                  03350021
033600*----------------------------------------------------------------*03360021
033700*                                                                *03370021
033800*                                                                *03380021
033900*----------------------------------------------------------------*03390021
034000 2000-PROCESS.                                                    03400021
034100                                                                  03410021
034200     MOVE '2000-PROCESS'                  TO PV-ABEND-PARAGRAPH.  03420021
034300                                                                  03430021
034400     IF  PC041-INTR-UPC-ID  =  PV-PREV-INTR-UPC-ID                03440021
034500         CONTINUE                                                 03450021
034600     ELSE                                                         03460021
034700         SET  PS-SEPHORA-DEPT-NO  TO  TRUE                        03470021
034800         MOVE SPACE  TO  PS-SEPHORA-SUPP-DC-SW                    03480021
034900         PERFORM 3000-CHECK-SEPHORA-DEPT                          03490021
035000     END-IF                                                       03500021
035100                                                                  03510021
035200     IF  PS-SEPHORA-DEPT-NO                                       03520021
035300         MOVE SPACE  TO  PS-SEPHORA-SUPP-DC-SW                    03530021
035400         PERFORM 8100-WRITE-OPEN                                  03540021
035500         ADD 1  TO  PV-NOT-SEPH-CNT                               03550021
035600     ELSE                                                         03560021
035700*                                                                 03570021
035800*        SEPHORA ORDER WITH RECEIVER SEQ < 1 IT IS A              03580021
035900*        CENTRAL STOCK PULL                                       03590021
036000*                                                                 03600021
036100         IF  PC041-RCVR-SEQ-NBR < 1                               03610021
036200             SET PS-SEPHORA-SUPP-DC-NO  TO TRUE                   03620021
036300             PERFORM 8100-WRITE-OPEN                              03630021
036400             ADD 1  TO  PV-SEPH-CNTRL-STOCK-CNT                   03640021
036500         ELSE                                                     03650021
036600*                                                                 03660021
036700*        SEPHORA ORDER AND STORE EXPECTED STARTED                 03670021
036710*                                                                 03671021
036720             IF  PC041-LOC-NBR = PT-STORE (PC041-LOC-NBR)         03672021
036721                 PERFORM 2100-PROCESS-SEPHORA                     03672121
036722             ELSE                                                 03672221
036723                ADD 1  TO  PV-SEPH-BYPASS-SE-CNT                  03672321
036724             END-IF                                               03672421
036725         END-IF                                                   03672521
036726     END-IF.                                                      03672621
036727                                                                  03672721
036728                                                                  03672821
036729     PERFORM 8000-READ-INV-STORES.                                03672921
036730                                                                  03673021
036740                                                                  03674021
036750*----------------------------------------------------------------*03675021
036760*                                                                *03676021
036770*                                                                *03677021
036780*----------------------------------------------------------------*03678021
036790 2100-PROCESS-SEPHORA.                                            03679021
036800                                                                  03680021
036900     MOVE '2000-PROCESS'                  TO PV-ABEND-PARAGRAPH.  03690021
037000                                                                  03700021
037100     SET PS-SEPHORA-SUPP-DC-NO  TO TRUE                           03710021
037200     PERFORM 3010-CHECK-SUPPORT-DC.                               03720021
037300                                                                  03730021
037400     SET  PC041-SEPHORA    TO TRUE                                03740021
037500     IF  PS-SEPHORA-SUPP-DC-YES                                   03750021
037600         SET  PC041-SEPHORA-SUPPORT-DC   TO  TRUE                 03760021
037700     ELSE                                                         03770021
037800         SET  PC041-SEPHORA-DIFFERENT-DC TO  TRUE                 03780021
037900     END-IF.                                                      03790021
038000                                                                  03800021
038100     MOVE PC041-INTR-UPC-ID  TO  PV-PREV-INTR-UPC-ID              03810021
038200                                                                  03820021
038300     PERFORM 8100-WRITE-OPEN                                      03830021
038400     ADD 1    TO  PV-SEPH-SE-CNT.                                 03840021
038500     ADD 1    TO  PT-STORE-COUNT (PC041-LOC-NBR).                 03850021
038600                                                                  03860021
038700                                                                  03870021
038800                                                                  03880021
038900*----------------------------------------------------------------*03890021
039000*  CHECK IF THE DEPARTMENT ON THE PO IS FOR A SEPHORA DEPARTMENT *03900021
039100*----------------------------------------------------------------*03910021
039200 3000-CHECK-SEPHORA-DEPT.                                         03920021
039300                                                                  03930021
039400     MOVE '3000-CHECK-SEPHORA-DEPT' TO PV-ABEND-PARAGRAPH.        03940021
039500                                                                  03950021
039600     SET  PS-SEPHORA-DEPT-NO  TO  TRUE.                           03960021
039700     MOVE PC041-INTR-UPC-ID   TO  DK-INTR-UPC-ID.                 03970021
039800                                                                  03980021
039900     EXEC SQL                                                     03990021
040000          SELECT COUNT(*)                                         04000021
040100            INTO :PV-SEPH-DEPT-CNT                                04010021
040200            FROM WST_INTGRTN_TYP A                                04020021
040300               , WST_ATTR_DEFN B                                  04030021
040400               , WST_ATTR_ELEM C  -- DEPARTMENT                   04040021
040500               , WST_ATTR_ELEM D  -- AC/IN    ACTIVE/INACTIVE     04050021
040600               , WST_ATTR_ELEM E  -- BEGIN TMST                   04060021
040700               , WST_ATTR_ELEM F  -- END TMST                     04070021
040800               , WST_ATTR_ELEM G  -- SEPHORA WORLD                04080021
040900               , XLT_SKU H                                        04090021
041000               , XLT_VND_STYL I                                   04100021
041100           WHERE A.INTGRTN_TYP_CDE   = 'SEPHORDEPT'               04110021
041200             AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE          04120021
041300             AND B.ATTR_DEFN_SEQ_NBR = 1                          04130021
041400             AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE          04140021
041500             AND C.ATTR_DEFN_SEQ_NBR = 1                          04150021
041600             AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE          04160021
041700             AND D.ATTR_DEFN_SEQ_NBR = 2                          04170021
041800             AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE          04180021
041900             AND E.ATTR_DEFN_SEQ_NBR = 3                          04190021
042000             AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE          04200021
042100             AND F.ATTR_DEFN_SEQ_NBR = 4                          04210021
042200             AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE          04220021
042300             AND G.ATTR_DEFN_SEQ_NBR = 5                          04230021
042400             AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR        04240021
042500             AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR        04250021
042600             AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR        04260021
042700             AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR        04270021
042800             AND D.ATTR_ELEM_TXT     = 'AC'                       04280021
042900             AND E.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP          04290021
043000             AND F.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP          04300021
043100             AND H.INTR_UPC_ID       = :DK-INTR-UPC-ID            04310021
043200             AND H.STYL_ID           = I.STYL_ID                  04320021
043300             AND C.ATTR_ELEM_NBR     = I.DEPT_NBR                 04330021
043400           FETCH FIRST 1 ROW ONLY                                 04340021
043500            WITH UR                                               04350021
043600     END-EXEC                                                     04360021
043700                                                                  04370021
043800     EVALUATE TRUE                                                04380021
043900         WHEN SQLCODE = ZERO                                      04390021
044000              IF  PV-SEPH-DEPT-CNT   >  0                         04400021
044100                  SET  PS-SEPHORA-DEPT-YES  TO  TRUE              04410021
044200              END-IF                                              04420021
044300                                                                  04430021
044400         WHEN SQLCODE = +100                                      04440021
044500              SET  PS-SEPHORA-DEPT-NO  TO  TRUE                   04450021
044600                                                                  04460021
044700         WHEN SQLCODE = -904                                      04470021
044800         WHEN SQLCODE = -911                                      04480021
044900         WHEN SQLCODE = -913                                      04490021
045000             PERFORM 9900-SQL-ERROR                               04500021
045100                                                                  04510021
045200         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  04520021
045300             MOVE  DK-INTR-UPC-ID  TO  PV-DISP-INTR-UPC-ID        04530021
045400             MOVE  SQLCODE         TO  PV-DISP-SQL                04540021
045500             DISPLAY '**************************************'     04550021
045600             DISPLAY 'WARNING ISSUED '                            04560021
045700             DISPLAY 'SQLCODE: '  PV-DISP-SQL                     04570021
045800             DISPLAY 'XLT_SKU: '  PV-DISP-INTR-UPC-ID             04580021
045900             DISPLAY 'WST_INTGRTN_TYP - SEPHORDEPT          '     04590021
046000             DISPLAY 'WST_ATTR_DEFN                         '     04600021
046100             DISPLAY 'WST_ATTR_ELEM                         '     04610021
046200             DISPLAY '**************************************'     04620021
046300             PERFORM 9800-SQL-WARNING                             04630021
046400                                                                  04640021
046500         WHEN SQLCODE < ZERO                                      04650021
046600             MOVE  DK-INTR-UPC-ID  TO  PV-DISP-INTR-UPC-ID        04660021
046700             MOVE  SQLCODE         TO  PV-DISP-SQL                04670021
046800             DISPLAY '**************************************'     04680021
046900             DISPLAY 'ERROR ISSUED '                              04690021
047000             DISPLAY 'SQLCODE: '  PV-DISP-SQL                     04700021
047100             DISPLAY 'XLT_SKU: '  PV-DISP-INTR-UPC-ID             04710021
047200             DISPLAY 'WST_INTGRTN_TYP - SEPHORDEPT          '     04720021
047300             DISPLAY 'WST_ATTR_DEFN                         '     04730021
047400             DISPLAY 'WST_ATTR_ELEM                         '     04740021
047500             DISPLAY '**************************************'     04750021
047600             PERFORM 9900-SQL-ERROR                               04760021
047700                                                                  04770021
047800     END-EVALUATE.                                                04780021
047900                                                                  04790021
048000                                                                  04800021
048100*----------------------------------------------------------------*04810021
048200*  FOR SEPHORA - CHECK IF THE RECEIVER WAS CREATED BY THE        *04820021
048300*  DC THAT SUPPORTS THE STORE                                    *04830021
048400*----------------------------------------------------------------*04840021
048500 3010-CHECK-SUPPORT-DC.                                           04850021
048600                                                                  04860021
048700     MOVE '3010-CHECK-SUPPORT-DC'   TO  PV-ABEND-PARAGRAPH.       04870021
048800     MOVE SPACE                     TO  PS-SEPHORA-SUPP-DC-SW.    04880021
048900     MOVE PC041-PO-NBR              TO  DK-PO-NBR.                04890021
049000     MOVE PC041-RCVR-SEQ-NBR        TO  DK-RCVR.                  04900021
049100     MOVE PC041-LOC-NBR             TO  DK-STR.                   04910021
049200                                                                  04920021
049300     EXEC SQL                                                     04930021
049400          SELECT B.LOC_NBR                                        04940021
049500               , B.EFF_BEG_DTE                                    04950021
049600               , B.DC_NBR                                         04960021
049700               , A.CURR_OPER_UNT_ID                               04970021
049800               , A.CRE_TMST                                       04980021
049900            INTO :XLT00014-LOC-NBR                                04990021
050000               , :XLT00014-EFF-BEG-DTE                            05000021
050100               , :XLT00014-DC-NBR                                 05010021
050200               , :RECEIV-CURR-OPER-UNT-ID                         05020021
050300               , :RECEIV-CRE-TMST                                 05030021
050400            FROM TRECEIV A                                        05040021
050500               , XLT_DC_LOC_ASGMT B                               05050021
050600          WHERE A.ORD_NBR      = :DK-PO-NBR                       05060021
050700            AND A.REC_SEQ_NBR  = :DK-RCVR                         05070021
050800            AND B.LOC_NBR      = :DK-STR                          05080021
050900            AND B.EFF_BEG_DTE  =                                  05090021
051000                (SELECT MAX(BB.EFF_BEG_DTE)                       05100021
051100                   FROM XLT_DC_LOC_ASGMT BB                       05110021
051200                  WHERE B.LOC_NBR = BB.LOC_NBR                    05120021
051300                    AND DATE(B.EFF_BEG_DTE) <= DATE(A.CRE_TMST))  05130021
051400           FETCH FIRST 1 ROW ONLY                                 05140021
051500            WITH UR                                               05150021
051600     END-EXEC                                                     05160021
051700                                                                  05170021
051800     EVALUATE TRUE                                                05180021
051900         WHEN SQLCODE = ZERO                                      05190021
052000              IF  XLT00014-DC-NBR  =  RECEIV-CURR-OPER-UNT-ID     05200021
052100                  SET  PS-SEPHORA-SUPP-DC-YES  TO  TRUE           05210021
052200              ELSE                                                05220021
052300                  SET  PS-SEPHORA-SUPP-DC-NO   TO  TRUE           05230021
052400              END-IF                                              05240021
052500                                                                  05250021
052600         WHEN SQLCODE = +100                                      05260021
052700              SET  PS-SEPHORA-SUPP-DC-NO   TO  TRUE               05270021
052800                                                                  05280021
052900         WHEN SQLCODE = -904                                      05290021
053000         WHEN SQLCODE = -911                                      05300021
053100         WHEN SQLCODE = -913                                      05310021
053200             PERFORM 9900-SQL-ERROR                               05320021
053300                                                                  05330021
053400         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  05340021
053500             MOVE  DK-PO-NBR  TO  PV-DISP-PO-NBR                  05350021
053600             MOVE  DK-RCVR    TO  PV-DISP-RCVR                    05360021
053700             MOVE  DK-STR     TO  PV-DISP-STR                     05370021
053800             MOVE  SQLCODE    TO  PV-DISP-SQL                     05380021
053900             DISPLAY '**************************************'     05390021
054000             DISPLAY 'WARNING ISSUED '                            05400021
054100             DISPLAY 'SQLCODE: '  PV-DISP-SQL                     05410021
054200             DISPLAY 'TRECEIV: '  PV-DISP-PO-NBR                  05420021
054300                             '-'  PV-DISP-RCVR                    05430021
054400                             '-'  PV-DISP-STR                     05440021
054500             DISPLAY 'XLT_DC_LOC_ASGMT                      '     05450021
054600             DISPLAY '**************************************'     05460021
054700             PERFORM 9800-SQL-WARNING                             05470021
054800                                                                  05480021
054900         WHEN SQLCODE < ZERO                                      05490021
055000             MOVE  DK-PO-NBR  TO  PV-DISP-PO-NBR                  05500021
055100             MOVE  DK-RCVR    TO  PV-DISP-RCVR                    05510021
055200             MOVE  DK-STR     TO  PV-DISP-STR                     05520021
055300             MOVE  SQLCODE    TO  PV-DISP-SQL                     05530021
055400             DISPLAY '**************************************'     05540021
055500             DISPLAY 'ERROR ISSUED '                              05550021
055600             DISPLAY 'SQLCODE: '  PV-DISP-SQL                     05560021
055700             DISPLAY 'TRECEIV: '  PV-DISP-PO-NBR                  05570021
055800                             '-'  PV-DISP-RCVR                    05580021
055900                             '-'  PV-DISP-STR                     05590021
056000             DISPLAY 'XLT_DC_LOC_ASGMT                      '     05600021
056100             DISPLAY '**************************************'     05610021
056200             PERFORM 9900-SQL-ERROR                               05620021
056300     END-EVALUATE.                                                05630021
056400                                                                  05640021
056500                                                                  05650021
056600*----------------------------------------------------------------*05660021
056700*                                                                *05670021
056800*                                                                *05680021
056900*----------------------------------------------------------------*05690021
057000 7000-OPEN-STORE-CSR.                                             05700021
057100     EXEC SQL                                                     05710021
057200         OPEN STORE-CSR                                           05720021
057300     END-EXEC.                                                    05730021
057400                                                                  05740021
057500     EVALUATE TRUE                                                05750021
057600         WHEN SQLCODE = ZERO                                      05760021
057700                 CONTINUE                                         05770021
057800         WHEN SQLCODE = -904                                      05780021
057900         WHEN SQLCODE = -911                                      05790021
058000         WHEN SQLCODE = -913                                      05800021
058100             PERFORM 9900-SQL-ERROR                               05810021
058200                                                                  05820021
058300         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  05830021
058400             DISPLAY '**************************************'     05840021
058500             DISPLAY 'WARNING ISSUED '                            05850021
058600             DISPLAY 'OPEN CURSOR                           '     05860021
058700             DISPLAY '**************************************'     05870021
058800             PERFORM 9800-SQL-WARNING                             05880021
058900                                                                  05890021
059000         WHEN SQLCODE < ZERO                                      05900021
059100             DISPLAY '**************************************'     05910021
059200             DISPLAY 'ERROR ISSUED ON                       '     05920021
059300             DISPLAY 'OPEN CURSOR                           '     05930021
059400             DISPLAY '**************************************'     05940021
059500             PERFORM 9900-SQL-ERROR                               05950021
059600                                                                  05960021
059700     END-EVALUATE.                                                05970021
059800                                                                  05980021
059900 7010-FETCH-STORE-CSR.                                            05990021
060000                                                                  06000021
060100     MOVE '7010-FETCH-STORE-CSR'    TO PV-ABEND-PARAGRAPH.        06010021
060200                                                                  06020021
060300     EXEC SQL                                                     06030021
060400         FETCH STORE-CSR                                          06040021
060500         INTO                                                     06050021
060600             :XLT00010-LOC-NBR                                    06060021
060700          ,  :XLT00010-OPN-DTE                                    06070021
060800          ,  :XLT00010-CLO-DTE                                    06080021
060900          ,  :XLT00010-LOC-NM                                     06090021
061000          ,  :PV-ATTR_ELEM_SEQ_NBR                                06100021
061100          ,  :PV-ATTR-ELEM-STR-NBR                                06110021
061200          ,  :PV-ATTR-ELEM-PHASE                                  06120021
061300          ,  :PV-ATTR-SE-START-DATE                               06130021
061400          ,  :PV-ATTR-GO-LIVE-DATE                                06140021
061500          ,  :PV-ATTR-ACTIVE-CODE                                 06150021
061600     END-EXEC                                                     06160021
061700                                                                  06170021
061800     EVALUATE TRUE                                                06180021
061900         WHEN SQLCODE = ZERO                                      06190021
062000             ADD 1                    TO PV-STORE-COUNT           06200021
062100         WHEN SQLCODE = +100                                      06210021
062200             SET PS-END-CSR-YES       TO TRUE                     06220021
062300         WHEN SQLCODE = -904                                      06230021
062400         WHEN SQLCODE = -911                                      06240021
062500         WHEN SQLCODE = -913                                      06250021
062600             PERFORM 9900-SQL-ERROR                               06260021
062700                                                                  06270021
062800         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  06280021
062900             DISPLAY '**************************************'     06290021
063000             DISPLAY 'WARNING ISSUED '                            06300021
063100             DISPLAY 'FETCH CURSOR                          '     06310021
063200             DISPLAY 'XLT_LOC                               '     06320021
063300             DISPLAY '**************************************'     06330021
063400             PERFORM 9800-SQL-WARNING                             06340021
063500                                                                  06350021
063600         WHEN SQLCODE < ZERO                                      06360021
063700             DISPLAY '**************************************'     06370021
063800             DISPLAY 'ERROR ISSUED ON                       '     06380021
063900             DISPLAY 'FETCH CURSOR                          '     06390021
064000             DISPLAY 'XLT_LOC                               '     06400021
064100             DISPLAY '**************************************'     06410021
064200             PERFORM 9900-SQL-ERROR                               06420021
064300                                                                  06430021
064400     END-EVALUATE.                                                06440021
064500                                                                  06450021
064600 7020-CLOSE-STORE-CSR.                                            06460021
064700                                                                  06470021
064800     MOVE '7020-CLOSE-STORE-CSR'    TO PV-ABEND-PARAGRAPH.        06480021
064900                                                                  06490021
065000     EXEC SQL                                                     06500021
065100         CLOSE STORE-CSR                                          06510021
065200     END-EXEC                                                     06520021
065300                                                                  06530021
065400     EVALUATE TRUE                                                06540021
065500         WHEN SQLCODE = ZERO                                      06550021
065600             CONTINUE                                             06560021
065700         WHEN SQLCODE = -904                                      06570021
065800         WHEN SQLCODE = -911                                      06580021
065900         WHEN SQLCODE = -913                                      06590021
066000             PERFORM 9900-SQL-ERROR                               06600021
066100                                                                  06610021
066200         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  06620021
066300             DISPLAY '**************************************'     06630021
066400             DISPLAY 'WARNING ISSUED '                            06640021
066500             DISPLAY 'CLOSE CURSOR                          '     06650021
066600             DISPLAY '**************************************'     06660021
066700             PERFORM 9800-SQL-WARNING                             06670021
066800                                                                  06680021
066900         WHEN SQLCODE < ZERO                                      06690021
067000             DISPLAY '**************************************'     06700021
067100             DISPLAY 'ERROR ISSUED ON                       '     06710021
067200             DISPLAY 'CLOSE CURSOR                          '     06720021
067300             DISPLAY '**************************************'     06730021
067400             PERFORM 9900-SQL-ERROR                               06740021
067500                                                                  06750021
067600     END-EVALUATE.                                                06760021
067700/                                                                 06770021
067800 8000-READ-INV-STORES.                                            06780021
067900                                                                  06790021
068000     MOVE '8000-READ-INV-STORES'  TO PV-ABEND-PARAGRAPH.          06800021
068100                                                                  06810021
068200     READ INVENTORY-STORE-FILE-IN                                 06820021
068300         INTO                                                     06830021
068400             PC041-UNBAL-SUMMARY-REC                              06840021
068500         AT END                                                   06850021
068600             SET PS-EOF-PC041-YES     TO TRUE                     06860021
068700         NOT AT END                                               06870021
068800             ADD 1                    TO PV-READ-PC041-COUNTER    06880021
068900                                                                  06890021
069000     END-READ.                                                    06900021
069100                                                                  06910021
069200 8100-WRITE-OPEN.                                                 06920021
069300*    OUT01                                                        06930021
069400     MOVE '8100-WRITE-OPEN'       TO PV-ABEND-PARAGRAPH.          06940021
069500     WRITE                                                        06950021
069600         INVENTORY-STORE-RECORD-OUT                               06960021
069700         FROM PC041-UNBAL-SUMMARY-REC                             06970021
069800     END-WRITE.                                                   06980021
069900     ADD 1                            TO PV-WRITE-1-COUNTER.      06990021
070000                                                                  07000021
070100 9000-QUIT.                                                       07010021
070200                                                                  07020021
070300     DISPLAY SPACES.                                              07030021
070400                                                                  07040021
070500     MOVE PV-READ-PC041-COUNTER       TO PV-DISP-NBR              07050021
070600     DISPLAY 'UNBALANCED RECORDS READ              = '            07060021
070700                                          PV-DISP-NBR             07070021
070800                                                                  07080021
070900     MOVE PV-WRITE-1-COUNTER          TO PV-DISP-NBR              07090021
071000     DISPLAY 'OPEN STORE RECORDS WRITTEN           = '            07100021
071100                                                 PV-DISP-NBR      07110021
071200                                                                  07120021
071300     DISPLAY '                                       '.           07130021
071400     MOVE PV-NOT-SEPH-CNT             TO PV-DISP-NBR              07140021
071500     DISPLAY 'UNBALANCED RECORDS-NOT SEPHORA       = '            07150021
071600                                                 PV-DISP-NBR.     07160021
071700                                                                  07170021
071800     MOVE PV-SEPH-CNTRL-STOCK-CNT     TO PV-DISP-NBR              07180021
071900     DISPLAY 'UNBALANCED RECORDS-SEPHORA CE        = '            07190021
072000                                                 PV-DISP-NBR.     07200021
072100                                                                  07210021
072200     MOVE PV-SEPH-BYPASS-SE-CNT       TO PV-DISP-NBR              07220021
072300     DISPLAY 'UNBALANCED RECORDS-SEPHORA BYPASSED  = '            07230021
072400                                                 PV-DISP-NBR.     07240021
072500                                                                  07250021
072600     MOVE PV-SEPH-SE-CNT              TO PV-DISP-NBR              07260021
072700     DISPLAY 'UNBALANCED RECORDS-SEPHORA SE        = '            07270021
072800                                                 PV-DISP-NBR.     07280021
072900                                                                  07290021
073000     CLOSE INVENTORY-STORE-FILE-IN                                07300021
073100           INVENTORY-STORE-FILE-OUT.                              07310021
073200                                                                  07320021
073300     PERFORM 9001-LIST-STORE-TABLE.                               07330021
073400                                                                  07340021
073500 9001-LIST-STORE-TABLE.                                           07350021
073600                                                                  07360021
073700     DISPLAY ' '                                                  07370021
073800     DISPLAY PV-MSG-HEADER                                        07380021
073900                                                                  07390021
074000     PERFORM VARYING PT-LOC-IDX FROM 1 BY 1 UNTIL                 07400021
074100                         PT-LOC-IDX > 9999                        07410021
074200         IF PT-STORE(PT-LOC-IDX) > ZERO                           07420021
074300             MOVE PT-STORE-COUNT (PT-LOC-IDX) TO PV-DISP-NBR      07430021
074400             DISPLAY PT-STORE(PT-LOC-IDX)                         07440021
074500             '  '                                                 07450021
074600             PT-LOC-NM (PT-LOC-IDX) (1:25)                        07460021
074700             '  '                                                 07470021
074800             PT-OPN-DTE (PT-LOC-IDX)                              07480021
074900             '  '                                                 07490021
075000             PT-SE-CLEAN-START-DATE (PT-LOC-IDX)                  07500021
075100             '  '                                                 07510021
075200             PT-GO-LIVE-DATE (PT-LOC-IDX)                         07520021
075300             '  '                                                 07530021
075400             PV-DISP-NBR                                          07540021
075500             '   '                                                07550021
075600             PT-PHASE-NBR (PT-LOC-IDX)                            07560021
075700         END-IF                                                   07570021
075800     END-PERFORM.                                                 07580021
075900/                                                                 07590021
076000 9100-SQL-ABEND.                                                  07600021
076100******************************************************************07610021
076200*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    07620021
076300*  ERROR OR WARNING CODE OCCURS.                                  07630021
076400******************************************************************07640021
076500     DISPLAY '9100-SQL-ABEND'.                                    07650021
076600     DISPLAY '** ABEND     **'.                                   07660021
076700     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        07670021
076800     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             07680021
076900     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     07690021
077000     DISPLAY '**              ** = '                              07700021
077100     MOVE SQLCODE TO PV-SQL-CODE.                                 07710021
077200     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                    07720021
077300     MOVE +4013 TO PV-ABEND-CODE.                                 07730021
077400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07740021
077500                                                                  07750021
077600******************************************************************07760021
077700*  THIS MODULE PERFORMS THE SQL WARNING.                         *07770021
077800******************************************************************07780021
077900                                                                  07790021
078000 9800-SQL-WARNING.                                                07800021
078100                                                                  07810021
078200     MOVE SQLCODE               TO SQLCODE2.                      07820021
078300     MOVE SQLERRD(3)            TO SQLERRD3.                      07830021
078400     DISPLAY '** ABEND **       ** = SQLWARNING'.                 07840021
078500     DISPLAY '** PROGRAM        ** = PCKUT118'.                   07850021
078600     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        07860021
078700     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  07870021
078800     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  07880021
078900                                                                  07890021
079000     COPY DPPD004.                                                07900021
079100     SET ABEND-4013-DB2-ERROR   TO TRUE                           07910021
079200     CALL 'ILBOABN0' USING ABEND-CODE.                            07920021
079300/                                                                 07930021
079400******************************************************************07940021
079500* THIS MODULE PERFORMS THE SQL ERROR.                            *07950021
079600******************************************************************07960021
079700                                                                  07970021
079800 9900-SQL-ERROR.                                                  07980021
079900                                                                  07990021
080000     MOVE SQLCODE               TO SQLCODE2.                      08000021
080100     MOVE SQLERRD(3)            TO SQLERRD3.                      08010021
080200     DISPLAY '** ABEND **       ** = SQLERROR'.                   08020021
080300     DISPLAY '** PROGRAM        ** = PCKUT118'.                   08030021
080400     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        08040021
080500     DISPLAY '** OPERATION      ** = ' PV-ABEND-OPERATION         08050021
080600     DISPLAY '** TABLE          ** = ' PV-ABEND-STRUCTURE-1       08060021
080700     DISPLAY SPACES                                               08070021
080800                                                                  08080021
080900     COPY DPPD004.                                                08090021
081000     SET ABEND-4013-DB2-ERROR   TO TRUE                           08100021
081100     CALL 'ILBOABN0' USING ABEND-CODE.                            08110021
