000100******************************************************************00010011
000200 IDENTIFICATION DIVISION.                                         00020011
000300******************************************************************00030011
000400                                                                  00040011
000500 PROGRAM-ID.    RVKUT005.                                         00050011
000600 AUTHOR.        MICHAEL WALTERS.                                  00060011
000700 INSTALLATION.  KOHLS.                                            00070011
000800 DATE-WRITTEN   MARCH, 1997.                                      00080011
000900 DATE-COMPILED.                                                   00090011
001000                                                                  00100011
001100******************************************************************00110011
001200*  THIS PROGRAM CREATES THE EXTRACT FILE FOR THE QUARTERLY        00120011
001300*  VENDOR RETURN AGREEMENT REPORT.                                00130011
001400******************************************************************00140011
001500                                                                  00150011
001600******************************************************************00160011
001700 ENVIRONMENT DIVISION.                                            00170011
001800******************************************************************00180011
001900                                                                  00190011
002000 CONFIGURATION SECTION.                                           00200011
002100                                                                  00210011
002200 SOURCE-COMPUTER.        IBM-3090.                                00220011
002300 OBJECT-COMPUTER.        IBM-3090.                                00230011
002400                                                                  00240011
002500 INPUT-OUTPUT SECTION.                                            00250011
002600                                                                  00260011
002700 FILE-CONTROL.                                                    00270011
002800                                                                  00280011
002900     SELECT RV-VENDOR-RETURN-FILE                                 00290011
003000         ASSIGN TO IN01.                                          00300011
003100                                                                  00310011
003200     SELECT RV-VENDOR-MASTER-FILE                                 00320016
003300         ASSIGN TO IN02.                                          00330011
003400                                                                  00340011
003500     SELECT RTV-REPORT-EXTRACT                                    00350011
003600         ASSIGN TO OUT01.                                         00360011
003700                                                                  00370011
003800******************************************************************00380011
003900 DATA DIVISION.                                                   00390011
004000******************************************************************00400011
004100                                                                  00410011
004200 FILE SECTION.                                                    00420011
004300                                                                  00430011
004400 FD  RV-VENDOR-RETURN-FILE                                        00440011
004500     RECORDING MODE IS F                                          00450011
004600     LABEL RECORDS ARE STANDARD                                   00460011
004700     BLOCK CONTAINS 0 RECORDS.                                    00470011
004800                                                                  00480011
004900 01  RV-VENDOR-RETURN-RECORD         PIC  X(200).                 00490011
005000                                                                  00500011
005100 FD  RV-VENDOR-MASTER-FILE                                        00510016
005200     RECORDING MODE IS F                                          00520011
005300     LABEL RECORDS ARE STANDARD                                   00530011
005400     BLOCK CONTAINS 0 RECORDS.                                    00540011
005500                                                                  00550011
005600 01  RV-VENDOR-MASTER-RECORD         PIC  X(130).                 00560016
005700                                                                  00570011
005800 FD  RTV-REPORT-EXTRACT                                           00580011
005900     RECORDING MODE IS F                                          00590011
006000     LABEL RECORDS ARE STANDARD                                   00600011
006100     BLOCK CONTAINS 0 RECORDS.                                    00610011
006200                                                                  00620011
006300 01  RTV-REPORT-EXTRACT-RECORD       PIC  X(200).                 00630011
006500*                                                                 00650011
006600******************************************************************00660011
006700 WORKING-STORAGE SECTION.                                         00670011
006800******************************************************************00680011
007000*                                                                 00700011
007100******************************************************************00710011
007200*  DB2 FORMATTED MESSAGE AREA                                     00720011
007300******************************************************************00730011
007400     COPY DPWS004.                                                00740025
007600*                                                                 00760011
007700******************************************************************00770011
007800*   WORK AREA FOR FISCAL CALENDAR ROUTINE.                        00780011
007900******************************************************************00790011
008000     COPY DPWS500.                                                00800025
008200*                                                                 00820011
008300******************************************************************00830011
008400*  VENDOR MASTER LAYOUT                                           00840011
008500******************************************************************00850011
008600     COPY RVRD004.                                                00860015
008800*                                                                 00880011
008900******************************************************************00890011
009000*  RTV RETURN EXTRACT FILE LAYOUT                                 00900011
009100******************************************************************00910011
009200     COPY RVWS010.                                                00920025
009300*                                                                 00930011
009400******************************************************************00940011
009500*  RTV VENDOR AGREEMENT REPORT RECORD LAYOUT                      00950011
009600******************************************************************00960011
009700     COPY RVRD002.                                                00970025
009900*                                                                 00990011
010000******************************************************************01000011
010100*  PARAMETER LIST FOR CALLING THE MBS LOOKUP SUBROUTINE           01010011
010200******************************************************************01020011
010300     COPY DPWS003.                                                01030025
010500*                                                                 01050011
010600******************************************************************01060011
010700*  COMMUNICATIONS AREA FOR DB2                                    01070011
010800******************************************************************01080011
010900     EXEC SQL                                                     01090011
011000          INCLUDE SQLCA                                           01100011
011100     END-EXEC.                                                    01110011
011300*                                                                 01130011
011400******************************************************************01140011
011500*  DB2 TABLE DECLARATION - EXTERNAL ENTERPRISE TABLE (TEXTENT)    01150011
011600******************************************************************01160011
011700     EXEC SQL                                                     01170011
011800          INCLUDE TEXTENT                                         01180011
011900     END-EXEC.                                                    01190011
012300*                                                                 01230011
012400******************************************************************01240011
012500*  DB2 TABLE DECLARATION - ENTERPRISE NAME TABLE (TENTNME)        01250011
012600******************************************************************01260011
012700     EXEC SQL                                                     01270011
012800          INCLUDE TENTNME                                         01280011
012900     END-EXEC.                                                    01290011
013300*                                                                 01330011
013400******************************************************************01340011
013500*  DB2 TABLE DECLARATION - VENDOR AGREEMENT TABLE (TVNDAGR)       01350011
013600******************************************************************01360011
013700     EXEC SQL                                                     01370011
013800          INCLUDE TVNDAGR                                         01380011
013900     END-EXEC.                                                    01390011
014000                                                                  01400011
014200 01  ABEND-CODE                          PIC S9(04)  VALUE +0     01420022
014300                                                     COMP SYNC.   01430022
014500 01  PA-PROGRAM-ACCUMULATORS.                                     01450011
014600     05 PA-VENDOR-DEPT-MERCH-COST        PIC S9(13)V99            01460022
014700                                                     VALUE +0     01470011
014800                                                     COMP-3       01480011
014900                                                     SYNC.        01490011
015000     05 PA-VENDOR-DEPT-RETURN-COST       PIC S9(13)V99            01500022
015100                                                     VALUE +0     01510011
015200                                                     COMP-3       01520011
015300                                                     SYNC.        01530011
015400                                                                  01540011
015500 01  PS-PROGRAM-SWITCHES.                                         01550011
015600     05  PS-EOF-VENDOR-MASTER-SW         PIC  X(01)  VALUE 'N'.   01560022
015700         88  PS-EOF-VENDOR-MASTER                    VALUE 'Y'.   01570022
015800         88  PS-NOT-EOF-VENDOR-MASTER                VALUE 'N'.   01580022
015900     05  PS-EOF-VENDOR-RETURN-SW         PIC  X(01)  VALUE 'N'.   01590022
016000         88  PS-EOF-VENDOR-RETURN                    VALUE 'Y'.   01600022
016100         88  PS-NOT-EOF-VENDOR-RETURN                VALUE 'N'.   01610022
016200     05  PS-EOC-VND-AGREE-CURSOR-SW      PIC  X(01)  VALUE 'N'.   01620022
016300         88  PS-EOC-VND-AGREE-CURSOR                 VALUE 'Y'.   01630022
016400         88  PS-NOT-EOC-VND-AGREE-CURSOR             VALUE 'N'.   01640022
016500     05  PS-EOC-VND-NAME-CURSOR-SW       PIC  X(01)  VALUE 'N'.   01650022
016600         88  PS-EOC-VND-NAME-CURSOR                  VALUE 'Y'.   01660022
016700         88  PS-NOT-EOC-VND-NAME-CURSOR              VALUE 'N'.   01670022
016800                                                                  01680011
016900 01  PC-PROGRAM-CONSTANTS.                                        01690011
017000     05  PC-SYSTEM-CD                    PIC  X(02)  VALUE 'RV'.  01700022
017300     05  PC-PGM-DPKUT039                 PIC  X(08)  VALUE        01730022
017400                                                     'DPKUT039'.  01740022
017500     05  PC-OPERATING-COMPANY-CD         PIC  X(02)  VALUE '03'.  01750022
018500 01  PV-PROGRAM-VARIABLES.                                        01850011
018510     05  PV-DISCOUNT-PCT-NULL-IND        PIC S9(04)  VALUE +0     01851024
018520                                                     COMP.        01852024
018600     05  PV-ERROR-ENT-ID                 PIC  9(09)  VALUE ZERO.  01860024
018610     05  PV-RPT-TYPE                     PIC  X(01)  VALUE SPACE. 01861024
018700     05  PV-BEGIN-DATE                   PIC  X(10)  VALUE SPACE. 01870011
018800     05  PV-BEGIN-FISCAL-DATE.                                    01880011
018900         10  PV-BEGIN-FISCAL-YEAR        PIC  9(02)  VALUE 0.     01890011
019000         10  PV-BEGIN-FISCAL-MONTH       PIC  9(02)  VALUE 0.     01900011
019100     05  PV-END-DATE                     PIC  X(10)  VALUE SPACE. 01910011
019200     05  PV-END-FISCAL-DATE.                                      01920011
019300         10  PV-END-FISCAL-YEAR          PIC  9(02)  VALUE 0.     01930011
019400         10  PV-END-FISCAL-MONTH         PIC  9(02)  VALUE 0.     01940011
020800     05  PV-FIELD-NAME                   PIC  X(30)  VALUE SPACES.02080011
020900                                                                  02090011
021000     05  PV-CURRENT-DATE                 PIC  X(10).              02100011
021100     05  PV-CURRENT-DATE-RFMT REDEFINES PV-CURRENT-DATE.          02110011
021200         10 PV-CURRENT-DATE-CC           PIC  X(02).              02120022
021300         10 PV-CURRENT-DATE-YY           PIC  X(02).              02130022
021400         10 FILLER                       PIC  X.                  02140011
021500         10 PV-CURRENT-DATE-MM           PIC  X(02).              02150022
021600         10 FILLER                       PIC  X.                  02160011
021700         10 PV-CURRENT-DATE-DD           PIC  X(02).              02170022
021800     05  PV-WORK-DATE.                                            02180011
021900         10 PV-WORK-DATE-YY              PIC  X(02)  VALUE SPACES.02190022
022000         10 PV-WORK-DATE-MM              PIC  X(02)  VALUE SPACES.02200022
022100         10 PV-WORK-DATE-DD              PIC  X(02)  VALUE SPACES.02210022
022200     05  PV-DB2-WORK-DATE.                                        02220011
022300         10 PV-DB2-CC                    PIC  9(02).              02230022
022400         10 PV-DB2-YY                    PIC  9(02).              02240022
022500         10 FILLER                       PIC  X.                  02250011
022600         10 PV-DB2-MM                    PIC  9(02).              02260022
022700         10 FILLER                       PIC  X.                  02270011
022800         10 PV-DB2-DD                    PIC  9(02).              02280022
022900     05  PV-HOLD-FILE-KEY.                                        02290011
023000         10 PV-HOLD-VENDOR-DUNNS         PIC  9(09)  VALUE 0.     02300011
023100         10 PV-HOLD-DEPT-NMBR            PIC  9(03)  VALUE 0.     02310011
023200         10 PV-HOLD-DEPT-NMBR-X REDEFINES                         02320011
023300            PV-HOLD-DEPT-NMBR            PIC  X(03).              02330011
023400                                                                  02340011
023500     05  PV-DB2-AGREE-VND-DUNNS          PIC  X(09)  VALUE SPACES.02350011
023600     05  PV-DB2-AGREE-VND-DUNNS-N REDEFINES                       02360011
023700         PV-DB2-AGREE-VND-DUNNS          PIC  9(09).              02370011
023800                                                                  02380011
023900     05  PV-DB2-AGREE-DPT-NMBR           PIC  X(03)  VALUE SPACES.02390011
024000     05  PV-DB2-AGREE-DPT-NMBR-N REDEFINES                        02400011
024100         PV-DB2-AGREE-DPT-NMBR           PIC  9(03).              02410011
024200                                                                  02420011
024300     05  PV-DB2-NAME-VND-DUNNS           PIC  X(09)  VALUE SPACES.02430011
024400     05  PV-DB2-NAME-VND-DUNNS-N REDEFINES                        02440011
024500         PV-DB2-NAME-VND-DUNNS           PIC  9(09).              02450011
024600                                                                  02460011
025300*                                                                 02530011
025400*  CURSOR DECLARATION TO GET ALL THE VENDOR RETURN AGREEMENTS     02540011
025500*  TO BUMP AGAINST THE RETURN AGREEMENT FILE AND THE VENDOR MASTER02550011
025600*                                                                 02560011
025700     EXEC SQL                                                     02570011
025800          DECLARE VND_AGREE_CURSOR CURSOR FOR                     02580011
025900          SELECT                                                  02590011
026000              A.RTV_RA_REQD_IND                                   02600011
026100             ,A.RTV_NO_RA_REQD_IND                                02610011
026200             ,A.DEBIT_DESTROY_IND                                 02620011
026300             ,A.MARKOUT_IND                                       02630011
026400             ,A.DEPT_NBR                                          02640011
026410             ,B.ENT_ID                                            02641024
026500             ,B.DUN_NBR                                           02650011
026600         FROM TVNDAGR A                                           02660011
026700            , TEXTENT B                                           02670011
026800        WHERE                                                     02680011
026900              A.EFFECTIVE_DATE  <= CURRENT DATE                   02690011
027000          AND A.EXPIRATION_DATE >  CURRENT DATE                   02700011
027100          AND A.ENT_ID           = B.ENT_ID                       02710011
027200          AND A.AGRMT_TYP_ID     = '3'                            02720011
027300        ORDER BY B.DUN_NBR, A.DEPT_NBR                            02730011
027400     END-EXEC.                                                    02740011
027500                                                                  02750011
027600*                                                                 02760011
027700*  CURSOR DECLARATION TO GET ALL THE VENDOR NAMES/RANK TO BUMP    02770011
027800*  AGAINST THE RETURN AGREEMENT FILE AND THE VENDOR MASTER        02780011
027900*                                                                 02790011
028000     EXEC SQL                                                     02800011
028100          DECLARE VND_NAME_CURSOR CURSOR FOR                      02810011
028200          SELECT                                                  02820011
028310                A.ENT_NAME_DESC                                   02831023
028400               ,B.DUN_NBR                                         02840011
028500               ,B.CFY_SLSRNK_NBR                                  02850012
028600          FROM  TENTNME A                                         02860011
028700              , TEXTENT B                                         02870011
028800          WHERE                                                   02880011
028900                A.ENT_ID = B.ENT_ID                               02890011
029100            AND A.TYPE_CDE = '01'                                 02910011
029200          ORDER BY 2                                              02920011
029300     END-EXEC.                                                    02930011
029400******************************************************************02940011
029500 LINKAGE SECTION.                                                 02950011
029600******************************************************************02960011
029700                                                                  02970011
029800******************************************************************02980011
029900 PROCEDURE DIVISION.                                              02990011
030000******************************************************************03000011
030100                                                                  03010011
030200******************************************************************03020011
030300*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    03030011
030400******************************************************************03040011
030500 0000-PROGRAM-MAINLINE.                                           03050011
030700     PERFORM 1000-INITIALIZE.                                     03070011
030800                                                                  03080011
030900     PERFORM 2000-CREATE-EXTRACT-FILE                             03090011
031000         UNTIL PS-EOF-VENDOR-MASTER                               03100011
031100           AND PS-EOF-VENDOR-RETURN                               03110011
031200                                                                  03120011
031300     PERFORM 9000-EOJ-ROUTINE.                                    03130011
031400     STOP RUN.                                                    03140011
031600                                                                  03160011
031700******************************************************************03170011
031800*  1000-INITIALIZE -  OPENS ALL THE REPORT FILE, ACCEPTS, EDITS,  03180011
031900*  AND DISPLAYS CONTROL CARD INFORMATION, OPENS AND FETCHES FIRST 03190011
032000*  OCCURANCE OF DB2 CURSOR, PRINTS INITIAL PAGE HEADING TO REPORT 03200011
032100*  FILE.                                                          03210011
032200******************************************************************03220011
032300 1000-INITIALIZE.                                                 03230011
032500     INITIALIZE RV002-RETURN-AGREE-EXTRACT-REC.                   03250011
032600                                                                  03260011
032700     OPEN INPUT  RV-VENDOR-MASTER-FILE                            03270016
032800          INPUT  RV-VENDOR-RETURN-FILE                            03280011
032900          OUTPUT RTV-REPORT-EXTRACT.                              03290011
033000                                                                  03300011
033100     SET PS-NOT-EOF-VENDOR-MASTER                                 03310011
033200         PS-NOT-EOF-VENDOR-MASTER                                 03320011
033300         PS-NOT-EOC-VND-NAME-CURSOR                               03330011
033400         PS-NOT-EOC-VND-AGREE-CURSOR TO TRUE.                     03340011
033500                                                                  03350011
033600     PERFORM 6000-READ-VENDOR-MASTER.                             03360011
033700     PERFORM 6100-READ-VENDOR-RETURN.                             03370011
033800                                                                  03380011
033900     IF PS-EOF-VENDOR-MASTER                                      03390011
034000         DISPLAY '** ABEND **'                                    03400011
034100         DISPLAY '** PROGRAM = RVKUT005 ** '                      03410011
034200         DISPLAY '** PARAGRAPH = 1000-INITIALIZE'                 03420011
034300         DISPLAY '** VENDOR MASTER FILE EMPTY '                   03430011
034400         MOVE +4003 TO ABEND-CODE                                 03440011
034500         CALL 'ILBOABN0' USING ABEND-CODE                         03450011
034600     END-IF.                                                      03460011
034700     IF PS-EOF-VENDOR-RETURN                                      03470011
034800         DISPLAY '** ABEND **'                                    03480011
034900         DISPLAY '** PROGRAM = RVKUT005 ** '                      03490011
035000         DISPLAY '** PARAGRAPH = 1000-INITIALIZE'                 03500011
035100         DISPLAY '** VENDOR RETURN FILE EMPTY'                    03510011
035200         MOVE +4003 TO ABEND-CODE                                 03520011
035300         CALL 'ILBOABN0' USING ABEND-CODE                         03530011
035400     ELSE                                                         03540011
035500         IF RV010-HEADER-REC                                      03550011
035600             MOVE RV010-BEGIN-DATE        TO PV-BEGIN-DATE        03560011
035700             MOVE RV010-END-DATE          TO PV-END-DATE          03570011
035800             MOVE RV010-BEGIN-FISCAL-DATE TO PV-BEGIN-FISCAL-DATE 03580011
035900             MOVE RV010-END-FISCAL-DATE   TO PV-END-FISCAL-DATE   03590011
036000             MOVE RV010-CURR-DATE         TO PV-CURRENT-DATE      03600011
036100             MOVE RV010-RPT-TYPE          TO PV-RPT-TYPE          03610011
036200             PERFORM 6100-READ-VENDOR-RETURN                      03620011
036300         ELSE                                                     03630011
036400             DISPLAY '** ABEND **'                                03640011
036500             DISPLAY '** PROGRAM = RVKUT005 ** '                  03650011
036600             DISPLAY '** PARAGRAPH = 1000-INITIALIZE'             03660011
036700             DISPLAY '** FIRST RECORD NOT THE HEADER RECORD '     03670011
036800             MOVE +4003 TO ABEND-CODE                             03680011
036900             CALL 'ILBOABN0' USING ABEND-CODE                     03690011
037000         END-IF                                                   03700011
037100     END-IF.                                                      03710011
037200                                                                  03720011
037300     PERFORM 6300-SET-CURRENT-KEY.                                03730011
037400                                                                  03740011
037500     PERFORM 7000-OPEN-VND-AGREE-CURSOR.                          03750011
037600     PERFORM 7200-FETCH-VND-AGREE-CURSOR.                         03760011
037700                                                                  03770011
037800     PERFORM 7300-OPEN-VND-NAME-CURSOR.                           03780011
037900     PERFORM 7500-FETCH-VND-NAME-CURSOR.                          03790011
038000                                                                  03800011
038200******************************************************************03820011
038300* 2000-CREATE-EXTRACT-FILE                                        03830011
038400* BOTH PARTS OF THE KEY MUST BE EQUAL IN ORDER TO SUM THAT FILES  03840011
038500* INFORMATION, AND READ THE NEXT RECORD.  IF THE FILE KEY DOESN'T 03850011
038600* MATCH THE CURRENT KEY BEING PROCESSED, LEAVE THAT FILE ALONE    03860011
038700* UNTIL THE KEY MATCHES.                                          03870011
038800******************************************************************03880011
038900 2000-CREATE-EXTRACT-FILE.                                        03890011
039100*    SUM/READ THE VENDOR MASTER UNTIL THE END OF THE FILE, OR     03910011
039200*    UNTIL THE FILE KEY IS DIFFERENT THAN THE CURRENT KEY         03920011
039300     PERFORM 2100-SUM-MERCH-COST                                  03930011
039400         UNTIL RV004-VENDOR-DUNNS NOT = PV-HOLD-VENDOR-DUNNS      03940016
039500            OR RV004-DEPT-NMBR     NOT = PV-HOLD-DEPT-NMBR        03950016
039600            OR PS-EOF-VENDOR-MASTER.                              03960011
039700                                                                  03970011
039800*    SUM/READ THE VENDOR RETURN FILE UNTIL THE END OF THE FILE, OR03980011
039900*    UNTIL THE FILE KEY IS DIFFERENT THAN THE CURRENT KEY         03990011
040000     PERFORM 2200-SUM-RETURN-COST                                 04000011
040100         UNTIL RV010-DUNS-NBR-N    NOT = PV-HOLD-VENDOR-DUNNS     04010011
040200            OR RV010-DPT-NBR-N     NOT = PV-HOLD-DEPT-NMBR        04020011
040300            OR PS-EOF-VENDOR-RETURN.                              04030011
040400                                                                  04040011
040500*    FETCH THE VENDOR AGREEMENT TERMS UNTIL THE CURSOR FINDS, OR  04050011
040600*    PASSES THE CURRENT VND/DPT                                   04060011
040700     PERFORM 7200-FETCH-VND-AGREE-CURSOR                          04070011
040800         UNTIL ((PV-DB2-AGREE-VND-DUNNS-N > PV-HOLD-VENDOR-DUNNS) 04080011
040900            OR  (PV-DB2-AGREE-VND-DUNNS-N = PV-HOLD-VENDOR-DUNNS  04090011
041000            AND  PV-DB2-AGREE-DPT-NMBR-N >= PV-HOLD-DEPT-NMBR) ). 04100011
041100                                                                  04110011
041200*    FETCH VENDOR NAMES UNTIL THE CURSOR FINDS OR PASSES THE CURRE04120011
041300*    VENDOR                                                       04130011
041400     PERFORM 7500-FETCH-VND-NAME-CURSOR                           04140011
041500         UNTIL PV-DB2-NAME-VND-DUNNS-N  >= PV-HOLD-VENDOR-DUNNS.  04150011
041600                                                                  04160011
041700     PERFORM 2300-GET-DEPT-INFO.                                  04170011
041800                                                                  04180011
041900     PERFORM 6200-WRITE-EXTRACT-FILE.                             04190011
042000                                                                  04200011
042100*    RESET THE HOLD KEY, AND ACCUMULATORS FOR THE NEXT VND/DPT    04210011
042200     INITIALIZE PA-PROGRAM-ACCUMULATORS.                          04220011
042300     PERFORM 6300-SET-CURRENT-KEY.                                04230011
042400                                                                  04240011
042500******************************************************************04250011
042600* 2100-SUM-MERCH-COST                                             04260011
042700* PROCESS:  THIS PARAGRAPH SUM THE MERCHANDISE COST  RECORDS      04270018
042800******************************************************************04280011
042900 2100-SUM-MERCH-COST.                                             04290011
043000     MOVE 'PA-VENDOR-DEPT-MERCH-COST' TO PV-FIELD-NAME            04300011
043100     COMPUTE  PA-VENDOR-DEPT-MERCH-COST =                         04310011
043200         (PA-VENDOR-DEPT-MERCH-COST + RV004-MERCH-COST)           04320016
043300         ON SIZE ERROR PERFORM 9100-OVERFLOW-ERROR                04330011
043400     END-COMPUTE                                                  04340011
047300                                                                  04730011
047400     PERFORM 6000-READ-VENDOR-MASTER.                             04740011
047500                                                                  04750011
047600******************************************************************04760011
047700* 2200-SUM-RETURN-COST                                            04770011
047800* PROCESS:  THIS PARAGRAPH SUMS THE RETURNED MERCHANDISE COST FOR 04780011
047900*           THE TIMEFRAME OF THE REPORT                           04790011
048000******************************************************************04800011
048100 2200-SUM-RETURN-COST.                                            04810011
048300     MOVE 'PA-VENDOR-DEPT-RETURN-COST' TO PV-FIELD-NAME           04830011
048400     COMPUTE PA-VENDOR-DEPT-RETURN-COST =                         04840011
048500         (PA-VENDOR-DEPT-RETURN-COST + RV010-UNIT-COST-AMT)       04850011
048600         ON SIZE ERROR PERFORM 9100-OVERFLOW-ERROR                04860011
048700     END-COMPUTE.                                                 04870011
048800                                                                  04880011
048900     PERFORM 6100-READ-VENDOR-RETURN.                             04890011
049000                                                                  04900011
049100******************************************************************04910011
049200*  CALL MBS SUBROUTINE TO GET DEPT DESC, AND DMM NAME.            04920011
049300******************************************************************04930011
049400 2300-GET-DEPT-INFO.                                              04940011
049500     INITIALIZE DP003-MBS-SUBROUTINE-FIELDS.                      04950011
049600     SET DP003-BYR-LOOKUP-NAME                                    04960011
049700         DP003-BYR-NAME-LAST-FIRST                                04970011
049800         DP003-DMM-LOOKUP-NAME                                    04980011
049900         DP003-DMM-NAME-LAST-FIRST                                04990011
050000         DP003-GMM-LOOKUP-NAME                                    05000011
050100         DP003-GMM-NAME-LAST-FIRST                                05010011
050200         DP003-DPT-LOOKUP            TO TRUE.                     05020011
050300     MOVE PC-SYSTEM-CD               TO DP003-SYSTEM-CODE.        05030011
050400     MOVE PC-OPERATING-COMPANY-CD    TO DP003-OP-CO-NMBR.         05040011
050500     MOVE PV-CURRENT-DATE-YY         TO PV-WORK-DATE-YY.          05050011
050600     MOVE PV-CURRENT-DATE-MM         TO PV-WORK-DATE-MM.          05060011
050700     MOVE PV-CURRENT-DATE-DD         TO PV-WORK-DATE-DD.          05070011
050800     MOVE PV-WORK-DATE               TO DP003-CURRENT-DATE.       05080011
050900     MOVE PV-END-DATE                TO PV-DB2-WORK-DATE.         05090011
051000     MOVE PV-DB2-YY                  TO PV-WORK-DATE-YY.          05100011
051100     MOVE PV-DB2-MM                  TO PV-WORK-DATE-MM.          05110011
051200     MOVE PV-DB2-DD                  TO PV-WORK-DATE-DD.          05120011
051300     MOVE PV-WORK-DATE               TO DP003-EFF-DATE.           05130011
051400     MOVE PV-HOLD-DEPT-NMBR-X        TO DP003-DPT-INPUT.          05140011
051500*                                                                 05150011
051600     CALL PC-PGM-DPKUT039 USING DP003-MBS-SUBROUTINE-FIELDS.      05160011
051700*                                                                 05170011
051800     EVALUATE TRUE                                                05180011
051900         WHEN DP003-SUCCESSFUL                                    05190011
052000             CONTINUE                                             05200011
052200         WHEN DP003-DPT-NOT-FOUND                                 05220011
052300            MOVE 'DEPT NOT FOUND'  TO  DP003-DPT-DESCRIPTION      05230011
052400            MOVE 'BUYER NOT FOUND'  TO DP003-BYR-NAME             05240011
052500            MOVE 'DMM NOT FOUND'    TO DP003-DMM-NAME             05250011
052600            MOVE 'GMM NOT FOUND'    TO DP003-GMM-NAME             05260011
052700            MOVE HIGH-VALUES        TO DP003-BYR-NMBR             05270011
052800                                       DP003-DMM-NMBR             05280011
052900                                       DP003-GMM-NMBR             05290011
053100         WHEN DP003-BYR-NMBR-NOT-FOUND                            05310011
053200         WHEN DP003-BYR-NAME-NOT-FOUND                            05320011
053300            MOVE 'BUYER NOT FOUND'  TO DP003-BYR-NAME             05330011
053400            MOVE 'DMM NOT FOUND'    TO DP003-DMM-NAME             05340011
053500            MOVE 'GMM NOT FOUND'    TO DP003-GMM-NAME             05350011
053600            MOVE HIGH-VALUES        TO DP003-BYR-NMBR             05360011
053700                                       DP003-DMM-NMBR             05370011
053800                                       DP003-GMM-NMBR             05380011
054000         WHEN DP003-DMM-NMBR-NOT-FOUND                            05400011
054100         WHEN DP003-DMM-NAME-NOT-FOUND                            05410011
054200            MOVE 'DMM NOT FOUND'    TO DP003-DMM-NAME             05420011
054300            MOVE 'GMM NOT FOUND'    TO DP003-GMM-NAME             05430011
054400            MOVE HIGH-VALUES        TO DP003-DMM-NMBR             05440011
054500                                       DP003-GMM-NMBR             05450011
054600                                                                  05460011
054700         WHEN DP003-GMM-NMBR-NOT-FOUND                            05470011
054800         WHEN DP003-GMM-NAME-NOT-FOUND                            05480011
054900            MOVE 'GMM NOT FOUND'    TO DP003-GMM-NAME             05490011
055000            MOVE HIGH-VALUES        TO DP003-GMM-NMBR             05500011
055200         WHEN OTHER                                               05520011
055300             DISPLAY '** ABEND **'                                05530011
055400             DISPLAY '** PROGRAM = RVKUT005 **'                   05540022
055500             DISPLAY '** PARAGRAPH = 2100-GET-DEPT-INFO **'       05550011
055600             DISPLAY '** INVALID RETURN CODE FROM DPKUT039 **'    05560011
055700             DISPLAY '** INPUT FIELDS: ' DP003-INPUT-FIELDS       05570011
055800             DISPLAY '**  RETURN DATA: ' DP003-RETURN-DATA        05580011
055900             DISPLAY '** SQLCA: ' DP003-SQLCA                     05590011
056000             DISPLAY '** SQLCODE: ' DP003-SQLCODE                 05600011
056100             MOVE +4008 TO ABEND-CODE                             05610011
056200             CALL 'ILBOABN0' USING ABEND-CODE                     05620011
056300     END-EVALUATE.                                                05630011
056400                                                                  05640011
060100******************************************************************06010011
060200* 6000-READ-VENDOR-MASTER.                                       *06020011
060300******************************************************************06030011
060400 6000-READ-VENDOR-MASTER.                                         06040011
060600     READ RV-VENDOR-MASTER-FILE                                   06060016
060700        INTO RV004-EXTRACT-RECORD                                 06070016
060800        AT END SET PS-EOF-VENDOR-MASTER TO TRUE                   06080011
060900     END-READ.                                                    06090011
061000                                                                  06100011
061100*    IF END OF FILE, SET KEY TO MAX TO FINISH OFF THE OTHER FILE  06110011
061200     IF PS-EOF-VENDOR-MASTER                                      06120011
061300         MOVE 999        TO RV004-DEPT-NMBR                       06130016
061400         MOVE 999999999  TO RV004-VENDOR-DUNNS                    06140016
061500     END-IF.                                                      06150011
061600*                                                                 06160011
061700******************************************************************06170011
061800* 6100-READ-VENDOR-RETURN.                                       *06180011
061900******************************************************************06190011
062000 6100-READ-VENDOR-RETURN.                                         06200011
062200     READ RV-VENDOR-RETURN-FILE                                   06220011
062300        INTO RV010-EXTRACT-RECORD                                 06230011
062400        AT END SET PS-EOF-VENDOR-RETURN TO TRUE                   06240011
062500     END-READ.                                                    06250011
062600                                                                  06260011
062700*    IF END OF FILE, SET KEY TO MAX TO FINISH OFF THE OTHER FILE  06270011
062800     IF PS-EOF-VENDOR-RETURN                                      06280011
062900         MOVE 999        TO RV010-DPT-NBR-N                       06290011
063000         MOVE 999999999  TO RV010-DUNS-NBR-N                      06300011
063100     END-IF.                                                      06310011
063200*                                                                 06320011
063300******************************************************************06330011
063400* 6200-WRITE-EXTRACT-FILE.                                       *06340011
063500******************************************************************06350011
063600 6200-WRITE-EXTRACT-FILE.                                         06360011
063700     INITIALIZE RV002-RETURN-AGREE-EXTRACT-REC.                   06370011
063800     SET RV002-DETAIL-REC             TO TRUE.                    06380011
063900     MOVE PV-HOLD-VENDOR-DUNNS        TO RV002-VENDOR-DUNNS.      06390011
064000     MOVE PV-HOLD-DEPT-NMBR           TO RV002-DEPT-NMBR.         06400011
064100     MOVE DP003-DPT-DESCRIPTION       TO RV002-DEPT-DESC.         06410011
064200     MOVE DP003-BYR-NAME              TO RV002-BUYER-NAME.        06420011
064300     MOVE DP003-BYR-NMBR              TO RV002-BUYER-NMBR.        06430011
064400     MOVE DP003-DMM-NAME              TO RV002-DMM-NAME.          06440011
064500     MOVE DP003-DMM-NMBR              TO RV002-DMM-NMBR.          06450011
064600     MOVE DP003-GMM-NAME              TO RV002-GMM-NAME.          06460011
064700     MOVE DP003-GMM-NMBR              TO RV002-GMM-NMBR.          06470011
064800     MOVE PA-VENDOR-DEPT-MERCH-COST   TO RV002-PURCH-COST.        06480011
064900     MOVE PA-VENDOR-DEPT-RETURN-COST  TO RV002-RETURN-COST.       06490011
065000                                                                  06500011
065100     IF  PV-DB2-AGREE-DPT-NMBR-N  = PV-HOLD-DEPT-NMBR             06510011
065200     AND PV-DB2-AGREE-VND-DUNNS-N = PV-HOLD-VENDOR-DUNNS          06520011
065300         PERFORM 6210-FETCH-NEGOTIATED-PCT                        06530024
065301         IF VNDAGR-DISCOUNT-PCT = ZERO  OR                        06530124
065302            PV-DISCOUNT-PCT-NULL-IND = -1                         06530224
065303             MOVE ZERO TO RV002-NEGOTIATED-PCT                    06530324
065304         ELSE                                                     06530424
065305             COMPUTE RV002-NEGOTIATED-PCT =                       06530524
065306                         VNDAGR-DISCOUNT-PCT * 100                06530624
065307         END-IF                                                   06530724
065310         IF VNDAGR-RTV-RA-REQD-IND = 'Y'                          06531024
065400         OR VNDAGR-RTV-NO-RA-REQD-IND = 'Y'                       06540011
065500             SET RV002-DEBIT-AND-RETURN      TO TRUE              06550011
065600         ELSE                                                     06560011
065700             SET RV002-NO-DEBIT-AND-RETURN   TO TRUE              06570011
065800         END-IF                                                   06580011
065900                                                                  06590011
066000         IF VNDAGR-DEBIT-DESTROY-IND = 'Y'                        06600011
066100             SET RV002-DEBIT-AND-DISPOSE     TO TRUE              06610011
066200         ELSE                                                     06620011
066300             SET RV002-NO-DEBIT-AND-DISPOSE  TO TRUE              06630011
066400         END-IF                                                   06640011
066500                                                                  06650011
066600         IF VNDAGR-MARKOUT-IND = 'Y'                              06660011
066700             SET RV002-MARK-OUT-OF-STOCK     TO TRUE              06670011
066800         ELSE                                                     06680011
066900             SET RV002-NO-MARK-OUT-OF-STOCK  TO TRUE              06690011
067000         END-IF                                                   06700011
067100     ELSE                                                         06710011
067200         MOVE '***'  TO RV002-RETURN-AGREEMENTS                   06720011
067210         MOVE ZEROS  TO RV002-NEGOTIATED-PCT                      06721024
067300     END-IF.                                                      06730011
067400                                                                  06740011
067500     IF PV-DB2-NAME-VND-DUNNS-N = PV-HOLD-VENDOR-DUNNS            06750011
067600         MOVE ENTNME-ENT-NAME-DESC  TO RV002-VENDOR-NAME          06760011
067700         IF EXTENT-CFY-SLSRNK-NBR = 0                             06770012
067800             SET RV002-ZERO-VENDOR-RANK TO TRUE                   06780018
068000         ELSE                                                     06800011
068100             MOVE EXTENT-CFY-SLSRNK-NBR TO RV002-VENDOR-RANK      06810018
068300         END-IF                                                   06830011
068400     ELSE                                                         06840011
068500* IF THE VENDOR NAME WAS NOT FOUND, MOVE THE DUNNS NUMBER TO THE  06850011
068600* NAME, AND SET THE RANK TO BE "UNKNOWN"                          06860011
068700         MOVE PV-HOLD-VENDOR-DUNNS  TO RV002-VENDOR-NAME          06870011
068800         SET RV002-UNKOWN-VENDOR-RANK TO TRUE                     06880019
069000     END-IF.                                                      06900011
069100                                                                  06910011
069200     WRITE RTV-REPORT-EXTRACT-RECORD                              06920011
069300        FROM RV002-RETURN-AGREE-EXTRACT-REC.                      06930011
069400*                                                                 06940011
069410******************************************************************06941024
069420* FETCH THE NEGOTIATED PERCENT FROM THE VENDOR AGREEMENT TABLE.  *06942024
069430******************************************************************06943024
069440 6210-FETCH-NEGOTIATED-PCT.                                       06944024
069450     EXEC SQL                                                     06945024
069492          SELECT DISCOUNT_PCT                                     06949224
069493            INTO :VNDAGR-DISCOUNT-PCT                             06949324
069494                   :PV-DISCOUNT-PCT-NULL-IND                      06949424
069495            FROM TVNDAGR                                          06949524
069496           WHERE DEPT_NBR         = :PV-DB2-AGREE-DPT-NMBR        06949624
069497             AND ENT_ID           = :EXTENT-ENT-ID                06949724
069498             AND AGRMT_TYP_ID     = '5'                           06949824
069499             AND EFFECTIVE_DATE  <= CURRENT DATE                  06949924
069500             AND EXPIRATION_DATE >  CURRENT DATE                  06950024
069501             AND TYP_CDE          = 7                             06950124
069503     END-EXEC.                                                    06950324
069505                                                                  06950524
069506     EVALUATE TRUE                                                06950624
069507         WHEN SQLCODE = ZERO                                      06950724
069508              CONTINUE                                            06950824
069510         WHEN SQLCODE = +100                                      06951024
069511              MOVE ZERO         TO VNDAGR-DISCOUNT-PCT            06951124
069513         WHEN SQLWARN0 NOT EQUAL SPACE                            06951324
069514         WHEN SQLCODE NOT EQUAL ZERO                              06951424
069515             MOVE EXTENT-ENT-ID TO PV-ERROR-ENT-ID                06951524
069516             DISPLAY '** ABEND **'                                06951624
069517             DISPLAY '** PROGRAM = RVKUT005 **'                   06951724
069518             DISPLAY '** PARAGRAPH = 6210-FETCH-NEGOTIATED-PCT'   06951824
069519             DISPLAY '** ENT-ID    = ' PV-ERROR-ENT-ID            06951924
069520             DISPLAY '** DEPT NBR  = ' PV-DB2-AGREE-DPT-NMBR      06952024
069521             PERFORM 9100-SQL-ABEND                               06952124
069522     END-EVALUATE.                                                06952224
069523                                                                  06952324
069530******************************************************************06953024
069600* 6300-SET-CURRENT-KEY.                                          *06960011
069700*  THE FILES ARE IN ASCENDING DUNNS/ASCENDING DEPT NUMBER ORDER. *06970011
069800*  IF BOTH FILES ARE ON THE SAME VND/DPT, SET THE CURRENT KEY    *06980011
069900*   TO EITHER OF THEM.                                           *06990011
070000*  IF ONE FILE IS LESS THAN THE OTHER ON EITHER KEY, MOVE THE    *07000011
070100*   SMALLER KEY TO THE HOLD FILES TO RUN THROUGHT THAT FILE.     *07010011
070200*   SEE 2000-CREATE-EXTRACT FOR FURTHER INFORMATION              *07020011
070300******************************************************************07030011
070400 6300-SET-CURRENT-KEY.                                            07040011
070600     EVALUATE TRUE                                                07060011
070700     WHEN RV010-DUNS-NBR-N = RV004-VENDOR-DUNNS                   07070016
070800        MOVE RV004-VENDOR-DUNNS       TO PV-HOLD-VENDOR-DUNNS     07080016
070900        IF RV010-DPT-NBR-N < RV004-DEPT-NMBR                      07090016
071000           MOVE RV010-DPT-NBR-N    TO PV-HOLD-DEPT-NMBR           07100011
071100        ELSE                                                      07110011
071200           MOVE RV004-DEPT-NMBR    TO PV-HOLD-DEPT-NMBR           07120016
071300        END-IF                                                    07130011
071400                                                                  07140011
071500     WHEN RV010-DUNS-NBR-N < RV004-VENDOR-DUNNS                   07150016
071600        MOVE RV010-DUNS-NBR-N         TO PV-HOLD-VENDOR-DUNNS     07160011
071700        MOVE RV010-DPT-NBR-N          TO PV-HOLD-DEPT-NMBR        07170011
071800                                                                  07180011
071900     WHEN OTHER                                                   07190011
072000        MOVE RV004-VENDOR-DUNNS       TO PV-HOLD-VENDOR-DUNNS     07200016
072100        MOVE RV004-DEPT-NMBR          TO PV-HOLD-DEPT-NMBR        07210016
072200                                                                  07220011
072300     END-EVALUATE.                                                07230011
072600*                                                                 07260011
072700******************************************************************07270011
072800* 7000-OPEN-VND-AGREE-CURSOR.                                    *07280011
072900******************************************************************07290011
073000 7000-OPEN-VND-AGREE-CURSOR.                                      07300011
073200     EXEC SQL                                                     07320011
073300          OPEN VND_AGREE_CURSOR                                   07330011
073400     END-EXEC.                                                    07340011
073500                                                                  07350011
073600     EVALUATE TRUE                                                07360011
073700         WHEN SQLWARN0 NOT EQUAL SPACE                            07370011
073800         WHEN SQLCODE NOT EQUAL ZERO                              07380011
073900             DISPLAY '** ABEND **'                                07390011
074000             DISPLAY '** PROGRAM = RVKUT005 **'                   07400022
074100             DISPLAY '** PARAGRAPH = 7000-OPEN-VENDOR-CURSOR **'  07410011
074200             PERFORM 9100-SQL-ABEND                               07420011
074300     END-EVALUATE.                                                07430011
074400                                                                  07440011
074600******************************************************************07460011
074700* 7100-CLOSE-VND-AGREE-CURSOR.                                   *07470011
074800******************************************************************07480011
074900 7100-CLOSE-VND-AGREE-CURSOR.                                     07490011
075200     EXEC SQL                                                     07520011
075300         CLOSE VND_AGREE_CURSOR                                   07530011
075400     END-EXEC.                                                    07540011
075500                                                                  07550011
075600     EVALUATE TRUE                                                07560011
075700         WHEN SQLWARN0 NOT EQUAL SPACE                            07570011
075800         WHEN SQLCODE NOT EQUAL ZERO                              07580011
075900             DISPLAY '** ABEND **'                                07590011
076000             DISPLAY '** PROGRAM = RVKUT005 **'                   07600022
076100             DISPLAY '** PARAGRAPH = 7000-CLOSE-VENDOR-CURSOR**'  07610011
076200             PERFORM 9100-SQL-ABEND                               07620011
076300     END-EVALUATE.                                                07630011
076400                                                                  07640011
076600******************************************************************07660011
076700* 7200-FETCH-VND-AGREE-CURSOR.                                   *07670011
076800******************************************************************07680011
076900 7200-FETCH-VND-AGREE-CURSOR.                                     07690011
077100     EXEC SQL                                                     07710011
077200          FETCH VND_AGREE_CURSOR                                  07720011
077300          INTO                                                    07730011
077400              :VNDAGR-RTV-RA-REQD-IND                             07740011
077500             ,:VNDAGR-RTV-NO-RA-REQD-IND                          07750011
077600             ,:VNDAGR-DEBIT-DESTROY-IND                           07760011
077700             ,:VNDAGR-MARKOUT-IND                                 07770011
077800             ,:PV-DB2-AGREE-DPT-NMBR                              07780011
077810             ,:EXTENT-ENT-ID                                      07781024
077900             ,:PV-DB2-AGREE-VND-DUNNS                             07790011
078000     END-EXEC.                                                    07800011
078100                                                                  07810011
078200     EVALUATE TRUE                                                07820011
078300         WHEN SQLCODE = ZERO                                      07830011
078400              CONTINUE                                            07840011
078600         WHEN SQLCODE = +100                                      07860011
078700              MOVE '999999999' TO PV-DB2-AGREE-VND-DUNNS          07870011
078800              MOVE '999'       TO PV-DB2-AGREE-DPT-NMBR           07880011
078900              SET PS-EOC-VND-AGREE-CURSOR TO TRUE                 07890018
079200         WHEN SQLWARN0 NOT EQUAL SPACE                            07920011
079300         WHEN SQLCODE NOT EQUAL ZERO                              07930011
079400             DISPLAY '** ABEND **'                                07940011
079500             DISPLAY '** PROGRAM = RVKUT005 **'                   07950022
079600             DISPLAY '** PARAGRAPH = 7200-FETCH-VENDOR-CURSOR**'  07960011
079700             PERFORM 9100-SQL-ABEND                               07970011
079800     END-EVALUATE.                                                07980011
079900                                                                  07990011
080300******************************************************************08030011
080400* 7300-OPEN-VND-NAME-CURSOR.                                    *R08040011
080500******************************************************************08050011
080600 7300-OPEN-VND-NAME-CURSOR.                                       08060011
080800     EXEC SQL                                                     08080011
080900          OPEN VND_NAME_CURSOR                                    08090011
081000     END-EXEC.                                                    08100011
081100                                                                  08110011
081200     EVALUATE TRUE                                                08120011
081300         WHEN SQLWARN0 NOT EQUAL SPACE                            08130011
081400         WHEN SQLCODE NOT EQUAL ZERO                              08140011
081500             DISPLAY '** ABEND **'                                08150011
081600             DISPLAY '** PROGRAM = RVKUT005 **'                   08160022
081700             DISPLAY '** PARAGRAPH = 7300-OPEN-VND-NAME-CURSOR*'  08170011
081800             PERFORM 9100-SQL-ABEND                               08180011
081900     END-EVALUATE.                                                08190011
082000                                                                  08200011
082200******************************************************************08220011
082300* 7400-CLOSE-VND-NAME-CURSOR.                                    *08230011
082400******************************************************************08240011
082500 7400-CLOSE-VND-NAME-CURSOR.                                      08250011
082800     EXEC SQL                                                     08280011
082900         CLOSE VND_NAME_CURSOR                                    08290011
083000     END-EXEC.                                                    08300011
083100                                                                  08310011
083200     EVALUATE TRUE                                                08320011
083300         WHEN SQLWARN0 NOT EQUAL SPACE                            08330011
083400         WHEN SQLCODE NOT EQUAL ZERO                              08340011
083500             DISPLAY '** ABEND **'                                08350011
083600             DISPLAY '** PROGRAM = RVKUT005 **'                   08360022
083700             DISPLAY '** PARAGRAPH = 7400-CLOSE-VND-NAME-CURSOR'  08370011
083800             PERFORM 9100-SQL-ABEND                               08380011
083900     END-EVALUATE.                                                08390011
084000                                                                  08400011
084200******************************************************************08420011
084300* 7500-FETCH-VND-NAME-CURSOR.                                    *08430011
084400******************************************************************08440011
084500 7500-FETCH-VND-NAME-CURSOR.                                      08450011
084700     EXEC SQL                                                     08470011
084800          FETCH VND_NAME_CURSOR                                   08480011
084900          INTO                                                    08490011
085010              :ENTNME-ENT-NAME-DESC                               08501023
085100             ,:PV-DB2-NAME-VND-DUNNS                              08510011
085200             ,:EXTENT-CFY-SLSRNK-NBR                              08520012
085300     END-EXEC.                                                    08530011
085400                                                                  08540011
085500     EVALUATE TRUE                                                08550011
085600         WHEN SQLCODE = ZERO                                      08560011
085700              CONTINUE                                            08570011
085900         WHEN SQLCODE = +100                                      08590011
086000              MOVE '999999999' TO  PV-DB2-NAME-VND-DUNNS          08600011
086100              SET PS-EOC-VND-NAME-CURSOR TO TRUE                  08610018
086400         WHEN SQLWARN0 NOT EQUAL SPACE                            08640011
086500         WHEN SQLCODE NOT EQUAL ZERO                              08650011
086600             DISPLAY '** ABEND **'                                08660011
086700             DISPLAY '** PROGRAM = RVKUT005 **'                   08670022
086800             DISPLAY '** PARAGRAPH = 7500-FETCH-VND-NAME-CURSOR'  08680011
086900             PERFORM 9100-SQL-ABEND                               08690011
087000     END-EVALUATE.                                                08700011
087100                                                                  08710011
088400******************************************************************08840011
088500* 9000-EOJ-ROUTINE - PRINTS A GRAND TOTAL, AND CLOSES THE VENDOR  08850011
088600* CURSOR AND THE REPORT FILE.                                     08860011
088700******************************************************************08870011
088800 9000-EOJ-ROUTINE.                                                08880011
089000     INITIALIZE RV002-RETURN-AGREE-EXTRACT-REC.                   08900011
089100                                                                  08910011
089200     SET RV002-HEADER-REC            TO TRUE.                     08920011
089400     MOVE PV-RPT-TYPE            TO RV002-RPT-TYPE.               08940011
089600     MOVE PV-CURRENT-DATE        TO RV002-CURR-DATE.              08960011
089800     MOVE PV-BEGIN-DATE          TO RV002-BEGIN-DATE.             08980011
089900     MOVE PV-END-DATE            TO RV002-END-DATE.               08990011
090000                                                                  09000011
090100* WRITE HEADER INFORMATION TO OUTPUT FILE.                        09010011
090300     WRITE RTV-REPORT-EXTRACT-RECORD                              09030011
090400        FROM RV002-RETURN-AGREE-EXTRACT-REC.                      09040011
090600                                                                  09060011
090700     CLOSE RV-VENDOR-MASTER-FILE                                  09070016
090800           RV-VENDOR-RETURN-FILE                                  09080011
090900           RTV-REPORT-EXTRACT.                                    09090011
091000                                                                  09100011
091100     PERFORM 7100-CLOSE-VND-AGREE-CURSOR.                         09110011
091200     PERFORM 7400-CLOSE-VND-NAME-CURSOR.                          09120011
091300                                                                  09130011
091500******************************************************************09150011
091600* 9100-OVERFLOW-ERROR - IF ON OF THE ACCUMULATOR FIELDS           09160011
091700* ROLLS OVER (IE THE NUMBER IS TOO BIG TO FIT) THIS PARAGRAPH     09170011
091800* WILL ABEND THE PROGRAM                                          09180011
091900******************************************************************09190011
092000 9100-OVERFLOW-ERROR.                                             09200011
092100     DISPLAY '** ABEND     **'.                                   09210011
092200     DISPLAY '** PROGRAM   ** = RVKUT005'.                        09220011
092300     DISPLAY '** PROGRAM ACCUMULATOR OVERFLOW ERROR **'.          09230011
092400     DISPLAY '** THE DATA CREATES A TOTALS VALUE LARGER THAN '.   09240011
092500     DISPLAY '** THE FIELD SET-UP TO HANDLE IT.  INCREASE THE'.   09250011
092600     DISPLAY '** THE FOLLOWING FIELD WAS TOO SMALL: '.            09260011
092700     DISPLAY PV-FIELD-NAME.                                       09270011
092800     MOVE +4004 TO ABEND-CODE.                                    09280011
092900     CALL 'ILBOABN0' USING ABEND-CODE.                            09290011
093000******************************************************************09300011
093100* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      09310011
093200* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 09320011
093300******************************************************************09330011
093400 9100-SQL-ABEND.                                                  09340011
093500******************************************************************09350011
093600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    09360011
093700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         09370011
093800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09380011
093900* FORMAT.                                                         09390011
094000******************************************************************09400011
094100     COPY DPPD004.                                                09410018
094300                                                                  09430011
094400     MOVE +4013 TO ABEND-CODE.                                    09440011
094500     CALL 'ILBOABN0' USING ABEND-CODE.                            09450011
