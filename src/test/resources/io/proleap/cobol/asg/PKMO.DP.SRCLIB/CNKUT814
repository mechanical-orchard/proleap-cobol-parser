000100******************************************************************00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000600******************************************************************00060004
000700 PROGRAM-ID.    CNKUT814.                                         00070099
000800 AUTHOR.        TKMA497.                                          00080007
000900 INSTALLATION.  KOHLS.                                            00090004
001000 DATE-WRITTEN   OCTOBER, 2011.                                    00100099
001100 DATE-COMPILED.                                                   00110004
001200******************************************************************00120004
001300*  NEW DC - TOSOPFA EXTRACT                                       00130099
001310*  THIS PROGRAM EXTRACTS DATA FROM THE OPERATION SET/OPERATION/   00131099
001400*  FACILITY TABLE AND IF THE NEW OPER_UNT_ID VALUE IN THE CONTROL 00140099
001410*  CARD IS DIFFERENT FROM THE VALUE USED IN THE MAIN CURSOR,      00141099
001500*  REPLACES THE VALUE USED IN THE MAIN CURSOR WITH THE NEW VALUE  00150099
001700*  IN THE CONTROL CARD BEFORE WRITING THE OUTPUT FILE.            00170099
006600******************************************************************00660004
007000 ENVIRONMENT DIVISION.                                            00700004
007100******************************************************************00710004
007200 CONFIGURATION SECTION.                                           00720004
007300*                                                                 00730004
007400 SOURCE-COMPUTER.        IBM-3090.                                00740004
007500 OBJECT-COMPUTER.        IBM-3090.                                00750004
007600*                                                                 00760004
007700 INPUT-OUTPUT SECTION.                                            00770004
007800*                                                                 00780004
007900 FILE-CONTROL.                                                    00790004
008000*                                                                 00800099
008400     SELECT TOSOPFA-FILE-OUT                                      00840099
008500         ASSIGN TO OUT01.                                         00850004
008700*                                                                 00870004
008800******************************************************************00880004
008900 DATA DIVISION.                                                   00890004
009000******************************************************************00900004
009100 FILE SECTION.                                                    00910004
009200*                                                                 00920004
010000*                                                                 01000004
010100 FD  TOSOPFA-FILE-OUT                                             01010099
010200     RECORDING MODE IS F                                          01020004
010300     BLOCK CONTAINS 0 RECORDS                                     01030004
010400     LABEL RECORDS ARE STANDARD.                                  01040004
010500*                                                                 01050004
010600 01  TOSOPFA-RECORD-OUT            PIC  X(57).                    01060099
010800*                                                                 01080004
010900 WORKING-STORAGE SECTION.                                         01090004
011000*                                                                 01100004
011100 01  PC-PROGRAM-CONSTANTS.                                        01110004
011200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)    VALUE            01120019
011300         'CNKUT814'.                                              01130099
011400                                                                  01140004
011500 01  DK-DB2-KEYS.                                                 01150099
011600     05  DK-OPER-UNT-ID             PIC S9(04)  VALUE ZERO        01160099
011700                                                   COMP.          01170099
012600*                                                                 01260004
012700 01  CC-CONTROL-CARD.                                             01270004
012800     05  CC-OPER-UNT-ID-CURR1       PIC  9(04).                   01280099
012810     05  CC-OPER-UNT-ID-CURR1-X REDEFINES CC-OPER-UNT-ID-CURR1    01281099
012820                                    PIC  X(04).                   01282099
012900     05  FILLER                     PIC  X.                       01290011
013000     05  CC-OPER-UNT-ID-NEW1        PIC  9(04).                   01300099
013010     05  CC-OPER-UNT-ID-NEW1-X REDEFINES CC-OPER-UNT-ID-NEW1      01301099
013020                                    PIC  X(04).                   01302088
013100     05  FILLER                     PIC  X.                       01310011
013200     05  CC-OPER-UNT-ID-CURR2       PIC  9(04).                   01320099
013210     05  CC-OPER-UNT-ID-CURR2-X REDEFINES CC-OPER-UNT-ID-CURR2    01321099
013220                                    PIC  X(04).                   01322088
013300     05  FILLER                     PIC  X.                       01330011
013400     05  CC-OPER-UNT-ID-NEW2        PIC  9(04).                   01340099
013410     05  CC-OPER-UNT-ID-NEW2-X REDEFINES CC-OPER-UNT-ID-NEW2      01341099
013420                                    PIC  X(04).                   01342088
013500     05  FILLER                     PIC  X.                       01350011
013600     05  CC-OPER-UNT-ID-CURR3       PIC  9(04).                   01360099
013610     05  CC-OPER-UNT-ID-CURR3-X REDEFINES CC-OPER-UNT-ID-CURR3    01361099
013620                                    PIC  X(04).                   01362088
013700     05  FILLER                     PIC  X.                       01370011
013800     05  CC-OPER-UNT-ID-NEW3        PIC  9(04).                   01380099
013810     05  CC-OPER-UNT-ID-NEW3-X REDEFINES CC-OPER-UNT-ID-NEW3      01381099
013820                                    PIC  X(04).                   01382088
013900     05  FILLER                     PIC  X.                       01390011
014000     05  CC-OPER-UNT-ID-CURR4       PIC  9(04).                   01400099
014010     05  CC-OPER-UNT-ID-CURR4-X REDEFINES CC-OPER-UNT-ID-CURR4    01401099
014020                                    PIC  X(04).                   01402088
014100     05  FILLER                     PIC  X.                       01410011
014200     05  CC-OPER-UNT-ID-NEW4        PIC  9(04).                   01420099
014210     05  CC-OPER-UNT-ID-NEW4-X REDEFINES CC-OPER-UNT-ID-NEW4      01421099
014220                                    PIC  X(04).                   01422088
014300     05  FILLER                     PIC  X(41).                   01430011
014500*                                                                 01450004
014600*                                                                 01460004
014700 01  PS-PROGRAM-SWITCHES.                                         01470004
015000     05  PS-CONTROL-CARD-VALID-SW    PIC  X(01)    VALUE SPACE.   01500004
015100         88  PS-CONTROL-CARD-INVALID               VALUE 'N'.     01510004
015200         88  PS-CONTROL-CARD-VALID                 VALUE 'Y'.     01520004
015201     05  PS-END-OF-TOSOPFA-CSR-SW    PIC  X(01)    VALUE 'N'.     01520199
015210         88 PS-END-OF-TOSOPFA-CSR-NO               VALUE 'N'.     01521099
015220         88 PS-END-OF-TOSOPFA-CSR-YES              VALUE 'Y'.     01522099
015300*                                                                 01530004
015400*                                                                 01540004
015500 01  PV-PROGRAM-VARIABLES.                                        01550004
015510     05  PV-TOSOPFA                  PIC  X.                      01551099
015520         88  PV-TOSOPFA-1            VALUE '1'.                   01552099
015530         88  PV-TOSOPFA-2            VALUE '2'.                   01553099
015540         88  PV-TOSOPFA-3            VALUE '3'.                   01554099
015550         88  PV-TOSOPFA-4            VALUE '4'.                   01555099
015600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01560004
015700                                                   COMP.          01570004
015800     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01580004
015810     05  PV-OPER-SET-ID              PIC S9(04)    VALUE ZERO     01581099
015820                                                   COMP.          01582029
015821     05  PV-OPER-ID                  PIC S9(04)    VALUE ZERO     01582199
015822                                                   COMP.          01582299
015830     05  PV-OPER-UNT-ID              PIC S9(04)    VALUE ZERO     01583099
015840                                                   COMP.          01584099
015900     05  PV-TOSOPFA-CNT             PIC S9(05)    VALUE ZERO      01590099
016000                                                   COMP-3.        01600004
016100     05  PV-TOSOPFA-1-CNT            PIC S9(05)    VALUE ZERO     01610099
016200                                                   COMP-3.        01620004
016210     05  PV-TOSOPFA-2-CNT            PIC S9(05)    VALUE ZERO     01621099
016220                                                   COMP-3.        01622097
016230     05  PV-TOSOPFA-3-CNT            PIC S9(05)    VALUE ZERO     01623099
016240                                                   COMP-3.        01624097
016250     05  PV-TOSOPFA-4-CNT            PIC S9(05)    VALUE ZERO     01625099
016260                                                   COMP-3.        01626097
016300     05  PV-OUTPUT-CNT               PIC S9(05)    VALUE ZERO     01630090
016400                                                   COMP-3.        01640004
016410     05  PV-DISPLAY-CNT              PIC ZZZZ9.                   01641033
016420     05  PV-DISPLAY-OPER-UNT-ID      PIC  9(4).                   01642099
016430     05  PV-DISPLAY-OPER-SET-ID      PIC  9(4).                   01643099
016431     05  PV-DISPLAY-OPER-ID          PIC  9(4).                   01643199
016440                                                                  01644099
016500     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01650004
017300*                                                                 01730004
017400 01  PE-PROGRAM-ERROR-MESSAGES.                                   01740004
017500     05  PE-MSG-01                   PIC  X(30)    VALUE          01750004
017600         'OPEN OF TOSOPFA_CSR           '.                        01760099
017700     05  PE-MSG-02                   PIC  X(30)    VALUE          01770004
017800         'FETCH OF TOSOPFA_CSR          '.                        01780099
020100     05  PE-MSG-03                   PIC  X(30)    VALUE          02010022
020200         'CLOSE OF TOSOPFA_CSR          '.                        02020099
020300*                                                                 02030004
021300******************************************************************02130004
021400*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       02140004
021500******************************************************************02150004
021600     COPY DPWS004.                                                02160004
021800*                                                                 02180004
021900******************************************************************02190004
022000*  COMMUNICATIONS AREA FOR DB2                                    02200004
022100******************************************************************02210004
022200     EXEC SQL                                                     02220004
022300          INCLUDE SQLCA                                           02230004
022400     END-EXEC.                                                    02240004
022500*                                                                 02250004
022510*----------------------------------------------------------------*02251035
022520*    DB2 OPERATION SET / FACILITY TABLE                           02252099
022530*----------------------------------------------------------------*02253035
022540     EXEC SQL                                                     02254035
022550          INCLUDE TOSOPFA                                         02255099
022560     END-EXEC.                                                    02256035
024900*                                                                 02490004
025100******************************************************************02510004
025200**  CURSOR USED TO RETRIEVE OPERATION SET / FACILITY              02520099
025400******************************************************************02540004
025500     EXEC SQL                                                     02550004
025600          DECLARE TOSOPFA_CSR CURSOR FOR                          02560099
025700           SELECT OPER_SET_ID                                     02570099
025701                 ,OPER_ID                                         02570199
025702                 ,OPER_UNT_ID                                     02570299
025703                 ,FCLTY_ID                                        02570399
025704                 ,FCLTY_AREA_ID                                   02570499
025705                 ,PRC_FCLTY_AREA_ID                               02570599
025706                 ,CRE_TMST                                        02570699
025707                 ,VER_STATUS_CDE                                  02570799
025708                 ,CRE_UID_ID                                      02570899
025709                 ,SCRN_SEQ_NBR                                    02570999
026600             FROM TOSOPFA                                         02660099
026800            WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                   02680099
026900         WITH UR                                                  02690016
027000     END-EXEC                                                     02700036
046000*                                                                 04600004
046100******************************************************************04610004
046200 PROCEDURE DIVISION.                                              04620004
046300******************************************************************04630004
046400                                                                  04640004
046500******************************************************************04650004
046600*  CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                   04660004
046700******************************************************************04670004
046800 0000-PROGRAM-MAINLINE.                                           04680004
046900     PERFORM 1000-INITIALIZE.                                     04690004
046910*                                                                 04691099
046920* NOTE:  IF LOC-ID-CURR  =  LOC-ID-NEW THIS IS VALID              04692099
046930*        THAT IS WHAT WILL BE USED TO LOAD THE FILE TO PROD       04693099
046940*                                                                 04694099
047000*                                                                 04700004
047010     IF  CC-OPER-UNT-ID-CURR1-X NUMERIC   AND                     04701099
047011         CC-OPER-UNT-ID-NEW1-X  NUMERIC   AND                     04701199
047012         CC-OPER-UNT-ID-CURR1-X > '0000'  AND                     04701299
047013         CC-OPER-UNT-ID-NEW1-X  > '0000'                          04701399
047024         MOVE CC-OPER-UNT-ID-CURR1 TO DK-OPER-UNT-ID              04702499
047025         MOVE CC-OPER-UNT-ID-NEW1  TO PV-OPER-UNT-ID              04702599
047026         MOVE '1'                  TO PV-TOSOPFA                  04702699
047027         PERFORM 7000-OPEN-TOSOPFA-CSR                            04702799
047028                                                                  04702899
047029         PERFORM 7010-FETCH-TOSOPFA-CSR                           04702999
047030         IF  PS-END-OF-TOSOPFA-CSR-NO                             04703099
047031             DISPLAY '** PROCESSING CC-OPER-UNT-ID-CURR1 '        04703199
047032                                    CC-OPER-UNT-ID-CURR1          04703299
047033             DISPLAY '** PROCESSING CC-OPER-UNT-ID-NEW1  '        04703399
047034                                    CC-OPER-UNT-ID-NEW1           04703499
047035             PERFORM 2000-PROCESS-TOSOPFA                         04703599
047036               UNTIL PS-END-OF-TOSOPFA-CSR-YES                    04703699
047037         ELSE                                                     04703799
047038             DISPLAY '** CC CURRENT OPER-UNT-ID 1 NOT FOUND ==> ' 04703899
047039                      CC-OPER-UNT-ID-CURR1-X                      04703999
047040         END-IF                                                   04704099
047041         PERFORM 7020-CLOSE-TOSOPFA-CSR                           04704199
047042                                                                  04704299
047043     ELSE                                                         04704325
047044* * *  JUST SKIP IF CURRENT AND NEW OPER-UNT-ID ARE ZERO          04704499
047045         IF  CC-OPER-UNT-ID-CURR1-X = '0000'  AND                 04704599
047046             CC-OPER-UNT-ID-NEW1-X  = '0000'                      04704699
047047             CONTINUE                                             04704789
047054         ELSE                                                     04705425
047055             DISPLAY '** CC OPER-UNT-ID 1 DATA INVALID'           04705599
047056             DISPLAY '** ' CC-OPER-UNT-ID-CURR1-X ' '             04705699
047057                           CC-OPER-UNT-ID-NEW1-X                  04705799
047059         END-IF                                                   04705986
047091     END-IF.                                                      04709125
047092*                                                                 04709292
047093     IF  CC-OPER-UNT-ID-CURR2-X NUMERIC  AND                      04709399
047094         CC-OPER-UNT-ID-NEW2-X  NUMERIC  AND                      04709499
047095         CC-OPER-UNT-ID-CURR2-X > '0000' AND                      04709599
047096         CC-OPER-UNT-ID-NEW2-X  > '0000'                          04709699
047210         MOVE CC-OPER-UNT-ID-CURR2 TO DK-OPER-UNT-ID              04721099
047220         MOVE CC-OPER-UNT-ID-NEW2  TO PV-OPER-UNT-ID              04722099
047221         MOVE '2'                  TO PV-TOSOPFA                  04722199
047222         SET PS-END-OF-TOSOPFA-CSR-NO TO TRUE                     04722299
047230         PERFORM 7000-OPEN-TOSOPFA-CSR                            04723099
047231                                                                  04723199
047240         PERFORM 7010-FETCH-TOSOPFA-CSR                           04724099
047241         IF  PS-END-OF-TOSOPFA-CSR-NO                             04724199
047242             DISPLAY '** PROCESSING CC-OPER-UNT-ID-CURR2 '        04724299
047243                                    CC-OPER-UNT-ID-CURR2          04724399
047244             DISPLAY '** PROCESSING CC-OPER-UNT-ID-NEW2  '        04724499
047245                                    CC-OPER-UNT-ID-NEW2           04724599
047250             PERFORM 2000-PROCESS-TOSOPFA                         04725099
047260               UNTIL PS-END-OF-TOSOPFA-CSR-YES                    04726099
047261         ELSE                                                     04726199
047262             DISPLAY '** CC CURRENT OPER-UNT-ID 2 NOT FOUND ==> ' 04726299
047264                      CC-OPER-UNT-ID-CURR2-X                      04726499
047265         END-IF                                                   04726599
047270         PERFORM 7020-CLOSE-TOSOPFA-CSR                           04727099
047271                                                                  04727199
047280     ELSE                                                         04728092
047290* * *  JUST SKIP IF CURRENT AND NEW OPER-UNT-ID ARE ZERO          04729099
047291         IF  CC-OPER-UNT-ID-CURR2-X = '0000'  AND                 04729199
047292             CC-OPER-UNT-ID-NEW2-X  = '0000'                      04729299
047293             CONTINUE                                             04729392
047294         ELSE                                                     04729492
047295             DISPLAY '** CC OPER-UNT-ID 2 DATA INVALID'           04729599
047296             DISPLAY '** ' CC-OPER-UNT-ID-CURR2-X ' '             04729699
047297                           CC-OPER-UNT-ID-NEW2-X                  04729799
047298         END-IF                                                   04729899
047299     END-IF.                                                      04729999
047300*                                                                 04730004
047400     IF  CC-OPER-UNT-ID-CURR3-X NUMERIC   AND                     04740099
047410         CC-OPER-UNT-ID-NEW3-X  NUMERIC   AND                     04741099
047420         CC-OPER-UNT-ID-CURR3-X > '0000'  AND                     04742099
047430         CC-OPER-UNT-ID-NEW3-X  > '0000'                          04743099
047472         MOVE CC-OPER-UNT-ID-CURR3 TO DK-OPER-UNT-ID              04747299
047473         MOVE CC-OPER-UNT-ID-NEW3  TO PV-OPER-UNT-ID              04747399
047474         MOVE '3'                  TO PV-TOSOPFA                  04747499
047475         SET PS-END-OF-TOSOPFA-CSR-NO TO TRUE                     04747599
047476         PERFORM 7000-OPEN-TOSOPFA-CSR                            04747699
047477                                                                  04747799
047478         PERFORM 7010-FETCH-TOSOPFA-CSR                           04747899
047479         IF  PS-END-OF-TOSOPFA-CSR-NO                             04747999
047480             DISPLAY '** PROCESSING CC-OPER-UNT-ID-CURR3 '        04748099
047481                                    CC-OPER-UNT-ID-CURR3          04748199
047482             DISPLAY '** PROCESSING CC-OPER-UNT-ID-NEW3  '        04748299
047483                                    CC-OPER-UNT-ID-NEW3           04748399
047484             PERFORM 2000-PROCESS-TOSOPFA                         04748499
047485               UNTIL PS-END-OF-TOSOPFA-CSR-YES                    04748599
047486         ELSE                                                     04748699
047487             DISPLAY '** CC CURRENT OPER-UNT-ID 3 NOT FOUND ==> ' 04748799
047488                      CC-OPER-UNT-ID-CURR3-X                      04748899
047489         END-IF                                                   04748999
047490         PERFORM 7020-CLOSE-TOSOPFA-CSR                           04749099
047491                                                                  04749199
047492     ELSE                                                         04749293
047493* * *  JUST SKIP IF CURRENT AND NEW OPER-UNT-ID ARE ZERO          04749399
047494         IF  CC-OPER-UNT-ID-CURR3-X = '0000'  AND                 04749499
047495             CC-OPER-UNT-ID-NEW3-X  = '0000'                      04749599
047496             CONTINUE                                             04749693
047497         ELSE                                                     04749793
047498             DISPLAY '** CC OPER-UNT-ID 3 DATA INVALID'           04749899
047499             DISPLAY '** ' CC-OPER-UNT-ID-CURR3-X ' '             04749999
047500                           CC-OPER-UNT-ID-NEW3-X                  04750099
047501         END-IF                                                   04750199
047502     END-IF.                                                      04750299
047503*                                                                 04750399
047504     IF  CC-OPER-UNT-ID-CURR4-X NUMERIC   AND                     04750499
047505         CC-OPER-UNT-ID-NEW4-X  NUMERIC   AND                     04750599
047506         CC-OPER-UNT-ID-CURR4-X > '0000'  AND                     04750699
047507         CC-OPER-UNT-ID-NEW4-X  > '0000'                          04750799
047510         MOVE CC-OPER-UNT-ID-CURR4 TO DK-OPER-UNT-ID              04751099
047511         MOVE CC-OPER-UNT-ID-NEW4  TO PV-OPER-UNT-ID              04751199
047512         MOVE '4'                  TO PV-TOSOPFA                  04751299
047513         SET PS-END-OF-TOSOPFA-CSR-NO TO TRUE                     04751399
047514         PERFORM 7000-OPEN-TOSOPFA-CSR                            04751499
047515                                                                  04751599
047516         PERFORM 7010-FETCH-TOSOPFA-CSR                           04751699
047517         IF  PS-END-OF-TOSOPFA-CSR-NO                             04751799
047518             DISPLAY '** PROCESSING CC-OPER-UNT-ID-CURR4 '        04751899
047519                                    CC-OPER-UNT-ID-CURR4          04751999
047520             DISPLAY '** PROCESSING CC-OPER-UNT-ID-NEW4  '        04752099
047521                                    CC-OPER-UNT-ID-NEW4           04752199
047522             PERFORM 2000-PROCESS-TOSOPFA                         04752299
047523               UNTIL PS-END-OF-TOSOPFA-CSR-YES                    04752399
047524         ELSE                                                     04752499
047525             DISPLAY '** CC CURRENT OPER-UNT-ID 4 NOT FOUND ==> ' 04752599
047526                      CC-OPER-UNT-ID-CURR4-X                      04752699
047527         END-IF                                                   04752799
047528         PERFORM 7020-CLOSE-TOSOPFA-CSR                           04752899
047529                                                                  04752999
047530     ELSE                                                         04753094
047531* * *  JUST SKIP IF CURRENT AND NEW OPER-UNT-ID ARE ZERO          04753199
047532         IF  CC-OPER-UNT-ID-CURR4-X = '0000'  AND                 04753299
047533             CC-OPER-UNT-ID-NEW4-X  = '0000'                      04753399
047534             CONTINUE                                             04753494
047535         ELSE                                                     04753594
047536             DISPLAY '** CC OPER-UNT-ID 4 DATA INVALID'           04753699
047537             DISPLAY '** ' CC-OPER-UNT-ID-CURR4-X ' '             04753799
047538                           CC-OPER-UNT-ID-NEW4-X                  04753899
047539         END-IF                                                   04753999
047540     END-IF.                                                      04754099
047541*                                                                 04754199
047542     PERFORM 9000-DISPLAY-COUNTS                                  04754299
047543*                                                                 04754399
047550     CLOSE TOSOPFA-FILE-OUT.                                      04755099
047600     STOP RUN.                                                    04760004
047700*                                                                 04770004
048400******************************************************************04840004
048500 1000-INITIALIZE.                                                 04850004
048600     DISPLAY '**'.                                                04860099
048601     DISPLAY '** PROGRAM:  CNKUT814'.                             04860199
048602     DISPLAY '**'.                                                04860299
048610     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           04861013
048611     DISPLAY '** CONTROL CARD: '                                  04861199
048612             CC-CONTROL-CARD.                                     04861299
048613     DISPLAY '**'.                                                04861399
048620*                                                                 04862013
048700     OPEN OUTPUT TOSOPFA-FILE-OUT.                                04870099
048800*                                                                 04880004
049600******************************************************************04960004
049700 2000-PROCESS-TOSOPFA.                                            04970099
058600*                                                                 05860004
059400     MOVE PV-OPER-UNT-ID     TO OSOPFA-OPER-UNT-ID                05940099
059800*                                                                 05980089
061800     WRITE TOSOPFA-RECORD-OUT                                     06180099
061900      FROM DCLTOSOPFA.                                            06190099
061901                                                                  06190199
061910     ADD +1 TO PV-OUTPUT-CNT.                                     06191090
061920     EVALUATE TRUE                                                06192098
061930         WHEN PV-TOSOPFA-1                                        06193099
061940              ADD +1 TO PV-TOSOPFA-1-CNT                          06194099
061950         WHEN PV-TOSOPFA-2                                        06195099
061951              ADD +1 TO PV-TOSOPFA-2-CNT                          06195199
061952         WHEN PV-TOSOPFA-3                                        06195299
061953              ADD +1 TO PV-TOSOPFA-3-CNT                          06195399
061954         WHEN PV-TOSOPFA-4                                        06195499
061955              ADD +1 TO PV-TOSOPFA-4-CNT                          06195599
061960     END-EVALUATE                                                 06196098
062000*                                                                 06200004
062100     PERFORM 7010-FETCH-TOSOPFA-CSR.                              06210099
062200*                                                                 06220004
112000******************************************************************11200004
112100*  OPEN THE TOSOPFA_CSR                                           11210099
112200******************************************************************11220004
112300 7000-OPEN-TOSOPFA-CSR.                                           11230099
112400     EXEC SQL                                                     11240004
112500          OPEN TOSOPFA_CSR                                        11250099
112600     END-EXEC.                                                    11260004
112700*                                                                 11270004
112800     EVALUATE TRUE                                                11280004
112900         WHEN SQLCODE = ZERO                                      11290004
113000              CONTINUE                                            11300004
113100         WHEN OTHER                                               11310004
113200              MOVE '7000-OPEN-TOSOPFA-CSR'                        11320099
113300                                 TO PV-ABEND-PARAGRAPH            11330022
113400              MOVE PE-MSG-01     TO PV-DB2-OPERATION-ATTEMPTED    11340004
113500              PERFORM 9200-SQL-ABEND                              11350004
113600     END-EVALUATE.                                                11360004
113700*                                                                 11370004
113800*                                                                 11380004
113900******************************************************************11390004
114000*  FETCH THE NEXT TOSOPFA                                         11400099
114100******************************************************************11410004
114200 7010-FETCH-TOSOPFA-CSR.                                          11420099
114220                                                                  11422058
114300     EXEC SQL                                                     11430004
114301          FETCH TOSOPFA_CSR                                       11430199
114310           INTO :OSOPFA-OPER-SET-ID                               11431099
114320               ,:OSOPFA-OPER-ID                                   11432099
114330               ,:OSOPFA-OPER-UNT-ID                               11433099
114340               ,:OSOPFA-FCLTY-ID                                  11434099
114350               ,:OSOPFA-FCLTY-AREA-ID                             11435099
114360               ,:OSOPFA-PRC-FCLTY-AREA-ID                         11436099
114370               ,:OSOPFA-CRE-TMST                                  11437099
114380               ,:OSOPFA-VER-STATUS-CDE                            11438099
114390               ,:OSOPFA-CRE-UID-ID                                11439099
114400               ,:OSOPFA-SCRN-SEQ-NBR                              11440099
115400     END-EXEC.                                                    11540004
115500*                                                                 11550004
115600     EVALUATE TRUE                                                11560004
115700         WHEN SQLCODE = ZERO                                      11570004
115710              ADD +1 TO PV-TOSOPFA-CNT                            11571099
115800         WHEN SQLCODE = +100                                      11580004
115910              SET PS-END-OF-TOSOPFA-CSR-YES                       11591099
115920                                TO TRUE                           11592027
116000         WHEN OTHER                                               11600004
116020              PERFORM 9000-DISPLAY-COUNTS                         11602033
116030              EVALUATE TRUE                                       11603099
116040                  WHEN PV-TOSOPFA-1                               11604099
116050                       DISPLAY '*** OPER-UNT-ID '                 11605099
116051                                CC-OPER-UNT-ID-CURR1-X            11605199
116060                  WHEN PV-TOSOPFA-2                               11606099
116061                       DISPLAY '*** OPER-UNT-ID '                 11606199
116062                                CC-OPER-UNT-ID-CURR2-X            11606299
116080                  WHEN PV-TOSOPFA-3                               11608099
116090                       DISPLAY '*** OPER-UNT-ID '                 11609099
116091                                CC-OPER-UNT-ID-CURR3-X            11609199
116092                  WHEN PV-TOSOPFA-4                               11609299
116093                       DISPLAY '*** OPER-UNT-ID '                 11609399
116094                                CC-OPER-UNT-ID-CURR4-X            11609499
116095              END-EVALUATE                                        11609599
116096              MOVE OSOPFA-OPER-SET-ID  TO PV-DISPLAY-OPER-SET-ID  11609699
116097              MOVE OSOPFA-OPER-ID      TO PV-DISPLAY-OPER-ID      11609799
116098              DISPLAY '*** LAST GOOD FETCH: '                     11609899
116100              DISPLAY '*** ' PV-DISPLAY-OPER-SET-ID ' '           11610099
116101                             PV-DISPLAY-OPER-ID ' '               11610199
116103                             OSOPFA-FCLTY-AREA-ID ' '             11610399
116104                             OSOPFA-PRC-FCLTY-AREA-ID ' '         11610499
116105                             OSOPFA-CRE-TMST                      11610599
116110              MOVE '7010-FETCH-TOSOPFA-CSR'                       11611099
116200                                   TO PV-ABEND-PARAGRAPH          11620099
116300              MOVE PE-MSG-02       TO PV-DB2-OPERATION-ATTEMPTED  11630099
116400              PERFORM 9200-SQL-ABEND                              11640004
116500     END-EVALUATE.                                                11650004
116700*                                                                 11670004
141700******************************************************************14170004
141800*  CLOSE THE TOSOPFA_CSR                                          14180099
141900******************************************************************14190004
142000 7020-CLOSE-TOSOPFA-CSR.                                          14200099
142100     EXEC SQL                                                     14210004
142200          CLOSE TOSOPFA_CSR                                       14220099
142300     END-EXEC.                                                    14230004
142400*                                                                 14240004
142500     EVALUATE TRUE                                                14250004
142600         WHEN SQLCODE = ZERO                                      14260004
142700              CONTINUE                                            14270004
142800         WHEN OTHER                                               14280004
142900              MOVE '7020-CLOSE-TOSOPFA-CSR'                       14290099
143000                                 TO PV-ABEND-PARAGRAPH            14300004
143100              MOVE PE-MSG-03     TO PV-DB2-OPERATION-ATTEMPTED    14310024
143200              PERFORM 9200-SQL-ABEND                              14320004
143300     END-EVALUATE.                                                14330004
143400*                                                                 14340004
144700******************************************************************14470004
144800 9000-DISPLAY-COUNTS.                                             14480033
145100                                                                  14510004
145200     DISPLAY '********************************************'.      14520099
145201     DISPLAY '**                                        **'.      14520199
145202     DISPLAY '**  TOSOPFA                               **'.      14520299
145204     DISPLAY '**                                        **'.      14520499
145210     MOVE PV-TOSOPFA-CNT    TO PV-DISPLAY-CNT                     14521099
145300     DISPLAY 'TOSOPFA FETCHED ..............: ' PV-DISPLAY-CNT.   14530099
145310     MOVE PV-OUTPUT-CNT      TO PV-DISPLAY-CNT                    14531090
145400     DISPLAY 'OUTPUT RECORDS WRITTEN........: ' PV-DISPLAY-CNT.   14540099
145410     DISPLAY '**                                        **'.      14541099
145500     MOVE PV-TOSOPFA-1-CNT   TO PV-DISPLAY-CNT                    14550099
145501     DISPLAY 'OPER-UNT-ID 1 RECORDS WRITTEN-: ' PV-DISPLAY-CNT.   14550199
145502     MOVE PV-TOSOPFA-2-CNT   TO PV-DISPLAY-CNT                    14550299
145503     DISPLAY 'OPER-UNT-ID 2 RECORDS WRITTEN-: ' PV-DISPLAY-CNT.   14550399
145504     MOVE PV-TOSOPFA-3-CNT   TO PV-DISPLAY-CNT                    14550499
145505     DISPLAY 'OPER-UNT-ID 3 RECORDS WRITTEN-: ' PV-DISPLAY-CNT.   14550599
145506     MOVE PV-TOSOPFA-4-CNT   TO PV-DISPLAY-CNT                    14550699
145507     DISPLAY 'OPER-UNT-ID 4 RECORDS WRITTEN-: ' PV-DISPLAY-CNT.   14550799
145508     DISPLAY '**                                        **'.      14550899
145510     DISPLAY '********************************************'.      14551037
146700*                                                                 14670004
146800******************************************************************14680004
146900*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    14690004
147000*  ERROR OR WARNING CODE OCCURS.                                  14700004
147100******************************************************************14710004
147200 9200-SQL-ABEND.                                                  14720004
147300     DISPLAY '9200-SQL-ABEND'.                                    14730004
147400     DISPLAY '** ABEND     **'.                                   14740004
147500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        14750004
147600     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             14760004
147700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     14770004
147800*                                                                 14780004
147900*                                                                 14790004
148000******************************************************************14800004
148100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    14810004
148200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         14820004
148300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     14830004
148400* FORMAT.                                                         14840004
148500******************************************************************14850004
148600     COPY DPPD004.                                                14860004
148700                                                                  14870004
148800     IF  SQLCODE NOT = -911                                       14880004
148900         EXEC SQL                                                 14890004
149000              COMMIT                                              14900004
149100         END-EXEC                                                 14910004
149200     END-IF.                                                      14920004
149300                                                                  14930004
149400     MOVE +4013                  TO PV-ABEND-CODE.                14940004
149500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         14950004
