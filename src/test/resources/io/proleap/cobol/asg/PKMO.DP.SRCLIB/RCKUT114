000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400 PROGRAM-ID.    RCKUT114.                                         00040001
000500 AUTHOR.        PATRICK BURKE.                                    00050001
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN   AUGUST 2001.                                      00070001
000800 DATE-COMPILED.                                                   00080001
000900***************************************************************** 00090001
001000* THIS PROGRAM IS TO DETERMINE IF THERE ARE ANY STORES SET-UP   * 00100001
001100* FOR THE CREATION OF THE VERIFIED UNITS REPORT (RCKRP035).     * 00110001
001200* IF THERE ARE NO STORES SET-UP FOR THIS RUN OF THE REPORT,     * 00120001
001300* THEN THE JOB WILL BE SET UP TO GET A RETURN CODE FROM THE     * 00130001
001400* PROGRAM.*                                                       00140001
001500***************************************************************** 00150001
001600 ENVIRONMENT DIVISION.                                            00160001
001700***************************************************************** 00170001
001800 INPUT-OUTPUT SECTION.                                            00180001
001900*                                                                 00190001
002000 FILE-CONTROL.                                                    00200001
002100*                                                                 00210001
002200***************************************************************** 00220001
002300 DATA DIVISION.                                                   00230001
002400***************************************************************** 00240001
002500 FILE SECTION.                                                    00250001
002600*                                                                 00260001
002700***************************************************************** 00270001
002800 WORKING-STORAGE SECTION.                                         00280001
002900***************************************************************** 00290001
003000                                                                  00300001
003100**************************************************************    00310001
003200* FORMAT OF THE CONTROL CARD INFORMATION PASSED INTO THE PGM *    00320001
003300**************************************************************    00330001
003400 01  CC-CONTROL-CARD.                                             00340001
003500     05  CC-RUN-TYPE                  PIC  X(01).                 00350001
003600          88  CC-RUN-DAILY                       VALUE 'D'.       00360001
003700          88  CC-RUN-WEEKLY                      VALUE 'W'.       00370001
003800     05  FILLER                       PIC  X(79) VALUE SPACES.    00380001
003900                                                                  00390001
004000                                                                  00400001
004100 01  PS-PROGRAM-SWITCHES.                                         00410001
004200     05  PS-RETURN-DATA-SW            PIC X(01)  VALUE 'N'.       00420001
004300         88  PS-RETURN-DATA                      VALUE 'Y'.       00430001
004400         88  PS-NO-RETURN-DATA                   VALUE 'N'.       00440001
004500*                                                                 00450001
004600                                                                  00490001
004700 01  PV-PROGRAM-VARIABLES.                                        00500001
004800*                                                                 00610001
004900     05  PV-STORE                     PIC S9(04)    COMP.                 
005000     05  PV-PRC-FUNC-CDE              PIC X(06).                  00620001
005100*                                                                 00630001
005200     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      00640001
005300*                                                                 00650001
005400                                                                  00980001
005500 01  PV-ABEND-FIELDS.                                             00990001
005600     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01000001
005700                                                 COMP SYNC.       01010001
005800     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'RCKUT114'.01020001
005900     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01030001
006000     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01040001
006100******************************************************************01050001
006200*  USED FOR DB2 ERROR MESSAGE BUILDING                            01060001
006300******************************************************************01070001
006400     COPY DPWS004.                                                01080009
006500                                                                  01090001
006600******************************************************************01100001
006700*   DB2 SQL COMMUNICATION AREA                                    01110001
006800******************************************************************01120001
006900     EXEC SQL                                                     01130001
007000          INCLUDE SQLCA                                           01140001
007100     END-EXEC.                                                    01150001
007200                                                                  01160001
007300******************************************************************01170001
007400*   DB2 DCLGEN                                                    01180001
007500******************************************************************01190001
007600     EXEC SQL                                                     01200001
007700          INCLUDE TKRPRPM                                         01210001
007800     END-EXEC.                                                    01220001
007900*                                                                 01230001
008000                                                                  01240001
008100 EJECT                                                            01250001
008200***********************************************************       01260001
008300 PROCEDURE DIVISION.                                              01270001
008400***********************************************************       01280001
008500                                                                  01290001
008600     DISPLAY '**************************************'.            01300001
008700     DISPLAY '*        PROGRAM - RCKUT114          *'.            01310001
008800     DISPLAY '**************************************'.            01320001
008900     DISPLAY '                                      '.            01330001
009000                                                                  01340001
009100     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           01350001
009200     DISPLAY 'CONTROL CARD = ' CC-CONTROL-CARD.                   01360001
009300                                                                  01370001
009400     EVALUATE TRUE                                                01380001
009500                                                                  01390001
009600       WHEN CC-RUN-DAILY                                          01400007
009700          MOVE 'VRFRPD'      TO  PV-PRC-FUNC-CDE                  01410007
009800                                                                  01420001
009900       WHEN CC-RUN-WEEKLY                                         01430006
010000          MOVE 'VRFRPW'      TO  PV-PRC-FUNC-CDE                  01440006
010100                                                                  01450001
010200     END-EVALUATE.                                                01460001
010300*                                                                 01470001
010400     PERFORM 1500-SELECT-TKRPRPM.                                 01480001
010500        IF PS-RETURN-DATA                                         01490001
010600          CONTINUE                                                01500001
010700        ELSE                                                      01510001
010800          MOVE 1 TO RETURN-CODE.                                  01520005
010900*                                                                 01530005
011000     PERFORM 9000-EOJ-ROUTINE.                                    01540001
011100*                                                                 01550001
011200     GOBACK.                                                      01560001
011300*                                                                 01570001
011400***************************************************************** 01580001
011500 1500-SELECT-TKRPRPM.                                             01590001
011600***************************************************************** 01600001
011700*                                                                 01610001
011800     EXEC SQL                                                     01620001
011900          SELECT A.LOC_ID                                         01630001
012000            INTO :PV-STORE                                        01640001
012100          FROM   TKRPRPM A                                        01650001
012200          WHERE  A.INTFC_SYS_CDE     = 'KHL'                      01660001
012300            AND  A.SYS_PRC_FUNC_CDE  =  :PV-PRC-FUNC-CDE          01670001
012400            AND  A.FUNC_PRC_STAT_CDE = 'AC'                       01680001
012500            AND  A.FUNC_TXT          = 'Y'                        01690001
012600                                                                  01700001
012700     END-EXEC.                                                    01710001
012800                                                                  01720001
012900         EVALUATE TRUE                                            01730001
013000             WHEN SQLCODE = ZERO                                  01740001
013100             WHEN SQLCODE = -811                                  01750001
013200                 SET PS-RETURN-DATA        TO TRUE                01760001
013300             WHEN SQLCODE = +100                                  01770001
013400                 SET PS-NO-RETURN-DATA     TO TRUE                01780001
013500             WHEN SQLWARN0 NOT = SPACES                           01790001
013600             WHEN SQLCODE  NOT = ZERO                             01800001
013700                  MOVE '1500-SELECT-TKRPRPM'                      01810001
013800                                TO PV-ABEND-PARAGRAPH             01820001
013900                  MOVE 'MAX RETRIES EXCEEDED'                     01830001
014000                                TO PV-ABEND-OPERATION             01840001
014100                  PERFORM Z999-SQL-ABEND                          01850001
014200*                                                                 01860001
014300         END-EVALUATE.                                            01870001
014400*                                                                 01880001
014500***************************************************************** 01890001
014600 9000-EOJ-ROUTINE.                                                01900001
014700***************************************************************** 01910001
014800*                                                                 01920001
014900*                                                                 01930001
015000      DISPLAY '***END RCKUT114***'.                               01940004
015100*                                                                 01950001
015200***************************************************************** 01960001
015300 Z999-SQL-ABEND.                                                  01970001
015400***************************************************************** 01980001
015500                                                                  01990001
015600     MOVE SQLCODE TO PV-SQLCODE.                                  02000001
015700     DISPLAY '*** DB2 ERROR '.                                    02010001
015800     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02020001
015900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02030001
016000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02040001
016100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02050001
016200                                                                  02060001
016300     COPY DPPD004.                                                02070009
016400                                                                  02080001
016500                                                                  02090001
016600     MOVE +4013                  TO PV-ABEND-CODE.                02100001
016700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02110001
016800***************************************************************** 02120001
016900 9999-ABORT.                                                      02130001
017000***************************************************************** 02140001
017100                                                                  02150001
017200      DISPLAY 'PV-ABEND-CODE = ' PV-ABEND-CODE                    02160001
017300      CALL 'ILBOABN0'   USING PV-ABEND-CODE.                      02170001
017400                                                                  02180001
