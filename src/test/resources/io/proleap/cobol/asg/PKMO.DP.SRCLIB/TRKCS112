000010 IDENTIFICATION DIVISION.                                         00001000
000020 PROGRAM-ID.    TRKCS112.                                         00002000
000030 AUTHOR.        TOM RUSKA. G&R.                                   00003000
000040 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00004000
000050 DATE-WRITTEN.  11-19-93.                                         00005000
000060 DATE-COMPILED.                                                   00006000
000070                                                                  00007000
000080*---------------------------------------------------------------* 00008000
000090*    TRANID      - Y112                                         * 00009000
000100*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * 00010000
000110*    DESCRIPTION - MAINTAIN TRAILER/TRIP                        * 00011000
000120*    MAPSET      - TRKM112                                      * 00012000
000130*                                                               * 00013000
000140*    THIS PROGRAM WILL SETUP AND MAINTAIN TRAILERS AND/OR TRIPS.* 00014000
000150*                                                               * 00015000
000160*---------------------------------------------------------------* 00016000
000161* 2011-12-14 CHRISTINE TWIEHAUS WR40574                          *00016168
000162*            ADDING CAN (CARR-AUTH-ID) TO TSHIPMT AND TAUSHIP    *00016268
000164*----------------------------------------------------------------*00016468
000165* 2014-10-27 CHERI PARMLEY      CHG0094517                       *00016583
000172*            COMPILE ONLY CHANGE TO COPYBOOK TRWS001 EXPANDING   *00017283
000173*            PO# TO 9 DIGITS.                                    *00017383
000174*----------------------------------------------------------------*00017483
273427* CHANGED 08/16/2022    BY BARB SCHULTZ    WR: CHG0273427        *00017595
273427* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE    *00017695
273427* MAKING THE CALL DYNAMIC VS STATIC.                             *00017795
000174*----------------------------------------------------------------*00017894
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495         00017996
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00018096
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00018196
CICS  *-----------------------------------------------------------------00018296
000180 ENVIRONMENT DIVISION.                                            00018300
000190 DATA DIVISION.                                                   00019000
000200                                                                  00020000
000210/                                                                 00021000
000220 WORKING-STORAGE SECTION.                                         00022000
000230                                                                  00023000
000240 01  DN-NULL-INDICATORS.                                          00024000
000250     05  DN-VEH-NBR                   PIC S9(4) COMP VALUE +0.    00025000
000260     05  DN-SUBAREA-OF-ID             PIC S9(4) COMP VALUE +0.    00026000
000270     05  DN-CURR-TRIP-ID              PIC S9(4) COMP VALUE +0.    00027000
000280     05  DN-EST-AR-TMST               PIC S9(4) COMP VALUE +0.    00028000
000290     05  DN-SEAL-COND-CDE             PIC S9(4) COMP VALUE +0.    00029000
000300     05  DN-INSPECT-DTE               PIC S9(4) COMP VALUE +0.    00030000
000310     05  DN-INSPECT-TME               PIC S9(4) COMP VALUE +0.    00031000
000320     05  DN-INSPECTOR-NAME            PIC S9(4) COMP VALUE +0.    00032000
000330     05  DN-TRIP-ID                   PIC S9(4) COMP VALUE +0.    00033000
000340     05  DN-SHIP-EST-AR-TMST          PIC S9(4) COMP VALUE +0.    00034000
000350                                                                  00035000
000360 01  DK-DB2-KEYS.                                                 00036000
000370     05  DK-OPER-UNT-ID               PIC S9(04) VALUE +0         00037000
000380                                                 COMP.            00038000
000390     05  DK-FCLTY-ID                  PIC S9(04) VALUE +0         00039000
000400                                                 COMP.            00040000
000410     05  DK-PLND-TRIP-SEQ             PIC S9(04) VALUE +0         00041000
000420                                                 COMP.            00042000
000430     05  DK-STR-NBR                   PIC S9(04) VALUE ZERO       00043000
000440                                                 COMP.            00044000
000450     05  DK-FCLTY-AREA-ID             PIC  X(06) VALUE SPACES.    00045000
000460     05  DK-SUBAREA-OF-ID             PIC  X(06) VALUE SPACES.    00046000
000470     05  DK-VEH-NBR                   PIC  X(10) VALUE SPACES.    00047000
000480     05  DK-OWNER-SCAC-ID             PIC  X(04) VALUE SPACES.    00048000
000490     05  DK-TRIP-ID                   PIC S9(09) VALUE +0         00049000
000500                                                 COMP.            00050000
000510     05  DK-SHIPT-ID                  PIC S9(09) VALUE +0         00051000
000520                                                 COMP.            00052000
000530     05  DK-FCLTY-LOC-TYP-CDE-1       PIC  X(02) VALUE SPACES.    00053000
000540     05  DK-FCLTY-LOC-TYP-CDE-2       PIC  X(02) VALUE SPACES.    00054000
000550     05  DK-TRIP-STATUS-CDE           PIC  X(02) VALUE SPACES.    00055000
000560     05  DK-SEAL-NBR                  PIC  X(15) VALUE SPACES.    00056000
000570     05  DK-ETA-DTE                   PIC  X(10) VALUE SPACES.    00057000
000580     05  DK-ETA-TIME                  PIC  X(08) VALUE SPACES.    00058000
000590                                                                  00059000
000600 01  PC-PROGRAM-CONSTANTS.                                        00060000
000610     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00061000
000620                                                    'TR112A  '.   00062000
000630     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00063000
000640                                                    'TRKM112 '.   00064000
000650     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00065000
000660                                                    COMP.         00066000
000670     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00067000
000680                                                    'TRKCS112'.   00068000
000690     05  PC-RANDNBR-PGM                 PIC X(08)   VALUE         00069000
000700                                                    'DPKUT902'.   00070000
000730     05  PC-TMKCS520                    PIC X(08)   VALUE         00073000
000740                                                    'TMKCS520'.   00074000
000750                                                                  00075008
000760     05  PC-INTER-APPL-CODES.                                     00076009
000770         10  PC-INTER-APPL-CRIT-SPEC    PIC  X(01)  VALUE '1'.    00077009
000780         10  PC-INTER-APPL-CRIT-ADD     PIC  X(01)  VALUE '2'.    00078009
000790         10  PC-INTER-APPL-UPDATE       PIC  X(01)  VALUE '3'.    00079009
000800         10  PC-INTER-APPL-DELETE       PIC  X(01)  VALUE '4'.    00080009
000810         10  PC-INTER-APPL-PARKING-LIST PIC  X(01)  VALUE '6'.    00081009
000820         10  PC-INTER-APPL-LIST-ADD     PIC  X(01)  VALUE '7'.    00082009
000830         10  PC-INTER-APPL-ADD-TO-UPD   PIC  X(01)  VALUE '8'.    00083009
000840         10  PC-INTER-APPL-FCST-UPD     PIC  X(01)  VALUE '9'.    00084009
000850         10  PC-INTER-APPL-TRLR-SPEC    PIC  X(01)  VALUE 'A'.    00085009
000860         10  PC-INTER-APPL-RC-LIST      PIC  X(01)  VALUE 'B'.    00086009
000870     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00087009
000880                                                    COMP-3.       00088009
000890     05  PC-ZERO                        PIC S9(04)  VALUE +0      00089009
000900                                                    COMP.         00090009
000910     05  PC-24                          PIC  9(02)  VALUE 24.     00091009
000920     05  PC-59                          PIC  9(02)  VALUE 59.     00092009
000930     05  PC-997                         PIC S9(04)  VALUE +997    00093009
000940                                                    COMP.         00094009
000950     05  PC-998                         PIC S9(04)  VALUE +998    00095009
000960                                                    COMP.         00096009
000970     05  PC-999                         PIC S9(04)  VALUE +999    00097009
000980                                                    COMP.         00098009
000990     05  PC-I                           PIC  X(01)  VALUE 'I'.    00099009
001000     05  PC-N                           PIC  X(01)  VALUE 'N'.    00100009
001010     05  PC-SPACES                      PIC  X(22)  VALUE  SPACES.00101009
001020     05  PC-DEFAULT-DATE              PIC X(10)  VALUE            00102009
001030                                                 '0001-01-01'.    00103009
001040     05  PC-DEFAULT-TIME              PIC X(08)  VALUE            00104009
001050                                                 '00.00.00'.      00105009
001060     05  PC-MSG-VAR-SYMBOLIC            PIC X(04) VALUE '&VAR'.   00106009
001070     05  PC-CREATE-AUTO-MSG             PIC X(42) VALUE           00107009
001080         'CREATED AUTOMATICALLY WHEN TRAILER ARRIVED'.            00108009
001090     05  PC-RESOLVE-AUTO-MSG             PIC X(43) VALUE          00109009
001100         'RESOLVED AUTOMATICALLY WHEN TRAILER ARRIVED'.           00110009
001110                                                                  00111009
001120     05  PC-AUTOVE-MODULE           PIC  X(08) VALUE 'RCKUT127'.  00112009
001130     05  PC-AUTOVE-MODULE-LENGTH    PIC S9(04) VALUE  +400        00113009
001140                                                    COMP SYNC.    00114009
001141                                                                  00114188
001142     05  PC-E838-RPAMSD                 PIC  X(04) VALUE 'E838'.  00114288
001150                                                                  00115088
001151                                                                  00115188
001160     05  PC-TSYMSG-NUMBERS.                                       00116009
001170         10  PC-TSYMSG-00004            PIC  9(05)  VALUE  00004. 00117009
001180*  PRESS F2 TO CONFIRM REQUEST                                    00118009
001190         10  PC-TSYMSG-00005            PIC  9(05)  VALUE  00005. 00119009
001200*  INVALID VALUE                                                  00120009
001210         10  PC-TSYMSG-00007            PIC  9(05)  VALUE  00007. 00121009
001220*  REQUIRED ENTRY                                                 00122009
001230         10  PC-TSYMSG-00008            PIC  9(05)  VALUE  00008. 00123009
001240*  MUST BE NUMERIC                                                00124009
001250         10  PC-TSYMSG-00009            PIC  9(05)  VALUE  00009. 00125009
001260*  INVALID DATE                                                   00126009
001270         10  PC-TSYMSG-00034            PIC  9(05)  VALUE  00034. 00127009
001280*  ADD SUCCESSFUL                                                 00128009
001290         10  PC-TSYMSG-00046            PIC  9(05)  VALUE  00046. 00129009
001300*  DATA NOT CHANGED; NO UPDATE PERFORMED                          00130009
001310         10  PC-TSYMSG-00057            PIC  9(05)  VALUE  00057. 00131009
001320*  A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION                 00132009
001330         10  PC-TSYMSG-00059            PIC  9(05)  VALUE  00059. 00133009
001340*  UPDATE(S) SUCCESSFUL                                           00134009
001350         10  PC-TSYMSG-00069            PIC  9(05)  VALUE  00069. 00135009
001360*  TOP OF LIST                                                    00136009
001370         10  PC-TSYMSG-00070            PIC  9(05)  VALUE  00070. 00137009
001380*  BOTTOM OF LIST                                                 00138009
001390         10  PC-TSYMSG-00115            PIC  9(05)  VALUE  00115. 00139009
001400*  DELETE SUCCESSFUL                                              00140009
001410         10  PC-TSYMSG-00116            PIC  9(05)  VALUE  00116. 00141009
001420*  CANNOT DELETE - RECORD DOES NOT EXIST                          00142009
001430         10  PC-TSYMSG-00117            PIC  9(05)  VALUE  00117. 00143009
001440*  CANNOT ADD - RECORD ALREADY EXISTS                             00144009
001450         10  PC-TSYMSG-00148            PIC  9(05)  VALUE  00148. 00145009
001460*  DATA DOES NOT EXIST                                            00146009
001470         10  PC-TSYMSG-00646            PIC  9(05)  VALUE  00646. 00147009
001480*  TRAILER CAN NOT RETURN TO THIS STATUS                          00148009
001490         10  PC-TSYMSG-00647            PIC  9(05)  VALUE  00647. 00149009
001500*  TRAILER HAS NOT BEGUN UNLOADING                                00150009
001510         10  PC-TSYMSG-00651            PIC  9(05)  VALUE  00651. 00151009
001520*  TRAILER HAS NOT BEGUN UNLOADING                                00152009
001530         10  PC-TSYMSG-00714            PIC  9(05)  VALUE  00714. 00153009
001540*  LOCATION CURRENTLY OCCUPIED                                    00154009
001550         10  PC-TSYMSG-00715            PIC  9(05)  VALUE  00715. 00155009
001560*  CAN NOT DELETE ETA DATE                                        00156009
001570         10  PC-TSYMSG-00743            PIC  9(05)  VALUE  00743. 00157009
001580*  TRIP DOES NOT EXIST                                            00158009
001590         10  PC-TSYMSG-00747            PIC  9(05)  VALUE  00747. 00159009
001600*  CANNOT DELETE A TRIP WITH THIS STATUS                          00160009
001610         10  PC-TSYMSG-00751            PIC  9(05)  VALUE  00751. 00161009
001620*  MUST ASSUME AN 'EN' OR 'AR' STATUS                             00162009
001630         10  PC-TSYMSG-00769            PIC  9(05)  VALUE  00769. 00163009
001640*  ABOUT TO ADD ANOTHER STOP TO TRIP                              00164009
001650         10  PC-TSYMSG-00803            PIC  9(05)  VALUE  00803. 00165009
001660*  INSUFFICIENT TRIP INFO; CANNOT PERFORM THE REQUESTED FUNCTION  00166009
001670         10  PC-TSYMSG-00988            PIC  9(05)  VALUE  00988. 00167009
001680*  TRAILER ALREADY HAS A TRIP ATTACHED TO IT                      00168009
001690         10  PC-TSYMSG-01058            PIC  9(05)  VALUE  01058. 00169009
001700*  THE FREIGHT BILL IS MISSING ON THIS RECEIVER                   00170009
001710         10  PC-TSYMSG-01076            PIC  9(05)  VALUE  01076. 00171009
001720*  TRAILER HAS TO BE ARRIVED BEFORE IT CAN BE DEPARTED            00172009
001730         10  PC-TSYMSG-01228            PIC  9(05)  VALUE  01228. 00173009
001740*  DATE ENTERED CAN BE UP TO &VAR DAYS PRIOR TO THE CURRENT DATE  00174009
001750         10  PC-TSYMSG-01497            PIC  9(05)  VALUE  01497. 00175009
001760*  UPDATE(S) SUCCESSFUL - ETA DATE IS EARLIER THAN TODAYS DATE    00176009
001770         10  PC-TSYMSG-01666            PIC  9(05)  VALUE  01666. 00177009
001780*  UPDATE SUCCESSFUL, XXXX STORAGE TROUBLES RESOLVED              00178009
001790         10  PC-TSYMSG-01667            PIC  9(05)  VALUE  01667. 00179009
001800*  UPDATE SUCCESSFUL, XXXX STORAGE TRBLS RESLVD AND ON-SITE       00180009
001810*  STORAGE CREATED                                                00181009
001820         10  PC-TSYMSG-01668            PIC  9(05)  VALUE  01668. 00182009
001830*  TRAILER ARRIVED, BUT UNABLE TO RESOLVE/CREATE TRBLE - MUST     00183009
001840*  DO MANUALLY                                                    00184009
001850         10  PC-TSYMSG-01669            PIC  9(05)  VALUE  01669. 00185009
001860*  TRAILER ARRIVED, BUT ERROR IN TROUBLE PROCESSING - CONTACT     00186009
001870*  SYSTEMS                                                        00187009
001880         10  PC-TSYMSG-03103            PIC  9(05)  VALUE  03103. 00188009
001890*  UNABLE TO DEPART TRAILER - UNRESOLVED FREE-ASTRAYS EXIST       00189009
001900         10  PC-TSYMSG-00984            PIC  9(05)  VALUE  00984. 00190009
001910*  AN ERROR OCCURRED DETERMINING F-KEY ELIGIBILITY - CONTACT SUPER00191009
001920         10  PC-TSYMSG-03138            PIC  9(05)  VALUE  03138. 00192009
001930*  STATUS UPDATE NOT ALLOWED FOR TRAILER WITH AUTO-VE RECEIVER(S) 00193009
001940         10  PC-TSYMSG-03217            PIC  9(05)  VALUE  03217. 00194009
001950*  TRAILER CONTAINS AUTO VE RECEIVER, MUST BE ARRIVED PRIOR TO DEP00195009
001960         10  PC-TSYMSG-03247            PIC  9(05)  VALUE  03247. 00196009
001961*  DC IS LIVE ON WMOS - CAN ONLY CHANGE TRIP STATUS TO DEPARTED   00196136
001962         10  PC-TSYMSG-03577            PIC  9(05)  VALUE  03577. 00196237
001963*  DC IS LIVE ON WMS - SHIPMENTS ATTACHED TO TRLR - UNABLE TO DEPA00196344
001964         10  PC-TSYMSG-03579            PIC  9(05)  VALUE  03579. 00196444
001965* * UNABLE TO CHANGE CURR LOC - NEW CURR LOC TURNED ON FOR WMS.   00196564
001966         10  PC-TSYMSG-03583            PIC  9(05)  VALUE  03583. 00196664
001967*  UNABLE TO UPDATE TRLR NBR,SCAC OR OPER UNITS -DC TURNED TO WMS 00196744
001968         10  PC-TSYMSG-03585            PIC  9(05)  VALUE  03585. 00196844
001969         10  PC-TSYMSG-03705            PIC  9(05)  VALUE  03705. 00196974
001970*  CANNOT DEPART TRAILER - %VAR PRO NUMBERS HAVE NOT BEEN ENTERED 00197074
001971*** START PRB0057005                                              00197184
001973         10  PC-TSYMSG-03774            PIC  9(05)  VALUE  03774. 00197386
001974*  TRAILER HAS TO BE ARRIVED BEFORE IT CAN BE UNLOADED            00197486
001975*** END PRB0057005                                                00197584
001976/                                                                 00197609
001980 01  PS-PROGRAM-SWITCHES.                                         00198009
001990     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00199009
002000         88  PS-NO-ERROR                            VALUE 'Y'.    00200009
002010         88  PS-ERROR                               VALUE 'N'.    00201009
002020     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00202009
002030         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00203009
002040         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00204009
002050     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00205009
002060         88  PS-DONE                                VALUE 'Y'.    00206009
002070         88  PS-NOT-DONE                            VALUE 'N'.    00207009
002080     05  PS-SEAL-CURSOR-SW              PIC  X(01)  VALUE 'N'.    00208009
002090         88  PS-NO-MORE-SEALS                       VALUE 'Y'.    00209009
002100     05  PS-SHIPMENT-CURSOR-SW          PIC  X(01)  VALUE 'N'.    00210009
002110         88  PS-NO-MORE-SHIPMENTS                   VALUE 'Y'.    00211009
002120     05  PS-NO-MORE-RECEIVRS-SW         PIC  X(01)  VALUE 'N'.    00212009
002130         88  PS-NO-MORE-RECEIVRS                    VALUE 'Y'.    00213009
002140     05  PS-NO-MORE-TRIPST-SW           PIC  X(01)  VALUE 'N'.    00214009
002150         88  PS-NO-MORE-TRIPST                      VALUE 'Y'.    00215009
002160     05  PS-TRIP-SW                     PIC  X(01)  VALUE 'N'.    00216009
002170         88  PS-START-OF-TRIPS                      VALUE 'N'.    00217009
002180         88  PS-END-OF-TRIPS                        VALUE 'Y'.    00218009
002190     05  PS-ETA-TIME-SW                 PIC  X(01)  VALUE 'N'.    00219009
002200         88  PS-ETA-TIME-NOT-VALID                  VALUE 'N'.    00220009
002210         88  PS-ETA-TIME-VALID                      VALUE 'Y'.    00221009
002220     05  PS-UPDATE-REC-SW               PIC  X(01)  VALUE 'N'.    00222009
002230         88  PS-UPDATE-REC                          VALUE 'Y'.    00223009
002240         88  PS-NO-UPDATE-REC                       VALUE 'N'.    00224009
002250     05  PS-ETA-DATE-SW                 PIC  X(01)  VALUE 'N'.    00225009
002260         88  PS-ETA-DATE-VALID                      VALUE 'Y'.    00226009
002270         88  PS-ETA-DATE-NOT-VALID                  VALUE 'N'.    00227009
002280     05  PS-SPACE-ERROR-SW              PIC X(01)   VALUE 'N'.    00228009
002290         88  PS-SPACE-ERROR                         VALUE 'Y'.    00229009
002300     05  PS-CHANGE-SCAC-VEHICLE-SW      PIC X(01)   VALUE 'N'.    00230009
002310         88  PS-CHANGE-SCAC-VEHICLE                 VALUE 'Y'.    00231009
002320         88  PS-DONT-CHANGE-SCAC-VEHICLE            VALUE 'N'.    00232009
002330     05  PS-DISPLAY-ERROR-SW            PIC  X(01)  VALUE 'N'.    00233009
002340         88  PS-DISPLAY-ERROR                       VALUE 'Y'.    00234009
002350         88  PS-DONT-DISPLAY-ERROR                  VALUE 'N'.    00235009
002360     05  PS-ETA-DATE-WARNING-SW         PIC  X(01)  VALUE 'N'.    00236009
002370         88  PS-NO-ETA-WARNING                      VALUE 'N'.    00237009
002380         88  PS-ETA-WARNING                         VALUE 'Y'.    00238009
002390     05  PS-UPDATE-TIMPORL-SW           PIC  X(01)  VALUE 'N'.    00239009
002400         88  PS-UPDATE-TIMPORL                      VALUE 'Y'.    00240009
002410         88  PS-DONT-UPDATE-TIMPORL                 VALUE 'N'.    00241009
002420     05  PS-SHPTPO-CURSOR-SW            PIC  X(01)  VALUE 'N'.    00242009
002430         88  PS-NO-MORE-SHPTPO                      VALUE 'Y'.    00243009
002440     05  PS-TRBL-CREATED-SW             PIC  X(01)  VALUE 'N'.    00244009
002450         88  PS-NO-TRBL-CREATED-ONSITE              VALUE 'N'.    00245009
002460         88  PS-TRBL-CREATED-ONSITE                 VALUE 'Y'.    00246009
002470     05  PS-MORE-STOPS-SCHEDULED-SW     PIC  X(01)  VALUE 'N'.    00247009
002480         88  PS-NO-MORE-STOPS-SCHEDULED             VALUE 'N'.    00248009
002490         88  PS-MORE-STOPS-SCHEDULED                VALUE 'Y'.    00249009
002500     05  PS-TRBL-ACCESS-TRBL-SW         PIC  X(01)  VALUE 'N'.    00250009
002510         88  PS-NO-TRBL-ACCESS-TRBL                 VALUE 'N'.    00251009
002520         88  PS-TRBL-ACCESS-TRBL-W                  VALUE 'W'.    00252009
002530         88  PS-TRBL-ACCESS-TRBL-F                  VALUE 'F'.    00253009
002540     05  PS-DC-PLANNING-PARM-SW         PIC  X(01)  VALUE 'N'.    00254014
002550         88  PS-DC-PLANNING-YES                     VALUE 'Y'.    00255014
002560         88  PS-DC-PLANNING-NO                      VALUE 'N'.    00256014
002561* JAK 04/2007 - ADD ASN SWITCH                                    00256129
002562     05  PS-ASNS-TO-WMS-SW              PIC  X(01)  VALUE 'N'.    00256226
002563         88  PS-ASNS-TO-WMS-YES                     VALUE 'Y'.    00256326
002564         88  PS-ASNS-TO-WMS-NO                      VALUE 'N'.    00256426
002565     05  PS-AR-TRIPST-SW                PIC  X(01)  VALUE 'N'.    00256540
002566         88  PS-AR-TRIPST-YES                       VALUE 'Y'.    00256640
002567         88  PS-AR-TRIPST-NO                        VALUE 'N'.    00256740
002570                                                                  00257009
002580 01  PV-PROGRAM-VARIABLES.                                        00258009
002590     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      00259009
002600                                                    COMP SYNC.    00260009
002610     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      00261009
002620                                                    COMP SYNC.    00262009
002630     05  PV-TRBL-RETRY-COUNTER          PIC S9(04)  VALUE +0      00263009
002640                                                    COMP SYNC.    00264009
002650     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      00265009
002660                                                    COMP-3.       00266009
002661     05  PV-DB2-COUNT-SHIPS             PIC S9(09)  VALUE +0      00266143
002662                                                    COMP-3.       00266243
002663     05  PV-DB2-COUNT-NON-AP-RCVRS      PIC S9(09)  VALUE +0      00266364
002664                                                    COMP-3.       00266443
002670     05  PV-VHTRIP-COUNT                PIC S9(09)  VALUE +0      00267009
002680                                                    COMP-3.       00268009
002681     05  PV-DISP-COUNT                  PIC  9(04).               00268177
002690     05  PV-ABSTIME                     PIC S9(15)  COMP.         00269009
002700     05  PV-CURRENT-TIME                PIC  9(06).               00270009
002710     05  PV-CURRENT-DATE                PIC  9(06).               00271009
002720     05  PV-SAVE-TRIP-ID                PIC S9(09)  VALUE +0      00272009
002730                                                    COMP.         00273009
002740     05  PV-NEXT-TRIP-ID                PIC S9(09)  VALUE +0      00274009
002750                                                    COMP.         00275009
002760     05  PV-CURR-TRIP-ID                PIC S9(09)  VALUE +0      00276009
002770                                                    COMP.         00277009
002780     05  PV-TRIP-PRTY-CDE               PIC X(02).                00278009
002790     05  PV-TRIP-PRTY-CDE-N REDEFINES                             00279009
002800         PV-TRIP-PRTY-CDE               PIC 9(02).                00280009
002810     05  PV-TRIP-STATUS-CDE             PIC  X(02).               00281009
002820     05  PV-SAVE-PLND-TRIP-SEQ          PIC S9(04) VALUE +0       00282009
002830                                                 COMP.            00283009
002840     05  PV-SAVE-OWNER-SCAC-ID          PIC X(04).                00284009
002850     05  PV-SAVE-VEH-NBR                PIC X(10).                00285009
002860     05  PV-SAVE-USAGE-CDE              PIC X(03).                00286009
002870                                                                  00287009
002880     05  PV-SAVE-VEH-SIZE-CDE           PIC X(02).                00288009
002890     05  PV-SAVE-CURR-FAC-AREA-ID       PIC X(06).                00289009
002900     05  PV-SAVE-CURR-OPER-UNT-ID       PIC X(04).                00290009
002910     05  PV-SAVE-CURR-FCLTY-ID          PIC X(04).                00291009
002920     05  PV-SAVE-STATUS-CDE             PIC X(02).                00292009
002930     05  PV-SAVE-CURR-STATUS-CDE        PIC X(02).                00293009
002940     05  PV-SAVE-CURR-STATUS-DTE        PIC X(10).                00294009
002950     05  PV-SAVE-CURR-STATUS-TME        PIC X(08).                00295009
002960     05  PV-CMPR-STATUS-TME.                                      00296009
002970         10  PV-CMPR-STATUS-TME-HH      PIC 9(02).                00297009
002980         10  FILLER                     PIC X(01).                00298009
002990         10  PV-CMPR-STATUS-TME-MM      PIC 9(02).                00299009
003000         10  FILLER                     PIC X(01).                00300009
003010         10  PV-CMPR-STATUS-TME-SS      PIC 9(02).                00301009
003020     05  PV-CMPR-STATUS-DTE             PIC X(10)  VALUE SPACES.  00302009
003030     05  PV-DB2-HOST-DATE               PIC X(10)  VALUE SPACES.  00303009
003040     05  PV-DB2-HOST-DATE-30            PIC X(10)  VALUE SPACES.  00304009
003050     05  PV-DB2-HOST-TIME               PIC X(08)  VALUE SPACES.  00305009
003060     05  PV-REC-TMST                    PIC X(26)  VALUE SPACES.  00306009
003070     05  PV-MESSAGE.                                              00307009
003080         10  PV-MESSAGE1                PIC X(10).                00308009
003090         10  PV-FILLER                  PIC X(01).                00309009
003100         10  PV-MESSAGE2                PIC X(10).                00310009
003110         10  PV-FILLER                  PIC X(01).                00311009
003120         10  PV-MESSAGE3                PIC X(10).                00312009
003130     05  PV-TRBL-RSLV-CT                PIC S9(04) VALUE +0       00313009
003140                                                 COMP-3.          00314009
003150     05  PV-TRBL-MSG-NO                 PIC 9(05) VALUE 0.        00315009
003160/                                                                 00316009
003170*----------------------------------------------------------------*00317009
003180*    WORKING STORAGE AREA FOR THE RIGHT JUSTIFICATION ROUTINE    *00318009
003190*----------------------------------------------------------------*00319009
003200     COPY TRWS011.                                                00320009
003210                                                                  00321009
003220     05  PV-EST-DATE-TIME.                                        00322009
003230         10  PV-EST-DATE                PIC X(10).                00323009
003240         10  FILLER                     PIC X(01).                00324009
003250         10  PV-EST-TIME                PIC X(08).                00325009
003260         10  FILLER                     PIC X(07).                00326009
003270                                                                  00327009
003280     05  PV-TRIPST-DTE.                                           00328009
003290         10  FILLER                     PIC X(02).                00329009
003300         10  PV-TRIPST-YY               PIC X(02).                00330009
003310         10  FILLER                     PIC X(01).                00331009
003320         10  PV-TRIPST-MM               PIC X(02).                00332009
003330         10  FILLER                     PIC X(01).                00333009
003340         10  PV-TRIPST-DD               PIC X(02).                00334009
003350                                                                  00335009
003360     05  PV-TRIP-MMDDYY.                                          00336009
003370         10  PV-TRIP-MM                 PIC X(02).                00337009
003380         10  FILLER                     PIC X(01)  VALUE '/'.     00338009
003390         10  PV-TRIP-DD                 PIC X(02).                00339009
003400         10  FILLER                     PIC X(01)  VALUE '/'.     00340009
003410         10  PV-TRIP-YY                 PIC X(02).                00341009
003420                                                                  00342009
003430                                                                  00343009
003440     05  PV-TRIPST-TME.                                           00344009
003450         10  PV-TRIPST-HH               PIC X(02).                00345009
003460         10  FILLER                     PIC X(01).                00346009
003470         10  PV-TRIPST-MIN              PIC X(02).                00347009
003480         10  FILLER                     PIC X(03).                00348009
003490                                                                  00349009
003500     05  PV-TRIP-TME.                                             00350009
003510         10  PV-TRIP-HH                 PIC X(02).                00351009
003520         10  FILLER                     PIC X(01)  VALUE ':'.     00352009
003530         10  PV-TRIP-MIN                PIC X(02).                00353009
003540                                                                  00354009
003550     05  PV-XMIT-MMDDYY.                                          00355009
003560         10  PV-XMIT-MONTH              PIC X(02).                00356009
003570         10  FILLER                     PIC X(01)  VALUE '/'.     00357009
003580         10  PV-XMIT-DAY                PIC X(02).                00358009
003590         10  FILLER                     PIC X(01)  VALUE '/'.     00359009
003600         10  PV-XMIT-YEAR               PIC X(02).                00360009
003610     05  PV-XMIT-DTE.                                             00361009
003620         10  FILLER                     PIC X(02).                00362009
003630         10  PV-XMIT-YY                 PIC X(02).                00363009
003640         10  FILLER                     PIC X(01).                00364009
003650         10  PV-XMIT-MM                 PIC X(02).                00365009
003660         10  FILLER                     PIC X(01).                00366009
003670         10  PV-XMIT-DD                 PIC X(02).                00367009
003680                                                                  00368009
003690     05  PV-CURR-STATUS-CCYYMMDD.                                 00369009
003700         10  PV-CURR-STATUS-CC          PIC X(02).                00370009
003710         10  PV-CURR-STATUS-DTE         PIC X(08).                00371009
003720         10  FILLER REDEFINES PV-CURR-STATUS-DTE.                 00372009
003730             15  PV-CURR-STATUS-YY      PIC X(02).                00373009
003740             15  FILLER                 PIC X(06).                00374009
003750     05  PV-CURR-STATUS-TME             PIC X(08).                00375009
003760*---------------------------------------------------------------* 00376009
003770*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 00377009
003780*---------------------------------------------------------------* 00378009
003790                                                                  00379009
003800     COPY TRWS006.                                                00380009
003810                                                                  00381009
003830*---------------------------------------------------------------* 00383009
003840*    MAP LAYOUT                                                 * 00384009
003850*---------------------------------------------------------------* 00385009
003870     COPY TRKM112.                                                00387009
003880                                                                  00388009
003881*---------------------------------------------------------------* 00388188
003882*  RECORD LAYOUT RPA MISDIRECT CALLED MODULE RCKCS838           * 00388288
003883*---------------------------------------------------------------* 00388388
003884     COPY RCWS077.                                                00388488
003885                                                                  00388588
003900*---------------------------------------------------------------* 00390009
003910*    ATTRIBUTE SETTINGS COPYBOOK.                               * 00391009
003920*---------------------------------------------------------------* 00392009
003930                                                                  00393009
003940     COPY DPWS015.                                                00394009
003950                                                                  00395009
003960*---------------------------------------------------------------* 00396009
003970*    FUNCTION KEYS COPYBOOK.                                    * 00397009
003980*---------------------------------------------------------------* 00398009
003990                                                                  00399009
004000     COPY DPWS016.                                                00400009
004010                                                                  00401009
004020*---------------------------------------------------------------* 00402009
004030*    NUMERIC EDIT LAYOUT.                                       * 00403009
004040*---------------------------------------------------------------* 00404009
004050                                                                  00405009
004060     COPY DPWS010I.                                               00406009
004070/                                                                 00407009
004080*----------------------------------------------------------------*00408009
004090*  WORK AREA PASSED IN CALL TO DPKUT902                          *00409009
004100*----------------------------------------------------------------*00410009
004110     COPY DPWS902.                                                00411009
004120                                                                  00412009
004130*----------------------------------------------------------------*00413009
004140*  COMMAREA FOR TMKCS520 -- TROUBLE PROCESSING MODULE            *00414009
004150*----------------------------------------------------------------*00415009
004160     COPY TMWS500.                                                00416009
004170                                                                  00417009
004180                                                                  00418009
004190***************************************************************** 00419009
004200*   RCWS040 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 00420009
004210*             AUTOVERIFY (AUTOVE) ELIGIBILITY MODULE (RCKUT127).* 00421009
004220***************************************************************** 00422009
004230     COPY RCWS040.                                                00423009
004240                                                                  00424009
004250/                                                                 00425009
004260*---------------------------------------------------------------* 00426010
004270*  COMMUNICATION AREA PASSED TO WRITE INFORMATION                 00427010
004280*  TO THE EAI EXPORT TABLES (XLKUP033)                            00428010
004290*---------------------------------------------------------------* 00429010
004300     COPY XLWS072.                                                00430010
004310                                                                  00431010
004320***************************************************************** 00432009
004330*    COPY BOOKS FOR THE VALIDATION ROUTINE FOR THE FREIGHT BILL   00433009
004340*    BILL OF LADING, AND VEHICLE NUMBER                           00434009
004350***************************************************************** 00435009
004360     COPY RCWS023.                                                00436009
004370                                                                  00437009
004380/                                                                 00438009
004390*---------------------------------------------------------------* 00439009
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 00440096
004410*---------------------------------------------------------------* 00441009
004420                                                                  00442009
004430     COPY DPWS030.                                                00443009
CICS       COPY DPWS930.                                                00444096
004450/                                                                 00445009
004460*---------------------------------------------------------------* 00446009
004470*    STANDARD COMMAREA.                                         * 00447009
004480*---------------------------------------------------------------* 00448009
004490                                                                  00449009
004500     COPY DPWS020.                                                00450009
004510     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00451009
004520                                                                  00452009
004530         10  INTER-APPL-COMM-AREA       PIC X(200).               00453009
004540     COPY TRWS005.                                                00454009
004550     COPY TRWS007.                                                00455009
004560     COPY TRWS008.                                                00456009
004570     COPY TRWS001.                                                00457009
004580     COPY RCWS012.                                                00458009
004590     COPY RCWS015.                                                00459009
004600*---------------------------------------------------------------* 00460009
004610*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 00461009
004620*---------------------------------------------------------------* 00462009
004630         10  ASC-SPECIFIC-COMMAREA.                               00463009
004640             15  ASC-INT-APPL-FORMAT-IND PIC X(01).               00464009
004650             15  ASC-ACTION-SW          PIC X(03).                00465009
004660                 88  ASC-ADD-PENDING    VALUE 'ADD'.              00466009
004670                 88  ASC-DELETE-PENDING VALUE 'DEL'.              00467009
004680                 88  ASC-UPDATE-PENDING VALUE 'UPD'.              00468009
004690             15  ASC-DELETE-SUCCESSFUL-SW  PIC X(01).             00469009
004700                 88  ASC-DELETE-SUCCESSFUL VALUE 'Y'.             00470009
004710             15  ASC-ADD-SUCCESSFUL-SW      PIC X(01).            00471009
004720                 88  ASC-ADD-NOT-SUCCESSFUL VALUE ' '.            00472009
004730                 88  ASC-ADD-SUCCESSFUL     VALUE 'Y'.            00473009
004740             15  ASC-VEHICLE-SETUP-PREV-SW      PIC X(01).        00474009
004750                 88  ASC-VEHICLE-NOT-SETUP-PREV VALUE 'N'.        00475009
004760                 88  ASC-VEHICLE-NULL-TRIP      VALUE 'L'.        00476009
004770                 88  ASC-VEHICLE-SETUP-PREV     VALUE 'Y'.        00477009
004780             15  ASC-NEW-STOP-PENDING-SW        PIC X(01).        00478009
004790                 88  ASC-NEW-STOP-PENDING       VALUE 'Y'.        00479009
004800             15  ASC-USE-SWITCH                 PIC X(01).        00480009
004810                 88  ASC-FROM-RC015             VALUE 'B'.        00481009
004820             15  ASC-TRIP-PRTY-CDE              PIC X(02).        00482009
004830             15  ASC-TRIP-PRTY-CDE-N REDEFINES                    00483009
004840                 ASC-TRIP-PRTY-CDE              PIC 9(02).        00484009
004850             15  ASC-VEHICLE-STATUS-SW          PIC X(02).        00485009
004860                 88  ASC-VEHICLE-ARRIVED        VALUE 'AR'.       00486009
004870                 88  ASC-VEHICLE-BEG-UNLD       VALUE 'UG'.       00487009
004880                 88  ASC-VEHICLE-BEG-LOAD       VALUE 'LG'.       00488009
004890                 88  ASC-VEHICLE-DEPARTED       VALUE 'DP'.       00489009
004900                 88  ASC-VEHICLE-ENROUTE        VALUE 'EN'.       00490009
004910                 88  ASC-VEHICLE-LOADED         VALUE 'LD'.       00491009
004920                 88  ASC-VEHICLE-UNLD           VALUE 'UN'.       00492009
004930             15  ASC-FIELDS-CHANGED-SW          PIC X(01).        00493009
004940                 88  ASC-FIELDS-CHANGED         VALUE 'Y'.        00494009
004950             15  AS-KEY-FIELDS.                                   00495009
004960                 20  ASC-KEY-OWNER-SCAC-ID    PIC X(04).          00496009
004970                 20  ASC-KEY-VEH-NBR          PIC X(10).          00497009
004980                 20  ASC-DEST-OPER-UNT-ID     PIC X(04).          00498009
004990                 20  ASC-DEST-OPER-UNT-ID-N REDEFINES             00499009
005000                     ASC-DEST-OPER-UNT-ID     PIC 9(04).          00500009
005010                 20  ASC-DEST-FCLTY-ID        PIC X(04).          00501009
005020                 20  ASC-DEST-FCLTY-ID-N REDEFINES                00502009
005030                     ASC-DEST-FCLTY-ID        PIC 9(04).          00503009
005040                 20  ASC-KEY-TRIP-ID          PIC S9(09) COMP.    00504009
005050                 20  ASC-KEY-FAC-AREA-ID      PIC X(06).          00505009
005060                 20  ASC-KEY-SUBAREA-OF-ID    PIC X(06).          00506009
005070                 20  ASC-TRIP-STATUS-CDE    PIC X(02).            00507009
005080                 20  ASC-USAGE-CDE          PIC X(03).            00508009
005090                 20  ASC-CURR-OPER-UNT-ID     PIC X(04).          00509009
005100                 20  ASC-CURR-OPER-UNT-ID-N REDEFINES             00510009
005110                     ASC-CURR-OPER-UNT-ID     PIC 9(04).          00511009
005120                 20  ASC-CURR-FCLTY-ID        PIC X(04).          00512009
005130                 20  ASC-CURR-FCLTY-ID-N REDEFINES                00513009
005140                     ASC-CURR-FCLTY-ID        PIC 9(04).          00514009
005150                 20  ASC-SPLT-XMIT-IND        PIC X(01).          00515009
005160             15  ASC-SCREEN-FIELDS.                               00516009
005170                 20  ASC-OWNER-SCAC-ID-DESC PIC X(25).            00517009
005180                 20  ASC-CURR-FAC-AREA-ID   PIC X(06).            00518009
005190                 20  ASC-CURR-FAC-AREA-ID-DESC                    00519009
005200                                            PIC X(30).            00520009
005210                 20  ASC-CURR-FCLTY-NME     PIC X(24).            00521009
005220                 20  ASC-CURR-SUBAREA-OF-ID PIC X(06).            00522009
005230                 20  ASC-CURR-SUBAREA-OF-ID-DESC                  00523009
005240                                            PIC X(30).            00524009
005310                 20  ASC-TRIP-STATUS-DESC   PIC X(25).            00531009
005320                 20  ASC-DEST-FCLTY-NME     PIC X(25).            00532009
005330                 20  ASC-DEST-FAC-AREA-ID   PIC X(06).            00533009
005340                 20  ASC-DEST-FAC-AREA-ID-DESC                    00534009
005350                                            PIC X(30).            00535009
005360                 20  ASC-DEST-SUBAREA-OF-ID PIC X(06).            00536009
005370                 20  ASC-DEST-SUBAREA-OF-ID-DESC                  00537009
005380                                            PIC X(30).            00538009
005390                 20  ASC-CURR-STATUS-DTE    PIC X(10).            00539009
005400                 20  ASC-CURR-STATUS-TME    PIC X(08).            00540009
005410                 20  ASC-LENGTH             PIC X(02).            00541009
005420                 20  ASC-MANIFEST-NBR       PIC X(15).            00542009
005430                 20  ASC-STOP-NBR           PIC 9(02).            00543009
005440                 20  ASC-TOTAL-STOPS        PIC 9(02).            00544009
005450                 20  ASC-SEAL-1             PIC X(15).            00545009
005460                 20  ASC-SEAL-2             PIC X(15).            00546009
005470                 20  ASC-ETA-DTE.                                 00547009
005480                     35  ASC-ETA-DTE-CCYY.                        00548009
005490                         40  ASC-ETA-DTE-CC     PIC X(02).        00549009
005500                         40  ASC-ETA-DTE-YY     PIC X(02).        00550009
005510                     35  FILLER-1               PIC X(01).        00551009
005520                     35  ASC-ETA-DTE-MM         PIC X(02).        00552009
005530                     35  FILLER-2               PIC X(01).        00553009
005540                     35  ASC-ETA-DTE-DD         PIC X(02).        00554009
005550                 20  FILLER REDEFINES ASC-ETA-DTE.                00555009
005560                     35  FILLER                 PIC X(02).        00556009
005570                     35  ASC-ETA-YY-MM-DD       PIC X(08).        00557009
005580                 20  ASC-OWNR-SCAC-SHP-DTE.                       00558009
005590                     35  ASC-OWNR-SCAC-SHP-CCYY.                  00559009
005600                         40  ASC-OWNR-SCAC-SHP-CC  PIC X(02).     00560009
005610                         40  ASC-OWNR-SCAC-SHP-YY  PIC X(02).     00561009
005620                     35  FILLER-1               PIC X(01).        00562009
005630                     35  ASC-OWNR-SCAC-SHP-MM   PIC X(02).        00563009
005640                     35  FILLER-2               PIC X(01).        00564009
005650                     35  ASC-OWNR-SCAC-SHP-DD   PIC X(02).        00565009
005660                 20  FILLER REDEFINES ASC-OWNR-SCAC-SHP-DTE.      00566009
005670                     35  FILLER                 PIC X(02).        00567009
005680                     35  ASC-SHP-YY-MM-DD       PIC X(08).        00568009
005690                 20  ASC-ETA-TIME.                                00569009
005700                     35  ASC-ETA-TIME-HH        PIC X(02).        00570009
005710                     35  ASC-ETA-TIME-HH-N REDEFINES              00571009
005720                         ASC-ETA-TIME-HH        PIC 9(02).        00572009
005730                     35  FILLER-3               PIC X(01).        00573009
005740                     35  ASC-ETA-TIME-MM        PIC X(02).        00574009
005750                     35  ASC-ETA-TIME-MM-N REDEFINES              00575009
005760                         ASC-ETA-TIME-MM        PIC 9(02).        00576009
005770                     35  FILLER-4               PIC X(01).        00577009
005780                     35  ASC-ETA-TIME-SS        PIC X(02).        00578009
005790                 20  ASC-VEH-TYP-CDE            PIC X(02).        00579009
005800                 20  ASC-XMIT-DATE              PIC X(08).        00580009
005810             15  ASC-SCREEN-FIELDS-OLD.                           00581009
005820                 20  ASC-OWNER-SCAC-ID-OLD      PIC X(04).        00582009
005830                 20  ASC-VEH-NBR-OLD            PIC X(10).        00583009
005840                 20  ASC-CURR-FAC-AREA-ID-OLD   PIC X(06).        00584009
005850                 20  ASC-CURR-SUBAREA-OF-ID-OLD PIC X(06).        00585009
005860                 20  ASC-CURR-OPER-UNT-ID-OLD   PIC X(04).        00586009
005870                 20  ASC-CURR-FCLTY-ID-OLD      PIC X(04).        00587009
005880                 20  ASC-TRIP-STATUS-CDE-OLD    PIC X(02).        00588009
005890                 20  ASC-DEST-FAC-AREA-ID-OLD   PIC X(06).        00589009
005900                 20  ASC-DEST-SUBAREA-OF-ID-OLD PIC X(06).        00590009
005910                 20  ASC-DEST-OPER-UNT-ID-OLD   PIC X(04).        00591009
005920                 20  ASC-DEST-FCLTY-ID-OLD      PIC X(04).        00592009
005930                 20  ASC-USAGE-CDE-OLD          PIC X(03).        00593009
005940                 20  ASC-LENGTH-OLD             PIC X(02).        00594009
005950                 20  ASC-MANIFEST-NBR-OLD       PIC X(15).        00595009
005960                 20  ASC-SEAL-1-OLD             PIC X(15).        00596009
005970                 20  ASC-SEAL-2-OLD             PIC X(15).        00597009
005980                 20  ASC-ETA-DTE-OLD.                             00598009
005990                     35  ASC-ETA-DTE-CCYY-OLD   PIC X(04).        00599009
006000                     35  FILLER-5               PIC X(01).        00600009
006010                     35  ASC-ETA-DTE-MM-OLD     PIC X(02).        00601009
006020                     35  FILLER-6               PIC X(01).        00602009
006030                     35  ASC-ETA-DTE-DD-OLD     PIC X(02).        00603009
006040                 20  ASC-ETA-TIME-OLD           PIC X(08).        00604009
006050                 20  ASC-OWNR-SHP-DTE-OLD.                        00605009
006060                     35  ASC-OWNR-SHP-DTE-CCYY-OLD PIC X(04).     00606009
006070                     35  FILLER-5               PIC X(01).        00607009
006080                     35  ASC-OWNR-SHP-DTE-MM-OLD PIC X(02).       00608009
006090                     35  FILLER-6               PIC X(01).        00609009
006100                     35  ASC-OWNR-SHP-DTE-DD-OLD PIC X(02).       00610009
006110                 20  ASC-VEH-TYP-CDE-OLD        PIC X(02).        00611009
006120                                                                  00612009
006130             15  ASC-PLND-TRIP-SEQ          PIC S9(04) COMP.      00613009
006140             15  ASC-USE-SELECTION-QUEUE-IND                      00614009
006150                                        PIC  X(01).               00615009
006160                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    00616009
006170             15  ASC-SEL-QUEUE-NAME     PIC  X(08).               00617009
006180             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05)  COMP-3.       00618009
006190             15  ASC-NUMBER-OF-SELECTED-ITEMS                     00619009
006200                                        PIC S9(09)  COMP-3.       00620009
006210             15  ASC-SEL-SUB            PIC S9(04)  COMP.         00621009
006220             15  ASC-SEL-ITEM           PIC S9(04)  COMP.         00622009
006230             15  ASC-REF-TRIP-ID        PIC S9(09)  COMP.         00623009
006240             15  ASC-AUTO-VE-SW                  PIC X(01).       00624009
006250                 88 ASC-AUTO-VE                  VALUE 'Y'.       00625009
006260                 88 ASC-AUTO-VE-NO               VALUE 'N'.       00626009
006261                                                                  00626188
006262             15  ASC-RPA-MISDRCT-CK-SW  PIC X(01).                00626288
006263                 88  ASC-RPA-MISDRCT-CK            VALUE 'Y'.     00626388
006264                 88  ASC-NO-RPA-MISDRCT-CK         VALUE 'N'.     00626488
006280                                                                  00628009
006290/                                                                 00629009
006300*---------------------------------------------------------------* 00630009
006310*    RECORD LAYOUT                                              * 00631009
006320*---------------------------------------------------------------* 00632009
006330                                                                  00633009
006340     COPY RCWS013.                                                00634009
006350                                                                  00635009
006360/                                                                 00636009
006370*---------------------------------------------------------------* 00637009
006380*    ABEND PROCESSING COPYBOOK.                                 * 00638009
006390*---------------------------------------------------------------* 00639009
006400                                                                  00640009
006410     COPY DPWS013.                                                00641009
006420                                                                  00642009
006430/                                                                 00643009
006440*----------------------------------------------------------------*00644009
006450*  WORK AREA PASSED IN CALL TO DPKUT500                          *00645009
006460*----------------------------------------------------------------*00646009
006470     COPY DPWS500.                                                00647009
006480                                                                  00648009
006490/                                                                 00649009
006500*---------------------------------------------------------------* 00650009
006510*    DB2 AREA FOR THE SHIPMT PO TABLE                           * 00651009
006520*---------------------------------------------------------------* 00652009
006530     EXEC SQL                                                     00653000
006540          INCLUDE TSHPTPO                                         00654000
006550     END-EXEC.                                                    00655000
006560                                                                  00656000
006570/                                                                 00657000
006580*---------------------------------------------------------------* 00658000
006590*    DB2 AREA FOR THE RECEIVER TABLE                            * 00659000
006600*---------------------------------------------------------------* 00660000
006610     EXEC SQL                                                     00661000
006620          INCLUDE TRECEIV                                         00662000
006630     END-EXEC.                                                    00663000
006640                                                                  00664000
006650/                                                                 00665000
006660*---------------------------------------------------------------* 00666000
006670*    DB2 AREA FOR THE FACILITY LOCATION TYPE TABLE              * 00667000
006680*---------------------------------------------------------------* 00668000
006690     EXEC SQL                                                     00669000
006700          INCLUDE TFLTYPE                                         00670000
006710     END-EXEC.                                                    00671000
006720                                                                  00672000
006730/                                                                 00673000
006740*---------------------------------------------------------------* 00674000
006750*    DB2 AREA FOR THE FACILITY LOCATION TABLE                   * 00675000
006760*---------------------------------------------------------------* 00676000
006770     EXEC SQL                                                     00677000
006780          INCLUDE TFLAREA                                         00678000
006790     END-EXEC.                                                    00679000
006800                                                                  00680000
006810/                                                                 00681000
006820*---------------------------------------------------------------* 00682000
006830*    DB2 AREA FOR THE STORE TABLE                               * 00683000
006840*---------------------------------------------------------------* 00684000
006850     EXEC SQL                                                     00685000
006860          INCLUDE TFACLTY                                         00686000
006870     END-EXEC.                                                    00687000
006880                                                                  00688000
006890/                                                                 00689000
006900*---------------------------------------------------------------* 00690000
006910*    DB2 AREA FOR THE TRIP STATUS CODE TABLE                    * 00691000
006920*---------------------------------------------------------------* 00692000
006930     EXEC SQL                                                     00693000
006940          INCLUDE TTRSTYP                                         00694000
006950     END-EXEC.                                                    00695000
006960                                                                  00696000
006970                                                                  00697000
006980/                                                                 00698000
006990*---------------------------------------------------------------* 00699000
007000*    DB2 AREA FOR THE SHIPMENT TABLE                            * 00700000
007010*---------------------------------------------------------------* 00701000
007020     EXEC SQL                                                     00702000
007030          INCLUDE TSHIPMT                                         00703000
007040     END-EXEC.                                                    00704000
007050                                                                  00705000
007060/                                                                 00706000
007070*---------------------------------------------------------------* 00707000
007080*    DB2 AREA FOR THE SHIPMENT AUDIT TABLE                      * 00708000
007090*---------------------------------------------------------------* 00709000
007100     EXEC SQL                                                     00710000
007110          INCLUDE TAUSHIP                                         00711000
007120     END-EXEC.                                                    00712000
007130                                                                  00713000
007140/                                                                 00714000
007150*---------------------------------------------------------------* 00715000
007160*    DB2 AREA FOR THE IMPORT PO RELEASE TABLE                   * 00716000
007170*---------------------------------------------------------------* 00717000
007180     EXEC SQL                                                     00718000
007190          INCLUDE TIMPORL                                         00719000
007200     END-EXEC.                                                    00720000
007210                                                                  00721000
007220/                                                                 00722000
007230*---------------------------------------------------------------* 00723000
007240*    DB2 AREA FOR THE EXTERNAL ENTERPRISE TABLE                 * 00724000
007250*---------------------------------------------------------------* 00725000
007260     EXEC SQL                                                     00726000
007270          INCLUDE TEXTENT                                         00727000
007280     END-EXEC.                                                    00728000
007290                                                                  00729000
007300/                                                                 00730000
007310*---------------------------------------------------------------* 00731000
007320*    DB2 AREA FOR THE EXTERNAL ENTERPRISE NAME TABLE            * 00732000
007330*---------------------------------------------------------------* 00733000
007340     EXEC SQL                                                     00734000
007350          INCLUDE TENTNME                                         00735000
007360     END-EXEC.                                                    00736000
007370                                                                  00737000
007380/                                                                 00738000
007390*---------------------------------------------------------------* 00739000
007400*    DB2 AREA FOR THE VEHICLE TABLE                             * 00740000
007410*---------------------------------------------------------------* 00741000
007420     EXEC SQL                                                     00742000
007430          INCLUDE TVEHICL                                         00743000
007440     END-EXEC.                                                    00744000
007450                                                                  00745000
007460/                                                                 00746000
007470*---------------------------------------------------------------* 00747000
007480*    DB2 AREA FOR THE VEHICLE TRIP TABLE                        * 00748000
007490*---------------------------------------------------------------* 00749000
007500     EXEC SQL                                                     00750000
007510          INCLUDE TVHTRIP                                         00751000
007520     END-EXEC.                                                    00752000
007530                                                                  00753000
007540/                                                                 00754000
007550*---------------------------------------------------------------* 00755000
007560*    DB2 AREA FOR THE TRIP STATUS TABLE                         * 00756000
007570*---------------------------------------------------------------* 00757000
007580     EXEC SQL                                                     00758000
007590          INCLUDE TTRIPST                                         00759000
007600     END-EXEC.                                                    00760000
007610                                                                  00761000
007620/                                                                 00762000
007630*---------------------------------------------------------------* 00763000
007640*    DB2 AREA FOR THE SHIPMENT STATUS CODE TABLE                * 00764000
007650*---------------------------------------------------------------* 00765000
007660     EXEC SQL                                                     00766000
007670          INCLUDE TSHSTYP                                         00767000
007680     END-EXEC.                                                    00768000
007690                                                                  00769000
007700/                                                                 00770000
007710*---------------------------------------------------------------* 00771000
007720*    DB2 AREA FOR THE VEICLE SEAL TABLE                         * 00772000
007730*---------------------------------------------------------------* 00773000
007740     EXEC SQL                                                     00774000
007750          INCLUDE TVHSEAL                                         00775000
007760     END-EXEC.                                                    00776000
007770                                                                  00777000
007780/                                                                 00778000
007870*---------------------------------------------------------------* 00787000
007880*    DB2 AREA FOR THE SHIPMENT STATUS TABLE                     * 00788000
007890*---------------------------------------------------------------* 00789000
007900     EXEC SQL                                                     00790000
007910          INCLUDE TSHIPST                                         00791000
007920     END-EXEC.                                                    00792000
007930                                                                  00793000
007940/                                                                 00794000
007950*---------------------------------------------------------------* 00795000
007960*    DB2 AREA FOR VEHICLE AUDIT TABLE                           * 00796000
007970*---------------------------------------------------------------* 00797000
007980     EXEC SQL                                                     00798000
007990          INCLUDE TAUVHCL                                         00799000
008000     END-EXEC.                                                    00800000
008010                                                                  00801000
008020/                                                                 00802000
008030*---------------------------------------------------------------* 00803000
008040*    DB2 AREA FOR TRIP AUDIT TABLE                              * 00804000
008050*---------------------------------------------------------------* 00805000
008060     EXEC SQL                                                     00806000
008070          INCLUDE TAUTRIP                                         00807000
008080     END-EXEC.                                                    00808000
008090                                                                  00809000
008100/                                                                 00810000
008110*---------------------------------------------------------------* 00811001
008120*    DB2 AREA FOR LOGISTICS LOCATION TABLE - XLT_LOC            * 00812001
008130*---------------------------------------------------------------* 00813001
008140     EXEC SQL                                                     00814001
008150          INCLUDE XLT00010                                        00815001
008160     END-EXEC.                                                    00816001
008170/                                                                 00817001
008180*---------------------------------------------------------------* 00818000
008190*    DB2 AREA FOR TROUBLE NOTIFICATION TABLE                    * 00819000
008200*---------------------------------------------------------------* 00820000
008210     EXEC SQL                                                     00821000
008220          INCLUDE TTRBNTF                                         00822000
008230     END-EXEC.                                                    00823000
008240/                                                                 00824000
008250*---------------------------------------------------------------* 00825015
008260*    DB2 AREA FOR FUNCTION PARAMETER TABLE                      * 00826015
008270*---------------------------------------------------------------* 00827015
008280     EXEC SQL                                                     00828015
008290          INCLUDE TKRPRPM                                         00829015
008300     END-EXEC.                                                    00830015
008310/                                                                 00831015
008320*---------------------------------------------------------------* 00832000
008330*    DB2 AREA FOR COMMUNICATIONS                                * 00833000
008340*---------------------------------------------------------------* 00834000
008350     EXEC SQL                                                     00835000
008360          INCLUDE SQLCA                                           00836000
008370     END-EXEC.                                                    00837000
008380                                                                  00838000
008390/                                                                 00839000
008400*---------------------------------------------------------------* 00840000
008410*  CURSOR TO LIST SEALS FOR A VEHICLE                           * 00841000
008420*---------------------------------------------------------------* 00842000
008430                                                                  00843000
008440     EXEC SQL                                                     00844000
008450          DECLARE SEAL-CSR CURSOR FOR                             00845000
008460           SELECT SEAL_NBR                                        00846000
008470                 ,LAST_UPD_DTE                                    00847000
008480                 ,LAST_UPD_TME                                    00848000
008490           FROM   TVHSEAL                                         00849000
008500           WHERE  TRIP_ID = :DK-TRIP-ID                           00850000
008510         ORDER BY LAST_UPD_DTE DESC                               00851000
008520                 ,LAST_UPD_TME DESC                               00852000
008530     END-EXEC.                                                    00853000
008540                                                                  00854000
008550/                                                                 00855000
008560*---------------------------------------------------------------* 00856000
008570*  CURSOR TO LIST SHIPMENTS FOR A TRIP                          * 00857000
008580*---------------------------------------------------------------* 00858000
008590                                                                  00859000
008600     EXEC SQL                                                     00860000
008610          DECLARE SHIPMENT-CSR CURSOR FOR                         00861000
008620           SELECT SHIPT_ID                                        00862000
008630            FROM  TSHIPMT                                         00863000
008640           WHERE (TRIP_ID = :DK-TRIP-ID                           00864000
008650             AND  TRIP_ID IS NOT NULL)                            00865000
008660         ORDER BY SHIPT_ID                                        00866000
008670     END-EXEC.                                                    00867000
008680                                                                  00868000
008690/                                                                 00869000
008700*---------------------------------------------------------------* 00870000
008710*  CURSOR TO LIST RECEIVERS FOR A TRIP                          * 00871000
008720*---------------------------------------------------------------* 00872000
008730                                                                  00873000
008740     EXEC SQL                                                     00874000
008750          DECLARE RECEIVR-CSR CURSOR FOR                          00875000
008760           SELECT C.ORD_NBR                                       00876000
008770                , C.REC_SEQ_NBR                                   00877000
008780                , C.STATUS_CDE                                    00878000
008790                , C.CRE_TMST                                      00879009
008800            FROM  TSHIPMT A                                       00880009
008810                , TSHPTPO B                                       00881009
008820                , TRECEIV C                                       00882009
008830           WHERE  A.TRIP_ID     = :DK-TRIP-ID                     00883009
008840             AND  A.TRIP_ID IS NOT NULL                           00884009
008850             AND  A.SHIPT_ID    = B.SHIPT_ID                      00885009
008860             AND  B.REC_SEQ_NBR > :PC-ZERO                        00886009
008870             AND  B.REC_SEQ_NBR = C.REC_SEQ_NBR                   00887009
008880             AND  B.PO_NBR      = C.ORD_NBR                       00888009
008890     END-EXEC.                                                    00889009
008900                                                                  00890009
008910/                                                                 00891009
008920*---------------------------------------------------------------* 00892009
008930*  CURSOR TO LIST SHPTPO                                        * 00893009
008940*---------------------------------------------------------------* 00894009
008950                                                                  00895009
008960     EXEC SQL                                                     00896009
008970          DECLARE SHPTPO-CSR CURSOR FOR                           00897009
008980           SELECT DISTINCT                                        00898009
008990                  SP.PO_NBR                                       00899009
009000            FROM  TSHIPMT SH                                      00900009
009010                , TSHPTPO SP                                      00901009
009020                , TVHTRIP TR                                      00902009
009030                , TIMPORL IM                                      00903009
009040           WHERE  TR.TRIP_ID  = :DK-TRIP-ID                       00904009
009050             AND  TR.TRIP_ID  =  SH.TRIP_ID                       00905009
009060             AND  SH.SHIPT_ID =  SP.SHIPT_ID                      00906009
009070             AND  SP.PO_NBR   =  IM.PO_NBR                        00907009
009080             AND  IM.VER_STATUS_CDE = 'A'                         00908009
009090             AND  IM.DCONSLR_RLSE_CDE = 'S'                       00909009
009100     END-EXEC.                                                    00910009
009110                                                                  00911009
009120/                                                                 00912009
009130*---------------------------------------------------------------* 00913009
009140*  CURSOR TO LIST TRIPST RECORDS FOR A TRIP                     * 00914009
009150*---------------------------------------------------------------* 00915009
009160                                                                  00916009
009170     EXEC SQL                                                     00917009
009180          DECLARE TRIPST-CSR CURSOR FOR                           00918009
009190           SELECT TRIP_STATUS_CDE                                 00919009
009200            FROM  TTRIPST                                         00920009
009210           WHERE  TRIP_ID     = :DK-TRIP-ID                       00921009
009220     END-EXEC.                                                    00922009
009230                                                                  00923009
009240/                                                                 00924009
009250*---------------------------------------------------------------* 00925009
009260*  CURSOR TO LIST TRIPS FOR A SCAC AND VEHICL NUMBER            * 00926009
009270*---------------------------------------------------------------* 00927009
009280                                                                  00928009
009290     EXEC SQL                                                     00929009
009300          DECLARE TRIP-CSR CURSOR FOR                             00930009
009310             SELECT  DISTINCT                                     00931009
009320                     A.TRIP_ID                                    00932009
009330*                  , B.TRIP_STATUS_CDE                            00933009
009340*                  , B.OPER_UNT_ID                                00934009
009350*                  , B.FCLTY_ID                                   00935009
009360*                  , B.FCLTY_AREA_ID                              00936009
009370            FROM  TVHTRIP A                                       00937009
009380               ,  TTRIPST B                                       00938009
009390           WHERE (A.OWNER_SCAC_ID = :DK-OWNER-SCAC-ID             00939009
009400             AND  A.VEH_NBR       = :DK-VEH-NBR                   00940009
009410             AND  A.TRIP_ID       = B.TRIP_ID                     00941009
009420             AND  A.TRIP_ID  NOT IN                               00942009
009430                 (SELECT C.TRIP_ID                                00943009
009440                  FROM TTRIPST C                                  00944009
009450                  WHERE C.TRIP_ID       = A.TRIP_ID               00945009
009460                    AND C.TRIP_STATUS_CDE = 'ET'))                00946009
009470     END-EXEC.                                                    00947009
009480                                                                  00948009
009490/                                                                 00949009
009500 LINKAGE SECTION.                                                 00950009
009510                                                                  00951009
009520 01  DFHCOMMAREA.                                                 00952009
009530     05  FILLER                         OCCURS  1 TO 4072 TIMES   00953009
009540                                        DEPENDING ON EIBCALEN.    00954009
009550         10  FILLER                     PIC X.                    00955009
009560                                                                  00956009
009570/                                                                 00957009
009580 PROCEDURE DIVISION.                                              00958009
009590*---------------------------------------------------------------* 00959009
009600*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 00960009
009610*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 00961009
009620*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 00962009
009630*---------------------------------------------------------------* 00963009
009640 0000-MAIN-MODULE.                                                00964009
009650                                                                  00965009
009660     INITIALIZE DP030-CICS-API-FIELDS.                            00966009
009670                                                                  00967009
009680     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       00968009
009690     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          00969009
009700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         00970009
009710                                                                  00971009
009720     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       00972009
009730                                                                  00973009
009740     MOVE LENGTH OF TR112AI        TO DP030-MAP-LENGTH (1).       00974009
009750     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     00975009
009760                                                                  00976009
009770     PERFORM 0001-CALL-CICS-ARCH-API.                             00977009
009780     PERFORM 1000-CONTROL-PROCESSING                              00978009
009790                                                                  00979009
009800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     00980009
009810     PERFORM 0001-CALL-CICS-ARCH-API.                             00981009
009820                                                                  00982009
009830*---------------------------------------------------------------* 00983009
009840*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 00984009
009850*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 00985009
009860*---------------------------------------------------------------* 00986009
009870 0001-CALL-CICS-ARCH-API.                                         00987009
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      00988096
009890                                    DFHCOMMAREA                   00989096
009900                                    DP030-CICS-API-FIELDS         00990096
009910                                    DP020-STANDARD-COMMAREA       00991096
009920                                    TR112AI.                      00992096
009930                                                                  00993009
009940     IF  DP030-RC-CALL-SUCCESSFUL                                 00994009
009950         CONTINUE                                                 00995009
009960     ELSE                                                         00996009
009970         SET DP013-NO-ROLLBACK                                    00997009
009980             DP013-XCTL-DISPLAY-RESTART                           00998009
009990             DP013-CICS-ABEND      TO TRUE                        00999009
010000         MOVE '0001-CALL-CICS-ARCH-API'                           01000009
010010                                   TO DP013-PARAGRAPH             01001009
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O01002096
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      01003096
010040         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      01004009
010050         PERFORM DP013-0000-PROCESS-ABEND                         01005009
010060     END-IF.                                                      01006009
010070                                                                  01007009
010080*----------------------------------------------------------------*01008009
010090* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *01009009
010100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *01010009
010110*----------------------------------------------------------------*01011009
010120                                                                  01012009
010130 1000-CONTROL-PROCESSING.                                         01013009
010140                                                                  01014009
010150     EVALUATE TRUE                                                01015009
010160         WHEN DP020-NEXT-ACT-INITIAL                              01016009
010170              PERFORM 1100-FIND-OBJECT-KEYS                       01017009
010180              IF  PS-ERROR                                        01018009
010190                  CONTINUE                                        01019009
010200              ELSE                                                01020009
010210                  PERFORM 4000-BUILD-INITIAL-PANEL                01021009
010220                  PERFORM 3200-RESET-ATTRIBUTES                   01022009
010230                  PERFORM 3500-SAVE-SCREEN-FIELDS                 01023009
010240                  IF  SQLCODE = +100                              01024009
010250                  AND NOT ASC-ADD-PENDING                         01025009
010260                      SET DP020-NEXT-ACT-APPL-ERROR               01026009
010270                                     TO TRUE                      01027009
010280                      MOVE PC-TSYMSG-00148                        01028009
010290                                     TO DP020-MSG-NUMBER          01029009
010300                      SET DP020-MSG-INFORMATIONAL                 01030009
010310                                     TO TRUE                      01031009
010320                  ELSE                                            01032009
010330                      IF  ASC-DELETE-PENDING                      01033009
010340                          MOVE PC-TSYMSG-00004                    01034009
010350                                     TO DP020-MSG-NUMBER          01035009
010360                          SET DP020-MSG-INFORMATIONAL             01036009
010370                                     TO TRUE                      01037009
010380                      END-IF                                      01038009
010390                  END-IF                                          01039009
010391* JAK 04/2007 - ADD WMS CODE - START                              01039131
010392* IF THE DC IS DOWNLOADING TO WMS, THEN THE TRIP STATUS           01039231
010393* CANNOT BE CHANGED.                                              01039331
010394*                 MOVE ASC-DEST-OPER-UNT-ID TO DK-OPER-UNT-ID     01039437
010395*                 PERFORM 4140-SELECT-TKRPRPM                     01039537
010396*                 IF PS-ASNS-TO-WMS-YES                           01039637
010400*                    MOVE DP015-PRO-NOR-MDT TO ATRIPSA            01040037
010401*                    MOVE DP015-BLUE TO ATRIPSC                   01040137
010407*                 END-IF                                          01040737
010408* JAK 04/2007 - ADD WMS CODE - END                                01040836
010409              END-IF                                              01040936
010410                                                                  01041009
010420         WHEN DP020-NEXT-ACT-READ-MAP                             01042009
010431             PERFORM 2000-PROCESS-PANEL                           01043109
010440                                                                  01044009
010450         WHEN DP020-NEXT-ACT-RETURN                               01045009
010460                                                                  01046009
010470* IF WE ARE RETURNING FROM THE PARKING LIST PROGRAM, WE WANT      01047009
010480* TO TAKE THE YARD AND SPACE RETURNED AND OVERLAY THE SCREEN      01048009
010490* WITH THAT INFO                                                  01049009
010500                                                                  01050009
010510             IF  DP020-INT-APPL-FORMAT-IND =                      01051009
010520                                      PC-INTER-APPL-PARKING-LIST  01052009
010530                 MOVE TR008-YARD    TO ASC-CURR-FAC-AREA-ID       01053009
010540                                       ACAREAO                    01054009
010550                 MOVE TR008-SPACE   TO ASC-CURR-SUBAREA-OF-ID     01055009
010560                                       ACSUBO                     01056009
010570                 MOVE +6            TO ACAREAL                    01057009
010580                                       ACSUBL                     01058009
010590                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               01059009
010600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             01060009
010611             ELSE                                                 01061109
010620                 PERFORM 4000-BUILD-INITIAL-PANEL                 01062009
010630                 PERFORM 3200-RESET-ATTRIBUTES                    01063009
010640                 PERFORM 3500-SAVE-SCREEN-FIELDS                  01064009
010651             END-IF                                               01065109
010660                                                                  01066009
010670         WHEN OTHER                                               01067009
010680             SET DP013-LOGIC-ABEND TO TRUE                        01068009
010690             SET DP013-NO-ROLLBACK TO TRUE                        01069009
010700             MOVE '1000-CONTROL-PROCESSING'                       01070009
010710                                   TO DP013-PARAGRAPH             01071009
010720             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   01072009
010730                                   TO DP013-MESSAGE-TEXT(1)       01073009
010740             MOVE DP020-NEXT-APPL-ACTIVITY                        01074009
010750                                   TO DP013-MESSAGE-TEXT(2)       01075009
010760             PERFORM DP013-0000-PROCESS-ABEND                     01076009
010770     END-EVALUATE.                                                01077009
010780                                                                  01078009
010790/                                                                 01079009
010800*----------------------------------------------------------------*01080009
010810*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE    *01081009
010820*  INTER-APPLICATION FORMAT CODE.                                *01082009
010830*----------------------------------------------------------------*01083009
010840 1100-FIND-OBJECT-KEYS.                                           01084009
010850                                                                  01085009
010860     INITIALIZE ASC-SPECIFIC-COMMAREA.                            01086009
010870                                                                  01087017
010880     MOVE DP020-INT-APPL-FORMAT-IND                               01088009
010890                                 TO ASC-INT-APPL-FORMAT-IND.      01089009
010900                                                                  01090009
010910                                                                  01091017
010920     EVALUATE DP020-INT-APPL-FORMAT-IND                           01092009
010930                                                                  01093009
010940         WHEN PC-INTER-APPL-CRIT-ADD                              01094009
010950             IF TR005-DELIVERY-SCAC-CDE = SPACES OR               01095009
010960                TR005-TRLR-NBR = SPACES                           01096009
010970                 MOVE PC-TSYMSG-00148                             01097009
010980                                   TO DP020-MSG-NUMBER            01098009
010990                 SET DP020-MSG-FATAL                              01099009
011000                     DP020-NEXT-ACT-APPL-ERROR                    01100009
011010                     PS-ERROR                                     01101009
011020                                   TO TRUE                        01102009
011030             ELSE                                                 01103009
011040                 MOVE TR005-OPER-UNT-ID                           01104009
011050                                 TO ASC-CURR-OPER-UNT-ID          01105009
011060                 MOVE TR005-FCLTY-ID TO ASC-CURR-FCLTY-ID         01106009
011070                 MOVE TR005-DEST-OPER-UNT-ID                      01107009
011080                                 TO ASC-DEST-OPER-UNT-ID          01108009
011090                 MOVE TR005-DEST-FCLTY-ID                         01109009
011100                                 TO ASC-DEST-FCLTY-ID             01110009
011110                 MOVE TR005-DELIVERY-SCAC-CDE                     01111009
011120                                 TO ASC-KEY-OWNER-SCAC-ID         01112009
011130                 MOVE TR005-TRLR-NBR TO ASC-KEY-VEH-NBR           01113009
011140                 IF TR005-CURR-DOCK-AREA = SPACES AND             01114009
011150                    TR005-CURR-DOCK-DOOR = SPACES                 01115009
011160                     MOVE TR005-CURR-YARD-LOC-ID                  01116009
011170                                 TO ASC-KEY-FAC-AREA-ID           01117009
011180                     MOVE TR005-CURR-SPACE-LOC-ID                 01118009
011190                                 TO ASC-KEY-SUBAREA-OF-ID         01119009
011200                 ELSE                                             01120009
011210                     MOVE TR005-CURR-DOCK-AREA                    01121009
011220                                 TO ASC-KEY-FAC-AREA-ID           01122009
011230                     MOVE TR005-CURR-DOCK-DOOR                    01123009
011240                                 TO ASC-KEY-SUBAREA-OF-ID         01124009
011250                 END-IF                                           01125009
011260                 MOVE TR005-STATUS-IND-1 TO ASC-TRIP-STATUS-CDE   01126009
011270                 MOVE TR005-USAGE-IND-1  TO ASC-USAGE-CDE         01127009
011280                 SET ASC-ADD-PENDING TO TRUE                      01128009
011290             END-IF                                               01129009
011300                                                                  01130009
011310         WHEN PC-INTER-APPL-LIST-ADD                              01131009
011320             IF  TR007-NUMBER-OF-SELECTED-ITEMS = ZERO            01132009
011330                 MOVE TR007-OPER-UNT-ID                           01133009
011340                                 TO ASC-CURR-OPER-UNT-ID          01134009
011350                 MOVE TR007-FCLTY-ID                              01135009
011360                                 TO ASC-CURR-FCLTY-ID             01136009
011370                 SET ASC-ADD-PENDING                              01137009
011380                                 TO TRUE                          01138009
011390             ELSE                                                 01139009
011400                 SET ASC-NEW-STOP-PENDING                         01140009
011410                                 TO TRUE                          01141009
011420                 SET ASC-USE-SELECTION-QUEUE                      01142009
011430                                 TO TRUE                          01143009
011440                 MOVE TR007-NUMBER-OF-SELECTED-ITEMS              01144009
011450                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  01145009
011460                 MOVE TR007-NUMBER-OF-TS-ITEMS                    01146009
011470                                 TO ASC-NUMBER-OF-TS-ITEMS        01147009
011480                 MOVE TR007-SEL-QUEUE-NAME                        01148009
011490                                 TO ASC-SEL-QUEUE-NAME            01149009
011500                 PERFORM 1120-PREPARE-LIST-ENTRY                  01150009
011510             END-IF                                               01151009
011520                                                                  01152009
011530         WHEN PC-INTER-APPL-UPDATE                                01153009
011540             IF  TR007-NUMBER-OF-SELECTED-ITEMS = ZERO            01154009
011550                 MOVE PC-TSYMSG-00057                             01155009
011560                                 TO DP020-MSG-NUMBER              01156009
011570                 SET DP020-MSG-WARNING                            01157009
011580                     DP020-NEXT-ACT-APPL-ERROR                    01158009
011590                                 TO TRUE                          01159009
011600             ELSE                                                 01160009
011610                 SET ASC-UPDATE-PENDING                           01161009
011620                                 TO TRUE                          01162009
011630                 SET ASC-USE-SELECTION-QUEUE                      01163009
011640                                 TO TRUE                          01164009
011650                 MOVE TR007-NUMBER-OF-SELECTED-ITEMS              01165009
011660                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  01166009
011670                 MOVE TR007-NUMBER-OF-TS-ITEMS                    01167009
011680                                 TO ASC-NUMBER-OF-TS-ITEMS        01168009
011690                 MOVE TR007-SEL-QUEUE-NAME                        01169009
011700                                 TO ASC-SEL-QUEUE-NAME            01170009
011710                 PERFORM 1120-PREPARE-LIST-ENTRY                  01171009
011720             END-IF                                               01172009
011730                                                                  01173009
011740         WHEN PC-INTER-APPL-DELETE                                01174009
011750             IF  TR007-NUMBER-OF-SELECTED-ITEMS = ZERO            01175009
011760                 MOVE PC-TSYMSG-00057                             01176009
011770                                 TO DP020-MSG-NUMBER              01177009
011780                 SET DP020-MSG-WARNING                            01178009
011790                     DP020-NEXT-ACT-APPL-ERROR                    01179009
011800                     PS-ERROR                                     01180009
011810                                 TO TRUE                          01181009
011820             ELSE                                                 01182009
011830                 SET ASC-DELETE-PENDING                           01183009
011840                                 TO TRUE                          01184009
011850                 SET ASC-USE-SELECTION-QUEUE                      01185009
011860                                 TO TRUE                          01186009
011870                 MOVE TR007-NUMBER-OF-SELECTED-ITEMS              01187009
011880                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  01188009
011890                 MOVE TR007-NUMBER-OF-TS-ITEMS                    01189009
011900                                 TO ASC-NUMBER-OF-TS-ITEMS        01190009
011910                 MOVE TR007-SEL-QUEUE-NAME                        01191009
011920                                 TO ASC-SEL-QUEUE-NAME            01192009
011930                 PERFORM 1120-PREPARE-LIST-ENTRY                  01193009
011940             END-IF                                               01194009
011950                                                                  01195009
011960         WHEN PC-INTER-APPL-ADD-TO-UPD                            01196009
011970             SET ASC-UPDATE-PENDING                               01197009
011980                             TO TRUE                              01198009
011990             MOVE TR005-OPER-UNT-ID                               01199009
012000                             TO ASC-CURR-OPER-UNT-ID              01200009
012010             MOVE TR005-FCLTY-ID TO ASC-CURR-FCLTY-ID             01201009
012020             MOVE TR005-DELIVERY-SCAC-CDE                         01202009
012030                             TO ASC-KEY-OWNER-SCAC-ID             01203009
012040             MOVE TR005-TRLR-NBR TO ASC-KEY-VEH-NBR               01204009
012050             MOVE TR005-TRIP-ID  TO ASC-KEY-TRIP-ID               01205009
012060                                                                  01206009
012070         WHEN PC-INTER-APPL-FCST-UPD                              01207009
012080             IF TR001-OPER-UNT-ID = SPACES OR                     01208009
012090                TR001-FCLTY-ID = SPACES OR                        01209009
012100                TR001-SCAC = SPACES OR                            01210009
012110                TR001-TRLR-NBR = SPACES                           01211009
012120                 MOVE PC-TSYMSG-00007                             01212009
012130                                 TO DP020-MSG-NUMBER              01213009
012140                 SET DP020-MSG-WARNING                            01214009
012150                     DP020-NEXT-ACT-APPL-ERROR                    01215009
012160                     PS-ERROR                                     01216009
012170                                 TO TRUE                          01217009
012180             ELSE                                                 01218009
012190                 SET ASC-UPDATE-PENDING                           01219009
012200                                 TO TRUE                          01220009
012210                 MOVE TR001-OPER-UNT-ID                           01221009
012220                                 TO ASC-CURR-OPER-UNT-ID          01222009
012230                 MOVE TR001-FCLTY-ID                              01223009
012240                                 TO ASC-CURR-FCLTY-ID             01224009
012250                 MOVE TR001-SCAC                                  01225009
012260                                 TO ASC-KEY-OWNER-SCAC-ID         01226009
012270                                    DK-OWNER-SCAC-ID              01227009
012280                 MOVE TR001-TRLR-NBR                              01228009
012290                                 TO ASC-KEY-VEH-NBR               01229009
012300                                    DK-VEH-NBR                    01230009
012310                 PERFORM 4100-SELECT-TVEHICL                      01231009
012320                 IF ASC-VEHICLE-NULL-TRIP OR                      01232009
012330                    ASC-VEHICLE-NOT-SETUP-PREV                    01233009
012340                     MOVE PC-TSYMSG-00743                         01234009
012350                                     TO DP020-MSG-NUMBER          01235009
012360                     SET DP020-MSG-WARNING                        01236009
012370                         DP020-NEXT-ACT-APPL-ERROR                01237009
012380                         PS-ERROR                                 01238009
012390                                     TO TRUE                      01239009
012400                 ELSE                                             01240009
012410                     MOVE VEHICL-CURR-TRIP-ID                     01241009
012420                                 TO ASC-KEY-TRIP-ID               01242009
012430                 END-IF                                           01243009
012440             END-IF                                               01244009
012450                                                                  01245009
012460         WHEN PC-INTER-APPL-TRLR-SPEC                             01246009
012470             IF RC012-TRIP-ID = ZEROES                            01247009
012480                 MOVE PC-TSYMSG-00803                             01248009
012490                                 TO DP020-MSG-NUMBER              01249009
012500                 SET DP020-MSG-WARNING                            01250009
012510                     DP020-NEXT-ACT-APPL-ERROR                    01251009
012520                     PS-ERROR                                     01252009
012530                                 TO TRUE                          01253009
012540             ELSE                                                 01254009
012550                 SET ASC-UPDATE-PENDING                           01255009
012560                                 TO TRUE                          01256009
012570                 MOVE RC012-OPER-UNT-ID                           01257009
012580                                 TO ASC-CURR-OPER-UNT-ID          01258009
012590                 MOVE RC012-FCLTY-ID TO ASC-CURR-FCLTY-ID         01259009
012600                 MOVE RC012-OWNER-SCAC-ID                         01260009
012610                                 TO ASC-KEY-OWNER-SCAC-ID         01261009
012620                 MOVE RC012-VEH-NBR  TO ASC-KEY-VEH-NBR           01262009
012630             END-IF                                               01263009
012640                                                                  01264009
012650         WHEN PC-INTER-APPL-RC-LIST                               01265009
012660             IF  RC015-NUMBER-OF-SELECTED-ITEMS = ZERO            01266009
012670                 MOVE PC-TSYMSG-00057                             01267009
012680                                 TO DP020-MSG-NUMBER              01268009
012690                 SET DP020-MSG-WARNING                            01269009
012700                     DP020-NEXT-ACT-APPL-ERROR                    01270009
012710                                 TO TRUE                          01271009
012720             ELSE                                                 01272009
012730                 SET ASC-UPDATE-PENDING                           01273009
012740                                 TO TRUE                          01274009
012750                 SET ASC-USE-SELECTION-QUEUE                      01275009
012760                                 TO TRUE                          01276009
012770                 MOVE RC015-NUMBER-OF-SELECTED-ITEMS              01277009
012780                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  01278009
012790                 MOVE RC015-NUMBER-OF-TS-ITEMS                    01279009
012800                                 TO ASC-NUMBER-OF-TS-ITEMS        01280009
012810                 MOVE RC015-SEL-QUEUE-NAME                        01281009
012820                                 TO ASC-SEL-QUEUE-NAME            01282009
012830                 PERFORM 1125-PREPARE-LIST-ENTRY                  01283009
012840                 SET ASC-FROM-RC015 TO TRUE                       01284009
012850             END-IF                                               01285009
012860                                                                  01286009
012870         WHEN OTHER                                               01287009
012880             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             01288009
012890             SET DP020-MSG-FATAL                                  01289009
012900                 DP020-NEXT-ACT-APPL-ERROR                        01290009
012910                 PS-ERROR        TO TRUE                          01291009
012920     END-EVALUATE.                                                01292009
012930                                                                  01293009
012940/                                                                 01294009
012950*----------------------------------------------------------------*01295009
012960* ENTRY IS FROM A LIST.  GET THE FORMAT NUMBER FROM THE TEMP     *01296009
012970* STORAGE QUEUE PASSED FROM THE LIST.                            *01297009
012980*----------------------------------------------------------------*01298009
012990 1120-PREPARE-LIST-ENTRY.                                         01299009
013000                                                                  01300009
013010     MOVE TR006-MAX-ITEMS          TO ASC-SEL-SUB.                01301009
013020     MOVE ZERO                     TO ASC-SEL-ITEM.               01302009
013030     PERFORM 2110-GET-NEXT-RECORD.                                01303009
013040                                                                  01304009
013050/                                                                 01305009
013060*----------------------------------------------------------------*01306009
013070* ENTRY IS FROM A LIST.  GET THE FORMAT NUMBER FROM THE TEMP     *01307009
013080* STORAGE QUEUE PASSED FROM THE LIST.                            *01308009
013090*----------------------------------------------------------------*01309009
013100 1125-PREPARE-LIST-ENTRY.                                         01310009
013110                                                                  01311009
013120     MOVE RC013-MAX-ITEMS          TO ASC-SEL-SUB.                01312009
013130     MOVE ZERO                     TO ASC-SEL-ITEM.               01313009
013140     PERFORM 2111-GET-NEXT-RECORD.                                01314009
013150                                                                  01315009
013160/                                                                 01316009
013170*----------------------------------------------------------------*01317009
013180* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *01318009
013190* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *01319009
013200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *01320009
013210* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *01321009
013220* FUNCTION KEYS CAN GET THIS FAR.                                *01322009
013230*----------------------------------------------------------------*01323009
013240                                                                  01324009
013250 2000-PROCESS-PANEL.                                              01325009
013260                                                                  01326009
013270     EVALUATE TRUE                                                01327009
013280         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    01328009
013290             IF  ASC-DELETE-SUCCESSFUL                            01329009
013300                 MOVE PC-TSYMSG-00116                             01330009
013310                                   TO DP020-MSG-NUMBER            01331009
013320                 SET DP020-MSG-FATAL                              01332009
013330                     PS-ERROR      TO TRUE                        01333009
013340                 PERFORM 3200-RESET-ATTRIBUTES                    01334009
013350             ELSE                                                 01335009
013360                 SET DP030-CONTINUE-GO                            01336009
013370                                   TO TRUE                        01337009
013380                 PERFORM 7000-DELETE-VEHICLE                      01338009
013390             END-IF                                               01339009
013400                                                                  01340009
013410         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 01341009
013420             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 01342009
013430             INITIALIZE TR005-INTER-APPL-COMMAREA                 01343009
013440             MOVE ASC-DEST-OPER-UNT-ID                            01344009
013450                                 TO TR005-DEST-OPER-UNT-ID        01345009
013460             MOVE ASC-DEST-FCLTY-ID                               01346009
013470                                 TO TR005-DEST-FCLTY-ID           01347009
013480             MOVE ASC-CURR-OPER-UNT-ID                            01348009
013490                                 TO TR005-OPER-UNT-ID             01349009
013500             MOVE ASC-CURR-FCLTY-ID                               01350009
013510                                 TO TR005-FCLTY-ID                01351009
013520             MOVE ASC-KEY-OWNER-SCAC-ID                           01352009
013530                                 TO TR005-DELIVERY-SCAC-CDE       01353009
013540             MOVE ASC-KEY-VEH-NBR                                 01354009
013550                                 TO TR005-TRLR-NBR                01355009
013560             MOVE ASC-CURR-FAC-AREA-ID                            01356009
013570                                 TO TR005-CURR-YARD-LOC-ID        01357009
013580             MOVE ASC-CURR-SUBAREA-OF-ID                          01358009
013590                                 TO TR005-CURR-SPACE-LOC-ID       01359009
013600             MOVE ASC-CURR-FAC-AREA-ID                            01360009
013610                                 TO TR005-CURR-DOCK-AREA          01361009
013620             MOVE ASC-CURR-SUBAREA-OF-ID                          01362009
013630                                 TO TR005-CURR-DOCK-DOOR          01363009
013650             MOVE SPACES         TO TR005-SCHD-DOCK-AREA          01365091
013670             MOVE SPACES         TO TR005-SCHD-DOCK-DOOR          01367091
013680             MOVE ASC-MANIFEST-NBR                                01368009
013690                                 TO TR005-MANIFEST-NBR            01369009
013700             MOVE ASC-KEY-TRIP-ID                                 01370009
013710                                 TO TR005-TRIP-ID                 01371009
013720                                                                  01372009
013730         WHEN DP020-SRC-AID = DP016-CLEAR                         01373009
013740             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   01374009
013750             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 01375009
013760                                                                  01376009
013770         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    01377009
013780             SET DP030-DONT-ERASE                                 01378009
013790                 DP030-SEND-DATAONLY (PC-APPL-MAP)                01379009
013800                               TO TRUE                            01380009
013810             PERFORM 4000-BUILD-INITIAL-PANEL                     01381009
013820             PERFORM 3200-RESET-ATTRIBUTES                        01382009
013830             PERFORM 3500-SAVE-SCREEN-FIELDS                      01383009
013840                                                                  01384009
013850         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             01385009
013860             IF  ASC-USE-SELECTION-QUEUE                          01386009
013870                 IF ASC-FROM-RC015                                01387009
013880*  THE NEXT AND PREVIOUS CODE IS NOT BEING USED AT THIS TIME, TEST01388009
013890*  BEFORE USING.                                                  01389009
013900                    PERFORM 2111-GET-NEXT-RECORD                  01390009
013910                 ELSE                                             01391009
013920                    PERFORM 2110-GET-NEXT-RECORD                  01392009
013930                 END-IF                                           01393009
013940                 PERFORM 4000-BUILD-INITIAL-PANEL                 01394009
013950                 PERFORM 3200-RESET-ATTRIBUTES                    01395009
013960                 PERFORM 3500-SAVE-SCREEN-FIELDS                  01396009
013970             ELSE                                                 01397009
013980*                --- BOTTOM OF LIST ---                           01398009
013990                 MOVE PC-TSYMSG-00070                             01399009
014000                                   TO DP020-MSG-NUMBER            01400009
014010                 SET DP020-MSG-INFORMATIONAL                      01401009
014020                                   TO TRUE                        01402009
014030             END-IF                                               01403009
014040                                                                  01404009
014050         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             01405009
014060             IF  ASC-USE-SELECTION-QUEUE                          01406009
014070                 IF ASC-FROM-RC015                                01407009
014080                    PERFORM 2121-GET-PREV-RECORD                  01408009
014090                 ELSE                                             01409009
014100                    PERFORM 2120-GET-PREV-RECORD                  01410009
014110                 END-IF                                           01411009
014120                 PERFORM 4000-BUILD-INITIAL-PANEL                 01412009
014130                 PERFORM 3200-RESET-ATTRIBUTES                    01413009
014140                 PERFORM 3500-SAVE-SCREEN-FIELDS                  01414009
014150             ELSE                                                 01415009
014160*                --- TOP OF LIST ---                              01416009
014170                 MOVE PC-TSYMSG-00069                             01417009
014180                                   TO DP020-MSG-NUMBER            01418009
014190                 SET DP020-MSG-INFORMATIONAL                      01419009
014200                                   TO TRUE                        01420009
014210             END-IF                                               01421009
014220                                                                  01422009
014230         WHEN OTHER                                               01423009
014240             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 01424009
014250             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   01425009
014260             IF  PS-NO-ERROR                                      01426009
014270                 SET DP030-CONTINUE-GO                            01427009
014280                                   TO TRUE                        01428009
014290                 PERFORM 2100-CHECK-FUNCTION-KEY                  01429009
014300             ELSE                                                 01430009
014310                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             01431009
014320                 SET DP030-OVERRIDE-GO                            01432009
014330                                   TO TRUE                        01433009
014340             END-IF                                               01434009
014350     END-EVALUATE.                                                01435009
014360                                                                  01436009
014370/                                                                 01437009
014380*----------------------------------------------------------------*01438009
014390* CHECK SCAC, TRAILER NUMBER, AND OPER UNT FOR CHANGES.          *01439064
014400* IF TRAILER HAS BEEN DOWNLOADED TO WMS THESE FIELDS CANNOT BE   *01440064
014500* CHANGED.                                                       *01450064
014600*----------------------------------------------------------------*01460064
014700 2050-CHECK-SCAC-TRLR-OPER.                                       01470064
014800                                                                  01480064
014900* CURR OPER                                                       01490064
015000     IF ASC-CURR-OPER-UNT-ID     NOT = ASC-CURR-OPER-UNT-ID-OLD   01500064
015100        MOVE ASC-CURR-OPER-UNT-ID-OLD TO  DK-OPER-UNT-ID          01510064
015200        PERFORM 4140-SELECT-TKRPRPM                               01520064
015300        IF PS-ASNS-TO-WMS-YES                                     01530064
015400           SET PS-DISPLAY-ERROR   TO TRUE                         01540064
015500           MOVE PC-TSYMSG-03583 TO DP020-MSG-NUMBER               01550064
015600           SET DP020-MSG-WARNING TO TRUE                          01560064
015700        ELSE                                                      01570064
015800           MOVE ASC-CURR-OPER-UNT-ID TO  DK-OPER-UNT-ID           01580064
015900           PERFORM 4140-SELECT-TKRPRPM                            01590064
016000           IF PS-ASNS-TO-WMS-YES                                  01600064
016100              SET PS-DISPLAY-ERROR   TO TRUE                      01610064
016200              MOVE PC-TSYMSG-03583 TO DP020-MSG-NUMBER            01620064
016300              SET DP020-MSG-WARNING TO TRUE                       01630064
016400           END-IF                                                 01640064
016500        END-IF                                                    01650064
016600     END-IF.                                                      01660064
016700                                                                  01670064
016800* DEST OPER                                                       01680064
016900     IF ASC-DEST-OPER-UNT-ID     NOT = ASC-DEST-OPER-UNT-ID-OLD   01690064
017000        MOVE ASC-DEST-OPER-UNT-ID-OLD TO  DK-OPER-UNT-ID          01700064
017100        PERFORM 4140-SELECT-TKRPRPM                               01710064
017200        IF PS-ASNS-TO-WMS-YES                                     01720064
017300           SET PS-DISPLAY-ERROR   TO TRUE                         01730064
017400           MOVE PC-TSYMSG-03583 TO DP020-MSG-NUMBER               01740064
017500           SET DP020-MSG-WARNING TO TRUE                          01750064
017600        ELSE                                                      01760064
017700           MOVE ASC-DEST-OPER-UNT-ID TO  DK-OPER-UNT-ID           01770064
017800           PERFORM 4140-SELECT-TKRPRPM                            01780064
017900           IF PS-ASNS-TO-WMS-YES                                  01790064
018000              SET PS-DISPLAY-ERROR   TO TRUE                      01800064
018100              MOVE PC-TSYMSG-03583 TO DP020-MSG-NUMBER            01810064
018200              SET DP020-MSG-WARNING TO TRUE                       01820064
018300           END-IF                                                 01830064
018400        END-IF                                                    01840064
018500     END-IF.                                                      01850064
018600                                                                  01860064
018700* TRIP STATUS CODE                                                01870064
018800     IF ASC-TRIP-STATUS-CDE NOT = ASC-TRIP-STATUS-CDE-OLD         01880064
018900        IF ASC-TRIP-STATUS-CDE NOT = 'DP'                         01890064
019000           IF PS-ASNS-TO-WMS-YES                                  01900064
019010*** ADD 10/31/08 BEGIN                                            01901065
019100              IF PV-DB2-COUNT-NON-AP-RCVRS > 0                    01910064
019110*** ADD 10/31/08 END                                              01911065
019200                 SET PS-DISPLAY-ERROR   TO TRUE                   01920064
019300                 MOVE PC-TSYMSG-03577   TO DP020-MSG-NUMBER       01930064
019400                 SET DP020-MSG-WARNING  TO TRUE                   01940064
019410*** ADD - BEGIN                                                   01941065
019500              END-IF                                              01950064
019510*** ADD - END                                                     01951065
019600           END-IF                                                 01960064
019700        END-IF                                                    01970064
019800     END-IF.                                                      01980064
019900                                                                  01990064
020000* SCAC CODE                                                       02000064
020100     IF ASC-KEY-OWNER-SCAC-ID NOT = ASC-OWNER-SCAC-ID-OLD         02010064
020200        IF PS-ASNS-TO-WMS-YES                                     02020064
020300           SET PS-DISPLAY-ERROR TO TRUE                           02030064
020400           MOVE PC-TSYMSG-03585 TO DP020-MSG-NUMBER               02040064
020500           SET DP020-MSG-WARNING TO TRUE                          02050064
020600        END-IF                                                    02060064
020700     END-IF.                                                      02070064
020800                                                                  02080064
020900* VEHICLE NUMBER                                                  02090064
021000     IF ASC-KEY-VEH-NBR     NOT = ASC-VEH-NBR-OLD                 02100064
021100        IF PS-ASNS-TO-WMS-YES                                     02110064
021200           SET PS-DISPLAY-ERROR TO TRUE                           02120064
021300           MOVE PC-TSYMSG-03585 TO DP020-MSG-NUMBER               02130064
021400           SET DP020-MSG-WARNING TO TRUE                          02140064
021500        END-IF                                                    02150064
021600     END-IF.                                                      02160064
021601                                                                  02160164
021602*----------------------------------------------------------------*02160209
021603* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*02160309
021604* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *02160409
021605* CICS ARCHITECTURE API.                                         *02160509
021606*----------------------------------------------------------------*02160609
021607 2100-CHECK-FUNCTION-KEY.                                         02160709
021608                                                                  02160809
021609     EVALUATE TRUE                                                02160909
021610         WHEN DP020-SRC-AID = DP016-ENTER                         02161009
021611             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02161109
021612                                                                  02161209
021613         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              02161309
021614             SET DP030-CONTINUE-GO TO TRUE                        02161409
021615             IF  ASC-VEHICLE-NOT-SETUP-PREV OR                    02161509
021616                 ASC-VEHICLE-NULL-TRIP                            02161609
021617                 PERFORM 5000-ADD-VEHICLE                         02161709
021618                 SET ASC-NEW-STOP-PENDING TO TRUE                 02161809
021619                 MOVE VHTRIP-REF-TRIP-ID                          02161909
021620                                       TO ASC-REF-TRIP-ID         02162009
021621             ELSE                                                 02162109
021622                IF  ASC-NEW-STOP-PENDING                          02162209
021623                    PERFORM 5010-ADD-TRIP                         02162309
021624                END-IF                                            02162409
021625             END-IF                                               02162509
021626                                                                  02162609
021627         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              02162709
021628                                                                  02162840
021629             PERFORM 3600-CHECK-IF-FIELDS-CHANGED                 02162909
021630             IF  ASC-FIELDS-CHANGED                               02163009
021640                 MOVE ASC-DEST-OPER-UNT-ID TO DK-OPER-UNT-ID      02164064
021641                 PERFORM 4140-SELECT-TKRPRPM                      02164164
021642                 MOVE ASC-TRIP-STATUS-CDE-OLD                     02164209
021643                                 TO DK-TRIP-STATUS-CDE            02164309
021644                 PERFORM 5120-GET-PRTY-CDE                        02164409
021645                 MOVE ASC-TRIP-STATUS-CDE                         02164509
021646                                 TO DK-TRIP-STATUS-CDE            02164609
021647                                                                  02164765
021648*** ADDED - 10/31/08 - BEGIN                                      02164865
021649                 MOVE ASC-KEY-TRIP-ID                             02164964
021650                                 TO DK-TRIP-ID                    02165064
021651                 PERFORM 2410-CHECK-AP-ON-TRECEIV                 02165109
021652*** ADDED - 10/31/08 - END                                        02165265
021653                                                                  02165365
021654                 PERFORM 2050-CHECK-SCAC-TRLR-OPER                02165409
021660                 PERFORM 6200-OPEN-RECEIVR-CSR                    02166064
021670                 PERFORM UNTIL ASC-AUTO-VE-SW   = 'Y'             02167064
021680                          OR   PS-NO-MORE-RECEIVRS                02168064
021690                     PERFORM 6210-FETCH-RECEIVR-CSR               02169064
021700                 END-PERFORM                                      02170064
021800                 PERFORM 6220-CLOSE-RECEIVR-CSR                   02180064
021900                                                                  02190064
022000                 IF ASC-TRIP-STATUS-CDE NOT =                     02200064
022100                                     ASC-TRIP-STATUS-CDE-OLD      02210064
022200                    PERFORM 2105-EVALUATE-STAT-CDE                02220064
022300                 END-IF                                           02230064
022301                                                                  02230164
022302               IF NOT PS-DISPLAY-ERROR                            02230209
022303                 IF ASC-TRIP-STATUS-CDE = 'DP' OR                 02230309
022304                    ASC-TRIP-STATUS-CDE = 'ET'                    02230409
022305                     SET PS-DONT-DISPLAY-ERROR TO TRUE            02230509
022306                     MOVE ZERO TO PV-DB2-COUNT                    02230609
022307                     MOVE ASC-KEY-TRIP-ID      TO SHIPMT-TRIP-ID  02230709
022308** CHECKING FOR NO PRO                                            02230841
022309                     PERFORM 3700-SELECT-TSHIPMT                  02230909
022310                     IF PV-DB2-COUNT > ZERO                       02231009
022311                         SET PS-DISPLAY-ERROR TO TRUE             02231109
022312                         MOVE PC-TSYMSG-01058  TO DP020-MSG-NUMBER02231209
022313                     ELSE                                         02231309
022314                         MOVE ASC-TRIP-STATUS-CDE                 02231409
022315                                   TO TRIPST-TRIP-STATUS-CDE      02231509
022316                         MOVE ASC-KEY-TRIP-ID                     02231609
022317                                   TO TRIPST-TRIP-ID              02231709
022318** CHECKING FOR ARRIVED                                           02231841
022319                         PERFORM 5420-CHECK-ARRIVAL               02231909
022320                         IF PS-UPDATE-REC                         02232009
022321                             SET PS-DISPLAY-ERROR TO TRUE         02232109
022322                             MOVE PC-TSYMSG-01076                 02232209
022323                                               TO DP020-MSG-NUMBER02232309
022324                         END-IF                                   02232409
022325                     END-IF                                       02232509
022326                     IF PS-DISPLAY-ERROR                          02232609
022327                         SET DP020-MSG-INFORMATIONAL              02232709
022328                                           TO TRUE                02232809
022329                     ELSE                                         02232909
022330                         SET DP030-CONTINUE-GO                    02233009
022331                                           TO TRUE                02233109
022332                         PERFORM 6000-UPDATE-VEHICLE              02233209
022333                     END-IF                                       02233309
022334                 ELSE                                             02233409
022335*** START PRB0057005                                              02233584
022336                   IF ASC-TRIP-STATUS-CDE = 'UG' OR               02233684
022337                      ASC-TRIP-STATUS-CDE = 'UN'                  02233784
022338                      MOVE ASC-TRIP-STATUS-CDE                    02233884
022339                                         TO TRIPST-TRIP-STATUS-CDE02233984
022340                      MOVE ASC-KEY-TRIP-ID                        02234084
022341                                         TO TRIPST-TRIP-ID        02234184
022342                      PERFORM 5420-CHECK-ARRIVAL                  02234284
022343                      IF PS-UPDATE-REC                            02234384
022344                         SET PS-DISPLAY-ERROR TO TRUE             02234484
022346                         MOVE PC-TSYMSG-03774 TO DP020-MSG-NUMBER 02234686
022347                      END-IF                                      02234784
022348                      IF PS-DISPLAY-ERROR                         02234884
022349                         SET DP020-MSG-FATAL  TO TRUE             02234987
022351                      ELSE                                        02235184
022356                         SET DP030-CONTINUE-GO                    02235684
022357                                         TO TRUE                  02235784
022358                         PERFORM 6000-UPDATE-VEHICLE              02235884
022359                      END-IF                                      02235984
022360                   ELSE                                           02236085
022361                      SET DP030-CONTINUE-GO                       02236185
022362                                         TO TRUE                  02236285
022363                      PERFORM 6000-UPDATE-VEHICLE                 02236385
022365                   END-IF                                         02236584
022366*** END PRB0057005                                                02236684
022367                 END-IF                                           02236709
022368              END-IF                                              02236809
022369             ELSE                                                 02236909
022370                 MOVE PC-TSYMSG-00046                             02237009
022371                                   TO DP020-MSG-NUMBER            02237109
022372                 SET DP020-MSG-INFORMATIONAL                      02237209
022373                                   TO TRUE                        02237309
022374          END-IF                                                  02237437
022375*        END-IF                                                   02237539
022376                                                                  02237609
022377         WHEN OTHER                                               02237709
022378             SET DP013-NO-ROLLBACK                                02237809
022379                 DP013-XCTL-DISPLAY-RESTART                       02237909
022380                 DP013-CICS-ABEND  TO TRUE                        02238009
022381             MOVE '2100-CHECK-FUNCTION-KEY'                       02238109
022382                                   TO DP013-PARAGRAPH             02238209
022383             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      02238309
022384                                   TO DP013-MESSAGE-TEXT (1)      02238409
022385             PERFORM DP013-0000-PROCESS-ABEND                     02238509
022386     END-EVALUATE.                                                02238609
022387                                                                  02238709
022388/                                                                 02238809
022389 2105-EVALUATE-STAT-CDE.                                          02238964
022390                                                                  02239064
022391** DELIVER AT KOHLS - UNLOADED                                    02239164
022392     IF ASC-TRIP-STATUS-CDE = 'UN'                                02239264
022400        AND (TRSTYP-PRTY-CDE  > '49' AND  < '70')                 02240064
022500        MOVE SPACES   TO ASC-AUTO-VE-SW                           02250064
022600        MOVE 'N'      TO PS-NO-MORE-RECEIVRS-SW                   02260064
022700        MOVE ASC-KEY-TRIP-ID   TO DK-TRIP-ID                      02270064
022800*SLH THIS WAS MOVED TO PERFORM HIGHER UP IN IF STATMENT IN 2100-  02280064
022900*       PERFORM 6200-OPEN-RECEIVR-CSR                             02290064
023000*       PERFORM UNTIL ASC-AUTO-VE-SW   = 'Y'                      02300064
023100*                OR   PS-NO-MORE-RECEIVRS                         02310064
023200*           PERFORM 6210-FETCH-RECEIVR-CSR                        02320064
023300*       END-PERFORM                                               02330064
023400*       PERFORM 6220-CLOSE-RECEIVR-CSR                            02340064
023500        IF PS-ASNS-TO-WMS-YES                                     02350064
023510*** ADD - 10/31/08 - BEGIN                                        02351065
023600           IF PV-DB2-COUNT-NON-AP-RCVRS > 0                       02360064
023610*** ADD - 10/31/08 - END                                          02361065
023700              SET PS-DISPLAY-ERROR TO TRUE                        02370064
023800              MOVE PC-TSYMSG-03577 TO DP020-MSG-NUMBER            02380064
023900              SET DP020-MSG-WARNING                               02390064
024000                                   TO TRUE                        02400064
024010*** ADD - 10/31/08 - BEGIN                                        02401065
024100           END-IF                                                 02410064
024110*** ADD - 10/31/08 - END                                          02411065
024200        ELSE                                                      02420064
024300           IF ASC-AUTO-VE                                         02430064
024400             SET PS-DISPLAY-ERROR  TO TRUE                        02440064
024500             MOVE PC-TSYMSG-03217  TO DP020-MSG-NUMBER            02450064
024600           END-IF                                                 02460064
024700        END-IF                                                    02470064
024800     ELSE                                                         02480064
024900        IF ASC-TRIP-STATUS-CDE = 'DP'                             02490064
025000          IF TRSTYP-PRTY-CDE  < 70                                02500064
025100**  < UNLOADED                                                    02510064
025200            MOVE SPACES   TO ASC-AUTO-VE-SW                       02520064
025300            MOVE 'N'      TO PS-NO-MORE-RECEIVRS-SW               02530064
025400            MOVE ASC-KEY-TRIP-ID   TO DK-TRIP-ID                  02540064
025500*SLH THIS WAS MOVED TO PERFORM HIGHER UP IN IF STATMENT IN 2100-  02550064
025600*           PERFORM 6200-OPEN-RECEIVR-CSR                         02560064
025700*           PERFORM UNTIL ASC-AUTO-VE-SW   = 'Y'                  02570064
025800*                   OR   PS-NO-MORE-RECEIVRS                      02580064
025900*               PERFORM 6210-FETCH-RECEIVR-CSR                    02590064
026000*           END-PERFORM                                           02600064
026100*           PERFORM 6220-CLOSE-RECEIVR-CSR                        02610064
026200                                                                  02620064
026300            IF PS-ASNS-TO-WMS-YES                                 02630064
026400               PERFORM 2400-SHIPMT-FOR-TRIP                       02640064
026500               IF PV-DB2-COUNT-SHIPS = ZERO                       02650064
026600                  PERFORM 2450-CHECK-AR-ON-TRIPST                 02660064
026700                  IF PS-AR-TRIPST-NO                              02670064
026800                    MOVE 'AR' TO TRIPST-TRIP-STATUS-CDE           02680064
026900* JAK 08/2007 - LOAD KEY FIELDS                                   02690064
027000                    MOVE DK-OPER-UNT-ID   TO TRIPST-OPER-UNT-ID   02700064
027100                    MOVE DK-TRIP-ID       TO TRIPST-TRIP-ID       02710064
027200                    MOVE DK-FCLTY-ID      TO TRIPST-FCLTY-ID      02720064
027300                    MOVE DK-FCLTY-AREA-ID TO TRIPST-FCLTY-AREA-ID 02730064
027400                    PERFORM 5400-INSERT-TTRIPST                   02740064
027500                  END-IF                                          02750064
027600               ELSE                                               02760064
027700                   SET PS-DISPLAY-ERROR TO TRUE                   02770064
027800                   MOVE PC-TSYMSG-03579                           02780064
027900                             TO DP020-MSG-NUMBER                  02790064
028000                   SET DP020-MSG-WARNING                          02800064
028100                             TO TRUE                              02810064
028200               END-IF                                             02820064
028300            ELSE                                                  02830064
028400                IF ASC-AUTO-VE                                    02840064
028500                    SET PS-DISPLAY-ERROR TO TRUE                  02850064
028600                    MOVE PC-TSYMSG-03247                          02860064
028700                                 TO DP020-MSG-NUMBER              02870064
028800                END-IF                                            02880064
028900            END-IF                                                02890064
029000          ELSE                                                    02900064
029100              CONTINUE                                            02910064
029200          END-IF                                                  02920064
029300        ELSE                                                      02930064
029400            IF PS-ASNS-TO-WMS-YES                                 02940064
029410*** ADD - 10/31/08 - BEGIN                                        02941065
029500               IF PV-DB2-COUNT-NON-AP-RCVRS > 0                   02950064
029510*** ADD - 10/31/08 - END                                          02951065
029600                  SET PS-DISPLAY-ERROR TO TRUE                    02960064
029700                  MOVE PC-TSYMSG-03577 TO DP020-MSG-NUMBER        02970064
029800                  SET DP020-MSG-WARNING                           02980064
029900                                       TO TRUE                    02990064
029910*** ADD - 10/31/08 - BEGIN                                        02991065
030000               END-IF                                             03000064
030010*** ADD - 10/31/08 - END                                          03001065
030100            END-IF                                                03010064
030200        END-IF                                                    03020064
030300     END-IF.                                                      03030064
030301                                                                  03030164
030302 2110-GET-NEXT-RECORD.                                            03030209
030303                                                                  03030309
030304     ADD +1                        TO ASC-SEL-SUB.                03030409
030305     IF  ASC-SEL-SUB > TR006-MAX-ITEMS                            03030509
030306         ADD +1                    TO ASC-SEL-ITEM                03030609
030307         MOVE +1                   TO ASC-SEL-SUB                 03030709
030308     END-IF.                                                      03030809
030309                                                                  03030909
030310     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                03031009
030311         IF  ASC-DELETE-PENDING                                   03031109
030312             MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER            03031209
030313             SET DP020-MSG-INFORMATIONAL                          03031309
030314                                   TO TRUE                        03031409
030315             IF  ASC-DELETE-SUCCESSFUL                            03031509
030316                 MOVE SPACES       TO ASC-DELETE-SUCCESSFUL-SW    03031609
030317             END-IF                                               03031709
030318         END-IF                                                   03031809
030319         PERFORM 9100-READ-SEL-QUEUE                              03031909
030320         IF  TR006-ITEM (ASC-SEL-SUB) > ZERO                      03032009
030321             MOVE TR006-OPER-UNT-ID (ASC-SEL-SUB)                 03032109
030322                                   TO ASC-CURR-OPER-UNT-ID        03032209
030323             MOVE TR006-FCLTY-ID (ASC-SEL-SUB)                    03032309
030324                                   TO ASC-CURR-FCLTY-ID           03032409
030325             MOVE TR006-OWNER-SCAC-ID (ASC-SEL-SUB)               03032509
030326                                   TO ASC-KEY-OWNER-SCAC-ID       03032609
030327             MOVE TR006-VEH-NBR (ASC-SEL-SUB)                     03032709
030328                                   TO ASC-KEY-VEH-NBR             03032809
030329             MOVE TR006-TRIP-ID (ASC-SEL-SUB)                     03032909
030330                                   TO ASC-KEY-TRIP-ID             03033009
030331             SET TR006-INQ (ASC-SEL-SUB)                          03033109
030332                                   TO TRUE                        03033209
030333             PERFORM 9200-REWRITE-LIST-QUEUE                      03033309
030334         ELSE                                                     03033409
030335             SUBTRACT +1 FROM ASC-SEL-SUB                         03033509
030336*            --- BOTTOM OF LIST ---                               03033609
030337             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            03033709
030338             SET DP020-MSG-INFORMATIONAL                          03033809
030339                                   TO TRUE                        03033909
030340         END-IF                                                   03034009
030341     ELSE                                                         03034109
030342         SUBTRACT +1 FROM ASC-SEL-ITEM                            03034209
030343         MOVE TR006-MAX-ITEMS      TO ASC-SEL-SUB                 03034309
030344         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            03034409
030345         SET DP020-MSG-INFORMATIONAL                              03034509
030346                                   TO TRUE                        03034609
030347     END-IF.                                                      03034709
030348                                                                  03034809
030349/                                                                 03034909
030350 2111-GET-NEXT-RECORD.                                            03035009
030351                                                                  03035109
030352     ADD +1                        TO ASC-SEL-SUB.                03035209
030353     IF  ASC-SEL-SUB > RC013-MAX-ITEMS                            03035309
030354         ADD +1                    TO ASC-SEL-ITEM                03035409
030355         MOVE +1                   TO ASC-SEL-SUB                 03035509
030356     END-IF.                                                      03035609
030357                                                                  03035709
030358     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                03035809
030359         PERFORM 9110-READ-SEL-QUEUE                              03035909
030360         IF  RC013-ITEM (ASC-SEL-SUB) > ZERO                      03036009
030361             MOVE RC013-OPER-UNT-ID (ASC-SEL-SUB)                 03036109
030362                                   TO ASC-CURR-OPER-UNT-ID        03036209
030363             MOVE RC013-FCLTY-ID (ASC-SEL-SUB)                    03036309
030364                                   TO ASC-CURR-FCLTY-ID           03036409
030365             MOVE RC013-OWNER-SCAC-ID (ASC-SEL-SUB)               03036509
030366                                   TO ASC-KEY-OWNER-SCAC-ID       03036609
030367             MOVE RC013-VEH-NBR (ASC-SEL-SUB)                     03036709
030368                                   TO ASC-KEY-VEH-NBR             03036809
030369             MOVE RC013-TRIP-ID (ASC-SEL-SUB)                     03036909
030370                                   TO ASC-KEY-TRIP-ID             03037009
030371*            SET TR006-INQ (ASC-SEL-SUB)                          03037109
030372*                                  TO TRUE                        03037209
030373             PERFORM 9210-REWRITE-LIST-QUEUE                      03037309
030374         ELSE                                                     03037409
030375             SUBTRACT +1 FROM ASC-SEL-SUB                         03037509
030376*            --- BOTTOM OF LIST ---                               03037609
030377             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            03037709
030378             SET DP020-MSG-INFORMATIONAL                          03037809
030379                                   TO TRUE                        03037909
030380         END-IF                                                   03038009
030381     ELSE                                                         03038109
030382         SUBTRACT +1 FROM ASC-SEL-ITEM                            03038209
030383         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 03038309
030384         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            03038409
030385         SET DP020-MSG-INFORMATIONAL                              03038509
030386                                   TO TRUE                        03038609
030387     END-IF.                                                      03038709
030388                                                                  03038809
030389/                                                                 03038909
030390 2120-GET-PREV-RECORD.                                            03039009
030391                                                                  03039109
030392     SUBTRACT +1 FROM ASC-SEL-SUB.                                03039209
030393     IF  ASC-SEL-SUB < +1                                         03039309
030394         SUBTRACT +1 FROM ASC-SEL-ITEM                            03039409
030395         MOVE TR006-MAX-ITEMS      TO ASC-SEL-SUB                 03039509
030396     END-IF.                                                      03039609
030397                                                                  03039709
030398     IF  ASC-SEL-ITEM > ZERO                                      03039809
030399         IF  ASC-DELETE-PENDING                                   03039909
030400             MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER            03040009
030401             SET DP020-MSG-INFORMATIONAL                          03040109
030402                                   TO TRUE                        03040209
030403             IF  ASC-DELETE-SUCCESSFUL                            03040309
030404                 MOVE SPACES       TO ASC-DELETE-SUCCESSFUL-SW    03040409
030405             END-IF                                               03040509
030406         END-IF                                                   03040609
030407         PERFORM 9100-READ-SEL-QUEUE                              03040709
030408         MOVE TR006-OPER-UNT-ID (ASC-SEL-SUB)                     03040809
030409                                   TO ASC-CURR-OPER-UNT-ID        03040909
030410         MOVE TR006-FCLTY-ID (ASC-SEL-SUB)                        03041009
030411                                   TO ASC-CURR-FCLTY-ID           03041109
030412         MOVE TR006-OWNER-SCAC-ID (ASC-SEL-SUB)                   03041209
030413                                   TO ASC-KEY-OWNER-SCAC-ID       03041309
030414         MOVE TR006-VEH-NBR (ASC-SEL-SUB)                         03041409
030415                                   TO ASC-KEY-VEH-NBR             03041509
030416         MOVE TR006-TRIP-ID (ASC-SEL-SUB)                         03041609
030417                                   TO ASC-KEY-TRIP-ID             03041709
030418     ELSE                                                         03041809
030419         MOVE +1                   TO ASC-SEL-ITEM                03041909
030420                                      ASC-SEL-SUB                 03042009
030421*        --- TOP OF LIST ---                                      03042109
030422         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            03042209
030423         SET DP020-MSG-INFORMATIONAL                              03042309
030424                                   TO TRUE                        03042409
030425     END-IF.                                                      03042509
030426                                                                  03042609
030427 2121-GET-PREV-RECORD.                                            03042709
030428                                                                  03042809
030429     SUBTRACT +1 FROM ASC-SEL-SUB.                                03042909
030430     IF  ASC-SEL-SUB < +1                                         03043009
030431         SUBTRACT +1 FROM ASC-SEL-ITEM                            03043109
030432         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 03043209
030433     END-IF.                                                      03043309
030434                                                                  03043409
030435     IF  ASC-SEL-ITEM > ZERO                                      03043509
030436         IF  ASC-DELETE-PENDING                                   03043609
030437             MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER            03043709
030438             SET DP020-MSG-INFORMATIONAL                          03043809
030439                                   TO TRUE                        03043909
030440             IF  ASC-DELETE-SUCCESSFUL                            03044009
030441                 MOVE SPACES       TO ASC-DELETE-SUCCESSFUL-SW    03044109
030442             END-IF                                               03044209
030443         END-IF                                                   03044309
030444         PERFORM 9100-READ-SEL-QUEUE                              03044409
030445         MOVE RC013-OPER-UNT-ID (ASC-SEL-SUB)                     03044509
030446                                   TO ASC-CURR-OPER-UNT-ID        03044609
030447         MOVE RC013-FCLTY-ID (ASC-SEL-SUB)                        03044709
030448                                   TO ASC-CURR-FCLTY-ID           03044809
030449         MOVE RC013-OWNER-SCAC-ID (ASC-SEL-SUB)                   03044909
030450                                   TO ASC-KEY-OWNER-SCAC-ID       03045009
030451         MOVE RC013-VEH-NBR (ASC-SEL-SUB)                         03045109
030452                                   TO ASC-KEY-VEH-NBR             03045209
030453         MOVE RC013-TRIP-ID (ASC-SEL-SUB)                         03045309
030454                                   TO ASC-KEY-TRIP-ID             03045409
030455     ELSE                                                         03045509
030456         MOVE +1                   TO ASC-SEL-ITEM                03045609
030457                                      ASC-SEL-SUB                 03045709
030458*        --- TOP OF LIST ---                                      03045809
030459         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            03045909
030460         SET DP020-MSG-INFORMATIONAL                              03046009
030461                                   TO TRUE                        03046109
030462     END-IF.                                                      03046209
030463                                                                  03046309
030464/                                                                 03046409
030465*----------------------------------------------------------------*03046509
030466*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *03046609
030467*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *03046709
030468*----------------------------------------------------------------*03046809
030469 2200-MOVE-SCREEN-TO-COMMAREA.                                    03046909
030470                                                                  03047009
030471     IF  ASCACL > ZERO                                            03047109
030472         MOVE ASCACI             TO ASC-KEY-OWNER-SCAC-ID         03047209
030473     ELSE                                                         03047309
030474         IF  ASCACF = DP015-ERASE-EOF                             03047409
030475             MOVE SPACES         TO ASC-KEY-OWNER-SCAC-ID         03047509
030476         END-IF                                                   03047609
030477     END-IF.                                                      03047709
030478                                                                  03047809
030479     IF  ATRLRL > ZERO                                            03047909
030480         MOVE ATRLRI             TO ASC-KEY-VEH-NBR               03048009
030481     ELSE                                                         03048109
030482         IF  ATRLRF = DP015-ERASE-EOF                             03048209
030483             MOVE SPACES         TO ASC-KEY-VEH-NBR               03048309
030484         END-IF                                                   03048409
030485     END-IF.                                                      03048509
030486                                                                  03048609
030487     IF  ACSHPMML > ZERO                                          03048709
030488         MOVE ACSHPMMI           TO ASC-OWNR-SCAC-SHP-MM          03048809
030489     ELSE                                                         03048909
030490         IF ACSHPMMF = DP015-ERASE-EOF                            03049009
030491            MOVE SPACES          TO ASC-OWNR-SCAC-SHP-MM          03049109
030492         END-IF                                                   03049209
030493     END-IF.                                                      03049309
030494                                                                  03049409
030495     IF  ACSHPDDL > ZERO                                          03049509
030496         MOVE ACSHPDDI           TO ASC-OWNR-SCAC-SHP-DD          03049609
030497     ELSE                                                         03049709
030498         IF ACSHPDDF = DP015-ERASE-EOF                            03049809
030499            MOVE SPACES          TO ASC-OWNR-SCAC-SHP-DD          03049909
030500         END-IF                                                   03050009
030501     END-IF.                                                      03050109
030502                                                                  03050209
030503     IF  ACSHPYYL > ZERO                                          03050309
030504         MOVE ACSHPYYI           TO ASC-OWNR-SCAC-SHP-CCYY        03050409
030505     ELSE                                                         03050509
030506         IF ACSHPYYF = DP015-ERASE-EOF                            03050609
030507            MOVE SPACES          TO ASC-OWNR-SCAC-SHP-CCYY        03050709
030508         END-IF                                                   03050809
030509     END-IF.                                                      03050909
030510                                                                  03051009
030511     IF  AUSEL > ZERO                                             03051109
030512         MOVE AUSEI              TO ASC-USAGE-CDE                 03051209
030513     ELSE                                                         03051309
030514         IF  AUSEF = DP015-ERASE-EOF                              03051409
030515             MOVE SPACES         TO ASC-USAGE-CDE                 03051509
030516         END-IF                                                   03051609
030517     END-IF.                                                      03051709
030518                                                                  03051809
030519     IF  ALGTHL > ZERO                                            03051909
030520         MOVE ALGTHI             TO ASC-LENGTH                    03052009
030521     ELSE                                                         03052109
030522         IF  ALGTHF = DP015-ERASE-EOF                             03052209
030523             MOVE SPACES         TO ASC-LENGTH                    03052309
030524         END-IF                                                   03052409
030525     END-IF.                                                      03052509
030526                                                                  03052609
030527     IF  ACOPERL > ZERO                                           03052709
030528         MOVE ACOPERI            TO ASC-CURR-OPER-UNT-ID          03052809
030529     ELSE                                                         03052909
030530         IF  ACOPERF = DP015-ERASE-EOF                            03053009
030531             MOVE SPACES         TO ASC-CURR-OPER-UNT-ID          03053109
030532         END-IF                                                   03053209
030533     END-IF.                                                      03053309
030534                                                                  03053409
030535     IF  ACFIDL > ZERO                                            03053509
030536         MOVE ACFIDI             TO ASC-CURR-FCLTY-ID             03053609
030537     ELSE                                                         03053709
030538         IF  ACFIDF = DP015-ERASE-EOF                             03053809
030539             MOVE SPACES         TO ASC-CURR-FCLTY-ID             03053909
030540         END-IF                                                   03054009
030541     END-IF.                                                      03054109
030542                                                                  03054209
030543*  VEHICLE TYPE CODE                                              03054309
030544     IF  ATRIPTPL > ZERO                                          03054409
030545         MOVE ATRIPTPI           TO ASC-VEH-TYP-CDE               03054509
030546     ELSE                                                         03054609
030547         IF  ATRIPTPF = DP015-ERASE-EOF                           03054709
030548             MOVE SPACES         TO ASC-VEH-TYP-CDE               03054809
030549         END-IF                                                   03054909
030550     END-IF.                                                      03055009
030551                                                                  03055109
030552     IF  ACAREAL > ZERO                                           03055209
030553         MOVE ACAREAI            TO ASC-CURR-FAC-AREA-ID          03055309
030554         MOVE SPACES             TO ASC-CURR-FAC-AREA-ID-DESC     03055409
030555                                    ACAREADO                      03055509
030556     ELSE                                                         03055609
030557         IF  ACAREAF = DP015-ERASE-EOF                            03055709
030558             MOVE SPACES         TO ASC-CURR-FAC-AREA-ID          03055809
030559                                    ASC-CURR-FAC-AREA-ID-DESC     03055909
030560                                    ACAREADO                      03056009
030561         END-IF                                                   03056109
030562     END-IF.                                                      03056209
030563                                                                  03056309
030564     IF  ACSUBL > ZERO                                            03056409
030565         MOVE ACSUBI             TO ASC-CURR-SUBAREA-OF-ID        03056509
030566         MOVE SPACES             TO ASC-CURR-SUBAREA-OF-ID-DESC   03056609
030567                                    ACSUBDO                       03056709
030568     ELSE                                                         03056809
030569         IF  ACSUBF = DP015-ERASE-EOF                             03056909
030570             MOVE SPACES         TO ASC-CURR-SUBAREA-OF-ID        03057009
030571                                    ASC-CURR-SUBAREA-OF-ID-DESC   03057109
030572                                    ACSUBDO                       03057209
030573         END-IF                                                   03057309
030574     END-IF.                                                      03057409
030575                                                                  03057509
030576     IF  ADOPERL > ZERO                                           03057609
030577         MOVE ADOPERI            TO ASC-DEST-OPER-UNT-ID          03057709
030578     ELSE                                                         03057809
030579         IF  ADOPERF = DP015-ERASE-EOF                            03057909
030580             MOVE SPACES         TO ASC-DEST-OPER-UNT-ID          03058009
030581         END-IF                                                   03058109
030582     END-IF.                                                      03058209
030583                                                                  03058309
030584     IF  ADFIDL > ZERO                                            03058409
030585         MOVE ADFIDI             TO ASC-DEST-FCLTY-ID             03058509
030586         MOVE SPACES             TO ASC-DEST-FCLTY-NME            03058609
030587                                    ADFIDDO                       03058709
030588     ELSE                                                         03058809
030589         IF  ADFIDF = DP015-ERASE-EOF                             03058909
030590             MOVE SPACES         TO ASC-DEST-FCLTY-ID             03059009
030591                                    ASC-DEST-FCLTY-NME            03059109
030592                                    ADFIDDO                       03059209
030593         END-IF                                                   03059309
030594     END-IF.                                                      03059409
030595                                                                  03059509
030596     IF  ADAREAL > ZERO                                           03059609
030597         MOVE ADAREAI            TO ASC-DEST-FAC-AREA-ID          03059709
030598         MOVE SPACES             TO ASC-DEST-FAC-AREA-ID-DESC     03059809
030599                                    ADAREADO                      03059909
030600     ELSE                                                         03060009
030601         IF  ADAREAF = DP015-ERASE-EOF                            03060109
030602             MOVE SPACES         TO ASC-DEST-FAC-AREA-ID          03060209
030603                                    ASC-DEST-FAC-AREA-ID-DESC     03060309
030604                                    ADAREADO                      03060409
030605         END-IF                                                   03060509
030606     END-IF.                                                      03060609
030607                                                                  03060709
030608     IF  ADSUBL > ZERO                                            03060809
030609         MOVE ADSUBI             TO ASC-DEST-SUBAREA-OF-ID        03060909
030610     ELSE                                                         03061009
030611         IF  ADSUBF = DP015-ERASE-EOF                             03061109
030612             MOVE SPACES         TO ASC-DEST-SUBAREA-OF-ID        03061209
030613                                    ASC-DEST-SUBAREA-OF-ID-DESC   03061309
030614                                    ADSUBDO                       03061409
030615         END-IF                                                   03061509
030616     END-IF.                                                      03061609
030617                                                                  03061709
030618     IF  ATRIPSL > ZERO                                           03061809
030619         MOVE ATRIPSI            TO ASC-TRIP-STATUS-CDE           03061909
030620     ELSE                                                         03062009
030621         IF  ATRIPSF = DP015-ERASE-EOF                            03062109
030622             MOVE SPACES         TO ASC-TRIP-STATUS-CDE           03062209
030623                                    ASC-TRIP-STATUS-DESC          03062309
030624                                    ATRIPSDO                      03062409
030625         END-IF                                                   03062509
030626     END-IF.                                                      03062609
030627                                                                  03062709
030628     IF  AMANL > ZERO                                             03062809
030629         MOVE AMANI              TO ASC-MANIFEST-NBR              03062909
030630     ELSE                                                         03063009
030631         IF  AMANF = DP015-ERASE-EOF                              03063109
030632             MOVE SPACES         TO ASC-MANIFEST-NBR              03063209
030633         END-IF                                                   03063309
030634     END-IF.                                                      03063409
030635                                                                  03063509
030636     IF  ASEAL1L > ZERO                                           03063609
030637         MOVE ASEAL1I            TO ASC-SEAL-1                    03063709
030638     ELSE                                                         03063809
030639         IF  ASEAL1F = DP015-ERASE-EOF                            03063909
030640             MOVE SPACES         TO ASC-SEAL-1                    03064009
030641         END-IF                                                   03064109
030642     END-IF.                                                      03064209
030643                                                                  03064309
030644*    IF  ASEAL2L > ZERO                                           03064409
030645*        MOVE ASEAL2I            TO ASC-SEAL-2                    03064509
030646*    ELSE                                                         03064609
030647*        IF  ASEAL2F = DP015-ERASE-EOF                            03064709
030648*            MOVE SPACES         TO ASC-SEAL-2                    03064809
030649*        END-IF                                                   03064909
030650*    END-IF.                                                      03065009
030651                                                                  03065109
030652     IF  AETAMML > ZERO                                           03065209
030653         MOVE AETAMMI             TO ASC-ETA-DTE-MM               03065309
030654     ELSE                                                         03065409
030655         IF  AETAMMF = DP015-ERASE-EOF                            03065509
030656             MOVE SPACE           TO ASC-ETA-DTE-MM               03065609
030657         END-IF                                                   03065709
030658     END-IF.                                                      03065809
030659                                                                  03065909
030660     IF  AETADDL > ZERO                                           03066009
030661         MOVE AETADDI             TO ASC-ETA-DTE-DD               03066109
030662     ELSE                                                         03066209
030663         IF  AETADDF = DP015-ERASE-EOF                            03066309
030664             MOVE SPACE           TO ASC-ETA-DTE-DD               03066409
030665         END-IF                                                   03066509
030666     END-IF.                                                      03066609
030667                                                                  03066709
030668     IF  AETAYYL   > ZERO                                         03066809
030669         MOVE AETAYYI             TO ASC-ETA-DTE-CCYY             03066909
030670     ELSE                                                         03067009
030671         IF  AETAYYF = DP015-ERASE-EOF                            03067109
030672             MOVE SPACE           TO ASC-ETA-DTE-CCYY             03067209
030673         END-IF                                                   03067309
030674     END-IF.                                                      03067409
030675                                                                  03067509
030676                                                                  03067609
030677/                                                                 03067709
030678*----------------------------------------------------------------*03067809
030679*    CALL TO (AUTOVE) AUTOVERIFICATION MODULE (RCKUT127)          03067909
030680*----------------------------------------------------------------*03068009
030681 2300-CALL-AUTOVE-MODULE.                                         03068109
030682                                                                  03068209
030683     INITIALIZE RC040-FIELDS.                                     03068309
030684     MOVE DK-OPER-UNT-ID       TO RC040-SIGNON-LOCATION.          03068409
030685     MOVE RECEIV-ORD-NBR       TO RC040-PO-NBR                    03068509
030686     MOVE RECEIV-REC-SEQ-NBR   TO RC040-PO-RCVR                   03068609
030687     MOVE DP020-USERID         TO RC040-USER-ID.                  03068709
030688     MOVE 'TRKCS112'           TO RC040-CALLING-PROGRAM.          03068809
030689                                                                  03068909
030690     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  03069009
030691                                        RC040-COMMAREA            03069109
030692                                        RC040-FIELDS.             03069209
030693                                                                  03069309
030694     EVALUATE TRUE                                                03069409
030695         WHEN RC040-SUCCESSFUL                                    03069509
030696              CONTINUE                                            03069609
030697         WHEN RC040-DATABASE-BUSY OR                              03069709
030698              RC040-INVALID-SQL                                   03069809
030699                  MOVE PC-TSYMSG-00984  TO DP020-MSG-NUMBER       03069909
030700                  SET DP020-MSG-WARNING TO TRUE                   03070009
030701                  SET DP030-OVERRIDE-GO TO TRUE                   03070109
030702                  SET PS-ERROR          TO TRUE                   03070209
030703         WHEN RC040-NOT-SUCCESSFUL                                03070309
030704                  MOVE PC-TSYMSG-03138  TO DP020-MSG-NUMBER       03070409
030705                  SET DP020-MSG-WARNING TO TRUE                   03070509
030706                  SET DP030-OVERRIDE-GO TO TRUE                   03070609
030707                  SET PS-ERROR          TO TRUE                   03070709
030708         WHEN OTHER                                               03070809
030709             MOVE '2300-CALL-AUTOVE ' TO DP013-PARAGRAPH          03070909
030710             MOVE 'UNSUCCESSFUL CALL TO AUTO VE MOD'              03071009
030711                                         TO DP013-MESSAGE-TEXT (1)03071109
030712             MOVE RC040-SUCCESS-IND      TO DP013-MESSAGE-TEXT (2)03071209
030713             MOVE RC040-SQLCA            TO DP013-SQLCA           03071309
030714             SET DP013-DB2-ABEND                                  03071409
030715                 DP013-XCTL-DISPLAY-RESTART  TO TRUE              03071509
030716             SET PS-ERROR                    TO TRUE              03071609
030717             PERFORM DP013-0000-PROCESS-ABEND                     03071709
030718                                                                  03071809
030719     END-EVALUATE.                                                03071909
030720/                                                                 03072009
030722******************************************************************03072240
030723*  CHECK IF SHIPMENTS ARE ATTACHED TO TRIP BY DOING A SELECT      03072340
030724*  AGAINST TSHIPMT.                                               03072440
030725******************************************************************03072540
030726 2400-SHIPMT-FOR-TRIP.                                            03072640
030727                                                                  03072740
030728     PERFORM                                                      03072840
030729         WITH TEST AFTER                                          03072940
030730         VARYING PV-RETRY-COUNTER                                 03073040
030731         FROM 1 BY 1                                              03073140
030732         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03073240
030733             OR (SQLCODE = +0)                                    03073340
030734             OR (SQLCODE = +100))                                 03073440
030735                                                                  03073540
030736         EXEC SQL                                                 03073640
030737              SELECT COUNT(*)                                     03073740
030738                INTO :PV-DB2-COUNT-SHIPS                          03073843
030739                FROM TSHIPMT A                                    03073940
030740               WHERE A.TRIP_ID     = :DK-TRIP-ID                  03074040
030741         END-EXEC                                                 03074140
030742                                                                  03074240
030743         EVALUATE TRUE                                            03074340
030744             WHEN SQLCODE = +0                                    03074440
030745             WHEN SQLCODE = +100                                  03074540
030746             WHEN SQLCODE = -904                                  03074640
030747             WHEN SQLCODE = -913                                  03074740
030748                  CONTINUE                                        03074840
030749                                                                  03074940
030750             WHEN SQLWARN0 NOT = SPACES                           03075040
030751             WHEN SQLCODE < +0                                    03075140
030752             WHEN SQLCODE > +0                                    03075240
030753                  MOVE '2400-SHIPMT-FOR-TRIP'                     03075340
030754                                  TO DP013-PARAGRAPH              03075440
030755                  MOVE 'UNSUCCESSFUL COUNT OF TSHIPMT TABLE'      03075540
030756                                  TO DP013-MESSAGE-TEXT (1)       03075640
030757                  MOVE SQLCA      TO DP013-SQLCA                  03075740
030758                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     03075840
030759                  SET DP013-DB2-ABEND                             03075940
030760                      DP013-XCTL-DISPLAY-RESTART                  03076040
030761                                  TO TRUE                         03076140
030762                  PERFORM DP013-0000-PROCESS-ABEND                03076240
030763         END-EVALUATE                                             03076340
030764     END-PERFORM.                                                 03076440
030765                                                                  03076540
030766     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03076640
030767             AND (SQLCODE NOT = +0)                               03076740
030768         MOVE '2400-SHIPMT-FOR-TRIP'                              03076840
030769                                  TO DP013-PARAGRAPH              03076940
030770         MOVE 'MAX RETRIES EXCEEDED ON COUNT TSHIPMT TABLE'       03077040
030771                                  TO DP013-MESSAGE-TEXT (1)       03077140
030772         MOVE SQLCA               TO DP013-SQLCA                  03077240
030773         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     03077340
030774         SET DP013-DB2-ABEND                                      03077440
030775             DP013-XCTL-DISPLAY-RESTART                           03077540
030776                                  TO TRUE                         03077640
030777         PERFORM DP013-0000-PROCESS-ABEND                         03077740
030778     END-IF.                                                      03077840
030779/                                                                 03077940
030780*** ADDED - 10/31/08 - BEGIN                                      03078065
030781******************************************************************03078140
030782*  CHECK IF ALL OF THE RECEIVERS FOR A TRIP ARE AP RECEIVERS.     03078240
030783*  THIS IS DONE BY CHECKING TO SEE IF THERE ARE OTHER TYPES OF    03078340
030784*  RECEIVERS ON THIS TRIP.  IF THE COUNT FROM THIS SQL IS GREATER 03078440
030785*  THAN ZERO, THE RECEIVERS FOR THIS TRIP ARE NOT ALL TYPE AP     03078540
030786*  RECEIVERS.                                                     03078640
030787******************************************************************03078740
030788 2410-CHECK-AP-ON-TRECEIV.                                        03078840
030789                                                                  03078940
030790     INITIALIZE PV-DB2-COUNT-NON-AP-RCVRS.                        03079040
030791                                                                  03079140
030792     PERFORM                                                      03079240
030793         WITH TEST AFTER                                          03079340
030794         VARYING PV-RETRY-COUNTER                                 03079440
030795         FROM 1 BY 1                                              03079540
030796         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03079640
030797             OR (SQLCODE = +0)                                    03079740
030798             OR (SQLCODE = +100))                                 03079840
030799                                                                  03079940
030800         EXEC SQL                                                 03080040
030801              SELECT COUNT(*)                                     03080140
030802                INTO :PV-DB2-COUNT-NON-AP-RCVRS                   03080243
030803                FROM  TSHIPMT A                                   03080309
030804                    , TSHPTPO B                                   03080409
030805                    , TRECEIV C                                   03080509
030806               WHERE  A.TRIP_ID        = :DK-TRIP-ID              03080609
030807                 AND  A.TRIP_ID IS NOT NULL                       03080709
030808                 AND  A.SHIPT_ID       = B.SHIPT_ID               03080809
030809                 AND  B.REC_SEQ_NBR    > :PC-ZERO                 03080909
030810                 AND  B.REC_SEQ_NBR    = C.REC_SEQ_NBR            03081009
030811                 AND  B.PO_NBR         = C.ORD_NBR                03081109
030812                 AND  C.REC_TYP_CDE   <> 'AP'                     03081264
030813                 AND  C.VER_STATUS_CDE = 'A'                      03081364
030814         END-EXEC                                                 03081440
030815                                                                  03081540
030816         EVALUATE TRUE                                            03081640
030817             WHEN SQLCODE = +0                                    03081740
030818             WHEN SQLCODE = +100                                  03081840
030819             WHEN SQLCODE = -904                                  03081940
030820             WHEN SQLCODE = -913                                  03082040
030821                  CONTINUE                                        03082140
030822                                                                  03082240
030823             WHEN SQLWARN0 NOT = SPACES                           03082340
030824             WHEN SQLCODE < +0                                    03082440
030825             WHEN SQLCODE > +0                                    03082540
030826                  MOVE '2410-CHECK-AP-ON-TRECEIV'                 03082640
030827                                  TO DP013-PARAGRAPH              03082740
030828                  MOVE 'UNSUCCESSFUL COUNT OF NON AP RECEIVERS'   03082840
030829                                  TO DP013-MESSAGE-TEXT (1)       03082940
030830                  MOVE SQLCA      TO DP013-SQLCA                  03083040
030831                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     03083140
030832                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (2)     03083240
030833                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (3)     03083340
030834                  SET DP013-DB2-ABEND                             03083440
030835                      DP013-XCTL-DISPLAY-RESTART                  03083540
030836                                  TO TRUE                         03083640
030837                  PERFORM DP013-0000-PROCESS-ABEND                03083740
030838         END-EVALUATE                                             03083840
030839     END-PERFORM.                                                 03083940
030840                                                                  03084040
030841     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03084140
030842             AND (SQLCODE NOT = +0)                               03084240
030843         MOVE '2410-CHECK-AP-ON-TRECEIV'                          03084340
030844                                  TO DP013-PARAGRAPH              03084440
030845         MOVE 'MAX RETRIES EXCEEDED ON COUNT OF NON AP RECEIVERS' 03084540
030846                                  TO DP013-MESSAGE-TEXT (1)       03084640
030847         MOVE SQLCA               TO DP013-SQLCA                  03084740
030848         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     03084840
030849         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (2)     03084940
030850         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (3)     03085040
030851         SET DP013-DB2-ABEND                                      03085140
030852             DP013-XCTL-DISPLAY-RESTART                           03085240
030853                                  TO TRUE                         03085340
030854         PERFORM DP013-0000-PROCESS-ABEND                         03085440
030855     END-IF.                                                      03085540
030856                                                                  03085665
030857*** ADDED - 10/31/08 - END                                        03085765
030858                                                                  03085865
030859******************************************************************03085940
030860*  CHECK IF AR RECORD EXISTS BY DOING A SELECT AGAINST TTRIPST.   03086040
030861******************************************************************03086140
030862 2450-CHECK-AR-ON-TRIPST.                                         03086240
030863                                                                  03086340
030864     PERFORM                                                      03086440
030865         WITH TEST AFTER                                          03086540
030866         VARYING PV-RETRY-COUNTER                                 03086640
030867         FROM 1 BY 1                                              03086740
030868          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)              03086840
030869              OR (SQLCODE = +100)                                 03086940
030870              OR (SQLCODE = +0))                                  03087040
030871                                                                  03087140
030872             EXEC SQL                                             03087240
030873               SELECT TRIP_ID                                     03087340
030874                 INTO :TRIPST-TRIP-ID                             03087440
030875                 FROM TTRIPST                                     03087540
030876               WHERE  TRIP_ID          = :DK-TRIP-ID              03087640
030877                 AND  TRIP_STATUS_CDE  = 'AR'                     03087740
030878             END-EXEC                                             03087840
030879                                                                  03087940
030880             EVALUATE TRUE                                        03088040
030881                 WHEN SQLCODE = +0                                03088140
030882                     SET PS-AR-TRIPST-YES    TO TRUE              03088240
030883                 WHEN SQLCODE = +100                              03088340
030884                     SET PS-AR-TRIPST-NO     TO TRUE              03088440
030885                 WHEN SQLCODE = -904                              03088540
030886                 WHEN SQLCODE = -913                              03088640
030887                     CONTINUE                                     03088740
030888                                                                  03088840
030889                 WHEN SQLWARN0 NOT = SPACES                       03088940
030890                 WHEN SQLCODE < +0                                03089040
030891                 WHEN SQLCODE > +0                                03089140
030892                     MOVE '2450-CHECK-AR-ON-TRIPST'               03089240
030893                                       TO DP013-PARAGRAPH         03089340
030894                     MOVE 'SELECT ON TTRIPST'                     03089440
030895                                       TO DP013-MESSAGE-TEXT(1)   03089540
030896                     MOVE DK-TRIP-ID   TO DP013-MESSAGE-TEXT(2)   03089640
030897                     MOVE SQLCA        TO DP013-SQLCA             03089740
030898                     MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)03089840
030899                     SET DP013-DB2-ABEND                          03089940
030900                         DP013-XCTL-DISPLAY-RESTART TO TRUE       03090040
030901                     PERFORM DP013-0000-PROCESS-ABEND             03090140
030902             END-EVALUATE                                         03090240
030903         END-PERFORM                                              03090340
030904                                                                  03090440
030905         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    03090540
030906             AND (SQLCODE NOT = +0)                               03090640
030907             MOVE '2450-CHECK-AR-ON-TRIPST'                       03090740
030908                                       TO DP013-PARAGRAPH         03090840
030909             MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '          03090940
030910                                       TO DP013-MESSAGE-TEXT (1)  03091040
030911             MOVE 'TO SELECT A TTRIPST ROW'                       03091140
030912                                       TO DP013-MESSAGE-TEXT (2)  03091240
030913             MOVE SQLCA                TO DP013-SQLCA             03091340
030914             MOVE 'TTRIPST'            TO DP013-DB2-TABLE-NAME (1)03091440
030915             SET DP013-DB2-ABEND                                  03091540
030916                 DP013-XCTL-DISPLAY-RESTART                       03091640
030917                                       TO TRUE                    03091740
030918             PERFORM DP013-0000-PROCESS-ABEND                     03091840
030919         END-IF.                                                  03091941
030920                                                                  03092040
030921*----------------------------------------------------------------*03092109
030922*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *03092209
030923*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *03092309
030924*----------------------------------------------------------------*03092409
030925 3000-EDIT-DATA-IN-COMMAREA.                                      03092500
030926                                                                  03092600
030927     PERFORM 3200-RESET-ATTRIBUTES.                               03092700
030928                                                                  03092800
030929     IF  ASC-ETA-DTE-MM > SPACES                                  03092900
030930     OR  ASC-ETA-DTE-DD > SPACES                                  03093000
030931     OR  ASC-ETA-DTE-CCYY > SPACES                                03093100
030932        INITIALIZE DPG51 DPG52 DPG53                              03093200
030933                   DPG54 DPG55 DPG56                              03093300
030934         STRING ASC-ETA-DTE-MM                 DELIMITED BY SIZE  03093400
030935                ASC-ETA-DTE-DD                 DELIMITED BY SIZE  03093500
030936                ASC-ETA-DTE-CCYY               DELIMITED BY SIZE  03093600
030937                               INTO DPG52-LK-DATE-INPUT           03093700
030938        SET DPG51-ACTUAL-CALENDAR-ONLY                            03093800
030939            DPG51-DO-NOT-INCR-DECR-DATE                           03093900
030940            DPG52-LK-DTE-GREG-CC TO TRUE                          03094000
030941        CALL DP500-KOHLS-CALENDAR-ROUTINE                         03094100
030942                        USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56 03094200
030943        IF (DPG54-DATE-INVALID                                    03094300
030944        OR  DPG54-SEVERE-ERROR)                                   03094400
030945            SET PS-ERROR                                          03094500
030946                DP020-MSG-FATAL   TO TRUE                         03094600
030947            MOVE PC-TSYMSG-00009  TO DP020-MSG-NUMBER             03094700
030948            MOVE DP015-UNP-ALP-BRT-MDT                            03094800
030949                                  TO AETAMMA                      03094900
030950                                     AETADDA                      03095000
030951                                     AETAYYA                      03095100
030952            MOVE DP015-RED        TO AETAMMC                      03095200
030953                                     AETADDC                      03095300
030954                                     AETAYYC                      03095400
030955            MOVE DP015-REVERSE    TO AETAMMH                      03095500
030956                                     AETADDH                      03095600
030957                                     AETAYYH                      03095700
030958            MOVE -1               TO AETAMML                      03095800
030959            SET DP030-SET-CURSOR-APPL-1                           03095900
030960                                  TO TRUE                         03096000
030961        ELSE                                                      03096100
030962            MOVE DPG55-DB2-ISO-DATE-FMT                           03096200
030963                                  TO ASC-ETA-DTE                  03096300
030964            SET PS-ETA-DATE-VALID TO TRUE                         03096400
030965        END-IF                                                    03096500
030966     ELSE                                                         03096600
030967        IF ASC-ETA-DTE-OLD > SPACES                               03096700
030968            MOVE PC-TSYMSG-00715  TO DP020-MSG-NUMBER             03096800
030969            MOVE ASC-ETA-DTE-MM   TO AETAMMO                      03096900
030970            MOVE ASC-ETA-DTE-DD   TO AETADDO                      03097000
030971            MOVE ASC-ETA-DTE-CCYY TO AETAYYO                      03097100
030972        END-IF                                                    03097200
030973     END-IF.                                                      03097300
030974                                                                  03097400
030975     IF ASC-ETA-DTE NOT = ASC-ETA-DTE-OLD                         03097500
030976         IF ATRIPTPI = 'TR'                                       03097600
030977             SET PS-NO-ETA-WARNING TO TRUE                        03097700
030978         ELSE                                                     03097800
030979             PERFORM 3001-EDIT-ETA-DATE                           03097900
030980         END-IF                                                   03098000
030981     END-IF.                                                      03098100
030982                                                                  03098200
030983     IF ASC-ETA-TIME-MM = SPACES AND                              03098300
030984        ASC-ETA-TIME-HH = SPACES                                  03098400
030985         MOVE '08' TO ASC-ETA-TIME-MM                             03098500
030986         MOVE '00' TO ASC-ETA-TIME-HH                             03098600
030987         SET PS-ETA-TIME-VALID TO TRUE                            03098700
030988     END-IF.                                                      03098800
030989                                                                  03098900
030990     IF PS-ETA-DATE-VALID                                         03099000
030991         MOVE '08' TO ASC-ETA-TIME-HH                             03099100
030992         MOVE '00' TO ASC-ETA-TIME-MM                             03099200
030993         SET PS-ETA-TIME-VALID TO TRUE                            03099300
030994     END-IF.                                                      03099400
030995                                                                  03099500
030996     IF  ASC-SEAL-1     = SPACES AND                              03099600
030997         ASC-SEAL-1-OLD NOT = SPACES                              03099700
030998         SET PS-ERROR                                             03099800
030999             DP020-MSG-FATAL     TO TRUE                          03099900
031000         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              03100000
031001         MOVE DP015-UNP-ALP-BRT-OFF                               03100100
031002                                 TO ASEAL1A                       03100200
031003         MOVE DP015-RED          TO ASEAL1C                       03100300
031004         MOVE DP015-REVERSE      TO ASEAL1H                       03100400
031005         MOVE -1                 TO ASEAL1L                       03100500
031006         SET DP030-SET-CURSOR-APPL-1                              03100600
031007                                 TO TRUE                          03100700
031008     END-IF.                                                      03100800
031009                                                                  03100900
031010     IF  ASC-OWNR-SCAC-SHP-MM > SPACES                            03101000
031011     OR  ASC-OWNR-SCAC-SHP-DD > SPACES                            03101100
031012     OR  ASC-OWNR-SCAC-SHP-CCYY > SPACES                          03101200
031013        INITIALIZE DPG51 DPG52 DPG53                              03101300
031014                   DPG54 DPG55 DPG56                              03101400
031015         STRING ASC-OWNR-SCAC-SHP-MM           DELIMITED BY SIZE  03101500
031016                ASC-OWNR-SCAC-SHP-DD           DELIMITED BY SIZE  03101600
031017                ASC-OWNR-SCAC-SHP-CCYY         DELIMITED BY SIZE  03101700
031018                               INTO DPG52-LK-DATE-INPUT           03101800
031019        SET DPG51-ACTUAL-CALENDAR-ONLY                            03101900
031020            DPG51-DO-NOT-INCR-DECR-DATE                           03102000
031021            DPG52-LK-DTE-GREG-CC TO TRUE                          03102100
031022        CALL DP500-KOHLS-CALENDAR-ROUTINE                         03102200
031023                        USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56 03102300
031024        IF (DPG54-DATE-INVALID                                    03102400
031025        OR  DPG54-SEVERE-ERROR)                                   03102500
031026            SET PS-ERROR                                          03102600
031027                DP020-MSG-FATAL   TO TRUE                         03102700
031028            MOVE PC-TSYMSG-00009  TO DP020-MSG-NUMBER             03102800
031029            MOVE DP015-UNP-ALP-BRT-MDT                            03102900
031030                                  TO ACSHPMMA                     03103000
031031                                     ACSHPDDA                     03103100
031032                                     ACSHPYYA                     03103200
031033            MOVE DP015-RED        TO ACSHPMMC                     03103300
031034                                     ACSHPDDC                     03103400
031035                                     ACSHPYYC                     03103500
031036            MOVE DP015-REVERSE    TO ACSHPMMH                     03103600
031037                                     ACSHPDDH                     03103700
031038                                     ACSHPYYH                     03103800
031039            MOVE -1               TO ACSHPMML                     03103900
031040            SET DP030-SET-CURSOR-APPL-1                           03104000
031041                                  TO TRUE                         03104100
031042        ELSE                                                      03104200
031043            MOVE DPG55-DB2-ISO-DATE-FMT                           03104300
031044                                  TO ASC-OWNR-SCAC-SHP-DTE        03104400
031045        END-IF                                                    03104500
031046     END-IF.                                                      03104600
031047                                                                  03104700
031048     IF  ASC-MANIFEST-NBR = SPACES                                03104800
031049         IF ASC-VEHICLE-NULL-TRIP                                 03104900
031050             NEXT SENTENCE                                        03105000
031051         ELSE                                                     03105100
031052             SET PS-ERROR                                         03105200
031053                 DP020-MSG-FATAL     TO TRUE                      03105300
031054             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          03105400
031055             MOVE DP015-UNP-ALP-BRT-OFF                           03105500
031056                                     TO AMANA                     03105600
031057             MOVE DP015-RED          TO AMANC                     03105700
031058             MOVE DP015-REVERSE      TO AMANH                     03105800
031059             MOVE -1                 TO AMANL                     03105900
031060             SET DP030-SET-CURSOR-APPL-1                          03106000
031061                                     TO TRUE                      03106100
031062         END-IF                                                   03106200
031063     END-IF.                                                      03106300
031064                                                                  03106400
031065     PERFORM 3070-CHECK-STATUS.                                   03106500
031066                                                                  03106600
031067     IF  ASC-ADD-PENDING                                          03106700
031068     AND ASC-DEST-OPER-UNT-ID = (SPACES OR ZEROES)                03106800
031069         SET PS-ERROR                                             03106900
031070             DP020-MSG-FATAL     TO TRUE                          03107000
031071         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              03107100
031072         MOVE DP015-UNP-ALP-BRT-OFF                               03107200
031073                                 TO ADOPERA                       03107300
031074         MOVE DP015-RED          TO ADOPERC                       03107400
031075         MOVE DP015-REVERSE      TO ADOPERH                       03107500
031076         MOVE -1                 TO ADOPERL                       03107600
031077         SET DP030-SET-CURSOR-APPL-1                              03107700
031078                                 TO TRUE                          03107800
031079     END-IF.                                                      03107900
031080                                                                  03108000
031081     IF  ASC-DEST-OPER-UNT-ID > ZERO                              03108100
031082         MOVE ASC-DEST-OPER-UNT-ID TO DP010I-UNEDITED-FIELD       03108200
031083         MOVE LENGTH OF ASC-DEST-OPER-UNT-ID                      03108300
031084                                 TO DP010I-MAXIMUM-DIGITS         03108400
031085         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       03108500
031086         SET DP010I-NEGATIVE-NOT-ALLOWED                          03108600
031087                                 TO TRUE                          03108700
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         03108995
273427              USING DP010I-NUMERIC-EDIT-AREA                      03109095
031089         IF  DP010I-ERROR-DETECTED                                03109194
031090             SET PS-ERROR                                         03109294
031091                 DP020-MSG-FATAL TO TRUE                          03109394
031092             MOVE PC-TSYMSG-00008                                 03109494
031093                                 TO DP020-MSG-NUMBER              03109594
031094             MOVE DP015-UNP-ALP-BRT-OFF                           03109694
031095                                 TO ADOPERA                       03109794
031096             MOVE DP015-RED      TO ADOPERC                       03109894
031097             MOVE DP015-REVERSE  TO ADOPERH                       03109994
031098             MOVE -1             TO ADOPERL                       03110094
031099             SET DP030-SET-CURSOR-APPL-1                          03110194
031100                                 TO TRUE                          03110294
031101         ELSE                                                     03110394
031102             MOVE DP010I-NUMERIC-FIELD                            03110494
031103                                 TO ASC-DEST-OPER-UNT-ID-N        03110594
031104                                    DK-OPER-UNT-ID                03110694
031105             MOVE ASC-DEST-OPER-UNT-ID                            03110794
031106                                 TO ADOPERO                       03110894
031107         END-IF                                                   03110994
031108     END-IF.                                                      03111094
031109                                                                  03111194
031110     IF  ASC-DEST-OPER-UNT-ID > ZERO                              03111294
031111         PERFORM 3010-VALIDATE-OPER-UNT-ID                        03111394
031112         IF  SQLCODE = +100                                       03111494
031113             SET PS-ERROR                                         03111594
031114                 DP020-MSG-FATAL     TO TRUE                      03111694
031115             MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER          03111794
031116             MOVE DP015-UNP-ALP-BRT-OFF                           03111894
031117                                     TO ADOPERA                   03111994
031118             MOVE DP015-RED          TO ADOPERC                   03112094
031119             MOVE DP015-REVERSE      TO ADOPERH                   03112194
031120             MOVE -1                 TO ADOPERL                   03112294
031121             SET DP030-SET-CURSOR-APPL-1                          03112394
031122                                     TO TRUE                      03112494
031123         END-IF                                                   03112594
031124     END-IF.                                                      03112694
031125                                                                  03112794
031126     IF ASC-DEST-FCLTY-ID = (SPACES OR ZERO)                      03112894
031127        AND NOT ASC-VEHICLE-NULL-TRIP                             03112994
031128         MOVE '0001'         TO ASC-DEST-FCLTY-ID                 03113094
031129     ELSE                                                         03113194
031130         IF  ASC-DEST-FCLTY-ID    > ZERO                          03113294
031131             MOVE ASC-DEST-FCLTY-ID  TO DP010I-UNEDITED-FIELD     03113394
031132             MOVE LENGTH OF ASC-DEST-FCLTY-ID                     03113494
031133                                     TO DP010I-MAXIMUM-DIGITS     03113594
031134             MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS   03113694
031135             SET DP010I-NEGATIVE-NOT-ALLOWED                      03113794
031136                                     TO TRUE                      03113894
273427             CALL DP010I-NUMERIC-EDIT-ROUTINE                     03114095
273427                  USING DP010I-NUMERIC-EDIT-AREA                  03114195
031138             IF  DP010I-ERROR-DETECTED                            03114294
031139                 SET PS-ERROR                                     03114394
031140                     DP020-MSG-FATAL TO TRUE                      03114494
031141                 MOVE PC-TSYMSG-00008                             03114594
031142                                     TO DP020-MSG-NUMBER          03114694
031143                 MOVE DP015-UNP-ALP-BRT-OFF                       03114794
031144                                     TO ADFIDA                    03114894
031145                 MOVE DP015-RED      TO ADFIDC                    03114994
031146                 MOVE DP015-REVERSE  TO ADFIDH                    03115094
031147                 MOVE -1             TO ADFIDL                    03115194
031148                 SET DP030-SET-CURSOR-APPL-1                      03115294
031149                                     TO TRUE                      03115394
031150             ELSE                                                 03115494
031151                 MOVE DP010I-NUMERIC-FIELD                        03115594
031152                                     TO ASC-DEST-FCLTY-ID-N       03115694
031153                                        DK-FCLTY-ID               03115794
031154                 MOVE ASC-DEST-FCLTY-ID                           03115894
031155                                     TO ADFIDO                    03115994
031156                 MOVE ASC-DEST-OPER-UNT-ID                        03116094
031157                                     TO DK-OPER-UNT-ID            03116194
031158                 PERFORM 3020-VALIDATE-FCLTY-ID                   03116294
031159                 IF  SQLCODE = +100                               03116394
031160                     SET PS-ERROR                                 03116494
031161                         DP020-MSG-FATAL     TO TRUE              03116594
031162                     MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER  03116694
031163                     MOVE DP015-UNP-ALP-BRT-OFF                   03116794
031164                                             TO ADFIDA            03116894
031165                     MOVE DP015-RED          TO ADFIDC            03116994
031166                     MOVE DP015-REVERSE      TO ADFIDH            03117094
031167                     MOVE -1                 TO ADFIDL            03117194
031168                     SET DP030-SET-CURSOR-APPL-1                  03117294
031169                                             TO TRUE              03117394
031170                 ELSE                                             03117494
031171                     MOVE FACLTY-FCLTY-NME   TO ASC-DEST-FCLTY-NME03117594
031172                                                ADFIDDO           03117694
031173                 END-IF                                           03117794
031174             END-IF                                               03117894
031175         END-IF                                                   03117994
031176     END-IF.                                                      03118094
031177                                                                  03118194
031178     IF  ASC-DEST-FAC-AREA-ID > SPACES                            03118294
031179         MOVE ASC-DEST-FAC-AREA-ID                                03118394
031180                                 TO FLAREA-FCLTY-AREA-ID          03118494
031181         PERFORM 4310-GET-AREA-DESC                               03118594
031182         IF SQLCODE = +0                                          03118694
031183             MOVE FLAREA-FCLTY-AREA-DESC                          03118794
031184                                 TO ASC-DEST-FAC-AREA-ID-DESC     03118894
031185                                    ADAREADO                      03118994
031186         ELSE                                                     03119094
031187             MOVE SPACES         TO ASC-DEST-FAC-AREA-ID-DESC     03119194
031188                                    ADAREADO                      03119294
031189         END-IF                                                   03119394
031190     END-IF.                                                      03119494
031191                                                                  03119594
031192     IF  ASC-DEST-FAC-AREA-ID = SPACES OR LOW-VALUES              03119694
031193         IF  ASC-DEST-SUBAREA-OF-ID > SPACES                      03119794
031194             MOVE ASC-DEST-SUBAREA-OF-ID TO PV-ALPHA-6            03119894
031195             PERFORM 3080-RIGHT-JUSTIFY                           03119994
031196             MOVE PV-ALPHA-6 TO ASC-DEST-SUBAREA-OF-ID            03120094
031197             MOVE ASC-DEST-OPER-UNT-ID                            03120194
031198                                 TO DK-OPER-UNT-ID                03120294
031199             MOVE ASC-DEST-FCLTY-ID                               03120394
031200                                 TO DK-FCLTY-ID                   03120494
031201             MOVE ASC-DEST-SUBAREA-OF-ID                          03120594
031202                                 TO DK-FCLTY-AREA-ID              03120694
031203             MOVE 'PS'           TO DK-FCLTY-LOC-TYP-CDE-1        03120794
031204             MOVE 'DD'           TO DK-FCLTY-LOC-TYP-CDE-2        03120894
031205             PERFORM 3030-VALIDATE-FCLTY-AREA-ID                  03120994
031206             IF  SQLCODE = +100                                   03121094
031207                 SET PS-ERROR                                     03121194
031208                     DP020-MSG-FATAL  TO TRUE                     03121294
031209                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         03121394
031210                 MOVE DP015-UNP-ALP-BRT-OFF                       03121494
031211                                      TO ADSUBA                   03121594
031212                 MOVE DP015-RED       TO ADSUBC                   03121694
031213                 MOVE DP015-REVERSE   TO ADSUBH                   03121794
031214                 MOVE -1              TO ADSUBL                   03121894
031215                 SET DP030-SET-CURSOR-APPL-1                      03121994
031216                                      TO TRUE                     03122094
031217             ELSE                                                 03122194
031218                 IF  DN-SUBAREA-OF-ID = -1                        03122294
031219                     CONTINUE                                     03122394
031220                 ELSE                                             03122494
031221                     MOVE FLAREA-SUBAREA-OF-ID                    03122594
031222                                      TO FLAREA-FCLTY-AREA-ID     03122694
031223                                         ASC-DEST-FAC-AREA-ID     03122794
031224                                         ADAREAO                  03122894
031225                     PERFORM 4310-GET-AREA-DESC                   03122994
031226                     MOVE FLAREA-FCLTY-AREA-DESC                  03123094
031227                                      TO ASC-DEST-FAC-AREA-ID-DESC03123194
031228                                         ADAREADO                 03123294
031229                     MOVE ASC-DEST-SUBAREA-OF-ID                  03123394
031230                                      TO FLAREA-FCLTY-AREA-ID     03123494
031231                     PERFORM 4310-GET-AREA-DESC                   03123594
031232                     MOVE FLAREA-FCLTY-AREA-DESC                  03123694
031233                                  TO ASC-DEST-SUBAREA-OF-ID-DESC  03123794
031234                                     ADSUBDO                      03123894
031235                 END-IF                                           03123994
031236             END-IF                                               03124094
031237         END-IF                                                   03124194
031238     ELSE                                                         03124294
031239         IF  ASC-DEST-SUBAREA-OF-ID > SPACES                      03124394
031240             MOVE ASC-DEST-SUBAREA-OF-ID TO PV-ALPHA-6            03124494
031241             PERFORM 3080-RIGHT-JUSTIFY                           03124594
031242             MOVE PV-ALPHA-6 TO ASC-DEST-SUBAREA-OF-ID            03124694
031243             MOVE ASC-DEST-OPER-UNT-ID                            03124794
031244                                 TO DK-OPER-UNT-ID                03124894
031245             MOVE ASC-DEST-FCLTY-ID                               03124994
031246                                 TO DK-FCLTY-ID                   03125094
031247             MOVE ASC-DEST-FAC-AREA-ID                            03125194
031248                                 TO DK-SUBAREA-OF-ID              03125294
031249             MOVE ASC-DEST-SUBAREA-OF-ID                          03125394
031250                                 TO DK-FCLTY-AREA-ID              03125494
031251             PERFORM 3035-VALIDATE-SUBAREA-OF-ID                  03125594
031252             IF  SQLCODE = +100                                   03125694
031253                 SET PS-ERROR                                     03125794
031254                     DP020-MSG-FATAL  TO TRUE                     03125894
031255                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         03125994
031256                 MOVE DP015-UNP-ALP-BRT-OFF                       03126094
031257                                      TO ADSUBA                   03126194
031258                 MOVE DP015-RED       TO ADSUBC                   03126294
031259                 MOVE DP015-REVERSE   TO ADSUBH                   03126394
031260                 MOVE -1              TO ADSUBL                   03126494
031261                 SET DP030-SET-CURSOR-APPL-1                      03126594
031262                                      TO TRUE                     03126694
031263             ELSE                                                 03126794
031264                 MOVE ASC-DEST-SUBAREA-OF-ID                      03126894
031265                                      TO FLAREA-FCLTY-AREA-ID     03126994
031266                 PERFORM 4310-GET-AREA-DESC                       03127094
031267                 MOVE FLAREA-FCLTY-AREA-DESC                      03127194
031268                                  TO ASC-DEST-SUBAREA-OF-ID-DESC  03127294
031269                                     ADSUBDO                      03127394
031270             END-IF                                               03127494
031271         END-IF                                                   03127594
031272     END-IF.                                                      03127694
031273                                                                  03127794
031274     IF  ASC-DEST-FAC-AREA-ID > SPACES                            03127894
031275         IF  ASC-DEST-SUBAREA-OF-ID = SPACES                      03127994
031276             MOVE ASC-DEST-OPER-UNT-ID                            03128094
031277                                 TO DK-OPER-UNT-ID                03128194
031278             MOVE ASC-DEST-FCLTY-ID                               03128294
031279                                 TO DK-FCLTY-ID                   03128394
031280             MOVE ASC-DEST-FAC-AREA-ID                            03128494
031281                                 TO DK-FCLTY-AREA-ID              03128594
031282             MOVE 'DA'           TO DK-FCLTY-LOC-TYP-CDE-1        03128694
031283             MOVE 'YD'           TO DK-FCLTY-LOC-TYP-CDE-2        03128794
031284             PERFORM 3030-VALIDATE-FCLTY-AREA-ID                  03128894
031285             IF  SQLCODE = +100                                   03128994
031286                 SET PS-ERROR                                     03129094
031287                     DP020-MSG-FATAL  TO TRUE                     03129194
031288                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         03129294
031289                 MOVE DP015-UNP-ALP-BRT-OFF                       03129394
031290                                      TO ADAREAA                  03129494
031291                 MOVE DP015-RED       TO ADAREAC                  03129594
031292                 MOVE DP015-REVERSE   TO ADAREAH                  03129694
031293                 MOVE -1              TO ADAREAL                  03129794
031294                 SET DP030-SET-CURSOR-APPL-1                      03129894
031295                                      TO TRUE                     03129994
031296             END-IF                                               03130094
031297         END-IF                                                   03130194
031298     ELSE                                                         03130294
031299         IF  ASC-DEST-SUBAREA-OF-ID > SPACES                      03130394
031300             MOVE ASC-DEST-SUBAREA-OF-ID TO PV-ALPHA-6            03130494
031301             PERFORM 3080-RIGHT-JUSTIFY                           03130594
031302             MOVE PV-ALPHA-6 TO ASC-DEST-SUBAREA-OF-ID            03130694
031303             MOVE ASC-DEST-OPER-UNT-ID                            03130794
031304                                 TO DK-OPER-UNT-ID                03130894
031305             MOVE ASC-DEST-FCLTY-ID                               03130994
031306                                 TO DK-FCLTY-ID                   03131094
031307             MOVE ASC-DEST-FAC-AREA-ID                            03131194
031308                                 TO DK-SUBAREA-OF-ID              03131294
031309             MOVE ASC-DEST-SUBAREA-OF-ID                          03131394
031310                                 TO DK-FCLTY-AREA-ID              03131494
031311             PERFORM 3035-VALIDATE-SUBAREA-OF-ID                  03131594
031312             IF  SQLCODE = +100                                   03131694
031313                 SET PS-ERROR                                     03131794
031314                     DP020-MSG-FATAL  TO TRUE                     03131894
031315                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         03131994
031316                 MOVE DP015-UNP-ALP-BRT-OFF                       03132094
031317                                      TO ADAREAA                  03132194
031318                 MOVE DP015-RED       TO ADAREAC                  03132294
031319                 MOVE DP015-REVERSE   TO ADAREAH                  03132394
031320                 MOVE -1              TO ADAREAL                  03132494
031321                 SET DP030-SET-CURSOR-APPL-1                      03132594
031322                                      TO TRUE                     03132694
031323             ELSE                                                 03132794
031324                 MOVE ASC-DEST-SUBAREA-OF-ID                      03132894
031325                                      TO FLAREA-FCLTY-AREA-ID     03132994
031326                 PERFORM 4310-GET-AREA-DESC                       03133094
031327                 MOVE FLAREA-FCLTY-AREA-DESC                      03133194
031328                                  TO ASC-DEST-SUBAREA-OF-ID-DESC  03133294
031329                                     ADSUBDO                      03133394
031330             END-IF                                               03133494
031331         END-IF                                                   03133594
031332     END-IF.                                                      03133694
031333                                                                  03133794
031334     IF  ASC-DEST-FAC-AREA-ID   = ASC-DEST-FAC-AREA-ID-OLD        03133894
031335     AND ASC-DEST-SUBAREA-OF-ID = ASC-DEST-SUBAREA-OF-ID-OLD      03133994
031336         CONTINUE                                                 03134094
031337     ELSE                                                         03134194
031338         MOVE ASC-DEST-OPER-UNT-ID                                03134294
031339                                 TO DK-OPER-UNT-ID                03134394
031340         MOVE ASC-DEST-FCLTY-ID  TO DK-FCLTY-ID                   03134494
031341         MOVE ASC-DEST-FAC-AREA-ID                                03134594
031342                                 TO DK-SUBAREA-OF-ID              03134694
031343         MOVE ASC-DEST-SUBAREA-OF-ID                              03134794
031344                                 TO DK-FCLTY-AREA-ID              03134894
031345         INITIALIZE PV-DB2-COUNT                                  03134994
031346         PERFORM 3050-CHECK-IF-AREA-OPEN                          03135094
031347         IF  PV-DB2-COUNT > +0                                    03135194
031348             SET PS-ERROR                                         03135294
031349                 DP020-MSG-FATAL  TO TRUE                         03135394
031350             MOVE PC-TSYMSG-00714 TO DP020-MSG-NUMBER             03135494
031351             MOVE DP015-UNP-ALP-BRT-OFF                           03135594
031352                                  TO ADAREAA                      03135694
031353                                     ADSUBA                       03135794
031354             MOVE DP015-RED       TO ADAREAC                      03135894
031355                                     ADSUBC                       03135994
031356             MOVE DP015-REVERSE   TO ADAREAH                      03136094
031357                                     ADSUBH                       03136194
031358             MOVE -1              TO ADAREAL                      03136294
031359             SET DP030-SET-CURSOR-APPL-1                          03136394
031360                                  TO TRUE                         03136494
031361         END-IF                                                   03136594
031362     END-IF.                                                      03136694
031363* CURRENT OPER-ID                                                 03136794
031364                                                                  03136894
031365     IF  ASC-ADD-PENDING                                          03136994
031366     AND ASC-CURR-OPER-UNT-ID = (SPACES OR ZEROES)                03137094
031367         SET PS-ERROR                                             03137194
031368             DP020-MSG-FATAL     TO TRUE                          03137294
031369         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              03137394
031370         MOVE DP015-UNP-ALP-BRT-OFF                               03137494
031371                                 TO ACOPERA                       03137594
031372         MOVE DP015-RED          TO ACOPERC                       03137694
031373         MOVE DP015-REVERSE      TO ACOPERH                       03137794
031374         MOVE -1                 TO ACOPERL                       03137894
031375         SET DP030-SET-CURSOR-APPL-1                              03137994
031376                                 TO TRUE                          03138094
031377     END-IF.                                                      03138194
031378                                                                  03138294
031379     IF  ASC-CURR-OPER-UNT-ID = (SPACES OR ZEROES)                03138394
031380         IF PV-TRIP-PRTY-CDE > '49'                               03138494
031381*       A VALUE OF '50' IS ARRIVED                                03138594
031382             SET PS-ERROR                                         03138694
031383                 DP020-MSG-FATAL TO TRUE                          03138794
031384             MOVE PC-TSYMSG-00007                                 03138894
031385                                 TO DP020-MSG-NUMBER              03138994
031386             MOVE DP015-UNP-ALP-BRT-OFF                           03139094
031387                                 TO ACOPERA                       03139194
031388             MOVE DP015-RED      TO ACOPERC                       03139294
031389             MOVE DP015-REVERSE  TO ACOPERH                       03139394
031390             MOVE -1             TO ACOPERL                       03139494
031391             SET DP030-SET-CURSOR-APPL-1                          03139594
031392                                 TO TRUE                          03139694
031393         END-IF                                                   03139794
031394     ELSE                                                         03139894
031395         MOVE ASC-CURR-OPER-UNT-ID TO DP010I-UNEDITED-FIELD       03139994
031396         MOVE LENGTH OF ASC-CURR-OPER-UNT-ID                      03140094
031397                                 TO DP010I-MAXIMUM-DIGITS         03140194
031398         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       03140294
031399         SET DP010I-NEGATIVE-NOT-ALLOWED                          03140394
031400                                 TO TRUE                          03140494
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         03140695
273427              USING DP010I-NUMERIC-EDIT-AREA                      03140795
031402         IF  DP010I-ERROR-DETECTED                                03140894
031403             SET PS-ERROR                                         03140994
031404                 DP020-MSG-FATAL TO TRUE                          03141094
031405             MOVE PC-TSYMSG-00008                                 03141194
031406                                 TO DP020-MSG-NUMBER              03141294
031407             MOVE DP015-UNP-ALP-BRT-OFF                           03141394
031408                                 TO ACOPERA                       03141494
031409             MOVE DP015-RED      TO ACOPERC                       03141594
031410             MOVE DP015-REVERSE  TO ACOPERH                       03141694
031411             MOVE -1             TO ACOPERL                       03141794
031412             SET DP030-SET-CURSOR-APPL-1                          03141894
031413                                 TO TRUE                          03141994
031414         ELSE                                                     03142094
031415             MOVE DP010I-NUMERIC-FIELD                            03142194
031416                                 TO ASC-CURR-OPER-UNT-ID-N        03142294
031417                                    DK-OPER-UNT-ID                03142394
031418                                    DK-STR-NBR                    03142494
031419             MOVE ASC-CURR-OPER-UNT-ID                            03142594
031420                                 TO ACOPERO                       03142694
031421         END-IF                                                   03142794
031422     END-IF.                                                      03142894
031423                                                                  03142994
031424     IF  ASC-CURR-OPER-UNT-ID = (SPACES OR ZEROS)                 03143094
031425         CONTINUE                                                 03143194
031426     ELSE                                                         03143294
031427         IF ASC-CURR-FCLTY-ID = (SPACES OR ZERO)                  03143394
031428            MOVE '0001'         TO ASC-CURR-FCLTY-ID              03143494
031429         END-IF                                                   03143594
031430     END-IF.                                                      03143694
031431                                                                  03143794
031432     IF  ASC-CURR-FCLTY-ID-N  > ZERO OR                           03143894
031433         ASC-CURR-FCLTY-ID    > SPACES                            03143994
031434         MOVE ASC-CURR-FCLTY-ID  TO DP010I-UNEDITED-FIELD         03144094
031435         MOVE LENGTH OF ASC-CURR-FCLTY-ID                         03144194
031436                                 TO DP010I-MAXIMUM-DIGITS         03144294
031437         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       03144394
031438         SET DP010I-NEGATIVE-NOT-ALLOWED                          03144494
031439                                 TO TRUE                          03144594
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         03144795
273427              USING DP010I-NUMERIC-EDIT-AREA                      03144895
031441         IF  DP010I-ERROR-DETECTED                                03144994
031442             SET PS-ERROR                                         03145094
031443                 DP020-MSG-FATAL TO TRUE                          03145194
031444             MOVE PC-TSYMSG-00008                                 03145294
031445                                 TO DP020-MSG-NUMBER              03145394
031446             MOVE DP015-UNP-ALP-BRT-OFF                           03145494
031447                                 TO ACFIDA                        03145594
031448             MOVE DP015-RED      TO ACFIDC                        03145694
031449             MOVE DP015-REVERSE  TO ACFIDH                        03145794
031450             MOVE -1             TO ACFIDL                        03145894
031451             SET DP030-SET-CURSOR-APPL-1                          03145994
031452                                 TO TRUE                          03146094
031453         ELSE                                                     03146194
031454             MOVE DP010I-NUMERIC-FIELD                            03146294
031455                                 TO ASC-CURR-FCLTY-ID-N           03146394
031456                                    DK-FCLTY-ID                   03146494
031457             MOVE ASC-CURR-FCLTY-ID                               03146594
031458                                 TO ACFIDO                        03146694
031459             MOVE ASC-CURR-OPER-UNT-ID                            03146794
031460                                 TO DK-OPER-UNT-ID                03146894
031461             PERFORM 3020-VALIDATE-FCLTY-ID                       03146994
031462             IF  SQLCODE = +100                                   03147094
031463                 SET PS-ERROR                                     03147194
031464                     DP020-MSG-FATAL     TO TRUE                  03147294
031465                 MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER      03147394
031466                 MOVE DP015-UNP-ALP-BRT-OFF                       03147494
031467                                         TO ACFIDA                03147594
031468                 MOVE DP015-RED          TO ACFIDC                03147694
031469                 MOVE DP015-REVERSE      TO ACFIDH                03147794
031470                 MOVE -1                 TO ACFIDL                03147894
031471                 SET DP030-SET-CURSOR-APPL-1                      03147994
031472                                         TO TRUE                  03148094
031473             ELSE                                                 03148194
031474                 MOVE FACLTY-FCLTY-NME   TO ASC-CURR-FCLTY-NME    03148294
031475                                            ACFIDDO               03148394
031476             END-IF                                               03148494
031477         END-IF                                                   03148594
031478     END-IF.                                                      03148694
031479                                                                  03148794
031480* IF AN ERROR WAS FOUND FOR THE CURRENT OPER-ID OR FACILITY,      03148894
031481*  SKIP THE LOOKUP OF VEHICLE TYPE CODE.                          03148994
031482     IF ACFIDL = -1 OR ACOPERL = -1                               03149094
031483         CONTINUE                                                 03149194
031484     ELSE                                                         03149294
031485         IF ASC-CURR-OPER-UNT-ID = ZERO OR LOW-VALUES OR SPACES   03149394
031486             CONTINUE                                             03149494
031487         ELSE                                                     03149594
031488             PERFORM 4005-GET-STORE-TYPE                          03149694
031489         END-IF                                                   03149794
031490     END-IF.                                                      03149894
031491                                                                  03149994
031492     EVALUATE XLT00010-LOC-TYP-CDE                                03150094
031493     WHEN 'DC'                                                    03150194
031494     WHEN 'DS'                                                    03150294
031495         MOVE 'TR'               TO ASC-VEH-TYP-CDE               03150394
031496                                    ATRIPTPO                      03150494
031497         IF ASC-CURR-OPER-UNT-ID-N = 90                           03150594
031498             MOVE DP015-UNP-ALP-NOR-OFF                           03150694
031499                                 TO ATRIPTPA                      03150794
031500             MOVE DP015-GREEN TO ATRIPTPC                         03150894
031501             MOVE DP015-UNDERLINE TO ATRIPTPH                     03150994
031502         ELSE                                                     03151094
031503             MOVE DP015-PRO-NOR-OFF TO ATRIPTPA                   03151194
031504             MOVE DP015-BLUE      TO ATRIPTPC                     03151294
031505         END-IF                                                   03151394
031506     WHEN 'HQ'                                                    03151494
031507         IF ASC-VEH-TYP-CDE = SPACES OR LOW-VALUES                03151594
031508             MOVE 'VS'           TO ASC-VEH-TYP-CDE               03151694
031509                                    ATRIPTPO                      03151794
031510         END-IF                                                   03151894
031511         MOVE DP015-UNP-ALP-NOR-OFF                               03151994
031512                                 TO ATRIPTPA                      03152094
031513         MOVE DP015-GREEN        TO ATRIPTPC                      03152194
031514         MOVE DP015-UNDERLINE    TO ATRIPTPH                      03152294
031515     WHEN OTHER                                                   03152394
031516*        MOVE SPACES             TO ASC-VEH-TYP-CDE               03152494
031517*                                   ATRIPTPO                      03152594
031518         MOVE DP015-UNP-ALP-NOR-OFF                               03152694
031519                                 TO ATRIPTPA                      03152794
031520         MOVE DP015-GREEN        TO ATRIPTPC                      03152894
031521         MOVE DP015-UNDERLINE    TO ATRIPTPH                      03152994
031522     END-EVALUATE                                                 03153094
031523                                                                  03153194
031524     IF ASC-VEH-TYP-CDE = 'TR' OR 'VS' OR 'AV'                    03153294
031525         CONTINUE                                                 03153394
031526     ELSE                                                         03153494
031527         SET PS-ERROR                                             03153594
031528             DP020-MSG-FATAL     TO TRUE                          03153694
031529         MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER              03153794
031530         MOVE DP015-UNP-ALP-BRT-OFF                               03153894
031531                                 TO ATRIPTPA                      03153994
031532         MOVE DP015-RED          TO ATRIPTPC                      03154094
031533         MOVE DP015-REVERSE      TO ATRIPTPH                      03154194
031534         MOVE -1                 TO ATRIPTPL                      03154294
031535         SET DP030-SET-CURSOR-APPL-1                              03154394
031536                                 TO TRUE                          03154494
031537     END-IF                                                       03154594
031538                                                                  03154694
031539     IF ASC-CURR-FAC-AREA-ID = LOW-VALUES                         03154794
031540         MOVE SPACES TO ASC-CURR-FAC-AREA-ID                      03154894
031541     END-IF                                                       03154994
031542     IF  ASC-CURR-FAC-AREA-ID > SPACES                            03155094
031543         MOVE ASC-CURR-FAC-AREA-ID                                03155194
031544                                 TO FLAREA-FCLTY-AREA-ID          03155294
031545         PERFORM 4310-GET-AREA-DESC                               03155394
031546         IF SQLCODE = +0                                          03155494
031547             MOVE FLAREA-FCLTY-AREA-DESC                          03155594
031548                                 TO ASC-CURR-FAC-AREA-ID-DESC     03155694
031549                                    ACAREADO                      03155794
031550         ELSE                                                     03155894
031551             MOVE SPACES         TO ASC-CURR-FAC-AREA-ID-DESC     03155994
031552                                    ACAREADO                      03156094
031553         END-IF                                                   03156194
031554     END-IF.                                                      03156294
031555                                                                  03156394
031556     IF  ASC-CURR-FAC-AREA-ID = SPACES OR LOW-VALUES              03156494
031557         IF  ASC-CURR-SUBAREA-OF-ID > SPACES                      03156594
031558             MOVE ASC-CURR-SUBAREA-OF-ID TO PV-ALPHA-6            03156694
031559             PERFORM 3080-RIGHT-JUSTIFY                           03156794
031560             MOVE PV-ALPHA-6 TO ASC-CURR-SUBAREA-OF-ID            03156894
031561             MOVE ASC-CURR-OPER-UNT-ID                            03156994
031562                                 TO DK-OPER-UNT-ID                03157094
031563             MOVE ASC-CURR-FCLTY-ID                               03157194
031564                                 TO DK-FCLTY-ID                   03157294
031565             MOVE ASC-CURR-SUBAREA-OF-ID                          03157394
031566                                 TO DK-FCLTY-AREA-ID              03157494
031567             MOVE 'PS'           TO DK-FCLTY-LOC-TYP-CDE-1        03157594
031568             MOVE 'DD'           TO DK-FCLTY-LOC-TYP-CDE-2        03157694
031569             PERFORM 3030-VALIDATE-FCLTY-AREA-ID                  03157794
031570             IF  SQLCODE = +100                                   03157894
031571                 SET PS-ERROR                                     03157994
031572                     DP020-MSG-FATAL  TO TRUE                     03158094
031573                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         03158194
031574                 MOVE DP015-UNP-ALP-BRT-OFF                       03158294
031575                                      TO ACSUBA                   03158394
031576                 MOVE DP015-RED       TO ACSUBC                   03158494
031577                 MOVE DP015-REVERSE   TO ACSUBH                   03158594
031578                 MOVE -1              TO ACSUBL                   03158694
031579                 SET DP030-SET-CURSOR-APPL-1                      03158794
031580                                      TO TRUE                     03158894
031581             ELSE                                                 03158994
031582                 MOVE FLAREA-SUBAREA-OF-ID                        03159094
031583                                      TO FLAREA-FCLTY-AREA-ID     03159194
031584                                         ASC-CURR-FAC-AREA-ID     03159294
031585                                         ACAREAO                  03159394
031586                 PERFORM 4310-GET-AREA-DESC                       03159494
031587                 MOVE FLAREA-FCLTY-AREA-DESC                      03159594
031588                                      TO ASC-CURR-FAC-AREA-ID-DESC03159694
031589                                         ACAREADO                 03159794
031590                 MOVE ASC-CURR-SUBAREA-OF-ID                      03159894
031591                                      TO FLAREA-FCLTY-AREA-ID     03159994
031592                 PERFORM 4310-GET-AREA-DESC                       03160094
031593                 MOVE FLAREA-FCLTY-AREA-DESC                      03160194
031594                                  TO ASC-CURR-SUBAREA-OF-ID-DESC  03160294
031595                                     ACSUBDO                      03160394
031596             END-IF                                               03160494
031597         END-IF                                                   03160594
031598     ELSE                                                         03160694
031599         IF  ASC-CURR-SUBAREA-OF-ID > SPACES                      03160794
031600             MOVE ASC-CURR-SUBAREA-OF-ID TO PV-ALPHA-6            03160894
031601             PERFORM 3080-RIGHT-JUSTIFY                           03160994
031602             MOVE PV-ALPHA-6 TO ASC-CURR-SUBAREA-OF-ID            03161094
031603             MOVE ASC-CURR-OPER-UNT-ID                            03161194
031604                                 TO DK-OPER-UNT-ID                03161294
031605             MOVE ASC-CURR-FCLTY-ID                               03161394
031606                                 TO DK-FCLTY-ID                   03161494
031607             MOVE ASC-CURR-FAC-AREA-ID                            03161594
031608                                 TO DK-SUBAREA-OF-ID              03161694
031609             MOVE ASC-CURR-SUBAREA-OF-ID                          03161794
031610                                 TO DK-FCLTY-AREA-ID              03161894
031611             PERFORM 3035-VALIDATE-SUBAREA-OF-ID                  03161994
031612             IF  SQLCODE = +100                                   03162094
031613                 SET PS-ERROR                                     03162194
031614                     DP020-MSG-FATAL  TO TRUE                     03162294
031615                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         03162394
031616                 MOVE DP015-UNP-ALP-BRT-OFF                       03162494
031617                                      TO ACSUBA                   03162594
031618                 MOVE DP015-RED       TO ACSUBC                   03162694
031619                 MOVE DP015-REVERSE   TO ACSUBH                   03162794
031620                 MOVE -1              TO ACSUBL                   03162894
031621                 SET DP030-SET-CURSOR-APPL-1                      03162994
031622                                      TO TRUE                     03163094
031623             ELSE                                                 03163194
031624                 MOVE ASC-CURR-SUBAREA-OF-ID                      03163294
031625                                      TO FLAREA-FCLTY-AREA-ID     03163394
031626                 PERFORM 4310-GET-AREA-DESC                       03163494
031627                 MOVE FLAREA-FCLTY-AREA-DESC                      03163594
031628                                  TO ASC-CURR-SUBAREA-OF-ID-DESC  03163694
031629                                     ACSUBDO                      03163794
031630             END-IF                                               03163894
031631         END-IF                                                   03163994
031632     END-IF.                                                      03164094
031633                                                                  03164194
031634     IF  ASC-CURR-FAC-AREA-ID > SPACES                            03164294
031635         IF  ASC-CURR-SUBAREA-OF-ID = SPACES                      03164394
031636             MOVE ASC-CURR-OPER-UNT-ID                            03164494
031637                                 TO DK-OPER-UNT-ID                03164594
031638             MOVE ASC-CURR-FCLTY-ID                               03164694
031639                                 TO DK-FCLTY-ID                   03164794
031640             MOVE ASC-CURR-FAC-AREA-ID                            03164894
031641                                 TO DK-FCLTY-AREA-ID              03164994
031642             MOVE 'DA'           TO DK-FCLTY-LOC-TYP-CDE-1        03165094
031643             MOVE 'YD'           TO DK-FCLTY-LOC-TYP-CDE-2        03165194
031644             PERFORM 3030-VALIDATE-FCLTY-AREA-ID                  03165294
031645             IF  SQLCODE = +100                                   03165394
031646                 SET PS-ERROR                                     03165494
031647                     DP020-MSG-FATAL  TO TRUE                     03165594
031648                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         03165694
031649                 MOVE DP015-UNP-ALP-BRT-OFF                       03165794
031650                                      TO ACAREAA                  03165894
031651                 MOVE DP015-RED       TO ACAREAC                  03165994
031652                 MOVE DP015-REVERSE   TO ACAREAH                  03166094
031653                 MOVE -1              TO ACAREAL                  03166194
031654                 SET DP030-SET-CURSOR-APPL-1                      03166294
031655                                      TO TRUE                     03166394
031656             END-IF                                               03166494
031657         END-IF                                                   03166594
031658     ELSE                                                         03166694
031659         IF  ASC-CURR-SUBAREA-OF-ID > SPACES                      03166794
031660             MOVE ASC-CURR-SUBAREA-OF-ID TO PV-ALPHA-6            03166894
031661             PERFORM 3080-RIGHT-JUSTIFY                           03166994
031662             MOVE PV-ALPHA-6 TO ASC-CURR-SUBAREA-OF-ID            03167094
031663             MOVE ASC-CURR-OPER-UNT-ID                            03167194
031664                                 TO DK-OPER-UNT-ID                03167294
031665             MOVE ASC-CURR-FCLTY-ID                               03167394
031666                                 TO DK-FCLTY-ID                   03167494
031667             MOVE ASC-CURR-FAC-AREA-ID                            03167594
031668                                 TO DK-SUBAREA-OF-ID              03167694
031669             MOVE ASC-CURR-SUBAREA-OF-ID                          03167794
031670                                 TO DK-FCLTY-AREA-ID              03167894
031671             PERFORM 3035-VALIDATE-SUBAREA-OF-ID                  03167994
031672             IF  SQLCODE = +100                                   03168094
031673                 SET PS-ERROR                                     03168194
031674                     DP020-MSG-FATAL  TO TRUE                     03168294
031675                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         03168394
031676                 MOVE DP015-UNP-ALP-BRT-OFF                       03168494
031677                                      TO ACAREAA                  03168594
031678                 MOVE DP015-RED       TO ACAREAC                  03168694
031679                 MOVE DP015-REVERSE   TO ACAREAH                  03168794
031680                 MOVE -1              TO ACAREAL                  03168894
031681                 SET DP030-SET-CURSOR-APPL-1                      03168994
031682                                      TO TRUE                     03169094
031683             ELSE                                                 03169194
031684                 MOVE ASC-CURR-SUBAREA-OF-ID                      03169294
031685                                      TO FLAREA-FCLTY-AREA-ID     03169394
031686                 PERFORM 4310-GET-AREA-DESC                       03169494
031687                 MOVE FLAREA-FCLTY-AREA-DESC                      03169594
031688                                  TO ASC-CURR-SUBAREA-OF-ID-DESC  03169694
031689                                     ACSUBDO                      03169794
031690             END-IF                                               03169894
031691         END-IF                                                   03169994
031692     END-IF.                                                      03170094
031693                                                                  03170194
031694     IF  ASC-CURR-FAC-AREA-ID   = ASC-CURR-FAC-AREA-ID-OLD        03170294
031695     AND ASC-CURR-SUBAREA-OF-ID = ASC-CURR-SUBAREA-OF-ID-OLD      03170394
031696         CONTINUE                                                 03170494
031697     ELSE                                                         03170594
031698         MOVE ASC-CURR-OPER-UNT-ID                                03170694
031699                                 TO DK-OPER-UNT-ID                03170794
031700         MOVE ASC-CURR-FCLTY-ID  TO DK-FCLTY-ID                   03170894
031701         MOVE ASC-CURR-FAC-AREA-ID                                03170994
031702                                 TO DK-SUBAREA-OF-ID              03171094
031703         MOVE ASC-CURR-SUBAREA-OF-ID                              03171194
031704                                 TO DK-FCLTY-AREA-ID              03171294
031705         INITIALIZE PV-DB2-COUNT                                  03171394
031706         PERFORM 3050-CHECK-IF-AREA-OPEN                          03171494
031707         IF  PV-DB2-COUNT > +0                                    03171594
031708             IF ASC-NEW-STOP-PENDING                              03171694
031709                 PERFORM 3090-CHECK-SAME-TRIP                     03171794
031710             ELSE                                                 03171894
031711                 SET PS-SPACE-ERROR TO TRUE                       03171994
031712             END-IF                                               03172094
031713             IF PS-SPACE-ERROR                                    03172194
031714                 SET PS-ERROR                                     03172294
031715                     DP020-MSG-FATAL  TO TRUE                     03172394
031716                 MOVE PC-TSYMSG-00714 TO DP020-MSG-NUMBER         03172494
031717                 MOVE DP015-UNP-ALP-BRT-OFF                       03172594
031718                                      TO ACAREAA                  03172694
031719                                         ACSUBA                   03172794
031720                 MOVE DP015-RED       TO ACAREAC                  03172894
031721                                         ACSUBC                   03172994
031722                 MOVE DP015-REVERSE   TO ACAREAH                  03173094
031723                                         ACSUBH                   03173194
031724                 MOVE -1              TO ACAREAL                  03173294
031725                 SET DP030-SET-CURSOR-APPL-1                      03173394
031726                                      TO TRUE                     03173494
031727             END-IF                                               03173594
031728         END-IF                                                   03173694
031729     END-IF.                                                      03173794
031730                                                                  03173894
031731     IF  ASC-ADD-PENDING                                          03173994
031732     AND ASC-KEY-VEH-NBR = SPACES                                 03174094
031733         SET PS-ERROR                                             03174194
031734             DP020-MSG-FATAL     TO TRUE                          03174294
031735         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              03174394
031736         MOVE DP015-UNP-ALP-BRT-OFF                               03174494
031737                                 TO ATRLRA                        03174594
031738         MOVE DP015-RED          TO ATRLRC                        03174694
031739         MOVE DP015-REVERSE      TO ATRLRH                        03174794
031740         MOVE -1                 TO ATRLRL                        03174894
031741         SET DP030-SET-CURSOR-APPL-1                              03174994
031742                                 TO TRUE                          03175094
031743     ELSE                                                         03175194
031744        MOVE ASC-KEY-VEH-NBR   TO RC023-VEHICLE                   03175294
031745        CALL RC023-FB-BOL-VEH-FORMAT                              03175394
031746                         USING RC023-FORMAT-DATA-AREA             03175494
031747        MOVE RC023-VEHICLE     TO ASC-KEY-VEH-NBR                 03175594
031748                                  ATRLRO                          03175694
031749     END-IF.                                                      03175794
031750                                                                  03175894
031751     IF  ASC-ADD-PENDING                                          03175994
031752     AND ASC-KEY-OWNER-SCAC-ID = SPACES                           03176094
031753         SET PS-ERROR                                             03176194
031754             DP020-MSG-FATAL     TO TRUE                          03176294
031755         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              03176394
031756         MOVE DP015-UNP-ALP-BRT-OFF                               03176494
031757                                 TO ASCACA                        03176594
031758         MOVE DP015-RED          TO ASCACC                        03176694
031759         MOVE DP015-REVERSE      TO ASCACH                        03176794
031760         MOVE -1                 TO ASCACL                        03176894
031761         SET DP030-SET-CURSOR-APPL-1                              03176994
031762                                 TO TRUE                          03177094
031763     END-IF.                                                      03177194
031764                                                                  03177294
031765                                                                  03177394
031766     IF  ASC-CURR-OPER-UNT-ID = (SPACES OR ZEROS)                 03177494
031767         CONTINUE                                                 03177594
031768     ELSE                                                         03177694
031769         IF PS-NO-ERROR                                           03177794
031770             MOVE ASC-CURR-OPER-UNT-ID                            03177894
031771                                 TO DP010I-UNEDITED-FIELD         03177994
031772             MOVE LENGTH OF ASC-CURR-OPER-UNT-ID                  03178094
031773                                 TO DP010I-MAXIMUM-DIGITS         03178194
031774             MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS   03178294
031775             SET DP010I-NEGATIVE-NOT-ALLOWED                      03178394
031776                                 TO TRUE                          03178494
273427             CALL DP010I-NUMERIC-EDIT-ROUTINE                     03178695
273427                  USING DP010I-NUMERIC-EDIT-AREA                  03178795
031778             IF  DP010I-ERROR-DETECTED                            03178894
031779                 SET PS-ERROR                                     03178994
031780                     DP020-MSG-FATAL TO TRUE                      03179094
031781                 MOVE PC-TSYMSG-00008                             03179194
031782                                  TO DP020-MSG-NUMBER             03179294
031783                 MOVE DP015-UNP-ALP-BRT-OFF                       03179394
031784                                 TO ACOPERA                       03179494
031785                 MOVE DP015-RED      TO ACOPERC                   03179594
031786                 MOVE DP015-REVERSE  TO ACOPERH                   03179694
031787                 MOVE -1             TO ACOPERL                   03179794
031788                 SET DP030-SET-CURSOR-APPL-1                      03179894
031789                                     TO TRUE                      03179994
031790             ELSE                                                 03180094
031791                 MOVE DP010I-NUMERIC-FIELD                        03180194
031792                                     TO ASC-CURR-OPER-UNT-ID-N    03180294
031793                                        DK-OPER-UNT-ID            03180394
031794                 MOVE ASC-CURR-OPER-UNT-ID                        03180494
031795                                 TO ACOPERO                       03180594
031796                 PERFORM 3010-VALIDATE-OPER-UNT-ID                03180694
031797                 IF  SQLCODE = +100                               03180794
031798                     SET PS-ERROR                                 03180894
031799                         DP020-MSG-FATAL     TO TRUE              03180994
031800                     MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER  03181094
031801                     MOVE DP015-UNP-ALP-BRT-OFF                   03181194
031802                                             TO ACOPERA           03181294
031803                     MOVE DP015-RED          TO ACOPERC           03181394
031804                     MOVE DP015-REVERSE      TO ACOPERH           03181494
031805                     MOVE -1                 TO ACOPERL           03181594
031806                     SET DP030-SET-CURSOR-APPL-1                  03181694
031807                                             TO TRUE              03181794
031808                 END-IF                                           03181894
031809             END-IF                                               03181994
031810         END-IF                                                   03182094
031811     END-IF.                                                      03182194
031812                                                                  03182294
031813     IF  ASC-ADD-PENDING                                          03182394
031814         IF ASC-VEHICLE-NULL-TRIP                                 03182494
031815             SET ASC-NEW-STOP-PENDING  TO TRUE                    03182594
031816         END-IF                                                   03182694
031817     END-IF.                                                      03182794
031818                                                                  03182894
031819     IF  PS-NO-ERROR                                              03182994
031820         EVALUATE TRUE                                            03183094
031821             WHEN ASC-ADD-PENDING                                 03183194
031822                 MOVE -1           TO ASCACL                      03183294
031823                 SET DP030-SET-CURSOR-APPL-1                      03183394
031824                                   TO TRUE                        03183494
031825             WHEN ASC-UPDATE-PENDING                              03183594
031826             WHEN ASC-NEW-STOP-PENDING                            03183694
031827                 MOVE -1           TO AUSEL                       03183794
031828                 SET DP030-SET-CURSOR-APPL-1                      03183894
031829                                   TO TRUE                        03183994
031830             WHEN ASC-DELETE-PENDING                              03184094
031831                 SET DP030-SET-CURSOR-TRAILER                     03184194
031832                                   TO TRUE                        03184294
031833         END-EVALUATE                                             03184394
031834     END-IF.                                                      03184494
031835                                                                  03184594
031836     IF  ASC-USAGE-CDE = SPACES                                   03184694
031837         SET PS-ERROR              TO TRUE                        03184794
031838         SET DP020-MSG-FATAL       TO TRUE                        03184894
031839         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            03184994
031840         MOVE DP015-UNP-ALP-BRT-OFF                               03185094
031841                                   TO AUSEA                       03185194
031842         MOVE DP015-RED            TO AUSEC                       03185294
031843         MOVE DP015-REVERSE        TO AUSEH                       03185394
031844         MOVE -1                   TO AUSEL                       03185494
031845         SET DP030-SET-CURSOR-APPL-1                              03185594
031846                                   TO TRUE                        03185694
031847     END-IF.                                                      03185794
031848                                                                  03185894
031849     IF ASC-UPDATE-PENDING                                        03185994
031850         IF  ASC-KEY-OWNER-SCAC-ID  > SPACES                      03186094
031851             MOVE ASC-KEY-OWNER-SCAC-ID                           03186194
031852                                      TO DK-OWNER-SCAC-ID         03186294
031853             PERFORM 3100-VALIDATE-SCAC-CDE                       03186394
031854             IF  SQLCODE = +100                                   03186494
031855                 SET PS-ERROR                                     03186594
031856                     DP020-MSG-FATAL  TO TRUE                     03186694
031857                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         03186794
031858                 MOVE DP015-UNP-ALP-BRT-OFF                       03186894
031859                                      TO ASCACA                   03186994
031860                 MOVE DP015-RED       TO ASCACC                   03187094
031861                 MOVE DP015-REVERSE   TO ASCACH                   03187194
031862                 MOVE -1              TO ASCACL                   03187294
031863                 SET DP030-SET-CURSOR-APPL-1                      03187394
031864                                      TO TRUE                     03187494
031865             ELSE                                                 03187594
031866                 PERFORM 4320-GET-ENT-NAME-DESC                   03187694
031867                 MOVE ENTNME-ENT-NAME-DESC                        03187794
031868                                 TO ASC-OWNER-SCAC-ID-DESC        03187894
031869             END-IF                                               03187994
031870         END-IF                                                   03188094
031871     END-IF.                                                      03188194
031872                                                                  03188294
031873                                                                  03188394
031874     IF ASC-UPDATE-PENDING AND ASC-KEY-TRIP-ID = ZERO             03188494
031875         SET PS-ERROR              TO TRUE                        03188594
031876         SET DP020-MSG-WARNING     TO TRUE                        03188694
031877         MOVE PC-TSYMSG-00803      TO DP020-MSG-NUMBER            03188794
031878         MOVE -1                   TO ASCACL                      03188894
031879         SET DP030-SET-CURSOR-APPL-1                              03188994
031880                                   TO TRUE                        03189094
031881     END-IF.                                                      03189194
031882                                                                  03189294
031883     IF ASC-UPDATE-PENDING AND PS-NO-ERROR                        03189394
031884         IF ASC-KEY-OWNER-SCAC-ID = ASC-OWNER-SCAC-ID-OLD AND     03189494
031885            ASC-KEY-VEH-NBR       = ASC-VEH-NBR-OLD               03189594
031886             CONTINUE                                             03189694
031887         ELSE                                                     03189794
031888             MOVE ASC-KEY-VEH-NBR          TO DK-VEH-NBR          03189894
031889             MOVE ASC-KEY-OWNER-SCAC-ID    TO DK-OWNER-SCAC-ID    03189994
031890             PERFORM 4130-SELECT-TVEHICL-VAL                      03190094
031891             IF ASC-VEHICLE-SETUP-PREV                            03190194
031892                 SET PS-ERROR              TO TRUE                03190294
031893                 SET DP020-MSG-FATAL       TO TRUE                03190394
031894                 MOVE PC-TSYMSG-00988      TO DP020-MSG-NUMBER    03190494
031895                 MOVE DP015-UNP-ALP-BRT-OFF                       03190594
031896                                           TO ASCACA              03190694
031897                                              ATRLRA              03190794
031898                 MOVE DP015-RED            TO ASCACC              03190894
031899                                              ATRLRC              03190994
031900                 MOVE DP015-REVERSE        TO ASCACH              03191094
031901                                              ATRLRH              03191194
031902                 MOVE -1                   TO ASCACL              03191294
031903                 SET DP030-SET-CURSOR-APPL-1                      03191394
031904                                           TO TRUE                03191494
031905             END-IF                                               03191594
031906         END-IF                                                   03191694
031907     END-IF.                                                      03191794
031908                                                                  03191894
031909 3001-EDIT-ETA-DATE.                                              03191994
031910                                                                  03192094
031911     EXEC SQL                                                     03192194
031912         SET  :PV-DB2-HOST-DATE-30      =  CURRENT DATE           03192294
031913     END-EXEC.                                                    03192394
031914                                                                  03192494
031915     INITIALIZE DPG51 DPG52 DPG53                                 03192594
031916                DPG54 DPG55 DPG56.                                03192694
031917                                                                  03192794
031918     MOVE ASC-ETA-DTE         TO DPG52-LK-DATE-INPUT.             03192894
031919     MOVE PV-DB2-HOST-DATE-30 TO DPG53-LK-CMPR-DATE-INPUT.        03192994
031920     SET DPG51-ACTUAL-CALENDAR-ONLY                               03193094
031921         DPG51-DO-NOT-INCR-DECR-DATE                              03193194
031922         DPG52-LK-DTE-ISO-FMT            TO TRUE.                 03193294
031923     SET DPG53-LK-CMPR-DTE-ISO-FMT       TO TRUE.                 03193394
031924     CALL DP500-KOHLS-CALENDAR-ROUTINE                            03193494
031925          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03193594
031926                                                                  03193694
031927     EVALUATE TRUE                                                03193794
031928     WHEN DPG55-DAYS-DIFFERENCE > ZERO                            03193894
031929     WHEN DPG55-DAYS-DIFFERENCE = ZERO                            03193994
031930         CONTINUE                                                 03194094
031931     WHEN DPG55-DAYS-DIFFERENCE < -30                             03194194
031932         SET PS-ERROR                                             03194294
031933             DP020-MSG-FATAL   TO TRUE                            03194394
031934         MOVE PC-TSYMSG-01228  TO DP020-MSG-NUMBER                03194494
031935         MOVE 30               TO DP020-MSG-TEXT                  03194594
031936         MOVE DP015-UNP-ALP-BRT-MDT                               03194694
031937                               TO AETAMMA                         03194794
031938                                  AETADDA                         03194894
031939                                  AETAYYA                         03194994
031940         MOVE DP015-RED        TO AETAMMC                         03195094
031941                                  AETADDC                         03195194
031942                                  AETAYYC                         03195294
031943         MOVE DP015-REVERSE    TO AETAMMH                         03195394
031944                                  AETADDH                         03195494
031945                                  AETAYYH                         03195594
031946         MOVE -1               TO AETAMML                         03195694
031947         SET DP030-SET-CURSOR-APPL-1                              03195794
031948                               TO TRUE                            03195894
031949     WHEN OTHER                                                   03195994
031950         SET PS-ETA-WARNING    TO TRUE                            03196094
031951     END-EVALUATE.                                                03196194
031952/                                                                 03196294
031953*----------------------------------------------------------------*03196394
031954*  CHECK THE OPER UNIT TABLE TO VERIFY THE OPER UNIT             *03196494
031955*  ENTERED ON THE MAP IS VALID.                                  *03196594
031956*----------------------------------------------------------------*03196694
031957                                                                  03196794
031958 3010-VALIDATE-OPER-UNT-ID.                                       03196894
031959                                                                  03196994
031960     PERFORM                                                      03197094
031961         WITH TEST AFTER                                          03197194
031962         VARYING PV-RETRY-COUNTER                                 03197294
031963         FROM 1 BY 1                                              03197394
031964         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03197494
031965                   OR (SQLCODE = +0)                              03197594
031966                   OR (SQLCODE = +100)                            03197694
031967                   OR (SQLCODE = -811))                           03197794
031968                                                                  03197894
031969         EXEC SQL                                                 03197994
031970            SELECT  OPER_UNT_ID                                   03198094
031971              INTO :FACLTY-OPER-UNT-ID                            03198194
031972              FROM  TFACLTY                                       03198294
031973             WHERE  OPER_UNT_ID = :DK-OPER-UNT-ID                 03198394
031974         END-EXEC                                                 03198494
031975                                                                  03198594
031976         EVALUATE TRUE                                            03198694
031977             WHEN SQLCODE = +0                                    03198794
031978             WHEN SQLCODE = +100                                  03198894
031979             WHEN SQLCODE = -811                                  03198994
031980             WHEN SQLCODE = -904                                  03199094
031981             WHEN SQLCODE = -913                                  03199194
031982                 CONTINUE                                         03199294
031983                                                                  03199394
031984             WHEN SQLWARN0 NOT = SPACES                           03199494
031985             WHEN SQLCODE < +0                                    03199594
031986             WHEN SQLCODE > +0                                    03199694
031987                 MOVE '3010-VALIDATE-OPER-UNT-ID'                 03199794
031988                                 TO DP013-PARAGRAPH               03199894
031989                 MOVE 'SELECT OPER UNIT'                          03199994
031990                                 TO DP013-MESSAGE-TEXT (1)        03200094
031991                 MOVE DK-OPER-UNT-ID TO DP013-MESSAGE-TEXT (2)    03200194
031992                 MOVE SQLCA      TO DP013-SQLCA                   03200294
031993                 MOVE 'TFACLTY'  TO DP013-DB2-TABLE-NAME (1)      03200394
031994                 SET DP013-DB2-ABEND                              03200494
031995                                 TO TRUE                          03200594
031996                 SET DP013-XCTL-DISPLAY-RESTART                   03200694
031997                                 TO TRUE                          03200794
031998                 PERFORM DP013-0000-PROCESS-ABEND                 03200894
031999         END-EVALUATE                                             03200994
032000     END-PERFORM.                                                 03201094
032001                                                                  03201194
032002     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03201294
032003             AND (SQLCODE NOT = +0)                               03201394
032004         MOVE '3010-VALIDATE-OPER-UNT-ID'                         03201494
032005                                 TO DP013-PARAGRAPH               03201594
032006         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     03201694
032007                                 TO DP013-MESSAGE-TEXT (1)        03201794
032008         MOVE 'OPER UNIT     '   TO DP013-MESSAGE-TEXT (2)        03201894
032009         MOVE SQLCA              TO DP013-SQLCA                   03201994
032010         MOVE 'TFACLTY'          TO DP013-DB2-TABLE-NAME (1)      03202094
032011         SET DP013-DB2-ABEND     TO TRUE                          03202194
032012         SET DP013-XCTL-DISPLAY-RESTART                           03202294
032013                                 TO TRUE                          03202394
032014         PERFORM DP013-0000-PROCESS-ABEND                         03202494
032015     END-IF.                                                      03202594
032016                                                                  03202694
032017/                                                                 03202794
032018*----------------------------------------------------------------*03202894
032019*  CHECK THE FACILITY TABLE TO VERIFY THAT THE FACILITY          *03202994
032020*  ENTERED ON THE MAP IS VALID.                                  *03203094
032021*----------------------------------------------------------------*03203194
032022                                                                  03203294
032023 3020-VALIDATE-FCLTY-ID.                                          03203394
032024                                                                  03203494
032025     PERFORM                                                      03203594
032026         WITH TEST AFTER                                          03203694
032027         VARYING PV-RETRY-COUNTER                                 03203794
032028         FROM 1 BY 1                                              03203894
032029         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03203994
032030                   OR (SQLCODE = +0)                              03204094
032031                   OR (SQLCODE = +100))                           03204194
032032                                                                  03204294
032033         EXEC SQL                                                 03204394
032034            SELECT  FCLTY_ID                                      03204494
032035                   ,FCLTY_NME                                     03204594
032036              INTO :FACLTY-FCLTY-ID                               03204694
032037                  ,:FACLTY-FCLTY-NME                              03204794
032038              FROM  TFACLTY                                       03204894
032039             WHERE  OPER_UNT_ID = :DK-OPER-UNT-ID                 03204994
032040               AND  FCLTY_ID    = :DK-FCLTY-ID                    03205094
032041         END-EXEC                                                 03205194
032042                                                                  03205294
032043         EVALUATE TRUE                                            03205394
032044             WHEN SQLCODE = +0                                    03205494
032045             WHEN SQLCODE = +100                                  03205594
032046             WHEN SQLCODE = -904                                  03205694
032047             WHEN SQLCODE = -913                                  03205794
032048                 CONTINUE                                         03205894
032049                                                                  03205994
032050             WHEN SQLWARN0 NOT = SPACES                           03206094
032051             WHEN SQLCODE < +0                                    03206194
032052             WHEN SQLCODE > +0                                    03206294
032053                 MOVE '3020-VALIDATE-FCLTY-ID'                    03206394
032054                                 TO DP013-PARAGRAPH               03206494
032055                 MOVE 'SELECT FACILITY ID '                       03206594
032056                                 TO DP013-MESSAGE-TEXT (1)        03206694
032057                 MOVE DK-OPER-UNT-ID TO DP013-MESSAGE-TEXT (2)    03206794
032058                 MOVE DK-FCLTY-ID    TO DP013-MESSAGE-TEXT (3)    03206894
032059                 MOVE SQLCA      TO DP013-SQLCA                   03206994
032060                 MOVE 'TFACLTY'  TO DP013-DB2-TABLE-NAME (1)      03207094
032061                 SET DP013-DB2-ABEND                              03207194
032062                                 TO TRUE                          03207294
032063                 SET DP013-XCTL-DISPLAY-RESTART                   03207394
032064                                 TO TRUE                          03207494
032065                 PERFORM DP013-0000-PROCESS-ABEND                 03207594
032066         END-EVALUATE                                             03207694
032067     END-PERFORM.                                                 03207794
032068                                                                  03207894
032069     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03207994
032070             AND (SQLCODE NOT = +0)                               03208094
032071         MOVE '3020-VALIDATE-FCLTY-ID'                            03208194
032072                                 TO DP013-PARAGRAPH               03208294
032073         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     03208394
032074                                 TO DP013-MESSAGE-TEXT (1)        03208494
032075         MOVE 'FACILITY ID   '   TO DP013-MESSAGE-TEXT (2)        03208594
032076         MOVE SQLCA              TO DP013-SQLCA                   03208694
032077         MOVE 'TFACLTY'          TO DP013-DB2-TABLE-NAME (1)      03208794
032078         SET DP013-DB2-ABEND     TO TRUE                          03208894
032079         SET DP013-XCTL-DISPLAY-RESTART                           03208994
032080                                 TO TRUE                          03209094
032081         PERFORM DP013-0000-PROCESS-ABEND                         03209194
032082     END-IF.                                                      03209294
032083                                                                  03209394
032084/                                                                 03209494
032085*----------------------------------------------------------------*03209594
032086*  CHECK THE FACILITY AREA TABLE TO VERIFY THAT THE FACILITY    * 03209694
032087*  AREA ENTERED IS VALID.                                        *03209794
032088*----------------------------------------------------------------*03209894
032089                                                                  03209994
032090 3030-VALIDATE-FCLTY-AREA-ID.                                     03210094
032091                                                                  03210194
032092     PERFORM                                                      03210294
032093         WITH TEST AFTER                                          03210394
032094         VARYING PV-RETRY-COUNTER                                 03210494
032095         FROM 1 BY 1                                              03210594
032096         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03210694
032097                   OR (SQLCODE = +0)                              03210794
032098                   OR (SQLCODE = +100))                           03210894
032099                                                                  03210994
032100         EXEC SQL                                                 03211094
032101            SELECT  FCLTY_AREA_ID                                 03211194
032102                 ,  SUBAREA_OF_ID                                 03211294
032103              INTO :FLAREA-FCLTY-AREA-ID                          03211394
032104                 , :FLAREA-SUBAREA-OF-ID                          03211494
032105                     :DN-SUBAREA-OF-ID                            03211594
032106              FROM  TFLAREA                                       03211694
032107             WHERE  OPER_UNT_ID       = :DK-OPER-UNT-ID           03211794
032108               AND  FCLTY_ID          = :DK-FCLTY-ID              03211894
032109               AND  FCLTY_AREA_ID     = :DK-FCLTY-AREA-ID         03211994
032110               AND  FCLTY_LOC_TYP_CDE IN                          03212094
032111               (:DK-FCLTY-LOC-TYP-CDE-1,:DK-FCLTY-LOC-TYP-CDE-2)  03212194
032112         END-EXEC                                                 03212294
032113                                                                  03212394
032114         EVALUATE TRUE                                            03212494
032115             WHEN SQLCODE = +0                                    03212594
032116             WHEN SQLCODE = +100                                  03212694
032117             WHEN SQLCODE = -904                                  03212794
032118             WHEN SQLCODE = -913                                  03212894
032119                 CONTINUE                                         03212994
032120                                                                  03213094
032121             WHEN SQLWARN0 NOT = SPACES                           03213194
032122             WHEN SQLCODE < +0                                    03213294
032123             WHEN SQLCODE > +0                                    03213394
032124                 MOVE SPACES TO PV-MESSAGE                        03213494
032125                 MOVE DK-OPER-UNT-ID TO PV-MESSAGE1               03213594
032126                 MOVE DK-FCLTY-ID    TO PV-MESSAGE2               03213694
032127                 MOVE DK-FCLTY-AREA-ID TO PV-MESSAGE3             03213794
032128                 MOVE '3030-VALIDATE-FCLTY-AREA-ID'               03213894
032129                                 TO DP013-PARAGRAPH               03213994
032130                 MOVE 'SELECT FACILITY AREA ID'                   03214094
032131                                 TO DP013-MESSAGE-TEXT (1)        03214194
032132                 MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT (2)        03214294
032133                 MOVE SQLCA      TO DP013-SQLCA                   03214394
032134                 MOVE 'TFLAREA'  TO DP013-DB2-TABLE-NAME (1)      03214494
032135                 SET DP013-DB2-ABEND                              03214594
032136                                 TO TRUE                          03214694
032137                 SET DP013-XCTL-DISPLAY-RESTART                   03214794
032138                                 TO TRUE                          03214894
032139                 PERFORM DP013-0000-PROCESS-ABEND                 03214994
032140         END-EVALUATE                                             03215094
032141     END-PERFORM.                                                 03215194
032142                                                                  03215294
032143     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03215394
032144             AND (SQLCODE NOT = +0)                               03215494
032145         MOVE '3030-VALIDATE-FCLTY-AREA-ID'                       03215594
032146                                 TO DP013-PARAGRAPH               03215694
032147         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     03215794
032148                                 TO DP013-MESSAGE-TEXT (1)        03215894
032149         MOVE 'FACILITY AREA ID' TO DP013-MESSAGE-TEXT (2)        03215994
032150         MOVE SQLCA              TO DP013-SQLCA                   03216094
032151         MOVE 'TFLAREA'          TO DP013-DB2-TABLE-NAME (1)      03216194
032152         SET DP013-DB2-ABEND     TO TRUE                          03216294
032153         SET DP013-XCTL-DISPLAY-RESTART                           03216394
032154                                 TO TRUE                          03216494
032155         PERFORM DP013-0000-PROCESS-ABEND                         03216594
032156     END-IF.                                                      03216694
032160                                                                  03216700
032170/                                                                 03217000
032180*----------------------------------------------------------------*03218000
032190*  CHECK THE FACILITY AREA TABLE TO VERIFY THAT THE FACILITY    * 03219000
032200*  AREA ENTERED IS A VALID SUBAREA ID.                           *03220000
032210*----------------------------------------------------------------*03221000
032220                                                                  03222000
032230 3035-VALIDATE-SUBAREA-OF-ID.                                     03223000
032240                                                                  03224000
032250     PERFORM                                                      03225000
032260         WITH TEST AFTER                                          03226000
032270         VARYING PV-RETRY-COUNTER                                 03227000
032280         FROM 1 BY 1                                              03228000
032290         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03229000
032300                   OR (SQLCODE = +0)                              03230000
032310                   OR (SQLCODE = +100))                           03231000
032320                                                                  03232000
032330         EXEC SQL                                                 03233000
032340            SELECT  SUBAREA_OF_ID                                 03234000
032350                 ,  FCLTY_LOC_TYP_CDE                             03235000
032360              INTO :FLAREA-SUBAREA-OF-ID                          03236000
032370                     :DN-SUBAREA-OF-ID                            03237000
032380                 , :FLAREA-FCLTY-LOC-TYP-CDE                      03238000
032390              FROM  TFLAREA                                       03239000
032400             WHERE  OPER_UNT_ID       = :DK-OPER-UNT-ID           03240000
032410               AND  FCLTY_ID          = :DK-FCLTY-ID              03241000
032420               AND  FCLTY_AREA_ID     = :DK-FCLTY-AREA-ID         03242000
032430               AND  SUBAREA_OF_ID     = :DK-SUBAREA-OF-ID         03243000
032440         END-EXEC                                                 03244000
032450                                                                  03245000
032460         EVALUATE TRUE                                            03246000
032470             WHEN SQLCODE = +0                                    03247000
032480             WHEN SQLCODE = +100                                  03248000
032490             WHEN SQLCODE = -904                                  03249000
032500             WHEN SQLCODE = -913                                  03250000
032510                 CONTINUE                                         03251000
032520                                                                  03252000
032530             WHEN SQLWARN0 NOT = SPACES                           03253000
032540             WHEN SQLCODE < +0                                    03254000
032550             WHEN SQLCODE > +0                                    03255000
032560                 MOVE SPACES TO PV-MESSAGE                        03256000
032570                 MOVE DK-OPER-UNT-ID TO PV-MESSAGE1               03257000
032580                 MOVE DK-FCLTY-ID    TO PV-MESSAGE2               03258000
032590                 MOVE DK-FCLTY-AREA-ID TO PV-MESSAGE3             03259000
032600                 MOVE '3035-VALIDATE-SUBAREA-OF-ID'               03260000
032610                                 TO DP013-PARAGRAPH               03261000
032620                 MOVE 'SELECT SUBAREA OF ID   '                   03262000
032630                                 TO DP013-MESSAGE-TEXT (1)        03263000
032640                 MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT (2)        03264000
032650                 MOVE DK-SUBAREA-OF-ID TO DP013-MESSAGE-TEXT (3)  03265000
032660                 MOVE SQLCA      TO DP013-SQLCA                   03266000
032670                 MOVE 'TFLAREA'  TO DP013-DB2-TABLE-NAME (1)      03267000
032680                 SET DP013-DB2-ABEND                              03268000
032690                                 TO TRUE                          03269000
032700                 SET DP013-XCTL-DISPLAY-RESTART                   03270000
032710                                 TO TRUE                          03271000
032720                 PERFORM DP013-0000-PROCESS-ABEND                 03272000
032730         END-EVALUATE                                             03273000
032740     END-PERFORM.                                                 03274000
032750                                                                  03275000
032760     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03276000
032770             AND (SQLCODE NOT = +0)                               03277000
032780         MOVE '3035-VALIDATE-SUBAREA-OF-ID'                       03278000
032790                                 TO DP013-PARAGRAPH               03279000
032800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     03280000
032810                                 TO DP013-MESSAGE-TEXT (1)        03281000
032820         MOVE 'SUBAREA OF ID   ' TO DP013-MESSAGE-TEXT (2)        03282000
032830         MOVE SQLCA              TO DP013-SQLCA                   03283000
032840         MOVE 'TFLAREA'          TO DP013-DB2-TABLE-NAME (1)      03284000
032850         SET DP013-DB2-ABEND     TO TRUE                          03285000
032860         SET DP013-XCTL-DISPLAY-RESTART                           03286000
032870                                 TO TRUE                          03287000
032880         PERFORM DP013-0000-PROCESS-ABEND                         03288000
032890     END-IF.                                                      03289000
032900                                                                  03290000
032910/                                                                 03291000
032920*----------------------------------------------------------------*03292000
032930*  CHECK THE TRIP STATUS CODE TABLE TO VERIFY THE STATUS         *03293000
032940*  ENTERED IS VALID.                                             *03294000
032950*----------------------------------------------------------------*03295000
032960                                                                  03296000
032970 3040-VALIDATE-TRIP-STATUS-CDE.                                   03297000
032980                                                                  03298000
032990     PERFORM                                                      03299000
033000         WITH TEST AFTER                                          03300000
033010         VARYING PV-RETRY-COUNTER                                 03301000
033020         FROM 1 BY 1                                              03302000
033030         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03303000
033040                   OR (SQLCODE = +0)                              03304000
033050                   OR (SQLCODE = +100))                           03305000
033060                                                                  03306000
033070         EXEC SQL                                                 03307000
033080            SELECT  TRIP_STATUS_CDE                               03308000
033090                   ,DESC                                          03309000
033100                   ,PRTY_CDE                                      03310000
033110              INTO :TRSTYP-TRIP-STATUS-CDE                        03311000
033120                  ,:TRSTYP-DESC                                   03312000
033130                  ,:TRSTYP-PRTY-CDE                               03313000
033140              FROM  TTRSTYP                                       03314000
033150             WHERE  TRIP_STATUS_CDE = :DK-TRIP-STATUS-CDE         03315000
033160         END-EXEC                                                 03316000
033170                                                                  03317000
033180         EVALUATE TRUE                                            03318000
033190             WHEN SQLCODE = +0                                    03319000
033200             WHEN SQLCODE = +100                                  03320000
033210             WHEN SQLCODE = -904                                  03321000
033220             WHEN SQLCODE = -913                                  03322000
033230                 CONTINUE                                         03323000
033240                                                                  03324000
033250             WHEN SQLWARN0 NOT = SPACES                           03325000
033260             WHEN SQLCODE < +0                                    03326000
033270             WHEN SQLCODE > +0                                    03327000
033280                 MOVE '3040-VALIDATE-TRIP-STATUS-CDE'             03328000
033290                                 TO DP013-PARAGRAPH               03329000
033300                 MOVE 'SELECT TRIP STATUS CODE'                   03330000
033310                                 TO DP013-MESSAGE-TEXT (1)        03331000
033320                 MOVE DK-TRIP-STATUS-CDE                          03332000
033330                                 TO DP013-MESSAGE-TEXT (2)        03333000
033340                 MOVE SQLCA      TO DP013-SQLCA                   03334000
033350                 MOVE 'TTRSTYP'  TO DP013-DB2-TABLE-NAME (1)      03335000
033360                 SET DP013-DB2-ABEND                              03336000
033370                                 TO TRUE                          03337000
033380                 SET DP013-XCTL-DISPLAY-RESTART                   03338000
033390                                 TO TRUE                          03339000
033400                 PERFORM DP013-0000-PROCESS-ABEND                 03340000
033410         END-EVALUATE                                             03341000
033420     END-PERFORM.                                                 03342000
033430                                                                  03343000
033440     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03344000
033450             AND (SQLCODE NOT = +0)                               03345000
033460         MOVE '3040-VALIDATE-TRIP-STATUS-CDE'                     03346000
033470                                 TO DP013-PARAGRAPH               03347000
033480         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     03348000
033490                                 TO DP013-MESSAGE-TEXT (1)        03349000
033500         MOVE 'TRIP STATUS CODE' TO DP013-MESSAGE-TEXT (2)        03350000
033510         MOVE SQLCA              TO DP013-SQLCA                   03351000
033520         MOVE 'TTRSTYP'          TO DP013-DB2-TABLE-NAME (1)      03352000
033530         SET DP013-DB2-ABEND     TO TRUE                          03353000
033540         SET DP013-XCTL-DISPLAY-RESTART                           03354000
033550                                 TO TRUE                          03355000
033560         PERFORM DP013-0000-PROCESS-ABEND                         03356000
033570     END-IF.                                                      03357000
033580                                                                  03358000
033590/                                                                 03359000
033600*----------------------------------------------------------------*03360000
033610*  CHECK TO SEE IF THE AREA AND SUBAREA ENTERED IS OPEN          *03361000
033620*----------------------------------------------------------------*03362000
033630                                                                  03363000
033640 3050-CHECK-IF-AREA-OPEN.                                         03364000
033650                                                                  03365000
033660     PERFORM                                                      03366000
033670         WITH TEST AFTER                                          03367000
033680         VARYING PV-RETRY-COUNTER                                 03368000
033690         FROM 1 BY 1                                              03369000
033700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03370000
033710                   OR (SQLCODE = +0)                              03371000
033720                   OR (SQLCODE = +100))                           03372000
033730                                                                  03373000
033740         EXEC SQL                                                 03374000
033750          SELECT COUNT(*)                                         03375000
033760           INTO :PV-DB2-COUNT                                     03376000
033770           FROM  TFLAREA A                                        03377000
033780          WHERE  A.FCLTY_LOC_TYP_CDE IN ('DD','PS')               03378000
033790            AND  A.OPER_UNT_ID   = :DK-OPER-UNT-ID                03379000
033800            AND  A.FCLTY_ID      = :DK-FCLTY-ID                   03380000
033810            AND  A.SUBAREA_OF_ID = :DK-SUBAREA-OF-ID              03381000
033820            AND  A.FCLTY_AREA_ID IN                               03382000
033830                 (SELECT B.CURR_FAC_AREA_ID                       03383000
033840                  FROM TVEHICL B                                  03384000
033850                  WHERE B.CURR_STATUS_CDE NOT IN ('DE', 'ET')     03385000
033860                    AND A.FCLTY_AREA_ID = :DK-FCLTY-AREA-ID)      03386000
033870         END-EXEC                                                 03387000
033880                                                                  03388000
033890         EVALUATE TRUE                                            03389000
033900             WHEN SQLCODE = +0                                    03390000
033910             WHEN SQLCODE = +100                                  03391000
033920             WHEN SQLCODE = -904                                  03392000
033930             WHEN SQLCODE = -913                                  03393000
033940                 CONTINUE                                         03394000
033950                                                                  03395000
033960             WHEN SQLWARN0 NOT = SPACES                           03396000
033970             WHEN SQLCODE < +0                                    03397000
033980             WHEN SQLCODE > +0                                    03398000
033990                 MOVE '3050-CHECK-IF-AREA-OPEN'                   03399000
034000                                 TO DP013-PARAGRAPH               03400000
034010                 MOVE 'SELECT ON TFLAREA '                        03401000
034020                                 TO DP013-MESSAGE-TEXT (1)        03402000
034030                 MOVE SQLCA      TO DP013-SQLCA                   03403000
034040                 MOVE 'TFLAREA'  TO DP013-DB2-TABLE-NAME (1)      03404000
034050                 MOVE 'TVEHICL'  TO DP013-DB2-TABLE-NAME (2)      03405000
034060                 SET DP013-DB2-ABEND                              03406000
034070                                 TO TRUE                          03407000
034080                 SET DP013-XCTL-DISPLAY-RESTART                   03408000
034090                                 TO TRUE                          03409000
034100                 PERFORM DP013-0000-PROCESS-ABEND                 03410000
034110         END-EVALUATE                                             03411000
034120     END-PERFORM.                                                 03412000
034130                                                                  03413000
034140     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03414000
034150             AND (SQLCODE NOT = +0)                               03415000
034160         MOVE '3050-CHECK-IF-AREA-OPEN'                           03416000
034170                                 TO DP013-PARAGRAPH               03417000
034180         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     03418000
034190                                 TO DP013-MESSAGE-TEXT (1)        03419000
034200         MOVE 'TFLAREA         ' TO DP013-MESSAGE-TEXT (2)        03420000
034210         MOVE SQLCA              TO DP013-SQLCA                   03421000
034220         MOVE 'TFLAREA'          TO DP013-DB2-TABLE-NAME (1)      03422000
034230         MOVE 'TVEHICL'          TO DP013-DB2-TABLE-NAME (2)      03423000
034240         SET DP013-DB2-ABEND     TO TRUE                          03424000
034250         SET DP013-XCTL-DISPLAY-RESTART                           03425000
034260                                 TO TRUE                          03426000
034270         PERFORM DP013-0000-PROCESS-ABEND                         03427000
034280     END-IF.                                                      03428000
034290                                                                  03429000
034300/                                                                 03430000
034310*----------------------------------------------------------------*03431000
034320*  DETERMINE IF A SPECIFIC TRIP STATUS EXISTS                    *03432000
034330*----------------------------------------------------------------*03433000
034340 3060-CHECK-PREV-TRIP-STATUS.                                     03434000
034350     IF ASC-TRIP-STATUS-CDE = 'UN'                                03435000
034360         MOVE 'UG' TO PV-TRIP-STATUS-CDE                          03436000
034370     ELSE                                                         03437000
034380         MOVE 'LG' TO PV-TRIP-STATUS-CDE.                         03438000
034390     PERFORM 4380-READ-TRIP-STATUS-TABLE.                         03439000
034400     IF SQLCODE NOT = +0                                          03440000
034410         IF ASC-TRIP-STATUS-CDE = 'UN'                            03441000
034420             MOVE PC-TSYMSG-00651      TO DP020-MSG-NUMBER        03442000
034430         ELSE                                                     03443000
034440             MOVE PC-TSYMSG-00647      TO DP020-MSG-NUMBER.       03444000
034450/                                                                 03445000
034460*----------------------------------------------------------------*03446000
034470*  CHECK THE VALUE IN THE STATUS FIELD, AND COMPARE IT WITH      *03447000
034480*  THE VALUE THAT THE STATUS FIELD HAD PREVIOUSLY.               *03448000
034490*----------------------------------------------------------------*03449000
034500                                                                  03450000
034510 3070-CHECK-STATUS.                                               03451000
034520                                                                  03452000
034530     IF  PS-NO-ERROR                                              03453000
034540     AND ASC-TRIP-STATUS-CDE = SPACES                             03454000
034550         SET PS-ERROR            TO TRUE                          03455000
034560         SET DP020-MSG-FATAL     TO TRUE                          03456000
034570         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              03457000
034580         MOVE DP015-UNP-ALP-BRT-OFF                               03458000
034590                                 TO ATRIPSA                       03459000
034600         MOVE DP015-RED          TO ATRIPSC                       03460000
034610         MOVE DP015-REVERSE      TO ATRIPSH                       03461000
034620         MOVE -1                 TO ATRIPSL                       03462000
034630         SET DP030-SET-CURSOR-APPL-1                              03463000
034640                                 TO TRUE                          03464000
034650     ELSE                                                         03465000
034660         MOVE ASC-TRIP-STATUS-CDE TO DK-TRIP-STATUS-CDE           03466000
034670         PERFORM 3040-VALIDATE-TRIP-STATUS-CDE                    03467000
034680         IF  SQLCODE = +100                                       03468000
034690             SET PS-ERROR              TO TRUE                    03469000
034700             SET DP020-MSG-FATAL       TO TRUE                    03470000
034710             MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER        03471000
034720             MOVE DP015-UNP-ALP-BRT-OFF                           03472000
034730                                       TO ATRIPSA                 03473000
034740             MOVE DP015-RED            TO ATRIPSC                 03474000
034750             MOVE DP015-REVERSE        TO ATRIPSH                 03475000
034760             MOVE -1                   TO ATRIPSL                 03476000
034770             SET DP030-SET-CURSOR-APPL-1                          03477000
034780                                       TO TRUE                    03478000
034790         ELSE                                                     03479000
034800             MOVE TRSTYP-DESC          TO ASC-TRIP-STATUS-DESC    03480000
034810                                          ATRIPSDO                03481000
034820             MOVE TRSTYP-PRTY-CDE      TO PV-TRIP-PRTY-CDE        03482000
034830         END-IF                                                   03483000
034840     END-IF.                                                      03484000
034850                                                                  03485000
034860*   CHECK STATUS PRIORITY PROGRESSION                             03486000
034870*                                                                 03487000
034880     IF  ASC-VEHICLE-SETUP-PREV                                   03488000
034890     AND PS-NO-ERROR                                              03489000
034900         IF ASC-UPDATE-PENDING AND                                03490000
034910            PV-TRIP-PRTY-CDE-N < ASC-TRIP-PRTY-CDE-N              03491000
034920             SET PS-ERROR              TO TRUE                    03492000
034930             SET DP020-MSG-FATAL       TO TRUE                    03493000
034940             MOVE PC-TSYMSG-00646      TO DP020-MSG-NUMBER        03494000
034950             MOVE DP015-UNP-ALP-BRT-OFF                           03495000
034960                                       TO ATRIPSA                 03496000
034970             MOVE DP015-RED            TO ATRIPSC                 03497000
034980             MOVE DP015-REVERSE        TO ATRIPSH                 03498000
034990             MOVE -1                   TO ATRIPSL                 03499000
035000             SET DP030-SET-CURSOR-APPL-1                          03500000
035010                                       TO TRUE                    03501000
035020         ELSE                                                     03502000
035030             IF  (ASC-TRIP-STATUS-CDE = 'DE')                     03503000
035040                     SET PS-ERROR              TO TRUE            03504000
035050                     SET DP020-MSG-FATAL       TO TRUE            03505000
035060                     MOVE PC-TSYMSG-00005                         03506000
035070                                       TO DP020-MSG-NUMBER        03507000
035080                     MOVE DP015-UNP-ALP-BRT-OFF                   03508000
035090                                               TO ATRIPSA         03509000
035100                     MOVE DP015-RED            TO ATRIPSC         03510000
035110                     MOVE DP015-REVERSE        TO ATRIPSH         03511000
035120                     MOVE -1                   TO ATRIPSL         03512000
035130                     SET DP030-SET-CURSOR-APPL-1                  03513000
035140                                               TO TRUE            03514000
035150             ELSE                                                 03515000
035160               IF  ASC-NEW-STOP-PENDING                           03516000
035170                   IF  (ASC-TRIP-STATUS-CDE = 'EN' OR             03517000
035180                        ASC-TRIP-STATUS-CDE = 'AR')               03518000
035190                       CONTINUE                                   03519000
035200                   ELSE                                           03520000
035210                       SET PS-ERROR              TO TRUE          03521000
035220                       SET DP020-MSG-FATAL       TO TRUE          03522000
035230                       MOVE PC-TSYMSG-00751                       03523000
035240                                           TO DP020-MSG-NUMBER    03524000
035250                       MOVE DP015-UNP-ALP-BRT-OFF                 03525000
035260                                                 TO ATRIPSA       03526000
035270                       MOVE DP015-RED            TO ATRIPSC       03527000
035280                       MOVE DP015-REVERSE        TO ATRIPSH       03528000
035290                       MOVE -1                   TO ATRIPSL       03529000
035300                       SET DP030-SET-CURSOR-APPL-1                03530000
035310                                                 TO TRUE          03531000
035320                   END-IF                                         03532000
035330               END-IF                                             03533000
035340               IF  (ASC-TRIP-STATUS-CDE = 'UN' AND                03534000
035350                    ASC-TRIP-STATUS-CDE-OLD NOT = 'UN' AND        03535000
035360                    ASC-TRIP-STATUS-CDE-OLD NOT = 'UG') OR        03536000
035370                   (ASC-TRIP-STATUS-CDE = 'LD' AND                03537000
035380                    ASC-TRIP-STATUS-CDE-OLD NOT = 'LD' AND        03538000
035390                    ASC-TRIP-STATUS-CDE-OLD NOT = 'LG')           03539000
035400                   PERFORM 3060-CHECK-PREV-TRIP-STATUS            03540000
035410                   IF SQLCODE NOT = +0                            03541000
035420                       SET PS-ERROR              TO TRUE          03542000
035430                       SET DP020-MSG-FATAL       TO TRUE          03543000
035440                       MOVE DP015-UNP-ALP-BRT-OFF                 03544000
035450                                                 TO ATRIPSA       03545000
035460                       MOVE DP015-RED            TO ATRIPSC       03546000
035470                       MOVE DP015-REVERSE        TO ATRIPSH       03547000
035480                       MOVE -1                   TO ATRIPSL       03548000
035490                       SET DP030-SET-CURSOR-APPL-1                03549000
035500                                                 TO TRUE          03550000
035510                   END-IF                                         03551000
035520               END-IF                                             03552000
035530             END-IF                                               03553000
035540         END-IF                                                   03554000
035550     END-IF.                                                      03555000
035560                                                                  03556000
035570     IF ASC-TRIP-STATUS-CDE = ASC-TRIP-STATUS-CDE-OLD             03557000
035580         NEXT SENTENCE                                            03558000
035590     ELSE                                                         03559000
035600         IF  ASC-TRIP-STATUS-CDE         = 'DP'                   03560000
035610          OR ASC-TRIP-STATUS-CDE         = 'CM'                   03561000
035620          OR ASC-TRIP-STATUS-CDE         = 'ET'                   03562000
035630             SET ASC-VEHICLE-DEPARTED  TO TRUE                    03563000
035640         END-IF                                                   03564000
035650         IF  ASC-TRIP-STATUS-CDE         = 'EN'                   03565000
035660             SET ASC-VEHICLE-ENROUTE   TO TRUE                    03566000
035670         END-IF                                                   03567000
035680         IF  ASC-TRIP-STATUS-CDE         = 'UG'                   03568000
035690             SET ASC-VEHICLE-LOADED    TO TRUE                    03569000
035700         END-IF                                                   03570000
035710         IF  ASC-TRIP-STATUS-CDE         = 'LG'                   03571000
035720             SET ASC-VEHICLE-BEG-LOAD  TO TRUE                    03572000
035730         END-IF                                                   03573000
035740         IF  ASC-TRIP-STATUS-CDE         = 'UN'                   03574000
035750             SET ASC-VEHICLE-BEG-UNLD  TO TRUE                    03575000
035760         END-IF                                                   03576000
035770         IF  ASC-TRIP-STATUS-CDE         = 'LD'                   03577000
035780             SET ASC-VEHICLE-LOADED    TO TRUE                    03578000
035790         END-IF                                                   03579000
035800         IF  ASC-TRIP-STATUS-CDE         = 'AR'                   03580000
035810             SET ASC-VEHICLE-ARRIVED   TO TRUE                    03581000
035820         END-IF                                                   03582000
035830     END-IF.                                                      03583000
035840                                                                  03584000
035850*  CHECK IF ANY RECEIVER IN TRAILER HAS UNRESOLVED FREE-ASTRAYS   03585000
035860*                                                                 03586000
035870     IF  PS-NO-ERROR                                              03587000
035880     AND DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                   03588000
035890     AND ASC-TRIP-STATUS-CDE = 'DP'                               03589000
035900         PERFORM 3085-CHECK-FREE-ASTRAYS                          03590000
035910     END-IF.                                                      03591000
035920                                                                  03592000
035930     IF  PV-DB2-COUNT > 0                                         03593000
035940         SET PS-ERROR              TO TRUE                        03594000
035950         SET DP020-MSG-FATAL       TO TRUE                        03595000
035960         MOVE PC-TSYMSG-03103      TO DP020-MSG-NUMBER            03596000
035970         MOVE DP015-UNP-ALP-BRT-OFF                               03597000
035980                                   TO ATRIPSA                     03598000
035990         MOVE DP015-RED            TO ATRIPSC                     03599000
036000         MOVE DP015-REVERSE        TO ATRIPSH                     03600000
036010         MOVE -1                   TO ATRIPSL                     03601000
036020         SET DP030-SET-CURSOR-APPL-1                              03602000
036030                                   TO TRUE                        03603000
036040     END-IF.                                                      03604000
036041                                                                  03604170
036042*  CHECK IF ANY SHIPMENTS ARE MISSING THE 'PRO' NUMBER            03604270
036043*                                                                 03604370
036044     INITIALIZE PV-DB2-COUNT                                      03604473
036045     IF  PS-NO-ERROR                                              03604570
036046     AND DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                   03604670
036047     AND ASC-TRIP-STATUS-CDE = 'DP'                               03604770
036049         PERFORM 3075-CHECK-PRO-NBR                               03604970
036050     END-IF.                                                      03605070
036051     IF  PV-DB2-COUNT > 0                                         03605173
036052         SET PS-ERROR                                             03605273
036053             DP020-MSG-FATAL       TO TRUE                        03605373
036054         MOVE PC-TSYMSG-03705      TO DP020-MSG-NUMBER            03605473
036055         MOVE PV-DB2-COUNT         TO PV-DISP-COUNT               03605577
036056         MOVE PV-DISP-COUNT        TO DP020-MSG-TEXT              03605677
036061         MOVE -1                   TO ATRIPSL                     03606180
036062         SET DP030-SET-CURSOR-APPL-1                              03606275
036063                                   TO TRUE                        03606375
036064     END-IF.                                                      03606475
036065                                                                  03606575
036066 3075-CHECK-PRO-NBR.                                              03606675
036067     PERFORM                                                      03606775
036068         WITH TEST AFTER                                          03606875
036069         VARYING PV-RETRY-COUNTER                                 03606975
036070         FROM 1 BY 1                                              03607075
036071         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03607175
036072             OR (SQLCODE = +0)                                    03607275
036073             OR (SQLCODE = +100))                                 03607375
036074                                                                  03607475
036075         EXEC SQL                                                 03607575
036076              SELECT COUNT(*)                                     03607675
036077                INTO :PV-DB2-COUNT                                03607775
036078                FROM  TSHIPMT                                     03607875
036079               WHERE TRIP_ID        = :ASC-KEY-TRIP-ID            03607975
036080                 AND NOT PRO_NBR    > '                      '    03608079
036081               WITH UR                                            03608181
036082         END-EXEC                                                 03608275
036083                                                                  03608375
036084         EVALUATE TRUE                                            03608475
036085             WHEN SQLCODE = +0                                    03608575
036086             WHEN SQLCODE = +100                                  03608675
036087             WHEN SQLCODE = -904                                  03608775
036088             WHEN SQLCODE = -913                                  03608875
036089                  CONTINUE                                        03608975
036090             WHEN SQLWARN0 NOT = SPACES                           03609075
036091             WHEN SQLCODE < +0                                    03609175
036092             WHEN SQLCODE > +0                                    03609275
036093                  MOVE '3075-CHECK-PRO-NBR'                       03609375
036094                                  TO DP013-PARAGRAPH              03609475
036095                  MOVE 'UNSUCCESSFUL COUNT OF TSHIPMT TABLE'      03609575
036096                                  TO DP013-MESSAGE-TEXT (1)       03609675
036097                  MOVE SQLCA      TO DP013-SQLCA                  03609775
036098                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     03609875
036099                  SET DP013-DB2-ABEND                             03609975
036100                      DP013-XCTL-DISPLAY-RESTART                  03610075
036101                                  TO TRUE                         03610175
036102                  PERFORM DP013-0000-PROCESS-ABEND                03610275
036103         END-EVALUATE                                             03610375
036104     END-PERFORM.                                                 03610475
036105                                                                  03610575
036106     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03610675
036107             AND (SQLCODE NOT = +0)                               03610775
036108         MOVE '3075-CHECK-PRO-NBR'                                03610875
036109                                  TO DP013-PARAGRAPH              03610975
036110         MOVE 'MAX RETRIES EXCEEDED ON COUNT TSHIPMT TABLE'       03611075
036111                                  TO DP013-MESSAGE-TEXT (1)       03611175
036112         MOVE SQLCA               TO DP013-SQLCA                  03611275
036113         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     03611375
036114         SET DP013-DB2-ABEND                                      03611475
036115             DP013-XCTL-DISPLAY-RESTART                           03611575
036116                                  TO TRUE                         03611675
036117         PERFORM DP013-0000-PROCESS-ABEND                         03611775
036118     END-IF.                                                      03611875
036119                                                                  03611975
036120/                                                                 03612075
036121 3085-CHECK-FREE-ASTRAYS.                                         03612175
036122                                                                  03612275
036123     PERFORM                                                      03612375
036124         WITH TEST AFTER                                          03612475
036125         VARYING PV-RETRY-COUNTER                                 03612575
036126         FROM 1 BY 1                                              03612675
036127         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03612775
036130             OR (SQLCODE = +0)                                    03613000
036140             OR (SQLCODE = +100))                                 03614000
036150                                                                  03615000
036160         EXEC SQL                                                 03616000
036170              SELECT COUNT(*)                                     03617000
036180                INTO :PV-DB2-COUNT                                03618000
036190                FROM  TSHIPMT A                                   03619000
036200                     ,TSHPTPO B                                   03620000
036210                     ,TRECEIV C                                   03621000
036220               WHERE A.TRIP_ID        = :ASC-KEY-TRIP-ID          03622000
036230                 AND A.SHIPT_ID       = B.SHIPT_ID                03623000
036240                 AND B.PRIM_SHIPT_IND = 'Y'                       03624000
036250                 AND B.PO_NBR         = C.ORD_NBR                 03625000
036260                 AND B.REC_SEQ_NBR    = C.REC_SEQ_NBR             03626000
036270                 AND C.FRE_ASTRA_IND  = 'Y'                       03627000
036280                 AND NOT C.STATUS_CDE IN ('VE','DE')              03628093
036290         END-EXEC                                                 03629000
036300                                                                  03630000
036310         EVALUATE TRUE                                            03631000
036320             WHEN SQLCODE = +0                                    03632000
036330             WHEN SQLCODE = +100                                  03633000
036340             WHEN SQLCODE = -904                                  03634000
036350             WHEN SQLCODE = -913                                  03635000
036360                  CONTINUE                                        03636000
036370                                                                  03637000
036380             WHEN SQLWARN0 NOT = SPACES                           03638000
036390             WHEN SQLCODE < +0                                    03639000
036400             WHEN SQLCODE > +0                                    03640000
036410                  MOVE '3085-CHECK-FREE-ASTRAYS'                  03641000
036420                                  TO DP013-PARAGRAPH              03642000
036430                  MOVE 'UNSUCCESSFUL COUNT OF TSHIPMT TABLE'      03643000
036440                                  TO DP013-MESSAGE-TEXT (1)       03644000
036450                  MOVE SQLCA      TO DP013-SQLCA                  03645000
036460                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     03646000
036470                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (2)     03647000
036480                  SET DP013-DB2-ABEND                             03648000
036490                      DP013-XCTL-DISPLAY-RESTART                  03649000
036500                                  TO TRUE                         03650000
036510                  PERFORM DP013-0000-PROCESS-ABEND                03651000
036520         END-EVALUATE                                             03652000
036530     END-PERFORM.                                                 03653000
036540                                                                  03654000
036550     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03655000
036560             AND (SQLCODE NOT = +0)                               03656000
036570         MOVE '3085-CHECK-FREE-ASTRAYS'                           03657000
036580                                  TO DP013-PARAGRAPH              03658000
036590         MOVE 'MAX RETRIES EXCEEDED ON COUNT TSHIPMT TABLE'       03659000
036600                                  TO DP013-MESSAGE-TEXT (1)       03660000
036610         MOVE SQLCA               TO DP013-SQLCA                  03661000
036620         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     03662000
036630         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (2)     03663000
036640         SET DP013-DB2-ABEND                                      03664000
036650             DP013-XCTL-DISPLAY-RESTART                           03665000
036660                                  TO TRUE                         03666000
036670         PERFORM DP013-0000-PROCESS-ABEND                         03667000
036680     END-IF.                                                      03668000
036690                                                                  03669000
036700/                                                                 03670000
036710*----------------------------------------------------------------*03671000
036720*    ROUTINE TO RIGHT JUSTIFY A 6 BYTE ALPHA FIELD               *03672000
036730*----------------------------------------------------------------*03673000
036740                                                                  03674000
036750     COPY TRWS012.                                                03675000
036760/                                                                 03676000
036770*----------------------------------------------------------------*03677000
036780*  CHECK IF THE SPACE OCCUPIED IS THE SAME TRAILER BUT A         *03678000
036790*  DIFFERENT TRIP                                                *03679000
036800*----------------------------------------------------------------*03680000
036810                                                                  03681000
036820 3090-CHECK-SAME-TRIP.                                            03682000
036830     PERFORM                                                      03683000
036840         WITH TEST AFTER                                          03684000
036850         VARYING PV-RETRY-COUNTER                                 03685000
036860         FROM 1 BY 1                                              03686000
036870         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03687000
036880                   OR (SQLCODE = +0)                              03688000
036890                   OR (SQLCODE = +100))                           03689000
036900                                                                  03690000
036910         EXEC SQL                                                 03691000
036920          SELECT DISTINCT                                         03692000
036930                 CURR_FAC_AREA_ID                                 03693000
036940           INTO :VEHICL-CURR-FAC-AREA-ID                          03694000
036950           FROM  TVEHICL A                                        03695000
036960          WHERE  A.CURR_FAC_AREA_ID = :DK-FCLTY-AREA-ID           03696000
036970            AND  A.CURR_STATUS_CDE NOT IN ('DE', 'ET')            03697000
036980            AND  A.OWNER_SCAC_ID = :DK-OWNER-SCAC-ID              03698000
036990            AND  A.VEH_NBR       = :DK-VEH-NBR                    03699000
037000         END-EXEC                                                 03700000
037010                                                                  03701000
037020         EVALUATE TRUE                                            03702000
037030             WHEN SQLCODE = +100                                  03703000
037040                 SET PS-SPACE-ERROR TO TRUE                       03704000
037050             WHEN SQLCODE = +0                                    03705000
037060             WHEN SQLCODE = -904                                  03706000
037070             WHEN SQLCODE = -913                                  03707000
037080                 CONTINUE                                         03708000
037090                                                                  03709000
037100             WHEN SQLWARN0 NOT = SPACES                           03710000
037110             WHEN SQLCODE < +0                                    03711000
037120             WHEN SQLCODE > +0                                    03712000
037130                 MOVE SPACES TO PV-MESSAGE                        03713000
037140                 MOVE DK-OWNER-SCAC-ID TO PV-MESSAGE1             03714000
037150                 MOVE DK-VEH-NBR       TO PV-MESSAGE2             03715000
037160                 MOVE DK-FCLTY-AREA-ID TO PV-MESSAGE3             03716000
037170                 MOVE '3090-CHECK-SAME-TRIP'                      03717000
037180                                 TO DP013-PARAGRAPH               03718000
037190                 MOVE 'SELECT ON TFLAREA '                        03719000
037200                                 TO DP013-MESSAGE-TEXT (1)        03720000
037210                 MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT (2)        03721000
037220                 MOVE SQLCA      TO DP013-SQLCA                   03722000
037230                 MOVE 'TVEHICL'  TO DP013-DB2-TABLE-NAME (1)      03723000
037240                 SET DP013-DB2-ABEND                              03724000
037250                                 TO TRUE                          03725000
037260                 SET DP013-XCTL-DISPLAY-RESTART                   03726000
037270                                 TO TRUE                          03727000
037280                 PERFORM DP013-0000-PROCESS-ABEND                 03728000
037290         END-EVALUATE                                             03729000
037300     END-PERFORM.                                                 03730000
037310                                                                  03731000
037320     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03732000
037330             AND (SQLCODE NOT = +0)                               03733000
037340         MOVE '3090-CHECK-SAME-TRIP'                              03734000
037350                                 TO DP013-PARAGRAPH               03735000
037360         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     03736000
037370                                 TO DP013-MESSAGE-TEXT (1)        03737000
037380         MOVE 'TVEHICL         ' TO DP013-MESSAGE-TEXT (2)        03738000
037390         MOVE SQLCA              TO DP013-SQLCA                   03739000
037400         MOVE 'TVEHICL'          TO DP013-DB2-TABLE-NAME (1)      03740000
037410         SET DP013-DB2-ABEND     TO TRUE                          03741000
037420         SET DP013-XCTL-DISPLAY-RESTART                           03742000
037430                                 TO TRUE                          03743000
037440         PERFORM DP013-0000-PROCESS-ABEND                         03744000
037450     END-IF.                                                      03745000
037460                                                                  03746000
037470/                                                                 03747000
037480*----------------------------------------------------------------*03748000
037490*  CHECK THE EXTERNAL ENTERPRISE TABLE TO VERIFY THE SCAC CODE   *03749000
037500*  ENTERED IS VALID.                                             *03750000
037510*----------------------------------------------------------------*03751000
037511* CLT 12-01-2011 WR40574 ADDED WITH UR                            03751169
037520                                                                  03752000
037530 3100-VALIDATE-SCAC-CDE.                                          03753000
037540                                                                  03754000
037550     PERFORM                                                      03755000
037560         WITH TEST AFTER                                          03756000
037570         VARYING PV-RETRY-COUNTER                                 03757000
037580         FROM 1 BY 1                                              03758000
037590         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03759000
037600                   OR (SQLCODE = +0)                              03760000
037610                   OR (SQLCODE = +100)                            03761000
037620                   OR (SQLCODE = -811))                           03762000
037630                                                                  03763000
037640         EXEC SQL                                                 03764000
037650            SELECT  SCAC_CDE                                      03765000
037660              INTO :EXTENT-SCAC-CDE                               03766000
037670              FROM  TEXTENT                                       03767000
037680             WHERE  SCAC_CDE    = :DK-OWNER-SCAC-ID               03768000
037690               AND  CARRIER_IND = 'Y'                             03769000
037691             WITH UR                                              03769169
037700         END-EXEC                                                 03770000
037710                                                                  03771000
037720         EVALUATE TRUE                                            03772000
037730             WHEN SQLCODE = +0                                    03773000
037740             WHEN SQLCODE = +100                                  03774000
037750             WHEN SQLCODE = -811                                  03775000
037760             WHEN SQLCODE = -904                                  03776000
037770             WHEN SQLCODE = -913                                  03777000
037780                 CONTINUE                                         03778000
037790                                                                  03779000
037800             WHEN SQLWARN0 NOT = SPACES                           03780000
037810             WHEN SQLCODE < +0                                    03781000
037820             WHEN SQLCODE > +0                                    03782000
037830                 MOVE '3100-VALIDATE-SCAC-CDE'                    03783000
037840                                 TO DP013-PARAGRAPH               03784000
037850                 MOVE 'SELECT SCAC CODE'                          03785000
037860                                 TO DP013-MESSAGE-TEXT (1)        03786000
037870                 MOVE DK-OWNER-SCAC-ID                            03787000
037880                                 TO DP013-MESSAGE-TEXT (2)        03788000
037890                 MOVE SQLCA      TO DP013-SQLCA                   03789000
037900                 MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (1)      03790000
037910                 SET DP013-DB2-ABEND                              03791000
037920                                 TO TRUE                          03792000
037930                 SET DP013-XCTL-DISPLAY-RESTART                   03793000
037940                                 TO TRUE                          03794000
037950                 PERFORM DP013-0000-PROCESS-ABEND                 03795000
037960         END-EVALUATE                                             03796000
037970     END-PERFORM.                                                 03797000
037980                                                                  03798000
037990     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03799000
038000             AND (SQLCODE NOT = +0)                               03800000
038010         MOVE '3100-VALIDATE-SCAC-CDE'                            03801000
038020                                 TO DP013-PARAGRAPH               03802000
038030         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     03803000
038040                                 TO DP013-MESSAGE-TEXT (1)        03804000
038050         MOVE 'SCAC CODE       ' TO DP013-MESSAGE-TEXT (2)        03805000
038060         MOVE SQLCA              TO DP013-SQLCA                   03806000
038070         MOVE 'TEXTENT'          TO DP013-DB2-TABLE-NAME (1)      03807000
038080         SET DP013-DB2-ABEND     TO TRUE                          03808000
038090         SET DP013-XCTL-DISPLAY-RESTART                           03809000
038100                                 TO TRUE                          03810000
038110         PERFORM DP013-0000-PROCESS-ABEND                         03811000
038120     END-IF.                                                      03812000
038130                                                                  03813000
038140/                                                                 03814000
038150*----------------------------------------------------------------*03815000
038160*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *03816000
038170*----------------------------------------------------------------*03817000
038180                                                                  03818000
038190 3200-RESET-ATTRIBUTES.                                           03819000
038200                                                                  03820000
038210     EVALUATE ASC-VEH-TYP-CDE                                     03821000
038220         WHEN 'TR'                                                03822000
038230         IF ASC-CURR-OPER-UNT-ID-N = 90                           03823000
038240             MOVE DP015-UNP-ALP-NOR-OFF                           03824000
038250                                 TO ATRIPTPA                      03825000
038260             MOVE DP015-GREEN TO ATRIPTPC                         03826000
038270             MOVE DP015-UNDERLINE TO ATRIPTPH                     03827000
038280         ELSE                                                     03828000
038290             MOVE DP015-PRO-NOR-OFF TO ATRIPTPA                   03829000
038300             MOVE DP015-BLUE      TO ATRIPTPC                     03830000
038310         END-IF                                                   03831000
038320         WHEN 'VS'                                                03832000
038330         WHEN 'AV'                                                03833000
038340             MOVE DP015-UNP-ALP-NOR-OFF                           03834000
038350                                    TO ATRIPTPA                   03835000
038360             MOVE DP015-GREEN       TO ATRIPTPC                   03836000
038370             MOVE DP015-UNDERLINE   TO ATRIPTPH                   03837000
038380         WHEN OTHER                                               03838000
038390             MOVE DP015-UNP-ALP-NOR-OFF                           03839000
038400                                    TO ATRIPTPA                   03840000
038410             MOVE DP015-GREEN       TO ATRIPTPC                   03841000
038420             MOVE DP015-UNDERLINE   TO ATRIPTPH                   03842000
038430     END-EVALUATE                                                 03843000
038440                                                                  03844000
038450     IF  ASC-NEW-STOP-PENDING                                     03845000
038460         MOVE DP015-UNP-ALP-NOR-OFF TO ADOPERA                    03846000
038470                                       ADFIDA                     03847000
038480                                       ADAREAA                    03848000
038490                                       ADSUBA                     03849000
038500                                       ADOPERA                    03850000
038510                                       ADFIDA                     03851000
038520                                       AMANA                      03852000
038530                                       ASEAL1A                    03853000
038540                                       AETAMMA                    03854000
038550                                       AETADDA                    03855000
038560                                       AETAYYA                    03856000
038570                                       ACSHPMMA                   03857000
038580                                       ACSHPDDA                   03858000
038590                                       ACSHPYYA                   03859000
038600         MOVE DP015-GREEN           TO ADOPERC                    03860000
038610                                       ADFIDC                     03861000
038620                                       ADAREAC                    03862000
038630                                       ADSUBC                     03863000
038640                                       ADOPERC                    03864000
038650                                       ADFIDC                     03865000
038660                                       AMANC                      03866000
038670                                       ASEAL1C                    03867000
038680                                       AETAMMC                    03868000
038690                                       AETADDC                    03869000
038700                                       AETAYYC                    03870000
038710                                       ACSHPMMC                   03871000
038720                                       ACSHPDDC                   03872000
038730                                       ACSHPYYC                   03873000
038740         MOVE DP015-UNDERLINE       TO ASCACH                     03874000
038750                                       ATRLRH                     03875000
038760                                       ADOPERH                    03876000
038770                                       ADFIDH                     03877000
038780                                       ADAREAH                    03878000
038790                                       ADSUBH                     03879000
038800                                       AMANH                      03880000
038810                                       ASEAL1H                    03881000
038820                                       AETAMMH                    03882000
038830                                       AETADDH                    03883000
038840                                       AETAYYH                    03884000
038850                                       ACSHPMMH                   03885000
038860                                       ACSHPDDH                   03886000
038870                                       ACSHPYYH                   03887000
038880         MOVE DP015-PRO-NOR-OFF     TO ASCACA                     03888000
038890                                       ACOPERA                    03889000
038900                                       ACFIDA                     03890000
038910                                       AUSEA                      03891000
038920                                       ALGTHA                     03892000
038930                                       ATRLRA                     03893000
038940                                       ATRIPSA                    03894000
038950                                       ACAREAA                    03895000
038960                                       ACSUBA                     03896000
038970                                       ASEAL2A                    03897000
038980         MOVE DP015-BLUE            TO ASCACC                     03898000
038990                                       ACOPERC                    03899000
039000                                       ACFIDC                     03900000
039010                                       AUSEC                      03901000
039020                                       ALGTHC                     03902000
039030                                       ATRLRC                     03903000
039040                                       ATRIPSC                    03904000
039050                                       ACAREAC                    03905000
039060                                       ACSUBC                     03906000
039070                                       ASEAL2C                    03907000
039080         MOVE DP015-HL-OFF          TO ASCACH                     03908000
039090                                       ACOPERH                    03909000
039100                                       ACFIDH                     03910000
039110                                       AUSEH                      03911000
039120                                       ALGTHH                     03912000
039130                                       ATRLRH                     03913000
039140                                       ATRIPSH                    03914000
039150                                       ACAREAH                    03915000
039160                                       ACSUBH                     03916000
039170                                       ASEAL2H                    03917000
039180     ELSE                                                         03918000
039190     IF  ASC-ADD-PENDING                                          03919000
039200         MOVE DP015-PRO-NOR-OFF     TO ASCACA                     03920000
039210                                       ATRLRA                     03921000
039220                                       ASEAL2A                    03922000
039230         MOVE DP015-UNP-ALP-NOR-OFF TO ACOPERA                    03923000
039240                                       ACFIDA                     03924000
039250                                       ACAREAA                    03925000
039260                                       ACSUBA                     03926000
039270                                       ATRIPSA                    03927000
039280                                       ADOPERA                    03928000
039290                                       ADFIDA                     03929000
039300                                       ADAREAA                    03930000
039310                                       ADSUBA                     03931000
039320                                       AUSEA                      03932000
039330                                       AMANA                      03933000
039340                                       ASEAL1A                    03934000
039350                                       ACSHPMMA                   03935000
039360                                       ACSHPDDA                   03936000
039370                                       ACSHPYYA                   03937000
039380         MOVE DP015-BLUE            TO ASCACC                     03938000
039390                                       ATRLRC                     03939000
039400                                       ASEAL2C                    03940000
039410         MOVE DP015-GREEN           TO ACAREAC                    03941000
039420                                       ACSUBC                     03942000
039430                                       ACOPERC                    03943000
039440                                       ACFIDC                     03944000
039450                                       ATRIPSC                    03945000
039460                                       ADOPERC                    03946000
039470                                       ADFIDC                     03947000
039480                                       ADAREAC                    03948000
039490                                       ADSUBC                     03949000
039500                                       AUSEC                      03950000
039510                                       AMANC                      03951000
039520                                       ASEAL1C                    03952000
039530                                       AETAMMC                    03953000
039540                                       AETADDC                    03954000
039550                                       AETAYYC                    03955000
039560                                       ACSHPMMC                   03956000
039570                                       ACSHPDDC                   03957000
039580                                       ACSHPYYC                   03958000
039590         MOVE DP015-HL-OFF          TO ASCACH                     03959000
039600                                       ATRLRH                     03960000
039610                                       ASEAL2H                    03961000
039620         MOVE DP015-UNDERLINE       TO ACAREAH                    03962000
039630                                       ACSUBH                     03963000
039640                                       ACOPERH                    03964000
039650                                       ACFIDH                     03965000
039660                                       ATRIPSH                    03966000
039670                                       ADAREAH                    03967000
039680                                       ADSUBH                     03968000
039690                                       ADOPERH                    03969000
039700                                       ADFIDH                     03970000
039710                                       AUSEH                      03971000
039720                                       AMANH                      03972000
039730                                       ASEAL1H                    03973000
039740                                       AETAMMH                    03974000
039750                                       AETADDH                    03975000
039760                                       AETAYYH                    03976000
039770                                       ACSHPMMH                   03977000
039780                                       ACSHPDDH                   03978000
039790                                       ACSHPYYH                   03979000
039800*                                                                 03980000
039810*        IF ASC-VEHICLE-NULL-TRIP                                 03981000
039820*            MOVE DP015-PRO-NOR-OFF TO ADOPERA                    03982000
039830*                                      ADFIDA                     03983000
039840*                                      ADAREAA                    03984000
039850*                                      ADSUBA                     03985000
039860*                                      AMANA                      03986000
039870*            MOVE DP015-BLUE        TO ADOPERC                    03987000
039880*                                      ADFIDC                     03988000
039890*                                      ADAREAC                    03989000
039900*                                      ADSUBC                     03990000
039910*                                      AMANC                      03991000
039920*            MOVE DP015-HL-OFF      TO ADOPERH                    03992000
039930*                                      ADFIDH                     03993000
039940*                                      ADAREAH                    03994000
039950*                                      ADSUBH                     03995000
039960*                                      AMANH                      03996000
039970*        END-IF                                                   03997000
039980     ELSE                                                         03998000
039990     IF  ASC-UPDATE-PENDING                                       03999000
040000         MOVE DP015-PRO-NOR-OFF     TO ASEAL2A                    04000000
040010         MOVE DP015-UNP-ALP-NOR-OFF TO ACOPERA                    04001000
040020                                       ASCACA                     04002000
040030                                       ATRLRA                     04003000
040040                                       ACFIDA                     04004000
040050                                       ACAREAA                    04005000
040060                                       ACSUBA                     04006000
040070                                       ATRIPSA                    04007000
040080                                       ADOPERA                    04008000
040090                                       ADFIDA                     04009000
040100                                       ADAREAA                    04010000
040110                                       ADSUBA                     04011000
040120                                       AUSEA                      04012000
040130                                       AMANA                      04013000
040140                                       ASEAL1A                    04014000
040150         MOVE DP015-BLUE            TO ASEAL2C                    04015000
040160         MOVE DP015-GREEN           TO ACAREAC                    04016000
040170                                       ASCACC                     04017000
040180                                       ATRLRC                     04018000
040190                                       ACSUBC                     04019000
040200                                       ACOPERC                    04020000
040210                                       ACFIDC                     04021000
040220                                       ATRIPSC                    04022000
040230                                       ADOPERC                    04023000
040240                                       ADFIDC                     04024000
040250                                       ADAREAC                    04025000
040260                                       ADSUBC                     04026000
040270                                       AUSEC                      04027000
040280                                       AMANC                      04028000
040290                                       ASEAL1C                    04029000
040300                                       AETAMMC                    04030000
040310                                       AETADDC                    04031000
040320                                       AETAYYC                    04032000
040330         MOVE DP015-HL-OFF          TO ASEAL2H                    04033000
040340         MOVE DP015-UNDERLINE       TO ACAREAH                    04034000
040350                                       ASCACH                     04035000
040360                                       ATRLRH                     04036000
040370                                       ACSUBH                     04037000
040380                                       ACOPERH                    04038000
040390                                       ACFIDH                     04039000
040400                                       ATRIPSH                    04040000
040410                                       ADAREAH                    04041000
040420                                       ADSUBH                     04042000
040430                                       ADOPERH                    04043000
040440                                       ADFIDH                     04044000
040450                                       AUSEH                      04045000
040460                                       AMANH                      04046000
040470                                       ASEAL1H                    04047000
040480                                       AETAMMH                    04048000
040490                                       AETADDH                    04049000
040500                                       AETAYYH                    04050000
040510         IF ASC-VEHICLE-NULL-TRIP                                 04051000
040520             MOVE DP015-PRO-NOR-OFF TO ADOPERA                    04052000
040530                                       ADFIDA                     04053000
040540                                       ADAREAA                    04054000
040550                                       ADSUBA                     04055000
040560                                       AMANA                      04056000
040570             MOVE DP015-BLUE        TO ADOPERC                    04057000
040580                                       ADFIDC                     04058000
040590                                       ADAREAC                    04059000
040600                                       ADSUBC                     04060000
040610                                       AMANC                      04061000
040620             MOVE DP015-HL-OFF      TO ADOPERH                    04062000
040630                                       ADFIDH                     04063000
040640                                       ADAREAH                    04064000
040650                                       ADSUBH                     04065000
040660                                       AMANH                      04066000
040670         END-IF                                                   04067000
040680     ELSE                                                         04068000
040690     IF  ASC-DELETE-PENDING                                       04069000
040700         MOVE DP015-PRO-NOR-OFF     TO ASCACA                     04070000
040710                                       ATRLRA                     04071000
040720                                       ALGTHA                     04072000
040730                                       ACOPERA                    04073000
040740                                       ACFIDA                     04074000
040750                                       ACAREAA                    04075000
040760                                       ACSUBA                     04076000
040770                                       ATRIPSA                    04077000
040780                                       ADOPERA                    04078000
040790                                       ADFIDA                     04079000
040800                                       ADAREAA                    04080000
040810                                       ADSUBA                     04081000
040820                                       AUSEA                      04082000
040830                                       AMANA                      04083000
040840                                       ASEAL1A                    04084000
040850                                       ASEAL2A                    04085000
040860                                       AETAMMA                    04086000
040870                                       AETADDA                    04087000
040880                                       AETAYYA                    04088000
040890                                       ATRIPTPA                   04089000
040900         MOVE DP015-BLUE            TO ASCACC                     04090000
040910                                       ATRLRC                     04091000
040920                                       ALGTHC                     04092000
040930                                       ACAREAC                    04093000
040940                                       ACSUBC                     04094000
040950                                       ACOPERC                    04095000
040960                                       ACFIDC                     04096000
040970                                       ATRIPSC                    04097000
040980                                       ADOPERC                    04098000
040990                                       ADFIDC                     04099000
041000                                       ADAREAC                    04100000
041010                                       ADSUBC                     04101000
041020                                       AUSEC                      04102000
041030                                       AMANC                      04103000
041040                                       ASEAL1C                    04104000
041050                                       ASEAL2C                    04105000
041060                                       AETAMMC                    04106000
041070                                       AETADDC                    04107000
041080                                       AETAYYC                    04108000
041090                                       ATRIPTPC                   04109000
041100         MOVE DP015-HL-OFF          TO ASCACH                     04110000
041110                                       ATRLRH                     04111000
041120                                       ALGTHH                     04112000
041130                                       ACAREAH                    04113000
041140                                       ACSUBH                     04114000
041150                                       ACOPERH                    04115000
041160                                       ACFIDH                     04116000
041170                                       ATRIPSH                    04117000
041180                                       ADAREAH                    04118000
041190                                       ADSUBH                     04119000
041200                                       ADOPERH                    04120000
041210                                       ADFIDH                     04121000
041220                                       AUSEH                      04122000
041230                                       AMANH                      04123000
041240                                       ASEAL1H                    04124000
041250                                       ASEAL2H                    04125000
041260                                       AETAMMH                    04126000
041270                                       AETADDH                    04127000
041280                                       AETAYYH                    04128000
041290                                       ATRIPTPH.                  04129000
041300                                                                  04130000
041310     IF ASC-SPLT-XMIT-IND NOT = SPACE                             04131000
041320         MOVE DP015-PRO-NOR-OFF     TO AETAMMA                    04132000
041330                                       AETADDA                    04133000
041340                                       AETAYYA                    04134000
041350         MOVE DP015-BLUE            TO AETAMMC                    04135000
041360                                       AETADDC                    04136000
041370                                       AETAYYC                    04137000
041380     END-IF.                                                      04138000
041390                                                                  04139000
041401                                                                  04140128
041402/                                                                 04140228
041410*----------------------------------------------------------------*04141000
041420*    SAVE SCREEN FIELDS FOR LATER COMPARISONS                    *04142000
041430*----------------------------------------------------------------*04143000
041440                                                                  04144000
041450 3500-SAVE-SCREEN-FIELDS.                                         04145000
041460                                                                  04146000
041470     MOVE ASC-KEY-OWNER-SCAC-ID  TO ASC-OWNER-SCAC-ID-OLD.        04147000
041480     MOVE ASC-KEY-VEH-NBR        TO ASC-VEH-NBR-OLD.              04148000
041490     MOVE ASC-CURR-FAC-AREA-ID   TO ASC-CURR-FAC-AREA-ID-OLD.     04149000
041500     MOVE ASC-CURR-SUBAREA-OF-ID TO ASC-CURR-SUBAREA-OF-ID-OLD.   04150000
041510     MOVE ASC-CURR-OPER-UNT-ID   TO ASC-CURR-OPER-UNT-ID-OLD.     04151000
041520     MOVE ASC-CURR-FCLTY-ID      TO ASC-CURR-FCLTY-ID-OLD.        04152000
041530     MOVE ASC-TRIP-STATUS-CDE    TO ASC-TRIP-STATUS-CDE-OLD.      04153000
041540     MOVE ASC-DEST-FAC-AREA-ID   TO ASC-DEST-FAC-AREA-ID-OLD.     04154000
041550     MOVE ASC-DEST-SUBAREA-OF-ID TO ASC-DEST-SUBAREA-OF-ID-OLD.   04155000
041560     MOVE ASC-DEST-OPER-UNT-ID   TO ASC-DEST-OPER-UNT-ID-OLD.     04156000
041570     MOVE ASC-DEST-FCLTY-ID      TO ASC-DEST-FCLTY-ID-OLD.        04157000
041580     MOVE ASC-USAGE-CDE          TO ASC-USAGE-CDE-OLD.            04158000
041590     MOVE ASC-LENGTH             TO ASC-LENGTH-OLD.               04159000
041600     MOVE ASC-MANIFEST-NBR       TO ASC-MANIFEST-NBR-OLD.         04160000
041610     MOVE ASC-SEAL-1             TO ASC-SEAL-1-OLD.               04161000
041620*    MOVE ASC-SEAL-2             TO ASC-SEAL-2-OLD.               04162000
041630     MOVE ASC-ETA-DTE            TO ASC-ETA-DTE-OLD.              04163000
041640     MOVE ASC-OWNR-SCAC-SHP-DTE  TO ASC-OWNR-SHP-DTE-OLD.         04164000
041650     MOVE ASC-VEH-TYP-CDE        TO ASC-VEH-TYP-CDE-OLD.          04165000
041660/                                                                 04166000
041670*----------------------------------------------------------------*04167000
041680*  CHECK TO SEE IF ANY FIELDS CHANGED.                           *04168000
041690*----------------------------------------------------------------*04169000
041700                                                                  04170000
041710 3600-CHECK-IF-FIELDS-CHANGED.                                    04171000
041720                                                                  04172000
041730     MOVE 'N'                    TO ASC-FIELDS-CHANGED-SW.        04173000
041740                                                                  04174000
041750     IF  ASC-CURR-FAC-AREA-ID   = ASC-CURR-FAC-AREA-ID-OLD        04175000
041760     AND ASC-CURR-SUBAREA-OF-ID = ASC-CURR-SUBAREA-OF-ID-OLD      04176000
041770     AND ASC-CURR-OPER-UNT-ID   = ASC-CURR-OPER-UNT-ID-OLD        04177000
041780     AND ASC-CURR-FCLTY-ID      = ASC-CURR-FCLTY-ID-OLD           04178000
041790     AND ASC-TRIP-STATUS-CDE    = ASC-TRIP-STATUS-CDE-OLD         04179000
041800     AND ASC-DEST-FAC-AREA-ID   = ASC-DEST-FAC-AREA-ID-OLD        04180000
041810     AND ASC-DEST-SUBAREA-OF-ID = ASC-DEST-SUBAREA-OF-ID-OLD      04181000
041820     AND ASC-DEST-OPER-UNT-ID   = ASC-DEST-OPER-UNT-ID-OLD        04182000
041830     AND ASC-DEST-FCLTY-ID      = ASC-DEST-FCLTY-ID-OLD           04183000
041840     AND ASC-USAGE-CDE          = ASC-USAGE-CDE-OLD               04184000
041850     AND ASC-LENGTH             = ASC-LENGTH-OLD                  04185000
041860     AND ASC-MANIFEST-NBR       = ASC-MANIFEST-NBR-OLD            04186000
041870*    AND ASC-SEAL-1             = ASC-SEAL-1-OLD                  04187000
041880*    AND ASC-SEAL-2             = ASC-SEAL-2-OLD                  04188000
041890     AND ASC-ETA-DTE            = ASC-ETA-DTE-OLD                 04189000
041900     AND ASC-ETA-TIME           = ASC-ETA-TIME-OLD                04190000
041910     AND ASC-OWNR-SCAC-SHP-DTE  = ASC-OWNR-SHP-DTE-OLD            04191000
041920     AND ASC-KEY-OWNER-SCAC-ID  = ASC-OWNER-SCAC-ID-OLD           04192000
041930     AND ASC-KEY-VEH-NBR        = ASC-VEH-NBR-OLD                 04193000
041940     AND ASC-VEH-TYP-CDE        = ASC-VEH-TYP-CDE-OLD             04194000
041950         CONTINUE                                                 04195000
041960     ELSE                                                         04196000
041970         SET ASC-FIELDS-CHANGED  TO TRUE                          04197000
041980     END-IF.                                                      04198000
041990                                                                  04199000
042000 3700-SELECT-TSHIPMT.                                             04200000
042010                                                                  04201000
042020     PERFORM                                                      04202000
042030         WITH TEST AFTER                                          04203000
042040         VARYING PV-RETRY-COUNTER                                 04204000
042050         FROM 1 BY 1                                              04205000
042060         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04206000
042070             OR (SQLCODE = +0)                                    04207000
042080             OR (SQLCODE = +100))                                 04208000
042090                                                                  04209000
042100         EXEC SQL                                                 04210000
042110              SELECT COUNT(*)                                     04211000
042120                INTO :PV-DB2-COUNT                                04212000
042130                FROM TSHIPMT A                                    04213000
042140                   , TSHIPST B                                    04214023
042150               WHERE A.TRIP_ID     = :SHIPMT-TRIP-ID              04215000
042160                 AND A.PRO_NBR     = :PC-SPACES                   04216000
042170                 AND A.SHIPT_ID    = B.SHIPT_ID                   04217022
042180                 AND NOT EXISTS                                   04218024
042190                     (SELECT 1                                    04219024
042200                        FROM TSHIPMT Y                            04220024
042210                           , TSHIPST Z                            04221024
042220                      WHERE Y.TRIP_ID  = A.TRIP_ID                04222024
042230                        AND Y.SHIPT_ID = Z.SHIPT_ID               04223024
042240                        AND Z.SHIPT_STATUS_CDE <> 'DE')           04224024
042250         END-EXEC                                                 04225024
042260                                                                  04226000
042270         EVALUATE TRUE                                            04227000
042280             WHEN SQLCODE = +0                                    04228000
042290             WHEN SQLCODE = +100                                  04229000
042300             WHEN SQLCODE = -904                                  04230000
042310             WHEN SQLCODE = -913                                  04231000
042320                  CONTINUE                                        04232000
042330                                                                  04233000
042340             WHEN SQLWARN0 NOT = SPACES                           04234000
042350             WHEN SQLCODE < +0                                    04235000
042360             WHEN SQLCODE > +0                                    04236000
042370                  MOVE '3700-SELECT-TSHIPMT'                      04237000
042380                                  TO DP013-PARAGRAPH              04238000
042390                  MOVE 'UNSUCCESSFUL COUNT OF TSHIPMT TABLE'      04239000
042400                                  TO DP013-MESSAGE-TEXT (1)       04240000
042410                  MOVE SQLCA      TO DP013-SQLCA                  04241000
042420                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     04242000
042430                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (2)     04243000
042440                  SET DP013-DB2-ABEND                             04244000
042450                      DP013-XCTL-DISPLAY-RESTART                  04245000
042460                                  TO TRUE                         04246000
042470                  PERFORM DP013-0000-PROCESS-ABEND                04247000
042480         END-EVALUATE                                             04248000
042490     END-PERFORM.                                                 04249000
042500                                                                  04250000
042510     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        04251000
042520             AND (SQLCODE NOT = +0)                               04252000
042530         MOVE '3700-SELECT-TSHIPMT'                               04253000
042540                                  TO DP013-PARAGRAPH              04254000
042550         MOVE 'MAX RETRIES EXCEEDED ON COUNT TSHIPMT TABLE'       04255000
042560                                  TO DP013-MESSAGE-TEXT (1)       04256000
042570         MOVE SQLCA               TO DP013-SQLCA                  04257000
042580         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     04258000
042590         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (2)     04259000
042600         SET DP013-DB2-ABEND                                      04260000
042610             DP013-XCTL-DISPLAY-RESTART                           04261000
042620                                  TO TRUE                         04262000
042630         PERFORM DP013-0000-PROCESS-ABEND                         04263000
042640     END-IF.                                                      04264000
042650                                                                  04265000
042660/                                                                 04266000
042670*----------------------------------------------------------------*04267000
042680*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *04268000
042690*    ENTRY.                                                      *04269000
042700*----------------------------------------------------------------*04270000
042710                                                                  04271000
042720 4000-BUILD-INITIAL-PANEL.                                        04272000
042730                                                                  04273000
042750     INITIALIZE DCLTVEHICL                                        04275091
042760                DCLTVHTRIP                                        04276000
042770                DCLTTRIPST                                        04277000
042780                DCLXLT00010                                       04278001
042790                ASC-SCREEN-FIELDS.                                04279000
042800                                                                  04280000
042810     MOVE ASC-CURR-OPER-UNT-ID     TO DK-OPER-UNT-ID              04281000
042820                                      DK-STR-NBR                  04282000
042830     MOVE ASC-CURR-FCLTY-ID        TO DK-FCLTY-ID.                04283000
042840     MOVE ASC-KEY-VEH-NBR          TO DK-VEH-NBR.                 04284000
042850     MOVE ASC-KEY-OWNER-SCAC-ID    TO DK-OWNER-SCAC-ID.           04285000
042860     MOVE ASC-KEY-TRIP-ID          TO DK-TRIP-ID.                 04286000
042870     MOVE ASC-KEY-FAC-AREA-ID      TO ASC-CURR-FAC-AREA-ID        04287000
042880     MOVE ASC-KEY-SUBAREA-OF-ID    TO ASC-CURR-SUBAREA-OF-ID      04288000
042890                                                                  04289000
042891     PERFORM 4385-CHECK-RPAMSD.                                   04289190
042892                                                                  04289290
042900     PERFORM 4005-GET-STORE-TYPE.                                 04290000
042910     EVALUATE XLT00010-LOC-TYP-CDE                                04291001
042920     WHEN 'DC'                                                    04292000
042930     WHEN 'DS'                                                    04293000
042940         MOVE 'TR'               TO ASC-VEH-TYP-CDE               04294000
042950                                    ATRIPTPO                      04295000
042960         IF ASC-CURR-OPER-UNT-ID-N = 90                           04296000
042970             MOVE DP015-UNP-ALP-NOR-OFF                           04297000
042980                                 TO ATRIPTPA                      04298000
042990             MOVE DP015-GREEN TO ATRIPTPC                         04299000
043000             MOVE DP015-UNDERLINE TO ATRIPTPH                     04300000
043010         ELSE                                                     04301000
043020             MOVE DP015-PRO-NOR-OFF TO ATRIPTPA                   04302000
043030             MOVE DP015-BLUE      TO ATRIPTPC                     04303000
043040         END-IF                                                   04304000
043050     WHEN 'HQ'                                                    04305000
043060         IF ASC-VEH-TYP-CDE = SPACES OR LOW-VALUES                04306000
043070             MOVE 'VS'           TO ASC-VEH-TYP-CDE               04307000
043080                                    ATRIPTPO                      04308000
043090         END-IF                                                   04309000
043100         MOVE DP015-UNP-ALP-NOR-OFF                               04310000
043110                                 TO ATRIPTPA                      04311000
043120         MOVE DP015-GREEN        TO ATRIPTPC                      04312000
043130         MOVE DP015-UNDERLINE    TO ATRIPTPH                      04313000
043140     WHEN OTHER                                                   04314000
043150*        MOVE SPACES             TO ASC-VEH-TYP-CDE               04315000
043160*                                   ATRIPTPO                      04316000
043170         MOVE DP015-UNP-ALP-NOR-OFF                               04317000
043180                                 TO ATRIPTPA                      04318000
043190         MOVE DP015-GREEN        TO ATRIPTPC                      04319000
043200         MOVE DP015-UNDERLINE    TO ATRIPTPH                      04320000
043210     END-EVALUATE                                                 04321000
043220                                                                  04322000
043230     PERFORM 4200-SELECT-TFACLTY.                                 04323000
043240     MOVE FACLTY-FCLTY-NME       TO ASC-CURR-FCLTY-NME.           04324000
043250                                                                  04325000
043260     PERFORM 4100-SELECT-TVEHICL.                                 04326000
043270     IF SQLCODE = ZERO                                            04327000
043280         MOVE VEHICL-VEH-TYP-CDE TO ASC-VEH-TYP-CDE               04328000
043290     END-IF                                                       04329000
043300                                                                  04330000
043310     IF  ASC-VEHICLE-SETUP-PREV  AND                              04331000
043320         TRSTYP-PRTY-CDE <  '89'                                  04332000
043330         IF ASC-ADD-PENDING                                       04333000
043340             SET ASC-NEW-STOP-PENDING                             04334000
043350                                     TO TRUE                      04335000
043360             MOVE VEHICL-CURR-OPER-UNT-ID TO                      04336000
043370                     ASC-CURR-OPER-UNT-ID-N                       04337000
043380             MOVE VEHICL-CURR-FCLTY-ID TO                         04338000
043390                     ASC-CURR-FCLTY-ID-N                          04339000
043400             MOVE ASC-CURR-OPER-UNT-ID     TO DK-OPER-UNT-ID      04340000
043410             MOVE ASC-CURR-FCLTY-ID        TO DK-FCLTY-ID         04341000
043420             PERFORM 4200-SELECT-TFACLTY                          04342000
043430             MOVE FACLTY-FCLTY-NME       TO ASC-CURR-FCLTY-NME    04343000
043440             MOVE VEHICL-CURR-TRIP-ID                             04344000
043450                                   TO ASC-KEY-TRIP-ID             04345000
043460                                      DK-TRIP-ID                  04346000
043470         END-IF                                                   04347000
043480         IF DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-TRLR-SPEC   04348000
043490             MOVE VEHICL-CURR-TRIP-ID                             04349000
043500                                   TO ASC-KEY-TRIP-ID             04350000
043510                                      DK-TRIP-ID                  04351000
043520         END-IF                                                   04352000
043530         IF ASC-NEW-STOP-PENDING                                  04353000
043540             SET DP020-MSG-WARNING TO TRUE                        04354000
043550             MOVE PC-TSYMSG-00769  TO DP020-MSG-NUMBER            04355000
043560         END-IF                                                   04356000
043570         PERFORM 4320-GET-ENT-NAME-DESC                           04357000
043580         MOVE ENTNME-ENT-NAME-DESC                                04358000
043590                                 TO ASC-OWNER-SCAC-ID-DESC        04359000
043600         MOVE ASC-CURR-SUBAREA-OF-ID                              04360000
043610                                 TO FLAREA-FCLTY-AREA-ID          04361000
043620         PERFORM 4310-GET-AREA-DESC                               04362000
043630         MOVE FLAREA-FCLTY-AREA-DESC                              04363000
043640                                 TO ASC-CURR-SUBAREA-OF-ID-DESC   04364000
043650         IF  DN-SUBAREA-OF-ID = -1                                04365000
043660             MOVE SPACES         TO ASC-CURR-FAC-AREA-ID          04366000
043670                                    ASC-CURR-FAC-AREA-ID-DESC     04367000
043680         ELSE                                                     04368000
043690             MOVE FLAREA-SUBAREA-OF-ID                            04369000
043700                                 TO ASC-CURR-FAC-AREA-ID          04370000
043710                                    FLAREA-FCLTY-AREA-ID          04371000
043720             PERFORM 4310-GET-AREA-DESC                           04372000
043730             MOVE FLAREA-FCLTY-AREA-DESC                          04373000
043740                                 TO ASC-CURR-FAC-AREA-ID-DESC     04374000
043750         END-IF                                                   04375000
044020         PERFORM 4120-SELECT-TVHTRIP                              04402000
044030         IF  SQLCODE = +0                                         04403000
044040             MOVE ASC-DEST-OPER-UNT-ID                            04404000
044050                                 TO DK-OPER-UNT-ID                04405000
044060             MOVE ASC-DEST-FCLTY-ID                               04406000
044070                                 TO DK-FCLTY-ID                   04407000
044080             MOVE TRIPST-STATUS-DTE                               04408000
044090                                 TO PV-TRIPST-DTE                 04409000
044100             MOVE PV-TRIPST-YY   TO PV-TRIP-YY                    04410000
044110             MOVE PV-TRIPST-MM   TO PV-TRIP-MM                    04411000
044120             MOVE PV-TRIPST-DD   TO PV-TRIP-DD                    04412000
044130             MOVE TRIPST-STATUS-TME                               04413000
044140                                 TO PV-TRIPST-TME                 04414000
044150             MOVE PV-TRIPST-HH   TO PV-TRIP-HH                    04415000
044160             MOVE PV-TRIPST-MIN  TO PV-TRIP-MIN                   04416000
044170                                                                  04417000
044180             IF ASC-SPLT-XMIT-IND NOT = SPACE                     04418000
044190                 MOVE VHTRIP-SPLT-XMIT-DTE                        04419000
044200                                     TO PV-XMIT-DTE               04420000
044210                 MOVE PV-XMIT-YY TO PV-XMIT-YEAR                  04421000
044220                 MOVE PV-XMIT-MM TO PV-XMIT-MONTH                 04422000
044230                 MOVE PV-XMIT-DD TO PV-XMIT-DAY                   04423000
044240                 MOVE PV-XMIT-MMDDYY TO ASC-XMIT-DATE             04424000
044250             ELSE                                                 04425000
044260                 MOVE SPACES         TO ASC-XMIT-DATE             04426000
044270             END-IF                                               04427000
044280                                                                  04428000
044290             IF VHTRIP-OWNR-SCAC-SHIP-DTE = '0001-01-01'          04429000
044300                MOVE SPACES TO ASC-OWNR-SCAC-SHP-DTE              04430000
044310                               ASC-OWNR-SHP-DTE-OLD               04431000
044320             ELSE                                                 04432000
044330                MOVE VHTRIP-OWNR-SCAC-SHIP-DTE                    04433000
044340                                 TO ASC-OWNR-SCAC-SHP-DTE         04434000
044350                                    ASC-OWNR-SHP-DTE-OLD          04435000
044360             END-IF                                               04436000
044370             IF DN-EST-AR-TMST NOT = -1                           04437000
044380                AND (ASC-DELETE-PENDING OR                        04438000
044390                     ASC-UPDATE-PENDING)                          04439000
044400                 MOVE VHTRIP-EST-AR-TMST                          04440000
044410                                 TO PV-EST-DATE-TIME              04441000
044420                 MOVE PV-EST-DATE                                 04442000
044430                                 TO ASC-ETA-DTE                   04443000
044440                                    ASC-ETA-DTE-OLD               04444000
044450                 MOVE PV-EST-TIME                                 04445000
044460                                 TO ASC-ETA-TIME                  04446000
044470                                    ASC-ETA-TIME-OLD              04447000
044480             ELSE                                                 04448000
044490                 EXEC CICS ASKTIME                                04449000
044500                      ABSTIME (PV-ABSTIME)                        04450000
044510                 END-EXEC                                         04451000
044520                 EXEC CICS FORMATTIME                             04452000
044530                      ABSTIME (PV-ABSTIME)                        04453000
044540                      DATESEP ('-') YYMMDD  (ASC-ETA-YY-MM-DD)    04454000
044550                      TIME (ASC-ETA-TIME) TIMESEP                 04455000
044560                 END-EXEC                                         04456000
044570                 IF ASC-ETA-DTE-YY > 60                           04457000
044580                     MOVE '19'   TO ASC-ETA-DTE-CC                04458000
044590                 ELSE                                             04459000
044600                     MOVE '20'   TO ASC-ETA-DTE-CC                04460000
044610                 END-IF                                           04461000
044620                 MOVE ASC-ETA-DTE                                 04462000
044630                                 TO ASC-ETA-DTE-OLD               04463000
044640                 MOVE ASC-ETA-TIME                                04464000
044650                                 TO ASC-ETA-TIME-OLD              04465000
044660             END-IF                                               04466000
044670             PERFORM 4200-SELECT-TFACLTY                          04467000
044680             MOVE FACLTY-FCLTY-NME                                04468000
044690                                 TO ASC-DEST-FCLTY-NME            04469000
044700             IF ASC-NEW-STOP-PENDING                              04470000
044710                 MOVE 'EN' TO ASC-TRIP-STATUS-CDE                 04471000
044720                 MOVE SPACE TO ASC-MANIFEST-NBR                   04472000
044730             END-IF                                               04473000
044740             MOVE ASC-TRIP-STATUS-CDE                             04474000
044750                                 TO DK-TRIP-STATUS-CDE            04475000
044760             PERFORM 4365-GET-TRIP-STATUS-DESC                    04476000
044770             MOVE TRSTYP-DESC     TO ASC-TRIP-STATUS-DESC         04477000
044780             MOVE TRSTYP-PRTY-CDE TO ASC-TRIP-PRTY-CDE            04478000
044790             MOVE ASC-DEST-SUBAREA-OF-ID                          04479000
044800                                 TO FLAREA-FCLTY-AREA-ID          04480000
044810             PERFORM 4310-GET-AREA-DESC                           04481000
044820             IF  SQLCODE = +0                                     04482000
044830                 MOVE FLAREA-FCLTY-AREA-DESC                      04483000
044840                                 TO ASC-DEST-SUBAREA-OF-ID-DESC   04484000
044850                 IF  DN-SUBAREA-OF-ID = -1                        04485000
044860                     MOVE SPACES TO ASC-DEST-FAC-AREA-ID          04486000
044870                                    ASC-DEST-FAC-AREA-ID-DESC     04487000
044880                 ELSE                                             04488000
044890                     MOVE FLAREA-SUBAREA-OF-ID                    04489000
044900                                 TO ASC-DEST-FAC-AREA-ID          04490000
044910                                    FLAREA-FCLTY-AREA-ID          04491000
044920                     PERFORM 4310-GET-AREA-DESC                   04492000
044930                     MOVE FLAREA-FCLTY-AREA-DESC                  04493000
044940                                 TO ASC-DEST-FAC-AREA-ID-DESC     04494000
044950                 END-IF                                           04495000
044960             END-IF                                               04496000
044970         ELSE                                                     04497000
044980             EXEC CICS ASKTIME                                    04498000
044990                  ABSTIME (PV-ABSTIME)                            04499000
045000             END-EXEC                                             04500000
045010             EXEC CICS FORMATTIME                                 04501000
045020                  ABSTIME (PV-ABSTIME)                            04502000
045030                  DATESEP ('-') YYMMDD  (ASC-ETA-YY-MM-DD)        04503000
045040                  TIME (ASC-ETA-TIME) TIMESEP                     04504000
045050             END-EXEC                                             04505000
045060             IF ASC-ETA-DTE-YY > 60                               04506000
045070                 MOVE '19'   TO ASC-ETA-DTE-CC                    04507000
045080             ELSE                                                 04508000
045090                 MOVE '20'   TO ASC-ETA-DTE-CC                    04509000
045100             END-IF                                               04510000
045110             MOVE ASC-ETA-DTE-YY  TO PV-TRIP-YY                   04511000
045120             MOVE ASC-ETA-DTE-MM  TO PV-TRIP-MM                   04512000
045130             MOVE ASC-ETA-DTE-DD  TO PV-TRIP-DD                   04513000
045140             MOVE ASC-ETA-TIME-HH TO PV-TRIP-HH                   04514000
045150             MOVE ASC-ETA-TIME-MM TO PV-TRIP-MIN                  04515000
045160             MOVE ASC-ETA-DTE                                     04516000
045170                             TO ASC-ETA-DTE-OLD                   04517000
045180             MOVE ASC-ETA-TIME                                    04518000
045190                             TO ASC-ETA-TIME-OLD                  04519000
045200             IF ASC-NEW-STOP-PENDING                              04520000
045210                 MOVE 'EN' TO ASC-TRIP-STATUS-CDE                 04521000
045220                 MOVE SPACE TO ASC-MANIFEST-NBR                   04522000
045230             END-IF                                               04523000
045240             MOVE ASC-TRIP-STATUS-CDE                             04524000
045250                                 TO DK-TRIP-STATUS-CDE            04525000
045260             PERFORM 4365-GET-TRIP-STATUS-DESC                    04526000
045270             MOVE TRSTYP-DESC     TO ASC-TRIP-STATUS-DESC         04527000
045280             MOVE TRSTYP-PRTY-CDE TO ASC-TRIP-PRTY-CDE            04528000
045290         END-IF                                                   04529000
045300         INITIALIZE PV-DB2-COUNT                                  04530000
045310         PERFORM 4125-COUNT-STOPS                                 04531000
045320         IF  PV-DB2-COUNT = +1                                    04532000
045330             MOVE +1             TO ASC-STOP-NBR                  04533000
045340                                    ASC-TOTAL-STOPS               04534000
045350         ELSE                                                     04535000
045360             COMPUTE ASC-STOP-NBR = ASC-PLND-TRIP-SEQ + 1         04536000
045370             MOVE PV-DB2-COUNT   TO ASC-TOTAL-STOPS               04537000
045380         END-IF                                                   04538000
045390         MOVE 'N'                TO PS-SEAL-CURSOR-SW             04539000
045400         IF ASC-NEW-STOP-PENDING                                  04540000
045410             COMPUTE ASC-TOTAL-STOPS = ASC-TOTAL-STOPS + 1        04541000
045420             MOVE ASC-TOTAL-STOPS TO ASC-STOP-NBR                 04542000
045430         ELSE                                                     04543000
045440             PERFORM 4330-OPEN-SEAL-CSR                           04544000
045450             PERFORM 4340-FETCH-SEAL-CSR                          04545000
045460             IF  SQLCODE = +0                                     04546000
045470                 MOVE VHSEAL-SEAL-NBR TO ASC-SEAL-1               04547000
045480                 PERFORM 4340-FETCH-SEAL-CSR                      04548000
045490                 IF  SQLCODE = +0                                 04549000
045500                     MOVE VHSEAL-SEAL-NBR                         04550000
045510                                     TO ASC-SEAL-2                04551000
045520                 END-IF                                           04552000
045530             END-IF                                               04553000
045540             PERFORM 4350-CLOSE-SEAL-CSR                          04554000
045550         END-IF                                                   04555000
045560         IF  ASC-ADD-PENDING                                      04556000
045570         AND (ASC-TRIP-PRTY-CDE-N < 21                            04557000
045580          OR  ASC-TRIP-PRTY-CDE-N > 49)                           04558000
045590             SET ASC-NEW-STOP-PENDING                             04559000
045600                                 TO TRUE                          04560000
045610             MOVE SPACES         TO ASC-MANIFEST-NBR              04561000
045620                                    ASC-SEAL-1                    04562000
045630                                    ASC-SEAL-2                    04563000
045640                                    ASC-DEST-FCLTY-NME            04564000
045650             MOVE ZEROES         TO ASC-DEST-OPER-UNT-ID-N        04565000
045660                                    ASC-DEST-FCLTY-ID-N           04566000
045670         END-IF                                                   04567000
045680     ELSE                                                         04568000
045690*        CREATE NEW TRIP WITH AN EMPTY OR DEPARTED VEHICLE        04569000
045700         EXEC CICS ASKTIME                                        04570000
045710              ABSTIME (PV-ABSTIME)                                04571000
045720         END-EXEC                                                 04572000
045730         EXEC CICS FORMATTIME                                     04573000
045740              ABSTIME (PV-ABSTIME)                                04574000
045750              DATESEP ('-') YYMMDD  (ASC-ETA-YY-MM-DD)            04575000
045760              TIME (ASC-ETA-TIME) TIMESEP                         04576000
045770         END-EXEC                                                 04577000
045780         IF ASC-ETA-DTE-YY > 60                                   04578000
045790             MOVE '19'   TO ASC-ETA-DTE-CC                        04579000
045800         ELSE                                                     04580000
045810             MOVE '20'   TO ASC-ETA-DTE-CC                        04581000
045820         END-IF                                                   04582000
045830         MOVE ASC-ETA-DTE-YY  TO PV-TRIP-YY                       04583000
045840         MOVE ASC-ETA-DTE-MM  TO PV-TRIP-MM                       04584000
045850         MOVE ASC-ETA-DTE-DD  TO PV-TRIP-DD                       04585000
045860         MOVE ASC-ETA-TIME-HH TO PV-TRIP-HH                       04586000
045870         MOVE ASC-ETA-TIME-MM TO PV-TRIP-MIN                      04587000
045880         MOVE ASC-ETA-DTE                                         04588000
045890                         TO ASC-ETA-DTE-OLD                       04589000
045900         MOVE ASC-ETA-TIME                                        04590000
045910                         TO ASC-ETA-TIME-OLD                      04591000
045920         PERFORM 4320-GET-ENT-NAME-DESC                           04592000
045930         MOVE ENTNME-ENT-NAME-DESC                                04593000
045940                                 TO ASC-OWNER-SCAC-ID-DESC        04594000
045950         IF ASC-USAGE-CDE = SPACES                                04595000
045960             MOVE 'RCV'      TO ASC-USAGE-CDE                     04596000
045970         END-IF                                                   04597000
045980         IF ASC-VEHICLE-NULL-TRIP AND                             04598000
045990            ASC-UPDATE-PENDING                                    04599000
046000             MOVE VEHICL-CURR-STATUS-CDE                          04600000
046010                             TO ASC-TRIP-STATUS-CDE               04601000
046020         ELSE                                                     04602000
046030             IF ASC-TRIP-STATUS-CDE = SPACES OR                   04603000
046040                ASC-TRIP-STATUS-CDE = 'ET'                        04604000
046050                 MOVE 'EN'       TO ASC-TRIP-STATUS-CDE           04605000
046060             END-IF                                               04606000
046070         END-IF                                                   04607000
046080         IF   ASC-VEHICLE-SETUP-PREV AND                          04608000
046090             TRSTYP-PRTY-CDE >= '89'                              04609000
046100             PERFORM 4320-GET-ENT-NAME-DESC                       04610000
046110             MOVE ENTNME-ENT-NAME-DESC                            04611000
046120                                  TO ASC-OWNER-SCAC-ID-DESC       04612000
046130             MOVE ASC-CURR-SUBAREA-OF-ID                          04613000
046140                                 TO FLAREA-FCLTY-AREA-ID          04614000
046150             PERFORM 4310-GET-AREA-DESC                           04615000
046160             MOVE FLAREA-FCLTY-AREA-DESC                          04616000
046170                                 TO ASC-CURR-SUBAREA-OF-ID-DESC   04617000
046180             IF  DN-SUBAREA-OF-ID = -1                            04618000
046190                 MOVE SPACES     TO ASC-CURR-FAC-AREA-ID          04619000
046200                                    ASC-CURR-FAC-AREA-ID-DESC     04620000
046210             ELSE                                                 04621000
046220                 MOVE FLAREA-SUBAREA-OF-ID                        04622000
046230                                 TO ASC-CURR-FAC-AREA-ID          04623000
046240                                    FLAREA-FCLTY-AREA-ID          04624000
046250                 PERFORM 4310-GET-AREA-DESC                       04625000
046260                 MOVE FLAREA-FCLTY-AREA-DESC                      04626000
046270                                 TO ASC-CURR-FAC-AREA-ID-DESC     04627000
046280             END-IF                                               04628000
046290             MOVE +1             TO ASC-STOP-NBR                  04629000
046300                                    ASC-TOTAL-STOPS               04630000
046310             SET ASC-NEW-STOP-PENDING  TO TRUE                    04631000
046320         ELSE                                                     04632000
046330             MOVE +1             TO ASC-STOP-NBR                  04633000
046340                                    ASC-TOTAL-STOPS               04634000
046350         END-IF                                                   04635000
046360     END-IF.                                                      04636000
046361                                                                  04636188
046385     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        04638525
046390                                                                  04639000
046400/                                                                 04640000
046410 4005-GET-STORE-TYPE.                                             04641000
046420     EXEC SQL                                                     04642000
046430         SELECT LOC_TYP_CDE                                       04643001
046440         INTO :XLT00010-LOC-TYP-CDE                               04644001
046450         FROM XLT_LOC                                             04645001
046460         WHERE LOC_NBR = :DK-STR-NBR                              04646001
046470     END-EXEC.                                                    04647000
046480                                                                  04648000
046490     EVALUATE TRUE                                                04649000
046500         WHEN SQLCODE = ZERO                                      04650000
046510             CONTINUE                                             04651000
046520         WHEN SQLCODE = +100                                      04652000
046530             MOVE SPACES                 TO ASC-VEH-TYP-CDE       04653000
046540                                            ATRIPTPO              04654000
046550                                                                  04655000
046560         WHEN SQLCODE = -904                                      04656000
046570         WHEN SQLCODE = -913                                      04657000
046580             CONTINUE                                             04658000
046590                                                                  04659000
046600         WHEN SQLWARN0 NOT = SPACES                               04660000
046610         WHEN SQLCODE < ZERO                                      04661000
046620         WHEN SQLCODE > ZERO                                      04662000
046630             MOVE '4005-GET-STORE-TYPE'                           04663000
046640                                   TO DP013-PARAGRAPH             04664000
046650             MOVE 'SELECT ON XLT_LOC'                             04665001
046660                                   TO DP013-MESSAGE-TEXT (1)      04666000
046670             MOVE DK-STR-NBR       TO DP013-MESSAGE-TEXT (2)      04667000
046680             MOVE SQLCA            TO DP013-SQLCA                 04668000
046690             MOVE 'XLT_LOC'        TO DP013-DB2-TABLE-NAME (1)    04669001
046700             SET DP013-DB2-ABEND                                  04670000
046710                 DP013-XCTL-DISPLAY-RESTART                       04671000
046720                                   TO TRUE                        04672000
046730             PERFORM DP013-0000-PROCESS-ABEND                     04673000
046740     END-EVALUATE.                                                04674000
046750/                                                                 04675000
046760*----------------------------------------------------------------*04676000
046770* SELECT A VEHICLE                                               *04677000
046780*----------------------------------------------------------------*04678000
046790 4100-SELECT-TVEHICL.                                             04679000
046800                                                                  04680000
046810     PERFORM                                                      04681000
046820         WITH TEST AFTER                                          04682000
046830         VARYING PV-RETRY-COUNTER                                 04683000
046840         FROM 1 BY 1                                              04684000
046850         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04685000
046860            OR (SQLCODE = +0)                                     04686000
046870            OR (SQLCODE = +100))                                  04687000
046880                                                                  04688000
046890         EXEC SQL                                                 04689000
046900          SELECT  A.OWNER_SCAC_ID                                 04690000
046910                 ,A.VEH_NBR                                       04691000
046920                 ,A.USAGE_CDE                                     04692000
046930                 ,A.VEH_SIZE_CDE                                  04693000
046940                 ,A.CURR_STATUS_CDE                               04694000
046950                 ,A.CURR_STATUS_DTE                               04695000
046960                 ,A.CURR_STATUS_TME                               04696000
046970                 ,A.CURR_OPER_UNT_ID                              04697000
046980                 ,A.CURR_FCLTY_ID                                 04698000
046990                 ,A.CURR_FAC_AREA_ID                              04699000
047000                 ,A.CURR_TRIP_ID                                  04700000
047010                 ,A.VEH_TYP_CDE                                   04701000
047020                 ,B.DESC                                          04702000
047030                 ,B.PRTY_CDE                                      04703000
047040           INTO  :VEHICL-OWNER-SCAC-ID                            04704000
047050                ,:VEHICL-VEH-NBR                                  04705000
047060                ,:VEHICL-USAGE-CDE                                04706000
047070                ,:VEHICL-VEH-SIZE-CDE                             04707000
047080                ,:VEHICL-CURR-STATUS-CDE                          04708000
047090                ,:VEHICL-CURR-STATUS-DTE                          04709000
047100                ,:VEHICL-CURR-STATUS-TME                          04710000
047110                ,:VEHICL-CURR-OPER-UNT-ID                         04711000
047120                ,:VEHICL-CURR-FCLTY-ID                            04712000
047130                ,:VEHICL-CURR-FAC-AREA-ID                         04713000
047140                ,:VEHICL-CURR-TRIP-ID  :DN-CURR-TRIP-ID           04714000
047150                ,:VEHICL-VEH-TYP-CDE                              04715000
047160                ,:TRSTYP-DESC                                     04716000
047170                ,:TRSTYP-PRTY-CDE                                 04717000
047180           FROM   TVEHICL A                                       04718000
047190                , TTRSTYP B                                       04719000
047200           WHERE  A.VEH_NBR       = :DK-VEH-NBR                   04720000
047210             AND  A.OWNER_SCAC_ID = :DK-OWNER-SCAC-ID             04721000
047220             AND  A.CURR_STATUS_CDE = B.TRIP_STATUS_CDE           04722000
047230         END-EXEC                                                 04723000
047240                                                                  04724000
047250         EVALUATE TRUE                                            04725000
047260             WHEN SQLCODE = +0                                    04726000
047270                  IF DN-CURR-TRIP-ID = -1                         04727000
047280                      SET ASC-VEHICLE-NULL-TRIP                   04728000
047290                                     TO TRUE                      04729000
047300                  ELSE                                            04730000
047310                      SET ASC-VEHICLE-SETUP-PREV                  04731000
047320                                     TO TRUE                      04732000
047330                  END-IF                                          04733000
047340                  MOVE VEHICL-OWNER-SCAC-ID                       04734000
047350                                 TO ASC-KEY-OWNER-SCAC-ID         04735000
047360                  MOVE VEHICL-VEH-NBR                             04736000
047370                                 TO ASC-KEY-VEH-NBR               04737000
047380                  MOVE VEHICL-USAGE-CDE                           04738000
047390                                 TO ASC-USAGE-CDE                 04739000
047400                  MOVE VEHICL-VEH-SIZE-CDE                        04740000
047410                                 TO ASC-LENGTH                    04741000
047420                  MOVE VEHICL-CURR-STATUS-DTE                     04742000
047430                                 TO ASC-CURR-STATUS-DTE           04743000
047440                  MOVE VEHICL-CURR-STATUS-TME                     04744000
047450                                 TO ASC-CURR-STATUS-TME           04745000
047460                 IF  DP020-INT-APPL-FORMAT-IND NOT =              04746000
047470                                     PC-INTER-APPL-PARKING-LIST   04747000
047480                      MOVE VEHICL-CURR-FAC-AREA-ID                04748000
047490                                     TO ASC-CURR-SUBAREA-OF-ID    04749000
047500                  END-IF                                          04750000
047510                  MOVE VEHICL-CURR-STATUS-CDE                     04751000
047520                                 TO ASC-TRIP-STATUS-CDE           04752000
047530                                                                  04753000
047540*                 MOVE VEHICL-VEH-TYP-CDE                         04754000
047550*                                TO ASC-VEH-TYP-CDE               04755000
047560                                                                  04756000
047570             WHEN SQLCODE = +100                                  04757000
047580                  SET ASC-VEHICLE-NOT-SETUP-PREV                  04758000
047590                                 TO TRUE                          04759000
047600                                                                  04760000
047610             WHEN SQLCODE = -904                                  04761000
047620             WHEN SQLCODE = -913                                  04762000
047630                 CONTINUE                                         04763000
047640                                                                  04764000
047650             WHEN SQLWARN0 NOT = SPACES                           04765000
047660             WHEN SQLCODE < ZERO                                  04766000
047670             WHEN SQLCODE > ZERO                                  04767000
047680                 MOVE '4100-SELECT-TVEHICL'                       04768000
047690                                   TO DP013-PARAGRAPH             04769000
047700                 MOVE 'SELECT ON TVEHICL'                         04770000
047710                                   TO DP013-MESSAGE-TEXT (1)      04771000
047720                 MOVE DK-VEH-NBR   TO DP013-MESSAGE-TEXT (2)      04772000
047730                 MOVE DK-OWNER-SCAC-ID                            04773000
047740                                   TO DP013-MESSAGE-TEXT (3)      04774000
047750                 MOVE SQLCA        TO DP013-SQLCA                 04775000
047760                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    04776000
047770                 SET DP013-DB2-ABEND                              04777000
047780                     DP013-XCTL-DISPLAY-RESTART                   04778000
047790                                   TO TRUE                        04779000
047800                 PERFORM DP013-0000-PROCESS-ABEND                 04780000
047810         END-EVALUATE                                             04781000
047820     END-PERFORM.                                                 04782000
047830                                                                  04783000
047840     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        04784000
047850             AND (SQLCODE NOT = +0)                               04785000
047860         MOVE '4100-SELECT-TVEHICL'                               04786000
047870                                   TO DP013-PARAGRAPH             04787000
047880         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     04788000
047890                                   TO DP013-MESSAGE-TEXT (1)      04789000
047900         MOVE 'A VEHICLE ROW   '   TO DP013-MESSAGE-TEXT (2)      04790000
047910         MOVE SQLCA                TO DP013-SQLCA                 04791000
047920         MOVE 'TVEHICL'            TO DP013-DB2-TABLE-NAME (1)    04792000
047930         SET DP013-DB2-ABEND                                      04793000
047940             DP013-XCTL-DISPLAY-RESTART                           04794000
047950                                   TO TRUE                        04795000
047960         PERFORM DP013-0000-PROCESS-ABEND                         04796000
047970     END-IF.                                                      04797000
047980                                                                  04798000
047990/                                                                 04799000
048670*----------------------------------------------------------------*04867000
048680* SELECT THE MOST RECENT TRIP MADE BY A VEHICLE                  *04868000
048690*----------------------------------------------------------------*04869000
048700 4120-SELECT-TVHTRIP.                                             04870000
048710                                                                  04871000
048720     PERFORM                                                      04872000
048730         WITH TEST AFTER                                          04873000
048740         VARYING PV-RETRY-COUNTER                                 04874000
048750         FROM 1 BY 1                                              04875000
048760         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04876000
048770            OR (SQLCODE = +0)                                     04877000
048780            OR (SQLCODE = +100))                                  04878000
048790                                                                  04879000
048800         EXEC SQL                                                 04880000
048810           SELECT A.MANIFEST_NBR                                  04881000
048820                 ,A.PLND_TRIP_SEQ                                 04882000
048830                 ,A.REF_TRIP_ID                                   04883000
048840                 ,A.EST_AR_TMST                                   04884000
048850                 ,A.OWNR_SCAC_SHIP_DTE                            04885000
048860                 ,A.SPLT_XMIT_IND                                 04886000
048870                 ,A.SPLT_XMIT_DTE                                 04887000
048880                 ,B.TRIP_STATUS_CDE                               04888000
048890                 ,B.STATUS_DTE                                    04889000
048900                 ,B.STATUS_TME                                    04890000
048910                 ,B.OPER_UNT_ID                                   04891000
048920                 ,B.FCLTY_ID                                      04892000
048930                 ,B.FCLTY_AREA_ID                                 04893000
048940           INTO  :VHTRIP-MANIFEST-NBR                             04894000
048950                ,:VHTRIP-PLND-TRIP-SEQ                            04895000
048960                ,:VHTRIP-REF-TRIP-ID                              04896000
048970                ,:VHTRIP-EST-AR-TMST   :DN-EST-AR-TMST            04897000
048980                ,:VHTRIP-OWNR-SCAC-SHIP-DTE                       04898000
048990                ,:VHTRIP-SPLT-XMIT-IND                            04899000
049000                ,:VHTRIP-SPLT-XMIT-DTE                            04900000
049010                ,:TRIPST-TRIP-STATUS-CDE                          04901000
049020                ,:TRIPST-STATUS-DTE                               04902000
049030                ,:TRIPST-STATUS-TME                               04903000
049040                ,:TRIPST-OPER-UNT-ID                              04904000
049050                ,:TRIPST-FCLTY-ID                                 04905000
049060                ,:TRIPST-FCLTY-AREA-ID                            04906000
049070           FROM   TVHTRIP A                                       04907000
049080                 ,TTRIPST B                                       04908000
049090                 ,TTRSTYP C                                       04909000
049100           WHERE  A.TRIP_ID          = :DK-TRIP-ID                04910000
049110             AND  B.TRIP_STATUS_CDE ^= 'DE'                       04911000
049120             AND  C.PRTY_CDE =                                    04912000
049130                  (SELECT MAX(E.PRTY_CDE)                         04913000
049140                     FROM TTRIPST D                               04914000
049150                         ,TTRSTYP E                               04915000
049160                    WHERE D.TRIP_ID         = A.TRIP_ID           04916000
049170                      AND D.TRIP_STATUS_CDE = E.TRIP_STATUS_CDE)  04917000
049180             AND  A.TRIP_ID         = B.TRIP_ID                   04918000
049190             AND  B.TRIP_STATUS_CDE = C.TRIP_STATUS_CDE           04919000
049200         END-EXEC                                                 04920000
049210                                                                  04921000
049220         EVALUATE TRUE                                            04922000
049230             WHEN SQLCODE = +0                                    04923000
049240                  MOVE VHTRIP-MANIFEST-NBR                        04924000
049250                                 TO ASC-MANIFEST-NBR              04925000
049260                  MOVE VHTRIP-PLND-TRIP-SEQ                       04926000
049270                                 TO ASC-PLND-TRIP-SEQ             04927000
049280                  MOVE VHTRIP-REF-TRIP-ID                         04928000
049290                                 TO ASC-REF-TRIP-ID               04929000
049300                  MOVE TRIPST-TRIP-STATUS-CDE                     04930000
049310                                 TO ASC-TRIP-STATUS-CDE           04931000
049320                  MOVE TRIPST-OPER-UNT-ID                         04932000
049330                                 TO ASC-DEST-OPER-UNT-ID          04933000
049340                  MOVE TRIPST-FCLTY-ID                            04934000
049350                                 TO ASC-DEST-FCLTY-ID             04935000
049360                  MOVE TRIPST-FCLTY-AREA-ID                       04936000
049370                                 TO ASC-DEST-SUBAREA-OF-ID        04937000
049380                  MOVE VHTRIP-SPLT-XMIT-IND                       04938000
049390                                 TO ASC-SPLT-XMIT-IND             04939000
049400                                                                  04940000
049410             WHEN SQLCODE = +100                                  04941000
049420             WHEN SQLCODE = -904                                  04942000
049430             WHEN SQLCODE = -913                                  04943000
049440                 CONTINUE                                         04944000
049450                                                                  04945000
049460             WHEN SQLWARN0 NOT = SPACES                           04946000
049470             WHEN SQLCODE < ZERO                                  04947000
049480             WHEN SQLCODE > ZERO                                  04948000
049490                 MOVE '4120-SELECT-TVHTRIP'                       04949000
049500                                   TO DP013-PARAGRAPH             04950000
049510                 MOVE 'SELECT TRIP INFO  '                        04951000
049520                                   TO DP013-MESSAGE-TEXT (1)      04952000
049530                 MOVE DK-TRIP-ID   TO DP013-MESSAGE-TEXT (1)      04953000
049540                 MOVE SQLCA        TO DP013-SQLCA                 04954000
049550                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    04955000
049560                 MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (2)    04956000
049570                 SET DP013-DB2-ABEND                              04957000
049580                     DP013-XCTL-DISPLAY-RESTART                   04958000
049590                                   TO TRUE                        04959000
049600                 PERFORM DP013-0000-PROCESS-ABEND                 04960000
049610         END-EVALUATE                                             04961000
049620     END-PERFORM.                                                 04962000
049630                                                                  04963000
049640     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        04964000
049650             AND (SQLCODE NOT = +0)                               04965000
049660         MOVE '4120-SELECT-TVHTRIP'                               04966000
049670                                   TO DP013-PARAGRAPH             04967000
049680         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     04968000
049690                                   TO DP013-MESSAGE-TEXT (1)      04969000
049700         MOVE 'TRIP INFO       '   TO DP013-MESSAGE-TEXT (2)      04970000
049710         MOVE SQLCA                TO DP013-SQLCA                 04971000
049720         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    04972000
049730         MOVE 'TTRIPST'            TO DP013-DB2-TABLE-NAME (2)    04973000
049740         SET DP013-DB2-ABEND                                      04974000
049750             DP013-XCTL-DISPLAY-RESTART                           04975000
049760                                   TO TRUE                        04976000
049770         PERFORM DP013-0000-PROCESS-ABEND                         04977000
049780     END-IF.                                                      04978000
049790                                                                  04979000
049800/                                                                 04980000
049810*----------------------------------------------------------------*04981000
049820* COUNT THE NUMBER OF STOPS FOR A GIVEN VEHICLE                  *04982000
049830*----------------------------------------------------------------*04983000
049840 4125-COUNT-STOPS.                                                04984000
049850                                                                  04985000
049860     PERFORM                                                      04986000
049870         WITH TEST AFTER                                          04987000
049880         VARYING PV-RETRY-COUNTER                                 04988000
049890         FROM 1 BY 1                                              04989000
049900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04990000
049910            OR (SQLCODE = +0)                                     04991000
049920            OR (SQLCODE = +100))                                  04992000
049930                                                                  04993000
049940         EXEC SQL                                                 04994000
049950           SELECT COUNT(*)                                        04995000
049960           INTO  :PV-DB2-COUNT                                    04996000
049970           FROM   TVHTRIP A                                       04997000
049980           WHERE  A.OWNER_SCAC_ID = :DK-OWNER-SCAC-ID             04998000
049990             AND  A.VEH_NBR       IS NOT NULL                     04999000
050000             AND  A.VEH_NBR       = :DK-VEH-NBR                   05000000
050010             AND  A.TRIP_ID NOT IN                                05001000
050020                  (SELECT B.TRIP_ID                               05002000
050030                     FROM TVHTRIP B                               05003000
050040                         ,TTRIPST C                               05004000
050050                    WHERE A.TRIP_ID          = B.TRIP_ID          05005000
050060                      AND A.TRIP_ID          = C.TRIP_ID          05006000
050070                      AND C.TRIP_STATUS_CDE  = 'DE')              05007000
050080         END-EXEC                                                 05008000
050090                                                                  05009000
050100         EVALUATE TRUE                                            05010000
050110             WHEN SQLCODE = +0                                    05011000
050120             WHEN SQLCODE = +100                                  05012000
050130             WHEN SQLCODE = -904                                  05013000
050140             WHEN SQLCODE = -913                                  05014000
050150                 CONTINUE                                         05015000
050160                                                                  05016000
050170             WHEN SQLWARN0 NOT = SPACES                           05017000
050180             WHEN SQLCODE < ZERO                                  05018000
050190             WHEN SQLCODE > ZERO                                  05019000
050200                 MOVE SPACES TO PV-MESSAGE                        05020000
050210                 MOVE DK-VEH-NBR TO PV-MESSAGE1                   05021000
050220                 MOVE DK-OWNER-SCAC-ID TO PV-MESSAGE2             05022000
050230                 MOVE '4125-COUNT-STOPS   '                       05023000
050240                                   TO DP013-PARAGRAPH             05024000
050250                 MOVE 'SELECT NUMBER OF STOPS '                   05025000
050260                                   TO DP013-MESSAGE-TEXT (1)      05026000
050270                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT (2)      05027000
050280                 MOVE SQLCA        TO DP013-SQLCA                 05028000
050290                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    05029000
050300                 SET DP013-DB2-ABEND                              05030000
050310                     DP013-XCTL-DISPLAY-RESTART                   05031000
050320                                   TO TRUE                        05032000
050330                 PERFORM DP013-0000-PROCESS-ABEND                 05033000
050340         END-EVALUATE                                             05034000
050350     END-PERFORM.                                                 05035000
050360                                                                  05036000
050370     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05037000
050380             AND (SQLCODE NOT = +0)                               05038000
050390         MOVE '4125-COUNT-STOPS   '                               05039000
050400                                   TO DP013-PARAGRAPH             05040000
050410         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     05041000
050420                                   TO DP013-MESSAGE-TEXT (1)      05042000
050430         MOVE 'NBR OF STOPS    '   TO DP013-MESSAGE-TEXT (2)      05043000
050440         MOVE SQLCA                TO DP013-SQLCA                 05044000
050450         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    05045000
050460         SET DP013-DB2-ABEND                                      05046000
050470             DP013-XCTL-DISPLAY-RESTART                           05047000
050480                                   TO TRUE                        05048000
050490         PERFORM DP013-0000-PROCESS-ABEND                         05049000
050500     END-IF.                                                      05050000
050510                                                                  05051000
050520/                                                                 05052000
050530*----------------------------------------------------------------*05053000
050540* SELECT A VEHICLE - USED FOR VALIDATION                         *05054000
050550*----------------------------------------------------------------*05055000
050560 4130-SELECT-TVEHICL-VAL.                                         05056000
050570                                                                  05057000
050580     PERFORM                                                      05058000
050590         WITH TEST AFTER                                          05059000
050600         VARYING PV-RETRY-COUNTER                                 05060000
050610         FROM 1 BY 1                                              05061000
050620         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05062000
050630            OR (SQLCODE = +0)                                     05063000
050640            OR (SQLCODE = +100))                                  05064000
050650                                                                  05065000
050660         EXEC SQL                                                 05066000
050670          SELECT  A.OWNER_SCAC_ID                                 05067000
050680                 ,A.VEH_NBR                                       05068000
050690                 ,A.USAGE_CDE                                     05069000
050700                 ,A.VEH_SIZE_CDE                                  05070000
050710                 ,A.CURR_STATUS_CDE                               05071000
050720                 ,A.CURR_FAC_AREA_ID                              05072000
050730                 ,A.CURR_TRIP_ID                                  05073000
050740                 ,B.DESC                                          05074000
050750                 ,B.PRTY_CDE                                      05075000
050760           INTO  :VEHICL-OWNER-SCAC-ID                            05076000
050770                ,:VEHICL-VEH-NBR                                  05077000
050780                ,:VEHICL-USAGE-CDE                                05078000
050790                ,:VEHICL-VEH-SIZE-CDE                             05079000
050800                ,:VEHICL-CURR-STATUS-CDE                          05080000
050810                ,:VEHICL-CURR-FAC-AREA-ID                         05081000
050820                ,:VEHICL-CURR-TRIP-ID  :DN-CURR-TRIP-ID           05082000
050830                ,:TRSTYP-DESC                                     05083000
050840                ,:TRSTYP-PRTY-CDE                                 05084000
050850           FROM   TVEHICL A                                       05085000
050860                , TTRSTYP B                                       05086000
050870           WHERE  A.VEH_NBR       = :DK-VEH-NBR                   05087000
050880             AND  A.OWNER_SCAC_ID = :DK-OWNER-SCAC-ID             05088000
050890             AND  A.CURR_STATUS_CDE = B.TRIP_STATUS_CDE           05089000
050900         END-EXEC                                                 05090000
050910                                                                  05091000
050920         EVALUATE TRUE                                            05092000
050930             WHEN SQLCODE = +0                                    05093000
050940                  IF DN-CURR-TRIP-ID = -1                         05094000
050950                      SET ASC-VEHICLE-NULL-TRIP                   05095000
050960                                     TO TRUE                      05096000
050970                  ELSE                                            05097000
050980                      SET ASC-VEHICLE-SETUP-PREV                  05098000
050990                                     TO TRUE                      05099000
051000                  END-IF                                          05100000
051010                                                                  05101000
051020             WHEN SQLCODE = +100                                  05102000
051030                  SET ASC-VEHICLE-NOT-SETUP-PREV                  05103000
051040                                 TO TRUE                          05104000
051050                                                                  05105000
051060             WHEN SQLCODE = -904                                  05106000
051070             WHEN SQLCODE = -913                                  05107000
051080                 CONTINUE                                         05108000
051090                                                                  05109000
051100             WHEN SQLWARN0 NOT = SPACES                           05110000
051110             WHEN SQLCODE < ZERO                                  05111000
051120             WHEN SQLCODE > ZERO                                  05112000
051130                 MOVE '4130-SELECT-TVEHICL-VAL'                   05113000
051140                                   TO DP013-PARAGRAPH             05114000
051150                 MOVE 'SELECT ON TVEHICL'                         05115000
051160                                   TO DP013-MESSAGE-TEXT (1)      05116000
051170                 MOVE DK-VEH-NBR   TO DP013-MESSAGE-TEXT (2)      05117000
051180                 MOVE DK-OWNER-SCAC-ID                            05118000
051190                                   TO DP013-MESSAGE-TEXT (3)      05119000
051200                 MOVE SQLCA        TO DP013-SQLCA                 05120000
051210                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    05121000
051220                 SET DP013-DB2-ABEND                              05122000
051230                     DP013-XCTL-DISPLAY-RESTART                   05123000
051240                                   TO TRUE                        05124000
051250                 PERFORM DP013-0000-PROCESS-ABEND                 05125000
051260         END-EVALUATE                                             05126000
051270     END-PERFORM.                                                 05127000
051280                                                                  05128000
051290     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05129000
051300             AND (SQLCODE NOT = +0)                               05130000
051310         MOVE '4130-SELECT-TVEHICL-VAL'                           05131000
051320                                   TO DP013-PARAGRAPH             05132000
051330         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     05133000
051340                                   TO DP013-MESSAGE-TEXT (1)      05134000
051350         MOVE 'A VEHICLE ROW   '   TO DP013-MESSAGE-TEXT (2)      05135000
051360         MOVE SQLCA                TO DP013-SQLCA                 05136000
051370         MOVE 'TVEHICL'            TO DP013-DB2-TABLE-NAME (1)    05137000
051380         SET DP013-DB2-ABEND                                      05138000
051390             DP013-XCTL-DISPLAY-RESTART                           05139000
051400                                   TO TRUE                        05140000
051410         PERFORM DP013-0000-PROCESS-ABEND                         05141000
051420     END-IF.                                                      05142000
051430                                                                  05143000
051440/                                                                 05144000
051441* JAK 04/2007 - ADD PARAGRAPH 4140                                05144125
051442*----------------------------------------------------------------*05144225
051443* CHECK PARM TABLE TO SEE IF DC IS TURNED ON TO DOWNLOAD ASN'S   *05144325
051444* TO WMS.                                                        *05144425
051445*----------------------------------------------------------------*05144525
051446 4140-SELECT-TKRPRPM.                                             05144625
051447                                                                  05144725
051448     PERFORM                                                      05144825
051449         WITH TEST AFTER                                          05144925
051450         VARYING PV-RETRY-COUNTER                                 05145025
051451         FROM 1 BY 1                                              05145125
051452         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05145225
051453            OR (SQLCODE = +0)                                     05145325
051454            OR (SQLCODE = +100))                                  05145425
051455                                                                  05145525
051456         EXEC SQL                                                 05145625
051457              SELECT   FUNC_TXT                                   05145725
051458                INTO  :KRPRPM-FUNC-TXT                            05145825
051459                FROM                                              05145925
051460                      TKRPRPM A                                   05146025
051461                     ,TTRIPST B                                   05146164
051462                WHERE                                             05146225
051463                      A.LOC_ID            = :DK-OPER-UNT-ID       05146364
051464                  AND A.SYS_PRC_FUNC_CDE  = 'ASNDWN'              05146464
051465                  AND A.FUNC_PRC_STAT_CDE = 'AC'                  05146564
051466                  AND A.INTFC_SYS_CDE     = 'KHL'                 05146664
051467                  AND A.FUNC_TXT          = 'Y'                   05146764
051468                  AND A.FUNC_BEG_TMST    < CURRENT TIMESTAMP      05146864
051469                  AND B.TRIP_ID           = :ASC-KEY-TRIP-ID      05146964
051470                  AND B.TRIP_STATUS_CDE   = 'EN'                  05147064
051471                  AND B.CRE_TMST         >= A.FUNC_BEG_TMST       05147164
051480         END-EXEC                                                 05148025
051481                                                                  05148125
051482         EVALUATE TRUE                                            05148225
051483             WHEN SQLCODE = +0                                    05148325
051484                  SET PS-ASNS-TO-WMS-YES    TO TRUE               05148425
051492             WHEN SQLCODE = +100                                  05149225
051493                  SET PS-ASNS-TO-WMS-NO     TO TRUE               05149325
051496             WHEN SQLCODE = -904                                  05149625
051497             WHEN SQLCODE = -913                                  05149725
051498                 CONTINUE                                         05149825
051500             WHEN SQLWARN0 NOT = SPACES                           05150025
051501             WHEN SQLCODE < ZERO                                  05150125
051502             WHEN SQLCODE > ZERO                                  05150225
051503                 MOVE '4140-SELECT-TKRPRPM'                       05150325
051504                                   TO DP013-PARAGRAPH             05150425
051505                 MOVE 'SELECT ON TKRPRPM'                         05150525
051506                                   TO DP013-MESSAGE-TEXT (1)      05150625
051508                 MOVE DK-OPER-UNT-ID                              05150825
051509                                   TO DP013-MESSAGE-TEXT (2)      05150925
051510                 MOVE SQLCA        TO DP013-SQLCA                 05151025
051511                 MOVE 'TKRPRPM'    TO DP013-DB2-TABLE-NAME (1)    05151125
051512                 SET DP013-DB2-ABEND                              05151225
051513                     DP013-XCTL-DISPLAY-RESTART                   05151325
051514                                   TO TRUE                        05151425
051515                 PERFORM DP013-0000-PROCESS-ABEND                 05151525
051516         END-EVALUATE                                             05151625
051517     END-PERFORM.                                                 05151725
051518                                                                  05151825
051519     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05151925
051520             AND (SQLCODE NOT = +0)                               05152025
051521         MOVE '4140-SELECT-TKRPRPM'                               05152125
051522                                   TO DP013-PARAGRAPH             05152225
051523         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     05152325
051524                                   TO DP013-MESSAGE-TEXT (1)      05152425
051525         MOVE 'A TKRPRPRM ROW  '   TO DP013-MESSAGE-TEXT (2)      05152525
051526         MOVE SQLCA                TO DP013-SQLCA                 05152625
051527         MOVE 'TKRPRPM'            TO DP013-DB2-TABLE-NAME (1)    05152725
051528         SET DP013-DB2-ABEND                                      05152825
051529             DP013-XCTL-DISPLAY-RESTART                           05152925
051530                                   TO TRUE                        05153025
051531         PERFORM DP013-0000-PROCESS-ABEND                         05153125
051532     END-IF.                                                      05153225
051533                                                                  05153325
051534/                                                                 05153425
051535*----------------------------------------------------------------*05153525
051536*    GET FACILITY NAME                                           *05153625
051537*----------------------------------------------------------------*05153725
051538                                                                  05153825
051539 4200-SELECT-TFACLTY.                                             05153925
051540                                                                  05154025
051541     PERFORM                                                      05154125
051542         WITH TEST AFTER                                          05154225
051543         VARYING PV-RETRY-COUNTER                                 05154325
051544         FROM 1 BY 1                                              05154425
051550         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05155000
051560            OR  (SQLCODE = +100)                                  05156000
051570            OR  (SQLCODE = +0))                                   05157000
051580                                                                  05158000
051590         EXEC SQL                                                 05159000
051600             SELECT  FCLTY_NME                                    05160000
051610               INTO :FACLTY-FCLTY-NME                             05161000
051620              FROM  TFACLTY                                       05162000
051630             WHERE  OPER_UNT_ID = :DK-OPER-UNT-ID                 05163000
051640               AND  FCLTY_ID    = :DK-FCLTY-ID                    05164000
051650         END-EXEC                                                 05165000
051660                                                                  05166000
051670         EVALUATE TRUE                                            05167000
051680             WHEN SQLCODE = +0                                    05168000
051690             WHEN SQLCODE = +100                                  05169000
051700             WHEN SQLCODE = -904                                  05170000
051710             WHEN SQLCODE = -913                                  05171000
051720                  CONTINUE                                        05172000
051730                                                                  05173000
051740             WHEN SQLWARN0 NOT = SPACE                            05174000
051750             WHEN SQLCODE < +0                                    05175000
051760             WHEN SQLCODE > +0                                    05176000
051770                  MOVE '4200-SELECT-TFACLTY'                      05177000
051780                                   TO DP013-PARAGRAPH             05178000
051790                  MOVE 'SELECT ON TFACLTY'                        05179000
051800                                   TO DP013-MESSAGE-TEXT (1)      05180000
051810                  MOVE DK-OPER-UNT-ID TO DP013-MESSAGE-TEXT (2)   05181000
051820                  MOVE DK-FCLTY-ID    TO DP013-MESSAGE-TEXT (3)   05182000
051830                  MOVE SQLCA       TO DP013-SQLCA                 05183000
051840                  MOVE 'TFACLTY'   TO DP013-DB2-TABLE-NAME (1)    05184000
051850                  SET DP013-DB2-ABEND                             05185000
051860                      DP013-XCTL-DISPLAY-RESTART                  05186000
051870                                   TO TRUE                        05187000
051880                  PERFORM DP013-0000-PROCESS-ABEND                05188000
051890         END-EVALUATE                                             05189000
051900     END-PERFORM.                                                 05190000
051910                                                                  05191000
051920     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05192000
051930             AND (SQLCODE NOT = +0)                               05193000
051940         MOVE '4200-SELECT-TFACLTY'                               05194000
051950                                   TO DP013-PARAGRAPH             05195000
051960         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   05196000
051970                                   TO DP013-MESSAGE-TEXT (1)      05197000
051980         MOVE 'ON TABLE TFACLTY '  TO DP013-MESSAGE-TEXT (2)      05198000
051990         MOVE SQLCA                TO DP013-SQLCA                 05199000
052000         SET DP013-DB2-ABEND                                      05200000
052010             DP013-XCTL-DISPLAY-RESTART                           05201000
052020                                   TO TRUE                        05202000
052030         PERFORM DP013-0000-PROCESS-ABEND                         05203000
052040     END-IF.                                                      05204000
052050                                                                  05205000
052060/                                                                 05206000
052070*----------------------------------------------------------------*05207000
052080*    GET THE FACILITY SUB AREA                                   *05208000
052090*----------------------------------------------------------------*05209000
052100 4300-GET-SUBAREA.                                                05210000
052110                                                                  05211000
052120     PERFORM                                                      05212000
052130         WITH TEST AFTER                                          05213000
052140         VARYING PV-RETRY-COUNTER                                 05214000
052150         FROM 1 BY 1                                              05215000
052160         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05216000
052170             OR (SQLCODE = +0)                                    05217000
052180             OR (SQLCODE = +100))                                 05218000
052190                                                                  05219000
052200         EXEC SQL                                                 05220000
052210              SELECT SUBAREA_OF_ID                                05221000
052220                INTO :FLAREA-SUBAREA-OF-ID                        05222000
052230                       :DN-SUBAREA-OF-ID                          05223000
052240                FROM TFLAREA                                      05224000
052250               WHERE OPER_UNT_ID   = :DK-OPER-UNT-ID              05225000
052260                 AND FCLTY_ID      = :DK-FCLTY-ID                 05226000
052270                 AND FCLTY_AREA_ID = :FLAREA-FCLTY-AREA-ID        05227000
052280         END-EXEC                                                 05228000
052290                                                                  05229000
052300         EVALUATE TRUE                                            05230000
052310             WHEN SQLCODE = +0                                    05231000
052320             WHEN SQLCODE = +100                                  05232000
052330             WHEN SQLCODE = -904                                  05233000
052340             WHEN SQLCODE = -913                                  05234000
052350                  CONTINUE                                        05235000
052360                                                                  05236000
052370             WHEN SQLWARN0 NOT = SPACES                           05237000
052380             WHEN SQLCODE < +0                                    05238000
052390             WHEN SQLCODE > +0                                    05239000
052400                  MOVE SPACES TO PV-MESSAGE                       05240000
052410                  MOVE DK-OPER-UNT-ID TO PV-MESSAGE1              05241000
052420                  MOVE DK-FCLTY-ID    TO PV-MESSAGE2              05242000
052430                  MOVE FLAREA-FCLTY-AREA-ID TO PV-MESSAGE3        05243000
052440                  MOVE '4300-GET-SUBAREA'                         05244000
052450                                  TO DP013-PARAGRAPH              05245000
052460                  MOVE 'UNSUCCESSFUL SELECT ON TFLAREA TABLE'     05246000
052470                                  TO DP013-MESSAGE-TEXT (1)       05247000
052480                  MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT (2)       05248000
052490                  MOVE SQLCA      TO DP013-SQLCA                  05249000
052500                  MOVE 'TFLAREA ' TO DP013-DB2-TABLE-NAME (1)     05250000
052510                  SET DP013-DB2-ABEND                             05251000
052520                      DP013-XCTL-DISPLAY-RESTART                  05252000
052530                                  TO TRUE                         05253000
052540                  PERFORM DP013-0000-PROCESS-ABEND                05254000
052550         END-EVALUATE                                             05255000
052560     END-PERFORM.                                                 05256000
052570                                                                  05257000
052580     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05258000
052590             AND (SQLCODE NOT = +0)                               05259000
052600         MOVE '4300-GET-SUBAREA'  TO DP013-PARAGRAPH              05260000
052610         MOVE 'MAX RETRIES EXCEEDED ON SELECT FACILITY TABLE'     05261000
052620                                  TO DP013-MESSAGE-TEXT (1)       05262000
052630         MOVE SQLCA               TO DP013-SQLCA                  05263000
052640         MOVE 'TFLAREA'           TO DP013-DB2-TABLE-NAME (1)     05264000
052650         SET DP013-DB2-ABEND                                      05265000
052660             DP013-XCTL-DISPLAY-RESTART                           05266000
052670                                  TO TRUE                         05267000
052680         PERFORM DP013-0000-PROCESS-ABEND                         05268000
052690     END-IF.                                                      05269000
052700                                                                  05270000
052710/                                                                 05271000
052720*----------------------------------------------------------------*05272000
052730*    GET THE FACILITY AREA DESC                                  *05273000
052740*----------------------------------------------------------------*05274000
052750 4310-GET-AREA-DESC.                                              05275000
052760                                                                  05276000
052770     PERFORM                                                      05277000
052780         WITH TEST AFTER                                          05278000
052790         VARYING PV-RETRY-COUNTER                                 05279000
052800         FROM 1 BY 1                                              05280000
052810         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05281000
052820             OR (SQLCODE = +0)                                    05282000
052830             OR (SQLCODE = +100))                                 05283000
052840                                                                  05284000
052850         EXEC SQL                                                 05285000
052860              SELECT FCLTY_AREA_DESC                              05286000
052870                    ,SUBAREA_OF_ID                                05287000
052880                INTO :FLAREA-FCLTY-AREA-DESC                      05288000
052890                    ,:FLAREA-SUBAREA-OF-ID                        05289000
052900                       :DN-SUBAREA-OF-ID                          05290000
052910                FROM TFLAREA                                      05291000
052920               WHERE OPER_UNT_ID   = :DK-OPER-UNT-ID              05292000
052930                 AND FCLTY_ID      = :DK-FCLTY-ID                 05293000
052940                 AND FCLTY_AREA_ID = :FLAREA-FCLTY-AREA-ID        05294000
052950         END-EXEC                                                 05295000
052960                                                                  05296000
052970         EVALUATE TRUE                                            05297000
052980             WHEN SQLCODE = +0                                    05298000
052990             WHEN SQLCODE = +100                                  05299000
053000             WHEN SQLCODE = -904                                  05300000
053010             WHEN SQLCODE = -913                                  05301000
053020                  CONTINUE                                        05302000
053030                                                                  05303000
053040             WHEN SQLWARN0 NOT = SPACES                           05304000
053050             WHEN SQLCODE < +0                                    05305000
053060             WHEN SQLCODE > +0                                    05306000
053070                  MOVE SPACES TO PV-MESSAGE                       05307000
053080                  MOVE DK-OPER-UNT-ID TO PV-MESSAGE1              05308000
053090                  MOVE DK-FCLTY-ID    TO PV-MESSAGE2              05309000
053100                  MOVE FLAREA-FCLTY-AREA-ID TO PV-MESSAGE3        05310000
053110                  MOVE '4310-GET-AREA-DESC'                       05311000
053120                                  TO DP013-PARAGRAPH              05312000
053130                  MOVE 'UNSUCCESSFUL SELECT ON TFLAREA TABLE'     05313000
053140                                  TO DP013-MESSAGE-TEXT (1)       05314000
053150                  MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT (2)       05315000
053160                  MOVE SQLCA      TO DP013-SQLCA                  05316000
053170                  MOVE 'TFLAREA ' TO DP013-DB2-TABLE-NAME (1)     05317000
053180                  SET DP013-DB2-ABEND                             05318000
053190                      DP013-XCTL-DISPLAY-RESTART                  05319000
053200                                  TO TRUE                         05320000
053210                  PERFORM DP013-0000-PROCESS-ABEND                05321000
053220         END-EVALUATE                                             05322000
053230     END-PERFORM.                                                 05323000
053240                                                                  05324000
053250     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05325000
053260             AND (SQLCODE NOT = +0)                               05326000
053270         MOVE '4310-GET-AREA-DESC' TO DP013-PARAGRAPH             05327000
053280         MOVE 'MAX RETRIES EXCEEDED ON SELECT FACILITY TABLE'     05328000
053290                                  TO DP013-MESSAGE-TEXT (1)       05329000
053300         MOVE SQLCA               TO DP013-SQLCA                  05330000
053310         MOVE 'TFLAREA'           TO DP013-DB2-TABLE-NAME (1)     05331000
053320         SET DP013-DB2-ABEND                                      05332000
053330             DP013-XCTL-DISPLAY-RESTART                           05333000
053340                                  TO TRUE                         05334000
053350         PERFORM DP013-0000-PROCESS-ABEND                         05335000
053360     END-IF.                                                      05336000
053370                                                                  05337000
053380/                                                                 05338000
053390*----------------------------------------------------------------*05339000
053400*    GET THE ENTERPRISE NAME DESC                                *05340000
053410*----------------------------------------------------------------*05341000
053411* CLT 12-01-2011 WR40574 ADDED WITH UR                            05341169
053420 4320-GET-ENT-NAME-DESC.                                          05342000
053430                                                                  05343000
053440     PERFORM                                                      05344000
053450         WITH TEST AFTER                                          05345000
053460         VARYING PV-RETRY-COUNTER                                 05346000
053470         FROM 1 BY 1                                              05347000
053480         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05348000
053490             OR (SQLCODE = +0)                                    05349000
053500             OR (SQLCODE = +100))                                 05350000
053510                                                                  05351000
053520         EXEC SQL                                                 05352000
053530              SELECT ENT_NAME_DESC                                05353000
053540                INTO :ENTNME-ENT-NAME-DESC                        05354000
053550                FROM TEXTENT A                                    05355000
053560                    ,TENTNME B                                    05356000
053570               WHERE A.SCAC_CDE    = :DK-OWNER-SCAC-ID            05357000
053580                 AND A.CARRIER_IND = 'Y'                          05358000
053590                 AND B.TYPE_CDE    = '01'                         05359000
053600                 AND A.ENT_ID = B.ENT_ID                          05360000
053601               WITH UR                                            05360169
053610         END-EXEC                                                 05361000
053620                                                                  05362000
053630         EVALUATE TRUE                                            05363000
053640             WHEN SQLCODE = +0                                    05364000
053650             WHEN SQLCODE = +100                                  05365000
053660             WHEN SQLCODE = -904                                  05366000
053670             WHEN SQLCODE = -913                                  05367000
053680                  CONTINUE                                        05368000
053690                                                                  05369000
053700             WHEN SQLWARN0 NOT = SPACES                           05370000
053710             WHEN SQLCODE < +0                                    05371000
053720             WHEN SQLCODE > +0                                    05372000
053730                  MOVE '4320-GET-ENT-NAME-DESC'                   05373000
053740                                  TO DP013-PARAGRAPH              05374000
053750                  MOVE 'UNSUCCESSFUL SELECT ON TENTNME TABLE'     05375000
053760                                  TO DP013-MESSAGE-TEXT (1)       05376000
053770                  MOVE DK-OWNER-SCAC-ID TO DP013-MESSAGE-TEXT (2) 05377000
053780                  MOVE SQLCA      TO DP013-SQLCA                  05378000
053790                  MOVE 'TEXTENT ' TO DP013-DB2-TABLE-NAME (1)     05379000
053800                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)     05380000
053810                  SET DP013-DB2-ABEND                             05381000
053820                      DP013-XCTL-DISPLAY-RESTART                  05382000
053830                                  TO TRUE                         05383000
053840                  PERFORM DP013-0000-PROCESS-ABEND                05384000
053850         END-EVALUATE                                             05385000
053860     END-PERFORM.                                                 05386000
053870                                                                  05387000
053880     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05388000
053890             AND (SQLCODE NOT = +0)                               05389000
053900         MOVE '4320-GET-ENT-NAME-DESC'                            05390000
053910                                  TO DP013-PARAGRAPH              05391000
053920         MOVE 'MAX RETRIES EXCEEDED ON SELECT TENTNME TABLE'      05392000
053930                                  TO DP013-MESSAGE-TEXT (1)       05393000
053940         MOVE SQLCA               TO DP013-SQLCA                  05394000
053950         MOVE 'TEXTENT'           TO DP013-DB2-TABLE-NAME (1)     05395000
053960         MOVE 'TENTNME'           TO DP013-DB2-TABLE-NAME (2)     05396000
053970         SET DP013-DB2-ABEND                                      05397000
053980             DP013-XCTL-DISPLAY-RESTART                           05398000
053990                                  TO TRUE                         05399000
054000         PERFORM DP013-0000-PROCESS-ABEND                         05400000
054010     END-IF.                                                      05401000
054020                                                                  05402000
054030/                                                                 05403000
054040*----------------------------------------------------------------*05404000
054050* OPEN THE SEAL CURSOR                                           *05405000
054060*----------------------------------------------------------------*05406000
054070                                                                  05407000
054080 4330-OPEN-SEAL-CSR.                                              05408000
054090                                                                  05409000
054100     PERFORM                                                      05410000
054110         WITH TEST AFTER                                          05411000
054120         VARYING PV-RETRY-COUNTER                                 05412000
054130         FROM 1 BY 1                                              05413000
054140         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05414000
054150            OR (SQLCODE = +0))                                    05415000
054160                                                                  05416000
054170         EXEC SQL                                                 05417000
054180              OPEN SEAL-CSR                                       05418000
054190         END-EXEC                                                 05419000
054200                                                                  05420000
054210         EVALUATE TRUE                                            05421000
054220             WHEN SQLCODE = +0                                    05422000
054230                  CONTINUE                                        05423000
054240             WHEN SQLCODE = -904                                  05424000
054250             WHEN SQLCODE = -913                                  05425000
054260                  CONTINUE                                        05426000
054270             WHEN SQLWARN0 NOT = SPACE                            05427000
054280             WHEN SQLCODE  NOT = +0                               05428000
054290                  MOVE '4330-OPEN-SEAL-CSR'                       05429000
054300                                   TO DP013-PARAGRAPH             05430000
054310                  MOVE 'OPEN SEAL CURSOR'                         05431000
054320                                   TO DP013-MESSAGE-TEXT (1)      05432000
054330                  MOVE DK-TRIP-ID  TO DP013-MESSAGE-TEXT (2)      05433000
054340                  MOVE SQLCA       TO DP013-SQLCA                 05434000
054350                  MOVE 'TVHSEAL'   TO DP013-DB2-TABLE-NAME (1)    05435000
054360                  SET DP013-DB2-ABEND                             05436000
054370                                   TO TRUE                        05437000
054380                  PERFORM DP013-0000-PROCESS-ABEND                05438000
054390         END-EVALUATE                                             05439000
054400     END-PERFORM.                                                 05440000
054410                                                                  05441000
054420     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05442000
054430             AND (SQLCODE NOT = +0)                               05443000
054440         MOVE '4330-OPEN-SEAL-CSR' TO DP013-PARAGRAPH             05444000
054450         MOVE 'MAX RETRIES EXCEEDED FOR OPEN SEAL CURSOR'         05445000
054460                                   TO DP013-MESSAGE-TEXT (1)      05446000
054470         MOVE SQLCA                TO DP013-SQLCA                 05447000
054480         SET DP013-DB2-ABEND       TO TRUE                        05448000
054490         PERFORM DP013-0000-PROCESS-ABEND                         05449000
054500     END-IF.                                                      05450000
054510                                                                  05451000
054520/                                                                 05452000
054530*----------------------------------------------------------------*05453000
054540*    FETCH A SEAL ROW                                            *05454000
054550*----------------------------------------------------------------*05455000
054560                                                                  05456000
054570 4340-FETCH-SEAL-CSR.                                             05457000
054580                                                                  05458000
054590     EXEC SQL                                                     05459000
054600          FETCH SEAL-CSR                                          05460000
054610          INTO :VHSEAL-SEAL-NBR                                   05461000
054620     END-EXEC                                                     05462000
054630                                                                  05463000
054640     EVALUATE TRUE                                                05464000
054650         WHEN SQLCODE = +0                                        05465000
054660              CONTINUE                                            05466000
054670                                                                  05467000
054680         WHEN SQLCODE = +100                                      05468000
054690              SET PS-NO-MORE-SEALS TO TRUE                        05469000
054700                                                                  05470000
054710         WHEN SQLWARN0 NOT = SPACE                                05471000
054720         WHEN SQLCODE < +0                                        05472000
054730         WHEN SQLCODE > +0                                        05473000
054740              MOVE '4340-FETCH-SEAL-CSR'                          05474000
054750                                   TO DP013-PARAGRAPH             05475000
054760              MOVE 'FETCH SEAL CURSOR'                            05476000
054770                                   TO DP013-MESSAGE-TEXT (1)      05477000
054780              MOVE VHSEAL-SEAL-NBR TO DP013-MESSAGE-TEXT (2)      05478000
054790              MOVE SQLCA           TO DP013-SQLCA                 05479000
054800              MOVE 'TVHSEAL'       TO DP013-DB2-TABLE-NAME (1)    05480000
054810              SET DP013-DB2-ABEND  TO TRUE                        05481000
054820              PERFORM DP013-0000-PROCESS-ABEND                    05482000
054830     END-EVALUATE.                                                05483000
054840                                                                  05484000
054850/                                                                 05485000
054860*----------------------------------------------------------------*05486000
054870* CLOSE THE SEAL CURSOR                                          *05487000
054880*----------------------------------------------------------------*05488000
054890                                                                  05489000
054900 4350-CLOSE-SEAL-CSR.                                             05490000
054910                                                                  05491000
054920     EXEC SQL                                                     05492000
054930          CLOSE SEAL-CSR                                          05493000
054940     END-EXEC                                                     05494000
054950                                                                  05495000
054960     EVALUATE TRUE                                                05496000
054970         WHEN SQLCODE = +0                                        05497000
054980              CONTINUE                                            05498000
054990         WHEN SQLWARN0 NOT = SPACE                                05499000
055000         WHEN SQLCODE  NOT = +0                                   05500000
055010              MOVE '4350-CLOSE-SEAL-CSR'                          05501000
055020                                   TO DP013-PARAGRAPH             05502000
055030              MOVE 'CLOSE SEAL CURSOR'                            05503000
055040                                   TO DP013-MESSAGE-TEXT (1)      05504000
055050              MOVE SQLCA           TO DP013-SQLCA                 05505000
055060              MOVE 'TVHSEAL'       TO DP013-DB2-TABLE-NAME (1)    05506000
055070              SET DP013-DB2-ABEND  TO TRUE                        05507000
055080              PERFORM DP013-0000-PROCESS-ABEND                    05508000
055090     END-EVALUATE.                                                05509000
055100                                                                  05510000
055110/                                                                 05511000
055120*----------------------------------------------------------------*05512000
055130*    GET THE TRIP STATUS CODE DESCRIPTION                        *05513000
055140*----------------------------------------------------------------*05514000
055150                                                                  05515000
055160 4365-GET-TRIP-STATUS-DESC.                                       05516000
055170                                                                  05517000
055180     PERFORM                                                      05518000
055190         WITH TEST AFTER                                          05519000
055200         VARYING PV-RETRY-COUNTER                                 05520000
055210         FROM 1 BY 1                                              05521000
055220         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05522000
055230            OR  (SQLCODE = +100)                                  05523000
055240            OR  (SQLCODE = +0))                                   05524000
055250                                                                  05525000
055260         EXEC SQL                                                 05526000
055270             SELECT  DESC                                         05527000
055280                    ,PRTY_CDE                                     05528000
055290              INTO  :TRSTYP-DESC                                  05529000
055300                   ,:TRSTYP-PRTY-CDE                              05530000
055310              FROM  TTRSTYP                                       05531000
055320             WHERE  TRIP_STATUS_CDE = :DK-TRIP-STATUS-CDE         05532000
055330         END-EXEC                                                 05533000
055340                                                                  05534000
055350         EVALUATE TRUE                                            05535000
055360             WHEN SQLCODE = +0                                    05536000
055370             WHEN SQLCODE = +100                                  05537000
055380             WHEN SQLCODE = -904                                  05538000
055390             WHEN SQLCODE = -913                                  05539000
055400                  CONTINUE                                        05540000
055410                                                                  05541000
055420             WHEN SQLWARN0 NOT = SPACE                            05542000
055430             WHEN SQLCODE < +0                                    05543000
055440             WHEN SQLCODE > +0                                    05544000
055450                  MOVE '4365-GET-TRIP-STATUS-DESC'                05545000
055460                                   TO DP013-PARAGRAPH             05546000
055470                  MOVE 'SELECT ON TTRSTYP'                        05547000
055480                                   TO DP013-MESSAGE-TEXT (1)      05548000
055490                  MOVE DK-TRIP-STATUS-CDE                         05549000
055500                                   TO DP013-MESSAGE-TEXT (2)      05550000
055510                  MOVE SQLCA       TO DP013-SQLCA                 05551000
055520                  MOVE 'TTRSTYP'   TO DP013-DB2-TABLE-NAME (1)    05552000
055530                  SET DP013-DB2-ABEND                             05553000
055540                      DP013-XCTL-DISPLAY-RESTART                  05554000
055550                                   TO TRUE                        05555000
055560                  PERFORM DP013-0000-PROCESS-ABEND                05556000
055570         END-EVALUATE                                             05557000
055580     END-PERFORM.                                                 05558000
055590                                                                  05559000
055600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05560000
055610             AND (SQLCODE NOT = +0)                               05561000
055620         MOVE '4365-GET-TRIP-STATUS-DESC'                         05562000
055630                                   TO DP013-PARAGRAPH             05563000
055640         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   05564000
055650                                   TO DP013-MESSAGE-TEXT (1)      05565000
055660         MOVE 'ON TABLE TTRSTYP '  TO DP013-MESSAGE-TEXT (2)      05566000
055670         MOVE SQLCA                TO DP013-SQLCA                 05567000
055680         SET DP013-DB2-ABEND                                      05568000
055690             DP013-XCTL-DISPLAY-RESTART                           05569000
055700                                   TO TRUE                        05570000
055710         PERFORM DP013-0000-PROCESS-ABEND                         05571000
055720     END-IF.                                                      05572000
055730                                                                  05573000
055740/                                                                 05574000
055750*----------------------------------------------------------------*05575000
055760*    READ THE TRIP STATUS TABLE FOR A PARTICULAR STATUS-CDE.     *05576000
055770*----------------------------------------------------------------*05577000
055780                                                                  05578000
055790 4380-READ-TRIP-STATUS-TABLE.                                     05579000
055800     PERFORM                                                      05580000
055810         WITH TEST AFTER                                          05581000
055820         VARYING PV-RETRY-COUNTER                                 05582000
055830         FROM 1 BY 1                                              05583000
055840         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05584000
055850            OR  (SQLCODE = +100)                                  05585000
055860            OR  (SQLCODE = +0))                                   05586000
055870                                                                  05587000
055880         EXEC SQL                                                 05588000
055890           SELECT STATUS_DTE                                      05589000
055900               ,  STATUS_TME                                      05590000
055910           INTO  :TRIPST-STATUS-DTE                               05591000
055920               , :TRIPST-STATUS-TME                               05592000
055930           FROM   TTRIPST                                         05593000
055940           WHERE  TRIP_ID          = :DK-TRIP-ID                  05594000
055950             AND  TRIP_STATUS_CDE  = :PV-TRIP-STATUS-CDE          05595000
055960         END-EXEC                                                 05596000
055970                                                                  05597000
055980         EVALUATE TRUE                                            05598000
055990             WHEN SQLCODE = +0                                    05599000
056000             WHEN SQLCODE = +100                                  05600000
056010             WHEN SQLCODE = -904                                  05601000
056020             WHEN SQLCODE = -913                                  05602000
056030                  CONTINUE                                        05603000
056040                                                                  05604000
056050             WHEN SQLWARN0 NOT = SPACE                            05605000
056060             WHEN SQLCODE < +0                                    05606000
056070             WHEN SQLCODE > +0                                    05607000
056080                  MOVE '4380-READ-TRIP-STATUS-TABLE'              05608000
056090                                   TO DP013-PARAGRAPH             05609000
056100                  MOVE 'SELECT ON TTRIPST'                        05610000
056110                                   TO DP013-MESSAGE-TEXT (1)      05611000
056120                  MOVE DK-TRIP-ID  TO DP013-MESSAGE-TEXT (2)      05612000
056130                  MOVE PV-TRIP-STATUS-CDE                         05613000
056140                                   TO DP013-MESSAGE-TEXT (3)      05614000
056150                  MOVE SQLCA       TO DP013-SQLCA                 05615000
056160                  MOVE 'TTRIPST'   TO DP013-DB2-TABLE-NAME (1)    05616000
056170                  SET DP013-DB2-ABEND                             05617000
056180                      DP013-XCTL-DISPLAY-RESTART                  05618000
056190                                   TO TRUE                        05619000
056200                  PERFORM DP013-0000-PROCESS-ABEND                05620000
056210         END-EVALUATE                                             05621000
056220     END-PERFORM.                                                 05622000
056230                                                                  05623000
056240     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05624000
056250             AND (SQLCODE NOT = +0)                               05625000
056260         MOVE '4380-READ-TRIP-STATUS-TABLE'                       05626000
056270                                   TO DP013-PARAGRAPH             05627000
056280         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   05628000
056290                                   TO DP013-MESSAGE-TEXT (1)      05629000
056300         MOVE 'ON TABLE TTRIPST '  TO DP013-MESSAGE-TEXT (2)      05630000
056310         MOVE SQLCA                TO DP013-SQLCA                 05631000
056320         SET DP013-DB2-ABEND                                      05632000
056330             DP013-XCTL-DISPLAY-RESTART                           05633000
056340                                   TO TRUE                        05634000
056350         PERFORM DP013-0000-PROCESS-ABEND                         05635000
056360     END-IF.                                                      05636000
056370                                                                  05637000
056380                                                                  05638088
056381*----------------------------------------------------------------*05638188
056382* CHECK PARM TABLE TO SEE IF CURRENT DC LOCATION TO SEE IF THE   *05638288
056383* DC IS USING RPA MIS-DIRECT PROCESS                             *05638388
056384*----------------------------------------------------------------*05638488
056385 4385-CHECK-RPAMSD.                                               05638588
056386                                                                  05638688
056387     MOVE  DK-OPER-UNT-ID        TO KRPRPM-LOC-ID.                05638790
056388     EXEC SQL                                                     05638888
056389          SELECT FUNC_TXT                                         05638988
056390          INTO  :KRPRPM-FUNC-TXT                                  05639088
056391          FROM   TKRPRPM                                          05639188
056396           WHERE LOC_ID            = :KRPRPM-LOC-ID               05639688
056397             AND INTFC_SYS_CDE     = 'KHL'                        05639788
056398             AND SYS_PRC_FUNC_CDE  = 'RPAMSD'                     05639888
056399             AND FUNC_PRC_STAT_CDE = 'AC'                         05639988
056400             AND FUNC_BEG_TMST    <= CURRENT TIMESTAMP            05640088
056401             AND FUNC_END_TMST    >= CURRENT TIMESTAMP            05640188
056402             AND FUNC_TXT          = 'Y'                          05640288
056403     END-EXEC.                                                    05640388
056404                                                                  05640488
056405     EVALUATE TRUE                                                05640588
056406         WHEN SQLCODE = +0                                        05640688
056407             SET ASC-RPA-MISDRCT-CK    TO TRUE                    05640788
056408         WHEN SQLCODE = +100                                      05640888
056409             SET ASC-NO-RPA-MISDRCT-CK TO TRUE                    05640988
056410         WHEN SQLWARN0 NOT = SPACES                               05641088
056411         WHEN SQLCODE < +0                                        05641188
056412         WHEN SQLCODE > +0                                        05641288
056413             MOVE '4385-CHECK-RPAMSD          '                   05641388
056414                               TO DP013-PARAGRAPH                 05641488
056415             MOVE 'SELECT ON TKRPRPM'                             05641588
056416                               TO DP013-MESSAGE-TEXT(1)           05641688
056417             MOVE DK-TRIP-ID   TO DP013-MESSAGE-TEXT(2)           05641788
056418             MOVE KRPRPM-LOC-ID TO DP013-MESSAGE-TEXT(3)          05641888
056419             MOVE SQLCA        TO DP013-SQLCA                     05641988
056420             MOVE 'TKRPRPM'    TO DP013-DB2-TABLE-NAME (1)        05642088
056421             SET DP013-DB2-ABEND                                  05642188
056422                 DP013-XCTL-DISPLAY-RESTART TO TRUE               05642288
056423             PERFORM DP013-0000-PROCESS-ABEND                     05642388
056424     END-EVALUATE.                                                05642488
056425                                                                  05642588
056426*----------------------------------------------------------------*05642600
056427* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *05642700
056428*----------------------------------------------------------------*05642800
056429                                                                  05642900
056430 4400-MOVE-COMMAREA-TO-SCREEN.                                    05643000
056440                                                                  05644000
056450     MOVE ASC-KEY-OWNER-SCAC-ID    TO ASCACO.                     05645000
056460     MOVE ASC-OWNER-SCAC-ID-DESC   TO ASCACDO.                    05646000
056470     MOVE ASC-KEY-VEH-NBR          TO ATRLRO.                     05647000
056480     MOVE ASC-OWNR-SCAC-SHP-MM     TO ACSHPMMO.                   05648000
056490     MOVE ASC-OWNR-SCAC-SHP-DD     TO ACSHPDDO.                   05649000
056500     MOVE ASC-OWNR-SCAC-SHP-CCYY   TO ACSHPYYO.                   05650000
056510     MOVE ASC-USAGE-CDE            TO AUSEO.                      05651000
056520     MOVE ASC-LENGTH               TO ALGTHO.                     05652000
056530     MOVE ASC-CURR-OPER-UNT-ID-N   TO ACOPERO.                    05653000
056540     MOVE ASC-CURR-FCLTY-ID-N      TO ACFIDO.                     05654000
056550     MOVE ASC-CURR-FCLTY-NME       TO ACFIDDO.                    05655000
056560     MOVE ASC-VEH-TYP-CDE          TO ATRIPTPO.                   05656000
056570     MOVE ASC-CURR-FAC-AREA-ID     TO ACAREAO.                    05657000
056580     MOVE ASC-CURR-FAC-AREA-ID-DESC                               05658000
056590                                   TO ACAREADO.                   05659000
056600     MOVE ASC-CURR-SUBAREA-OF-ID   TO ACSUBO.                     05660000
056610     MOVE ASC-CURR-SUBAREA-OF-ID-DESC                             05661000
056620                                   TO ACSUBDO.                    05662000
056630     MOVE ASC-DEST-OPER-UNT-ID-N   TO ADOPERO.                    05663000
056640     MOVE ASC-DEST-FCLTY-ID-N      TO ADFIDO.                     05664000
056650     MOVE ASC-DEST-FCLTY-NME       TO ADFIDDO.                    05665000
056660     MOVE ASC-DEST-FAC-AREA-ID     TO ADAREAO.                    05666000
056670     MOVE ASC-DEST-FAC-AREA-ID-DESC                               05667000
056680                                   TO ADAREADO.                   05668000
056690     MOVE ASC-DEST-SUBAREA-OF-ID   TO ADSUBO.                     05669000
056700     MOVE ASC-DEST-SUBAREA-OF-ID-DESC                             05670000
056710                                   TO ADSUBDO.                    05671000
056720     MOVE ASC-TRIP-STATUS-CDE      TO ATRIPSO.                    05672000
056730     MOVE ASC-TRIP-STATUS-DESC     TO ATRIPSDO.                   05673000
056740     MOVE PV-TRIP-MMDDYY           TO ASTATDTO.                   05674000
056750     MOVE PV-TRIP-TME              TO ASTATTMO.                   05675000
056760     MOVE ASC-MANIFEST-NBR         TO AMANO.                      05676000
056770     MOVE ASC-STOP-NBR             TO ASTOPO.                     05677000
056780     MOVE ASC-TOTAL-STOPS          TO ATSTOPO.                    05678000
056790     MOVE ASC-SEAL-1               TO ASEAL1O.                    05679000
056800     MOVE ASC-SEAL-2               TO ASEAL2O.                    05680000
056810     MOVE ASC-ETA-DTE-MM           TO AETAMMO.                    05681000
056820     MOVE ASC-ETA-DTE-DD           TO AETADDO.                    05682000
056830     MOVE ASC-ETA-DTE-CCYY         TO AETAYYO.                    05683000
056840     MOVE ASC-XMIT-DATE            TO AXMITDTO.                   05684000
056910                                                                  05691000
056920     IF  ASC-ADD-PENDING                                          05692000
056930     OR  ASC-UPDATE-PENDING                                       05693000
056940         IF  PS-NO-ERROR                                          05694000
056950             SET DP030-SET-CURSOR-APPL-1                          05695000
056960                                       TO TRUE                    05696000
056970                 MOVE -1               TO AUSEL                   05697000
056980         END-IF                                                   05698000
056990     ELSE                                                         05699000
057000         IF  ASC-NEW-STOP-PENDING                                 05700000
057010             IF  PS-NO-ERROR                                      05701000
057020                 MOVE -1               TO ADOPERL                 05702000
057030                 SET DP030-SET-CURSOR-APPL-1                      05703000
057040                                       TO TRUE                    05704000
057050             END-IF                                               05705000
057060         END-IF                                                   05706000
057070     END-IF.                                                      05707000
057080                                                                  05708000
057090/                                                                 05709000
057100*----------------------------------------------------------------*05710000
057110* ADD A VEHICLE                                                  *05711000
057120*----------------------------------------------------------------*05712000
057130 5000-ADD-VEHICLE.                                                05713000
057140                                                                  05714000
057150     INITIALIZE DCLTVEHICL                                        05715000
057160                DCLTVHTRIP                                        05716000
057170                DCLTTRIPST                                        05717000
057180                DCLTVHSEAL.                                       05718000
057190                                                                  05719000
057200     MOVE ASC-KEY-OWNER-SCAC-ID    TO DK-OWNER-SCAC-ID.           05720000
057210     MOVE ASC-KEY-VEH-NBR          TO DK-VEH-NBR.                 05721000
057220                                                                  05722000
057230     MOVE 'CE'                     TO VEHICL-CRT-SRC-CDE          05723000
057240                                      VHTRIP-CRT-SRC-CDE.         05724000
057250     MOVE ASC-USAGE-CDE            TO VEHICL-USAGE-CDE.           05725000
057260     MOVE ASC-LENGTH               TO VEHICL-VEH-SIZE-CDE.        05726000
057270                                                                  05727000
057280     IF ASC-CURR-OPER-UNT-ID = (SPACES OR LOW-VALUES)             05728000
057290         MOVE ZERO                 TO VEHICL-CURR-OPER-UNT-ID     05729000
057300     ELSE                                                         05730000
057310         MOVE ASC-CURR-OPER-UNT-ID TO VEHICL-CURR-OPER-UNT-ID.    05731000
057320     IF ASC-CURR-FCLTY-ID = (SPACES OR LOW-VALUES)                05732000
057330         MOVE ZERO                 TO VEHICL-CURR-FCLTY-ID        05733000
057340     ELSE                                                         05734000
057350         MOVE ASC-CURR-FCLTY-ID    TO VEHICL-CURR-FCLTY-ID.       05735000
057360                                                                  05736000
057370     MOVE ASC-VEH-TYP-CDE          TO VEHICL-VEH-TYP-CDE          05737000
057380                                                                  05738000
057390     MOVE ASC-CURR-SUBAREA-OF-ID   TO VEHICL-CURR-FAC-AREA-ID.    05739000
057400     MOVE ASC-MANIFEST-NBR         TO VHTRIP-MANIFEST-NBR.        05740000
057410     IF ASC-TRIP-STATUS-CDE NOT = VEHICL-CURR-STATUS-CDE          05741000
057420         MOVE SPACES TO VEHICL-CURR-STATUS-DTE                    05742000
057430         MOVE SPACES TO VEHICL-CURR-STATUS-TME                    05743000
057440     END-IF.                                                      05744000
057450     MOVE ASC-TRIP-STATUS-CDE      TO VEHICL-CURR-STATUS-CDE      05745000
057460                                      TRIPST-TRIP-STATUS-CDE      05746000
057470                                      DK-TRIP-STATUS-CDE.         05747000
057480                                                                  05748000
057490     PERFORM 5120-GET-PRTY-CDE.                                   05749000
057500     MOVE TRSTYP-PRTY-CDE          TO ASC-TRIP-PRTY-CDE.          05750000
057510                                                                  05751000
057520     MOVE ASC-DEST-OPER-UNT-ID     TO TRIPST-OPER-UNT-ID.         05752000
057530     MOVE ASC-DEST-FCLTY-ID        TO TRIPST-FCLTY-ID.            05753000
057540     MOVE ASC-DEST-SUBAREA-OF-ID   TO TRIPST-FCLTY-AREA-ID.       05754000
057550                                                                  05755000
057560     PERFORM 5050-GET-RANDOM-NUMBER                               05756000
057570         WITH TEST AFTER                                          05757000
057580         UNTIL PV-VHTRIP-COUNT = 0.                               05758000
057590     MOVE PV-CURR-TRIP-ID      TO VEHICL-CURR-TRIP-ID             05759000
057600                                  ASC-KEY-TRIP-ID                 05760000
057610                                  VHTRIP-TRIP-ID                  05761000
057620                                  VHTRIP-REF-TRIP-ID              05762000
057630                                  TRIPST-TRIP-ID                  05763000
057640                                  VHSEAL-TRIP-ID.                 05764000
057650     IF ASC-ETA-DTE = SPACES AND                                  05765000
057660        ASC-ETA-TIME = SPACES                                     05766000
057670         MOVE -1       TO DN-EST-AR-TMST                          05767000
057680     ELSE                                                         05768000
057690         STRING  ASC-ETA-DTE-CC                                   05769000
057700                 ASC-ETA-DTE-YY                                   05770000
057710                 '-'                                              05771000
057720                 ASC-ETA-DTE-MM                                   05772000
057730                 '-'                                              05773000
057740                 ASC-ETA-DTE-DD                                   05774000
057750                 '-'                                              05775000
057760                 ASC-ETA-TIME-HH                                  05776000
057770                 '.'                                              05777000
057780                 ASC-ETA-TIME-MM                                  05778000
057790                 '.00.000000'                                     05779000
057800                 DELIMITED BY SIZE                                05780000
057810                 INTO VHTRIP-EST-AR-TMST                          05781000
057820         MOVE +1       TO DN-EST-AR-TMST                          05782000
057830     END-IF.                                                      05783000
057840                                                                  05784000
057850     IF ASC-OWNR-SCAC-SHP-DTE = SPACES OR                         05785000
057860        ASC-OWNR-SCAC-SHP-DTE = '0001-01-01'                      05786000
057870        EXEC CICS ASKTIME                                         05787000
057880             ABSTIME (PV-ABSTIME)                                 05788000
057890        END-EXEC                                                  05789000
057900        EXEC CICS FORMATTIME                                      05790000
057910             ABSTIME (PV-ABSTIME)                                 05791000
057920             DATESEP ('-') YYMMDD  (ASC-SHP-YY-MM-DD)             05792000
057930        END-EXEC                                                  05793000
057940        IF ASC-OWNR-SCAC-SHP-YY > 60                              05794000
057950            MOVE '19'   TO ASC-OWNR-SCAC-SHP-CC                   05795000
057960        ELSE                                                      05796000
057970            MOVE '20'   TO ASC-OWNR-SCAC-SHP-CC                   05797000
057980        END-IF                                                    05798000
057990     END-IF.                                                      05799000
058000                                                                  05800000
058010     MOVE ASC-OWNR-SCAC-SHP-DTE                                   05801000
058020                     TO ASC-OWNR-SHP-DTE-OLD                      05802000
058030                        VHTRIP-OWNR-SCAC-SHIP-DTE.                05803000
058040                                                                  05804000
058050     IF ASC-VEHICLE-NULL-TRIP                                     05805000
058060         PERFORM 6160-UPDATE-TVEHICL                              05806000
058070     ELSE                                                         05807000
058080         PERFORM 5100-INSERT-TVEHICL.                             05808000
058090     PERFORM 8000-AUDIT-TVEHICL.                                  05809000
058100                                                                  05810000
058110     IF  SQLCODE = +0                                             05811000
058120         MOVE +1                 TO DN-VEH-NBR                    05812000
058130         PERFORM 5300-INSERT-TVHTRIP                              05813000
058140         MOVE VHTRIP-TRIP-ID   TO DK-TRIP-ID                      05814000
058150         PERFORM 8100-AUDIT-TVHTRIP                               05815000
058160         PERFORM 5400-INSERT-TTRIPST                              05816000
058170         IF  ASC-TRIP-PRTY-CDE-N < 21                             05817000
058180         OR  ASC-TRIP-PRTY-CDE-N > 49                             05818000
058190             SET ASC-NEW-STOP-PENDING                             05819000
058200                                 TO TRUE                          05820000
058210         END-IF                                                   05821000
058220         IF TRIPST-TRIP-STATUS-CDE = 'AR'                         05822000
058230             MOVE 'EN' TO TRIPST-TRIP-STATUS-CDE                  05823000
058240             PERFORM 5400-INSERT-TTRIPST                          05824000
058250         END-IF                                                   05825000
058260         IF  ASC-SEAL-1 > SPACES                                  05826000
058270             MOVE ASC-SEAL-1     TO VHSEAL-SEAL-NBR               05827000
058280             MOVE -1             TO DN-SEAL-COND-CDE              05828000
058290                                    DN-INSPECT-DTE                05829000
058300                                    DN-INSPECT-TME                05830000
058310                                    DN-INSPECTOR-NAME             05831000
058320             PERFORM 5500-INSERT-TVHSEAL                          05832000
058330         END-IF                                                   05833000
058340*        IF  ASC-SEAL-2 > SPACES                                  05834000
058350*            MOVE ASC-SEAL-2     TO VHSEAL-SEAL-NBR               05835000
058360*            MOVE -1             TO DN-SEAL-COND-CDE              05836000
058370*                                   DN-INSPECT-DTE                05837000
058380*                                   DN-INSPECT-TME                05838000
058390*                                   DN-INSPECTOR-NAME             05839000
058400*            PERFORM 5500-INSERT-TVHSEAL                          05840000
058410*        END-IF                                                   05841000
058420     END-IF.                                                      05842000
058430                                                                  05843000
058440     IF  SQLCODE = ZERO                                           05844000
058450         IF PS-ETA-WARNING                                        05845000
058460             SET DP020-MSG-WARNING TO TRUE                        05846000
058470             MOVE PC-TSYMSG-01497 TO DP020-MSG-NUMBER             05847000
058480             MOVE DP015-UNP-ALP-BRT-MDT                           05848000
058490                                   TO AETAMMA                     05849000
058500                                      AETADDA                     05850000
058510                                      AETAYYA                     05851000
058520             MOVE DP015-YELLOW TO AETAMMC                         05852000
058530                                      AETADDC                     05853000
058540                                      AETAYYC                     05854000
058550             MOVE DP015-REVERSE TO AETAMMH                        05855000
058560                                      AETADDH                     05856000
058570                                      AETAYYH                     05857000
058580         ELSE                                                     05858000
058590             MOVE PC-TSYMSG-00034 TO DP020-MSG-NUMBER             05859000
058600         END-IF                                                   05860000
058610         SET DP020-MSG-INFORMATIONAL                              05861000
058620             ASC-VEHICLE-SETUP-PREV                               05862000
058630             ASC-ADD-SUCCESSFUL  TO TRUE                          05863000
058640         IF  ASC-USE-SELECTION-QUEUE                              05864000
058650             PERFORM 5200-UPDATE-SELECTION-QUEUE                  05865000
058660         END-IF                                                   05866000
058670         PERFORM 3500-SAVE-SCREEN-FIELDS                          05867000
058680     END-IF.                                                      05868000
058690                                                                  05869000
058700/                                                                 05870000
058710*----------------------------------------------------------------*05871000
058720* ADD A TRIP PROCESSING                                          *05872000
058730*----------------------------------------------------------------*05873000
058740 5010-ADD-TRIP.                                                   05874000
058750                                                                  05875000
058760     INITIALIZE DCLTVHTRIP                                        05876000
058770                DCLTTRIPST.                                       05877000
058780                                                                  05878000
058790     MOVE ASC-KEY-OWNER-SCAC-ID    TO DK-OWNER-SCAC-ID.           05879000
058800     MOVE ASC-KEY-VEH-NBR          TO DK-VEH-NBR.                 05880000
058810                                                                  05881000
058820     PERFORM 5050-GET-RANDOM-NUMBER                               05882000
058830         WITH TEST AFTER                                          05883000
058840         UNTIL PV-VHTRIP-COUNT = 0.                               05884000
058850     IF  ASC-USAGE-CDE          = ASC-USAGE-CDE-OLD               05885000
058860     AND ASC-LENGTH             = ASC-LENGTH-OLD                  05886000
058870         CONTINUE                                                 05887000
058880     ELSE                                                         05888000
058890         PERFORM 4100-SELECT-TVEHICL                              05889000
058900         MOVE ASC-USAGE-CDE  TO VEHICL-USAGE-CDE                  05890000
058910         MOVE ASC-LENGTH     TO VEHICL-VEH-SIZE-CDE               05891000
058920         PERFORM 6160-UPDATE-TVEHICL                              05892000
058930         PERFORM 8000-AUDIT-TVEHICL                               05893000
058940     END-IF.                                                      05894000
058950                                                                  05895000
058960     MOVE 'CE'                     TO VHTRIP-CRT-SRC-CDE.         05896000
058970     MOVE ASC-MANIFEST-NBR         TO VHTRIP-MANIFEST-NBR.        05897000
058980     MOVE ASC-TRIP-STATUS-CDE      TO TRIPST-TRIP-STATUS-CDE.     05898000
058990     MOVE ASC-DEST-OPER-UNT-ID     TO TRIPST-OPER-UNT-ID.         05899000
059000     MOVE ASC-DEST-FCLTY-ID        TO TRIPST-FCLTY-ID.            05900000
059010     MOVE ASC-DEST-SUBAREA-OF-ID   TO TRIPST-FCLTY-AREA-ID.       05901000
059020                                                                  05902000
059030     MOVE PV-CURR-TRIP-ID          TO VHTRIP-TRIP-ID              05903000
059040                                      TRIPST-TRIP-ID              05904000
059050                                      VHSEAL-TRIP-ID.             05905000
059060                                                                  05906000
059070     PERFORM 6135-GET-MAX-TRIP-SEQ.                               05907000
059080                                                                  05908000
059090     COMPUTE ASC-STOP-NBR = VHTRIP-PLND-TRIP-SEQ + 1.             05909000
059100     MOVE ASC-STOP-NBR           TO ASC-TOTAL-STOPS.              05910000
059110     MOVE ASC-STOP-NBR           TO ASTOPO.                       05911000
059120     MOVE ASC-TOTAL-STOPS        TO ATSTOPO.                      05912000
059130     MOVE +1                     TO DN-VEH-NBR.                   05913000
059140     MOVE ASC-REF-TRIP-ID        TO VHTRIP-REF-TRIP-ID.           05914000
059150     IF ASC-ETA-DTE = SPACES AND                                  05915000
059160        ASC-ETA-TIME = SPACES                                     05916000
059170         MOVE -1       TO DN-EST-AR-TMST                          05917000
059180     ELSE                                                         05918000
059190         STRING  ASC-ETA-DTE-CC                                   05919000
059200                 ASC-ETA-DTE-YY                                   05920000
059210                 '-'                                              05921000
059220                 ASC-ETA-DTE-MM                                   05922000
059230                 '-'                                              05923000
059240                 ASC-ETA-DTE-DD                                   05924000
059250                 '-'                                              05925000
059260                 ASC-ETA-TIME-HH                                  05926000
059270                 '.'                                              05927000
059280                 ASC-ETA-TIME-MM                                  05928000
059290                 '.00.000000'                                     05929000
059300                 DELIMITED BY SIZE                                05930000
059310                 INTO VHTRIP-EST-AR-TMST                          05931000
059320         MOVE +1       TO DN-EST-AR-TMST                          05932000
059330     END-IF.                                                      05933000
059340                                                                  05934000
059350     IF ASC-OWNR-SCAC-SHP-DTE = SPACES OR                         05935000
059360        ASC-OWNR-SCAC-SHP-DTE = '0001-01-01'                      05936000
059370        EXEC CICS ASKTIME                                         05937000
059380             ABSTIME (PV-ABSTIME)                                 05938000
059390        END-EXEC                                                  05939000
059400        EXEC CICS FORMATTIME                                      05940000
059410             ABSTIME (PV-ABSTIME)                                 05941000
059420             DATESEP ('-') YYMMDD  (ASC-SHP-YY-MM-DD)             05942000
059430        END-EXEC                                                  05943000
059440        IF ASC-OWNR-SCAC-SHP-YY > 60                              05944000
059450            MOVE '19'   TO ASC-OWNR-SCAC-SHP-CC                   05945000
059460        ELSE                                                      05946000
059470            MOVE '20'   TO ASC-OWNR-SCAC-SHP-CC                   05947000
059480        END-IF                                                    05948000
059490     END-IF.                                                      05949000
059500                                                                  05950000
059510     MOVE ASC-OWNR-SCAC-SHP-DTE                                   05951000
059520                     TO ASC-OWNR-SHP-DTE-OLD                      05952000
059530                        VHTRIP-OWNR-SCAC-SHIP-DTE.                05953000
059540                                                                  05954000
059550     PERFORM 5300-INSERT-TVHTRIP.                                 05955000
059560     MOVE VHTRIP-TRIP-ID   TO DK-TRIP-ID.                         05956000
059570     PERFORM 8100-AUDIT-TVHTRIP.                                  05957000
059580                                                                  05958000
059590     IF  SQLCODE = +0                                             05959000
059600         PERFORM 5400-INSERT-TTRIPST                              05960000
059610         IF  ASC-SEAL-1 > SPACES                                  05961000
059620             MOVE ASC-SEAL-1     TO VHSEAL-SEAL-NBR               05962000
059630             MOVE -1             TO DN-SEAL-COND-CDE              05963000
059640                                    DN-INSPECT-DTE                05964000
059650                                    DN-INSPECT-TME                05965000
059660                                    DN-INSPECTOR-NAME             05966000
059670             PERFORM 5500-INSERT-TVHSEAL                          05967000
059680         END-IF                                                   05968000
059690*        IF  ASC-SEAL-2 > SPACES                                  05969000
059700*            MOVE ASC-SEAL-2     TO VHSEAL-SEAL-NBR               05970000
059710*            MOVE -1             TO DN-SEAL-COND-CDE              05971000
059720*                                   DN-INSPECT-DTE                05972000
059730*                                   DN-INSPECT-TME                05973000
059740*                                   DN-INSPECTOR-NAME             05974000
059750*            PERFORM 5500-INSERT-TVHSEAL                          05975000
059760*        END-IF                                                   05976000
059770*        PERFORM 5110-UPDATE-CURR-TRIP-ID                         05977000
059780*        PERFORM 8000-AUDIT-TVEHICL                               05978000
059790*        IF  ASC-TRIP-PRTY-CDE-N > 49                             05979000
059800*            PERFORM 5110-UPDATE-CURR-TRIP-ID                     05980000
059810*            PERFORM 8000-AUDIT-TVEHICL                           05981000
059820*        END-IF                                                   05982000
059830                                                                  05983000
059840         IF PS-ETA-WARNING                                        05984000
059850             SET DP020-MSG-WARNING TO TRUE                        05985000
059860             MOVE PC-TSYMSG-01497 TO DP020-MSG-NUMBER             05986000
059870             MOVE DP015-UNP-ALP-BRT-MDT                           05987000
059880                                   TO AETAMMA                     05988000
059890                                      AETADDA                     05989000
059900                                      AETAYYA                     05990000
059910             MOVE DP015-YELLOW TO AETAMMC                         05991000
059920                                      AETADDC                     05992000
059930                                      AETAYYC                     05993000
059940             MOVE DP015-REVERSE TO AETAMMH                        05994000
059950                                      AETADDH                     05995000
059960                                      AETAYYH                     05996000
059970         ELSE                                                     05997000
059980             MOVE PC-TSYMSG-00034 TO DP020-MSG-NUMBER             05998000
059990         END-IF                                                   05999000
060000                                                                  06000000
060010         SET DP020-MSG-INFORMATIONAL                              06001000
060020             ASC-ADD-SUCCESSFUL  TO TRUE                          06002000
060030         IF  ASC-USE-SELECTION-QUEUE                              06003000
060040             PERFORM 5200-UPDATE-SELECTION-QUEUE                  06004000
060050         END-IF                                                   06005000
060060     END-IF.                                                      06006000
060070                                                                  06007000
060080/                                                                 06008000
060090*----------------------------------------------------------------*06009000
060100*  GET A RANDOM NUMBER FROM THE RANDOM NUMBER GENERATOR          *06010000
060110*----------------------------------------------------------------*06011000
060120 5050-GET-RANDOM-NUMBER.                                          06012000
060130     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     06013000
060140                                                                  06014000
060150     CALL PC-RANDNBR-PGM USING DFHEIBLK                           06015000
060160                               DFHCOMMAREA                        06016000
060170                               DP902-RANDNBR-ROUTINE-FIELDS.      06017000
060180                                                                  06018000
060190     IF  DP902-SUCCESSFUL                                         06019000
060200         MOVE DP902-RANDOM-NUMBER  TO PV-CURR-TRIP-ID             06020000
060210         MOVE +1                   TO DN-CURR-TRIP-ID             06021000
060220     ELSE                                                         06022000
060230         MOVE '5050-GET-RANDOM-NUMBER'                            06023000
060240                                   TO DP013-PARAGRAPH             06024000
060250         MOVE 'CALL TO DPKUT902 FAILED'                           06025000
060260                                   TO DP013-MESSAGE-TEXT(1)       06026000
060270         SET DP013-XCTL-DISPLAY-RESTART                           06027000
060280                                   TO TRUE                        06028000
060290         PERFORM DP013-0000-PROCESS-ABEND                         06029000
060300     END-IF.                                                      06030000
060310     PERFORM 7600-READ-DUPL-TVHTRIP.                              06031000
060320/                                                                 06032000
060330*----------------------------------------------------------------*06033000
060340*  INSERT A ROW ON THE VEHICLE TABLE                             *06034000
060350*----------------------------------------------------------------*06035000
060360 5100-INSERT-TVEHICL.                                             06036000
060370                                                                  06037000
060380     PERFORM                                                      06038000
060390         WITH TEST AFTER                                          06039000
060400         VARYING PV-RETRY-COUNTER                                 06040000
060410         FROM 1 BY 1                                              06041000
060420         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06042000
060430             OR (SQLCODE = +0)                                    06043000
060440             OR (SQLCODE = -803))                                 06044000
060450                                                                  06045000
060460         EXEC SQL                                                 06046000
060470             INSERT  INTO TVEHICL                                 06047000
060480                    (OWNER_SCAC_ID                                06048000
060490                    ,VEH_NBR                                      06049000
060500                    ,CRT_SRC_CDE                                  06050000
060510                    ,LAST_UPD_DTE                                 06051000
060520                    ,LAST_UPD_TME                                 06052000
060530                    ,LAST_UPD_UID                                 06053000
060540                    ,USAGE_CDE                                    06054000
060550                    ,VEH_TYP_CDE                                  06055000
060560                    ,CURR_STATUS_CDE                              06056000
060570                    ,CURR_STATUS_DTE                              06057000
060580                    ,CURR_STATUS_TME                              06058000
060590                    ,CURR_OPER_UNT_ID                             06059000
060600                    ,CURR_FCLTY_ID                                06060000
060610                    ,CURR_FAC_AREA_ID                             06061000
060620                    ,CURR_LOC_DTE                                 06062000
060630                    ,CURR_LOC_TME                                 06063000
060640                    ,CURR_TRIP_ID                                 06064000
060650                    ,VEH_SIZE_CDE)                                06065000
060660            VALUES  (:DK-OWNER-SCAC-ID                            06066000
060670                    ,:DK-VEH-NBR                                  06067000
060680                    ,:VEHICL-CRT-SRC-CDE                          06068000
060690                    ,CURRENT DATE                                 06069000
060700                    ,CURRENT TIME                                 06070000
060710                    ,:DP020-USERID                                06071000
060720                    ,:VEHICL-USAGE-CDE                            06072000
060730                    ,:VEHICL-VEH-TYP-CDE                          06073000
060740                    ,:VEHICL-CURR-STATUS-CDE                      06074000
060750                    ,CURRENT DATE                                 06075000
060760                    ,CURRENT TIME                                 06076000
060770                    ,:VEHICL-CURR-OPER-UNT-ID                     06077000
060780                    ,:VEHICL-CURR-FCLTY-ID                        06078000
060790                    ,:VEHICL-CURR-FAC-AREA-ID                     06079000
060800                    ,CURRENT DATE                                 06080000
060810                    ,CURRENT TIME                                 06081000
060820                    ,:VEHICL-CURR-TRIP-ID                         06082000
060830                       :DN-CURR-TRIP-ID                           06083000
060840                    ,:VEHICL-VEH-SIZE-CDE)                        06084000
060850         END-EXEC                                                 06085000
060860                                                                  06086000
060870         EVALUATE TRUE                                            06087000
060880             WHEN SQLCODE = +0                                    06088000
060890                 SET ASC-VEHICLE-SETUP-PREV                       06089000
060900                                 TO TRUE                          06090000
060910                                                                  06091000
060920             WHEN SQLCODE = -803                                  06092000
060930                 SET PS-ERROR           TO TRUE                   06093000
060940                 SET DP020-MSG-FATAL    TO TRUE                   06094000
060950                 MOVE PC-TSYMSG-00117   TO DP020-MSG-NUMBER       06095000
060960                 MOVE DP015-UNP-ALP-BRT-OFF                       06096000
060970                                        TO ASCACA                 06097000
060980                                           ATRLRA                 06098000
060990                 MOVE DP015-RED         TO ASCACC                 06099000
061000                                           ATRLRC                 06100000
061010                 MOVE DP015-REVERSE     TO ASCACH                 06101000
061020                                           ATRLRH                 06102000
061030                 MOVE -1                TO ASCACL                 06103000
061040                 SET DP030-SET-CURSOR-APPL-1                      06104000
061050                                        TO TRUE                   06105000
061060                                                                  06106000
061070             WHEN SQLCODE = -904                                  06107000
061080             WHEN SQLCODE = -913                                  06108000
061090                 CONTINUE                                         06109000
061100                                                                  06110000
061110             WHEN SQLWARN0 NOT = SPACES                           06111000
061120             WHEN SQLCODE < +0                                    06112000
061130             WHEN SQLCODE > +0                                    06113000
061140                 MOVE '5100-INSERT-TVEHICL'                       06114000
061150                                   TO DP013-PARAGRAPH             06115000
061160                 MOVE 'INSERT A ROW ON TVEHICL'                   06116000
061170                                   TO DP013-MESSAGE-TEXT(1)       06117000
061180                 MOVE DK-VEH-NBR   TO DP013-MESSAGE-TEXT(2)       06118000
061190                 MOVE DK-OWNER-SCAC-ID                            06119000
061200                                   TO DP013-MESSAGE-TEXT(3)       06120000
061210                 MOVE SQLCA        TO DP013-SQLCA                 06121000
061220                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    06122000
061230                 SET DP013-DB2-ABEND                              06123000
061240                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06124000
061250                 PERFORM DP013-0000-PROCESS-ABEND                 06125000
061260         END-EVALUATE                                             06126000
061270     END-PERFORM.                                                 06127000
061280                                                                  06128000
061290     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06129000
061300             AND (SQLCODE NOT = +0)                               06130000
061310         MOVE '5100-INSERT-TVEHICL'                               06131000
061320                                   TO DP013-PARAGRAPH             06132000
061330         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              06133000
061340                                   TO DP013-MESSAGE-TEXT (1)      06134000
061350         MOVE 'TO INSERT A TVEHICL ROW'                           06135000
061360                                   TO DP013-MESSAGE-TEXT (2)      06136000
061370         MOVE SQLCA                TO DP013-SQLCA                 06137000
061380         MOVE 'TVEHICL'            TO DP013-DB2-TABLE-NAME (1)    06138000
061390         SET DP013-DB2-ABEND                                      06139000
061400             DP013-XCTL-DISPLAY-RESTART                           06140000
061410                                   TO TRUE                        06141000
061420         PERFORM DP013-0000-PROCESS-ABEND                         06142000
061430     END-IF.                                                      06143000
061440                                                                  06144000
061450/                                                                 06145000
061460*----------------------------------------------------------------*06146000
061470*  UPDATE THE CURRENT TRIP ID ON TVEHICL                         *06147000
061480*----------------------------------------------------------------*06148000
061490 5110-UPDATE-CURR-TRIP-ID.                                        06149000
061500                                                                  06150000
061510     PERFORM                                                      06151000
061520         WITH TEST AFTER                                          06152000
061530         VARYING PV-RETRY-COUNTER                                 06153000
061540         FROM 1 BY 1                                              06154000
061550         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06155000
061560             OR (SQLCODE = +0))                                   06156000
061570                                                                  06157000
061580         EXEC SQL                                                 06158000
061590           UPDATE TVEHICL                                         06159000
061600              SET CURR_TRIP_ID = :VEHICL-CURR-TRIP-ID             06160000
061610                                   :DN-CURR-TRIP-ID               06161000
061620                 ,LAST_UPD_DTE = CURRENT DATE                     06162000
061630                 ,LAST_UPD_TME = CURRENT TIME                     06163000
061640                 ,LAST_UPD_UID = :DP020-USERID                    06164000
061650           WHERE  VEH_NBR       = :DK-VEH-NBR                     06165000
061660             AND  OWNER_SCAC_ID = :DK-OWNER-SCAC-ID               06166000
061670         END-EXEC                                                 06167000
061680                                                                  06168000
061690         EVALUATE TRUE                                            06169000
061700             WHEN SQLCODE = +0                                    06170000
061710             WHEN SQLCODE = -904                                  06171000
061720             WHEN SQLCODE = -913                                  06172000
061730                 CONTINUE                                         06173000
061740                                                                  06174000
061750             WHEN SQLWARN0 NOT = SPACES                           06175000
061760             WHEN SQLCODE < +0                                    06176000
061770             WHEN SQLCODE > +0                                    06177000
061780                 MOVE '5110-UPDATE-CURR-TRIP-ID'                  06178000
061790                                   TO DP013-PARAGRAPH             06179000
061800                 MOVE 'UPDATE CURR TRIP ID ON TVEHICL'            06180000
061810                                   TO DP013-MESSAGE-TEXT(1)       06181000
061820                 MOVE DK-VEH-NBR   TO DP013-MESSAGE-TEXT(2)       06182000
061830                 MOVE DK-OWNER-SCAC-ID                            06183000
061840                                   TO DP013-MESSAGE-TEXT(3)       06184000
061850                 MOVE SQLCA        TO DP013-SQLCA                 06185000
061860                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    06186000
061870                 SET DP013-DB2-ABEND                              06187000
061880                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06188000
061890                 PERFORM DP013-0000-PROCESS-ABEND                 06189000
061900         END-EVALUATE                                             06190000
061910     END-PERFORM.                                                 06191000
061920                                                                  06192000
061930     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06193000
061940             AND (SQLCODE NOT = +0)                               06194000
061950         MOVE '5110-UPDATE-CURR-TRIP-ID'                          06195000
061960                                   TO DP013-PARAGRAPH             06196000
061970         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              06197000
061980                                   TO DP013-MESSAGE-TEXT (1)      06198000
061990         MOVE 'TO UPDATE A TVEHICL ROW'                           06199000
062000                                   TO DP013-MESSAGE-TEXT (2)      06200000
062010         MOVE SQLCA                TO DP013-SQLCA                 06201000
062020         MOVE 'TVEHICL'            TO DP013-DB2-TABLE-NAME (1)    06202000
062030         SET DP013-DB2-ABEND                                      06203000
062040             DP013-XCTL-DISPLAY-RESTART                           06204000
062050                                   TO TRUE                        06205000
062060         PERFORM DP013-0000-PROCESS-ABEND                         06206000
062070     END-IF.                                                      06207000
062080                                                                  06208000
062090/                                                                 06209000
062100*----------------------------------------------------------------*06210000
062110*  GET THE STATUS PRIORITY CODE                                  *06211000
062120*----------------------------------------------------------------*06212000
062130                                                                  06213000
062140 5120-GET-PRTY-CDE.                                               06214000
062150                                                                  06215000
062160     PERFORM                                                      06216000
062170         WITH TEST AFTER                                          06217000
062180         VARYING PV-RETRY-COUNTER                                 06218000
062190         FROM 1 BY 1                                              06219000
062200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06220000
062210                   OR (SQLCODE = +0))                             06221000
062220                                                                  06222000
062230         EXEC SQL                                                 06223000
062240            SELECT  PRTY_CDE                                      06224000
062250              INTO :TRSTYP-PRTY-CDE                               06225000
062260              FROM  TTRSTYP                                       06226000
062270             WHERE  TRIP_STATUS_CDE = :DK-TRIP-STATUS-CDE         06227000
062280         END-EXEC                                                 06228000
062290                                                                  06229000
062300         EVALUATE TRUE                                            06230000
062310             WHEN SQLCODE = +0                                    06231000
062320             WHEN SQLCODE = -904                                  06232000
062330             WHEN SQLCODE = -913                                  06233000
062340                 CONTINUE                                         06234000
062350                                                                  06235000
062360             WHEN SQLWARN0 NOT = SPACES                           06236000
062370             WHEN SQLCODE < +0                                    06237000
062380             WHEN SQLCODE > +0                                    06238000
062390                 MOVE '5120-GET-PRTY-CDE '                        06239000
062400                                 TO DP013-PARAGRAPH               06240000
062410                 MOVE 'SELECT SHIPT PRTY CODE'                    06241000
062420                                 TO DP013-MESSAGE-TEXT (1)        06242000
062430                 MOVE DK-TRIP-STATUS-CDE                          06243000
062440                                 TO DP013-MESSAGE-TEXT (2)        06244000
062450                 MOVE SQLCA      TO DP013-SQLCA                   06245000
062460                 MOVE 'TTRSTYP'  TO DP013-DB2-TABLE-NAME (1)      06246000
062470                 SET DP013-DB2-ABEND                              06247000
062480                                 TO TRUE                          06248000
062490                 SET DP013-XCTL-DISPLAY-RESTART                   06249000
062500                                 TO TRUE                          06250000
062510                 PERFORM DP013-0000-PROCESS-ABEND                 06251000
062520         END-EVALUATE                                             06252000
062530     END-PERFORM.                                                 06253000
062540                                                                  06254000
062550     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06255000
062560             AND (SQLCODE NOT = +0)                               06256000
062570         MOVE '5120-GET-PRTY-CDE '                                06257000
062580                                 TO DP013-PARAGRAPH               06258000
062590         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     06259000
062600                                 TO DP013-MESSAGE-TEXT (1)        06260000
062610         MOVE 'TRIP  PRTY CODE ' TO DP013-MESSAGE-TEXT (2)        06261000
062620         MOVE SQLCA              TO DP013-SQLCA                   06262000
062630         MOVE 'TTRSTYP'          TO DP013-DB2-TABLE-NAME (1)      06263000
062640         SET DP013-DB2-ABEND     TO TRUE                          06264000
062650         SET DP013-XCTL-DISPLAY-RESTART                           06265000
062660                                 TO TRUE                          06266000
062670         PERFORM DP013-0000-PROCESS-ABEND                         06267000
062680     END-IF.                                                      06268000
062690                                                                  06269000
062700/                                                                 06270000
062710*----------------------------------------------------------------*06271000
062720* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *06272000
062730* OBJECT WAS UPDATED.                                            *06273000
062740*----------------------------------------------------------------*06274000
062750                                                                  06275000
062760 5200-UPDATE-SELECTION-QUEUE.                                     06276000
062770                                                                  06277000
062780     PERFORM 9100-READ-SEL-QUEUE.                                 06278000
062790                                                                  06279000
062800     IF  ASC-DELETE-SUCCESSFUL                                    06280000
062810         SET TR006-DEL (ASC-SEL-SUB)                              06281000
062820                                   TO TRUE                        06282000
062830     ELSE                                                         06283000
062840         SET TR006-UPD (ASC-SEL-SUB)                              06284000
062850                                   TO TRUE                        06285000
062860     END-IF.                                                      06286000
062870                                                                  06287000
062880     PERFORM 9200-REWRITE-LIST-QUEUE.                             06288000
062890                                                                  06289000
062900/                                                                 06290000
062910*----------------------------------------------------------------*06291000
062920*  INSERT A ROW ON THE VEHICLE TRIP TABLE                        *06292000
062930*----------------------------------------------------------------*06293000
062940 5300-INSERT-TVHTRIP.                                             06294000
062950                                                                  06295000
062960     PERFORM                                                      06296000
062970         WITH TEST AFTER                                          06297000
062980         VARYING PV-RETRY-COUNTER                                 06298000
062990         FROM 1 BY 1                                              06299000
063000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06300000
063010             OR (SQLCODE = +0))                                   06301000
063020                                                                  06302000
063030         EXEC SQL                                                 06303000
063040             INSERT  INTO TVHTRIP                                 06304000
063050                    (OWNER_SCAC_ID                                06305000
063060                    ,VEH_NBR                                      06306000
063070                    ,TRIP_ID                                      06307000
063080                    ,TRIP_BEG_DTE                                 06308000
063090                    ,TRIP_BEG_TME                                 06309000
063100                    ,CRT_SRC_CDE                                  06310000
063110                    ,LAST_UPD_DTE                                 06311000
063120                    ,LAST_UPD_TME                                 06312000
063130                    ,LAST_UPD_UID                                 06313000
063140                    ,MANIFEST_NBR                                 06314000
063150                    ,PLND_TRIP_SEQ                                06315000
063160                    ,OWNR_SCAC_SHIP_DTE                           06316000
063170                    ,REF_TRIP_ID                                  06317000
063180                    ,EST_AR_TMST                                  06318000
063190                    ,SPLT_XMIT_IND                                06319000
063200                    ,SPLT_XMIT_DTE                                06320000
063210                    ,SPLT_XMIT_TM)                                06321000
063220            VALUES  (:DK-OWNER-SCAC-ID                            06322000
063230                    ,:DK-VEH-NBR                                  06323000
063240                       :DN-VEH-NBR                                06324000
063250                    ,:VHTRIP-TRIP-ID                              06325000
063260                    ,CURRENT DATE                                 06326000
063270                    ,CURRENT TIME                                 06327000
063280                    ,:VHTRIP-CRT-SRC-CDE                          06328000
063290                    ,CURRENT DATE                                 06329000
063300                    ,CURRENT TIME                                 06330000
063310                    ,:DP020-USERID                                06331000
063320                    ,:VHTRIP-MANIFEST-NBR                         06332000
063330                    ,:VHTRIP-PLND-TRIP-SEQ                        06333000
063340                    ,:VHTRIP-OWNR-SCAC-SHIP-DTE                   06334000
063350                    ,:VHTRIP-REF-TRIP-ID                          06335000
063360                    ,:VHTRIP-EST-AR-TMST   :DN-EST-AR-TMST        06336000
063370                    ,:VHTRIP-SPLT-XMIT-IND                        06337000
063380                    ,:PC-DEFAULT-DATE                             06338000
063390                    ,:PC-DEFAULT-TIME)                            06339000
063400         END-EXEC                                                 06340000
063410                                                                  06341000
063420         EVALUATE TRUE                                            06342000
063430             WHEN SQLCODE = +0                                    06343000
063440             WHEN SQLCODE = -904                                  06344000
063450             WHEN SQLCODE = -913                                  06345000
063460                 CONTINUE                                         06346000
063470                                                                  06347000
063480             WHEN SQLWARN0 NOT = SPACES                           06348000
063490             WHEN SQLCODE < +0                                    06349000
063500             WHEN SQLCODE > +0                                    06350000
063510                 MOVE SPACES TO PV-MESSAGE                        06351000
063520                 MOVE DK-VEH-NBR TO PV-MESSAGE1                   06352000
063530                 MOVE DK-OWNER-SCAC-ID TO PV-MESSAGE2             06353000
063540                 MOVE VHTRIP-TRIP-ID   TO PV-MESSAGE3             06354000
063550                 MOVE '5300-INSERT-TVHTRIP'                       06355000
063560                                   TO DP013-PARAGRAPH             06356000
063570                 MOVE 'INSERT A ROW ON TVHTRIP'                   06357000
063580                                   TO DP013-MESSAGE-TEXT(1)       06358000
063590                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       06359000
063600                 MOVE SQLCA        TO DP013-SQLCA                 06360000
063610                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    06361000
063620                 SET DP013-DB2-ABEND                              06362000
063630                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06363000
063640                 PERFORM DP013-0000-PROCESS-ABEND                 06364000
063650         END-EVALUATE                                             06365000
063660     END-PERFORM.                                                 06366000
063670                                                                  06367000
063680     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06368000
063690             AND (SQLCODE NOT = +0)                               06369000
063700         MOVE '5300-INSERT-TVHTRIP'                               06370000
063710                                   TO DP013-PARAGRAPH             06371000
063720         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              06372000
063730                                   TO DP013-MESSAGE-TEXT (1)      06373000
063740         MOVE 'TO INSERT A TVHTRIP ROW'                           06374000
063750                                   TO DP013-MESSAGE-TEXT (2)      06375000
063760         MOVE SQLCA                TO DP013-SQLCA                 06376000
063770         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    06377000
063780         SET DP013-DB2-ABEND                                      06378000
063790             DP013-XCTL-DISPLAY-RESTART                           06379000
063800                                   TO TRUE                        06380000
063810         PERFORM DP013-0000-PROCESS-ABEND                         06381000
063820     END-IF.                                                      06382000
063830                                                                  06383000
063840/                                                                 06384000
063850*----------------------------------------------------------------*06385000
063860*  INSERT A ROW ON THE VEHICLE TRIP STATUS TABLE                 *06386000
063870*----------------------------------------------------------------*06387000
063880 5400-INSERT-TTRIPST.                                             06388000
063890                                                                  06389000
063900     EXEC SQL                                                     06390000
063910         SET :PV-DB2-HOST-DATE      = CURRENT DATE                06391000
063920     END-EXEC.                                                    06392000
063930                                                                  06393000
063940     EXEC SQL                                                     06394000
063950         SET :PV-DB2-HOST-TIME      = CURRENT TIME                06395000
063960     END-EXEC.                                                    06396000
063970                                                                  06397000
063980*    IF THE CURRENT TIME IS LESS THAN OR EQUAL TO THE TIME OF THE 06398000
063990*    PREVIOUSLY INSERTED ROW (MEANING TWO OR MORE RECORDS HAVE BEE06399000
064000*    ADDED IN ON SECOND) ADD A SECOND TO THE PREVIOUS TIME TO KEEP06400000
064010*    TIMES UNIQUE.                                                06401000
064020                                                                  06402000
064030     MOVE TRIPST-STATUS-TME TO PV-CMPR-STATUS-TME.                06403009
064040     MOVE TRIPST-STATUS-DTE TO PV-CMPR-STATUS-DTE.                06404009
064050                                                                  06405000
064060     IF PV-DB2-HOST-DATE   = PV-CMPR-STATUS-DTE                   06406002
064070        IF  PV-DB2-HOST-TIME          <= PV-CMPR-STATUS-TME       06407009
064080           ADD +1                     TO PV-CMPR-STATUS-TME-SS    06408009
064090           IF PV-CMPR-STATUS-TME-SS    > 59                       06409009
064100              ADD +1                  TO PV-CMPR-STATUS-TME-MM    06410009
064110              MOVE ZEROS              TO PV-CMPR-STATUS-TME-SS    06411009
064120              IF PV-CMPR-STATUS-TME-MM > 59                       06412009
064130                 ADD +1               TO PV-CMPR-STATUS-TME-HH    06413009
064140                 MOVE ZEROS           TO PV-CMPR-STATUS-TME-MM    06414009
064150                 IF PV-CMPR-STATUS-TME-HH                         06415009
064160                                       > 23                       06416009
064170                    MOVE ZEROS        TO PV-CMPR-STATUS-TME-HH    06417009
064180                 END-IF                                           06418009
064190              END-IF                                              06419009
064200           END-IF                                                 06420009
064210           MOVE PV-CMPR-STATUS-TME    TO PV-DB2-HOST-TIME         06421009
064220        ELSE                                                      06422009
064230           MOVE PV-DB2-HOST-TIME      TO PV-CMPR-STATUS-TME       06423009
064240        END-IF                                                    06424009
064250     END-IF.                                                      06425009
064260                                                                  06426000
064270     PERFORM 5420-CHECK-ARRIVAL.                                  06427000
064280                                                                  06428000
064290     PERFORM                                                      06429000
064300         WITH TEST AFTER                                          06430000
064310         VARYING PV-RETRY-COUNTER                                 06431000
064320         FROM 1 BY 1                                              06432000
064330         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06433000
064340             OR (SQLCODE = +0))                                   06434000
064350                                                                  06435000
064360         EXEC SQL                                                 06436000
064370             INSERT  INTO TTRIPST                                 06437000
064380                    (TRIP_ID                                      06438000
064390                    ,TRIP_STATUS_CDE                              06439000
064400                    ,STATUS_DTE                                   06440000
064410                    ,STATUS_TME                                   06441000
064420                    ,STATUS_UID                                   06442000
064430                    ,OPER_UNT_ID                                  06443000
064440                    ,FCLTY_ID                                     06444000
064450                    ,FCLTY_AREA_ID)                               06445000
064460            VALUES  (:TRIPST-TRIP-ID                              06446000
064470                    ,:TRIPST-TRIP-STATUS-CDE                      06447000
064480                    ,:PV-DB2-HOST-DATE                            06448000
064490                    ,:PV-DB2-HOST-TIME                            06449000
064500                    ,:DP020-USERID                                06450000
064510                    ,:TRIPST-OPER-UNT-ID                          06451000
064520                    ,:TRIPST-FCLTY-ID                             06452000
064530                    ,:TRIPST-FCLTY-AREA-ID)                       06453000
064540         END-EXEC                                                 06454000
064550                                                                  06455000
064560         EVALUATE TRUE                                            06456000
064570             WHEN SQLCODE = +0                                    06457000
064580                 MOVE PV-DB2-HOST-DATE                            06458000
064590                                     TO PV-TRIPST-DTE             06459000
064600                 MOVE PV-TRIPST-YY   TO PV-TRIP-YY                06460000
064610                 MOVE PV-TRIPST-MM   TO PV-TRIP-MM                06461000
064620                 MOVE PV-TRIPST-DD   TO PV-TRIP-DD                06462000
064630                 MOVE PV-TRIP-MMDDYY TO ASTATDTO                  06463000
064640                 MOVE PV-DB2-HOST-TIME                            06464000
064650                                     TO PV-TRIPST-TME             06465000
064660                 MOVE PV-TRIPST-HH   TO PV-TRIP-HH                06466000
064670                 MOVE PV-TRIPST-MIN  TO PV-TRIP-MIN               06467000
064680                 MOVE PV-TRIP-TME    TO ASTATTMO                  06468000
064690             WHEN SQLCODE = -904                                  06469000
064700             WHEN SQLCODE = -913                                  06470000
064710                 CONTINUE                                         06471000
064720                                                                  06472000
064730             WHEN SQLWARN0 NOT = SPACES                           06473000
064740             WHEN SQLCODE < +0                                    06474000
064750             WHEN SQLCODE > +0                                    06475000
064760                 MOVE '5400-INSERT-TTRIPST'                       06476000
064770                                   TO DP013-PARAGRAPH             06477000
064780                 MOVE 'INSERT A ROW ON TTRIPST'                   06478000
064790                                   TO DP013-MESSAGE-TEXT(1)       06479000
064800                 MOVE TRIPST-TRIP-ID TO DP013-MESSAGE-TEXT(2)     06480000
064810                 MOVE TRIPST-TRIP-STATUS-CDE                      06481000
064820                                   TO DP013-MESSAGE-TEXT(3)       06482000
064830                 MOVE SQLCA        TO DP013-SQLCA                 06483000
064840                 MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)    06484000
064850                 SET DP013-DB2-ABEND                              06485000
064860                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06486000
064870                 PERFORM DP013-0000-PROCESS-ABEND                 06487000
064880         END-EVALUATE                                             06488000
064890     END-PERFORM.                                                 06489000
064900                                                                  06490000
064910     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06491000
064920             AND (SQLCODE NOT = +0)                               06492000
064930         MOVE '5400-INSERT-TTRIPST'                               06493000
064940                                   TO DP013-PARAGRAPH             06494000
064950         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              06495000
064960                                   TO DP013-MESSAGE-TEXT (1)      06496000
064970         MOVE 'TO INSERT A TTRIPST ROW'                           06497000
064980                                   TO DP013-MESSAGE-TEXT (2)      06498000
064990         MOVE SQLCA                TO DP013-SQLCA                 06499000
065000         MOVE 'TTRIPST'            TO DP013-DB2-TABLE-NAME (1)    06500000
065010         SET DP013-DB2-ABEND                                      06501000
065020             DP013-XCTL-DISPLAY-RESTART                           06502000
065030                                   TO TRUE                        06503000
065040         PERFORM DP013-0000-PROCESS-ABEND                         06504000
065050     END-IF.                                                      06505000
065060                                                                  06506000
065061     IF  TRIPST-TRIP-STATUS-CDE = 'UN' AND                        06506189
065062         SQLCODE = +0                  AND                        06506289
065063         ASC-RPA-MISDRCT-CK                                       06506389
065064         PERFORM 5510-RPA-MISDIRECT                               06506489
065065     END-IF.                                                      06506589
065066                                                                  06506689
065070     IF TRIPST-TRIP-STATUS-CDE = 'AR'                             06507000
065080     OR PS-UPDATE-REC                                             06508000
065090         MOVE ASC-KEY-TRIP-ID   TO DK-TRIP-ID                     06509000
065100         STRING PV-DB2-HOST-DATE  DELIMITED BY SIZE,              06510000
065110                '-' DELIMITED BY SIZE,                            06511000
065120                PV-DB2-HOST-TIME  DELIMITED BY SIZE,              06512000
065130                '.000000' DELIMITED BY SIZE                       06513000
065140                INTO                PV-REC-TMST                   06514000
065150         END-STRING                                               06515000
065160         MOVE 'N'               TO PS-NO-MORE-RECEIVRS-SW         06516000
065170         SET PS-NO-TRBL-CREATED-ONSITE                            06517000
065180             PS-NO-TRBL-ACCESS-TRBL    TO TRUE                    06518000
065190         MOVE ZEROS TO PV-TRBL-RSLV-CT                            06519000
065200                       PV-TRBL-MSG-NO                             06520000
065210         PERFORM 6200-OPEN-RECEIVR-CSR                            06521000
065220         PERFORM 6210-FETCH-RECEIVR-CSR                           06522000
065230         PERFORM UNTIL PS-NO-MORE-RECEIVRS                        06523000
065240             PERFORM 6300-UPDATE-RECEIV                           06524000
065250             PERFORM 5430-CHK4-STORAGE-TRBL                       06525000
065260             PERFORM 6210-FETCH-RECEIVR-CSR                       06526000
065270         END-PERFORM                                              06527000
065280         PERFORM 6220-CLOSE-RECEIVR-CSR                           06528000
065290     END-IF.                                                      06529000
065300/                                                                 06530000
065310 5403-CHECK-DC-PLANNING-PARM.                                     06531013
065320                                                                  06532013
065330*    MOVE DP020-LOCATION-NBR  TO  KRPRPM-LOC-ID.                  06533021
065340                                                                  06534013
065350     EXEC SQL                                                     06535013
065360          SELECT FUNC_TXT                                         06536013
065370          INTO  :KRPRPM-FUNC-TXT                                  06537013
065380          FROM   TKRPRPM                                          06538013
065390          WHERE  SYS_PRC_FUNC_CDE  = 'PLNCRE'                     06539013
065400            AND  LOC_ID            = :KRPRPM-LOC-ID               06540013
065410            AND  INTFC_SYS_CDE     = 'DLX'                        06541016
065420            AND  FUNC_PRC_STAT_CDE = 'AC'                         06542013
065430            AND  FUNC_TXT          = 'Y'                          06543014
065440     END-EXEC.                                                    06544013
065450                                                                  06545013
065460     EVALUATE TRUE                                                06546014
065470         WHEN SQLCODE = +0                                        06547014
065480             SET PS-DC-PLANNING-YES TO TRUE                       06548014
065490         WHEN SQLCODE = +100                                      06549014
065500             SET PS-DC-PLANNING-NO  TO TRUE                       06550014
065510         WHEN SQLWARN0 NOT = SPACES                               06551014
065520         WHEN SQLCODE < +0                                        06552014
065530         WHEN SQLCODE > +0                                        06553014
065540             MOVE '5403-CHECK-DC-PLANNING-PARM'                   06554014
065550                               TO DP013-PARAGRAPH                 06555014
065560             MOVE 'SELECT ON TKRPRPM'                             06556014
065570                               TO DP013-MESSAGE-TEXT(1)           06557014
065580             MOVE DK-TRIP-ID   TO DP013-MESSAGE-TEXT(2)           06558014
065590             MOVE KRPRPM-LOC-ID TO DP013-MESSAGE-TEXT(3)          06559014
065600             MOVE SQLCA        TO DP013-SQLCA                     06560014
065610             MOVE 'TKRPRPM'    TO DP013-DB2-TABLE-NAME (1)        06561014
065620             SET DP013-DB2-ABEND                                  06562014
065630                 DP013-XCTL-DISPLAY-RESTART TO TRUE               06563014
065640             PERFORM DP013-0000-PROCESS-ABEND                     06564014
065650     END-EVALUATE.                                                06565014
065660                                                                  06566014
065670 5405-CALL-XLKUP033-EAI.                                          06567014
065680     INITIALIZE XL072-EAI-EXPORT-COMMAREA.                        06568014
065690     SET XL072-SU-APP-ID                                          06569014
065700         XL072-COMMIT-UPDATE      TO TRUE.                        06570014
065710                                                                  06571014
065720                                                                  06572014
065730     MOVE 'RECEIVING'             TO XL072-EVNT-OBJ-TXT.          06573014
065740     MOVE 'TRAILER ARRIVAL'       TO XL072-EVNT-OBJ-ACTN-TXT.     06574014
065750     MOVE DP020-USERID            TO XL072-CRE-BY-USR-ID.         06575014
065760     MOVE PC-CURRENT-PROGRAM-NAME TO XL072-CRE-PGM-NM.            06576014
065770                                                                  06577014
065780     MOVE ASC-KEY-TRIP-ID         TO XL072-EVNT-KY-1-NBR.         06578014
065790*LMM                                                              06579017
065800     MOVE TRIPST-OPER-UNT-ID      TO XL072-EVNT-KY-2-NBR.         06580020
065810     MOVE PV-REC-TMST             TO XL072-EVNT-KY-1-TMST.        06581014
065820     MOVE ASC-KEY-OWNER-SCAC-ID   TO XL072-EVNT-KY-1-TXT.         06582014
065830     MOVE ASC-KEY-VEH-NBR         TO XL072-EVNT-KY-2-TXT.         06583014
065840                                                                  06584014
065850     SET XL072-COPYBOOK-NOT-USED  TO TRUE.                        06585014
065860                                                                  06586014
065870     CALL XL072-USER-PGM USING DFHEIBLK                           06587014
065880                              XL072-COMMAREA                      06588014
065890                              XL072-EAI-EXPORT-COMMAREA.          06589014
065900                                                                  06590014
065910     EVALUATE TRUE                                                06591014
065920         WHEN XL072-SUCCESSFUL                                    06592014
065930              CONTINUE                                            06593014
065940         WHEN OTHER                                               06594014
065950              MOVE '5405-CALL-XLKUP033-EAI'                       06595014
065960                                TO DP013-PARAGRAPH                06596014
065970              MOVE 'CALL TO XLKUP033 LABOR '                      06597019
065980                                TO DP013-MESSAGE-TEXT(1)          06598014
065990              MOVE ASC-KEY-TRIP-ID   TO DP013-MESSAGE-TEXT(2)     06599014
066000              STRING  XL072-SQL-ERROR-PARA                        06600014
066010                      '-'                                         06601014
066020                      XL072-CALL-MOD-FAIL-NM                      06602014
066030                      '-'                                         06603014
066040                      XL072-CALL-MOD-FAIL-ERR-CDE                 06604014
066050                      '-'                                         06605014
066060                      DELIMITED BY SIZE                           06606010
066070                      INTO DP013-MESSAGE-TEXT(3)                  06607010
066080              MOVE XL072-SQLCA  TO DP013-SQLCA                    06608010
066090              MOVE 'SUT BUS EVNT' TO DP013-DB2-TABLE-NAME (1)     06609010
066100              SET DP013-DB2-ABEND                                 06610010
066110                  DP013-XCTL-DISPLAY-RESTART TO TRUE              06611010
066120              PERFORM DP013-0000-PROCESS-ABEND                    06612010
066130*                                                                 06613010
066140     END-EVALUATE.                                                06614010
066150                                                                  06615010
066160*----------------------------------------------------------------*06616010
066170*  UPDATE THE TRIP STATUS                                        *06617010
066180*----------------------------------------------------------------*06618010
066190 5410-UPDATE-TTRIPST.                                             06619010
066200                                                                  06620010
066210     PERFORM                                                      06621010
066220         WITH TEST AFTER                                          06622010
066230         VARYING PV-RETRY-COUNTER                                 06623010
066240         FROM 1 BY 1                                              06624010
066250         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06625010
066260             OR (SQLCODE = +0))                                   06626010
066270                                                                  06627000
066280         EXEC SQL                                                 06628000
066290           UPDATE TTRIPST                                         06629000
066300              SET OPER_UNT_ID   = :TRIPST-OPER-UNT-ID             06630000
066310                 ,FCLTY_ID      = :TRIPST-FCLTY-ID                06631000
066320                 ,FCLTY_AREA_ID = :TRIPST-FCLTY-AREA-ID           06632000
066330           WHERE  TRIP_ID          = :DK-TRIP-ID                  06633000
066340             AND  TRIP_STATUS_CDE ^= 'DE'                         06634000
066350         END-EXEC                                                 06635000
066360                                                                  06636000
066370         EVALUATE TRUE                                            06637000
066380             WHEN SQLCODE = +0                                    06638000
066390             WHEN SQLCODE = -904                                  06639000
066400             WHEN SQLCODE = -913                                  06640000
066410                 CONTINUE                                         06641000
066420                                                                  06642000
066430             WHEN SQLWARN0 NOT = SPACES                           06643000
066440             WHEN SQLCODE < +0                                    06644000
066450             WHEN SQLCODE > +0                                    06645000
066460                 MOVE '5410-UPDATE-TTRIPST'                       06646000
066470                                   TO DP013-PARAGRAPH             06647000
066480                 MOVE 'UPDATE ON TTRIPST'                         06648000
066490                                   TO DP013-MESSAGE-TEXT(1)       06649000
066500                 MOVE DK-TRIP-ID   TO DP013-MESSAGE-TEXT(2)       06650000
066510                 MOVE SQLCA        TO DP013-SQLCA                 06651000
066520                 MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)    06652000
066530                 SET DP013-DB2-ABEND                              06653000
066540                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06654000
066550                 PERFORM DP013-0000-PROCESS-ABEND                 06655000
066560         END-EVALUATE                                             06656000
066570     END-PERFORM.                                                 06657000
066580                                                                  06658000
066590     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06659000
066600             AND (SQLCODE NOT = +0)                               06660000
066610         MOVE '5410-UPDATE-TTRIPST'                               06661000
066620                                   TO DP013-PARAGRAPH             06662000
066630         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              06663000
066640                                   TO DP013-MESSAGE-TEXT (1)      06664000
066650         MOVE 'TO UPDATE A TTRIPST ROW'                           06665000
066660                                   TO DP013-MESSAGE-TEXT (2)      06666000
066670         MOVE SQLCA                TO DP013-SQLCA                 06667000
066680         MOVE 'TTRIPST'            TO DP013-DB2-TABLE-NAME (1)    06668000
066690         SET DP013-DB2-ABEND                                      06669000
066700             DP013-XCTL-DISPLAY-RESTART                           06670000
066710                                   TO TRUE                        06671000
066720         PERFORM DP013-0000-PROCESS-ABEND                         06672000
066730     END-IF.                                                      06673000
066740                                                                  06674000
066750/                                                                 06675000
066760*----------------------------------------------------------------*06676000
066770*  IF THE CURRENT TRIP STATUS IS GREATER THAN 50 (ARRIVED) CHECK *06677000
066780*  TO SEE IF THE TRIP HAS GONE THROUGH THE ARRIVAL PROCESS -- IF *06678000
066790*  NOT, UPDATE THE REC_TMST TO THE CURRENT TIMESTAMP FOR EACH    *06679000
066800*  RECEIVER                                                      *06680000
066810*----------------------------------------------------------------*06681000
066820 5420-CHECK-ARRIVAL.                                              06682000
066830                                                                  06683000
066840     MOVE TRIPST-TRIP-STATUS-CDE  TO  DK-TRIP-STATUS-CDE.         06684000
066850     PERFORM 5120-GET-PRTY-CDE.                                   06685000
066860                                                                  06686000
066870     IF TRSTYP-PRTY-CDE > '50'                                    06687000
066880         PERFORM                                                  06688000
066890             WITH TEST AFTER                                      06689000
066900             VARYING PV-RETRY-COUNTER                             06690000
066910             FROM 1 BY 1                                          06691000
066920             UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)           06692000
066930                 OR (SQLCODE = +100)                              06693000
066940                 OR (SQLCODE = +0))                               06694000
066950                                                                  06695000
066960             EXEC SQL                                             06696000
066970               SELECT TRIP_ID                                     06697000
066980                 INTO :TRIPST-TRIP-ID                             06698000
066990                 FROM TTRIPST                                     06699000
067000               WHERE  TRIP_ID          = :TRIPST-TRIP-ID          06700000
067010                 AND  TRIP_STATUS_CDE  = 'AR'                     06701000
067020             END-EXEC                                             06702000
067030                                                                  06703000
067040             EVALUATE TRUE                                        06704000
067050                 WHEN SQLCODE = +0                                06705000
067060                     SET PS-NO-UPDATE-REC    TO TRUE              06706000
067070                 WHEN SQLCODE = +100                              06707000
067080                     SET PS-UPDATE-REC       TO TRUE              06708000
067090                 WHEN SQLCODE = -904                              06709000
067100                 WHEN SQLCODE = -913                              06710000
067110                     CONTINUE                                     06711000
067120                                                                  06712000
067130                 WHEN SQLWARN0 NOT = SPACES                       06713000
067140                 WHEN SQLCODE < +0                                06714000
067150                 WHEN SQLCODE > +0                                06715000
067160                     MOVE '5420-CHECK-ARRIVAL'                    06716000
067170                                       TO DP013-PARAGRAPH         06717000
067180                     MOVE 'SELECT ON TTRIPST'                     06718000
067190                                       TO DP013-MESSAGE-TEXT(1)   06719000
067200                     MOVE DK-TRIP-ID   TO DP013-MESSAGE-TEXT(2)   06720000
067210                     MOVE SQLCA        TO DP013-SQLCA             06721000
067220                     MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)06722000
067230                     SET DP013-DB2-ABEND                          06723000
067240                         DP013-XCTL-DISPLAY-RESTART TO TRUE       06724000
067250                     PERFORM DP013-0000-PROCESS-ABEND             06725000
067260             END-EVALUATE                                         06726000
067270         END-PERFORM                                              06727000
067280                                                                  06728000
067290         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    06729000
067300             AND (SQLCODE NOT = +0)                               06730000
067310             MOVE '5420-CHECK-ARRIVAL'                            06731000
067320                                       TO DP013-PARAGRAPH         06732000
067330             MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '          06733000
067340                                       TO DP013-MESSAGE-TEXT (1)  06734000
067350             MOVE 'TO SELECT A TTRIPST ROW'                       06735000
067360                                       TO DP013-MESSAGE-TEXT (2)  06736000
067370             MOVE SQLCA                TO DP013-SQLCA             06737000
067380             MOVE 'TTRIPST'            TO DP013-DB2-TABLE-NAME (1)06738000
067390             SET DP013-DB2-ABEND                                  06739000
067400                 DP013-XCTL-DISPLAY-RESTART                       06740000
067410                                       TO TRUE                    06741000
067420             PERFORM DP013-0000-PROCESS-ABEND                     06742000
067430         END-IF                                                   06743000
067440     ELSE                                                         06744000
067450         SET PS-NO-UPDATE-REC          TO TRUE                    06745000
067460     END-IF.                                                      06746000
067470                                                                  06747000
067480 5430-CHK4-STORAGE-TRBL.                                          06748000
067490     PERFORM                                                      06749000
067500         WITH TEST AFTER                                          06750000
067510         VARYING PV-TRBL-RETRY-COUNTER                            06751000
067520         FROM 1 BY 1                                              06752000
067530         UNTIL ((PV-TRBL-RETRY-COUNTER > PC-MAX-RETRIES)          06753000
067540             OR (SQLCODE = +0)                                    06754000
067550             OR (SQLCODE = +100)                                  06755000
067560             OR (PS-TRBL-ACCESS-TRBL-F))                          06756000
067570                                                                  06757000
067580         EXEC SQL                                                 06758000
067590             SELECT OPER_UNT_ID                                   06759000
067600                  , FCLTY_ID                                      06760000
067610                  , PO_NBR                                        06761000
067620                  , REC_SEQ_NBR                                   06762000
067630                  , TRBL_RSN_CDE                                  06763000
067640              INTO  :TRBNTF-OPER-UNT-ID                           06764000
067650                  , :TRBNTF-FCLTY-ID                              06765000
067660                  , :TRBNTF-PO-NBR                                06766000
067670                  , :TRBNTF-REC-SEQ-NBR                           06767000
067680                  , :TRBNTF-TRBL-RSN-CDE                          06768000
067690              FROM  TTRBNTF                                       06769000
067700              WHERE PO_NBR        = :RECEIV-ORD-NBR               06770000
067710                AND REC_SEQ_NBR   = :RECEIV-REC-SEQ-NBR           06771000
067720                AND TRBL_RSN_CDE  IN (:PC-997, :PC-998)           06772000
067730                AND RESOLVED_IND  IN (:PC-I, :PC-N)               06773000
067740         END-EXEC                                                 06774000
067750                                                                  06775000
067760         EVALUATE TRUE                                            06776000
067770             WHEN SQLCODE = +0                                    06777000
067780                 SET PS-NO-TRBL-ACCESS-TRBL TO TRUE               06778000
067790                 PERFORM 5440-CHK-TRBL-RSN                        06779000
067800             WHEN SQLCODE = +100                                  06780000
067810                 SET PS-NO-TRBL-ACCESS-TRBL TO TRUE               06781000
067820             WHEN SQLCODE = -904                                  06782000
067830             WHEN SQLCODE = -913                                  06783000
067840                 SET PS-TRBL-ACCESS-TRBL-W TO TRUE                06784000
067850                 MOVE PC-TSYMSG-01668 TO PV-TRBL-MSG-NO           06785000
067860             WHEN SQLWARN0 NOT = SPACE                            06786000
067870             WHEN SQLCODE < ZERO                                  06787000
067880             WHEN SQLCODE > ZERO                                  06788000
067890                 MOVE '5430-CHK4-STORAGE-TRBL'                    06789000
067900                                      TO DP013-PARAGRAPH          06790000
067910                 MOVE 'SELECT ON TTRBNTF '                        06791000
067920                                      TO DP013-MESSAGE-TEXT(1)    06792000
067930                 MOVE SQLCA                                       06793000
067940                                      TO DP013-SQLCA              06794000
067950                 MOVE 'TTRBNTF'                                   06795000
067960                                 TO DP013-DB2-TABLE-NAME (1)      06796000
067970                 SET  DP013-DB2-ABEND                             06797000
067980                      DP013-NO-ROLLBACK                           06798000
067990                      DP013-LINK-RETURN TO TRUE                   06799000
068000                 PERFORM DP013-0000-PROCESS-ABEND                 06800000
068010                 SET PS-TRBL-ACCESS-TRBL-F TO TRUE                06801000
068020                 MOVE PC-TSYMSG-01669 TO PV-TRBL-MSG-NO           06802000
068030                 SET DP020-MSG-FATAL    TO TRUE                   06803000
068040         END-EVALUATE                                             06804000
068050     END-PERFORM.                                                 06805000
068060                                                                  06806000
068070 5440-CHK-TRBL-RSN.                                               06807000
068080**** TRBL-RSN-CDES 997 OR 998 ARE TO  BE RESOLVED WHEN            06808000
068090**** A TRAILER IS PLACED IN 'ARRIVED' STATUS                      06809000
068100     IF TRBNTF-TRBL-RSN-CDE = 997 OR 998                          06810000
068110         SET TM500-RESOLVE-MANUAL                                 06811000
068120             TM500-PO-LEVEL                                       06812000
068130             TM500-ADD-DETAILS TO TRUE                            06813000
068140         MOVE TRBNTF-OPER-UNT-ID  TO TM500-OPER-UNT-ID            06814000
068150         MOVE TRBNTF-FCLTY-ID     TO TM500-FCLTY-ID               06815000
068160         MOVE TRBNTF-PO-NBR       TO TM500-PO-NBR                 06816000
068170         MOVE TRBNTF-REC-SEQ-NBR  TO TM500-REC-SEQ-NBR            06817000
068180         MOVE TRBNTF-TRBL-RSN-CDE TO TM500-TRBL-RSN-CDE           06818000
068190         MOVE ZERO                TO TM500-PO-LNE-NBR             06819000
068200         MOVE DP020-USERID        TO TM500-RESOLVED-UID           06820000
068210         MOVE PC-RESOLVE-AUTO-MSG TO TM500-FREEFORM-TEXT          06821000
068220         PERFORM 5450-TRBL-UPDATE                                 06822000
068230         IF TM500-CALL-SUCCESSFUL                                 06823000
068240             ADD +1 TO PV-TRBL-RSLV-CT                            06824000
068250         END-IF                                                   06825000
068260     END-IF.                                                      06826000
068270                                                                  06827000
068280**** AFTER A SUCCESSFUL RESOLUTION OF TRBL-RSN-CDE 998,           06828000
068290**** TRBL-RSN-CDE 999 IS CREATED FOR THE 'ARRIVED' TRAILER        06829000
068300**** INDICATING THAT THIS TRAILER STILL HAS STORAGE TROUBLE       06830000
068310     IF TM500-CALL-SUCCESSFUL                                     06831000
068320         IF TRBNTF-TRBL-RSN-CDE = 998                             06832000
068330             SET TM500-CREATE-MANUAL                              06833000
068340                 TM500-PO-LEVEL                                   06834000
068350                 TM500-ADD-DETAILS                                06835000
068360                 PS-TRBL-CREATED-ONSITE TO TRUE                   06836000
068370             MOVE PC-999            TO TM500-TRBL-RSN-CDE         06837000
068380             MOVE DP020-USERID      TO TM500-NOTIF-UID            06838000
068390                                       TM500-CRE-UID              06839000
068400             MOVE TRBNTF-OPER-UNT-ID TO TM500-OPER-UNT-ID         06840000
068410             MOVE TRBNTF-FCLTY-ID    TO TM500-FCLTY-ID            06841000
068420             MOVE TRBNTF-PO-NBR      TO TM500-PO-NBR              06842000
068430             MOVE TRBNTF-PO-LNE-NBR  TO TM500-PO-LNE-NBR          06843000
068440             MOVE TRBNTF-REC-SEQ-NBR TO TM500-REC-SEQ-NBR         06844000
068450             MOVE PC-CREATE-AUTO-MSG TO                           06845000
068460                                     TM500-FREEFORM-TEXT          06846000
068470             PERFORM 5450-TRBL-UPDATE                             06847000
068480         END-IF                                                   06848000
068490     ELSE                                                         06849000
068500         SET PS-TRBL-ACCESS-TRBL-F TO TRUE                        06850000
068510         MOVE PC-TSYMSG-01669 TO PV-TRBL-MSG-NO                   06851000
068520     END-IF.                                                      06852000
068530                                                                  06853000
068540                                                                  06854000
068550 5450-TRBL-UPDATE.                                                06855000
068560     PERFORM 5460-LINK-TO-UPDATE.                                 06856000
068570     IF TM500-CALL-SUCCESSFUL                                     06857000
068580         CONTINUE                                                 06858000
068590     ELSE                                                         06859000
068600         SET PS-TRBL-ACCESS-TRBL-F TO TRUE                        06860000
068610         MOVE PC-TSYMSG-01669 TO PV-TRBL-MSG-NO                   06861000
068620         SET DP020-MSG-FATAL    TO TRUE                           06862000
068630     END-IF.                                                      06863000
068640                                                                  06864000
068650 5460-LINK-TO-UPDATE.                                             06865000
068660     EXEC CICS LINK                                               06866000
068670         PROGRAM  (PC-TMKCS520)                                   06867000
068680         COMMAREA (TM500-FIELDS)                                  06868000
068690         RESP     (PV-CICS-RESPONSE)                              06869000
068700     END-EXEC.                                                    06870000
068710                                                                  06871000
068720     IF PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)                06872000
068730         MOVE 'C'       TO DP013-ABEND-TYPE-IND                   06873000
068740****     DP013-CICS-ABEND                                         06874000
068750         MOVE '4'       TO DP013-ABEND-CONTROL-IND                06875000
068760****     DP013-LINK-RETURN                                        06876000
068770         MOVE 'N'       TO DP013-ROLLBACK-IND                     06877000
068780****     DP013-NO-ROLLBACK                                        06878000
068790         MOVE '5460-LINK-TO-UPDATE' TO  DP013-PARAGRAPH           06879000
068800         MOVE 'ATTEMPTING TO LINK TO CENTRAL PROCESSING'          06880000
068810                                    TO DP013-MESSAGE-TEXT (1)     06881000
068820         PERFORM DP013-0000-PROCESS-ABEND                         06882000
068830     END-IF.                                                      06883000
068840                                                                  06884000
068850/                                                                 06885000
068860*----------------------------------------------------------------*06886000
068870*  INSERT A ROW ON THE VEHICLE SEAL TABLE                        *06887000
068880*----------------------------------------------------------------*06888000
068890 5500-INSERT-TVHSEAL.                                             06889000
068900                                                                  06890000
068910     PERFORM                                                      06891000
068920         WITH TEST AFTER                                          06892000
068930         VARYING PV-RETRY-COUNTER                                 06893000
068940         FROM 1 BY 1                                              06894000
068950         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06895000
068960             OR (SQLCODE = +0))                                   06896000
068970                                                                  06897000
068980         EXEC SQL                                                 06898000
068990             INSERT  INTO TVHSEAL                                 06899000
069000                    (TRIP_ID                                      06900000
069010                    ,SEAL_NBR                                     06901000
069020                    ,LAST_UPD_DTE                                 06902000
069030                    ,LAST_UPD_TME                                 06903000
069040                    ,LAST_UPD_UID                                 06904000
069050                    ,SEAL_COND_CDE                                06905000
069060                    ,INSPECT_DTE                                  06906000
069070                    ,INSPECT_TME                                  06907000
069080                    ,INSPECTOR_NAME)                              06908000
069090            VALUES  (:VHSEAL-TRIP-ID                              06909000
069100                    ,:VHSEAL-SEAL-NBR                             06910000
069110                    ,CURRENT DATE                                 06911000
069120                    ,CURRENT TIME                                 06912000
069130                    ,:DP020-USERID                                06913000
069140                    ,:VHSEAL-SEAL-COND-CDE                        06914000
069150                       :DN-SEAL-COND-CDE                          06915000
069160                    ,:VHSEAL-INSPECT-DTE                          06916000
069170                       :DN-INSPECT-DTE                            06917000
069180                    ,:VHSEAL-INSPECT-TME                          06918000
069190                       :DN-INSPECT-TME                            06919000
069200                    ,:VHSEAL-INSPECTOR-NAME                       06920000
069210                       :DN-INSPECTOR-NAME)                        06921000
069220         END-EXEC                                                 06922000
069230                                                                  06923000
069240         EVALUATE TRUE                                            06924000
069250             WHEN SQLCODE = +0                                    06925000
069260             WHEN SQLCODE = -904                                  06926000
069270             WHEN SQLCODE = -913                                  06927000
069280                 CONTINUE                                         06928000
069290                                                                  06929000
069300             WHEN SQLWARN0 NOT = SPACES                           06930000
069310             WHEN SQLCODE < +0                                    06931000
069320             WHEN SQLCODE > +0                                    06932000
069330                 MOVE '5500-INSERT-TVHSEAL'                       06933000
069340                                   TO DP013-PARAGRAPH             06934000
069350                 MOVE 'INSERT A ROW ON TVHSEAL'                   06935000
069360                                   TO DP013-MESSAGE-TEXT(1)       06936000
069370                 MOVE VHSEAL-TRIP-ID TO DP013-MESSAGE-TEXT(2)     06937000
069380                 MOVE VHSEAL-SEAL-NBR TO DP013-MESSAGE-TEXT(3)    06938000
069390                 MOVE SQLCA        TO DP013-SQLCA                 06939000
069400                 MOVE 'TVHSEAL'    TO DP013-DB2-TABLE-NAME (1)    06940000
069410                 SET DP013-DB2-ABEND                              06941000
069420                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06942000
069430                 PERFORM DP013-0000-PROCESS-ABEND                 06943000
069440         END-EVALUATE                                             06944000
069450     END-PERFORM.                                                 06945000
069460                                                                  06946000
069470     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06947000
069480             AND (SQLCODE NOT = +0)                               06948000
069490         MOVE '5500-INSERT-TVHSEAL'                               06949000
069500                                   TO DP013-PARAGRAPH             06950000
069510         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              06951000
069520                                   TO DP013-MESSAGE-TEXT (1)      06952000
069530         MOVE 'TO INSERT A TVHSEAL ROW'                           06953000
069540                                   TO DP013-MESSAGE-TEXT (2)      06954000
069550         MOVE SQLCA                TO DP013-SQLCA                 06955000
069560         MOVE 'TVHSEAL'            TO DP013-DB2-TABLE-NAME (1)    06956000
069570         SET DP013-DB2-ABEND                                      06957000
069580             DP013-XCTL-DISPLAY-RESTART                           06958000
069590                                   TO TRUE                        06959000
069600         PERFORM DP013-0000-PROCESS-ABEND                         06960000
069610     END-IF.                                                      06961000
069620                                                                  06962000
069630                                                                  06963088
069631*----------------------------------------------------------------*06963188
069632*  RPA MISDIRECT - START E838 (RCKCS838) TO CAPTURE MISDIRECT     06963288
069633*  RECEIVER INFORMATION                                           06963388
069634*----------------------------------------------------------------*06963488
069635 5510-RPA-MISDIRECT.                                              06963588
069636                                                                  06963688
069637     INITIALIZE RC077-UNLOADED-TRLR-COMMAREA.                     06963788
069638                                                                  06963888
069639     MOVE TRIPST-OPER-UNT-ID    TO RC077-OPER-UNT-ID              06963989
069640     MOVE ASC-KEY-OWNER-SCAC-ID TO RC077-SCAC                     06964088
069641     MOVE ASC-KEY-VEH-NBR       TO RC077-VEH-NBR                  06964188
069642     MOVE TRIPST-TRIP-ID        TO RC077-TRIP-ID                  06964289
069643     MOVE 'TRKCS112'            TO RC077-FROM-PROGRAM             06964388
069644                                                                  06964488
069646     EXEC CICS                                                    06964688
069647         START TRANSID(PC-E838-RPAMSD)                            06964788
069648               FROM   (RC077-UNLOADED-TRLR-COMMAREA)              06964888
069649     END-EXEC.                                                    06964988
069650                                                                  06965088
069651                                                                  06965188
069652*----------------------------------------------------------------*06965200
069653* APPLY CHANGES TO A VEHICLE                                     *06965300
069660*----------------------------------------------------------------*06966000
069670 6000-UPDATE-VEHICLE.                                             06967000
069680                                                                  06968000
069690     MOVE ASC-KEY-TRIP-ID          TO DK-TRIP-ID.                 06969000
069700     IF ASC-KEY-OWNER-SCAC-ID = ASC-OWNER-SCAC-ID-OLD AND         06970000
069710        ASC-KEY-VEH-NBR       = ASC-VEH-NBR-OLD       AND         06971000
069720        ASC-VEH-TYP-CDE       = ASC-VEH-TYP-CDE-OLD               06972000
069730         CONTINUE                                                 06973000
069740     ELSE                                                         06974000
069750         SET PS-CHANGE-SCAC-VEHICLE TO TRUE                       06975000
069760         MOVE ASC-OWNER-SCAC-ID-OLD    TO DK-OWNER-SCAC-ID        06976000
069770         MOVE ASC-VEH-NBR-OLD          TO DK-VEH-NBR              06977000
069780         MOVE ASC-KEY-OWNER-SCAC-ID    TO PV-SAVE-OWNER-SCAC-ID   06978000
069790         MOVE ASC-KEY-VEH-NBR          TO PV-SAVE-VEH-NBR         06979000
069800         MOVE ASC-TRIP-STATUS-CDE      TO PV-SAVE-STATUS-CDE      06980000
069810         MOVE ASC-LENGTH              TO PV-SAVE-VEH-SIZE-CDE     06981000
069820         MOVE ASC-CURR-FAC-AREA-ID    TO PV-SAVE-CURR-FAC-AREA-ID 06982000
069830         MOVE ASC-CURR-OPER-UNT-ID    TO PV-SAVE-CURR-OPER-UNT-ID 06983000
069840         MOVE ASC-CURR-FCLTY-ID       TO PV-SAVE-CURR-FCLTY-ID    06984000
069850         PERFORM 4100-SELECT-TVEHICL                              06985000
069860         MOVE 'ET'            TO VEHICL-CURR-STATUS-CDE           06986000
069870         MOVE ZERO            TO VEHICL-CURR-TRIP-ID              06987000
069880         MOVE ASC-VEH-TYP-CDE          TO VEHICL-VEH-TYP-CDE      06988000
069890         PERFORM 6160-UPDATE-TVEHICL                              06989000
069900         PERFORM 8000-AUDIT-TVEHICL                               06990000
069910         MOVE PV-SAVE-OWNER-SCAC-ID    TO DK-OWNER-SCAC-ID        06991000
069920                                          ASC-KEY-OWNER-SCAC-ID   06992000
069930         MOVE PV-SAVE-VEH-NBR          TO DK-VEH-NBR              06993000
069940                                          ASC-VEH-NBR-OLD         06994000
069950         MOVE PV-SAVE-STATUS-CDE       TO VEHICL-CURR-STATUS-CDE  06995000
069960                                          PV-SAVE-CURR-STATUS-CDE 06996000
069970                                          ASC-TRIP-STATUS-CDE     06997000
069980         MOVE VEHICL-USAGE-CDE         TO PV-SAVE-USAGE-CDE       06998000
069990         MOVE VEHICL-CURR-STATUS-DTE   TO PV-SAVE-CURR-STATUS-DTE 06999000
070000         MOVE VEHICL-CURR-STATUS-TME   TO PV-SAVE-CURR-STATUS-TME 07000000
070010         PERFORM 4100-SELECT-TVEHICL                              07001000
070020         IF ASC-VEHICLE-NULL-TRIP                                 07002000
070030             MOVE PV-SAVE-VEH-SIZE-CDE                            07003000
070040                                    TO VEHICL-VEH-SIZE-CDE        07004000
070050                                        ASC-LENGTH                07005000
070060             MOVE PV-SAVE-CURR-FAC-AREA-ID                        07006000
070070                                    TO VEHICL-CURR-FAC-AREA-ID    07007000
070080             MOVE PV-SAVE-CURR-OPER-UNT-ID                        07008000
070090                                    TO VEHICL-CURR-OPER-UNT-ID    07009000
070100             MOVE PV-SAVE-CURR-FCLTY-ID                           07010000
070110                                    TO VEHICL-CURR-FCLTY-ID       07011000
070120             MOVE ASC-KEY-TRIP-ID TO VEHICL-CURR-TRIP-ID          07012000
070130             MOVE +1              TO DN-CURR-TRIP-ID              07013000
070140             MOVE PV-SAVE-USAGE-CDE TO VEHICL-USAGE-CDE           07014000
070150                                       ASC-USAGE-CDE              07015000
070160             MOVE PV-SAVE-CURR-STATUS-CDE                         07016000
070170                                    TO VEHICL-CURR-STATUS-CDE     07017000
070180                                       ASC-TRIP-STATUS-CDE        07018000
070190             MOVE PV-SAVE-CURR-STATUS-DTE                         07019000
070200                                    TO VEHICL-CURR-STATUS-DTE     07020000
070210             MOVE PV-SAVE-CURR-STATUS-TME                         07021000
070220                                    TO VEHICL-CURR-STATUS-TME     07022000
070230             MOVE ASC-VEH-TYP-CDE      TO VEHICL-VEH-TYP-CDE      07023000
070240             PERFORM 6160-UPDATE-TVEHICL                          07024000
070250             SET ASC-VEHICLE-SETUP-PREV TO TRUE                   07025000
070260         ELSE                                                     07026000
070270             MOVE ASC-TRIP-STATUS-CDE                             07027000
070280                                    TO VEHICL-CURR-STATUS-CDE     07028000
070290             MOVE PV-SAVE-USAGE-CDE TO VEHICL-USAGE-CDE           07029000
070300             MOVE ASC-KEY-TRIP-ID   TO VEHICL-CURR-TRIP-ID        07030000
070310             MOVE +1                TO DN-CURR-TRIP-ID            07031000
070320             MOVE 'CE'              TO VEHICL-CRT-SRC-CDE         07032000
070330*                                                                 07033000
070340             PERFORM 5100-INSERT-TVEHICL                          07034000
070350         END-IF                                                   07035000
070360                                                                  07036000
070370         PERFORM 8000-AUDIT-TVEHICL                               07037000
070380                                                                  07038000
070390         PERFORM 8200-SYNCPOINT                                   07039000
070400                                                                  07040000
070410         IF PV-SAVE-OWNER-SCAC-ID NOT = ASC-OWNER-SCAC-ID-OLD     07041000
070420             MOVE ASC-KEY-TRIP-ID   TO DK-TRIP-ID                 07042000
070430             MOVE 'N'               TO PS-SHIPMENT-CURSOR-SW      07043000
070440             PERFORM 6100-OPEN-SHIPMENT-CSR                       07044000
070450             PERFORM 6102-FETCH-SHIPMENT-CSR                      07045000
070460             PERFORM UNTIL PS-NO-MORE-SHIPMENTS                   07046000
070470                 MOVE ASC-KEY-OWNER-SCAC-ID TO SHIPMT-PRO-SCAC-ID 07047000
070480                 PERFORM 7500-UPDATE-TSHIPMT                      07048000
070490                 MOVE ASC-TRIP-STATUS-CDE                         07049000
070500                                 TO SHIPST-SHIPT-STATUS-CDE       07050000
070510                 PERFORM 8300-AUDIT-TSHIPMT                       07051000
070520                 PERFORM 6102-FETCH-SHIPMENT-CSR                  07052000
070530             END-PERFORM                                          07053000
070540             PERFORM 6104-CLOSE-SHIPMENT-CSR                      07054000
070550         END-IF                                                   07055000
070560                                                                  07056000
070570         MOVE PV-SAVE-OWNER-SCAC-ID                               07057000
070580                                   TO ASC-OWNER-SCAC-ID-OLD       07058000
070590                                      ASC-KEY-OWNER-SCAC-ID       07059000
070600         MOVE ASC-VEH-NBR-OLD      TO ASC-KEY-VEH-NBR             07060000
070610                                                                  07061000
070620     END-IF.                                                      07062000
070630                                                                  07063000
070640*IF THE VEHICLE TYPE CODE IS CHANGED FROM ANYTHING BUT 'VS' OR    07064000
070650*'AV' TO 'VS' OR 'AV' CHECK THE SHIPST_CITY_NAME FOR SPACES OR    07065000
070660*LOW VALUES AND MOVE 'PORT OF ENTRY' TO SHIPST_CITY_NAME...SO IT  07066000
070670*DISPLAYS ON POKCS070 OFF POMENU INQUIRY.  IT CAN'T BE PLACED     07067000
070680*IN THE LOWER PART OF THIS PARAGRAPH WHERE SHIPST IS UPDATED AS   07068000
070690*IT ONLY GOES INTO THAT CODE WHEN THE TRIP-STATUS-CDE IS CHANGED  07069000
070700*AND IT'S NOT ALWAYS THE CASE THAT THE VEHICLE TYPE CODE AND TRIP 07070000
070710*STATUS CODE ARE CHANGED TOGETHER.                                07071000
070720     IF ASC-VEH-TYP-CDE = ASC-VEH-TYP-CDE-OLD                     07072000
070730         CONTINUE                                                 07073000
070740     ELSE                                                         07074000
070750         IF ASC-VEH-TYP-CDE = 'AV' OR 'VS'                        07075000
070760             IF ASC-VEH-TYP-CDE-OLD = 'AV' OR 'VS'                07076000
070770                 CONTINUE                                         07077000
070780             ELSE                                                 07078000
070790                 MOVE VEHICL-CURR-TRIP-ID TO DK-TRIP-ID           07079000
070800                 PERFORM 6100-OPEN-SHIPMENT-CSR                   07080000
070810                 PERFORM 6102-FETCH-SHIPMENT-CSR                  07081000
070820                 PERFORM UNTIL PS-NO-MORE-SHIPMENTS               07082000
070830                     MOVE SHIPMT-SHIPT-ID                         07083000
070840                                     TO DK-SHIPT-ID               07084000
070850                     PERFORM 6110-SELECT-TSHIPST                  07085000
070860                     MOVE ASC-TRIP-STATUS-CDE                     07086000
070870                                     TO SHIPST-SHIPT-STATUS-CDE   07087000
070880                     IF SHIPST-CITY-NAME = SPACES OR LOW-VALUES   07088000
070890                         MOVE 'PORT OF ENTRY'                     07089000
070900                                 TO SHIPST-CITY-NAME              07090000
070910                     END-IF                                       07091000
070920                     PERFORM 6115-UPDATE-SHIPST                   07092000
070930                     PERFORM 6102-FETCH-SHIPMENT-CSR              07093000
070940                 END-PERFORM                                      07094000
070950                 PERFORM 6104-CLOSE-SHIPMENT-CSR                  07095000
070960             END-IF                                               07096000
070970         END-IF                                                   07097000
070980     END-IF.                                                      07098000
070990***************************************************************   07099000
071000                                                                  07100000
071010     MOVE ASC-OWNER-SCAC-ID-OLD    TO DK-OWNER-SCAC-ID.           07101000
071020     MOVE ASC-VEH-NBR-OLD          TO DK-VEH-NBR.                 07102000
071030     MOVE ASC-KEY-TRIP-ID          TO DK-TRIP-ID.                 07103000
071040     MOVE ASC-PLND-TRIP-SEQ        TO DK-PLND-TRIP-SEQ.           07104000
071050                                                                  07105000
071060     IF  ASC-VEHICLE-ARRIVED                                      07106000
071070     OR  ASC-VEHICLE-BEG-UNLD                                     07107000
071080     OR  ASC-VEHICLE-DEPARTED                                     07108000
071090     OR  ASC-VEHICLE-LOADED                                       07109000
071100     OR  ASC-VEHICLE-UNLD                                         07110000
071110         CONTINUE                                                 07111000
071120     ELSE                                                         07112000
071130         IF  ASC-CURR-SUBAREA-OF-ID = ASC-CURR-SUBAREA-OF-ID-OLD  07113000
071140         AND ASC-CURR-OPER-UNT-ID   = ASC-CURR-OPER-UNT-ID-OLD    07114000
071150         AND ASC-CURR-FCLTY-ID      = ASC-CURR-FCLTY-ID-OLD       07115000
071160         AND ASC-USAGE-CDE          = ASC-USAGE-CDE-OLD           07116000
071170         AND ASC-LENGTH             = ASC-LENGTH-OLD              07117000
071180             CONTINUE                                             07118000
071190         ELSE                                                     07119000
071200             MOVE ASC-TRIP-STATUS-CDE                             07120000
071210                                 TO VEHICL-CURR-STATUS-CDE        07121000
071220             MOVE ASC-CURR-SUBAREA-OF-ID                          07122000
071230                                 TO VEHICL-CURR-FAC-AREA-ID       07123000
071240             MOVE ASC-CURR-OPER-UNT-ID                            07124000
071250                                 TO VEHICL-CURR-OPER-UNT-ID       07125000
071260             MOVE ASC-CURR-FCLTY-ID                               07126000
071270                                 TO VEHICL-CURR-FCLTY-ID          07127000
071280             MOVE ASC-KEY-TRIP-ID                                 07128000
071290                                 TO VEHICL-CURR-TRIP-ID           07129000
071300             MOVE ASC-USAGE-CDE  TO VEHICL-USAGE-CDE              07130000
071310             MOVE ASC-LENGTH     TO VEHICL-VEH-SIZE-CDE           07131000
071320             MOVE ASC-CURR-STATUS-DTE                             07132000
071330                                 TO VEHICL-CURR-STATUS-DTE        07133000
071340             MOVE ASC-CURR-STATUS-TME                             07134000
071350                                 TO VEHICL-CURR-STATUS-TME        07135000
071360             PERFORM 4005-GET-STORE-TYPE                          07136000
071370             EVALUATE XLT00010-LOC-TYP-CDE                        07137001
071380             WHEN 'DC'                                            07138000
071390             WHEN 'DS'                                            07139000
071400                 MOVE 'TR'                TO ASC-VEH-TYP-CDE      07140000
071410                                             ATRIPTPO             07141000
071420                 IF ASC-CURR-OPER-UNT-ID-N = 90                   07142000
071430                     MOVE DP015-UNP-ALP-NOR-OFF                   07143000
071440                                          TO ATRIPTPA             07144000
071450                     MOVE DP015-GREEN TO ATRIPTPC                 07145000
071460                     MOVE DP015-UNDERLINE TO ATRIPTPH             07146000
071470                 ELSE                                             07147000
071480                     MOVE DP015-PRO-NOR-OFF TO ATRIPTPA           07148000
071490                     MOVE DP015-BLUE      TO ATRIPTPC             07149000
071500                 END-IF                                           07150000
071510     WHEN 'HQ'                                                    07151000
071520         IF ASC-VEH-TYP-CDE = SPACES OR LOW-VALUES                07152000
071530             MOVE 'VS'           TO ASC-VEH-TYP-CDE               07153000
071540                                    ATRIPTPO                      07154000
071550         END-IF                                                   07155000
071560         MOVE DP015-UNP-ALP-NOR-OFF                               07156000
071570                                 TO ATRIPTPA                      07157000
071580         MOVE DP015-GREEN        TO ATRIPTPC                      07158000
071590         MOVE DP015-UNDERLINE    TO ATRIPTPH                      07159000
071600     WHEN OTHER                                                   07160000
071610*        MOVE SPACES             TO ASC-VEH-TYP-CDE               07161000
071620*                                   ATRIPTPO                      07162000
071630         MOVE DP015-UNP-ALP-NOR-OFF                               07163000
071640                                 TO ATRIPTPA                      07164000
071650         MOVE DP015-GREEN        TO ATRIPTPC                      07165000
071660         MOVE DP015-UNDERLINE    TO ATRIPTPH                      07166000
071670     END-EVALUATE                                                 07167000
071680                                                                  07168000
071690     IF ASC-VEH-TYP-CDE = 'TR' OR 'VS' OR 'AV'                    07169000
071700             MOVE ASC-VEH-TYP-CDE        TO VEHICL-VEH-TYP-CDE    07170000
071710                                                                  07171000
071720             PERFORM 6160-UPDATE-TVEHICL                          07172000
071730             PERFORM 8000-AUDIT-TVEHICL                           07173000
071740*        CONTINUE                                                 07174000
071750     ELSE                                                         07175000
071760         SET PS-ERROR                                             07176000
071770             DP020-MSG-FATAL     TO TRUE                          07177000
071780         MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER              07178000
071790         MOVE DP015-UNP-ALP-BRT-OFF                               07179000
071800                                 TO ATRIPTPA                      07180000
071810         MOVE DP015-RED          TO ATRIPTPC                      07181000
071820         MOVE DP015-REVERSE      TO ATRIPTPH                      07182000
071830         MOVE -1                 TO ATRIPTPL                      07183000
071840         SET DP030-SET-CURSOR-APPL-1                              07184000
071850                                 TO TRUE                          07185000
071860     END-IF                                                       07186000
071870                                                                  07187000
071880         END-IF                                                   07188000
071890         IF (ASC-DEST-SUBAREA-OF-ID = ASC-DEST-SUBAREA-OF-ID-OLD  07189000
071900         AND ASC-DEST-OPER-UNT-ID   = ASC-DEST-OPER-UNT-ID-OLD    07190000
071910         AND ASC-DEST-FCLTY-ID      = ASC-DEST-FCLTY-ID-OLD)      07191000
071920         OR  ASC-VEHICLE-NULL-TRIP                                07192000
071930             CONTINUE                                             07193000
071940         ELSE                                                     07194000
071950             MOVE ASC-DEST-OPER-UNT-ID                            07195000
071960                                 TO TRIPST-OPER-UNT-ID            07196000
071970             MOVE ASC-DEST-FCLTY-ID                               07197000
071980                                 TO TRIPST-FCLTY-ID               07198000
071990             MOVE ASC-DEST-SUBAREA-OF-ID                          07199000
072000                                 TO TRIPST-FCLTY-AREA-ID          07200000
072010             PERFORM 5410-UPDATE-TTRIPST                          07201000
072020         END-IF                                                   07202000
072030         IF  ASC-TRIP-STATUS-CDE = ASC-TRIP-STATUS-CDE-OLD        07203000
072040         OR  ASC-VEHICLE-NULL-TRIP                                07204000
072050             CONTINUE                                             07205000
072060         ELSE                                                     07206000
072070             PERFORM 6150-SELECT-TTRIPST                          07207000
072080             MOVE ASC-TRIP-STATUS-CDE                             07208000
072090                                 TO TRIPST-TRIP-STATUS-CDE        07209000
072100             PERFORM 5400-INSERT-TTRIPST                          07210000
072110         END-IF                                                   07211000
072120     END-IF.                                                      07212000
072130                                                                  07213000
072140     IF (ASC-VEHICLE-ARRIVED                                      07214000
072150     OR  ASC-VEHICLE-UNLD)                                        07215000
072160         IF ASC-VEHICLE-SETUP-PREV                                07216000
072170             PERFORM 6150-SELECT-TTRIPST                          07217000
072180             MOVE ASC-TRIP-STATUS-CDE                             07218000
072190                                     TO TRIPST-TRIP-STATUS-CDE    07219000
072200             MOVE ASC-DEST-OPER-UNT-ID                            07220000
072210                                     TO TRIPST-OPER-UNT-ID        07221000
072220                                        KRPRPM-LOC-ID             07222021
072230             MOVE ASC-DEST-FCLTY-ID  TO TRIPST-FCLTY-ID           07223000
072240             MOVE ASC-DEST-SUBAREA-OF-ID                          07224000
072250                                     TO TRIPST-FCLTY-AREA-ID      07225000
072260             PERFORM 5400-INSERT-TTRIPST                          07226000
072270*************CALL TO XLKUP003 FOR LABOR IF ''AR''***************  07227012
072280             IF TRIPST-TRIP-STATUS-CDE = 'AR' AND                 07228014
072290                ASC-KEY-VEH-NBR > SPACES                          07229014
072300                  PERFORM 5403-CHECK-DC-PLANNING-PARM             07230014
072310                  IF PS-DC-PLANNING-YES                           07231014
072320                     PERFORM 5405-CALL-XLKUP033-EAI               07232014
072330                  END-IF                                          07233014
072340             END-IF                                               07234014
072350         END-IF                                                   07235000
072360         MOVE ASC-TRIP-STATUS-CDE                                 07236000
072370                                 TO VEHICL-CURR-STATUS-CDE        07237000
072380         MOVE ASC-CURR-SUBAREA-OF-ID                              07238000
072390                                 TO VEHICL-CURR-FAC-AREA-ID       07239000
072400         MOVE ASC-CURR-OPER-UNT-ID                                07240000
072410                                 TO VEHICL-CURR-OPER-UNT-ID       07241000
072420         MOVE ASC-KEY-TRIP-ID    TO VEHICL-CURR-TRIP-ID           07242000
072430         MOVE ASC-CURR-FCLTY-ID  TO VEHICL-CURR-FCLTY-ID          07243000
072440         MOVE ASC-USAGE-CDE      TO VEHICL-USAGE-CDE              07244000
072450         MOVE ASC-LENGTH         TO VEHICL-VEH-SIZE-CDE           07245000
072460         MOVE SPACES             TO VEHICL-CURR-STATUS-DTE        07246000
072470         MOVE SPACES             TO VEHICL-CURR-STATUS-TME        07247000
072480         MOVE ASC-VEH-TYP-CDE          TO VEHICL-VEH-TYP-CDE      07248000
072490         PERFORM 6160-UPDATE-TVEHICL                              07249000
072500         PERFORM 8000-AUDIT-TVEHICL                               07250000
072510         MOVE 'N'                TO PS-SEAL-CURSOR-SW             07251000
072520         PERFORM 4330-OPEN-SEAL-CSR                               07252000
072530         PERFORM 4340-FETCH-SEAL-CSR                              07253000
072540         IF  SQLCODE = +0                                         07254000
072550             MOVE VHSEAL-SEAL-NBR TO ASC-SEAL-1                   07255000
072560             PERFORM 4340-FETCH-SEAL-CSR                          07256000
072570             IF  SQLCODE = +0                                     07257000
072580                 MOVE VHSEAL-SEAL-NBR                             07258000
072590                                 TO ASC-SEAL-2                    07259000
072600             END-IF                                               07260000
072610         END-IF                                                   07261000
072620         PERFORM 4350-CLOSE-SEAL-CSR                              07262000
072630         MOVE ASC-KEY-TRIP-ID    TO DK-TRIP-ID                    07263000
072640         MOVE 'N'                TO PS-SHIPMENT-CURSOR-SW         07264000
072650         PERFORM 6100-OPEN-SHIPMENT-CSR                           07265000
072660         PERFORM 6102-FETCH-SHIPMENT-CSR                          07266000
072670         PERFORM UNTIL PS-NO-MORE-SHIPMENTS                       07267000
072680             MOVE SHIPMT-SHIPT-ID                                 07268000
072690                                 TO DK-SHIPT-ID                   07269000
072700             PERFORM 6110-SELECT-TSHIPST                          07270000
072710             MOVE ASC-TRIP-STATUS-CDE                             07271000
072720                                 TO SHIPST-SHIPT-STATUS-CDE       07272000
072730             PERFORM 6120-INSERT-TSHIPST                          07273000
072740             PERFORM 6102-FETCH-SHIPMENT-CSR                      07274000
072750         END-PERFORM                                              07275000
072760         PERFORM 6104-CLOSE-SHIPMENT-CSR                          07276000
072770     END-IF.                                                      07277000
072780                                                                  07278000
072790     IF  ASC-VEHICLE-DEPARTED                                     07279000
072800         PERFORM 6130-GET-NEXT-TRIP                               07280000
072810         IF  SQLCODE = +0                                         07281000
072820             SET PS-MORE-STOPS-SCHEDULED TO TRUE                  07282000
072830             MOVE VHTRIP-TRIP-ID  TO PV-NEXT-TRIP-ID              07283000
072840             PERFORM 6150-SELECT-TTRIPST                          07284000
072850             MOVE 'DP'           TO TRIPST-TRIP-STATUS-CDE        07285000
072860             PERFORM 5400-INSERT-TTRIPST                          07286000
072870             PERFORM 6150-SELECT-TTRIPST                          07287000
072880             MOVE 'ET'           TO TRIPST-TRIP-STATUS-CDE        07288000
072890             PERFORM 5400-INSERT-TTRIPST                          07289000
072900             MOVE PV-NEXT-TRIP-ID TO DK-TRIP-ID                   07290000
072910             MOVE PV-NEXT-TRIP-ID TO VEHICL-CURR-TRIP-ID          07291000
072920             MOVE +1              TO DN-CURR-TRIP-ID              07292000
072930             PERFORM 5110-UPDATE-CURR-TRIP-ID                     07293000
072940             PERFORM 8000-AUDIT-TVEHICL                           07294000
072950             MOVE 'EN'           TO VEHICL-CURR-STATUS-CDE        07295000
072960             IF  ASC-TRIP-STATUS-CDE = 'DP'                       07296000
072970                 MOVE SPACES                                      07297000
072980                                 TO VEHICL-CURR-FAC-AREA-ID       07298000
072990             END-IF                                               07299000
073000             MOVE ASC-DEST-OPER-UNT-ID                            07300000
073010                                 TO VEHICL-CURR-OPER-UNT-ID       07301000
073020             MOVE ASC-DEST-FCLTY-ID                               07302000
073030                                 TO VEHICL-CURR-FCLTY-ID          07303000
073040             MOVE ASC-KEY-TRIP-ID                                 07304000
073050                                 TO VEHICL-CURR-TRIP-ID           07305000
073060             MOVE ASC-USAGE-CDE  TO VEHICL-USAGE-CDE              07306000
073070             MOVE ASC-LENGTH     TO VEHICL-VEH-SIZE-CDE           07307000
073080             MOVE SPACES         TO VEHICL-CURR-STATUS-DTE        07308000
073090             MOVE SPACES         TO VEHICL-CURR-STATUS-TME        07309000
073100             MOVE ASC-VEH-TYP-CDE      TO VEHICL-VEH-TYP-CDE      07310000
073110             PERFORM 6160-UPDATE-TVEHICL                          07311000
073120             PERFORM 8000-AUDIT-TVEHICL                           07312000
073130             MOVE 'N'            TO PS-SHIPMENT-CURSOR-SW         07313000
073140             PERFORM 6100-OPEN-SHIPMENT-CSR                       07314000
073150             PERFORM 6102-FETCH-SHIPMENT-CSR                      07315000
073160             PERFORM UNTIL PS-NO-MORE-SHIPMENTS                   07316000
073170                 MOVE SHIPMT-SHIPT-ID                             07317000
073180                                 TO DK-SHIPT-ID                   07318000
073190                 PERFORM 6110-SELECT-TSHIPST                      07319000
073200                 MOVE ASC-TRIP-STATUS-CDE                         07320000
073210                                 TO SHIPST-SHIPT-STATUS-CDE       07321000
073220                 PERFORM 6120-INSERT-TSHIPST                      07322000
073230                 PERFORM 6110-SELECT-TSHIPST                      07323000
073240                 MOVE 'ET'       TO SHIPST-SHIPT-STATUS-CDE       07324000
073250                 PERFORM 6120-INSERT-TSHIPST                      07325000
073530                 PERFORM 6102-FETCH-SHIPMENT-CSR                  07353000
073540             END-PERFORM                                          07354000
073550             PERFORM 6104-CLOSE-SHIPMENT-CSR                      07355000
073560         ELSE                                                     07356000
073570             PERFORM 6150-SELECT-TTRIPST                          07357000
073580             MOVE 'DP'           TO TRIPST-TRIP-STATUS-CDE        07358000
073590             MOVE ASC-DEST-OPER-UNT-ID                            07359000
073600                                 TO TRIPST-OPER-UNT-ID            07360000
073610             MOVE ASC-DEST-FCLTY-ID                               07361000
073620                                 TO TRIPST-FCLTY-ID               07362000
073630             PERFORM 5400-INSERT-TTRIPST                          07363000
073640             PERFORM 6150-SELECT-TTRIPST                          07364000
073650             MOVE 'ET'           TO TRIPST-TRIP-STATUS-CDE        07365000
073660             PERFORM 5400-INSERT-TTRIPST                          07366000
073670             MOVE 'N'                TO PS-SHIPMENT-CURSOR-SW     07367000
073680             MOVE TRIPST-TRIP-ID TO DK-TRIP-ID                    07368000
073690             PERFORM 6100-OPEN-SHIPMENT-CSR                       07369000
073700             PERFORM 6102-FETCH-SHIPMENT-CSR                      07370000
073710             PERFORM UNTIL PS-NO-MORE-SHIPMENTS                   07371000
073720                 MOVE SHIPMT-SHIPT-ID                             07372000
073730                                 TO DK-SHIPT-ID                   07373000
073740                 PERFORM 6110-SELECT-TSHIPST                      07374000
073750                 MOVE ASC-TRIP-STATUS-CDE                         07375000
073760                                 TO SHIPST-SHIPT-STATUS-CDE       07376000
073770                 PERFORM 6120-INSERT-TSHIPST                      07377000
073780                 PERFORM 6110-SELECT-TSHIPST                      07378000
073790                 MOVE 'ET'       TO SHIPST-SHIPT-STATUS-CDE       07379000
073800                 PERFORM 6120-INSERT-TSHIPST                      07380000
073810                 PERFORM 6102-FETCH-SHIPMENT-CSR                  07381000
073820             END-PERFORM                                          07382000
073830             PERFORM 6104-CLOSE-SHIPMENT-CSR                      07383000
073840             PERFORM 7100-DELETE-ALL-TRIP-STOPS                   07384000
073850             MOVE ASC-TRIP-STATUS-CDE                             07385000
073860                                 TO VEHICL-CURR-STATUS-CDE        07386000
073870             MOVE ASC-CURR-SUBAREA-OF-ID                          07387000
073880                                 TO VEHICL-CURR-FAC-AREA-ID       07388000
073890             MOVE ASC-CURR-OPER-UNT-ID                            07389000
073900                                 TO VEHICL-CURR-OPER-UNT-ID       07390000
073910             MOVE ASC-KEY-TRIP-ID                                 07391000
073920                                 TO VEHICL-CURR-TRIP-ID           07392000
073930             MOVE ASC-CURR-FCLTY-ID                               07393000
073940                                 TO VEHICL-CURR-FCLTY-ID          07394000
073950             MOVE ASC-USAGE-CDE  TO VEHICL-USAGE-CDE              07395000
073960             MOVE ASC-LENGTH     TO VEHICL-VEH-SIZE-CDE           07396000
073970             MOVE SPACES         TO VEHICL-CURR-STATUS-DTE        07397000
073980             MOVE SPACES         TO VEHICL-CURR-STATUS-TME        07398000
073990             MOVE ASC-VEH-TYP-CDE      TO VEHICL-VEH-TYP-CDE      07399000
074000             PERFORM 6160-UPDATE-TVEHICL                          07400000
074010             PERFORM 8000-AUDIT-TVEHICL                           07401000
074020             MOVE 'ET'           TO VEHICL-CURR-STATUS-CDE        07402000
074030             IF  ASC-TRIP-STATUS-CDE = 'DP'                       07403000
074040                 MOVE SPACES     TO VEHICL-CURR-FAC-AREA-ID       07404000
074050                                    ASC-CURR-FAC-AREA-ID          07405000
074060                                    ASC-CURR-FAC-AREA-ID-DESC     07406000
074070                                    ASC-CURR-SUBAREA-OF-ID        07407000
074080                                    ASC-CURR-SUBAREA-OF-ID-DESC   07408000
074090             END-IF                                               07409000
074100             MOVE ASC-CURR-OPER-UNT-ID                            07410000
074110                                 TO VEHICL-CURR-OPER-UNT-ID       07411000
074120             MOVE ASC-CURR-FCLTY-ID                               07412000
074130                                 TO VEHICL-CURR-FCLTY-ID          07413000
074140             MOVE ZERO           TO VEHICL-CURR-TRIP-ID           07414000
074150             MOVE SPACES         TO VEHICL-USAGE-CDE              07415000
074160             MOVE ASC-LENGTH     TO VEHICL-VEH-SIZE-CDE           07416000
074170             MOVE SPACES         TO VEHICL-CURR-STATUS-DTE        07417000
074180             MOVE SPACES         TO VEHICL-CURR-STATUS-TME        07418000
074190             MOVE ASC-VEH-TYP-CDE      TO VEHICL-VEH-TYP-CDE      07419000
074200             PERFORM 6160-UPDATE-TVEHICL                          07420000
074210             PERFORM 8000-AUDIT-TVEHICL                           07421000
074220         END-IF                                                   07422000
074230     END-IF.                                                      07423000
074240                                                                  07424000
074250     IF  ASC-VEHICLE-LOADED                                       07425000
074260     OR  ASC-VEHICLE-BEG-UNLD                                     07426000
074270     OR  ASC-VEHICLE-BEG-LOAD                                     07427000
074280     OR  ASC-VEHICLE-ENROUTE                                      07428000
074290         IF  ASC-VEHICLE-SETUP-PREV                               07429000
074300             PERFORM 6150-SELECT-TTRIPST                          07430000
074310             IF ASC-TRIP-STATUS-CDE NOT = TRIPST-TRIP-STATUS-CDE  07431000
074320                 MOVE ASC-TRIP-STATUS-CDE                         07432000
074330                                         TO TRIPST-TRIP-STATUS-CDE07433000
074340                 MOVE ASC-DEST-OPER-UNT-ID                        07434000
074350                                         TO TRIPST-OPER-UNT-ID    07435000
074360                 MOVE ASC-DEST-FCLTY-ID  TO TRIPST-FCLTY-ID       07436000
074370                 PERFORM 5400-INSERT-TTRIPST                      07437000
074380                 MOVE 'N'                TO PS-SHIPMENT-CURSOR-SW 07438000
074390                 MOVE TRIPST-TRIP-ID TO DK-TRIP-ID                07439000
074400                 PERFORM 6100-OPEN-SHIPMENT-CSR                   07440000
074410                 PERFORM 6102-FETCH-SHIPMENT-CSR                  07441000
074420                 PERFORM UNTIL PS-NO-MORE-SHIPMENTS               07442000
074430                     MOVE SHIPMT-SHIPT-ID                         07443000
074440                                     TO DK-SHIPT-ID               07444000
074450                     PERFORM 6110-SELECT-TSHIPST                  07445000
074460                     MOVE ASC-TRIP-STATUS-CDE                     07446000
074470                                     TO SHIPST-SHIPT-STATUS-CDE   07447000
074480                     PERFORM 6120-INSERT-TSHIPST                  07448000
074490                     PERFORM 6102-FETCH-SHIPMENT-CSR              07449000
074500                 END-PERFORM                                      07450000
074510                 PERFORM 6104-CLOSE-SHIPMENT-CSR                  07451000
074520                 MOVE SPACES             TO VEHICL-CURR-STATUS-DTE07452000
074530                 MOVE SPACES             TO VEHICL-CURR-STATUS-TME07453000
074540             ELSE                                                 07454000
074550                 MOVE ASC-CURR-STATUS-DTE                         07455000
074560                                         TO VEHICL-CURR-STATUS-DTE07456000
074570                 MOVE ASC-CURR-STATUS-TME                         07457000
074580                                         TO VEHICL-CURR-STATUS-TME07458000
074590             END-IF                                               07459000
074600         ELSE                                                     07460000
074610             MOVE ASC-CURR-STATUS-DTE                             07461000
074620                                     TO VEHICL-CURR-STATUS-DTE    07462000
074630             MOVE ASC-CURR-STATUS-TME                             07463000
074640                                     TO VEHICL-CURR-STATUS-TME    07464000
074650         END-IF                                                   07465000
074660         MOVE ASC-TRIP-STATUS-CDE                                 07466000
074670                                 TO VEHICL-CURR-STATUS-CDE        07467000
074680         MOVE ASC-CURR-SUBAREA-OF-ID                              07468000
074690                                 TO VEHICL-CURR-FAC-AREA-ID       07469000
074700         MOVE ASC-CURR-OPER-UNT-ID                                07470000
074710                                 TO VEHICL-CURR-OPER-UNT-ID       07471000
074720         MOVE ASC-KEY-TRIP-ID    TO VEHICL-CURR-TRIP-ID           07472000
074730         MOVE ASC-CURR-FCLTY-ID  TO VEHICL-CURR-FCLTY-ID          07473000
074740         MOVE ASC-USAGE-CDE      TO VEHICL-USAGE-CDE              07474000
074750         MOVE ASC-LENGTH         TO VEHICL-VEH-SIZE-CDE           07475000
074760         MOVE ASC-VEH-TYP-CDE          TO VEHICL-VEH-TYP-CDE      07476000
074770         PERFORM 6160-UPDATE-TVEHICL                              07477000
074780         PERFORM 8000-AUDIT-TVEHICL                               07478000
074790     END-IF.                                                      07479000
074800                                                                  07480000
074810     MOVE ASC-KEY-TRIP-ID        TO DK-TRIP-ID.                   07481000
074820                                                                  07482000
074830     IF  ASC-VEHICLE-NULL-TRIP AND                                07483000
074840         PS-DONT-CHANGE-SCAC-VEHICLE                              07484000
074850         CONTINUE                                                 07485000
074860     ELSE                                                         07486000
074870         IF ASC-MANIFEST-NBR NOT = ASC-MANIFEST-NBR-OLD OR        07487000
074880            ASC-ETA-DTE NOT = ASC-ETA-DTE-OLD OR                  07488000
074890            ASC-ETA-TIME NOT =  ASC-ETA-TIME-OLD OR               07489000
074900            ASC-OWNR-SCAC-SHP-DTE NOT = ASC-OWNR-SHP-DTE-OLD OR   07490000
074910            PS-CHANGE-SCAC-VEHICLE                                07491000
074920             MOVE ASC-MANIFEST-NBR   TO VHTRIP-MANIFEST-NBR       07492000
074930             IF ASC-OWNR-SCAC-SHP-DTE = SPACES                    07493000
074940                 MOVE '0001-01-01' TO VHTRIP-OWNR-SCAC-SHIP-DTE   07494000
074950             ELSE                                                 07495000
074960                 MOVE ASC-OWNR-SCAC-SHP-DTE                       07496000
074970                                     TO VHTRIP-OWNR-SCAC-SHIP-DTE 07497000
074980             END-IF                                               07498000
074990             IF ASC-ETA-DTE = SPACES AND                          07499000
075000                ASC-ETA-TIME = SPACES                             07500000
075010                 MOVE -1       TO DN-EST-AR-TMST                  07501000
075020             ELSE                                                 07502000
075030                 STRING  ASC-ETA-DTE-CC                           07503000
075040                         ASC-ETA-DTE-YY                           07504000
075050                         '-'                                      07505000
075060                         ASC-ETA-DTE-MM                           07506000
075070                         '-'                                      07507000
075080                         ASC-ETA-DTE-DD                           07508000
075090                         '-'                                      07509000
075100                         ASC-ETA-TIME-HH                          07510000
075110                         '.'                                      07511000
075120                         ASC-ETA-TIME-MM                          07512000
075130                         '.00.000000'                             07513000
075140                         DELIMITED BY SIZE                        07514000
075150                         INTO VHTRIP-EST-AR-TMST                  07515000
075160                 MOVE +1       TO DN-EST-AR-TMST                  07516000
075170             END-IF                                               07517000
075180             MOVE ASC-REF-TRIP-ID TO VHTRIP-REF-TRIP-ID           07518000
075190             PERFORM 6170-UPDATE-TVHTRIP                          07519000
075200             MOVE VEHICL-CURR-STATUS-CDE TO TRIPST-TRIP-STATUS-CDE07520000
075210             PERFORM 8100-AUDIT-TVHTRIP                           07521000
075220         END-IF                                                   07522000
075230     END-IF.                                                      07523000
075240                                                                  07524000
075250     IF  ASC-SEAL-1 = ASC-SEAL-1-OLD                              07525000
075260         CONTINUE                                                 07526000
075270     ELSE                                                         07527000
075280         MOVE DK-TRIP-ID     TO VHSEAL-TRIP-ID                    07528000
075290         MOVE ASC-SEAL-1     TO VHSEAL-SEAL-NBR                   07529000
075300         MOVE -1             TO DN-SEAL-COND-CDE                  07530000
075310                                DN-INSPECT-DTE                    07531000
075320                                DN-INSPECT-TME                    07532000
075330                                DN-INSPECTOR-NAME                 07533000
075340         PERFORM 5500-INSERT-TVHSEAL                              07534000
075350     END-IF.                                                      07535000
075360                                                                  07536000
075370*    IF  ASC-SEAL-2 = ASC-SEAL-2-OLD                              07537000
075380*        CONTINUE                                                 07538000
075390*    ELSE                                                         07539000
075400*        IF  ASC-SEAL-2-OLD = SPACES                              07540000
075410*        AND ASC-SEAL-2     > SPACES                              07541000
075420*            MOVE DK-TRIP-ID     TO VHSEAL-TRIP-ID                07542000
075430*            MOVE ASC-SEAL-2     TO VHSEAL-SEAL-NBR               07543000
075440*            MOVE -1             TO DN-SEAL-COND-CDE              07544000
075450*                                   DN-INSPECT-DTE                07545000
075460*                                   DN-INSPECT-TME                07546000
075470*                                   DN-INSPECTOR-NAME             07547000
075480*            PERFORM 5500-INSERT-TVHSEAL                          07548000
075490*        ELSE                                                     07549000
075500*            IF  ASC-SEAL-2-OLD > SPACES                          07550000
075510*            AND ASC-SEAL-2     = SPACES                          07551000
075520*                MOVE ASC-SEAL-2-OLD                              07552000
075530*                                TO DK-SEAL-NBR                   07553000
075540*                PERFORM 6180-DELETE-TVHSEAL                      07554000
075550*            ELSE                                                 07555000
075560*                MOVE ASC-SEAL-2-OLD                              07556000
075570*                                TO DK-SEAL-NBR                   07557000
075580*                PERFORM 6180-DELETE-TVHSEAL                      07558000
075590*                MOVE DK-TRIP-ID TO VHSEAL-TRIP-ID                07559000
075600*                MOVE ASC-SEAL-2 TO VHSEAL-SEAL-NBR               07560000
075610*                MOVE -1         TO DN-SEAL-COND-CDE              07561000
075620*                                   DN-INSPECT-DTE                07562000
075630*                                   DN-INSPECT-TME                07563000
075640*                                   DN-INSPECTOR-NAME             07564000
075650*                PERFORM 5500-INSERT-TVHSEAL                      07565000
075660*            END-IF                                               07566000
075670*        END-IF                                                   07567000
075680*    END-IF.                                                      07568000
075690                                                                  07569000
075700     IF ASC-CURR-OPER-UNT-ID NOT = ASC-CURR-OPER-UNT-ID-OLD       07570000
075710     OR ASC-CURR-FCLTY-ID NOT = ASC-CURR-FCLTY-ID-OLD             07571000
075720         MOVE ASC-KEY-TRIP-ID   TO DK-TRIP-ID                     07572000
075730         MOVE 'N'               TO PS-NO-MORE-RECEIVRS-SW         07573000
075740         PERFORM 6200-OPEN-RECEIVR-CSR                            07574000
075750         PERFORM 6210-FETCH-RECEIVR-CSR                           07575000
075760         PERFORM UNTIL PS-NO-MORE-RECEIVRS                        07576000
075770             PERFORM 6400-UPDATE-RECEIV-OPER                      07577000
075780             PERFORM 6210-FETCH-RECEIVR-CSR                       07578000
075790         END-PERFORM                                              07579000
075800         PERFORM 6220-CLOSE-RECEIVR-CSR                           07580000
075810         MOVE 'N'               TO PS-NO-MORE-TRIPST-SW           07581000
075820         PERFORM 6500-OPEN-TRIPST-CSR                             07582000
075830         PERFORM 6600-FETCH-TRIPST-CSR                            07583000
075840         PERFORM UNTIL PS-NO-MORE-TRIPST                          07584000
075850             PERFORM 6800-UPDATE-TRIPST                           07585000
075860             PERFORM 6600-FETCH-TRIPST-CSR                        07586000
075870         END-PERFORM                                              07587000
075880         PERFORM 6700-CLOSE-TRIPST-CSR                            07588000
075890     END-IF.                                                      07589000
075900                                                                  07590000
075910     IF PS-ETA-WARNING                                            07591000
075920         MOVE PC-TSYMSG-01497    TO DP020-MSG-NUMBER              07592000
075930         MOVE DP015-UNP-ALP-BRT-MDT                               07593000
075940                                 TO AETAMMA                       07594000
075950                                    AETADDA                       07595000
075960                                    AETAYYA                       07596000
075970         MOVE DP015-YELLOW       TO AETAMMC                       07597000
075980                                    AETADDC                       07598000
075990                                    AETAYYC                       07599000
076000         MOVE DP015-REVERSE      TO AETAMMH                       07600000
076010                                    AETADDH                       07601000
076020                                    AETAYYH                       07602000
076030     ELSE                                                         07603000
076040         MOVE PC-TSYMSG-00059    TO DP020-MSG-NUMBER              07604000
076050         SET DP020-MSG-INFORMATIONAL TO TRUE                      07605000
076060***** CHECK IF TROUBLE HAS BEEN RESOLVED AND/OR CREATED           07606000
076070         PERFORM 6010-WAS-THERE-STOR-TRBL                         07607000
076080     END-IF.                                                      07608000
076090                                                                  07609000
076100     IF  ASC-USE-SELECTION-QUEUE                                  07610000
076110         PERFORM 5200-UPDATE-SELECTION-QUEUE                      07611000
076120     END-IF.                                                      07612000
076130                                                                  07613000
076140     PERFORM 3500-SAVE-SCREEN-FIELDS.                             07614000
076150                                                                  07615000
076160     IF  ASC-VEHICLE-DEPARTED AND PS-NO-MORE-STOPS-SCHEDULED      07616000
076170         MOVE ZEROES TO ASC-KEY-TRIP-ID                           07617000
076180     END-IF.                                                      07618000
076190                                                                  07619000
076200     MOVE SPACES TO ASC-VEHICLE-STATUS-SW.                        07620000
076210                                                                  07621000
076220 6010-WAS-THERE-STOR-TRBL.                                        07622000
076230     IF PS-NO-TRBL-ACCESS-TRBL                                    07623000
076240         IF PV-TRBL-RSLV-CT = 0                                   07624000
076250             MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER             07625000
076260             SET DP020-MSG-INFORMATIONAL TO TRUE                  07626000
076270         ELSE                                                     07627000
076280         IF PV-TRBL-RSLV-CT > 0   AND                             07628000
076290            PS-NO-TRBL-CREATED-ONSITE                             07629000
076300             MOVE PV-TRBL-RSLV-CT TO DP020-MSG-TEXT               07630000
076310             MOVE PC-TSYMSG-01666 TO DP020-MSG-NUMBER             07631000
076320             SET DP020-MSG-INFORMATIONAL TO TRUE                  07632000
076330         ELSE                                                     07633000
076340         IF PV-TRBL-RSLV-CT > 0   AND                             07634000
076350            PS-TRBL-CREATED-ONSITE                                07635000
076360             MOVE PV-TRBL-RSLV-CT TO DP020-MSG-TEXT               07636000
076370             MOVE PC-TSYMSG-01667 TO DP020-MSG-NUMBER             07637000
076380             SET DP020-MSG-INFORMATIONAL TO TRUE                  07638000
076390         END-IF                                                   07639000
076400     ELSE                                                         07640000
076410         IF PS-TRBL-ACCESS-TRBL-W                                 07641000
076420             SET DP020-MSG-WARNING       TO TRUE                  07642000
076430             MOVE PV-TRBL-MSG-NO  TO DP020-MSG-NUMBER             07643000
076440         ELSE                                                     07644000
076450             SET DP020-MSG-FATAL         TO TRUE                  07645000
076460             MOVE PV-TRBL-MSG-NO  TO DP020-MSG-NUMBER             07646000
076470         END-IF                                                   07647000
076480     END-IF.                                                      07648000
076490                                                                  07649000
076500/                                                                 07650000
076510*----------------------------------------------------------------*07651000
076520* OPEN THE SHIPMENT CURSROR                                      *07652000
076530*----------------------------------------------------------------*07653000
076540                                                                  07654000
076550 6100-OPEN-SHIPMENT-CSR.                                          07655000
076560                                                                  07656000
076570     PERFORM                                                      07657000
076580         WITH TEST AFTER                                          07658000
076590         VARYING PV-RETRY-COUNTER                                 07659000
076600         FROM 1 BY 1                                              07660000
076610         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07661000
076620            OR (SQLCODE = +0))                                    07662000
076630                                                                  07663000
076640         EXEC SQL                                                 07664000
076650              OPEN SHIPMENT-CSR                                   07665000
076660         END-EXEC                                                 07666000
076670                                                                  07667000
076680         EVALUATE TRUE                                            07668000
076690             WHEN SQLCODE = +0                                    07669000
076700                  CONTINUE                                        07670000
076710             WHEN SQLCODE = -904                                  07671000
076720             WHEN SQLCODE = -913                                  07672000
076730                  CONTINUE                                        07673000
076740             WHEN SQLWARN0 NOT = SPACE                            07674000
076750             WHEN SQLCODE  NOT = +0                               07675000
076760                  MOVE '6100-OPEN-SHIPMENT-CSR'                   07676000
076770                                   TO DP013-PARAGRAPH             07677000
076780                  MOVE 'OPEN SHIPMENT CURSOR'                     07678000
076790                                   TO DP013-MESSAGE-TEXT (1)      07679000
076800                  MOVE DK-TRIP-ID  TO DP013-MESSAGE-TEXT (2)      07680000
076810                  MOVE SQLCA       TO DP013-SQLCA                 07681000
076820                  MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (1)    07682000
076830                  SET DP013-DB2-ABEND                             07683000
076840                                   TO TRUE                        07684000
076850                  PERFORM DP013-0000-PROCESS-ABEND                07685000
076860         END-EVALUATE                                             07686000
076870     END-PERFORM.                                                 07687000
076880                                                                  07688000
076890     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07689000
076900             AND (SQLCODE NOT = +0)                               07690000
076910         MOVE '6100-OPEN-SHIPMENT-CSR'                            07691000
076920                                   TO DP013-PARAGRAPH             07692000
076930         MOVE 'MAX RETRIES EXCEEDED FOR OPEN SHIPMENT CURSOR'     07693000
076940                                   TO DP013-MESSAGE-TEXT (1)      07694000
076950         MOVE SQLCA                TO DP013-SQLCA                 07695000
076960         SET DP013-DB2-ABEND       TO TRUE                        07696000
076970         PERFORM DP013-0000-PROCESS-ABEND                         07697000
076980     END-IF.                                                      07698000
076990                                                                  07699000
077000/                                                                 07700000
077010*----------------------------------------------------------------*07701000
077020*    FETCH A SHIPMENT ROW                                        *07702000
077030*----------------------------------------------------------------*07703000
077040                                                                  07704000
077050 6102-FETCH-SHIPMENT-CSR.                                         07705000
077060                                                                  07706000
077070     EXEC SQL                                                     07707000
077080          FETCH SHIPMENT-CSR                                      07708000
077090          INTO :SHIPMT-SHIPT-ID                                   07709000
077100     END-EXEC                                                     07710000
077110                                                                  07711000
077120     EVALUATE TRUE                                                07712000
077130         WHEN SQLCODE = +0                                        07713000
077140              CONTINUE                                            07714000
077150                                                                  07715000
077160         WHEN SQLCODE = +100                                      07716000
077170              SET PS-NO-MORE-SHIPMENTS TO TRUE                    07717000
077180                                                                  07718000
077190         WHEN SQLWARN0 NOT = SPACE                                07719000
077200         WHEN SQLCODE < +0                                        07720000
077210         WHEN SQLCODE > +0                                        07721000
077220              MOVE '6102-FETCH-SHIPMENT-CSR'                      07722000
077230                                   TO DP013-PARAGRAPH             07723000
077240              MOVE 'FETCH SHIPMENT CURSOR'                        07724000
077250                                   TO DP013-MESSAGE-TEXT (1)      07725000
077260              MOVE SHIPMT-SHIPT-ID TO DP013-MESSAGE-TEXT (2)      07726000
077270              MOVE SQLCA           TO DP013-SQLCA                 07727000
077280              MOVE 'TSHIPMT'       TO DP013-DB2-TABLE-NAME (1)    07728000
077290              SET DP013-DB2-ABEND  TO TRUE                        07729000
077300              PERFORM DP013-0000-PROCESS-ABEND                    07730000
077310     END-EVALUATE.                                                07731000
077320                                                                  07732000
077330/                                                                 07733000
077340*----------------------------------------------------------------*07734000
077350* CLOSE THE SHIPMENT CURSOR                                      *07735000
077360*----------------------------------------------------------------*07736000
077370                                                                  07737000
077380 6104-CLOSE-SHIPMENT-CSR.                                         07738000
077390                                                                  07739000
077400     EXEC SQL                                                     07740000
077410          CLOSE SHIPMENT-CSR                                      07741000
077420     END-EXEC                                                     07742000
077430                                                                  07743000
077440     EVALUATE TRUE                                                07744000
077450         WHEN SQLCODE = +0                                        07745000
077460              CONTINUE                                            07746000
077470         WHEN SQLWARN0 NOT = SPACE                                07747000
077480         WHEN SQLCODE  NOT = +0                                   07748000
077490              MOVE '6104-CLOSE-SHIPMENT-CSR'                      07749000
077500                                   TO DP013-PARAGRAPH             07750000
077510              MOVE 'CLOSE SHIPMENT CURSOR'                        07751000
077520                                   TO DP013-MESSAGE-TEXT (1)      07752000
077530              MOVE SQLCA           TO DP013-SQLCA                 07753000
077540              MOVE 'TSHIPMT'       TO DP013-DB2-TABLE-NAME (1)    07754000
077550              SET DP013-DB2-ABEND  TO TRUE                        07755000
077560              PERFORM DP013-0000-PROCESS-ABEND                    07756000
077570     END-EVALUATE.                                                07757000
077580                                                                  07758000
077590/                                                                 07759000
077600*----------------------------------------------------------------*07760000
077610*  SELECT LATEST SHIPMENT STATUS ROW                             *07761000
077620*----------------------------------------------------------------*07762000
077630 6110-SELECT-TSHIPST.                                             07763000
077640                                                                  07764000
077650     PERFORM                                                      07765000
077660         WITH TEST AFTER                                          07766000
077670         VARYING PV-RETRY-COUNTER                                 07767000
077680         FROM 1 BY 1                                              07768000
077690         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07769000
077700             OR (SQLCODE = +0))                                   07770000
077710                                                                  07771000
077720         EXEC SQL                                                 07772000
077730             SELECT  A.SHIPT_ID                                   07773000
077740                    ,A.SHIPT_STATUS_CDE                           07774000
077750                    ,A.STATUS_DTE                                 07775000
077760                    ,A.STATUS_TME                                 07776000
077770                    ,A.STATUS_UID                                 07777000
077780                    ,A.DELAY_RSN_CDE                              07778000
077790                    ,A.CARR_STATUS_CDE                            07779000
077800                    ,A.TIME_ZONE_CDE                              07780000
077810                    ,A.CITY_NAME                                  07781000
077820                    ,A.STATE_CDE                                  07782000
077830             INTO    :SHIPST-SHIPT-ID                             07783000
077840                    ,:SHIPST-SHIPT-STATUS-CDE                     07784000
077850                    ,:SHIPST-STATUS-DTE                           07785000
077860                    ,:SHIPST-STATUS-TME                           07786000
077870                    ,:SHIPST-STATUS-UID                           07787000
077880                    ,:SHIPST-DELAY-RSN-CDE                        07788000
077890                    ,:SHIPST-CARR-STATUS-CDE                      07789000
077900                    ,:SHIPST-TIME-ZONE-CDE                        07790000
077910                    ,:SHIPST-CITY-NAME                            07791000
077920                    ,:SHIPST-STATE-CDE                            07792000
077930           FROM   TSHIPST A                                       07793000
077940                 ,TSHSTYP B                                       07794000
077950           WHERE  A.SHIPT_ID = :DK-SHIPT-ID                       07795000
077960             AND  B.PRTY_CDE =                                    07796000
077970                  (SELECT MAX(D.PRTY_CDE)                         07797000
077980                     FROM TSHIPST C                               07798000
077990                         ,TSHSTYP D                               07799000
078000                    WHERE C.SHIPT_ID         = A.SHIPT_ID         07800000
078010                      AND C.SHIPT_STATUS_CDE = D.SHIPT_STATUS_CDE)07801000
078020             AND  A.SHIPT_STATUS_CDE = B.SHIPT_STATUS_CDE         07802000
078030         END-EXEC                                                 07803000
078040                                                                  07804000
078050         EVALUATE TRUE                                            07805000
078060             WHEN SQLCODE = +0                                    07806000
078070             WHEN SQLCODE = -904                                  07807000
078080             WHEN SQLCODE = -913                                  07808000
078090                 CONTINUE                                         07809000
078100                                                                  07810000
078110             WHEN SQLWARN0 NOT = SPACES                           07811000
078120             WHEN SQLCODE < +0                                    07812000
078130             WHEN SQLCODE > +0                                    07813000
078140                 MOVE '6110-SELECT-TSHIPST'                       07814000
078150                                   TO DP013-PARAGRAPH             07815000
078160                 MOVE 'SELECT A TSHIPST ROW   '                   07816000
078170                                   TO DP013-MESSAGE-TEXT(1)       07817000
078180                 MOVE DK-SHIPT-ID  TO DP013-MESSAGE-TEXT(2)       07818000
078190                 MOVE SQLCA        TO DP013-SQLCA                 07819000
078200                 MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)    07820000
078210                 SET DP013-DB2-ABEND                              07821000
078220                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07822000
078230                 PERFORM DP013-0000-PROCESS-ABEND                 07823000
078240         END-EVALUATE                                             07824000
078250     END-PERFORM.                                                 07825000
078260                                                                  07826000
078270     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07827000
078280             AND (SQLCODE NOT = +0)                               07828000
078290         MOVE '6110-SELECT-TSHIPST'                               07829000
078300                                   TO DP013-PARAGRAPH             07830000
078310         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              07831000
078320                                   TO DP013-MESSAGE-TEXT (1)      07832000
078330         MOVE 'TO SELECT A TSHIPST ROW'                           07833000
078340                                   TO DP013-MESSAGE-TEXT (2)      07834000
078350         MOVE SQLCA                TO DP013-SQLCA                 07835000
078360         MOVE 'TSHIPST'            TO DP013-DB2-TABLE-NAME (1)    07836000
078370         SET DP013-DB2-ABEND                                      07837000
078380             DP013-XCTL-DISPLAY-RESTART                           07838000
078390                                   TO TRUE                        07839000
078400         PERFORM DP013-0000-PROCESS-ABEND                         07840000
078410     END-IF.                                                      07841000
078420                                                                  07842000
078430/                                                                 07843000
078440*----------------------------------------------------------------*07844000
078450*     SQL UPDATE TSHIPST                                        * 07845000
078460*     UPDATE THE CITY NAME FIELD TO 'PORT OF ENTRY' FOR VEHICLE * 07846000
078470*     TYPE CODE OF 'VS', VESSEL, OR 'AV', AIR.                  * 07847000
078480*----------------------------------------------------------------*07848000
078490                                                                  07849000
078500 6115-UPDATE-SHIPST.                                              07850000
078510                                                                  07851000
078520     PERFORM                                                      07852000
078530         WITH TEST AFTER                                          07853000
078540         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     07854000
078550         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            07855000
078560                 SQLCODE = ZERO OR                                07856000
078570                 SQLCODE = +100                                   07857000
078580                                                                  07858000
078590         EXEC SQL                                                 07859000
078600             UPDATE TSHIPST                                       07860000
078610                SET CITY_NAME        = :SHIPST-CITY-NAME          07861000
078620              WHERE SHIPT_ID         = :SHIPST-SHIPT-ID           07862000
078630                AND SHIPT_STATUS_CDE = :SHIPST-SHIPT-STATUS-CDE   07863000
078640         END-EXEC                                                 07864000
078650                                                                  07865000
078660         EVALUATE TRUE                                            07866000
078670             WHEN SQLCODE = +0                                    07867000
078680             WHEN SQLCODE = -904                                  07868000
078690             WHEN SQLCODE = -913                                  07869000
078700                 CONTINUE                                         07870000
078710                                                                  07871000
078720             WHEN SQLWARN0 NOT = SPACES                           07872000
078730             WHEN SQLCODE < +0                                    07873000
078740             WHEN SQLCODE > +0                                    07874000
078750                 MOVE '6115-UPDATE-TSHIPST'                       07875000
078760                                   TO DP013-PARAGRAPH             07876000
078770                 MOVE 'UPDATE A ROW ON TSHIPST'                   07877000
078780                                   TO DP013-MESSAGE-TEXT(1)       07878000
078790                 MOVE SHIPST-SHIPT-ID TO DP013-MESSAGE-TEXT(2)    07879000
078800                 MOVE SHIPST-SHIPT-STATUS-CDE                     07880000
078810                                   TO DP013-MESSAGE-TEXT(3)       07881000
078820                 MOVE SQLCA        TO DP013-SQLCA                 07882000
078830                 MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)    07883000
078840                 SET DP013-DB2-ABEND                              07884000
078850                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07885000
078860                 PERFORM DP013-0000-PROCESS-ABEND                 07886000
078870         END-EVALUATE                                             07887000
078880     END-PERFORM.                                                 07888000
078890                                                                  07889000
078900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07890000
078910             AND (SQLCODE NOT = +0)                               07891000
078920         MOVE '6115-UPDATE-TSHIPST'                               07892000
078930                                   TO DP013-PARAGRAPH             07893000
078940         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              07894000
078950                                   TO DP013-MESSAGE-TEXT (1)      07895000
078960         MOVE 'TO UPDATE A TSHIPST ROW'                           07896000
078970                                   TO DP013-MESSAGE-TEXT (2)      07897000
078980         MOVE SQLCA                TO DP013-SQLCA                 07898000
078990         MOVE 'TSHIPST'            TO DP013-DB2-TABLE-NAME (1)    07899000
079000         SET DP013-DB2-ABEND                                      07900000
079010             DP013-XCTL-DISPLAY-RESTART                           07901000
079020                                   TO TRUE                        07902000
079030         PERFORM DP013-0000-PROCESS-ABEND                         07903000
079040     END-IF.                                                      07904000
079050/                                                                 07905000
079060*----------------------------------------------------------------*07906000
079070*  INSERT A SHIPMENT STATUS ROW                                  *07907000
079080*----------------------------------------------------------------*07908000
079090 6120-INSERT-TSHIPST.                                             07909000
079100                                                                  07910000
079110     IF PV-DB2-HOST-DATE = SPACES OR                              07911000
079120        PV-DB2-HOST-TIME = SPACES                                 07912000
079130         EXEC SQL                                                 07913000
079140             SET :PV-DB2-HOST-DATE      = CURRENT DATE            07914000
079150         END-EXEC                                                 07915000
079160                                                                  07916000
079170         EXEC SQL                                                 07917000
079180             SET :PV-DB2-HOST-TIME      = CURRENT TIME            07918000
079190         END-EXEC                                                 07919000
079200     END-IF.                                                      07920000
079210                                                                  07921000
079220     PERFORM                                                      07922000
079230         WITH TEST AFTER                                          07923000
079240         VARYING PV-RETRY-COUNTER                                 07924000
079250         FROM 1 BY 1                                              07925000
079260         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07926000
079270             OR (SQLCODE = +0))                                   07927000
079280                                                                  07928000
079290         EXEC SQL                                                 07929000
079300             INSERT  INTO TSHIPST                                 07930000
079310                    (SHIPT_ID                                     07931000
079320                    ,SHIPT_STATUS_CDE                             07932000
079330                    ,STATUS_DTE                                   07933000
079340                    ,STATUS_TME                                   07934000
079350                    ,STATUS_UID                                   07935000
079360                    ,DELAY_RSN_CDE                                07936000
079370                    ,CARR_STATUS_CDE                              07937000
079380                    ,TIME_ZONE_CDE                                07938000
079390                    ,CITY_NAME                                    07939000
079400                    ,STATE_CDE )                                  07940000
079410            VALUES  (:SHIPST-SHIPT-ID                             07941000
079420                    ,:SHIPST-SHIPT-STATUS-CDE                     07942000
079430                    ,:PV-DB2-HOST-DATE                            07943000
079440                    ,:PV-DB2-HOST-TIME                            07944000
079450                    ,:DP020-USERID                                07945000
079460                    ,:SHIPST-DELAY-RSN-CDE                        07946000
079470                    ,:SHIPST-CARR-STATUS-CDE                      07947000
079480                    ,:SHIPST-TIME-ZONE-CDE                        07948000
079490                    ,:SHIPST-CITY-NAME                            07949000
079500                    ,:SHIPST-STATE-CDE )                          07950000
079510         END-EXEC                                                 07951000
079520                                                                  07952000
079530         EVALUATE TRUE                                            07953000
079540             WHEN SQLCODE = +0                                    07954000
079550             WHEN SQLCODE = -904                                  07955000
079560             WHEN SQLCODE = -913                                  07956000
079570                 CONTINUE                                         07957000
079580                                                                  07958000
079590             WHEN SQLWARN0 NOT = SPACES                           07959000
079600             WHEN SQLCODE < +0                                    07960000
079610             WHEN SQLCODE > +0                                    07961000
079620                 MOVE '6120-INSERT-TSHIPST'                       07962000
079630                                   TO DP013-PARAGRAPH             07963000
079640                 MOVE 'INSERT A ROW ON TSHIPST'                   07964000
079650                                   TO DP013-MESSAGE-TEXT(1)       07965000
079660                 MOVE SHIPST-SHIPT-ID TO DP013-MESSAGE-TEXT(2)    07966000
079670                 MOVE SHIPST-SHIPT-STATUS-CDE                     07967000
079680                                   TO DP013-MESSAGE-TEXT(3)       07968000
079690                 MOVE SQLCA        TO DP013-SQLCA                 07969000
079700                 MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)    07970000
079710                 SET DP013-DB2-ABEND                              07971000
079720                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07972000
079730                 PERFORM DP013-0000-PROCESS-ABEND                 07973000
079740         END-EVALUATE                                             07974000
079750     END-PERFORM.                                                 07975000
079760                                                                  07976000
079770     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07977000
079780             AND (SQLCODE NOT = +0)                               07978000
079790         MOVE '6120-INSERT-TSHIPST'                               07979000
079800                                   TO DP013-PARAGRAPH             07980000
079810         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              07981000
079820                                   TO DP013-MESSAGE-TEXT (1)      07982000
079830         MOVE 'TO INSERT A TSHIPST ROW'                           07983000
079840                                   TO DP013-MESSAGE-TEXT (2)      07984000
079850         MOVE SQLCA                TO DP013-SQLCA                 07985000
079860         MOVE 'TSHIPST'            TO DP013-DB2-TABLE-NAME (1)    07986000
079870         SET DP013-DB2-ABEND                                      07987000
079880             DP013-XCTL-DISPLAY-RESTART                           07988000
079890                                   TO TRUE                        07989000
079900         PERFORM DP013-0000-PROCESS-ABEND                         07990000
079910     END-IF.                                                      07991000
079920/                                                                 07992000
079930*----------------------------------------------------------------*07993000
079940*  GET THE NEXT SEQUENTIAL TRIP IF THERE IS ONE                  *07994000
079950*----------------------------------------------------------------*07995000
079960 6130-GET-NEXT-TRIP.                                              07996000
079970                                                                  07997000
079980     PERFORM                                                      07998000
079990         WITH TEST AFTER                                          07999000
080000         VARYING PV-RETRY-COUNTER                                 08000000
080010         FROM 1 BY 1                                              08001000
080020         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08002000
080030             OR (SQLCODE = +0)                                    08003000
080040             OR (SQLCODE = +100)                                  08004000
080050             OR (SQLCODE = -811))                                 08005000
080060                                                                  08006000
080070         EXEC SQL                                                 08007000
080080             SELECT  TRIP_ID                                      08008000
080090               INTO  :VHTRIP-TRIP-ID                              08009000
080100           FROM   TVHTRIP                                         08010000
080110           WHERE  OWNER_SCAC_ID = :DK-OWNER-SCAC-ID               08011000
080120             AND  VEH_NBR       IS NOT NULL                       08012000
080130             AND  VEH_NBR       = :DK-VEH-NBR                     08013000
080140             AND  PLND_TRIP_SEQ > :DK-PLND-TRIP-SEQ               08014000
080150             AND  PLND_TRIP_SEQ IN                                08015000
080160            (SELECT MIN(PLND_TRIP_SEQ)                            08016000
080170                   FROM   TVHTRIP A                               08017000
080180                      ,   TTRIPST B                               08018000
080190                      ,   TTRSTYP C                               08019000
080200                   WHERE  A.OWNER_SCAC_ID = :DK-OWNER-SCAC-ID     08020000
080210                     AND  A.VEH_NBR       IS NOT NULL             08021000
080220                     AND  A.VEH_NBR       = :DK-VEH-NBR           08022000
080230                     AND  A.TRIP_ID       = B.TRIP_ID             08023000
080240                     AND  B.TRIP_STATUS_CDE NOT IN ('DE', 'ET')   08024000
080250                     AND  A.PLND_TRIP_SEQ > :DK-PLND-TRIP-SEQ     08025000
080260                     AND  B.TRIP_STATUS_CDE = C.TRIP_STATUS_CDE   08026000
080270                     AND  C.PRTY_CDE =                            08027000
080280                          (SELECT MAX(E.PRTY_CDE)                 08028000
080290                             FROM TTRIPST D                       08029000
080300                                 ,TTRSTYP E                       08030000
080310                            WHERE D.TRIP_ID         = A.TRIP_ID   08031000
080320                      AND D.TRIP_STATUS_CDE = E.TRIP_STATUS_CDE)) 08032000
080330         END-EXEC                                                 08033000
080340                                                                  08034000
080350         EVALUATE TRUE                                            08035000
080360             WHEN SQLCODE = +0                                    08036000
080370             WHEN SQLCODE = +100                                  08037000
080380             WHEN SQLCODE = -811                                  08038000
080390             WHEN SQLCODE = -904                                  08039000
080400             WHEN SQLCODE = -913                                  08040000
080410                 CONTINUE                                         08041000
080420                                                                  08042000
080430             WHEN SQLWARN0 NOT = SPACES                           08043000
080440             WHEN SQLCODE < +0                                    08044000
080450             WHEN SQLCODE > +0                                    08045000
080460                 MOVE SPACES TO PV-MESSAGE                        08046000
080470                 MOVE DK-OWNER-SCAC-ID TO PV-MESSAGE1             08047000
080480                 MOVE DK-VEH-NBR       TO PV-MESSAGE2             08048000
080490                 MOVE DK-PLND-TRIP-SEQ TO PV-MESSAGE3             08049000
080500                 MOVE '6130-GET-NEXT-TRIP '                       08050000
080510                                   TO DP013-PARAGRAPH             08051000
080520                 MOVE 'SELECT A TVHTRIP ROW   '                   08052000
080530                                   TO DP013-MESSAGE-TEXT(1)       08053000
080540                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       08054000
080550                 MOVE SQLCA        TO DP013-SQLCA                 08055000
080560                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    08056000
080570                 SET DP013-DB2-ABEND                              08057000
080580                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08058000
080590                 PERFORM DP013-0000-PROCESS-ABEND                 08059000
080600         END-EVALUATE                                             08060000
080610     END-PERFORM.                                                 08061000
080620                                                                  08062000
080630     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08063000
080640             AND (SQLCODE NOT = +0)                               08064000
080650         MOVE '6130-GET-NEXT-TRIP '                               08065000
080660                                   TO DP013-PARAGRAPH             08066000
080670         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              08067000
080680                                   TO DP013-MESSAGE-TEXT (1)      08068000
080690         MOVE 'TO SELECT A TVHTRIP ROW'                           08069000
080700                                   TO DP013-MESSAGE-TEXT (2)      08070000
080710         MOVE SQLCA                TO DP013-SQLCA                 08071000
080720         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    08072000
080730         SET DP013-DB2-ABEND                                      08073000
080740             DP013-XCTL-DISPLAY-RESTART                           08074000
080750                                   TO TRUE                        08075000
080760         PERFORM DP013-0000-PROCESS-ABEND                         08076000
080770     END-IF.                                                      08077000
080780                                                                  08078000
080790/                                                                 08079000
080800*----------------------------------------------------------------*08080000
080810*  GET THE LATEST TRIP ID                                        *08081000
080820*----------------------------------------------------------------*08082000
080830 6135-GET-MAX-TRIP-SEQ.                                           08083000
080840                                                                  08084000
080850     PERFORM                                                      08085000
080860         WITH TEST AFTER                                          08086000
080870         VARYING PV-RETRY-COUNTER                                 08087000
080880         FROM 1 BY 1                                              08088000
080890         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08089000
080900             OR (SQLCODE = +0)                                    08090000
080910             OR (SQLCODE = -305))                                 08091000
080920                                                                  08092000
080930         EXEC SQL                                                 08093000
080940             SELECT MAX(PLND_TRIP_SEQ)                            08094000
080950               INTO  :VHTRIP-PLND-TRIP-SEQ                        08095000
080960           FROM   TVHTRIP                                         08096000
080970           WHERE  OWNER_SCAC_ID = :DK-OWNER-SCAC-ID               08097000
080980             AND  VEH_NBR       IS NOT NULL                       08098000
080990             AND  VEH_NBR       = :DK-VEH-NBR                     08099000
081000         END-EXEC                                                 08100000
081010                                                                  08101000
081020         EVALUATE TRUE                                            08102000
081030             WHEN SQLCODE = +0                                    08103000
081040                 ADD +1            TO VHTRIP-PLND-TRIP-SEQ        08104000
081050                                                                  08105000
081060             WHEN SQLCODE = -305                                  08106000
081070                 MOVE +1           TO VHTRIP-PLND-TRIP-SEQ        08107000
081080                                                                  08108000
081090             WHEN SQLCODE = -904                                  08109000
081100             WHEN SQLCODE = -913                                  08110000
081110                 CONTINUE                                         08111000
081120                                                                  08112000
081130             WHEN SQLWARN0 NOT = SPACES                           08113000
081140             WHEN SQLCODE < +0                                    08114000
081150             WHEN SQLCODE > +0                                    08115000
081160                 MOVE '6135-GET-MAX-TRIP-SEQ'                     08116000
081170                                   TO DP013-PARAGRAPH             08117000
081180                 MOVE 'SELECT A TVHTRIP ROW   '                   08118000
081190                                   TO DP013-MESSAGE-TEXT(1)       08119000
081200                 MOVE DK-VEH-NBR   TO DP013-MESSAGE-TEXT(2)       08120000
081210                 MOVE DK-OWNER-SCAC-ID                            08121000
081220                                   TO DP013-MESSAGE-TEXT(3)       08122000
081230                 MOVE SQLCA        TO DP013-SQLCA                 08123000
081240                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    08124000
081250                 SET DP013-DB2-ABEND                              08125000
081260                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08126000
081270                 PERFORM DP013-0000-PROCESS-ABEND                 08127000
081280         END-EVALUATE                                             08128000
081290     END-PERFORM.                                                 08129000
081300                                                                  08130000
081310     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08131000
081320             AND (SQLCODE NOT = +0)                               08132000
081330         MOVE '6135-GET-MAX-TRIP-SEQ'                             08133000
081340                                   TO DP013-PARAGRAPH             08134000
081350         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              08135000
081360                                   TO DP013-MESSAGE-TEXT (1)      08136000
081370         MOVE 'TO SELECT A TVHTRIP ROW'                           08137000
081380                                   TO DP013-MESSAGE-TEXT (2)      08138000
081390         MOVE SQLCA                TO DP013-SQLCA                 08139000
081400         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    08140000
081410         SET DP013-DB2-ABEND                                      08141000
081420             DP013-XCTL-DISPLAY-RESTART                           08142000
081430                                   TO TRUE                        08143000
081440         PERFORM DP013-0000-PROCESS-ABEND                         08144000
081450     END-IF.                                                      08145000
081460                                                                  08146000
081470/                                                                 08147000
081480*----------------------------------------------------------------*08148000
081490*  SELECT CURRENT TRIP STATUS ROW                                *08149000
081500*----------------------------------------------------------------*08150000
081510 6150-SELECT-TTRIPST.                                             08151000
081520                                                                  08152000
081530     PERFORM                                                      08153000
081540         WITH TEST AFTER                                          08154000
081550         VARYING PV-RETRY-COUNTER                                 08155000
081560         FROM 1 BY 1                                              08156000
081570         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08157000
081580             OR (SQLCODE = +0))                                   08158000
081590                                                                  08159000
081600         EXEC SQL                                                 08160000
081610             SELECT  A.TRIP_ID                                    08161000
081620                    ,A.TRIP_STATUS_CDE                            08162000
081630                    ,A.STATUS_DTE                                 08163000
081640                    ,A.STATUS_TME                                 08164000
081650                    ,A.STATUS_UID                                 08165000
081660                    ,A.OPER_UNT_ID                                08166000
081670                    ,A.FCLTY_ID                                   08167000
081680                    ,A.FCLTY_AREA_ID                              08168000
081690              INTO   :TRIPST-TRIP-ID                              08169000
081700                    ,:TRIPST-TRIP-STATUS-CDE                      08170000
081710                    ,:TRIPST-STATUS-DTE                           08171000
081720                    ,:TRIPST-STATUS-TME                           08172000
081730                    ,:TRIPST-STATUS-UID                           08173000
081740                    ,:TRIPST-OPER-UNT-ID                          08174000
081750                    ,:TRIPST-FCLTY-ID                             08175000
081760                    ,:TRIPST-FCLTY-AREA-ID                        08176000
081770              FROM  TTRIPST A                                     08177000
081780                   ,TTRSTYP B                                     08178000
081790             WHERE  A.TRIP_ID          = :DK-TRIP-ID              08179000
081800               AND  A.TRIP_STATUS_CDE ^= 'DE'                     08180000
081810               AND  B.PRTY_CDE =                                  08181000
081820                  (SELECT MAX(D.PRTY_CDE)                         08182000
081830                     FROM TTRIPST C                               08183000
081840                         ,TTRSTYP D                               08184000
081850                    WHERE C.TRIP_ID         = A.TRIP_ID           08185000
081860                      AND C.TRIP_STATUS_CDE = D.TRIP_STATUS_CDE)  08186000
081870               AND  A.TRIP_STATUS_CDE = B.TRIP_STATUS_CDE         08187000
081880         END-EXEC                                                 08188000
081890                                                                  08189000
081900         EVALUATE TRUE                                            08190000
081910             WHEN SQLCODE = +0                                    08191000
081920             WHEN SQLCODE = -904                                  08192000
081930             WHEN SQLCODE = -913                                  08193000
081940                 CONTINUE                                         08194000
081950                                                                  08195000
081960             WHEN SQLWARN0 NOT = SPACES                           08196000
081970             WHEN SQLCODE < +0                                    08197000
081980             WHEN SQLCODE > +0                                    08198000
081990                 MOVE '6150-SELECT-TTRIPST'                       08199000
082000                                   TO DP013-PARAGRAPH             08200000
082010                 MOVE 'SELECT A ROW ON TTRIPST'                   08201000
082020                                   TO DP013-MESSAGE-TEXT(1)       08202000
082030                 MOVE DK-TRIP-ID   TO DP013-MESSAGE-TEXT(2)       08203000
082040                 MOVE SQLCA        TO DP013-SQLCA                 08204000
082050                 MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)    08205000
082060                 SET DP013-DB2-ABEND                              08206000
082070                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08207000
082080                 PERFORM DP013-0000-PROCESS-ABEND                 08208000
082090         END-EVALUATE                                             08209000
082100     END-PERFORM.                                                 08210000
082110                                                                  08211000
082120     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08212000
082130             AND (SQLCODE NOT = +0)                               08213000
082140         MOVE '6150-INSERT-TTRIPST'                               08214000
082150                                   TO DP013-PARAGRAPH             08215000
082160         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              08216000
082170                                   TO DP013-MESSAGE-TEXT (1)      08217000
082180         MOVE 'TO SELECT A TTRIPST ROW'                           08218000
082190                                   TO DP013-MESSAGE-TEXT (2)      08219000
082200         MOVE SQLCA                TO DP013-SQLCA                 08220000
082210         MOVE 'TTRIPST'            TO DP013-DB2-TABLE-NAME (1)    08221000
082220         SET DP013-DB2-ABEND                                      08222000
082230             DP013-XCTL-DISPLAY-RESTART                           08223000
082240                                   TO TRUE                        08224000
082250         PERFORM DP013-0000-PROCESS-ABEND                         08225000
082260     END-IF.                                                      08226000
082270                                                                  08227000
082280/                                                                 08228000
082290*----------------------------------------------------------------*08229000
082300*  UPDATE THE LOCATION AND STATUS OF THE VEHICLE                 *08230000
082310*----------------------------------------------------------------*08231000
082320 6160-UPDATE-TVEHICL.                                             08232000
082330                                                                  08233000
082340     IF VEHICL-CURR-TRIP-ID = ZERO                                08234000
082350         MOVE -1 TO DN-CURR-TRIP-ID                               08235000
082360     ELSE                                                         08236000
082370         MOVE +1 TO DN-CURR-TRIP-ID                               08237000
082380     END-IF.                                                      08238000
082390                                                                  08239000
082400     IF VEHICL-CURR-STATUS-DTE = SPACES OR                        08240000
082410        VEHICL-CURR-STATUS-TME = SPACES                           08241000
082420         EXEC CICS ASKTIME                                        08242000
082430              ABSTIME (PV-ABSTIME)                                08243000
082440         END-EXEC                                                 08244000
082450         EXEC CICS FORMATTIME                                     08245000
082460              ABSTIME (PV-ABSTIME)                                08246000
082470              DATESEP ('-') YYMMDD  (PV-CURR-STATUS-DTE)          08247000
082480              TIME (PV-CURR-STATUS-TME) TIMESEP                   08248000
082490         END-EXEC                                                 08249000
082500         IF PV-CURR-STATUS-YY > 60                                08250000
082510             MOVE '19'   TO PV-CURR-STATUS-CC                     08251000
082520         ELSE                                                     08252000
082530             MOVE '20'   TO PV-CURR-STATUS-CC                     08253000
082540         END-IF                                                   08254000
082550         MOVE PV-CURR-STATUS-CCYYMMDD  TO                         08255000
082560                              VEHICL-CURR-STATUS-DTE              08256000
082570         MOVE PV-CURR-STATUS-TME TO                               08257000
082580                              VEHICL-CURR-STATUS-TME              08258000
082590     END-IF                                                       08259000
082600                                                                  08260000
082610     PERFORM                                                      08261000
082620         WITH TEST AFTER                                          08262000
082630         VARYING PV-RETRY-COUNTER                                 08263000
082640         FROM 1 BY 1                                              08264000
082650         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08265000
082660             OR (SQLCODE = +0))                                   08266000
082670                                                                  08267000
082680         EXEC SQL                                                 08268000
082690           UPDATE TVEHICL                                         08269000
082700              SET LAST_UPD_DTE     = CURRENT DATE                 08270000
082710                 ,LAST_UPD_TME     = CURRENT TIME                 08271000
082720                 ,LAST_UPD_UID     = :DP020-USERID                08272000
082730                 ,USAGE_CDE        = :VEHICL-USAGE-CDE            08273000
082740                 ,VEH_TYP_CDE      = :VEHICL-VEH-TYP-CDE          08274000
082750                 ,VEH_SIZE_CDE     = :VEHICL-VEH-SIZE-CDE         08275000
082760                 ,CURR_STATUS_DTE  = :VEHICL-CURR-STATUS-DTE      08276000
082770                 ,CURR_STATUS_TME  = :VEHICL-CURR-STATUS-TME      08277000
082780                 ,CURR_STATUS_CDE  = :VEHICL-CURR-STATUS-CDE      08278000
082790                 ,CURR_FAC_AREA_ID = :VEHICL-CURR-FAC-AREA-ID     08279000
082800                 ,CURR_OPER_UNT_ID = :VEHICL-CURR-OPER-UNT-ID     08280000
082810                 ,CURR_FCLTY_ID    = :VEHICL-CURR-FCLTY-ID        08281000
082820                 ,CURR_TRIP_ID     = :VEHICL-CURR-TRIP-ID         08282000
082830                                     :DN-CURR-TRIP-ID             08283000
082840           WHERE  VEH_NBR       = :DK-VEH-NBR                     08284000
082850             AND  OWNER_SCAC_ID = :DK-OWNER-SCAC-ID               08285000
082860         END-EXEC                                                 08286000
082870                                                                  08287000
082880         EVALUATE TRUE                                            08288000
082890             WHEN SQLCODE = +0                                    08289000
082900             WHEN SQLCODE = -904                                  08290000
082910             WHEN SQLCODE = -913                                  08291000
082920                 CONTINUE                                         08292000
082930                                                                  08293000
082940             WHEN SQLWARN0 NOT = SPACES                           08294000
082950             WHEN SQLCODE < +0                                    08295000
082960             WHEN SQLCODE > +0                                    08296000
082970                 MOVE '6160-UPDATE-TVEHICL'                       08297000
082980                                   TO DP013-PARAGRAPH             08298000
082990                 MOVE 'UPDATE CURR INFO ON TVEHICL'               08299000
083000                                   TO DP013-MESSAGE-TEXT(1)       08300000
083010                 MOVE DK-VEH-NBR   TO DP013-MESSAGE-TEXT(2)       08301000
083020                 MOVE DK-OWNER-SCAC-ID                            08302000
083030                                   TO DP013-MESSAGE-TEXT(3)       08303000
083040                 MOVE SQLCA        TO DP013-SQLCA                 08304000
083050                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    08305000
083060                 SET DP013-DB2-ABEND                              08306000
083070                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08307000
083080                 PERFORM DP013-0000-PROCESS-ABEND                 08308000
083090         END-EVALUATE                                             08309000
083100     END-PERFORM.                                                 08310000
083110                                                                  08311000
083120     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08312000
083130             AND (SQLCODE NOT = +0)                               08313000
083140         MOVE '6160-UPDATE-TVEHICL'                               08314000
083150                                   TO DP013-PARAGRAPH             08315000
083160         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              08316000
083170                                   TO DP013-MESSAGE-TEXT (1)      08317000
083180         MOVE 'TO UPDATE A TVEHICL ROW'                           08318000
083190                                   TO DP013-MESSAGE-TEXT (2)      08319000
083200         MOVE SQLCA                TO DP013-SQLCA                 08320000
083210         MOVE 'TVEHICL'            TO DP013-DB2-TABLE-NAME (1)    08321000
083220         SET DP013-DB2-ABEND                                      08322000
083230             DP013-XCTL-DISPLAY-RESTART                           08323000
083240                                   TO TRUE                        08324000
083250         PERFORM DP013-0000-PROCESS-ABEND                         08325000
083260     END-IF.                                                      08326000
083270                                                                  08327000
083280*----------------------------------------------------------------*08328000
083290*  UPDATE THE STATUS OF THE VEHICLE WHEN IT IS DELETED           *08329000
083300*----------------------------------------------------------------*08330000
083310 6165-UPDATE-VEHICLE-STATUS.                                      08331000
083320                                                                  08332000
083330     PERFORM                                                      08333000
083340         WITH TEST AFTER                                          08334000
083350         VARYING PV-RETRY-COUNTER                                 08335000
083360         FROM 1 BY 1                                              08336000
083370         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08337000
083380             OR (SQLCODE = +0))                                   08338000
083390                                                                  08339000
083400         EXEC SQL                                                 08340000
083410           UPDATE TVEHICL                                         08341000
083420              SET CURR_TRIP_ID    = :VEHICL-CURR-TRIP-ID          08342000
083430                                      :DN-CURR-TRIP-ID            08343000
083440                 ,CURR_STATUS_CDE = :VEHICL-CURR-STATUS-CDE       08344000
083450                 ,LAST_UPD_DTE    = CURRENT DATE                  08345000
083460                 ,LAST_UPD_TME    = CURRENT TIME                  08346000
083470                 ,LAST_UPD_UID    = :DP020-USERID                 08347000
083480           WHERE  VEH_NBR       = :DK-VEH-NBR                     08348000
083490             AND  OWNER_SCAC_ID = :DK-OWNER-SCAC-ID               08349000
083500         END-EXEC                                                 08350000
083510                                                                  08351000
083520         EVALUATE TRUE                                            08352000
083530             WHEN SQLCODE = +0                                    08353000
083540             WHEN SQLCODE = -904                                  08354000
083550             WHEN SQLCODE = -913                                  08355000
083560                 CONTINUE                                         08356000
083570                                                                  08357000
083580             WHEN SQLWARN0 NOT = SPACES                           08358000
083590             WHEN SQLCODE < +0                                    08359000
083600             WHEN SQLCODE > +0                                    08360000
083610                 MOVE '6165-UPDATE-VEHICLE-STATUS'                08361000
083620                                   TO DP013-PARAGRAPH             08362000
083630                 MOVE 'UPDATE STATUS ON TVEHICL'                  08363000
083640                                   TO DP013-MESSAGE-TEXT(1)       08364000
083650                 MOVE DK-VEH-NBR   TO DP013-MESSAGE-TEXT(2)       08365000
083660                 MOVE DK-OWNER-SCAC-ID                            08366000
083670                                   TO DP013-MESSAGE-TEXT(3)       08367000
083680                 MOVE SQLCA        TO DP013-SQLCA                 08368000
083690                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    08369000
083700                 SET DP013-DB2-ABEND                              08370000
083710                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08371000
083720                 PERFORM DP013-0000-PROCESS-ABEND                 08372000
083730         END-EVALUATE                                             08373000
083740     END-PERFORM.                                                 08374000
083750                                                                  08375000
083760     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08376000
083770             AND (SQLCODE NOT = +0)                               08377000
083780         MOVE '6165-UPDATE-VEHICLE-STATUS'                        08378000
083790                                   TO DP013-PARAGRAPH             08379000
083800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              08380000
083810                                   TO DP013-MESSAGE-TEXT (1)      08381000
083820         MOVE 'TO UPDATE A TVEHICL ROW'                           08382000
083830                                   TO DP013-MESSAGE-TEXT (2)      08383000
083840         MOVE SQLCA                TO DP013-SQLCA                 08384000
083850         MOVE 'TVEHICL'            TO DP013-DB2-TABLE-NAME (1)    08385000
083860         SET DP013-DB2-ABEND                                      08386000
083870             DP013-XCTL-DISPLAY-RESTART                           08387000
083880                                   TO TRUE                        08388000
083890         PERFORM DP013-0000-PROCESS-ABEND                         08389000
083900     END-IF.                                                      08390000
083910                                                                  08391000
083920/                                                                 08392000
083930*----------------------------------------------------------------*08393000
083940*  UPDATE THE MANIFEST NUMBER                                    *08394000
083950*----------------------------------------------------------------*08395000
083960 6170-UPDATE-TVHTRIP.                                             08396000
083970                                                                  08397000
083980     PERFORM                                                      08398000
083990         WITH TEST AFTER                                          08399000
084000         VARYING PV-RETRY-COUNTER                                 08400000
084010         FROM 1 BY 1                                              08401000
084020         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08402000
084030             OR (SQLCODE = +0))                                   08403000
084040                                                                  08404000
084050         EXEC SQL                                                 08405000
084060           UPDATE TVHTRIP                                         08406000
084070              SET OWNER_SCAC_ID = :DK-OWNER-SCAC-ID               08407000
084080                 ,VEH_NBR       = :DK-VEH-NBR                     08408000
084090                 ,LAST_UPD_DTE  = CURRENT DATE                    08409000
084100                 ,LAST_UPD_TME  = CURRENT TIME                    08410000
084110                 ,LAST_UPD_UID  = :DP020-USERID                   08411000
084120                 ,MANIFEST_NBR  = :VHTRIP-MANIFEST-NBR            08412000
084130                 ,REF_TRIP_ID   = :VHTRIP-REF-TRIP-ID             08413000
084140                 ,OWNR_SCAC_SHIP_DTE                              08414000
084150                                = :VHTRIP-OWNR-SCAC-SHIP-DTE      08415000
084160                 ,EST_AR_TMST   = :VHTRIP-EST-AR-TMST             08416000
084170                                  :DN-EST-AR-TMST                 08417000
084180           WHERE  TRIP_ID       = :DK-TRIP-ID                     08418000
084190         END-EXEC                                                 08419000
084200                                                                  08420000
084210         EVALUATE TRUE                                            08421000
084220             WHEN SQLCODE = +0                                    08422000
084230             WHEN SQLCODE = -904                                  08423000
084240             WHEN SQLCODE = -913                                  08424000
084250                 CONTINUE                                         08425000
084260                                                                  08426000
084270             WHEN SQLWARN0 NOT = SPACES                           08427000
084280             WHEN SQLCODE < +0                                    08428000
084290             WHEN SQLCODE > +0                                    08429000
084300                 MOVE '6170-UPDATE-TVHTRIP'                       08430000
084310                                   TO DP013-PARAGRAPH             08431000
084320                 MOVE 'UPDATE MANIFEST NBR ON TVHTRIP'            08432000
084330                                   TO DP013-MESSAGE-TEXT(1)       08433000
084340                 MOVE DK-TRIP-ID   TO DP013-MESSAGE-TEXT(2)       08434000
084350                 MOVE SQLCA        TO DP013-SQLCA                 08435000
084360                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    08436000
084370                 SET DP013-DB2-ABEND                              08437000
084380                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08438000
084390                 PERFORM DP013-0000-PROCESS-ABEND                 08439000
084400         END-EVALUATE                                             08440000
084410     END-PERFORM.                                                 08441000
084420                                                                  08442000
084430     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08443000
084440             AND (SQLCODE NOT = +0)                               08444000
084450         MOVE '6170-UPDATE-TVHTRIP'                               08445000
084460                                   TO DP013-PARAGRAPH             08446000
084470         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              08447000
084480                                   TO DP013-MESSAGE-TEXT (1)      08448000
084490         MOVE 'TO UPDATE A TVHTRIP ROW'                           08449000
084500                                   TO DP013-MESSAGE-TEXT (2)      08450000
084510         MOVE SQLCA                TO DP013-SQLCA                 08451000
084520         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    08452000
084530         SET DP013-DB2-ABEND                                      08453000
084540             DP013-XCTL-DISPLAY-RESTART                           08454000
084550                                   TO TRUE                        08455000
084560         PERFORM DP013-0000-PROCESS-ABEND                         08456000
084570     END-IF.                                                      08457000
084580/                                                                 08458000
084590*----------------------------------------------------------------*08459000
084600*  DELETE SEAL ROW                                               *08460000
084610*----------------------------------------------------------------*08461000
084620 6180-DELETE-TVHSEAL.                                             08462000
084630                                                                  08463000
084640     PERFORM                                                      08464000
084650         WITH TEST AFTER                                          08465000
084660         VARYING PV-RETRY-COUNTER                                 08466000
084670         FROM 1 BY 1                                              08467000
084680         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08468000
084690             OR (SQLCODE = +0))                                   08469000
084700                                                                  08470000
084710         EXEC SQL                                                 08471000
084720           DELETE FROM TVHSEAL                                    08472000
084730           WHERE  TRIP_ID  = :DK-TRIP-ID                          08473000
084740             AND  SEAL_NBR = :DK-SEAL-NBR                         08474000
084750         END-EXEC                                                 08475000
084760                                                                  08476000
084770         EVALUATE TRUE                                            08477000
084780             WHEN SQLCODE = +0                                    08478000
084790             WHEN SQLCODE = -904                                  08479000
084800             WHEN SQLCODE = -913                                  08480000
084810                 CONTINUE                                         08481000
084820                                                                  08482000
084830             WHEN SQLWARN0 NOT = SPACES                           08483000
084840             WHEN SQLCODE < +0                                    08484000
084850             WHEN SQLCODE > +0                                    08485000
084860                 MOVE '6180-DELETE-TVHSEAL'                       08486000
084870                                   TO DP013-PARAGRAPH             08487000
084880                 MOVE 'DELETE A SEAL ROW ON TVHSEAL'              08488000
084890                                   TO DP013-MESSAGE-TEXT(1)       08489000
084900                 MOVE DK-TRIP-ID   TO DP013-MESSAGE-TEXT(2)       08490000
084910                 MOVE DK-SEAL-NBR  TO DP013-MESSAGE-TEXT(3)       08491000
084920                 MOVE SQLCA        TO DP013-SQLCA                 08492000
084930                 MOVE 'TVHSEAL'    TO DP013-DB2-TABLE-NAME (1)    08493000
084940                 SET DP013-DB2-ABEND                              08494000
084950                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08495000
084960                 PERFORM DP013-0000-PROCESS-ABEND                 08496000
084970         END-EVALUATE                                             08497000
084980     END-PERFORM.                                                 08498000
084990                                                                  08499000
085000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08500000
085010             AND (SQLCODE NOT = +0)                               08501000
085020         MOVE '6180-DELETE-TVHSEAL'                               08502000
085030                                   TO DP013-PARAGRAPH             08503000
085040         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              08504000
085050                                   TO DP013-MESSAGE-TEXT (1)      08505000
085060         MOVE 'TO DELETE A TVHSEAL ROW'                           08506000
085070                                   TO DP013-MESSAGE-TEXT (2)      08507000
085080         MOVE SQLCA                TO DP013-SQLCA                 08508000
085090         MOVE 'TVHSEAL'            TO DP013-DB2-TABLE-NAME (1)    08509000
085100         SET DP013-DB2-ABEND                                      08510000
085110             DP013-XCTL-DISPLAY-RESTART                           08511000
085120                                   TO TRUE                        08512000
085130         PERFORM DP013-0000-PROCESS-ABEND                         08513000
085140     END-IF.                                                      08514000
085150                                                                  08515000
085160                                                                  08516000
085170 6200-OPEN-RECEIVR-CSR.                                           08517000
085180                                                                  08518000
085190     PERFORM                                                      08519000
085200         WITH TEST AFTER                                          08520000
085210         VARYING PV-RETRY-COUNTER                                 08521000
085220         FROM 1 BY 1                                              08522000
085230         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08523000
085240            OR (SQLCODE = +0))                                    08524000
085250                                                                  08525000
085260         EXEC SQL                                                 08526000
085270              OPEN RECEIVR-CSR                                    08527000
085280         END-EXEC                                                 08528000
085290                                                                  08529000
085300         EVALUATE TRUE                                            08530000
085310             WHEN SQLCODE = +0                                    08531000
085320                  CONTINUE                                        08532000
085330             WHEN SQLCODE = -904                                  08533000
085340             WHEN SQLCODE = -913                                  08534000
085350                  CONTINUE                                        08535000
085360             WHEN SQLWARN0 NOT = SPACE                            08536000
085370             WHEN SQLCODE  NOT = +0                               08537000
085380                  MOVE '6200-OPEN-RECEIVR-CSR'                    08538000
085390                                   TO DP013-PARAGRAPH             08539000
085400                  MOVE 'OPEN RECEIVER CURSOR'                     08540000
085410                                   TO DP013-MESSAGE-TEXT (1)      08541000
085420                  MOVE DK-TRIP-ID  TO DP013-MESSAGE-TEXT (2)      08542000
085430                  MOVE SQLCA       TO DP013-SQLCA                 08543000
085440                  MOVE 'TRECEIV'   TO DP013-DB2-TABLE-NAME (1)    08544000
085450                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (2)    08545000
085460                  MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (3)    08546000
085470                  SET DP013-DB2-ABEND                             08547000
085480                                   TO TRUE                        08548000
085490                  PERFORM DP013-0000-PROCESS-ABEND                08549000
085500         END-EVALUATE                                             08550000
085510     END-PERFORM.                                                 08551000
085520                                                                  08552000
085530     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08553000
085540             AND (SQLCODE NOT = +0)                               08554000
085550         MOVE '6200-OPEN-RECEIVR-CSR'                             08555000
085560                                   TO DP013-PARAGRAPH             08556000
085570         MOVE 'MAX RETRIES EXCEEDED FOR OPEN RECEIVR CURSOR'      08557000
085580                                   TO DP013-MESSAGE-TEXT (1)      08558000
085590         MOVE SQLCA                TO DP013-SQLCA                 08559000
085600         SET DP013-DB2-ABEND       TO TRUE                        08560000
085610         PERFORM DP013-0000-PROCESS-ABEND                         08561000
085620     END-IF.                                                      08562000
085630                                                                  08563000
085640/                                                                 08564000
085650*----------------------------------------------------------------*08565000
085660*    FETCH A RECEIVR ROW                                         *08566000
085670*----------------------------------------------------------------*08567000
085680                                                                  08568000
085690 6210-FETCH-RECEIVR-CSR.                                          08569000
085700                                                                  08570000
085710     EXEC SQL                                                     08571000
085720          FETCH RECEIVR-CSR                                       08572000
085730          INTO :RECEIV-ORD-NBR                                    08573000
085740             , :RECEIV-REC-SEQ-NBR                                08574000
085750             , :RECEIV-STATUS-CDE                                 08575000
085760             , :RECEIV-CRE-TMST                                   08576000
085770     END-EXEC                                                     08577000
085780                                                                  08578000
085790     EVALUATE TRUE                                                08579000
085800         WHEN SQLCODE = +0                                        08580000
085810             IF  RECEIV-STATUS-CDE = 'IP' OR 'CM' OR 'VE'         08581005
085820                 PERFORM 2300-CALL-AUTOVE-MODULE                  08582000
085830                 IF RC040-AUTO-VE-YES                             08583000
085840                     SET ASC-AUTO-VE            TO TRUE           08584000
085850                 END-IF                                           08585000
085860             END-IF                                               08586000
085870                                                                  08587000
085880         WHEN SQLCODE = +100                                      08588000
085890              SET PS-NO-MORE-RECEIVRS TO TRUE                     08589000
085900                                                                  08590000
085910         WHEN SQLWARN0 NOT = SPACE                                08591000
085920         WHEN SQLCODE < +0                                        08592000
085930         WHEN SQLCODE > +0                                        08593000
085940              MOVE '6210-FETCH-RECEIVR-CSR'                       08594000
085950                                   TO DP013-PARAGRAPH             08595000
085960              MOVE 'FETCH RECEIVR CURSOR'                         08596000
085970                                   TO DP013-MESSAGE-TEXT (1)      08597000
085980              MOVE SHIPMT-SHIPT-ID TO DP013-MESSAGE-TEXT (2)      08598000
085990              MOVE SQLCA           TO DP013-SQLCA                 08599000
086000              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (1)    08600000
086010              MOVE 'TSHPTPO'       TO DP013-DB2-TABLE-NAME (2)    08601000
086020              MOVE 'TSHIPMT'       TO DP013-DB2-TABLE-NAME (3)    08602000
086030              SET DP013-DB2-ABEND  TO TRUE                        08603000
086040              PERFORM DP013-0000-PROCESS-ABEND                    08604000
086050     END-EVALUATE.                                                08605000
086060                                                                  08606000
086070/                                                                 08607000
086080*----------------------------------------------------------------*08608000
086090* CLOSE THE RECEIVR CURSOR                                       *08609000
086100*----------------------------------------------------------------*08610000
086110                                                                  08611000
086120 6220-CLOSE-RECEIVR-CSR.                                          08612000
086130                                                                  08613000
086140     EXEC SQL                                                     08614000
086150          CLOSE RECEIVR-CSR                                       08615000
086160     END-EXEC                                                     08616000
086170                                                                  08617000
086180     EVALUATE TRUE                                                08618000
086190         WHEN SQLCODE = +0                                        08619000
086200              CONTINUE                                            08620000
086210         WHEN SQLWARN0 NOT = SPACE                                08621000
086220         WHEN SQLCODE  NOT = +0                                   08622000
086230              MOVE '6220-CLOSE-RECEIVR-CSR'                       08623000
086240                                   TO DP013-PARAGRAPH             08624000
086250              MOVE 'CLOSE RECEIVR CURSOR'                         08625000
086260                                   TO DP013-MESSAGE-TEXT (1)      08626000
086270              MOVE SQLCA           TO DP013-SQLCA                 08627000
086280              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (1)    08628000
086290              MOVE 'TSHPTPO'       TO DP013-DB2-TABLE-NAME (2)    08629000
086300              MOVE 'TSHIPMT'       TO DP013-DB2-TABLE-NAME (3)    08630000
086310              SET DP013-DB2-ABEND  TO TRUE                        08631000
086320              PERFORM DP013-0000-PROCESS-ABEND                    08632000
086330     END-EVALUATE.                                                08633000
086340                                                                  08634000
086350/                                                                 08635000
086360 6300-UPDATE-RECEIV.                                              08636000
086370                                                                  08637000
086380     PERFORM                                                      08638000
086390         WITH TEST AFTER                                          08639000
086400         VARYING PV-RETRY-COUNTER                                 08640000
086410         FROM 1 BY 1                                              08641000
086420         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08642000
086430             OR (SQLCODE = +0))                                   08643000
086440                                                                  08644000
086450         MOVE ASC-CURR-OPER-UNT-ID TO RECEIV-OPER-UNT-ID          08645000
086460         MOVE ASC-CURR-FCLTY-ID    TO RECEIV-FCLTY-ID             08646000
086470                                                                  08647000
086480         EXEC SQL                                                 08648000
086490           UPDATE TRECEIV                                         08649000
086500              SET REC_TMST      = :PV-REC-TMST                    08650000
086510           WHERE  ORD_NBR       = :RECEIV-ORD-NBR                 08651000
086520             AND  REC_SEQ_NBR   = :RECEIV-REC-SEQ-NBR             08652000
086530             AND  CRE_TMST      = :RECEIV-CRE-TMST                08653000
086540         END-EXEC                                                 08654000
086550                                                                  08655000
086560         EVALUATE TRUE                                            08656000
086570             WHEN SQLCODE = +0                                    08657000
086580             WHEN SQLCODE = -904                                  08658000
086590             WHEN SQLCODE = -913                                  08659000
086600                 CONTINUE                                         08660000
086610                                                                  08661000
086620             WHEN SQLWARN0 NOT = SPACE                            08662000
086630             WHEN SQLCODE < +0                                    08663000
086640             WHEN SQLCODE > +0                                    08664000
086650                 MOVE '6300-UPDATE-RECEIV'                        08665000
086660                                 TO DP013-PARAGRAPH               08666000
086670                 MOVE 'UPDATE ON RECEIPTS TABLE'                  08667000
086680                                 TO DP013-MESSAGE-TEXT (1)        08668000
086690                 MOVE SQLCA      TO DP013-SQLCA                   08669000
086700                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      08670000
086710                     SET DP013-DB2-ABEND                          08671000
086720                         DP013-XCTL-DISPLAY-RESTART               08672000
086730                                     TO TRUE                      08673000
086740                 PERFORM DP013-0000-PROCESS-ABEND                 08674000
086750         END-EVALUATE                                             08675000
086760     END-PERFORM.                                                 08676000
086770                                                                  08677000
086780     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08678000
086790             AND (SQLCODE NOT = +0)                               08679000
086800         MOVE '6300-UPDATE-RECEIV'                                08680000
086810                                  TO DP013-PARAGRAPH              08681000
086820         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON TRECEIV'         08682000
086830                                  TO DP013-MESSAGE-TEXT (1)       08683000
086840         MOVE SQLCA               TO DP013-SQLCA                  08684000
086850         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     08685000
086860         SET DP013-DB2-ABEND                                      08686000
086870             DP013-XCTL-DISPLAY-RESTART                           08687000
086880                                  TO TRUE                         08688000
086890         PERFORM DP013-0000-PROCESS-ABEND                         08689000
086900     END-IF.                                                      08690000
086910                                                                  08691000
086920/                                                                 08692000
086930 6400-UPDATE-RECEIV-OPER.                                         08693000
086940                                                                  08694000
086950     PERFORM                                                      08695000
086960         WITH TEST AFTER                                          08696000
086970         VARYING PV-RETRY-COUNTER                                 08697000
086980         FROM 1 BY 1                                              08698000
086990         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08699000
087000             OR (SQLCODE = +0))                                   08700000
087010                                                                  08701000
087020         MOVE ASC-CURR-OPER-UNT-ID TO RECEIV-OPER-UNT-ID          08702000
087030                                      RECEIV-CURR-OPER-UNT-ID     08703000
087040         MOVE ASC-CURR-FCLTY-ID    TO RECEIV-FCLTY-ID             08704000
087050                                      RECEIV-CURR-FCLTY-ID        08705000
087060                                                                  08706000
087070         EXEC SQL                                                 08707000
087080           UPDATE TRECEIV                                         08708000
087090              SET CURR_OPER_UNT_ID   = :RECEIV-CURR-OPER-UNT-ID   08709000
087100                , CURR_FCLTY_ID      = :RECEIV-CURR-FCLTY-ID      08710000
087110           WHERE  ORD_NBR            = :RECEIV-ORD-NBR            08711000
087120             AND  REC_SEQ_NBR        = :RECEIV-REC-SEQ-NBR        08712000
087130             AND  CRE_TMST           = :RECEIV-CRE-TMST           08713000
087140         END-EXEC                                                 08714000
087150                                                                  08715000
087160         EVALUATE TRUE                                            08716000
087170             WHEN SQLCODE = +0                                    08717000
087180             WHEN SQLCODE = -904                                  08718000
087190             WHEN SQLCODE = -913                                  08719000
087200                 CONTINUE                                         08720000
087210                                                                  08721000
087220             WHEN SQLWARN0 NOT = SPACE                            08722000
087230             WHEN SQLCODE < +0                                    08723000
087240             WHEN SQLCODE > +0                                    08724000
087250                 MOVE '6400-UPDATE-RECEIV-OPER'                   08725000
087260                                 TO DP013-PARAGRAPH               08726000
087270                 MOVE 'UPDATE ON RECEIPTS TABLE'                  08727000
087280                                 TO DP013-MESSAGE-TEXT (1)        08728000
087290                 MOVE SQLCA      TO DP013-SQLCA                   08729000
087300                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      08730000
087310                     SET DP013-DB2-ABEND                          08731000
087320                         DP013-XCTL-DISPLAY-RESTART               08732000
087330                                     TO TRUE                      08733000
087340                 PERFORM DP013-0000-PROCESS-ABEND                 08734000
087350         END-EVALUATE                                             08735000
087360     END-PERFORM.                                                 08736000
087370                                                                  08737000
087380     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08738000
087390             AND (SQLCODE NOT = +0)                               08739000
087400         MOVE '6400-UPDATE-RECEIV-OPER'                           08740000
087410                                  TO DP013-PARAGRAPH              08741000
087420         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON TRECEIV'         08742000
087430                                  TO DP013-MESSAGE-TEXT (1)       08743000
087440         MOVE SQLCA               TO DP013-SQLCA                  08744000
087450         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     08745000
087460         SET DP013-DB2-ABEND                                      08746000
087470             DP013-XCTL-DISPLAY-RESTART                           08747000
087480                                  TO TRUE                         08748000
087490         PERFORM DP013-0000-PROCESS-ABEND                         08749000
087500     END-IF.                                                      08750000
087510                                                                  08751000
087520/                                                                 08752000
087530                                                                  08753000
087540 6500-OPEN-TRIPST-CSR.                                            08754000
087550                                                                  08755000
087560     EXEC SQL                                                     08756000
087570          OPEN TRIPST-CSR                                         08757000
087580     END-EXEC.                                                    08758000
087590                                                                  08759000
087600     EVALUATE TRUE                                                08760000
087610         WHEN SQLCODE = +0                                        08761000
087620              CONTINUE                                            08762000
087630         WHEN SQLWARN0 NOT = SPACE                                08763000
087640         WHEN SQLCODE  NOT = +0                                   08764000
087650              MOVE '6500-OPEN-TRIPST-CSR'                         08765000
087660                               TO DP013-PARAGRAPH                 08766000
087670              MOVE 'OPEN RECEIVER CURSOR'                         08767000
087680                               TO DP013-MESSAGE-TEXT (1)          08768000
087690              MOVE DK-TRIP-ID  TO DP013-MESSAGE-TEXT (2)          08769000
087700              MOVE SQLCA       TO DP013-SQLCA                     08770000
087710              MOVE 'TRECEIV'   TO DP013-DB2-TABLE-NAME (1)        08771000
087720              MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (2)        08772000
087730              MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (3)        08773000
087740              SET DP013-DB2-ABEND                                 08774000
087750                               TO TRUE                            08775000
087760              PERFORM DP013-0000-PROCESS-ABEND                    08776000
087770     END-EVALUATE.                                                08777000
087780                                                                  08778000
087790                                                                  08779000
087800/                                                                 08780000
087810*----------------------------------------------------------------*08781000
087820*    FETCH A TRIPST ROW                                          *08782000
087830*----------------------------------------------------------------*08783000
087840                                                                  08784000
087850 6600-FETCH-TRIPST-CSR.                                           08785000
087860                                                                  08786000
087870     EXEC SQL                                                     08787000
087880          FETCH TRIPST-CSR                                        08788000
087890          INTO :TRIPST-TRIP-STATUS-CDE                            08789000
087900     END-EXEC                                                     08790000
087910                                                                  08791000
087920     EVALUATE TRUE                                                08792000
087930         WHEN SQLCODE = +0                                        08793000
087940              CONTINUE                                            08794000
087950                                                                  08795000
087960         WHEN SQLCODE = +100                                      08796000
087970              SET PS-NO-MORE-TRIPST TO TRUE                       08797000
087980                                                                  08798000
087990         WHEN SQLWARN0 NOT = SPACE                                08799000
088000         WHEN SQLCODE < +0                                        08800000
088010         WHEN SQLCODE > +0                                        08801000
088020              MOVE '6600-FETCH-TRIPST-CSR'                        08802000
088030                                   TO DP013-PARAGRAPH             08803000
088040              MOVE 'FETCH TRIPST CURSOR'                          08804000
088050                                   TO DP013-MESSAGE-TEXT (1)      08805000
088060              MOVE DK-TRIP-ID      TO DP013-MESSAGE-TEXT (2)      08806000
088070              MOVE SQLCA           TO DP013-SQLCA                 08807000
088080              MOVE 'TTRIPST'       TO DP013-DB2-TABLE-NAME (1)    08808000
088090              SET DP013-DB2-ABEND  TO TRUE                        08809000
088100              PERFORM DP013-0000-PROCESS-ABEND                    08810000
088110     END-EVALUATE.                                                08811000
088120                                                                  08812000
088130/                                                                 08813000
088140*----------------------------------------------------------------*08814000
088150* CLOSE THE TRIPST CURSOR                                        *08815000
088160*----------------------------------------------------------------*08816000
088170                                                                  08817000
088180 6700-CLOSE-TRIPST-CSR.                                           08818000
088190                                                                  08819000
088200     EXEC SQL                                                     08820000
088210          CLOSE TRIPST-CSR                                        08821000
088220     END-EXEC.                                                    08822000
088230                                                                  08823000
088240     EVALUATE TRUE                                                08824000
088250         WHEN SQLCODE = +0                                        08825000
088260              CONTINUE                                            08826000
088270         WHEN SQLWARN0 NOT = SPACE                                08827000
088280         WHEN SQLCODE  NOT = +0                                   08828000
088290              MOVE '6700-CLOSE-TRIPST-CSR'                        08829000
088300                                   TO DP013-PARAGRAPH             08830000
088310              MOVE 'CLOSE TRIPST CURSOR'                          08831000
088320                                   TO DP013-MESSAGE-TEXT (1)      08832000
088330              MOVE SQLCA           TO DP013-SQLCA                 08833000
088340              MOVE 'TTRIPST'       TO DP013-DB2-TABLE-NAME (1)    08834000
088350              SET DP013-DB2-ABEND  TO TRUE                        08835000
088360              PERFORM DP013-0000-PROCESS-ABEND                    08836000
088370     END-EVALUATE.                                                08837000
088380                                                                  08838000
088390/                                                                 08839000
088400 6800-UPDATE-TRIPST.                                              08840000
088410                                                                  08841000
088420     MOVE ASC-CURR-OPER-UNT-ID TO TRIPST-OPER-UNT-ID.             08842000
088430     MOVE ASC-CURR-FCLTY-ID    TO TRIPST-FCLTY-ID.                08843000
088440                                                                  08844000
088450     EXEC SQL                                                     08845000
088460       UPDATE TTRIPST                                             08846000
088470          SET OPER_UNT_ID     = :TRIPST-OPER-UNT-ID               08847000
088480            , FCLTY_ID        = :TRIPST-FCLTY-ID                  08848000
088490       WHERE  TRIP_ID         = :DK-TRIP-ID                       08849000
088500         AND  TRIP_STATUS_CDE = :TRIPST-TRIP-STATUS-CDE           08850000
088510     END-EXEC                                                     08851000
088520                                                                  08852000
088530     EVALUATE TRUE                                                08853000
088540         WHEN SQLCODE = +0                                        08854000
088550         WHEN SQLCODE = -904                                      08855000
088560         WHEN SQLCODE = -913                                      08856000
088570             CONTINUE                                             08857000
088580                                                                  08858000
088590         WHEN SQLWARN0 NOT = SPACE                                08859000
088600         WHEN SQLCODE < +0                                        08860000
088610         WHEN SQLCODE > +0                                        08861000
088620             MOVE '6800-UPDATE-TRIPST'                            08862000
088630                             TO DP013-PARAGRAPH                   08863000
088640             MOVE 'UPDATE ON TTRIPST TABLE'                       08864000
088650                             TO DP013-MESSAGE-TEXT (1)            08865000
088660             MOVE SQLCA      TO DP013-SQLCA                       08866000
088670             MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)          08867000
088680                 SET DP013-DB2-ABEND                              08868000
088690                     DP013-XCTL-DISPLAY-RESTART                   08869000
088700                                 TO TRUE                          08870000
088710             PERFORM DP013-0000-PROCESS-ABEND                     08871000
088720     END-EVALUATE.                                                08872000
088730                                                                  08873000
088740/                                                                 08874000
088750*----------------------------------------------------------------*08875000
088760* OPEN THE SHPTPO CURSOR                                         *08876000
088770*----------------------------------------------------------------*08877000
088780 6900-OPEN-SHPTPO-CSR.                                            08878000
088790                                                                  08879000
088800     PERFORM                                                      08880000
088810         WITH TEST AFTER                                          08881000
088820         VARYING PV-RETRY-COUNTER                                 08882000
088830         FROM 1 BY 1                                              08883000
088840         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08884000
088850            OR (SQLCODE = +0))                                    08885000
088860                                                                  08886000
088870         EXEC SQL                                                 08887000
088880              OPEN SHPTPO-CSR                                     08888000
088890         END-EXEC                                                 08889000
088900                                                                  08890000
088910         EVALUATE TRUE                                            08891000
088920             WHEN SQLCODE = +0                                    08892000
088930                  CONTINUE                                        08893000
088940             WHEN SQLCODE = -904                                  08894000
088950             WHEN SQLCODE = -913                                  08895000
088960                  CONTINUE                                        08896000
088970             WHEN SQLWARN0 NOT = SPACE                            08897000
088980             WHEN SQLCODE  NOT = +0                               08898000
088990                  MOVE '6900-OPEN-SHPTPO-CSR'                     08899000
089000                                   TO DP013-PARAGRAPH             08900000
089010                  MOVE 'OPEN SHPTPO CURSOR'                       08901000
089020                                   TO DP013-MESSAGE-TEXT (1)      08902000
089030                  MOVE DK-SHIPT-ID                                08903000
089040                                   TO DP013-MESSAGE-TEXT (2)      08904000
089050                  MOVE SQLCA       TO DP013-SQLCA                 08905000
089060                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (1)    08906000
089070                  SET DP013-DB2-ABEND                             08907000
089080                                   TO TRUE                        08908000
089090                  PERFORM DP013-0000-PROCESS-ABEND                08909000
089100         END-EVALUATE                                             08910000
089110     END-PERFORM.                                                 08911000
089120                                                                  08912000
089130     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08913000
089140             AND (SQLCODE NOT = +0)                               08914000
089150         MOVE '6900-OPEN-SHPTPO-CSR'                              08915000
089160                                   TO DP013-PARAGRAPH             08916000
089170         MOVE 'MAX RETRIES EXCEEDED FOR OPEN SHPTPO CURSOR'       08917000
089180                                   TO DP013-MESSAGE-TEXT (1)      08918000
089190         MOVE SQLCA                TO DP013-SQLCA                 08919000
089200         SET DP013-DB2-ABEND       TO TRUE                        08920000
089210         PERFORM DP013-0000-PROCESS-ABEND                         08921000
089220     END-IF.                                                      08922000
089230/                                                                 08923000
089240*----------------------------------------------------------------*08924000
089250*    FETCH A SHPTPO ROW                                          *08925000
089260*----------------------------------------------------------------*08926000
089270 6910-FETCH-SHPTPO-CSR.                                           08927000
089280                                                                  08928000
089290     EXEC SQL                                                     08929000
089300          FETCH SHPTPO-CSR                                        08930000
089310          INTO :SHPTPO-PO-NBR                                     08931000
089320     END-EXEC                                                     08932000
089330                                                                  08933000
089340     EVALUATE TRUE                                                08934000
089350         WHEN SQLCODE = +0                                        08935000
089360              CONTINUE                                            08936000
089370                                                                  08937000
089380         WHEN SQLCODE = +100                                      08938000
089390              SET PS-NO-MORE-SHPTPO TO TRUE                       08939000
089400                                                                  08940000
089410         WHEN SQLWARN0 NOT = SPACE                                08941000
089420         WHEN SQLCODE < +0                                        08942000
089430         WHEN SQLCODE > +0                                        08943000
089440              MOVE '6910-FETCH-SHPTPO-CSR'                        08944000
089450                                   TO DP013-PARAGRAPH             08945000
089460              MOVE 'FETCH SHPTPO CURSOR'                          08946000
089470                                   TO DP013-MESSAGE-TEXT (1)      08947000
089480              MOVE SHPTPO-SHIPT-ID TO DP013-MESSAGE-TEXT (2)      08948000
089490              MOVE SQLCA           TO DP013-SQLCA                 08949000
089500              MOVE 'TSHPTPO'       TO DP013-DB2-TABLE-NAME (1)    08950000
089510              SET DP013-DB2-ABEND  TO TRUE                        08951000
089520              PERFORM DP013-0000-PROCESS-ABEND                    08952000
089530     END-EVALUATE.                                                08953000
089540/                                                                 08954000
089550*----------------------------------------------------------------*08955000
089560* CLOSE THE SHPTPO CURSOR                                        *08956000
089570*----------------------------------------------------------------*08957000
089580 6920-CLOSE-SHPTPO-CSR.                                           08958000
089590                                                                  08959000
089600     EXEC SQL                                                     08960000
089610          CLOSE SHPTPO-CSR                                        08961000
089620     END-EXEC                                                     08962000
089630                                                                  08963000
089640     EVALUATE TRUE                                                08964000
089650         WHEN SQLCODE = +0                                        08965000
089660              CONTINUE                                            08966000
089670         WHEN SQLWARN0 NOT = SPACE                                08967000
089680         WHEN SQLCODE  NOT = +0                                   08968000
089690              MOVE '6920-CLOSE-SHPTPO-CSR'                        08969000
089700                                   TO DP013-PARAGRAPH             08970000
089710              MOVE 'CLOSE SHPTPO CURSOR'                          08971000
089720                                   TO DP013-MESSAGE-TEXT (1)      08972000
089730              MOVE SQLCA           TO DP013-SQLCA                 08973000
089740              MOVE 'TSHPTPO'       TO DP013-DB2-TABLE-NAME (1)    08974000
089750              SET DP013-DB2-ABEND  TO TRUE                        08975000
089760              PERFORM DP013-0000-PROCESS-ABEND                    08976000
089770     END-EVALUATE.                                                08977000
089780/                                                                 08978000
089790*----------------------------------------------------------------*08979000
089800* DELETE A VEHICLE                                               *08980000
089810*----------------------------------------------------------------*08981000
089820 7000-DELETE-VEHICLE.                                             08982000
089830                                                                  08983000
089840     MOVE ASC-KEY-OWNER-SCAC-ID  TO DK-OWNER-SCAC-ID.             08984000
089850     MOVE ASC-KEY-VEH-NBR        TO DK-VEH-NBR.                   08985000
089860     MOVE ASC-PLND-TRIP-SEQ      TO DK-PLND-TRIP-SEQ.             08986000
089870     MOVE ASC-KEY-TRIP-ID        TO DK-TRIP-ID.                   08987000
089880                                                                  08988000
089890     PERFORM 4100-SELECT-TVEHICL.                                 08989000
089900     IF DK-TRIP-ID =  VEHICL-CURR-TRIP-ID                         08990000
089910         PERFORM 7030-DELETE-CURRENT-STOP                         08991000
089920         MOVE 'N' TO PS-SHPTPO-CURSOR-SW                          08992000
089930         SET PS-DONT-UPDATE-TIMPORL TO TRUE                       08993000
089940         PERFORM 6900-OPEN-SHPTPO-CSR                             08994000
089950         PERFORM 6910-FETCH-SHPTPO-CSR                            08995000
089960         PERFORM UNTIL PS-NO-MORE-SHPTPO                          08996000
089970             PERFORM 7040-SELECT-TSHPTPO                          08997000
089980             IF PS-UPDATE-TIMPORL                                 08998000
089990                PERFORM 7050-UPDATE-TIMPORL                       08999000
090000             END-IF                                               09000000
090010             PERFORM 6910-FETCH-SHPTPO-CSR                        09001000
090020         END-PERFORM                                              09002000
090030         PERFORM 6920-CLOSE-SHPTPO-CSR                            09003000
090040                                                                  09004000
090050         MOVE PC-TSYMSG-00115        TO DP020-MSG-NUMBER          09005000
090060         SET DP020-MSG-INFORMATIONAL                              09006000
090070             ASC-DELETE-SUCCESSFUL   TO TRUE                      09007000
090080         IF  ASC-USE-SELECTION-QUEUE                              09008000
090090             PERFORM 5200-UPDATE-SELECTION-QUEUE                  09009000
090100         END-IF                                                   09010000
090110     ELSE                                                         09011000
090120         MOVE VEHICL-CURR-TRIP-ID    TO DK-TRIP-ID                09012000
090130         PERFORM 4120-SELECT-TVHTRIP                              09013000
090140         MOVE VHTRIP-PLND-TRIP-SEQ   TO PV-SAVE-PLND-TRIP-SEQ     09014000
090150         MOVE ASC-KEY-TRIP-ID        TO DK-TRIP-ID                09015000
090160         PERFORM 4120-SELECT-TVHTRIP                              09016000
090170         IF VHTRIP-PLND-TRIP-SEQ > PV-SAVE-PLND-TRIP-SEQ          09017000
090180                                                                  09018000
090190             PERFORM 6150-SELECT-TTRIPST                          09019000
090200                                                                  09020000
090210             MOVE 'DE'               TO TRIPST-TRIP-STATUS-CDE    09021000
090220                                                                  09022000
090230             PERFORM 5400-INSERT-TTRIPST                          09023000
090240             MOVE 'N'                TO PS-SHIPMENT-CURSOR-SW     09024000
090250             MOVE VHTRIP-TRIP-ID TO DK-TRIP-ID                    09025000
090260             PERFORM 6100-OPEN-SHIPMENT-CSR                       09026000
090270             PERFORM 6102-FETCH-SHIPMENT-CSR                      09027000
090280             PERFORM UNTIL PS-NO-MORE-SHIPMENTS                   09028000
090290                 MOVE SHIPMT-SHIPT-ID                             09029000
090300                                 TO DK-SHIPT-ID                   09030000
090310                 PERFORM 6110-SELECT-TSHIPST                      09031000
090320                 MOVE 'ET'       TO SHIPST-SHIPT-STATUS-CDE       09032000
090330                 IF (ASC-VEH-TYP-CDE = 'VS' OR 'AV')  AND         09033000
090340                    SHIPST-CITY-NAME = SPACES OR LOW-VALUES       09034000
090350                     MOVE 'PORT OF ENTRY'                         09035000
090360                                 TO SHIPST-CITY-NAME              09036000
090370                 END-IF                                           09037000
090380                 PERFORM 6120-INSERT-TSHIPST                      09038000
090390                 PERFORM 6102-FETCH-SHIPMENT-CSR                  09039000
090400             END-PERFORM                                          09040000
090410             PERFORM 6104-CLOSE-SHIPMENT-CSR                      09041000
090420                                                                  09042000
090430             MOVE 'N' TO PS-SHPTPO-CURSOR-SW                      09043000
090440             SET PS-DONT-UPDATE-TIMPORL TO TRUE                   09044000
090450             PERFORM 6900-OPEN-SHPTPO-CSR                         09045000
090460             PERFORM 6910-FETCH-SHPTPO-CSR                        09046000
090470             PERFORM UNTIL PS-NO-MORE-SHPTPO                      09047000
090480                 PERFORM 7040-SELECT-TSHPTPO                      09048000
090490                 IF PS-UPDATE-TIMPORL                             09049000
090500                    PERFORM 7050-UPDATE-TIMPORL                   09050000
090510                 END-IF                                           09051000
090520                 PERFORM 6910-FETCH-SHPTPO-CSR                    09052000
090530             END-PERFORM                                          09053000
090540             PERFORM 6920-CLOSE-SHPTPO-CSR                        09054000
090550                                                                  09055000
090560             MOVE PC-TSYMSG-00115        TO DP020-MSG-NUMBER      09056000
090570             SET DP020-MSG-INFORMATIONAL                          09057000
090580                 ASC-DELETE-SUCCESSFUL   TO TRUE                  09058000
090590             IF  ASC-USE-SELECTION-QUEUE                          09059000
090600                 PERFORM 5200-UPDATE-SELECTION-QUEUE              09060000
090610             END-IF                                               09061000
090620         ELSE                                                     09062000
090630             MOVE PC-TSYMSG-00747                                 09063000
090640                             TO DP020-MSG-NUMBER                  09064000
090650             SET DP020-MSG-WARNING                                09065000
090660                 DP020-NEXT-ACT-APPL-ERROR                        09066000
090670                             TO TRUE.                             09067000
090680                                                                  09068000
090690                                                                  09069000
090700/                                                                 09070000
090710*----------------------------------------------------------------*09071000
090720*  DELETE A TRIP WHICH IS THE CURRENT STOP                       *09072000
090730*----------------------------------------------------------------*09073000
090740 7030-DELETE-CURRENT-STOP.                                        09074000
090750                                                                  09075000
090760     MOVE VEHICL-CURR-TRIP-ID    TO DK-TRIP-ID.                   09076000
090770     PERFORM 6150-SELECT-TTRIPST.                                 09077000
090780     MOVE 'DE'                   TO TRIPST-TRIP-STATUS-CDE.       09078000
090790     PERFORM 5400-INSERT-TTRIPST.                                 09079000
090800                                                                  09080000
090810     INITIALIZE PV-DB2-COUNT.                                     09081000
090820     PERFORM 4125-COUNT-STOPS.                                    09082000
090830     COMPUTE PV-DB2-COUNT = PV-DB2-COUNT - 1.                     09083000
090840     IF PV-DB2-COUNT >  DK-PLND-TRIP-SEQ                          09084000
090850         PERFORM 6130-GET-NEXT-TRIP                               09085000
090860         IF  SQLCODE = +0                                         09086000
090870*         OR SQLCODE = -811                                       09087000
090880             MOVE VHTRIP-TRIP-ID     TO VEHICL-CURR-TRIP-ID       09088000
090890             MOVE +1                 TO DN-CURR-TRIP-ID           09089000
090900                                                                  09090000
090910             MOVE VEHICL-CURR-TRIP-ID    TO DK-TRIP-ID            09091000
090920             PERFORM 6150-SELECT-TTRIPST                          09092000
090930             MOVE TRIPST-TRIP-STATUS-CDE                          09093000
090940                                     TO VEHICL-CURR-STATUS-CDE    09094000
090950             PERFORM 6165-UPDATE-VEHICLE-STATUS                   09095000
090960             PERFORM 8000-AUDIT-TVEHICL                           09096000
090970             MOVE 'N'                TO PS-SHIPMENT-CURSOR-SW     09097000
090980             MOVE VHTRIP-TRIP-ID TO DK-TRIP-ID                    09098000
090990             PERFORM 6100-OPEN-SHIPMENT-CSR                       09099000
091000             PERFORM 6102-FETCH-SHIPMENT-CSR                      09100000
091010             PERFORM UNTIL PS-NO-MORE-SHIPMENTS                   09101000
091020                 MOVE SHIPMT-SHIPT-ID                             09102000
091030                                 TO DK-SHIPT-ID                   09103000
091040                 PERFORM 6110-SELECT-TSHIPST                      09104000
091050                 MOVE 'ET'       TO SHIPST-SHIPT-STATUS-CDE       09105000
091060                 IF (ASC-VEH-TYP-CDE = 'VS' OR 'AV')  AND         09106000
091070                    SHIPST-CITY-NAME = SPACES OR LOW-VALUES       09107000
091080                     MOVE 'PORT OF ENTRY'                         09108000
091090                                 TO SHIPST-CITY-NAME              09109000
091100                 END-IF                                           09110000
091110                 PERFORM 6120-INSERT-TSHIPST                      09111000
091120                 PERFORM 6102-FETCH-SHIPMENT-CSR                  09112000
091130             END-PERFORM                                          09113000
091140             PERFORM 6104-CLOSE-SHIPMENT-CSR                      09114000
091150        ELSE                                                      09115000
091160            MOVE '7030-DELETE-CURRRENT-STOP'                      09116000
091170                             TO DP013-PARAGRAPH                   09117000
091180            MOVE 'GET NEXT-TTRIP'                                 09118000
091190                             TO DP013-MESSAGE-TEXT (1)            09119000
091200            MOVE SQLCA       TO DP013-SQLCA                       09120000
091210            MOVE 'TVHTRIP'   TO DP013-DB2-TABLE-NAME (1)          09121000
091220            SET DP013-DB2-ABEND                                   09122000
091230                             TO TRUE                              09123000
091240            PERFORM DP013-0000-PROCESS-ABEND                      09124000
091250        END-IF                                                    09125000
091260     ELSE                                                         09126000
091270         MOVE ASC-KEY-OWNER-SCAC-ID    TO DK-OWNER-SCAC-ID.       09127000
091280         MOVE ASC-KEY-VEH-NBR          TO DK-VEH-NBR.             09128000
091290         PERFORM 7200-OPEN-TRIP-CSR.                              09129000
091300         SET PS-START-OF-TRIPS TO TRUE                            09130000
091310         PERFORM 7300-FETCH-TRIP-CSR                              09131000
091320         PERFORM UNTIL PS-END-OF-TRIPS                            09132000
091330             MOVE 'N'                TO PS-SHIPMENT-CURSOR-SW     09133000
091340             MOVE TRIPST-TRIP-ID TO DK-TRIP-ID                    09134000
091350             PERFORM 6100-OPEN-SHIPMENT-CSR                       09135000
091360             PERFORM 6102-FETCH-SHIPMENT-CSR                      09136000
091370             PERFORM UNTIL PS-NO-MORE-SHIPMENTS                   09137000
091380                 MOVE SHIPMT-SHIPT-ID                             09138000
091390                                 TO DK-SHIPT-ID                   09139000
091400                 PERFORM 6110-SELECT-TSHIPST                      09140000
091410                 MOVE 'ET'       TO SHIPST-SHIPT-STATUS-CDE       09141000
091420                 IF (ASC-VEH-TYP-CDE = 'VS' OR 'AV')  AND         09142000
091430                    SHIPST-CITY-NAME = SPACES OR LOW-VALUES       09143000
091440                     MOVE 'PORT OF ENTRY'                         09144000
091450                                 TO SHIPST-CITY-NAME              09145000
091460                 END-IF                                           09146000
091470                 PERFORM 6120-INSERT-TSHIPST                      09147000
091480                 PERFORM 6102-FETCH-SHIPMENT-CSR                  09148000
091490             END-PERFORM                                          09149000
091500             PERFORM 6104-CLOSE-SHIPMENT-CSR                      09150000
091510             PERFORM 7300-FETCH-TRIP-CSR                          09151000
091520         END-PERFORM                                              09152000
091530         PERFORM 7400-CLOSE-TRIP-CSR.                             09153000
091540         PERFORM 7100-DELETE-ALL-TRIP-STOPS                       09154000
091550         MOVE +0                 TO VEHICL-CURR-TRIP-ID           09155000
091560         MOVE -1                 TO DN-CURR-TRIP-ID               09156000
091570         MOVE 'ET'               TO VEHICL-CURR-STATUS-CDE        09157000
091580                                                                  09158000
091590         PERFORM 6165-UPDATE-VEHICLE-STATUS                       09159000
091600         PERFORM 8000-AUDIT-TVEHICL.                              09160000
091610/                                                                 09161000
091620 7040-SELECT-TSHPTPO.                                             09162000
091630                                                                  09163000
091640         EXEC SQL                                                 09164000
091650              SELECT  DISTINCT                                    09165000
091660                      PO_NBR                                      09166000
091670                INTO :SHPTPO-PO-NBR                               09167000
091680                FROM  TSHPTPO SP                                  09168000
091690                    , TSHSTYP Y                                   09169000
091700                    , TSHIPST X                                   09170000
091710               WHERE  SP.SHIPT_ID = X.SHIPT_ID                    09171000
091720                 AND  SP.PO_NBR   =  :SHPTPO-PO-NBR               09172000
091730                 AND  Y.SHIPT_STATUS_CDE = X.SHIPT_STATUS_CDE     09173000
091740                 AND  Y.PRTY_CDE =                                09174000
091750                      (SELECT MAX(TY.PRTY_CDE)                    09175000
091760                         FROM   TSHIPST ST                        09176000
091770                              , TSHSTYP TY                        09177000
091780                        WHERE ST.SHIPT_ID = X.SHIPT_ID            09178000
091790                          AND ST.SHIPT_STATUS_CDE =               09179000
091800                              TY.SHIPT_STATUS_CDE)                09180000
091810                 AND  Y.PRTY_CDE < '95'                           09181000
091820         END-EXEC                                                 09182000
091830                                                                  09183000
091840         EVALUATE TRUE                                            09184000
091850             WHEN SQLCODE = +100                                  09185000
091860                  SET PS-UPDATE-TIMPORL TO TRUE                   09186000
091870                                                                  09187000
091880             WHEN SQLCODE = ZERO                                  09188000
091890             WHEN SQLCODE = -904                                  09189000
091900             WHEN SQLCODE = -913                                  09190000
091910                  SET PS-DONT-UPDATE-TIMPORL TO TRUE              09191000
091920                                                                  09192000
091930             WHEN SQLWARN0 NOT = SPACES                           09193000
091940             WHEN SQLCODE < +0                                    09194000
091950             WHEN SQLCODE > +0                                    09195000
091960                  MOVE '7040-SELECT-TSHPTPO'                      09196000
091970                                  TO DP013-PARAGRAPH              09197000
091980                  MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '         09198000
091990                                  TO DP013-MESSAGE-TEXT (1)       09199000
092000                  MOVE SQLCA      TO DP013-SQLCA                  09200000
092010                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     09201000
092020                  SET DP013-DB2-ABEND                             09202000
092030                      DP013-XCTL-DISPLAY-RESTART                  09203000
092040                                  TO TRUE                         09204000
092050                  PERFORM DP013-0000-PROCESS-ABEND                09205000
092060         END-EVALUATE.                                            09206000
092070/                                                                 09207000
092080 7050-UPDATE-TIMPORL.                                             09208000
092090                                                                  09209000
092100     PERFORM                                                      09210000
092110         WITH TEST AFTER                                          09211000
092120         VARYING PV-RETRY-COUNTER                                 09212000
092130         FROM 1 BY 1                                              09213000
092140         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09214000
092150             OR (SQLCODE = +0))                                   09215000
092160                                                                  09216000
092170         EXEC SQL                                                 09217000
092180           UPDATE TIMPORL                                         09218000
092190              SET DCONSLR_RLSE_CDE = 'N'                          09219000
092200                 ,DCONSLR_ACTL_DTE = CURRENT DATE                 09220000
092210                 ,DCONSLR_ACTL_TM  = CURRENT TIME                 09221000
092220                 ,LAST_UPD_TMST   = CURRENT TIMESTAMP             09222000
092230                 ,LAST_UPD_BY_UID = :DP020-USERID                 09223000
092240           WHERE  PO_NBR   = :SHPTPO-PO-NBR                       09224000
092250             AND  VER_STATUS_CDE = 'A'                            09225000
092260         END-EXEC                                                 09226000
092270                                                                  09227000
092280         EVALUATE TRUE                                            09228000
092290             WHEN SQLCODE = +0                                    09229000
092300             WHEN SQLCODE = -904                                  09230000
092310             WHEN SQLCODE = -913                                  09231000
092320                 CONTINUE                                         09232000
092330                                                                  09233000
092340             WHEN SQLWARN0 NOT = SPACES                           09234000
092350             WHEN SQLCODE < +0                                    09235000
092360             WHEN SQLCODE > +0                                    09236000
092370                 MOVE '7050-UPDATE-TIMPORL'                       09237000
092380                                   TO DP013-PARAGRAPH             09238000
092390                 MOVE 'UPDATE INFO ON TIMPORL     '               09239000
092400                                   TO DP013-MESSAGE-TEXT(1)       09240000
092410                 MOVE SQLCA        TO DP013-SQLCA                 09241000
092420                 MOVE 'TIMPORL'    TO DP013-DB2-TABLE-NAME (1)    09242000
092430                 SET DP013-DB2-ABEND                              09243000
092440                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09244000
092450                 PERFORM DP013-0000-PROCESS-ABEND                 09245000
092460         END-EVALUATE                                             09246000
092470     END-PERFORM.                                                 09247000
092480                                                                  09248000
092490     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    09249000
092500         SQLCODE NOT = +0                                         09250000
092510         MOVE '7050-UPDATE-TIMPORL'                               09251000
092520                                   TO DP013-PARAGRAPH             09252000
092530         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              09253000
092540                                   TO DP013-MESSAGE-TEXT (1)      09254000
092550         MOVE 'TO UPDATE A TIMPORL ROW'                           09255000
092560                                   TO DP013-MESSAGE-TEXT (2)      09256000
092570         MOVE SQLCA                TO DP013-SQLCA                 09257000
092580         MOVE 'TIMPORL'            TO DP013-DB2-TABLE-NAME (1)    09258000
092590         SET DP013-DB2-ABEND                                      09259000
092600             DP013-XCTL-DISPLAY-RESTART                           09260000
092610                                   TO TRUE                        09261000
092620         PERFORM DP013-0000-PROCESS-ABEND                         09262000
092630     END-IF.                                                      09263000
092640/                                                                 09264000
092650*----------------------------------------------------------------*09265000
092660*  DELETE ALL TRIPS FOR THIS VEHICLE AND NULL OUT THE TRIP-ID    *09266000
092670*  ON ALL RELATED SHIPMENTS.                                     *09267000
092680*----------------------------------------------------------------*09268000
092690 7100-DELETE-ALL-TRIP-STOPS.                                      09269000
092700     MOVE ASC-KEY-OWNER-SCAC-ID    TO DK-OWNER-SCAC-ID.           09270000
092710     MOVE ASC-KEY-VEH-NBR          TO DK-VEH-NBR.                 09271000
092720     PERFORM 7200-OPEN-TRIP-CSR.                                  09272000
092730     SET PS-START-OF-TRIPS TO TRUE                                09273000
092740     PERFORM 7300-FETCH-TRIP-CSR                                  09274000
092750     PERFORM UNTIL PS-END-OF-TRIPS                                09275000
092760         MOVE 'ET'           TO TRIPST-TRIP-STATUS-CDE            09276000
092770         PERFORM 5400-INSERT-TTRIPST                              09277000
092780         PERFORM 7300-FETCH-TRIP-CSR                              09278000
092790     END-PERFORM                                                  09279000
092800     PERFORM 7400-CLOSE-TRIP-CSR.                                 09280000
092810*----------------------------------------------------------------*09281000
092820* OPEN THE SHIPMENT CURSROR                                      *09282000
092830*----------------------------------------------------------------*09283000
092840                                                                  09284000
092850 7200-OPEN-TRIP-CSR.                                              09285000
092860                                                                  09286000
092870     PERFORM                                                      09287000
092880         WITH TEST AFTER                                          09288000
092890         VARYING PV-RETRY-COUNTER                                 09289000
092900         FROM 1 BY 1                                              09290000
092910         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09291000
092920            OR (SQLCODE = +0))                                    09292000
092930                                                                  09293000
092940         EXEC SQL                                                 09294000
092950              OPEN TRIP-CSR                                       09295000
092960         END-EXEC                                                 09296000
092970                                                                  09297000
092980         EVALUATE TRUE                                            09298000
092990             WHEN SQLCODE = +0                                    09299000
093000                  CONTINUE                                        09300000
093010             WHEN SQLCODE = -904                                  09301000
093020             WHEN SQLCODE = -913                                  09302000
093030                  CONTINUE                                        09303000
093040             WHEN SQLWARN0 NOT = SPACE                            09304000
093050             WHEN SQLCODE  NOT = +0                               09305000
093060                  MOVE '7200-OPEN-TRIP-CSR'                       09306000
093070                                   TO DP013-PARAGRAPH             09307000
093080                  MOVE 'OPEN SHIPMENT CURSOR'                     09308000
093090                                   TO DP013-MESSAGE-TEXT (1)      09309000
093100                  MOVE DK-VEH-NBR  TO DP013-MESSAGE-TEXT (2)      09310000
093110                  MOVE DK-OWNER-SCAC-ID                           09311000
093120                                   TO DP013-MESSAGE-TEXT (3)      09312000
093130                  MOVE SQLCA       TO DP013-SQLCA                 09313000
093140                  MOVE 'TVHTRIP'   TO DP013-DB2-TABLE-NAME (1)    09314000
093150                  SET DP013-DB2-ABEND                             09315000
093160                                   TO TRUE                        09316000
093170                  PERFORM DP013-0000-PROCESS-ABEND                09317000
093180         END-EVALUATE                                             09318000
093190     END-PERFORM.                                                 09319000
093200                                                                  09320000
093210     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09321000
093220             AND (SQLCODE NOT = +0)                               09322000
093230         MOVE '7200-OPEN-TRIP-CSR'                                09323000
093240                                   TO DP013-PARAGRAPH             09324000
093250         MOVE 'MAX RETRIES EXCEEDED FOR OPEN TRIP CURSOR'         09325000
093260                                   TO DP013-MESSAGE-TEXT (1)      09326000
093270         MOVE SQLCA                TO DP013-SQLCA                 09327000
093280         SET DP013-DB2-ABEND       TO TRUE                        09328000
093290         PERFORM DP013-0000-PROCESS-ABEND                         09329000
093300     END-IF.                                                      09330000
093310                                                                  09331000
093320/                                                                 09332000
093330*----------------------------------------------------------------*09333000
093340*    FETCH A TRIP ROW                                            *09334000
093350*----------------------------------------------------------------*09335000
093360                                                                  09336000
093370 7300-FETCH-TRIP-CSR.                                             09337000
093380                                                                  09338000
093390     EXEC SQL                                                     09339000
093400          FETCH TRIP-CSR                                          09340000
093410              INTO   :TRIPST-TRIP-ID                              09341000
093420*                   ,:TRIPST-TRIP-STATUS-CDE                      09342000
093430*                   ,:TRIPST-OPER-UNT-ID                          09343000
093440*                   ,:TRIPST-FCLTY-ID                             09344000
093450*                   ,:TRIPST-FCLTY-AREA-ID                        09345000
093460     END-EXEC                                                     09346000
093470                                                                  09347000
093480     EVALUATE TRUE                                                09348000
093490         WHEN SQLCODE = +0                                        09349000
093500              CONTINUE                                            09350000
093510                                                                  09351000
093520         WHEN SQLCODE = +100                                      09352000
093530              SET PS-END-OF-TRIPS TO TRUE                         09353000
093540                                                                  09354000
093550         WHEN SQLWARN0 NOT = SPACE                                09355000
093560         WHEN SQLCODE < +0                                        09356000
093570         WHEN SQLCODE > +0                                        09357000
093580              MOVE '7300-FETCH-TRIP-CSR'                          09358000
093590                                   TO DP013-PARAGRAPH             09359000
093600              MOVE 'FETCH TRIP CURSOR'                            09360000
093610                                   TO DP013-MESSAGE-TEXT (1)      09361000
093620              MOVE SQLCA           TO DP013-SQLCA                 09362000
093630              MOVE 'TVHTRIP'       TO DP013-DB2-TABLE-NAME (1)    09363000
093640              SET DP013-DB2-ABEND  TO TRUE                        09364000
093650              PERFORM DP013-0000-PROCESS-ABEND                    09365000
093660     END-EVALUATE.                                                09366000
093670/                                                                 09367000
093680*----------------------------------------------------------------*09368000
093690* CLOSE THE SHIPMENT CURSOR                                      *09369000
093700*----------------------------------------------------------------*09370000
093710                                                                  09371000
093720 7400-CLOSE-TRIP-CSR.                                             09372000
093730                                                                  09373000
093740     EXEC SQL                                                     09374000
093750          CLOSE TRIP-CSR                                          09375000
093760     END-EXEC                                                     09376000
093770                                                                  09377000
093780     EVALUATE TRUE                                                09378000
093790         WHEN SQLCODE = +0                                        09379000
093800              CONTINUE                                            09380000
093810         WHEN SQLWARN0 NOT = SPACE                                09381000
093820         WHEN SQLCODE  NOT = +0                                   09382000
093830              MOVE '7400-CLOSE-TRIP-CSR'                          09383000
093840                                   TO DP013-PARAGRAPH             09384000
093850              MOVE 'CLOSE TRIP CURSOR'                            09385000
093860                                   TO DP013-MESSAGE-TEXT (1)      09386000
093870              MOVE SQLCA           TO DP013-SQLCA                 09387000
093880              MOVE 'TVHTRIP'       TO DP013-DB2-TABLE-NAME (1)    09388000
093890              SET DP013-DB2-ABEND  TO TRUE                        09389000
093900              PERFORM DP013-0000-PROCESS-ABEND                    09390000
093910     END-EVALUATE.                                                09391000
093920                                                                  09392000
093930*----------------------------------------------------------------*09393000
093940*  UPDATE THE CURRENT TRIP ID ON TSHIPMT                         *09394000
093950*----------------------------------------------------------------*09395000
093960 7500-UPDATE-TSHIPMT.                                             09396000
093970                                                                  09397000
093980     PERFORM                                                      09398000
093990         WITH TEST AFTER                                          09399000
094000         VARYING PV-RETRY-COUNTER                                 09400000
094010         FROM 1 BY 1                                              09401000
094020         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09402000
094030             OR (SQLCODE = +0))                                   09403000
094040                                                                  09404000
094050         EXEC SQL                                                 09405000
094060           UPDATE TSHIPMT                                         09406000
094070              SET LAST_UPD_DTE    = CURRENT DATE                  09407000
094080                , LAST_UPD_TME    = CURRENT TIME                  09408000
094090                , LAST_UPD_UID    = :DP020-USERID                 09409000
094100                , PRO_SCAC_ID     = :SHIPMT-PRO-SCAC-ID           09410000
094110                , LAST_UPD_PGM_ID = :PC-CURRENT-PROGRAM-NAME      09411000
094120           WHERE  SHIPT_ID        = :SHIPMT-SHIPT-ID              09412000
094130         END-EXEC                                                 09413000
094140                                                                  09414000
094150         EVALUATE TRUE                                            09415000
094160             WHEN SQLCODE = +0                                    09416000
094170             WHEN SQLCODE = -904                                  09417000
094180             WHEN SQLCODE = -913                                  09418000
094190                 CONTINUE                                         09419000
094200                                                                  09420000
094210             WHEN SQLWARN0 NOT = SPACES                           09421000
094220             WHEN SQLCODE < +0                                    09422000
094230             WHEN SQLCODE > +0                                    09423000
094240                 MOVE '7500-UPDATE-TSHIPMT'                       09424000
094250                                   TO DP013-PARAGRAPH             09425000
094260                 MOVE 'UPDATE TRIP ID ON TSHIPMT'                 09426000
094270                                   TO DP013-MESSAGE-TEXT(1)       09427000
094280                 MOVE SHIPMT-SHIPT-ID TO DP013-MESSAGE-TEXT(2)    09428000
094290                 MOVE SQLCA        TO DP013-SQLCA                 09429000
094300                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    09430000
094310                 SET DP013-DB2-ABEND                              09431000
094320                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09432000
094330                 PERFORM DP013-0000-PROCESS-ABEND                 09433000
094340         END-EVALUATE                                             09434000
094350     END-PERFORM.                                                 09435000
094360                                                                  09436000
094370     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09437000
094380             AND (SQLCODE NOT = +0)                               09438000
094390         MOVE '7500-UPDATE-TSHIPMT'                               09439000
094400                                   TO DP013-PARAGRAPH             09440000
094410         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              09441000
094420                                   TO DP013-MESSAGE-TEXT (1)      09442000
094430         MOVE 'TO UPDATE A TSHIPMT ROW'                           09443000
094440                                   TO DP013-MESSAGE-TEXT (2)      09444000
094450         MOVE SQLCA                TO DP013-SQLCA                 09445000
094460         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (1)    09446000
094470         SET DP013-DB2-ABEND                                      09447000
094480             DP013-XCTL-DISPLAY-RESTART                           09448000
094490                                   TO TRUE                        09449000
094500         PERFORM DP013-0000-PROCESS-ABEND                         09450000
094510     END-IF.                                                      09451000
094520                                                                  09452000
094530 7600-READ-DUPL-TVHTRIP.                                          09453000
094540                                                                  09454000
094550     PERFORM                                                      09455000
094560         WITH TEST AFTER                                          09456000
094570         VARYING PV-RETRY-COUNTER                                 09457000
094580         FROM 1 BY 1                                              09458000
094590         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09459000
094600             OR (SQLCODE = +0))                                   09460000
094610                                                                  09461000
094620         EXEC SQL                                                 09462000
094630              SELECT COUNT(*)                                     09463000
094640               INTO :PV-VHTRIP-COUNT                              09464000
094650                FROM  TVHTRIP                                     09465000
094660               WHERE (TRIP_ID         = :PV-CURR-TRIP-ID)         09466000
094670         END-EXEC                                                 09467000
094680                                                                  09468000
094690         EVALUATE TRUE                                            09469000
094700             WHEN SQLCODE = +0                                    09470000
094710             WHEN SQLCODE = -904                                  09471000
094720             WHEN SQLCODE = -913                                  09472000
094730                 CONTINUE                                         09473000
094740                                                                  09474000
094750             WHEN SQLWARN0 NOT = SPACES                           09475000
094760             WHEN SQLCODE < +0                                    09476000
094770             WHEN SQLCODE > +0                                    09477000
094780                 MOVE '7600-READ-DUPL-TVHTRIP'                    09478000
094790                                   TO DP013-PARAGRAPH             09479000
094800                 MOVE 'GET COUNT OF TRIPS'                        09480000
094810                                   TO DP013-MESSAGE-TEXT(1)       09481000
094820                 MOVE PV-CURR-TRIP-ID TO DP013-MESSAGE-TEXT(2)    09482000
094830                 MOVE SQLCA        TO DP013-SQLCA                 09483000
094840                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    09484000
094850                 SET DP013-DB2-ABEND                              09485000
094860                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09486000
094870                 PERFORM DP013-0000-PROCESS-ABEND                 09487000
094880         END-EVALUATE                                             09488000
094890     END-PERFORM.                                                 09489000
094900                                                                  09490000
094910     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09491000
094920             AND (SQLCODE NOT = +0)                               09492000
094930         MOVE '7600-READ-DUPL-TVHTRIP'                            09493000
094940                                   TO DP013-PARAGRAPH             09494000
094950         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              09495000
094960                                   TO DP013-MESSAGE-TEXT (1)      09496000
094970         MOVE 'TO COUNT TVHTRIP ROWS'                             09497000
094980                                   TO DP013-MESSAGE-TEXT (2)      09498000
094990         MOVE SQLCA                TO DP013-SQLCA                 09499000
095000         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    09500000
095010         SET DP013-DB2-ABEND                                      09501000
095020             DP013-XCTL-DISPLAY-RESTART                           09502000
095030                                   TO TRUE                        09503000
095040         PERFORM DP013-0000-PROCESS-ABEND                         09504000
095050     END-IF.                                                      09505000
095060/                                                                 09506000
095070*----------------------------------------------------------------*09507000
095080*  TAKE A SNAPSHOT OF THE AFTER  IMAGE OF TVEHICL AND WRITE      *09508000
095090*  TO THE AUDIT TABLE.                                           *09509000
095100*----------------------------------------------------------------*09510000
095110 8000-AUDIT-TVEHICL.                                              09511000
095120                                                                  09512000
095130     INITIALIZE DCLTAUVHCL.                                       09513000
095140                                                                  09514000
095150     PERFORM                                                      09515000
095160         WITH TEST AFTER                                          09516000
095170         VARYING PV-RETRY-COUNTER                                 09517000
095180         FROM 1 BY 1                                              09518000
095190         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09519000
095200             OR (SQLCODE = +0))                                   09520000
095210                                                                  09521000
095220         EXEC SQL                                                 09522000
095230             SELECT  OWNER_SCAC_ID                                09523000
095240                    ,VEH_NBR                                      09524000
095250                    ,CRT_SRC_CDE                                  09525000
095260                    ,LAST_UPD_DTE                                 09526000
095270                    ,LAST_UPD_TME                                 09527000
095280                    ,LAST_UPD_UID                                 09528000
095290                    ,USAGE_CDE                                    09529000
095300                    ,VEH_TYP_CDE                                  09530000
095310                    ,CURR_STATUS_CDE                              09531000
095320                    ,CURR_STATUS_DTE                              09532000
095330                    ,CURR_STATUS_TME                              09533000
095340                    ,CURR_OPER_UNT_ID                             09534000
095350                    ,CURR_FCLTY_ID                                09535000
095360                    ,CURR_FAC_AREA_ID                             09536000
095370                    ,CURR_LOC_DTE                                 09537000
095380                    ,CURR_LOC_TME                                 09538000
095390                    ,CURR_TRIP_ID                                 09539000
095400                    ,VEH_SIZE_CDE                                 09540000
095410            INTO     :VEHICL-OWNER-SCAC-ID                        09541000
095420                    ,:VEHICL-VEH-NBR                              09542000
095430                    ,:VEHICL-CRT-SRC-CDE                          09543000
095440                    ,:VEHICL-LAST-UPD-DTE                         09544000
095450                    ,:VEHICL-LAST-UPD-TME                         09545000
095460                    ,:VEHICL-LAST-UPD-UID                         09546000
095470                    ,:VEHICL-USAGE-CDE                            09547000
095480                    ,:VEHICL-VEH-TYP-CDE                          09548000
095490                    ,:VEHICL-CURR-STATUS-CDE                      09549000
095500                    ,:VEHICL-CURR-STATUS-DTE                      09550000
095510                    ,:VEHICL-CURR-STATUS-TME                      09551000
095520                    ,:VEHICL-CURR-OPER-UNT-ID                     09552000
095530                    ,:VEHICL-CURR-FCLTY-ID                        09553000
095540                    ,:VEHICL-CURR-FAC-AREA-ID                     09554000
095550                    ,:VEHICL-CURR-LOC-DTE                         09555000
095560                    ,:VEHICL-CURR-LOC-TME                         09556000
095570                    ,:VEHICL-CURR-TRIP-ID                         09557000
095580                       :DN-CURR-TRIP-ID                           09558000
095590                    ,:VEHICL-VEH-SIZE-CDE                         09559000
095600           FROM   TVEHICL                                         09560000
095610           WHERE  VEH_NBR       = :DK-VEH-NBR                     09561000
095620             AND  OWNER_SCAC_ID = :DK-OWNER-SCAC-ID               09562000
095630         END-EXEC                                                 09563000
095640                                                                  09564000
095650         EVALUATE TRUE                                            09565000
095660             WHEN SQLCODE = +0                                    09566000
095670             WHEN SQLCODE = -904                                  09567000
095680             WHEN SQLCODE = -913                                  09568000
095690                 CONTINUE                                         09569000
095700                                                                  09570000
095710             WHEN SQLWARN0 NOT = SPACES                           09571000
095720             WHEN SQLCODE < +0                                    09572000
095730             WHEN SQLCODE > +0                                    09573000
095740                 MOVE '8000-AUDIT-TVEHICL'                        09574000
095750                                   TO DP013-PARAGRAPH             09575000
095760                 MOVE 'SELECT A TVEHICL ROW   '                   09576000
095770                                   TO DP013-MESSAGE-TEXT(1)       09577000
095780                 MOVE DK-VEH-NBR   TO DP013-MESSAGE-TEXT(2)       09578000
095790                 MOVE DK-OWNER-SCAC-ID                            09579000
095800                                   TO DP013-MESSAGE-TEXT(3)       09580000
095810                 MOVE SQLCA        TO DP013-SQLCA                 09581000
095820                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    09582000
095830                 SET DP013-DB2-ABEND                              09583000
095840                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09584000
095850                 PERFORM DP013-0000-PROCESS-ABEND                 09585000
095860         END-EVALUATE                                             09586000
095870     END-PERFORM.                                                 09587000
095880                                                                  09588000
095890     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09589000
095900             AND (SQLCODE NOT = +0)                               09590000
095910         MOVE '8000-AUDIT-TVEHICL '                               09591000
095920                                   TO DP013-PARAGRAPH             09592000
095930         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              09593000
095940                                   TO DP013-MESSAGE-TEXT (1)      09594000
095950         MOVE 'TO SELECT A TVEHICL ROW'                           09595000
095960                                   TO DP013-MESSAGE-TEXT (2)      09596000
095970         MOVE SQLCA                TO DP013-SQLCA                 09597000
095980         MOVE 'TVEHICL'            TO DP013-DB2-TABLE-NAME (1)    09598000
095990         SET DP013-DB2-ABEND                                      09599000
096000             DP013-XCTL-DISPLAY-RESTART                           09600000
096010                                   TO TRUE                        09601000
096020         PERFORM DP013-0000-PROCESS-ABEND                         09602000
096030     END-IF.                                                      09603000
096040                                                                  09604000
096050                                                                  09605000
096060     PERFORM                                                      09606000
096070         WITH TEST AFTER                                          09607000
096080         VARYING PV-RETRY-COUNTER                                 09608000
096090         FROM 1 BY 1                                              09609000
096100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09610000
096110             OR (SQLCODE = +0))                                   09611000
096120                                                                  09612000
096130         EXEC SQL                                                 09613000
096140             INSERT  INTO TAUVHCL                                 09614000
096150                    (OWNER_SCAC_ID                                09615000
096160                    ,VEH_NBR                                      09616000
096170                    ,CRT_SRC_CDE                                  09617000
096180                    ,LAST_UPD_DTE                                 09618000
096190                    ,LAST_UPD_TME                                 09619000
096200                    ,LAST_UPD_UID                                 09620000
096210                    ,USAGE_CDE                                    09621000
096220                    ,VEH_TYP_CDE                                  09622000
096230                    ,CURR_STATUS_CDE                              09623000
096240                    ,CURR_STATUS_DTE                              09624000
096250                    ,CURR_STATUS_TME                              09625000
096260                    ,CURR_OPER_UNT_ID                             09626000
096270                    ,CURR_FCLTY_ID                                09627000
096280                    ,CURR_FAC_AREA_ID                             09628000
096290                    ,CURR_LOC_DTE                                 09629000
096300                    ,CURR_LOC_TME                                 09630000
096310                    ,CURR_TRIP_ID                                 09631000
096320                    ,VEH_SIZE_CDE)                                09632000
096330            VALUES  (:VEHICL-OWNER-SCAC-ID                        09633000
096340                    ,:VEHICL-VEH-NBR                              09634000
096350                    ,:VEHICL-CRT-SRC-CDE                          09635000
096360                    ,:VEHICL-LAST-UPD-DTE                         09636000
096370                    ,:VEHICL-LAST-UPD-TME                         09637000
096380                    ,:VEHICL-LAST-UPD-UID                         09638000
096390                    ,:VEHICL-USAGE-CDE                            09639000
096400                    ,:VEHICL-VEH-TYP-CDE                          09640000
096410                    ,:VEHICL-CURR-STATUS-CDE                      09641000
096420                    ,:VEHICL-CURR-STATUS-DTE                      09642000
096430                    ,:VEHICL-CURR-STATUS-TME                      09643000
096440                    ,:VEHICL-CURR-OPER-UNT-ID                     09644000
096450                    ,:VEHICL-CURR-FCLTY-ID                        09645000
096460                    ,:VEHICL-CURR-FAC-AREA-ID                     09646000
096470                    ,:VEHICL-CURR-LOC-DTE                         09647000
096480                    ,:VEHICL-CURR-LOC-TME                         09648000
096490                    ,:VEHICL-CURR-TRIP-ID                         09649000
096500                       :DN-CURR-TRIP-ID                           09650000
096510                    ,:VEHICL-VEH-SIZE-CDE)                        09651000
096520         END-EXEC                                                 09652000
096530                                                                  09653000
096540         EVALUATE TRUE                                            09654000
096550             WHEN SQLCODE = +0                                    09655000
096560             WHEN SQLCODE = -904                                  09656000
096570             WHEN SQLCODE = -913                                  09657000
096580                 CONTINUE                                         09658000
096590                                                                  09659000
096600             WHEN SQLWARN0 NOT = SPACES                           09660000
096610             WHEN SQLCODE < +0                                    09661000
096620             WHEN SQLCODE > +0                                    09662000
096630                 MOVE '8000-AUDIT-TVEHICL '                       09663000
096640                                   TO DP013-PARAGRAPH             09664000
096650                 MOVE 'INSERT A ROW ON TAUVHCL'                   09665000
096660                                   TO DP013-MESSAGE-TEXT(1)       09666000
096670                 MOVE DK-VEH-NBR   TO DP013-MESSAGE-TEXT(2)       09667000
096680                 MOVE DK-OWNER-SCAC-ID                            09668000
096690                                   TO DP013-MESSAGE-TEXT(3)       09669000
096700                 MOVE SQLCA        TO DP013-SQLCA                 09670000
096710                 MOVE 'TAUVHCL'    TO DP013-DB2-TABLE-NAME (1)    09671000
096720                 SET DP013-DB2-ABEND                              09672000
096730                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09673000
096740                 PERFORM DP013-0000-PROCESS-ABEND                 09674000
096750         END-EVALUATE                                             09675000
096760     END-PERFORM.                                                 09676000
096770                                                                  09677000
096780     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09678000
096790             AND (SQLCODE NOT = +0)                               09679000
096800         MOVE '8000-AUDIT-TAUVHCL'                                09680000
096810                                   TO DP013-PARAGRAPH             09681000
096820         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              09682000
096830                                   TO DP013-MESSAGE-TEXT (1)      09683000
096840         MOVE 'TO INSERT A TAUVHCL ROW'                           09684000
096850                                   TO DP013-MESSAGE-TEXT (2)      09685000
096860         MOVE SQLCA                TO DP013-SQLCA                 09686000
096870         MOVE 'TAUVHCL'            TO DP013-DB2-TABLE-NAME (1)    09687000
096880         SET DP013-DB2-ABEND                                      09688000
096890             DP013-XCTL-DISPLAY-RESTART                           09689000
096900                                   TO TRUE                        09690000
096910         PERFORM DP013-0000-PROCESS-ABEND                         09691000
096920     END-IF.                                                      09692000
096930                                                                  09693000
096940******************************************************************09694000
096950*  SELECT A VEHICL FOR A SCAC AND VEHICLE                         09695000
096960******************************************************************09696000
096970                                                                  09697000
096980                                                                  09698000
096990*----------------------------------------------------------------*09699000
097000*  TAKE A SNAPSHOT OF THE AFTER  IMAGE OF TVHTRIP AND WRITE      *09700000
097010*  TO THE AUDIT TABLE.                                           *09701000
097020*----------------------------------------------------------------*09702000
097030 8100-AUDIT-TVHTRIP.                                              09703000
097040                                                                  09704000
097050     INITIALIZE DCLTAUTRIP.                                       09705000
097060                                                                  09706000
097070     PERFORM                                                      09707000
097080         WITH TEST AFTER                                          09708000
097090         VARYING PV-RETRY-COUNTER                                 09709000
097100         FROM 1 BY 1                                              09710000
097110         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09711000
097120             OR (SQLCODE = +0))                                   09712000
097130                                                                  09713000
097140         EXEC SQL                                                 09714000
097150             SELECT  OWNER_SCAC_ID                                09715000
097160                    ,VEH_NBR                                      09716000
097170                    ,TRIP_ID                                      09717000
097180                    ,TRIP_BEG_DTE                                 09718000
097190                    ,TRIP_BEG_TME                                 09719000
097200                    ,CRT_SRC_CDE                                  09720000
097210                    ,LAST_UPD_DTE                                 09721000
097220                    ,LAST_UPD_TME                                 09722000
097230                    ,LAST_UPD_UID                                 09723000
097240                    ,MANIFEST_NBR                                 09724000
097250                    ,PLND_TRIP_SEQ                                09725000
097260                    ,PLND_ACTVY_CDE                               09726000
097270                    ,OWNR_SCAC_SHIP_DTE                           09727000
097280                    ,REF_TRIP_ID                                  09728000
097290                    ,EST_AR_TMST                                  09729000
097300                    ,SPLT_XMIT_IND                                09730000
097310                    ,SPLT_XMIT_DTE                                09731000
097320                    ,SPLT_XMIT_TM                                 09732000
097330            INTO     :VHTRIP-OWNER-SCAC-ID                        09733000
097340                    ,:VHTRIP-VEH-NBR                              09734000
097350                       :DN-VEH-NBR                                09735000
097360                    ,:VHTRIP-TRIP-ID                              09736000
097370                    ,:VHTRIP-TRIP-BEG-DTE                         09737000
097380                    ,:VHTRIP-TRIP-BEG-TME                         09738000
097390                    ,:VHTRIP-CRT-SRC-CDE                          09739000
097400                    ,:VHTRIP-LAST-UPD-DTE                         09740000
097410                    ,:VHTRIP-LAST-UPD-TME                         09741000
097420                    ,:VHTRIP-LAST-UPD-UID                         09742000
097430                    ,:VHTRIP-MANIFEST-NBR                         09743000
097440                    ,:VHTRIP-PLND-TRIP-SEQ                        09744000
097450                    ,:VHTRIP-PLND-ACTVY-CDE                       09745000
097460                    ,:VHTRIP-OWNR-SCAC-SHIP-DTE                   09746000
097470                    ,:VHTRIP-REF-TRIP-ID                          09747000
097480                    ,:VHTRIP-EST-AR-TMST                          09748000
097490                           :DN-EST-AR-TMST                        09749000
097500                    ,:VHTRIP-SPLT-XMIT-IND                        09750000
097510                    ,:VHTRIP-SPLT-XMIT-DTE                        09751000
097520                    ,:VHTRIP-SPLT-XMIT-TM                         09752000
097530           FROM   TVHTRIP                                         09753000
097540           WHERE  OWNER_SCAC_ID = :DK-OWNER-SCAC-ID               09754000
097550             AND  VEH_NBR       IS NOT NULL                       09755000
097560             AND  VEH_NBR       = :DK-VEH-NBR                     09756000
097570             AND  TRIP_ID       = :DK-TRIP-ID                     09757000
097580         END-EXEC                                                 09758000
097590                                                                  09759000
097600         EVALUATE TRUE                                            09760000
097610             WHEN SQLCODE = +0                                    09761000
097620             WHEN SQLCODE = -904                                  09762000
097630             WHEN SQLCODE = -913                                  09763000
097640                 CONTINUE                                         09764000
097650                                                                  09765000
097660             WHEN SQLWARN0 NOT = SPACES                           09766000
097670             WHEN SQLCODE < +0                                    09767000
097680             WHEN SQLCODE > +0                                    09768000
097690                 MOVE SPACES TO PV-MESSAGE                        09769000
097700                 MOVE DK-OWNER-SCAC-ID TO PV-MESSAGE1             09770000
097710                 MOVE DK-VEH-NBR       TO PV-MESSAGE2             09771000
097720                 MOVE DK-TRIP-ID       TO PV-MESSAGE3             09772000
097730                 MOVE '8100-AUDIT-TVHTRIP'                        09773000
097740                                   TO DP013-PARAGRAPH             09774000
097750                 MOVE 'SELECT A ROW ON TVHTRIP'                   09775000
097760                                   TO DP013-MESSAGE-TEXT(1)       09776000
097770                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       09777000
097780                 MOVE SQLCA        TO DP013-SQLCA                 09778000
097790                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    09779000
097800                 SET DP013-DB2-ABEND                              09780000
097810                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09781000
097820                 PERFORM DP013-0000-PROCESS-ABEND                 09782000
097830         END-EVALUATE                                             09783000
097840     END-PERFORM.                                                 09784000
097850                                                                  09785000
097860     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09786000
097870             AND (SQLCODE NOT = +0)                               09787000
097880         MOVE '8100-AUDIT-TVHTRIP'                                09788000
097890                                   TO DP013-PARAGRAPH             09789000
097900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              09790000
097910                                   TO DP013-MESSAGE-TEXT (1)      09791000
097920         MOVE 'TO SELECT A TVHTRIP ROW'                           09792000
097930                                   TO DP013-MESSAGE-TEXT (2)      09793000
097940         MOVE SQLCA                TO DP013-SQLCA                 09794000
097950         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    09795000
097960         SET DP013-DB2-ABEND                                      09796000
097970             DP013-XCTL-DISPLAY-RESTART                           09797000
097980                                   TO TRUE                        09798000
097990         PERFORM DP013-0000-PROCESS-ABEND                         09799000
098000     END-IF.                                                      09800000
098010                                                                  09801000
098020     MOVE 'CE'                     TO VHTRIP-CRT-SRC-CDE.         09802000
098030                                                                  09803000
098040     PERFORM                                                      09804000
098050         WITH TEST AFTER                                          09805000
098060         VARYING PV-RETRY-COUNTER                                 09806000
098070         FROM 1 BY 1                                              09807000
098080         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09808000
098090             OR (SQLCODE = +0))                                   09809000
098100                                                                  09810000
098110         EXEC SQL                                                 09811000
098120             INSERT  INTO TAUTRIP                                 09812000
098130                    (OWNER_SCAC_ID                                09813000
098140                    ,VEH_NBR                                      09814000
098150                    ,TRIP_ID                                      09815000
098160                    ,TRIP_BEG_DTE                                 09816000
098170                    ,TRIP_BEG_TME                                 09817000
098180                    ,CRT_SRC_CDE                                  09818000
098190                    ,LAST_UPD_DTE                                 09819000
098200                    ,LAST_UPD_TME                                 09820000
098210                    ,LAST_UPD_UID                                 09821000
098220                    ,MANIFEST_NBR                                 09822000
098230                    ,PLND_TRIP_SEQ                                09823000
098240                    ,PLND_ACTVY_CDE                               09824000
098250                    ,OWNR_SCAC_SHIP_DTE                           09825000
098260                    ,REF_TRIP_ID                                  09826000
098270                    ,EST_AR_TMST                                  09827000
098280                    ,AUD_STATUS_CDE                               09828000
098290                    ,SPLT_XMIT_IND                                09829000
098300                    ,SPLT_XMIT_DTE                                09830000
098310                    ,SPLT_XMIT_TM)                                09831000
098320            VALUES  (:VHTRIP-OWNER-SCAC-ID                        09832000
098330                    ,:VHTRIP-VEH-NBR                              09833000
098340                       :DN-VEH-NBR                                09834000
098350                    ,:VHTRIP-TRIP-ID                              09835000
098360                    ,:VHTRIP-TRIP-BEG-DTE                         09836000
098370                    ,:VHTRIP-TRIP-BEG-TME                         09837000
098380                    ,:VHTRIP-CRT-SRC-CDE                          09838000
098390                    ,:VHTRIP-LAST-UPD-DTE                         09839000
098400                    ,:VHTRIP-LAST-UPD-TME                         09840000
098410                    ,:VHTRIP-LAST-UPD-UID                         09841000
098420                    ,:VHTRIP-MANIFEST-NBR                         09842000
098430                    ,:VHTRIP-PLND-TRIP-SEQ                        09843000
098440                    ,:VHTRIP-PLND-ACTVY-CDE                       09844000
098450                    ,:VHTRIP-OWNR-SCAC-SHIP-DTE                   09845000
098460                    ,:VHTRIP-REF-TRIP-ID                          09846000
098470                    ,:VHTRIP-EST-AR-TMST                          09847000
098480                           :DN-EST-AR-TMST                        09848000
098490                    ,:TRIPST-TRIP-STATUS-CDE                      09849000
098500                    ,:VHTRIP-SPLT-XMIT-IND                        09850000
098510                    ,:VHTRIP-SPLT-XMIT-DTE                        09851000
098520                    ,:VHTRIP-SPLT-XMIT-TM)                        09852000
098530         END-EXEC                                                 09853000
098540                                                                  09854000
098550         EVALUATE TRUE                                            09855000
098560             WHEN SQLCODE = +0                                    09856000
098570             WHEN SQLCODE = -904                                  09857000
098580             WHEN SQLCODE = -913                                  09858000
098590                 CONTINUE                                         09859000
098600                                                                  09860000
098610             WHEN SQLWARN0 NOT = SPACES                           09861000
098620             WHEN SQLCODE < +0                                    09862000
098630             WHEN SQLCODE > +0                                    09863000
098640                 MOVE SPACES TO PV-MESSAGE                        09864000
098650                 MOVE DK-OWNER-SCAC-ID TO PV-MESSAGE1             09865000
098660                 MOVE DK-VEH-NBR       TO PV-MESSAGE2             09866000
098670                 MOVE DK-TRIP-ID       TO PV-MESSAGE3             09867000
098680                 MOVE '8100-AUDIT-TVHTRIP'                        09868000
098690                                   TO DP013-PARAGRAPH             09869000
098700                 MOVE 'INSERT A ROW ON TAUTRIP'                   09870000
098710                                   TO DP013-MESSAGE-TEXT(1)       09871000
098720                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       09872000
098730                 MOVE SQLCA        TO DP013-SQLCA                 09873000
098740                 MOVE 'TAUTRIP'    TO DP013-DB2-TABLE-NAME (1)    09874000
098750                 SET DP013-DB2-ABEND                              09875000
098760                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09876000
098770                 PERFORM DP013-0000-PROCESS-ABEND                 09877000
098780         END-EVALUATE                                             09878000
098790     END-PERFORM.                                                 09879000
098800                                                                  09880000
098810     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09881000
098820             AND (SQLCODE NOT = +0)                               09882000
098830         MOVE '8100-AUDIT-TVHTRIP'                                09883000
098840                                   TO DP013-PARAGRAPH             09884000
098850         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              09885000
098860                                   TO DP013-MESSAGE-TEXT (1)      09886000
098870         MOVE 'TO INSERT A TAUTRIP ROW'                           09887000
098880                                   TO DP013-MESSAGE-TEXT (2)      09888000
098890         MOVE SQLCA                TO DP013-SQLCA                 09889000
098900         MOVE 'TAUTRIP'            TO DP013-DB2-TABLE-NAME (1)    09890000
098910         SET DP013-DB2-ABEND                                      09891000
098920             DP013-XCTL-DISPLAY-RESTART                           09892000
098930                                   TO TRUE                        09893000
098940         PERFORM DP013-0000-PROCESS-ABEND                         09894000
098950     END-IF.                                                      09895000
098960                                                                  09896000
098970 8110-RETURN.                                                     09897000
098980                                                                  09898000
098990*    EXEC CICS                                                    09899000
099000*        SEND FROM (PV-MESSAGE-AREA)                              09900000
099010*             LENGTH (19)                                         09901000
099020*             ERASE                                               09902000
099030*    END-EXEC.                                                    09903000
099040                                                                  09904000
099050     EXEC CICS                                                    09905000
099060         RETURN                                                   09906000
099070     END-EXEC.                                                    09907000
099080                                                                  09908000
099090 8200-SYNCPOINT.                                                  09909000
099100                                                                  09910000
099110     EXEC CICS SYNCPOINT                                          09911000
099120     END-EXEC.                                                    09912000
099130/                                                                 09913000
099140*----------------------------------------------------------------*09914000
099150*  TAKE A SNAPSHOT OF THE AFTER  IMAGE OF TSHIPMT AND WRITE      *09915000
099160*  TO THE AUDIT TABLE.                                           *09916000
099170*----------------------------------------------------------------*09917000
099180 8300-AUDIT-TSHIPMT.                                              09918000
099190                                                                  09919000
099200     INITIALIZE DCLTAUSHIP.                                       09920000
099210                                                                  09921000
099211* CLT 12-01-2011 WR40574 ADDED CARR-AUTH-ID BELOW                 09921166
099220     PERFORM                                                      09922000
099230         WITH TEST AFTER                                          09923000
099240         VARYING PV-RETRY-COUNTER                                 09924000
099250         FROM 1 BY 1                                              09925000
099260         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09926000
099270             OR (SQLCODE = +0))                                   09927000
099280                                                                  09928000
099290         EXEC SQL                                                 09929000
099300             SELECT  A.TRIP_ID                                    09930000
099310                    ,A.SHIPT_ID                                   09931000
099320                    ,A.CRT_SRC_CDE                                09932000
099330                    ,A.LAST_UPD_DTE                               09933000
099340                    ,A.LAST_UPD_TME                               09934000
099350                    ,A.LAST_UPD_UID                               09935000
099360                    ,A.PRO_SCAC_ID                                09936000
099370                    ,A.PRO_NBR                                    09937000
099380                    ,A.BOL_NBR                                    09938000
099390                    ,A.SHIPPER_NME                                09939000
099400                    ,A.SHIPT_TYP_CDE                              09940000
099410                    ,A.EXPTED_GRO_WGHT                            09941000
099420                    ,A.PKG_TYP_CDE                                09942000
099430                    ,A.EXPTED_PKG_QTY                             09943000
099440                    ,A.FRGT_CHG_AMT                               09944000
099450                    ,A.FRGT_TERMS_CDE                             09945000
099460                    ,A.EXPTED_PLT_QTY                             09946000
099470                    ,A.VEND_SHIP_DTE                              09947000
099480                    ,A.EST_AR_TMST                                09948000
099490                    ,A.ORIG_SCAC_ID                               09949000
099500                    ,A.LAST_UPD_PGM_ID                            09950000
099510                    ,A.CRE_USER_ID                                09951000
099520                    ,A.CARR_CART_CT                               09952000
099530                    ,A.CARR_LAST_UPD_DTE                          09953000
099540                    ,A.CARR_LAST_UPD_TIME                         09954000
099550                    ,A.VEND_CART_CT                               09955000
099560                    ,A.VEND_LAST_UPD_DTE                          09956000
099570                    ,A.VEND_LAST_UPD_TIME                         09957000
099580                    ,A.VEH_NBR                                    09958000
099590                    ,A.AUTH_NBR                                   09959000
099600                    ,A.AUTH_DTE                                   09960000
099610                    ,A.CONFIRM_DTE                                09961000
099620                    ,A.CONFIRM_TIME                               09962000
099630                    ,A.COMPLETE_PRO_NBR                           09963000
099640                    ,A.COMPLETE_BOL_NBR                           09964000
099650                    ,A.PROCESSED_DTE                              09965000
099660                    ,A.INVC_NBR                                   09966000
099661                    ,A.CARR_AUTH_ID                               09966166
099670            INTO     :SHIPMT-TRIP-ID                              09967000
099680                       :DN-TRIP-ID                                09968000
099690                    ,:SHIPMT-SHIPT-ID                             09969000
099700                    ,:SHIPMT-CRT-SRC-CDE                          09970000
099710                    ,:SHIPMT-LAST-UPD-DTE                         09971000
099720                    ,:SHIPMT-LAST-UPD-TME                         09972000
099730                    ,:SHIPMT-LAST-UPD-UID                         09973000
099740                    ,:SHIPMT-PRO-SCAC-ID                          09974000
099750                    ,:SHIPMT-PRO-NBR                              09975000
099760                    ,:SHIPMT-BOL-NBR                              09976000
099770                    ,:SHIPMT-SHIPPER-NME                          09977000
099780                    ,:SHIPMT-SHIPT-TYP-CDE                        09978000
099790                    ,:SHIPMT-EXPTED-GRO-WGHT                      09979000
099800                    ,:SHIPMT-PKG-TYP-CDE                          09980000
099810                    ,:SHIPMT-EXPTED-PKG-QTY                       09981000
099820                    ,:SHIPMT-FRGT-CHG-AMT                         09982000
099830                    ,:SHIPMT-FRGT-TERMS-CDE                       09983000
099840                    ,:SHIPMT-EXPTED-PLT-QTY                       09984000
099850                    ,:SHIPMT-VEND-SHIP-DTE                        09985000
099860                    ,:SHIPMT-EST-AR-TMST                          09986000
099870                       :DN-SHIP-EST-AR-TMST                       09987000
099880                    ,:SHIPMT-ORIG-SCAC-ID                         09988000
099890                    ,:SHIPMT-LAST-UPD-PGM-ID                      09989000
099900                    ,:SHIPMT-CRE-USER-ID                          09990000
099910                    ,:SHIPMT-CARR-CART-CT                         09991000
099920                    ,:SHIPMT-CARR-LAST-UPD-DTE                    09992000
099930                    ,:SHIPMT-CARR-LAST-UPD-TIME                   09993000
099940                    ,:SHIPMT-VEND-CART-CT                         09994000
099950                    ,:SHIPMT-VEND-LAST-UPD-DTE                    09995000
099960                    ,:SHIPMT-VEND-LAST-UPD-TIME                   09996000
099970                    ,:SHIPMT-VEH-NBR                              09997000
099980                    ,:SHIPMT-AUTH-NBR                             09998000
099990                    ,:SHIPMT-AUTH-DTE                             09999000
100000                    ,:SHIPMT-CONFIRM-DTE                          10000000
100010                    ,:SHIPMT-CONFIRM-TIME                         10001000
100020                    ,:SHIPMT-COMPLETE-PRO-NBR                     10002000
100030                    ,:SHIPMT-COMPLETE-BOL-NBR                     10003000
100040                    ,:SHIPMT-PROCESSED-DTE                        10004000
100050                    ,:SHIPMT-INVC-NBR                             10005000
100051                    ,:SHIPMT-CARR-AUTH-ID                         10005166
100060           FROM   TSHIPMT A                                       10006000
100070           WHERE  A.SHIPT_ID         = :SHIPMT-SHIPT-ID           10007000
100080         END-EXEC                                                 10008000
100090                                                                  10009000
100100         EVALUATE TRUE                                            10010000
100110             WHEN SQLCODE = +0                                    10011000
100120             WHEN SQLCODE = -904                                  10012000
100130             WHEN SQLCODE = -913                                  10013000
100140                 CONTINUE                                         10014000
100150                                                                  10015000
100160             WHEN SQLWARN0 NOT = SPACES                           10016000
100170             WHEN SQLCODE < +0                                    10017000
100180             WHEN SQLCODE > +0                                    10018000
100190                 MOVE '8300-AUDIT-TSHIPMT'                        10019000
100200                                   TO DP013-PARAGRAPH             10020000
100210                 MOVE 'SELECT A TSHIPMT ROW   '                   10021000
100220                                   TO DP013-MESSAGE-TEXT(1)       10022000
100230                 MOVE SHIPMT-SHIPT-ID TO DP013-MESSAGE-TEXT(2)    10023000
100240                 MOVE SQLCA        TO DP013-SQLCA                 10024000
100250                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    10025000
100260                 SET DP013-DB2-ABEND                              10026000
100270                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10027000
100280                 PERFORM DP013-0000-PROCESS-ABEND                 10028000
100290         END-EVALUATE                                             10029000
100300     END-PERFORM.                                                 10030000
100310                                                                  10031000
100320     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10032000
100330             AND (SQLCODE NOT = +0)                               10033000
100340         MOVE '8300-AUDIT-TSHIPMT '                               10034000
100350                                   TO DP013-PARAGRAPH             10035000
100360         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              10036000
100370                                   TO DP013-MESSAGE-TEXT (1)      10037000
100380         MOVE 'TO SELECT A TSHIPMT ROW'                           10038000
100390                                   TO DP013-MESSAGE-TEXT (2)      10039000
100400         MOVE SQLCA                TO DP013-SQLCA                 10040000
100410         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (1)    10041000
100420         SET DP013-DB2-ABEND                                      10042000
100430             DP013-XCTL-DISPLAY-RESTART                           10043000
100440                                   TO TRUE                        10044000
100450         PERFORM DP013-0000-PROCESS-ABEND                         10045000
100460     END-IF.                                                      10046000
100470                                                                  10047000
100471* CLT 12-01-2011 WR40574 ADDED CARR-AUTH-ID BELOW                 10047166
100480     PERFORM                                                      10048000
100490         WITH TEST AFTER                                          10049000
100500         VARYING PV-RETRY-COUNTER                                 10050000
100510         FROM 1 BY 1                                              10051000
100520         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10052000
100530             OR (SQLCODE = +0))                                   10053000
100540                                                                  10054000
100550         EXEC SQL                                                 10055000
100560             INSERT  INTO TAUSHIP                                 10056000
100570                    (TRIP_ID                                      10057000
100580                    ,SHIPT_ID                                     10058000
100590                    ,CRT_SRC_CDE                                  10059000
100600                    ,LAST_UPD_DTE                                 10060000
100610                    ,LAST_UPD_TME                                 10061000
100620                    ,LAST_UPD_UID                                 10062000
100630                    ,PRO_SCAC_ID                                  10063000
100640                    ,PRO_NBR                                      10064000
100650                    ,BOL_NBR                                      10065000
100660                    ,SHIPPER_NME                                  10066000
100670                    ,SHIPT_TYP_CDE                                10067000
100680                    ,EXPTED_GRO_WGHT                              10068000
100690                    ,PKG_TYP_CDE                                  10069000
100700                    ,EXPTED_PKG_QTY                               10070000
100710                    ,FRGT_CHG_AMT                                 10071000
100720                    ,FRGT_TERMS_CDE                               10072000
100730                    ,EST_AR_TMST                                  10073000
100740                    ,VEND_SHIP_DTE                                10074000
100750                    ,EXPTED_PLT_QTY                               10075000
100760                    ,ORIG_SCAC_ID                                 10076000
100770                    ,LAST_UPD_PGM_ID                              10077000
100780                    ,CRE_USER_ID                                  10078000
100790                    ,CARR_CART_CT                                 10079000
100800                    ,CARR_LAST_UPD_DTE                            10080000
100810                    ,CARR_LAST_UPD_TIME                           10081000
100820                    ,VEND_CART_CT                                 10082000
100830                    ,VEND_LAST_UPD_DTE                            10083000
100840                    ,VEND_LAST_UPD_TIME                           10084000
100850                    ,VEH_NBR                                      10085000
100860                    ,AUTH_NBR                                     10086000
100870                    ,AUTH_DTE                                     10087000
100880                    ,CONFIRM_DTE                                  10088000
100890                    ,CONFIRM_TIME                                 10089000
100900                    ,PROCESSED_DTE                                10090000
100910                    ,INVC_NBR                                     10091000
100920                    ,AUD_STATUS_CDE                               10092066
100921                    ,CARR_AUTH_ID  )                              10092166
100930            VALUES  (:SHIPMT-TRIP-ID                              10093000
100940                       :DN-TRIP-ID                                10094000
100950                    ,:SHIPMT-SHIPT-ID                             10095000
100960                    ,:SHIPMT-CRT-SRC-CDE                          10096000
100970                    ,:SHIPMT-LAST-UPD-DTE                         10097000
100980                    ,:SHIPMT-LAST-UPD-TME                         10098000
100990                    ,:SHIPMT-LAST-UPD-UID                         10099000
101000                    ,:SHIPMT-PRO-SCAC-ID                          10100000
101010                    ,:SHIPMT-COMPLETE-PRO-NBR                     10101000
101020                    ,:SHIPMT-COMPLETE-BOL-NBR                     10102000
101030                    ,:SHIPMT-SHIPPER-NME                          10103000
101040                    ,:SHIPMT-SHIPT-TYP-CDE                        10104000
101050                    ,:SHIPMT-EXPTED-GRO-WGHT                      10105000
101060                    ,:SHIPMT-PKG-TYP-CDE                          10106000
101070                    ,:SHIPMT-EXPTED-PKG-QTY                       10107000
101080                    ,:SHIPMT-FRGT-CHG-AMT                         10108000
101090                    ,:SHIPMT-FRGT-TERMS-CDE                       10109000
101100                    ,:SHIPMT-EST-AR-TMST                          10110000
101110                       :DN-SHIP-EST-AR-TMST                       10111000
101120                    ,:SHIPMT-VEND-SHIP-DTE                        10112000
101130                    ,:SHIPMT-EXPTED-PLT-QTY                       10113000
101140                    ,:SHIPMT-ORIG-SCAC-ID                         10114000
101150                    ,:SHIPMT-LAST-UPD-PGM-ID                      10115000
101160                    ,:SHIPMT-CRE-USER-ID                          10116000
101170                    ,:SHIPMT-CARR-CART-CT                         10117000
101180                    ,:SHIPMT-CARR-LAST-UPD-DTE                    10118000
101190                    ,:SHIPMT-CARR-LAST-UPD-TIME                   10119000
101200                    ,:SHIPMT-VEND-CART-CT                         10120000
101210                    ,:SHIPMT-VEND-LAST-UPD-DTE                    10121000
101220                    ,:SHIPMT-VEND-LAST-UPD-TIME                   10122000
101230                    ,:SHIPMT-VEH-NBR                              10123000
101240                    ,:SHIPMT-AUTH-NBR                             10124000
101250                    ,:SHIPMT-AUTH-DTE                             10125000
101260                    ,:SHIPMT-CONFIRM-DTE                          10126000
101270                    ,:SHIPMT-CONFIRM-TIME                         10127000
101280                    ,:SHIPMT-PROCESSED-DTE                        10128000
101290                    ,:SHIPMT-INVC-NBR                             10129000
101300                    ,:SHIPST-SHIPT-STATUS-CDE                     10130066
101301                    ,:SHIPMT-CARR-AUTH-ID    )                    10130167
101310         END-EXEC                                                 10131000
101320                                                                  10132000
101330         EVALUATE TRUE                                            10133000
101340             WHEN SQLCODE = +0                                    10134000
101350             WHEN SQLCODE = -904                                  10135000
101360             WHEN SQLCODE = -913                                  10136000
101370                 CONTINUE                                         10137000
101380                                                                  10138000
101390             WHEN SQLWARN0 NOT = SPACES                           10139000
101400             WHEN SQLCODE < +0                                    10140000
101410             WHEN SQLCODE > +0                                    10141000
101420                 MOVE '8300-AUDIT-TSHIPMT '                       10142000
101430                                   TO DP013-PARAGRAPH             10143000
101440                 MOVE 'INSERT A ROW ON TAUSHIP'                   10144000
101450                                   TO DP013-MESSAGE-TEXT(1)       10145000
101460                 MOVE SHIPMT-SHIPT-ID TO DP013-MESSAGE-TEXT(2)    10146000
101470                 MOVE SQLCA        TO DP013-SQLCA                 10147000
101480                 MOVE 'TAUSHIP'    TO DP013-DB2-TABLE-NAME (1)    10148000
101490                 SET DP013-DB2-ABEND                              10149000
101500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10150000
101510                 PERFORM DP013-0000-PROCESS-ABEND                 10151000
101520         END-EVALUATE                                             10152000
101530     END-PERFORM.                                                 10153000
101540                                                                  10154000
101550     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10155000
101560             AND (SQLCODE NOT = +0)                               10156000
101570         MOVE '8300-AUDIT-TSHIPMT'                                10157000
101580                                   TO DP013-PARAGRAPH             10158000
101590         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              10159000
101600                                   TO DP013-MESSAGE-TEXT (1)      10160000
101610         MOVE 'TO INSERT A TAUSHIP ROW'                           10161000
101620                                   TO DP013-MESSAGE-TEXT (2)      10162000
101630         MOVE SQLCA                TO DP013-SQLCA                 10163000
101640         MOVE 'TAUSHIP'            TO DP013-DB2-TABLE-NAME (1)    10164000
101650         SET DP013-DB2-ABEND                                      10165000
101660             DP013-XCTL-DISPLAY-RESTART                           10166000
101670                                   TO TRUE                        10167000
101680         PERFORM DP013-0000-PROCESS-ABEND                         10168000
101690     END-IF.                                                      10169000
101700                                                                  10170000
101710/                                                                 10171000
101720*----------------------------------------------------------------*10172000
101730* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *10173000
101740*----------------------------------------------------------------*10174000
101750                                                                  10175000
101760 9100-READ-SEL-QUEUE.                                             10176000
101770     EXEC CICS                                                    10177000
101780         READQ TS                                                 10178000
101790             QUEUE (ASC-SEL-QUEUE-NAME)                           10179000
101800             INTO  (TR006-DOCK-SCHEDULE-REC)                      10180000
101810             ITEM  (ASC-SEL-ITEM)                                 10181000
101820             RESP  (PV-CICS-RESPONSE)                             10182000
101830     END-EXEC.                                                    10183000
101840                                                                  10184000
101850     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   10185000
101860         CONTINUE                                                 10186000
101870     ELSE                                                         10187000
101880         SET DP013-LOGIC-ABEND                                    10188000
101890             DP013-NO-ROLLBACK     TO TRUE                        10189000
101900         MOVE '9100-READ-SEL-QUEUE'                               10190000
101910                                   TO DP013-PARAGRAPH             10191000
101920         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   10192000
101930                                   TO DP013-MESSAGE-TEXT (1)      10193000
101940         PERFORM DP013-0000-PROCESS-ABEND                         10194000
101950     END-IF.                                                      10195000
101960                                                                  10196000
101970/                                                                 10197000
101980 9110-READ-SEL-QUEUE.                                             10198000
101990     EXEC CICS                                                    10199000
102000         READQ TS                                                 10200000
102010             QUEUE (ASC-SEL-QUEUE-NAME)                           10201000
102020             INTO  (RC013-DC-SELECT-RECORD)                       10202000
102030             ITEM  (ASC-SEL-ITEM)                                 10203000
102040             RESP  (PV-CICS-RESPONSE)                             10204000
102050     END-EXEC.                                                    10205000
102060                                                                  10206000
102070     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   10207000
102080         CONTINUE                                                 10208000
102090     ELSE                                                         10209000
102100         SET DP013-LOGIC-ABEND                                    10210000
102110             DP013-NO-ROLLBACK     TO TRUE                        10211000
102120         MOVE '9110-READ-SEL-QUEUE'                               10212000
102130                                   TO DP013-PARAGRAPH             10213000
102140         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   10214000
102150                                   TO DP013-MESSAGE-TEXT (1)      10215000
102160         PERFORM DP013-0000-PROCESS-ABEND                         10216000
102170     END-IF.                                                      10217000
102180                                                                  10218000
102190/                                                                 10219000
102200*----------------------------------------------------------------*10220000
102210* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *10221000
102220*----------------------------------------------------------------*10222000
102230 9200-REWRITE-LIST-QUEUE.                                         10223000
102240                                                                  10224000
102250     EXEC CICS                                                    10225000
102260          WRITEQ TS                                               10226000
102270              QUEUE  (ASC-SEL-QUEUE-NAME)                         10227000
102280              FROM   (TR006-DOCK-SCHEDULE-REC)                    10228000
102290              ITEM   (ASC-SEL-ITEM)                               10229000
102300              RESP   (PV-CICS-RESPONSE)                           10230000
102310              REWRITE                                             10231000
102320     END-EXEC.                                                    10232000
102330                                                                  10233000
102340     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               10234000
102350         SET DP013-CICS-ABEND                                     10235000
102360             DP013-NO-ROLLBACK     TO TRUE                        10236000
102370         MOVE '9200-REWRITE-LIST-QUEUE'                           10237000
102380                                   TO DP013-PARAGRAPH             10238000
102390         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   10239000
102400                                   TO DP013-MESSAGE-TEXT (1)      10240000
102410         PERFORM DP013-0000-PROCESS-ABEND                         10241000
102420     END-IF.                                                      10242000
102430                                                                  10243000
102440/                                                                 10244000
102450*----------------------------------------------------------------*10245000
102460* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *10246000
102470*----------------------------------------------------------------*10247000
102480 9210-REWRITE-LIST-QUEUE.                                         10248000
102490                                                                  10249000
102500     EXEC CICS                                                    10250000
102510          WRITEQ TS                                               10251000
102520              QUEUE  (ASC-SEL-QUEUE-NAME)                         10252000
102530              FROM   (RC013-DC-SELECT-RECORD)                     10253000
102540              ITEM   (ASC-SEL-ITEM)                               10254000
102550              RESP   (PV-CICS-RESPONSE)                           10255000
102560              REWRITE                                             10256000
102570     END-EXEC.                                                    10257000
102580                                                                  10258000
102590     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               10259000
102600         SET DP013-CICS-ABEND                                     10260000
102610             DP013-NO-ROLLBACK     TO TRUE                        10261000
102620         MOVE '9210-REWRITE-LIST-QUEUE'                           10262000
102630                                   TO DP013-PARAGRAPH             10263000
102640         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   10264000
102650                                   TO DP013-MESSAGE-TEXT (1)      10265000
102660         PERFORM DP013-0000-PROCESS-ABEND                         10266000
102670     END-IF.                                                      10267000
102680                                                                  10268000
102690*----------------------------------------------------------------*10269000
102700 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  10270000
102710                                                                  10271000
102720     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           10272000
102730     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          10273000
102740     INITIALIZE DP013-SRC-TASK-NUMBER                             10274000
102750                DP013-STACK.                                      10275000
102760     SET DP013-LINK-RETURN            TO TRUE.                    10276000
102770                                                                  10277000
102780     EXEC CICS                                                    10278000
102790         LINK                                                     10279000
102800             PROGRAM   (DP013-NAME)                               10280000
102810             COMMAREA  (DP013-PARAMETERS)                         10281000
102820             LENGTH    (DP013-LENGTH)                             10282000
102830     END-EXEC.                                                    10283000
102840/                                                                 10284000
102850*----------------------------------------------------------------*10285000
102860*    ABEND PROCESSOR MODULE                                      *10286000
102870*----------------------------------------------------------------*10287000
102880                                                                  10288000
102890     COPY DPPD013.                                                10289000
