000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 TITLE 'MANIFESTING - TRAILER STATUS CALLED MODULE'.              00040000
000500 PROGRAM-ID.             PCKCS896.                                00050000
000600 AUTHOR.                 DENISE HAHN.                             00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORE.                  00070000
000800 DATE-WRITTEN            MAY, 2001.                               00080000
000900 DATE-COMPILED.                                                   00090000
001000******************************************************************00100000
001100* THIS PROGRAM WILL BE USED TO DETERMINE THE CURRENT STATUS       00110000
001200* OF A GIVEN TRAILER                                              00120000
001300******************************************************************00130000
001400 ENVIRONMENT DIVISION.                                            00140000
001500 DATA DIVISION.                                                   00150000
001600******************************************************************00160000
001700 WORKING-STORAGE SECTION.                                         00170000
001800                                                                  00180000
001900 01  DK-DB2-KEYS.                                                 00190000
002000     05  DK-TRLR-SRL-NBR          PIC S9(09)  COMP.               00200000
002100     05  DK-OTBND-TRIP-ID         PIC S9(09)  COMP.               00210000
002200                                                                  00220000
002300                                                                  00230000
002400*----------------------------------------------------------------*00240000
002500* COMMAREA USED WHEN LINKING FROM A CALLING PROGRAM               00250000
002600*----------------------------------------------------------------*00260000
002700     COPY PCWS048.                                                00270000
002800                                                                  00280000
002900*----------------------------------------------------------------*00290000
003000*  PROGRAM CONSTANTS                                             *00300000
003100*----------------------------------------------------------------*00310000
003200 01  PC-PROGRAM-CONSTANTS.                                        00320000
003300     05  PC-T                     PIC  X(01)  VALUE 'T'.          00330000
003310     05  PC-SPOT-CHECK            PIC  X(02)  VALUE '02'.         00331000
003320     05  PC-100-PERCENT           PIC  X(02)  VALUE '01'.         00332000
003330     05  PC-DEFAULT-TMST          PIC  X(26)  VALUE               00333000
003340                                  '9999-09-09-09.09.09.999999'.   00334000
003350                                                                  00335000
003360*----------------------------------------------------------------*00336000
003370*  PROGRAM SWITCHES                                              *00337000
003380*----------------------------------------------------------------*00338000
003390 01  PS-PROGRAM-SWITCHES.                                         00339000
003400     05  PS-TRAILER-VALIDATION-SW        PIC  X(01)  VALUE ' '.   00340000
003500         88  PS-VALIDATE-ORIGINAL                    VALUE 'O'.   00350000
003600         88  PS-VALIDATE-AUDIT-TO                    VALUE 'A'.   00360000
003700     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'N'.   00370000
003800         88  PS-ERROR                                VALUE 'Y'.   00380000
003900         88  PS-ERROR-NO                             VALUE 'N'.   00390000
003901     05  PS-ROW-FOUND-SW                 PIC  X(01)  VALUE 'N'.   00390104
003902         88  PS-ROW-FOUND                            VALUE 'Y'.   00390202
003903         88  PS-ROW-NOT-FND                          VALUE 'N'.   00390302
003910     05  PS-END-OF-TRIP-CSR-SW           PIC  X(01)  VALUE 'N'.   00391002
003920         88  PS-END-OF-TRIP-CSR                      VALUE 'Y'.   00392002
003930         88  PS-NOT-END-OF-TRIP-CSR                  VALUE 'N'.   00393002
004000                                                                  00400000
004100*----------------------------------------------------------------*00410000
004200*  PROGRAM VARIABLES                                             *00420000
004300*----------------------------------------------------------------*00430000
004400 01  PV-PROGRAM-VARIABLES.                                        00440000
004500                                                                  00450000
004510     05  PV-CURRENT-TRIP-ID              PIC S9(09) COMP.         00451000
004520     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 00452000
004530     05  PV-DISPLAY-TRLR-SRL             PIC  9(09).              00453000
004540     05  PV-DISPLAY-SQLCODE              PIC -9(05) VALUE ZEROES. 00454000
004550     05  PV-SQL-RETURN-CD                PIC  999-.               00455000
004560     05  PV-EIBTASKN                     PIC  Z(06)9.             00456000
004570                                                                  00457000
004580                                                                  00458000
004590     05  PV-COMMAREA-LENGTH              PIC S9(04)  COMP         00459000
004600                                                     VALUE ZERO.  00460000
004700     05  PV-CICS-RESP                    PIC S9(08)  VALUE ZEROS  00470000
004800                                                     COMP SYNC.   00480000
004900                                                                  00490000
005000                                                                  00500000
005100******************************************************************00510000
005200*  DB2 TABLE FOR TRAILER ID TABLE                                 00520000
005300******************************************************************00530000
005400     EXEC SQL                                                     00540000
005500          INCLUDE TCNTRID                                         00550000
005600     END-EXEC.                                                    00560000
005700                                                                  00570000
005800******************************************************************00580000
005900*  DB2 TABLE FOR OUTBOUND TRAILER TRIP TABLE                      00590000
006000******************************************************************00600000
006100     EXEC SQL                                                     00610000
006200          INCLUDE TSUOBTR                                         00620000
006300     END-EXEC.                                                    00630000
006400                                                                  00640000
006500******************************************************************00650000
006600*  DB2 TABLE FOR OUTBOUND TRAILER TRIP STATUS TABLE               00660000
006700******************************************************************00670000
006800     EXEC SQL                                                     00680000
006900          INCLUDE TSUOBTS                                         00690000
007000     END-EXEC.                                                    00700000
007100                                                                  00710000
007200******************************************************************00720000
007300*  DB2 TABLE FOR TRIP STATUS CODE DESCRIPTION TABLE               00730000
007400******************************************************************00740000
007500     EXEC SQL                                                     00750000
007600          INCLUDE TSUOBSC                                         00760000
007700     END-EXEC.                                                    00770000
007800                                                                  00780000
007900******************************************************************00790000
008000*  DB2 TABLE FOR AUDIT TABLE                                      00800000
008100******************************************************************00810000
008200     EXEC SQL                                                     00820000
008300          INCLUDE TSUNAUD                                         00830000
008400     END-EXEC.                                                    00840000
008500                                                                  00850000
008600******************************************************************00860000
008700*  DB2 TABLE FOR AUDIT TRAILER TRIP TABLE                         00870000
008800******************************************************************00880000
008900     EXEC SQL                                                     00890000
009000          INCLUDE SUT00004                                        00900000
009100     END-EXEC.                                                    00910000
009200                                                                  00920000
009300*----------------------------------------------------------------*00930000
009400*  COMMUNICATIONS AREA FOR DB2                                   *00940000
009500*----------------------------------------------------------------*00950000
009600     EXEC SQL                                                     00960000
009700         INCLUDE SQLCA                                            00970000
009800     END-EXEC.                                                    00980000
009900                                                                  00990000
009910*---------------------------------------------------------------* 00991001
009920* CURSOR FOR SELECTING MAX TRIP ID FROM TSUOBTS                   00992001
009930*---------------------------------------------------------------* 00993001
009940     EXEC SQL                                                     00994001
009950          DECLARE CURR_TRIP_CSR CURSOR FOR                        00995001
009952          SELECT A.OTBND_TRIP_ID                                  00995201
009953                ,A.TRIP_STAT_CDE                                  00995301
009954                ,A.OTBND_STAT_TMST                                00995401
009955                ,A.STAT_OPER_UNT_ID                               00995501
009956                ,A.OTBND_STAT_USR_ID                              00995601
009957                ,A.DOOR_ID                                        00995701
009958                ,A.TRLR_PRKG_LOC_DESC                             00995801
009959                ,A.TRLR_PRKG_SLOT_NBR                             00995901
009960                ,C.TRIP_STAT_DESC                                 00996001
009961                ,C.STAT_SHRT_DESC                                 00996101
009962                ,B.ORGN_OPER_UNT_ID                               00996201
009963                ,B.DEST_OPER_UNT_ID                               00996301
009964                ,B.DOOR_TYP_CDE                                   00996401
009978          FROM   TSUOBTS A                                        00997801
009979                ,TSUOBTR B                                        00997901
009980                ,TSUOBSC C                                        00998001
009981          WHERE  B.TRLR_SRL_NBR    = :DK-TRLR-SRL-NBR             00998101
009983            AND  B.TRIP_ACTV_CDE   = 'A'                          00998301
009984            AND  A.OTBND_TRIP_ID   = B.OTBND_TRIP_ID              00998401
009985            AND  A.TRIP_STAT_CDE   = C.TRIP_STAT_CDE              00998501
009986            AND  A.OTBND_STAT_TMST =                              00998601
009987                 (SELECT MAX(D.OTBND_STAT_TMST)                   00998701
009988                    FROM TSUOBTS D                                00998801
009989                   WHERE D.OTBND_TRIP_ID = A.OTBND_TRIP_ID)       00998901
010011           ORDER BY A.OTBND_STAT_TMST DESC                        01001101
010012     END-EXEC.                                                    01001201
010013                                                                  01001301
010014                                                                  01001401
010020                                                                  01002000
010100******************************************************************01010000
010200 LINKAGE SECTION.                                                 01020000
010300******************************************************************01030000
010400 01  DFHCOMMAREA.                                                 01040000
010500     05  FILLER                         OCCURS  1 TO 4072 TIMES   01050000
010600                                      DEPENDING ON EIBCALEN.      01060000
010700         10  FILLER                   PIC X.                      01070000
010800                                                                  01080000
010900******************************************************************01090000
011000 PROCEDURE DIVISION.                                              01100000
011100******************************************************************01110000
011200 0000-PROGRAM-MAINLINE.                                           01120000
011300     MOVE EIBTASKN                 TO  PV-EIBTASKN                01130000
011400     INITIALIZE                        PC048-COMMAREA-REC.        01140000
011500     MOVE DFHCOMMAREA              TO  PC048-COMMAREA-REC.        01150000
011600                                                                  01160000
011700     MOVE  PC048-TRLR-SRL-NBR      TO  DK-TRLR-SRL-NBR.           01170000
011800     MOVE  SPACES                  TO  PC048-OTBND-TRIP-STATUS    01180000
011900                                       PC048-AUD-TO-TRIP-STATUS.  01190000
012000                                                                  01200000
012100     SET  PS-VALIDATE-ORIGINAL     TO  TRUE.                      01210000
012200     PERFORM 1000-CHECK-TRLR-SRL.                                 01220000
012300                                                                  01230000
012400     SET PS-NOT-END-OF-TRIP-CSR                                   01240004
012500         PS-ROW-NOT-FND         TO TRUE.                          01250004
012600     PERFORM 1050-OPEN-CURR-TRIP-CSR.                             01260002
012610     PERFORM 1100-GET-TRIP-STATUS                                 01261001
012611             UNTIL PS-ROW-FOUND  OR                               01261101
012612                   PS-END-OF-TRIP-CSR.                            01261202
012620     PERFORM 1150-CLOSE-CURR-TRIP-CSR.                            01262001
012700                                                                  01270000
012800     IF  PC048-OPEN-FOR-AUDIT    OR                               01280000
012900         PC048-CLOSE-AUDIT-KEEP  OR                               01290000
013000         PC048-CLOSE-AUDIT-REL                                    01300000
013100         PERFORM 2000-GET-AUDIT-INFO                              01310000
013200     ELSE                                                         01320000
013300         PERFORM 2200-CHECK-FOR-SPOT-AUD                          01330000
013400     END-IF.                                                      01340000
013500                                                                  01350000
013600     SET PC048-SUCCESSFUL TO TRUE.                                01360000
013700     PERFORM 9998-RETURN.                                         01370000
013800                                                                  01380000
013900                                                                  01390000
014000*-----------------------------------------------------------------01400000
014100*CHECK TO SEE IF THE TRAILER SERIAL NUMBER IS VALID.              01410000
014200*-----------------------------------------------------------------01420000
014300 1000-CHECK-TRLR-SRL.                                             01430000
014400     EXEC SQL                                                     01440000
014500          SELECT  SCAC_CDE                                        01450000
014600                 ,TRLR_ID                                         01460000
014700            INTO :CNTRID-SCAC-CDE                                 01470000
014800                ,:CNTRID-TRLR-ID                                  01480000
014900            FROM  TCNTRID                                         01490000
015000           WHERE  TRLR_SRL_NBR  =  :DK-TRLR-SRL-NBR               01500000
015100     END-EXEC.                                                    01510000
015200                                                                  01520000
015300     EVALUATE TRUE                                                01530000
015400         WHEN SQLCODE = ZERO                                      01540000
015500              IF  PS-VALIDATE-ORIGINAL                            01550000
015600                  MOVE  CNTRID-SCAC-CDE  TO  PC048-SCAC-CDE       01560000
015700                  MOVE  CNTRID-TRLR-ID   TO  PC048-TRLR-ID        01570000
015800              ELSE                                                01580000
015900                  MOVE  CNTRID-SCAC-CDE  TO  PC048-AUD-TO-SCAC-CDE01590000
016000                  MOVE  CNTRID-TRLR-ID   TO  PC048-AUD-TO-TRLR-ID 01600000
016100              END-IF                                              01610000
016200                                                                  01620000
016300         WHEN SQLCODE = +100                                      01630000
016400              IF  PS-VALIDATE-ORIGINAL                            01640000
016500                  SET  PC048-INVALID-TRLR         TO  TRUE        01650000
016600              ELSE                                                01660000
016700                  SET  PC048-AUD-TO-INVALID-TRLR TO   TRUE        01670000
016800              END-IF                                              01680000
016900                                                                  01690000
017000         WHEN SQLCODE = -904                                      01700000
017100         WHEN SQLCODE = -911                                      01710000
017200         WHEN SQLCODE = -913                                      01720000
017300              SET   PS-ERROR            TO  TRUE                  01730000
017400              MOVE  DK-TRLR-SRL-NBR     TO  PV-DISPLAY-TRLR-SRL   01740000
017500              MOVE  SQLCODE             TO  PV-DISPLAY-SQLCODE    01750000
017600                                            PV-SQL-RETURN-CD      01760000
017700              STRING  ' PCKCS896-1000-'     DELIMITED BY SIZE     01770000
017800                      PV-DISPLAY-TRLR-SRL   DELIMITED BY SIZE     01780000
017900                      ' SQLCODE-'           DELIMITED BY SIZE     01790000
018000                      PV-DISPLAY-SQLCODE    DELIMITED BY SIZE     01800000
018100                      ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     01810000
018200                                      INTO PV-CICS-MSG-AREA2      01820000
018300              MOVE LENGTH OF PV-CICS-MSG-AREA2                    01830000
018400                TO PV-COMMAREA-LENGTH                             01840000
018500              PERFORM 9999-WRITE-TO-CSSL                          01850000
018600                                                                  01860000
018700             STRING 'ERR FILE# SQL='       DELIMITED BY SIZE      01870000
018800                    PV-SQL-RETURN-CD       DELIMITED BY SIZE      01880000
018900                                      INTO PC048-CRA-RET-MSG      01890000
019000             SET  PC048-DATABASE-BUSY    TO TRUE                  01900000
019100             MOVE '1000-'                TO PC048-CRA-REQ-ID      01910000
019200             PERFORM 9998-RETURN                                  01920000
019300                                                                  01930000
019400         WHEN SQLWARN0 NOT = SPACES                               01940000
019500         WHEN SQLCODE NOT EQUAL ZERO                              01950000
019600              MOVE  DK-TRLR-SRL-NBR     TO  PV-DISPLAY-TRLR-SRL   01960000
019700              MOVE  SQLCODE             TO  PV-DISPLAY-SQLCODE    01970000
019800                                            PV-SQL-RETURN-CD      01980000
019900              STRING  ' PCKCS896-1000-'     DELIMITED BY SIZE     01990000
020000                      PV-DISPLAY-TRLR-SRL   DELIMITED BY SIZE     02000000
020100                      '  CALLED BY-'        DELIMITED BY SIZE     02010000
020200                      PC048-CALLING-PGM-NME DELIMITED BY SIZE     02020000
020300                      '  SQLCODE='          DELIMITED BY SIZE     02030000
020400                      PV-DISPLAY-SQLCODE    DELIMITED BY SIZE     02040000
020500                      ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     02050000
020600                                      INTO PV-CICS-MSG-AREA2      02060000
020700             MOVE LENGTH OF PV-CICS-MSG-AREA2                     02070000
020800               TO PV-COMMAREA-LENGTH                              02080000
020900              PERFORM 9999-WRITE-TO-CSSL                          02090000
021000                                                                  02100000
021100         STRING 'ERR FILE# SQL='            DELIMITED BY SIZE     02110000
021200                PV-SQL-RETURN-CD            DELIMITED BY SIZE     02120000
021300                                       INTO PC048-CRA-RET-MSG     02130000
021400             SET  PC048-INVALID-SQL      TO TRUE                  02140000
021500             MOVE '1000-'                TO PC048-CRA-REQ-ID      02150000
021600             PERFORM 9998-RETURN                                  02160000
021700                                                                  02170000
021800     END-EVALUATE.                                                02180000
021900                                                                  02190000
022000                                                                  02200000
022100*-----------------------------------------------------------------02210000
022200* OPEN THE CURRENT TRIP CSR                                       02220002
022400*-----------------------------------------------------------------02240000
022500 1050-OPEN-CURR-TRIP-CSR.                                         02250002
022600                                                                  02260000
022800                                                                  02280000
022900     EXEC SQL                                                     02290000
023000        OPEN CURR_TRIP_CSR                                        02300002
023100     END-EXEC.                                                    02310000
023101                                                                  02310100
023102     EVALUATE TRUE                                                02310200
023103         WHEN SQLCODE = ZERO                                      02310300
023104              CONTINUE                                            02310400
023105                                                                  02310500
023140         WHEN SQLCODE = -904                                      02314000
023150         WHEN SQLCODE = -911                                      02315000
023160         WHEN SQLCODE = -913                                      02316000
023170              SET   PS-ERROR            TO  TRUE                  02317000
023180              MOVE  DK-TRLR-SRL-NBR     TO  PV-DISPLAY-TRLR-SRL   02318000
023190              MOVE  SQLCODE             TO  PV-DISPLAY-SQLCODE    02319000
023200                                            PV-SQL-RETURN-CD      02320000
023210              STRING  ' PCKCS896-1050-'     DELIMITED BY SIZE     02321000
023220                      PV-DISPLAY-TRLR-SRL   DELIMITED BY SIZE     02322000
023221                      ' SQLCODE-'           DELIMITED BY SIZE     02322100
023222                      PV-DISPLAY-SQLCODE    DELIMITED BY SIZE     02322200
023223                      ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     02322300
023224                                      INTO PV-CICS-MSG-AREA2      02322400
023225              MOVE LENGTH OF PV-CICS-MSG-AREA2                    02322500
023226                TO PV-COMMAREA-LENGTH                             02322600
023227              PERFORM 9999-WRITE-TO-CSSL                          02322700
023228                                                                  02322800
023229             STRING 'ERR FILE# SQL='       DELIMITED BY SIZE      02322900
023230                    PV-SQL-RETURN-CD       DELIMITED BY SIZE      02323000
023231                                      INTO PC048-CRA-RET-MSG      02323100
023232             SET  PC048-DATABASE-BUSY    TO TRUE                  02323200
023233             MOVE '1050-'                TO PC048-CRA-REQ-ID      02323300
023234             PERFORM 9998-RETURN                                  02323400
023235                                                                  02323500
023236         WHEN SQLWARN0 NOT = SPACES                               02323600
023237         WHEN SQLCODE NOT EQUAL ZERO                              02323700
023238              MOVE  DK-TRLR-SRL-NBR     TO  PV-DISPLAY-TRLR-SRL   02323800
023239              MOVE  SQLCODE             TO  PV-DISPLAY-SQLCODE    02323900
023240                                            PV-SQL-RETURN-CD      02324000
023241              STRING  ' PCKCS896-1050-'     DELIMITED BY SIZE     02324100
023242                      PV-DISPLAY-TRLR-SRL   DELIMITED BY SIZE     02324200
023243                      '  CALLED BY-'        DELIMITED BY SIZE     02324300
023244                      PC048-CALLING-PGM-NME DELIMITED BY SIZE     02324400
023245                      '  SQLCODE='          DELIMITED BY SIZE     02324500
023246                      PV-DISPLAY-SQLCODE                          02324600
023247                      ' TASK= ' PV-EIBTASKN                       02324700
023248                      DELIMITED BY SIZE                           02324800
023249                                      INTO PV-CICS-MSG-AREA2      02324900
023250             MOVE LENGTH OF PV-CICS-MSG-AREA2                     02325000
023251               TO PV-COMMAREA-LENGTH                              02325100
023252              PERFORM 9999-WRITE-TO-CSSL                          02325200
023253                                                                  02325300
023254         STRING 'ERR FILE# SQL='            DELIMITED BY SIZE     02325400
023255                PV-SQL-RETURN-CD            DELIMITED BY SIZE     02325500
023256                                       INTO PC048-CRA-RET-MSG     02325600
023257             SET  PC048-INVALID-SQL      TO TRUE                  02325700
023258             MOVE '1050-'                TO PC048-CRA-REQ-ID      02325800
023259             PERFORM 9998-RETURN                                  02325900
023260                                                                  02326000
023261     END-EVALUATE.                                                02326100
023262                                                                  02326200
023263                                                                  02326300
023264*-----------------------------------------------------------------02326400
023265* CHECK TO SEE IF THE CARTON HAS BEEN SCANNED OFF THE TRAILER     02326500
023266*-----------------------------------------------------------------02326600
023267 1100-GET-TRIP-STATUS.                                            02326700
023268                                                                  02326800
023269     EXEC SQL                                                     02326900
023270          FETCH  CURR_TRIP_CSR                                    02327002
024300          INTO   :SUOBTS-OTBND-TRIP-ID                            02430000
024400                ,:SUOBTS-TRIP-STAT-CDE                            02440000
024500                ,:SUOBTS-OTBND-STAT-TMST                          02450000
024600                ,:SUOBTS-STAT-OPER-UNT-ID                         02460000
024700                ,:SUOBTS-OTBND-STAT-USR-ID                        02470000
024800                ,:SUOBTS-DOOR-ID                                  02480000
024900                ,:SUOBTS-TRLR-PRKG-LOC-DESC                       02490000
025000                ,:SUOBTS-TRLR-PRKG-SLOT-NBR                       02500000
025100                ,:SUOBSC-TRIP-STAT-DESC                           02510000
025200                ,:SUOBSC-STAT-SHRT-DESC                           02520000
025300                ,:SUOBTR-ORGN-OPER-UNT-ID                         02530000
025400                ,:SUOBTR-DEST-OPER-UNT-ID                         02540000
025500                ,:SUOBTR-DOOR-TYP-CDE                             02550000
026800     END-EXEC.                                                    02680000
026900                                                                  02690000
027000                                                                  02700000
027100     EVALUATE TRUE                                                02710000
027200         WHEN SQLCODE = ZERO                                      02720000
027210              SET PS-ROW-FOUND  TO   TRUE                         02721002
027300              IF  PS-VALIDATE-ORIGINAL                            02730000
027400                  MOVE SUOBTS-OTBND-TRIP-ID                       02740000
027500                    TO PC048-OTBND-TRIP-ID                        02750000
027600                  MOVE SUOBTS-TRIP-STAT-CDE                       02760000
027700                    TO PC048-OTBND-TRIP-STATUS                    02770000
027800                  MOVE SUOBTS-OTBND-STAT-TMST                     02780000
027900                    TO PC048-TRIP-STAT-TMST                       02790000
028000                  MOVE SUOBSC-TRIP-STAT-DESC                      02800000
028100                    TO PC048-OTBND-TRIP-STATUS-DESC               02810000
028200                 MOVE SUOBSC-STAT-SHRT-DESC                       02820000
028300                    TO PC048-TRIP-STAT-SHRT-DESC                  02830000
028400                  MOVE SUOBTR-ORGN-OPER-UNT-ID                    02840000
028500                    TO PC048-ORGN-OPER-UNT-ID                     02850000
028600                  MOVE SUOBTR-DEST-OPER-UNT-ID                    02860000
028700                    TO PC048-DEST-OPER-UNT-ID                     02870000
028800                  MOVE SUOBTS-STAT-OPER-UNT-ID                    02880000
028900                    TO PC048-STATUS-OPER-UNIT                     02890000
029000                  MOVE SUOBTS-OTBND-STAT-USR-ID                   02900000
029100                    TO PC048-STATUS-USER-ID                       02910000
029200                  MOVE SUOBTS-DOOR-ID                             02920000
029300                    TO PC048-DOOR-ID                              02930000
029400                  MOVE SUOBTS-TRLR-PRKG-LOC-DESC                  02940000
029500                    TO PC048-PRKG-LOC-DESC                        02950000
029600                  MOVE SUOBTS-TRLR-PRKG-SLOT-NBR                  02960000
029700                    TO PC048-PRKG-SLOT-NBR                        02970000
029800                  MOVE SUOBTR-DOOR-TYP-CDE                        02980000
029900                    TO PC048-DOOR-TYP-CDE                         02990000
030000              ELSE                                                03000000
030100                  MOVE SUOBTS-OTBND-TRIP-ID                       03010000
030200                    TO PC048-AUD-TO-TRIP-ID                       03020000
030300                  MOVE SUOBTS-TRIP-STAT-CDE                       03030000
030400                    TO PC048-AUD-TO-TRIP-STATUS                   03040000
030500                  MOVE SUOBTS-OTBND-STAT-TMST                     03050000
030600                    TO PC048-AUD-TO-STAT-TMST                     03060000
030700                  MOVE SUOBSC-TRIP-STAT-DESC                      03070000
030800                    TO PC048-AUD-TO-TRIP-STAT-DESC                03080000
030900                 MOVE SUOBSC-STAT-SHRT-DESC                       03090000
031000                    TO PC048-AUD-TOTRIP-STAT-SHRTDESC             03100000
031100                  MOVE SUOBTR-ORGN-OPER-UNT-ID                    03110000
031200                    TO PC048-AUD-TO-ORIG-OPER                     03120000
031300                  MOVE SUOBTR-DEST-OPER-UNT-ID                    03130000
031400                    TO PC048-AUD-TO-DEST-OPER                     03140000
031500                  MOVE SUOBTS-STAT-OPER-UNT-ID                    03150000
031600                    TO PC048-AUD-TO-STAT-OPER                     03160000
031700                  MOVE SUOBTS-OTBND-STAT-USR-ID                   03170000
031800                    TO PC048-AUD-TO-STAT-USER                     03180000
031900                  MOVE SUOBTS-DOOR-ID                             03190000
032000                    TO PC048-AUD-TO-DOOR-ID                       03200000
032100                  MOVE SUOBTS-TRLR-PRKG-LOC-DESC                  03210000
032200                    TO PC048-AUD-TO-PRKG-DESC                     03220000
032300                  MOVE SUOBTS-TRLR-PRKG-SLOT-NBR                  03230000
032400                    TO PC048-AUD-TO-SLOT-NBR                      03240000
032500                  MOVE SUOBTR-DOOR-TYP-CDE                        03250000
032600                    TO PC048-AUD-TO-DOOR-TYP-CDE                  03260000
032700              END-IF                                              03270000
032800                                                                  03280000
032900         WHEN SQLCODE = +100                                      03290000
033000              IF  PS-VALIDATE-ORIGINAL                            03300000
033100                  SET  PC048-NO-ACTIVE-TRIP      TO  TRUE         03310000
033200              ELSE                                                03320000
033300                  SET  PC048-AUD-TO-NO-ACT-TRIP  TO  TRUE         03330002
033400              END-IF                                              03340000
033410              SET PS-END-OF-TRIP-CSR         TO  TRUE             03341002
033600         WHEN SQLCODE = -904                                      03360000
033700         WHEN SQLCODE = -911                                      03370000
033800         WHEN SQLCODE = -913                                      03380000
033900              SET   PS-ERROR            TO  TRUE                  03390000
034000              MOVE  DK-TRLR-SRL-NBR     TO  PV-DISPLAY-TRLR-SRL   03400000
034100              MOVE  SQLCODE             TO  PV-DISPLAY-SQLCODE    03410000
034200                                            PV-SQL-RETURN-CD      03420000
034300              STRING  ' PCKCS896-1100-'     DELIMITED BY SIZE     03430000
034400                      PV-DISPLAY-TRLR-SRL   DELIMITED BY SIZE     03440000
034500                      ' SQLCODE-'           DELIMITED BY SIZE     03450000
034600                      PV-DISPLAY-SQLCODE    DELIMITED BY SIZE     03460000
034700                      ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     03470000
034800                                      INTO PV-CICS-MSG-AREA2      03480000
034900              MOVE LENGTH OF PV-CICS-MSG-AREA2                    03490000
035000                TO PV-COMMAREA-LENGTH                             03500000
035100              PERFORM 9999-WRITE-TO-CSSL                          03510000
035200                                                                  03520000
035300             STRING 'ERR FILE# SQL='       DELIMITED BY SIZE      03530000
035400                    PV-SQL-RETURN-CD       DELIMITED BY SIZE      03540000
035500                                      INTO PC048-CRA-RET-MSG      03550000
035600             SET  PC048-DATABASE-BUSY    TO TRUE                  03560000
035700             MOVE '1100-'                TO PC048-CRA-REQ-ID      03570000
035800             PERFORM 9998-RETURN                                  03580000
035900                                                                  03590000
036000         WHEN SQLWARN0 NOT = SPACES                               03600000
036100         WHEN SQLCODE NOT EQUAL ZERO                              03610000
036200              MOVE  DK-TRLR-SRL-NBR     TO  PV-DISPLAY-TRLR-SRL   03620000
036300              MOVE  SQLCODE             TO  PV-DISPLAY-SQLCODE    03630000
036400                                            PV-SQL-RETURN-CD      03640000
036500              STRING  ' PCKCS896-1100-'     DELIMITED BY SIZE     03650000
036600                      PV-DISPLAY-TRLR-SRL   DELIMITED BY SIZE     03660000
036700                      '  CALLED BY-'        DELIMITED BY SIZE     03670000
036800                      PC048-CALLING-PGM-NME DELIMITED BY SIZE     03680000
036900                      '  SQLCODE='          DELIMITED BY SIZE     03690000
037000                      PV-DISPLAY-SQLCODE                          03700000
037100                      ' TASK= ' PV-EIBTASKN                       03710000
037200                      DELIMITED BY SIZE                           03720000
037210                                      INTO PV-CICS-MSG-AREA2      03721000
037220             MOVE LENGTH OF PV-CICS-MSG-AREA2                     03722000
037230               TO PV-COMMAREA-LENGTH                              03723000
037231              PERFORM 9999-WRITE-TO-CSSL                          03723100
037232                                                                  03723200
037233         STRING 'ERR FILE# SQL='            DELIMITED BY SIZE     03723300
037234                PV-SQL-RETURN-CD            DELIMITED BY SIZE     03723400
037235                                       INTO PC048-CRA-RET-MSG     03723500
037236             SET  PC048-INVALID-SQL      TO TRUE                  03723600
037237             MOVE '1100-'                TO PC048-CRA-REQ-ID      03723700
037238             PERFORM 9998-RETURN                                  03723800
037239                                                                  03723900
037240     END-EVALUATE.                                                03724000
037241                                                                  03724100
037242                                                                  03724200
037243*-----------------------------------------------------------------03724302
037244* CLSOE THE CURRENT TRIP CSR                                      03724402
037245*-----------------------------------------------------------------03724502
037246 1150-CLOSE-CURR-TRIP-CSR.                                        03724602
037247                                                                  03724702
037248                                                                  03724802
037249     EXEC SQL                                                     03724902
037250        CLOSE CURR_TRIP_CSR                                       03725003
037251     END-EXEC.                                                    03725102
037252                                                                  03725202
037253     EVALUATE TRUE                                                03725302
037254         WHEN SQLCODE = ZERO                                      03725402
037255              CONTINUE                                            03725502
037256                                                                  03725602
037257         WHEN SQLCODE = -904                                      03725702
037258         WHEN SQLCODE = -911                                      03725802
037259         WHEN SQLCODE = -913                                      03725902
037260              SET   PS-ERROR            TO  TRUE                  03726002
037261              MOVE  DK-TRLR-SRL-NBR     TO  PV-DISPLAY-TRLR-SRL   03726102
037262              MOVE  SQLCODE             TO  PV-DISPLAY-SQLCODE    03726202
037263                                            PV-SQL-RETURN-CD      03726302
037264              STRING  ' PCKCS896-1150-'     DELIMITED BY SIZE     03726402
037265                      PV-DISPLAY-TRLR-SRL   DELIMITED BY SIZE     03726502
037266                      ' SQLCODE-'           DELIMITED BY SIZE     03726602
037267                      PV-DISPLAY-SQLCODE    DELIMITED BY SIZE     03726702
037268                      ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     03726802
037269                                      INTO PV-CICS-MSG-AREA2      03726902
037270              MOVE LENGTH OF PV-CICS-MSG-AREA2                    03727002
037271                TO PV-COMMAREA-LENGTH                             03727102
037272              PERFORM 9999-WRITE-TO-CSSL                          03727202
037273                                                                  03727302
037274             STRING 'ERR FILE# SQL='       DELIMITED BY SIZE      03727402
037275                    PV-SQL-RETURN-CD       DELIMITED BY SIZE      03727502
037276                                      INTO PC048-CRA-RET-MSG      03727602
037277             SET  PC048-DATABASE-BUSY    TO TRUE                  03727702
037278             MOVE '1150-'                TO PC048-CRA-REQ-ID      03727802
037279             PERFORM 9998-RETURN                                  03727902
037280                                                                  03728002
037281         WHEN SQLWARN0 NOT = SPACES                               03728102
037282         WHEN SQLCODE NOT EQUAL ZERO                              03728202
037283              MOVE  DK-TRLR-SRL-NBR     TO  PV-DISPLAY-TRLR-SRL   03728302
037284              MOVE  SQLCODE             TO  PV-DISPLAY-SQLCODE    03728402
037285                                            PV-SQL-RETURN-CD      03728502
037286              STRING  ' PCKCS896-1150-'     DELIMITED BY SIZE     03728602
037287                      PV-DISPLAY-TRLR-SRL   DELIMITED BY SIZE     03728702
037288                      '  CALLED BY-'        DELIMITED BY SIZE     03728802
037289                      PC048-CALLING-PGM-NME DELIMITED BY SIZE     03728902
037290                      '  SQLCODE='          DELIMITED BY SIZE     03729002
037291                      PV-DISPLAY-SQLCODE                          03729102
037292                      ' TASK= ' PV-EIBTASKN                       03729202
037293                      DELIMITED BY SIZE                           03729302
037294                                      INTO PV-CICS-MSG-AREA2      03729402
037295             MOVE LENGTH OF PV-CICS-MSG-AREA2                     03729502
037296               TO PV-COMMAREA-LENGTH                              03729602
037297              PERFORM 9999-WRITE-TO-CSSL                          03729702
037298                                                                  03729802
037299         STRING 'ERR FILE# SQL='            DELIMITED BY SIZE     03729902
037300                PV-SQL-RETURN-CD            DELIMITED BY SIZE     03730002
037301                                       INTO PC048-CRA-RET-MSG     03730102
037302             SET  PC048-INVALID-SQL      TO TRUE                  03730202
037303             MOVE '1150-'                TO PC048-CRA-REQ-ID      03730302
037304             PERFORM 9998-RETURN                                  03730402
037305                                                                  03730502
037306     END-EVALUATE.                                                03730602
037307                                                                  03730702
037308                                                                  03730802
037309*-----------------------------------------------------------------03730900
037310* IF TRAILER IS BEING AUDITED - GET THE AUDIT DATA                03731000
037311*-----------------------------------------------------------------03731100
037312 2000-GET-AUDIT-INFO.                                             03731200
037313                                                                  03731300
037314     PERFORM 2100-GET-AUDIT-TO-TRLR.                              03731400
037315                                                                  03731500
037316     IF  PC048-DEST-TRLR-SRL-NBR  >  ZEROES                       03731600
037317         IF  PC048-DEST-TRLR-SRL-NBR  =  PC048-TRLR-SRL-NBR       03731700
037318             CONTINUE                                             03731800
037319         ELSE                                                     03731900
037320             SET  PS-VALIDATE-AUDIT-TO  TO  TRUE                  03732000
037330             PERFORM 1000-CHECK-TRLR-SRL                          03733000
037400         END-IF                                                   03740000
037500     END-IF.                                                      03750000
037600                                                                  03760000
037700                                                                  03770000
037800*-----------------------------------------------------------------03780000
037900* GET AUDIT TO TRAILER AND AUDIT NUMBER                           03790000
038000*-----------------------------------------------------------------03800000
038100 2100-GET-AUDIT-TO-TRLR.                                          03810000
038200                                                                  03820000
038300     MOVE SUOBTS-OTBND-TRIP-ID   TO   DK-OTBND-TRIP-ID.           03830000
038400                                                                  03840000
038500     EXEC SQL                                                     03850000
038600          SELECT A.AUD_CNTL_NBR                                   03860000
038700                ,A.AUD_STRT_TMST                                  03870000
038800                ,A.AUD_USR_ID                                     03880000
038900                ,A.OPER_UNT_ID                                    03890000
039000                ,A.AUD_STAT_CDE                                   03900000
039100                ,A.AUD_TYP_CDE                                    03910000
039200                ,A.DEST_TYP_CDE                                   03920000
039300          INTO   :SUNAUD-AUD-CNTL-NBR                             03930000
039400                ,:SUNAUD-AUD-STRT-TMST                            03940000
039500                ,:SUNAUD-AUD-USR-ID                               03950000
039600                ,:SUNAUD-OPER-UNT-ID                              03960000
039700                ,:SUNAUD-AUD-STAT-CDE                             03970000
039800                ,:SUNAUD-AUD-TYP-CDE                              03980000
039900                ,:SUNAUD-DEST-TYP-CDE                             03990000
040000          FROM   TSUNAUD A                                        04000000
040100               , SUT_AUD_TRLR_TRIP B                              04010000
040200          WHERE  A.AUD_CNTL_NBR       =  B.AUD_CNTL_NBR           04020000
040300            AND  A.AUD_CAT_CDE        = :PC-T                     04030000
040400            AND  A.AUD_STP_TMST       = :PC-DEFAULT-TMST          04040000
040500            AND  B.ORIG_OTBND_TRIP_ID = :DK-OTBND-TRIP-ID         04050000
040600     END-EXEC.                                                    04060000
040700                                                                  04070000
040800     EVALUATE TRUE                                                04080000
040900         WHEN SQLCODE = ZERO                                      04090000
041000              MOVE SUNAUD-AUD-CNTL-NBR                            04100000
041100                TO PC048-AUD-CNTL-NBR                             04110000
041200              MOVE SUNAUD-AUD-STRT-TMST                           04120000
041300                TO PC048-AUD-STRT-TMST                            04130000
041400              MOVE SUNAUD-AUD-USR-ID                              04140000
041500                TO PC048-AUD-USR-ID                               04150000
041600              MOVE SUNAUD-OPER-UNT-ID                             04160000
041700                TO PC048-OPER-UNT-ID                              04170000
041800              MOVE SUNAUD-AUD-STAT-CDE                            04180000
041900                TO PC048-AUD-STAT-CDE                             04190000
042000              MOVE SUNAUD-AUD-TYP-CDE                             04200000
042100                TO PC048-AUD-TYP-CDE                              04210000
042200              MOVE SUNAUD-DEST-TYP-CDE                            04220000
042300                TO PC048-DEST-TYP-CDE                             04230000
042400                                                                  04240000
042500         WHEN SQLCODE = +100                                      04250000
042600              CONTINUE                                            04260000
042700                                                                  04270000
042800         WHEN SQLCODE = -904                                      04280000
042900         WHEN SQLCODE = -911                                      04290000
043000         WHEN SQLCODE = -913                                      04300000
043100              SET   PS-ERROR            TO  TRUE                  04310000
043200              MOVE  DK-TRLR-SRL-NBR     TO  PV-DISPLAY-TRLR-SRL   04320000
043300              MOVE  SQLCODE             TO  PV-DISPLAY-SQLCODE    04330000
043400                                            PV-SQL-RETURN-CD      04340000
043500              STRING  ' PCKCS896-2100-'     DELIMITED BY SIZE     04350000
043600                      PV-DISPLAY-TRLR-SRL   DELIMITED BY SIZE     04360000
043700                      ' SQLCODE-'           DELIMITED BY SIZE     04370000
043800                      PV-DISPLAY-SQLCODE    DELIMITED BY SIZE     04380000
043900                      ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     04390000
044000                                      INTO PV-CICS-MSG-AREA2      04400000
044100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    04410000
044200                TO PV-COMMAREA-LENGTH                             04420000
044300              PERFORM 9999-WRITE-TO-CSSL                          04430000
044400                                                                  04440000
044500             STRING 'ERR FILE# SQL='       DELIMITED BY SIZE      04450000
044600                    PV-SQL-RETURN-CD       DELIMITED BY SIZE      04460000
044700                                      INTO PC048-CRA-RET-MSG      04470000
044800             SET  PC048-DATABASE-BUSY    TO TRUE                  04480000
044900             MOVE '2100-'                TO PC048-CRA-REQ-ID      04490000
045000             PERFORM 9998-RETURN                                  04500000
045100                                                                  04510000
045200         WHEN SQLWARN0 NOT = SPACES                               04520000
045300         WHEN SQLCODE NOT EQUAL ZERO                              04530000
045400              MOVE  DK-TRLR-SRL-NBR     TO  PV-DISPLAY-TRLR-SRL   04540000
045500              MOVE  SQLCODE             TO  PV-DISPLAY-SQLCODE    04550000
045600                                            PV-SQL-RETURN-CD      04560000
045700              STRING  ' PCKCS896-2100-'     DELIMITED BY SIZE     04570000
045800                      PV-DISPLAY-TRLR-SRL   DELIMITED BY SIZE     04580000
045900                      '  CALLED BY-'        DELIMITED BY SIZE     04590000
046000                      PC048-CALLING-PGM-NME DELIMITED BY SIZE     04600000
046100                      '  SQLCODE='          DELIMITED BY SIZE     04610000
046200                      PV-DISPLAY-SQLCODE                          04620000
046300                      ' TASK= ' PV-EIBTASKN                       04630000
046400                      DELIMITED BY SIZE                           04640000
046500                                      INTO PV-CICS-MSG-AREA2      04650000
046600             MOVE LENGTH OF PV-CICS-MSG-AREA2                     04660000
046700               TO PV-COMMAREA-LENGTH                              04670000
046800              PERFORM 9999-WRITE-TO-CSSL                          04680000
046900                                                                  04690000
047000         STRING 'ERR FILE# SQL='            DELIMITED BY SIZE     04700000
047100                PV-SQL-RETURN-CD            DELIMITED BY SIZE     04710000
047200                                       INTO PC048-CRA-RET-MSG     04720000
047300             SET  PC048-INVALID-SQL      TO TRUE                  04730000
047400             MOVE '2100-'                TO PC048-CRA-REQ-ID      04740000
047500             PERFORM 9998-RETURN                                  04750000
047600                                                                  04760000
047700     END-EVALUATE.                                                04770000
047800                                                                  04780000
047900                                                                  04790000
048000*-----------------------------------------------------------------04800000
048100* CHECK TO SEE IF THERE IS AN ACTIVE SPOT AUDIT                   04810000
048200*-----------------------------------------------------------------04820000
048300 2200-CHECK-FOR-SPOT-AUD.                                         04830000
048400                                                                  04840000
048500     MOVE SUOBTS-OTBND-TRIP-ID   TO   DK-OTBND-TRIP-ID.           04850000
048600                                                                  04860000
048700     EXEC SQL                                                     04870000
048800          SELECT A.AUD_CNTL_NBR                                   04880000
048900                ,A.AUD_STRT_TMST                                  04890000
049000                ,A.AUD_USR_ID                                     04900000
049100                ,A.OPER_UNT_ID                                    04910000
049200                ,A.AUD_STAT_CDE                                   04920000
049300                ,A.AUD_TYP_CDE                                    04930000
049400                ,A.DEST_TYP_CDE                                   04940000
049500          INTO   :SUNAUD-AUD-CNTL-NBR                             04950000
049600                ,:SUNAUD-AUD-STRT-TMST                            04960000
049700                ,:SUNAUD-AUD-USR-ID                               04970000
049800                ,:SUNAUD-OPER-UNT-ID                              04980000
049900                ,:SUNAUD-AUD-STAT-CDE                             04990000
050000                ,:SUNAUD-AUD-TYP-CDE                              05000000
050001                ,:SUNAUD-DEST-TYP-CDE                             05000100
050002          FROM   TSUNAUD A                                        05000200
050003               , SUT_AUD_TRLR_TRIP B                              05000300
050004          WHERE  A.AUD_CNTL_NBR       =  B.AUD_CNTL_NBR           05000400
050005            AND  A.AUD_CAT_CDE        = :PC-T                     05000500
050006            AND  A.AUD_TYP_CDE        = :PC-SPOT-CHECK            05000600
050007            AND  A.AUD_STP_TMST       = :PC-DEFAULT-TMST          05000700
050008            AND  B.ORIG_OTBND_TRIP_ID = :DK-OTBND-TRIP-ID         05000800
050009     END-EXEC.                                                    05000900
050010                                                                  05001000
050011     EVALUATE TRUE                                                05001100
050012         WHEN SQLCODE = ZERO                                      05001200
050013              MOVE SUNAUD-AUD-CNTL-NBR                            05001300
050014                TO PC048-AUD-CNTL-NBR                             05001400
050015              MOVE SUNAUD-AUD-STRT-TMST                           05001500
050016                TO PC048-AUD-STRT-TMST                            05001600
050017              MOVE SUNAUD-AUD-USR-ID                              05001700
050018                TO PC048-AUD-USR-ID                               05001800
050019              MOVE SUNAUD-OPER-UNT-ID                             05001900
050020                TO PC048-OPER-UNT-ID                              05002000
050021              MOVE SUNAUD-AUD-STAT-CDE                            05002100
050022                TO PC048-AUD-STAT-CDE                             05002200
050023              MOVE SUNAUD-AUD-TYP-CDE                             05002300
050024                TO PC048-AUD-TYP-CDE                              05002400
050025              MOVE SUNAUD-DEST-TYP-CDE                            05002500
050026                TO PC048-DEST-TYP-CDE                             05002600
050027                                                                  05002700
050028         WHEN SQLCODE = +100                                      05002800
050029              CONTINUE                                            05002900
050030                                                                  05003000
050031         WHEN SQLCODE = -904                                      05003100
050032         WHEN SQLCODE = -911                                      05003200
050033         WHEN SQLCODE = -913                                      05003300
050034              SET   PS-ERROR            TO  TRUE                  05003400
050035              MOVE  DK-TRLR-SRL-NBR     TO  PV-DISPLAY-TRLR-SRL   05003500
050036              MOVE  SQLCODE             TO  PV-DISPLAY-SQLCODE    05003600
050037                                            PV-SQL-RETURN-CD      05003700
050038              STRING  ' PCKCS896-2200-'     DELIMITED BY SIZE     05003800
050039                      PV-DISPLAY-TRLR-SRL   DELIMITED BY SIZE     05003900
050040                      ' SQLCODE-'           DELIMITED BY SIZE     05004000
050041                      PV-DISPLAY-SQLCODE    DELIMITED BY SIZE     05004100
050042                      ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     05004200
050043                                      INTO PV-CICS-MSG-AREA2      05004300
050044              MOVE LENGTH OF PV-CICS-MSG-AREA2                    05004400
050045                TO PV-COMMAREA-LENGTH                             05004500
050046              PERFORM 9999-WRITE-TO-CSSL                          05004600
050047                                                                  05004700
050048             STRING 'ERR FILE# SQL='       DELIMITED BY SIZE      05004800
050049                    PV-SQL-RETURN-CD       DELIMITED BY SIZE      05004900
050050                                      INTO PC048-CRA-RET-MSG      05005000
050051             SET  PC048-DATABASE-BUSY    TO TRUE                  05005100
050052             MOVE '2200-'                TO PC048-CRA-REQ-ID      05005200
050053             PERFORM 9998-RETURN                                  05005300
050054                                                                  05005400
050055         WHEN SQLWARN0 NOT = SPACES                               05005500
050056         WHEN SQLCODE NOT EQUAL ZERO                              05005600
050057              MOVE  DK-TRLR-SRL-NBR     TO  PV-DISPLAY-TRLR-SRL   05005700
050058              MOVE  SQLCODE             TO  PV-DISPLAY-SQLCODE    05005800
050059                                            PV-SQL-RETURN-CD      05005900
050060              STRING  ' PCKCS896-2200-'     DELIMITED BY SIZE     05006000
050061                      PV-DISPLAY-TRLR-SRL   DELIMITED BY SIZE     05006100
050062                      '  CALLED BY-'        DELIMITED BY SIZE     05006200
050063                      PC048-CALLING-PGM-NME DELIMITED BY SIZE     05006300
050064                      '  SQLCODE='          DELIMITED BY SIZE     05006400
050065                      PV-DISPLAY-SQLCODE                          05006500
050066                      ' TASK= ' PV-EIBTASKN                       05006600
050067                      DELIMITED BY SIZE                           05006700
050068                                      INTO PV-CICS-MSG-AREA2      05006800
050069             MOVE LENGTH OF PV-CICS-MSG-AREA2                     05006900
050070               TO PV-COMMAREA-LENGTH                              05007000
050071              PERFORM 9999-WRITE-TO-CSSL                          05007100
050072                                                                  05007200
050073         STRING 'ERR FILE# SQL='            DELIMITED BY SIZE     05007300
050074                PV-SQL-RETURN-CD            DELIMITED BY SIZE     05007400
050075                                       INTO PC048-CRA-RET-MSG     05007500
050076             SET  PC048-INVALID-SQL      TO TRUE                  05007600
050077             MOVE '2200-'                TO PC048-CRA-REQ-ID      05007700
050078             PERFORM 9998-RETURN                                  05007800
050079                                                                  05007900
050080     END-EVALUATE.                                                05008000
050081                                                                  05008100
050082                                                                  05008200
050083*-----------------------------------------------------------------05008300
050084*  RETURN TO CALLING PROGRAM                                      05008400
050085*-----------------------------------------------------------------05008500
050086 9998-RETURN.                                                     05008600
050087                                                                  05008700
050088     INITIALIZE                    PV-CICS-MSG-AREA2.             05008800
050089     STRING ' PCKCS896 ENDED - TASK = '                           05008900
050090              PV-EIBTASKN                                         05009000
050100              DELIMITED BY SIZE                                   05010000
050200                              INTO PV-CICS-MSG-AREA2              05020000
050300     PERFORM 9999-WRITE-TO-CSSL.                                  05030000
050400                                                                  05040000
050500     MOVE PC048-COMMAREA-REC            TO DFHCOMMAREA.           05050000
050600                                                                  05060000
050700     EXEC CICS                                                    05070000
050800          RETURN                                                  05080000
050900     END-EXEC.                                                    05090000
051000                                                                  05100000
051100                                                                  05110000
051200 9999-WRITE-TO-CSSL.                                              05120000
051300     MOVE LENGTH OF PV-CICS-MSG-AREA2                             05130000
051400       TO PV-COMMAREA-LENGTH                                      05140000
051500     EXEC CICS                                                    05150000
051600          WRITEQ TD                                               05160000
051700           QUEUE   ('CSSL')                                       05170000
051800            FROM   (PV-CICS-MSG-AREA2)                            05180000
051900          LENGTH   (PV-COMMAREA-LENGTH)                           05190000
052000            RESP   (PV-CICS-RESP)                                 05200000
052100     END-EXEC.                                                    05210000
052200                                                                  05220000
