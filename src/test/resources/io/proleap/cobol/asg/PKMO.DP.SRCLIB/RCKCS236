000100 IDENTIFICATION DIVISION.                                         00010025
000200 PROGRAM-ID.    RCKCS236.                                         00020025
000300 AUTHOR.        TOM RUSKA. G&R.                                   00030025
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040025
000500 DATE-WRITTEN.  03-09-94.                                         00050025
000600 DATE-COMPILED.                                                   00060025
000700                                                                  00070025
000800*---------------------------------------------------------------* 00080025
000900*    TRANID      - E236                                         * 00090025
001000*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * 00100025
001100*    DESCRIPTION - MAINTAIN SHIPMENT PURCHASE ORDER             * 00110025
001200*    MAPSET      - RCKM236                                      * 00120025
001300*                                                               * 00130025
001400*    THIS PROGRAM WILL MAINTAIN SHIPMENT PURCHASE ORDERS.       * 00140025
001500*                                                               * 00150025
001600*---------------------------------------------------------------* 00160025
001700*  CHANGED 10/21/2014    BY COGNIZANT       WR: CHG0094517        00170025
001800*                                                                 00180025
001900* EXTENDED PO# FROM 7 TO 8 DIGITS WHERE NEEDED.                   00190025
002000*-----------------------------------------------------------------00200025
002100* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00210025
002200* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00220025
002300* MAKING THE CALL DYNAMIC VS STATIC.                              00230025
002400*---------------------------------------------------------------* 00240025
002500                                                                  00250025
002600 ENVIRONMENT DIVISION.                                            00260025
002700 DATA DIVISION.                                                   00270025
002800                                                                  00280025
002900/                                                                 00290025
003000 WORKING-STORAGE SECTION.                                         00300025
003100                                                                  00310025
003200 01  DK-DB2-KEYS.                                                 00320025
003300     05  DK-OPER-UNT-ID               PIC S9(04) VALUE +0         00330025
003400                                                 COMP.            00340025
003500     05  DK-FCLTY-ID                  PIC S9(04) VALUE +0         00350025
003600                                                 COMP.            00360025
003700     05  DK-TRIP-ID                   PIC S9(09) VALUE +0         00370025
003800                                                 COMP.            00380025
003900     05  DK-SHIPT-ID                  PIC S9(09) VALUE +0         00390025
004000                                                 COMP.            00400025
004100     05  DK-PO-NBR                    PIC S9(09) VALUE +0         00410025
004200                                                 COMP.            00420025
004300     05  DK-PRO-NBR                   PIC  X(16) VALUE SPACES.    00430025
004400     05  DK-BOL-NBR                   PIC  X(16) VALUE SPACES.    00440025
004500     05  DK-REC-SEQ-NBR               PIC S9(02) VALUE +0         00450025
004600                                                 COMP.            00460025
004700                                                                  00470025
004800 01  PC-PROGRAM-CONSTANTS.                                        00480025
004900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00490025
005000                                                    'RC236A  '.   00500025
005100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00510025
005200                                                    'RCKM236 '.   00520025
005300     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00530025
005400                                                    COMP.         00540025
005500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00550025
005600                                                    'RCKCS236'.   00560025
005700     05  PC-AUDIT-RTN                   PIC  X(08)  VALUE         00570025
005800                                                    'RCKCS290'.   00580025
005900     05  PC-AUDIT-RTN-LENGTH            PIC S9(04)  VALUE  +300   00590025
006000                                                    COMP SYNC.    00600025
006100     05  PC-INTER-APPL-CODES.                                     00610025
006200         10  PC-INTER-APPL-LIST-ADD     PIC  X(01)  VALUE '1'.    00620025
006300         10  PC-INTER-APPL-LIST-UPD     PIC  X(01)  VALUE '2'.    00630025
006400         10  PC-INTER-APPL-LIST-DEL     PIC  X(01)  VALUE '3'.    00640025
006500         10  PC-INTER-APPL-LIST-LIST    PIC  X(01)  VALUE '4'.    00650025
006600         10  PC-INTER-APPL-ADD-SHIP     PIC  X(01)  VALUE '5'.    00660025
006700         10  PC-INTER-APPL-IMP-RLSE     PIC  X(01)  VALUE '6'.    00670025
006800     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00680025
006900                                                    COMP-3.       00690025
007000     05  PC-IP                          PIC  X(02)  VALUE 'IP'.   00700025
007100     05  PC-VE                          PIC  X(02)  VALUE 'VE'.   00710025
007200     05  PC-AV                          PIC  X(02)  VALUE 'AV'.   00720025
007300     05  PC-VS                          PIC  X(02)  VALUE 'VS'.   00730025
007400     05  PC-A                           PIC  X(01)  VALUE 'A'.    00740025
007500     05  PC-D                           PIC  X(01)  VALUE 'D'.    00750025
007600     05  PC-U                           PIC  X(01)  VALUE 'U'.    00760025
007700     05  PC-Y                           PIC  X(01)  VALUE 'Y'.    00770025
007800     05  PC-R                           PIC  X(01)  VALUE 'R'.    00780025
007900     05  PC-S                           PIC  X(01)  VALUE 'S'.    00790025
008000     05  PC-DASH                        PIC  X(01)  VALUE '-'.    00800025
008100     05  PC-ACTIVE                      PIC  X(01)  VALUE 'A'.    00810025
008200     05  PC-PO-ACTIVE                   PIC  X(02)  VALUE 'AC'.   00820025
008300     05  PC-IMPORT                      PIC  X(02)  VALUE 'IM'.   00830025
008400     05  PC-DEFAULT-DATE              PIC X(10)  VALUE            00840025
008500                                                 '0001-01-01'.    00850025
008600     05  PC-DEFAULT-TIME              PIC X(08)  VALUE            00860025
008700                                                 '00.00.00'.      00870025
008800     05  PC-DEFAULT-DATE-9S           PIC X(10)  VALUE            00880025
008900                                                 '9999-09-09'.    00890025
009000     05  PC-1                     PIC  9(01)  VALUE 1.            00900025
009100     05  PC-N                     PIC  X(01)  VALUE 'N'.          00910025
009200     05  PC-DFLT-IMPORL-DATE      PIC X(10) VALUE '9999-09-09'.   00920025
009300     05  PC-DFLT-IMPORL-TIME      PIC X(08) VALUE '09.09.09'.     00930025
009400                                                                  00940025
009500     05  PC-TSYMSG-NUMBERS.                                       00950025
009600         10  PC-TSYMSG-00004            PIC  9(05)  VALUE  00004. 00960025
009700         10  PC-TSYMSG-00005            PIC  9(05)  VALUE  00005. 00970025
009800         10  PC-TSYMSG-00007            PIC  9(05)  VALUE  00007. 00980025
009900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE  00008. 00990025
010000         10  PC-TSYMSG-00034            PIC  9(05)  VALUE  00034. 01000025
010100         10  PC-TSYMSG-00046            PIC  9(05)  VALUE  00046. 01010025
010200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE  00057. 01020025
010300         10  PC-TSYMSG-00059            PIC  9(05)  VALUE  00059. 01030025
010400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE  00069. 01040025
010500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE  00070. 01050025
010600         10  PC-TSYMSG-00083            PIC  9(05)  VALUE  00083. 01060025
010700         10  PC-TSYMSG-00115            PIC  9(05)  VALUE  00115. 01070025
010800         10  PC-TSYMSG-00116            PIC  9(05)  VALUE  00116. 01080025
010900         10  PC-TSYMSG-00117            PIC  9(05)  VALUE  00117. 01090025
011000         10  PC-TSYMSG-00148            PIC  9(05)  VALUE  00148. 01100025
011100         10  PC-TSYMSG-00463            PIC  9(05)  VALUE  00463. 01110025
011200         10  PC-TSYMSG-00734            PIC  9(05)  VALUE  00734. 01120025
011300         10  PC-TSYMSG-00743            PIC  9(05)  VALUE  00743. 01130025
011400         10  PC-TSYMSG-01040            PIC  9(05)  VALUE  01040. 01140025
011500         10  PC-TSYMSG-01061            PIC  9(05)  VALUE  01061. 01150025
011600         10  PC-TSYMSG-01303            PIC  9(05)  VALUE  01303. 01160025
011700         10  PC-TSYMSG-01317            PIC  9(05)  VALUE  01317. 01170025
011800         10  PC-TSYMSG-02539            PIC  9(05)  VALUE  02539. 01180025
011900         10  PC-TSYMSG-02541            PIC  9(05)  VALUE  02541. 01190025
012000         10  PC-TSYMSG-02641            PIC  9(05)  VALUE  02641. 01200025
012100         10  PC-TSYMSG-02642            PIC  9(05)  VALUE  02642. 01210025
012200                                                                  01220025
012300 01  PS-PROGRAM-SWITCHES.                                         01230025
012400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01240025
012500         88  PS-NO-ERROR                            VALUE 'Y'.    01250025
012600         88  PS-ERROR                               VALUE 'N'.    01260025
012700     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01270025
012800         88  PS-DONE                                VALUE 'Y'.    01280025
012900         88  PS-NOT-DONE                            VALUE 'N'.    01290025
013000     05  PS-SHPTPO-FOUND-SW             PIC  X(01)  VALUE 'N'.    01300025
013100         88  PS-SHPTPO-FOUND                        VALUE 'Y'.    01310025
013200         88  PS-SHPTPO-NOT-FOUND                    VALUE 'N'.    01320025
013300     05  PS-SHIPMT-FOUND-SW             PIC  X(01)  VALUE 'N'.    01330025
013400         88  PS-SHIPMT-FOUND                        VALUE 'Y'.    01340025
013500         88  PS-SHIPMT-NOT-FOUND                    VALUE 'N'.    01350025
013600     05  PS-IN-PROCESS-SW                PIC  X(01)  VALUE 'N'.   01360025
013700         88  PS-IN-PROCESS                           VALUE 'Y'.   01370025
013800         88  PS-NOT-IN-PROCESS                       VALUE 'N'.   01380025
013900     05  PS-UPDATE-TRECEIV-SW            PIC  X(01)  VALUE 'N'.   01390025
014000         88  PS-UPDATE-TRECEIV                       VALUE 'Y'.   01400025
014100         88  PS-DONT-UPDATE-TRECEIV                  VALUE 'N'.   01410025
014200     05  PS-DISPLAY-DISTRO-SW     PIC  X(01)  VALUE 'N'.          01420025
014300         88  PS-DISPLAY-DISTRO-MSG            VALUE 'Y'.          01430025
014400         88  PS-DONT-DISPLAY-DISTRO-MSG       VALUE 'N'.          01440025
014500     05  PS-NO-DISTRO-SW          PIC  X(01)  VALUE 'N'.          01450025
014600         88  PS-DISTRO                        VALUE 'Y'.          01460025
014700         88  PS-NO-DISTRO                     VALUE 'N'.          01470025
014800     05  PS-CHECK-TSHPTPO-SW      PIC  X(01)  VALUE 'N'.          01480025
014900         88  PS-CHECK-TSHPTPO                 VALUE 'Y'.          01490025
015000         88  PS-DONT-CHECK-TSHPTPO            VALUE 'N'.          01500025
015100     05  PS-UPDATE-TIMPORL-SW     PIC  X(01)  VALUE 'N'.          01510025
015200         88  PS-UPDATE-TIMPORL                VALUE 'Y'.          01520025
015300         88  PS-DONT-UPDATE-TIMPORL           VALUE 'N'.          01530025
015400     05  PS-TIMCNRL-EXISTS-SW     PIC  X(01)  VALUE 'N'.          01540025
015500         88  PS-TIMCNRL-EXISTS                VALUE 'Y'.          01550025
015600         88  PS-TIMCNRL-EXISTS-NO             VALUE 'N'.          01560025
015700     05  PS-TIMCNPO-EXISTS-SW     PIC  X(01)  VALUE 'N'.          01570025
015800         88  PS-TIMCNPO-EXISTS                VALUE 'Y'.          01580025
015900         88  PS-TIMCNPO-EXISTS-NO             VALUE 'N'.          01590025
016000     05  PS-CMN-SPLITS-MSG-SW     PIC  X(01)  VALUE 'N'.          01600025
016100         88  PS-CMN-SPLITS-MSG                VALUE 'Y'.          01610025
016200         88  PS-CMN-SPLITS-MSG-NO             VALUE 'N'.          01620025
016300     05  PS-SHPTPO-SHIPMT-FOUND-SW    PIC X(01)  VALUE 'N'.       01630025
016400         88  PS-SHPTPO-SHIPMT-FOUND              VALUE 'Y'.       01640025
016500         88  PS-SHPTPO-SHIPMT-FOUND-NO           VALUE 'N'.       01650025
016600     05  PS-TIMCNPO-ROW-2-EXISTS-SW   PIC X(01)  VALUE 'N'.       01660025
016700         88  PS-TIMCNPO-ROW-2-EXISTS             VALUE 'Y'.       01670025
016800         88  PS-TIMCNPO-ROW-2-EXISTS-NO          VALUE 'N'.       01680025
016900     05  PS-EOC-PO-CONTNR-CSR-SW      PIC X(01)  VALUE 'N'.       01690025
017000         88  PS-EOC-PO-CONTNR-CSR                VALUE 'Y'.       01700025
017100         88  PS-EOC-PO-CONTNR-CSR-NO             VALUE 'N'.       01710025
017200 01  PV-PROGRAM-VARIABLES.                                        01720025
017300     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      01730025
017400                                                    COMP SYNC.    01740025
017500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01750025
017600                                                    COMP SYNC.    01760025
017700     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01770025
017800                                                    COMP-3.       01780025
017900     05  PV-TIMCNPO-COUNT               PIC S9(04)  VALUE +0      01790025
018000                                                    COMP-3.       01800025
018100     05  PV-OPER-UNT-ID                 PIC S9(04)   VALUE ZEROS  01810025
018200                                                     COMP.        01820025
018300     05  PV-SHPTPO-PO-NBR               PIC S9(09) VALUE +0       01830025
018400                                                     COMP.        01840025
018500     05  PV-IMCNPO-PO-NBR               PIC S9(09) VALUE +0       01850025
018600                                                     COMP.        01860025
018700     05  PV-IMCNPO-CONTNR-ID            PIC  X(16) VALUE SPACES.  01870025
018800     05  PV-PO-TYP-CDE           PIC X(02)  VALUE SPACES.         01880025
018900     05  PV-DPKUT038             PIC X(08)  VALUE 'DPKUT038'.     01890025
019000     05  PV-DPKUT038-CA-LENGTH   PIC S9(04) VALUE +1237           01900025
019100                                                COMP.             01910025
019200     05  ST-ABSTIME              PIC S9(16) VALUE ZERO.           01920025
019300     05  PV-CURRENT-DATE         PIC X(06)  VALUE SPACE.          01930025
019400     05  PV-TEMP-DATE.                                            01940025
019500         10  PV-DATE-CCYY             PIC X(04).                  01950025
019600         10  FILLER                   PIC X(01).                  01960025
019700         10  PV-DATE-MM               PIC X(02).                  01970025
019800         10  FILLER                   PIC X(01).                  01980025
019900         10  PV-DATE-DD               PIC X(02).                  01990025
020000     05  PV-WORK-DATE.                                            02000025
020100         10  PV-WK-DTE-MM             PIC X(02).                  02010025
020200         10  FILLER                   PIC X(01) VALUE '/'.        02020025
020300         10  PV-WK-DTE-DD             PIC X(02).                  02030025
020400         10  FILLER                   PIC X(01) VALUE '/'.        02040025
020500         10  PV-WK-DTE-YY             PIC X(04).                  02050025
020600     05  PV-RECEIV-ACTL-CART-CNT        PIC S9(04)  COMP.         02060025
020700     05  PV-RECEIV-EXPTED-CART-CNT      PIC S9(04)  COMP.         02070025
020800     05  PV-RECEIV-CART-CNT             PIC S9(04)  COMP.         02080025
020900     05  PV-SHPTPO-CART-CNT             PIC S9(04)  COMP.         02090025
021000     05  PV-TRN-CDE                     PIC X(01) VALUE SPACE.    02100025
021100     05  PV-MESSAGE.                                              02110025
021200         10  PV-MESSAGE1                PIC X(10).                02120025
021300         10  PV-FILLER                  PIC X(01).                02130025
021400         10  PV-MESSAGE2                PIC X(10).                02140025
021500         10  PV-FILLER                  PIC X(01).                02150025
021600         10  PV-MESSAGE3                PIC X(10).                02160025
021700                                                                  02170025
021800*---------------------------------------------------------------* 02180025
021900*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02190025
022000*---------------------------------------------------------------* 02200025
022100                                                                  02210025
022200     COPY RCWS013.                                                02220025
022300                                                                  02230025
022400/                                                                 02240025
022500*---------------------------------------------------------------* 02250025
022600*  RECORD LAYOUT 'INSERT AUDIT MODULE'  RCKCS290                * 02260025
022700*---------------------------------------------------------------* 02270025
022800                                                                  02280025
022900     COPY RCWS031.                                                02290025
023000                                                                  02300025
023100/                                                                 02310025
023200*---------------------------------------------------------------* 02320025
023300*    MAP LAYOUT                                                 * 02330025
023400*---------------------------------------------------------------* 02340025
023500                                                                  02350025
023600     COPY RCKM236.                                                02360025
023700                                                                  02370025
023800/                                                                 02380025
023900*---------------------------------------------------------------* 02390025
024000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02400025
024100*---------------------------------------------------------------* 02410025
024200                                                                  02420025
024300     COPY DPWS015.                                                02430025
024400                                                                  02440025
024500*---------------------------------------------------------------* 02450025
024600*    FUNCTION KEYS COPYBOOK.                                    * 02460025
024700*---------------------------------------------------------------* 02470025
024800                                                                  02480025
024900     COPY DPWS016.                                                02490025
025000                                                                  02500025
025100*---------------------------------------------------------------* 02510025
025200*    NUMERIC EDIT LAYOUT.                                       * 02520025
025300*---------------------------------------------------------------* 02530025
025400                                                                  02540025
025500     COPY DPWS010I.                                               02550025
025600                                                                  02560025
025700*----------------------------------------------------------------*02570025
025800*  COPYBOOK FOR LOGISTICS DOMAIN LOCATION MODULE (XLKUT071)      *02580025
025900*----------------------------------------------------------------*02590025
026000     COPY XLWS071.                                                02600025
026100                                                                  02610025
026200/                                                                 02620025
026300******************************************************************02630026
026400** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **02640026
026410** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **02641026
026500******************************************************************02650026
026600                                                                  02660025
026700     COPY DPWS030.                                                02670025
026710     COPY DPWS930.                                                02671026
026800                                                                  02680025
026900/                                                                 02690025
027000*---------------------------------------------------------------* 02700025
027100*    STANDARD COMMAREA.                                         * 02710025
027200*---------------------------------------------------------------* 02720025
027300                                                                  02730025
027400     COPY DPWS020.                                                02740025
027500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02750025
027600                                                                  02760025
027700         10  INTER-APPL-COMM-AREA       PIC X(200).               02770025
027800     COPY RCWS012.                                                02780025
027900     COPY RCWS015.                                                02790025
028000     COPY TRWS005.                                                02800025
028100     COPY POWS011.                                                02810025
028200*---------------------------------------------------------------* 02820025
028300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02830025
028400*---------------------------------------------------------------* 02840025
028500         10  ASC-SPECIFIC-COMMAREA.                               02850025
028600             15  ASC-INT-APPL-FORMAT-IND    PIC X(01).            02860025
028700             15  ASC-ACTION-SW              PIC X(03).            02870025
028800                 88  ASC-ADD-PENDING        VALUE 'ADD'.          02880025
028900                 88  ASC-DELETE-PENDING     VALUE 'DEL'.          02890025
029000                 88  ASC-UPDATE-PENDING     VALUE 'UPD'.          02900025
029100             15  ASC-DELETE-SUCCESSFUL-SW   PIC X(01).            02910025
029200                 88  ASC-DELETE-SUCCESSFUL  VALUE 'Y'.            02920025
029300             15  ASC-ADD-SUCCESSFUL-SW      PIC X(01).            02930025
029400                 88  ASC-ADD-NOT-SUCCESSFUL VALUE ' '.            02940025
029500                 88  ASC-ADD-SUCCESSFUL     VALUE 'Y'.            02950025
029600             15  ASC-FIELDS-CHANGED-SW      PIC X(01).            02960025
029700                 88  ASC-FIELDS-CHANGED     VALUE 'Y'.            02970025
029800             15  ASC-SHPPO-NAME-SW          PIC X(01).            02980025
029900                 88  ASC-SHPPO-NAME-EXISTS  VALUE 'Y'.            02990025
030000             15  ASC-ACTIVE-PO-SW           PIC X(01).            03000025
030100                 88  ASC-ACTIVE-PO          VALUE 'Y'.            03010025
030200             15  ASC-INTER-APPL-LIST-SW     PIC X(01).            03020025
030300                 88  ASC-INTER-APPL-LIST-LIST                     03030025
030400                                            VALUE 'Y'.            03040025
030500             15  ASC-SPLITS-CHECKED-SW      PIC X(01).            03050025
030600                 88  ASC-SPLITS-CHECKED     VALUE 'Y'.            03060025
030700             15  ASC-LOCAL-01-SW                   PIC X(01).     03070025
030800                 88  ASC-LOCAL-01-NEED-CONFIRM     VALUE 'Y'.     03080025
030900                 88  ASC-LOCAL-01-NO-NEED-CONFIRM  VALUE 'N'.     03090025
031000             15  ASC-LOCAL-03-SW                   PIC X(01).     03100025
031100                 88  ASC-LOCAL-03-PROCESSED        VALUE 'Y'.     03110025
031200                 88  ASC-LOCAL-03-PROCESSED-NO     VALUE 'N'.     03120025
031300             15  ASC-REC-SEQ-NBR            PIC S9(09) COMP.      03130025
031400             15  ASC-KEY-FIELDS.                                  03140025
031500                 20  ASC-KEY-OPER-UNT-ID    PIC X(04).            03150025
031600                 20  ASC-KEY-OPER-UNT-ID-N REDEFINES              03160025
031700                     ASC-KEY-OPER-UNT-ID    PIC 9(04).            03170025
031800                 20  ASC-KEY-FCLTY-ID       PIC X(04).            03180025
031900                 20  ASC-KEY-FCLTY-ID-N REDEFINES                 03190025
032000                     ASC-KEY-FCLTY-ID       PIC 9(04).            03200025
032100                 20  ASC-KEY-PRO-NBR        PIC X(16).            03210025
032200                 20  ASC-KEY-BOL-NBR        PIC X(16).            03220025
032300                 20  ASC-KEY-TRIP-ID        PIC S9(09) COMP.      03230025
032400                 20  ASC-KEY-SHIPT-ID       PIC S9(09) COMP.      03240025
032500                 20  ASC-KEY-PO-NBR         PIC S9(09) COMP.      03250025
032600             15  ASC-SCREEN-FIELDS.                               03260025
032700                 20  ASC-FCLTY-NME          PIC X(25).            03270025
032800                 20  ASC-PO-NBR             PIC X(08).            03280025
032900                 20  ASC-PO-NBR-N REDEFINES ASC-PO-NBR            03290025
033000                                            PIC 9(08).            03300025
033100                 20  ASC-VEND-NAME          PIC X(30).            03310025
033200                 20  ASC-PKSL-IND           PIC X(01).            03320025
033300                 20  ASC-EXPTED-CART-CNT    PIC X(04).            03330025
033400                 20  ASC-EXPTED-CART-CNT-N REDEFINES              03340025
033500                     ASC-EXPTED-CART-CNT    PIC 9(04).            03350025
033600                 20  ASC-ACTL-CART-CNT      PIC X(04).            03360025
033700                 20  ASC-ACTL-CART-CNT-N REDEFINES                03370025
033800                     ASC-ACTL-CART-CNT      PIC 9(04).            03380025
033900                 20  ASC-DMG-CART-CNT       PIC X(04).            03390025
034000                 20  ASC-DMG-CART-CNT-N REDEFINES                 03400025
034100                     ASC-DMG-CART-CNT       PIC 9(04).            03410025
034200             15  ASC-SCREEN-FIELDS-OLD.                           03420025
034300                 20  ASC-PO-NBR-OLD          PIC X(08).           03430025
034400                 20  ASC-VEND-NAME-OLD       PIC X(30).           03440025
034500                 20  ASC-PKSL-IND-OLD        PIC X(01).           03450025
034600                 20  ASC-EXPTED-CART-CNT-OLD PIC X(04).           03460025
034700                 20  ASC-EXPTED-CART-CNT-OLD-N REDEFINES          03470025
034800                     ASC-EXPTED-CART-CNT-OLD PIC 9(04).           03480025
034900                 20  ASC-ACTL-CART-CNT-OLD   PIC X(04).           03490025
035000                 20  ASC-ACTL-CART-CNT-OLD-N REDEFINES            03500025
035100                     ASC-ACTL-CART-CNT-OLD   PIC 9(04).           03510025
035200                 20  ASC-DMG-CART-CNT-OLD    PIC X(04).           03520025
035300             15  ASC-VIEW-ONLY-FIELDS.                            03530025
035400                 20  ASC-PO-TYP-CDE          PIC X(02).           03540025
035500                 20  ASC-PO-TYP-CDE-DESC     PIC X(20).           03550025
035600                 20  ASC-PO-STATUS-DESC      PIC X(20).           03560025
035700                 20  ASC-DONT-SHIP-BEF-DTE   PIC X(10).           03570025
035800                 20  ASC-CANCEL-DTE          PIC X(10).           03580025
035900                 20  ASC-EXT-CAN-DTE         PIC X(10).           03590025
036000                 20  ASC-DEPT-NBR.                                03600025
036100                      25 ASC-DEPT-NBR-N      PIC 9(03).           03610025
036200                 20  ASC-DEPT-DESC           PIC X(25).           03620025
036300                 20  ASC-BUYER-NAME          PIC X(25).           03630025
036400                 20  ASC-NO-DISTRO-MSG       PIC X(09).           03640025
036500                 20  ASC-OTB-NBR.                                 03650025
036600                     25  ASC-OTB-CCYY        PIC X(04).           03660025
036700                     25  ASC-OTB-DASH        PIC X(01).           03670025
036800                     25  ASC-OTB-MM          PIC X(02).           03680025
036900                                                                  03690025
037000             15  ASC-USE-SELECTION-QUEUE-IND                      03700025
037100                                        PIC  X(01).               03710025
037200                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    03720025
037300             15  ASC-SEL-QUEUE-NAME     PIC  X(08).               03730025
037400             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05)  COMP-3.       03740025
037500             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03750025
037600                                        PIC S9(09)  COMP-3.       03760025
037700             15  ASC-SEL-SUB            PIC S9(04)  COMP.         03770025
037800             15  ASC-SEL-ITEM           PIC S9(04)  COMP.         03780025
037900                                                                  03790025
038000                                                                  03800025
038100/                                                                 03810025
038200*----------------------------------------------------------------*03820025
038300*     USED BY MBS SYSTEM TO GET BUYER NAME                       *03830025
038400*----------------------------------------------------------------*03840025
038500                                                                  03850025
038600     COPY DPWS003.                                                03860025
038700/                                                                 03870025
038800*----------------------------------------------------------------*03880025
038900**  SECURITY SUBROUTINE PARAMETERS                                03890025
039000*----------------------------------------------------------------*03900025
039100     COPY DPWS008.                                                03910025
039200/                                                                 03920025
039300*---------------------------------------------------------------* 03930025
039400*    ABEND PROCESSING COPYBOOK.                                 * 03940025
039500*---------------------------------------------------------------* 03950025
039600                                                                  03960025
039700     COPY DPWS013.                                                03970025
039800                                                                  03980025
039900/                                                                 03990025
040000*---------------------------------------------------------------* 04000025
040100*    DB2 AREA FOR THE FACILITY TABLE                            * 04010025
040200*---------------------------------------------------------------* 04020025
040300     EXEC SQL                                                     04030025
040400          INCLUDE TFACLTY                                         04040025
040500     END-EXEC.                                                    04050025
040600                                                                  04060025
040700/                                                                 04070025
040800*---------------------------------------------------------------* 04080025
040900*    DB2 AREA FOR SHIPMENT PO TABLE                             * 04090025
041000*---------------------------------------------------------------* 04100025
041100     EXEC SQL                                                     04110025
041200          INCLUDE TSHPTPO                                         04120025
041300     END-EXEC.                                                    04130025
041400                                                                  04140025
041500                                                                  04150025
041600*---------------------------------------------------------------* 04160025
041700*    DB2 AREA FOR SHIPMENT PO AUDIT TABLE                       * 04170025
041800*---------------------------------------------------------------* 04180025
041900     EXEC SQL                                                     04190025
042000          INCLUDE TAUSHPO                                         04200025
042100     END-EXEC.                                                    04210025
042200                                                                  04220025
042300/                                                                 04230025
042400*---------------------------------------------------------------* 04240025
042500*    DB2 AREA FOR SHIPMENT TABLE                                * 04250025
042600*---------------------------------------------------------------* 04260025
042700     EXEC SQL                                                     04270025
042800          INCLUDE TSHIPMT                                         04280025
042900     END-EXEC.                                                    04290025
043000                                                                  04300025
043100/                                                                 04310025
043200*---------------------------------------------------------------* 04320025
043300*    DB2 AREA FOR SHIPMENT STATUS TABLE                         * 04330025
043400*---------------------------------------------------------------* 04340025
043500     EXEC SQL                                                     04350025
043600          INCLUDE TSHIPST                                         04360025
043700     END-EXEC.                                                    04370025
043800                                                                  04380025
043900/                                                                 04390025
044000*---------------------------------------------------------------* 04400025
044100*    DB2 AREA FOR SHIPMENT STATUS TYPE TABLE                    * 04410025
044200*---------------------------------------------------------------* 04420025
044300     EXEC SQL                                                     04430025
044400          INCLUDE TSHSTYP                                         04440025
044500     END-EXEC.                                                    04450025
044600                                                                  04460025
044700/                                                                 04470025
044800*---------------------------------------------------------------* 04480025
044900*    DB2 AREA FOR PURCHASE ORDER TABLE                          * 04490025
045000*---------------------------------------------------------------* 04500025
045100     EXEC SQL                                                     04510025
045200          INCLUDE TPURCHS                                         04520025
045300     END-EXEC.                                                    04530025
045400                                                                  04540025
045500/                                                                 04550025
045600*---------------------------------------------------------------* 04560025
045700*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 04570025
045800*---------------------------------------------------------------* 04580025
045900     EXEC SQL                                                     04590025
046000          INCLUDE TENTNME                                         04600025
046100     END-EXEC.                                                    04610025
046200                                                                  04620025
046300/                                                                 04630025
046400*---------------------------------------------------------------* 04640025
046500*    DB2 AREA FOR THE RECEIVER TABLE                            * 04650025
046600*---------------------------------------------------------------* 04660025
046700     EXEC SQL                                                     04670025
046800          INCLUDE TRECEIV                                         04680025
046900     END-EXEC.                                                    04690025
047000                                                                  04700025
047100/                                                                 04710025
047200*---------------------------------------------------------------* 04720025
047300*    DB2 AREA FOR THE STATUS CODE TABLE                         * 04730025
047400*---------------------------------------------------------------* 04740025
047500     EXEC SQL                                                     04750025
047600          INCLUDE TSTATCD                                         04760025
047700     END-EXEC.                                                    04770025
047800                                                                  04780025
047900/                                                                 04790025
048000*---------------------------------------------------------------* 04800025
048100*    DB2 AREA FOR THE TYPE CODE DESCRIPTION TABLE               * 04810025
048200*---------------------------------------------------------------* 04820025
048300     EXEC SQL                                                     04830025
048400          INCLUDE TPOTYCD                                         04840025
048500     END-EXEC.                                                    04850025
048600                                                                  04860025
048700/                                                                 04870025
048800*---------------------------------------------------------------* 04880025
048900*    DB2 AREA FOR THE PLAN SHIPMENTS TABLE                      * 04890025
049000*---------------------------------------------------------------* 04900025
049100     EXEC SQL                                                     04910025
049200          INCLUDE TPLNSHP                                         04920025
049300     END-EXEC.                                                    04930025
049400                                                                  04940025
049500/                                                                 04950025
049600*---------------------------------------------------------------* 04960025
049700*    DB2 AREA FOR THE TRIP TABLE                                * 04970025
049800*---------------------------------------------------------------* 04980025
049900     EXEC SQL                                                     04990025
050000          INCLUDE TVHTRIP                                         05000025
050100     END-EXEC.                                                    05010025
050200                                                                  05020025
050300/                                                                 05030025
050400*---------------------------------------------------------------* 05040025
050500*    DB2 AREA FOR THE VEHICLE TABLE                             * 05050025
050600*---------------------------------------------------------------* 05060025
050700     EXEC SQL                                                     05070025
050800          INCLUDE TVEHICL                                         05080025
050900     END-EXEC.                                                    05090025
051000                                                                  05100025
051100/                                                                 05110025
051200*---------------------------------------------------------------* 05120025
051300*    DB2 AREA FOR THE PURCHASE ITEM TABLE                       * 05130025
051400*---------------------------------------------------------------* 05140025
051500     EXEC SQL                                                     05150025
051600          INCLUDE TPURITM                                         05160025
051700     END-EXEC.                                                    05170025
051800/                                                                 05180025
051900*---------------------------------------------------------------* 05190025
052000*    DB2 AREA FOR THE ALLOCATION PLAN TABLE                     * 05200025
052100*---------------------------------------------------------------* 05210025
052200     EXEC SQL                                                     05220025
052300          INCLUDE TALLPLN                                         05230025
052400     END-EXEC.                                                    05240025
052500                                                                  05250025
052600/                                                                 05260025
052700*---------------------------------------------------------------* 05270025
052800*    DB2 AREA FOR THE IMPORT PO RELEASE TABLE                   * 05280025
052900*---------------------------------------------------------------* 05290025
053000     EXEC SQL                                                     05300025
053100          INCLUDE TIMPORL                                         05310025
053200     END-EXEC.                                                    05320025
053300                                                                  05330025
053400/                                                                 05340025
053500*---------------------------------------------------------------* 05350025
053600*    DB2 AREA FOR THE IMPORT CONTAINER/PO RELEASE TABLE         * 05360025
053700*---------------------------------------------------------------* 05370025
053800     EXEC SQL                                                     05380025
053900          INCLUDE TIMCNRL                                         05390025
054000     END-EXEC.                                                    05400025
054100                                                                  05410025
054200/                                                                 05420025
054300*---------------------------------------------------------------* 05430025
054400*    DB2 AREA FOR THE IMPORT CONTAINER PO TABLE                 * 05440025
054500*---------------------------------------------------------------* 05450025
054600     EXEC SQL                                                     05460025
054700          INCLUDE TIMCNPO                                         05470025
054800     END-EXEC.                                                    05480025
054900                                                                  05490025
055000/                                                                 05500025
055100*---------------------------------------------------------------* 05510025
055200*    DB2 AREA FOR THE MDSE DISTRIBUTION TABLE                   * 05520025
055300*---------------------------------------------------------------* 05530025
055400     EXEC SQL                                                     05540025
055500          INCLUDE TMESTDS                                         05550025
055600     END-EXEC.                                                    05560025
055700                                                                  05570025
055800/                                                                 05580025
055900*    CURSOR USED TO DETERMINE IF THE 'NO DISTRO' MESSAGE SHOULD BE05590025
056000*    DISPLAYED.                                                   05600025
056100                                                                  05610025
056200     EXEC SQL                                                     05620025
056300          DECLARE PO_CSR CURSOR FOR                               05630025
056400            SELECT DISTINCT(B.PO_LNE_NBR)                         05640025
056500            FROM   TPURCHS A                                      05650025
056600                  ,TPURITM B                                      05660025
056700            WHERE  A.PO_NBR = B.PO_NBR                            05670025
056800            AND    A.PO_NBR = :DK-PO-NBR                          05680025
056900            AND    A.VER_STATUS_CDE = B.VER_STATUS_CDE            05690025
057000            AND    A.VER_STATUS_CDE = :PC-ACTIVE                  05700025
057100     END-EXEC.                                                    05710025
057200                                                                  05720025
057300/                                                                 05730025
057400*    CURSOR USED TO DETERMINE IF IMPORTS UCC128 ERROR MESSAGES    05740025
057500*    SHOULD BE DISPLAYED.                                         05750025
057600                                                                  05760025
057700     EXEC SQL                                                     05770025
057800          DECLARE PO_CONTNR_CSR CURSOR FOR                        05780025
057900            SELECT A.PO_NBR                                       05790025
058000                 , A.CONTNR_ID                                    05800025
058100            FROM   TIMCNPO A                                      05810025
058200            WHERE  A.PO_NBR     = :IMCNRL-PO-NBR                  05820025
058300            AND    A.CONTNR_ID <> :IMCNRL-CONTNR-ID               05830025
058400     END-EXEC.                                                    05840025
058500/                                                                 05850025
058600*---------------------------------------------------------------* 05860025
058700*    DB2 AREA FOR COMMUNICATIONS                                * 05870025
058800*---------------------------------------------------------------* 05880025
058900     EXEC SQL                                                     05890025
059000          INCLUDE SQLCA                                           05900025
059100     END-EXEC.                                                    05910025
059200                                                                  05920025
059300/                                                                 05930025
059400 LINKAGE SECTION.                                                 05940025
059500                                                                  05950025
059600 01  DFHCOMMAREA.                                                 05960025
059700     05  FILLER                         OCCURS  1 TO 4072 TIMES   05970025
059800                                        DEPENDING ON EIBCALEN.    05980025
059900         10  FILLER                     PIC X.                    05990025
060000                                                                  06000025
060100/                                                                 06010025
060200 PROCEDURE DIVISION.                                              06020025
060300*---------------------------------------------------------------* 06030025
060400*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 06040025
060500*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 06050025
060600*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 06060025
060700*---------------------------------------------------------------* 06070025
060800*0000-MAIN-MODULE.                                                06080025
060900                                                                  06090025
061000     INITIALIZE DP030-CICS-API-FIELDS.                            06100025
061100                                                                  06110025
061200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06120025
061300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06130025
061400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06140025
061500                                                                  06150025
061600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06160025
061700                                                                  06170025
061800     MOVE LENGTH OF RC236AI        TO DP030-MAP-LENGTH (1).       06180025
061900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06190025
062000                                                                  06200025
062100     PERFORM 0001-CALL-CICS-ARCH-API.                             06210025
062200     PERFORM 1000-CONTROL-PROCESSING                              06220025
062300                                                                  06230025
062400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06240025
062500     PERFORM 0001-CALL-CICS-ARCH-API.                             06250025
062600                                                                  06260025
062700*---------------------------------------------------------------* 06270025
062800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 06280025
062900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 06290025
063000*---------------------------------------------------------------* 06300025
063100 0001-CALL-CICS-ARCH-API.                                         06310025
063210     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06321026
063300                                    DFHCOMMAREA                   06330026
063400                                    DP030-CICS-API-FIELDS         06340026
063500                                    DP020-STANDARD-COMMAREA       06350026
063600                                    RC236AI.                      06360026
063700                                                                  06370025
063800     IF  DP030-RC-CALL-SUCCESSFUL                                 06380025
063900         CONTINUE                                                 06390025
064000     ELSE                                                         06400025
064100         SET DP013-NO-ROLLBACK                                    06410025
064200             DP013-XCTL-DISPLAY-RESTART                           06420025
064300             DP013-CICS-ABEND      TO TRUE                        06430025
064400         MOVE '0001-CALL-CICS-ARCH-API'                           06440025
064500                                   TO DP013-PARAGRAPH             06450025
064510         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O06451026
064520-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06452026
064800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06480025
064900         PERFORM DP013-0000-PROCESS-ABEND                         06490025
065000     END-IF.                                                      06500025
065100                                                                  06510025
065200*----------------------------------------------------------------*06520025
065300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06530025
065400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06540025
065500*----------------------------------------------------------------*06550025
065600                                                                  06560025
065700 1000-CONTROL-PROCESSING.                                         06570025
065800                                                                  06580025
065900     EVALUATE TRUE                                                06590025
066000         WHEN DP020-NEXT-ACT-INITIAL                              06600025
066100              PERFORM 1100-FIND-OBJECT-KEYS                       06610025
066200              IF  PS-ERROR                                        06620025
066300                  CONTINUE                                        06630025
066400              ELSE                                                06640025
066500                  PERFORM 4000-BUILD-INITIAL-PANEL                06650025
066600                  PERFORM 3200-RESET-ATTRIBUTES                   06660025
066700                  PERFORM 3500-SAVE-SCREEN-FIELDS                 06670025
066800                  IF PS-SHPTPO-NOT-FOUND                          06680025
066900                  AND NOT ASC-ADD-PENDING                         06690025
067000                      SET DP020-NEXT-ACT-APPL-ERROR               06700025
067100                                     TO TRUE                      06710025
067200                      MOVE PC-TSYMSG-00148                        06720025
067300                                     TO DP020-MSG-NUMBER          06730025
067400                      SET DP020-MSG-INFORMATIONAL                 06740025
067500                                     TO TRUE                      06750025
067600                  ELSE                                            06760025
067700                      IF  ASC-DELETE-PENDING                      06770025
067800                          MOVE PC-TSYMSG-00004                    06780025
067900                                     TO DP020-MSG-NUMBER          06790025
068000                          SET DP020-MSG-INFORMATIONAL             06800025
068100                                     TO TRUE                      06810025
068200                      END-IF                                      06820025
068300                  END-IF                                          06830025
068400              END-IF                                              06840025
068500                                                                  06850025
068600         WHEN DP020-NEXT-ACT-READ-MAP                             06860025
068700             PERFORM 2000-PROCESS-PANEL                           06870025
068800                                                                  06880025
068900         WHEN DP020-NEXT-ACT-RETURN                               06890025
069000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06900025
069100             IF ASC-LOCAL-03-PROCESSED-NO                         06910025
069200                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               06920025
069300             END-IF                                               06930025
069400                                                                  06940025
069500         WHEN OTHER                                               06950025
069600             SET DP013-LOGIC-ABEND TO TRUE                        06960025
069700             SET DP013-NO-ROLLBACK TO TRUE                        06970025
069800             MOVE '1000-CONTROL-PROCESSING'                       06980025
069900                                   TO DP013-PARAGRAPH             06990025
070000             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   07000025
070100                                   TO DP013-MESSAGE-TEXT(1)       07010025
070200             MOVE DP020-NEXT-APPL-ACTIVITY                        07020025
070300                                   TO DP013-MESSAGE-TEXT(2)       07030025
070400             PERFORM DP013-0000-PROCESS-ABEND                     07040025
070500     END-EVALUATE.                                                07050025
070600                                                                  07060025
070700/                                                                 07070025
070800*----------------------------------------------------------------*07080025
070900*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE    *07090025
071000*  INTER-APPLICATION FORMAT CODE.                                *07100025
071100*----------------------------------------------------------------*07110025
071200 1100-FIND-OBJECT-KEYS.                                           07120025
071300                                                                  07130025
071400     INITIALIZE ASC-SPECIFIC-COMMAREA.                            07140025
071500                                                                  07150025
071600     MOVE DP020-INT-APPL-FORMAT-IND                               07160025
071700                                 TO ASC-INT-APPL-FORMAT-IND.      07170025
071800                                                                  07180025
071900                                                                  07190025
072000     EVALUATE DP020-INT-APPL-FORMAT-IND                           07200025
072100                                                                  07210025
072200         WHEN PC-INTER-APPL-LIST-ADD                              07220025
072300*  ADD A PO                                                       07230025
072400             MOVE RC015-OPER-UNT-ID      TO ASC-KEY-OPER-UNT-ID-N 07240025
072500             MOVE RC015-FCLTY-ID         TO ASC-KEY-FCLTY-ID-N    07250025
072600             MOVE RC015-SHIPT-ID         TO ASC-KEY-SHIPT-ID      07260025
072700                                            DK-SHIPT-ID           07270025
072800             PERFORM 1130-SELECT-TSHIPMT                          07280025
072900                                                                  07290025
073000             IF PS-SHIPMT-FOUND                                   07300025
073100                 MOVE RC015-TRIP-ID      TO ASC-KEY-TRIP-ID       07310025
073200                                            DK-TRIP-ID            07320025
073300                 PERFORM 1150-CHECK-SPLT-XMIT-IND                 07330025
073400                 IF PS-NO-ERROR                                   07340025
073500                     SET ASC-ADD-PENDING TO TRUE                  07350025
073600                     SET ASC-USE-SELECTION-QUEUE                  07360025
073700                                 TO TRUE                          07370025
073800                     MOVE RC015-NUMBER-OF-SELECTED-ITEMS          07380025
073900                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  07390025
074000                     MOVE RC015-NUMBER-OF-TS-ITEMS                07400025
074100                                 TO ASC-NUMBER-OF-TS-ITEMS        07410025
074200                     MOVE RC015-SEL-QUEUE-NAME                    07420025
074300                                 TO ASC-SEL-QUEUE-NAME            07430025
074400                     PERFORM 1120-PREPARE-LIST-ENTRY              07440025
074500                 END-IF                                           07450025
074600             END-IF                                               07460025
074700                                                                  07470025
074800                                                                  07480025
074900         WHEN PC-INTER-APPL-LIST-UPD                              07490025
075000             MOVE RC015-OPER-UNT-ID      TO ASC-KEY-OPER-UNT-ID-N 07500025
075100             MOVE RC015-FCLTY-ID         TO ASC-KEY-FCLTY-ID-N    07510025
075200             MOVE RC015-SHIPT-ID         TO ASC-KEY-SHIPT-ID      07520025
075300                                            DK-SHIPT-ID           07530025
075400             PERFORM 1130-SELECT-TSHIPMT                          07540025
075500             IF PS-SHIPMT-NOT-FOUND                               07550025
075600                 CONTINUE                                         07560025
075700             ELSE                                                 07570025
075800             IF  RC015-NUMBER-OF-SELECTED-ITEMS = ZERO            07580025
075900                 MOVE PC-TSYMSG-00057                             07590025
076000                                 TO DP020-MSG-NUMBER              07600025
076100                 SET DP020-MSG-WARNING                            07610025
076200                     DP020-NEXT-ACT-APPL-ERROR                    07620025
076300                                 TO TRUE                          07630025
076400             ELSE                                                 07640025
076500                 SET ASC-UPDATE-PENDING                           07650025
076600                                 TO TRUE                          07660025
076700                 SET ASC-USE-SELECTION-QUEUE                      07670025
076800                                 TO TRUE                          07680025
076900                 MOVE RC015-NUMBER-OF-SELECTED-ITEMS              07690025
077000                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  07700025
077100                 MOVE RC015-NUMBER-OF-TS-ITEMS                    07710025
077200                                 TO ASC-NUMBER-OF-TS-ITEMS        07720025
077300                 MOVE RC015-SEL-QUEUE-NAME                        07730025
077400                                 TO ASC-SEL-QUEUE-NAME            07740025
077500                 PERFORM 1120-PREPARE-LIST-ENTRY                  07750025
077600                 IF ASC-REC-SEQ-NBR      NOT = +0                 07760025
077700                     MOVE PC-TSYMSG-00734                         07770025
077800                                   TO DP020-MSG-NUMBER            07780025
077900                     SET PS-ERROR                                 07790025
078000                         DP020-MSG-FATAL                          07800025
078100                         DP020-NEXT-ACT-APPL-ERROR                07810025
078200                                   TO TRUE                        07820025
078300                 END-IF                                           07830025
078400             END-IF                                               07840025
078500             END-IF                                               07850025
078600                                                                  07860025
078700                                                                  07870025
078800         WHEN PC-INTER-APPL-LIST-LIST                             07880025
078900             MOVE RC015-OPER-UNT-ID      TO ASC-KEY-OPER-UNT-ID-N 07890025
079000             MOVE RC015-FCLTY-ID         TO ASC-KEY-FCLTY-ID-N    07900025
079100             MOVE RC015-SHIPT-ID         TO ASC-KEY-SHIPT-ID      07910025
079200                                            DK-SHIPT-ID           07920025
079300             IF  RC015-NUMBER-OF-SELECTED-ITEMS NOT NUMERIC       07930025
079400                 MOVE ZERO      TO RC015-NUMBER-OF-SELECTED-ITEMS 07940025
079500             END-IF                                               07950025
079600             IF  RC015-NUMBER-OF-SELECTED-ITEMS = ZERO            07960025
079700                 MOVE PC-TSYMSG-00057                             07970025
079800                                 TO DP020-MSG-NUMBER              07980025
079900                 SET DP020-MSG-WARNING                            07990025
080000                     DP020-NEXT-ACT-APPL-ERROR                    08000025
080100                     PS-ERROR    TO TRUE                          08010025
080200             ELSE                                                 08020025
080300                 PERFORM 2170-CHECK-RACF-ACCESS                   08030025
080400                 IF DP008-ACCESS-DENIED                           08040025
080500*                    -- NO SECURITY CLEARANCE FOR FUNCTION --     08050025
080600                     MOVE PC-TSYMSG-01061                         08060025
080700                                       TO DP020-MSG-NUMBER        08070025
080800                     SET PS-ERROR                                 08080025
080900                         DP020-MSG-WARNING                        08090025
081000                         DP020-NEXT-ACT-APPL-ERROR                08100025
081100                                 TO TRUE                          08110025
081200                 ELSE                                             08120025
081300                     SET ASC-UPDATE-PENDING                       08130025
081400                                     TO TRUE                      08140025
081500                     SET ASC-USE-SELECTION-QUEUE                  08150025
081600                         ASC-INTER-APPL-LIST-LIST                 08160025
081700                                     TO TRUE                      08170025
081800                     MOVE RC015-NUMBER-OF-SELECTED-ITEMS          08180025
081900                                   TO ASC-NUMBER-OF-SELECTED-ITEMS08190025
082000                     MOVE RC015-NUMBER-OF-TS-ITEMS                08200025
082100                                     TO ASC-NUMBER-OF-TS-ITEMS    08210025
082200                     MOVE RC015-SEL-QUEUE-NAME                    08220025
082300                                     TO ASC-SEL-QUEUE-NAME        08230025
082400                     PERFORM 1120-PREPARE-LIST-ENTRY              08240025
082500                     PERFORM 1130-SELECT-TSHIPMT                  08250025
082600                     IF PS-SHIPMT-NOT-FOUND                       08260025
082700                          CONTINUE                                08270025
082800                     ELSE                                         08280025
082900                     MOVE ASC-REC-SEQ-NBR TO  DK-REC-SEQ-NBR      08290025
083000                     MOVE ASC-KEY-PO-NBR  TO DK-PO-NBR            08300025
083100                     MOVE ASC-KEY-OPER-UNT-ID  TO DK-OPER-UNT-ID  08310025
083200                     MOVE ASC-KEY-FCLTY-ID TO DK-FCLTY-ID         08320025
083300                     IF DK-REC-SEQ-NBR > 0                        08330025
083400                         SET PS-NOT-IN-PROCESS TO TRUE            08340025
083500                         PERFORM 1140-SELECT-RECEIVER             08350025
083600                         IF PS-NOT-IN-PROCESS                     08360025
083700                             MOVE PC-TSYMSG-00463                 08370025
083800                                             TO DP020-MSG-NUMBER  08380025
083900                             SET DP020-MSG-WARNING                08390025
084000                                 DP020-NEXT-ACT-APPL-ERROR        08400025
084100                                             TO TRUE              08410025
084200                         END-IF                                   08420025
084300                     END-IF                                       08430025
084400                     END-IF                                       08440025
084500                 END-IF                                           08450025
084600             END-IF                                               08460025
084700                                                                  08470025
084800         WHEN PC-INTER-APPL-LIST-DEL                              08480025
084900             MOVE RC015-OPER-UNT-ID      TO ASC-KEY-OPER-UNT-ID-N 08490025
085000             MOVE RC015-FCLTY-ID         TO ASC-KEY-FCLTY-ID-N    08500025
085100             MOVE RC015-SHIPT-ID         TO ASC-KEY-SHIPT-ID      08510025
085200                                            DK-SHIPT-ID           08520025
085300             PERFORM 1130-SELECT-TSHIPMT                          08530025
085400             IF PS-SHIPMT-NOT-FOUND                               08540025
085500                 CONTINUE                                         08550025
085600             ELSE                                                 08560025
085700             IF  RC015-NUMBER-OF-SELECTED-ITEMS = ZERO            08570025
085800                 MOVE PC-TSYMSG-00057                             08580025
085900                                 TO DP020-MSG-NUMBER              08590025
086000                 SET DP020-MSG-WARNING                            08600025
086100                     DP020-NEXT-ACT-APPL-ERROR                    08610025
086200                                 TO TRUE                          08620025
086300             ELSE                                                 08630025
086400                 SET ASC-DELETE-PENDING                           08640025
086500                                 TO TRUE                          08650025
086600                 SET ASC-USE-SELECTION-QUEUE                      08660025
086700                                 TO TRUE                          08670025
086800                 MOVE RC015-NUMBER-OF-SELECTED-ITEMS              08680025
086900                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  08690025
087000                 MOVE RC015-NUMBER-OF-TS-ITEMS                    08700025
087100                                 TO ASC-NUMBER-OF-TS-ITEMS        08710025
087200                 MOVE RC015-SEL-QUEUE-NAME                        08720025
087300                                 TO ASC-SEL-QUEUE-NAME            08730025
087400                 PERFORM 1120-PREPARE-LIST-ENTRY                  08740025
087500             END-IF                                               08750025
087600             END-IF                                               08760025
087700                                                                  08770025
087800         WHEN PC-INTER-APPL-ADD-SHIP                              08780025
087900             SET ASC-ADD-PENDING TO TRUE                          08790025
088000             MOVE TR005-OPER-UNT-ID   TO DK-OPER-UNT-ID           08800025
088100                                         ASC-KEY-OPER-UNT-ID-N    08810025
088200             MOVE TR005-FCLTY-ID      TO DK-FCLTY-ID              08820025
088300                                         ASC-KEY-FCLTY-ID-N       08830025
088400             MOVE TR005-TRIP-ID       TO ASC-KEY-TRIP-ID          08840025
088500                                         DK-TRIP-ID               08850025
088600             MOVE TR005-SHIPT-ID      TO ASC-KEY-SHIPT-ID         08860025
088700                                         DK-SHIPT-ID              08870025
088800             PERFORM 1130-SELECT-TSHIPMT                          08880025
088900                                                                  08890025
089000             PERFORM 1150-CHECK-SPLT-XMIT-IND                     08900025
089100                                                                  08910025
089200         WHEN OTHER                                               08920025
089300             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             08930025
089400             SET DP020-MSG-FATAL                                  08940025
089500                 DP020-NEXT-ACT-APPL-ERROR                        08950025
089600                 PS-ERROR        TO TRUE                          08960025
089700     END-EVALUATE.                                                08970025
089800                                                                  08980025
089900/                                                                 08990025
090000*----------------------------------------------------------------*09000025
090100* ENTRY IS FROM A LIST.  GET THE FORMAT NUMBER FROM THE TEMP     *09010025
090200* STORAGE QUEUE PASSED FROM THE LIST.                            *09020025
090300*----------------------------------------------------------------*09030025
090400 1120-PREPARE-LIST-ENTRY.                                         09040025
090500                                                                  09050025
090600     MOVE RC013-MAX-ITEMS          TO ASC-SEL-SUB.                09060025
090700     MOVE ZERO                     TO ASC-SEL-ITEM.               09070025
090800     PERFORM 2110-GET-NEXT-RECORD.                                09080025
090900                                                                  09090025
091000/                                                                 09100025
091100*----------------------------------------------------------------*09110025
091200*    RETREIVE SHIPMENT INFO                                      *09120025
091300*----------------------------------------------------------------*09130025
091400 1130-SELECT-TSHIPMT.                                             09140025
091500                                                                  09150025
091600     PERFORM                                                      09160025
091700         WITH TEST AFTER                                          09170025
091800         VARYING PV-RETRY-COUNTER                                 09180025
091900         FROM 1 BY 1                                              09190025
092000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09200025
092100             OR (SQLCODE = +0 OR +100))                           09210025
092200                                                                  09220025
092300         EXEC SQL                                                 09230025
092400              SELECT PRO_NBR                                      09240025
092500                    ,BOL_NBR                                      09250025
092600                INTO :SHIPMT-PRO-NBR                              09260025
092700                    ,:SHIPMT-BOL-NBR                              09270025
092800                FROM TSHIPMT                                      09280025
092900               WHERE SHIPT_ID = :DK-SHIPT-ID                      09290025
093000         END-EXEC                                                 09300025
093100                                                                  09310025
093200         EVALUATE TRUE                                            09320025
093300             WHEN SQLCODE = +0                                    09330025
093400                  MOVE SHIPMT-PRO-NBR  TO ASC-KEY-PRO-NBR         09340025
093500                  MOVE SHIPMT-BOL-NBR  TO ASC-KEY-BOL-NBR         09350025
093600                  SET PS-SHIPMT-FOUND  TO TRUE                    09360025
093700                                                                  09370025
093800             WHEN SQLCODE = +100                                  09380025
093900                  MOVE PC-TSYMSG-01303                            09390025
094000                                       TO DP020-MSG-NUMBER        09400025
094100                  SET DP020-MSG-INFORMATIONAL                     09410025
094200                      DP020-NEXT-ACT-APPL-ERROR                   09420025
094300                      PS-SHIPMT-NOT-FOUND                         09430025
094400                      PS-ERROR         TO TRUE                    09440025
094500                                                                  09450025
094600             WHEN SQLCODE = -904                                  09460025
094700             WHEN SQLCODE = -913                                  09470025
094800                  CONTINUE                                        09480025
094900                                                                  09490025
095000             WHEN SQLWARN0 NOT = SPACES                           09500025
095100             WHEN SQLCODE < +0                                    09510025
095200             WHEN SQLCODE > +0                                    09520025
095300                  MOVE '1130-SELECT-TSHIPMT     '                 09530025
095400                                  TO DP013-PARAGRAPH              09540025
095500                  MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT  '         09550025
095600                                  TO DP013-MESSAGE-TEXT (1)       09560025
095700                  MOVE SQLCA      TO DP013-SQLCA                  09570025
095800                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     09580025
095900                  SET DP013-DB2-ABEND                             09590025
096000                      DP013-XCTL-DISPLAY-RESTART                  09600025
096100                                  TO TRUE                         09610025
096200                  PERFORM DP013-0000-PROCESS-ABEND                09620025
096300         END-EVALUATE                                             09630025
096400     END-PERFORM.                                                 09640025
096500                                                                  09650025
096600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    09660025
096700         SQLCODE NOT = +0                                         09670025
096800         MOVE '1130-SELECT-TSHIPMT     '                          09680025
096900                                  TO DP013-PARAGRAPH              09690025
097000         MOVE 'MAX RETRIES EXCEEDED FOR SELECT ON TSHIPMT '       09700025
097100                                  TO DP013-MESSAGE-TEXT (1)       09710025
097200         MOVE SQLCA               TO DP013-SQLCA                  09720025
097300         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     09730025
097400         SET DP013-DB2-ABEND                                      09740025
097500             DP013-XCTL-DISPLAY-RESTART                           09750025
097600                                  TO TRUE                         09760025
097700         PERFORM DP013-0000-PROCESS-ABEND                         09770025
097800     END-IF.                                                      09780025
097900                                                                  09790025
098000/                                                                 09800025
098100 1140-SELECT-RECEIVER.                                            09810025
098200                                                                  09820025
098300     PERFORM                                                      09830025
098400         WITH TEST AFTER                                          09840025
098500         VARYING PV-RETRY-COUNTER                                 09850025
098600         FROM 1 BY 1                                              09860025
098700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09870025
098800            OR (SQLCODE = +0)                                     09880025
098900            OR (SQLCODE = +100))                                  09890025
099000                                                                  09900025
099100         EXEC SQL                                                 09910025
099200            SELECT  A.STATUS_CDE,                                 09920025
099300                    A.ACTL_CART_CNT,                              09930025
099400                    A.EXPTED_CART_CNT,                            09940025
099500                    A.OPER_UNT_ID,                                09950025
099600                    A.FCLTY_ID                                    09960025
099700              INTO :RECEIV-STATUS-CDE,                            09970025
099800                   :RECEIV-ACTL-CART-CNT,                         09980025
099900                   :RECEIV-EXPTED-CART-CNT,                       09990025
100000                   :RECEIV-OPER-UNT-ID,                           10000025
100100                   :RECEIV-FCLTY-ID                               10010025
100200              FROM  TRECEIV A                                     10020025
100300             WHERE A.ORD_NBR     = :DK-PO-NBR                     10030025
100400               AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR                10040025
100500               AND A.VER_STATUS_CDE = 'A'                         10050025
100600         END-EXEC                                                 10060025
100700                                                                  10070025
100800         EVALUATE TRUE                                            10080025
100900             WHEN SQLCODE = +0                                    10090025
101000                 CONTINUE                                         10100025
101100                                                                  10110025
101200             WHEN SQLCODE = +100                                  10120025
101300             WHEN SQLCODE = -904                                  10130025
101400             WHEN SQLCODE = -913                                  10140025
101500                 CONTINUE                                         10150025
101600                                                                  10160025
101700             WHEN SQLWARN0 NOT = SPACE                            10170025
101800             WHEN SQLCODE < +0                                    10180025
101900             WHEN SQLCODE > +0                                    10190025
102000                 MOVE '1140-SELECT-TRECEIV'                       10200025
102100                                   TO DP013-PARAGRAPH             10210025
102200                 MOVE 'SELECT ON TRECEIV'                         10220025
102300                                   TO DP013-MESSAGE-TEXT (1)      10230025
102400                 MOVE SQLCA        TO DP013-SQLCA                 10240025
102500                 MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (1)    10250025
102600                 SET DP013-DB2-ABEND                              10260025
102700                                   TO TRUE                        10270025
102800                 SET DP013-XCTL-DISPLAY-RESTART                   10280025
102900                                   TO TRUE                        10290025
103000                 PERFORM DP013-0000-PROCESS-ABEND                 10300025
103100         END-EVALUATE                                             10310025
103200     END-PERFORM.                                                 10320025
103300                                                                  10330025
103400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    10340025
103500         SQLCODE NOT = +0                                         10350025
103600         MOVE '1140-SELECT-TRECEIV'                               10360025
103700                                   TO DP013-PARAGRAPH             10370025
103800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     10380025
103900                                   TO DP013-MESSAGE-TEXT (1)      10390025
104000         MOVE 'RECEIVER INFO'                                     10400025
104100                                   TO DP013-MESSAGE-TEXT (2)      10410025
104200         MOVE SQLCA                TO DP013-SQLCA                 10420025
104300         MOVE 'TRECEIV'            TO DP013-DB2-TABLE-NAME (1)    10430025
104400         SET DP013-DB2-ABEND       TO TRUE                        10440025
104500         SET DP013-XCTL-DISPLAY-RESTART                           10450025
104600                                   TO TRUE                        10460025
104700         PERFORM DP013-0000-PROCESS-ABEND                         10470025
104800     END-IF.                                                      10480025
104900                                                                  10490025
105000     IF RECEIV-STATUS-CDE = PC-VE                                 10500025
105100        CONTINUE                                                  10510025
105200     ELSE                                                         10520025
105300         SET PS-IN-PROCESS TO TRUE                                10530025
105400     END-IF.                                                      10540025
105500/                                                                 10550025
105600 1150-CHECK-SPLT-XMIT-IND.                                        10560025
105700     EXEC SQL                                                     10570025
105800         SELECT A.SPLT_XMIT_IND                                   10580025
105900         INTO :VHTRIP-SPLT-XMIT-IND                               10590025
106000         FROM   TVHTRIP A                                         10600025
106100          WHERE                                                   10610025
106200                 A.TRIP_ID                 = :DK-TRIP-ID          10620025
106300     END-EXEC                                                     10630025
106400                                                                  10640025
106500         EVALUATE TRUE                                            10650025
106600             WHEN SQLCODE = ZERO                                  10660025
106700                 IF VHTRIP-SPLT-XMIT-IND = SPACE                  10670025
106800                     CONTINUE                                     10680025
106900                 ELSE                                             10690025
107000                     MOVE PC-TSYMSG-01317 TO DP020-MSG-NUMBER     10700025
107100                     SET DP020-MSG-FATAL                          10710025
107200                         DP020-NEXT-ACT-APPL-ERROR                10720025
107300                         PS-ERROR        TO TRUE                  10730025
107400                 END-IF                                           10740025
107500             WHEN SQLCODE = +100                                  10750025
107600                 MOVE PC-TSYMSG-00743 TO DP020-MSG-NUMBER         10760025
107700                 SET DP020-MSG-FATAL                              10770025
107800                     DP020-NEXT-ACT-APPL-ERROR                    10780025
107900                     PS-ERROR        TO TRUE                      10790025
108000             WHEN SQLCODE = -904                                  10800025
108100             WHEN SQLCODE = -913                                  10810025
108200                 CONTINUE                                         10820025
108300                                                                  10830025
108400             WHEN SQLWARN0 NOT = SPACES                           10840025
108500             WHEN SQLCODE < +0                                    10850025
108600             WHEN SQLCODE > +0                                    10860025
108700                 MOVE '1150-CHECK-SPLT-XMIT-IND'                  10870025
108800                                   TO DP013-PARAGRAPH             10880025
108900                 MOVE 'CHECK IF TRIP ALREADY TRANSMITTED'         10890025
109000                                   TO DP013-MESSAGE-TEXT(1)       10900025
109100                 MOVE SQLCA        TO DP013-SQLCA                 10910025
109200                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    10920025
109300                 SET DP013-DB2-ABEND                              10930025
109400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10940025
109500                 PERFORM DP013-0000-PROCESS-ABEND                 10950025
109600     END-EVALUATE.                                                10960025
109700/                                                                 10970025
109800*----------------------------------------------------------------*10980025
109900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10990025
110000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *11000025
110100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *11010025
110200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *11020025
110300* FUNCTION KEYS CAN GET THIS FAR.                                *11030025
110400*----------------------------------------------------------------*11040025
110500                                                                  11050025
110600 2000-PROCESS-PANEL.                                              11060025
110700                                                                  11070025
110800     EVALUATE TRUE                                                11080025
110900                                                                  11090025
111000         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    11100025
111100             IF ASC-ADD-PENDING                                   11110025
111200                 PERFORM 2100-CHECK-FUNCTION-KEY                  11120025
111300             ELSE                                                 11130025
111400                 IF ASC-DELETE-SUCCESSFUL                         11140025
111500                     MOVE PC-TSYMSG-00116                         11150025
111600                                   TO DP020-MSG-NUMBER            11160025
111700                     SET DP020-MSG-FATAL                          11170025
111800                         PS-ERROR      TO TRUE                    11180025
111900                     PERFORM 3200-RESET-ATTRIBUTES                11190025
112000                 ELSE                                             11200025
112100                     SET DP030-CONTINUE-GO                        11210025
112200                                   TO TRUE                        11220025
112300                     PERFORM 7000-DELETE-SHIPMENT                 11230025
112400                 END-IF                                           11240025
112500             END-IF                                               11250025
112600                                                                  11260025
112700         WHEN DP020-SRC-AID = DP016-CLEAR                         11270025
112800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11280025
112900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11290025
113000                                                                  11300025
113100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    11310025
113200             SET DP030-DONT-ERASE                                 11320025
113300                 DP030-SEND-DATAONLY (PC-APPL-MAP)                11330025
113400                               TO TRUE                            11340025
113500             PERFORM 4000-BUILD-INITIAL-PANEL                     11350025
113600             PERFORM 3200-RESET-ATTRIBUTES                        11360025
113700             PERFORM 3500-SAVE-SCREEN-FIELDS                      11370025
113800                                                                  11380025
113900         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             11390025
114000             IF  ASC-USE-SELECTION-QUEUE                          11400025
114100                 PERFORM 2110-GET-NEXT-RECORD                     11410025
114200                 PERFORM 4000-BUILD-INITIAL-PANEL                 11420025
114300                 PERFORM 3200-RESET-ATTRIBUTES                    11430025
114400                 PERFORM 3500-SAVE-SCREEN-FIELDS                  11440025
114500             ELSE                                                 11450025
114600*                --- BOTTOM OF LIST ---                           11460025
114700                 MOVE PC-TSYMSG-00070                             11470025
114800                                   TO DP020-MSG-NUMBER            11480025
114900                 SET DP020-MSG-INFORMATIONAL                      11490025
115000                                   TO TRUE                        11500025
115100             END-IF                                               11510025
115200                                                                  11520025
115300         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             11530025
115400             IF  ASC-USE-SELECTION-QUEUE                          11540025
115500                 PERFORM 2120-GET-PREV-RECORD                     11550025
115600                 PERFORM 4000-BUILD-INITIAL-PANEL                 11560025
115700                 PERFORM 3200-RESET-ATTRIBUTES                    11570025
115800                 PERFORM 3500-SAVE-SCREEN-FIELDS                  11580025
115900             ELSE                                                 11590025
116000*                --- TOP OF LIST ---                              11600025
116100                 MOVE PC-TSYMSG-00069                             11610025
116200                                   TO DP020-MSG-NUMBER            11620025
116300                 SET DP020-MSG-INFORMATIONAL                      11630025
116400                                   TO TRUE                        11640025
116500             END-IF                                               11650025
116600                                                                  11660025
116700         WHEN OTHER                                               11670025
116800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 11680025
116900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11690025
117000             IF  PS-NO-ERROR                                      11700025
117100                 SET DP030-CONTINUE-GO                            11710025
117200                                   TO TRUE                        11720025
117300                 PERFORM 2100-CHECK-FUNCTION-KEY                  11730025
117400             ELSE                                                 11740025
117500                 SET DP030-OVERRIDE-GO                            11750025
117600                                   TO TRUE                        11760025
117700             END-IF                                               11770025
117800     END-EVALUATE.                                                11780025
117900                                                                  11790025
118000/                                                                 11800025
118100*----------------------------------------------------------------*11810025
118200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*11820025
118300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *11830025
118400* CICS ARCHITECTURE API.                                         *11840025
118500*----------------------------------------------------------------*11850025
118600 2100-CHECK-FUNCTION-KEY.                                         11860025
118700                                                                  11870025
118800     EVALUATE TRUE                                                11880025
118900         WHEN DP020-SRC-AID = DP016-ENTER                         11890025
119000             CONTINUE                                             11900025
119100                                                                  11910025
119200                                                                  11920025
119300         WHEN DP020-FK-CONFIRM (DP020-SRC-AID) AND                11930025
119400              ASC-LOCAL-01-NEED-CONFIRM        AND                11940025
119500              ASC-ADD-PENDING                                     11950025
119600             SET DP030-CONTINUE-GO TO TRUE                        11960025
119700             PERFORM 5000-ADD-SHIPMENT                            11970025
119800             SET ASC-LOCAL-01-NO-NEED-CONFIRM TO TRUE             11980025
119900                                                                  11990025
120000         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    12000025
120100             IF ASC-ADD-PENDING                                   12010025
120200                 PERFORM 2200-MOVE-SCREEN-TO-COMMAREA             12020025
120300                 MOVE ASC-PO-NBR-N TO DK-PO-NBR                   12030025
120400                 PERFORM 5005-DETERMINE-PO-TYP-CDE                12040025
120500                 IF PV-PO-TYP-CDE = PC-IMPORT                     12050025
120600                     PERFORM 5010-CHECK-FOR-CMN-SPLITS            12060025
120700                     IF PS-CMN-SPLITS-MSG-NO                      12070025
120800                         SET DP030-CONTINUE-GO TO TRUE            12080025
120900                         PERFORM 5000-ADD-SHIPMENT                12090025
121000                     ELSE                                         12100025
121100                         SET ASC-LOCAL-01-NEED-CONFIRM TO TRUE    12110025
121200                     END-IF                                       12120025
121300                 ELSE                                             12130025
121400                     SET DP030-CONTINUE-GO TO TRUE                12140025
121500                     PERFORM 5000-ADD-SHIPMENT                    12150025
121600                 END-IF                                           12160025
121700             END-IF                                               12170025
121800                                                                  12180025
121900         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID) AND          12190025
122000              DP020-SRC-AID = DP016-PF13                          12200025
122100             MOVE ASC-PO-NBR-N TO DK-PO-NBR                       12210025
122200             PERFORM 5005-DETERMINE-PO-TYP-CDE                    12220025
122300             IF PV-PO-TYP-CDE = PC-IMPORT                         12230025
122400                 PERFORM 5010-CHECK-FOR-CMN-SPLITS                12240025
122500                 IF PS-CMN-SPLITS-MSG-NO                          12250025
122600                     SET DP030-CONTINUE-GO TO TRUE                12260025
122700                     PERFORM 5000-ADD-SHIPMENT                    12270025
122800                 ELSE                                             12280025
122900                     SET ASC-LOCAL-01-NEED-CONFIRM TO TRUE        12290025
123000                 END-IF                                           12300025
123100             ELSE                                                 12310025
123200                 SET DP030-CONTINUE-GO TO TRUE                    12320025
123300                 PERFORM 5000-ADD-SHIPMENT                        12330025
123400             END-IF                                               12340025
123500                                                                  12350025
123600         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              12360025
123700             PERFORM 3600-CHECK-IF-FIELDS-CHANGED                 12370025
123800             IF  ASC-FIELDS-CHANGED                               12380025
123900                 SET DP030-CONTINUE-GO                            12390025
124000                                   TO TRUE                        12400025
124100                 PERFORM 6000-UPDATE-SHIPMENT                     12410025
124200             ELSE                                                 12420025
124300                 MOVE PC-TSYMSG-00046                             12430025
124400                                   TO DP020-MSG-NUMBER            12440025
124500                 SET DP020-MSG-INFORMATIONAL                      12450025
124600                                   TO TRUE                        12460025
124700             END-IF                                               12470025
124800                                                                  12480025
124900         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              12490025
125000             SET ASC-LOCAL-03-PROCESSED TO TRUE                   12500025
125100             INITIALIZE PO011-INTER-APPL-COMMAREA                 12510025
125200             SET DP030-CONTINUE-GO TO TRUE                        12520025
125300             MOVE ASC-PO-NBR TO PO011-PO-NBR                      12530025
125400             MOVE ASC-DEPT-NBR TO PO011-DEPT-NBR                  12540025
125500             MOVE ASC-VEND-NAME TO PO011-VENDOR-NAME              12550025
125600                                                                  12560025
125700         WHEN OTHER                                               12570025
125800             SET DP013-NO-ROLLBACK                                12580025
125900                 DP013-XCTL-DISPLAY-RESTART                       12590025
126000                 DP013-CICS-ABEND  TO TRUE                        12600025
126100             MOVE '2100-CHECK-FUNCTION-KEY'                       12610025
126200                                   TO DP013-PARAGRAPH             12620025
126300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      12630025
126400                                   TO DP013-MESSAGE-TEXT (1)      12640025
126500             PERFORM DP013-0000-PROCESS-ABEND                     12650025
126600     END-EVALUATE.                                                12660025
126700                                                                  12670025
126800/                                                                 12680025
126900 2110-GET-NEXT-RECORD.                                            12690025
127000                                                                  12700025
127100     ADD +1                        TO ASC-SEL-SUB.                12710025
127200     IF  ASC-SEL-SUB > RC013-MAX-ITEMS                            12720025
127300         ADD +1                    TO ASC-SEL-ITEM                12730025
127400         MOVE +1                   TO ASC-SEL-SUB                 12740025
127500     END-IF.                                                      12750025
127600                                                                  12760025
127700     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                12770025
127800         IF  ASC-DELETE-PENDING                                   12780025
127900             MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER            12790025
128000             SET DP020-MSG-INFORMATIONAL                          12800025
128100                                   TO TRUE                        12810025
128200             IF  ASC-DELETE-SUCCESSFUL                            12820025
128300                 MOVE SPACES       TO ASC-DELETE-SUCCESSFUL-SW    12830025
128400             END-IF                                               12840025
128500         END-IF                                                   12850025
128600         PERFORM 9100-READ-SEL-QUEUE                              12860025
128700         IF  RC013-ITEM (ASC-SEL-SUB) > ZERO                      12870025
128800             MOVE RC013-PO-NBR (ASC-SEL-SUB)                      12880025
128900                                   TO ASC-KEY-PO-NBR              12890025
129000                                      DK-PO-NBR                   12900025
129100             MOVE RC013-REC-SEQ-NBR (ASC-SEL-SUB)                 12910025
129200                                   TO ASC-REC-SEQ-NBR             12920025
129300                                      DK-REC-SEQ-NBR              12930025
129400             IF DP020-INT-APPL-FORMAT-IND =                       12940025
129500                             PC-INTER-APPL-LIST-LIST              12950025
129600                 MOVE RC013-SHIPT-ID (ASC-SEL-SUB)                12960025
129700                                   TO ASC-KEY-SHIPT-ID            12970025
129800                                      DK-SHIPT-ID                 12980025
129900             END-IF                                               12990025
130000             SET RC013-INQ (ASC-SEL-SUB)                          13000025
130100                                   TO TRUE                        13010025
130200             PERFORM 9200-REWRITE-LIST-QUEUE                      13020025
130300         ELSE                                                     13030025
130400             SUBTRACT +1 FROM ASC-SEL-SUB                         13040025
130500*            --- BOTTOM OF LIST ---                               13050025
130600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            13060025
130700             SET DP020-MSG-INFORMATIONAL                          13070025
130800                                   TO TRUE                        13080025
130900         END-IF                                                   13090025
131000     ELSE                                                         13100025
131100         SUBTRACT +1 FROM ASC-SEL-ITEM                            13110025
131200         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 13120025
131300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            13130025
131400         SET DP020-MSG-INFORMATIONAL                              13140025
131500                                   TO TRUE                        13150025
131600     END-IF.                                                      13160025
131700                                                                  13170025
131800/                                                                 13180025
131900 2120-GET-PREV-RECORD.                                            13190025
132000                                                                  13200025
132100     SUBTRACT +1 FROM ASC-SEL-SUB.                                13210025
132200     IF  ASC-SEL-SUB < +1                                         13220025
132300         SUBTRACT +1 FROM ASC-SEL-ITEM                            13230025
132400         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 13240025
132500     END-IF.                                                      13250025
132600                                                                  13260025
132700     IF  ASC-SEL-ITEM > ZERO                                      13270025
132800         IF  ASC-DELETE-PENDING                                   13280025
132900             MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER            13290025
133000             SET DP020-MSG-INFORMATIONAL                          13300025
133100                                   TO TRUE                        13310025
133200             IF  ASC-DELETE-SUCCESSFUL                            13320025
133300                 MOVE SPACES       TO ASC-DELETE-SUCCESSFUL-SW    13330025
133400             END-IF                                               13340025
133500         END-IF                                                   13350025
133600         PERFORM 9100-READ-SEL-QUEUE                              13360025
133700         MOVE RC013-PO-NBR (ASC-SEL-SUB)                          13370025
133800                                   TO ASC-KEY-PO-NBR              13380025
133900         MOVE RC013-REC-SEQ-NBR (ASC-SEL-SUB)                     13390025
134000                                   TO ASC-REC-SEQ-NBR             13400025
134100                                      DK-REC-SEQ-NBR              13410025
134200         IF DP020-INT-APPL-FORMAT-IND =                           13420025
134300                             PC-INTER-APPL-LIST-LIST              13430025
134400             MOVE RC013-SHIPT-ID (ASC-SEL-SUB)                    13440025
134500                                   TO ASC-KEY-SHIPT-ID            13450025
134600                                      DK-SHIPT-ID                 13460025
134700         END-IF                                                   13470025
134800         SET RC013-INQ (ASC-SEL-SUB)                              13480025
134900                                   TO TRUE                        13490025
135000         PERFORM 9200-REWRITE-LIST-QUEUE                          13500025
135100     ELSE                                                         13510025
135200         MOVE +1                   TO ASC-SEL-ITEM                13520025
135300                                      ASC-SEL-SUB                 13530025
135400*        --- TOP OF LIST ---                                      13540025
135500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            13550025
135600         SET DP020-MSG-INFORMATIONAL                              13560025
135700                                   TO TRUE                        13570025
135800     END-IF.                                                      13580025
135900                                                                  13590025
136000/                                                                 13600025
136100                                                                  13610025
136200 2170-CHECK-RACF-ACCESS.                                          13620025
136300     SET DP008-RSRC-TYPE-FUNC     TO TRUE                         13630025
136400     MOVE 'RCVRMNT '              TO DP008-FUNCTION-NAME          13640025
136500     SET DP008-ACCESS-TYPE-USE    TO TRUE                         13650025
136600                                                                  13660025
136700     EXEC CICS                                                    13670025
136800        LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                  13680025
136900             COMMAREA (DP008-SECURITY-COMMAREA)                   13690025
137000             LENGTH (DP008-SECURITY-COMMAREA-LENGTH)              13700025
137100     END-EXEC                                                     13710025
137200                                                                  13720025
137300     IF DP008-CALL-SUCCESSFUL                                     13730025
137400         CONTINUE                                                 13740025
137500     ELSE                                                         13750025
137600        MOVE '2170-CHECK-RACF-ACCESS'                             13760025
137700                              TO DP013-PARAGRAPH                  13770025
137800         MOVE 'UNABLE TO ACCESS CICS'                             13780025
137900                              TO DP013-MESSAGE-TEXT (1)           13790025
138000         MOVE SQLCA           TO DP013-SQLCA                      13800025
138100         SET DP013-DB2-ABEND                                      13810025
138200             DP013-XCTL-DISPLAY-RESTART                           13820025
138300                              TO TRUE                             13830025
138400         PERFORM DP013-0000-PROCESS-ABEND                         13840025
138500     END-IF.                                                      13850025
138600 EJECT                                                            13860025
138700/                                                                 13870025
138800*----------------------------------------------------------------*13880025
138900*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *13890025
139000*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *13900025
139100*----------------------------------------------------------------*13910025
139200 2200-MOVE-SCREEN-TO-COMMAREA.                                    13920025
139300                                                                  13930025
139400     IF  APONBRL > ZERO                                           13940025
139500         MOVE APONBRI              TO ASC-PO-NBR                  13950025
139600     ELSE                                                         13960025
139700        IF  APONBRF = DP015-ERASE-EOF                             13970025
139800            MOVE SPACES            TO ASC-PO-NBR                  13980025
139900        END-IF                                                    13990025
140000     END-IF.                                                      14000025
140100                                                                  14010025
140200     IF  AVNNMEL > ZERO                                           14020025
140300         MOVE AVNNMEI              TO ASC-VEND-NAME               14030025
140400     ELSE                                                         14040025
140500        IF  AVNNMEF = DP015-ERASE-EOF                             14050025
140600            MOVE SPACES            TO ASC-VEND-NAME               14060025
140700        END-IF                                                    14070025
140800     END-IF.                                                      14080025
140900                                                                  14090025
141000     IF  APKSLL > ZERO                                            14100025
141100         MOVE APKSLI               TO ASC-PKSL-IND                14110025
141200     ELSE                                                         14120025
141300         IF  APKSLF = DP015-ERASE-EOF                             14130025
141400             MOVE SPACES           TO ASC-PKSL-IND                14140025
141500         END-IF                                                   14150025
141600     END-IF.                                                      14160025
141700                                                                  14170025
141800     IF  AEXPCNTL > ZERO                                          14180025
141900         MOVE AEXPCNTI             TO ASC-EXPTED-CART-CNT         14190025
142000     ELSE                                                         14200025
142100         IF  AEXPCNTF = DP015-ERASE-EOF                           14210025
142200             MOVE SPACES           TO ASC-EXPTED-CART-CNT         14220025
142300         END-IF                                                   14230025
142400     END-IF.                                                      14240025
142500                                                                  14250025
142600     IF  AACTCNTL > ZERO                                          14260025
142700         MOVE AACTCNTI             TO ASC-ACTL-CART-CNT           14270025
142800     ELSE                                                         14280025
142900         IF  AACTCNTF = DP015-ERASE-EOF                           14290025
143000             MOVE SPACES           TO ASC-ACTL-CART-CNT           14300025
143100         END-IF                                                   14310025
143200     END-IF.                                                      14320025
143300                                                                  14330025
143400     IF  ADMGCNTL > ZERO                                          14340025
143500         MOVE ADMGCNTI             TO ASC-DMG-CART-CNT            14350025
143600     ELSE                                                         14360025
143700         IF  ADMGCNTF = DP015-ERASE-EOF                           14370025
143800             MOVE SPACES           TO ASC-DMG-CART-CNT            14380025
143900         END-IF                                                   14390025
144000     END-IF.                                                      14400025
144100                                                                  14410025
144200/                                                                 14420025
144300*----------------------------------------------------------------*14430025
144400*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *14440025
144500*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *14450025
144600*----------------------------------------------------------------*14460025
144700 3000-EDIT-DATA-IN-COMMAREA.                                      14470025
144800                                                                  14480025
144900     PERFORM 3200-RESET-ATTRIBUTES.                               14490025
145000                                                                  14500025
145100     IF  ASC-DMG-CART-CNT > SPACES                                14510025
145200         MOVE ASC-DMG-CART-CNT      TO DP010I-UNEDITED-FIELD      14520025
145300         MOVE LENGTH OF ASC-DMG-CART-CNT                          14530025
145400                                    TO DP010I-MAXIMUM-DIGITS      14540025
145500         MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS    14550025
145600         SET  DP010I-NEGATIVE-NOT-ALLOWED                         14560025
145700                                    TO TRUE                       14570025
145800         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14580025
145900              USING DP010I-NUMERIC-EDIT-AREA                      14590025
146000         IF  DP010I-ERROR-DETECTED                                14600025
146100             SET PS-ERROR                                         14610025
146200                 DP020-MSG-FATAL    TO TRUE                       14620025
146300             MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER           14630025
146400             MOVE DP015-UNP-ALP-BRT-OFF                           14640025
146500                                    TO ADMGCNTA                   14650025
146600             MOVE DP015-RED         TO ADMGCNTC                   14660025
146700             MOVE DP015-REVERSE     TO ADMGCNTH                   14670025
146800             MOVE -1                TO ADMGCNTL                   14680025
146900             SET DP030-SET-CURSOR-APPL-1                          14690025
147000                                    TO TRUE                       14700025
147100        ELSE                                                      14710025
147200             MOVE DP010I-NUMERIC-FIELD                            14720025
147300                                    TO ASC-DMG-CART-CNT-N         14730025
147400             MOVE ASC-DMG-CART-CNT  TO ADMGCNTO                   14740025
147500         END-IF                                                   14750025
147600     END-IF.                                                      14760025
147700                                                                  14770025
147800     IF  ASC-ACTL-CART-CNT > SPACES                               14780025
147900         MOVE ASC-ACTL-CART-CNT     TO DP010I-UNEDITED-FIELD      14790025
148000         MOVE LENGTH OF ASC-ACTL-CART-CNT                         14800025
148100                                    TO DP010I-MAXIMUM-DIGITS      14810025
148200         MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS    14820025
148300         SET  DP010I-NEGATIVE-NOT-ALLOWED                         14830025
148400                                    TO TRUE                       14840025
148500         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14850025
148600              USING DP010I-NUMERIC-EDIT-AREA                      14860025
148700         IF  DP010I-ERROR-DETECTED                                14870025
148800             SET PS-ERROR                                         14880025
148900                 DP020-MSG-FATAL    TO TRUE                       14890025
149000             MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER           14900025
149100             MOVE DP015-UNP-ALP-BRT-OFF                           14910025
149200                                    TO AACTCNTA                   14920025
149300             MOVE DP015-RED         TO AACTCNTC                   14930025
149400             MOVE DP015-REVERSE     TO AACTCNTH                   14940025
149500             MOVE -1                TO AACTCNTL                   14950025
149600             SET DP030-SET-CURSOR-APPL-1                          14960025
149700                                    TO TRUE                       14970025
149800        ELSE                                                      14980025
149900             MOVE DP010I-NUMERIC-FIELD                            14990025
150000                                    TO ASC-ACTL-CART-CNT-N        15000025
150100             MOVE ASC-ACTL-CART-CNT TO AACTCNTO                   15010025
150200         END-IF                                                   15020025
150300     END-IF.                                                      15030025
150400                                                                  15040025
150500     IF  ASC-EXPTED-CART-CNT > SPACES                             15050025
150600         MOVE ASC-EXPTED-CART-CNT   TO DP010I-UNEDITED-FIELD      15060025
150700         MOVE LENGTH OF ASC-EXPTED-CART-CNT                       15070025
150800                                    TO DP010I-MAXIMUM-DIGITS      15080025
150900         MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS    15090025
151000         SET  DP010I-NEGATIVE-NOT-ALLOWED                         15100025
151100                                    TO TRUE                       15110025
151200         CALL DP010I-NUMERIC-EDIT-ROUTINE                         15120025
151300              USING DP010I-NUMERIC-EDIT-AREA                      15130025
151400         IF  DP010I-ERROR-DETECTED                                15140025
151500             SET PS-ERROR                                         15150025
151600                 DP020-MSG-FATAL    TO TRUE                       15160025
151700             MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER           15170025
151800             MOVE DP015-UNP-ALP-BRT-OFF                           15180025
151900                                    TO AEXPCNTA                   15190025
152000             MOVE DP015-RED         TO AEXPCNTC                   15200025
152100             MOVE DP015-REVERSE     TO AEXPCNTH                   15210025
152200             MOVE -1                TO AEXPCNTL                   15220025
152300             SET DP030-SET-CURSOR-APPL-1                          15230025
152400                                    TO TRUE                       15240025
152500         ELSE                                                     15250025
152600             MOVE DP010I-NUMERIC-FIELD                            15260025
152700                                    TO ASC-EXPTED-CART-CNT-N      15270025
152800             MOVE ASC-EXPTED-CART-CNT                             15280025
152900                                    TO AEXPCNTO                   15290025
153000         END-IF                                                   15300025
153100     END-IF.                                                      15310025
153200                                                                  15320025
153300     IF  ASC-PKSL-IND = (' ' OR 'Y' OR 'N')                       15330025
153400         CONTINUE                                                 15340025
153500     ELSE                                                         15350025
153600         SET PS-ERROR                                             15360025
153700             DP020-MSG-FATAL        TO TRUE                       15370025
153800         MOVE PC-TSYMSG-00005       TO DP020-MSG-NUMBER           15380025
153900         MOVE DP015-UNP-ALP-BRT-OFF TO APKSLA                     15390025
154000         MOVE DP015-RED             TO APKSLC                     15400025
154100         MOVE DP015-REVERSE         TO APKSLH                     15410025
154200         MOVE -1                    TO APKSLL                     15420025
154300         SET DP030-SET-CURSOR-APPL-1                              15430025
154400                                    TO TRUE                       15440025
154500     END-IF.                                                      15450025
154600                                                                  15460025
154700     IF  PS-NO-ERROR                                              15470025
154800     AND ASC-ADD-PENDING                                          15480025
154900     AND ASC-PO-NBR NOT = (SPACES OR ZEROES)                      15490025
155000         MOVE ASC-PO-NBR            TO DP010I-UNEDITED-FIELD      15500025
155100         MOVE LENGTH OF ASC-PO-NBR  TO DP010I-MAXIMUM-DIGITS      15510025
155200         MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS    15520025
155300         SET  DP010I-NEGATIVE-NOT-ALLOWED                         15530025
155400                                    TO TRUE                       15540025
155500         CALL DP010I-NUMERIC-EDIT-ROUTINE                         15550025
155600              USING DP010I-NUMERIC-EDIT-AREA                      15560025
155700         IF  DP010I-ERROR-DETECTED                                15570025
155800             SET PS-ERROR                                         15580025
155900                 DP020-MSG-FATAL    TO TRUE                       15590025
156000             MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER           15600025
156100             MOVE DP015-UNP-ALP-BRT-OFF                           15610025
156200                                    TO APONBRA                    15620025
156300             MOVE DP015-RED         TO APONBRC                    15630025
156400             MOVE DP015-REVERSE     TO APONBRH                    15640025
156500             MOVE -1                TO APONBRL                    15650025
156600             SET DP030-SET-CURSOR-APPL-1                          15660025
156700                                    TO TRUE                       15670025
156800         ELSE                                                     15680025
156900             MOVE DP010I-NUMERIC-FIELD                            15690025
157000                                    TO ASC-PO-NBR-N               15700025
157100                                       DK-PO-NBR                  15710025
157200             MOVE ASC-PO-NBR        TO APONBRO                    15720025
157300             PERFORM 3040-CHECK-TPURCHS-EXIST                     15730025
157400             IF SQLCODE = +100                                    15740025
157500                SET PS-ERROR                                      15750025
157600                    DP020-MSG-FATAL        TO TRUE                15760025
157700                MOVE PC-TSYMSG-00083       TO DP020-MSG-NUMBER    15770025
157800                MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA             15780025
157900                MOVE DP015-RED             TO APONBRC             15790025
158000                MOVE DP015-REVERSE         TO APONBRH             15800025
158100                MOVE -1                    TO APONBRL             15810025
158200                SET DP030-SET-CURSOR-APPL-1 TO TRUE               15820025
158300             END-IF                                               15830025
158400         END-IF                                                   15840025
158500     END-IF.                                                      15850025
158600                                                                  15860025
158700     IF  PS-NO-ERROR                                              15870025
158800     AND ASC-ADD-PENDING                                          15880025
158900         IF  ASC-PO-NBR = (SPACES OR ZEROES)                      15890025
159000             SET PS-ERROR                                         15900025
159100                 DP020-MSG-FATAL        TO TRUE                   15910025
159200             MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER       15920025
159300             MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA                15930025
159400             MOVE DP015-RED             TO APONBRC                15940025
159500             MOVE DP015-REVERSE         TO APONBRH                15950025
159600             MOVE -1                    TO APONBRL                15960025
159700             SET DP030-SET-CURSOR-APPL-1                          15970025
159800                                        TO TRUE                   15980025
159900         ELSE                                                     15990025
160000             MOVE ASC-PO-NBR            TO DP010I-UNEDITED-FIELD  16000025
160100             MOVE LENGTH OF ASC-PO-NBR  TO DP010I-MAXIMUM-DIGITS  16010025
160200             MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS16020025
160300             SET  DP010I-NEGATIVE-NOT-ALLOWED                     16030025
160400                                        TO TRUE                   16040025
160500             CALL DP010I-NUMERIC-EDIT-ROUTINE                     16050025
160600                  USING DP010I-NUMERIC-EDIT-AREA                  16060025
160700             IF  DP010I-ERROR-DETECTED                            16070025
160800                 SET PS-ERROR                                     16080025
160900                     DP020-MSG-FATAL    TO TRUE                   16090025
161000                 MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER       16100025
161100                 MOVE DP015-UNP-ALP-BRT-OFF                       16110025
161200                                        TO APONBRA                16120025
161300                 MOVE DP015-RED         TO APONBRC                16130025
161400                 MOVE DP015-REVERSE     TO APONBRH                16140025
161500                 MOVE -1                TO APONBRL                16150025
161600                 SET DP030-SET-CURSOR-APPL-1                      16160025
161700                                        TO TRUE                   16170025
161800             ELSE                                                 16180025
161900                 MOVE DP010I-NUMERIC-FIELD                        16190025
162000                                        TO ASC-PO-NBR-N           16200025
162100                                           DK-PO-NBR              16210025
162200                 MOVE ASC-PO-NBR        TO APONBRO                16220025
162300                 MOVE ASC-KEY-SHIPT-ID  TO DK-SHIPT-ID            16230025
162400                                                                  16240025
162500                 INITIALIZE PV-DB2-COUNT                          16250025
162600                 PERFORM 3030-CHECK-DUPL-SHPPO                    16260025
162700                 IF  PV-DB2-COUNT > +0                            16270025
162800                     EVALUATE TRUE                                16280025
162900                         WHEN DP020-FK-LOCAL-FUNC-03              16290025
163000                                       (DP020-SRC-AID)            16300025
163100                             PERFORM 3010-GET-DEPT-NBR            16310025
163200                             IF  SQLCODE = +100                   16320025
163300                             SET DP020-MSG-WARNING TO TRUE        16330025
163400                             MOVE PC-TSYMSG-00083 TO              16340025
163500                                            DP020-MSG-NUMBER      16350025
163600                             END-IF                               16360025
163700                             PERFORM 7020-DEPT-BUYER-NAMES        16370025
163800                             PERFORM 7030-GET-PO-STATUS-DESC      16380025
163900                             PERFORM 7040-SELECT-TPLNSHP          16390025
164000                                                                  16400025
164100                         WHEN OTHER                               16410025
164200                             SET PS-ERROR                         16420025
164300                                 DP020-MSG-FATAL  TO TRUE         16430025
164400                             MOVE PC-TSYMSG-00117 TO              16440025
164500                                              DP020-MSG-NUMBER    16450025
164600                             MOVE DP015-UNP-ALP-BRT-OFF           16460025
164700                                                  TO APONBRA      16470025
164800                             MOVE DP015-RED       TO APONBRC      16480025
164900                             MOVE DP015-REVERSE   TO APONBRH      16490025
165000                             MOVE -1              TO APONBRL      16500025
165100                             SET DP030-SET-CURSOR-APPL-1          16510025
165200                                                  TO TRUE         16520025
165300                     END-EVALUATE                                 16530025
165400                 ELSE                                             16540025
165500                     PERFORM 3010-GET-DEPT-NBR                    16550025
165600                     IF  SQLCODE = +100                           16560025
165700                         SET DP020-MSG-WARNING TO TRUE            16570025
165800                         MOVE PC-TSYMSG-00083 TO DP020-MSG-NUMBER 16580025
165900                     END-IF                                       16590025
166000                                                                  16600025
166100                     PERFORM 7020-DEPT-BUYER-NAMES                16610025
166200                     PERFORM 7030-GET-PO-STATUS-DESC              16620025
166300                     PERFORM 7040-SELECT-TPLNSHP                  16630025
166400                                                                  16640025
166500                 END-IF                                           16650025
166600             END-IF                                               16660025
166700         END-IF                                                   16670025
166800     END-IF.                                                      16680025
166900                                                                  16690025
167000     IF PS-NO-ERROR AND (ASC-PO-NBR NOT = ASC-PO-NBR-OLD)         16700025
167100         PERFORM 3001-GET-NEW-VEND-NAME                           16710025
167200         MOVE ASC-KEY-SHIPT-ID TO DK-SHIPT-ID                     16720025
167300         MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                       16730025
167400         PERFORM 3002-DOES-TSHPTPO-EXIST                          16740025
167500         IF ASC-ADD-PENDING                                       16750025
167600             CONTINUE                                             16760025
167700         ELSE                                                     16770025
167800             IF PS-SHPTPO-NOT-FOUND                               16780025
167900                 INITIALIZE ASC-PKSL-IND                          16790025
168000                        ASC-EXPTED-CART-CNT-N                     16800025
168100                        ASC-ACTL-CART-CNT-N                       16810025
168200                        ASC-DMG-CART-CNT-N                        16820025
168300             END-IF                                               16830025
168400         END-IF                                                   16840025
168500     END-IF.                                                      16850025
168600                                                                  16860025
168700                                                                  16870025
168800     IF  (PS-NO-ERROR                                             16880025
168900     AND ASC-ADD-PENDING                                          16890025
169000     AND ASC-VEND-NAME = SPACES)                                  16900025
169100         MOVE 'N'                       TO ASC-ACTIVE-PO-SW       16910025
169200         PERFORM 3020-CHECK-ACTIVE-PO                             16920025
169300         IF  SQLCODE = +100                                       16930025
169400                 SET PS-ERROR                                     16940025
169500                       DP020-MSG-FATAL  TO TRUE                   16950025
169600                 MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER       16960025
169700                 MOVE DP015-UNP-ALP-BRT-OFF TO AVNNMEA            16970025
169800                 MOVE DP015-RED         TO AVNNMEC                16980025
169900                 MOVE DP015-REVERSE     TO AVNNMEH                16990025
170000                 MOVE -1                TO AVNNMEL                17000025
170100                 SET DP030-SET-CURSOR-APPL-1                      17010025
170200                                        TO TRUE                   17020025
170300         ELSE                                                     17030025
170400             MOVE ENTNME-ENT-NAME-DESC  TO ASC-VEND-NAME          17040025
170500                                           AVNNMEO                17050025
170600             SET ASC-ACTIVE-PO          TO TRUE                   17060025
170700         END-IF                                                   17070025
170800     END-IF.                                                      17080025
170900                                                                  17090025
171000                                                                  17100025
171100     IF  PS-NO-ERROR                                              17110025
171200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17120025
171300         PERFORM 3200-RESET-ATTRIBUTES                            17130025
171400         EVALUATE TRUE                                            17140025
171500             WHEN ASC-ADD-PENDING                                 17150025
171600                 MOVE -1           TO APONBRL                     17160025
171700                 SET DP030-SET-CURSOR-APPL-1                      17170025
171800                                   TO TRUE                        17180025
171900             WHEN ASC-UPDATE-PENDING                              17190025
172000                 MOVE -1           TO AVNNMEL                     17200025
172100                 SET DP030-SET-CURSOR-APPL-1                      17210025
172200                                   TO TRUE                        17220025
172300             WHEN ASC-DELETE-PENDING                              17230025
172400                 SET DP030-SET-CURSOR-TRAILER                     17240025
172500                                   TO TRUE                        17250025
172600         END-EVALUATE                                             17260025
172700     END-IF.                                                      17270025
172800                                                                  17280025
172900/                                                                 17290025
173000*----------------------------------------------------------------*17300025
173100* CHECK TO SEE IF PO NUMBER IS ACTIVE                            *17310025
173200*----------------------------------------------------------------*17320025
173300 3001-GET-NEW-VEND-NAME.                                          17330025
173400                                                                  17340025
173500         EXEC SQL                                                 17350025
173600              SELECT B.ENT_NAME_DESC                              17360025
173700                INTO :ENTNME-ENT-NAME-DESC                        17370025
173800                FROM TPURCHS A                                    17380025
173900                    ,TENTNME B                                    17390025
174000               WHERE A.PO_NBR         = :DK-PO-NBR                17400025
174100                 AND A.VER_STATUS_CDE = 'A'                       17410025
174200                 AND B.TYPE_CDE       = '01'                      17420025
174300                 AND A.ENT_ID     = B.ENT_ID                      17430025
174400         END-EXEC                                                 17440025
174500                                                                  17450025
174600         EVALUATE TRUE                                            17460025
174700             WHEN SQLCODE = +0                                    17470025
174800                 MOVE ENTNME-ENT-NAME-DESC TO ASC-VEND-NAME       17480025
174900             WHEN SQLCODE = +100                                  17490025
175000                 CONTINUE                                         17500025
175100*                MOVE SPACES               TO ASC-VEND-NAME       17510025
175200             WHEN SQLCODE = -904                                  17520025
175300             WHEN SQLCODE = -913                                  17530025
175400             WHEN SQLWARN0 NOT = SPACES                           17540025
175500             WHEN SQLCODE < +0                                    17550025
175600             WHEN SQLCODE > +0                                    17560025
175700                  MOVE '3001-GET-NEW-VEND-NAME'                   17570025
175800                                  TO DP013-PARAGRAPH              17580025
175900                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'      17590025
176000                                  TO DP013-MESSAGE-TEXT (1)       17600025
176100                  MOVE SQLCA      TO DP013-SQLCA                  17610025
176200                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     17620025
176300                  SET DP013-DB2-ABEND                             17630025
176400                      DP013-XCTL-DISPLAY-RESTART                  17640025
176500                                  TO TRUE                         17650025
176600                  PERFORM DP013-0000-PROCESS-ABEND                17660025
176700         END-EVALUATE.                                            17670025
176800/                                                                 17680025
176900 3002-DOES-TSHPTPO-EXIST.                                         17690025
177000                                                                  17700025
177100         EXEC SQL                                                 17710025
177200              SELECT PO_NBR                                       17720025
177300                INTO :SHPTPO-PO-NBR                               17730025
177400                FROM TSHPTPO                                      17740025
177500               WHERE SHIPT_ID = :DK-SHIPT-ID                      17750025
177600                 AND PO_NBR   = :DK-PO-NBR                        17760025
177700         END-EXEC                                                 17770025
177800                                                                  17780025
177900         EVALUATE TRUE                                            17790025
178000             WHEN SQLCODE = ZERO                                  17800025
178100                  SET PS-SHPTPO-FOUND TO TRUE                     17810025
178200             WHEN SQLCODE = +100                                  17820025
178300                  SET PS-SHPTPO-NOT-FOUND TO TRUE                 17830025
178400             WHEN SQLCODE = -904                                  17840025
178500             WHEN SQLCODE = -913                                  17850025
178600                  CONTINUE                                        17860025
178700                                                                  17870025
178800             WHEN SQLWARN0 NOT = SPACES                           17880025
178900             WHEN SQLCODE < +0                                    17890025
179000             WHEN SQLCODE > +0                                    17900025
179100                  MOVE '3002-DOES-TSHPTPO-EXIST'                  17910025
179200                                  TO DP013-PARAGRAPH              17920025
179300                  MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '         17930025
179400                                  TO DP013-MESSAGE-TEXT (1)       17940025
179500                  MOVE SQLCA      TO DP013-SQLCA                  17950025
179600                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     17960025
179700                  SET DP013-DB2-ABEND                             17970025
179800                      DP013-XCTL-DISPLAY-RESTART                  17980025
179900                                  TO TRUE                         17990025
180000                  PERFORM DP013-0000-PROCESS-ABEND                18000025
180100         END-EVALUATE.                                            18010025
180200/                                                                 18020025
180300*----------------------------------------------------------------*18030025
180400*  RETRIEVE THE DEPARTMENT NUMBER                                 18040025
180500*----------------------------------------------------------------*18050025
180600                                                                  18060025
180700 3010-GET-DEPT-NBR.                                               18070025
180800                                                                  18080025
180900     PERFORM                                                      18090025
181000         WITH TEST AFTER                                          18100025
181100         VARYING PV-RETRY-COUNTER                                 18110025
181200         FROM 1 BY 1                                              18120025
181300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18130025
181400             OR (SQLCODE = +0)                                    18140025
181500             OR (SQLCODE = +100))                                 18150025
181600                                                                  18160025
181700         EXEC SQL                                                 18170025
181800              SELECT DEPT_NBR                                     18180025
181900                    , STATUS_CDE                                  18190025
182000                    , B.PO_TYP_DESC                               18200025
182100                    , OTB_PER_NBR                                 18210025
182200                    , B.PO_TYP_CDE                                18220025
182300                INTO :PURCHS-DEPT-NBR                             18230025
182400                    ,:PURCHS-STATUS-CDE                           18240025
182500                    ,:POTYCD-PO-TYP-DESC                          18250025
182600                    ,:PURCHS-OTB-PER-NBR                          18260025
182700                    ,:PURCHS-PO-TYP-CDE                           18270025
182800                FROM TPURCHS A                                    18280025
182900               ,     TPOTYCD B                                    18290025
183000               WHERE PO_NBR         = :DK-PO-NBR                  18300025
183100                 AND VER_STATUS_CDE = 'A'                         18310025
183200                 AND A.PO_TYP_CDE   = B.PO_TYP_CDE                18320025
183300                 AND B.PO_VARIETY_CDE   = 'T'                     18330025
183400         END-EXEC                                                 18340025
183500                                                                  18350025
183600         EVALUATE TRUE                                            18360025
183700             WHEN SQLCODE = +0                                    18370025
183800                  MOVE PURCHS-DEPT-NBR                            18380025
183900                                  TO ASC-DEPT-NBR-N               18390025
184000                  MOVE PURCHS-PO-TYP-CDE                          18400025
184100                                  TO ASC-PO-TYP-CDE               18410025
184200                  MOVE POTYCD-PO-TYP-DESC                         18420025
184300                                  TO ASC-PO-TYP-CDE-DESC          18430025
184400                  MOVE PURCHS-OTB-PER-NBR (1:4)                   18440025
184500                                  TO ASC-OTB-CCYY                 18450025
184600                  MOVE PURCHS-OTB-PER-NBR (5:2)                   18460025
184700                                  TO ASC-OTB-MM                   18470025
184800                  MOVE PC-DASH    TO ASC-OTB-DASH                 18480025
184900                                                                  18490025
185000             WHEN SQLCODE = +100                                  18500025
185100             WHEN SQLCODE = -904                                  18510025
185200             WHEN SQLCODE = -913                                  18520025
185300                  CONTINUE                                        18530025
185400                                                                  18540025
185500             WHEN SQLWARN0 NOT = SPACES                           18550025
185600             WHEN SQLCODE < +0                                    18560025
185700             WHEN SQLCODE > +0                                    18570025
185800                  MOVE '3010-GET-DEPT-NBR'                        18580025
185900                                  TO DP013-PARAGRAPH              18590025
186000                  MOVE 'UNSUCCESSFUL SELECT FOR DEPT NBR   '      18600025
186100                                  TO DP013-MESSAGE-TEXT (1)       18610025
186200                  MOVE SQLCA      TO DP013-SQLCA                  18620025
186300                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     18630025
186400                  SET DP013-DB2-ABEND                             18640025
186500                      DP013-XCTL-DISPLAY-RESTART                  18650025
186600                                  TO TRUE                         18660025
186700                  PERFORM DP013-0000-PROCESS-ABEND                18670025
186800         END-EVALUATE                                             18680025
186900     END-PERFORM.                                                 18690025
187000                                                                  18700025
187100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    18710025
187200         SQLCODE NOT = +0                                         18720025
187300         MOVE '3010-GET-DEPT-NBR '                                18730025
187400                                  TO DP013-PARAGRAPH              18740025
187500         MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR DEPT NBR'       18750025
187600                                  TO DP013-MESSAGE-TEXT (1)       18760025
187700         MOVE SQLCA               TO DP013-SQLCA                  18770025
187800         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     18780025
187900         SET DP013-DB2-ABEND                                      18790025
188000             DP013-XCTL-DISPLAY-RESTART                           18800025
188100                                  TO TRUE                         18810025
188200         PERFORM DP013-0000-PROCESS-ABEND                         18820025
188300     END-IF.                                                      18830025
188400                                                                  18840025
188500/                                                                 18850025
188600*----------------------------------------------------------------*18860025
188700* CHECK TO SEE IF PO NUMBER IS ACTIVE                            *18870025
188800*----------------------------------------------------------------*18880025
188900 3020-CHECK-ACTIVE-PO.                                            18890025
189000                                                                  18900025
189100     PERFORM                                                      18910025
189200         WITH TEST AFTER                                          18920025
189300         VARYING PV-RETRY-COUNTER                                 18930025
189400         FROM 1 BY 1                                              18940025
189500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18950025
189600             OR (SQLCODE = +0)                                    18960025
189700             OR (SQLCODE = +100))                                 18970025
189800                                                                  18980025
189900         EXEC SQL                                                 18990025
190000              SELECT B.ENT_NAME_DESC                              19000025
190100                INTO :ENTNME-ENT-NAME-DESC                        19010025
190200                FROM TPURCHS A                                    19020025
190300                    ,TENTNME B                                    19030025
190400               WHERE A.PO_NBR         = :DK-PO-NBR                19040025
190500                 AND A.VER_STATUS_CDE = 'A'                       19050025
190600                 AND B.TYPE_CDE       = '01'                      19060025
190700                 AND A.ENT_ID     = B.ENT_ID                      19070025
190800         END-EXEC                                                 19080025
190900                                                                  19090025
191000         EVALUATE TRUE                                            19100025
191100             WHEN SQLCODE = +0                                    19110025
191200             WHEN SQLCODE = +100                                  19120025
191300             WHEN SQLCODE = -904                                  19130025
191400             WHEN SQLCODE = -913                                  19140025
191500                  CONTINUE                                        19150025
191600                                                                  19160025
191700             WHEN SQLWARN0 NOT = SPACES                           19170025
191800             WHEN SQLCODE < +0                                    19180025
191900             WHEN SQLCODE > +0                                    19190025
192000                  MOVE '3020-CHECK-ACTIVE-PO  '                   19200025
192100                                  TO DP013-PARAGRAPH              19210025
192200                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'      19220025
192300                                  TO DP013-MESSAGE-TEXT (1)       19230025
192400                  MOVE SQLCA      TO DP013-SQLCA                  19240025
192500                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     19250025
192600                  SET DP013-DB2-ABEND                             19260025
192700                      DP013-XCTL-DISPLAY-RESTART                  19270025
192800                                  TO TRUE                         19280025
192900                  PERFORM DP013-0000-PROCESS-ABEND                19290025
193000         END-EVALUATE                                             19300025
193100     END-PERFORM.                                                 19310025
193200                                                                  19320025
193300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    19330025
193400         SQLCODE NOT = +0                                         19340025
193500         MOVE '3020-CHECK-ACTIVE-PO  '                            19350025
193600                                  TO DP013-PARAGRAPH              19360025
193700         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE NAME'    19370025
193800                                  TO DP013-MESSAGE-TEXT (1)       19380025
193900         MOVE SQLCA               TO DP013-SQLCA                  19390025
194000         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (1)     19400025
194100         SET DP013-DB2-ABEND                                      19410025
194200             DP013-XCTL-DISPLAY-RESTART                           19420025
194300                                  TO TRUE                         19430025
194400         PERFORM DP013-0000-PROCESS-ABEND                         19440025
194500     END-IF.                                                      19450025
194600                                                                  19460025
194700/                                                                 19470025
194800 3030-CHECK-DUPL-SHPPO.                                           19480025
194900                                                                  19490025
195000     PERFORM                                                      19500025
195100         WITH TEST AFTER                                          19510025
195200         VARYING PV-RETRY-COUNTER                                 19520025
195300         FROM 1 BY 1                                              19530025
195400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19540025
195500             OR (SQLCODE = +0)                                    19550025
195600             OR (SQLCODE = +100))                                 19560025
195700                                                                  19570025
195800         EXEC SQL                                                 19580025
195900             SELECT COUNT(*)                                      19590025
196000              INTO  :PV-DB2-COUNT                                 19600025
196100           FROM   TSHPTPO                                         19610025
196200           WHERE  SHIPT_ID = :DK-SHIPT-ID                         19620025
196300             AND  PO_NBR   = :DK-PO-NBR                           19630025
196400         END-EXEC                                                 19640025
196500                                                                  19650025
196600         EVALUATE TRUE                                            19660025
196700             WHEN SQLCODE = +0                                    19670025
196800             WHEN SQLCODE = +100                                  19680025
196900             WHEN SQLCODE = -904                                  19690025
197000             WHEN SQLCODE = -913                                  19700025
197100                 CONTINUE                                         19710025
197200                                                                  19720025
197300             WHEN SQLWARN0 NOT = SPACES                           19730025
197400             WHEN SQLCODE < +0                                    19740025
197500             WHEN SQLCODE > +0                                    19750025
197600                 MOVE '3030-CHECK-DUPL-SHPPO   '                  19760025
197700                                   TO DP013-PARAGRAPH             19770025
197800                 MOVE 'SELECT A TSHPTPO ROW   '                   19780025
197900                                   TO DP013-MESSAGE-TEXT(1)       19790025
198000                 MOVE SQLCA        TO DP013-SQLCA                 19800025
198100                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    19810025
198200                 SET DP013-DB2-ABEND                              19820025
198300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19830025
198400                 PERFORM DP013-0000-PROCESS-ABEND                 19840025
198500         END-EVALUATE                                             19850025
198600     END-PERFORM.                                                 19860025
198700                                                                  19870025
198800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    19880025
198900         SQLCODE NOT = +0                                         19890025
199000         MOVE '3030-CHECK-DUPL-SHPPO   '                          19900025
199100                                   TO DP013-PARAGRAPH             19910025
199200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              19920025
199300                                   TO DP013-MESSAGE-TEXT (1)      19930025
199400         MOVE 'TO SELECT A TSHPTPO ROW'                           19940025
199500                                   TO DP013-MESSAGE-TEXT (2)      19950025
199600         MOVE SQLCA                TO DP013-SQLCA                 19960025
199700         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    19970025
199800         SET DP013-DB2-ABEND                                      19980025
199900             DP013-XCTL-DISPLAY-RESTART                           19990025
200000                                   TO TRUE                        20000025
200100         PERFORM DP013-0000-PROCESS-ABEND                         20010025
200200     END-IF.                                                      20020025
200300                                                                  20030025
200400/                                                                 20040025
200500 3040-CHECK-TPURCHS-EXIST.                                        20050025
200600                                                                  20060025
200700     PERFORM                                                      20070025
200800         WITH TEST AFTER                                          20080025
200900         VARYING PV-RETRY-COUNTER                                 20090025
201000         FROM 1 BY 1                                              20100025
201100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20110025
201200             OR (SQLCODE = +0)                                    20120025
201300             OR (SQLCODE = +100))                                 20130025
201400                                                                  20140025
201500         EXEC SQL                                                 20150025
201600              SELECT PO_NBR                                       20160025
201700                INTO :PURCHS-PO-NBR                               20170025
201800                FROM TPURCHS                                      20180025
201900               WHERE PO_NBR         = :DK-PO-NBR                  20190025
202000                 AND VER_STATUS_CDE = 'A'                         20200025
202100         END-EXEC                                                 20210025
202200                                                                  20220025
202300         EVALUATE TRUE                                            20230025
202400             WHEN SQLCODE = +0                                    20240025
202500             WHEN SQLCODE = +100                                  20250025
202600             WHEN SQLCODE = -904                                  20260025
202700             WHEN SQLCODE = -913                                  20270025
202800                  CONTINUE                                        20280025
202900                                                                  20290025
203000             WHEN SQLWARN0 NOT = SPACES                           20300025
203100             WHEN SQLCODE < +0                                    20310025
203200             WHEN SQLCODE > +0                                    20320025
203300                  MOVE '3040-CHECK-TPURCHS-EXIST'                 20330025
203400                                  TO DP013-PARAGRAPH              20340025
203500                  MOVE 'UNSUCCESSFUL SELECT OF PO NUMBER'         20350025
203600                                  TO DP013-MESSAGE-TEXT (1)       20360025
203700                  MOVE SQLCA      TO DP013-SQLCA                  20370025
203800                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     20380025
203900                  SET DP013-DB2-ABEND                             20390025
204000                      DP013-XCTL-DISPLAY-RESTART                  20400025
204100                                  TO TRUE                         20410025
204200                  PERFORM DP013-0000-PROCESS-ABEND                20420025
204300         END-EVALUATE                                             20430025
204400     END-PERFORM.                                                 20440025
204500                                                                  20450025
204600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    20460025
204700         SQLCODE NOT = +0                                         20470025
204800         MOVE '3040-CHECK-TPURCHS-EXIST'                          20480025
204900                                  TO DP013-PARAGRAPH              20490025
205000         MOVE 'MAX RETRIES EXCEEDED ON SELECT PO NUMBER      '    20500025
205100                                  TO DP013-MESSAGE-TEXT (1)       20510025
205200         MOVE SQLCA               TO DP013-SQLCA                  20520025
205300         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     20530025
205400         SET DP013-DB2-ABEND                                      20540025
205500             DP013-XCTL-DISPLAY-RESTART                           20550025
205600                                  TO TRUE                         20560025
205700         PERFORM DP013-0000-PROCESS-ABEND                         20570025
205800     END-IF.                                                      20580025
205900                                                                  20590025
206000/                                                                 20600025
206100*----------------------------------------------------------------*20610025
206200*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *20620025
206300*----------------------------------------------------------------*20630025
206400                                                                  20640025
206500 3200-RESET-ATTRIBUTES.                                           20650025
206600                                                                  20660025
206700     IF  ASC-ADD-PENDING                                          20670025
206800         MOVE DP015-UNP-ALP-NOR-OFF TO APONBRA                    20680025
206900                                       AVNNMEA                    20690025
207000                                       APKSLA                     20700025
207100                                       AEXPCNTA                   20710025
207200                                       AACTCNTA                   20720025
207300                                       ADMGCNTA                   20730025
207400         MOVE DP015-GREEN           TO APONBRC                    20740025
207500                                       AVNNMEC                    20750025
207600                                       APKSLC                     20760025
207700                                       AEXPCNTC                   20770025
207800                                       AACTCNTC                   20780025
207900                                       ADMGCNTC                   20790025
208000         MOVE DP015-UNDERLINE       TO APONBRH                    20800025
208100                                       AVNNMEH                    20810025
208200                                       APKSLH                     20820025
208300                                       AEXPCNTH                   20830025
208400                                       AACTCNTH                   20840025
208500                                       ADMGCNTH                   20850025
208600     ELSE                                                         20860025
208700         IF  ASC-UPDATE-PENDING                                   20870025
208800             MOVE DP015-PRO-NOR-OFF     TO APONBRA                20880025
208900             MOVE DP015-UNP-ALP-NOR-OFF TO APKSLA                 20890025
209000                                           AEXPCNTA               20900025
209100                                           AACTCNTA               20910025
209200                                           ADMGCNTA               20920025
209300             MOVE DP015-BLUE            TO APONBRC                20930025
209400             MOVE DP015-GREEN           TO APKSLC                 20940025
209500                                           AEXPCNTC               20950025
209600                                           AACTCNTC               20960025
209700                                           ADMGCNTC               20970025
209800             MOVE DP015-HL-OFF          TO APONBRH                20980025
209900             MOVE DP015-UNDERLINE       TO APKSLH                 20990025
210000                                           AEXPCNTH               21000025
210100                                           AACTCNTH               21010025
210200                                           ADMGCNTH               21020025
210300             IF  ASC-SHPPO-NAME-EXISTS                            21030025
210400                 MOVE DP015-PRO-NOR-OFF TO AVNNMEA                21040025
210500                 MOVE DP015-BLUE        TO AVNNMEC                21050025
210600                 MOVE DP015-HL-OFF      TO AVNNMEH                21060025
210700             ELSE                                                 21070025
210800                 MOVE DP015-UNP-ALP-NOR-OFF                       21080025
210900                                        TO AVNNMEA                21090025
211000                 MOVE DP015-GREEN       TO AVNNMEC                21100025
211100                 MOVE DP015-UNDERLINE   TO AVNNMEH                21110025
211200             END-IF                                               21120025
211300             IF ASC-INTER-APPL-LIST-LIST AND                      21130025
211400                ASC-ACTL-CART-CNT-N > 0                           21140025
211500                 MOVE DP015-PRO-NOR-OFF     TO AEXPCNTA           21150025
211600                 MOVE DP015-BLUE            TO AEXPCNTC           21160025
211700             END-IF                                               21170025
211800         ELSE                                                     21180025
211900             IF  ASC-DELETE-PENDING                               21190025
212000                 MOVE DP015-PRO-NOR-OFF     TO APONBRA            21200025
212100                                               AVNNMEA            21210025
212200                                               APKSLA             21220025
212300                                               AEXPCNTA           21230025
212400                                               AACTCNTA           21240025
212500                                               ADMGCNTA           21250025
212600                 MOVE DP015-BLUE            TO APONBRC            21260025
212700                                               AVNNMEC            21270025
212800                                               APKSLC             21280025
212900                                               AEXPCNTC           21290025
213000                                               AACTCNTC           21300025
213100                                               ADMGCNTC           21310025
213200                 MOVE DP015-HL-OFF          TO APONBRH            21320025
213300                                               AVNNMEH            21330025
213400                                               APKSLH             21340025
213500                                               AEXPCNTH           21350025
213600                                               AACTCNTH           21360025
213700                                               ADMGCNTH           21370025
213800             END-IF                                               21380025
213900        END-IF                                                    21390025
214000     END-IF.                                                      21400025
214100                                                                  21410025
214200     IF ASC-PO-STATUS-DESC  = 'APPROVED' OR 'ACTIVE'              21420025
214300         MOVE DP015-BLUE                    TO APOSTATC           21430025
214400     ELSE                                                         21440025
214500         MOVE DP015-RED                     TO APOSTATC           21450025
214600     END-IF.                                                      21460025
214700                                                                  21470025
214800     IF ASC-PO-TYP-CDE-DESC = ('IMPORT' OR 'IMPORT ECOMMERCE'     21480025
214900                                 OR 'IMPORT FLOWBACK')            21490025
215000         MOVE DP015-BLUE                    TO ATRIPTPC           21500025
215100     ELSE                                                         21510025
215200         MOVE DP015-RED                     TO ATRIPTPC           21520025
215300     END-IF.                                                      21530025
215400/                                                                 21540025
215500*----------------------------------------------------------------*21550025
215600*    SAVE SCREEN FIELDS FOR LATER COMPARISONS                    *21560025
215700*----------------------------------------------------------------*21570025
215800                                                                  21580025
215900 3500-SAVE-SCREEN-FIELDS.                                         21590025
216000                                                                  21600025
216100     MOVE ASC-PO-NBR             TO ASC-PO-NBR-OLD.               21610025
216200     MOVE ASC-VEND-NAME          TO ASC-VEND-NAME-OLD.            21620025
216300     MOVE ASC-PKSL-IND           TO ASC-PKSL-IND-OLD.             21630025
216400     MOVE ASC-EXPTED-CART-CNT    TO ASC-EXPTED-CART-CNT-OLD.      21640025
216500     MOVE ASC-ACTL-CART-CNT      TO ASC-ACTL-CART-CNT-OLD.        21650025
216600     MOVE ASC-DMG-CART-CNT       TO ASC-DMG-CART-CNT-OLD.         21660025
216700                                                                  21670025
216800/                                                                 21680025
216900*----------------------------------------------------------------*21690025
217000*  CHECK TO SEE IF ANY FIELDS CHANGED.                           *21700025
217100*----------------------------------------------------------------*21710025
217200                                                                  21720025
217300 3600-CHECK-IF-FIELDS-CHANGED.                                    21730025
217400                                                                  21740025
217500     MOVE 'N'                    TO ASC-FIELDS-CHANGED-SW.        21750025
217600                                                                  21760025
217700     IF  ASC-PO-NBR             = ASC-PO-NBR-OLD                  21770025
217800     AND ASC-VEND-NAME          = ASC-VEND-NAME-OLD               21780025
217900     AND ASC-PKSL-IND           = ASC-PKSL-IND-OLD                21790025
218000     AND ASC-EXPTED-CART-CNT    = ASC-EXPTED-CART-CNT-OLD         21800025
218100     AND ASC-ACTL-CART-CNT      = ASC-ACTL-CART-CNT-OLD           21810025
218200     AND ASC-DMG-CART-CNT       = ASC-DMG-CART-CNT-OLD            21820025
218300         CONTINUE                                                 21830025
218400     ELSE                                                         21840025
218500         SET ASC-FIELDS-CHANGED  TO TRUE                          21850025
218600     END-IF.                                                      21860025
218700                                                                  21870025
218800/                                                                 21880025
218900*----------------------------------------------------------------*21890025
219000*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *21900025
219100*    ENTRY.                                                      *21910025
219200*----------------------------------------------------------------*21920025
219300                                                                  21930025
219400 4000-BUILD-INITIAL-PANEL.                                        21940025
219500                                                                  21950025
219600     INITIALIZE DCLTSHPTPO                                        21960025
219700                ASC-SCREEN-FIELDS.                                21970025
219800                                                                  21980025
219900     MOVE ZEROES                 TO ASC-PO-NBR-N                  21990025
220000                                    ASC-EXPTED-CART-CNT-N         22000025
220100                                    ASC-ACTL-CART-CNT-N           22010025
220200                                    ASC-DMG-CART-CNT-N.           22020025
220300                                                                  22030025
220400     MOVE ASC-KEY-OPER-UNT-ID      TO DK-OPER-UNT-ID.             22040025
220500     MOVE ASC-KEY-FCLTY-ID         TO DK-FCLTY-ID.                22050025
220600     MOVE ASC-KEY-SHIPT-ID         TO DK-SHIPT-ID.                22060025
220700     MOVE ASC-KEY-TRIP-ID          TO DK-TRIP-ID.                 22070025
220800     MOVE ASC-KEY-PO-NBR           TO DK-PO-NBR.                  22080025
220900                                                                  22090025
221000     PERFORM 4200-SELECT-LOC-NAME.                                22100025
221100     MOVE XL071-LOC-NM           TO ASC-FCLTY-NME.                22110025
221200                                                                  22120025
221300     PERFORM 4100-SELECT-TSHPTPO.                                 22130025
221400                                                                  22140025
221500     IF  ASC-SHPPO-NAME-EXISTS                                    22150025
221600         CONTINUE                                                 22160025
221700     ELSE                                                         22170025
221800         PERFORM 4110-GET-VEND-NAME                               22180025
221900     END-IF.                                                      22190025
222000                                                                  22200025
222100     IF  ASC-ADD-PENDING                                          22210025
222200         MOVE 'Y'                 TO ASC-PKSL-IND                 22220025
222300     END-IF.                                                      22230025
222400                                                                  22240025
222500     IF PS-SHPTPO-FOUND                                           22250025
222600         PERFORM 3010-GET-DEPT-NBR                                22260025
222700         PERFORM 7020-DEPT-BUYER-NAMES                            22270025
222800         PERFORM 7030-GET-PO-STATUS-DESC                          22280025
222900         PERFORM 7040-SELECT-TPLNSHP                              22290025
223000     END-IF.                                                      22300025
223100                                                                  22310025
223200*  THERE WILL NEVER BE A TALLPLN FOR OPER-UNT = 90, SO SKIP       22320025
223300*  THE DISTRO LOGIC.                                              22330025
223400     IF DK-OPER-UNT-ID = 90                                       22340025
223500         CONTINUE                                                 22350025
223600     ELSE                                                         22360025
223700         PERFORM 4300-DETERMINE-NO-DISTRO                         22370025
223800     END-IF.                                                      22380025
223900                                                                  22390025
224000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        22400025
224100                                                                  22410025
224200/                                                                 22420025
224300*----------------------------------------------------------------*22430025
224400* SELECT A SHIPMENT PO                                           *22440025
224500*----------------------------------------------------------------*22450025
224600 4100-SELECT-TSHPTPO.                                             22460025
224700                                                                  22470025
224800     PERFORM                                                      22480025
224900         WITH TEST AFTER                                          22490025
225000         VARYING PV-RETRY-COUNTER                                 22500025
225100         FROM 1 BY 1                                              22510025
225200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22520025
225300             OR (SQLCODE = +0)                                    22530025
225400             OR (SQLCODE = +100))                                 22540025
225500                                                                  22550025
225600         EXEC SQL                                                 22560025
225700              SELECT PO_NBR                                       22570025
225800                    ,EXPTED_CART_CNT                              22580025
225900                    ,ACTL_CART_CNT                                22590025
226000                    ,DMG_CART_CNT                                 22600025
226100                    ,PKSL_IND                                     22610025
226200                    ,VEND_NAME                                    22620025
226300                INTO :SHPTPO-PO-NBR                               22630025
226400                    ,:SHPTPO-EXPTED-CART-CNT                      22640025
226500                    ,:SHPTPO-ACTL-CART-CNT                        22650025
226600                    ,:SHPTPO-DMG-CART-CNT                         22660025
226700                    ,:SHPTPO-PKSL-IND                             22670025
226800                    ,:SHPTPO-VEND-NAME                            22680025
226900                FROM TSHPTPO                                      22690025
227000               WHERE SHIPT_ID = :DK-SHIPT-ID                      22700025
227100                 AND PO_NBR   = :DK-PO-NBR                        22710025
227200         END-EXEC                                                 22720025
227300                                                                  22730025
227400         EVALUATE TRUE                                            22740025
227500             WHEN SQLCODE = ZERO                                  22750025
227600                  MOVE SHPTPO-PO-NBR   TO ASC-PO-NBR-N            22760025
227700                                          DK-PO-NBR               22770025
227800                  MOVE SHPTPO-EXPTED-CART-CNT                     22780025
227900                                       TO ASC-EXPTED-CART-CNT-N   22790025
228000                  MOVE SHPTPO-ACTL-CART-CNT                       22800025
228100                                       TO ASC-ACTL-CART-CNT-N     22810025
228200                  MOVE SHPTPO-DMG-CART-CNT                        22820025
228300                                       TO ASC-DMG-CART-CNT-N      22830025
228400                  MOVE SHPTPO-PKSL-IND                            22840025
228500                                       TO ASC-PKSL-IND            22850025
228600                  IF  SHPTPO-VEND-NAME > SPACES                   22860025
228700                      SET ASC-SHPPO-NAME-EXISTS                   22870025
228800                                       TO TRUE                    22880025
228900                      MOVE SHPTPO-VEND-NAME                       22890025
229000                                       TO ASC-VEND-NAME           22900025
229100                  ELSE                                            22910025
229200                      MOVE 'N'         TO ASC-SHPPO-NAME-SW       22920025
229300                  END-IF                                          22930025
229400                  SET PS-SHPTPO-FOUND TO TRUE                     22940025
229500                                                                  22950025
229600             WHEN SQLCODE = +100                                  22960025
229700                  SET PS-SHPTPO-NOT-FOUND TO TRUE                 22970025
229800             WHEN SQLCODE = -904                                  22980025
229900             WHEN SQLCODE = -913                                  22990025
230000                  CONTINUE                                        23000025
230100                                                                  23010025
230200             WHEN SQLWARN0 NOT = SPACES                           23020025
230300             WHEN SQLCODE < +0                                    23030025
230400             WHEN SQLCODE > +0                                    23040025
230500                  MOVE '4100-SELECT-TSHPTPO'                      23050025
230600                                  TO DP013-PARAGRAPH              23060025
230700                  MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '         23070025
230800                                  TO DP013-MESSAGE-TEXT (1)       23080025
230900                  MOVE SQLCA      TO DP013-SQLCA                  23090025
231000                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     23100025
231100                  SET DP013-DB2-ABEND                             23110025
231200                      DP013-XCTL-DISPLAY-RESTART                  23120025
231300                                  TO TRUE                         23130025
231400                  PERFORM DP013-0000-PROCESS-ABEND                23140025
231500         END-EVALUATE                                             23150025
231600     END-PERFORM.                                                 23160025
231700                                                                  23170025
231800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    23180025
231900         SQLCODE NOT = +0                                         23190025
232000         MOVE '4100-SELECT-TSHPTPO'                               23200025
232100                                  TO DP013-PARAGRAPH              23210025
232200         MOVE 'MAX RETRIES EXCEEDED ON SELECY FOR TSHPTPO'        23220025
232300                                  TO DP013-MESSAGE-TEXT (1)       23230025
232400         MOVE SQLCA               TO DP013-SQLCA                  23240025
232500         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (1)     23250025
232600         SET DP013-DB2-ABEND                                      23260025
232700             DP013-XCTL-DISPLAY-RESTART                           23270025
232800                                  TO TRUE                         23280025
232900         PERFORM DP013-0000-PROCESS-ABEND                         23290025
233000     END-IF.                                                      23300025
233100                                                                  23310025
233200/                                                                 23320025
233300*----------------------------------------------------------------*23330025
233400* GET THE VENDOR NAME                                            *23340025
233500*----------------------------------------------------------------*23350025
233600 4110-GET-VEND-NAME.                                              23360025
233700                                                                  23370025
233800     PERFORM                                                      23380025
233900         WITH TEST AFTER                                          23390025
234000         VARYING PV-RETRY-COUNTER                                 23400025
234100         FROM 1 BY 1                                              23410025
234200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               23420025
234300             OR (SQLCODE = +0)                                    23430025
234400             OR (SQLCODE = +100))                                 23440025
234500                                                                  23450025
234600         EXEC SQL                                                 23460025
234700              SELECT B.ENT_NAME_DESC                              23470025
234800                INTO :ENTNME-ENT-NAME-DESC                        23480025
234900                FROM TPURCHS A                                    23490025
235000                    ,TENTNME B                                    23500025
235100                    ,TSTATCD C                                    23510025
235200               WHERE A.PO_NBR         = :DK-PO-NBR                23520025
235300                 AND A.VER_STATUS_CDE = 'A'                       23530025
235400                 AND B.TYPE_CDE       = '01'                      23540025
235500                 AND C.STATUS_TYP_CDE = 'P'                       23550025
235600                 AND C.STATUS_CLS     = 'ACT'                     23560025
235700                 AND A.STATUS_CDE = C.STATUS_CDE                  23570025
235800                 AND A.ENT_ID     = B.ENT_ID                      23580025
235900         END-EXEC                                                 23590025
236000                                                                  23600025
236100         EVALUATE TRUE                                            23610025
236200             WHEN SQLCODE = +0                                    23620025
236300                  MOVE ENTNME-ENT-NAME-DESC                       23630025
236400                                    TO ASC-VEND-NAME              23640025
236500                  SET ASC-ACTIVE-PO TO TRUE                       23650025
236600                                                                  23660025
236700             WHEN SQLCODE = +100                                  23670025
236800                  MOVE 'N'          TO ASC-ACTIVE-PO-SW           23680025
236900                                                                  23690025
237000             WHEN SQLCODE = -904                                  23700025
237100             WHEN SQLCODE = -913                                  23710025
237200                  CONTINUE                                        23720025
237300                                                                  23730025
237400             WHEN SQLWARN0 NOT = SPACES                           23740025
237500             WHEN SQLCODE < +0                                    23750025
237600             WHEN SQLCODE > +0                                    23760025
237700                  MOVE '4110-GET-VENDOR-NAME'                     23770025
237800                                  TO DP013-PARAGRAPH              23780025
237900                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'      23790025
238000                                  TO DP013-MESSAGE-TEXT (1)       23800025
238100                  MOVE SQLCA      TO DP013-SQLCA                  23810025
238200                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     23820025
238300                  SET DP013-DB2-ABEND                             23830025
238400                      DP013-XCTL-DISPLAY-RESTART                  23840025
238500                                  TO TRUE                         23850025
238600                  PERFORM DP013-0000-PROCESS-ABEND                23860025
238700         END-EVALUATE                                             23870025
238800     END-PERFORM.                                                 23880025
238900                                                                  23890025
239000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    23900025
239100         SQLCODE NOT = +0                                         23910025
239200         MOVE '4110-GET-VEND-NAME'                                23920025
239300                                  TO DP013-PARAGRAPH              23930025
239400         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE NAME'    23940025
239500                                  TO DP013-MESSAGE-TEXT (1)       23950025
239600         MOVE SQLCA               TO DP013-SQLCA                  23960025
239700         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (1)     23970025
239800         SET DP013-DB2-ABEND                                      23980025
239900             DP013-XCTL-DISPLAY-RESTART                           23990025
240000                                  TO TRUE                         24000025
240100         PERFORM DP013-0000-PROCESS-ABEND                         24010025
240200     END-IF.                                                      24020025
240300                                                                  24030025
240400/                                                                 24040025
240500*----------------------------------------------------------------*24050025
240600*    GET LOCATION NAME FROM XLT_LOC TABLE VIA XLKUT071           *24060025
240700*----------------------------------------------------------------*24070025
240800                                                                  24080025
240900 4200-SELECT-LOC-NAME.                                            24090025
241000                                                                  24100025
241100     INITIALIZE XL071-COMMAREA-REC.                               24110025
241200                                                                  24120025
241300     MOVE ASC-KEY-OPER-UNT-ID TO XL071-LOCATION-NUMBER.           24130025
241400                                                                  24140025
241500     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    24150025
241600                                      XL071-COMMAREA              24160025
241700                                      XL071-COMMAREA-REC.         24170025
241800                                                                  24180025
241900     EVALUATE TRUE                                                24190025
242000         WHEN XL071-NO-ERRORS                                     24200025
242100             CONTINUE                                             24210025
242200         WHEN XL071-LOC-NOT-FOUND                                 24220025
242300         WHEN XL071-SQLCODE-N = -904                              24230025
242400         WHEN XL071-SQLCODE-N = -913                              24240025
242500             MOVE SPACES TO XL071-LOC-NM                          24250025
242600                                                                  24260025
242700         WHEN XL071-BAD-DB2-RETURN                                24270025
242800              MOVE '4200-SELECT-LOC-NAME' TO DP013-PARAGRAPH      24280025
242900              MOVE 'CALL TO XLKUT071' TO DP013-MESSAGE-TEXT (1)   24290025
243000              STRING 'LOCATION NBR: '    DELIMITED BY SIZE        24300025
243100                   XL071-LOCATION-NUMBER DELIMITED BY SIZE        24310025
243200                                    INTO DP013-MESSAGE-TEXT(2)    24320025
243300              MOVE XL071-SQLCA     TO DP013-SQLCA                 24330025
243400              MOVE 'XLT_LOC'       TO DP013-DB2-TABLE-NAME (1)    24340025
243500              SET DP013-DB2-ABEND                                 24350025
243600                  DP013-XCTL-DISPLAY-RESTART TO TRUE              24360025
243700              PERFORM DP013-0000-PROCESS-ABEND                    24370025
243800     END-EVALUATE.                                                24380025
243900                                                                  24390025
244000/                                                                 24400025
244100 4300-DETERMINE-NO-DISTRO.                                        24410025
244200******************************************************************24420025
244300*    THIS PARAGRAPH DETERMINES IF THE 'NO DISTRO' SHOULD BE       24430025
244400*    DISPLAYED FOR THE PO.                                        24440025
244500******************************************************************24450025
244600                                                                  24460025
244700     PERFORM 4310-OPEN-PO-CSR.                                    24470025
244800     PERFORM 4320-FETCH-PO-CSR.                                   24480025
244900     SET PS-NOT-DONE TO TRUE.                                     24490025
245000     PERFORM 4330-PROCESS-PO-CSR UNTIL PS-DONE.                   24500025
245100                                                                  24510025
245200     IF PS-DISPLAY-DISTRO-MSG                                     24520025
245300        MOVE 'NO DISTRO'      TO ASC-NO-DISTRO-MSG                24530025
245400     ELSE                                                         24540025
245500        MOVE SPACES           TO ASC-NO-DISTRO-MSG                24550025
245600     END-IF.                                                      24560025
245700                                                                  24570025
245800 4310-OPEN-PO-CSR.                                                24580025
245900                                                                  24590025
246000     PERFORM                                                      24600025
246100         WITH TEST AFTER                                          24610025
246200         VARYING PV-RETRY-COUNTER                                 24620025
246300         FROM 1 BY 1                                              24630025
246400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               24640025
246500            OR (SQLCODE = +0))                                    24650025
246600                                                                  24660025
246700         EXEC SQL                                                 24670025
246800              OPEN PO_CSR                                         24680025
246900         END-EXEC                                                 24690025
247000                                                                  24700025
247100         EVALUATE TRUE                                            24710025
247200             WHEN SQLCODE = +0                                    24720025
247300                  CONTINUE                                        24730025
247400             WHEN SQLCODE = -904                                  24740025
247500             WHEN SQLCODE = -913                                  24750025
247600                  CONTINUE                                        24760025
247700             WHEN SQLWARN0 NOT = SPACE                            24770025
247800             WHEN SQLCODE  NOT = +0                               24780025
247900                  MOVE '4310-OPEN-PO-CSR'                         24790025
248000                                   TO DP013-PARAGRAPH             24800025
248100                  MOVE 'OPEN PO CURSOR'                           24810025
248200                                   TO DP013-MESSAGE-TEXT (1)      24820025
248300                  MOVE DK-PO-NBR   TO DP013-MESSAGE-TEXT (2)      24830025
248400                  MOVE SQLCA       TO DP013-SQLCA                 24840025
248500                  MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)    24850025
248600                  SET DP013-DB2-ABEND                             24860025
248700                                   TO TRUE                        24870025
248800                  PERFORM DP013-0000-PROCESS-ABEND                24880025
248900         END-EVALUATE                                             24890025
249000     END-PERFORM.                                                 24900025
249100                                                                  24910025
249200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    24920025
249300         SQLCODE NOT = +0                                         24930025
249400         MOVE '4310-OPEN-PO-CSR' TO DP013-PARAGRAPH               24940025
249500         MOVE 'MAX RETRIES EXCEEDED FOR OPEN PO CURSOR'           24950025
249600                                   TO DP013-MESSAGE-TEXT (1)      24960025
249700         MOVE SQLCA                TO DP013-SQLCA                 24970025
249800         SET DP013-DB2-ABEND       TO TRUE                        24980025
249900         PERFORM DP013-0000-PROCESS-ABEND                         24990025
250000     END-IF.                                                      25000025
250100                                                                  25010025
250200 4320-FETCH-PO-CSR.                                               25020025
250300                                                                  25030025
250400     EXEC SQL                                                     25040025
250500          FETCH PO_CSR                                            25050025
250600          INTO :PURITM-PO-LNE-NBR                                 25060025
250700     END-EXEC                                                     25070025
250800                                                                  25080025
250900     EVALUATE TRUE                                                25090025
251000         WHEN SQLCODE = +0                                        25100025
251100              CONTINUE                                            25110025
251200                                                                  25120025
251300         WHEN SQLCODE = +100                                      25130025
251400              SET PS-DONE TO TRUE                                 25140025
251500                                                                  25150025
251600         WHEN SQLWARN0 NOT = SPACE                                25160025
251700         WHEN SQLCODE < +0                                        25170025
251800         WHEN SQLCODE > +0                                        25180025
251900              MOVE '4320-FETCH-PO-CSR'                            25190025
252000                                   TO DP013-PARAGRAPH             25200025
252100              MOVE 'FETCH PO CURSOR'                              25210025
252200                                   TO DP013-MESSAGE-TEXT (1)      25220025
252300              MOVE PURITM-PO-LNE-NBR                              25230025
252400                                   TO DP013-MESSAGE-TEXT (2)      25240025
252500              MOVE SQLCA           TO DP013-SQLCA                 25250025
252600              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    25260025
252700              SET DP013-DB2-ABEND  TO TRUE                        25270025
252800              PERFORM DP013-0000-PROCESS-ABEND                    25280025
252900     END-EVALUATE.                                                25290025
253000                                                                  25300025
253100 4330-PROCESS-PO-CSR.                                             25310025
253200                                                                  25320025
253300     PERFORM                                                      25330025
253400         WITH TEST AFTER                                          25340025
253500         VARYING PV-RETRY-COUNTER                                 25350025
253600         FROM 1 BY 1                                              25360025
253700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               25370025
253800            OR  (SQLCODE = +100)                                  25380025
253900            OR  (SQLCODE = +0))                                   25390025
254000                                                                  25400025
254100         EXEC SQL                                                 25410025
254200            SELECT  PLAN_NBR                                      25420025
254300            INTO   :ALLPLN-PLAN-NBR                               25430025
254400            FROM    TALLPLN                                       25440025
254500            WHERE   PO_NBR     = :DK-PO-NBR                       25450025
254600            AND     PO_LNE_NBR = :PURITM-PO-LNE-NBR               25460025
254700            AND     DEST_NBR   = :DK-OPER-UNT-ID                  25470025
254800            AND     STATUS_CDE = :PC-PO-ACTIVE                    25480025
254900         END-EXEC                                                 25490025
255000                                                                  25500025
255100         EVALUATE TRUE                                            25510025
255200             WHEN SQLCODE = -904                                  25520025
255300             WHEN SQLCODE = -913                                  25530025
255400                  CONTINUE                                        25540025
255500                                                                  25550025
255600             WHEN SQLCODE = +0                                    25560025
255700                  SET PS-DISTRO         TO TRUE                   25570025
255800                                                                  25580025
255900             WHEN SQLCODE = +100                                  25590025
256000                  SET PS-NO-DISTRO      TO TRUE                   25600025
256100                                                                  25610025
256200             WHEN SQLWARN0 NOT = SPACE                            25620025
256300             WHEN SQLCODE < +0                                    25630025
256400             WHEN SQLCODE > +0                                    25640025
256500                  MOVE SPACES TO PV-MESSAGE                       25650025
256600                  MOVE DK-PO-NBR TO PV-MESSAGE1                   25660025
256700                  MOVE PURITM-PO-LNE-NBR TO PV-MESSAGE2           25670025
256800                  MOVE PV-OPER-UNT-ID TO PV-MESSAGE3              25680025
256900                  MOVE '4330-PROCESS-PO-CSR '                     25690025
257000                                   TO DP013-PARAGRAPH             25700025
257100                  MOVE 'SELECT ON TALLPLN'                        25710025
257200                                   TO DP013-MESSAGE-TEXT (1)      25720025
257300                  MOVE PV-MESSAGE  TO DP013-MESSAGE-TEXT (2)      25730025
257400                  MOVE SQLCA       TO DP013-SQLCA                 25740025
257500                  MOVE 'TALLPLN'   TO DP013-DB2-TABLE-NAME (1)    25750025
257600                  SET DP013-DB2-ABEND                             25760025
257700                      DP013-XCTL-DISPLAY-RESTART                  25770025
257800                                   TO TRUE                        25780025
257900                  PERFORM DP013-0000-PROCESS-ABEND                25790025
258000         END-EVALUATE                                             25800025
258100     END-PERFORM.                                                 25810025
258200                                                                  25820025
258300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    25830025
258400         SQLCODE NOT = +0                                         25840025
258500         MOVE '4330-PROCESS-PO-CSR '                              25850025
258600                                   TO DP013-PARAGRAPH             25860025
258700         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   25870025
258800                                   TO DP013-MESSAGE-TEXT (1)      25880025
258900         MOVE 'ON TABLE TALLPLN '  TO DP013-MESSAGE-TEXT (2)      25890025
259000         MOVE SQLCA                TO DP013-SQLCA                 25900025
259100         SET DP013-DB2-ABEND                                      25910025
259200             DP013-XCTL-DISPLAY-RESTART                           25920025
259300                                   TO TRUE                        25930025
259400         PERFORM DP013-0000-PROCESS-ABEND                         25940025
259500     END-IF.                                                      25950025
259600                                                                  25960025
259700                                                                  25970025
259800     IF PS-DISTRO                                                 25980025
259900        PERFORM                                                   25990025
260000            WITH TEST AFTER                                       26000025
260100            VARYING PV-RETRY-COUNTER                              26010025
260200            FROM 1 BY 1                                           26020025
260300            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            26030025
260400               OR  (SQLCODE = +100)                               26040025
260500               OR  (SQLCODE = -811)                               26050025
260600               OR  (SQLCODE = +0))                                26060025
260700                                                                  26070025
260800            EXEC SQL                                              26080025
260900               SELECT  PO_NBR                                     26090025
261000               INTO   :MESTDS-PO-NBR                              26100025
261100               FROM    TMESTDS                                    26110025
261200               WHERE   PO_NBR     = :DK-PO-NBR                    26120025
261300               AND     PO_LNE_NBR = :PURITM-PO-LNE-NBR            26130025
261400               AND     PLAN_NBR   = :ALLPLN-PLAN-NBR              26140025
261500            END-EXEC                                              26150025
261600                                                                  26160025
261700            EVALUATE TRUE                                         26170025
261800                WHEN SQLCODE = -904                               26180025
261900                WHEN SQLCODE = -913                               26190025
262000                     CONTINUE                                     26200025
262100                                                                  26210025
262200                WHEN SQLCODE = +0                                 26220025
262300                WHEN SQLCODE = -811                               26230025
262400                     SET PS-DISTRO         TO TRUE                26240025
262500                                                                  26250025
262600                WHEN SQLCODE = +100                               26260025
262700                     SET PS-NO-DISTRO      TO TRUE                26270025
262800                                                                  26280025
262900                WHEN SQLWARN0 NOT = SPACE                         26290025
263000                WHEN SQLCODE < +0                                 26300025
263100                WHEN SQLCODE > +0                                 26310025
263200                     MOVE SPACES TO PV-MESSAGE                    26320025
263300                     MOVE DK-PO-NBR TO PV-MESSAGE1                26330025
263400                     MOVE PURITM-PO-LNE-NBR TO PV-MESSAGE2        26340025
263500                     MOVE ALLPLN-PLAN-NBR TO PV-MESSAGE3          26350025
263600                     MOVE '4330-PROCESS-PO-CSR '                  26360025
263700                                      TO DP013-PARAGRAPH          26370025
263800                     MOVE 'SELECT ON TMESTDS'                     26380025
263900                                      TO DP013-MESSAGE-TEXT (1)   26390025
264000                     MOVE PV-MESSAGE  TO DP013-MESSAGE-TEXT (2)   26400025
264100                     MOVE SQLCA       TO DP013-SQLCA              26410025
264200                     MOVE 'TMESTDS'   TO DP013-DB2-TABLE-NAME (1) 26420025
264300                     SET DP013-DB2-ABEND                          26430025
264400                         DP013-XCTL-DISPLAY-RESTART               26440025
264500                                      TO TRUE                     26450025
264600                     PERFORM DP013-0000-PROCESS-ABEND             26460025
264700            END-EVALUATE                                          26470025
264800        END-PERFORM                                               26480025
264900                                                                  26490025
265000        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                 26500025
265100            SQLCODE NOT = +0                                      26510025
265200            MOVE '4330-PROCESS-PO-CSR '                           26520025
265300                                      TO DP013-PARAGRAPH          26530025
265400            MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                26540025
265500                                      TO DP013-MESSAGE-TEXT (1)   26550025
265600            MOVE 'ON TABLE TMESTDS '  TO DP013-MESSAGE-TEXT (2)   26560025
265700            MOVE SQLCA                TO DP013-SQLCA              26570025
265800            SET DP013-DB2-ABEND                                   26580025
265900                DP013-XCTL-DISPLAY-RESTART                        26590025
266000                                      TO TRUE                     26600025
266100            PERFORM DP013-0000-PROCESS-ABEND                      26610025
266200        END-IF                                                    26620025
266300     END-IF.                                                      26630025
266400                                                                  26640025
266500     IF PS-NO-DISTRO                                              26650025
266600        SET PS-DISPLAY-DISTRO-MSG TO TRUE                         26660025
266700        SET PS-DONE TO TRUE                                       26670025
266800     ELSE                                                         26680025
266900        PERFORM 4320-FETCH-PO-CSR                                 26690025
267000     END-IF.                                                      26700025
267100                                                                  26710025
267200                                                                  26720025
267300/                                                                 26730025
267400*----------------------------------------------------------------*26740025
267500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *26750025
267600*----------------------------------------------------------------*26760025
267700                                                                  26770025
267800 4400-MOVE-COMMAREA-TO-SCREEN.                                    26780025
267900                                                                  26790025
268000     MOVE ASC-KEY-OPER-UNT-ID     TO AOPERO.                      26800025
268100     MOVE ASC-KEY-FCLTY-ID        TO AFCLTYO.                     26810025
268200     MOVE ASC-FCLTY-NME           TO ADESCO.                      26820025
268300     MOVE ASC-KEY-PRO-NBR         TO APRONBRO.                    26830025
268400     MOVE ASC-KEY-BOL-NBR         TO ABOLNBRO.                    26840025
268500     MOVE ASC-PO-NBR-N            TO APONBRO.                     26850025
268600     MOVE ASC-VEND-NAME           TO AVNNMEO.                     26860025
268700     MOVE ASC-PKSL-IND            TO APKSLO.                      26870025
268800     MOVE ASC-EXPTED-CART-CNT-N   TO AEXPCNTO.                    26880025
268900     MOVE ASC-ACTL-CART-CNT-N     TO AACTCNTO.                    26890025
269000     MOVE ASC-DMG-CART-CNT-N      TO ADMGCNTO.                    26900025
269100                                                                  26910025
269200     IF  ASC-ADD-PENDING                                          26920025
269300         MOVE -1                  TO APONBRL                      26930025
269400         SET DP030-SET-CURSOR-APPL-1                              26940025
269500                                  TO TRUE                         26950025
269600     ELSE                                                         26960025
269700         IF  ASC-UPDATE-PENDING                                   26970025
269800             MOVE -1              TO AVNNMEL                      26980025
269900             SET DP030-SET-CURSOR-APPL-1                          26990025
270000                                  TO TRUE                         27000025
270100         END-IF                                                   27010025
270200     END-IF.                                                      27020025
270300                                                                  27030025
270400     IF ASC-INTER-APPL-LIST-LIST                                  27040025
270500         IF ASC-ACTL-CART-CNT-N > 0                               27050025
270600             MOVE DP015-PRO-NOR-OFF   TO AEXPCNTA                 27060025
270700         END-IF                                                   27070025
270800     END-IF.                                                      27080025
270900                                                                  27090025
271000     MOVE ASC-NO-DISTRO-MSG           TO ADISTOO                  27100025
271100     MOVE ASC-PO-TYP-CDE-DESC         TO ATRIPTPO                 27110025
271200     MOVE ASC-DONT-SHIP-BEF-DTE       TO ABEFDTEO                 27120025
271300     MOVE ASC-CANCEL-DTE              TO ACANDTEO                 27130025
271400     MOVE ASC-EXT-CAN-DTE             TO AEXCDTEO                 27140025
271500     MOVE ASC-PO-STATUS-DESC          TO APOSTATO                 27150025
271600     MOVE ASC-DEPT-NBR                TO ADPTNBRO                 27160025
271700     MOVE ASC-DEPT-DESC               TO ADPTDSCO                 27170025
271800     MOVE ASC-BUYER-NAME              TO ABUYNMEO.                27180025
271900     MOVE ASC-OTB-NBR                 TO AOTBO.                   27190025
272000/                                                                 27200025
272100*----------------------------------------------------------------*27210025
272200* ADD A SHIPMENT                                                 *27220025
272300*----------------------------------------------------------------*27230025
272400 5000-ADD-SHIPMENT.                                               27240025
272500                                                                  27250025
272600     INITIALIZE DCLTSHPTPO.                                       27260025
272700                                                                  27270025
272800     MOVE ASC-KEY-SHIPT-ID       TO SHPTPO-SHIPT-ID.              27280025
272900     MOVE ASC-PO-NBR-N           TO SHPTPO-PO-NBR                 27290025
273000                                    DK-PO-NBR.                    27300025
273100                                                                  27310025
273200     MOVE ASC-EXPTED-CART-CNT-N  TO SHPTPO-EXPTED-CART-CNT.       27320025
273300     MOVE ASC-ACTL-CART-CNT-N    TO SHPTPO-ACTL-CART-CNT.         27330025
273400     MOVE ASC-DMG-CART-CNT-N     TO SHPTPO-DMG-CART-CNT.          27340025
273500     MOVE ASC-PKSL-IND           TO SHPTPO-PKSL-IND.              27350025
273600     IF  ASC-ACTIVE-PO                                            27360025
273700         MOVE SPACES             TO SHPTPO-VEND-NAME              27370025
273800     ELSE                                                         27380025
273900         MOVE ASC-VEND-NAME      TO SHPTPO-VEND-NAME              27390025
274000     END-IF.                                                      27400025
274100                                                                  27410025
274200     PERFORM 5020-INSERT-TSHPTPO.                                 27420025
274300                                                                  27430025
274400     PERFORM 5025-CHECK-VEHICLE-TYPE.                             27440025
274500                                                                  27450025
274600     IF PV-DB2-COUNT > ZERO                                       27460025
274700         PERFORM 5030-CHECK-TIMPORL-EXIST                         27470025
274800         IF SQLCODE = +100                                        27480025
274900             MOVE DK-PO-NBR           TO IMPORL-PO-NBR            27490025
275000             MOVE PC-1                TO IMPORL-VER-NBR           27500025
275100             MOVE PC-A                TO IMPORL-VER-STATUS-CDE    27510025
275200             MOVE PC-N                TO IMPORL-CONSLR-RLSE-CDE   27520025
275300                                         IMPORL-CSTM-BKR-RLSE-CDE 27530025
275400                                         IMPORL-TKT-PRTR-RLSE-CDE 27540025
275500                                         IMPORL-DCONSLR-RLSE-CDE  27550025
275600             MOVE PC-DFLT-IMPORL-DATE TO IMPORL-CONSLR-ACTL-DTE   27560025
275700                                         IMPORL-CONSLR-REQR-DTE   27570025
275800                                         IMPORL-CSTM-BKR-ACTL-DTE 27580025
275900                                         IMPORL-CSTM-BKR-REQR-DTE 27590025
276000                                         IMPORL-TKT-PRTR-ACTL-DTE 27600025
276100                                         IMPORL-TKT-PRTR-REQR-DTE 27610025
276200                                         IMPORL-DCONSLR-REQR-DTE  27620025
276300                                         IMPORL-DCONSLR-ACTL-DTE  27630025
276400             MOVE PC-DFLT-IMPORL-TIME TO IMPORL-CONSLR-ACTL-TM    27640025
276500                                         IMPORL-CSTM-BKR-ACTL-TM  27650025
276600                                         IMPORL-TKT-PRTR-ACTL-TM  27660025
276700                                         IMPORL-DCONSLR-ACTL-TM   27670025
276800             PERFORM 5035-ADD-TIMPORL                             27680025
276900         END-IF                                                   27690025
277000     END-IF.                                                      27700025
277100                                                                  27710025
277200     IF  (SQLCODE = +0 OR +100) AND PS-NO-ERROR                   27720025
277300         MOVE PC-TSYMSG-00034    TO DP020-MSG-NUMBER              27730025
277400         SET DP020-MSG-INFORMATIONAL                              27740025
277500             ASC-ADD-SUCCESSFUL  TO TRUE                          27750025
277600         IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                   27760025
277700            AND ASC-USE-SELECTION-QUEUE                           27770025
277800             PERFORM 5200-UPDATE-SELECTION-QUEUE                  27780025
277900         END-IF                                                   27790025
278000     END-IF.                                                      27800025
278100                                                                  27810025
278200/                                                                 27820025
278300                                                                  27830025
278400*----------------------------------------------------------------*27840025
278500*  DETERMINE PO TYPE CODE                                        *27850025
278600*----------------------------------------------------------------*27860025
278700 5005-DETERMINE-PO-TYP-CDE.                                       27870025
278800                                                                  27880025
278900     EXEC SQL                                                     27890025
279000         SELECT PO_TYP_CDE                                        27900025
279100          INTO :PV-PO-TYP-CDE                                     27910025
279200           FROM TPURCHS                                           27920025
279300          WHERE PO_NBR         = :DK-PO-NBR                       27930025
279400            AND VER_STATUS_CDE = :PC-A                            27940025
279500     END-EXEC                                                     27950025
279600                                                                  27960025
279700     EVALUATE TRUE                                                27970025
279800         WHEN SQLCODE = ZERO                                      27980025
279900             CONTINUE                                             27990025
280000                                                                  28000025
280100         WHEN SQLCODE = +100                                      28010025
280200             MOVE SPACES TO PV-PO-TYP-CDE                         28020025
280300                                                                  28030025
280400         WHEN SQLWARN0 NOT = SPACES                               28040025
280500         WHEN SQLCODE < ZERO                                      28050025
280600         WHEN SQLCODE > ZERO                                      28060025
280700             MOVE '5005-DETERMINE-PO-TYP-CDE'                     28070025
280800                               TO DP013-PARAGRAPH                 28080025
280900             MOVE 'SELECT TPURCHS'                                28090025
281000                               TO DP013-MESSAGE-TEXT (1)          28100025
281100             MOVE SQLCA        TO DP013-SQLCA                     28110025
281200             MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)        28120025
281300             SET DP013-DB2-ABEND                                  28130025
281400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               28140025
281500             PERFORM DP013-0000-PROCESS-ABEND                     28150025
281600     END-EVALUATE.                                                28160025
281700                                                                  28170025
281800*----------------------------------------------------------------*28180025
281900*  CHECK TO SEE IF DC CONTAINER SPLITS HAVE BEEN SENT            *28190025
282000*----------------------------------------------------------------*28200025
282100 5010-CHECK-FOR-CMN-SPLITS.                                       28210025
282200                                                                  28220025
282300     PERFORM 5030-CHECK-TIMPORL-EXIST.                            28230025
282400     IF SQLCODE = +0                                              28240025
282500         IF (IMPORL-DCONSLR-RLSE-CDE = PC-N) OR                   28250025
282600            (IMPORL-DCONSLR-RLSE-CDE = PC-D AND                   28260025
282700             IMPORL-DCONSLR-ACTL-DTE = PC-DEFAULT-DATE-9S)        28270025
282800            SET PS-TIMCNRL-EXISTS-NO TO TRUE                      28280025
282900            PERFORM 5040-CHECK-TIMCNRL-EXIST                      28290025
283000            IF PS-TIMCNRL-EXISTS                                  28300025
283100               SET PS-CMN-SPLITS-MSG TO TRUE                      28310025
283200               IF (IMCNRL-DCONSLR-RLSE-CDE = PC-Y OR PC-R)        28320025
283300                   PERFORM 5045-PROCESS-TSYMSG-2642-2539          28330025
283400               ELSE                                               28340025
283500                   IF (IMCNRL-DCONSLR-RLSE-CDE = PC-S OR PC-N     28350025
283600                       OR PC-D)                                   28360025
283700                      PERFORM 5050-PROCESS-TSYMSG-2641-2541       28370025
283800                   END-IF                                         28380025
283900               END-IF                                             28390025
284000            END-IF                                                28400025
284100         ELSE                                                     28410025
284200             SET PS-CMN-SPLITS-MSG-NO TO TRUE                     28420025
284300             SET ASC-LOCAL-01-NO-NEED-CONFIRM TO TRUE             28430025
284400         END-IF                                                   28440025
284500     ELSE                                                         28450025
284600         SET PS-CMN-SPLITS-MSG-NO TO TRUE                         28460025
284700         SET ASC-LOCAL-01-NO-NEED-CONFIRM TO TRUE                 28470025
284800     END-IF.                                                      28480025
284900                                                                  28490025
285000/                                                                 28500025
285100*----------------------------------------------------------------*28510025
285200*  INSERT A ROW ON THE TSHPTPO TABLE                             *28520025
285300*----------------------------------------------------------------*28530025
285400 5020-INSERT-TSHPTPO.                                             28540025
285500                                                                  28550025
285600     PERFORM                                                      28560025
285700         WITH TEST AFTER                                          28570025
285800         VARYING PV-RETRY-COUNTER                                 28580025
285900         FROM 1 BY 1                                              28590025
286000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28600025
286100             OR (SQLCODE = +0)                                    28610025
286200             OR (SQLCODE = -803))                                 28620025
286300                                                                  28630025
286400         EXEC SQL                                                 28640025
286500              INSERT INTO TSHPTPO                                 28650025
286600                     ( SHIPT_ID                                   28660025
286700                      ,PO_NBR                                     28670025
286800                      ,REC_SEQ_NBR                                28680025
286900                      ,EXPTED_CART_CNT                            28690025
287000                      ,ACTL_CART_CNT                              28700025
287100                      ,DMG_CART_CNT                               28710025
287200                      ,PKSL_IND                                   28720025
287300                      ,VEND_NAME                                  28730025
287400                      ,LAST_UPD_PGM_ID                            28740025
287500                      ,CRE_USER_ID                                28750025
287600                      ,LAST_UPD_USER_ID                           28760025
287700                      ,PRIM_SHIPT_IND                             28770025
287800                      ,SPLT_XMIT_IND                              28780025
287900                      ,SPLT_XMIT_DTE                              28790025
288000                      ,SPLT_XMIT_TM )                             28800025
288100              VALUES ( :SHPTPO-SHIPT-ID                           28810025
288200                      ,:SHPTPO-PO-NBR                             28820025
288300                      ,:SHPTPO-REC-SEQ-NBR                        28830025
288400                      ,:SHPTPO-EXPTED-CART-CNT                    28840025
288500                      ,:SHPTPO-ACTL-CART-CNT                      28850025
288600                      ,:SHPTPO-DMG-CART-CNT                       28860025
288700                      ,:SHPTPO-PKSL-IND                           28870025
288800                      ,:SHPTPO-VEND-NAME                          28880025
288900                      ,:PC-CURRENT-PROGRAM-NAME                   28890025
289000                      ,:DP020-USERID                              28900025
289100                      ,:SHPTPO-LAST-UPD-USER-ID                   28910025
289200                      ,:PC-Y                                      28920025
289300                      ,:SHPTPO-SPLT-XMIT-IND                      28930025
289400                      ,:PC-DEFAULT-DATE                           28940025
289500                      ,:PC-DEFAULT-TIME )                         28950025
289600         END-EXEC                                                 28960025
289700                                                                  28970025
289800         EVALUATE TRUE                                            28980025
289900             WHEN SQLCODE = +0                                    28990025
290000                 CONTINUE                                         29000025
290100                                                                  29010025
290200             WHEN SQLCODE = -803                                  29020025
290300                 SET PS-ERROR           TO TRUE                   29030025
290400                 SET DP020-MSG-FATAL    TO TRUE                   29040025
290500                 MOVE PC-TSYMSG-00117   TO DP020-MSG-NUMBER       29050025
290600                 MOVE DP015-UNP-ALP-BRT-OFF                       29060025
290700                                        TO APONBRA                29070025
290800                 MOVE DP015-RED         TO APONBRC                29080025
290900                 MOVE DP015-REVERSE     TO APONBRH                29090025
291000                 MOVE -1                TO APONBRL                29100025
291100                 SET DP030-SET-CURSOR-APPL-1                      29110025
291200                                        TO TRUE                   29120025
291300                                                                  29130025
291400             WHEN SQLCODE = -904                                  29140025
291500             WHEN SQLCODE = -913                                  29150025
291600                 CONTINUE                                         29160025
291700                                                                  29170025
291800             WHEN SQLWARN0 NOT = SPACES                           29180025
291900             WHEN SQLCODE < +0                                    29190025
292000             WHEN SQLCODE > +0                                    29200025
292100                 MOVE '5020-INSERT-TSHPTPO'                       29210025
292200                                   TO DP013-PARAGRAPH             29220025
292300                 MOVE 'INSERT A ROW ON TSHPTPO'                   29230025
292400                                   TO DP013-MESSAGE-TEXT(1)       29240025
292500                 MOVE SQLCA        TO DP013-SQLCA                 29250025
292600                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    29260025
292700                 SET DP013-DB2-ABEND                              29270025
292800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           29280025
292900                 PERFORM DP013-0000-PROCESS-ABEND                 29290025
293000         END-EVALUATE                                             29300025
293100     END-PERFORM.                                                 29310025
293200                                                                  29320025
293300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    29330025
293400         SQLCODE NOT = +0                                         29340025
293500         MOVE '5020-INSERT-TSHPTPO'                               29350025
293600                                   TO DP013-PARAGRAPH             29360025
293700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              29370025
293800                                   TO DP013-MESSAGE-TEXT (1)      29380025
293900         MOVE 'TO INSERT A TSHPTPO ROW'                           29390025
294000                                   TO DP013-MESSAGE-TEXT (2)      29400025
294100         MOVE SQLCA                TO DP013-SQLCA                 29410025
294200         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    29420025
294300         SET DP013-DB2-ABEND                                      29430025
294400             DP013-XCTL-DISPLAY-RESTART                           29440025
294500                                   TO TRUE                        29450025
294600         PERFORM DP013-0000-PROCESS-ABEND                         29460025
294700     END-IF.                                                      29470025
294800                                                                  29480025
294900     EVALUATE TRUE                                                29490025
295000        WHEN SQLCODE = +0                                         29500025
295100             MOVE PC-A             TO PV-TRN-CDE                  29510025
295200             PERFORM 5100-CREATE-TAUSHPO THRU 5100-EXIT           29520025
295300     END-EVALUATE.                                                29530025
295400     EJECT                                                        29540025
295500/                                                                 29550025
295600*----------------------------------------------------------------*29560025
295700*  CHECK TVEHICL FOR VEHICLE TYPE OF 'VS' OR 'AV' (VESSEL OR AIR) 29570025
295800*----------------------------------------------------------------*29580025
295900 5025-CHECK-VEHICLE-TYPE.                                         29590025
296000                                                                  29600025
296100     INITIALIZE PV-DB2-COUNT                                      29610025
296200     EXEC SQL                                                     29620025
296300         SELECT COUNT(*)                                          29630025
296400         INTO :PV-DB2-COUNT                                       29640025
296500         FROM                                                     29650025
296600                TSHIPMT A                                         29660025
296700             ,  TVHTRIP B                                         29670025
296800             ,  TVEHICL C                                         29680025
296900          WHERE                                                   29690025
297000                 A.SHIPT_ID                = :DK-SHIPT-ID         29700025
297100             AND A.TRIP_ID                 = B.TRIP_ID            29710025
297200             AND (B.OWNER_SCAC_ID          = C.OWNER_SCAC_ID      29720025
297300                  AND  B.VEH_NBR           = C.VEH_NBR)           29730025
297400             AND C.VEH_TYP_CDE             IN (:PC-VS, :PC-AV)    29740025
297500     END-EXEC                                                     29750025
297600                                                                  29760025
297700         EVALUATE TRUE                                            29770025
297800             WHEN SQLCODE = ZERO                                  29780025
297900                 CONTINUE                                         29790025
298000                                                                  29800025
298100             WHEN SQLWARN0 NOT = SPACES                           29810025
298200             WHEN SQLCODE < +0                                    29820025
298300             WHEN SQLCODE > +0                                    29830025
298400                 MOVE '5025-CHECK-VEHICLE-TYPE'                   29840025
298500                                   TO DP013-PARAGRAPH             29850025
298600                 MOVE 'COUNTING IMPORT VEHICLES FOR TRIP'         29860025
298700                                   TO DP013-MESSAGE-TEXT(1)       29870025
298800                 MOVE SQLCA        TO DP013-SQLCA                 29880025
298900                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    29890025
299000                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (2)    29900025
299100                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (3)    29910025
299200                 SET DP013-DB2-ABEND                              29920025
299300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           29930025
299400                 PERFORM DP013-0000-PROCESS-ABEND                 29940025
299500     END-EVALUATE.                                                29950025
299600/                                                                 29960025
299700*----------------------------------------------------------------*29970025
299800*  CHECK FOR TIMPORL ROW.                                         29980025
299900*----------------------------------------------------------------*29990025
300000                                                                  30000025
300100 5030-CHECK-TIMPORL-EXIST.                                        30010025
300200                                                                  30020025
300300     EXEC SQL                                                     30030025
300400         SELECT PO_NBR                                            30040025
300500              , VER_NBR                                           30050025
300600              , VER_STATUS_CDE                                    30060025
300700              , CONSLR_RLSE_CDE                                   30070025
300800              , CONSLR_REQR_DTE                                   30080025
300900              , CONSLR_ACTL_DTE                                   30090025
301000              , CONSLR_ACTL_TM                                    30100025
301100              , CSTM_BKR_RLSE_CDE                                 30110025
301200              , CSTM_BKR_REQR_DTE                                 30120025
301300              , CSTM_BKR_ACTL_DTE                                 30130025
301400              , CSTM_BKR_ACTL_TM                                  30140025
301500              , TKT_PRTR_RLSE_CDE                                 30150025
301600              , TKT_PRTR_REQR_DTE                                 30160025
301700              , TKT_PRTR_ACTL_DTE                                 30170025
301800              , TKT_PRTR_ACTL_TM                                  30180025
301900              , DCONSLR_RLSE_CDE                                  30190025
302000              , DCONSLR_REQR_DTE                                  30200025
302100              , DCONSLR_ACTL_DTE                                  30210025
302200              , DCONSLR_ACTL_TM                                   30220025
302300              , LAST_UPD_TMST                                     30230025
302400              , LAST_UPD_BY_UID                                   30240025
302500           INTO :IMPORL-PO-NBR                                    30250025
302600              , :IMPORL-VER-NBR                                   30260025
302700              , :IMPORL-VER-STATUS-CDE                            30270025
302800              , :IMPORL-CONSLR-RLSE-CDE                           30280025
302900              , :IMPORL-CONSLR-REQR-DTE                           30290025
303000              , :IMPORL-CONSLR-ACTL-DTE                           30300025
303100              , :IMPORL-CONSLR-ACTL-TM                            30310025
303200              , :IMPORL-CSTM-BKR-RLSE-CDE                         30320025
303300              , :IMPORL-CSTM-BKR-REQR-DTE                         30330025
303400              , :IMPORL-CSTM-BKR-ACTL-DTE                         30340025
303500              , :IMPORL-CSTM-BKR-ACTL-TM                          30350025
303600              , :IMPORL-TKT-PRTR-RLSE-CDE                         30360025
303700              , :IMPORL-TKT-PRTR-REQR-DTE                         30370025
303800              , :IMPORL-TKT-PRTR-ACTL-DTE                         30380025
303900              , :IMPORL-TKT-PRTR-ACTL-TM                          30390025
304000              , :IMPORL-DCONSLR-RLSE-CDE                          30400025
304100              , :IMPORL-DCONSLR-REQR-DTE                          30410025
304200              , :IMPORL-DCONSLR-ACTL-DTE                          30420025
304300              , :IMPORL-DCONSLR-ACTL-TM                           30430025
304400              , :IMPORL-LAST-UPD-TMST                             30440025
304500              , :IMPORL-LAST-UPD-BY-UID                           30450025
304600         FROM   TIMPORL                                           30460025
304700         WHERE PO_NBR = :DK-PO-NBR                                30470025
304800           AND VER_STATUS_CDE = 'A'                               30480025
304900     END-EXEC                                                     30490025
305000                                                                  30500025
305100     EVALUATE TRUE                                                30510025
305200         WHEN SQLCODE = ZERO                                      30520025
305300         WHEN SQLCODE = +100                                      30530025
305400             CONTINUE                                             30540025
305500         WHEN SQLWARN0 NOT = SPACES                               30550025
305600         WHEN SQLCODE < ZERO                                      30560025
305700         WHEN SQLCODE > ZERO                                      30570025
305800             MOVE '5030-CHECK-TIMPORL-EXIST'                      30580025
305900                               TO DP013-PARAGRAPH                 30590025
306000             MOVE 'SELECT IMPORL'                                 30600025
306100                               TO DP013-MESSAGE-TEXT (1)          30610025
306200             MOVE SQLCA        TO DP013-SQLCA                     30620025
306300             MOVE 'TIMPORL'    TO DP013-DB2-TABLE-NAME (1)        30630025
306400             SET DP013-DB2-ABEND                                  30640025
306500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30650025
306600             PERFORM DP013-0000-PROCESS-ABEND                     30660025
306700     END-EVALUATE.                                                30670025
306800                                                                  30680025
306900*----------------------------------------------------------------*30690025
307000*  INSERT THE PO TO THE TIMPORL, IMPORT PO RELEASE TABLE          30700025
307100*----------------------------------------------------------------*30710025
307200                                                                  30720025
307300 5035-ADD-TIMPORL.                                                30730025
307400                                                                  30740025
307500         EXEC SQL                                                 30750025
307600             INSERT INTO TIMPORL                                  30760025
307700                   (PO_NBR                                        30770025
307800                  , VER_NBR                                       30780025
307900                  , VER_STATUS_CDE                                30790025
308000                  , CONSLR_RLSE_CDE                               30800025
308100                  , CONSLR_REQR_DTE                               30810025
308200                  , CONSLR_ACTL_DTE                               30820025
308300                  , CONSLR_ACTL_TM                                30830025
308400                  , CSTM_BKR_RLSE_CDE                             30840025
308500                  , CSTM_BKR_REQR_DTE                             30850025
308600                  , CSTM_BKR_ACTL_DTE                             30860025
308700                  , CSTM_BKR_ACTL_TM                              30870025
308800                  , TKT_PRTR_RLSE_CDE                             30880025
308900                  , TKT_PRTR_REQR_DTE                             30890025
309000                  , TKT_PRTR_ACTL_DTE                             30900025
309100                  , TKT_PRTR_ACTL_TM                              30910025
309200                  , DCONSLR_RLSE_CDE                              30920025
309300                  , DCONSLR_REQR_DTE                              30930025
309400                  , DCONSLR_ACTL_DTE                              30940025
309500                  , DCONSLR_ACTL_TM                               30950025
309600                  , LAST_UPD_TMST                                 30960025
309700                  , LAST_UPD_BY_UID)                              30970025
309800            VALUES (:IMPORL-PO-NBR                                30980025
309900                  , :IMPORL-VER-NBR                               30990025
310000                  , :IMPORL-VER-STATUS-CDE                        31000025
310100                  , :IMPORL-CONSLR-RLSE-CDE                       31010025
310200                  , :IMPORL-CONSLR-REQR-DTE                       31020025
310300                  , :IMPORL-CONSLR-ACTL-DTE                       31030025
310400                  , :IMPORL-CONSLR-ACTL-TM                        31040025
310500                  , :IMPORL-CSTM-BKR-RLSE-CDE                     31050025
310600                  , :IMPORL-CSTM-BKR-REQR-DTE                     31060025
310700                  , :IMPORL-CSTM-BKR-ACTL-DTE                     31070025
310800                  , :IMPORL-CSTM-BKR-ACTL-TM                      31080025
310900                  , :IMPORL-TKT-PRTR-RLSE-CDE                     31090025
311000                  , :IMPORL-TKT-PRTR-REQR-DTE                     31100025
311100                  , :IMPORL-TKT-PRTR-ACTL-DTE                     31110025
311200                  , :IMPORL-TKT-PRTR-ACTL-TM                      31120025
311300                  , :IMPORL-DCONSLR-RLSE-CDE                      31130025
311400                  , :IMPORL-DCONSLR-REQR-DTE                      31140025
311500                  , :IMPORL-DCONSLR-ACTL-DTE                      31150025
311600                  , :IMPORL-DCONSLR-ACTL-TM                       31160025
311700                  , CURRENT TIMESTAMP                             31170025
311800                  , :DP020-USERID)                                31180025
311900         END-EXEC                                                 31190025
312000                                                                  31200025
312100         EVALUATE TRUE                                            31210025
312200             WHEN SQLCODE = ZERO                                  31220025
312300                 CONTINUE                                         31230025
312400             WHEN SQLWARN0 NOT = SPACES                           31240025
312500             WHEN SQLCODE < ZERO                                  31250025
312600             WHEN SQLCODE > ZERO                                  31260025
312700                 MOVE '5035-ADD-TIMPORL'                          31270025
312800                                   TO DP013-PARAGRAPH             31280025
312900                 MOVE 'INSERT IMPORL'                             31290025
313000                                   TO DP013-MESSAGE-TEXT (1)      31300025
313100                 MOVE SQLCA        TO DP013-SQLCA                 31310025
313200                 MOVE 'TIMPORL'    TO DP013-DB2-TABLE-NAME (1)    31320025
313300                 SET DP013-DB2-ABEND                              31330025
313400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           31340025
313500                 PERFORM DP013-0000-PROCESS-ABEND                 31350025
313600         END-EVALUATE.                                            31360025
313700                                                                  31370025
313800*----------------------------------------------------------------*31380025
313900*  CHECK FOR TIMCNRL ROW.                                         31390025
314000*----------------------------------------------------------------*31400025
314100 5040-CHECK-TIMCNRL-EXIST.                                        31410025
314200                                                                  31420025
314300     EXEC SQL                                                     31430025
314400         SELECT CONTNR_ID,                                        31440025
314500                CONTNR_SEQ_NBR,                                   31450025
314600                PO_NBR,                                           31460025
314700                DCONSLR_RLSE_CDE,                                 31470025
314800                DCONSLR_REQR_DTE,                                 31480025
314900                DCONSLR_ACTL_DTE,                                 31490025
315000                DCONSLR_ACTL_TM,                                  31500025
315100                CRE_TMST,                                         31510025
315200                CRE_BY_UID,                                       31520025
315300                LAST_UPD_BY_UID,                                  31530025
315400                LAST_UPD_TMST                                     31540025
315500          INTO :IMCNRL-CONTNR-ID,                                 31550025
315600               :IMCNRL-CONTNR-SEQ-NBR,                            31560025
315700               :IMCNRL-PO-NBR,                                    31570025
315800               :IMCNRL-DCONSLR-RLSE-CDE,                          31580025
315900               :IMCNRL-DCONSLR-REQR-DTE,                          31590025
316000               :IMCNRL-DCONSLR-ACTL-DTE,                          31600025
316100               :IMCNRL-DCONSLR-ACTL-TM,                           31610025
316200               :IMCNRL-CRE-TMST,                                  31620025
316300               :IMCNRL-CRE-BY-UID,                                31630025
316400               :IMCNRL-LAST-UPD-BY-UID,                           31640025
316500               :IMCNRL-LAST-UPD-TMST                              31650025
316600           FROM TIMCNRL                                           31660025
316700          WHERE CONTNR_ID        = :ASC-KEY-PRO-NBR               31670025
316800            AND PO_NBR           = :DK-PO-NBR                     31680025
316900     END-EXEC                                                     31690025
317000                                                                  31700025
317100     EVALUATE TRUE                                                31710025
317200         WHEN SQLCODE = ZERO                                      31720025
317300         WHEN SQLCODE = -811                                      31730025
317400             SET PS-TIMCNRL-EXISTS TO TRUE                        31740025
317500                                                                  31750025
317600         WHEN SQLCODE = +100                                      31760025
317700             SET PS-TIMCNRL-EXISTS-NO TO TRUE                     31770025
317800                                                                  31780025
317900         WHEN SQLWARN0 NOT = SPACES                               31790025
318000         WHEN SQLCODE < ZERO                                      31800025
318100         WHEN SQLCODE > ZERO                                      31810025
318200             MOVE '5040-CHECK-TIMCNRL-EXIST'                      31820025
318300                               TO DP013-PARAGRAPH                 31830025
318400             MOVE 'SELECT IMCNRL'                                 31840025
318500                               TO DP013-MESSAGE-TEXT (1)          31850025
318600             MOVE SQLCA        TO DP013-SQLCA                     31860025
318700             MOVE 'TIMCNRL'    TO DP013-DB2-TABLE-NAME (1)        31870025
318800             SET DP013-DB2-ABEND                                  31880025
318900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               31890025
319000             PERFORM DP013-0000-PROCESS-ABEND                     31900025
319100     END-EVALUATE.                                                31910025
319200                                                                  31920025
319300*----------------------------------------------------------------*31930025
319400*  PROCESS DC CONTAINER SPLITS ERROR MESSAGES 2642 AND 2539.     *31940025
319500*----------------------------------------------------------------*31950025
319600 5045-PROCESS-TSYMSG-2642-2539.                                   31960025
319700                                                                  31970025
319800     SET PS-TIMCNPO-EXISTS-NO TO TRUE.                            31980025
319900     PERFORM 5080-CHECK-TIMCNPO-EXIST.                            31990025
320000     IF PS-TIMCNPO-EXISTS                                         32000025
320100         MOVE +0 TO PV-TIMCNPO-COUNT                              32010025
320200         PERFORM 5052-COUNT-TIMCNPO-ROWS                          32020025
320300         IF PV-TIMCNPO-COUNT > +0                                 32030025
320400             PERFORM 5055-OPEN-PO-CONTNR-CSR                      32040025
320500             SET PS-TIMCNPO-ROW-2-EXISTS-NO TO TRUE               32050025
320600             PERFORM 5060-PROCESS-PO-CONTNR-CSR                   32060025
320700                 UNTIL PS-EOC-PO-CONTNR-CSR                       32070025
320800             SET PS-EOC-PO-CONTNR-CSR-NO TO TRUE                  32080025
320900         ELSE                                                     32090025
321000             SET ASC-LOCAL-01-NEED-CONFIRM TO TRUE                32100025
321100             SET PS-CMN-SPLITS-MSG TO TRUE                        32110025
321200             MOVE PC-TSYMSG-02539 TO DP020-MSG-NUMBER             32120025
321300             SET DP020-MSG-WARNING TO TRUE                        32130025
321400         END-IF                                                   32140025
321500     END-IF.                                                      32150025
321600                                                                  32160025
321700*----------------------------------------------------------------*32170025
321800*  PROCESS DC CONTAINER SPLITS ERROR MESSAGES 2641 AND 2541.     *32180025
321900*----------------------------------------------------------------*32190025
322000 5050-PROCESS-TSYMSG-2641-2541.                                   32200025
322100                                                                  32210025
322200     SET PS-TIMCNPO-EXISTS-NO TO TRUE.                            32220025
322300     PERFORM 5080-CHECK-TIMCNPO-EXIST.                            32230025
322400     IF PS-TIMCNPO-EXISTS                                         32240025
322500         MOVE +0 TO PV-TIMCNPO-COUNT                              32250025
322600         PERFORM 5052-COUNT-TIMCNPO-ROWS                          32260025
322700         IF PV-TIMCNPO-COUNT > +0                                 32270025
322800             PERFORM 5055-OPEN-PO-CONTNR-CSR                      32280025
322900             SET PS-TIMCNPO-ROW-2-EXISTS-NO TO TRUE               32290025
323000             PERFORM 5062-PROCESS-PO-CONTNR-CSR-2                 32300025
323100                 UNTIL PS-EOC-PO-CONTNR-CSR                       32310025
323200             SET PS-EOC-PO-CONTNR-CSR-NO TO TRUE                  32320025
323300         ELSE                                                     32330025
323400             SET ASC-LOCAL-01-NEED-CONFIRM TO TRUE                32340025
323500             SET PS-CMN-SPLITS-MSG TO TRUE                        32350025
323600             MOVE PC-TSYMSG-02541 TO DP020-MSG-NUMBER             32360025
323700             SET DP020-MSG-WARNING TO TRUE                        32370025
323800         END-IF                                                   32380025
323900     END-IF.                                                      32390025
324000                                                                  32400025
324100******************************************************************32410025
324200*  COUNT TIMCNPO ROWS.                                           *32420025
324300******************************************************************32430025
324400 5052-COUNT-TIMCNPO-ROWS.                                         32440025
324500                                                                  32450025
324600     EXEC SQL                                                     32460025
324700         SELECT                                                   32470025
324800               COUNT(DISTINCT CONTNR_ID)                          32480025
324900         INTO   :PV-TIMCNPO-COUNT                                 32490025
325000         FROM   TIMCNPO                                           32500025
325100         WHERE  PO_NBR         =  :IMCNPO-PO-NBR                  32510025
325200           AND  CONTNR_ID      <> :IMCNPO-CONTNR-ID               32520025
325300     END-EXEC.                                                    32530025
325400                                                                  32540025
325500     EVALUATE TRUE                                                32550025
325600         WHEN SQLCODE = ZERO                                      32560025
325700         WHEN SQLCODE = +100                                      32570025
325800              CONTINUE                                            32580025
325900         WHEN SQLWARN0 NOT = SPACE                                32590025
326000         WHEN SQLCODE NOT = ZERO                                  32600025
326100              MOVE '5052-COUNT-TIMCNPO-ROWS'                      32610025
326200                               TO DP013-PARAGRAPH                 32620025
326300              MOVE 'SQL ERROR SELECTING PO COUNT'                 32630025
326400                               TO DP013-MESSAGE-TEXT (1)          32640025
326500              MOVE SQLCA       TO DP013-SQLCA                     32650025
326600              SET DP013-DB2-ABEND                                 32660025
326700                               TO TRUE                            32670025
326800              PERFORM DP013-0000-PROCESS-ABEND                    32680025
326900     END-EVALUATE.                                                32690025
327000                                                                  32700025
327100******************************************************************32710025
327200* OPEN THE PO CONTAINER CUSROR.                                  *32720025
327300******************************************************************32730025
327400 5055-OPEN-PO-CONTNR-CSR.                                         32740025
327500                                                                  32750025
327600     PERFORM                                                      32760025
327700         WITH TEST AFTER                                          32770025
327800         VARYING PV-RETRY-COUNTER                                 32780025
327900         FROM 1 BY 1                                              32790025
328000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               32800025
328100            OR (SQLCODE = +0))                                    32810025
328200                                                                  32820025
328300         EXEC SQL                                                 32830025
328400              OPEN PO_CONTNR_CSR                                  32840025
328500         END-EXEC                                                 32850025
328600                                                                  32860025
328700         EVALUATE TRUE                                            32870025
328800             WHEN SQLCODE = +0                                    32880025
328900                  CONTINUE                                        32890025
329000             WHEN SQLCODE = -904                                  32900025
329100             WHEN SQLCODE = -913                                  32910025
329200                  CONTINUE                                        32920025
329300             WHEN SQLWARN0 NOT = SPACE                            32930025
329400             WHEN SQLCODE  NOT = +0                               32940025
329500                  MOVE '5055-OPEN-PO-CONTNR-CSR'                  32950025
329600                                   TO DP013-PARAGRAPH             32960025
329700                  MOVE 'OPEN PO CONTNR CSR'                       32970025
329800                                   TO DP013-MESSAGE-TEXT (1)      32980025
329900                  MOVE IMCNRL-PO-NBR TO DP013-MESSAGE-TEXT (2)    32990025
330000                  MOVE SQLCA       TO DP013-SQLCA                 33000025
330100                  MOVE 'TIMCNPO'   TO DP013-DB2-TABLE-NAME (1)    33010025
330200                  SET DP013-DB2-ABEND                             33020025
330300                                   TO TRUE                        33030025
330400                  PERFORM DP013-0000-PROCESS-ABEND                33040025
330500         END-EVALUATE                                             33050025
330600     END-PERFORM.                                                 33060025
330700                                                                  33070025
330800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    33080025
330900         SQLCODE NOT = +0                                         33090025
331000         MOVE '5055-OPEN-PO-CONTNR-CSR' TO DP013-PARAGRAPH        33100025
331100         MOVE 'MAX RETRIES EXCEEDED FOR OPEN PO CONTNR CURSOR'    33110025
331200                                   TO DP013-MESSAGE-TEXT (1)      33120025
331300         MOVE SQLCA                TO DP013-SQLCA                 33130025
331400         SET DP013-DB2-ABEND       TO TRUE                        33140025
331500         PERFORM DP013-0000-PROCESS-ABEND                         33150025
331600     END-IF.                                                      33160025
331700                                                                  33170025
331800******************************************************************33180025
331900* PROCESS THE PO CONTAINER CURSOR.                               *33190025
332000******************************************************************33200025
332100 5060-PROCESS-PO-CONTNR-CSR.                                      33210025
332200                                                                  33220025
332300     PERFORM 5070-FETCH-PO-CONTNR-CSR.                            33230025
332400                                                                  33240025
332500     IF PS-EOC-PO-CONTNR-CSR                                      33250025
332600         PERFORM 5065-CLOSE-PO-CONTNR-CURSOR                      33260025
332700     ELSE                                                         33270025
332800         SET PS-SHPTPO-SHIPMT-FOUND-NO TO TRUE                    33280025
332900         PERFORM 5075-CHECK-SHPTPO-SHIPMT                         33290025
333000         IF PS-SHPTPO-SHIPMT-FOUND                                33300025
333100             SET PS-CMN-SPLITS-MSG TO TRUE                        33310025
333200             SET ASC-LOCAL-01-NEED-CONFIRM TO TRUE                33320025
333300             MOVE PC-TSYMSG-02539 TO DP020-MSG-NUMBER             33330025
333400             SET DP020-MSG-WARNING TO TRUE                        33340025
333500         ELSE                                                     33350025
333600             SET PS-CMN-SPLITS-MSG TO TRUE                        33360025
333700             SET ASC-LOCAL-01-NEED-CONFIRM TO TRUE                33370025
333800             MOVE PC-TSYMSG-02642 TO DP020-MSG-NUMBER             33380025
333900             SET DP020-MSG-WARNING TO TRUE                        33390025
334000         END-IF                                                   33400025
334100     END-IF.                                                      33410025
334200                                                                  33420025
334300******************************************************************33430025
334400* PROCESS THE PO CONTAINER CURSOR.                               *33440025
334500******************************************************************33450025
334600 5062-PROCESS-PO-CONTNR-CSR-2.                                    33460025
334700                                                                  33470025
334800     PERFORM 5070-FETCH-PO-CONTNR-CSR.                            33480025
334900                                                                  33490025
335000     IF PS-EOC-PO-CONTNR-CSR                                      33500025
335100         PERFORM 5065-CLOSE-PO-CONTNR-CURSOR                      33510025
335200     ELSE                                                         33520025
335300         SET PS-SHPTPO-SHIPMT-FOUND-NO TO TRUE                    33530025
335400         PERFORM 5075-CHECK-SHPTPO-SHIPMT                         33540025
335500         IF PS-SHPTPO-SHIPMT-FOUND                                33550025
335600             SET PS-CMN-SPLITS-MSG TO TRUE                        33560025
335700             SET ASC-LOCAL-01-NEED-CONFIRM TO TRUE                33570025
335800             MOVE PC-TSYMSG-02541 TO DP020-MSG-NUMBER             33580025
335900             SET DP020-MSG-WARNING TO TRUE                        33590025
336000         ELSE                                                     33600025
336100             SET PS-CMN-SPLITS-MSG TO TRUE                        33610025
336200             SET ASC-LOCAL-01-NEED-CONFIRM TO TRUE                33620025
336300             MOVE PC-TSYMSG-02641 TO DP020-MSG-NUMBER             33630025
336400             SET DP020-MSG-WARNING TO TRUE                        33640025
336500         END-IF                                                   33650025
336600     END-IF.                                                      33660025
336700                                                                  33670025
336800*----------------------------------------------------------------*33680025
336900*   CLOSE THE PO CONTAINER CURSOR.                               *33690025
337000*----------------------------------------------------------------*33700025
337100 5065-CLOSE-PO-CONTNR-CURSOR.                                     33710025
337200                                                                  33720025
337300     EXEC SQL                                                     33730025
337400          CLOSE PO_CONTNR_CSR                                     33740025
337500     END-EXEC                                                     33750025
337600                                                                  33760025
337700*                                                                 33770025
337800     EVALUATE TRUE                                                33780025
337900         WHEN SQLCODE = ZERO                                      33790025
338000             CONTINUE                                             33800025
338100         WHEN SQLWARN0 NOT = SPACES                               33810025
338200         WHEN SQLCODE < ZERO                                      33820025
338300         WHEN SQLCODE > ZERO                                      33830025
338400             MOVE '5060-CLOSE-PO-CONTNR-CSR'                      33840025
338500                               TO DP013-PARAGRAPH                 33850025
338600             MOVE 'CLOSE PO CONTNR CURSOR'                        33860025
338700                               TO DP013-MESSAGE-TEXT (1)          33870025
338800             MOVE SQLCA        TO DP013-SQLCA                     33880025
338900             MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)        33890025
339000             SET DP013-DB2-ABEND                                  33900025
339100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               33910025
339200             PERFORM DP013-0000-PROCESS-ABEND                     33920025
339300     END-EVALUATE.                                                33930025
339400                                                                  33940025
339500 EJECT                                                            33950025
339600                                                                  33960025
339700*----------------------------------------------------------------*33970025
339800*   FETCH THE PO CONTAINER CURSOR.                               *33980025
339900*----------------------------------------------------------------*33990025
340000 5070-FETCH-PO-CONTNR-CSR.                                        34000025
340100                                                                  34010025
340200     EXEC SQL                                                     34020025
340300          FETCH PO_CONTNR_CSR                                     34030025
340400          INTO :PV-IMCNPO-PO-NBR                                  34040025
340500              ,:PV-IMCNPO-CONTNR-ID                               34050025
340600     END-EXEC                                                     34060025
340700                                                                  34070025
340800     EVALUATE TRUE                                                34080025
340900         WHEN SQLCODE = +0                                        34090025
341000              SET PS-EOC-PO-CONTNR-CSR-NO TO TRUE                 34100025
341100                                                                  34110025
341200         WHEN SQLCODE = +100                                      34120025
341300              SET PS-EOC-PO-CONTNR-CSR    TO TRUE                 34130025
341400                                                                  34140025
341500         WHEN SQLWARN0 NOT = SPACE                                34150025
341600         WHEN SQLCODE < +0                                        34160025
341700         WHEN SQLCODE > +0                                        34170025
341800              MOVE '5070-FETCH-PO-CONTNR-CSR'                     34180025
341900                                   TO DP013-PARAGRAPH             34190025
342000              MOVE 'FETCH PO CONTNR CURSOR'                       34200025
342100                                   TO DP013-MESSAGE-TEXT (1)      34210025
342200              MOVE IMCNRL-PO-NBR                                  34220025
342300                                   TO DP013-MESSAGE-TEXT (2)      34230025
342400              MOVE SQLCA           TO DP013-SQLCA                 34240025
342500              MOVE 'TIMCNPO'       TO DP013-DB2-TABLE-NAME (1)    34250025
342600              SET DP013-DB2-ABEND  TO TRUE                        34260025
342700              PERFORM DP013-0000-PROCESS-ABEND                    34270025
342800     END-EVALUATE.                                                34280025
342900                                                                  34290025
343000*----------------------------------------------------------------*34300025
343100*  CHECK FOR TSHPTPO/TSHIPMT ROW.                                 34310025
343200*----------------------------------------------------------------*34320025
343300 5075-CHECK-SHPTPO-SHIPMT.                                        34330025
343400                                                                  34340025
343500     EXEC SQL                                                     34350025
343600         SELECT A.PO_NBR                                          34360025
343700           INTO :PV-SHPTPO-PO-NBR                                 34370025
343800           FROM                                                   34380025
343900                TSHPTPO  A                                        34390025
344000               ,TSHIPMT  B                                        34400025
344100          WHERE A.PO_NBR          = :PV-IMCNPO-PO-NBR             34410025
344200            AND B.PRO_NBR         = :PV-IMCNPO-CONTNR-ID          34420025
344300            AND A.SHIPT_ID        = B.SHIPT_ID                    34430025
344400     END-EXEC                                                     34440025
344500                                                                  34450025
344600     EVALUATE TRUE                                                34460025
344700         WHEN SQLCODE = ZERO                                      34470025
344800         WHEN SQLCODE = -811                                      34480025
344900             SET PS-SHPTPO-SHIPMT-FOUND TO TRUE                   34490025
345000                                                                  34500025
345100         WHEN SQLCODE = +100                                      34510025
345200             SET PS-SHPTPO-SHIPMT-FOUND-NO TO TRUE                34520025
345300                                                                  34530025
345400         WHEN SQLWARN0 NOT = SPACES                               34540025
345500         WHEN SQLCODE < ZERO                                      34550025
345600         WHEN SQLCODE > ZERO                                      34560025
345700             MOVE '5075-CHECK-SHPTPO-SHIPMT'                      34570025
345800                               TO DP013-PARAGRAPH                 34580025
345900             MOVE 'SELECT SHPTPO/SHIPMT'                          34590025
346000                               TO DP013-MESSAGE-TEXT (1)          34600025
346100             MOVE SQLCA        TO DP013-SQLCA                     34610025
346200             MOVE 'SHIPMT'     TO DP013-DB2-TABLE-NAME (1)        34620025
346300             SET DP013-DB2-ABEND                                  34630025
346400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               34640025
346500             PERFORM DP013-0000-PROCESS-ABEND                     34650025
346600     END-EVALUATE.                                                34660025
346700                                                                  34670025
346800*----------------------------------------------------------------*34680025
346900*  CHECK FOR TIMCNPO ROW.                                         34690025
347000*----------------------------------------------------------------*34700025
347100 5080-CHECK-TIMCNPO-EXIST.                                        34710025
347200                                                                  34720025
347300     EXEC SQL                                                     34730025
347400         SELECT CONTNR_ID,                                        34740025
347500                PO_NBR                                            34750025
347600          INTO :IMCNPO-CONTNR-ID,                                 34760025
347700               :IMCNPO-PO-NBR                                     34770025
347800           FROM TIMCNPO                                           34780025
347900          WHERE CONTNR_ID        = :IMCNRL-CONTNR-ID              34790025
348000            AND PO_NBR           = :IMCNRL-PO-NBR                 34800025
348100     END-EXEC                                                     34810025
348200                                                                  34820025
348300     EVALUATE TRUE                                                34830025
348400         WHEN SQLCODE = ZERO                                      34840025
348500             SET PS-TIMCNPO-EXISTS TO TRUE                        34850025
348600                                                                  34860025
348700         WHEN SQLCODE = +100                                      34870025
348800             SET PS-TIMCNPO-EXISTS-NO TO TRUE                     34880025
348900                                                                  34890025
349000         WHEN SQLWARN0 NOT = SPACES                               34900025
349100         WHEN SQLCODE < ZERO                                      34910025
349200         WHEN SQLCODE > ZERO                                      34920025
349300             MOVE '5080-CHECK-TIMCNPO-EXIST'                      34930025
349400                               TO DP013-PARAGRAPH                 34940025
349500             MOVE 'SELECT TIMCNPO'                                34950025
349600                               TO DP013-MESSAGE-TEXT (1)          34960025
349700             MOVE SQLCA        TO DP013-SQLCA                     34970025
349800             MOVE 'TIMCNPO'    TO DP013-DB2-TABLE-NAME (1)        34980025
349900             SET DP013-DB2-ABEND                                  34990025
350000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               35000025
350100             PERFORM DP013-0000-PROCESS-ABEND                     35010025
350200     END-EVALUATE.                                                35020025
350300                                                                  35030025
350400*----------------------------------------------------------------*35040025
350500*  INSERT THE PO TO THE SHIPEMENT PO ASSOCIATION AUDIT TABLE      35050025
350600*                                                                 35060025
350700*----------------------------------------------------------------*35070025
350800                                                                  35080025
350900 5100-CREATE-TAUSHPO.                                             35090025
351000                                                                  35100025
351100     PERFORM                                                      35110025
351200         WITH TEST AFTER                                          35120025
351300         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     35130025
351400         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            35140025
351500                (SQLCODE = ZERO)   OR                             35150025
351600                (SQLCODE = +100)                                  35160025
351700                                                                  35170025
351800         EXEC SQL                                                 35180025
351900             SELECT SHIPT_ID,                                     35190025
352000                    PO_NBR,                                       35200025
352100                    REC_SEQ_NBR,                                  35210025
352200                    EXPTED_CART_CNT,                              35220025
352300                    ACTL_CART_CNT,                                35230025
352400                    DMG_CART_CNT,                                 35240025
352500                    PKSL_IND,                                     35250025
352600                    VEND_NAME,                                    35260025
352700                    FRGT_CHG_AMT,                                 35270025
352800                    LAST_UPD_PGM_ID,                              35280025
352900                    CRE_USER_ID,                                  35290025
353000                    CARR_CART_CT,                                 35300025
353100                    CARR_LAST_UPD_DTE,                            35310025
353200                    CARR_LAST_UPD_TIME,                           35320025
353300                    VEND_CART_CT,                                 35330025
353400                    VEND_LAST_UPD_DTE,                            35340025
353500                    VEND_LAST_UPD_TIME,                           35350025
353600                    CRE_TMST,                                     35360025
353700                    LAST_UPD_DTE,                                 35370025
353800                    LAST_UPD_TIME,                                35380025
353900                    LAST_UPD_USER_ID,                             35390025
354000                    PRIM_SHIPT_IND                                35400025
354100                   ,SPLT_XMIT_IND                                 35410025
354200                   ,SPLT_XMIT_DTE                                 35420025
354300                   ,SPLT_XMIT_TM                                  35430025
354400               INTO :SHPTPO-SHIPT-ID,                             35440025
354500                    :SHPTPO-PO-NBR,                               35450025
354600                    :SHPTPO-REC-SEQ-NBR,                          35460025
354700                    :SHPTPO-EXPTED-CART-CNT,                      35470025
354800                    :SHPTPO-ACTL-CART-CNT,                        35480025
354900                    :SHPTPO-DMG-CART-CNT,                         35490025
355000                    :SHPTPO-PKSL-IND,                             35500025
355100                    :SHPTPO-VEND-NAME,                            35510025
355200                    :SHPTPO-FRGT-CHG-AMT,                         35520025
355300                    :SHPTPO-LAST-UPD-PGM-ID,                      35530025
355400                    :SHPTPO-CRE-USER-ID,                          35540025
355500                    :SHPTPO-CARR-CART-CT,                         35550025
355600                    :SHPTPO-CARR-LAST-UPD-DTE,                    35560025
355700                    :SHPTPO-CARR-LAST-UPD-TIME,                   35570025
355800                    :SHPTPO-VEND-CART-CT,                         35580025
355900                    :SHPTPO-VEND-LAST-UPD-DTE,                    35590025
356000                    :SHPTPO-VEND-LAST-UPD-TIME,                   35600025
356100                    :SHPTPO-CRE-TMST,                             35610025
356200                    :SHPTPO-LAST-UPD-DTE,                         35620025
356300                    :SHPTPO-LAST-UPD-TIME,                        35630025
356400                    :SHPTPO-LAST-UPD-USER-ID,                     35640025
356500                    :SHPTPO-PRIM-SHIPT-IND                        35650025
356600                   ,:SHPTPO-SPLT-XMIT-IND                         35660025
356700                   ,:SHPTPO-SPLT-XMIT-DTE                         35670025
356800                   ,:SHPTPO-SPLT-XMIT-TM                          35680025
356900               FROM TSHPTPO                                       35690025
357000              WHERE SHIPT_ID = :SHPTPO-SHIPT-ID                   35700025
357100                AND PO_NBR   = :SHPTPO-PO-NBR                     35710025
357200         END-EXEC                                                 35720025
357300                                                                  35730025
357400         EVALUATE TRUE                                            35740025
357500             WHEN SQLCODE = ZERO                                  35750025
357600             WHEN SQLCODE = +100                                  35760025
357700             WHEN SQLCODE = -904                                  35770025
357800             WHEN SQLCODE = -913                                  35780025
357900                 CONTINUE                                         35790025
358000                                                                  35800025
358100             WHEN SQLWARN0 NOT = SPACE                            35810025
358200             WHEN SQLCODE  NOT = +0                               35820025
358300                  MOVE SPACES TO PV-MESSAGE                       35830025
358400                  MOVE SHPTPO-SHIPT-ID TO PV-MESSAGE1             35840025
358500                  MOVE DK-PO-NBR       TO PV-MESSAGE2             35850025
358600                  MOVE '5100-CREATE-TAUSHPO'                      35860025
358700                                   TO DP013-PARAGRAPH             35870025
358800                  MOVE 'SELECT TSHPTPO DATA'                      35880025
358900                                   TO DP013-MESSAGE-TEXT (1)      35890025
359000                  MOVE PV-MESSAGE  TO DP013-MESSAGE-TEXT (2)      35900025
359100                  MOVE SQLCA       TO DP013-SQLCA                 35910025
359200                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (1)    35920025
359300                  SET DP013-DB2-ABEND                             35930025
359400                                   TO TRUE                        35940025
359500                  PERFORM DP013-0000-PROCESS-ABEND                35950025
359600         END-EVALUATE                                             35960025
359700                                                                  35970025
359800     END-PERFORM.                                                 35980025
359900                                                                  35990025
360000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    36000025
360100         SQLCODE NOT = +0                                         36010025
360200         MOVE '5100-CREATE-TAUSHPO'                               36020025
360300                                   TO DP013-PARAGRAPH             36030025
360400         MOVE 'MAX RETRIES EXCEEDED FOR SELECT TAUSHPO'           36040025
360500                                   TO DP013-MESSAGE-TEXT (1)      36050025
360600         MOVE SQLCA                TO DP013-SQLCA                 36060025
360700         SET DP013-DB2-ABEND       TO TRUE                        36070025
360800         PERFORM DP013-0000-PROCESS-ABEND                         36080025
360900     END-IF.                                                      36090025
361000                                                                  36100025
361100 5100-INSERT-TAUSHPO.                                             36110025
361200     MOVE PV-TRN-CDE               TO AUSHPO-TRN-CDE              36120025
361300     PERFORM                                                      36130025
361400         WITH TEST AFTER                                          36140025
361500         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     36150025
361600         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            36160025
361700                 SQLCODE = ZERO                                   36170025
361800                                                                  36180025
361900         EXEC SQL                                                 36190025
362000             INSERT INTO TAUSHPO                                  36200025
362100                   (SHIPT_ID,                                     36210025
362200                    PO_NBR,                                       36220025
362300                    REC_SEQ_NBR,                                  36230025
362400                    EXPTED_CART_CNT,                              36240025
362500                    ACTL_CART_CNT,                                36250025
362600                    DMG_CART_CNT,                                 36260025
362700                    PKSL_IND,                                     36270025
362800                    VEND_NAME,                                    36280025
362900                    FRGT_CHG_AMT,                                 36290025
363000                    LAST_UPD_PGM_ID,                              36300025
363100                    CRE_USER_ID,                                  36310025
363200                    CARR_CART_CT,                                 36320025
363300                    CARR_LAST_UPD_DTE,                            36330025
363400                    CARR_LAST_UPD_TIME,                           36340025
363500                    VEND_CART_CT,                                 36350025
363600                    VEND_LAST_UPD_DTE,                            36360025
363700                    VEND_LAST_UPD_TIME,                           36370025
363800                    CRE_TMST,                                     36380025
363900                    LAST_UPD_DTE,                                 36390025
364000                    LAST_UPD_TIME,                                36400025
364100                    LAST_UPD_USER_ID,                             36410025
364200                    PRIM_SHIPT_IND                                36420025
364300                   ,SPLT_XMIT_IND                                 36430025
364400                   ,SPLT_XMIT_DTE                                 36440025
364500                   ,SPLT_XMIT_TM                                  36450025
364600                   ,TRN_CDE )                                     36460025
364700             VALUES                                               36470025
364800                  (:SHPTPO-SHIPT-ID,                              36480025
364900                   :SHPTPO-PO-NBR,                                36490025
365000                   :SHPTPO-REC-SEQ-NBR,                           36500025
365100                   :SHPTPO-EXPTED-CART-CNT,                       36510025
365200                   :SHPTPO-ACTL-CART-CNT,                         36520025
365300                   :SHPTPO-DMG-CART-CNT,                          36530025
365400                   :SHPTPO-PKSL-IND,                              36540025
365500                   :SHPTPO-VEND-NAME,                             36550025
365600                   :SHPTPO-FRGT-CHG-AMT,                          36560025
365700                   :SHPTPO-LAST-UPD-PGM-ID,                       36570025
365800                   :SHPTPO-CRE-USER-ID,                           36580025
365900                   :SHPTPO-CARR-CART-CT,                          36590025
366000                   :SHPTPO-CARR-LAST-UPD-DTE,                     36600025
366100                   :SHPTPO-CARR-LAST-UPD-TIME,                    36610025
366200                   :SHPTPO-VEND-CART-CT,                          36620025
366300                   :SHPTPO-VEND-LAST-UPD-DTE,                     36630025
366400                   :SHPTPO-VEND-LAST-UPD-TIME,                    36640025
366500                   :SHPTPO-CRE-TMST,                              36650025
366600                    CURRENT DATE ,                                36660025
366700                    CURRENT TIME ,                                36670025
366800                   :DP020-USERID ,                                36680025
366900                   :SHPTPO-PRIM-SHIPT-IND                         36690025
367000                  ,:SHPTPO-SPLT-XMIT-IND                          36700025
367100                  ,:SHPTPO-SPLT-XMIT-DTE                          36710025
367200                  ,:SHPTPO-SPLT-XMIT-TM                           36720025
367300                  ,:AUSHPO-TRN-CDE )                              36730025
367400         END-EXEC                                                 36740025
367500                                                                  36750025
367600         EVALUATE TRUE                                            36760025
367700             WHEN SQLCODE = +0                                    36770025
367800             WHEN SQLCODE = -904                                  36780025
367900             WHEN SQLCODE = -913                                  36790025
368000                 CONTINUE                                         36800025
368100                                                                  36810025
368200             WHEN SQLWARN0 NOT = SPACES                           36820025
368300             WHEN SQLCODE < +0                                    36830025
368400             WHEN SQLCODE > +0                                    36840025
368500                 MOVE SPACES TO PV-MESSAGE                        36850025
368600                 MOVE SHPTPO-SHIPT-ID TO PV-MESSAGE1              36860025
368700                 MOVE DK-PO-NBR       TO PV-MESSAGE2              36870025
368800                 MOVE '5100-INSERT-TAUSHPO'                       36880025
368900                                   TO DP013-PARAGRAPH             36890025
369000                 MOVE 'INSERT A ROW ON TAUSHPO'                   36900025
369100                                   TO DP013-MESSAGE-TEXT(1)       36910025
369200                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       36920025
369300                 MOVE SQLCA        TO DP013-SQLCA                 36930025
369400                 MOVE 'TAUSHPO'    TO DP013-DB2-TABLE-NAME (1)    36940025
369500                 SET DP013-DB2-ABEND                              36950025
369600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           36960025
369700                 PERFORM DP013-0000-PROCESS-ABEND                 36970025
369800         END-EVALUATE                                             36980025
369900     END-PERFORM.                                                 36990025
370000                                                                  37000025
370100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    37010025
370200         SQLCODE NOT = +0                                         37020025
370300         MOVE '5100-INSERT-TAUSHPO'                               37030025
370400                                   TO DP013-PARAGRAPH             37040025
370500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              37050025
370600                                   TO DP013-MESSAGE-TEXT (1)      37060025
370700         MOVE 'TO INSERT A TAUSHPO ROW'                           37070025
370800                                   TO DP013-MESSAGE-TEXT (2)      37080025
370900         MOVE SQLCA                TO DP013-SQLCA                 37090025
371000         MOVE 'TAUSHPO'            TO DP013-DB2-TABLE-NAME (1)    37100025
371100         SET DP013-DB2-ABEND                                      37110025
371200             DP013-XCTL-DISPLAY-RESTART                           37120025
371300                                   TO TRUE                        37130025
371400         PERFORM DP013-0000-PROCESS-ABEND                         37140025
371500     END-IF.                                                      37150025
371600 5100-EXIT.                                                       37160025
371700     EXIT.                                                        37170025
371800                                                                  37180025
371900/                                                                 37190025
372000*----------------------------------------------------------------*37200025
372100* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *37210025
372200* OBJECT WAS UPDATED.                                            *37220025
372300*----------------------------------------------------------------*37230025
372400                                                                  37240025
372500 5200-UPDATE-SELECTION-QUEUE.                                     37250025
372600                                                                  37260025
372700     PERFORM 9100-READ-SEL-QUEUE.                                 37270025
372800                                                                  37280025
372900     IF  ASC-DELETE-SUCCESSFUL                                    37290025
373000         SET RC013-DEL (ASC-SEL-SUB)                              37300025
373100                                   TO TRUE                        37310025
373200     ELSE                                                         37320025
373300         SET RC013-UPD (ASC-SEL-SUB)                              37330025
373400                                   TO TRUE                        37340025
373500     END-IF.                                                      37350025
373600                                                                  37360025
373700     PERFORM 9200-REWRITE-LIST-QUEUE.                             37370025
373800                                                                  37380025
373900/                                                                 37390025
374000*----------------------------------------------------------------*37400025
374100* APPLY CHANGES TO A SHIPMENT                                    *37410025
374200*----------------------------------------------------------------*37420025
374300 6000-UPDATE-SHIPMENT.                                            37430025
374400                                                                  37440025
374500     MOVE ASC-KEY-SHIPT-ID       TO DK-SHIPT-ID.                  37450025
374600     MOVE ASC-PO-NBR-N           TO DK-PO-NBR.                    37460025
374700                                                                  37470025
374800     MOVE ASC-EXPTED-CART-CNT-N  TO SHPTPO-EXPTED-CART-CNT.       37480025
374900     MOVE ASC-ACTL-CART-CNT-N    TO SHPTPO-ACTL-CART-CNT.         37490025
375000     MOVE ASC-DMG-CART-CNT-N     TO SHPTPO-DMG-CART-CNT.          37500025
375100     MOVE ASC-PKSL-IND           TO SHPTPO-PKSL-IND.              37510025
375200                                                                  37520025
375300     IF  ASC-ACTIVE-PO                                            37530025
375400         MOVE SPACES             TO SHPTPO-VEND-NAME              37540025
375500     ELSE                                                         37550025
375600         MOVE ASC-VEND-NAME      TO SHPTPO-VEND-NAME              37560025
375700     END-IF.                                                      37570025
375800                                                                  37580025
375900     PERFORM 6020-UPDATE-TSHPTPO.                                 37590025
376000                                                                  37600025
376100     IF ASC-INTER-APPL-LIST-LIST                                  37610025
376200         MOVE ASC-REC-SEQ-NBR TO  DK-REC-SEQ-NBR                  37620025
376300         MOVE ASC-KEY-PO-NBR  TO DK-PO-NBR                        37630025
376400         MOVE ASC-KEY-OPER-UNT-ID  TO DK-OPER-UNT-ID              37640025
376500         MOVE ASC-KEY-FCLTY-ID TO DK-FCLTY-ID                     37650025
376600         PERFORM 1140-SELECT-RECEIVER                             37660025
376700         SET PS-DONT-UPDATE-TRECEIV TO TRUE                       37670025
376800         IF ASC-ACTL-CART-CNT NOT = ASC-ACTL-CART-CNT-OLD AND     37680025
376900            ASC-REC-SEQ-NBR > 0                                   37690025
377000             SET PS-UPDATE-TRECEIV TO TRUE                        37700025
377100*            IF RECEIV-ACTL-CART-CNT = 0                          37710025
377200*                MOVE RECEIV-EXPTED-CART-CNT                      37720025
377300*                      TO PV-RECEIV-CART-CNT                      37730025
377400*            ELSE                                                 37740025
377500                 MOVE RECEIV-ACTL-CART-CNT                        37750025
377600                       TO PV-RECEIV-CART-CNT                      37760025
377700*            END-IF                                               37770025
377800*            IF ASC-ACTL-CART-CNT-OLD-N = 0                       37780025
377900*                MOVE ASC-EXPTED-CART-CNT-OLD-N                   37790025
378000*                      TO PV-SHPTPO-CART-CNT                      37800025
378100*            ELSE                                                 37810025
378200                 MOVE ASC-ACTL-CART-CNT-OLD-N                     37820025
378300                       TO PV-SHPTPO-CART-CNT                      37830025
378400*            END-IF                                               37840025
378500             COMPUTE PV-RECEIV-ACTL-CART-CNT =                    37850025
378600                        PV-RECEIV-CART-CNT -                      37860025
378700                        PV-SHPTPO-CART-CNT +                      37870025
378800                        ASC-ACTL-CART-CNT-N                       37880025
378900             MOVE PV-RECEIV-ACTL-CART-CNT TO                      37890025
379000                  RECEIV-ACTL-CART-CNT                            37900025
379100         END-IF                                                   37910025
379200         IF ASC-EXPTED-CART-CNT NOT = ASC-EXPTED-CART-CNT-OLD AND 37920025
379300            ASC-REC-SEQ-NBR > 0                                   37930025
379400             SET PS-UPDATE-TRECEIV TO TRUE                        37940025
379500             COMPUTE PV-RECEIV-EXPTED-CART-CNT =                  37950025
379600                        RECEIV-EXPTED-CART-CNT -                  37960025
379700                        ASC-EXPTED-CART-CNT-OLD-N +               37970025
379800                        ASC-EXPTED-CART-CNT-N                     37980025
379900             MOVE PV-RECEIV-EXPTED-CART-CNT TO                    37990025
380000                  RECEIV-EXPTED-CART-CNT                          38000025
380100         END-IF                                                   38010025
380200         IF PS-UPDATE-TRECEIV                                     38020025
380300             PERFORM 6100-LINK-AUDIT-MODULE                       38030025
380400             PERFORM 6200-UPDATE-TRECEIV                          38040025
380500         END-IF                                                   38050025
380600     END-IF.                                                      38060025
380700                                                                  38070025
380800     MOVE PC-TSYMSG-00059        TO DP020-MSG-NUMBER.             38080025
380900     SET DP020-MSG-INFORMATIONAL TO TRUE.                         38090025
381000                                                                  38100025
381100     IF  ASC-USE-SELECTION-QUEUE                                  38110025
381200         PERFORM 5200-UPDATE-SELECTION-QUEUE                      38120025
381300     END-IF.                                                      38130025
381400                                                                  38140025
381500     PERFORM 3500-SAVE-SCREEN-FIELDS.                             38150025
381600/                                                                 38160025
381700*----------------------------------------------------------------*38170025
381800*  UPDATE THE SHIPMENT ROW                                       *38180025
381900*----------------------------------------------------------------*38190025
382000 6020-UPDATE-TSHPTPO.                                             38200025
382100                                                                  38210025
382200     PERFORM                                                      38220025
382300         WITH TEST AFTER                                          38230025
382400         VARYING PV-RETRY-COUNTER                                 38240025
382500         FROM 1 BY 1                                              38250025
382600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               38260025
382700             OR (SQLCODE = +0))                                   38270025
382800                                                                  38280025
382900         EXEC SQL                                                 38290025
383000           UPDATE TSHPTPO                                         38300025
383100              SET EXPTED_CART_CNT = :SHPTPO-EXPTED-CART-CNT       38310025
383200                 ,ACTL_CART_CNT   = :SHPTPO-ACTL-CART-CNT         38320025
383300                 ,DMG_CART_CNT    = :SHPTPO-DMG-CART-CNT          38330025
383400                 ,PKSL_IND        = :SHPTPO-PKSL-IND              38340025
383500                 ,VEND_NAME       = :SHPTPO-VEND-NAME             38350025
383600                 ,LAST_UPD_PGM_ID = :PC-CURRENT-PROGRAM-NAME      38360025
383700                 ,LAST_UPD_DTE    = CURRENT DATE                  38370025
383800                 ,LAST_UPD_TIME   = CURRENT TIME                  38380025
383900                 ,LAST_UPD_USER_ID = :DP020-USERID                38390025
384000           WHERE  SHIPT_ID = :DK-SHIPT-ID                         38400025
384100             AND  PO_NBR   = :DK-PO-NBR                           38410025
384200         END-EXEC                                                 38420025
384300                                                                  38430025
384400         EVALUATE TRUE                                            38440025
384500             WHEN SQLCODE = +0                                    38450025
384600             WHEN SQLCODE = -904                                  38460025
384700             WHEN SQLCODE = -913                                  38470025
384800                 CONTINUE                                         38480025
384900                                                                  38490025
385000             WHEN SQLWARN0 NOT = SPACES                           38500025
385100             WHEN SQLCODE < +0                                    38510025
385200             WHEN SQLCODE > +0                                    38520025
385300                 MOVE '6020-UPDATE-TSHPTPO'                       38530025
385400                                   TO DP013-PARAGRAPH             38540025
385500                 MOVE 'UPDATE INFO ON TSHPTPO     '               38550025
385600                                   TO DP013-MESSAGE-TEXT(1)       38560025
385700                 MOVE SQLCA        TO DP013-SQLCA                 38570025
385800                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    38580025
385900                 SET DP013-DB2-ABEND                              38590025
386000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           38600025
386100                 PERFORM DP013-0000-PROCESS-ABEND                 38610025
386200         END-EVALUATE                                             38620025
386300     END-PERFORM.                                                 38630025
386400                                                                  38640025
386500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    38650025
386600         SQLCODE NOT = +0                                         38660025
386700         MOVE '6020-UPDATE-TSHPTPO'                               38670025
386800                                   TO DP013-PARAGRAPH             38680025
386900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              38690025
387000                                   TO DP013-MESSAGE-TEXT (1)      38700025
387100         MOVE 'TO UPDATE A TSHPTPO ROW'                           38710025
387200                                   TO DP013-MESSAGE-TEXT (2)      38720025
387300         MOVE SQLCA                TO DP013-SQLCA                 38730025
387400         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    38740025
387500         SET DP013-DB2-ABEND                                      38750025
387600             DP013-XCTL-DISPLAY-RESTART                           38760025
387700                                   TO TRUE                        38770025
387800         PERFORM DP013-0000-PROCESS-ABEND                         38780025
387900     END-IF.                                                      38790025
388000                                                                  38800025
388100     EVALUATE TRUE                                                38810025
388200        WHEN SQLCODE = +0                                         38820025
388300           MOVE DK-SHIPT-ID TO SHPTPO-SHIPT-ID                    38830025
388400           MOVE DK-PO-NBR   TO SHPTPO-PO-NBR                      38840025
388500           MOVE PC-U             TO PV-TRN-CDE                    38850025
388600           PERFORM 5100-CREATE-TAUSHPO THRU 5100-EXIT             38860025
388700     END-EVALUATE.                                                38870025
388800                                                                  38880025
388900/                                                                 38890025
389000*----------------------------------------------------------------*38900025
389100*    LINK TO AUDIT MODULE * RCKCS290                             *38910025
389200*----------------------------------------------------------------*38920025
389300                                                                  38930025
389400 6100-LINK-AUDIT-MODULE.                                          38940025
389500                                                                  38950025
389600     MOVE 'V'              TO RC031-TABLE-TO-AUDIT.               38960025
389700     MOVE 'B'              TO RC031-AUD-TYP-CDE.                  38970025
389800     MOVE 'U'              TO RC031-AUD-FUNC-CDE.                 38980025
389900     MOVE RECEIV-OPER-UNT-ID                                      38990025
390000                           TO RC031-OPER-UNT-ID.                  39000025
390100     MOVE RECEIV-FCLTY-ID  TO RC031-FCLTY-ID.                     39010025
390200     MOVE DK-PO-NBR        TO RC031-PO-NBR.                       39020025
390300     MOVE DK-REC-SEQ-NBR   TO RC031-REC-SEQ-NBR.                  39030025
390400                                                                  39040025
390500     EXEC CICS                                                    39050025
390600          LINK PROGRAM  (PC-AUDIT-RTN)                            39060025
390700          COMMAREA (RC031-FIELDS)                                 39070025
390800          LENGTH   (PC-AUDIT-RTN-LENGTH)                          39080025
390900     END-EXEC.                                                    39090025
391000                                                                  39100025
391100     EVALUATE TRUE                                                39110025
391200         WHEN RC031-CALL-SUCCESSFUL                               39120025
391300             CONTINUE                                             39130025
391400         WHEN OTHER                                               39140025
391500             MOVE '6100-LINK-AUDIT-MODULE'                        39150025
391600                                 TO DP013-PARAGRAPH               39160025
391700             MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'                39170025
391800                                 TO DP013-MESSAGE-TEXT (1)        39180025
391900             MOVE RC031-RETURN-DESC                               39190025
392000                                 TO DP013-MESSAGE-TEXT (2)        39200025
392100             MOVE RC031-SQLCA    TO DP013-SQLCA                   39210025
392200             SET DP013-DB2-ABEND                                  39220025
392300                 DP013-XCTL-DISPLAY-RESTART                       39230025
392400                                 TO TRUE                          39240025
392500             PERFORM DP013-0000-PROCESS-ABEND                     39250025
392600     END-EVALUATE.                                                39260025
392700/                                                                 39270025
392800*----------------------------------------------------------------*39280025
392900* UPDATE THE CURRENT RECEIVER HEADER                             *39290025
393000*----------------------------------------------------------------*39300025
393100 6200-UPDATE-TRECEIV.                                             39310025
393200                                                                  39320025
393300     PERFORM                                                      39330025
393400         WITH TEST AFTER                                          39340025
393500         VARYING PV-RETRY-COUNTER                                 39350025
393600         FROM 1 BY 1                                              39360025
393700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               39370025
393800             OR (SQLCODE = +0))                                   39380025
393900                                                                  39390025
394000         EXEC SQL                                                 39400025
394100           UPDATE TRECEIV                                         39410025
394200              SET   EXPTED_CART_CNT    =  :RECEIV-EXPTED-CART-CNT 39420025
394300                   ,ACTL_CART_CNT      =  :RECEIV-ACTL-CART-CNT   39430025
394400                   ,UPD_TMST           =  CURRENT TIMESTAMP       39440025
394500                   ,UPD_UID            =  :DP020-USERID           39450025
394600                   ,UPD_PGM_ID         =  :PC-CURRENT-PROGRAM-NAME39460025
394700               WHERE OPER_UNT_ID    = :RECEIV-OPER-UNT-ID         39470025
394800                 AND FCLTY_ID       = :RECEIV-FCLTY-ID            39480025
394900                 AND ORD_NBR        = :DK-PO-NBR                  39490025
395000                 AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR             39500025
395100                 AND VER_STATUS_CDE = 'A'                         39510025
395200         END-EXEC                                                 39520025
395300                                                                  39530025
395400                                                                  39540025
395500                                                                  39550025
395600         EVALUATE TRUE                                            39560025
395700             WHEN SQLCODE = +0                                    39570025
395800             WHEN SQLCODE = -904                                  39580025
395900             WHEN SQLCODE = -913                                  39590025
396000                 CONTINUE                                         39600025
396100                                                                  39610025
396200             WHEN SQLWARN0 NOT = SPACES                           39620025
396300             WHEN SQLCODE < +0                                    39630025
396400             WHEN SQLCODE > +0                                    39640025
396500                 MOVE '6200-UPDATE-TRECEIV'                       39650025
396600                                   TO DP013-PARAGRAPH             39660025
396700                 MOVE 'UPDATE RECEIVER HEADER    '                39670025
396800                                   TO DP013-MESSAGE-TEXT(1)       39680025
396900                 MOVE SQLCA        TO DP013-SQLCA                 39690025
397000                 MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (1)    39700025
397100                 SET DP013-DB2-ABEND                              39710025
397200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           39720025
397300                 PERFORM DP013-0000-PROCESS-ABEND                 39730025
397400         END-EVALUATE                                             39740025
397500     END-PERFORM.                                                 39750025
397600                                                                  39760025
397700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    39770025
397800         SQLCODE NOT = +0                                         39780025
397900         MOVE '6200-UPDATE-TRECEIV'                               39790025
398000                                   TO DP013-PARAGRAPH             39800025
398100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              39810025
398200                                   TO DP013-MESSAGE-TEXT (1)      39820025
398300         MOVE 'TO UPDATE A TRECEIV ROW'                           39830025
398400                                   TO DP013-MESSAGE-TEXT (2)      39840025
398500         MOVE SQLCA                TO DP013-SQLCA                 39850025
398600         MOVE 'TRECEIV'            TO DP013-DB2-TABLE-NAME (1)    39860025
398700         SET DP013-DB2-ABEND                                      39870025
398800             DP013-XCTL-DISPLAY-RESTART                           39880025
398900                                   TO TRUE                        39890025
399000         PERFORM DP013-0000-PROCESS-ABEND                         39900025
399100     END-IF.                                                      39910025
399200                                                                  39920025
399300/                                                                 39930025
399400*----------------------------------------------------------------*39940025
399500* DELETE A SHIPMENT                                              *39950025
399600*----------------------------------------------------------------*39960025
399700 7000-DELETE-SHIPMENT.                                            39970025
399800                                                                  39980025
399900     MOVE ASC-KEY-SHIPT-ID       TO DK-SHIPT-ID                   39990025
400000                                    SHPTPO-SHIPT-ID               40000025
400100     MOVE ASC-PO-NBR-N           TO DK-PO-NBR                     40010025
400200                                    SHPTPO-PO-NBR                 40020025
400300                                                                  40030025
400400     PERFORM 5100-CREATE-TAUSHPO.                                 40040025
400500     PERFORM 7010-DELETE-TSHPTPO.                                 40050025
400600                                                                  40060025
400700     IF SQLCODE = ZERO                                            40070025
400800         MOVE DK-SHIPT-ID        TO SHPTPO-SHIPT-ID               40080025
400900         MOVE DK-PO-NBR          TO SHPTPO-PO-NBR                 40090025
401000         MOVE PC-D               TO PV-TRN-CDE                    40100025
401100         PERFORM 5100-INSERT-TAUSHPO THRU 5100-EXIT               40110025
401200     END-IF.                                                      40120025
401300                                                                  40130025
401400     SET PS-DONT-CHECK-TSHPTPO                                    40140025
401500         PS-DONT-UPDATE-TIMPORL  TO TRUE.                         40150025
401600                                                                  40160025
401700     PERFORM 7050-CHECK-DCONSLR-IND.                              40170025
401800                                                                  40180025
401900     IF PS-CHECK-TSHPTPO                                          40190025
402000        PERFORM 7060-CHECK-TSHPTPO                                40200025
402100     END-IF.                                                      40210025
402200                                                                  40220025
402300     IF PS-UPDATE-TIMPORL                                         40230025
402400        PERFORM 7070-UPDATE-TIMPORL                               40240025
402500     END-IF.                                                      40250025
402600                                                                  40260025
402700     MOVE PC-TSYMSG-00115        TO DP020-MSG-NUMBER.             40270025
402800     SET DP020-MSG-INFORMATIONAL                                  40280025
402900         ASC-DELETE-SUCCESSFUL   TO TRUE.                         40290025
403000                                                                  40300025
403100     IF  ASC-USE-SELECTION-QUEUE                                  40310025
403200         PERFORM 5200-UPDATE-SELECTION-QUEUE                      40320025
403300     END-IF.                                                      40330025
403400                                                                  40340025
403500/                                                                 40350025
403600*----------------------------------------------------------------*40360025
403700* DELETE A SHIPMENT PO ROW                                       *40370025
403800*----------------------------------------------------------------*40380025
403900 7010-DELETE-TSHPTPO.                                             40390025
404000                                                                  40400025
404100     PERFORM                                                      40410025
404200         WITH TEST AFTER                                          40420025
404300         VARYING PV-RETRY-COUNTER                                 40430025
404400         FROM 1 BY 1                                              40440025
404500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               40450025
404600             OR (SQLCODE = +0))                                   40460025
404700                                                                  40470025
404800         EXEC SQL                                                 40480025
404900           DELETE                                                 40490025
405000             FROM TSHPTPO                                         40500025
405100             WHERE SHIPT_ID = :DK-SHIPT-ID                        40510025
405200               AND PO_NBR   = :DK-PO-NBR                          40520025
405300         END-EXEC                                                 40530025
405400                                                                  40540025
405500         EVALUATE TRUE                                            40550025
405600             WHEN SQLCODE = +0                                    40560025
405700             WHEN SQLCODE = -904                                  40570025
405800             WHEN SQLCODE = -913                                  40580025
405900                 CONTINUE                                         40590025
406000                                                                  40600025
406100             WHEN SQLWARN0 NOT = SPACES                           40610025
406200             WHEN SQLCODE < +0                                    40620025
406300             WHEN SQLCODE > +0                                    40630025
406400                 MOVE '7010-DELETE-TSHPTPO'                       40640025
406500                                   TO DP013-PARAGRAPH             40650025
406600                 MOVE 'DELETE ROW FROM TSHPTPO    '               40660025
406700                                   TO DP013-MESSAGE-TEXT(1)       40670025
406800                 MOVE SQLCA        TO DP013-SQLCA                 40680025
406900                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    40690025
407000                 SET DP013-DB2-ABEND                              40700025
407100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           40710025
407200                 PERFORM DP013-0000-PROCESS-ABEND                 40720025
407300         END-EVALUATE                                             40730025
407400     END-PERFORM.                                                 40740025
407500                                                                  40750025
407600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    40760025
407700         SQLCODE NOT = +0                                         40770025
407800         MOVE '7010-DELETE-TSHPTPO'                               40780025
407900                                   TO DP013-PARAGRAPH             40790025
408000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              40800025
408100                                   TO DP013-MESSAGE-TEXT (1)      40810025
408200         MOVE 'TO DELETE A TSHPTPO ROW'                           40820025
408300                                   TO DP013-MESSAGE-TEXT (2)      40830025
408400         MOVE SQLCA                TO DP013-SQLCA                 40840025
408500         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    40850025
408600         SET DP013-DB2-ABEND                                      40860025
408700             DP013-XCTL-DISPLAY-RESTART                           40870025
408800                                   TO TRUE                        40880025
408900         PERFORM DP013-0000-PROCESS-ABEND                         40890025
409000     END-IF.                                                      40900025
409100                                                                  40910025
409200/                                                                 40920025
409300 7020-DEPT-BUYER-NAMES.                                           40930025
409400                                                                  40940025
409500     INITIALIZE ASC-BUYER-NAME                                    40950025
409600                DP003-MBS-SUBROUTINE-FIELDS.                      40960025
409700                                                                  40970025
409800     EXEC CICS                                                    40980025
409900         ASKTIME ABSTIME (ST-ABSTIME)                             40990025
410000     END-EXEC.                                                    41000025
410100                                                                  41010025
410200     EXEC CICS                                                    41020025
410300         FORMATTIME ABSTIME (ST-ABSTIME)                          41030025
410400                    YYMMDD  (PV-CURRENT-DATE)                     41040025
410500     END-EXEC.                                                    41050025
410600                                                                  41060025
410700     MOVE ASC-DEPT-NBR                 TO DP003-DPT-INPUT.        41070025
410800     SET DP003-BYR-LOOKUP-NAME                                    41080025
410900         DP003-BYR-NAME-FIRST-LAST     TO TRUE                    41090025
411000                                                                  41100025
411100     MOVE 'MP'                         TO DP003-SYSTEM-CODE.      41110025
411200     MOVE '03'                         TO DP003-OP-CO-NMBR.       41120025
411300     MOVE PV-CURRENT-DATE              TO DP003-CURRENT-DATE      41130025
411400                                          DP003-EFF-DATE.         41140025
411500                                                                  41150025
411600     EXEC CICS                                                    41160025
411700         LINK PROGRAM  (PV-DPKUT038)                              41170025
411800              COMMAREA (DP003-MBS-SUBROUTINE-FIELDS)              41180025
411900              LENGTH   (PV-DPKUT038-CA-LENGTH)                    41190025
412000              RESP     (PV-CICS-RESPONSE)                         41200025
412100     END-EXEC.                                                    41210025
412200                                                                  41220025
412300     EVALUATE TRUE                                                41230025
412400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 41240025
412500              CONTINUE                                            41250025
412600         WHEN OTHER                                               41260025
412700              MOVE '7020-GET-BUYER-NAME' TO DP013-PARAGRAPH       41270025
412800              MOVE 'CANNOT LINK TO DPKUT038'                      41280025
412900                                         TO DP013-MESSAGE-TEXT (1)41290025
413000              SET DP013-CICS-ABEND       TO TRUE                  41300025
413100              SET DP013-NO-ROLLBACK      TO TRUE                  41310025
413200             PERFORM DP013-0000-PROCESS-ABEND                     41320025
413300     END-EVALUATE.                                                41330025
413400                                                                  41340025
413500     EVALUATE TRUE                                                41350025
413600         WHEN DP003-SUCCESSFUL                                    41360025
413700              MOVE DP003-BYR-NAME      TO ASC-BUYER-NAME          41370025
413800                                                                  41380025
413900         WHEN DP003-BYR-NAME-NOT-FOUND                            41390025
414000              MOVE '* NO BUYER NAME FOUND * '                     41400025
414100                                   TO ASC-BUYER-NAME              41410025
414200                                                                  41420025
414300         WHEN DP003-BYR-NAME-DB2-ERROR                            41430025
414400         WHEN DP003-DPT-DB2-ERROR                                 41440025
414500              MOVE '7020-DEPT-BUYER-NAMES'                        41450025
414600                                   TO DP013-PARAGRAPH             41460025
414700              MOVE DP003-RETURN-MSG                               41470025
414800                                   TO DP013-MESSAGE-TEXT (1)      41480025
414900              MOVE DP003-DPT-INPUT TO DP013-MESSAGE-TEXT (2)      41490025
415000              MOVE DP003-SQLCA         TO DP013-SQLCA             41500025
415100              MOVE 'TMDSEAR'           TO DP013-DB2-TABLE-NAME (1)41510025
415200              MOVE 'TAPLAVL'           TO DP013-DB2-TABLE-NAME (2)41520025
415300              MOVE 'TRSPBAR'           TO DP013-DB2-TABLE-NAME (3)41530025
415400              SET DP013-DB2-ABEND        TO TRUE                  41540025
415500              SET DP013-NO-ROLLBACK      TO TRUE                  41550025
415600             PERFORM DP013-0000-PROCESS-ABEND                     41560025
415700                                                                  41570025
415800         WHEN DP003-BYR-NAME-MAX-RETRIES                          41580025
415900         WHEN DP003-DPT-MAX-RETRIES                               41590025
416000              MOVE '7020-DEPT-BUYER-NAMES'                        41600025
416100                                   TO DP013-PARAGRAPH             41610025
416200              MOVE DP003-RETURN-MSG                               41620025
416300                                   TO DP013-MESSAGE-TEXT (1)      41630025
416400              MOVE DP003-DPT-INPUT TO DP013-MESSAGE-TEXT (2)      41640025
416500              MOVE DP003-SQLCA         TO DP013-SQLCA             41650025
416600              MOVE 'TMDSEAR'           TO DP013-DB2-TABLE-NAME (1)41660025
416700              MOVE 'TAPLAVL'           TO DP013-DB2-TABLE-NAME (2)41670025
416800              MOVE 'TRSPBAR'           TO DP013-DB2-TABLE-NAME (3)41680025
416900              SET DP013-DB2-ABEND         TO TRUE                 41690025
417000              SET DP013-NO-ROLLBACK       TO TRUE                 41700025
417100             PERFORM DP013-0000-PROCESS-ABEND                     41710025
417200                                                                  41720025
417300         WHEN OTHER                                               41730025
417400              MOVE '7020-DEPT-BUYER-NAMES'                        41740025
417500                                   TO DP013-PARAGRAPH             41750025
417600              MOVE DP003-RETURN-MSG                               41760025
417700                  TO DP013-MESSAGE-TEXT (1)                       41770025
417800              MOVE DP003-DPT-INPUT TO DP013-MESSAGE-TEXT (2)      41780025
417900              MOVE DP003-SQLCA         TO DP013-SQLCA             41790025
418000              MOVE 'TMDSEAR'           TO DP013-DB2-TABLE-NAME (1)41800025
418100              MOVE 'TAPLAVL'           TO DP013-DB2-TABLE-NAME (2)41810025
418200              MOVE 'TRSPBAR'           TO DP013-DB2-TABLE-NAME (3)41820025
418300              SET DP013-OTHER-ABEND      TO TRUE                  41830025
418400              SET DP013-NO-ROLLBACK      TO TRUE                  41840025
418500             PERFORM DP013-0000-PROCESS-ABEND                     41850025
418600     END-EVALUATE.                                                41860025
418700                                                                  41870025
418800*  DEPT NAME                                                      41880025
418900     INITIALIZE ASC-DEPT-DESC                                     41890025
419000                DP003-MBS-SUBROUTINE-FIELDS.                      41900025
419100     MOVE ASC-DEPT-NBR                 TO DP003-DPT-INPUT.        41910025
419200     SET DP003-DPT-LOOKUP              TO TRUE                    41920025
419300                                                                  41930025
419400     MOVE 'MP'                         TO DP003-SYSTEM-CODE.      41940025
419500     MOVE '03'                         TO DP003-OP-CO-NMBR.       41950025
419600     MOVE PV-CURRENT-DATE              TO DP003-CURRENT-DATE      41960025
419700                                          DP003-EFF-DATE.         41970025
419800                                                                  41980025
419900     EXEC CICS                                                    41990025
420000         LINK PROGRAM  (PV-DPKUT038)                              42000025
420100              COMMAREA (DP003-MBS-SUBROUTINE-FIELDS)              42010025
420200              LENGTH   (PV-DPKUT038-CA-LENGTH)                    42020025
420300              RESP     (PV-CICS-RESPONSE)                         42030025
420400     END-EXEC.                                                    42040025
420500                                                                  42050025
420600     EVALUATE TRUE                                                42060025
420700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 42070025
420800              CONTINUE                                            42080025
420900         WHEN OTHER                                               42090025
421000              MOVE '7020-GET-BUYER-NAME' TO DP013-PARAGRAPH       42100025
421100              MOVE 'CANNOT LINK TO DPKUT038'                      42110025
421200                                         TO DP013-MESSAGE-TEXT (1)42120025
421300              MOVE 'DPT LOOKUP'          TO DP013-MESSAGE-TEXT (2)42130025
421400              SET DP013-CICS-ABEND       TO TRUE                  42140025
421500              SET DP013-NO-ROLLBACK      TO TRUE                  42150025
421600             PERFORM DP013-0000-PROCESS-ABEND                     42160025
421700     END-EVALUATE.                                                42170025
421800                                                                  42180025
421900     EVALUATE TRUE                                                42190025
422000         WHEN DP003-SUCCESSFUL                                    42200025
422100              MOVE DP003-DPT-DESCRIPTION                          42210025
422200                                       TO ASC-DEPT-DESC           42220025
422300                                                                  42230025
422400         WHEN DP003-DPT-NOT-FOUND                                 42240025
422500              MOVE '* NO DEPT NAME FOUND * '                      42250025
422600                                   TO ASC-DEPT-DESC               42260025
422700                                                                  42270025
422800         WHEN DP003-BYR-NAME-DB2-ERROR                            42280025
422900         WHEN DP003-DPT-DB2-ERROR                                 42290025
423000              MOVE '7020-DEPT-BUYER-NAMES'                        42300025
423100                                   TO DP013-PARAGRAPH             42310025
423200              MOVE DP003-RETURN-MSG                               42320025
423300                                   TO DP013-MESSAGE-TEXT (1)      42330025
423400              MOVE DP003-DPT-INPUT TO DP013-MESSAGE-TEXT (2)      42340025
423500              MOVE DP003-SQLCA         TO DP013-SQLCA             42350025
423600              MOVE 'TMDSEAR'           TO DP013-DB2-TABLE-NAME (1)42360025
423700              MOVE 'TAPLAVL'           TO DP013-DB2-TABLE-NAME (2)42370025
423800              MOVE 'TRSPBAR'           TO DP013-DB2-TABLE-NAME (3)42380025
423900              SET DP013-DB2-ABEND        TO TRUE                  42390025
424000              SET DP013-NO-ROLLBACK      TO TRUE                  42400025
424100             PERFORM DP013-0000-PROCESS-ABEND                     42410025
424200                                                                  42420025
424300         WHEN DP003-BYR-NAME-MAX-RETRIES                          42430025
424400         WHEN DP003-DPT-MAX-RETRIES                               42440025
424500              MOVE '7020-DEPT-BUYER-NAMES'                        42450025
424600                                   TO DP013-PARAGRAPH             42460025
424700              MOVE DP003-RETURN-MSG                               42470025
424800                                   TO DP013-MESSAGE-TEXT (1)      42480025
424900              MOVE DP003-DPT-INPUT TO DP013-MESSAGE-TEXT (2)      42490025
425000              MOVE DP003-SQLCA         TO DP013-SQLCA             42500025
425100              MOVE 'TMDSEAR'           TO DP013-DB2-TABLE-NAME (1)42510025
425200              MOVE 'TAPLAVL'           TO DP013-DB2-TABLE-NAME (2)42520025
425300              MOVE 'TRSPBAR'           TO DP013-DB2-TABLE-NAME (3)42530025
425400              SET DP013-DB2-ABEND         TO TRUE                 42540025
425500              SET DP013-NO-ROLLBACK       TO TRUE                 42550025
425600             PERFORM DP013-0000-PROCESS-ABEND                     42560025
425700                                                                  42570025
425800         WHEN OTHER                                               42580025
425900              MOVE '7020-DEPT-BUYER-NAMES'                        42590025
426000                                   TO DP013-PARAGRAPH             42600025
426100              MOVE DP003-RETURN-MSG                               42610025
426200                  TO DP013-MESSAGE-TEXT (1)                       42620025
426300              MOVE DP003-DPT-INPUT TO DP013-MESSAGE-TEXT (2)      42630025
426400              MOVE DP003-SQLCA         TO DP013-SQLCA             42640025
426500              MOVE 'TMDSEAR'           TO DP013-DB2-TABLE-NAME (1)42650025
426600              MOVE 'TAPLAVL'           TO DP013-DB2-TABLE-NAME (2)42660025
426700              MOVE 'TRSPBAR'           TO DP013-DB2-TABLE-NAME (3)42670025
426800              SET DP013-OTHER-ABEND      TO TRUE                  42680025
426900              SET DP013-NO-ROLLBACK      TO TRUE                  42690025
427000             PERFORM DP013-0000-PROCESS-ABEND                     42700025
427100     END-EVALUATE.                                                42710025
427200                                                                  42720025
427300                                                                  42730025
427400/                                                                 42740025
427500 7030-GET-PO-STATUS-DESC.                                         42750025
427600     EXEC SQL                                                     42760025
427700         SELECT STATUS_DESC                                       42770025
427800         INTO   :STATCD-STATUS-DESC                               42780025
427900         FROM   TSTATCD                                           42790025
428000         WHERE  STATUS_CDE     = :PURCHS-STATUS-CDE               42800025
428100            AND    STATUS_TYP_CDE = 'P'                           42810025
428200     END-EXEC                                                     42820025
428300                                                                  42830025
428400     EVALUATE TRUE                                                42840025
428500         WHEN SQLCODE = ZERO                                      42850025
428600             MOVE STATCD-STATUS-DESC TO ASC-PO-STATUS-DESC        42860025
428700         WHEN SQLCODE = +100                                      42870025
428800         WHEN SQLCODE = -904                                      42880025
428900         WHEN SQLCODE = -911                                      42890025
429000         WHEN SQLCODE = -913                                      42900025
429100             MOVE SPACES             TO ASC-PO-STATUS-DESC        42910025
429200         WHEN OTHER                                               42920025
429300             SET  PS-DONE TO TRUE                                 42930025
429400             MOVE '7030-GET-PO-STATUS-DESC'                       42940025
429500                                     TO DP013-PARAGRAPH           42950025
429600             MOVE 'UNSUCCESSFUL SELECT ON TSTATCD  '              42960025
429700                                     TO DP013-MESSAGE-TEXT (1)    42970025
429800             MOVE PURCHS-STATUS-CDE                               42980025
429900                                     TO DP013-MESSAGE-TEXT (2)    42990025
430000             MOVE SQLCA              TO DP013-SQLCA               43000025
430100             MOVE 'TSTATCD '         TO DP013-DB2-TABLE-NAME (1)  43010025
430200             SET DP013-DB2-ABEND                                  43020025
430300                 DP013-XCTL-DISPLAY-RESTART                       43030025
430400                                     TO TRUE                      43040025
430500             PERFORM DP013-0000-PROCESS-ABEND                     43050025
430600     END-EVALUATE.                                                43060025
430700/                                                                 43070025
430800 7040-SELECT-TPLNSHP.                                             43080025
430900                                                                  43090025
431000         EXEC SQL                                                 43100025
431100             SELECT DONT_SHIP_BEF_DTE                             43110025
431200                   ,CAN_IFNOT_SHIP_DTE                            43120025
431300                   ,EXT_CAN_DTE                                   43130025
431400             INTO   :PLNSHP-DONT-SHIP-BEF-DTE                     43140025
431500                   ,:PLNSHP-CAN-IFNOT-SHIP-DTE                    43150025
431600                   ,:PLNSHP-EXT-CAN-DTE                           43160025
431700             FROM   TPLNSHP                                       43170025
431800             WHERE  PO_NBR         = :DK-PO-NBR                   43180025
431900             AND    VER_STATUS_CDE = :PC-ACTIVE                   43190025
432000         END-EXEC                                                 43200025
432100                                                                  43210025
432200         EVALUATE TRUE                                            43220025
432300             WHEN SQLCODE = +0                                    43230025
432400                IF PLNSHP-DONT-SHIP-BEF-DTE = PC-DEFAULT-DATE     43240025
432500                    MOVE SPACES        TO ASC-DONT-SHIP-BEF-DTE   43250025
432600                ELSE                                              43260025
432700                    MOVE PLNSHP-DONT-SHIP-BEF-DTE TO PV-TEMP-DATE 43270025
432800                    MOVE PV-DATE-CCYY  TO PV-WK-DTE-YY            43280025
432900                    MOVE PV-DATE-MM    TO PV-WK-DTE-MM            43290025
433000                    MOVE PV-DATE-DD    TO PV-WK-DTE-DD            43300025
433100                    MOVE PV-WORK-DATE  TO ASC-DONT-SHIP-BEF-DTE   43310025
433200                END-IF                                            43320025
433300                                                                  43330025
433400                IF PLNSHP-CAN-IFNOT-SHIP-DTE = PC-DEFAULT-DATE    43340025
433500                    MOVE SPACES    TO ASC-CANCEL-DTE              43350025
433600                ELSE                                              43360025
433700                   MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO PV-TEMP-DATE 43370025
433800                   MOVE PV-DATE-CCYY  TO PV-WK-DTE-YY             43380025
433900                   MOVE PV-DATE-MM    TO PV-WK-DTE-MM             43390025
434000                   MOVE PV-DATE-DD    TO PV-WK-DTE-DD             43400025
434100                   MOVE PV-WORK-DATE  TO ASC-CANCEL-DTE           43410025
434200                END-IF                                            43420025
434300                                                                  43430025
434400                IF PLNSHP-EXT-CAN-DTE = PC-DEFAULT-DATE           43440025
434500                    MOVE SPACES        TO ASC-EXT-CAN-DTE         43450025
434600                ELSE                                              43460025
434700                    MOVE PLNSHP-EXT-CAN-DTE TO PV-TEMP-DATE       43470025
434800                    MOVE PV-DATE-CCYY  TO PV-WK-DTE-YY            43480025
434900                    MOVE PV-DATE-MM    TO PV-WK-DTE-MM            43490025
435000                    MOVE PV-DATE-DD    TO PV-WK-DTE-DD            43500025
435100                    MOVE PV-WORK-DATE  TO ASC-EXT-CAN-DTE         43510025
435200                END-IF                                            43520025
435300                                                                  43530025
435400             WHEN SQLCODE = +100                                  43540025
435500             WHEN SQLCODE = -904                                  43550025
435600             WHEN SQLCODE = -911                                  43560025
435700             WHEN SQLCODE = -913                                  43570025
435800                  SET PS-DONE  TO TRUE                            43580025
435900                                                                  43590025
436000             WHEN OTHER                                           43600025
436100                  SET  PS-DONE TO TRUE                            43610025
436200                  MOVE '7040-SELECT-TPLNSHP'                      43620025
436300                                  TO DP013-PARAGRAPH              43630025
436400                  MOVE 'UNSUCCESSFUL SELECT ON TPLNSHP  '         43640025
436500                                  TO DP013-MESSAGE-TEXT (1)       43650025
436600                  MOVE DK-PO-NBR  TO DP013-MESSAGE-TEXT (2)       43660025
436700                  MOVE SQLCA      TO DP013-SQLCA                  43670025
436800                  MOVE 'TPLNSHP ' TO DP013-DB2-TABLE-NAME (1)     43680025
436900                  SET DP013-DB2-ABEND                             43690025
437000                      DP013-XCTL-DISPLAY-RESTART                  43700025
437100                                  TO TRUE                         43710025
437200                  PERFORM DP013-0000-PROCESS-ABEND                43720025
437300         END-EVALUATE.                                            43730025
437400/                                                                 43740025
437500 7050-CHECK-DCONSLR-IND.                                          43750025
437600                                                                  43760025
437700     EXEC SQL                                                     43770025
437800         SELECT PO_NBR                                            43780025
437900              , DCONSLR_RLSE_CDE                                  43790025
438000           INTO :IMPORL-PO-NBR                                    43800025
438100              , :IMPORL-DCONSLR-RLSE-CDE                          43810025
438200         FROM   TIMPORL                                           43820025
438300         WHERE PO_NBR = :DK-PO-NBR                                43830025
438400           AND VER_STATUS_CDE   = 'A'                             43840025
438500           AND DCONSLR_RLSE_CDE = 'S'                             43850025
438600     END-EXEC                                                     43860025
438700                                                                  43870025
438800     EVALUATE TRUE                                                43880025
438900         WHEN SQLCODE = ZERO                                      43890025
439000             SET PS-CHECK-TSHPTPO TO TRUE                         43900025
439100         WHEN SQLCODE = +100                                      43910025
439200             CONTINUE                                             43920025
439300         WHEN SQLWARN0 NOT = SPACES                               43930025
439400         WHEN SQLCODE < ZERO                                      43940025
439500         WHEN SQLCODE > ZERO                                      43950025
439600             MOVE '7050-CHECK-DCONSLR-IND'                        43960025
439700                               TO DP013-PARAGRAPH                 43970025
439800             MOVE 'SELECT IMPORL'                                 43980025
439900                               TO DP013-MESSAGE-TEXT (1)          43990025
440000             MOVE SQLCA        TO DP013-SQLCA                     44000025
440100             MOVE 'TIMPORL'    TO DP013-DB2-TABLE-NAME (1)        44010025
440200             SET DP013-DB2-ABEND                                  44020025
440300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               44030025
440400             PERFORM DP013-0000-PROCESS-ABEND                     44040025
440500     END-EVALUATE.                                                44050025
440600/                                                                 44060025
440700 7060-CHECK-TSHPTPO.                                              44070025
440800                                                                  44080025
440900         EXEC SQL                                                 44090025
441000              SELECT  DISTINCT                                    44100025
441100                      PO_NBR                                      44110025
441200                INTO  :SHPTPO-PO-NBR                              44120025
441300                FROM  TSHPTPO SP                                  44130025
441400                    , TSHSTYP Y                                   44140025
441500                    , TSHIPST X                                   44150025
441600               WHERE  SP.PO_NBR   = :DK-PO-NBR                    44160025
441700                 AND  SP.SHIPT_ID = X.SHIPT_ID                    44170025
441800                 AND  Y.SHIPT_STATUS_CDE = X.SHIPT_STATUS_CDE     44180025
441900                 AND  Y.PRTY_CDE =                                44190025
442000                      (SELECT MAX(TY.PRTY_CDE)                    44200025
442100                         FROM   TSHIPST ST                        44210025
442200                              , TSHSTYP TY                        44220025
442300                        WHERE ST.SHIPT_ID = X.SHIPT_ID            44230025
442400                          AND ST.SHIPT_STATUS_CDE =               44240025
442500                              TY.SHIPT_STATUS_CDE)                44250025
442600                 AND  Y.PRTY_CDE < '95'                           44260025
442700         END-EXEC                                                 44270025
442800                                                                  44280025
442900         EVALUATE TRUE                                            44290025
443000             WHEN SQLCODE = +100                                  44300025
443100                  SET PS-UPDATE-TIMPORL TO TRUE                   44310025
443200                                                                  44320025
443300             WHEN SQLCODE = ZERO                                  44330025
443400             WHEN SQLCODE = -904                                  44340025
443500             WHEN SQLCODE = -913                                  44350025
443600                  CONTINUE                                        44360025
443700                                                                  44370025
443800             WHEN SQLWARN0 NOT = SPACES                           44380025
443900             WHEN SQLCODE < +0                                    44390025
444000             WHEN SQLCODE > +0                                    44400025
444100                  MOVE '7060-CHECK-TSHPTOP'                       44410025
444200                                  TO DP013-PARAGRAPH              44420025
444300                  MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '         44430025
444400                                  TO DP013-MESSAGE-TEXT (1)       44440025
444500                  MOVE SQLCA      TO DP013-SQLCA                  44450025
444600                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     44460025
444700                  SET DP013-DB2-ABEND                             44470025
444800                      DP013-XCTL-DISPLAY-RESTART                  44480025
444900                                  TO TRUE                         44490025
445000                  PERFORM DP013-0000-PROCESS-ABEND                44500025
445100         END-EVALUATE.                                            44510025
445200/                                                                 44520025
445300 7070-UPDATE-TIMPORL.                                             44530025
445400                                                                  44540025
445500     PERFORM                                                      44550025
445600         WITH TEST AFTER                                          44560025
445700         VARYING PV-RETRY-COUNTER                                 44570025
445800         FROM 1 BY 1                                              44580025
445900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               44590025
446000             OR (SQLCODE = +0))                                   44600025
446100                                                                  44610025
446200         EXEC SQL                                                 44620025
446300           UPDATE TIMPORL                                         44630025
446400              SET DCONSLR_RLSE_CDE = 'N'                          44640025
446500                 ,DCONSLR_ACTL_DTE = CURRENT DATE                 44650025
446600                 ,DCONSLR_ACTL_TM  = CURRENT TIME                 44660025
446700                 ,LAST_UPD_TMST   = CURRENT TIMESTAMP             44670025
446800                 ,LAST_UPD_BY_UID = :DP020-USERID                 44680025
446900           WHERE  PO_NBR   = :DK-PO-NBR                           44690025
447000             AND  VER_STATUS_CDE = 'A'                            44700025
447100         END-EXEC                                                 44710025
447200                                                                  44720025
447300         EVALUATE TRUE                                            44730025
447400             WHEN SQLCODE = +0                                    44740025
447500             WHEN SQLCODE = -904                                  44750025
447600             WHEN SQLCODE = -913                                  44760025
447700                 CONTINUE                                         44770025
447800                                                                  44780025
447900             WHEN SQLWARN0 NOT = SPACES                           44790025
448000             WHEN SQLCODE < +0                                    44800025
448100             WHEN SQLCODE > +0                                    44810025
448200                 MOVE '7070-UPDATE-TIMPORL'                       44820025
448300                                   TO DP013-PARAGRAPH             44830025
448400                 MOVE 'UPDATE INFO ON TIMPORL     '               44840025
448500                                   TO DP013-MESSAGE-TEXT(1)       44850025
448600                 MOVE SQLCA        TO DP013-SQLCA                 44860025
448700                 MOVE 'TIMPORL'    TO DP013-DB2-TABLE-NAME (1)    44870025
448800                 SET DP013-DB2-ABEND                              44880025
448900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           44890025
449000                 PERFORM DP013-0000-PROCESS-ABEND                 44900025
449100         END-EVALUATE                                             44910025
449200     END-PERFORM.                                                 44920025
449300                                                                  44930025
449400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    44940025
449500         SQLCODE NOT = +0                                         44950025
449600         MOVE '7070-UPDATE-TIMPORL'                               44960025
449700                                   TO DP013-PARAGRAPH             44970025
449800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              44980025
449900                                   TO DP013-MESSAGE-TEXT (1)      44990025
450000         MOVE 'TO UPDATE A TIMPORL ROW'                           45000025
450100                                   TO DP013-MESSAGE-TEXT (2)      45010025
450200         MOVE SQLCA                TO DP013-SQLCA                 45020025
450300         MOVE 'TIMPORL'            TO DP013-DB2-TABLE-NAME (1)    45030025
450400         SET DP013-DB2-ABEND                                      45040025
450500             DP013-XCTL-DISPLAY-RESTART                           45050025
450600                                   TO TRUE                        45060025
450700         PERFORM DP013-0000-PROCESS-ABEND                         45070025
450800     END-IF.                                                      45080025
450900/                                                                 45090025
451000*----------------------------------------------------------------*45100025
451100* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *45110025
451200*----------------------------------------------------------------*45120025
451300                                                                  45130025
451400 9100-READ-SEL-QUEUE.                                             45140025
451500     EXEC CICS                                                    45150025
451600         READQ TS                                                 45160025
451700             QUEUE (ASC-SEL-QUEUE-NAME)                           45170025
451800             INTO  (RC013-DC-SELECT-RECORD)                       45180025
451900             ITEM  (ASC-SEL-ITEM)                                 45190025
452000             RESP  (PV-CICS-RESPONSE)                             45200025
452100     END-EXEC.                                                    45210025
452200                                                                  45220025
452300     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   45230025
452400     OR  PV-CICS-RESPONSE EQUAL DFHRESP(QIDERR)                   45240025
452500         CONTINUE                                                 45250025
452600     ELSE                                                         45260025
452700         SET DP013-LOGIC-ABEND                                    45270025
452800             DP013-NO-ROLLBACK     TO TRUE                        45280025
452900         MOVE '9100-READ-SEL-QUEUE'                               45290025
453000                                   TO DP013-PARAGRAPH             45300025
453100         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   45310025
453200                                   TO DP013-MESSAGE-TEXT (1)      45320025
453300         PERFORM DP013-0000-PROCESS-ABEND                         45330025
453400     END-IF.                                                      45340025
453500                                                                  45350025
453600/                                                                 45360025
453700*----------------------------------------------------------------*45370025
453800* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *45380025
453900*----------------------------------------------------------------*45390025
454000 9200-REWRITE-LIST-QUEUE.                                         45400025
454100                                                                  45410025
454200     EXEC CICS                                                    45420025
454300          WRITEQ TS                                               45430025
454400              QUEUE  (ASC-SEL-QUEUE-NAME)                         45440025
454500              FROM   (RC013-DC-SELECT-RECORD)                     45450025
454600              ITEM   (ASC-SEL-ITEM)                               45460025
454700              RESP   (PV-CICS-RESPONSE)                           45470025
454800              REWRITE                                             45480025
454900     END-EXEC.                                                    45490025
455000                                                                  45500025
455100     IF PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                    45510025
455200     OR PV-CICS-RESPONSE EQUAL DFHRESP(ITEMERR)                   45520025
455300         CONTINUE                                                 45530025
455400     ELSE                                                         45540025
455500         SET DP013-CICS-ABEND                                     45550025
455600             DP013-NO-ROLLBACK     TO TRUE                        45560025
455700         MOVE '9200-REWRITE-LIST-QUEUE'                           45570025
455800                                   TO DP013-PARAGRAPH             45580025
455900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   45590025
456000                                   TO DP013-MESSAGE-TEXT (1)      45600025
456100         PERFORM DP013-0000-PROCESS-ABEND                         45610025
456200     END-IF.                                                      45620025
456300                                                                  45630025
456400/                                                                 45640025
456500*----------------------------------------------------------------*45650025
456600*    ABEND PROCESSOR MODULE                                      *45660025
456700*----------------------------------------------------------------*45670025
456800                                                                  45680025
456900     COPY DPPD013.                                                45690025
