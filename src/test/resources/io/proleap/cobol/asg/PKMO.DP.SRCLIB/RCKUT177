000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             RCKUT177.                                00050000
000600 AUTHOR.                 RON KRIER.                               00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            MAY 2021.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*  THIS PROGRAM WILL BE USED TO TAKE IN A COMMA DELIMTED FILE   * 00120000
001300*  FROM SEPHORA AND CONFIRM THAT THE FILE IS BEING PROCESSED IN * 00130003
001400*  FULL.  THIS MEANS THAT WE WILL CYCLE THRU THE INPUT FILE     * 00140000
001500*  WHICH ACTUALLY COULD CONTAIN 1 TO MANY INDIVIDUAL FILES      * 00150000
001600*  FROM SEPHORA AND WILL READ THE FILE COUNTING THE DETAIL TYPE * 00160000
001700*  RECORDS (A 'D' IN THE FIRST COLUMN) UNTIL A TOTAL TYPE       * 00170000
001800*  RECORD (A 'T' IN THE FIRST COLUMN) IS FOUND AND THEN COMPARE * 00180000
001900*  WHAT WAS COUNTED TO THE COUNT FIELD ON THE TOTAL RECORD TO   * 00190000
002000*  ENSURE THE ENTIRE FILE WAS RECEIVED.  IF THERE IS A          * 00200000
002100*  MISMATCH, THEN THE PROGRAM WILL PASS A RETURN CODE AND THE   * 00210000
002200*  REST OF THE STEPS IN THE JOB WILL NOT EXECUTE DUE TO BAD     * 00220000
002300*  DATA.                                                        * 00230000
002400*                                                               * 00240000
002500*  IT SHOULD BE NOTED THAT THERE CAN BE 1 TO MANY GROUPINGS OF  * 00250000
002600*  'D' AND 'T' RECORDS SINCE WHEN THIS PROGRAM RUNS, IT WILL    * 00260000
002700*  PULL IN ALL GENERATIONS OF A GDG FILE WHICH CAN THEN BE 1    * 00270000
002800*  TO MANY DATA FILES FROM SEPHORA.                             * 00280000
002900*                                                               * 00290000
003000*  THE INPUT RECORDS WILL BE WRITTEN TO AN OUTPUT FILE BUT AT   * 00300000
003100*  THE BEGINNING OF THE OUTPUT RECORD, A FILE NAME FIELD WILL   * 00310000
003200*  BE ADDED WHICH WILL BE USED IN THE PROCESS TO RECOGNIZE      * 00320000
003300*  DIFFERENT FILES BEING PROCESSED AND HELP IN DEFINING THE     * 00330000
003400*  BOL NUMBER ASSOCIATED WITH THE DATA.                         * 00340000
003500***************************************************************** 00350000
263784* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00352010
263784* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00353010
263784* MAKING THE CALL DYNAMIC VS STATIC.                              00354010
263784*---------------------------------------------------------------* 00355010
003600                                                                  00360000
003700 ENVIRONMENT DIVISION.                                            00370000
003800                                                                  00380000
003900 CONFIGURATION SECTION.                                           00390000
004000                                                                  00400000
004100 SOURCE-COMPUTER.        IBM-3090.                                00410000
004200 OBJECT-COMPUTER.        IBM-3090.                                00420000
004300                                                                  00430000
004400 INPUT-OUTPUT SECTION.                                            00440000
004500                                                                  00450000
004600 FILE-CONTROL.                                                    00460000
004700                                                                  00470000
004800     SELECT SHIPPED-MDSE-CSV-INPUT-FILE                           00480000
004900         ASSIGN TO INP01.                                         00490000
005000                                                                  00500000
005100     SELECT SHIPPED-MDSE-CSV-OUTPUT-FILE                          00510000
005200         ASSIGN TO OUT01.                                         00520000
005300                                                                  00530000
005400******************************************************************00540000
005500 DATA DIVISION.                                                   00550000
005600******************************************************************00560000
005700                                                                  00570000
005800 FILE SECTION.                                                    00580000
005900                                                                  00590000
006000 FD  SHIPPED-MDSE-CSV-INPUT-FILE                                  00600000
006100     RECORDING MODE IS F                                          00610000
006200     LABEL RECORDS ARE STANDARD                                   00620000
006300     BLOCK CONTAINS 0 RECORDS.                                    00630000
006400 01  SHIPPED-MDSE-CSV-INPUT-RECORD    PIC  X(100).                00640000
006500                                                                  00650000
006600 FD  SHIPPED-MDSE-CSV-OUTPUT-FILE                                 00660000
006700     RECORDING MODE IS F                                          00670000
006800     BLOCK CONTAINS 0  RECORDS.                                   00680000
006900 01  SHIPPED-MDSE-CSV-OUTPUT-RECORD   PIC  X(121).                00690000
007000                                                                  00700000
007100 WORKING-STORAGE SECTION.                                         00710000
007200                                                                  00720000
007300 01  FILLER                      PIC  X(46)    VALUE              00730000
007400     '** WORKING STORAGE FOR RCKUT177 STARTS HERE **'.            00740000
007500                                                                  00750000
007600 01  PROGRAM-SWITCHES.                                            00760000
007700     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00770000
007800         88  PS-END-OF-FILE                        VALUE 'Y'.     00780000
007900     05  PS-ERROR-FOUND-SW           PIC  X(01)    VALUE 'N'.     00790000
008000         88  PS-ERROR-FOUND                        VALUE 'Y'.     00800000
008010     05  PS-RECORD-ERROR-SW          PIC  X(01)    VALUE 'N'.     00801000
008020         88  PS-RECORD-ERROR-FOUND                 VALUE 'Y'.     00802000
008030         88  PS-RECORD-NO-ERROR                    VALUE 'N'.     00803000
008040     05  PS-NUMERIC-ERROR-SW         PIC X(01)     VALUE 'N'.     00804000
008050         88  PS-NUMERIC-ERROR-NO                   VALUE 'N'.     00805000
008060         88  PS-NUMERIC-ERROR-YES                  VALUE 'Y'.     00806000
008100                                                                  00810000
008200 01  PC-CONSTANTS.                                                00820000
008300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00830000
008400                                                   'RCKUT177'.    00840000
008500     05  PC-COMMA                    PIC X(01)     VALUE ','.     00850000
008600     05  PC-D                        PIC X(01)     VALUE 'D'.     00860000
008700     05  PC-T                        PIC X(01)     VALUE 'T'.     00870000
008710     05  PC-PROGRESSIVE-READ-LIMIT   PIC S9(9)     VALUE 1000     00871009
008720                                                    COMP-3.       00872009
008800                                                                  00880000
008900 01  PV-UNSTRING-FIELDS.                                          00890000
009000     05  PV-RECORD-TYPE              PIC   X(01)    VALUE SPACES. 00900000
009100     05  PV-RECORD-QTY               PIC   X(07)    VALUE SPACES. 00910000
009110     05  PV-RECORD-FILLER            PIC   X(05)    VALUE SPACES. 00911000
009200                                                                  00920000
009300 01  PV-ABEND-FIELDS.                                             00930000
009400     05  PV-ABEND-CODE               PIC S9(04)  VALUE ZERO       00940000
009500                                                   COMP SYNC.     00950000
009600     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    00960000
009700     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'RCKUT177'.00970000
009800     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00980000
009900     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00990000
010000     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    01000000
010100     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    01010004
010200     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    01020004
010300     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01030000
010400     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      01040000
010500                                                                  01050000
010600 01  PV-MISC-FIELDS.                                              01060000
010700     05  PV-READ-COUNT               PIC  S9(9)     VALUE ZERO    01070000
010800                                                    COMP-3.       01080000
010900     05  PV-READ-TOTAL-COUNT         PIC  S9(9)     VALUE ZERO    01090000
011000                                                    COMP-3.       01100000
011100     05  PV-READ-DETL-COUNT          PIC  S9(9)     VALUE ZERO    01110000
011200                                                    COMP-3.       01120000
011300     05  PV-READ-OTHR-COUNT          PIC  S9(9)     VALUE ZERO    01130000
011400                                                    COMP-3.       01140000
011410     05  PV-PROGRESSIVE-READ-COUNT   PIC  S9(9)     VALUE ZERO    01141009
011420                                                    COMP-3.       01142009
011500     05  PV-GOOD-WRITE-COUNT         PIC  S9(9)     VALUE ZERO    01150000
011600                                                    COMP-3.       01160000
011700     05  PV-SEQUENCE-NBR             PIC   9(06)    VALUE ZERO.   01170000
011710     05  PV-DETAIL-COUNT             PIC  S9(9)     VALUE ZERO    01171000
011720                                                    COMP-3.       01172000
011730     05  PV-COMMA-COUNT              PIC  S9(04)    VALUE +0      01173001
011740                                                    COMP SYNC.    01174001
011750     05  PV-TOTAL-RECORD-QTY         PIC  S9(9)     VALUE ZERO    01175001
011760                                                    COMP-3.       01176001
011800     05  PV-CURRENT-TMST-DB2         PIC X(26)     VALUE SPACE.   01180000
011900     05  PV-CURRENT-TMST.                                         01190000
012000         10  PV-CURR-DATE.                                        01200000
012100             15  PV-CURR-DATE-YYYY   PIC  9(04)    VALUE ZERO.    01210000
012200             15  PV-CURR-DASH1       PIC  X        VALUE SPACE.   01220000
012300             15  PV-CURR-DATE-MM     PIC  9(02)    VALUE ZERO.    01230000
012400             15  PV-CURR-DASH2       PIC  X        VALUE SPACE.   01240000
012500             15  PV-CURR-DATE-DD     PIC  9(02)    VALUE ZERO.    01250000
012600             15  PV-CURR-DASH3       PIC  X        VALUE SPACE.   01260000
012700         10  PV-CURR-TIME.                                        01270000
012800             15  PV-CURR-TIME-HH     PIC  9(02)    VALUE ZERO.    01280000
012900             15  PV-CURR-TIME-P1     PIC  X        VALUE SPACE.   01290000
013000             15  PV-CURR-TIME-MM     PIC  9(02)    VALUE ZERO.    01300000
013100             15  PV-CURR-TIME-P2     PIC  X        VALUE SPACE.   01310000
013200             15  PV-CURR-TIME-SS     PIC  9(02)    VALUE ZERO.    01320000
013300             15  FILL                PIC  X(07)    VALUE SPACE.   01330000
013400                                                                  01340000
013410     05  PV-PREV-RECORD-TYPE         PIC   X(1)     VALUE SPACE.  01341000
013500     05  PV-DB2-COUNT                PIC  S9(9)    VALUE ZERO     01350000
013600                                                   COMP-3.        01360000
013700     05  PV-DISP-NBR-C               PIC  ZZ,ZZZ,ZZ9.             01370000
013800     05  PV-DISP-NBR-C2              PIC  ZZ,ZZZ,ZZ9.             01380000
013900     05  PV-DISP-NBR                 PIC  ZZZZZZZ9.               01390000
014000     05  PV-DISP-NBR-15              PIC  999999999999999.        01400000
014100     05  PV-DISP-NBR-10              PIC  9999999999.             01410000
014200     05  PV-DISP-NBR-8               PIC  99999999.               01420000
014300     05  PV-DISP-NBR-18              PIC  999999999999999999.     01430000
014400     05  PV-DISP-NBR-4               PIC  9999.                   01440000
014500                                                                  01450000
014600                                                                  01460000
014700******************************************************************01470000
014800*  COPYBOOKS.                                                     01480000
014900******************************************************************01490000
015010                                                                  01501000
015020*----------------------------------------------------------------*01502000
015030*    NUMERIC EDIT ROUTINE LAYOUT                                  01503000
015040*----------------------------------------------------------------*01504000
015050     COPY DPWS010I.                                               01505000
015060                                                                  01506000
015100*----------------------------------------------------------------*01510000
015200*    SHIPPED MERCHANDISE CSV INPUT FILE LAYOUT                    01520000
015300*----------------------------------------------------------------*01530000
015400     COPY RCRD106.                                                01540000
015500                                                                  01550000
015600*----------------------------------------------------------------*01560000
015700*    SHIPPED MERCHANDISE CSV OUTPUT FILE LAYOUT                   01570000
015800*----------------------------------------------------------------*01580000
015900     COPY RCRD107.                                                01590000
016000                                                                  01600000
016100***************************************************************** 01610000
016200*  *** DB2 MESSAGE AREAS ****                                   * 01620000
016300***************************************************************** 01630000
016400     COPY DPWS004.                                                01640000
016500                                                                  01650000
016600*---------------------------------------------------------------* 01660000
016700*    DB2 AREA FOR COMMUNICATIONS                                * 01670000
016800*---------------------------------------------------------------* 01680000
016900     EXEC SQL                                                     01690000
017000          INCLUDE SQLCA                                           01700000
017100     END-EXEC.                                                    01710000
017200                                                                  01720000
017300***************************************************************** 01730000
017400                                                                  01740000
017500 LINKAGE SECTION.                                                 01750000
017600                                                                  01760000
017700***************************************************************** 01770000
017800 PROCEDURE DIVISION.                                              01780000
017900***************************************************************** 01790000
018000                                                                  01800000
018100 0000-MAINLINE-PROCESSING.                                        01810000
018200                                                                  01820000
018300     DISPLAY '** START OF PROGRAM RCKUT177 **'.                   01830002
018400                                                                  01840000
018410     MOVE PC-PROGRESSIVE-READ-LIMIT TO PV-DISP-NBR.               01841009
018420     DISPLAY 'PROGRESSIVE READ DISPLAY TRIGGER IS:  '             01842009
018430             PV-DISP-NBR.                                         01843009
018440                                                                  01844009
018500     PERFORM 1000-INITIALIZATION.                                 01850000
018600                                                                  01860000
018700     PERFORM 2000-PROCESS-EXTRACT-RECS                            01870000
018800       UNTIL PS-END-OF-FILE.                                      01880000
018900                                                                  01890000
019000     IF  PV-READ-COUNT = 0                                        01900000
019100         DISPLAY '*** EMPTY INPUT FILE ***'                       01910000
019200     ELSE                                                         01920000
019300         IF  PV-PREV-RECORD-TYPE = PC-T                           01930000
019400             NEXT SENTENCE                                        01940000
019500         ELSE                                                     01950000
019600             MOVE PV-READ-COUNT       TO PV-DISP-NBR              01960000
019700             DISPLAY RC106-SHIPPED-MDSE-CSV-REC                   01970001
019800             DISPLAY 'LAST RECORD ON FILE WAS NOT'                01980000
019900                     ' A TOTAL RECORD'                            01990000
020000             DISPLAY ' '                                          02000000
020700             SET PS-ERROR-FOUND TO TRUE                           02070000
021100         END-IF                                                   02110000
021200     END-IF.                                                      02120000
021500                                                                  02150000
021600     PERFORM 8500-SHOW-COUNTERS.                                  02160000
021700                                                                  02170000
021800     CLOSE SHIPPED-MDSE-CSV-INPUT-FILE                            02180000
021900           SHIPPED-MDSE-CSV-OUTPUT-FILE.                          02190000
022000                                                                  02200000
022001     IF  PS-ERROR-FOUND                                           02200100
022010         MOVE 4008 TO RETURN-CODE                                 02201008
022020     END-IF.                                                      02202000
022030                                                                  02203000
022100     STOP RUN.                                                    02210000
022200                                                                  02220000
022201                                                                  02220103
022210******************************************************************02221003
022220*  OPEN FILES AND READ THE FIRST INPUT RECORD                    *02222003
022230******************************************************************02223003
022300 1000-INITIALIZATION.                                             02230000
022800                                                                  02280000
022900     OPEN INPUT  SHIPPED-MDSE-CSV-INPUT-FILE.                     02290000
023000     OPEN OUTPUT SHIPPED-MDSE-CSV-OUTPUT-FILE.                    02300000
023100                                                                  02310000
023200** GET CURRENT TIMESTAMP                                          02320000
023300                                                                  02330000
023400     EXEC SQL                                                     02340000
023500         SET :PV-CURRENT-TMST-DB2 = CURRENT TIMESTAMP             02350000
023600     END-EXEC.                                                    02360000
023700                                                                  02370000
023800     EVALUATE TRUE                                                02380000
023900         WHEN SQLCODE = ZERO                                      02390000
024000             MOVE PV-CURRENT-TMST-DB2    TO PV-CURRENT-TMST       02400000
024100             DISPLAY 'CURRENT TIMESTAMP IS: '                     02410000
024200                     PV-CURRENT-TMST-DB2                          02420000
024300         WHEN OTHER                                               02430000
024400             MOVE '1000-INITIALIZATION'  TO PV-ABEND-PARAGRAPH    02440000
024500             MOVE 'SET CURRENT TIMESTAMP'                         02450000
024600                                         TO PV-ABEND-OPERATION    02460000
024700             PERFORM 9900-DB2-ABEND                               02470000
024800         END-EVALUATE.                                            02480000
024900                                                                  02490000
025000     MOVE 1 TO PV-SEQUENCE-NBR.                                   02500000
025100                                                                  02510000
025200     PERFORM 7000-READ-INPUT.                                     02520000
025300                                                                  02530000
025400     IF  PS-END-OF-FILE                                           02540000
025500         NEXT SENTENCE                                            02550000
025600     ELSE                                                         02560000
025700         IF  RC106-TOTAL-RECORD                                   02570000
025800             SET PS-ERROR-FOUND TO TRUE                           02580000
025900             DISPLAY 'FIRST RECORD OF THE FILE IS A TOTAL'        02590000
026000                     ' RECORD - DATA ERROR'                       02600000
026100             DISPLAY 'FILE CANNOT BE PROCESSED'                   02610000
026200         END-IF                                                   02620000
026300     END-IF.                                                      02630000
026400                                                                  02640000
026401                                                                  02640103
026410******************************************************************02641003
026420* THIS PARAGRAPH WILL CONTROL THE PROCESSING OF THE INPUT        *02642003
026421* RECORDS.  AS IT READS DETAIL RECORDS, IT WILL TALLY EACH       *02642103
026422* RECORD SO THAT WHEN IT GETS TO THE TOTAL RECORD, THE PROGRAM   *02642203
026423* WILL VALIDATE THE NUMBER OF DETAIL RECORDS READ TO THE COUNT   *02642303
026424* ON THE TOTAL RECORD AND DO WHAT NEEDS TO BE DONE IF THERE IS A *02642403
026425* DIFFERENCE.                                                    *02642503
026430******************************************************************02643003
026500 2000-PROCESS-EXTRACT-RECS.                                       02650000
026600                                                                  02660000
026700     IF  RC106-DETAIL-RECORD                                      02670000
026800         ADD +1 TO PV-DETAIL-COUNT                                02680000
026900         PERFORM 3000-PROCESS-DETAIL-RECORD                       02690000
027000     ELSE                                                         02700000
027100         IF  RC106-TOTAL-RECORD                                   02710000
027200             PERFORM 4000-PROCESS-TOTAL-RECORD                    02720000
027210             MOVE ZERO TO PV-DETAIL-COUNT                         02721000
027220             ADD 1 TO PV-SEQUENCE-NBR                             02722000
027300         ELSE                                                     02730000
027400             SET PS-ERROR-FOUND TO TRUE                           02740000
027410             MOVE PV-READ-COUNT       TO PV-DISP-NBR              02741000
027420             DISPLAY RC106-SHIPPED-MDSE-CSV-REC                   02742000
027430             DISPLAY 'AN UNKNOWN RECORD TYPE AT RECORD '          02743000
027431                     PV-DISP-NBR                                  02743100
027440                     ' RECORD TYPE WAS NOT A D OR T'              02744000
027450             DISPLAY ' SKIPPING TO NEXT RECORD'                   02745000
027460             DISPLAY ' '                                          02746000
027470             SET PS-ERROR-FOUND TO TRUE                           02747000
027480         END-IF                                                   02748000
027490     END-IF.                                                      02749000
027500                                                                  02750000
034900     PERFORM 7000-READ-INPUT.                                     03490000
035000                                                                  03500000
035001                                                                  03500103
035010******************************************************************03501003
035020* THIS PARAGRAPH WILL MOVE THE DATA FROM THE INPUT DETAIL FILE   *03502003
035030* LAYOUT (RCRD106) TO THE OUTPUT DETAIL FILE LAYOUT (RCRD107)    *03503003
035040* AND ADD A FILE NAME VALUE TO THE OUTPUT RECORD TO BE ABLE TO   *03504003
035050* RELATE THE DETAILS TO A SPECIFIC FILE BEING PROCESSED.         *03505003
035080******************************************************************03508003
035100 3000-PROCESS-DETAIL-RECORD.                                      03510000
035200                                                                  03520000
035210     SET RC107-DETAIL-RECORD TO TRUE.                             03521000
035220     MOVE PC-COMMA           TO RC107-COMMA-1.                    03522000
035230                                                                  03523000
035300     MOVE PV-CURR-DATE-YYYY  TO RC107-FILE-NAME-YEAR.             03530000
035400     MOVE PV-CURR-DATE-MM    TO RC107-FILE-NAME-MONTH.            03540000
035500     MOVE PV-CURR-DATE-DD    TO RC107-FILE-NAME-DAY.              03550000
035600     MOVE PV-CURR-TIME-HH    TO RC107-FILE-NAME-HOUR.             03560000
035700     MOVE PV-CURR-TIME-MM    TO RC107-FILE-NAME-MINUTE.           03570000
035800     MOVE PV-CURR-TIME-SS    TO RC107-FILE-NAME-SECOND.           03580000
035900                                                                  03590000
036000     MOVE PV-SEQUENCE-NBR    TO RC107-FILE-NAME-SEQ-NBR.          03600000
036100                                                                  03610000
036110     MOVE RC106-CSV-DATA     TO RC107-CSV-DATA.                   03611000
036120                                                                  03612000
040400     WRITE SHIPPED-MDSE-CSV-OUTPUT-RECORD                         04040000
040500      FROM RC107-SHIPPED-MDSE-CSV-REC.                            04050000
040510                                                                  04051000
040600     ADD +1 TO PV-GOOD-WRITE-COUNT.                               04060000
040800                                                                  04080000
115900                                                                  11590000
116000******************************************************************11600000
116100* THIS PARAGRAPH WILL PROCESS THE TOTAL TYPE RECORD AND CHECK    *11610003
116200* IF THE RECORD COUNT IN THE TOTAL RECORD MATCHES THE NUMBER     *11620003
116300* OF DETAIL RECORDS READ BY THE PROGRAM.                         *11630003
116400******************************************************************11640000
116500 4000-PROCESS-TOTAL-RECORD.                                       11650000
116600                                                                  11660000
116601     MOVE ZERO TO PV-COMMA-COUNT.                                 11660102
116602                                                                  11660202
116610     INSPECT RC106-SHIPPED-MDSE-CSV-REC                           11661000
116620         TALLYING PV-COMMA-COUNT                                  11662000
116630         FOR ALL ','                                              11663000
116640     IF  PV-COMMA-COUNT < 1                                       11664002
116641     OR  PV-COMMA-COUNT > 2                                       11664102
116650         MOVE PV-READ-COUNT       TO PV-DISP-NBR                  11665000
116660         DISPLAY RC106-SHIPPED-MDSE-CSV-REC                       11666000
116670         DISPLAY 'TOTAL INPUT RECORD NBR ' PV-DISP-NBR            11667002
116680                 ' COMMA COUNT NOT EQUAL TO A VALUE OF 1 OR 2'    11668002
116690         DISPLAY ' SKIPPING TO NEXT RECORD'                       11669000
116691         DISPLAY ' '                                              11669100
116692         SET PS-ERROR-FOUND TO TRUE                               11669200
116693         SET PS-RECORD-ERROR-FOUND TO TRUE                        11669302
116694     ELSE                                                         11669400
116695         SET PS-RECORD-NO-ERROR TO TRUE                           11669500
116696         PERFORM 4100-UNSTRING-TOTAL-RECORD                       11669600
117500     END-IF.                                                      11750000
117600                                                                  11760000
117700     IF  PS-RECORD-NO-ERROR                                       11770000
117800         PERFORM 4200-CHECK-NUMERIC-FIELDS                        11780000
117900     END-IF.                                                      11790000
118000                                                                  11800000
118100     IF  PS-RECORD-NO-ERROR                                       11810000
118200         IF  PV-TOTAL-RECORD-QTY = PV-DETAIL-COUNT                11820000
118300             DISPLAY '** DETAIL COUNT READ MATCHES COUNT ON'      11830000
118400                     ' TOTAL RECORD NUMBER: '                     11840000
118410                     PV-SEQUENCE-NBR                              11841000
118411             MOVE PV-TOTAL-RECORD-QTY TO PV-DISP-NBR-C            11841106
118412             DISPLAY 'COUNT FROM TOTAL RECORD     : '             11841207
118413                     PV-DISP-NBR-C                                11841306
118414             MOVE PV-DETAIL-COUNT    TO PV-DISP-NBR-C2            11841406
118415             DISPLAY 'COUNT OF DETAIL RECORDS READ: '             11841506
118416                     PV-DISP-NBR-C2                               11841606
118420             DISPLAY '   ==> DATA RELATED TO INTERNAL'            11842006
118430                     ' FILE NAME: ' RC107-FILE-NAME               11843005
118500         ELSE                                                     11850000
118600             MOVE PV-READ-COUNT       TO PV-DISP-NBR              11860000
118700             DISPLAY RC106-SHIPPED-MDSE-CSV-REC                   11870000
118800             DISPLAY 'TOTAL INPUT RECORD NBR ' PV-DISP-NBR        11880002
118900                     ' DETAIL COUNT NOT EQUAL TO READ COUNT'      11890000
119000             MOVE PV-TOTAL-RECORD-QTY TO PV-DISP-NBR-C            11900000
119100             DISPLAY 'COUNT FROM TOTAL RECORD     : '             11910007
119200                     PV-DISP-NBR-C                                11920000
119300             MOVE PV-DETAIL-COUNT    TO PV-DISP-NBR-C2            11930000
119400             DISPLAY 'COUNT OF DETAIL RECORDS READ: '             11940000
119500                     PV-DISP-NBR-C2                               11950000
119510             DISPLAY '   ==> DATA RELATED TO INTERNAL'            11951006
119520                     ' FILE NAME: ' RC107-FILE-NAME               11952005
119600             DISPLAY ' '                                          11960000
120600             SET PS-ERROR-FOUND TO TRUE                           12060000
120700         END-IF                                                   12070002
121000     END-IF.                                                      12100000
121100                                                                  12110000
121200                                                                  12120000
121300******************************************************************12130000
121400* UNSTRING THE DATA ON THE TOTAL RECORD.  IT IS COMMA DELIMITED  *12140003
121500* AND FIELDS NEED TO BE SEPARATED.                               *12150003
121600******************************************************************12160000
121700 4100-UNSTRING-TOTAL-RECORD.                                      12170000
121800                                                                  12180000
121910     UNSTRING RC106-SHIPPED-MDSE-CSV-REC DELIMITED BY ','         12191000
122100         INTO PV-RECORD-TYPE                                      12210000
122200              PV-RECORD-QTY                                       12220000
122300              PV-RECORD-FILLER                                    12230000
122400      ON OVERFLOW                                                 12240000
122500         MOVE PV-READ-COUNT           TO PV-DISP-NBR              12250000
122600         DISPLAY RC106-SHIPPED-MDSE-CSV-REC                       12260000
122700         DISPLAY 'INPUT TOTAL RECORD ' PV-DISP-NBR                12270000
122800                  ' HAS OVERFLOWED'                               12280000
122900         DISPLAY 'SKIPPING TO NEXT RECORD'                        12290000
123000         SET PS-ERROR-FOUND           TO TRUE                     12300001
123100     END-UNSTRING.                                                12310000
123200                                                                  12320000
123201                                                                  12320100
123210******************************************************************12321000
123220* THIS PARAGRAPH WILL CHECK THE NUMERIC FIELDS THAT WERE         *12322003
123230* UNSTRUNG FROM THE TOTAL RECORD TO ENSURE THE FIELDS CONTAIN    *12323003
123231* NUMERIC VALUES.                                                *12323103
123240******************************************************************12324000
123300 4200-CHECK-NUMERIC-FIELDS.                                       12330000
123400                                                                  12340000
123500     SET PS-NUMERIC-ERROR-NO TO TRUE.                             12350000
123600                                                                  12360000
123700* NUMERIC CHECK THE RECORD QUANTITY FIELD                         12370000
123800     MOVE PV-RECORD-QTY      TO DP010I-UNEDITED-FIELD.            12380000
123900     MOVE 7                  TO DP010I-MAXIMUM-DIGITS.            12390000
124000     MOVE 0                  TO DP010I-MAXIMUM-DECIMALS.          12400000
124100     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     12410000
263784     CALL DP010I-NUMERIC-EDIT-ROUTINE                             12421010
263784          USING DP010I-NUMERIC-EDIT-AREA.                         12422010
124300     IF  DP010I-ERROR-DETECTED                                    12430000
124400         SET PS-NUMERIC-ERROR-YES TO TRUE                         12440000
124410         SET PS-RECORD-ERROR-FOUND TO TRUE                        12441000
124500         DISPLAY RC106-SHIPPED-MDSE-CSV-REC                       12450000
124600         DISPLAY 'RECORD QUANTITY NUMERIC CHECK: ' PV-RECORD-QTY  12460000
124700         DISPLAY '** DP010I-ERROR-IND = ' DP010I-ERROR-IND        12470000
124800         DISPLAY ' '                                              12480000
124900     ELSE                                                         12490000
125000         MOVE DP010I-NUMERIC-FIELD TO PV-TOTAL-RECORD-QTY         12500000
125100     END-IF.                                                      12510000
125200                                                                  12520000
125500                                                                  12550000
125600******************************************************************12560000
125700* READ A COMMA DELIMITED INPUT RECORD.                           *12570003
125800******************************************************************12580000
125810 7000-READ-INPUT.                                                 12581002
125900                                                                  12590000
126000     READ SHIPPED-MDSE-CSV-INPUT-FILE                             12600000
126100       INTO RC106-SHIPPED-MDSE-CSV-REC                            12610000
126200         AT END                                                   12620000
126300           SET PS-END-OF-FILE TO TRUE                             12630000
126400         NOT AT END                                               12640000
126500           ADD 1                      TO PV-READ-COUNT            12650000
126510                                         PV-PROGRESSIVE-READ-COUNT12651009
126600           MOVE RC106-RECORD-TYPE     TO PV-PREV-RECORD-TYPE      12660000
126700           IF  RC106-DETAIL-RECORD                                12670000
126800               ADD 1 TO PV-READ-DETL-COUNT                        12680000
126900           ELSE                                                   12690000
127000               IF  RC106-TOTAL-RECORD                             12700000
127100                   ADD 1 TO PV-READ-TOTAL-COUNT                   12710000
127200               ELSE                                               12720000
127300                   ADD 1 TO PV-READ-OTHR-COUNT                    12730000
127400               END-IF                                             12740000
127500           END-IF                                                 12750000
127510           IF  PV-PROGRESSIVE-READ-COUNT =                        12751009
127520               PC-PROGRESSIVE-READ-LIMIT                          12752009
127530               MOVE PV-READ-COUNT TO PV-DISP-NBR                  12753009
127540               DISPLAY 'PROGRESSIVE READ COUNT IS: '              12754009
127550                       PV-DISP-NBR                                12755009
127560               MOVE ZEROS TO PV-PROGRESSIVE-READ-COUNT            12756009
127570           END-IF                                                 12757009
127600     END-READ.                                                    12760000
127700                                                                  12770000
138000                                                                  13800000
138100******************************************************************13810000
138200* SHOW RECORD COUNTS AND AMOUNTS IN SYSOUT                       *13820003
138300******************************************************************13830000
138400 8500-SHOW-COUNTERS.                                              13840000
138500     DISPLAY ' *********  RCKUT177 STATISTICS *********'          13850000
138600     MOVE PV-READ-COUNT           TO PV-DISP-NBR-C                13860000
138700     DISPLAY 'RECORDS READ             = ' PV-DISP-NBR-C.         13870000
138800     MOVE PV-READ-DETL-COUNT      TO PV-DISP-NBR-C                13880000
138900     DISPLAY 'DETAIL RECORDS READ      = ' PV-DISP-NBR-C.         13890000
139000     MOVE PV-READ-TOTAL-COUNT     TO PV-DISP-NBR-C                13900000
139100     DISPLAY 'TOTAL RECORDS READ       = ' PV-DISP-NBR-C.         13910000
139200     MOVE PV-READ-OTHR-COUNT      TO PV-DISP-NBR-C                13920000
139300     DISPLAY 'OTHER RECORDS READ       = ' PV-DISP-NBR-C.         13930000
139400     MOVE PV-GOOD-WRITE-COUNT     TO PV-DISP-NBR-C.               13940000
139500     DISPLAY 'VALID DETAIL WRITE CNT   = ' PV-DISP-NBR-C.         13950000
139800                                                                  13980000
139810                                                                  13981003
139900******************************************************************13990000
140000* DB2 ABEND ROUTINE                                              *14000003
140100******************************************************************14010000
140200 9900-DB2-ABEND.                                                  14020000
140400                                                                  14040000
140500     MOVE SQLCODE TO PV-SQLCODE.                                  14050000
140600     DISPLAY '*** DB2 ERROR '.                                    14060000
140700     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       14070000
140800     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 14080000
140900     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               14090000
141000     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               14100000
141100     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       14110000
141200     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             14120000
141300                                                                  14130000
141800     COPY DPPD004.                                                14180000
141900                                                                  14190000
142000     MOVE +4013                  TO PV-ABEND-CODE.                14200000
142100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         14210000
142200*                                                                 14220000
142300* ************************ END OF RCKUT177 ********************** 14230000
