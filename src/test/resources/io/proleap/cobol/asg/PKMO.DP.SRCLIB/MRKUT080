000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             MRKUT080.                                00050000
000600 AUTHOR.                 SUZANNE MEYER.                           00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            02-05-98.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*  FETCH & LOAD STORE TABLE, SET UP DATE TABLE FS (F4) & FISCAL;* 00120000
001300*  FETCH ALL ROWS FROM TMRITEM, CHECK SKU-RENUMB, VERIFY ITS ON * 00130000
001400*  STORE TABLE, FETCH HEADER VIA TUPCSKU, FETCH UNITS VIA       * 00140000
001500*  TSKSTWKS.                                                      00150024
001600*                                                               * 00160000
001700*  THIS PROGRAM WILL DECLARE A CURSOR TO SELECT ALL ROWS FROM   * 00170000
001800*  THE TMRITEM TABLE. THE MAIN PROGRAM LOOP WILL FETCH THE CUR- * 00180000
001900*  RENT ROW OF THE CURSOR AND DECLARE ANOTHER CURSOR WHICH SEL- * 00190000
002000*  ECTS ALL ROWS FOR THE CURRENT WEEK BEING PROCESSED. OUTPUT   * 00200000
002100*  WILL BE CREATED IN THE MRK125-SKU-HISTORY-RECORD FORMAT AND  * 00210000
002200*  SUBSEQUENTLY LOADED INTO THE APPROPRIATE MR/MDS SALES TABLES.* 00220000
002300***************************************************************** 00230000
002310*  CHANGE MADE:                                                 * 00240044
002320*  09-21-01  BY N MOULTON                                       * 00250046
002330*   BMC CHANGES: CHANGED COPYBOOK MRRD125 TO WORK WITH STANDARD * 00260044
002340*   IBM FORMAT WHICH REQUIRED CHANGES TO SOME PROGRAM VARIABLES.* 00270044
002390***************************************************************** 00280044
002400*  CHANGE MADE:                                                 * 00290036
002500*  03-30-00  BY A KINTOPF                                       * 00300036
002600*   ADDED CODE TO CHECK THE TUPCPLS STATUS FRO REGIONAL         * 00310042
002700*   CLEARANCE PRICING                                           * 00320036
002800***************************************************************** 00330036
004500* CHANGED 08/14/98 BY PAUL KEBER - STRATAGEM                      00340024
004600*   WR# 6041                                                      00350024
004700*       AS PART OF Y2K CHANGES, UPDATED PROGRAM TO ACCESS         00360024
004800*       THE NEW WEEKLY SALES TABLE - TSKSTWKS AND REPLACED        00370024
004801*       SALES_INDCT FIELD WITH NEW DATE FIELD FSCL_BOW_DTE.       00380024
004802*       ELIMINATED THE D200-FASHION-DATE ROUTINE BY USING         00390024
004803*       DPG55-1ST-WKDY-DB2ISO-FMT FROM THE D100-FISCAL-DATE CALL  00400024
004804*       AS THE CURRENT FASHION SALES DATE.                        00410024
004805***************************************************************** 00420024
004806* CHANGED 07/01/02 BY DON TOMLINSON                               00340024
004807*   WR# NI-SKU PROJECT                                            00350024
004812*       ADD TSKXREF FOR DEPT, SUBCLASS, AND SKU.                  00400024
004814*       SEE D300-SELECT-TSK FOR CHANGES. RETURN ONLY SKU. NO              
004815*       NEED TO RETURN DEPT OR SUBCLASS.                                  
004816***************************************************************** 00420024
004806* CHANGED 06/21/04 BY BOB FORD                                    00340024
004807*   WR# 26363 STORE NUMBER EXPANSION                              00350024
004812*       MODIFIED PROGRAM TO HANDLE 5-DIGIT STORES.  CHANGED WORK  00400024
004814*       FIELDS, TABLE SIZES, REPLACED TSTR00 WITH XMT_LOC, USE            
004815*       XMT_STR_GP_MBSHP TO GET METRO ID.                                 
004816***************************************************************** 00420024
004806* CHANGED 06/16/05 BY CHRIS LEADLEY                               00340024
004807*   WR# 26363 STORE NUMBER EXPANSION                              00350024
004812*       REMOVED SELECTION ON SPECIFIC DEPARTMENTS FROM THE        00400024
004814*       TMRITEM CURSOR SO THAT ITEMS FOR ALL DEPARTMENTS ARE              
004815*       EXTRACTED (ALONG WITH THEIR SALES FOR THE WEEK).                  
004815*       THIS WAS LEFT BEHIND FROM SNE TESTING.                            
      ***************************************************************** 00420024
      * CHANGED 04/01/11 BY JACK KRAMER                                 00340024
      *   WR# 38972 - MLOF                                              00350024
      *       ADDED E_BUS_IND TO STORE CURSOR. IF THE INPUT STORE NBR   00400024
      *       IS AN E_BUS LOCATION - SET THE STORE INDEX TO THE EFC     00400024
      *       CHANNEL NUMBER (873).                                     00400024
004816***************************************************************** 00420024
004817 ENVIRONMENT DIVISION.                                            00430000
004818***************************************************************** 00440000
004819                                                                  00450000
004820 CONFIGURATION SECTION.                                           00460000
004821                                                                  00470000
004822 SOURCE-COMPUTER.        IBM-3090.                                00480000
004823 OBJECT-COMPUTER.        IBM-3090.                                00490000
004824                                                                  00500000
004825 INPUT-OUTPUT SECTION.                                            00510000
004826                                                                  00520000
004827 FILE-CONTROL.                                                    00530000
004828                                                                  00540000
004829*                                                                 00550000
004830     SELECT VALID-SALES-FILE      ASSIGN TO OUT01.                00560000
004831*                                                                 00570000
004832***************************************************************** 00580000
004833 DATA DIVISION.                                                   00590000
004834***************************************************************** 00600000
004835*                                                                 00610000
004836 FILE SECTION.                                                    00620000
004837                                                                  00630000
004838 FD  VALID-SALES-FILE                                             00640000
004839     RECORDING MODE F                                             00650000
004840     BLOCK CONTAINS 0 RECORDS                                     00660000
004850     RECORD CONTAINS 200 CHARACTERS                               00670000
004900     LABEL RECORDS ARE STANDARD.                                  00680000
005000                                                                  00690000
005100 01  VALID-SALES-REC                  PIC X(200).                 00700000
005200                                                                  00710000
005300*                                                                 00720000
005400******************************************                        00730000
005500 WORKING-STORAGE SECTION.                                         00740000
005600******************************************                        00750000
005700*                                                                 00760000
005800                                                                  00770000
005900* OUTPUT MERCHANDISE REPLENISHMENT SALES RECORD                   00780000
006000 EJECT                                                            00790000
006100     COPY MRRD125.                                                00800000
006200                                                                  00810000
006800******************************************                        00820000
006900* COPYBOOKS FOR THE CALENDAR ROUTINE                              00830000
007000******************************************                        00840000
007200     COPY DPWS500.                                                00850000
007300                                                                  00860000
007400   01  FILLER.                                                    00870000
007500       05  FILLER                      PIC  X(36)    VALUE        00880000
007600           ' ***** WORKING STORAGE PGM=MRKUT080 '.                00890000
007700       05  FILLER                      PIC  X(10)    VALUE        00900000
007800           ' LOCATION='.                                          00910000
007900       05  PGM-LOCATION                PIC  X(04)    VALUE SPACES.00920000
008000       05  FILLER                      PIC  X(06)    VALUE        00930000
008100           ' *****'.                                              00940000
008200                                                                  00950000
008300 01  PROGRAM-SWITCHES.                                            00960000
008400                                                                  00970000
008500     05  PS-EOF-TMRITEM-CSR            PIC  X(01)    VALUE 'N'.   00980000
008600         88  EOF-TMRITEM-CSR                         VALUE 'Y'.   00990000
008700         88  NOT-EOF-TMRITEM-CSR                     VALUE 'N'.   01000000
008800                                                                  01010000
008900     05  PS-EOF-UPC-SKU-CSR            PIC  X(01)    VALUE 'N'.   01020000
009000         88  EOF-UPC-SKU-CSR                         VALUE 'Y'.   01030000
009100         88  NOT-EOF-UPC-SKU-CSR                     VALUE 'N'.   01040000
009200                                                                  01050000
009300     05  PS-TUPCSZ-SWITCH              PIC  X(01)    VALUE 'N'.   01060000
009400         88  PS-EOF-TUPCSZ                           VALUE 'Y'.   01070000
009500         88  NOT-EOF-TUPCSZ                          VALUE 'N'.   01080000
009600                                                                  01090000
009700     05  PS-TSK-SWITCH                 PIC  X(01)    VALUE 'N'.   01100000
009800         88  EOF-TSK                                 VALUE 'Y'.   01110000
009900         88  NOT-EOF-TSK                             VALUE 'N'.   01120000
010000                                                                  01130000
010100     05  PS-HEADER-INFO-SWITCH         PIC  X(01)    VALUE 'N'.   01140000
010200         88  PS-HEADER-INFO-NOT-COMPLETE             VALUE 'Y'.   01150000
010300         88  PS-HEADER-INFO-COMPLETE                 VALUE 'N'.   01160000
010400                                                                  01170000
010500     05  PS-TVNDSTL-TENTNME-SWITCH     PIC  X(01)    VALUE 'N'.   01180000
010600         88  EOF-TVNDSTL-TENTNME                     VALUE 'Y'.   01190000
010700         88  NOT-EOF-TVNDSTL-TENTNME                 VALUE 'N'.   01200000
010800                                                                  01210000
010900*    05  PS-TVSCHL-SWITCH              PIC  X(01)    VALUE 'N'.   01220032
011000*        88  EOF-TVSCHVL                             VALUE 'Y'.   01230032
011100*        88  NOT-EOF-TVSCHVL                         VALUE 'N'.   01240032
011200                                                                  01250000
011300     05  PS-TVSCHL-SEASON-SWITCH       PIC  X(01)    VALUE 'N'.   01260000
011400         88  EOF-TVSCHVL-SEASON                      VALUE 'Y'.   01270000
011500         88  NOT-EOF-TVSCHVL-SEASON                  VALUE 'N'.   01280000
011600                                                                  01290000
011700     05  PS-STORE-TABLE-SWITCH         PIC  X(01)    VALUE 'N'.   01300000
011800         88  STORE-FOUND                             VALUE 'Y'.   01310000
011900         88  STORE-NOT-FOUND                         VALUE 'N'.   01320000
012000                                                                  01330000
012100     05  PS-MHT-DLY-SLS-SWITCH         PIC  X(01)    VALUE 'N'.   01340024
012200         88  MHT-DLY-SLS-FOUND                       VALUE 'Y'.   01350024
012300         88  MHT-DLY-SLS-NOT-FOUND                   VALUE 'N'.   01360024
012400                                                                  01370000
012500     05  PS-EOF-STORE-CSR              PIC  X(01)    VALUE 'N'.   01380000
012600         88  EOF-STORE-CSR                           VALUE 'Y'.   01390000
012700                                                                  01400000
012800     05  PS-EOF-FS-FILE                PIC  X(01)    VALUE 'N'.   01410000
012900         88  EOF-IS-REACHED                          VALUE 'Y'.   01420000
013000                                                                  01430000
013100 01  PC-CONSTANTS.                                                01440000
013200     05  PC-ROW-NOT-FOUND              PIC  S9(04)   VALUE +100   01450000
013300                                                     COMP SYNC.   01460000
013400     05  PC-N                          PIC  X(01)    VALUE 'N'.   01470000
013500     05  PC-Y                          PIC  X(01)    VALUE 'Y'.   01480000
013600     05  PC-STORE-QUANTITY             PIC  S9(5)    VALUE 99999. 01490000
013700     05  PC-CORP-STORE                 PIC  S9(4) COMP.           01500000
           05  PC-ECOMM-CHANNEL         PIC S9(04) VALUE 873 COMP SYNC.         
013800                                                                  01510000
013900                                                                  01520000
014000 01  WS-COUNT-FIELDS.                                             01530000
014100     05 WS-COUNTER                     PIC S9(03)    VALUE +0     01540000
014200                                                     COMP-3.      01550000
014300     05 WS-MR-RECORDS-IN               PIC  9(9)     VALUE ZERO.  01560025
014400     05 WS-MR-RECORDS-CREATED          PIC  9(9)     VALUE ZERO.  01570025
014500     05 WS-MR-RECORDS-BYPASSED         PIC  9(9)     VALUE ZERO.  01580025
014600                                                                  01590000
017100*                                                                 01600000
017200 01  CC-DATE.                                                     01610000
017300     05  CC-DATE-CC                    PIC 9(02)     VALUE ZEROS. 01620000
017400     05  CC-DATE-YR                    PIC 9(02)     VALUE ZEROS. 01630000
017410     05  FILLER                        PIC X(01)     VALUE '-'.   01640000
017500     05  CC-DATE-MO                    PIC 9(02)     VALUE ZEROS. 01650000
017510     05  FILLER                        PIC X(01)     VALUE '-'.   01660000
017600     05  CC-DATE-DY                    PIC 9(02)     VALUE ZEROS. 01670000
017700                                                                  01680000
018200 01  PV-MISC-FIELDS.                                              01690000
018300     05  PV-ABEND-CODE                 PIC S9(04)    VALUE ZERO   01700000
018400                                                     COMP SYNC.   01710000
018500     05  PV-ABEND-PARAGRAPH            PIC  X(30)    VALUE SPACES.01720000
018600                                                                  01730000
018700                                                                  01740000
018800*    05  PV-FASHION-CODE               PIC  X(20)    VALUE SPACES.01750031
018900                                                                  01760000
019000     05  PV-SEASON-CODE                PIC  X(20)    VALUE SPACES.01770000
044600     05  PV-NULL-IND1                  PIC S9(04)  COMP VALUE +0.         
019100*                                                                 01780000
019200 01 WS-VARIABLES.                                                 01790000
019300                                                                  01800000
020000     05 PV-CURRENT-FSCL-BOW-DATE       PIC  X(10)  VALUE SPACES.  01850024
020000     05 PV-CURRENT-FSCL-EOW-DATE       PIC  X(10)  VALUE SPACES.  01850024
           05 PV-FSCL-EOW-DATE               PIC  X(10)  VALUE SPACES.          
           05 PV-FSCL-BOW-DATE               PIC  X(10)  VALUE SPACES.          
           05 PV-FSCL-EOW-DATE-1             PIC  X(10)  VALUE SPACES.          
           05 PV-FSCL-EOW-DATE-2             PIC  X(10)  VALUE SPACES.          
           05 PV-FSCL-EOW-DATE-3             PIC  X(10)  VALUE SPACES.          
           05 PV-FSCL-EOW-DATE-4             PIC  X(10)  VALUE SPACES.          
           05 PV-FSCL-EOW-DATE-5             PIC  X(10)  VALUE SPACES.          
           05 PV-FSCL-EOW-DATE-6             PIC  X(10)  VALUE SPACES.          
020001                                                                  01860024
020002**   05 PV-CURRENT-FS-DATE.                                       01870024
020100**      10  PV-FS-YY                   PIC  9(02).                01880024
020200**      10  PV-FS-WW                   PIC  9(02).                01890024
020300**                                                                01900024
020400**   05 PV-CURRENT-FS-DATE-ALPHA                                  01910024
020500**          REDEFINES PV-CURRENT-FS-DATE                          01920024
020600**                                     PIC  X(04).                01930024
020700**                                                                01940024
020800**   05 PV-FS-DATE.                                               01950024
020900**      10  PV-FS-CENT                 PIC  9(02).                01960024
021000**      10  PV-FS-YEAR                 PIC  9(02).                01970024
021100**      10  PV-FS-FILLER               PIC  9(04).                01980024
021200                                                                  01990000
021300     05 PV-FISCAL-DATE.                                           02000000
021400        10  PV-CENT-YEAR               PIC  9(04).                02010055
021401        10  FILLER REDEFINES PV-CENT-YEAR.                        02020055
021402            15  PV-CENT                PIC  9(02).                02030054
021500            15  PV-YEAR                PIC  9(02).                02040054
021600        10  PV-FILLER                  PIC  9(04).                02050000
021700                                                                  02060000
021800     05 PV-MR125-FISCAL-FORMAT.                                   02070000
021900        10  PV-CCYY                    PIC  S9(4) COMP.           02080052
022100        10  PV-WW                      PIC  S9(4) COMP.           02090052
022200                                                                  02100000
022900 01  DATE-ORIENTATION-TABLE.                                      02110000
023000     05  DATE-TABLE                 OCCURS  53 TIMES              02120000
023100                                    INDEXED BY WS-WEEK-INDEX.     02130000
023200         10 WS-CAL-DATE                PIC  9(08).                02140000
023300         10 WS-CAL-YRWK.                                          02150000
023400            15 WS-CAL-YR               PIC  9(04).                02160000
023500            15 WS-CAL-WK               PIC  9(02).                02170000
023600         10 WS-FISCAL-YRWK.                                       02180000
023700            15 WS-FISCAL-CC            PIC  9(02).                02190000
023800            15 WS-FISCAL-YR            PIC  9(02).                02200000
023900            15 WS-FISCAL-WK            PIC  9(02).                02210000
024000                                                                  02220000
024100 01  STORE-TABLE-EXTRACT.                                         02230000
024200     05  STORE-TABLE                 OCCURS 99999 TIMES           02240000
024300                                     INDEXED BY STORE-INDEX.      02250000
024600         10 WS-XMT-LOC-TYP-CDE         PIC  X(02).                02280000
024700                                                                  02290000
024800         10 WS-XMT-LOC-ST-CDE          PIC  X(02).                02300000
024900                                                                  02310000
025000         10 WS-XMT-LOC-DIST-NBR        PIC  X(02).                02320000
025100                                                                  02330000
025200         10 WS-XMT-LOC-LOC-NBR         PIC S9(4) COMP.            02340013
025300                                                                  02350000
025400         10 WS-XMT-MET-NBR             PIC S9(4) COMP.            02360000
                                                                        02330000
               10 WS-XMT-E-BUS-IND           PIC  X(01).                02320000
025500                                                                  02370000
025600                                                                  02380000
025700     EXEC SQL                                                     02390000
025800         INCLUDE TSK                                              02400000
025900     END-EXEC.                                                    02410000
026000                                                                  02420000
026100     EXEC SQL                                                     02430000
026200         INCLUDE TUPCSKU                                          02440000
026300     END-EXEC.                                                    02450000
026400                                                                  02460000
026500     EXEC SQL                                                     02470000
026600         INCLUDE XMT00001                                         02480000
026700     END-EXEC.                                                    02490000
026800                                                                  02500000
026500     EXEC SQL                                                     02470000
026600         INCLUDE XMT00003                                         02480000
026700     END-EXEC.                                                    02490000
026800                                                                  02500000
026900     EXEC SQL                                                     02510000
027000         INCLUDE TMRITEM                                          02520000
027100     END-EXEC.                                                    02530000
027200                                                                  02540000
027600                                                                  02550000
027700     EXEC SQL                                                     02560000
027800         INCLUDE TUPC                                             02570000
027900     END-EXEC.                                                    02580000
028000                                                                  02590000
028100     EXEC SQL                                                     02600000
028200         INCLUDE TSIZE                                            02610000
028300     END-EXEC.                                                    02620000
028400                                                                  02630000
028500     EXEC SQL                                                     02640000
028600         INCLUDE TVSCHVL                                          02650000
028700     END-EXEC.                                                    02660000
028800                                                                  02670000
028900     EXEC SQL                                                     02680000
029000         INCLUDE TENTNME                                          02690000
029100     END-EXEC.                                                    02700000
029200                                                                  02710000
029300     EXEC SQL                                                     02720000
029400         INCLUDE MHT00000                                         02730000
029500     END-EXEC.                                                    02740000
029600                                                                  02750000
029700     EXEC SQL                                                     02760000
029800         INCLUDE TVNDSTL                                          02770000
029900     END-EXEC.                                                    02780000
030000                                                                  02790000
030010     EXEC SQL                                                     02760000
030020         INCLUDE TSKXREF                                          02770000
030030     END-EXEC.                                                    02780000
030000                                                                  02790000
030010     EXEC SQL                                                     02760000
030020         INCLUDE TDTATTR                                          02770000
030030     END-EXEC.                                                    02780000
030040                                                                  02790000
030100* DB2 COMMUNICATION AREA                                          02800000
030200                                                                  02810000
030300     EXEC SQL                                                     02820000
030400         INCLUDE SQLCA                                            02830000
030500     END-EXEC.                                                    02840000
030600                                                                  02850000
030700* DB2 COMMUNICATION AREA2                                         02860000
030800                                                                  02870000
030900     COPY SQLCA2.                                                 02880000
031000                                                                  02890000
031100******************************************                        02900000
031200                                                                  02910000
031300     EXEC SQL                                                     02920000
031400       DECLARE STORE_CSR CURSOR FOR                               02930000
031700       SELECT ST_CDE                                              02970000
031800             ,DIST_NBR                                            02980000
031900             ,A.LOC_NBR                                           02990013
032000             ,B.STR_GP_ID                                         03000000
                   ,A.E_BUS_IND                                         03000000
032100       FROM XMT_LOC A, XMT_STR_GP_MBSHP B                         03010000
032300       WHERE A.LOC_TYP_CDE = 'DS'                                 03030000
032400         AND A.CLO_DTE > CURRENT DATE                             03040000
032400         AND A.LOC_NBR = B.LOC_NBR                                03040000
032400         AND B.STR_GP_TYP_CDE = 2000                              03040000
031900       ORDER BY A.LOC_NBR                                         02990013
032500     END-EXEC.                                                    03050000
032600******************************************                        03060000
032700                                                                  03070000
032800     EXEC SQL                                                     03080000
032900       DECLARE TMRITEM_CSR CURSOR FOR                             03090000
033000       SELECT A.ITEM_NBR                                          03100000
033100       FROM                                                       03110000
033200            TMRITEM         A                                     03120023
033800           ,TSKXREF         B                                     03120023
034000       WHERE A.ITEM_NBR     = B.ITM_NBR                                 22
033700     END-EXEC.                                                    03130015
033701**************************************************************    03410015
033710***THE FOLLOWING 3 STATEMENTS ARE FOR TESTING ONLY ***********    03410015
033800**         ,TSKXREF         B                                     03120023
033900**       AND B.DEPT_NBR IN ('012', '146', '246', '239', '371')            
034000**     WHERE A.ITEM_NBR     = B.ITM_NBR                                 22
034502**************************************************************    03410015
034503                                                                  03420000
034504     EXEC SQL                                                     03430000
034505       DECLARE DLY_SLS_CSR CURSOR FOR                             03440024
034506       SELECT SUM(SLS_UNT_QTY)                                    03450024
034507            , STR_NBR                                             03460000
034508       FROM MHT_DLY_SLS A, TSKXREF B                              03470024
034509       WHERE B.ITM_NBR   =  :MRITEM-ITEM-NBR                      03480000
034509         AND A.SKU_NBR   =  B.SKU                                 03480000
034510**  NO STORE 0 IS KEPT ON MHT_DLY_SLS, SO NOT NEEDED              03490000
034510**       AND STR_NBR      <> :PC-CORP-STORE                       03490000
WR9999         AND PRCG_DTE IN (                                                
WR9999                   :PV-CURRENT-FSCL-BOW-DATE                              
                       , :PV-FSCL-EOW-DATE-1                                    
                       , :PV-FSCL-EOW-DATE-2                                    
                       , :PV-FSCL-EOW-DATE-3                                    
                       , :PV-FSCL-EOW-DATE-4                                    
                       , :PV-FSCL-EOW-DATE-5                                    
                       , :PV-FSCL-EOW-DATE-6                                    
                       )                                                        
034600         AND SLS_UNT_QTY  >  0                                    03510000
034700         AND A.SKU_STAT_CDE IN ('10', '20', '40')                 03520000
034800       GROUP BY A.SKU_NBR,                                        03530000
034800                A.STR_NBR                                         03530000
034802     END-EXEC.                                                    03550000
034900                                                                  03560000
035000******************************************                        03570000
035100                                                                  03580000
035200     EXEC SQL                                                     03590000
035300       DECLARE TUPCSKU_CSR CURSOR FOR                             03600000
035400       SELECT UPC_NBR                                             03610000
035500       FROM TUPCSKU                                               03620000
035600       WHERE ITEM_NBR = :MRITEM-ITEM-NBR                          03630000
035700     END-EXEC.                                                    03640000
035800******************************************                        03650000
035900*                                                                 03660000
036000***************************************************************** 03670000
036100 PROCEDURE DIVISION.                                              03680000
036200***************************************************************** 03690000
036300 A000-MAIN-PROCESSING.                                            03700000
036400                                                                  03710000
036500     PERFORM B000-INIT-ROUTINE.                                   03720000
036600                                                                  03730000
036700     PERFORM B100-PROCESS-LOOP                                    03740000
036800             UNTIL EOF-IS-REACHED.                                03750000
036900                                                                  03760000
037000     PERFORM B200-END-PROCESS.                                    03770000
037100                                                                  03780000
037200     GOBACK.                                                      03790000
037300*                                                                 03800000
037400******************************************************************03810000
037500* ACCEPT THE SYSTEM DATE,                                         03820000
037600* OPEN XMT_LOC CUSRSOR, AND LOAD THE TABLE W/DATA FROM XMT_LOC.   03830000
037700******************************************************************03840000
037800 B000-INIT-ROUTINE.                                               03850000
037900                                                                  03860000
038000     PERFORM U000-OPEN-FILE.                                      03870000
038100                                                                  03880000
038200     PERFORM U100-ACCEPT-DATE.                                    03890000
038300                                                                  03900021
038400     PERFORM C000-OPEN-XMT-LOC-CURSOR.                            03910000
038500     MOVE SPACES TO PS-EOF-STORE-CSR.                             03920000
038600                                                                  03930000
038700     PERFORM C100-SUB-LOAD-FILE                                   03940000
038800        UNTIL WS-COUNTER > PC-STORE-QUANTITY OR                   03950000
038900        EOF-STORE-CSR.                                            03960000
039000                                                                  03970000
039100     PERFORM C150-CLOSE-XMT-LOC.                                  03980000
039200                                                                  03990000
039300     PERFORM C200-DATE-LOGIC.                                     04000000
039400                                                                  04010000
039500 B000-X. EXIT.                                                    04020000
039600* RETURN TO A000-MAIN-PROCESSING                                  04030000
039700                                                                  04040000
039800******************************************************************04050000
039900* B100-PROCESS-LOOP                                               04060000
040200******************************************************************04070000
040300 B100-PROCESS-LOOP.                                               04080000
040400                                                                  04090000
040500      PERFORM C300-OPEN-TMRITEM-CURSOR.                           04100000
040600      MOVE SPACES TO PS-EOF-TMRITEM-CSR.                          04110000
040601                                                                  04120000
040602      PERFORM C350-FETCH-TMRITEM                                  04130000
040700         UNTIL EOF-TMRITEM-CSR.                                   04140000
040800      PERFORM C400-CLOSE-TMRITEM.                                 04150000
040900      SET EOF-IS-REACHED TO TRUE.                                 04160000
041000 B100-X. EXIT.                                                    04170000
041100*                                                                 04180000
041200******************************************************************04190000
041300*  END-PROCESSING                                                *04200000
041400******************************************************************04210000
041500 B200-END-PROCESS.                                                04220000
041600                                                                  04230000
041700     SUBTRACT WS-MR-RECORDS-CREATED FROM WS-MR-RECORDS-IN         04240000
041800         GIVING WS-MR-RECORDS-BYPASSED.                           04250000
041900                                                                  04260000
042000     IF (WS-MR-RECORDS-BYPASSED + WS-MR-RECORDS-CREATED) NOT =    04270000
042100         WS-MR-RECORDS-IN                                         04280000
042200         DISPLAY 'ERROR IN RECORD COUNT.'                         04290000
042300     END-IF.                                                      04300000
042400                                                                  04310000
042500     DISPLAY 'RECORDS IN = ' WS-MR-RECORDS-IN.                    04320000
042600     DISPLAY 'MR-RECORDS-BYPASSED =  ' WS-MR-RECORDS-BYPASSED.    04330000
042700     DISPLAY 'MR-RECORDS-CREATED = ' WS-MR-RECORDS-CREATED.       04340000
042800     DISPLAY 'QUANTITY OF STORES = ' WS-COUNTER                   04350000
042900                                                                  04360000
043000     PERFORM U400-CLOSE-FILE.                                     04370000
043100                                                                  04380000
043200 B200-X. EXIT.                                                    04390000
043300* RETURN TO A000-MAIN-PROCESSING.                                 04400000
043400                                                                  04410000
043500*                                                                 04420000
043600******************************************************************04430000
043700* THIS PARAGRAPH OPENS THE XMT-LOC CURSOR                         04440000
043800******************************************************************04450000
043900 C000-OPEN-XMT-LOC-CURSOR.                                        04460000
044000                                                                  04470000
044100     MOVE 'C000'                   TO PGM-LOCATION.               04480000
044200     MOVE 'C000-OPEN-XMT-LOC'      TO PV-ABEND-PARAGRAPH.         04490000
044300                                                                  04500000
044400     EXEC SQL                                                     04510000
044500         OPEN STORE_CSR                                           04520000
044600     END-EXEC.                                                    04530000
044700                                                                  04540000
044800     EVALUATE TRUE                                                04550000
044900       WHEN SQLCODE         = ZERO                                04560000
045000       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    04570000
045100         CONTINUE                                                 04580000
045200       WHEN OTHER                                                 04590000
045300         DISPLAY PV-ABEND-PARAGRAPH                               04600000
045400         PERFORM Z999-SQL-ERROR                                   04610000
045500     END-EVALUATE.                                                04620000
045600 C000-X. EXIT.                                                    04630000
045700*RETURN TO B000-INIT-ROUTINE                                      04640000
045800                                                                  04650000
045900*                                                                 04660000
046000******************************************************************04670000
046100*  THIS PARAGRAPH SUB AND LOADS THE INTERNAL TABLE FROM XMT-LOC  *04680000
046200******************************************************************04690000
046300 C100-SUB-LOAD-FILE.                                              04700000
046400                                                                  04710000
046500     MOVE 'C100'                   TO PGM-LOCATION.               04720000
046600     MOVE 'C100-SUB-LOAD-FILE     '                               04730000
046700                                   TO PV-ABEND-PARAGRAPH.         04740000
046800                                                                  04750000
046900     PERFORM  D000-FETCH-XMT-LOC.                                 04760000
047000                                                                  04770000
047100     IF NOT EOF-STORE-CSR                                         04780000
047200                                                                  04790000
047300                                                                  04800000
047400        IF WS-COUNTER > PC-STORE-QUANTITY                         04810000
047500            OR XMT00001-LOC-NBR > PC-STORE-QUANTITY               04820000
047600            DISPLAY '** ABEND ** IN PROGRAM MRKUT080 '            04830000
047700         DISPLAY 'MRKUT080 - EXCEEDED TABLE LIMIT'                04840000
047800                 ' OF STORE TABLE'                                04850000
047900         DISPLAY 'QUANTITY OF STORES = ' WS-COUNTER               04860000
048000         DISPLAY 'STORE NUMBER = ' XMT00001-LOC-NBR               04870000
048100            MOVE +4004 TO PV-ABEND-CODE                           04880000
048200            CALL 'ILBOABN0' USING PV-ABEND-CODE                   04890000
048300        END-IF                                                    04900000
048400                                                                  04910000
048500                                                                  04920000
048600       SET STORE-INDEX TO XMT00001-LOC-NBR                        04930000
048700                                                                  04940000
049000       MOVE XMT00001-LOC-NBR                                      04970013
049100                TO WS-XMT-LOC-LOC-NBR (STORE-INDEX)               04980000
049200       MOVE XMT00001-LOC-TYP-CDE                                  04990000
049300                TO WS-XMT-LOC-TYP-CDE (STORE-INDEX)               05000000
049400       MOVE XMT00001-ST-CDE                                       05010000
049500                TO WS-XMT-LOC-ST-CDE (STORE-INDEX)                05020000
049600       MOVE XMT00001-DIST-NBR                                     05030000
049700                TO WS-XMT-LOC-DIST-NBR (STORE-INDEX)              05040000
049800       MOVE XMT00003-STR-GP-ID                                    05050000
049900                TO WS-XMT-MET-NBR (STORE-INDEX)                   05060000
             MOVE XMT00001-E-BUS-IND                                    05050000
                      TO WS-XMT-E-BUS-IND (STORE-INDEX)                 05060000
050000                                                                  05070000
050100     END-IF.                                                      05080000
050200                                                                  05090000
050300 C100-X. EXIT.                                                    05100000
050400* RETURN TO B000-INIT-ROUTINE                                     05110000
050500                                                                  05120000
050600*                                                                 05130000
050700******************************************************************05140000
050800*  CLOSE STORE CURSOR                                           * 05150000
050900******************************************************************05160000
051000 C150-CLOSE-XMT-LOC.                                              05170000
051100                                                                  05180000
051200     MOVE 'C150'                   TO PGM-LOCATION.               05190000
051300     MOVE 'C150-CLOSE-XMT-LOC     '                               05200000
051400                                   TO PV-ABEND-PARAGRAPH.         05210000
051500     EXEC SQL                                                     05220000
051600         CLOSE STORE_CSR                                          05230000
051700     END-EXEC.                                                    05240000
051800                                                                  05250000
051900     EVALUATE TRUE                                                05260000
052000       WHEN SQLCODE         = ZERO                                05270000
052100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05280000
052200         CONTINUE                                                 05290000
052300       WHEN OTHER                                                 05300000
052400         DISPLAY PV-ABEND-PARAGRAPH                               05310000
052500         PERFORM Z999-SQL-ERROR                                   05320000
052600     END-EVALUATE.                                                05330000
052700                                                                  05340000
052800 C150-X. EXIT.                                                    05350000
052900                                                                  05360000
053000******************************************************************05370000
053100* DETERMINE CENTURY FROM CPU-DATE AND PERFORM REMAINING DATE LOGIC05380000
053200******************************************************************05390000
053300 C200-DATE-LOGIC.                                                 05400000
053400                                                                  05410000
053500     MOVE 'C200'                 TO PGM-LOCATION.                 05420000
053600     MOVE 'C200-DATE-LOGIC  '                                     05430000
053700                                 TO PV-ABEND-PARAGRAPH.           05440000
054300                                                                  05450000
054600     PERFORM D100-FISCAL-DATE.                                    05460000
054700                                                                  05470000
054800     MOVE DPG55-1ST-WKDY-DB2ISO-FMT TO PV-CURRENT-FSCL-BOW-DATE.  05480024
054801     DISPLAY 'FASHION DATE: ' PV-CURRENT-FSCL-BOW-DATE.           05490024
054802                                                                  05500024
           MOVE PV-CURRENT-FSCL-BOW-DATE TO PV-FSCL-BOW-DATE                    
           PERFORM Z500-SET-EOW-DATE.                                           
           MOVE PV-FSCL-EOW-DATE  TO PV-FSCL-EOW-DATE-1                         
           MOVE PV-FSCL-EOW-DATE-1 TO PV-FSCL-BOW-DATE                          
           PERFORM Z500-SET-EOW-DATE.                                           
           MOVE PV-FSCL-EOW-DATE  TO PV-FSCL-EOW-DATE-2.                        
           MOVE PV-FSCL-EOW-DATE-2 TO PV-FSCL-BOW-DATE                          
           PERFORM Z500-SET-EOW-DATE.                                           
           MOVE PV-FSCL-EOW-DATE  TO PV-FSCL-EOW-DATE-3.                        
           MOVE PV-FSCL-EOW-DATE-3 TO PV-FSCL-BOW-DATE                          
           PERFORM Z500-SET-EOW-DATE.                                           
           MOVE PV-FSCL-EOW-DATE  TO PV-FSCL-EOW-DATE-4.                        
           MOVE PV-FSCL-EOW-DATE-4 TO PV-FSCL-BOW-DATE                          
           PERFORM Z500-SET-EOW-DATE.                                           
           MOVE PV-FSCL-EOW-DATE  TO PV-FSCL-EOW-DATE-5.                        
           MOVE PV-FSCL-EOW-DATE-5 TO PV-FSCL-BOW-DATE                          
           PERFORM Z500-SET-EOW-DATE.                                           
           MOVE PV-FSCL-EOW-DATE  TO PV-FSCL-EOW-DATE-6.                        
                                                                                
           DISPLAY 'EOW-DTE-1 = ' PV-FSCL-EOW-DATE-1                            
           DISPLAY 'EOW-DTE-2 = ' PV-FSCL-EOW-DATE-2                            
           DISPLAY 'EOW-DTE-3 = ' PV-FSCL-EOW-DATE-3                            
           DISPLAY 'EOW-DTE-4 = ' PV-FSCL-EOW-DATE-4                            
           DISPLAY 'EOW-DTE-5 = ' PV-FSCL-EOW-DATE-5                            
           DISPLAY 'EOW-DTE-6 = ' PV-FSCL-EOW-DATE-6.                           
054803**   PERFORM D200-FASHION-DATE.                                   05510024
054900                                                                  05520000
055000 C200-X. EXIT.                                                    05530000
055100*  RETURN TO B100-PROCESS-LOOP                                    05540000
055200                                                                  05550000
055300******************************************************************05560000
055400* THIS PARAGRAPH OPENS THE TMRITEM CURSOR *                       05570000
055500******************************************************************05580000
055600 C300-OPEN-TMRITEM-CURSOR.                                        05590000
055700                                                                  05600000
055800     MOVE 'C300'                   TO PGM-LOCATION.               05610000
055900     MOVE 'C300-OPEN-TMRITEM'      TO PV-ABEND-PARAGRAPH.         05620000
056000                                                                  05630000
056100     EXEC SQL                                                     05640000
056200         OPEN TMRITEM_CSR                                         05650000
056300     END-EXEC.                                                    05660000
056400                                                                  05670000
056500     EVALUATE TRUE                                                05680000
056600       WHEN SQLCODE         = ZERO                                05690000
056700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05700000
056800         CONTINUE                                                 05710000
056900       WHEN OTHER                                                 05720000
057000         DISPLAY PV-ABEND-PARAGRAPH                               05730000
057100         PERFORM Z999-SQL-ERROR                                   05740000
057200     END-EVALUATE.                                                05750000
057300                                                                  05760000
057400 C300-X. EXIT.                                                    05770000
057500* RETURN TO C400-PROCESS-00-RECORD                                05780000
057600                                                                  05790000
057700******************************************************************05800000
057800** FETCH FROM THE TMRITEM TABLE TO ACQUIRE AND ITEM #     **      05810000
058000******************************************************************05820000
058100 C350-FETCH-TMRITEM.                                              05830000
058200                                                                  05840000
058300     MOVE 'C350'                   TO PGM-LOCATION.               05850000
058400     MOVE 'C350-FETCH-TMRITEM  '  TO PV-ABEND-PARAGRAPH.          05860000
058500                                                                  05870000
058600     EXEC SQL                                                     05880000
058700          FETCH TMRITEM_CSR                                       05890000
058800           INTO :MRITEM-ITEM-NBR                                  05900000
059000     END-EXEC.                                                    05910000
059100                                                                  05920000
059200     EVALUATE TRUE                                                05930000
059300       WHEN SQLCODE         = ZERO                                05940000
059400         ADD +1 TO WS-MR-RECORDS-IN                               05950000
059500         SET NOT-EOF-TMRITEM-CSR TO TRUE                          05960000
059600         CONTINUE                                                 05970000
059700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05980000
059800         IF WS-MR-RECORDS-IN = 0                                  05990000
059900         DISPLAY '*** NO ITEMS FOUND THAT MET CRITERIA ***'       06000000
060000         END-IF                                                   06010000
060100         SET EOF-TMRITEM-CSR TO TRUE                              06020000
060200         CONTINUE                                                 06030000
060300       WHEN OTHER                                                 06040000
060400         DISPLAY PV-ABEND-PARAGRAPH                               06050000
060500         PERFORM Z999-SQL-ERROR                                   06060000
060600     END-EVALUATE.                                                06070000
060700                                                                  06080000
060800     IF SQLCODE = 0                                               06090000
061100                                                                  06100000
061400        SET PS-HEADER-INFO-NOT-COMPLETE TO TRUE                   06110000
061402           PERFORM D300-SELECT-TSK                                06130000
061500           PERFORM D600-OPEN-TUPCSKU-CSR                          06140000
061510           SET NOT-EOF-UPC-SKU-CSR TO TRUE                        06150000
061600           PERFORM D650-FETCH-TUPCSKU                             06160000
061700             UNTIL EOF-UPC-SKU-CSR OR PS-HEADER-INFO-COMPLETE     06170000
061900           PERFORM D700-CLOSE-TUPCSKU-CSR                         06180000
062000           PERFORM C450-MOVE-DATA                                 06190000
062100***************************************************************   06200029
062101** FOR TEST PURPOSES ONLY : SET HEADER INFO TO TRUE    S.M        06210029
062102*          SET PS-HEADER-INFO-COMPLETE TO TRUE                    06220035
062103                                                                  06230000
062200           IF PS-HEADER-INFO-COMPLETE                             06240000
062300              PERFORM D800-OPEN-DLY-SLS-CSR                       06250024
062400                                                                  06260000
062500              SET MHT-DLY-SLS-FOUND TO TRUE                       06270024
062501                                                                  06280000
062502              PERFORM D850-FETCH-DLY-SLS                          06290024
062503                 UNTIL MHT-DLY-SLS-NOT-FOUND                      06300024
062505              PERFORM D900-CLOSE-DLY-SLS-CSR                      06320024
062506                                                                  06330000
062900           END-IF                                                 06340000
062910     END-IF.                                                      06350000
063000                                                                  06360000
063100 C350-X. EXIT.                                                    06370000
063200* RETURN TO C400-PROCESS-00-RECORD                                06380000
063300                                                                  06390000
063400*                                                                 06400000
063500******************************************************************06410000
063600*  CLOSE TMRITEM CURSOR.                                        * 06420000
063700******************************************************************06430000
063800 C400-CLOSE-TMRITEM.                                              06440000
063900                                                                  06450000
064000     MOVE 'C400'                   TO PGM-LOCATION.               06460000
064100     MOVE 'C400-CLOSE-TMRITEM     '                               06470000
064200                                   TO PV-ABEND-PARAGRAPH.         06480000
064300     EXEC SQL                                                     06490000
064400         CLOSE TMRITEM_CSR                                        06500000
064500     END-EXEC.                                                    06510000
064600                                                                  06520000
064700     EVALUATE TRUE                                                06530000
064800       WHEN SQLCODE         = ZERO                                06540000
064900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    06550000
065000         CONTINUE                                                 06560000
065100       WHEN OTHER                                                 06570000
065200         DISPLAY PV-ABEND-PARAGRAPH                               06580000
065300         PERFORM Z999-SQL-ERROR                                   06590000
065400     END-EVALUATE.                                                06600000
065500                                                                  06610000
065600 C400-X. EXIT.                                                    06620000
065700* RETURN TO C400-PROCESS-00-RECORD                                06630000
065800*                                                                 06640000
065900                                                                  06650000
066000 C450-MOVE-DATA.                                                  06660000
066100         ADD +1 TO WS-MR-RECORDS-CREATED                          06670000
066200                                                                  06680000
066300                                                                  06690000
066400         MOVE PV-SEASON-CODE          TO MR125-SEASON-CODE        06700000
066500*        MOVE PV-FASHION-CODE         TO MR125-FASHION-CODE       06710031
110900         MOVE SPACES                  TO MR125-FASHION-CODE       06720031
110901                                                                  06730000
110902         MOVE 'A'                     TO MR125-ACTIVE-DELETE      06740000
110903                                                                  06750000
110904         MOVE UPC-GP-CDE              TO MR125-GROUP-CODE         06760000
110905                                                                  06770000
110906         MOVE VNDSTL-ENT-ID           TO MR125-ENT-ID             06780000
110907         MOVE VNDSTL-VS-NBR           TO MR125-LONG-VENDOR-STYLE  06790000
110908         MOVE UPC-CSTM-CLOR-DESC      TO MR125-CSTM-CLOR-DESC     06800000
110909         MOVE SIZE-KOHLS-DESC         TO MR125-KOHLS-DESC-SZ      06810000
110910         MOVE ENTNME-ENT-NAME-DESC    TO MR125-ENT-NAME-DESC      06820000
110911                                                                  06830000
110912         MOVE MRITEM-ITEM-NBR         TO MR125-ITEM-NMBR.         06840000
110913                                                                  06850000
110914                                                                  06860000
110915 C450-X. EXIT.                                                    06870000
110916                                                                  06880000
110917                                                                  06890000
110918* RETURN TO B100-PROCESS-LOOP                                     06900000
110919*                                                                 06910000
110920******************************************************************06920000
110921** FETCH FROM THE XMT-LOC TABLE TO GATHER VALUES FOR WS-TABLE   **06930000
110922******************************************************************06940000
110923 D000-FETCH-XMT-LOC.                                              06950000
110924                                                                  06960000
110925     MOVE 'D000'                   TO PGM-LOCATION.               06970000
110926     MOVE 'D000-SELECT-XMT-LOC  '  TO PV-ABEND-PARAGRAPH.         06980000
110927                                                                  06990000
110928     EXEC SQL                                                     07000000
110929          FETCH STORE_CSR                                         07010000
110930           INTO                                                   07020000
110934                :XMT00001-ST-CDE                                  07060000
110935               ,:XMT00001-DIST-NBR                                07070000
110936               ,:XMT00001-LOC-NBR                                 07080000
110937               ,:XMT00003-STR-GP-ID                               07090000
                     ,:XMT00001-E-BUS-IND                               07090000
110938     END-EXEC.                                                    07100000
110939                                                                  07110000
110940     EVALUATE TRUE                                                07120000
110941       WHEN SQLCODE         = ZERO                                07130000
110942                              ADD 1 TO WS-COUNTER                 07140000
110943         CONTINUE                                                 07150000
110944       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    07160000
110945          IF WS-COUNTER = 0                                       07170000
110946          DISPLAY '**** NO STORES FOUND THAT MET CRITERIA ***'    07180000
110947          END-IF                                                  07190000
110948         SET EOF-STORE-CSR TO TRUE                                07200000
110949         CONTINUE                                                 07210000
110950       WHEN OTHER                                                 07220000
110951         DISPLAY PV-ABEND-PARAGRAPH                               07230000
110952         PERFORM Z999-SQL-ERROR                                   07240000
110953     END-EVALUATE.                                                07250000
110954                                                                  07260000
110955 D000-X. EXIT.                                                    07270000
110956* RETURN TO C100-SUB-LOAD-FILE                                    07280000
110957                                                                  07290000
110958******************************************************************07300000
110959*  GET FISCAL DATE FROM CURRENT CPU DATE                         *07310000
110960******************************************************************07320000
110961 D100-FISCAL-DATE.                                                07330000
110962                                                                  07340000
110963     MOVE 'D100'                  TO PGM-LOCATION.                07350000
110964     MOVE 'D100-FISCAL-DATE       '                               07360000
110965                                  TO PV-ABEND-PARAGRAPH.          07370000
110966                                                                  07380000
110967     MOVE 'F2'                   TO DPG51-CALENDAR-TYPE.          07390000
110968     SET  DPG52-LK-DTE-ISO-FMT   TO TRUE.                         07400000
110969     MOVE CC-DATE                TO DPG52-LK-DATE-INPUT.          07410024
110969     MOVE CC-DATE                TO PV-CURRENT-FSCL-EOW-DATE      07410024
110970     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51  DPG52         07420000
110971                                             DPG53  DPG54         07430000
110972                                             DPG55  DPG56.        07440000
110973     EVALUATE TRUE                                                07450000
110974         WHEN DPG54-SEVERE-ERROR                                  07460000
110975            DISPLAY 'SERVERE ERROR IN YR2 END DATE CALC '         07470000
110976            DISPLAY 'INPUT DATE ' DPG52-LK-DATE-INPUT             07480000
110977            DISPLAY DPG54-ERROR-MESSAGE                           07490000
110978            DISPLAY PV-ABEND-PARAGRAPH                            07500000
110979            PERFORM Z999-SQL-ERROR                                07510000
110980         WHEN DPG54-WARNING-ERROR                                 07520000
110981            DISPLAY 'WARNING ERROR IN CALENDAR FIRST DAY'         07530000
110982            DISPLAY DPG54-ERROR-MESSAGE                           07540000
110983         WHEN DPG54-NO-ERROR                                      07550000
110984            CONTINUE                                              07560000
110985     END-EVALUATE.                                                07570000
110986                                                                  07580000
110987     MOVE DPG56-FISCAL-WEEK-NBR       TO PV-WW.                   07590000
110988*************************************************************     07600027
110989***  MOVE DPG55-DB2-ISO-DATE *******  TO PV-FISCAL-DATE. WAS      07610027
110990*** INCORRECT CAL YEAR FORMAT FOR FISCAL CENT. 2/3/99 S.MEYER     07620027
110991*************************************************************     07630027
110992     MOVE DPG56-FISCAL-YEAR-CCYY      TO PV-FISCAL-DATE.          07640028
110993     MOVE PV-CENT-YEAR                TO PV-CCYY.                 07650053
110994                                                                  07660000
110995     MOVE PV-MR125-FISCAL-FORMAT      TO MR125-SALES-DATE.        07670000
110996                                                                  07680000
110997 D100-X. EXIT.                                                    07690000
110998* RETURN TO C200-DATE-LOGIC.                                      07700000
110999                                                                  07710000
111000******************************************************************07720000
111001*  GET FASHION SALES FORMATTED DATE FROM CURRENT DATE            *07730000
111002******************************************************************07740000
111003*D200-FASHION-DATE.                                               07750024
111004*                                                                 07760024
111005*    MOVE 'D200'                   TO PGM-LOCATION.               07770024
111006*    MOVE 'D200-FASHION-DATE      '                               07780024
111007*                                  TO PV-ABEND-PARAGRAPH.         07790024
111008*                                                                 07800024
111009*    MOVE 'F4'                   TO DPG51-CALENDAR-TYPE.          07810024
111010*    SET  DPG52-LK-DTE-ISO-FMT   TO TRUE.                         07820024
111011*    MOVE CC-DATE                TO DPG52-LK-DATE-INPUT.          07830024
111012*    CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51  DPG52         07840024
111013*                                            DPG53  DPG54         07850024
111014*                                            DPG55  DPG56.        07860024
111015*    EVALUATE TRUE                                                07870024
111016*        WHEN DPG54-SEVERE-ERROR                                  07880024
111017*           DISPLAY 'SERVERE ERROR IN YR2 END DATE CALC '         07890024
111018*           DISPLAY 'INPUT DATE ' DPG52-LK-DATE-INPUT             07900024
111019*           DISPLAY DPG54-ERROR-MESSAGE                           07910024
111020*           DISPLAY PV-ABEND-PARAGRAPH                            07920024
111021*           PERFORM Z999-SQL-ERROR                                07930024
111022*        WHEN DPG54-WARNING-ERROR                                 07940024
111023*           DISPLAY 'WARNING ERROR IN CALENDAR FIRST DAY'         07950024
111024*           DISPLAY DPG54-ERROR-MESSAGE                           07960024
111025*        WHEN DPG54-NO-ERROR                                      07970024
111026*           CONTINUE                                              07980024
111027*    END-EVALUATE.                                                07990024
111028*                                                                 08000024
111029*    MOVE DPG56-FISCAL-WEEK-NBR       TO PV-FS-WW.                08010024
111030*    MOVE DPG55-DB2-ISO-DATE          TO PV-FS-DATE.              08020024
111031*    MOVE PV-FS-YEAR                  TO PV-FS-YY.                08030024
111032*                                                                 08040024
111033*    DISPLAY 'FASHION DATE: ' PV-CURRENT-FS-DATE.                 08050024
111034*                                                                 08060024
111035*D200-X. EXIT.                                                    08070024
111036* RETURN TO C200-DATE-LOGIC.                                      08080000
111037                                                                  08090000
111038******************************************************************08100000
111039** SELECT FROM TSK SKU, VENDOR IN-HSE, & STATUS CODE..SKU RENUMB**08110000
111040******************************************************************08120000
111041 D300-SELECT-TSK.                                                 08130000
111042                                                                  08140000
111043     MOVE 'D300'                   TO PGM-LOCATION.               08150000
111044     MOVE 'D300-SELECT-TSK     '  TO PV-ABEND-PARAGRAPH.          08160000
111045                                                                  08170000
111046     EXEC SQL                                                     08180000
111049          SELECT      SKU                                         08210000
111050                     ,STATUS_CODE                                 08220000
111051                     ,VNDR_IN_HSE_NMBR                            08230000
111054           INTO :SKXREF-SKU                                       08250000
111055               ,:TSK-STATUS-CODE                                  08250000
111056               ,:TSK-VNDR-IN-HSE-NMBR                             08260000
111058           FROM      TSK       A                                  08270000
111059                    ,TSKXREF   B                                  08270000
111060           WHERE   A.ITEM_NMBR       = :MRITEM-ITEM-NBR           08280000
111061            AND    A.ITEM_NMBR       = B.ITM_NBR                  08280000
111062                                                                  08290000
111063     END-EXEC.                                                    08300000
111064                                                                  08310000
111065     EVALUATE TRUE                                                08320000
111066       WHEN SQLCODE         = ZERO                                08330000
111067         SET NOT-EOF-TSK   TO TRUE                                08340000
111068         MOVE 'A'                  TO MR125-ACTIVE-DELETE         08350000
111069         MOVE SKXREF-SKU           TO MR125-SKU                   08360000
111070         MOVE TSK-STATUS-CODE      TO MR125-STATUS-CODE           08370000
111071         MOVE TSK-VNDR-IN-HSE-NMBR TO MR125-VNDR-INHSE            08380000
111072       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    08390000
111073         SET EOF-TSK       TO TRUE                                08400000
111074         CONTINUE                                                 08410000
111075       WHEN OTHER                                                 08420000
111076         DISPLAY PV-ABEND-PARAGRAPH                               08430000
111077         PERFORM Z999-SQL-ERROR                                   08440000
111078     END-EVALUATE.                                                08450000
111079                                                                  08460000
111080                                                                  08470000
111081 D300-X. EXIT.                                                    08480000
111082* RETURN TO C350-FETCH-TMRITEM                                    08490000
111083                                                                  08500000
111084*                                                                 08510000
111085***************************************************************** 08520000
111086* D500-SEARCH-STORE-TABLE                                         08530000
111087***************************************************************** 08540000
111088 D500-SEARCH-STORE-TABLE.                                         08550000
111089                                                                  08560000
111090     MOVE 'D500'                   TO PGM-LOCATION.               08570000
111091     MOVE 'D500-SEARCH-STORE-TABLE'                               08580000
111092                                   TO PV-ABEND-PARAGRAPH.         08590000
111093                                                                  08600000
111094      SET STORE-INDEX TO 1.                                       08610000
111095      SEARCH STORE-TABLE                                          08620000
111096        AT END                                                    08630000
111097           SET STORE-NOT-FOUND TO TRUE                            08640000
111098      WHEN WS-XMT-LOC-LOC-NBR (STORE-INDEX)                       08650000
111099             = MHT00000-STR-NBR                                   08660013
111100                 SET STORE-FOUND TO TRUE                          08670000
111101      END-SEARCH                                                  08680000
111102                                                                  08690000
111103      IF STORE-FOUND                                              08700000
111104         PERFORM E250-POPULATE-STORE-FIELDS                       08710000
111105      END-IF.                                                     08720000
111106                                                                  08730000
111107*                                                                 08740000
111108 D500-X. EXIT.                                                    08750000
111109* RETURN TO C350-FETCH-TMRITEM                                    08760000
111110*                                                                 08770000
111111******************************************************************08780000
111112* THIS PARAGRAPH OPENS THE TUPCSKU CURSOR *                       08790000
111113******************************************************************08800000
111114 D600-OPEN-TUPCSKU-CSR.                                           08810000
111115                                                                  08820000
111116     MOVE 'D600'                   TO PGM-LOCATION.               08830000
111117     MOVE 'D600-OPEN-TUPCSKU'      TO PV-ABEND-PARAGRAPH.         08840000
111118                                                                  08850000
111119     EXEC SQL                                                     08860000
111120         OPEN TUPCSKU_CSR                                         08870000
111121     END-EXEC.                                                    08880000
111122                                                                  08890000
111123     EVALUATE TRUE                                                08900000
111124       WHEN SQLCODE         = ZERO                                08910000
111125       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    08920000
111126         CONTINUE                                                 08930000
111127       WHEN OTHER                                                 08940000
111128         DISPLAY PV-ABEND-PARAGRAPH                               08950000
111129         PERFORM Z999-SQL-ERROR                                   08960000
111130     END-EVALUATE.                                                08970000
111131                                                                  08980000
111132 D600-X. EXIT.                                                    08990000
111133* RETURN TO C400-PROCESS-00-RECORD                                09000000
111134                                                                  09010000
111135******************************************************************09020000
111136** FETCH FROM THE TUPCSKU TO GET THE UPC-NBR                    **09030000
111137******************************************************************09040000
111138 D650-FETCH-TUPCSKU.                                              09050000
111139                                                                  09060000
111140     MOVE 'D650'                   TO PGM-LOCATION.               09070000
111141     MOVE 'D650-FETCH-TUPCSKU  '  TO PV-ABEND-PARAGRAPH.          09080000
111142                                                                  09090000
111143     EXEC SQL                                                     09100000
111144          FETCH TUPCSKU_CSR                                       09110000
111145           INTO :TUPCSKU-UPC-NBR                                  09120000
111146     END-EXEC.                                                    09130000
111147                                                                  09140000
111148     EVALUATE TRUE                                                09150000
111149       WHEN SQLCODE         = ZERO                                09160000
111150         SET NOT-EOF-UPC-SKU-CSR TO TRUE                          09170000
111151         PERFORM E300-SELECT-TUPC-TSIZE-JOIN                      09180000
111152       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    09190000
111153         SET EOF-UPC-SKU-CSR TO TRUE                              09200000
111154                                                                  09210000
111155       WHEN OTHER                                                 09220000
111156         DISPLAY PV-ABEND-PARAGRAPH                               09230000
111157         PERFORM Z999-SQL-ERROR                                   09240000
111158     END-EVALUATE.                                                09250000
111159                                                                  09260000
111160                                                                  09270000
111161 D650-X. EXIT.                                                    09280000
111162* RETURN TO C350-FETCH-TMRITEM                                    09290000
111163                                                                  09300000
111164*                                                                 09310000
111165******************************************************************09320000
111166*  CLOSE TUPCSKU CURSOR.                                        * 09330000
111167******************************************************************09340000
111168 D700-CLOSE-TUPCSKU-CSR.                                          09350000
111169                                                                  09360000
111170     MOVE 'D700'                   TO PGM-LOCATION.               09370000
111171     MOVE 'D700-CLOSE-TUPCSKU     '                               09380000
111172                                   TO PV-ABEND-PARAGRAPH.         09390000
111173     EXEC SQL                                                     09400000
111174         CLOSE TUPCSKU_CSR                                        09410000
111175     END-EXEC.                                                    09420000
111176                                                                  09430000
111177     EVALUATE TRUE                                                09440000
111178       WHEN SQLCODE         = ZERO                                09450000
111179       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    09460000
111180         CONTINUE                                                 09470000
111181       WHEN OTHER                                                 09480000
111182         DISPLAY PV-ABEND-PARAGRAPH                               09490000
111183         PERFORM Z999-SQL-ERROR                                   09500000
111184     END-EVALUATE.                                                09510000
111185                                                                  09520000
111186 D700-X. EXIT.                                                    09530000
111187* RETURN TO C400-PROCESS-00-RECORD                                09540000
111188*                                                                 09550000
111189                                                                  09560000
111190*                                                                 09570000
111191******************************************************************09580000
111192* THIS PARAGRAPH OPENS THE DLY-SLS CURSOR *                       09590024
111193******************************************************************09600000
111194 D800-OPEN-DLY-SLS-CSR.                                           09610024
111195*                                                                 09620000
111196     MOVE 'D800'                   TO PGM-LOCATION.               09630000
111197     MOVE 'D800-OPEN-DLY-SLS-CSR' TO PV-ABEND-PARAGRAPH.          09640024
111198                                                                  09650000
111199     EXEC SQL                                                     09660000
111200         OPEN DLY_SLS_CSR                                         09670024
111201     END-EXEC.                                                    09680000
111202                                                                  09690000
111203     EVALUATE TRUE                                                09700000
111204       WHEN SQLCODE         = ZERO                                09710000
111205       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    09720000
111206         CONTINUE                                                 09730000
111207       WHEN OTHER                                                 09740000
111208         DISPLAY PV-ABEND-PARAGRAPH                               09750000
111209         PERFORM Z999-SQL-ERROR                                   09760000
111210     END-EVALUATE.                                                09770000
111211                                                                  09780000
111212 D800-X. EXIT.                                                    09790000
111213* RETURN TO C350-FETCH-TMRITEM                                    09800000
111214                                                                  09810000
111215******************************************************************09820000
111216** FETCH FROM THE DLY-SLS TO OBTAIN THE WEEKLY SALES UNITS &    **09830024
111217** TYPE CODE WHERE 1=10, 2=20 PROMO SALES, 3=30 NOT USED IN PROG**09840000
111218******************************************************************09850000
111219 D850-FETCH-DLY-SLS.                                              09860024
111220                                                                  09870000
111221     MOVE 'D850'                   TO PGM-LOCATION.               09880000
111222     MOVE 'D850-FETCH-DLY-SLS'    TO PV-ABEND-PARAGRAPH.          09890024
111223                                                                  09900000
034509*    DISPLAY 'MRITEM-ITEM = '  MRITEM-ITEM-NBR                    03480000
111224     EXEC SQL                                                     09910000
111225          FETCH DLY_SLS_CSR                                       09920024
111226           INTO                                                   09930000
111228                :MHT00000-SLS-UNT-QTY :PV-NULL-IND1               09950000
111230               ,:MHT00000-STR-NBR                                 09970000
111231     END-EXEC.                                                    09980000
111232                                                                  09990000
111233     EVALUATE TRUE                                                10000000
111234       WHEN SQLCODE         = ZERO                                10010000
111235                                                                  10020000
111251         IF PV-NULL-IND1 < 0                                      10050024
111252           MOVE ZERO               TO MHT00000-SLS-UNT-QTY        10060000
111254         END-IF                                                   10080000
111253         PERFORM D500-SEARCH-STORE-TABLE                          10070000
113100         MOVE SPACES               TO MR125-SALES-TYPE            11590000
113600         MOVE MHT00000-SLS-UNT-QTY TO MR125-UNITS                 11620000
113700         MOVE 'A'                  TO MR125-ACTIVE-DELETE         11630000
111255                                                                  10090018
111256**************************** FOR TEST PURPOSES **********         10100018
111257**************               OVERWRITING STORE                    10110018
111258*          MOVE MHT00000-STR-NBR TO MR125-STORE                   10120019
111259                                                                  10130000
111260*        IF STORE-FOUND                                           10140000
111261         PERFORM E600-WRITE-FILE                                  10150000
111262*        END-IF                                                   10160000
111263                                                                  10170000
111264       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    10180000
111265         SET MHT-DLY-SLS-NOT-FOUND TO TRUE                        10190024
111266       WHEN OTHER                                                 10200000
111267         DISPLAY PV-ABEND-PARAGRAPH                               10210000
111268         PERFORM Z999-SQL-ERROR                                   10220000
111269     END-EVALUATE.                                                10230000
111270                                                                  10240000
111271                                                                  10250000
111272 D850-X. EXIT.                                                    10260000
111273* RETURN TO C350-FETCH-TMRITEM                                    10270000
111274                                                                  10280000
111275*                                                                 10290000
111276******************************************************************10300000
111277*  CLOSE TUPCSKU CURSOR.                                        * 10310000
111278******************************************************************10320000
111279 D900-CLOSE-DLY-SLS-CSR.                                          10330024
111280*                                                                 10340000
111281     MOVE 'D900'                   TO PGM-LOCATION.               10350000
111282     MOVE 'D900-CLOSE-DLY-SLS-CSR'                                10360024
111283                                   TO PV-ABEND-PARAGRAPH.         10370000
111284     EXEC SQL                                                     10380000
111285         CLOSE DLY_SLS_CSR                                        10390024
111286     END-EXEC.                                                    10400000
111287                                                                  10410000
111288     EVALUATE TRUE                                                10420000
111289       WHEN SQLCODE         = ZERO                                10430000
111290       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    10440000
111291         CONTINUE                                                 10450000
111292       WHEN OTHER                                                 10460000
111293         DISPLAY PV-ABEND-PARAGRAPH                               10470000
111294         PERFORM Z999-SQL-ERROR                                   10480000
111295     END-EVALUATE.                                                10490000
111296                                                                  10500000
111297 D900-X. EXIT.                                                    10510000
111298* RETURN TO B100-PROCESS-LOOP                                     10520000
111299*                                                                 10530000
111300*                                                                 10540000
111301                                                                  10550000
111302******************************************************************10560000
111303** SEARCH THE INTERNAL XMT-LOC TABLE AND POPULATE OUTPUT        **10570000
111304******************************************************************10580000
111305 E250-POPULATE-STORE-FIELDS.                                      10590000
111306                                                                  10600000
111307     MOVE 'E250'                   TO PGM-LOCATION.               10610000
111308     MOVE 'E250-POPULATE-STORE-F'  TO PV-ABEND-PARAGRAPH.         10620000
111309                                                                  10630000
111310                                                                  10640000
           IF WS-XMT-E-BUS-IND (STORE-INDEX) = 'Y'                              
               SET STORE-INDEX TO PC-ECOMM-CHANNEL                      10650000
           ELSE                                                                 
111311         SET STORE-INDEX TO MHT00000-STR-NBR                      10650000
           END-IF.                                                              
111312                                                                  10660000
111313     MOVE WS-XMT-LOC-LOC-NBR (STORE-INDEX)                        10670000
111314                    TO MR125-STORE.                               10680000
111315     MOVE WS-XMT-LOC-ST-CDE (STORE-INDEX)                         10690000
111316                    TO MR125-STORE-STATE-CODE.                    10700000
111317     MOVE WS-XMT-LOC-DIST-NBR (STORE-INDEX)                       10710000
111318                    TO MR125-STORE-DISTRICT-NMBR.                 10720000
111319     MOVE WS-XMT-MET-NBR (STORE-INDEX)                            10730000
111320                    TO MR125-STORE-MET-NBR.                       10740000
111321                                                                  10750000
111322 E250-X. EXIT.                                                    10760000
111323* RETURN TO D500-SEARCH-STORE-TABLE                               10770000
111324*                                                                 10780000
111325******************************************************************10790000
111326** SELECT FROM TUPC/TSIZE JOIN VIA TUPCSKU-UPC-NBR              **10800000
111327******************************************************************10810000
111328 E300-SELECT-TUPC-TSIZE-JOIN.                                     10820000
111329                                                                  10830000
111330     MOVE 'E300'                   TO PGM-LOCATION.               10840000
111331     MOVE 'E300-SELECT-TUPC/TSZ'  TO PV-ABEND-PARAGRAPH.          10850000
111332                                                                  10860000
111333     EXEC SQL                                                     10870000
111334          SELECT      A.UPC_ID                                    10880000
111335                     ,A.VS_ID                                     10890000
111336                     ,A.CSTM_CLOR_DESC                            10900000
111337                     ,A.GP_CDE                                    10910000
111338                     ,A.SEA_SEQ_NBR                               10920000
111339                     ,B.KOHLS_DESC                                10930000
111340           INTO      :UPC-UPC-ID                                  10940000
111341                    ,:UPC-VS-ID                                   10950000
111342                    ,:UPC-CSTM-CLOR-DESC                          10960000
111343                    ,:UPC-GP-CDE                                  10970000
111344                    ,:UPC-SEA-SEQ-NBR                             10980000
111345                    ,:SIZE-KOHLS-DESC                             10990000
111346           FROM      TUPC    A                                    11000000
111347                    ,TSIZE   B                                    11010000
111348           WHERE     A.UPC_NBR = :TUPCSKU-UPC-NBR                 11020000
111349             AND    (A.EFF_BEG_DTE     =  CURRENT DATE            11030000
111350              OR     A.EFF_BEG_DTE     <  CURRENT DATE)           11040000
111351             AND     A.EFF_END_DTE    IS NULL                     11050000
111352             AND     A.KOHLS_SIZE_CDE  = B.KOHLS_SIZE_CDE         11060000
111353                                                                  11070000
111354     END-EXEC.                                                    11080000
111355                                                                  11090000
111356*                    ,A.MDSE_TYP_SEQ_NBR                          11100038
111357*                   ,:UPC-MDSE-TYP-SEQ-NBR                        11110038
111358                                                                  11120038
111359     EVALUATE TRUE                                                11130000
111360       WHEN SQLCODE         = ZERO                                11140000
111361         SET NOT-EOF-TUPCSZ TO TRUE                               11150000
111362         PERFORM E110-GET-INFO                                    11160000
111363         PERFORM F300-SELECT-TVNDSTL-TENTNME                      11170000
111364                                                                  11180000
111365       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    11190000
111366         SET PS-EOF-TUPCSZ TO TRUE                                11200000
111367                                                                  11210000
111368       WHEN OTHER                                                 11220000
111369         DISPLAY PV-ABEND-PARAGRAPH ' ' TUPCSKU-UPC-NBR           11230000
111370         PERFORM Z999-SQL-ERROR                                   11240000
111371     END-EVALUATE.                                                11250000
111372 E300-X. EXIT.                                                    11260000
111373                                                                  11270000
111374 E110-GET-INFO.                                                   11280000
111375     IF SQLCODE = 0                                               11290000
111376        IF UPC-SEA-SEQ-NBR  = 0                                   11300000
111377           MOVE SPACES TO MR125-SEASON-CODE                       11310000
111378        ELSE                                                      11320000
111379           PERFORM F200-SELECT-TVSCHVL-SEASON                     11330000
111380        END-IF                                                    11340000
111381                                                                  11350000
111382*       IF UPC-MDSE-TYP-SEQ-NBR = 0                               11360031
111383*           MOVE SPACES TO MR125-FASHION-CODE                     11370031
111384*       ELSE                                                      11380031
111385*           PERFORM F250-SELECT-TVSCHVL-FASHION                   11390031
111386*       END-IF                                                    11400031
111387     END-IF.                                                      11410000
111400                                                                  11420000
111500                                                                  11430000
111600 E110-X. EXIT.                                                    11440000
111700* RETURN TO D650-PROCESS-00-RECORD                                11450000
111800                                                                  11460000
111900******************************************************************11470000
112000** CHANGE THE TYPE CODE FROM DLY-SLS TO MATCH FSRD049   (MRKUT079)11480024
112100** WHERE 1=10, REG. SALES; 2=20, PROMO SALES; 3=30 CLEAR-NOT USED 11490000
112200******************************************************************11500000
112300*E400-EDIT-TYPE-CODE.                                             11510000
112400                                                                  11520000
112500*    MOVE 'F200'                   TO PGM-LOCATION.               11530000
112600*    MOVE 'F200-SELECT-TVSCHVL '  TO PV-ABEND-PARAGRAPH.          11540000
112700                                                                  11550000
112800*    IF SKSTWKS-SALES-TYPE-CODE = '01'                            11560000
112900*       MOVE '10'                 TO MR125-SALES-TYPE             11570000
113000*    ELSE                                                         11580000
113100        MOVE SPACES               TO MR125-SALES-TYPE             11590000
113100*       MOVE '20'                 TO MR125-SALES-TYPE             11590000
113200*    END-IF.                                                      11600000
113300                                                                  11610000
113600     MOVE MHT00000-SLS-UNT-QTY   TO MR125-UNITS.                  11620000
113700     MOVE 'A'                    TO MR125-ACTIVE-DELETE.          11630000
113800                                                                  11640000
113900*E400-X. EXIT.                                                    11650000
114000* RETURN TO D650-PROCESS-00-RECORD                                11660000
114100                                                                  11670000
114200******************************************************************11680000
114300** WRITE FILE TO OUTPUT MRRD125                                 **11690000
114400******************************************************************11700000
114500 E600-WRITE-FILE.                                                 11710000
114600                                                                  11720000
114700     MOVE 'E600'                   TO PGM-LOCATION.               11730000
114800     MOVE 'E600-WRITE-FILE      '  TO PV-ABEND-PARAGRAPH.         11740000
114900                                                                  11750000
115000                                                                  11760000
115100     WRITE VALID-SALES-REC FROM MR125-SKU-HISTORY-RECORD.         11770000
115200                                                                  11780000
115300 E600-X. EXIT.                                                    11790000
115400* RETURN TO A100-MAIN-PROCESSING                                  11800000
115500*                                                                 11810000
115600                                                                  11820000
115700******************************************************************11830000
115800** SELECT FROM TVSCHVL-SEASON                                   **11840000
115900******************************************************************11850000
116000 F200-SELECT-TVSCHVL-SEASON.                                      11860000
116100                                                                  11870000
116200     MOVE 'F200'                   TO PGM-LOCATION.               11880000
116300     MOVE 'F200-SELECT-TVSCHVL '  TO PV-ABEND-PARAGRAPH.          11890000
116400                                                                  11900000
116500     MOVE 4 TO VSCHVL-CHARTC-CDE.                                 11910000
116600                                                                  11920000
116700     EXEC SQL                                                     11930000
116800                                                                  11940000
116900          SELECT      CHARTC_VAL_DESC                             11950000
117000           INTO      :VSCHVL-CHARTC-VAL-DESC                      11960000
117100           FROM      TVSCHVL                                      11970000
117200           WHERE     CHARTC_SEQ_NBR  = :UPC-SEA-SEQ-NBR           11980000
117300             AND     CHARTC_CDE      = :VSCHVL-CHARTC-CDE         11990000
117400                                                                  12000000
117500     END-EXEC.                                                    12010000
117600                                                                  12020000
117700     EVALUATE TRUE                                                12030000
117800       WHEN SQLCODE         = ZERO                                12040000
117900         SET NOT-EOF-TVSCHVL-SEASON TO TRUE                       12050000
118000                                                                  12060000
118100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    12070000
118200         SET EOF-TVSCHVL-SEASON  TO TRUE                          12080000
118300                                                                  12090000
118400       WHEN OTHER                                                 12100000
118500         DISPLAY PV-ABEND-PARAGRAPH                               12110000
118600         PERFORM Z999-SQL-ERROR                                   12120000
118700     END-EVALUATE.                                                12130000
118800                                                                  12140000
118900     IF SQLCODE = 0                                               12150000
119000        MOVE VSCHVL-CHARTC-VAL-DESC TO PV-SEASON-CODE             12160000
119100     END-IF.                                                      12170000
119200                                                                  12180000
119300 F200-X. EXIT.                                                    12190000
119400* RETURN TO E300-SELECT-TUPC-TSIZE-JOIN                           12200000
119500                                                                  12210000
119600******************************************************************12220000
119700** SELECT FROM TVSCHVL-FASHION                                  **12230000
119800******************************************************************12240000
119900*F250-SELECT-TVSCHVL-FASHION.                                     12250031
120000*                                                                 12260031
120100*    MOVE 'F250'                   TO PGM-LOCATION.               12270031
120200*    MOVE 'F250-SELECT-TVSCHVL '  TO PV-ABEND-PARAGRAPH.          12280031
120300*                                                                 12290031
120400*    MOVE 6 TO VSCHVL-CHARTC-CDE.                                 12300031
120500*                                                                 12310031
120600*    EXEC SQL                                                     12320031
120700*                                                                 12330031
120800*         SELECT      CHARTC_VAL_DESC                             12340031
120900*          INTO :VSCHVL-CHARTC-VAL-DESC                           12350031
121000*          FROM      TVSCHVL                                      12360031
121100*          WHERE     CHARTC_SEQ_NBR  = :UPC-MDSE-TYP-SEQ-NBR      12370031
121200*            AND     CHARTC_CDE      = :VSCHVL-CHARTC-CDE         12380031
121300*                                                                 12390031
121400*    END-EXEC.                                                    12400031
121500*                                                                 12410031
121600*    EVALUATE TRUE                                                12420031
121700*      WHEN SQLCODE         = ZERO                                12430031
121800*        SET NOT-EOF-TVSCHVL TO TRUE                              12440031
121900*                                                                 12450031
122000*      WHEN SQLCODE         = PC-ROW-NOT-FOUND                    12460031
122100*        SET EOF-TVSCHVL         TO TRUE                          12470031
122200*                                                                 12480031
122300*      WHEN OTHER                                                 12490031
122400*        DISPLAY PV-ABEND-PARAGRAPH                               12500031
122500*        PERFORM Z999-SQL-ERROR                                   12510031
122600*    END-EVALUATE.                                                12520031
122700*                                                                 12530031
122800*    IF SQLCODE = 0                                               12540031
122900*       MOVE VSCHVL-CHARTC-VAL-DESC TO PV-FASHION-CODE            12550031
123000*    END-IF.                                                      12560031
123100*                                                                 12570031
123200*F250-X. EXIT.                                                    12580031
123300* RETURN TO E300-SELECT-TUPC-TSIZE-JOIN                           12590000
123400                                                                  12600000
123500******************************************************************12610000
123600** SELECT FROM TVNDSTL/TENTNME VIA TUPC-VS-ID                   **12620000
123700******************************************************************12630000
123800 F300-SELECT-TVNDSTL-TENTNME.                                     12640000
123900                                                                  12650000
124000     MOVE 'F300'                   TO PGM-LOCATION.               12660000
124100     MOVE 'F300-SELECT-TVNDSTL '  TO PV-ABEND-PARAGRAPH.          12670000
124200                                                                  12680000
124300     EXEC SQL                                                     12690000
124400          SELECT      A.ENT_ID                                    12700000
124500                     ,A.VS_NBR                                    12710000
124600                     ,B.ENT_NAME_DESC                             12720000
124700           INTO :VNDSTL-ENT-ID                                    12730000
124800               ,:VNDSTL-VS-NBR                                    12740000
124900               ,:ENTNME-ENT-NAME-DESC                             12750000
125000           FROM      TVNDSTL A                                    12760000
125100                    ,TENTNME B                                    12770000
125200           WHERE     A.VS_ID         = :UPC-VS-ID                 12780000
125300             AND     A.ENT_ID        = B.ENT_ID                   12790000
125400             AND     B.TYPE_CDE      = '01'                       12800000
125500                                                                  12810000
125600     END-EXEC.                                                    12820000
125700                                                                  12830000
125800     EVALUATE TRUE                                                12840000
125900       WHEN SQLCODE         = ZERO                                12850000
126000                                                                  12860000
126100         SET NOT-EOF-TVNDSTL-TENTNME TO TRUE                      12870000
126200         SET PS-HEADER-INFO-COMPLETE TO TRUE                      12880000
126300                                                                  12890000
126400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    12900000
126500         SET EOF-TVNDSTL-TENTNME TO TRUE                          12910000
126600                                                                  12920000
126700       WHEN OTHER                                                 12930000
126800         DISPLAY PV-ABEND-PARAGRAPH                               12940000
126900         PERFORM Z999-SQL-ERROR                                   12950000
127000     END-EVALUATE.                                                12960000
127100                                                                  12970000
127200 F300-X. EXIT.                                                    12980000
127300* RETURN TO E300-SELECT-TUPC-TSIZE-JOIN                           12990000
127400                                                                  13000000
127500                                                                  13010000
127600******************************************************************13020000
127700* OPEN FASHION SALES FILE                                         13030000
127800******************************************************************13040000
127900 U000-OPEN-FILE.                                                  13050000
128000                                                                  13060000
128100     MOVE 'U000'                   TO PGM-LOCATION.               13070000
128200     MOVE 'U000-OPEN-FILE         '                               13080000
128300                                   TO PV-ABEND-PARAGRAPH.         13090000
128400                                                                  13100000
128500     OPEN                                                         13110000
128600            OUTPUT VALID-SALES-FILE.                              13120000
128700                                                                  13130000
128800 U000-X. EXIT.                                                    13140000
128900* RETURN TO B000-INIT-ROUTINE                                     13150000
129000                                                                  13160000
129100******************************************************************13170000
129200** ACCEPT SYSTEM DATE FROM CPU                                  **13180000
129300******************************************************************13190000
129400 U100-ACCEPT-DATE.                                                13200000
129500                                                                  13210000
129600     MOVE 'U100'                   TO PGM-LOCATION.               13220000
129700     MOVE 'U100-ACCEPT-DATE       '                               13230000
129800                                   TO PV-ABEND-PARAGRAPH.         13240000
129900*                                                                 13250000
130100     ACCEPT CC-DATE.                                              13260000
130200     DISPLAY 'CC-DATE' CC-DATE.                                   13270000
131100                                                                  13280000
131200 U100-X. EXIT.                                                    13290000
131300* RETURN TO B000-INIT-ROUTINE                                     13300000
131400                                                                  13310000
131500                                                                  13320000
131600                                                                  13330000
131700                                                                  13340000
131800******************************************************************13350000
131900*  CLOSE THE FASHION SALES FILE AND THE MR FILE                  *13360000
132000******************************************************************13370000
132100 U400-CLOSE-FILE.                                                 13380000
132200                                                                  13390000
132300     MOVE 'U400'                   TO PGM-LOCATION.               13400000
132400     MOVE 'U400-READ-RECORD       '                               13410000
132500                                   TO PV-ABEND-PARAGRAPH.         13420000
132600     CLOSE                                                        13430000
132700           VALID-SALES-FILE.                                      13440000
132800                                                                  13450000
132900 U400-X. EXIT.                                                    13460000
133000* RETURN TO B200-END-PROCESS                                      13470000
133100                                                                  13480000
02161 ******************************************************************        
02161 **  READ TDTATTR TO GET THE SALES DATES  ********************             
02161 ******************************************************************        
02157  Z500-SET-EOW-DATE.                                                       
111043     MOVE 'Z500'                   TO PGM-LOCATION.               08150000
111044     MOVE 'Z500-SET-EOW-DATE   '  TO PV-ABEND-PARAGRAPH.          08160000
           EXEC SQL                                                             
W10763       SELECT                                                             
WR6041             KY_DTE + 1 DAYS                                              
                INTO    :PV-FSCL-EOW-DATE                                       
WR6041       FROM     TDTATTR                                                   
             WHERE KY_DTE        = :PV-FSCL-BOW-DATE                            
           END-EXEC                                                             
           EVALUATE TRUE                                                        
              WHEN SQLCODE = +0                                                 
                 CONTINUE                                                       
              WHEN OTHER                                                        
126800           DISPLAY PV-ABEND-PARAGRAPH                             12940000
126900           PERFORM Z999-SQL-ERROR                                 12950000
           END-EVALUATE.                                                        
01856 *                                                                         
133200******************************************************************13490000
133300*   ERROR MESSAGE ROUTINE                                         13500000
133400******************************************************************13510000
133500 Z999-SQL-ERROR.                                                  13520000
133600                                                                  13530000
133700     MOVE SQLCODE    TO SQLCODE2.                                 13540000
133800     MOVE SQLERRD(3) TO SQLERRD3.                                 13550000
133900     DISPLAY '** ABEND **       ** = SQLERROR'.                   13560000
134000     DISPLAY '** PROGRAM        ** = MRKUT080'.                   13570000
134100     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  13580000
134200     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  13590000
134300     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   13600000
134400     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  13610000
134500     MOVE +4013 TO PV-ABEND-CODE.                                 13620000
134600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         13630000
134700******************************************************************13640000
