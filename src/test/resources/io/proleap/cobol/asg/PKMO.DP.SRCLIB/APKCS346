000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    APKCS346.                                         00020000
000300 AUTHOR.        MIKE BESKE.                                       00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  08-97.                                            00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*    THIS IS A COPY OF PROGRAM APKCS329, CHANGED TO APKCS346    * 00090000
001000*    TO LIMIT SECURITY.                                         * 00100000
001100*---------------------------------------------------------------* 00110000
001200*    TRANID      - A346                                         * 00120000
001300*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * 00130000
001400*    DESCRIPTION - INVOICE ITEM INQUIRY                         * 00140000
001500*    MAPSET      - APKM346                                      * 00150000
001600*                                                               * 00160000
001700*                                                               * 00170000
001800*---------------------------------------------------------------* 00180000
001900*                                                               * 00190000
002000* CHANGE LOG:                                                   * 00200000
002100*                                                               * 00210000
002200* 02/01/01  CHANGED BY: MIKE BESKE              WR #: 21576     * 00220000
002300*          - REMOVED CODE THAT IS NOT USED BY THIS PROGRAM SUCH * 00230000
002400*            CODE REFERRING TO UPDATE, DELETE AND ADD MODES.    * 00240000
002500*            THIS PROGRAM IS AN INQUIRY ONLY PROGRAM.  THIS WAS * 00250000
002600*            INCLUDED WITH THE EDI FLEXABILITY PROJECT BECAUSE  * 00260000
002700*            IT HAD CODE THAT USED ERROR MESSAGE # 00851.  THIS * 00270000
002800*            CODE WAS NEVER BEING EXECUTED.                     * 00280000
002900*                                                               * 00290000
003000* 02/22/02  CHANGED BY: MIKE BESKE              WR# 21278       * 00300000
003100*          - REPLACED THE TSK TABLE WITH TSKXREF AS PART        * 00310000
003200*            OF RETEK PROJECT PRELIM FOR AP.  (PARA 4060-)      * 00320000
003300*                                                               * 00330000
003400*  05/22/02  ADDED LABELS TO PO_NBR IN SQL WHERE JOINS OF       * 00340000
003500*            TINVOIC AND TPAYREQ IN ORDER TO DIFFERENTIATE THE  * 00350000
003600*            TABLE THE PO_NBR IS ORIGINATING FROM.              * 00360000
003700*             BY: MIKE BESKE                     WR: 23500      * 00370000
003800*                                                               * 00380000
003900* 11/04/02  CHANGED MADE:                                       * 00390000
004000*           COLBY DATING PROJECT - REMOVED TPAYREQ.             * 00400000
004100*           CHANGED BY: MIKE BESKE              WR# 23750       * 00410000
004200*                                                               * 00420000
004300* 04/21/03  CHANGE MADE:                                        * 00430006
004400*           MODIFICATIONS DONE AS PART OF NI-SKU PROJECT.       * 00440006
004500*           REMOVED TPURCHS TPURITM TVNDINV TUPCSKU TSKXREF PLUS* 00450006
004600*           ALL REFERENCES TO THESE TABLES.  REMOVED CODE THAT  * 00460006
004700*           POPULATED THE SCREEN FIELD NAMES THAT WERE REMOVED  * 00470006
004800*           FRPM APKM346.  ADDED CODE TO POPULATE ADPTNBR ON THE* 00480006
004900*           NI-SKU CHANGES.                                     * 00490006
005000*           CHANGED BY: MIKE BESKE              WR# 22557       * 00500006
005100*                                                               * 00510006
005200* 06/05/03  CHANGE MADE:                                        * 00520006
005300*           MODIFICATIONS DONE AS PART OF NI-SKU PROJECT.       * 00530006
005400*           HAD TO REDO THE MODIFICATIONS AS PART OF THE NISKU  * 00540006
005500*           PROJECT.  THE TPURITM TABLE NEEDED TO BE IN THE     * 00550006
005600*           PROGRAM BECAUSE OF GETTING THE PO LINE NUMBER FROM  * 00560006
005700*           IT.  SIMILAR TO THE CHANGES MADE TO APKCS329 BASED  * 00570006
005800*           ON POST INSTALL PROBLEMS REPORTED BY AP USERS       * 00580006
005900*           REGARDING THE ABILITY TO CHANGED THE PO LINE NUMBER * 00590006
006000*           AND HAVING THE CORRECT NUMBER BEING DISPLAYED AFTER * 00600006
006100*           THE CHANGE.  I DID DISCIVER THOUGH THAT THIS PROGRAM* 00610006
006200*           APPEARS TO HAVE ALWAYS SHOWN THE WRONG PO LINE NBR. * 00620006
006300*           THE DIFFERENCES ARE PROBABLY DUE TO THE LACK OF     * 00630006
006400*           RATHER COMPLEX CODE INVOLVING THE PO LINE NUMBER    * 00640006
006500*           EXISTS IN APKCS329. DUE TO LACK OF TIME TO DO THIS  * 00650006
006600*           RESEARCH TO CORRECT THIS PROGRAM AT THIS TIME, THE  * 00660006
006700*           CORRECTION WILL HAVE TO WAIT UNTIL LATER.  ROLLIN   * 00670006
006800*           WAS INFORMED OF THIS AND OKAYED THIS. THE USERS HAVE* 00680006
006900*           APPARENTLY NEVER REPORTED THIS PROBLEM.             * 00690006
007000*           CHANGED BY: MIKE BESKE              WR# 22557       * 00700006
007100*                                                               * 00710006
007110* 03/11/07  CHANGE MADE:                                        * 00711011
007120*           MBDC PROJECT. RECOMPILE                             * 00712008
007200*           CHANGED BY: GREG WISIALOWSKI        WR# 21578       * 00720008
007201*                                                               * 00720108
007202* 10/27/14  CHANGE MADE: PO EXTENDED DIGIT CHANGES.             * 00720209
007203*           EXTENDED PO# FROM 7 TO 9                            * 00720309
007204*           CHANGED BY: COGNIZANT               WR# CHG0094517  * 00720409
007205*                                                               * 00720509
007206* 10/24/22  CHANGE MADE:                                        * 00720613
007207*     ADD COPYBOOK DPWS930                                      * 00720714
007208*     CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API  * 00720814
007209*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864      * 00720914
007210*---------------------------------------------------------------* 00721008
007300                                                                  00730006
007400 ENVIRONMENT DIVISION.                                            00740006
007500 DATA DIVISION.                                                   00750006
007600                                                                  00760006
007700/                                                                 00770006
007800 WORKING-STORAGE SECTION.                                         00780006
007900                                                                  00790006
008000 01  DK-DB2-KEYS.                                                 00800006
008100     05  DK-INVC-ID                   PIC  X(22).                 00810006
008200     05  DK-PAYT-REQ-SEQ-NBR          PIC S9(09) VALUE +0         00820006
008300                                                 COMP.            00830006
008400     05  DK-PAYT-REQ-LNE-NBR          PIC S9(09) VALUE +0         00840006
008500                                                 COMP.            00850006
008600     05  DK-PO-LNE-NBR                PIC S9(09) VALUE +0         00860006
008700                                                 COMP.            00870006
008800     05  DK-PO-NBR                    PIC S9(09) VALUE +0         00880006
008900                                                 COMP.            00890006
009000     05  DK-PO-NBR-LOW                PIC S9(09) VALUE +0         00900006
009100                                                 COMP.            00910006
009200     05  DK-PO-NBR-HIGH               PIC S9(09) VALUE +0         00920006
009300                                                 COMP.            00930006
009400                                                                  00940006
009500 01  PC-PROGRAM-CONSTANTS.                                        00950006
009600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00960006
009700                                                    'AP346A  '.   00970006
009800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00980006
009900                                                    'APKM346 '.   00990006
010000     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     01000006
010100                                                    COMP.         01010006
010200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         01020006
010300                                                    'APKCS346'.   01030006
010400     05  PC-DPKUT100                    PIC  X(08)  VALUE         01040006
010500                                                    'DPKUT100'.   01050006
010600     05  PC-DPKUT500                    PIC  X(08)  VALUE         01060006
010700                                                    'DPKUT500'.   01070006
010800     05  PC-NULL-DATE                   PIC  X(10)  VALUE         01080006
010900                                                    '9999-09-09'. 01090006
011000     05  PC-PRIME1                      PIC S9(05)   COMP-3       01100006
011100                                            VALUE +38543.         01110006
011200     05  PC-PRIME2                      PIC S9(05)   COMP-3       01120006
011300                                            VALUE +58889.         01130006
011400     05  PC-ONE-BILLION                 PIC S9(11)   COMP-3       01140006
011500                                            VALUE +1000000000.    01150006
011600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      01160006
011700                                                    COMP-3.       01170006
011800     05  PC-TSYMSG-NUMBERS.                                       01180006
011900                                                                  01190006
012000         10  PC-TSYMSG-00004            PIC  9(05)  VALUE  00004. 01200006
012100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE  00005. 01210006
012200         10  PC-TSYMSG-00007            PIC  9(05)  VALUE  00007. 01220006
012300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE  00008. 01230006
012400         10  PC-TSYMSG-00009            PIC  9(05)  VALUE  00009. 01240006
012500         10  PC-TSYMSG-00010            PIC  9(05)  VALUE  00010. 01250006
012600         10  PC-TSYMSG-00016            PIC  9(05)  VALUE  00016. 01260006
012700         10  PC-TSYMSG-00017            PIC  9(05)  VALUE  00017. 01270006
012800         10  PC-TSYMSG-00034            PIC  9(05)  VALUE  00034. 01280006
012900         10  PC-TSYMSG-00046            PIC  9(05)  VALUE  00046. 01290006
013000         10  PC-TSYMSG-00047            PIC  9(05)  VALUE  00047. 01300006
013100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE  00057. 01310006
013200         10  PC-TSYMSG-00059            PIC  9(05)  VALUE  00059. 01320006
013300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE  00069. 01330006
013400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE  00070. 01340006
013500         10  PC-TSYMSG-00073            PIC  9(05)  VALUE  00073. 01350006
013600         10  PC-TSYMSG-00100            PIC  9(05)  VALUE  00100. 01360006
013700         10  PC-TSYMSG-00112            PIC  9(05)  VALUE  00112. 01370006
013800         10  PC-TSYMSG-00115            PIC  9(05)  VALUE  00115. 01380006
013900         10  PC-TSYMSG-00116            PIC  9(05)  VALUE  00116. 01390006
014000         10  PC-TSYMSG-00117            PIC  9(05)  VALUE  00117. 01400006
014100         10  PC-TSYMSG-00118            PIC  9(05)  VALUE  00118. 01410006
014200         10  PC-TSYMSG-00124            PIC  9(05)  VALUE  00124. 01420006
014300         10  PC-TSYMSG-00134            PIC  9(05)  VALUE  00134. 01430006
014400         10  PC-TSYMSG-00148            PIC  9(05)  VALUE  00148. 01440006
014500         10  PC-TSYMSG-00158            PIC  9(05)  VALUE  00158. 01450006
014600         10  PC-TSYMSG-00164            PIC  9(05)  VALUE  00164. 01460006
014700         10  PC-TSYMSG-00165            PIC  9(05)  VALUE  00165. 01470006
014800         10  PC-TSYMSG-00170            PIC  9(05)  VALUE  00170. 01480006
014900         10  PC-TSYMSG-00224            PIC  9(05)  VALUE  00224. 01490006
015000         10  PC-TSYMSG-00231            PIC  9(05)  VALUE  00231. 01500006
015100         10  PC-TSYMSG-00308            PIC  9(05)  VALUE  00308. 01510006
015200         10  PC-TSYMSG-00316            PIC  9(05)  VALUE  00316. 01520006
015300         10  PC-TSYMSG-00349            PIC  9(05)  VALUE  00349. 01530006
015400         10  PC-TSYMSG-00354            PIC  9(05)  VALUE  00354. 01540006
015500         10  PC-TSYMSG-00396            PIC  9(05)  VALUE  00396. 01550006
015600         10  PC-TSYMSG-00457            PIC  9(05)  VALUE  00457. 01560006
015700         10  PC-TSYMSG-00482            PIC  9(05)  VALUE  00482. 01570006
015800         10  PC-TSYMSG-00494            PIC  9(05)  VALUE  00494. 01580006
015900         10  PC-TSYMSG-00601            PIC  9(05)  VALUE  00601. 01590006
016000         10  PC-TSYMSG-00726            PIC  9(05)  VALUE  00726. 01600006
016100         10  PC-TSYMSG-00849            PIC  9(05)  VALUE  00849. 01610006
016200         10  PC-TSYMSG-00850            PIC  9(05)  VALUE  00850. 01620006
016300         10  PC-TSYMSG-00852            PIC  9(05)  VALUE  00852. 01630006
016400         10  PC-TSYMSG-00855            PIC  9(05)  VALUE  00855. 01640006
016500         10  PC-TSYMSG-00856            PIC  9(05)  VALUE  00856. 01650006
016600         10  PC-TSYMSG-00857            PIC  9(05)  VALUE  00857. 01660006
016700         10  PC-TSYMSG-00858            PIC  9(05)  VALUE  00858. 01670006
016800         10  PC-TSYMSG-00859            PIC  9(05)  VALUE  00859. 01680006
016900         10  PC-TSYMSG-00860            PIC  9(05)  VALUE  00860. 01690006
017000         10  PC-TSYMSG-00865            PIC  9(05)  VALUE  00865. 01700006
017100         10  PC-TSYMSG-00869            PIC  9(05)  VALUE  00869. 01710006
017200         10  PC-TSYMSG-00870            PIC  9(05)  VALUE  00870. 01720006
017300         10  PC-TSYMSG-00871            PIC  9(05)  VALUE  00871. 01730006
017400         10  PC-TSYMSG-00873            PIC  9(05)  VALUE  00873. 01740006
017500         10  PC-TSYMSG-00874            PIC  9(05)  VALUE  00874. 01750006
017600         10  PC-TSYMSG-00913            PIC  9(05)  VALUE  00913. 01760006
017700         10  PC-TSYMSG-00961            PIC  9(05)  VALUE  00961. 01770006
017800                                                                  01780006
017900 01  PV-PROGRAM-VARIABLES.                                        01790006
018000                                                                  01800006
018100     05  PV-DB2-COUNT                   PIC S9(9) COMP.           01810006
018200     05  PV-NULL-INDICATORS.                                      01820006
018300         10  MIITEM-PO-LNE-NBR-NN       PIC S9(4) COMP.           01830006
018400                                                                  01840006
018500     05  PV-NUM3                        PIC ZZ9.                  01850006
018600     05  PV-NUM3-X REDEFINES                                      01860006
018700         PV-NUM3                        PIC X(3).                 01870006
018800     05  PV-NUM4                        PIC ZZZ9.                 01880006
018900     05  PV-NUM4-X REDEFINES                                      01890006
019000         PV-NUM4                        PIC X(4).                 01900006
019100     05  PV-NUM7                        PIC Z(7).                 01910011
019200     05  PV-NUM7-X REDEFINES                                      01920011
019300         PV-NUM7                        PIC X(7).                 01930011
019310     05  PV-NUM9                        PIC Z(9).                 01931011
019320     05  PV-NUM9-X REDEFINES                                      01932011
019330         PV-NUM9                        PIC X(9).                 01933011
019400     05  PV-NUM11                       PIC Z(11).                01940006
019500     05  PV-NUM11-X REDEFINES                                     01950006
019600         PV-NUM11                       PIC X(11).                01960006
019700     05  PV-7V99                        PIC Z(7).99.              01970006
019800     05  PV-7V99-X REDEFINES                                      01980006
019900         PV-7V99                        PIC X(10).                01990006
020000     05  PV-6V999                       PIC Z(6).999.             02000006
020100     05  PV-6V999-X REDEFINES                                     02010006
020200         PV-6V999                       PIC X(10).                02020006
020300     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      02030006
020400                                                    COMP SYNC.    02040006
020500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02050006
020600                                                    COMP SYNC.    02060006
020700     05  PV-WORK-FIELD                   PIC S9(17)   COMP-3      02070006
020800                                                      VALUE +0.   02080006
020900     05  PV-WORK-FIELD2                  PIC S9(17)   COMP-3      02090006
021000                                                      VALUE +0.   02100006
021100     05  PV-DUP-COUNTER                 PIC S9(04) COMP.          02110006
021200                                                                  02120006
021300 01  PS-PROGRAM-SWITCHES.                                         02130006
021400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    02140006
021500         88  PS-NO-ERROR                            VALUE 'Y'.    02150006
021600         88  PS-ERROR                               VALUE 'N'.    02160006
021700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    02170006
021800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    02180006
021900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    02190006
022000     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    02200006
022100         88  PS-DONE                                VALUE 'Y'.    02210006
022200         88  PS-NOT-DONE                            VALUE 'N'.    02220006
022300     05  PS-PURITM-FOUND-SW             PIC  X(01)  VALUE 'N'.    02230006
022400         88  PURITM-FOUND                           VALUE 'Y'.    02240006
022500         88  PURITM-NOT-FOUND                       VALUE 'N'.    02250006
022600/                                                                 02260006
022700*---------------------------------------------------------------* 02270006
022800*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02280006
022900*---------------------------------------------------------------* 02290006
023000                                                                  02300006
023100     COPY APWS301.                                                02310006
023200                                                                  02320006
023300/                                                                 02330006
023400*---------------------------------------------------------------* 02340006
023500*    MAP LAYOUT                                                 * 02350006
023600*---------------------------------------------------------------* 02360006
023700                                                                  02370006
023800     COPY APKM346.                                                02380006
023900/                                                                 02390006
024000*---------------------------------------------------------------* 02400006
024100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02410006
024200*---------------------------------------------------------------* 02420006
024300                                                                  02430006
024400     COPY DPWS015.                                                02440006
024500                                                                  02450006
024600*---------------------------------------------------------------* 02460006
024700*    FUNCTION KEYS COPYBOOK.                                    * 02470006
024800*---------------------------------------------------------------* 02480006
024900                                                                  02490006
025000     COPY DPWS016.                                                02500006
025100                                                                  02510006
025200*---------------------------------------------------------------* 02520006
025300*  WORK AREA FOR NUMERIC EDIT ROUTINE - DPKUT100                * 02530006
025400*---------------------------------------------------------------* 02540006
025500     COPY DPWS010I.                                               02550006
025600                                                                  02560006
025700/                                                                 02570006
025800*---------------------------------------------------------------* 02580006
025900*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 02590006
026000*---------------------------------------------------------------* 02600006
026100                                                                  02610006
026200     COPY DPWS030.                                                02620006
026210     COPY DPWS930.                                                02621014
026300                                                                  02630006
026400/                                                                 02640006
026500*---------------------------------------------------------------* 02650006
026600*    STANDARD COMMAREA.                                         * 02660006
026700*---------------------------------------------------------------* 02670006
026800                                                                  02680006
026900     COPY DPWS020.                                                02690006
027000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02700006
027100                                                                  02710006
027200         10  INTER-APPL-COMM-AREA       PIC X(200).               02720006
027300     COPY APWS300.                                                02730006
027400*---------------------------------------------------------------* 02740006
027500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02750006
027600*---------------------------------------------------------------* 02760006
027700         10  ASC-SPECIFIC-COMMAREA.                               02770006
027800             15  ASC-INT-APPL-FORMAT-IND    PIC X(01).            02780006
027900                 88  ASC-INTER-APPL-CRIT-UPD     VALUE ' '.       02790006
028000                 88  ASC-INTER-APPL-CRIT-DEL     VALUE '1'.       02800006
028100                 88  ASC-INTER-APPL-LIST-UPD     VALUE '5'.       02810006
028200                 88  ASC-INTER-APPL-LIST-DEL     VALUE '6'.       02820006
028300             15  ASC-ACTION-SW              PIC X(03).            02830006
028400                 88  ASC-NO-CHANGES-ALLOWED VALUE 'NOC'.          02840006
028500             15  ASC-FIELDS-MODIFIED-SW     PIC X(01).            02850006
028600                 88  ASC-FIELDS-MODIFIED    VALUE 'Y'.            02860006
028700             15  ASC-INVOICE-FOUND-SW       PIC X(01).            02870006
028800                 88  ASC-INVOICE-FOUND      VALUE 'Y'.            02880006
028900                 88  ASC-INVOICE-NOT-FOUND  VALUE 'N'.            02890006
029000                 88  ASC-INVOICE-DUPLICATE  VALUE 'D'.            02900006
029100             15  ASC-TALCHRG-EXISTS-SW      PIC X(01).            02910006
029200                 88  ASC-TALCHRG-EXISTS     VALUE 'Y'.            02920006
029300             15  ASC-KEY-FIELDS.                                  02930006
029400                 20  ASC-KEY-PAYT-REQ-SEQ-NBR     PIC S9(09) COMP.02940006
029500                 20  ASC-KEY-PO-NBR               PIC S9(09) COMP.02950006
029600                 20  ASC-KEY-INVC-ID              PIC  X(22).     02960006
029700                 20  ASC-KEY-INVC-STATUS          PIC  X(02).     02970006
029800                 20  ASC-KEY-PO-LNE-NBR           PIC S9(09) COMP.02980006
029900                 20  ASC-KEY-PAYT-REQ-LNE-NBR     PIC S9(09) COMP.02990006
030000                 20  ASC-KEY-DEPT-NBR             PIC  X(03).     03000006
030100             15  ASC-ORIGINAL-FIELD-VALUES.                       03010006
030200                 20  ASC-OLD-PO-LNE-NBR           PIC S9(09) COMP.03020006
030300                 20  ASC-OLD-PREQIT-FIELDS.                       03030006
030400                     25  ASC-OLD-PAY-REQ-LNE-QTY  PIC S9(09) COMP.03040006
030500                     25  ASC-OLD-QTY-UNT-OF-MSMT  PIC  X(02).     03050006
030600                     25  ASC-OLD-UNT-COST-AMT     PIC S9(07)V9(3) 03060006
030700                                                       COMP-3.    03070006
030800             15  ASC-NEWLY-ENTERED-FIELD-VALUES.                  03080006
030900                 20  ASC-NEW-PO-LNE-NBR           PIC S9(09) COMP.03090006
031000                 20  ASC-NEW-PREQIT-FIELDS.                       03100006
031100                     25  ASC-NEW-PAY-REQ-LNE-QTY  PIC S9(09) COMP.03110006
031200                     25  ASC-NEW-QTY-UNT-OF-MSMT  PIC  X(02).     03120006
031300                     25  ASC-NEW-UNT-COST-AMT     PIC S9(07)V9(3) 03130006
031400                                                       COMP-3.    03140006
031500             15  ASC-ALPHA-COUNTERPARTS.                          03150006
031600                 20  ASC-ALP-PO-LNE-NBR.                          03160006
031700                     25  ASC-ALP-PO-LNE-NBR-NUM                   03170006
031800                                                  PIC 9(4).       03180006
031900                 20  ASC-ALP-PAY-REQ-LNE-QTY.                     03190006
032000                     25  ASC-ALP-PAY-REQ-LNE-QTY-NUM              03200006
032100                                                  PIC 9(7).       03210006
032200                 20  ASC-ALP-UNT-COST-AMT.                        03220006
032300                     25  ASC-ALP-UNT-COST-AMT-NUM PIC 9(7)V9(3).  03230006
032400                                                                  03240006
032500             15  ASC-OTHER-FIELDS.                                03250006
032600                 20  ASC-INVC-TYP-CDE         PIC X(2).           03260006
032700                 20  ASC-ENTR-MTHD-CDE        PIC X(2).           03270006
032800                 20  ASC-PREV-KEY-FIELDS.                         03280006
032900                     25  ASC-PREV-PO-LNE-NBR  PIC 9(04).          03290006
033000                 20  ASC-PAY-IND              PIC X(1).           03300006
033100                 20  ASC-DUN-NBR              PIC  X(09).         03310006
033200                 20  ASC-CURRENT-TIMESTAMP    PIC  X(26).         03320006
033300                 20  ASC-CURRENT-TS-RDF       REDEFINES           03330006
033400                     ASC-CURRENT-TIMESTAMP.                       03340006
033500                     25  ASC-CURRENT-DATE     PIC X(10).          03350006
033600                     25  FILLER               PIC X(01).          03360006
033700                     25  ASC-CURRENT-TIME.                        03370006
033800                         30  ASC-HH           PIC 9(02).          03380006
033900                         30  FILLER           PIC X(01).          03390006
034000                         30  ASC-MIN          PIC 9(02).          03400006
034100                         30  FILLER           PIC X(01).          03410006
034200                         30  ASC-SEC          PIC 9(02).          03420006
034300                         30  FILLER           PIC X(01).          03430006
034400                         30  ASC-MILLI-SEC    PIC 9(06).          03440006
034500             15  ASC-USE-SELECTION-QUEUE-IND                      03450006
034600                                        PIC  X(01).               03460006
034700                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    03470006
034800             15  ASC-SEL-QUEUE-NAME     PIC  X(08).               03480006
034900             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05)  COMP-3.       03490006
035000             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03500006
035100                                        PIC S9(09)  COMP-3.       03510006
035200             15  ASC-SEL-SUB            PIC S9(04)  COMP.         03520006
035300             15  ASC-SEL-ITEM           PIC S9(04)  COMP.         03530006
035400                                                                  03540006
035500/                                                                 03550006
035600*---------------------------------------------------------------* 03560006
035700*    ABEND PROCESSING COPYBOOK.                                 * 03570006
035800*---------------------------------------------------------------* 03580006
035900                                                                  03590006
036000     COPY DPWS013.                                                03600006
036100                                                                  03610006
036200/                                                                 03620006
036300*---------------------------------------------------------------* 03630006
036400*    DB2 TABLE LAYOUTS                                          * 03640006
036500*---------------------------------------------------------------* 03650006
036600                                                                  03660006
036700     EXEC SQL INCLUDE TPREQIT  END-EXEC.                          03670006
036800/                                                                 03680006
036900     EXEC SQL INCLUDE TINVOIC  END-EXEC.                          03690006
037000/                                                                 03700006
037100     EXEC SQL INCLUDE TMIITEM  END-EXEC.                          03710006
037200/                                                                 03720006
037300     EXEC SQL INCLUDE TPURITM  END-EXEC.                          03730006
037400/                                                                 03740006
037500*---------------------------------------------------------------* 03750006
037600*    DB2 AREA FOR COMMUNICATIONS                                * 03760006
037700*---------------------------------------------------------------* 03770006
037800     EXEC SQL                                                     03780006
037900          INCLUDE  SQLCA                                          03790006
038000     END-EXEC.                                                    03800006
038100                                                                  03810006
038200/                                                                 03820006
038300 LINKAGE SECTION.                                                 03830006
038400                                                                  03840006
038500 01  DFHCOMMAREA.                                                 03850006
038600     05  FILLER                         OCCURS  1 TO 4072 TIMES   03860006
038700                                        DEPENDING ON EIBCALEN.    03870006
038800         10  FILLER                     PIC X.                    03880006
038900                                                                  03890006
039000/                                                                 03900006
039100 PROCEDURE DIVISION.                                              03910006
039200*---------------------------------------------------------------* 03920006
039300*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 03930006
039400*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 03940006
039500*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 03950006
039600*---------------------------------------------------------------* 03960006
039700 0000-MAIN-MODULE.                                                03970006
039800                                                                  03980006
039900     INITIALIZE DP030-CICS-API-FIELDS.                            03990006
040000                                                                  04000006
040100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04010006
040200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04020006
040300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04030006
040400                                                                  04040006
040500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04050006
040600                                                                  04060006
040700     MOVE LENGTH OF AP346AI        TO DP030-MAP-LENGTH (1).       04070006
040800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04080006
040900                                                                  04090006
041000     PERFORM 0001-CALL-CICS-ARCH-API.                             04100006
041100     PERFORM 1000-CONTROL-PROCESSING                              04110006
041200                                                                  04120006
041300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04130006
041400     PERFORM 0001-CALL-CICS-ARCH-API.                             04140006
041500                                                                  04150006
041600*---------------------------------------------------------------* 04160006
041700*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 04170006
041800*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 04180006
041900*---------------------------------------------------------------* 04190006
042000 0001-CALL-CICS-ARCH-API.                                         04200006
042100     CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     04210013
042200                                     DFHCOMMAREA                  04220013
042300                                     DP030-CICS-API-FIELDS        04230013
042400                                     DP020-STANDARD-COMMAREA      04240013
042500                                     AP346AI.                     04250013
042600                                                                  04260006
042700     IF  DP030-RC-CALL-SUCCESSFUL                                 04270006
042800         CONTINUE                                                 04280006
042900     ELSE                                                         04290006
043000         SET DP013-NO-ROLLBACK                                    04300006
043100             DP013-XCTL-DISPLAY-RESTART                           04310006
043200             DP013-CICS-ABEND      TO TRUE                        04320006
043300         MOVE '0001-CALL-CICS-ARCH-API'                           04330006
043400                                   TO DP013-PARAGRAPH             04340006
043500         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04350014
043600-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04360014
043700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04370006
043800         PERFORM DP013-0000-PROCESS-ABEND                         04380006
043900     END-IF.                                                      04390006
044000                                                                  04400006
044100*---------------------------------------------------------------- 04410006
044200* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       04420006
044300* COURSE OF ACTION IS FOR THIS TRANSACTION.                       04430006
044400*---------------------------------------------------------------- 04440006
044500                                                                  04450006
044600 1000-CONTROL-PROCESSING.                                         04460006
044700                                                                  04470006
044800     EVALUATE TRUE                                                04480006
044900         WHEN DP020-NEXT-ACT-INITIAL                              04490006
045000              PERFORM 1100-FIND-OBJECT-KEYS                       04500006
045100              IF  PS-ERROR                                        04510006
045200                  CONTINUE                                        04520006
045300              ELSE                                                04530006
045400                  PERFORM 4000-BUILD-INITIAL-PANEL                04540006
045500                  IF PS-ERROR                                     04550006
045600                      CONTINUE                                    04560006
045700                  ELSE                                            04570006
045800                      PERFORM 3200-RESET-ATTRIBUTES               04580006
045900                      PERFORM 3500-SAVE-SCREEN-FIELDS             04590006
046000                      IF ASC-INVOICE-NOT-FOUND                    04600006
046100                          SET DP020-NEXT-ACT-APPL-ERROR           04610006
046200                                         TO TRUE                  04620006
046300                          MOVE PC-TSYMSG-00855                    04630006
046400                                         TO DP020-MSG-NUMBER      04640006
046500                          SET DP020-MSG-INFORMATIONAL             04650006
046600                                         TO TRUE                  04660006
046700                      END-IF                                      04670006
046800                  END-IF                                          04680006
046900              END-IF                                              04690006
047000                                                                  04700006
047100         WHEN DP020-NEXT-ACT-READ-MAP                             04710006
047200             PERFORM 2000-PROCESS-PANEL                           04720006
047300                                                                  04730006
047400         WHEN DP020-NEXT-ACT-RETURN                               04740006
047500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04750006
047600                                                                  04760006
047700         WHEN OTHER                                               04770006
047800             SET DP013-LOGIC-ABEND TO TRUE                        04780006
047900             SET DP013-NO-ROLLBACK TO TRUE                        04790006
048000             MOVE '1000-CONTROL-PROCESSING'                       04800006
048100                                   TO DP013-PARAGRAPH             04810006
048200             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04820006
048300                                   TO DP013-MESSAGE-TEXT(1)       04830006
048400             MOVE DP020-NEXT-APPL-ACTIVITY                        04840006
048500                                   TO DP013-MESSAGE-TEXT(2)       04850006
048600             PERFORM DP013-0000-PROCESS-ABEND                     04860006
048700     END-EVALUATE.                                                04870006
048800                                                                  04880006
048900/                                                                 04890006
049000*---------------------------------------------------------------- 04900006
049100*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE     04910006
049200*  INTER-APPLICATION FORMAT CODE.                                 04920006
049300*---------------------------------------------------------------- 04930006
049400 1100-FIND-OBJECT-KEYS.                                           04940006
049500                                                                  04950006
049600     INITIALIZE ASC-SPECIFIC-COMMAREA.                            04960006
049700     SET PS-NO-ERROR             TO TRUE.                         04970006
049800                                                                  04980006
049900     MOVE AP300-INVC-ID          TO ASC-KEY-INVC-ID.              04990006
050000     MOVE AP300-PO-NBR           TO ASC-KEY-PO-NBR.               05000006
050100     MOVE AP300-DEPT-NBR         TO ASC-KEY-DEPT-NBR.             05010006
050200                                                                  05020006
050300     MOVE AP300-PO-LNE-NBR       TO ASC-KEY-PO-LNE-NBR.           05030006
050400     MOVE AP300-PAYT-REQ-LNE-NBR TO ASC-KEY-PAYT-REQ-LNE-NBR.     05040006
050500                                                                  05050006
050600     IF ASC-KEY-INVC-ID > SPACES                                  05060006
050700         CONTINUE                                                 05070006
050800     ELSE                                                         05080006
050900         MOVE PC-TSYMSG-00849    TO DP020-MSG-NUMBER              05090006
051000         SET DP020-MSG-FATAL                                      05100006
051100             DP020-NEXT-ACT-APPL-ERROR                            05110006
051200             PS-ERROR            TO TRUE                          05120006
051300     END-IF.                                                      05130006
051400                                                                  05140006
051500     IF PS-NO-ERROR                                               05150006
051600         MOVE DP020-INT-APPL-FORMAT-IND                           05160006
051700                                     TO ASC-INT-APPL-FORMAT-IND   05170006
051800         EVALUATE TRUE                                            05180006
051900                                                                  05190006
052000             WHEN ASC-INTER-APPL-LIST-UPD                         05200006
052100             WHEN ASC-INTER-APPL-LIST-DEL                         05210006
052200                 SET ASC-USE-SELECTION-QUEUE                      05220006
052300                                 TO TRUE                          05230006
052400                 MOVE AP300-NUMBER-OF-SELECTED-ITEMS              05240006
052500                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  05250006
052600                 MOVE AP300-NUMBER-OF-TS-ITEMS                    05260006
052700                                 TO ASC-NUMBER-OF-TS-ITEMS        05270006
052800                 MOVE AP300-SEL-QUEUE-NAME                        05280006
052900                                 TO ASC-SEL-QUEUE-NAME            05290006
053000                                                                  05300006
053100                 PERFORM 1120-PREPARE-LIST-ENTRY                  05310006
053200                                                                  05320006
053300             WHEN OTHER                                           05330006
053400                 MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER         05340006
053500                 SET DP020-MSG-FATAL                              05350006
053600                     DP020-NEXT-ACT-APPL-ERROR                    05360006
053700                     PS-ERROR        TO TRUE                      05370006
053800         END-EVALUATE                                             05380006
053900     END-IF.                                                      05390006
054000                                                                  05400006
054100/                                                                 05410006
054200*---------------------------------------------------------------- 05420006
054300* ENTRY IS FROM A LIST.  GET THE FORMAT NUMBER FROM THE TEMP      05430006
054400* STORAGE QUEUE PASSED FROM THE LIST.                             05440006
054500*---------------------------------------------------------------- 05450006
054600 1120-PREPARE-LIST-ENTRY.                                         05460006
054700                                                                  05470006
054800     MOVE AP301-MAX-ITEMS          TO ASC-SEL-SUB.                05480006
054900     MOVE ZERO                     TO ASC-SEL-ITEM.               05490006
055000     PERFORM 2110-GET-NEXT-RECORD.                                05500006
055100/                                                                 05510006
055200*---------------------------------------------------------------- 05520006
055300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA    05530006
055400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT    05540006
055500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST   05550006
055600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID       05560006
055700* FUNCTION KEYS CAN GET THIS FAR.                                 05570006
055800*---------------------------------------------------------------- 05580006
055900                                                                  05590006
056000 2000-PROCESS-PANEL.                                              05600006
056100                                                                  05610006
056200     EVALUATE TRUE                                                05620006
056300                                                                  05630006
056400         WHEN DP020-SRC-AID = DP016-CLEAR                         05640006
056500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05650006
056600                                                                  05660006
056700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05670006
056800             SET DP030-DONT-ERASE                                 05680006
056900                 DP030-SEND-DATAONLY (PC-APPL-MAP)                05690006
057000                               TO TRUE                            05700006
057100             PERFORM 4000-BUILD-INITIAL-PANEL                     05710006
057200             PERFORM 3200-RESET-ATTRIBUTES                        05720006
057300             PERFORM 3500-SAVE-SCREEN-FIELDS                      05730006
057400                                                                  05740006
057500         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05750006
057600             IF  ASC-USE-SELECTION-QUEUE                          05760006
057700                 PERFORM 2110-GET-NEXT-RECORD                     05770006
057800                 PERFORM 4000-BUILD-INITIAL-PANEL                 05780006
057900                 PERFORM 3200-RESET-ATTRIBUTES                    05790006
058000                 PERFORM 3500-SAVE-SCREEN-FIELDS                  05800006
058100             ELSE                                                 05810006
058200*                --- BOTTOM OF LIST ---                           05820006
058300                 MOVE PC-TSYMSG-00070                             05830006
058400                                   TO DP020-MSG-NUMBER            05840006
058500                 SET DP020-MSG-INFORMATIONAL                      05850006
058600                                   TO TRUE                        05860006
058700             END-IF                                               05870006
058800                                                                  05880006
058900         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             05890006
059000             IF  ASC-USE-SELECTION-QUEUE                          05900006
059100                 PERFORM 2120-GET-PREV-RECORD                     05910006
059200                 PERFORM 4000-BUILD-INITIAL-PANEL                 05920006
059300                 PERFORM 3200-RESET-ATTRIBUTES                    05930006
059400                 PERFORM 3500-SAVE-SCREEN-FIELDS                  05940006
059500             ELSE                                                 05950006
059600*                --- TOP OF LIST ---                              05960006
059700                 MOVE PC-TSYMSG-00069                             05970006
059800                                   TO DP020-MSG-NUMBER            05980006
059900                 SET DP020-MSG-INFORMATIONAL                      05990006
060000                                   TO TRUE                        06000006
060100             END-IF                                               06010006
060200                                                                  06020006
060300         WHEN OTHER                                               06030006
060400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06040006
060500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06050006
060600             IF PS-NO-ERROR        OR                             06060006
060700                DP020-MSG-WARNING                                 06070006
060800                 SET DP030-CONTINUE-GO                            06080006
060900                                   TO TRUE                        06090006
061000                 PERFORM 2100-CHECK-FUNCTION-KEY                  06100006
061100             ELSE                                                 06110006
061200                 SET DP030-OVERRIDE-GO                            06120006
061300                                   TO TRUE                        06130006
061400             END-IF                                               06140006
061500     END-EVALUATE.                                                06150006
061600/                                                                 06160006
061700*---------------------------------------------------------------- 06170006
061800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST. 06180006
061900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE   06190006
062000* CICS ARCHITECTURE API.                                          06200006
062100*---------------------------------------------------------------- 06210006
062200 2100-CHECK-FUNCTION-KEY.                                         06220006
062300                                                                  06230006
062400     EVALUATE TRUE                                                06240006
062500         WHEN DP020-SRC-AID = DP016-ENTER                         06250006
062600             CONTINUE                                             06260006
062700                                                                  06270006
062800         WHEN OTHER                                               06280006
062900             SET DP013-NO-ROLLBACK                                06290006
063000                 DP013-XCTL-DISPLAY-RESTART                       06300006
063100                 DP013-CICS-ABEND  TO TRUE                        06310006
063200             MOVE '2100-CHECK-FUNCTION-KEY'                       06320006
063300                                   TO DP013-PARAGRAPH             06330006
063400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06340006
063500                                   TO DP013-MESSAGE-TEXT (1)      06350006
063600             PERFORM DP013-0000-PROCESS-ABEND                     06360006
063700     END-EVALUATE.                                                06370006
063800/                                                                 06380006
063900 2110-GET-NEXT-RECORD.                                            06390006
064000                                                                  06400006
064100     ADD +1                        TO ASC-SEL-SUB.                06410006
064200     IF  ASC-SEL-SUB > AP301-MAX-ITEMS                            06420006
064300         ADD +1                    TO ASC-SEL-ITEM                06430006
064400         MOVE +1                   TO ASC-SEL-SUB                 06440006
064500     END-IF.                                                      06450006
064600                                                                  06460006
064700     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                06470006
064800         PERFORM 9100-READ-SEL-QUEUE                              06480006
064900         IF  AP301-ITEM (ASC-SEL-SUB) > ZERO                      06490006
065000             MOVE AP301-PO-LNE-NBR       (ASC-SEL-SUB)            06500006
065100                                   TO ASC-KEY-PO-LNE-NBR          06510006
065200             MOVE AP301-PAYT-REQ-LNE-NBR (ASC-SEL-SUB)            06520006
065300                                   TO ASC-KEY-PAYT-REQ-LNE-NBR    06530006
065400         ELSE                                                     06540006
065500             SUBTRACT +1 FROM ASC-SEL-SUB                         06550006
065600*            --- BOTTOM OF LIST ---                               06560006
065700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06570006
065800             SET DP020-MSG-INFORMATIONAL                          06580006
065900                                   TO TRUE                        06590006
066000         END-IF                                                   06600006
066100     ELSE                                                         06610006
066200         SUBTRACT +1 FROM ASC-SEL-ITEM                            06620006
066300         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 06630006
066400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06640006
066500         SET DP020-MSG-INFORMATIONAL                              06650006
066600                                   TO TRUE                        06660006
066700     END-IF.                                                      06670006
066800                                                                  06680006
066900/                                                                 06690006
067000 2120-GET-PREV-RECORD.                                            06700006
067100                                                                  06710006
067200     SUBTRACT +1 FROM ASC-SEL-SUB.                                06720006
067300     IF  ASC-SEL-SUB < +1                                         06730006
067400         SUBTRACT +1 FROM ASC-SEL-ITEM                            06740006
067500         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 06750006
067600     END-IF.                                                      06760006
067700                                                                  06770006
067800     IF  ASC-SEL-ITEM > ZERO                                      06780006
067900         PERFORM 9100-READ-SEL-QUEUE                              06790006
068000         MOVE AP301-PO-LNE-NBR       (ASC-SEL-SUB)                06800006
068100                               TO ASC-KEY-PO-LNE-NBR              06810006
068200         MOVE AP301-PAYT-REQ-LNE-NBR (ASC-SEL-SUB)                06820006
068300                               TO ASC-KEY-PAYT-REQ-LNE-NBR        06830006
068400     ELSE                                                         06840006
068500         MOVE +1                   TO ASC-SEL-ITEM                06850006
068600                                      ASC-SEL-SUB                 06860006
068700*        --- TOP OF LIST ---                                      06870006
068800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06880006
068900         SET DP020-MSG-INFORMATIONAL                              06890006
069000                                   TO TRUE                        06900006
069100     END-IF.                                                      06910006
069200                                                                  06920006
069300/                                                                 06930006
069400*---------------------------------------------------------------- 06940006
069500*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE      06950006
069600*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.   06960006
069700*---------------------------------------------------------------- 06970006
069800 2200-MOVE-SCREEN-TO-COMMAREA.                                    06980006
069900                                                                  06990006
070000     IF  APOLNEL  > ZERO                                          07000006
070100         MOVE APOLNEI              TO ASC-ALP-PO-LNE-NBR          07010006
070200     ELSE                                                         07020006
070300         IF  APOLNEF  = DP015-ERASE-EOF                           07030006
070400             MOVE SPACE            TO ASC-ALP-PO-LNE-NBR          07040006
070500         END-IF                                                   07050006
070600     END-IF.                                                      07060006
070700                                                                  07070006
070800     IF  ANBRPCSL > ZERO                                          07080006
070900         MOVE ANBRPCSI             TO ASC-ALP-PAY-REQ-LNE-QTY     07090006
071000     ELSE                                                         07100006
071100         IF  ANBRPCSF = DP015-ERASE-EOF                           07110006
071200             MOVE SPACE            TO ASC-ALP-PAY-REQ-LNE-QTY     07120006
071300         END-IF                                                   07130006
071400     END-IF.                                                      07140006
071500                                                                  07150006
071600     IF  AUOML    > ZERO                                          07160006
071700         MOVE AUOMI                TO ASC-NEW-QTY-UNT-OF-MSMT     07170006
071800     ELSE                                                         07180006
071900         IF  AUOMF    = DP015-ERASE-EOF                           07190006
072000             MOVE SPACE            TO ASC-NEW-QTY-UNT-OF-MSMT     07200006
072100         END-IF                                                   07210006
072200     END-IF.                                                      07220006
072300                                                                  07230006
072400     IF  AUNTCSTL > ZERO                                          07240006
072500         MOVE AUNTCSTI             TO ASC-ALP-UNT-COST-AMT        07250006
072600     ELSE                                                         07260006
072700         IF  AUNTCSTF = DP015-ERASE-EOF                           07270006
072800             MOVE SPACE            TO ASC-ALP-UNT-COST-AMT        07280006
072900         END-IF                                                   07290006
073000     END-IF.                                                      07300006
073100                                                                  07310006
073200/                                                                 07320006
073300*----------------------------------------------------------------*07330006
073400* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *07340006
073500* MAP.                                                           *07350006
073600*----------------------------------------------------------------*07360006
073700 3200-RESET-ATTRIBUTES.                                           07370006
073800                                                                  07380006
073900     PERFORM 3220-PROTECT-ALL-FIELDS.                             07390006
074000                                                                  07400006
074100 3210-UNPROTECT-PO-LNE-NBR.                                       07410006
074200                                                                  07420006
074300     MOVE DP015-UNP-ALP-NOR-OFF    TO                             07430006
074400           APOLNEA.                                               07440006
074500     MOVE DP015-GREEN              TO                             07450006
074600           APOLNEC.                                               07460006
074700     MOVE DP015-UNDERLINE          TO                             07470006
074800           APOLNEH.                                               07480006
074900                                                                  07490006
075000 3215-UNPROTECT-TPREQIT-FIELDS.                                   07500006
075100                                                                  07510006
075200     MOVE DP015-UNP-ALP-NOR-OFF    TO                             07520006
075300          ANBRPCSA                                                07530006
075400             AUOMA                                                07540006
075500          AUNTCSTA                                                07550006
075600     MOVE DP015-GREEN              TO                             07560006
075700          ANBRPCSC                                                07570006
075800             AUOMC                                                07580006
075900          AUNTCSTC                                                07590006
076000     MOVE DP015-UNDERLINE          TO                             07600006
076100          ANBRPCSH                                                07610006
076200             AUOMH                                                07620006
076300          AUNTCSTH.                                               07630006
076400                                                                  07640006
076500/                                                                 07650006
076600 3220-PROTECT-ALL-FIELDS.                                         07660006
076700                                                                  07670006
076800     PERFORM 3222-PROTECT-PO-LNE-NBR                              07680006
076900     PERFORM 3224-PROTECT-TPREQIT-FIELDS.                         07690006
077000*    PERFORM 3226-PROTECT-BOTTOM-HALF.                            07700006
077100                                                                  07710006
077200 3222-PROTECT-PO-LNE-NBR.                                         07720006
077300                                                                  07730006
077400     MOVE DP015-PRO-NOR-OFF        TO                             07740006
077500           APOLNEA                                                07750006
077600     MOVE DP015-BLUE               TO                             07760006
077700           APOLNEC                                                07770006
077800     MOVE DP015-HL-OFF             TO                             07780006
077900           APOLNEH.                                               07790006
078000                                                                  07800006
078100 3224-PROTECT-TPREQIT-FIELDS.                                     07810006
078200                                                                  07820006
078300     MOVE DP015-PRO-NOR-OFF        TO                             07830006
078400          ANBRPCSA                                                07840006
078500             AUOMA                                                07850006
078600          AUNTCSTA                                                07860006
078700                                                                  07870006
078800     MOVE DP015-BLUE               TO                             07880006
078900          ANBRPCSC                                                07890006
079000             AUOMC                                                07900006
079100          AUNTCSTC                                                07910006
079200                                                                  07920006
079300     MOVE DP015-HL-OFF             TO                             07930006
079400          ANBRPCSH                                                07940006
079500             AUOMH                                                07950006
079600          AUNTCSTH.                                               07960006
079700                                                                  07970006
079800/                                                                 07980006
079900*---------------------------------------------------------------- 07990006
080000*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST      08000006
080100*    ENTRY.                                                       08010006
080200*---------------------------------------------------------------- 08020006
080300                                                                  08030006
080400 3500-SAVE-SCREEN-FIELDS.                                         08040006
080500                                                                  08050006
080600     MOVE ASC-NEWLY-ENTERED-FIELD-VALUES  TO                      08060006
080700          ASC-ORIGINAL-FIELD-VALUES.                              08070006
080800/                                                                 08080006
080900*---------------------------------------------------------------- 08090006
081000*  CHECK TO SEE IF ANY FIELDS CHANGED.                            08100006
081100*---------------------------------------------------------------- 08110006
081200                                                                  08120006
081300 3600-CHECK-IF-FIELDS-CHANGED.                                    08130006
081400                                                                  08140006
081500     MOVE 'N'                    TO ASC-FIELDS-MODIFIED-SW        08150006
081600                                                                  08160006
081700     IF ASC-NEWLY-ENTERED-FIELD-VALUES  NOT =                     08170006
081800        ASC-ORIGINAL-FIELD-VALUES                                 08180006
081900         SET ASC-FIELDS-MODIFIED TO TRUE                          08190006
082000     END-IF.                                                      08200006
082100                                                                  08210006
082200/                                                                 08220006
082300 4000-BUILD-INITIAL-PANEL.                                        08230006
082400                                                                  08240006
082500     INITIALIZE DCLTINVOIC                                        08250006
082600                DCLTPREQIT                                        08260006
082700                DCLTMIITEM                                        08270006
082800                DK-DB2-KEYS                                       08280006
082900                ASC-ORIGINAL-FIELD-VALUES                         08290006
083000                ASC-NEWLY-ENTERED-FIELD-VALUES                    08300006
083100                ASC-ALPHA-COUNTERPARTS                            08310006
083200                ASC-OTHER-FIELDS                                  08320006
083300                                                                  08330006
083400     EXEC SQL                                                     08340006
083500         SET :ASC-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           08350006
083600     END-EXEC                                                     08360006
083700                                                                  08370006
083800     MOVE ASC-KEY-INVC-ID         TO DK-INVC-ID                   08380006
083900                                                                  08390006
084000     IF ASC-KEY-PO-NBR > +0                                       08400006
084100         MOVE ASC-KEY-PO-NBR      TO DK-PO-NBR-LOW                08410006
084200                                     DK-PO-NBR-HIGH               08420006
084300     ELSE                                                         08430006
084400         MOVE +0                  TO DK-PO-NBR-LOW                08440006
084500         MOVE +999999999          TO DK-PO-NBR-HIGH               08450006
084600     END-IF.                                                      08460006
084700                                                                  08470006
084800     SET PS-NO-ERROR TO TRUE                                      08480006
084900     PERFORM 4010-VALIDATE-INVC-PO-COMBO.                         08490006
085000                                                                  08500006
085100     IF ASC-INVOICE-NOT-FOUND OR                                  08510006
085200        ASC-INVOICE-DUPLICATE                                     08520006
085300         IF ASC-INVOICE-DUPLICATE                                 08530006
085400             IF DK-PO-NBR-LOW = +0                                08540006
085500*                -- PO NBR REQUIRED TO BREAK THE TIE --           08550006
085600                 MOVE PC-TSYMSG-00852 TO DP020-MSG-NUMBER         08560006
085700             ELSE                                                 08570006
085800*                -- SEVERE DATA CORRUPTION - CONTACT DP --        08580006
085900                 MOVE PC-TSYMSG-00858 TO DP020-MSG-NUMBER         08590006
086000             END-IF                                               08600006
086100         ELSE                                                     08610006
086200             MOVE PC-TSYMSG-00855     TO DP020-MSG-NUMBER         08620006
086300         END-IF                                                   08630006
086400         SET DP020-MSG-FATAL                                      08640006
086500             PS-ERROR                                             08650006
086600             DP020-NEXT-ACT-APPL-ERROR                            08660006
086700                                      TO TRUE                     08670006
086800     ELSE                                                         08680006
086900         EVALUATE TRUE                                            08690006
087000            WHEN  INVOIC-STATUS-CDE       = 'DE'                  08700006
087100            WHEN  INVOIC-STATUS-CDE       = 'OP'                  08710006
087200            WHEN  INVOIC-STATUS-CDE       = 'PD'                  08720006
087300            WHEN  INVOIC-STATUS-CDE       = 'PJ'                  08730006
087400            WHEN  INVOIC-STATUS-CDE       = 'RL'                  08740006
087500            WHEN  INVOIC-STATUS-CDE       = 'OB'                  08750006
087600                MOVE PC-TSYMSG-00170       TO DP020-MSG-NUMBER    08760006
087700*               -- ALLOW THEM TO LOOK, BUT NOT TOUCH --           08770006
087800                SET ASC-NO-CHANGES-ALLOWED                        08780006
087900                    DP020-MSG-INFORMATIONAL TO TRUE               08790006
088000         END-EVALUATE                                             08800006
088100     END-IF.                                                      08810006
088200                                                                  08820006
088300     IF PS-NO-ERROR                                               08830006
088400         MOVE INVOIC-PAYT-REQ-SEQ-NBR   TO                        08840006
088500              DK-PAYT-REQ-SEQ-NBR                                 08850006
088600         MOVE ASC-KEY-PAYT-REQ-LNE-NBR  TO                        08860006
088700              DK-PAYT-REQ-LNE-NBR                                 08870006
088800         MOVE INVOIC-PO-NBR             TO                        08880006
088900              DK-PO-NBR                                           08890006
089000         MOVE ASC-KEY-PO-LNE-NBR        TO                        08900006
089100              DK-PO-LNE-NBR                                       08910006
089200         PERFORM 4020-GET-REST-OF-DATA                            08920006
089300         PERFORM 4200-MOVE-DATABASE-TO-COMMAREA                   08930006
089400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     08940006
089500     END-IF.                                                      08950006
089600/                                                                 08960006
089700 4010-VALIDATE-INVC-PO-COMBO.                                     08970006
089800                                                                  08980006
089900     PERFORM                                                      08990006
090000         WITH TEST AFTER                                          09000006
090100         VARYING PV-RETRY-COUNTER                                 09010006
090200         FROM 1 BY 1                                              09020006
090300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09030006
090400            OR (SQLCODE = +0)                                     09040006
090500            OR (SQLCODE = +100)                                   09050006
090600            OR (SQLCODE = -811))                                  09060006
090700                                                                  09070006
090800**       ***   THE "VALUE" FUNCTION REPLACES NULL VALUES WITH     09080006
090900**       ***   WHATEVER VALUE IS SPECIFIED.  IN THIS CASE,        09090006
091000**       ***   ALL NULL PO_NBR'S  WILL BE TREATED AS IF THEIR     09100006
091100**       ***   PO_NBR'S WERE ZERO, AND WOULD NOT BE RETURNED      09110006
091200**       ***   IF AN ACTUAL ASC-KEY-PO-NBR WAS SPECIFIED, BUT     09120006
091300**       ***   WOULD BE RETURNED IF NO ASC-KEY-PO-NBR WAS         09130006
091400**       ***   SUPPLIED.                                          09140006
091500                                                                  09150006
091600         EXEC SQL                                                 09160006
091700           SELECT  PAYT_REQ_SEQ_NBR                               09170006
091800                  ,INVC_ID                                        09180006
091900                  ,INVC_TYP_CDE                                   09190006
092000                  ,STATUS_CDE                                     09200006
092100                  ,ENTR_MTHD_CDE                                  09210006
092200                  ,RMIT_VND_ID                                    09220006
092300                  ,VALUE(PO_NBR,+0)                               09230006
092400            INTO   :INVOIC-PAYT-REQ-SEQ-NBR                       09240006
092500                  ,:INVOIC-INVC-ID                                09250006
092600                  ,:INVOIC-INVC-TYP-CDE                           09260006
092700                  ,:INVOIC-STATUS-CDE                             09270006
092800                  ,:INVOIC-ENTR-MTHD-CDE                          09280006
092900                  ,:INVOIC-RMIT-VND-ID                            09290006
093000                  ,:INVOIC-PO-NBR                                 09300006
093100             FROM   TINVOIC A                                     09310006
093200            WHERE   INVC_ID                = :DK-INVC-ID          09320006
093300              AND   A.PO_NBR               IS NOT NULL            09330006
093400              AND   A.PO_NBR         BETWEEN :DK-PO-NBR-LOW       09340006
093500                                         AND :DK-PO-NBR-HIGH      09350006
093600         END-EXEC                                                 09360006
093700                                                                  09370006
093800         EVALUATE TRUE                                            09380006
093900             WHEN SQLCODE = +0                                    09390006
094000                 SET ASC-INVOICE-FOUND         TO TRUE            09400006
094100             WHEN SQLCODE = -904                                  09410006
094200             WHEN SQLCODE = -913                                  09420006
094300                 CONTINUE                                         09430006
094400             WHEN SQLCODE = -811                                  09440006
094500                                                                  09450006
094600                 SET ASC-INVOICE-DUPLICATE     TO TRUE            09460006
094700                                                                  09470006
094800             WHEN SQLCODE = +100                                  09480006
094900                                                                  09490006
095000                 SET ASC-INVOICE-NOT-FOUND     TO TRUE            09500006
095100                                                                  09510006
095200             WHEN SQLWARN0 NOT = SPACES                           09520006
095300             WHEN SQLCODE < ZERO                                  09530006
095400             WHEN SQLCODE > ZERO                                  09540006
095500                 MOVE '4010-SELECT-TINVOIC'                       09550006
095600                                   TO DP013-PARAGRAPH             09560006
095700                 MOVE 'SELECT ON TINVOIC        '                 09570006
095800                                   TO DP013-MESSAGE-TEXT (1)      09580006
095900                 MOVE SQLCA        TO DP013-SQLCA                 09590006
096000                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    09600006
096100                 MOVE SPACES       TO DP013-DB2-TABLE-NAME (2)    09610006
096200                 SET DP013-DB2-ABEND                              09620006
096300                     DP013-XCTL-DISPLAY-RESTART                   09630006
096400                                   TO TRUE                        09640006
096500                 PERFORM DP013-0000-PROCESS-ABEND                 09650006
096600         END-EVALUATE                                             09660006
096700     END-PERFORM.                                                 09670006
096800                                                                  09680006
096900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09690006
097000         MOVE '4010-SELECT-TINVOIC'                               09700006
097100                                   TO DP013-PARAGRAPH             09710006
097200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     09720006
097300                                   TO DP013-MESSAGE-TEXT (1)      09730006
097400         MOVE SQLCA                TO DP013-SQLCA                 09740006
097500         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    09750006
097600         MOVE SPACES               TO DP013-DB2-TABLE-NAME (2)    09760006
097700         SET DP013-DB2-ABEND                                      09770006
097800             DP013-XCTL-DISPLAY-RESTART                           09780006
097900                                   TO TRUE                        09790006
098000         PERFORM DP013-0000-PROCESS-ABEND                         09800006
098100     END-IF.                                                      09810006
098200/                                                                 09820006
098300 4020-GET-REST-OF-DATA.                                           09830006
098400                                                                  09840006
098500     PERFORM 4030-VALIDATE-TPREQIT-TMIITEM.                       09850006
098600                                                                  09860006
098700     IF SQLCODE = +0                                              09870006
098800         IF ASC-KEY-PO-LNE-NBR = +0                               09880006
098900             NEXT SENTENCE                                        09890006
099000         ELSE                                                     09900006
099100             PERFORM 4050-GET-DATA-FROM-TPURITM                   09910006
099200         END-IF                                                   09920006
099300     ELSE                                                         09930006
099400*-->     -- DATA GOT BLOWN AWAY BY SOMEONE ELSE --                09940006
099500         MOVE PC-TSYMSG-00134   TO DP020-MSG-NUMBER               09950006
099600         SET PS-ERROR                                             09960006
099700             DP020-NEXT-ACT-APPL-ERROR                            09970006
099800                                TO TRUE                           09980006
099900     END-IF.                                                      09990006
100000/                                                                 10000006
100100 4030-VALIDATE-TPREQIT-TMIITEM.                                   10010006
100200                                                                  10020006
100300     PERFORM                                                      10030006
100400         WITH TEST AFTER                                          10040006
100500         VARYING PV-RETRY-COUNTER                                 10050006
100600         FROM 1 BY 1                                              10060006
100700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10070006
100800            OR (SQLCODE = +0)                                     10080006
100900            OR (SQLCODE = +100))                                  10090006
101000                                                                  10100006
101100**       ***   THE "VALUE" FUNCTION REPLACES NULL VALUES WITH     10110006
101200**       ***   WHATEVER VALUE IS SPECIFIED.  IN THIS CASE, NULL   10120006
101300**       ***   PO_LNE_NBR'S ARE TREATED AS THOUGH THEY EQUAL +0.  10130006
101400                                                                  10140006
101500         EXEC SQL                                                 10150006
101600           SELECT  A.PAYT_REQ_LNE_NBR                             10160006
101700                  ,A.PAY_REQ_LNE_QTY                              10170006
101800                  ,A.QTY_UNT_OF_MSMT                              10180006
101900                  ,A.UNT_COST_AMT                                 10190006
102000                  ,B.UNT_COST_SEL_CDE                             10200006
102100           INTO   :PREQIT-PAYT-REQ-LNE-NBR                        10210006
102200                 ,:PREQIT-PAY-REQ-LNE-QTY                         10220006
102300                 ,:PREQIT-QTY-UNT-OF-MSMT                         10230006
102400                 ,:PREQIT-UNT-COST-AMT                            10240006
102500                 ,:MIITEM-UNT-COST-SEL-CDE                        10250006
102600           FROM   TPREQIT A                                       10260006
102700                 ,TMIITEM B                                       10270006
102800          WHERE   A.PAYT_REQ_SEQ_NBR   = :DK-PAYT-REQ-SEQ-NBR     10280006
102900            AND   B.PAYT_REQ_SEQ_NBR   = :DK-PAYT-REQ-SEQ-NBR     10290006
103000            AND   A.PAYT_REQ_LNE_NBR   = :DK-PAYT-REQ-LNE-NBR     10300006
103100            AND   B.PAYT_REQ_LNE_NBR   = :DK-PAYT-REQ-LNE-NBR     10310006
103200         END-EXEC                                                 10320006
103300                                                                  10330006
103400         EVALUATE TRUE                                            10340006
103500             WHEN SQLCODE = +0                                    10350006
103600             WHEN SQLCODE = -904                                  10360006
103700             WHEN SQLCODE = -913                                  10370006
103800             WHEN SQLCODE = +100                                  10380006
103900                 CONTINUE                                         10390006
104000             WHEN SQLWARN0 NOT = SPACES                           10400006
104100             WHEN SQLCODE < ZERO                                  10410006
104200             WHEN SQLCODE > ZERO                                  10420006
104300                 MOVE '4030-...'                                  10430006
104400                                   TO DP013-PARAGRAPH             10440006
104500                 MOVE 'SELECT ON TPREQIT/TMIITEM'                 10450006
104600                                   TO DP013-MESSAGE-TEXT (1)      10460006
104700                 MOVE SQLCA        TO DP013-SQLCA                 10470006
104800                 MOVE 'TPREQIT'    TO DP013-DB2-TABLE-NAME (1)    10480006
104900                 MOVE 'TMIITEM'    TO DP013-DB2-TABLE-NAME (2)    10490006
105000                 SET DP013-DB2-ABEND                              10500006
105100                     DP013-XCTL-DISPLAY-RESTART                   10510006
105200                                   TO TRUE                        10520006
105300                 PERFORM DP013-0000-PROCESS-ABEND                 10530006
105400         END-EVALUATE                                             10540006
105500     END-PERFORM.                                                 10550006
105600                                                                  10560006
105700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10570006
105800         MOVE '4030-...'                                          10580006
105900                                   TO DP013-PARAGRAPH             10590006
106000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     10600006
106100                                   TO DP013-MESSAGE-TEXT (1)      10610006
106200         MOVE SQLCA                TO DP013-SQLCA                 10620006
106300         MOVE 'TPREQIT'            TO DP013-DB2-TABLE-NAME (1)    10630006
106400         MOVE 'TMIITEM'            TO DP013-DB2-TABLE-NAME (2)    10640006
106500         SET DP013-DB2-ABEND                                      10650006
106600             DP013-XCTL-DISPLAY-RESTART                           10660006
106700                                   TO TRUE                        10670006
106800         PERFORM DP013-0000-PROCESS-ABEND                         10680006
106900     END-IF.                                                      10690006
107000/                                                                 10700006
107100 4050-GET-DATA-FROM-TPURITM.                                      10710006
107200                                                                  10720006
107300     INITIALIZE DCLTPURITM                                        10730006
107400     SET PURITM-NOT-FOUND        TO TRUE                          10740006
107500                                                                  10750006
107600     PERFORM                                                      10760006
107700         WITH TEST AFTER                                          10770006
107800         VARYING PV-RETRY-COUNTER                                 10780006
107900         FROM 1 BY 1                                              10790006
108000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10800006
108100            OR (SQLCODE = +0)                                     10810006
108200            OR (SQLCODE = +100))                                  10820006
108300                                                                  10830006
108400         EXEC SQL                                                 10840006
108500            SELECT VEND_STYL_NAME                                 10850006
108600                  ,COLOR_CDE                                      10860006
108700                  ,COLOR_DESC                                     10870006
108800                  ,SIZE_CDE                                       10880006
108900                  ,SIZE_DESC                                      10890006
109000                  ,SKU_DESC                                       10900006
109100                  ,CL_NBR                                         10910006
109200                  ,SKU_SEQ_NBR                                    10920006
109300            INTO  :PURITM-VEND-STYL-NAME                          10930006
109400                 ,:PURITM-COLOR-CDE                               10940006
109500                 ,:PURITM-COLOR-DESC                              10950006
109600                 ,:PURITM-SIZE-CDE                                10960006
109700                 ,:PURITM-SIZE-DESC                               10970006
109800                 ,:PURITM-SKU-DESC                                10980006
109900                 ,:PURITM-CL-NBR                                  10990006
110000                 ,:PURITM-SKU-SEQ-NBR                             11000006
110100           FROM   TPURITM                                         11010006
110200          WHERE   PO_NBR             = :DK-PO-NBR                 11020006
110300            AND   APP_PO_LNE_NBR     = :DK-PO-LNE-NBR             11030006
110400            AND   VER_STATUS_CDE     = 'A'                        11040006
110500         END-EXEC                                                 11050006
110600                                                                  11060006
110700         EVALUATE TRUE                                            11070006
110800             WHEN SQLCODE = +0                                    11080006
110900                 SET PURITM-FOUND        TO TRUE                  11090006
111000             WHEN SQLCODE = -904                                  11100006
111100             WHEN SQLCODE = -913                                  11110006
111200             WHEN SQLCODE = +100                                  11120006
111300                 CONTINUE                                         11130006
111400             WHEN SQLWARN0 NOT = SPACES                           11140006
111500             WHEN SQLCODE < ZERO                                  11150006
111600             WHEN SQLCODE > ZERO                                  11160006
111700                 MOVE '4050-...'                                  11170006
111800                                   TO DP013-PARAGRAPH             11180006
111900                 MOVE 'SELECT ON TPURITM'                         11190006
112000                                   TO DP013-MESSAGE-TEXT (1)      11200006
112100                 MOVE SQLCA        TO DP013-SQLCA                 11210006
112200                 MOVE 'TPURITM'    TO DP013-DB2-TABLE-NAME (1)    11220006
112300                 SET DP013-DB2-ABEND                              11230006
112400                     DP013-XCTL-DISPLAY-RESTART                   11240006
112500                                   TO TRUE                        11250006
112600                 PERFORM DP013-0000-PROCESS-ABEND                 11260006
112700         END-EVALUATE                                             11270006
112800     END-PERFORM.                                                 11280006
112900                                                                  11290006
113000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11300006
113100         MOVE '4050-...'                                          11310006
113200                                   TO DP013-PARAGRAPH             11320006
113300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     11330006
113400                                   TO DP013-MESSAGE-TEXT (1)      11340006
113500         MOVE SQLCA                TO DP013-SQLCA                 11350006
113600         MOVE 'TPURITM'            TO DP013-DB2-TABLE-NAME (1)    11360006
113700         SET DP013-DB2-ABEND                                      11370006
113800             DP013-XCTL-DISPLAY-RESTART                           11380006
113900                                   TO TRUE                        11390006
114000         PERFORM DP013-0000-PROCESS-ABEND                         11400006
114100     END-IF.                                                      11410006
114200/                                                                 11420006
114300 4200-MOVE-DATABASE-TO-COMMAREA.                                  11430006
114400                                                                  11440006
114500     MOVE INVOIC-PAYT-REQ-SEQ-NBR  TO ASC-KEY-PAYT-REQ-SEQ-NBR    11450006
114600     MOVE INVOIC-INVC-TYP-CDE      TO ASC-INVC-TYP-CDE            11460006
114700     MOVE INVOIC-STATUS-CDE        TO ASC-KEY-INVC-STATUS         11470006
114800     MOVE INVOIC-ENTR-MTHD-CDE     TO ASC-ENTR-MTHD-CDE           11480006
114900                                                                  11490006
115000     MOVE INVOIC-RMIT-VND-ID       TO ASC-DUN-NBR                 11500006
115100     MOVE INVOIC-PO-NBR            TO ASC-KEY-PO-NBR              11510006
115200                                                                  11520006
115300     MOVE PREQIT-PAY-REQ-LNE-QTY   TO ASC-OLD-PAY-REQ-LNE-QTY     11530006
115400                                      ASC-ALP-PAY-REQ-LNE-QTY-NUM 11540006
115500     MOVE PREQIT-UNT-COST-AMT      TO ASC-OLD-UNT-COST-AMT        11550006
115600                                      ASC-ALP-UNT-COST-AMT-NUM    11560006
115700     IF PREQIT-UNT-COST-AMT = +0                                  11570006
115800         MOVE 'NC'                 TO ASC-ALP-UNT-COST-AMT        11580006
115900     END-IF                                                       11590006
116000                                                                  11600006
116100     MOVE PREQIT-QTY-UNT-OF-MSMT   TO ASC-OLD-QTY-UNT-OF-MSMT.    11610006
116200                                                                  11620006
116300     MOVE ASC-KEY-PO-LNE-NBR       TO ASC-OLD-PO-LNE-NBR          11630006
116400                                      ASC-PREV-PO-LNE-NBR         11640006
116500                                      ASC-ALP-PO-LNE-NBR-NUM      11650006
116600                                                                  11660006
116700     IF MIITEM-UNT-COST-SEL-CDE = 'P'                             11670006
116800         MOVE 'Y'                  TO ASC-PAY-IND                 11680006
116900     ELSE                                                         11690006
117000         MOVE 'N'                  TO ASC-PAY-IND                 11700006
117100     END-IF                                                       11710006
117200                                                                  11720006
117300     MOVE ASC-ORIGINAL-FIELD-VALUES   TO                          11730006
117400          ASC-NEWLY-ENTERED-FIELD-VALUES.                         11740006
117500                                                                  11750006
117600 4400-MOVE-COMMAREA-TO-SCREEN.                                    11760006
117700                                                                  11770006
117800     MOVE ASC-KEY-INVC-ID           TO AINVNBRO.                  11780006
117900                                                                  11790006
118000     MOVE ASC-KEY-PAYT-REQ-LNE-NBR  TO PV-NUM4.                   11800006
118100     MOVE PV-NUM4-X                 TO AINVLNEO.                  11810006
118200                                                                  11820006
118300                                                                  11830006
118400     MOVE ASC-KEY-PO-NBR            TO PV-NUM9.                   11840009
118500     MOVE PV-NUM9-X                 TO APONUMO.                   11850009
118600                                                                  11860006
118700     IF ASC-ALP-PO-LNE-NBR = '****' OR                            11870006
118800        ASC-ALP-PO-LNE-NBR = '0000'                               11880006
118900         MOVE '****'                   TO APOLNEO                 11890006
119000                                          ASC-ALP-PO-LNE-NBR      11900006
119100     ELSE                                                         11910006
119200         IF ASC-ALP-PO-LNE-NBR NUMERIC                            11920006
119300             MOVE ASC-NEW-PO-LNE-NBR   TO PV-NUM4                 11930006
119400             MOVE PV-NUM4-X            TO APOLNEO                 11940006
119500                                          ASC-ALP-PO-LNE-NBR      11950006
119600         ELSE                                                     11960006
119700             MOVE ASC-ALP-PO-LNE-NBR   TO APOLNEO                 11970006
119800         END-IF                                                   11980006
119900     END-IF.                                                      11990006
120000                                                                  12000006
120100     MOVE ASC-DUN-NBR               TO ADUNNBRO.                  12010006
120200     MOVE ASC-KEY-DEPT-NBR          TO ADPTNBRO.                  12020006
120300                                                                  12030006
120400     IF ASC-ALP-PAY-REQ-LNE-QTY NOT NUMERIC                       12040006
120500         MOVE +0                    TO ASC-NEW-PAY-REQ-LNE-QTY    12050006
120600         MOVE ASC-ALP-PAY-REQ-LNE-QTY                             12060006
120700                                    TO ANBRPCSO                   12070006
120800     ELSE                                                         12080006
120900         MOVE ASC-NEW-PAY-REQ-LNE-QTY TO PV-NUM7                  12090011
121000         MOVE PV-NUM7-X             TO ANBRPCSO                   12100011
121100                                       ASC-ALP-PAY-REQ-LNE-QTY    12110006
121200     END-IF.                                                      12120006
121300                                                                  12130006
121400     MOVE ASC-NEW-QTY-UNT-OF-MSMT   TO AUOMO.                     12140006
121500     MOVE ASC-PAY-IND               TO APAYINDO.                  12150006
121600                                                                  12160006
121700     IF ASC-ALP-UNT-COST-AMT NOT NUMERIC                          12170006
121800         MOVE +0                    TO ASC-NEW-UNT-COST-AMT       12180006
121900         MOVE ASC-ALP-UNT-COST-AMT  TO AUNTCSTO                   12190006
122000     ELSE                                                         12200006
122100         MOVE ASC-NEW-UNT-COST-AMT  TO PV-6V999                   12210006
122200         MOVE PV-6V999-X            TO AUNTCSTO                   12220006
122300                                       ASC-ALP-UNT-COST-AMT       12230006
122400         IF ASC-NEW-UNT-COST-AMT = +0                             12240006
122500             MOVE SPACES            TO ASC-ALP-UNT-COST-AMT       12250006
122600                                       AUNTCSTO                   12260006
122700         END-IF                                                   12270006
122800     END-IF.                                                      12280006
122900                                                                  12290006
123000/                                                                 12300006
123100*---------------------------------------------------------------- 12310006
123200* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.        12320006
123300*---------------------------------------------------------------- 12330006
123400                                                                  12340006
123500 9100-READ-SEL-QUEUE.                                             12350006
123600                                                                  12360006
123700     EXEC CICS                                                    12370006
123800         READQ TS                                                 12380006
123900             QUEUE (ASC-SEL-QUEUE-NAME)                           12390006
124000             INTO  (AP301-INVC-LIST-TS-RCRD)                      12400006
124100             ITEM  (ASC-SEL-ITEM)                                 12410006
124200             RESP  (PV-CICS-RESPONSE)                             12420006
124300     END-EXEC.                                                    12430006
124400                                                                  12440006
124500     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   12450006
124600         CONTINUE                                                 12460006
124700     ELSE                                                         12470006
124800         SET DP013-LOGIC-ABEND                                    12480006
124900             DP013-NO-ROLLBACK     TO TRUE                        12490006
125000         MOVE '9100-READ-SEL-QUEUE'                               12500006
125100                                   TO DP013-PARAGRAPH             12510006
125200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   12520006
125300                                   TO DP013-MESSAGE-TEXT (1)      12530006
125400         PERFORM DP013-0000-PROCESS-ABEND                         12540006
125500     END-IF.                                                      12550006
125600                                                                  12560006
125700/                                                                 12570006
125800*---------------------------------------------------------------- 12580006
125900*    ABEND PROCESSOR MODULE                                       12590006
126000*---------------------------------------------------------------- 12600006
126100                                                                  12610006
126200     COPY DPPD013.                                                12620006
