000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400                                                                  00040001
000500 PROGRAM-ID.             SVKRP002.                                00050085
000600 AUTHOR.                 DAVE MUSKAT - COMPUWARE.                 00060001
000700 INSTALLATION.           KOHLS.                                   00070001
000800 DATE-WRITTEN            FEBRUARY 1999.                           00080085
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100***************************************************************** 00110001
001200* * * *>>>   THIS PROGRAM MUST BE COMPILED COBOL/390   <<<* * * * 00120007
001300***************************************************************** 00130007
001400*                                                                 00140067
001500*  THIS PROGRAM WILL CREATE A MONTHLY STORED VALUE CARD REVENUE   00150067
001600*  REPORT FROM AN INPUT FILE CONTAINING CARD BALANCE DATA.        00160067
001700*                                                                 00170099
001800*  THE INPUT BALANCE FILE (INP01) CONTAINS A RECORD FOR EACH      00180080
001900*  STORED VALUE CARD CONTAINING A BALANCE AMOUNT.  EACH RECORD    00190099
002000*  SHOWS THE BALANCE AND DATE OF LAST ACTIVITY.                   00200080
002100*                                                                 00210079
002200*  THE INPUT CARD DATE FILE (INP02) CONTAINS A FISCAL MONTH END   00220080
002300*  DATE AND THE TYPE (DETAIL OR TOTAL) OF REPORT BEING RUN.       00230099
002400*                                                                 00240099
002500*  THE REPORT (RPT01) ACCUMULATES THE BALANCE OF CARDS INTO       00250079
002600*  GROUPINGS BASED ON WHERE THE BALANCE FALLS WITHIN FIVE DOLLAR  00260099
002700*  RANGES, SHOWN ACROSS THE TOP OF THE THE REPORT.                00270079
002800*  THEY ARE ALSO GROUPED BASED ON HOW LONG THE CARD HAS BEEN      00280079
002900*  INACTIVE (NOT USED) COMPARED WITH CURRENT FISCAL MONTH ENDING  00290079
003000*  DATE.  THESE GROUPINGS ARE SHOWN DOWN THE LEFT SIDE OF THE     00300079
003100*  REPORT.                                                        00310079
003200***************************************************************** 00320007
003300*                                                                 00330079
003400*  THE PROGRAM READS THE CARD DATE FILE TO GET THE FISCAL MONTH   00340079
003500*  END DATE AND THE TYPE OF REPORT BEING RUN. THIS FISCAL MONTH   00350099
003510*  END DATE IS PASSED TO THE KOHLS CALENDAR ROUTINE TO DETERMINE  00351099
003520*  THE FISCAL PERIOD IN WHICH IT OCCURS. THE PROGRAM USES THIS    00352099
003530*  FISCAL PERIOD AS THE STARTING POINT IN THE FIRST DATE RANGE    00353099
003540*  USED TO SHOW 'MONTHS INACTIVE' ON THE REPORT. THE CALENDAR     00354099
003550*  ROUTINE IS USED AGAIN TO DECREMENT THE FISCAL PERIOD TO        00355099
003560*  DETERMINE THE ENDING POINT IN THE DATE RANGE.                  00356099
004200*                                                                 00420080
004300*  THIS PROCESS OF USING THE CALENDAR ROUTINE TO DECREMENT THE    00430080
004400*  FISCAL PERIOD IS REPEATED TO GET THE STARTING AND ENDING       00440080
004500*  POINTS OF ALL THE DATE RANGES THAT ARE SHOWN AS 'MONTHS        00450080
004600*  INACTIVE' ON THE REPORT.                                       00460080
004700*                                                                 00470067
004710*  THE REPORT TYPE IS PASSED TO THE MAIN PROCESSING PARAGRAGH     00471099
004720*  TO DETERMINE IF THE DETAIL OR TOTAL REPORT IS TO BE PROCESSED. 00472099
004730*  WHEN PROCESSING THE DETAIL REPORT, THE BALANCE FILE IS SORTED  00473099
004800*  IN CARD STOCK TYPE ORDER, FEE MONTH DURATION, AND STATE.       00480099
004801*  ALL CARD STOCK TYPES, EXCEPT KCK AND KMRC ARE GROUPED AS       00480199
004802*  'GIFTCARD' IN THE INPUT RECORD. WHEN PROCESSING THE TOTAL      00480299
004803*  REPORT, THE BALANCE FILE IS SORTED IN FEE MONTH DURATION, AND  00480399
004804*  STATE. AS THE BALANCE FILE IS READ, THE CARD BALANCES ARE      00480499
004805*  ACCUMULATED BY DATE RANGE IN WORKING STORAGE TABLES:           00480599
005100*     TABLE 1 ACCUMULATES DATA FOR A STATE WITHIN EACH FEE MONTH  00510099
005110*      AND STOCK TYPE.                                            00511099
005200*     TABLE 2 ACCUMULATES DATA FOR THE TOTAL OF A STOCK TYPE FOR  00520099
005210*     ALL STATES.                                                 00521099
005300*  EACH ENTRY IN TABLE 1 AND TABLE 2 REPRESENTS A DATE RANGE      00530067
005400*  SHOWN ON THE REPORT.  THE LAST ACTIVITY DATE ON THE RECORD IS  00540067
005500*  USED TO DETERMINE WHICH ENTRY IN TABLE 1 AND TABLE 2 WILL BE   00550067
005600*  USED TO ACCUMULATE THE BALANCE.                                00560067
005700*                                                                 00570067
005800*  WHEN PROCESSING THE DETAIL REPORT, TABLE 1 IS UNLOADED AND     00580099
005810*  PRINTED AS A PAGE ON THE REPORT ON A CONTROL BREAK OF STATE.   00581099
005820*  TABLE 1 IS CLEARED AND USED FOR THE NEXT STATE. WHEN THERE IS A00582099
005830*  CONTROL BREAK ON CARD STOCK, TABLE 2 IS UNLOADED TO PRINT THE  00583099
005840*  TOTAL PAGE OF THE CARD STOCK TYPE. THIS CONTINUES UNTIL THE END00584099
005850*  OF FILE.                                                       00585099
006300*                                                                 00630080
006400******************************************************************00640080
006500*                                                                 00650079
006600*  CHANGED 02/02/99 BY DAVE MUSKAT - COMPUWARE                    00660067
006700*   WR# 5886 NEW PROGRAM.                                         00670067
006800*                                                                 00680099
006900*  CHANGED 01/29/00 BY DAVID COLOMBO - COMPUWARE                  00690099
007000*   WR# 5886 REMOVE THE REVENUE CALCULATION AND TOTAL REVENUE     00700067
007100*            LISTED ON THE REPORT. CHANGE THE DOLLAR AND COUNT    00710067
007200*            FIELDS LISTED ON THE REPORT TO SHOW WHOLE AMOUNTS    00720067
007300*            RATHER THAN AMOUNTS IN THOUSANDS. ALSO ADDED TOTAL   00730099
007400*            LINES TO SHOW NEGATIVE BALANCE RECORDS.              00740099
007500*                                                                 00750067
007600***************************************************************** 00760001
007700*  CHANGED 03/31/02 BY BARB ERTL                                  00770099
007800*   WR# 22603 MULTI-CHANNEL GIFT CARD PROJECT                     00780099
007900*             REMOVE SQL READ FOR CRD STK TYP DESC.  IT'S COMING  00790099
008000*             IN ON THE INPUT FILE.                               00800099
008100***************************************************************** 00810001
008110*  CHANGED 06/08/09 BY ROLF NOHE                                  00811099
008120*   WR# 29062 - PROJECT 2317 - GIFT CARD NUMBERING TO 30 DIGITS.  00812099
008130*             RECOMPILE TO PICK UP CHANGES IN SVWS004.            00813099
008150***************************************************************** 00815099
008200 ENVIRONMENT DIVISION.                                            00820001
008300***************************************************************** 00830001
008400                                                                  00840001
008500 CONFIGURATION SECTION.                                           00850001
008600                                                                  00860001
008700 SOURCE-COMPUTER.        IBM-3090.                                00870001
008800 OBJECT-COMPUTER.        IBM-3090.                                00880001
008900                                                                  00890001
009000 INPUT-OUTPUT SECTION.                                            00900001
009100                                                                  00910001
009200 FILE-CONTROL.                                                    00920001
009300                                                                  00930001
009400     SELECT BALANCE-FILE                                          00940086
009500         ASSIGN TO INP01.                                         00950001
009600                                                                  00960001
009700     SELECT DATE-CARD-FILE                                        00970001
009800         ASSIGN TO INP02.                                         00980003
009900                                                                  00990099
010000     SELECT REVENUE-REPORT-FILE                                   01000086
010100         ASSIGN TO RPT01.                                         01010001
010200                                                                  01020001
010300                                                                  01030001
010400******************************************************************01040001
010500 DATA DIVISION.                                                   01050001
010600******************************************************************01060001
010700                                                                  01070001
010800 FILE SECTION.                                                    01080001
010900                                                                  01090001
011000 FD  BALANCE-FILE                                                 01100086
011100     RECORDING MODE IS F                                          01110001
011200     LABEL RECORDS ARE STANDARD                                   01120001
011300     BLOCK CONTAINS 0 RECORDS.                                    01130001
011400                                                                  01140001
011500 01  BALANCE-RECORD                  PIC  X(80).                  01150086
011600                                                                  01160001
011700 FD  DATE-CARD-FILE                                               01170001
011800     RECORDING MODE IS F                                          01180001
011900     BLOCK CONTAINS 0 RECORDS                                     01190001
012000     LABEL RECORDS ARE STANDARD.                                  01200001
012100                                                                  01210001
012200 01  DATE-CARD-RECORD                PIC X(80).                   01220001
012300                                                                  01230001
012400 FD  REVENUE-REPORT-FILE                                          01240086
012500     RECORDING MODE IS F                                          01250001
012600     BLOCK CONTAINS 0  RECORDS.                                   01260001
012700                                                                  01270001
012800 01  REVENUE-REPORT-RECORD           PIC  X(132).                 01280099
012900******************************************************************01290001
013000 WORKING-STORAGE SECTION.                                         01300001
013100******************************************************************01310001
013200 01  FILLER                            PIC X(50)  VALUE           01320001
013300     ' *** WORKING STORAGE STARTS HERE FOR SVKRP002 *** '.        01330085
013400                                                                  01340001
013500******************************************************************01350086
013600* RECORD LAYOUT FOR INPUT BALANCE FILE                            01360086
013700******************************************************************01370086
013800     COPY SVRD003.                                                01380099
013900******************************************************************01390099
014000* RECORD LAYOUT FOR INPUT NEGATIVE BALANCE FILE                   01400099
014100******************************************************************01410099
014200     COPY SVRD003 REPLACING 'SV003-' BY 'SV3NG-'.                 01420099
014300******************************************************************01430001
014400* RECORD LAYOUT FOR INPUT DATE CARD (FISCAL MONTH-END DATE)       01440001
014500******************************************************************01450001
014600  01  CC-CONTROL-CARD.                                            01460005
014700      05  CC-REPORT-TYPE               PIC X(01)  VALUE SPACES.   01470099
014800      05  CC-MONTH-END-CCYY-MM-DD      PIC X(10)  VALUE SPACES.   01480005
014900      05  FILLER                       PIC X(69)  VALUE SPACES.   01490099
015000                                                                  01500001
015100******************************************************************01510004
015200*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01520004
015300******************************************************************01530004
015400     COPY DPWS500.                                                01540099
015500                                                                  01550004
015600******************************************************************01560099
015700*  COPYBOOK OF MERCHANDISE CARD CONSTANTS                         01570099
015800******************************************************************01580099
015900     COPY SVWS004.                                                01590099
016000                                                                  01600099
016100 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01610011
016200                                                  COMP SYNC.      01620005
016300     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01630005
016400     88  AC-TABLE-OVERFLOW                        VALUE +4004.    01640099
016500     88  AC-DATASET-DATA-ERROR                    VALUE +4008.    01650011
016600     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01660005
016700                                                                  01670004
016800 01  PS-PROGRAM-SWITCHES.                                         01680067
016900     05  PS-END-OF-BALANCE-FILE-SW     PIC X(01)  VALUE 'N'.      01690086
017000         88  PS-END-OF-BALANCE-FILE               VALUE 'Y'.      01700086
017100     05  PS-END-OF-CARD-FILE-SW        PIC X(01)  VALUE 'N'.      01710018
017200         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      01720018
017300     05  PS-TABLE-3-DATE-FOUND-SW      PIC X(01)  VALUE 'N'.      01730016
017400         88  PS-TABLE-3-DATE-FOUND                VALUE 'Y'.      01740016
017500         88  PS-TABLE-3-DATE-NOT-FOUND            VALUE 'N'.      01750016
017600     05  PS-TABLE-4-AMOUNT-FOUND-SW    PIC X(01)  VALUE 'N'.      01760099
017700         88  PS-TABLE-4-AMOUNT-FOUND              VALUE 'Y'.      01770016
017800         88  PS-TABLE-4-AMOUNT-NOT-FOUND          VALUE 'N'.      01780016
017900     05  PS-FISCAL-PERIOD-FOUND-SW     PIC X(01)  VALUE 'N'.      01790089
018000         88  PS-FISCAL-PERIOD-FOUND               VALUE 'Y'.      01800089
018100         88  PS-FISCAL-PERIOD-NOT-FOUND           VALUE 'N'.      01810089
018200     05  PS-END-OF-STATE-CSR-SW        PIC X(01)  VALUE 'N'.      01820099
018300         88  PS-END-OF-STATE-CSR                  VALUE 'Y'.      01830099
018400     05  PS-END-OF-STATES-TABLE        PIC X(01)  VALUE 'N'.      01840099
018500         88  PS-STATE-FOUND                       VALUE 'Y'.      01850099
018600         88  PS-STATE-NOT-FOUND                   VALUE 'N'.      01860099
018700                                                                  01870001
018800 01  PC-CONSTANTS.                                                01880001
018900     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +60.     01890001
019000     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01900001
019100                                                   'SVKRP002'.    01910085
019200     05  PC-REPORT-NBR-1             PIC  9(01)    VALUE 1.       01920001
019300     05  PC-ALL-CARDS-DESC           PIC  X(08)    VALUE          01930099
019400         'ALLCARDS'.                                              01940099
019500     05  PC-STATES-DESC              PIC  X(11)    VALUE          01950099
019600         ' TOTAL FOR '.                                           01960099
019700     05  PC-ALL-STATES               PIC  X(42)    VALUE          01970099
019800         ' TOTAL ALL STATES                         '.            01980099
019900     05  PC-DEFAULT-FEE-STATES       PIC  X(42)    VALUE          01990099
020000         ' TOTAL FOR ALL DEFAULT FEE STATES         '.            02000099
020010     05  PC-NON-FEE-STATES           PIC  X(28)    VALUE          02001099
020020         ' TOTAL FOR NON-FEE STATE OF '.                          02002099
020030     05  PC-NON-DEFAULT-FEE-STATES   PIC  X(36)    VALUE          02003099
020040         ' TOTAL FOR NON-DEFAULT FEE STATE OF '.                  02004099
020100     05  PC-DETAIL-REPORT            PIC  X(01)    VALUE 'D'.     02010099
020200     05  PC-TOTAL-REPORT             PIC  X(01)    VALUE 'T'.     02020099
020300     05  PC-MAX-DLR-GRPS             PIC S9(03)    VALUE +5       02030099
020400                                                   COMP-3.        02040099
020500     05  PC-MAX-MONTHS-GRPS          PIC S9(03)    VALUE +17      02050099
020600                                                   COMP-3.        02060099
020700                                                                  02070001
020800 01  PV-MISC-COUNT-FIELDS.                                        02080036
020900     05  PV-PAGE-CNT                 PIC S9(04)    VALUE ZERO     02090085
021000                                                   COMP-3.        02100001
021100     05  PV-LINE-CNT                 PIC S9(04)    VALUE ZERO     02110085
021200                                                   COMP SYNC.     02120001
021300     05  PV-MAX-STATE                PIC S9(03)    VALUE +60.     02130099
021400     05  PV-STATE-SUB                PIC S9(03)    VALUE ZERO.    02140099
021500******************************************************************02150067
021600*  FIELDS TO FOR SYSOUT DISPLAY.                                  02160099
021700******************************************************************02170067
021800 01  PV-DISPLAY-FIELDS.                                           02180067
021900     05  PV-DISPLAY-BALANCE-REC-CNT  PIC S9(11)    COMP-3         02190067
022000                                                   VALUE ZERO.    02200067
022100     05  PV-DISPLAY-COUNT            PIC 99999999999              02210067
022200                                                   VALUE ZERO.    02220067
022300                                                                  02230067
022400******************************************************************02240067
022500*  FIELDS TO HOLD TOTALS FOR PRINTING A REPORT TOTAL LINE.        02250067
022600******************************************************************02260067
022700 01  PV-TOT-ACCUM-FIELDS.                                         02270070
022800     05  PV-TOT-COLUMN-DATA          OCCURS 5 TIMES               02280099
022900                                     INDEXED BY PV-TOT-IDX.       02290070
023000         10  PV-TOT-COLUMN-DLR       PIC S9(11)V99 COMP-3         02300070
023100                                                   VALUE ZERO.    02310070
023200         10  PV-TOT-COLUMN-CNT       PIC S9(11)    COMP-3         02320070
023300                                                   VALUE ZERO.    02330070
023400     05  PV-TOT-DLR-UNREDEEMED       PIC S9(11)V99 COMP-3         02340099
023500                                                   VALUE ZERO.    02350070
023600     05  PV-TOT-CNT-UNREDEEMED       PIC S9(11)    COMP-3         02360070
023700                                                   VALUE ZERO.    02370099
023800 01  PV-TOT-DLR-NEG-BAL              PIC S9(11)V99 COMP-3         02380099
023900                                                   VALUE ZERO.    02390099
024000 01  PV-TOT-CNT-NEG-BAL              PIC S9(11)    COMP-3         02400099
024100                                                   VALUE ZERO.    02410099
024200 01  PV-ALL-DLR-NEG-BAL              PIC S9(11)V99 COMP-3         02420099
024300                                                   VALUE ZERO.    02430099
024400 01  PV-ALL-CNT-NEG-BAL              PIC S9(11)    COMP-3         02440099
024500                                                   VALUE ZERO.    02450099
024600                                                                  02460099
024700******************************************************************02470067
024800*  FIELDS USED FOR CALCULATIONS OF PERCENTS SHIFTING DECIMALS.    02480067
024900******************************************************************02490067
025000 01  PV-CALC-WORK-FIELDS.                                         02500001
025100     05  PV-DOLLARS-CENTS            PIC S9(11)V99 VALUE ZERO     02510011
025200                                                   COMP-3.        02520010
025300     05  PV-DOLLAR-FRACTION          PIC S9(08)V999               02530011
025400                                                   VALUE ZERO     02540099
025500                                                   COMP-3.        02550001
025600     05  PV-COUNT-WHOLE-NBR          PIC S9(11)    VALUE ZERO     02560011
025700                                                   COMP-3.        02570010
025800     05  PV-COUNT-FRACTION           PIC S9(08)V999               02580011
025900                                                   VALUE ZERO     02590099
026000                                                   COMP-3.        02600010
026100 01  PV-WORK-DLR-NEG-BAL             PIC S9(11)V99 COMP-3         02610099
026200                                                   VALUE ZERO.    02620099
026300 01  PV-WORK-CNT-NEG-BAL             PIC S9(11)    COMP-3         02630099
026400                                                   VALUE ZERO.    02640099
026500 EJECT                                                            02650001
026600                                                                  02660001
026700******************************************************************02670067
026800*  FIELDS USED TO DETERMINE CONTROL BREAKS.                       02680067
026900******************************************************************02690067
027000 01  PV-SAVE-FIELDS.                                              02700011
027100     05  PV-SAVE-CRD-STK-TYP         PIC X(08)     VALUE SPACE.   02710078
027200     05  PV-SAVE-CRD-STK-DESC        PIC X(25)     VALUE SPACE.   02720078
027300     05  PV-SAVE-ST-FEE-MONTH        PIC S9(04)    VALUE ZERO     02730099
027400                                                   COMP-3.        02740099
027500     05  PV-SAVE-ST-CDE              PIC X(02)     VALUE SPACE.   02750099
027600                                                                  02760008
027700 01  PV-MISC-FIELDS.                                              02770001
027800     05  PV-PRINT-RECORD             PIC X(200)    VALUE SPACE.   02780011
027900     05  PV-LINE-SPACING             PIC S9(04)    VALUE ZERO     02790001
028000                                                   COMP SYNC.     02800001
028100     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   02810099
028200     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   02820011
028300     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   02830011
028400     05  PV-DB2-OPERATION            PIC  X(30)    VALUE SPACE.   02840011
028500     05  PV-PRINT-AMOUNT             PIC  ZZZ,ZZ9.999             02850011
028600                                                   VALUE ZEROS.   02860001
028700                                                                  02870001
028800 01  PV-DATE-AND-TIME-FIELDS.                                     02880067
028900*****  BEGINNING FISCAL PERIOD USED IN REPORTS.                   02890067
029000     05  PV-CARD-CCYYPP              PIC 9(06)     VALUE ZERO.    02900067
029100     05  FILLER REDEFINES PV-CARD-CCYYPP.                         02910067
029200         10  PV-CARD-CCYY            PIC 9(04).                   02920067
029300         10  PV-CARD-PP              PIC 9(02).                   02930067
029400*****  FIELD USED TO DECREMENT FISCAL PERIOD                      02940089
029500     05  PV-DEC-FISCAL-PERIOD        PIC 9(02)     VALUE ZERO.    02950089
029600*****  REUSEABLE DATE WORK FIELD IN CCYY-MM-DD FORMAT.            02960067
029700     05  PV-WORK-CCYY-MM-DD          PIC X(10)     VALUE SPACE.   02970032
029800*****  FIELDS TO RECEIVE DATES FROM THE CALENDAR ROUTINE.         02980067
029900     05  PV-FISCAL-PER-FST-DATE      PIC X(10)     VALUE SPACE.   02990067
030000     05  PV-FISCAL-PER-LST-DATE      PIC X(10)     VALUE SPACE.   03000032
030100     05  PV-FISCAL-YEAR-CCYY         PIC 9(04)     VALUE ZERO.    03010034
030200     05  PV-FISCAL-PER-NBR           PIC 9(02)     VALUE ZERO.    03020034
030300     05  PV-MONTH-NAME               PIC X(09)     VALUE SPACE.   03030034
030400     05  PV-MONTH-ABBR               PIC X(03)     VALUE SPACE.   03040034
030500*****  FIELDS FOR REPORT HEADINGS.                                03050067
030600     05  PV-CURR-DATE-CCYYMMDD.                                   03060001
030700         10  PV-CURR-DATE-CCYY       PIC  9(04).                  03070007
030800         10  PV-CURR-DATE-MM         PIC  9(02).                  03080007
030900         10  PV-CURR-DATE-DD         PIC  9(02).                  03090007
031000     05  PV-CURR-TIME.                                            03100001
031100         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    03110001
031200         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    03120001
031300         10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    03130001
031400                                                                  03140001
031500******************************************************************03150001
031600*  TOP OF PAGE HEADING LINE FOR PRINTING A 132 CHARACTER REPORT.  03160099
031700******************************************************************03170001
031800     COPY DPWS132.                                                03180099
031900                                                                  03190001
032000******************************************************************03200061
032100*  HEADING LINES FOR THE STORED VALUE REVENUE REPORT.             03210086
032200******************************************************************03220061
032300 01  H2-HEADING-LINE-2.                                           03230019
032400     05  FILLER                      PIC  X(37)    VALUE SPACE.   03240099
032500     05  FILLER                      PIC  X(44)    VALUE          03250086
032600        'STORED VALUE INACTIVE UNREDEEMED REPORT FOR '.           03260086
032700     05  H2-MONTH                    PIC  X(09)    VALUE SPACE.   03270019
032800     05  FILLER                      PIC  X(01)    VALUE SPACE.   03280003
032900     05  H2-YEAR                     PIC  X(04)    VALUE SPACE.   03290019
033000     05  FILLER                      PIC  X(37)    VALUE SPACE.   03300099
033100                                                                  03310001
033200 01  H3-HEADING-LINE-3.                                           03320019
033300     05  FILLER                      PIC  X(19)    VALUE          03330099
033400        '  CARD STOCK TYPE: '.                                    03340099
033500     05  H3-CRD-STK-DESC             PIC  X(09)    VALUE SPACE.   03350099
033600     05  H3-DASH                     PIC  X(01)    VALUE '-'.     03360099
033700     05  H3-DESCRIPTION.                                          03370099
033800         10  H3-PREFIX               PIC  X(28)    VALUE SPACE.   03380099
033900         10  H3-STATE                PIC  X(28)    VALUE SPACE.   03390099
034000     05  H3-DESC REDEFINES H3-DESCRIPTION.                        03400099
034010         10  H3-PREFIX1              PIC  X(36).                  03401099
034020         10  H3-STATE1               PIC  X(20).                  03402099
034100     05  FILLER                      PIC  X(47)    VALUE SPACE.   03410099
034200                                                                  03420004
034300 01  H4-HEADING-LINE-4.                                           03430099
034400     05  FILLER                      PIC  X(41)    VALUE SPACE.   03440099
034500     05  FILLER                      PIC  X(30)    VALUE          03450086
034600        ' INACTIVE UNREDEEMED BALANCES '.                         03460086
034700     05  FILLER                      PIC  X(61)    VALUE SPACE.   03470099
034800                                                                  03480004
034900 01  H5-HEADING-LINE-5.                                           03490019
035000     05  FILLER                      PIC  X(09)    VALUE SPACE.   03500086
035100     05  FILLER                      PIC  X(100)   VALUE ALL '-'. 03510099
035200     05  FILLER                      PIC  X(11)    VALUE SPACE.   03520099
035300     05  FILLER                      PIC  X(05)    VALUE 'TOTAL'. 03530086
035400     05  FILLER                      PIC  X(07)    VALUE SPACE.   03540099
035500                                                                  03550004
035600 01  H6-HEADING-LINE-6.                                           03560019
035700     05  FILLER                      PIC  X(09)    VALUE          03570086
035800        '  MONTHS '.                                              03580086
035900     05  H6-COLUMN-HEADING-ENTRY     OCCURS 5 TIMES               03590099
036000                                     INDEXED BY H6-IDX.           03600086
036100         10  H6-COLUMN-HEADING       PIC  X(20)    VALUE SPACE.   03610087
036200     05  FILLER                      PIC  X(23)    VALUE          03620099
036300        '         UNREDEEMED    '.                                03630099
036400                                                                  03640004
036500 01  H7-HEADING-LINE-7.                                           03650086
036600     05  FILLER                      PIC  X(50)    VALUE          03660086
036700        ' INACTIVE   DOLLARS/COUNT      DOLLARS/COUNT      '.     03670099
036800     05  FILLER                      PIC  X(52)    VALUE          03680099
036900        '  DOLLARS/COUNT         DOLLARS/COUNT       DOLLARS/'.   03690099
037000     05  FILLER                      PIC  X(30)    VALUE          03700099
037100        'COUNT          DOLLARS/COUNT  '.                         03710099
037200                                                                  03720086
037300******************************************************************03730061
037400*  DETAIL LINE PRINTED FIRST ON THE REVENUE REPORT (FOR DOLLARS). 03740086
037500******************************************************************03750061
037600 01  D1-DETAIL-LINE-1.                                            03760086
037700     05  FILLER                      PIC  X(02)    VALUE SPACE.   03770086
037800     05  D1-PERIOD-DESC              PIC  X(05)    VALUE SPACE.   03780086
037900     05  FILLER                      PIC  X(04)    VALUE SPACE.   03790099
038000     05  D1-COLUMN-ENTRY             OCCURS 5 TIMES               03800099
038100                                     INDEXED BY D1-IDX.           03810086
038200         10  D1-COLUMN               PIC  ZZZ,ZZZ,ZZ9.99          03820087
038300                                                   VALUE ZEROS.   03830087
038400         10  FILLER                  PIC  X(06)    VALUE SPACE.   03840086
038500     05  FILLER                      PIC  X(03)    VALUE SPACE.   03850099
038600     05  D1-TOTAL-UNREDEEMED         PIC  ZZZ,ZZZ,ZZ9.99          03860087
038700                                                   VALUE ZEROS.   03870087
038800     05  FILLER                      PIC  X(04)    VALUE SPACE.   03880099
038900                                                                  03890004
039000******************************************************************03900086
039100*  DETAIL LINE PRINTED SECOND ON THE REVENUE REPORT (FOR COUNTS). 03910086
039200******************************************************************03920086
039300 01  D2-DETAIL-LINE-2.                                            03930086
039400     05  FILLER                      PIC  X(15)    VALUE SPACE.   03940099
039500     05  D2-COLUMN-ENTRY             OCCURS 5 TIMES               03950099
039600                                     INDEXED BY D2-IDX.           03960086
039700         10  D2-COLUMN               PIC  ZZZ,ZZZ,ZZ9             03970087
039800                                                   VALUE ZEROS.   03980087
039900         10  FILLER                  PIC  X(09)    VALUE SPACE.   03990099
040000     05  FILLER                      PIC  X(03)    VALUE SPACE.   04000099
040100     05  D2-TOTAL-UNREDEEMED         PIC  ZZZ,ZZZ,ZZ9             04010087
040200                                                   VALUE ZEROS.   04020087
040300     05  FILLER                      PIC  X(03)    VALUE SPACE.   04030099
040400                                                                  04040086
040500******************************************************************04050061
040600*  TOTAL LINE PRINTED FIRST ON THE REVENUE REPORT (FOR DOLLARS).  04060086
040700******************************************************************04070061
040800 01  T1-TOTAL-LINE-1.                                             04080086
040900     05  FILLER                      PIC  X(08)    VALUE          04090099
041000         '  TOTALS'.                                              04100099
041100     05  T1-COLUMN-ENTRY             OCCURS 5 TIMES               04110099
041200                                     INDEXED BY T1-IDX.           04120086
041300         10  T1-COLUMN               PIC  ZZ,ZZZ,ZZZ,ZZ9.99       04130087
041400                                                   VALUE ZEROS.   04140087
041500         10  FILLER                  PIC  X(03)    VALUE SPACE.   04150086
041600     05  FILLER                      PIC  X(03)    VALUE SPACE.   04160099
041700     05  T1-TOTAL-UNREDEEMED         PIC  ZZ,ZZZ,ZZZ,ZZ9.99       04170087
041800                                                   VALUE ZEROS.   04180087
041900     05  FILLER                      PIC  X(04)    VALUE SPACE.   04190099
042000                                                                  04200087
042100******************************************************************04210086
042200*  TOTAL LINE PRINTED SECOND ON THE REVENUE REPORT (FOR COUNTS).  04220086
042300******************************************************************04230086
042400 01  T2-TOTAL-LINE-2.                                             04240086
042500     05  FILLER                      PIC  X(12)    VALUE SPACE.   04250099
042600     05  T2-COLUMN-ENTRY             OCCURS 5 TIMES               04260099
042700                                     INDEXED BY T2-IDX.           04270086
042800         10  T2-COLUMN               PIC  ZZ,ZZZ,ZZZ,ZZ9          04280087
042900                                                   VALUE ZEROS.   04290087
043000         10  FILLER                  PIC  X(06)    VALUE SPACE.   04300086
043100     05  FILLER                      PIC  X(03)    VALUE SPACE.   04310099
043200     05  T2-TOTAL-UNREDEEMED         PIC  ZZ,ZZZ,ZZZ,ZZ9          04320087
043300                                                   VALUE ZEROS.   04330087
043400     05  FILLER                      PIC  X(03)    VALUE SPACE.   04340099
043500                                                                  04350087
043600******************************************************************04360099
043700*  TOTAL LINE PRINTED FOR NEGATIVE BALANCES (FOR DOLLARS).        04370099
043800******************************************************************04380099
043900 01  T3-TOTAL-LINE-3.                                             04390099
044000     05  FILLER                      PIC  X(24)    VALUE          04400099
044100         '  TOTAL NEGATIVE BALANCE'.                              04410099
044200     05  FILLER                      PIC  X(88)    VALUE SPACE.   04420099
044300     05  T3-TOTAL-NEG-QTY            PIC  ZZ,ZZZ,ZZZ,ZZ9.99       04430099
044400                                                   VALUE ZEROS.   04440099
044500     05  FILLER                      PIC  X(03)    VALUE SPACE.   04450099
044600                                                                  04460099
044700******************************************************************04470099
044800*  TOTAL LINE PRINTED FOR NEGATIVE BALANCES (FOR COUNTS).         04480099
044900******************************************************************04490099
045000 01  T4-TOTAL-LINE-4.                                             04500099
045100     05  FILLER                      PIC  X(116)   VALUE SPACE.   04510099
045200     05  T4-TOTAL-NEG-QTY            PIC  ZZ,ZZZ,ZZZ,ZZ9          04520099
045300                                                   VALUE ZEROS.   04530099
045400     05  FILLER                      PIC  X(02)    VALUE SPACE.   04540099
045500                                                                  04550099
045600******************************************************************04560099
045700*  UNDER LINES FOR THE STORED VALUE REVENUE REPORT.               04570086
045800******************************************************************04580061
045900 01  UL-UNDER-LINE.                                               04590004
046000     05  FILLER                      PIC  X(09)    VALUE SPACE.   04600086
046100     05  FILLER                      OCCURS 5 TIMES.              04610099
046200         10  FILLER                  PIC  X(19)    VALUE ALL '-'. 04620087
046300         10  FILLER                  PIC  X(01)    VALUE SPACE.   04630087
046400     05  FILLER                      PIC  X(04)    VALUE SPACE.   04640099
046500     05  FILLER                      PIC  X(18)    VALUE ALL '-'. 04650099
046600     05  FILLER                      PIC  X(01)    VALUE SPACE.   04660099
046700******************************************************************04670015
046800* TABLE TO HOLD REPORT DATA FOR ALL CARDS EXCEPT KCK AND KMRC    *04680099
046900* AND FOR ALL FEE STATES*                                         04690099
047000******************************************************************04700015
047100 01  TB1-1-TABLE.                                                 04710088
047200     05  TB1-1-ENTRY                 OCCURS 17 TIMES              04720099
047300                                     INDEXED BY TB1-IDX.          04730013
047400         10  TB1-COL-DATA            OCCURS 5 TIMES               04740099
047500                                     INDEXED BY TB1-C-IDX.        04750088
047600             15  TB1-DLR-COL-QTY     PIC S9(09)V99 COMP-3         04760088
047700                                                   VALUE ZERO.    04770088
047800             15  TB1-CNT-COL-QTY     PIC S9(09)    COMP-3         04780088
047900                                                   VALUE ZERO.    04790088
048000         10  TB1-DLR-UNREDEEMED      PIC S9(09)V99 COMP-3         04800088
048100                                                   VALUE ZERO.    04810036
048200         10  TB1-CNT-UNREDEEMED      PIC S9(09)    COMP-3         04820088
048300                                                   VALUE ZERO.    04830036
048400******************************************************************04840099
048500* TABLE TO HOLD REPORT DATA FOR ALL CARDS AND ALL STATES.        *04850099
048600******************************************************************04860099
048700 01  TB2-2-TABLE.                                                 04870099
048800     05  TB2-2-ENTRY                 OCCURS 17 TIMES              04880099
048900                                     INDEXED BY TB2-IDX.          04890099
049000         10  TB2-COL-DATA            OCCURS 5 TIMES               04900099
049100                                     INDEXED BY TB2-C-IDX.        04910099
049200             15  TB2-DLR-COL-QTY     PIC S9(09)V99 COMP-3         04920099
049300                                                   VALUE ZERO.    04930099
049400             15  TB2-CNT-COL-QTY     PIC S9(09)    COMP-3         04940099
049500                                                   VALUE ZERO.    04950099
049600         10  TB2-DLR-UNREDEEMED      PIC S9(09)V99 COMP-3         04960099
049700                                                   VALUE ZERO.    04970099
049800         10  TB2-CNT-UNREDEEMED      PIC S9(09)    COMP-3         04980099
049900                                                   VALUE ZERO.    04990099
050000******************************************************************05000099
050100* TABLE TO HOLD RANGE OF FISCAL DATES TO BE SHOWN ON THE REPORT:  05010040
050200*   THESE ARE THE START AND ENDING DATES OF THE FISCAL PERIODS    05020089
050300*   THAT ARE USED FOR THE 'MONTHS INACTIVE' SHOWN DOWN LEFT SIDE  05030089
050400*   OF THE REPORT.                                                05040089
050500******************************************************************05050036
050600 01  TB3-FISCAL-PERIOD-DATA.                                      05060088
050700     05  FILLER.                                                  05070088
050800         10  FILLER                  PIC X(04)     VALUE '0012'.  05080089
050900         10  FILLER                  PIC X(05)     VALUE '<= 12'. 05090089
051000         10  FILLER                  PIC X(10)     VALUE SPACE.   05100089
051100         10  FILLER                  PIC X(10)     VALUE SPACE.   05110089
051200     05  FILLER.                                                  05120088
051300         10  FILLER                  PIC X(04)     VALUE '1318'.  05130099
051400         10  FILLER                  PIC X(05)     VALUE '13-18'. 05140099
051500         10  FILLER                  PIC X(10)     VALUE SPACE.   05150089
051600         10  FILLER                  PIC X(10)     VALUE SPACE.   05160089
051700     05  FILLER.                                                  05170088
051800         10  FILLER                  PIC X(04)     VALUE '1919'.  05180099
051900         10  FILLER                  PIC X(05)     VALUE '= 19 '. 05190099
052000         10  FILLER                  PIC X(10)     VALUE SPACE.   05200089
052100         10  FILLER                  PIC X(10)     VALUE SPACE.   05210089
052200     05  FILLER.                                                  05220088
052300         10  FILLER                  PIC X(04)     VALUE '2020'.  05230099
052400         10  FILLER                  PIC X(05)     VALUE '= 20 '. 05240099
052500         10  FILLER                  PIC X(10)     VALUE SPACE.   05250089
052600         10  FILLER                  PIC X(10)     VALUE SPACE.   05260089
052700     05  FILLER.                                                  05270099
052800         10  FILLER                  PIC X(04)     VALUE '2121'.  05280099
052900         10  FILLER                  PIC X(05)     VALUE '= 21 '. 05290099
053000         10  FILLER                  PIC X(10)     VALUE SPACE.   05300099
053100         10  FILLER                  PIC X(10)     VALUE SPACE.   05310099
053200     05  FILLER.                                                  05320099
053300         10  FILLER                  PIC X(04)     VALUE '2222'.  05330099
053400         10  FILLER                  PIC X(05)     VALUE '= 22 '. 05340099
053500         10  FILLER                  PIC X(10)     VALUE SPACE.   05350099
053600         10  FILLER                  PIC X(10)     VALUE SPACE.   05360099
053700     05  FILLER.                                                  05370088
053800         10  FILLER                  PIC X(04)     VALUE '2323'.  05380089
053900         10  FILLER                  PIC X(05)     VALUE '= 23 '. 05390089
054000         10  FILLER                  PIC X(10)     VALUE SPACE.   05400089
054100         10  FILLER                  PIC X(10)     VALUE SPACE.   05410089
054200     05  FILLER.                                                  05420088
054300         10  FILLER                  PIC X(04)     VALUE '2424'.  05430089
054400         10  FILLER                  PIC X(05)     VALUE '= 24 '. 05440089
054500         10  FILLER                  PIC X(10)     VALUE SPACE.   05450089
054600         10  FILLER                  PIC X(10)     VALUE SPACE.   05460089
054700     05  FILLER.                                                  05470088
054800         10  FILLER                  PIC X(04)     VALUE '2536'.  05480099
054900         10  FILLER                  PIC X(05)     VALUE '25-36'. 05490099
055000         10  FILLER                  PIC X(10)     VALUE SPACE.   05500088
055100         10  FILLER                  PIC X(10)     VALUE SPACE.   05510088
055200     05  FILLER.                                                  05520099
055300         10  FILLER                  PIC X(04)     VALUE '3754'.  05530099
055400         10  FILLER                  PIC X(05)     VALUE '37-54'. 05540099
055500         10  FILLER                  PIC X(10)     VALUE SPACE.   05550099
055600         10  FILLER                  PIC X(10)     VALUE SPACE.   05560099
055700     05  FILLER.                                                  05570099
055800         10  FILLER                  PIC X(04)     VALUE '5555'.  05580099
055900         10  FILLER                  PIC X(05)     VALUE '= 55 '. 05590099
056000         10  FILLER                  PIC X(10)     VALUE SPACE.   05600099
056100         10  FILLER                  PIC X(10)     VALUE SPACE.   05610099
056200     05  FILLER.                                                  05620099
056300         10  FILLER                  PIC X(04)     VALUE '5656'.  05630099
056400         10  FILLER                  PIC X(05)     VALUE '= 56 '. 05640099
056500         10  FILLER                  PIC X(10)     VALUE SPACE.   05650099
056600         10  FILLER                  PIC X(10)     VALUE SPACE.   05660099
056700     05  FILLER.                                                  05670099
056800         10  FILLER                  PIC X(04)     VALUE '5757'.  05680099
056900         10  FILLER                  PIC X(05)     VALUE '= 57 '. 05690099
057000         10  FILLER                  PIC X(10)     VALUE SPACE.   05700099
057100         10  FILLER                  PIC X(10)     VALUE SPACE.   05710099
057200     05  FILLER.                                                  05720099
057300         10  FILLER                  PIC X(04)     VALUE '5858'.  05730099
057400         10  FILLER                  PIC X(05)     VALUE '= 58 '. 05740099
057500         10  FILLER                  PIC X(10)     VALUE SPACE.   05750099
057600         10  FILLER                  PIC X(10)     VALUE SPACE.   05760099
057700     05  FILLER.                                                  05770099
057800         10  FILLER                  PIC X(04)     VALUE '5959'.  05780099
057900         10  FILLER                  PIC X(05)     VALUE '= 59 '. 05790099
058000         10  FILLER                  PIC X(10)     VALUE SPACE.   05800099
058100         10  FILLER                  PIC X(10)     VALUE SPACE.   05810099
058200     05  FILLER.                                                  05820099
058300         10  FILLER                  PIC X(04)     VALUE '6060'.  05830099
058400         10  FILLER                  PIC X(05)     VALUE '= 60 '. 05840099
058500         10  FILLER                  PIC X(10)     VALUE SPACE.   05850099
058600         10  FILLER                  PIC X(10)     VALUE SPACE.   05860099
058700     05  FILLER.                                                  05870099
058800         10  FILLER                  PIC X(04)     VALUE '6199'.  05880099
058900         10  FILLER                  PIC X(05)     VALUE '>= 61'. 05890099
059000         10  FILLER                  PIC X(10)     VALUE SPACE.   05900099
059100         10  FILLER                  PIC X(10)     VALUE SPACE.   05910099
059200 01  TB3-FISCAL-PERIOD-TABLE REDEFINES TB3-FISCAL-PERIOD-DATA.    05920099
059300     05  TB3-FISCAL-PERIOD-ENTRY     OCCURS 17 TIMES              05930099
059400                                     INDEXED BY TB3-IDX.          05940088
059500         10  TB3-FISCAL-PER-NEWEST   PIC 9(02).                   05950089
059600         10  TB3-FISCAL-PER-OLDEST   PIC 9(02).                   05960089
059700         10  TB3-REPORT-DESC         PIC X(05).                   05970089
059800         10  TB3-NEWEST-DATE         PIC X(10).                   05980099
059900         10  TB3-OLDEST-DATE         PIC X(10).                   05990099
060000                                                                  06000001
060100                                                                  06010089
060200******************************************************************06020089
060300* TABLE TO HOLD RANGE OF DOLLAR AMOUNTS USED FOR 'INACTIVE        06030089
060400* UNREDEEMED BALANCES' SHOWN IN 5 COLUMNS ACROSS TOP OF REPORT.   06040099
060500******************************************************************06050089
060600 01  TB4-DOLLAR-DATA.                                             06060089
060700     05  FILLER.                                                  06070089
060800         10 FILLER                   PIC S9(07)V99 COMP-3         06080099
060900                                                   VALUE       0. 06090089
061000         10 FILLER                   PIC S9(07)V99 COMP-3         06100099
061100                                                   VALUE   +1.50. 06110089
061200         10 FILLER                   PIC X(20)     VALUE          06120099
061300         '   >0 AND <=1.50    '.                                  06130099
061400     05  FILLER.                                                  06140089
061500         10 FILLER                   PIC S9(07)V99 COMP-3         06150099
061600                                                   VALUE   +1.50. 06160089
061700         10 FILLER                   PIC S9(07)V99 COMP-3         06170099
061800                                                   VALUE  +10.00. 06180099
061900         10 FILLER                   PIC X(20)     VALUE          06190099
062000         '>1.50 AND <=10.00   '.                                  06200099
062100     05  FILLER.                                                  06210089
062200         10 FILLER                   PIC S9(07)V99 COMP-3         06220089
062300                                                   VALUE  +10.00. 06230089
062400         10 FILLER                   PIC S9(07)V99 COMP-3         06240089
062500                                                   VALUE  +50.00. 06250099
062600         10 FILLER                   PIC X(20)     VALUE          06260099
062700         '>10.00 AND <=50.00  '.                                  06270099
062800     05  FILLER.                                                  06280089
062900         10 FILLER                   PIC S9(07)V99 COMP-3         06290089
063000                                                   VALUE  +50.00. 06300089
063100         10 FILLER                   PIC S9(07)V99 COMP-3         06310089
063200                                                   VALUE  +75.00. 06320099
063300         10 FILLER                   PIC X(20)     VALUE          06330099
063400         '  >50.00 AND <=75.00'.                                  06340099
063500     05  FILLER.                                                  06350089
063600         10 FILLER                   PIC S9(07)V99 COMP-3         06360089
063700                                                   VALUE  +75.00. 06370099
063800         10 FILLER                   PIC S9(07)V99 COMP-3         06380089
063900                                                   VALUE          06390089
064000                                                   +9999999.99.   06400089
064100         10 FILLER                   PIC X(20)     VALUE          06410099
064200         '       > 75.00      '.                                  06420099
064300 01  TB4-DOLLAR-TABLE  REDEFINES  TB4-DOLLAR-DATA.                06430089
064400     05  TB4-DOLLAR-ENTRY            OCCURS 5 TIMES               06440099
064500                                     INDEXED BY TB4-IDX.          06450089
064600         10  TB4-DOLLAR-START        PIC S9(07)V99 COMP-3.        06460089
064700         10  TB4-DOLLAR-END          PIC S9(07)V99 COMP-3.        06470089
064800         10  TB4-REPORT-DESC         PIC X(20).                   06480099
064900                                                                  06490099
065000******************************************************************06500099
065100* STANDARD DB2 ERROR HANDLING AREA                                06510099
065200******************************************************************06520099
065300     COPY DPWS004.                                                06530099
065400                                                                  06540099
065500******************************************************************06550099
065600*    STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA             *06560099
065700******************************************************************06570099
065800     EXEC SQL                                                     06580099
065900          INCLUDE SQLCA                                           06590099
066000     END-EXEC.                                                    06600099
066100                                                                  06610099
066200     COPY SQLCA2.                                                 06620099
066300***************************************************************** 06630099
066400*    DB2 TABLE DB2PDBA.TSTATE                                    *06640099
066500*              - STATE TABLE (TSTATE)                            *06650099
066600******************************************************************06660099
066700     EXEC SQL                                                     06670099
066800          INCLUDE TSTATE                                          06680099
066900     END-EXEC.                                                    06690099
067000                                                                  06700099
067100 01  TB5-STATES-TABLE.                                            06710099
067200     05  TB5-STATES-ENTRY            OCCURS 60 TIMES.             06720099
067300         10  TB5-STATE-CODE          PIC X(02).                   06730099
067400         10  TB5-STATE-NAME          PIC X(20).                   06740099
067500                                                                  06750099
067600******************************************************************06760099
067700*    CURSOR TO EXTRACT STATE NAME FROM TABLE TSTATE              *06770099
067800******************************************************************06780099
067900     EXEC SQL                                                     06790099
068000        DECLARE STATE-CSR CURSOR FOR                              06800099
068100            SELECT STATE_CODE,                                    06810099
068200                   STATE_NAME                                     06820099
068300              FROM TSTATE                                         06830099
068400            WITH UR                                               06840099
068500     END-EXEC.                                                    06850099
068600                                                                  06860099
068700***************************************************************** 06870089
068800* PROCEDURE DIVISION.                                           * 06880001
068900***************************************************************** 06890001
069000 PROCEDURE DIVISION.                                              06900001
069100                                                                  06910001
069200 0000-MAINLINE-PROCESSING.                                        06920099
069300                                                                  06930099
069400     PERFORM 1000-INITIALIZE-PROGRAM.                             06940099
069500     PERFORM 2000-PRODUCE-REPORT.                                 06950099
069600                                                                  06960099
069700     MOVE PV-DISPLAY-BALANCE-REC-CNT  TO PV-DISPLAY-COUNT.        06970099
069800     DISPLAY '    TOTAL INPUT RECORDS READ = ' PV-DISPLAY-COUNT.  06980099
069900                                                                  06990099
070000     CLOSE BALANCE-FILE                                           07000099
070100           REVENUE-REPORT-FILE.                                   07010099
070200                                                                  07020099
070300     STOP RUN.                                                    07030099
070400                                                                  07040099
070500 EJECT                                                            07050099
070600******************************************************************07060099
070700* 1000-INITIALIZE-PROGRAM                                         07070099
070800* OPEN FILES, GET CONTROL CARD, LOAD TABLE 3 DATE RANGES,         07080099
070900* FORMAT REPORT HEADINGS.                                         07090099
071000******************************************************************07100099
071100 1000-INITIALIZE-PROGRAM.                                         07110099
071200                                                                  07120099
071300     OPEN INPUT  DATE-CARD-FILE                                   07130099
071400          INPUT  BALANCE-FILE                                     07140099
071500          OUTPUT REVENUE-REPORT-FILE.                             07150099
071600                                                                  07160099
071700     PERFORM 1100-PROCESS-CONTROL-CARD.                           07170099
071800     PERFORM 1200-GET-FISCAL-PERIOD-RANGE.                        07180099
071900     PERFORM 1300-LOAD-STATES-TABLE.                              07190099
072000     PERFORM 1400-FORMAT-HEADINGS.                                07200099
072100******************************************************************07210099
072200* 1100-PROCESS-CONTROL-CARD                                       07220099
072300* READ DATE CONTROL CARD FOR FISCAL MONTH-END DATE.               07230099
072400* CALL DATE ROUTINE TO GET MAX FISCAL PERIOD.                     07240099
072500******************************************************************07250099
072600 1100-PROCESS-CONTROL-CARD.                                       07260099
072700                                                                  07270099
072800     PERFORM 1110-READ-DATE-CARD-FILE.                            07280099
072900     CLOSE DATE-CARD-FILE.                                        07290099
073000     IF CC-REPORT-TYPE = PC-DETAIL-REPORT OR                      07300099
073100                         PC-TOTAL-REPORT                          07310099
073200         CONTINUE                                                 07320099
073300     ELSE                                                         07330099
073400         MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   07340099
073500         MOVE 'NO REPORT PARM TO PROCESS'  TO PV-OPERATION-MSG-1  07350099
073600         SET AC-CONTROL-CARD-ERROR TO TRUE                        07360099
073700         PERFORM 9999-ABEND                                       07370099
073800     END-IF.                                                      07380099
073900                                                                  07390099
074000     IF PS-END-OF-CARD-FILE                                       07400099
074100         MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   07410099
074200         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  07420099
074300         SET AC-CONTROL-CARD-ERROR TO TRUE                        07430099
074400         PERFORM 9999-ABEND                                       07440099
074500     END-IF.                                                      07450099
074600                                                                  07460099
074700     MOVE CC-MONTH-END-CCYY-MM-DD TO PV-WORK-CCYY-MM-DD.          07470099
074800     DISPLAY 'SVKRP002 CONTROL CARD DATE = ' PV-WORK-CCYY-MM-DD.  07480099
074900     PERFORM 1500-GET-FISCAL-445-DATES.                           07490099
075000     MOVE PV-FISCAL-YEAR-CCYY     TO H2-YEAR                      07500099
075100                                     PV-CARD-CCYY.                07510099
075200     MOVE PV-MONTH-NAME           TO H2-MONTH.                    07520099
075300     MOVE PV-FISCAL-PER-NBR       TO PV-CARD-PP.                  07530099
075400******************************************************************07540099
075500* 1110-READ-DATE-CARD-FILE                                        07550099
075600* READ DATE CONTROL CARD.                                         07560099
075700******************************************************************07570099
075800 1110-READ-DATE-CARD-FILE.                                        07580099
075900     READ DATE-CARD-FILE INTO CC-CONTROL-CARD                     07590099
076000        AT END                                                    07600099
076100           SET PS-END-OF-CARD-FILE TO TRUE.                       07610099
076200                                                                  07620099
076300******************************************************************07630099
076400* 1200-GET-FISCAL-PERIOD-RANGE                                    07640099
076500* LOAD RANGE OF FISCAL PERIOD FIRST AND LAST DATES TO TABLE 3.    07650099
076600*                                                                 07660099
076700* THESE RANGES ARE BASED ON FISCAL YEAR AND FISCAL PERIOD WHICH   07670099
076800* GET DECREMENTED BY USING THE KOHLS CALENDAR ROUTINE.            07680099
076900*                                                                 07690099
077000* THE RANGES BEGIN WITH THE FISCAL YEAR AND FISCAL PERIOD DERIVED 07700099
077100* FROM THE INPUT CONTROL CARD DATE (PV-CARD-CCYY, PV-CARD-PP).    07710099
077200* THE RANGES END WITH THE FISCAL YEAR AND FISCAL PERIOD FROM      07720099
077300* SEVERAL FISCAL PERIODS EARLIER (DETERMINED BY THE LAST ENTRY IN 07730099
077400* TABLE 3).                                                       07740099
077500*                                                                 07750099
077600* THE FISCAL PERIOD FIRST AND LAST DATES DERIVED FROM THE CONTROL 07760099
077700* CARD ARE STILL PRESENT IN WORKING STORAGE FROM THE CALENDAR     07770099
077800* CALL PERFORMED IN PARA 1100.                                    07780099
077900******************************************************************07790099
078000 1200-GET-FISCAL-PERIOD-RANGE.                                    07800099
078100                                                                  07810099
078200     PERFORM 1210-LOAD-TABLE-3-ENTRY                              07820099
078300        VARYING TB3-IDX FROM +1 BY +1                             07830099
078400           UNTIL TB3-IDX > PC-MAX-MONTHS-GRPS.                    07840099
078500                                                                  07850099
078600******************************************************************07860099
078700* 1210-LOAD-TABLE-3-ENTRY                                         07870099
078800*  LOAD TABLE 3 ENTRIES WITH THE STARTING AND ENDING POINTS OF A  07880099
078900*  DATE RANGE.  A RANGE "STARTS" WITH THE LAST DATE OF A FISCAL   07890099
079000*  PERIOD.  THIS DATE IS "NEWEST" DATE IN THE RANGE.              07900099
079100*  A RANGE "ENDS" WITH THE FIRST DATE OF AN OLDER FISCAL PERIOD.  07910099
079200*  THIS DATE IS "OLDEST" DATE IN THE RANGE.                       07920099
079300******************************************************************07930099
079400 1210-LOAD-TABLE-3-ENTRY.                                         07940099
079500                                                                  07950099
079600     IF TB3-IDX = +1                                              07960099
079700         MOVE PV-FISCAL-PER-LST-DATE TO TB3-NEWEST-DATE(TB3-IDX)  07970099
079800         MOVE TB3-FISCAL-PER-OLDEST(TB3-IDX)                      07980099
079900                                     TO PV-DEC-FISCAL-PERIOD      07990099
080000         PERFORM 1510-DECREMENT-FISCAL-PERIOD                     08000099
080100         MOVE PV-FISCAL-PER-FST-DATE TO TB3-OLDEST-DATE(TB3-IDX)  08010099
080200     ELSE                                                         08020099
080300         MOVE TB3-FISCAL-PER-NEWEST(TB3-IDX)                      08030099
080400                                     TO PV-DEC-FISCAL-PERIOD      08040099
080500         PERFORM 1510-DECREMENT-FISCAL-PERIOD                     08050099
080600         MOVE PV-FISCAL-PER-LST-DATE TO TB3-NEWEST-DATE(TB3-IDX)  08060099
080700         IF TB3-IDX = PC-MAX-MONTHS-GRPS                          08070099
080800             MOVE LOW-VALUES         TO TB3-OLDEST-DATE(TB3-IDX)  08080099
080900         ELSE                                                     08090099
081000             MOVE TB3-FISCAL-PER-OLDEST(TB3-IDX)                  08100099
081100                                     TO PV-DEC-FISCAL-PERIOD      08110099
081200             PERFORM 1510-DECREMENT-FISCAL-PERIOD                 08120099
081300             MOVE PV-FISCAL-PER-FST-DATE                          08130099
081400                                     TO TB3-OLDEST-DATE(TB3-IDX)  08140099
081500         END-IF                                                   08150099
081600     END-IF.                                                      08160099
081700                                                                  08170099
081800******************************************************************08180099
081900* 1300-LOAD-STATES-TABLE                                          08190099
082000*    OPENS, FETCH, PROCESS AND CLOSE STATE TABLE                  08200099
082100******************************************************************08210099
082200 1300-LOAD-STATES-TABLE.                                          08220099
082300                                                                  08230099
082400     PERFORM 1310-OPEN-STATE-CSR.                                 08240099
082500     PERFORM 1350-FETCH-STATE-CSR.                                08250099
082600                                                                  08260099
082700     PERFORM 1330-LOAD-STATES-TABLE                               08270099
082900          UNTIL PS-END-OF-STATE-CSR.                              08290099
083100                                                                  08310099
083200     PERFORM 1360-CLOSE-STATE-CSR.                                08320099
083300                                                                  08330099
083400******************************************************************08340099
083500*    OPEN THE STATE CURSOR                                       *08350099
083600******************************************************************08360099
083700 1310-OPEN-STATE-CSR.                                             08370099
083800     EXEC SQL                                                     08380099
083900         OPEN STATE-CSR                                           08390099
084000     END-EXEC.                                                    08400099
084100                                                                  08410099
084200     EVALUATE TRUE                                                08420099
084300        WHEN SQLCODE = ZERO                                       08430099
084400             CONTINUE                                             08440099
084500        WHEN OTHER                                                08450099
084600             MOVE '1310-OPEN-STATE-CSR'                           08460099
084700                               TO PV-PARAGRAPH-NAME               08470099
084800             MOVE 'OPEN STATE CURSOR - '                          08480099
084900                               TO PV-DB2-OPERATION                08490099
085000             PERFORM Z900-SQL-ABEND                               08500099
085100     END-EVALUATE.                                                08510099
085200                                                                  08520099
085300******************************************************************08530099
085400* 1330-LOAD-STATES-TABLE                                          08540099
085500*     LOAD THE STATE TABLE                                        08550099
085600******************************************************************08560099
085700 1330-LOAD-STATES-TABLE.                                          08570099
085800     ADD +1                    TO PV-STATE-SUB.                   08580099
085900     IF PV-STATE-SUB > PV-MAX-STATE                               08590099
086000         MOVE '1330-LOAD-STATES-TABLE   '  TO PV-PARAGRAPH-NAME   08600099
086100         MOVE 'STATE TABLE LIMIT EXCEEDED' TO PV-OPERATION-MSG-1  08610099
086200         SET AC-TABLE-OVERFLOW     TO TRUE                        08620099
086300         PERFORM 9999-ABEND                                       08630099
086400     ELSE                                                         08640099
086500         MOVE TSTATE-STATE-CODE TO TB5-STATE-CODE (PV-STATE-SUB)  08650099
086600         MOVE TSTATE-STATE-NAME TO TB5-STATE-NAME (PV-STATE-SUB)  08660099
086700         PERFORM 1350-FETCH-STATE-CSR                             08670099
086800     END-IF.                                                      08680099
086900                                                                  08690099
087000******************************************************************08700099
087100*      1350-FETCH-STATE-CSR                                      *08710099
087200* ==>  PROCESSES:                                                *08720099
087300*      - FETCH FROM THE STATE TABLE.                             *08730099
087400******************************************************************08740099
087500 1350-FETCH-STATE-CSR.                                            08750099
087600     EXEC SQL                                                     08760099
087700         FETCH STATE-CSR                                          08770099
087800         INTO :TSTATE-STATE-CODE                                  08780099
087900             ,:TSTATE-STATE-NAME                                  08790099
088000     END-EXEC.                                                    08800099
088100                                                                  08810099
088200     EVALUATE SQLCODE                                             08820099
088300         WHEN ZERO                                                08830099
088400             CONTINUE                                             08840099
088500         WHEN +100                                                08850099
088600             MOVE PV-STATE-SUB TO PV-MAX-STATE                    08860099
088700             SET PS-END-OF-STATE-CSR TO TRUE                      08870099
088800         WHEN OTHER                                               08880099
088900             MOVE '1350-FETCH-STATE-CSR'                          08890099
089000                                    TO PV-PARAGRAPH-NAME          08900099
089100             MOVE 'FETCH STATE CURSOR - '                         08910099
089200                                    TO PV-DB2-OPERATION           08920099
089300             PERFORM Z900-SQL-ABEND                               08930099
089400     END-EVALUATE.                                                08940099
089500                                                                  08950099
089600******************************************************************08960099
089700*      1360-CLOSE-STATE-CSR                                      *08970099
089800* ==>  PROCESSES:                                                *08980099
089900*      - CLOSE THE STATE  CURSOR                                 *08990099
090000******************************************************************09000099
090100 1360-CLOSE-STATE-CSR.                                            09010099
090200     EXEC SQL                                                     09020099
090300         CLOSE STATE-CSR                                          09030099
090400     END-EXEC.                                                    09040099
090500                                                                  09050099
090600     EVALUATE TRUE                                                09060099
090700         WHEN SQLCODE = ZERO                                      09070099
090800             CONTINUE                                             09080099
090900         WHEN OTHER                                               09090099
091000             MOVE '1360-CLOSE-STATE-CSR'                          09100099
091100                                TO PV-PARAGRAPH-NAME              09110099
091200             MOVE 'CLOSE STATE CURSOR - '                         09120099
091300                                TO PV-DB2-OPERATION               09130099
091400             PERFORM Z900-SQL-ABEND                               09140099
091500     END-EVALUATE.                                                09150099
091600                                                                  09160099
091700******************************************************************09170099
091800* 1400-FORMAT-HEADINGS                                            09180099
091900*    GET CURRENT DATE AND TIME FROM SYSTEM.                       09190099
092000*    FORMAT DATE, TIME, AND PROGRAM NAME FIELDS IN THE TOP PAGE   09200099
092100*    PAGE HEADING LINE. FORMAT DOLLAR RANGES IN H6-HEADING-LINE-6.09210099
092200******************************************************************09220099
092300 1400-FORMAT-HEADINGS.                                            09230099
092400                                                                  09240099
092500     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   09250099
092600     ACCEPT PV-CURR-TIME FROM TIME.                               09260099
092700                                                                  09270099
092800     MOVE PV-CURR-DATE-MM             TO DP132-RUN-MONTH.         09280099
092900     MOVE PV-CURR-DATE-DD             TO DP132-RUN-DAY.           09290099
093000     MOVE PV-CURR-DATE-CCYY           TO DP132-RUN-YEAR.          09300099
093100                                                                  09310099
093200     MOVE PV-CURR-TIME-HH             TO DP132-RUN-HOUR.          09320099
093300     MOVE PV-CURR-TIME-MM             TO DP132-RUN-MINUTE.        09330099
093400     MOVE PC-CURRENT-PROGRAM-NAME     TO DP132-PROGRAM-NAME.      09340099
093500     MOVE PC-REPORT-NBR-1             TO DP132-REPORT-NUMBER.     09350099
093600                                                                  09360099
093700     PERFORM                                                      09370099
093800       VARYING TB4-IDX                                            09380099
093900       FROM +1 BY +1                                              09390099
094000       UNTIL TB4-IDX > PC-MAX-DLR-GRPS                            09400099
094100         SET H6-IDX TO TB4-IDX                                    09410099
094200         MOVE TB4-REPORT-DESC(TB4-IDX)                            09420099
094300                                   TO H6-COLUMN-HEADING(H6-IDX)   09430099
094400     END-PERFORM.                                                 09440099
094500                                                                  09450099
094600******************************************************************09460099
094700* 1500-GET-FISCAL-445-DATES                                       09470099
094800* CALL KOHLS CALENDAR ROUTINE TO TAKE A DATE IN DB2 ISO FORMAT    09480099
094900* (CCYY-MM-DD) AND RETURN 4-4-5 (JAN - DEC) FISCAL DATE FIELDS.   09490099
095000******************************************************************09500099
095100 1500-GET-FISCAL-445-DATES.                                       09510099
095200                                                                  09520099
095300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              09530099
095400                                                                  09540099
095500     SET DPG51-FISCAL-JAN-DEC-F2       TO TRUE.                   09550099
095600     SET DPG51-DO-NOT-INCR-DECR-DATE   TO TRUE.                   09560099
095700     MOVE PV-WORK-CCYY-MM-DD           TO DPG52-LK-DATE-INPUT.    09570099
095800     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   09580099
095900                                                                  09590099
096000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    09600099
096100                                             DPG54 DPG55 DPG56.   09610099
096200     EVALUATE TRUE                                                09620099
096300         WHEN DPG54-SEVERE-ERROR                                  09630099
096400         WHEN DPG54-DATE-INVALID                                  09640099
096500             MOVE '1500-GET-FISCAL-445-DATES'                     09650099
096600                                           TO PV-PARAGRAPH-NAME   09660099
096700             MOVE 'INVALID CONTROL CARD FISCAL DATE'              09670099
096800                                           TO PV-OPERATION-MSG-1  09680099
096900             SET AC-CONTROL-CARD-ERROR TO TRUE                    09690099
097000             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  09700099
097100             PERFORM 9999-ABEND                                   09710099
097200     END-EVALUATE.                                                09720099
097300                                                                  09730099
097400     MOVE DPG56-FISCAL-YEAR-CCYY       TO PV-FISCAL-YEAR-CCYY.    09740099
097500     MOVE DPG56-FISCAL-PERIOD-NBR      TO PV-FISCAL-PER-NBR.      09750099
097600     MOVE DPG56-FISCAL-PERIOD-NAME     TO PV-MONTH-NAME.          09760099
097700     MOVE DPG56-FIRST-FP-DB2-ISO-FMT   TO PV-FISCAL-PER-FST-DATE. 09770099
097800     MOVE DPG56-LAST-FP-DB2-ISO-FMT    TO PV-FISCAL-PER-LST-DATE. 09780099
097900                                                                  09790099
098000******************************************************************09800099
098100* 1510-DECREMENT-FISCAL-PERIOD                                    09810099
098200* CALL KOHLS CALENDAR ROUTINE TO TAKE A 4-4-5 FISCAL YEAR AND     09820099
098300* FISCAL PERIOD (CCYYPP), DECREMENT THE FISCAL PERIOD, AND RETURN 09830099
098400* 4-4-5 (JAN - DEC) FISCAL DATE FIELDS FOR THE NEW FISCAL PERIOD. 09840099
098500******************************************************************09850099
098600 1510-DECREMENT-FISCAL-PERIOD.                                    09860099
098700                                                                  09870099
098800     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              09880099
098900                                                                  09890099
099000     SET DPG51-FISCAL-JAN-DEC-F2   TO TRUE.                       09900099
099100     SET DPG51-DECREMENT-DATE      TO TRUE.                       09910099
099200     MOVE PV-DEC-FISCAL-PERIOD TO DPG51-INCR-DECR-FISCAL-PRD-9.   09920099
099300     MOVE PV-CARD-CCYY             TO DPG52-FISCAL-CC-PRD-YR.     09930099
099400     MOVE PV-CARD-PP               TO DPG52-FISCAL-CC-PRD-PP.     09940099
099500     SET DPG52-LK-DTE-FISC-PRD-CC  TO TRUE.                       09950099
099600                                                                  09960099
099700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    09970099
099800                                             DPG54 DPG55 DPG56.   09980099
099900     EVALUATE TRUE                                                09990099
100000         WHEN DPG54-SEVERE-ERROR                                  10000099
100100         WHEN DPG54-DATE-INVALID                                  10010099
100200             MOVE '1510-DECREMENT-FISCAL-PERIOD'                  10020099
100300                                       TO PV-PARAGRAPH-NAME       10030099
100400             MOVE 'ERROR DECREMENTING FISCAL PERIOD'              10040099
100500                                       TO PV-OPERATION-MSG-1      10050099
100600             MOVE DPG54-ERROR-MESSAGE  TO PV-OPERATION-MSG-2      10060099
100700             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                10070099
100800             PERFORM 9999-ABEND                                   10080099
100900     END-EVALUATE.                                                10090099
101000     MOVE DPG56-FISCAL-YEAR-CCYY       TO PV-FISCAL-YEAR-CCYY.    10100099
101100     MOVE DPG56-FISCAL-PERIOD-NBR      TO PV-FISCAL-PER-NBR.      10110099
101200     MOVE DPG56-FIRST-FP-DB2-ISO-FMT   TO PV-FISCAL-PER-FST-DATE. 10120099
101300     MOVE DPG56-LAST-FP-DB2-ISO-FMT    TO PV-FISCAL-PER-LST-DATE. 10130099
101400                                                                  10140099
101500 EJECT                                                            10150099
101600******************************************************************10160099
101700* 2000-PRODUCE-REPORT                                             10170099
101800******************************************************************10180099
101900 2000-PRODUCE-REPORT.                                             10190099
102000                                                                  10200099
102100     PERFORM 2100-PREPARE-FOR-REPORT.                             10210099
102200     IF CC-REPORT-TYPE = PC-DETAIL-REPORT                         10220099
102300         PERFORM 2200-PROCESS-BALANCE-DETAIL                      10230099
102400           UNTIL PS-END-OF-BALANCE-FILE                           10240099
102500     END-IF.                                                      10250099
102600                                                                  10260099
102700     IF CC-REPORT-TYPE = PC-TOTAL-REPORT                          10270099
102800         PERFORM 2201-PROCESS-BALANCE-TOTALS                      10280099
102900           UNTIL PS-END-OF-BALANCE-FILE                           10290099
103000     END-IF.                                                      10300099
103100     PERFORM 2500-PRINT-CARD-STOCK-PAGE.                          10310099
103200     PERFORM 3000-PRINT-SUMMARY-PAGE.                             10320099
103300                                                                  10330099
103400******************************************************************10340099
103500* 2100-PREPARE-FOR-REPORT.                                        10350099
103600*   DO PRIME READ OF BALANCE FILE, SET UP CONTROL BREAK FIELD,    10360099
103700*   GET FIRST CARD STOCK DESCRIPTION, PRINT REPORT HEADINGS.      10370099
103800******************************************************************10380099
103900 2100-PREPARE-FOR-REPORT.                                         10390099
104000                                                                  10400099
104100     PERFORM 7000-READ-BALANCE-FILE.                              10410099
104200     IF PS-END-OF-BALANCE-FILE                                    10420099
104300         MOVE '2100-PREPARE-FOR-REPORT'    TO PV-PARAGRAPH-NAME   10430099
104400         MOVE 'NO INPUT DATA TO PROCESS'   TO PV-OPERATION-MSG-1  10440099
104500         SET AC-DATASET-DATA-ERROR TO TRUE                        10450099
104600         PERFORM 9999-ABEND                                       10460099
104700     END-IF.                                                      10470099
104800                                                                  10480099
104900     MOVE SV003-CRD-STK-TYP-ID   TO PV-SAVE-CRD-STK-TYP.          10490099
105000     MOVE SV003-CRD-STK-TYP-DESC TO PV-SAVE-CRD-STK-DESC.         10500099
105100     MOVE SV003-ST-CDE           TO PV-SAVE-ST-CDE.               10510099
105200     MOVE SV003-ST-FEE-MONTH     TO PV-SAVE-ST-FEE-MONTH.         10520099
105300******************************************************************10530099
105400* 2200-PROCESS-BALANCE-DETAIL.                                    10540099
105500*  PROCESS THE STORED VALUE CARD BALANCE FILE.                    10550099
105600******************************************************************10560099
105700 2200-PROCESS-BALANCE-DETAIL.                                     10570099
105800                                                                  10580099
105900     IF SV003-CRD-STK-TYP-ID = PV-SAVE-CRD-STK-TYP                10590099
106000         IF SV003-ST-FEE-MONTH = PV-SAVE-ST-FEE-MONTH             10600099
106100             IF SV003-ST-CDE = PV-SAVE-ST-CDE                     10610099
106200                CONTINUE                                          10620099
106300             ELSE                                                 10630099
106400                IF SV003-ST-FEE-MONTH = SV004-SRV-FEE-INACTIVE-PRD10640099
106500                    CONTINUE                                      10650099
106600                ELSE                                              10660099
106700                    PERFORM 2210-PROCESS-BREAK-ON-STATE           10670099
106800                END-IF                                            10680099
106900             END-IF                                               10690099
107000         ELSE                                                     10700099
107100             PERFORM 2220-PROCESS-BREAK-ON-FEE-MTH                10710099
107200         END-IF                                                   10720099
107300     ELSE                                                         10730099
107400         PERFORM 2230-PROCESS-BREAK-ON-CRD-STK                    10740099
107500     END-IF.                                                      10750099
107600                                                                  10760099
107700     IF SV003-BALANCE > 0                                         10770099
107800         PERFORM 2300-FIND-DATE-RANGE                             10780099
107900         PERFORM 2400-ACCUM-TOTALS                                10790099
108000     ELSE                                                         10800099
108100         PERFORM 2410-ACCUM-NEG-TOTALS                            10810099
108200     END-IF.                                                      10820099
108300                                                                  10830099
108400     PERFORM 7000-READ-BALANCE-FILE.                              10840099
108500                                                                  10850099
108600******************************************************************10860099
108700* 2201-PROCESS-BALANCE-TOTALS.                                    10870099
108800*  PROCESS THE STORED VALUE CARD BALANCE FILE.                    10880099
108900******************************************************************10890099
109000 2201-PROCESS-BALANCE-TOTALS.                                     10900099
109100                                                                  10910099
109200     IF SV003-ST-FEE-MONTH = PV-SAVE-ST-FEE-MONTH                 10920099
109300         IF SV003-ST-CDE = PV-SAVE-ST-CDE                         10930099
109400            CONTINUE                                              10940099
109500         ELSE                                                     10950099
109600             IF SV003-ST-FEE-MONTH = SV004-SRV-FEE-INACTIVE-PRD   10960099
109700                 CONTINUE                                         10970099
109800             ELSE                                                 10980099
109900                 PERFORM 2210-PROCESS-BREAK-ON-STATE              10990099
110000             END-IF                                               11000099
110100         END-IF                                                   11010099
110200     ELSE                                                         11020099
110300         PERFORM 2220-PROCESS-BREAK-ON-FEE-MTH                    11030099
110400     END-IF.                                                      11040099
110500                                                                  11050099
110600     IF SV003-BALANCE > 0                                         11060099
110700         PERFORM 2300-FIND-DATE-RANGE                             11070099
110800         PERFORM 2400-ACCUM-TOTALS                                11080099
110900     ELSE                                                         11090099
111000         PERFORM 2410-ACCUM-NEG-TOTALS                            11100099
111100     END-IF.                                                      11110099
111200                                                                  11120099
111300     PERFORM 7000-READ-BALANCE-FILE.                              11130099
111400                                                                  11140099
111500******************************************************************11150099
111600* 2210-PROCESS-BREAK-ON-STATE                                    *11160099
111700*  PROCESS CONTROL BREAK ON STATE                                *11170099
111800*  PRINTS THE ACCUMULATION TOTALS FOR THE PREVIOUS STATE.        *11180099
111900******************************************************************11190099
112000 2210-PROCESS-BREAK-ON-STATE.                                     11200099
112100                                                                  11210099
112200     PERFORM 2500-PRINT-CARD-STOCK-PAGE.                          11220099
112300     MOVE SV003-ST-CDE TO PV-SAVE-ST-CDE.                         11230099
112400                                                                  11240099
112500******************************************************************11250099
112600* 2220-PROCESS-BREAK-ON-FEE-MTH                                  *11260099
112700*  PROCESS CONTROL BREAK ON NUMBER OF FEE MONTHS                 *11270099
112800*  PRINTS THE ACCUMULATION TOTALS FOR THE PREVIOUS FEE MONTH.    *11280099
112900******************************************************************11290099
113000 2220-PROCESS-BREAK-ON-FEE-MTH.                                   11300099
113100                                                                  11310099
113200     PERFORM 2500-PRINT-CARD-STOCK-PAGE.                          11320099
113300     MOVE SV003-ST-CDE       TO PV-SAVE-ST-CDE.                   11330099
113400     MOVE SV003-ST-FEE-MONTH TO PV-SAVE-ST-FEE-MONTH.             11340099
113500                                                                  11350099
113600******************************************************************11360099
113700* 2230-PROCESS-BREAK-ON-CRD-STK                                  *11370099
113800*  PROCESS CONTROL BREAK ON CARD STOCK TYPE.                     *11380099
113900*  PRINT DETAIL LINE OF DOLLAR TOTALS FOR LAST DATE.             *11390099
114000*  PRINT TOTAL LINE OF DOLLAR TOTALS FOR LAST CARD STOCK         *11400099
114100******************************************************************11410099
114200 2230-PROCESS-BREAK-ON-CRD-STK.                                   11420099
114300                                                                  11430099
114400     PERFORM 2500-PRINT-CARD-STOCK-PAGE.                          11440099
114500     PERFORM 3000-PRINT-SUMMARY-PAGE.                             11450099
114600     MOVE SV003-ST-CDE         TO PV-SAVE-ST-CDE.                 11460099
114700     MOVE SV003-ST-FEE-MONTH   TO PV-SAVE-ST-FEE-MONTH.           11470099
114800     MOVE SV003-CRD-STK-TYP-ID TO PV-SAVE-CRD-STK-TYP.            11480099
114900                                                                  11490099
115000******************************************************************11500099
115100* 2300-FIND-DATE-RANGE                                            11510099
115200******************************************************************11520099
115300 2300-FIND-DATE-RANGE.                                            11530099
115400                                                                  11540099
115500     SET PS-TABLE-3-DATE-NOT-FOUND    TO TRUE.                    11550099
115600     PERFORM 2310-FIND-TABLE-3-ENTRY                              11560099
115700        VARYING TB3-IDX FROM +1 BY +1                             11570099
115800           UNTIL TB3-IDX > PC-MAX-MONTHS-GRPS                     11580099
115900           OR PS-TABLE-3-DATE-FOUND.                              11590099
116000                                                                  11600099
116100******************************************************************11610099
116200* 2310-FIND-TABLE-3-ENTRY                                         11620099
116300* FIND DATE RANGE WHERE THE RECORD'S LAST ACTIVITY DATE IS        11630099
116400* LESS/EQUAL THE NEWEST DATE AND GREATER/EQUAL THE OLDEST DATE.   11640099
116500******************************************************************11650099
116600 2310-FIND-TABLE-3-ENTRY.                                         11660099
116700                                                                  11670099
116800     IF  SV003-LST-ACTVY-DTE <= TB3-NEWEST-DATE(TB3-IDX)          11680099
116900     AND SV003-LST-ACTVY-DTE >= TB3-OLDEST-DATE(TB3-IDX)          11690099
117000         SET PS-TABLE-3-DATE-FOUND TO TRUE                        11700099
117100         SET TB1-IDX TO TB3-IDX                                   11710099
117200     END-IF.                                                      11720099
117300                                                                  11730099
117400******************************************************************11740099
117500* 2400-ACCUM-TOTALS.                                              11750099
117600*  ADD AMOUNTS FROM CURRENT INPUT RECORD TO BALANCE ACCUMULATORS. 11760099
117700******************************************************************11770099
117800 2400-ACCUM-TOTALS.                                               11780099
117900                                                                  11790099
118000     SET PS-TABLE-4-AMOUNT-NOT-FOUND  TO TRUE.                    11800099
118100     SET TB2-IDX TO TB1-IDX.                                      11810099
118200     PERFORM                                                      11820099
118300       VARYING TB1-C-IDX FROM +1 BY +1                            11830099
118400       UNTIL TB1-C-IDX > PC-MAX-DLR-GRPS                          11840099
118500       OR PS-TABLE-4-AMOUNT-FOUND                                 11850099
118600         SET TB2-C-IDX TO TB1-C-IDX                               11860099
118700         SET TB4-IDX   TO TB1-C-IDX                               11870099
118800         IF SV003-BALANCE  > TB4-DOLLAR-START(TB4-IDX)            11880099
118900         AND SV003-BALANCE <= TB4-DOLLAR-END(TB4-IDX)             11890099
119000              ADD SV003-BALANCE                                   11900099
119100                           TO TB1-DLR-COL-QTY(TB1-IDX, TB1-C-IDX) 11910099
119200                              TB2-DLR-COL-QTY(TB2-IDX, TB2-C-IDX) 11920099
119300              ADD +1       TO TB1-CNT-COL-QTY(TB1-IDX, TB1-C-IDX) 11930099
119400                              TB2-CNT-COL-QTY(TB2-IDX, TB2-C-IDX) 11940099
119500              SET PS-TABLE-4-AMOUNT-FOUND TO TRUE                 11950099
119600         END-IF                                                   11960099
119700     END-PERFORM.                                                 11970099
119800                                                                  11980099
119900     ADD SV003-BALANCE            TO TB1-DLR-UNREDEEMED(TB1-IDX)  11990099
120000                                     TB2-DLR-UNREDEEMED(TB2-IDX). 12000099
120100     ADD +1                       TO TB1-CNT-UNREDEEMED(TB1-IDX)  12010099
120200                                     TB2-CNT-UNREDEEMED(TB2-IDX). 12020099
120300                                                                  12030099
120400******************************************************************12040099
120500* 2410-ACCUM-NEG-TOTALS.                                          12050099
120600*  ADD AMOUNTS FROM CURRENT INPUT RECORD TO NEGATIVE BALANCE      12060099
120700*  ACCUMULATORS.                                                  12070099
120800******************************************************************12080099
120900 2410-ACCUM-NEG-TOTALS.                                           12090099
121000                                                                  12100099
121100     ADD SV003-BALANCE        TO PV-TOT-DLR-NEG-BAL               12110099
121200                                 PV-ALL-DLR-NEG-BAL.              12120099
121300                                                                  12130099
121400     ADD +1                   TO PV-TOT-CNT-NEG-BAL               12140099
121500                                 PV-ALL-CNT-NEG-BAL.              12150099
121600                                                                  12160099
121700******************************************************************12170099
121800* 2500-PRINT-CARD-STOCK-PAGE.                                     12180099
121900*  UNLOAD TABLE 1 TO PRINT REPORT FOR THE PREVIOUS CARD STOCK.    12190099
122000******************************************************************12200099
122100 2500-PRINT-CARD-STOCK-PAGE.                                      12210099
122200     PERFORM 2600-FIND-STATE-DESCRIPTION.                         12220099
122300     PERFORM 8000-PRINT-HEADINGS.                                 12230099
122400     PERFORM 2510-PRINT-CARD-STOCK-LINES                          12240099
122500        VARYING TB1-IDX FROM +1 BY +1                             12250099
122600           UNTIL TB1-IDX > PC-MAX-MONTHS-GRPS                     12260099
122700     PERFORM 4000-PRINT-TOTAL-LINES.                              12270099
122800     MOVE PV-TOT-DLR-NEG-BAL     TO  PV-WORK-DLR-NEG-BAL.         12280099
122900     MOVE PV-TOT-CNT-NEG-BAL     TO  PV-WORK-CNT-NEG-BAL.         12290099
123000     PERFORM 5000-PRINT-CARD-STOCK-NEG-BAL.                       12300099
123100******************************************************************12310099
123200* 2510-PRINT-CARD-STOCK-LINES                                     12320099
123300*  PRINT THE DOLLAR AND COUNT DETAIL LINES FOR A DATE RANGE       12330099
123400*  ON THE REPORT PAGE FOR A CARD STOCK TYPE.                      12340099
123500******************************************************************12350099
123600 2510-PRINT-CARD-STOCK-LINES.                                     12360099
123700                                                                  12370099
123800     SET TB3-IDX TO TB1-IDX.                                      12380099
123900     MOVE TB3-REPORT-DESC(TB3-IDX) TO D1-PERIOD-DESC.             12390099
124000                                                                  12400099
124100     PERFORM                                                      12410099
124200       VARYING TB1-C-IDX FROM +1 BY +1                            12420099
124300       UNTIL TB1-C-IDX > PC-MAX-DLR-GRPS                          12430099
124400         SET D1-IDX     TO TB1-C-IDX                              12440099
124500         SET D2-IDX     TO TB1-C-IDX                              12450099
124600         SET PV-TOT-IDX TO TB1-C-IDX                              12460099
124700         ADD  TB1-DLR-COL-QTY (TB1-IDX, TB1-C-IDX)                12470099
124800                                 TO PV-TOT-COLUMN-DLR(PV-TOT-IDX) 12480099
124900         MOVE TB1-DLR-COL-QTY (TB1-IDX, TB1-C-IDX)                12490099
125000                                 TO D1-COLUMN(D1-IDX)             12500099
125100         ADD  TB1-CNT-COL-QTY (TB1-IDX, TB1-C-IDX)                12510099
125200                                 TO PV-TOT-COLUMN-CNT(PV-TOT-IDX) 12520099
125300         MOVE TB1-CNT-COL-QTY (TB1-IDX, TB1-C-IDX)                12530099
125400                                 TO D2-COLUMN(D2-IDX)             12540099
125500     END-PERFORM.                                                 12550099
125600                                                                  12560099
125700     ADD  TB1-DLR-UNREDEEMED(TB1-IDX) TO PV-TOT-DLR-UNREDEEMED.   12570099
125800     MOVE TB1-DLR-UNREDEEMED(TB1-IDX) TO D1-TOTAL-UNREDEEMED.     12580099
125900                                                                  12590099
126000     ADD  TB1-CNT-UNREDEEMED(TB1-IDX) TO PV-TOT-CNT-UNREDEEMED.   12600099
126100     MOVE TB1-CNT-UNREDEEMED(TB1-IDX) TO D2-TOTAL-UNREDEEMED.     12610099
126200                                                                  12620099
126300     MOVE D1-DETAIL-LINE-1 TO  PV-PRINT-RECORD.                   12630099
126400     IF TB1-IDX = +1                                              12640099
126500         MOVE +2           TO  PV-LINE-SPACING                    12650099
126600     ELSE                                                         12660099
126700         MOVE +1           TO  PV-LINE-SPACING                    12670099
126800     END-IF.                                                      12680099
126900     PERFORM 8200-WRITE-REPORT-LINE.                              12690099
127000                                                                  12700099
127100     MOVE D2-DETAIL-LINE-2 TO  PV-PRINT-RECORD.                   12710099
127200     MOVE +1               TO  PV-LINE-SPACING.                   12720099
127300     PERFORM 8200-WRITE-REPORT-LINE                               12730099
127400                                                                  12740099
127500     PERFORM 2520-ZERO-TABLE-1-ENTRY.                             12750099
127600                                                                  12760099
127700******************************************************************12770099
127800* 2520-ZERO-TABLE-1-ENTRY                                         12780099
127900* PREPARE TABLE FOR USE ON NEXT CARD STOCK TYPE.                  12790099
128000******************************************************************12800099
128100 2520-ZERO-TABLE-1-ENTRY.                                         12810099
128200     MOVE ZEROS TO TB1-DLR-UNREDEEMED (TB1-IDX)                   12820099
128300                   TB1-CNT-UNREDEEMED (TB1-IDX).                  12830099
128400     PERFORM                                                      12840099
128500       VARYING TB1-C-IDX FROM +1 BY +1                            12850099
128600       UNTIL TB1-C-IDX > PC-MAX-DLR-GRPS                          12860099
128700         MOVE ZEROS TO TB1-DLR-COL-QTY(TB1-IDX, TB1-C-IDX)        12870099
128800         MOVE ZEROS TO TB1-CNT-COL-QTY(TB1-IDX, TB1-C-IDX)        12880099
128900     END-PERFORM.                                                 12890099
129000******************************************************************12900099
129100* 2600-FIND-STATE-DESCRIPTION.                                    12910099
129200*  SEARCH STATES TABLE FOR A DESCRIPTION OF THE STATE REPORT.     12920099
129300******************************************************************12930099
129400 2600-FIND-STATE-DESCRIPTION.                                     12940099
129500                                                                  12950099
129600     MOVE SPACES TO H3-DESCRIPTION.                               12960099
129700     SET PS-STATE-NOT-FOUND TO TRUE.                              12970099
129800     IF PV-SAVE-ST-FEE-MONTH = SV004-SRV-FEE-INACTIVE-PRD         12980099
129900        MOVE PC-DEFAULT-FEE-STATES         TO H3-DESCRIPTION      12990099
130000     ELSE                                                         13000099
130010        IF PV-SAVE-ST-FEE-MONTH > SV004-SRV-FEE-INACTIVE-PRD      13001099
130020            MOVE PC-NON-DEFAULT-FEE-STATES TO H3-PREFIX1          13002099
130030        ELSE                                                      13003099
130100            MOVE PC-NON-FEE-STATES         TO H3-PREFIX           13010099
130110        END-IF                                                    13011099
130200        PERFORM 2610-SEARCH-STATES-TABLE                          13020099
130300        VARYING PV-STATE-SUB FROM +1 BY +1                        13030099
130400          UNTIL PS-STATE-FOUND                                    13040099
130500             OR PV-STATE-SUB > PV-MAX-STATE                       13050099
130600                                                                  13060099
130700        IF PS-STATE-FOUND                                         13070099
130800            CONTINUE                                              13080099
130900        ELSE                                                      13090099
131000            MOVE PV-SAVE-ST-CDE TO H3-STATE                       13100099
131100        END-IF                                                    13110099
131200     END-IF.                                                      13120099
131300                                                                  13130099
131400******************************************************************13140099
131500* 2610-SEARCH-STATES-TABLE.                                       13150099
131600*  FIND THE STATE DESCRIPTION FROM THE STATES TABLE.              13160099
131700******************************************************************13170099
131800 2610-SEARCH-STATES-TABLE.                                        13180099
131900     IF PV-SAVE-ST-CDE = TB5-STATE-CODE (PV-STATE-SUB)            13190099
131910         IF PV-SAVE-ST-FEE-MONTH > SV004-SRV-FEE-INACTIVE-PRD     13191099
131920             MOVE TB5-STATE-NAME (PV-STATE-SUB) TO H3-STATE1      13192099
131930         ELSE                                                     13193099
132000             MOVE TB5-STATE-NAME (PV-STATE-SUB) TO H3-STATE       13200099
132010         END-IF                                                   13201099
132100         SET PS-STATE-FOUND TO TRUE                               13210099
132200     END-IF.                                                      13220099
132300******************************************************************13230099
132400* 3000-PRINT-SUMMARY-PAGE.                                        13240099
132500*  UNLOAD TABLE 2 TO PRINT SUMMARY PAGE FOR ALL CARD STOCK TYPES. 13250099
132600******************************************************************13260099
132700 3000-PRINT-SUMMARY-PAGE.                                         13270099
132800                                                                  13280099
132900     MOVE SPACES        TO H3-DESCRIPTION.                        13290099
133000     MOVE PC-ALL-STATES TO H3-DESCRIPTION.                        13300099
133100     PERFORM 8000-PRINT-HEADINGS.                                 13310099
133200     PERFORM 3010-PRINT-SUMMARY-LINES                             13320099
133300        VARYING TB2-IDX FROM +1 BY +1                             13330099
133400           UNTIL TB2-IDX > PC-MAX-MONTHS-GRPS                     13340099
133500     PERFORM 4000-PRINT-TOTAL-LINES.                              13350099
133600     MOVE PV-ALL-DLR-NEG-BAL     TO  PV-WORK-DLR-NEG-BAL.         13360099
133700     MOVE PV-ALL-CNT-NEG-BAL     TO  PV-WORK-CNT-NEG-BAL.         13370099
133800     PERFORM 5000-PRINT-CARD-STOCK-NEG-BAL.                       13380099
133900                                                                  13390099
134000     MOVE ZERO                   TO PV-ALL-DLR-NEG-BAL            13400099
134100                                    PV-ALL-CNT-NEG-BAL.           13410099
134200******************************************************************13420099
134300* 3010-PRINT-SUMMARY-LINES                                        13430099
134400*  PRINT THE DOLLAR AND COUNT DETAIL LINES FOR A DATE RANGE       13440099
134500*  ON THE REPORT PAGE FOR ALL CARD STOCK TYPES.                   13450099
134600******************************************************************13460099
134700 3010-PRINT-SUMMARY-LINES.                                        13470099
134800                                                                  13480099
134900     SET TB3-IDX TO TB2-IDX.                                      13490099
135000     MOVE TB3-REPORT-DESC(TB3-IDX) TO D1-PERIOD-DESC.             13500099
135100                                                                  13510099
135200     PERFORM                                                      13520099
135300       VARYING TB2-C-IDX FROM +1 BY +1                            13530099
135400       UNTIL TB2-C-IDX > PC-MAX-DLR-GRPS                          13540099
135500         SET D1-IDX     TO TB2-C-IDX                              13550099
135600         SET D2-IDX     TO TB2-C-IDX                              13560099
135700         SET PV-TOT-IDX TO TB2-C-IDX                              13570099
135800         ADD  TB2-DLR-COL-QTY (TB2-IDX, TB2-C-IDX)                13580099
135900                                 TO PV-TOT-COLUMN-DLR(PV-TOT-IDX) 13590099
136000         MOVE TB2-DLR-COL-QTY (TB2-IDX, TB2-C-IDX)                13600099
136100                                 TO D1-COLUMN(D1-IDX)             13610099
136200         ADD  TB2-CNT-COL-QTY (TB2-IDX, TB2-C-IDX)                13620099
136300                                 TO PV-TOT-COLUMN-CNT(PV-TOT-IDX) 13630099
136400         MOVE TB2-CNT-COL-QTY (TB2-IDX, TB2-C-IDX)                13640099
136500                                 TO D2-COLUMN(D2-IDX)             13650099
136600     END-PERFORM.                                                 13660099
136700                                                                  13670099
136800     ADD  TB2-DLR-UNREDEEMED(TB2-IDX) TO PV-TOT-DLR-UNREDEEMED.   13680099
136900     MOVE TB2-DLR-UNREDEEMED(TB2-IDX) TO D1-TOTAL-UNREDEEMED.     13690099
137000                                                                  13700099
137100     ADD  TB2-CNT-UNREDEEMED(TB2-IDX) TO PV-TOT-CNT-UNREDEEMED.   13710099
137200     MOVE TB2-CNT-UNREDEEMED(TB2-IDX) TO D2-TOTAL-UNREDEEMED.     13720099
137300                                                                  13730099
137400     MOVE D1-DETAIL-LINE-1 TO  PV-PRINT-RECORD.                   13740099
137500     IF TB1-IDX = +1                                              13750099
137600         MOVE +2           TO  PV-LINE-SPACING                    13760099
137700     ELSE                                                         13770099
137800         MOVE +1           TO  PV-LINE-SPACING                    13780099
137900     END-IF.                                                      13790099
138000     PERFORM 8200-WRITE-REPORT-LINE.                              13800099
138100                                                                  13810099
138200     MOVE D2-DETAIL-LINE-2 TO  PV-PRINT-RECORD.                   13820099
138300     MOVE +1               TO  PV-LINE-SPACING.                   13830099
138400     PERFORM 8200-WRITE-REPORT-LINE.                              13840099
138500                                                                  13850099
138600     PERFORM 3020-ZERO-TABLE-2-ENTRY.                             13860099
138700                                                                  13870099
138800******************************************************************13880099
138900* 3020-ZERO-TABLE-2-ENTRY.                                        13890099
139000* PREPARE TABLE FOR USE ON NEXT CARD STOCK TYPE.                  13900099
139100******************************************************************13910099
139200 3020-ZERO-TABLE-2-ENTRY.                                         13920099
139300     MOVE ZEROS TO TB2-DLR-UNREDEEMED (TB2-IDX)                   13930099
139400                   TB2-CNT-UNREDEEMED (TB2-IDX).                  13940099
139500     PERFORM                                                      13950099
139600       VARYING TB2-C-IDX FROM +1 BY +1                            13960099
139700       UNTIL TB2-C-IDX > PC-MAX-DLR-GRPS                          13970099
139800         MOVE ZEROS TO TB2-DLR-COL-QTY(TB2-IDX, TB2-C-IDX)        13980099
139900         MOVE ZEROS TO TB2-CNT-COL-QTY(TB2-IDX, TB2-C-IDX)        13990099
140000     END-PERFORM.                                                 14000099
140100******************************************************************14010099
140200* 4000-PRINT-TOTAL-LINES                                          14020099
140300*  THIS PARAGRAPH WILL PRINT THE REPORT TOTAL LINES.              14030099
140400******************************************************************14040099
140500 4000-PRINT-TOTAL-LINES.                                          14050099
140600                                                                  14060099
140700     MOVE PV-TOT-DLR-UNREDEEMED  TO  T1-TOTAL-UNREDEEMED.         14070099
140800                                                                  14080099
140900     MOVE PV-TOT-CNT-UNREDEEMED  TO  T2-TOTAL-UNREDEEMED.         14090099
141000                                                                  14100099
141100     PERFORM                                                      14110099
141200       VARYING PV-TOT-IDX FROM +1 BY +1                           14120099
141300       UNTIL PV-TOT-IDX > PC-MAX-DLR-GRPS                         14130099
141400         SET T1-IDX  TO PV-TOT-IDX                                14140099
141500         SET T2-IDX TO PV-TOT-IDX                                 14150099
141600         MOVE PV-TOT-COLUMN-DLR(PV-TOT-IDX)                       14160099
141700                                 TO  T1-COLUMN(T1-IDX)            14170099
141800         MOVE PV-TOT-COLUMN-CNT(PV-TOT-IDX)                       14180099
141900                                 TO  T2-COLUMN(T2-IDX)            14190099
142000     END-PERFORM.                                                 14200099
142100                                                                  14210099
142200                                                                  14220099
142300     MOVE UL-UNDER-LINE          TO  PV-PRINT-RECORD.             14230099
142400     MOVE +1                     TO  PV-LINE-SPACING.             14240099
142500     PERFORM 8200-WRITE-REPORT-LINE.                              14250099
142600                                                                  14260099
142700     MOVE T1-TOTAL-LINE-1        TO  PV-PRINT-RECORD.             14270099
142800     MOVE +1                     TO  PV-LINE-SPACING.             14280099
142900     PERFORM 8200-WRITE-REPORT-LINE.                              14290099
143000                                                                  14300099
143100     MOVE T2-TOTAL-LINE-2        TO  PV-PRINT-RECORD.             14310099
143200     MOVE +1                     TO  PV-LINE-SPACING.             14320099
143300     PERFORM 8200-WRITE-REPORT-LINE.                              14330099
143400                                                                  14340099
143500     INITIALIZE PV-TOT-ACCUM-FIELDS.                              14350099
143600                                                                  14360099
143700******************************************************************14370099
143800* 5000-PRINT-CARD-STOCK-NEG-BAL                                   14380099
143900*  THIS PARAGRAPH WILL PRINT THE REPORT CARD STOCK NEGATIVE       14390099
144000*  BALANCE LINE.                                                  14400099
144100******************************************************************14410099
144200 5000-PRINT-CARD-STOCK-NEG-BAL.                                   14420099
144300                                                                  14430099
144400     MOVE PV-WORK-DLR-NEG-BAL    TO  T3-TOTAL-NEG-QTY.            14440099
144500     MOVE PV-WORK-CNT-NEG-BAL    TO  T4-TOTAL-NEG-QTY.            14450099
144600                                                                  14460099
144700     MOVE T3-TOTAL-LINE-3        TO  PV-PRINT-RECORD.             14470099
144800     MOVE +3                     TO  PV-LINE-SPACING.             14480099
144900     PERFORM 8200-WRITE-REPORT-LINE.                              14490099
145000                                                                  14500099
145100     MOVE T4-TOTAL-LINE-4        TO  PV-PRINT-RECORD.             14510099
145200     MOVE +1                     TO  PV-LINE-SPACING.             14520099
145300     PERFORM 8200-WRITE-REPORT-LINE.                              14530099
145400                                                                  14540099
145500     MOVE ZERO                   TO  PV-TOT-DLR-NEG-BAL           14550099
145600                                     PV-TOT-CNT-NEG-BAL.          14560099
145700                                                                  14570099
145800******************************************************************14580099
145900* 7000-READ-BALANCE-FILE                                          14590099
146000*  READ THE CARD BALANCE RECORDS.                                 14600099
146100******************************************************************14610099
146200 7000-READ-BALANCE-FILE.                                          14620099
146300                                                                  14630099
146400     READ BALANCE-FILE INTO SV003-RECORD                          14640099
146500         AT END                                                   14650099
146600           SET PS-END-OF-BALANCE-FILE TO TRUE.                    14660099
146700                                                                  14670099
146800     IF NOT PS-END-OF-BALANCE-FILE                                14680099
146900         ADD +1 TO PV-DISPLAY-BALANCE-REC-CNT                     14690099
147000     END-IF.                                                      14700099
147100                                                                  14710099
147200 EJECT                                                            14720099
147300******************************************************************14730099
147400* 8000-PRINT-HEADINGS                                             14740099
147500*  PRINT THE HEADINGS FOR THE REPORT.                             14750099
147600******************************************************************14760099
147700 8000-PRINT-HEADINGS.                                             14770099
147800                                                                  14780099
147900     ADD +1                      TO PV-PAGE-CNT.                  14790099
148000     MOVE PV-PAGE-CNT TO DP132-PAGE-NUMBER.                       14800099
148100     MOVE DP132-STANDRD-HEADER-132-COLS                           14810099
148200                                 TO PV-PRINT-RECORD.              14820099
148300     PERFORM 8100-WRITE-RPT-TOP-OF-PAGE.                          14830099
148400                                                                  14840099
148500     MOVE H2-HEADING-LINE-2      TO PV-PRINT-RECORD.              14850099
148600     MOVE +1                     TO PV-LINE-SPACING.              14860099
148700     PERFORM 8200-WRITE-REPORT-LINE.                              14870099
148800                                                                  14880099
148900     IF CC-REPORT-TYPE = PC-TOTAL-REPORT                          14890099
149000         MOVE PC-ALL-CARDS-DESC TO H3-CRD-STK-DESC                14900099
149100     ELSE                                                         14910099
149200         MOVE PV-SAVE-CRD-STK-TYP  TO H3-CRD-STK-DESC             14920099
149300     END-IF.                                                      14930099
149400                                                                  14940099
149500     MOVE H3-HEADING-LINE-3      TO PV-PRINT-RECORD.              14950099
149600     MOVE +2                     TO PV-LINE-SPACING.              14960099
149700     PERFORM 8200-WRITE-REPORT-LINE.                              14970099
149800                                                                  14980099
149900     MOVE H4-HEADING-LINE-4      TO PV-PRINT-RECORD.              14990099
150000     MOVE +1                     TO PV-LINE-SPACING.              15000099
150100     PERFORM 8200-WRITE-REPORT-LINE.                              15010099
150200                                                                  15020099
150300     MOVE H5-HEADING-LINE-5      TO PV-PRINT-RECORD.              15030099
150400     MOVE +1                     TO PV-LINE-SPACING.              15040099
150500     PERFORM 8200-WRITE-REPORT-LINE.                              15050099
150600                                                                  15060099
150700     MOVE H6-HEADING-LINE-6      TO PV-PRINT-RECORD.              15070099
150800     MOVE +1                     TO PV-LINE-SPACING.              15080099
150900     PERFORM 8200-WRITE-REPORT-LINE.                              15090099
151000                                                                  15100099
151100     MOVE H7-HEADING-LINE-7      TO PV-PRINT-RECORD.              15110099
151200     MOVE +1                     TO PV-LINE-SPACING.              15120099
151300     PERFORM 8200-WRITE-REPORT-LINE.                              15130099
151400                                                                  15140099
151500******************************************************************15150099
151600* 8100-WRITE-RPT-TOP-OF-PAGE                                      15160099
151700*  WRITE FIRST REPORT LINE AFTER PAGE BREAK.                      15170099
151800******************************************************************15180099
151900 8100-WRITE-RPT-TOP-OF-PAGE.                                      15190099
152000                                                                  15200099
152100     WRITE REVENUE-REPORT-RECORD                                  15210099
152200       FROM PV-PRINT-RECORD                                       15220099
152300         AFTER ADVANCING PAGE.                                    15230099
152400     MOVE +1             TO PV-LINE-CNT.                          15240099
152500                                                                  15250099
152600******************************************************************15260099
152700* 8200-WRITE-REPORT-LINE                                          15270099
152800*  WRITE REPORT LINE AFTER ADVANCING LINE SPACING.                15280099
152900******************************************************************15290099
153000 8200-WRITE-REPORT-LINE.                                          15300099
153100                                                                  15310099
153200     WRITE REVENUE-REPORT-RECORD                                  15320099
153300       FROM PV-PRINT-RECORD                                       15330099
153400         AFTER ADVANCING PV-LINE-SPACING.                         15340099
153500                                                                  15350099
153600     ADD PV-LINE-SPACING TO PV-LINE-CNT.                          15360099
153700******************************************************************15370099
153800* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           15380099
153900******************************************************************15390099
154000 9999-ABEND.                                                      15400099
154100     DISPLAY '** ABEND           **'.                             15410099
154200     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  15420099
154300     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        15430099
154400     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       15440099
154500     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       15450099
154600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         15460099
154700******************************************************************15470099
154800*     Z900-SQL-ABEND                                             *15480099
154900* ==> PROCESSES:                                                 *15490099
155000*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *15500099
155100******************************************************************15510099
155200 Z900-SQL-ABEND.                                                  15520099
155300                                                                  15530099
155400     DISPLAY 'Z900-SQL-ABEND'.                                    15540099
155500     DISPLAY '**  ABEND     **'.                                  15550099
155600     DISPLAY '**  PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.       15560099
155700     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             15570099
155800     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION.              15580099
155900******************************************************************15590099
156000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    15600099
156100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         15610099
156200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     15620099
156300* FORMAT.                                                         15630099
156400******************************************************************15640099
156500     COPY DPPD004.                                                15650099
156600                                                                  15660099
156700     MOVE +4013 TO AC-ABEND-CODE.                                 15670099
156800     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         15680099
156900                                                                  15690099
