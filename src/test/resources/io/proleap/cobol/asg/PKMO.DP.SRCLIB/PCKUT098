000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             PCKUT098.                                00050000
000600 AUTHOR.                 BRENDA ROCKWELL.                         00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            NOVEMBER, 2011.                          00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100*----------------------------------------------------------------*00110000
001200* THIS PROGRAM WILL READ IN A FILE OF ENROUTE AND ARRIVED        *00120000
001300* TRAILERS.  DATA WILL BE EXTRACTED FOR EACH TRAILER AND ADDED   *00130000
001400* TO THE FILE.  CURRENTLY RUN FOR EFC'S ONLY, IT WILL RETRIEVE   *00140000
001500* THE NUMBER OF CARTONS DOWNLOADED TO WMOS AND THE NUMBER OF NEW *00150000
001600* SKUS ON THE TRAILER.                                           *00160000
001700*                                                                *00170000
001800* THE INPUT AND OUTPUT FILE LAYOUTS ARE PCRD068.                 *00180000
001810* THE REPORT FILE LAYOUT IS PCRD071.                             *00181000
001900*----------------------------------------------------------------*00190000
001910***************************************************************** 00191000
001920*  CHANGE LOG.                                                    00192000
001930*  DATE         CHANGED BY      DESC                              00193000
001940*  -----------  -------------- ---------------------------------- 00194000
001950*  04/03/2012   B. ROCKWELL    ADD TOTAL SKU COUNT.               00195000
001951*                              CREATE NEW PCRD071 OUTPUT FILE.    00195100
001952*                              PROJ ID:  3347A                    00195200
001953*                              WR/IR#:   WR40796                  00195300
001954***************************************************************** 00195400
002000***************************************************************** 00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200***************************************************************** 00220000
002300 INPUT-OUTPUT SECTION.                                            00230000
002400                                                                  00240000
002500 FILE-CONTROL.                                                    00250000
002600                                                                  00260000
002700     SELECT INPUT-FILE ASSIGN TO INP01.                           00270000
002800                                                                  00280000
002900     SELECT OUTPUT-FILE ASSIGN TO OUT01.                          00290000
002901                                                                  00290100
002902     SELECT REPORT-FILE ASSIGN TO RPT01.                          00290200
003000                                                                  00300000
003100***************************************************************** 00310000
003200 DATA DIVISION.                                                   00320000
003300***************************************************************** 00330000
003400 FILE SECTION.                                                    00340000
003500 FD  INPUT-FILE                                                   00350000
003600     RECORDING MODE IS F                                          00360000
003700     LABEL RECORDS ARE STANDARD                                   00370000
003800     BLOCK CONTAINS 0 RECORDS.                                    00380000
003900 01  INPUT-RECORD                PIC X(400).                      00390000
004000                                                                  00400000
004100 FD  OUTPUT-FILE                                                  00410000
004200     RECORDING MODE IS F                                          00420000
004300     LABEL RECORDS ARE STANDARD                                   00430000
004400     BLOCK CONTAINS 0 RECORDS.                                    00440000
004500 01  OUTPUT-RECORD               PIC X(400).                      00450000
004600                                                                  00460000
004610 FD  REPORT-FILE                                                  00461000
004620     RECORDING MODE IS F                                          00462000
004630     LABEL RECORDS ARE STANDARD                                   00463000
004640     BLOCK CONTAINS 0 RECORDS.                                    00464000
004650 01  REPORT-RECORD               PIC X(200).                      00465000
004660                                                                  00466000
004700***************************************************************** 00470000
004800 WORKING-STORAGE SECTION.                                         00480000
004900                                                                  00490000
005000 01  PS-PROGRAM-SWITCHES.                                         00500000
005100     05  PS-END-OF-INPUT-FILE-SW      PIC X(01)  VALUE 'N'.       00510000
005200         88  PS-END-OF-INPUT-FILE                VALUE 'Y'.       00520000
005300         88  PS-NOT-END-OF-INPUT-FILE            VALUE 'N'.       00530000
005400     05  PS-END-CSR-SW                PIC X(1)   VALUE 'N'.       00540000
005500         88  PS-END-CSR                          VALUE 'Y'.       00550000
005600     05  PS-END-SKU-CSR-SW            PIC X(1)   VALUE 'N'.       00560000
005700         88  PS-END-SKU-CSR                      VALUE 'Y'.       00570000
005800                                                                  00580000
005900 01  PV-PROGRAM-VARIABLES.                                        00590000
006000     05  PV-READ-COUNT                PIC S9(09) VALUE ZERO       00600000
006100                                                  COMP SYNC.      00610000
006200                                                                  00620000
006300     05  PV-DISPLAY-READ-CNT          PIC ZZZ,ZZZ,ZZ9.            00630000
006400                                                                  00640000
006500     05  PV-DISPLAY-TRIP-ID           PIC Z(8)9-.                 00650000
006600     05  PV-DISPLAY-PO-NBR            PIC Z(8)9-.                 00660000
006700     05  PV-DISPLAY-PO-LNE-NBR        PIC Z(8)9-.                 00670000
006800     05  PV-DISPLAY-RCVR-SEQ-NBR      PIC 9999-.                  00680000
006900     05  PV-DISPLAY-PACK-ID           PIC Z(8)9-.                 00690000
007000     05  PV-DISPLAY-OPER-UNT-ID       PIC 9999-.                  00700000
007100                                                                  00710000
007200     05  PV-PREV-PO-NBR              PIC S9(09)    VALUE ZERO.    00720000
007300     05  PV-PREV-REC-SEQ-NBR         PIC S9(04)    VALUE ZERO.    00730000
007400     05  PV-LAST-DATE                PIC S9(07)V COMP-3.          00740000
007500     05  PV-STORE-NBR                PIC  S9(4) VALUE +0          00750000
007600                                                    COMP.         00760000
007700     05  PV-DB2-COUNT                 PIC S9(9) VALUE +0          00770000
007800                                                COMP-3.           00780000
007900     05  PV-PO-COUNT                  PIC S9(9) VALUE +0          00790000
008000                                                COMP-3.           00800000
008100     05  PV-PO-COUNT-CURR             PIC S9(9) VALUE +0          00810000
008200                                                COMP-3.           00820000
008300     05  PV-SCAN-COUNT                PIC S9(9) VALUE +0          00830000
008400                                                COMP-3.           00840000
008500     05  PV-CURR-TMST                 PIC X(26).                  00850000
008600     05  PV-CARTON-COUNT              PIC S9(9)  VALUE +0         00860000
008700                                                    COMP.         00870000
008800     05  PV-TOT-NEW-SKUS              PIC S9(9)  VALUE +0         00880000
008900                                                    COMP.         00890000
008910     05  PV-TOTAL-SKUS                PIC S9(9)  VALUE +0         00891000
008920                                                    COMP.         00892000
009000     05  PV-TOT-CARTON-COUNT          PIC S9(9)  VALUE +0         00900000
009100                                                    COMP.         00910000
009200     05  PV-TOT-CTN-CNT-LINE          PIC S9(9)  VALUE +0         00920000
009300                                                    COMP.         00930000
009400                                                                  00940000
009500     05  PV-DB2-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACES.    00950000
009600     05  PV-DB2-FUNCTION              PIC X(30)  VALUE SPACES.    00960000
009700     05  PV-DB2-TABLE-NAME1           PIC X(15)  VALUE SPACES.    00970000
009800     05  PV-DB2-TABLE-NAME2           PIC X(15)  VALUE SPACES.    00980000
009900     05  PV-DB2-TABLE-NAME3           PIC X(15)  VALUE SPACES.    00990000
010000                                                                  01000000
010100 01  PV-SAVE-FIELDS.                                              01010000
010200     05  PV-SAVE-TRIP-ID             PIC  S9(9) COMP.             01020000
010300     05  PV-SAVE-PO-NBR              PIC  S9(9) COMP.             01030000
010400     05  PV-SAVE-REC-SEQ-NBR         PIC  S9(9) COMP.             01040000
010500     05  PV-SAVE-PO-LNE-NBR          PIC  S9(9) COMP.             01050000
010600     05  PV-SAVE-MAX-PO-LNE-QTY      PIC  S9(9) COMP.             01060000
010700     05  PV-SAVE-SHPMT-ID            PIC  X(20).                  01070000
010800                                                                  01080000
010900 01  DK-DB-KEYS.                                                  01090000
011000     05  DK-TRIP-ID                  PIC  S9(9) COMP.             01100000
011100     05  DK-PO-NBR                   PIC  S9(9) COMP.             01110000
011200     05  DK-REC-SEQ-NBR              PIC  S9(9) COMP.             01120000
011210     05  DK-QUANTITY                 PIC  S9(9) COMP.             01121000
011220     05  DK-OPER-UNT-ID              PIC S9(04) COMP.             01122000
011300                                                                  01130000
011400 01 PC-PROGRAM-CONSTANTS.                                         01140000
011500     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'PCKUT098'. 01150000
011600                                                                  01160000
011700 01  PV-ABEND-FIELDS.                                             01170000
011800     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01180000
011900                                                 COMP SYNC.       01190000
012000     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'PCKUT098'.01200000
012100     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01210000
012200     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01220000
012300     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01230000
012400     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    01240000
012500     05  PV-DISPLAY-SQLCODE           PIC -9(05) VALUE ZEROES.    01250000
012600     05  PV-SQL-RETURN-CD             PIC  999-.                  01260000
012700     05  PV-ABEND-STRUCTURE-1         PIC X(15)  VALUE SPACES.    01270000
012800     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01280000
012900     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01290000
013000     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01300000
013100     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01310000
013200                                                                  01320000
013300     05  PV-MAJ-CL-NBR                PIC   X(04).                01330000
013400                                                                  01340000
013500******************************************************************01350000
013600*  USED FOR DB2 ERROR MESSAGE BUILDING                            01360000
013700******************************************************************01370000
013800     COPY DPWS004.                                                01380000
013900******************************************************************01390000
014000*    ABEND PROCESSING COPYBOOK.                                  *01400000
014100******************************************************************01410000
014200     COPY DPWS013.                                                01420000
014300******************************************************************01430000
014400*  COPYBOOK FOR WST_SHPMT_XREF_HDR                                01440000
014500******************************************************************01450000
014600     EXEC SQL                                                     01460000
014700          INCLUDE WST00001                                        01470000
014800     END-EXEC.                                                    01480000
014900******************************************************************01490000
015000*  COPYBOOK FOR WST_SHPMT_XREF_DTL                                01500000
015100******************************************************************01510000
015200     EXEC SQL                                                     01520000
015300          INCLUDE WST00002                                        01530000
015400     END-EXEC.                                                    01540000
015500******************************************************************01550000
015600*  COPYBOOK FOR WSV_LOC_XREF                                      01560000
015700******************************************************************01570000
015800     EXEC SQL                                                     01580000
015900          INCLUDE WSV00000                                        01590000
016000     END-EXEC.                                                    01600000
016100******************************************************************01610000
016200*    SKU TABLE - XLT_SKU                                          01620000
016300******************************************************************01630000
016400     EXEC SQL                                                     01640000
016500          INCLUDE XLT00003                                        01650000
016600     END-EXEC.                                                    01660000
016601******************************************************************01660100
016602*    SKU TABLE - XLT_DEPT                                         01660200
016603******************************************************************01660300
016604     EXEC SQL                                                     01660400
016605          INCLUDE XLT00002                                        01660500
016606     END-EXEC.                                                    01660600
016607******************************************************************01660700
016608*    SKU TABLE - XLT_VND_STYL                                     01660800
016609******************************************************************01660900
016610     EXEC SQL                                                     01661000
016611          INCLUDE XLT00004                                        01661100
016612     END-EXEC.                                                    01661200
016670******************************************************************01667000
016680*  COPYBOOK FOR IMT_ITM_DC_ASSN                                   01668000
016690******************************************************************01669000
016691     EXEC SQL                                                     01669100
016692          INCLUDE IMT00024                                        01669200
016693     END-EXEC.                                                    01669300
016694******************************************************************01669400
016695*  COPYBOOK FOR TWEBITM                                           01669500
016696******************************************************************01669600
016697     EXEC SQL                                                     01669700
016698          INCLUDE TWEBITM                                         01669800
016699     END-EXEC.                                                    01669900
016700******************************************************************01670000
016800*    PURCHASE ORDER LINE ITEM TABLE                               01680000
016900******************************************************************01690000
017000     EXEC SQL                                                     01700000
017100          INCLUDE TPURITM                                         01710000
017200     END-EXEC.                                                    01720000
017300******************************************************************01730000
017400*    COPYBOOK FOR TSKST                                           01740000
017500******************************************************************01750000
017600     EXEC SQL                                                     01760000
017700          INCLUDE TSKST                                           01770000
017800     END-EXEC.                                                    01780000
017900******************************************************************01790000
018000*  COPYBOOK FOR TRECEIV                                           01800000
018100******************************************************************01810000
018200     EXEC SQL                                                     01820000
018300          INCLUDE TRECEIV                                         01830000
018400     END-EXEC.                                                    01840000
018500******************************************************************01850000
018510******************************************************************01851000
018520*  COPYBOOK FOR TRECITM                                           01852000
018530******************************************************************01853000
018540     EXEC SQL                                                     01854000
018550          INCLUDE TRECITM                                         01855000
018560     END-EXEC.                                                    01856000
018570******************************************************************01857000
018600* CURSOR FOR SHIPMENT NUMBERS                                     01860000
018700******************************************************************01870000
018800     EXEC SQL                                                     01880000
018900         DECLARE SHPMT-CSR CURSOR FOR                             01890000
019000             SELECT DISTINCT PO_NBR                               01900000
019100                            ,RCVR_SEQ_NBR                         01910000
019200                            ,EXT_SHP_ID                           01920000
019300               FROM WST_SHPMT_XREF_DTL                            01930000
019400              WHERE EXT_SHP_ID IN                                 01940000
019500                    (SELECT EXT_SHP_ID                            01950000
019600                       FROM WST_SHPMT_XREF_HDR                    01960000
019700                      WHERE INTR_TRIP_ID = :DK-TRIP-ID            01970000
019800                        AND DWNLD_CDE IN ('C', 'D'))              01980000
019900                AND  DWNLD_CDE <> 'T'                             01990000
020000                AND  ACTV_CDE  = 'A'                              02000000
020100              ORDER BY EXT_SHP_ID                                 02010000
020200           WITH UR                                                02020000
020300     END-EXEC.                                                    02030000
020400******************************************************************02040000
020500*    CURSOR FOR SKU NUMBERS                                       02050000
020600******************************************************************02060000
020700     EXEC SQL                                                     02070000
020800          DECLARE SKU-CSR CURSOR FOR                              02080000
020900              SELECT  SKU_NBR                                     02090000
020910                    , STYL_ID                                     02091000
020920                    , A.PO_NBR                                    02092000
020930                    , A.PO_LNE_NBR                                02093000
020940                    , RCVR_SEQ_NBR                                02094000
020950                    , SUM(PKSL_ITM_QTY)                           02095000
020960                    , B.INNR_PACK_QTY                             02096000
020970                    , B.CASE_PACK_QTY                             02097000
020980                    , C.OUTR_PK_QTY                               02098000
021000                FROM  WST_SHPMT_XREF_DTL A                        02100000
021100                    , TRECITM B                                   02110000
021200                    , XLT_SKU C                                   02120000
021300               WHERE  A.ACTV_CDE       = 'A'                      02130000
021400                 AND  A.PO_NBR         = B.ORD_NBR                02140000
021500                 AND  B.ORD_LNE_NBR    = A.PO_LNE_NBR             02150000
021510                 AND  REC_SEQ_NBR      = RCVR_SEQ_NBR             02151000
021520                 AND  OPER_UNT_ID      = :DK-OPER-UNT-ID          02152000
021600                 AND  B.ITM_NBR        = C.ITM_NBR                02160000
021800                 AND  A.EXT_SHP_ID IN                             02180000
021900                     (SELECT EXT_SHP_ID                           02190000
022000                        FROM WST_SHPMT_XREF_HDR                   02200000
022100                       WHERE INTR_TRIP_ID = :DK-TRIP-ID)          02210000
022200               GROUP BY SKU_NBR                                   02220000
022210                      , STYL_ID                                   02221000
022220                      , A.PO_NBR                                  02222000
022230                      , A.PO_LNE_NBR                              02223000
022240                      , RCVR_SEQ_NBR                              02224000
022250                      , B.INNR_PACK_QTY                           02225000
022260                      , B.CASE_PACK_QTY                           02226000
022270                      , C.OUTR_PK_QTY                             02227000
022280               WITH UR                                            02228021
022300     END-EXEC.                                                    02230000
022400******************************************************************02240000
022500*   DB2 SQL COMMUNICATION AREA                                    02250000
022600******************************************************************02260000
022700     EXEC SQL                                                     02270000
022800          INCLUDE SQLCA                                           02280000
022900     END-EXEC.                                                    02290000
023000*                                                                 02300000
023100*DB2 AREA FOR COMMUNICATIONS AREA2                                02310000
023200     COPY SQLCA2.                                                 02320000
023300                                                                  02330000
023400***********************************************************       02340000
023500*  RECORD LAYOUT FOR THE INPUT AND OUTPUT FILES                   02350000
023600***********************************************************       02360000
023700     COPY PCRD068.                                                02370000
023710***********************************************************       02371000
023720*  RECORD LAYOUT FOR THE OUTPUT REPORT FILE                       02372000
023730***********************************************************       02373000
023740     COPY PCRD071.                                                02374000
023800                                                                  02380000
023900***********************************************************       02390000
024000 PROCEDURE DIVISION.                                              02400000
024100***********************************************************       02410000
024200     DISPLAY '***BEGINNING PCKUT098***'.                          02420000
024300                                                                  02430000
024400     PERFORM 1000-INITIALIZE.                                     02440000
024500                                                                  02450000
024600     PERFORM 2000-PROCESS-TRAILER                                 02460000
024700         UNTIL PS-END-OF-INPUT-FILE.                              02470000
024800                                                                  02480000
024900     PERFORM 9000-CLOSE-FILES.                                    02490000
025000                                                                  02500000
025100     GOBACK.                                                      02510000
025200                                                                  02520000
025300******************************************************************02530000
025400*  DO FIRST TIME PROGRAM INITIALIZE TASKS.                        02540000
025500 1000-INITIALIZE.                                                 02550000
025600******************************************************************02560000
025700     OPEN INPUT  INPUT-FILE                                       02570000
025800          OUTPUT OUTPUT-FILE                                      02580000
025810                 REPORT-FILE.                                     02581000
025900                                                                  02590000
026000     INITIALIZE PC068-RECORD-LAYOUT                               02600000
026010                PC071-RECORD-LAYOUT.                              02601000
026100                                                                  02610000
026200*FIRST READ                                                       02620000
026300     PERFORM 7000-READ-INPUT-FILE.                                02630000
026400                                                                  02640000
026500     IF PS-END-OF-INPUT-FILE                                      02650000
026600         DISPLAY '** FILE IS EMPTY **'                            02660000
026700     ELSE                                                         02670000
026800         PERFORM 8500-LOOKUP-STORE-NBR.                           02680000
026900                                                                  02690000
027000***************************************************************** 02700000
027100 2000-PROCESS-TRAILER.                                            02710000
027200***************************************************************** 02720000
027300                                                                  02730000
027400     MOVE '2000-PROCESS-TRAILER   ' TO PV-ABEND-PARAGRAPH.        02740000
027500                                                                  02750000
027600     MOVE ZEROES           TO PV-TOT-CARTON-COUNT                 02760000
027700                              PV-TOT-NEW-SKUS                     02770000
027710                              PV-TOTAL-SKUS.                      02771000
027800     MOVE PC068-TRIP-ID     TO DK-TRIP-ID.                        02780000
027810     MOVE PC068-OPER-UNT-ID TO DK-OPER-UNT-ID.                    02781000
027900                                                                  02790000
028000***  SKIP THE HANGING PACKSLIP RECORDS                            02800000
028010***  SKIP THE PROCESSED FREIGHT TRAILERS - WE CANNOT RETRIEVE     02801000
028020***       THE SKU INFORMATION FOR THESE.                          02802000
028100     IF PC068-HANG-PKSLP OR PC068-PROCESSED                       02810000
028200         MOVE ZEROES              TO PC068-NBR-CTNS-DNLD          02820000
028300     ELSE                                                         02830000
028400         PERFORM 6000-OPEN-SHIP-CSR                               02840000
028500         PERFORM 3000-RETRIEVE-SHIPMT-DATA UNTIL PS-END-CSR       02850000
028600         PERFORM 6100-CLOSE-SHIP-CSR                              02860000
028700         MOVE PV-TOT-CARTON-COUNT TO PC068-NBR-CTNS-DNLD          02870000
028900         PERFORM 6200-OPEN-SKU-CSR                                02890000
029000         PERFORM 3300-RETRIEVE-SKUS UNTIL PS-END-SKU-CSR          02900000
029100         PERFORM 6300-CLOSE-SKU-CSR                               02910000
029200         MOVE PV-TOT-NEW-SKUS     TO PC068-NEW-SKU-CNT            02920000
029210         MOVE PV-TOTAL-SKUS       TO PC068-TOT-SKU-CNT.           02921000
029300                                                                  02930000
029400     PERFORM 8000-WRITE-TO-OUTPUT-FILE.                           02940000
029500                                                                  02950000
029600     PERFORM 7000-READ-INPUT-FILE.                                02960000
029700                                                                  02970000
029800***************************************************************** 02980000
029900 3000-RETRIEVE-SHIPMT-DATA.                                       02990000
030000***************************************************************** 03000000
030100     MOVE '3000-RETRIEVE-SHIPMT-DATA'                             03010000
030200                  TO PV-ABEND-PARAGRAPH.                          03020000
030300                                                                  03030000
030400     EXEC SQL                                                     03040000
030500         FETCH SHPMT-CSR                                          03050000
030600         INTO                                                     03060000
030700             :WST00002-PO-NBR                                     03070000
030800         ,   :WST00002-RCVR-SEQ-NBR                               03080000
030900         ,   :WST00002-EXT-SHP-ID                                 03090000
031000     END-EXEC.                                                    03100000
031100                                                                  03110000
031200     EVALUATE TRUE                                                03120000
031300         WHEN SQLCODE = ZERO                                      03130000
031400             PERFORM 3200-READ-TRECEIV-TABLE                      03140000
031500         WHEN SQLCODE = +100                                      03150000
031600             SET PS-END-CSR           TO TRUE                     03160000
031700         WHEN SQLWARN0 NOT = SPACE                                03170000
031800         WHEN SQLCODE  NOT = ZERO                                 03180000
031801              MOVE WST00002-PO-NBR   TO PV-DISPLAY-PO-NBR         03180123
031803              MOVE WST00002-RCVR-SEQ-NBR                          03180323
031804                                     TO  PV-DISPLAY-RCVR-SEQ-NBR  03180423
031806             INITIALIZE PV-DB2-OPERATION-MESSAGE-1                03180624
031807             STRING PV-DISPLAY-PO-NBR '-'                         03180725
031808                    PV-DISPLAY-RCVR-SEQ-NBR  '   '                03180823
031809                    WST00002-EXT-SHP-ID                           03180926
031810                                    DELIMITED BY SIZE             03181023
031820                               INTO PV-DB2-OPERATION-MESSAGE-1    03182023
031900             MOVE '3000-RETRIEVE-SHPMT'  TO PV-ABEND-PARAGRAPH    03190000
032000             MOVE 'FETCH CURSOR'         TO PV-ABEND-OPERATION    03200000
032100             MOVE 'WST_SHPMT_XREF_DTL'   TO PV-ABEND-STRUCTURE-1  03210000
032200             PERFORM 9900-DB2-ABEND                               03220000
032300     END-EVALUATE.                                                03230000
032400                                                                  03240000
032500***************************************************************** 03250000
032600 3200-READ-TRECEIV-TABLE.                                         03260000
032700***************************************************************** 03270000
032800                                                                  03280000
032900     EXEC SQL                                                     03290000
033000         SELECT SUM(EXPTED_CART_CNT)                              03300000
033100           INTO :PV-CARTON-COUNT                                  03310000
033200           FROM TRECEIV                                           03320000
033300          WHERE ORD_NBR     = :WST00002-PO-NBR                    03330000
033400            AND REC_SEQ_NBR = :WST00002-RCVR-SEQ-NBR              03340000
033410           WITH UR                                                03341022
033500     END-EXEC.                                                    03350000
033600                                                                  03360000
033700     EVALUATE TRUE                                                03370000
033800         WHEN SQLCODE = ZERO                                      03380000
033900           ADD PV-CARTON-COUNT TO PV-TOT-CARTON-COUNT             03390000
034000         WHEN SQLCODE = +100                                      03400000
034010         WHEN SQLCODE = -305                                      03401028
034100           CONTINUE                                               03410000
034200         WHEN OTHER                                               03420000
034210              MOVE WST00002-PO-NBR   TO PV-DISPLAY-PO-NBR         03421027
034220              MOVE WST00002-RCVR-SEQ-NBR                          03422027
034230                                     TO  PV-DISPLAY-RCVR-SEQ-NBR  03423027
034240             INITIALIZE PV-DB2-OPERATION-MESSAGE-1                03424027
034250             STRING PV-DISPLAY-PO-NBR '-'                         03425027
034260                    PV-DISPLAY-RCVR-SEQ-NBR  '   '                03426027
034270                    WST00002-EXT-SHP-ID                           03427027
034280                                    DELIMITED BY SIZE             03428027
034290                               INTO PV-DB2-OPERATION-MESSAGE-1    03429027
034300           MOVE '3200-READ-TRECEIV' TO PV-ABEND-PARAGRAPH         03430000
034400           MOVE 'SELECT'            TO PV-ABEND-OPERATION         03440000
034500           MOVE 'TRECEIV'           TO PV-ABEND-STRUCTURE-1       03450000
034600           PERFORM 9900-DB2-ABEND                                 03460000
034700     END-EVALUATE.                                                03470000
034800                                                                  03480000
034900***************************************************************** 03490000
035000 3300-RETRIEVE-SKUS.                                              03500000
035100***************************************************************** 03510000
035200     MOVE '3300-RETRIEVE-SKUS' TO PV-ABEND-PARAGRAPH.             03520000
035300                                                                  03530000
035400     PERFORM 3400-FETCH-SKU-CSR.                                  03540000
035500                                                                  03550000
035600                                                                  03560000
035700***************************************************************** 03570000
035800 3400-FETCH-SKU-CSR.                                              03580000
035900***************************************************************** 03590000
036000                                                                  03600000
036100     EXEC SQL                                                     03610000
036200         FETCH SKU-CSR                                            03620000
036300         INTO                                                     03630000
036400             :XLT00003-SKU-NBR                                    03640000
036410          ,  :XLT00003-STYL-ID                                    03641000
036420          ,  :WST00002-PO-NBR                                     03642000
036430          ,  :WST00002-PO-LNE-NBR                                 03643000
036440          ,  :WST00002-RCVR-SEQ-NBR                               03644000
036450          ,  :DK-QUANTITY                                         03645000
036460          ,  :RECITM-INNR-PACK-QTY                                03646000
036470          ,  :RECITM-CASE-PACK-QTY                                03647000
036480          ,  :XLT00003-OUTR-PK-QTY                                03648000
036500     END-EXEC.                                                    03650000
036600                                                                  03660000
036700     EVALUATE TRUE                                                03670000
036800         WHEN SQLCODE = ZERO                                      03680000
036801             ADD 1 TO PV-TOTAL-SKUS                               03680100
036900             PERFORM 3500-PROCESS-SKU                             03690000
037000         WHEN SQLCODE = +100                                      03700000
037100             SET PS-END-SKU-CSR          TO TRUE                  03710000
037200         WHEN SQLWARN0 NOT = SPACE                                03720000
037300         WHEN SQLCODE  NOT = ZERO                                 03730000
037400             MOVE '3400-FETCH-SKU-CSR'   TO PV-ABEND-PARAGRAPH    03740000
037500             MOVE 'FETCH CURSOR'         TO PV-ABEND-OPERATION    03750000
037600             MOVE 'WST_SHPMT_XREF_DTL'   TO PV-ABEND-STRUCTURE-1  03760000
037700             PERFORM 9900-DB2-ABEND                               03770000
037800     END-EVALUATE.                                                03780000
037900                                                                  03790000
038000***************************************************************** 03800000
038100 3500-PROCESS-SKU.                                                03810000
038200***************************************************************** 03820000
038300     MOVE '3500-PROCESS-SKU'   TO PV-ABEND-PARAGRAPH.             03830000
038400                                                                  03840000
038500     EXEC SQL                                                     03850000
038600          SELECT  LAST_RCVD_DATE                                  03860000
038700            INTO :PV-LAST-DATE                                    03870000
038800            FROM  TSKST A                                         03880000
038900                , XLT_SKU B                                       03890000
039000           WHERE  A.ITEM_NMBR   = B.ITM_NBR                       03900000
039100             AND  LOC_NBR       = :PV-STORE-NBR                   03910000
039200             AND  SKU_NBR       = :XLT00003-SKU-NBR               03920000
039210           WITH UR                                                03921000
039300     END-EXEC.                                                    03930000
039400                                                                  03940000
039500     EVALUATE TRUE                                                03950000
039600         WHEN SQLCODE = ZERO                                      03960000
039700           IF PV-LAST-DATE = ZERO                                 03970000
039800               ADD 1 TO PV-TOT-NEW-SKUS                           03980000
039900           END-IF                                                 03990000
040000         WHEN SQLCODE = +100                                      04000000
040100           ADD 1 TO PV-TOT-NEW-SKUS                               04010000
040110           PERFORM 5000-WRITE-REPORT-RECORD                       04011000
040200         WHEN OTHER                                               04020000
040300           MOVE '3500-PROCESS-SKU'  TO PV-ABEND-PARAGRAPH         04030000
040400           MOVE 'SELECT'            TO PV-ABEND-OPERATION         04040000
040500           MOVE 'TSKST'             TO PV-ABEND-STRUCTURE-1       04050000
040600           PERFORM 9900-DB2-ABEND                                 04060000
040700     END-EVALUATE.                                                04070000
040810***************************************************************** 04081000
040820 5000-WRITE-REPORT-RECORD.                                        04082000
040830***************************************************************** 04083000
040840     MOVE PC068-OPER-UNT-ID     TO PC071-OPER-UNT-ID.             04084000
040841     MOVE PC068-TRIP-ID         TO PC071-TRIP-ID.                 04084100
040850     MOVE PC068-SCAC            TO PC071-SCAC.                    04085000
040860     MOVE PC068-TRLR-NBR        TO PC071-TRLR-NBR.                04086000
040861     MOVE PC068-ARRIVAL-DATE    TO PC071-ARRIVAL-DATE.            04086100
040870     MOVE PC068-TRLR-LOC        TO PC071-TRLR-LOC.                04087000
040880     MOVE WST00002-PO-NBR       TO PC071-PO-NBR.                  04088000
040890     MOVE WST00002-PO-LNE-NBR   TO PC071-PO-LNE-NBR.              04089000
040891     MOVE WST00002-RCVR-SEQ-NBR TO PC071-REC-SEQ-NBR.             04089100
040893     MOVE XLT00003-SKU-NBR      TO PC071-SKU-NBR.                 04089300
040894     MOVE DK-QUANTITY           TO PC071-SKU-QTY.                 04089400
040895     MOVE RECITM-INNR-PACK-QTY  TO PC071-INPK-QTY.                04089500
040896                                                                  04089600
040897     IF RECITM-CASE-PACK-QTY > 0                                  04089700
040898        MOVE RECITM-CASE-PACK-QTY  TO PC071-OTPK-QTY              04089800
040899     ELSE                                                         04089900
040900        MOVE XLT00003-OUTR-PK-QTY  TO PC071-OTPK-QTY              04090000
040901     END-IF.                                                      04090100
040902                                                                  04090200
040903     PERFORM 5500-GET-ATTRIBUTES.                                 04090300
040904                                                                  04090400
040905     WRITE REPORT-RECORD FROM PC071-RECORD-LAYOUT.                04090500
040906                                                                  04090600
040907     INITIALIZE PC071-RECORD-LAYOUT.                              04090700
040908***************************************************************** 04090800
040909 5500-GET-ATTRIBUTES.                                             04090900
040910***************************************************************** 04091000
040911     MOVE '5500-GET-ATTRIBUTES' TO PV-ABEND-PARAGRAPH.            04091100
040912                                                                  04091200
040913     EXEC SQL                                                     04091300
040914          SELECT SHIP_WD_QTY                                      04091400
040915                ,SHIP_DPTH_QTY                                    04091500
040916                ,SHIP_HT_QTY                                      04091600
040917                ,SHIP_WT_QTY                                      04091700
040918                ,HAZDS_IND                                        04091800
040919                ,BRKBL_IND                                        04091900
040920                ,SHIP_ALN_IND                                     04092000
040921                ,SKU_DESC                                         04092100
040922                ,A.INTR_UPC_ID                                    04092200
040923            INTO :WEBITM-SHIP-WD-QTY                              04092300
040924               , :WEBITM-SHIP-DPTH-QTY                            04092400
040925               , :WEBITM-SHIP-HT-QTY                              04092500
040926               , :WEBITM-SHIP-WT-QTY                              04092600
040927               , :WEBITM-HAZDS-IND                                04092700
040928               , :WEBITM-BRKBL-IND                                04092800
040929               , :WEBITM-SHIP-ALN-IND                             04092900
040930               , :XLT00003-SKU-DESC                               04093000
040931               , :XLT00003-INTR-UPC-ID                            04093100
040932          FROM TWEBITM A,                                         04093200
040933               XLT_SKU B                                          04093300
040934          WHERE A.INTR_UPC_ID = B.INTR_UPC_ID                     04093400
040935            AND SKU_NBR       = :XLT00003-SKU-NBR                 04093500
040936            AND EFF_END_TMST  IS NULL                             04093600
040937           WITH UR                                                04093700
040938     END-EXEC.                                                    04093800
040939                                                                  04093900
040940     EVALUATE TRUE                                                04094000
040941         WHEN SQLCODE = ZERO                                      04094100
040942           MOVE XLT00003-SKU-DESC     TO PC071-SKU-DESC           04094200
040943           MOVE WEBITM-SHIP-WD-QTY    TO PC071-SKU-WIDTH          04094300
040944           MOVE WEBITM-SHIP-DPTH-QTY  TO PC071-SKU-LENGTH         04094400
040945           MOVE WEBITM-SHIP-HT-QTY    TO PC071-SKU-HEIGHT         04094500
040946           MOVE WEBITM-SHIP-WT-QTY    TO PC071-SKU-WEIGHT         04094600
040947           MOVE WEBITM-SHIP-ALN-IND   TO PC071-SHIPALONE-IND      04094700
040948           MOVE WEBITM-HAZDS-IND      TO PC071-HAZ-IND            04094800
040949           MOVE WEBITM-BRKBL-IND      TO PC071-BRKBL-IND          04094900
040950*    IF THE SKU IS NOT IN TWEBITM WE STILL NEED TO GET THE DESC   04095000
040951         WHEN SQLCODE = +100                                      04095100
040952             PERFORM 5600-GET-SKU-DESC                            04095200
040953     END-EVALUATE.                                                04095300
040954                                                                  04095400
040955     EXEC SQL                                                     04095500
040956          SELECT B.DEPT_NBR                                       04095600
040957               , DEPT_NM                                          04095700
040958            INTO :XLT00002-DEPT-NBR                               04095800
040959               , :XLT00002-DEPT-NM                                04095900
040960            FROM XLT_VND_STYL A                                   04096000
040961               , XLT_DEPT B                                       04096100
040962          WHERE A.STYL_ID  = :XLT00003-STYL-ID                    04096200
040963            AND A.DEPT_NBR = B.DEPT_NBR                           04096300
040964           WITH UR                                                04096400
040965     END-EXEC.                                                    04096500
040966                                                                  04096600
040967     EVALUATE TRUE                                                04096700
040968         WHEN SQLCODE = ZERO                                      04096800
040969           MOVE XLT00002-DEPT-NBR     TO PC071-DEPT-NBR           04096900
040970           MOVE XLT00002-DEPT-NM      TO PC071-DEPT-NAME          04097000
040971     END-EVALUATE.                                                04097100
040972                                                                  04097200
040973     EXEC SQL                                                     04097300
040974         SELECT AUTO_SORT_CDE                                     04097400
040975           INTO :IMT00024-AUTO-SORT-CDE                           04097500
040976           FROM IMT_ITM_DC_ASSN                                   04097600
040977          WHERE INTR_UPC_ID  = :XLT00003-INTR-UPC-ID              04097700
040978            AND DC_NBR       = :PC068-OPER-UNT-ID                 04097800
040979            AND EFF_END_TMST IS NULL                              04097900
040980           WITH UR                                                04098000
040981     END-EXEC.                                                    04098100
040982                                                                  04098200
040983     EVALUATE TRUE                                                04098300
040984         WHEN SQLCODE = ZERO                                      04098400
040985           MOVE IMT00024-AUTO-SORT-CDE TO PC071-SORT-NONSORT      04098500
040986     END-EVALUATE.                                                04098600
040987***************************************************************** 04098700
040988 5600-GET-SKU-DESC.                                               04098800
040989***************************************************************** 04098900
040990     MOVE '5600-GET-SKU-DESC' TO PV-ABEND-PARAGRAPH.              04099000
040991                                                                  04099100
040992     EXEC SQL                                                     04099200
040993          SELECT SKU_DESC                                         04099300
040994            INTO :XLT00003-SKU-DESC                               04099400
041002          FROM XLT_SKU                                            04100200
041004          WHERE SKU_NBR = :XLT00003-SKU-NBR                       04100400
041005           WITH UR                                                04100500
041007     END-EXEC.                                                    04100700
041008                                                                  04100800
041009     EVALUATE TRUE                                                04100900
041010         WHEN SQLCODE = ZERO                                      04101000
041011           MOVE XLT00003-SKU-DESC     TO PC071-SKU-DESC           04101100
041022     END-EVALUATE.                                                04102200
041023                                                                  04102300
041054***************************************************************** 04105400
041060 6000-OPEN-SHIP-CSR.                                              04106000
041100***************************************************************** 04110000
041200                                                                  04120000
041300     MOVE 'N' TO PS-END-CSR-SW.                                   04130000
041400                                                                  04140000
041500     EXEC SQL                                                     04150000
041600         OPEN SHPMT-CSR                                           04160000
041700     END-EXEC.                                                    04170000
041800                                                                  04180000
041900     EVALUATE TRUE                                                04190000
042000         WHEN SQLCODE = ZERO                                      04200000
042100             CONTINUE                                             04210000
042200         WHEN SQLWARN0 NOT = SPACE                                04220000
042300         WHEN SQLCODE  NOT = ZERO                                 04230000
042400             MOVE '6000-OPEN-SHIP-CSR'  TO PV-ABEND-PARAGRAPH     04240000
042500             MOVE 'OPEN CURSOR'         TO PV-ABEND-OPERATION     04250000
042600             MOVE 'WST_SHPMT_XREF_DTL'  TO PV-ABEND-STRUCTURE-1   04260000
042700             PERFORM 9900-DB2-ABEND                               04270000
042800     END-EVALUATE.                                                04280000
042900                                                                  04290000
043000***************************************************************** 04300000
043100 6100-CLOSE-SHIP-CSR.                                             04310000
043200***************************************************************** 04320000
043300                                                                  04330000
043400     EXEC SQL                                                     04340000
043500         CLOSE SHPMT-CSR                                          04350000
043600     END-EXEC.                                                    04360000
043700                                                                  04370000
043800     EVALUATE TRUE                                                04380000
043900         WHEN SQLCODE = ZERO                                      04390000
044000             CONTINUE                                             04400000
044100         WHEN SQLWARN0 NOT = SPACE                                04410000
044200         WHEN SQLCODE  NOT = ZERO                                 04420000
044300             MOVE '6100-CLOSE-SHIP-CSR'  TO PV-ABEND-PARAGRAPH    04430000
044400             MOVE 'CLOSE CURSOR'         TO PV-ABEND-OPERATION    04440000
044500             MOVE 'WST_SHPMT_XREF_DTL'   TO PV-ABEND-STRUCTURE-1  04450000
044600             PERFORM 9900-DB2-ABEND                               04460000
044700     END-EVALUATE.                                                04470000
044800                                                                  04480000
044900***************************************************************** 04490000
045000 6200-OPEN-SKU-CSR.                                               04500000
045100***************************************************************** 04510000
045200                                                                  04520000
045300     MOVE 'N' TO PS-END-SKU-CSR-SW.                               04530000
045400                                                                  04540000
045500     EXEC SQL                                                     04550000
045600         OPEN SKU-CSR                                             04560000
045700     END-EXEC.                                                    04570000
045800                                                                  04580000
045900     EVALUATE TRUE                                                04590000
046000         WHEN SQLCODE = ZERO                                      04600000
046100             CONTINUE                                             04610000
046200         WHEN SQLWARN0 NOT = SPACE                                04620000
046300         WHEN SQLCODE  NOT = ZERO                                 04630000
046400             MOVE '6200-OPEN-SKU-CSR'   TO PV-ABEND-PARAGRAPH     04640000
046500             MOVE 'OPEN CURSOR'         TO PV-ABEND-OPERATION     04650000
046600             MOVE 'WST_SHPMT_XREF_DTL'  TO PV-ABEND-STRUCTURE-1   04660000
046700             PERFORM 9900-DB2-ABEND                               04670000
046800     END-EVALUATE.                                                04680000
046900                                                                  04690000
047000***************************************************************** 04700000
047100 6300-CLOSE-SKU-CSR.                                              04710000
047200***************************************************************** 04720000
047300                                                                  04730000
047400     EXEC SQL                                                     04740000
047500         CLOSE SKU-CSR                                            04750000
047600     END-EXEC.                                                    04760000
047700                                                                  04770000
047800     EVALUATE TRUE                                                04780000
047900         WHEN SQLCODE = ZERO                                      04790000
048000             CONTINUE                                             04800000
048100         WHEN SQLWARN0 NOT = SPACE                                04810000
048200         WHEN SQLCODE  NOT = ZERO                                 04820000
048300             MOVE '6300-CLOSE-SKU-CSR'   TO PV-ABEND-PARAGRAPH    04830000
048400             MOVE 'CLOSE CURSOR'         TO PV-ABEND-OPERATION    04840000
048500             MOVE 'WST_SHPMT_XREF_DTL'   TO PV-ABEND-STRUCTURE-1  04850000
048600             PERFORM 9900-DB2-ABEND                               04860000
048700     END-EVALUATE.                                                04870000
048800                                                                  04880000
048900***************************************************************** 04890000
049000***************************************************************** 04900000
049100                                                                  04910000
049200 7000-READ-INPUT-FILE.                                            04920000
049300      READ INPUT-FILE INTO PC068-RECORD-LAYOUT                    04930000
049400        AT END                                                    04940000
049500           SET PS-END-OF-INPUT-FILE TO TRUE                       04950000
049600        NOT AT END                                                04960000
049700           ADD +1 TO PV-READ-COUNT                                04970000
049800      END-READ.                                                   04980000
049900***************************************************************** 04990000
050000 8000-WRITE-TO-OUTPUT-FILE.                                       05000000
050100***************************************************************** 05010000
050200     WRITE OUTPUT-RECORD                                          05020000
050300       FROM PC068-RECORD-LAYOUT.                                  05030000
050400                                                                  05040000
050500***************************************************************** 05050000
050600 8500-LOOKUP-STORE-NBR.                                           05060000
050700***************************************************************** 05070000
050800     EXEC SQL                                                     05080000
050900          SELECT  INTEGER(SUBSTR(WMOS_LOC_NBR,1,4))               05090000
051000            INTO :PV-STORE-NBR                                    05100000
051100            FROM  WSV_LOC_XREF                                    05110000
051200           WHERE  KOHLS_LOC_NBR = :PC068-OPER-UNT-ID              05120000
051210          WITH UR                                                 05121022
051300     END-EXEC.                                                    05130000
051400                                                                  05140000
051500     EVALUATE TRUE                                                05150000
051600         WHEN SQLCODE = ZERO                                      05160000
051700           CONTINUE                                               05170000
051800         WHEN SQLCODE = +100                                      05180000
051900           MOVE PC068-OPER-UNT-ID   TO PV-STORE-NBR               05190000
052000         WHEN OTHER                                               05200000
052100           MOVE '8500-LOOKUP-STORE' TO PV-ABEND-PARAGRAPH         05210000
052200           MOVE 'SELECT'            TO PV-ABEND-OPERATION         05220000
052300           MOVE 'WSV-LOC-XREF'      TO PV-ABEND-STRUCTURE-1       05230000
052400           PERFORM 9900-DB2-ABEND                                 05240000
052500     END-EVALUATE.                                                05250000
052600                                                                  05260000
052710***************************************************************** 05271000
052800 9000-CLOSE-FILES.                                                05280000
052900                                                                  05290000
053000     DISPLAY ' '.                                                 05300000
053100     DISPLAY '**************************************************'.05310000
053200     DISPLAY 'PROGRAM.................'   PC-PROGRAM-NAME.        05320000
053300     DISPLAY ' '.                                                 05330000
053400     MOVE PV-READ-COUNT              TO PV-DISPLAY-READ-CNT.      05340000
053500     DISPLAY 'TOT RECS READ       : '   PV-DISPLAY-READ-CNT.      05350000
053600     DISPLAY ' '.                                                 05360000
053700     DISPLAY 'RETURN CODE        = ' RETURN-CODE                  05370000
053800                                                                  05380000
053900                                                                  05390000
054000     CLOSE INPUT-FILE                                             05400000
054100           OUTPUT-FILE                                            05410000
054110           REPORT-FILE.                                           05411000
054200                                                                  05420000
054300 9900-DB2-ABEND.                                                  05430000
054400                                                                  05440000
054500     MOVE SQLCODE TO PV-DISPLAY-SQLCODE.                          05450000
054600     DISPLAY '*** DB2 ERROR '.                                    05460000
054700     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               05470000
054800     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 05480000
054900     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               05490000
055000     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               05500000
055100     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       05510000
055200     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       05520000
055300     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       05530000
055400     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             05540000
055500                                                                  05550000
055600     COPY DPPD004.                                                05560000
055700                                                                  05570000
055800     MOVE +4013                  TO PV-ABEND-CODE.                05580000
055900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05590000
056000                                                                  05600000
