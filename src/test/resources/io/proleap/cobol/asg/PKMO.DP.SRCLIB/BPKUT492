000100******************************************************************00010000
000200******************************************************************00020000
000300 IDENTIFICATION DIVISION.                                         00030000
000400******************************************************************00040000
000500******************************************************************00050000
000600                                                                  00060000
000700 PROGRAM-ID.     BPKUT492.                                        00070001
000800 AUTHOR.         COGNIZANT.                                       00080001
000900 INSTALLATION.   KOHLS DEPARTMENT STORES.                         00090000
001000 DATE-WRITTEN.   04/30/2010.                                      00100001
001100 DATE-COMPILED.                                                   00110000
001200                                                                  00120000
001300******************************************************************00130000
001400*                                                                 00140000
001500*                  COMP & NEW SLS AND EOP EXTRACT                 00150000
001600*                                                                 00160000
001700******************************************************************00170000
001800                                                                  00180000
001900******************************************************************00190000
002000*  CHANGES:                                                       00200000
002100*                                                                 00210000
002200*  04/30/2010    COGNIZANT    WR# 2344                            00359002
002300*     -  CHANGED THE PROGRAM FOR EP UPGRADE PROCESS.              00359202
002400*        PICKUP THE SALES RETAIL AMOUNTS FOR ACTUAL SALES &       00359302
002500*        ACTUAL SALES LY STAGING TABLES.POPULATE THE DATA BASED   00359302
002600*        ON THE NEW COPYBOOK BPRD150.                             00359402
002700*                                                                         
002800*  12/14/2011     COGNIZANT    CRQ# 16360                                 
002900*     -  MODIFY EXTRACT DATE LOGIC TO HAVE THE MONTH BEGIN DATE           
003000*        AS START DATE AND LAST WEEKEND DATE AS END DATE.                 
11752A*                                                                         
11752A*  06/09/2017     J SELWITSCHKA                                           
11752A*     -  CHANGES FOR EP UPGRADE.                                          
11752A*        MODIFY EXTRACT DATE LOGIC TO HAVE THE WEEK BEGIN DATE            
11752A*        AS START DATE INSTEAD OF THE MONTH BEGIN DATE.                   
11752A*                                                                         
11752A*  06/22/2017     J SELWITSCHKA                                           
11752A*     - NEW VERSION BPKUT492 IS A COPY OF BPKUT491 WITH EP                
11752A*       UPGRADE CHANGES. CREATED BECAUSE EP UPGRADE VERSION               
11752A*       WILL BE RUNNING IN PARALLEL WITH OLD VERSION.                     
11752A*                                                                         
003100******************************************************************00360000
003200                                                                  00370000
003300******************************************************************00380000
003400******************************************************************00390000
003500 ENVIRONMENT DIVISION.                                            00400000
003600******************************************************************00410000
003700******************************************************************00420000
003800                                                                  00430000
003900******************************************************************00440000
004000 CONFIGURATION SECTION.                                           00450000
004100******************************************************************00460000
004200                                                                  00470000
004300 SOURCE-COMPUTER.        IBM-3090.                                00480000
004400 OBJECT-COMPUTER.        IBM-3090.                                00490000
004500                                                                  00500000
004600******************************************************************00510000
004700 INPUT-OUTPUT SECTION.                                            00520000
004800******************************************************************00530000
004900                                                                  00540000
005000 FILE-CONTROL.                                                    00550000
005100                                                                  00560000
005200     SELECT CONTROL-CARD-FILE                                     00570000
005300         ASSIGN TO INP01.                                         00580000
005400                                                                  00590000
005500     SELECT COMP-FILE                                             00600000
005600         ASSIGN TO OUT01.                                         00610000
005700                                                                  00620000
005800     SELECT LY-FILE                                               00621004
005900         ASSIGN TO OUT02.                                         00622004
006000                                                                  00623004
006100******************************************************************00630000
006200******************************************************************00640000
006300 DATA DIVISION.                                                   00650000
006400******************************************************************00660000
006500******************************************************************00670000
006600                                                                  00680000
006700******************************************************************00690000
006800 FILE SECTION.                                                    00700000
006900******************************************************************00710000
007000                                                                  00720000
007100 FD  CONTROL-CARD-FILE                                            00730000
007200     RECORDING MODE IS F                                          00740000
007300     LABEL RECORDS ARE STANDARD                                   00750000
007400     BLOCK CONTAINS 0 RECORDS.                                    00760000
007500                                                                  00770000
007600 01  CONTROL-CARD-RECORD              PIC X(80).                  00780000
007700                                                                  00790000
007800 FD  COMP-FILE                                                    00800000
007900     RECORDING MODE IS F                                          00810000
008000     LABEL RECORDS ARE STANDARD                                   00820000
008100     BLOCK CONTAINS 0 RECORDS.                                    00830000
008200                                                                  00840000
008300 01  COMPNEW-OUT-RECORD                 PIC X(700).               00850010
008400                                                                  00860000
008500 FD  LY-FILE                                                      00861004
008600     RECORDING MODE IS F                                          00862004
008700     LABEL RECORDS ARE STANDARD                                   00863004
008800     BLOCK CONTAINS 0 RECORDS.                                    00864004
008900                                                                  00865004
009000 01  LY-OUT-RECORD                      PIC X(700).               00866004
009100                                                                  00867004
009200                                                                  00870000
009300******************************************************************00880000
009400 WORKING-STORAGE SECTION.                                         00890000
009500******************************************************************00900000
009600                                                                  00910000
009700 01  PS-PROGRAM-SWITCHES.                                         00920000
009800     05  PS-END-OF-CONTROL-CARDS-SW    PIC X     VALUE 'N'.       00930000
009900         88  PS-END-OF-CONTROL-CARDS             VALUE 'Y'.       00940000
010000                                                                  00950000
010100     05  PS-MULTIPLE-MONTHS-SW         PIC X     VALUE 'N'.       00960000
010200         88  PS-MULTIPLE-MONTHS                  VALUE 'Y'.       00970000
010300                                                                  00980000
010400     05  PS-END-OF-MTD1-COMP-CURSOR-SW PIC X     VALUE 'N'.       00990000
010500         88  PS-END-OF-MTD1-COMP-CURSOR          VALUE 'Y'.       01000000
010600         88  PS-NOT-END-OF-MTD1-COMP-CURSOR      VALUE 'N'.       01010000
010700                                                                  01020000
010800     05  PS-END-OF-MTD2-COMP-CURSOR-SW PIC X     VALUE 'N'.       01030000
010900         88  PS-END-OF-MTD2-COMP-CURSOR          VALUE 'Y'.       01040000
011000         88  PS-NOT-END-OF-MTD2-COMP-CURSOR      VALUE 'N'.       01050000
011100                                                                  01060000
011200     05  PS-END-OF-MTD1-NEW-CURSOR-SW  PIC X     VALUE 'N'.       01070000
011300         88  PS-END-OF-MTD1-NEW-CURSOR           VALUE 'Y'.       01080000
011400         88  PS-NOT-END-OF-MTD1-NEW-CURSOR       VALUE 'N'.       01090000
011500                                                                  01100000
011600     05  PS-END-OF-MTD2-NEW-CURSOR-SW  PIC X     VALUE 'N'.       01110000
011700         88  PS-END-OF-MTD2-NEW-CURSOR           VALUE 'Y'.       01120000
011800         88  PS-NOT-END-OF-MTD2-NEW-CURSOR       VALUE 'N'.       01130000
011900                                                                  01140000
012000     05  PS-END-OF-LY1-COMP-CURSOR-SW  PIC X     VALUE 'N'.       01150000
012100         88  PS-END-OF-LY1-COMP-CURSOR           VALUE 'Y'.       01160000
012200         88  PS-NOT-END-OF-LY1-COMP-CURSOR       VALUE 'N'.       01170000
012300                                                                  01180000
012400     05  PS-END-OF-LY2-COMP-CURSOR-SW  PIC X     VALUE 'N'.       01190000
012500         88  PS-END-OF-LY2-COMP-CURSOR           VALUE 'Y'.       01200000
012600         88  PS-NOT-END-OF-LY2-COMP-CURSOR       VALUE 'N'.       01210000
012700                                                                  01220000
012800     05  PS-E-BUS-IND                  PIC X     VALUE 'N'.       01310000
012900         88  PS-E-BUS                            VALUE 'Y'.       01320000
013000         88  PS-NOT-E-BUS                        VALUE 'N'.       01330000
013100                                                                  01340000
013200     05  PS-SLS-DLR-IND                PIC X(03) VALUE SPACES.    01341004
013300         88  PS-C1-SLS-DLR                       VALUE 'C1 '.     01342004
013400         88  PS-C2-SLS-DLR                       VALUE 'C2 '.     01343004
013500         88  PS-N1-SLS-DLR                       VALUE 'N1 '.     01343104
013600         88  PS-N2-SLS-DLR                       VALUE 'N2 '.     01343204
013700         88  PS-LC1-SLS-DLR                      VALUE 'LC1'.     01343304
013800         88  PS-LC2-SLS-DLR                      VALUE 'LC2'.     01343404
013900         88  PS-LN1-SLS-DLR                      VALUE 'LN1'.     01343504
014000         88  PS-LN2-SLS-DLR                      VALUE 'LN2'.     01343604
014100                                                                  01344002
014200                                                                  01350000
014300 01  PC-PROGRAM-CONSTANTS.                                        01360000
014400     05  PC-PHYSSTR                   PIC X(07)  VALUE 'PHYSSTR'. 01370000
014500     05  PC-VIRTSTR                   PIC X(07)  VALUE 'VIRTSTR'. 01380000
014600                                                                  01510000
014700 01  PV-PROGRAM-VARIABLES.                                        01520000
014800     05  PV-EXTRACT-START-DATE        PIC X(10).                  01530000
014900     05  PV-EXTRACT-END-DATE          PIC X(10).                  01540000
015000     05  PV-SEASON                    PIC X(01).                  01550000
015100     05  PV-YEAR                      PIC X(04).                  01560000
015200     05  PV-CHANNEL                   PIC X(07).                  01600000
015300                                                                  01610000
015400     05  PV-MTH1-START-DTE            PIC X(10).                  01620000
015500     05  PV-MTH1-END-DTE              PIC X(10).                  01630000
015600     05  PV-MTH1-COMP-DTE             PIC X(10).                  01640000
015700     05  PV-MTH1-NEW-DTE              PIC X(10).                  01650000
015800     05  PV-MTH1-SEAS-BEG-DTE         PIC X(10).                  01660000
015900     05  PV-MTH1-SEASON               PIC X(01).                  01670000
016000     05  PV-MTH1-YEAR                 PIC X(04).                  01680000
016100     05  PV-MTH1-MONTH-NBR            PIC X(02).                  01690000
016200                                                                  01700000
016300     05  PV-MTH2-START-DTE            PIC X(10).                  01710000
016400     05  PV-MTH2-END-DTE              PIC X(10).                  01720000
016500     05  PV-MTH2-COMP-DTE             PIC X(10).                  01730000
016600     05  PV-MTH2-NEW-DTE              PIC X(10).                  01740000
016700     05  PV-MTH2-SEAS-BEG-DTE         PIC X(10).                  01750000
016800     05  PV-MTH2-SEASON               PIC X(01).                  01760000
016900     05  PV-MTH2-YEAR                 PIC X(04).                  01770000
017000     05  PV-MTH2-MONTH-NBR            PIC X(02).                  01780000
017100                                                                  01790000
017200     05  PV-YEAR-NBR-NUM              PIC 9(04).                  01800000
017300     05  PV-PARAGRAPH-NAME            PIC X(30).                  01810000
017400     05  PV-DB2-OPER-ATTEMPTED        PIC X(30).                  01820000
017500     05  PV-ABEND-CODE                PIC S9(04) COMP VALUE ZERO. 01830000
017600****************************************************************  01831005
017700* OUTPUT RECORD LAYOUT FOR COMP & LY FILES                        01832005
017800****************************************************************  01833005
11752A*    COPY BPRD150.                                                01834008
11752A     COPY BPRD151.                                                01834008
018000                                                                  02050000
018100****************************************************************  02060000
018200* RECORD LAYOUT FOR CONTROL CARD FILE.                            02070000
018300****************************************************************  02080000
018400                                                                  02090000
018500 01  CC-CONTROL-CARD.                                             02100000
018600     05  CC-EXTRACT-START-DATE        PIC X(10).                  02110000
018700     05  FILLER                       PIC X(01).                  02120000
018800     05  CC-EXTRACT-END-DATE          PIC X(10).                  02130000
018900     05  FILLER                       PIC X(59).                  02140000
019000                                                                  02150000
019100****************************************************************  02160000
019200* MERCHANDISE LEDGER CONTROL TABLE                                02170000
019300****************************************************************  02180000
019400                                                                  02190000
019500     EXEC SQL                                                     02200000
019600         INCLUDE TMLCNTL                                          02210000
019700     END-EXEC.                                                    02220000
019800                                                                  02230000
019900****************************************************************  02240000
020000* DATE ATTRIBUTE TABLE                                            02250000
020100****************************************************************  02260000
020200                                                                  02270000
020300     EXEC SQL                                                     02280000
020400         INCLUDE TDTATTR                                          02290000
020500     END-EXEC.                                                    02300000
020600                                                                  02310000
020700****************************************************************  02320000
020800* MERCHANDISE LEDGER WEEKLY MAJOR CLASS BY STORE TABLE            02330000
020900****************************************************************  02340000
021000                                                                  02350000
021100     EXEC SQL                                                     02360000
021200         INCLUDE TWKMCLS                                          02370000
021300     END-EXEC.                                                    02380000
021400                                                                  02390000
021500****************************************************************  02400000
021600* STORE TABLE - NEW XMT_LOC                                       02410000
021700****************************************************************  02420000
021800                                                                  02430000
021900     EXEC SQL                                                     02440000
022000         INCLUDE XMT00001                                         02450000
022100     END-EXEC.                                                    02460000
022200                                                                  02470000
022300****************************************************************  02480000
022400*  COMMUNICATION AREAS FOR DB2                                    02490000
022500****************************************************************  02500000
022600                                                                  02510000
022700     EXEC SQL                                                     02520000
022800         INCLUDE SQLCA                                            02530000
022900     END-EXEC.                                                    02540000
023000                                                                  02550000
023100******************************************************************02560000
023200* DB2 COMMUNICATION AREA 2                                        02570000
023300******************************************************************02580000
023400                                                                  02590000
023500     COPY SQLCA2.                                                 02600000
023600                                                                  02610000
023700****************************************************************  02620000
023800*  COMP DATA CURSOR (MONTH 1)                                     02630000
023900****************************************************************  02640000
024000                                                                  02650000
024100     EXEC SQL                                                     02660000
024200        DECLARE COMP1-CSR CURSOR FOR                              02670000
024300          SELECT   B.DEPT_NBR                                     02680000
024400                  ,B.MAJ_CL_NBR                                   02690000
024500                  ,B.FSCL_WK_NBR                                  02700000
024600                  ,SUM(B.SLS_RTL_AMT)                             02710000
024700            FROM  XMT_LOC A                                       02730000
024800                 ,TWKMCLS B                                       02740000
024900                 ,TDTATTR C                                       02750000
025000           WHERE  B.FSCL_WK_NBR = C.FSCL_WK_NBR                   02760000
025100             AND  B.FSCL_WK_END_DTE BETWEEN :PV-MTH1-START-DTE AND02770000
025200                                            :PV-MTH1-END-DTE      02780000
025300             AND  A.LOC_NBR = B.STR_NBR                           02790000
025400             AND  A.LOC_TYP_CDE = 'DS'                            02800000
025500             AND  A.E_BUS_IND   = :PS-E-BUS-IND                   02810000
025600             AND  C.KY_DTE          BETWEEN :PV-MTH1-START-DTE AND02820000
025700                                            :PV-MTH1-END-DTE      02830000
025800             AND  C.KY_DTE = B.FSCL_WK_END_DTE                    02840000
025900             AND  A.MN_SLS_INCL_DTE <= :PV-MTH1-COMP-DTE          02850000
026000        GROUP BY  DEPT_NBR, MAJ_CL_NBR, B.FSCL_WK_NBR             02880000
026100        WITH UR                                                   02881018
026200     END-EXEC.                                                    02890000
026300                                                                  02900000
026400****************************************************************  02910000
026500*  COMP DATA CURSOR (MONTH 2 IF NECESSARY)                        02920000
026600****************************************************************  02930000
026700                                                                  02940000
026800     EXEC SQL                                                     02950000
026900        DECLARE COMP2-CSR CURSOR FOR                              02960000
027000          SELECT   B.DEPT_NBR                                     02970000
027100                  ,B.MAJ_CL_NBR                                   02980000
027200                  ,B.FSCL_WK_NBR                                  02990000
027300                  ,SUM(B.SLS_RTL_AMT)                             03000000
027400            FROM  XMT_LOC A                                       03020000
027500                 ,TWKMCLS B                                       03030000
027600                 ,TDTATTR C                                       03040000
027700           WHERE  B.FSCL_WK_NBR = C.FSCL_WK_NBR                   03050000
027800             AND  B.FSCL_WK_END_DTE BETWEEN :PV-MTH2-START-DTE AND03060000
027900                                            :PV-MTH2-END-DTE      03070000
028000             AND  A.LOC_NBR = B.STR_NBR                           03080000
028100             AND  A.LOC_TYP_CDE = 'DS'                            03090000
028200             AND  A.E_BUS_IND   = :PS-E-BUS-IND                   03100000
028300             AND  C.KY_DTE          BETWEEN :PV-MTH2-START-DTE AND03110000
028400                                            :PV-MTH2-END-DTE      03120000
028500             AND  C.KY_DTE = B.FSCL_WK_END_DTE                    03130000
028600             AND  A.MN_SLS_INCL_DTE <= :PV-MTH2-COMP-DTE          03140000
028700        GROUP BY  DEPT_NBR, MAJ_CL_NBR, B.FSCL_WK_NBR             03170000
028800        WITH UR                                                   03171018
028900     END-EXEC.                                                    03180000
029000                                                                  03190000
029100****************************************************************  03200000
029200*  NEW DATA CURSOR (MONTH 1)                                      03210000
029300****************************************************************  03220000
029400                                                                  03230000
029500     EXEC SQL                                                     03240000
029600        DECLARE NEW1-CSR CURSOR FOR                               03250000
029700          SELECT   B.DEPT_NBR                                     03260000
029800                  ,B.MAJ_CL_NBR                                   03270000
029900                  ,B.FSCL_WK_NBR                                  03280000
030000                  ,SUM(B.SLS_RTL_AMT)                             03290000
030100            FROM  TWKMCLS B                                       03310000
030200                 ,TDTATTR C                                       03320000
030300           WHERE  B.FSCL_WK_NBR = C.FSCL_WK_NBR                   03330000
030400             AND  B.FSCL_WK_END_DTE BETWEEN :PV-MTH1-START-DTE AND03340000
030500                                            :PV-MTH1-END-DTE      03350000
030600             AND  C.KY_DTE          BETWEEN :PV-MTH1-START-DTE AND03360000
030700                                            :PV-MTH1-END-DTE      03370000
030800             AND  C.KY_DTE = B.FSCL_WK_END_DTE                    03380000
030900             AND  B.STR_NBR IN                                    03390000
031000             (SELECT B.LOC_NBR                                    03400000
031100                FROM XMT_LOC B                                    03410000
031200               WHERE B.MN_SLS_INCL_DTE >  :PV-MTH1-NEW-DTE        03420000
031300                 AND B.OPN_DTE         >= :PV-MTH1-SEAS-BEG-DTE   03430000
031400                 AND B.LOC_TYP_CDE     =  'DS'                    03440000
031500                 AND B.E_BUS_IND       =  :PS-E-BUS-IND           03450000
031600                 AND B.LOC_NBR NOT IN                             03460000
031700                    (SELECT A.REPLT_STR_NBR                       03470000
031800                       FROM XMT_LOC A                             03480000
031900                      WHERE A.REPLT_STR_NBR   > 0                 03490000
032000                        AND A.LOC_TYP_CDE     =  'DS'))           03500000
032100        GROUP BY  DEPT_NBR, MAJ_CL_NBR, B.FSCL_WK_NBR             03510000
032200        WITH UR                                                   03511018
032300     END-EXEC.                                                    03520000
032400                                                                  03530000
032500****************************************************************  03540000
032600*  NEW DATA CURSOR (MONTH 2 IF NECESSARY)                         03550000
032700****************************************************************  03560000
032800                                                                  03570000
032900     EXEC SQL                                                     03580000
033000        DECLARE NEW2-CSR CURSOR FOR                               03590000
033100          SELECT   B.DEPT_NBR                                     03600000
033200                  ,B.MAJ_CL_NBR                                   03610000
033300                  ,B.FSCL_WK_NBR                                  03620000
033400                  ,SUM(B.SLS_RTL_AMT)                             03630000
033500            FROM  TWKMCLS B                                       03650000
033600                 ,TDTATTR C                                       03660000
033700           WHERE  B.FSCL_WK_NBR = C.FSCL_WK_NBR                   03670000
033800             AND  B.FSCL_WK_END_DTE BETWEEN :PV-MTH2-START-DTE AND03680000
033900                                            :PV-MTH2-END-DTE      03690000
034000             AND  C.KY_DTE          BETWEEN :PV-MTH2-START-DTE AND03700000
034100                                            :PV-MTH2-END-DTE      03710000
034200             AND  C.KY_DTE = B.FSCL_WK_END_DTE                    03720000
034300             AND  B.STR_NBR IN                                    03730000
034400             (SELECT B.LOC_NBR                                    03740000
034500                FROM XMT_LOC B                                    03750000
034600               WHERE B.MN_SLS_INCL_DTE >  :PV-MTH1-NEW-DTE        03760000
034700                 AND B.OPN_DTE         >= :PV-MTH1-SEAS-BEG-DTE   03770000
034800                 AND B.LOC_TYP_CDE     =  'DS'                    03780000
034900                 AND B.E_BUS_IND       =  :PS-E-BUS-IND           03790000
035000                 AND B.LOC_NBR NOT IN                             03800000
035100                    (SELECT A.REPLT_STR_NBR                       03810000
035200                       FROM XMT_LOC A                             03820000
035300                      WHERE A.REPLT_STR_NBR   > 0                 03830000
035400                        AND A.LOC_TYP_CDE     =  'DS'))           03840000
035500        GROUP BY  DEPT_NBR, MAJ_CL_NBR, B.FSCL_WK_NBR             03850000
035600        WITH UR                                                   03851018
035700     END-EXEC.                                                    03860000
035800                                                                  03870000
035900                                                                  03880000
036000******************************************************************03890000
036100******************************************************************03900000
036200 PROCEDURE DIVISION.                                              03910002
036300******************************************************************03920000
036400******************************************************************03930000
036500                                                                  03940000
036600 0000-MAINLINE.                                                   03950000
036700     PERFORM 1000-INITIALIZE.                                     03970000
036800                                                                  03980000
036900     DISPLAY 'PV-MTH1-START-DTE ' PV-MTH1-START-DTE               03981000
037000     DISPLAY 'PV-MTH1-END-DTE ' PV-MTH1-END-DTE                   03982000
037100     DISPLAY 'PV-MTH1-COMP-DTE ' PV-MTH1-COMP-DTE                 03983000
037200     DISPLAY 'PV-MTH2-START-DTE ' PV-MTH2-START-DTE               03984000
037300     DISPLAY 'PV-MTH2-END-DTE ' PV-MTH2-END-DTE                   03985000
037400     DISPLAY 'PV-MTH2-COMP-DTE ' PV-MTH2-COMP-DTE                 03986000
037500     PERFORM 2000-MTD-COMP.                                       03990000
037600                                                                  04000000
037700     PERFORM 2200-MTD-NEW.                                        04010000
037800                                                                  04020000
037900     PERFORM 3000-LY-COMP.                                        04030000
038000                                                                  04040000
038100     PERFORM 3200-LY-NEW.                                         04041003
038200                                                                  04042003
038300     CLOSE CONTROL-CARD-FILE                                      04070000
038400           COMP-FILE                                              04080012
038500           LY-FILE.                                               04081012
038600                                                                  04090000
038700     STOP RUN.                                                    04100000
038800                                                                  04110000
038900                                                                  04120000
039000******************************************************************04130000
039100*                                                                 04140000
039200*  OPEN INPUT AND OUTPUT FILES AND DETERMINE THE PROCESSING DATES 04150000
039300*                                                                 04160000
039400******************************************************************04170000
039500 1000-INITIALIZE.                                                 04180000
039600     OPEN INPUT  CONTROL-CARD-FILE                                04190000
039700          OUTPUT COMP-FILE                                        04200012
039800          OUTPUT LY-FILE.                                         04201004
039900                                                                  04210000
040000     PERFORM 1100-SET-EXTRACT-DATES.                              04220000
040100                                                                  04230000
040200                                                                  04240000
040300                                                                  04250000
040400******************************************************************04260000
040500*                                                                 04270000
040600* IF THERE ARE DATES ON THE CONTROL CARD, WE WILL USE THEM IN OUR 04280000
040700* PROCESSING (OVERRIDE).  IF NOT, WE WILL EXTRACT THE PROCESSING  04290000
040800* DATES FROM THE MERCHANDISE LEDGER CONTROL TABLE                 04300000
040900*                                                                 04310000
041000******************************************************************04320000
041100 1100-SET-EXTRACT-DATES.                                          04330000
041200     PERFORM 9000-READ-CONTROL-CARD-FILE.                         04340000
041300                                                                  04350000
041400     IF CC-EXTRACT-START-DATE = SPACE                             04360000
041500         PERFORM 1110-USE-ML-CNTL-DATES                           04370000
041600     ELSE                                                         04380000
041700         DISPLAY '***********************************************'04390000
041800         DISPLAY '** OVERRIDE DATE USED: ' CC-CONTROL-CARD '**'   04400000
041900         DISPLAY '***********************************************'04410000
042000         PERFORM 1120-USE-OVERRIDE-DATE                           04420000
042100     END-IF.                                                      04430000
042200                                                                  04440000
042300     PERFORM 1130-CHECK-FOR-MULTIPLE-MONTHS.                      04450000
042400                                                                  04460000
042500                                                                  04470000
042600 1110-USE-ML-CNTL-DATES.                                          04480000
042700     EXEC SQL                                                     04490000
042800          SELECT                                                  04500000
11752A*                FSCL_MN_BEG_DTE                                  04510000
11752A                 FSCL_WK_BEG_DTE                                  04510000
043000                ,MXPSTG_FSCL_WK_DTE                               04520000
043100            INTO                                                  04530000
11752A*                :DTATTR-FSCL-MN-BEG-DTE                          04540000
11752A                 :DTATTR-FSCL-WK-BEG-DTE                          04540000
043300                ,:MLCNTL-MXPSTG-FSCL-WK-DTE                       04550000
043400            FROM                                                  04560000
043500                 TMLCNTL                                          04570000
043600                ,TDTATTR                                                  
043700            WHERE                                                         
043800                 KY_DTE = OPN_FSCL_WK_DTE                                 
043900     END-EXEC.                                                    04580000
044000                                                                  04590000
044100     EVALUATE TRUE                                                04600000
044200         WHEN SQLCODE = ZERO                                      04610000
11752A*            MOVE DTATTR-FSCL-MN-BEG-DTE   TO                     04620000
11752A             MOVE DTATTR-FSCL-WK-BEG-DTE   TO                     04620000
044400                  PV-EXTRACT-START-DATE                           04630000
044500             MOVE MLCNTL-MXPSTG-FSCL-WK-DTE TO                    04640000
044600                  PV-EXTRACT-END-DATE                             04650000
044700         WHEN OTHER                                               04660000
044800             MOVE '1110-USE-ML-CNTL-DATES' TO PV-PARAGRAPH-NAME   04670000
044900             MOVE 'SELECT ROW FROM TMLCNTL'                       04680000
045000                                          TO PV-DB2-OPER-ATTEMPTED04690000
045100             PERFORM 9999-SQL-ABEND                               04700000
045200     END-EVALUATE.                                                04710000
045300                                                                  04720000
045400                                                                  04730000
045500 1120-USE-OVERRIDE-DATE.                                          04740000
045600     MOVE CC-EXTRACT-START-DATE TO PV-EXTRACT-START-DATE.         04750000
045700     MOVE CC-EXTRACT-END-DATE   TO PV-EXTRACT-END-DATE.           04760000
045800                                                                  04770000
045900                                                                  04780000
046000 1130-CHECK-FOR-MULTIPLE-MONTHS.                                  04790000
046100     EXEC SQL                                                     04800000
046200          SELECT                                                  04810000
046300                 FSCL_MN_BEG_DTE                                  04820000
046400            INTO                                                  04830000
046500                 :DTATTR-FSCL-MN-BEG-DTE                          04840000
046600            FROM                                                  04850000
046700                 TDTATTR                                          04860000
046800           WHERE KY_DTE = :PV-EXTRACT-START-DATE                  04870000
046900     END-EXEC.                                                    04880000
047000                                                                  04890000
047100     EVALUATE TRUE                                                04900000
047200         WHEN SQLCODE = ZERO                                      04910000
047300             MOVE DTATTR-FSCL-MN-BEG-DTE TO PV-MTH1-START-DTE     04920000
047400         WHEN OTHER                                               04930000
047500             MOVE '1130-CHECK-FOR-MULTIPLE-MONTHS' TO             04940000
047600                  PV-PARAGRAPH-NAME                               04950000
047700             MOVE 'SELECT ROW FROM TDTATTR'                       04960000
047800                                          TO PV-DB2-OPER-ATTEMPTED04970000
047900             PERFORM 9999-SQL-ABEND                               04980000
048000     END-EVALUATE.                                                04990000
048100                                                                  05000000
048200     EXEC SQL                                                     05010000
048300          SELECT                                                  05020000
048400                 FSCL_MN_BEG_DTE                                  05030000
048500            INTO                                                  05040000
048600                 :DTATTR-FSCL-MN-BEG-DTE                          05050000
048700            FROM                                                  05060000
048800                 TDTATTR                                          05070000
048900           WHERE KY_DTE = :PV-EXTRACT-END-DATE                    05080000
049000     END-EXEC.                                                    05090000
049100                                                                  05100000
049200     EVALUATE TRUE                                                05110000
049300         WHEN SQLCODE = ZERO                                      05120000
049400             MOVE DTATTR-FSCL-MN-BEG-DTE TO PV-MTH2-START-DTE     05130000
049500         WHEN OTHER                                               05140000
049600             MOVE '1130-CHECK-FOR-MULTIPLE-MONTHS' TO             05150000
049700                  PV-PARAGRAPH-NAME                               05160000
049800             MOVE 'SELECT ROW FROM TDTATTR'                       05170000
049900                                          TO PV-DB2-OPER-ATTEMPTED05180000
050000             PERFORM 9999-SQL-ABEND                               05190000
050100     END-EVALUATE.                                                05200000
050200                                                                  05210000
050300     IF PV-MTH1-START-DTE = PV-MTH2-START-DTE                     05220000
050400        CONTINUE                                                  05230000
050500     ELSE                                                         05240000
050600        SET PS-MULTIPLE-MONTHS TO TRUE                            05250000
050700     END-IF.                                                      05260000
050800                                                                  05270000
050900     PERFORM 1140-SET-PROCESSING-DATES.                           05280000
051000                                                                  05290000
051100                                                                  05300000
051200 1140-SET-PROCESSING-DATES.                                       05310000
051300     IF PS-MULTIPLE-MONTHS                                        05320000
051400       EXEC SQL                                                   05330000
051500            SELECT                                                05340000
051600                   FSCL_MN_END_DTE                                05350000
051700                  ,FSCL_MN_BEG_DTE                                05360000
051800                  ,FSCL_MN_NBR                                    05370000
051900                  ,SEA_BEG_DTE                                    05380000
052000                  ,SEA_DESC                                       05390000
052100                  ,FSCL_YR_NBR                                    05400000
052200              INTO                                                05410000
052300                   :DTATTR-FSCL-MN-END-DTE                        05420000
052400                  ,:DTATTR-FSCL-MN-BEG-DTE                        05430000
052500                  ,:DTATTR-FSCL-MN-NBR                            05440000
052600                  ,:DTATTR-SEA-BEG-DTE                            05450000
052700                  ,:DTATTR-SEA-DESC                               05460000
052800                  ,:DTATTR-FSCL-YR-NBR                            05470000
052900              FROM                                                05480000
053000                   TDTATTR                                        05490000
053100             WHERE KY_DTE = :PV-MTH1-START-DTE                    05500000
053200       END-EXEC                                                   05510000
053300                                                                  05520000
053400       EVALUATE TRUE                                              05530000
053500           WHEN SQLCODE = ZERO                                    05540000
053600               MOVE PV-EXTRACT-START-DATE  TO PV-MTH1-START-DTE   05550000
053700               MOVE DTATTR-FSCL-MN-END-DTE TO PV-MTH1-END-DTE     05560000
053800                                              PV-MTH1-COMP-DTE    05570000
053900               MOVE DTATTR-FSCL-MN-BEG-DTE TO PV-MTH1-NEW-DTE     05580000
054000               MOVE DTATTR-FSCL-MN-NBR     TO PV-MTH1-MONTH-NBR   05590000
054100               MOVE DTATTR-SEA-BEG-DTE     TO PV-MTH1-SEAS-BEG-DTE05600000
054200               MOVE DTATTR-SEA-DESC(1:1)   TO PV-MTH1-SEASON      05610000
054300               MOVE DTATTR-FSCL-YR-NBR     TO PV-MTH1-YEAR        05620000
054400           WHEN OTHER                                             05630000
054500               MOVE '1140-SET-PROCESSING-DATES' TO                05640000
054600                    PV-PARAGRAPH-NAME                             05650000
054700               MOVE 'SELECT ROW FROM TDTATTR'                     05660000
054800                                          TO PV-DB2-OPER-ATTEMPTED05670000
054900               PERFORM 9999-SQL-ABEND                             05680000
055000       END-EVALUATE                                               05690000
055100                                                                  05700000
055200       EXEC SQL                                                   05710000
055300            SELECT                                                05720000
055400                   SEA_BEG_DTE                                    05730000
055500                  ,SEA_DESC                                       05740000
055600                  ,FSCL_MN_NBR                                    05750000
055700                  ,FSCL_YR_NBR                                    05760000
055800                  ,FSCL_MN_END_DTE                                05770000
055900              INTO                                                05780000
056000                   :DTATTR-SEA-BEG-DTE                            05790000
056100                  ,:DTATTR-SEA-DESC                               05800000
056200                  ,:DTATTR-FSCL-MN-NBR                            05810000
056300                  ,:DTATTR-FSCL-YR-NBR                            05820000
056400                  ,:DTATTR-FSCL-MN-END-DTE                        05830000
056500              FROM                                                05840000
056600                   TDTATTR                                        05850000
056700             WHERE KY_DTE = :PV-MTH2-START-DTE                    05860000
056800       END-EXEC                                                   05870000
056900                                                                  05880000
057000       EVALUATE TRUE                                              05890000
057100           WHEN SQLCODE = ZERO                                    05900000
057200               MOVE PV-EXTRACT-END-DATE    TO PV-MTH2-END-DTE     05910000
057300               MOVE DTATTR-FSCL-MN-END-DTE TO PV-MTH2-COMP-DTE    05920000
057400               MOVE PV-MTH2-START-DTE      TO PV-MTH2-NEW-DTE     05930000
057500               MOVE DTATTR-FSCL-MN-NBR   TO PV-MTH2-MONTH-NBR     05940000
057600               MOVE DTATTR-SEA-BEG-DTE   TO PV-MTH2-SEAS-BEG-DTE  05950000
057700               MOVE DTATTR-SEA-DESC(1:1) TO PV-MTH2-SEASON        05960000
057800               MOVE DTATTR-FSCL-YR-NBR   TO PV-MTH2-YEAR          05970000
057900           WHEN OTHER                                             05980000
058000               MOVE '1140-SET-PROCESSING-DATES' TO                05990000
058100                    PV-PARAGRAPH-NAME                             06000000
058200               MOVE 'SELECT ROW FROM TDTATTR'                     06010000
058300                                          TO PV-DB2-OPER-ATTEMPTED06020000
058400               PERFORM 9999-SQL-ABEND                             06030000
058500       END-EVALUATE                                               06040000
058600     ELSE                                                         06050000
058700       MOVE PV-EXTRACT-START-DATE TO PV-MTH1-START-DTE            06060000
058800       MOVE PV-EXTRACT-END-DATE   TO PV-MTH1-END-DTE              06070000
058900                                                                  06080000
059000       EXEC SQL                                                   06090000
059100            SELECT                                                06100000
059200                   FSCL_MN_BEG_DTE                                06110000
059300                  ,FSCL_MN_END_DTE                                06120000
059400                  ,FSCL_MN_NBR                                    06130000
059500                  ,SEA_BEG_DTE                                    06140000
059600                  ,SEA_DESC                                       06150000
059700                  ,FSCL_YR_NBR                                    06160000
059800              INTO                                                06170000
059900                   :DTATTR-FSCL-MN-BEG-DTE                        06180000
060000                  ,:DTATTR-FSCL-MN-END-DTE                        06190000
060100                  ,:DTATTR-FSCL-MN-NBR                            06200000
060200                  ,:DTATTR-SEA-BEG-DTE                            06210000
060300                  ,:DTATTR-SEA-DESC                               06220000
060400                  ,:DTATTR-FSCL-YR-NBR                            06230000
060500              FROM                                                06240000
060600                   TDTATTR                                        06250000
060700             WHERE KY_DTE = :PV-MTH1-START-DTE                    06260000
060800       END-EXEC                                                   06270000
060900                                                                  06280000
061000       EVALUATE TRUE                                              06290000
061100           WHEN SQLCODE = ZERO                                    06300000
061200               MOVE DTATTR-FSCL-MN-BEG-DTE TO PV-MTH1-NEW-DTE     06310000
061300               MOVE DTATTR-FSCL-MN-END-DTE TO PV-MTH1-COMP-DTE    06320000
061400               MOVE DTATTR-FSCL-MN-NBR     TO PV-MTH1-MONTH-NBR   06330000
061500               MOVE DTATTR-SEA-BEG-DTE     TO PV-MTH1-SEAS-BEG-DTE06340000
061600               MOVE DTATTR-SEA-DESC(1:1)   TO PV-MTH1-SEASON      06350000
061700               MOVE DTATTR-FSCL-YR-NBR     TO PV-MTH1-YEAR        06360000
061800           WHEN OTHER                                             06370000
061900               MOVE '1140-SET-PROCESSING-DATES' TO                06380000
062000                    PV-PARAGRAPH-NAME                             06390000
062100               MOVE 'SELECT ROW FROM TDTATTR'                     06400000
062200                                          TO PV-DB2-OPER-ATTEMPTED06410000
062300               PERFORM 9999-SQL-ABEND                             06420000
062400       END-EVALUATE                                               06430000
062500     END-IF.                                                      06440000
062600                                                                  06450000
062700                                                                  06460000
062800******************************************************************06470000
062900*                                                                 06480000
063000* CURRENT YEAR COMP SALES AMOUNT                                  06490002
063100******************************************************************06500000
063200 2000-MTD-COMP.                                                   06510000
063300                                                                  06520000
063400     SET PS-NOT-E-BUS    TO TRUE.                                 06530000
063500     MOVE PC-PHYSSTR     TO PV-CHANNEL.                           06540000
063600     EXEC SQL                                                     06560000
063700         OPEN COMP1-CSR                                           06570000
063800     END-EXEC.                                                    06580000
063900     PERFORM 2010-PROCESS-MTD1-COMP-VALUES                        06600000
064000         UNTIL PS-END-OF-MTD1-COMP-CURSOR.                        06610000
064100                                                                  06620000
064200     IF PS-MULTIPLE-MONTHS                                        06630000
064300       EXEC SQL                                                   06640000
064400           OPEN COMP2-CSR                                         06650000
064500       END-EXEC                                                   06660000
064600                                                                  06670000
064700       PERFORM 2020-PROCESS-MTD2-COMP-VALUES                      06680000
064800           UNTIL PS-END-OF-MTD2-COMP-CURSOR                       06690000
064900     END-IF.                                                      06700000
065000                                                                  06710000
065100     MOVE PC-VIRTSTR     TO PV-CHANNEL.                           06720000
065200     SET PS-E-BUS        TO TRUE.                                 06730000
065300     SET PS-NOT-END-OF-MTD1-COMP-CURSOR TO TRUE.                  06740000
065400     EXEC SQL                                                     06750000
065500         OPEN COMP1-CSR                                           06760000
065600     END-EXEC.                                                    06770000
065700                                                                  06780000
065800     PERFORM 2010-PROCESS-MTD1-COMP-VALUES                        06790000
065900         UNTIL PS-END-OF-MTD1-COMP-CURSOR.                        06800000
066000                                                                  06810000
066100     IF PS-MULTIPLE-MONTHS                                        06820000
066200       SET PS-NOT-END-OF-MTD2-COMP-CURSOR TO TRUE                 06830000
066300       EXEC SQL                                                   06840000
066400           OPEN COMP2-CSR                                         06850000
066500       END-EXEC                                                   06860000
066600                                                                  06870000
066700       PERFORM 2020-PROCESS-MTD2-COMP-VALUES                      06880000
066800           UNTIL PS-END-OF-MTD2-COMP-CURSOR                       06890000
066900     END-IF.                                                      06900000
067000                                                                  06910000
067100                                                                  06920000
067200******************************************************************06930000
067300*                                                                 06940000
067400*                                                                 06950000
067500******************************************************************06960000
067600 2010-PROCESS-MTD1-COMP-VALUES.                                   06970000
067700     EXEC SQL                                                     06980000
067800         FETCH COMP1-CSR                                          06990000
067900         INTO  :WKMCLS-DEPT-NBR                                   07000000
068000              ,:WKMCLS-MAJ-CL-NBR                                 07010000
068100              ,:WKMCLS-FSCL-WK-NBR                                07020000
068200              ,:WKMCLS-SLS-RTL-AMT                                07030000
068300     END-EXEC.                                                    07050000
068400                                                                  07060000
068500     EVALUATE SQLCODE                                             07070000
068600         WHEN ZERO                                                07080000
068700            MOVE PV-MTH1-SEASON TO PV-SEASON                      07090000
068800            MOVE PV-MTH1-YEAR   TO PV-YEAR                        07100000
068900            SET PS-C1-SLS-DLR  TO TRUE                            07110002
069000            PERFORM 9100-WRITE-RECORD                             07140000
069100         WHEN +100                                                07150000
069200            SET PS-END-OF-MTD1-COMP-CURSOR TO TRUE                07160000
069300            EXEC SQL                                              07170000
069400               CLOSE COMP1-CSR                                    07180000
069500            END-EXEC                                              07190000
069600         WHEN OTHER                                               07200000
069700             MOVE '2010-PROCESS-MTD1-COMP-VALUES' TO              07210000
069800                  PV-PARAGRAPH-NAME                               07220000
069900     END-EVALUATE.                                                07230000
070000                                                                  07240000
070100                                                                  07250000
070200******************************************************************07260000
070300*                                                                 07270000
070400*                                                                 07280000
070500******************************************************************07290000
070600 2020-PROCESS-MTD2-COMP-VALUES.                                   07300000
070700     EXEC SQL                                                     07310000
070800         FETCH COMP2-CSR                                          07320000
070900         INTO  :WKMCLS-DEPT-NBR                                   07330000
071000              ,:WKMCLS-MAJ-CL-NBR                                 07340000
071100              ,:WKMCLS-FSCL-WK-NBR                                07350000
071200              ,:WKMCLS-SLS-RTL-AMT                                07360000
071300     END-EXEC.                                                    07380000
071400                                                                  07390000
071500     EVALUATE SQLCODE                                             07400000
071600         WHEN ZERO                                                07410000
071700            MOVE PV-MTH2-SEASON TO PV-SEASON                      07420000
071800            MOVE PV-MTH2-YEAR   TO PV-YEAR                        07430000
071900            SET PS-C2-SLS-DLR   TO TRUE                           07440002
072000            PERFORM 9100-WRITE-RECORD                             07470000
072100         WHEN +100                                                07480000
072200            SET PS-END-OF-MTD2-COMP-CURSOR TO TRUE                07490000
072300            EXEC SQL                                              07500000
072400               CLOSE COMP2-CSR                                    07510000
072500            END-EXEC                                              07520000
072600         WHEN OTHER                                               07530000
072700             MOVE '2020-PROCESS-MTD2-COMP-VALUES' TO              07540000
072800                  PV-PARAGRAPH-NAME                               07550000
072900     END-EVALUATE.                                                07560000
073000                                                                  07570000
073100                                                                  07580000
073200******************************************************************07590000
073300*                                                                 07600000
073400*                                                                 07610000
073500******************************************************************07620000
073600 2200-MTD-NEW.                                                    07630000
073700                                                                  07640000
073800     SET PS-NOT-E-BUS TO TRUE.                                    07650000
073900                                                                  07670000
074000     EXEC SQL                                                     07680000
074100         OPEN NEW1-CSR                                            07690000
074200     END-EXEC.                                                    07700000
074300                                                                  07710000
074400     PERFORM 2210-PROCESS-MTD1-NEW-VALUES                         07720000
074500         UNTIL PS-END-OF-MTD1-NEW-CURSOR.                         07730000
074600                                                                  07740000
074700     IF PS-MULTIPLE-MONTHS                                        07750000
074800                                                                  07760000
074900       EXEC SQL                                                   07770000
075000           OPEN NEW2-CSR                                          07780000
075100       END-EXEC                                                   07790000
075200                                                                  07800000
075300       PERFORM 2220-PROCESS-MTD2-NEW-VALUES                       07810000
075400           UNTIL PS-END-OF-MTD2-NEW-CURSOR                        07820000
075500     END-IF.                                                      07830000
075600                                                                  07840000
075700     SET PS-E-BUS    TO TRUE.                                     07850000
075800     SET PS-NOT-END-OF-MTD1-NEW-CURSOR TO TRUE.                   07870000
075900                                                                  07880000
076000     EXEC SQL                                                     07890000
076100         OPEN NEW1-CSR                                            07900000
076200     END-EXEC.                                                    07910000
076300                                                                  07920000
076400     PERFORM 2210-PROCESS-MTD1-NEW-VALUES                         07930000
076500         UNTIL PS-END-OF-MTD1-NEW-CURSOR.                         07940000
076600                                                                  07950000
076700     IF PS-MULTIPLE-MONTHS                                        07960000
076800       SET PS-NOT-END-OF-MTD2-NEW-CURSOR TO TRUE                  07970000
076900                                                                  07980000
077000       EXEC SQL                                                   07990000
077100           OPEN NEW2-CSR                                          08000000
077200       END-EXEC                                                   08010000
077300                                                                  08020000
077400       PERFORM 2220-PROCESS-MTD2-NEW-VALUES                       08030000
077500           UNTIL PS-END-OF-MTD2-NEW-CURSOR                        08040000
077600     END-IF.                                                      08050000
077700                                                                  08060000
077800******************************************************************08070000
077900*                                                                 08080000
078000*    PROCESS MOTH TO DATE SALES RETAIL AMOUNT FOR NEW STORES      08090000
078100******************************************************************08100000
078200 2210-PROCESS-MTD1-NEW-VALUES.                                    08110000
078300     EXEC SQL                                                     08120000
078400         FETCH NEW1-CSR                                           08130000
078500         INTO  :WKMCLS-DEPT-NBR                                   08140000
078600              ,:WKMCLS-MAJ-CL-NBR                                 08150000
078700              ,:WKMCLS-FSCL-WK-NBR                                08160000
078800              ,:WKMCLS-SLS-RTL-AMT                                08170000
078900     END-EXEC.                                                    08190000
079000                                                                  08200000
079100     EVALUATE SQLCODE                                             08210000
079200         WHEN ZERO                                                08220000
079300            MOVE PV-MTH1-SEASON TO PV-SEASON                      08230000
079400            MOVE PV-MTH1-YEAR   TO PV-YEAR                        08240000
079500            SET PS-N1-SLS-DLR   TO TRUE                           08250002
079600            PERFORM 9100-WRITE-RECORD                             08280000
079700         WHEN +100                                                08290000
079800            SET PS-END-OF-MTD1-NEW-CURSOR TO TRUE                 08300000
079900            EXEC SQL                                              08310000
080000               CLOSE NEW1-CSR                                     08320000
080100            END-EXEC                                              08330000
080200         WHEN OTHER                                               08340000
080300             MOVE '2210-PROCESS-MTD1-NEW-VALUES' TO               08350000
080400                  PV-PARAGRAPH-NAME                               08360000
080500     END-EVALUATE.                                                08370000
080600                                                                  08380000
080700                                                                  08390000
080800******************************************************************08400000
080900*   PROCESS MOTH TO DATE SALES RETAIL FOR NEW STORES IF MULTIPLE  08410000
081000*   MONTHS FOUND                                                  08420000
081100******************************************************************08430000
081200 2220-PROCESS-MTD2-NEW-VALUES.                                    08440000
081300     EXEC SQL                                                     08450000
081400         FETCH NEW2-CSR                                           08460000
081500         INTO  :WKMCLS-DEPT-NBR                                   08470000
081600              ,:WKMCLS-MAJ-CL-NBR                                 08480000
081700              ,:WKMCLS-FSCL-WK-NBR                                08490000
081800              ,:WKMCLS-SLS-RTL-AMT                                08500000
081900     END-EXEC.                                                    08520000
082000                                                                  08530000
082100     EVALUATE SQLCODE                                             08540000
082200         WHEN ZERO                                                08550000
082300            MOVE PV-MTH2-SEASON TO PV-SEASON                      08560000
082400            MOVE PV-MTH2-YEAR   TO PV-YEAR                        08570000
082500            SET  PS-N2-SLS-DLR   TO TRUE                          08580002
082600            PERFORM 9100-WRITE-RECORD                             08610000
082700         WHEN +100                                                08620000
082800            SET PS-END-OF-MTD2-NEW-CURSOR TO TRUE                 08630000
082900            EXEC SQL                                              08640000
083000               CLOSE NEW2-CSR                                     08650000
083100            END-EXEC                                              08660000
083200         WHEN OTHER                                               08670000
083300             MOVE '2220-PROCESS-MTD2-NEW-VALUES' TO               08680000
083400                  PV-PARAGRAPH-NAME                               08690000
083500     END-EVALUATE.                                                08700000
083600                                                                  08710000
083700                                                                  08720000
083800******************************************************************08730000
083900*                                                                 08740000
084000*   PROCESS LY COMP STORES SALES RETAIL                           08750000
084100******************************************************************08760000
084200 3000-LY-COMP.                                                    08770000
084300     PERFORM 9200-GET-LY-DATES.                                   08780000
084400                                                                  08790000
084500     SET PS-NOT-E-BUS TO TRUE.                                    08800000
084600                                                                  08820000
084700     EXEC SQL                                                     08830000
084800         OPEN COMP1-CSR                                           08840000
084900     END-EXEC.                                                    08850000
085000                                                                  08860000
085100     PERFORM 3010-PROCESS-LY1-COMP-VALUES                         08870000
085200         UNTIL PS-END-OF-LY1-COMP-CURSOR.                         08880000
085300                                                                  08890000
085400     IF PS-MULTIPLE-MONTHS                                        08900000
085500       DISPLAY 'OPENING LY COMP CURSOR-2'                         08910000
085600                                                                  08920000
085700       EXEC SQL                                                   08930000
085800           OPEN COMP2-CSR                                         08940000
085900       END-EXEC                                                   08950000
086000                                                                  08960000
086100       DISPLAY 'LY COMP CURSOR-2 IS OPEN'                         08970000
086200                                                                  08980000
086300       PERFORM 3020-PROCESS-LY2-COMP-VALUES                       08990000
086400           UNTIL PS-END-OF-LY2-COMP-CURSOR                        09000000
086500     END-IF.                                                      09010000
086600                                                                  09020000
086700     SET PS-E-BUS     TO TRUE.                                    09030000
086800     SET PS-NOT-END-OF-LY1-COMP-CURSOR TO TRUE.                   09050000
086900                                                                  09060000
087000     EXEC SQL                                                     09070000
087100         OPEN COMP1-CSR                                           09080000
087200     END-EXEC.                                                    09090000
087300                                                                  09100000
087400     PERFORM 3010-PROCESS-LY1-COMP-VALUES                         09110000
087500         UNTIL PS-END-OF-LY1-COMP-CURSOR.                         09120000
087600                                                                  09130000
087700     IF PS-MULTIPLE-MONTHS                                        09140000
087800       SET PS-NOT-END-OF-LY2-COMP-CURSOR TO TRUE                  09150000
087900                                                                  09160000
088000       EXEC SQL                                                   09170000
088100           OPEN COMP2-CSR                                         09180000
088200       END-EXEC                                                   09190000
088300                                                                  09200000
088400       PERFORM 3020-PROCESS-LY2-COMP-VALUES                       09210000
088500           UNTIL PS-END-OF-LY2-COMP-CURSOR                        09220000
088600     END-IF.                                                      09230000
088700                                                                  09240000
088800******************************************************************09250000
088900*                                                                 09260000
089000*    PROCESS LAST YEAR COMP VALUES                                09270000
089100******************************************************************09280000
089200 3010-PROCESS-LY1-COMP-VALUES.                                    09290000
089300     EXEC SQL                                                     09300000
089400         FETCH COMP1-CSR                                          09310000
089500         INTO  :WKMCLS-DEPT-NBR                                   09320000
089600              ,:WKMCLS-MAJ-CL-NBR                                 09330000
089700              ,:WKMCLS-FSCL-WK-NBR                                09340000
089800              ,:WKMCLS-SLS-RTL-AMT                                09350000
089900     END-EXEC.                                                    09370000
090000                                                                  09380000
090100     EVALUATE SQLCODE                                             09390000
090200         WHEN ZERO                                                09400000
090300            MOVE PV-MTH1-SEASON TO PV-SEASON                      09410000
090400            MOVE PV-MTH1-YEAR   TO PV-YEAR                        09420000
090500            SET PS-LC1-SLS-DLR   TO TRUE                          09430009
090600            PERFORM 9200-WRITE-RECORD                             09460002
090700         WHEN +100                                                09470000
090800            SET PS-END-OF-LY1-COMP-CURSOR TO TRUE                 09480000
090900            EXEC SQL                                              09490000
091000               CLOSE COMP1-CSR                                    09500000
091100            END-EXEC                                              09510000
091200         WHEN OTHER                                               09520000
091300             MOVE '3010-PROCESS-LY1-COMP-VALUES' TO               09530000
091400                  PV-PARAGRAPH-NAME                               09540000
091500     END-EVALUATE.                                                09550000
091600                                                                  09560000
091700                                                                  09570000
091800******************************************************************09580000
091900*                                                                 09590000
092000*    PROCESS LAST YEAR COMP IF MULTIPLE MONTHS FOUND              09600000
092100******************************************************************09610000
092200 3020-PROCESS-LY2-COMP-VALUES.                                    09620000
092300     EXEC SQL                                                     09630000
092400         FETCH COMP2-CSR                                          09640000
092500         INTO  :WKMCLS-DEPT-NBR                                   09650000
092600              ,:WKMCLS-MAJ-CL-NBR                                 09660000
092700              ,:WKMCLS-FSCL-WK-NBR                                09670000
092800              ,:WKMCLS-SLS-RTL-AMT                                09680000
092900     END-EXEC.                                                    09700000
093000                                                                  09710000
093100     EVALUATE SQLCODE                                             09720000
093200         WHEN ZERO                                                09730000
093300            MOVE PV-MTH2-SEASON TO PV-SEASON                      09740000
093400            MOVE PV-MTH2-YEAR   TO PV-YEAR                        09750000
093500            SET PS-LC2-SLS-DLR   TO TRUE                          09760009
093600            PERFORM 9200-WRITE-RECORD                             09790002
093700         WHEN +100                                                09800000
093800            SET PS-END-OF-LY2-COMP-CURSOR TO TRUE                 09810000
093900            EXEC SQL                                              09820000
094000               CLOSE COMP2-CSR                                    09830000
094100            END-EXEC                                              09840000
094200         WHEN OTHER                                               09850000
094300             MOVE '3020-PROCESS-LY2-COMP-VALUES' TO               09860000
094400                  PV-PARAGRAPH-NAME                               09870000
094500     END-EVALUATE.                                                09880000
094600                                                                  09890000
094700******************************************************************09891003
094800*                                                                 09892003
094900*    PROCESS LAST YEAR NEW STORES SALES                           09893003
095000******************************************************************09894003
095100 3200-LY-NEW.                                                     09895003
095200     PERFORM 9200-GET-LY-DATES.                                   09895103
095300                                                                  09896003
095400     SET PS-NOT-E-BUS TO TRUE.                                    09897003
095500                                                                  09899003
095600     EXEC SQL                                                     09899103
095700         OPEN NEW1-CSR                                            09899203
095800     END-EXEC.                                                    09899303
095900                                                                  09899403
096000     PERFORM 3210-PROCESS-MTD1-NEW-VALUES                         09899503
096100         UNTIL PS-END-OF-MTD1-NEW-CURSOR.                         09899603
096200                                                                  09899703
096300     IF PS-MULTIPLE-MONTHS                                        09899803
096400                                                                  09899903
096500       EXEC SQL                                                   09900003
096600           OPEN NEW2-CSR                                          09901003
096700       END-EXEC                                                   09902003
096800                                                                  09903003
096900       PERFORM 3220-PROCESS-MTD2-NEW-VALUES                       09904003
097000           UNTIL PS-END-OF-MTD2-NEW-CURSOR                        09905003
097100     END-IF.                                                      09906003
097200                                                                  09907003
097300     SET PS-E-BUS    TO TRUE.                                     09908003
097400     SET PS-NOT-END-OF-MTD1-NEW-CURSOR TO TRUE.                   09909103
097500                                                                  09909203
097600     EXEC SQL                                                     09909303
097700         OPEN NEW1-CSR                                            09909403
097800     END-EXEC.                                                    09909503
097900                                                                  09909603
098000     PERFORM 3210-PROCESS-MTD1-NEW-VALUES                         09909703
098100         UNTIL PS-END-OF-MTD1-NEW-CURSOR.                         09909803
098200                                                                  09909903
098300     IF PS-MULTIPLE-MONTHS                                        09910003
098400       SET PS-NOT-END-OF-MTD2-NEW-CURSOR TO TRUE                  09911003
098500                                                                  09912003
098600       EXEC SQL                                                   09913003
098700           OPEN NEW2-CSR                                          09914003
098800       END-EXEC                                                   09915003
098900                                                                  09916003
099000       PERFORM 3220-PROCESS-MTD2-NEW-VALUES                       09917003
099100           UNTIL PS-END-OF-MTD2-NEW-CURSOR                        09918003
099200     END-IF.                                                      09919003
099300                                                                  09919103
099400******************************************************************09919203
099500*                                                                 09919303
099600*  PROCESS NEW STORES                                             09919403
099700******************************************************************09919503
099800 3210-PROCESS-MTD1-NEW-VALUES.                                    09919603
099900     EXEC SQL                                                     09919703
100000         FETCH NEW1-CSR                                           09919803
100100         INTO  :WKMCLS-DEPT-NBR                                   09919903
100200              ,:WKMCLS-MAJ-CL-NBR                                 09920003
100300              ,:WKMCLS-FSCL-WK-NBR                                09921003
100400              ,:WKMCLS-SLS-RTL-AMT                                09922003
100500     END-EXEC.                                                    09923003
100600                                                                  09924003
100700     EVALUATE SQLCODE                                             09925003
100800         WHEN ZERO                                                09926003
100900            MOVE PV-MTH1-SEASON TO PV-SEASON                      09927003
101000            MOVE PV-MTH1-YEAR   TO PV-YEAR                        09928003
101100            SET PS-LN1-SLS-DLR   TO TRUE                          09929004
101200            PERFORM 9200-WRITE-RECORD                             09929103
101300         WHEN +100                                                09929203
101400            SET PS-END-OF-MTD1-NEW-CURSOR TO TRUE                 09929303
101500            EXEC SQL                                              09929403
101600               CLOSE NEW1-CSR                                     09929503
101700            END-EXEC                                              09929603
101800         WHEN OTHER                                               09929703
101900             MOVE '3210-PROCESS-LY1-NEW-VALUES' TO                09929803
102000                  PV-PARAGRAPH-NAME                               09929903
102100     END-EVALUATE.                                                09930003
102200                                                                  09931003
102300                                                                  09932003
102400******************************************************************09933003
102500*                                                                 09934003
102600*  PROCESS NEW STORES IF MULTIPLE MONTHS FOUND                    09935003
102700******************************************************************09936003
102800 3220-PROCESS-MTD2-NEW-VALUES.                                    09937003
102900     EXEC SQL                                                     09938003
103000         FETCH NEW2-CSR                                           09939003
103100         INTO  :WKMCLS-DEPT-NBR                                   09939103
103200              ,:WKMCLS-MAJ-CL-NBR                                 09939203
103300              ,:WKMCLS-FSCL-WK-NBR                                09939303
103400              ,:WKMCLS-SLS-RTL-AMT                                09939403
103500     END-EXEC.                                                    09939503
103600                                                                  09939603
103700     EVALUATE SQLCODE                                             09939703
103800         WHEN ZERO                                                09939803
103900            MOVE PV-MTH2-SEASON TO PV-SEASON                      09939903
104000            MOVE PV-MTH2-YEAR   TO PV-YEAR                        09940003
104100            SET  PS-LN2-SLS-DLR   TO TRUE                         09941004
104200            PERFORM 9200-WRITE-RECORD                             09942003
104300         WHEN +100                                                09943003
104400            SET PS-END-OF-MTD2-NEW-CURSOR TO TRUE                 09944003
104500            EXEC SQL                                              09945003
104600               CLOSE NEW2-CSR                                     09946003
104700            END-EXEC                                              09947003
104800         WHEN OTHER                                               09948003
104900             MOVE '3220-PROCESS-LY2-NEW-VALUES' TO                09949003
105000                  PV-PARAGRAPH-NAME                               09949103
105100     END-EVALUATE.                                                09949203
105200                                                                  09949303
105300                                                                  09949403
105400                                                                  09950000
105500******************************************************************11070000
105600*                                                                 11080000
105700*  READ CONTROL CARD TABLE                                        11090000
105800******************************************************************11100000
105900 9000-READ-CONTROL-CARD-FILE.                                     11110000
106000     READ CONTROL-CARD-FILE INTO CC-CONTROL-CARD                  11120000
106100         AT END SET PS-END-OF-CONTROL-CARDS TO TRUE.              11130000
106200                                                                  11140000
106300                                                                  11150000
106400***************************************************************** 11160000
106500*                                                                 11170000
106600*    WRITE INTO OUTPUT RECORD.                                    11180000
106700******************************************************************11190000
106800 9100-WRITE-RECORD.                                               11200000
106900     INITIALIZE BP150-RECORD                                      11200103
107000     INITIALIZE BP150-ACTUAL-SALES                                11200217
107100     INITIALIZE BP150-ACTUAL-SALES-LY                             11200317
107200     INITIALIZE BP150-ACTUAL-RECEIPTS                             11200417
107300     INITIALIZE COMPNEW-OUT-RECORD.                               11200517
107400     IF PS-NOT-E-BUS                                              11201003
107500         MOVE PC-PHYSSTR     TO BP150-ORGANIZATION-NAME1          11202003
107600     ELSE                                                         11203003
107700         MOVE PC-VIRTSTR     TO BP150-ORGANIZATION-NAME1          11203103
107800     END-IF.                                                      11204003
107900     MOVE WKMCLS-DEPT-NBR    TO BP150-DEPARTMENT-NBR1             11210003
108000     MOVE WKMCLS-MAJ-CL-NBR  TO BP150-CLASS-NBR1                  11220003
108100     MOVE PV-SEASON          TO BP150-SEASON1                     11230003
108200     MOVE PV-YEAR            TO BP150-YEAR1                       11240003
108300     MOVE WKMCLS-FSCL-WK-NBR TO BP150-WEEK-NBR1                   11270003
108400                                                                  11271003
108500     EVALUATE PS-SLS-DLR-IND                                      11280015
108600       WHEN 'C1 '                                                 11300016
108700          DIVIDE WKMCLS-SLS-RTL-AMT BY 1000                       11300303
108800                                    GIVING BP150-C-SLS-DLR        11300403
108900          MOVE ZEROES               TO  BP150-N-SLS-DLR           11300519
109000       WHEN 'C2 '                                                 11301016
109100          DIVIDE WKMCLS-SLS-RTL-AMT BY 1000                       11301103
109200                                    GIVING BP150-C-SLS-DLR        11301203
109300          MOVE ZEROES               TO  BP150-N-SLS-DLR           11301319
109400       WHEN 'N1 '                                                 11302016
109500          DIVIDE WKMCLS-SLS-RTL-AMT BY 1000                       11302103
109600                                    GIVING BP150-N-SLS-DLR        11302203
109700          MOVE ZEROES               TO  BP150-C-SLS-DLR           11302319
109800       WHEN 'N2 '                                                 11303016
109900          DIVIDE WKMCLS-SLS-RTL-AMT BY 1000                       11304003
110000                                    GIVING BP150-N-SLS-DLR        11305003
110100          MOVE ZEROES               TO  BP150-C-SLS-DLR           11305119
110200       WHEN OTHER                                                 11306003
110300          DISPLAY 'BAD SALES DOLLAR VARIABLE'                     11307003
110400     END-EVALUATE.                                                11310002
110500     WRITE COMPNEW-OUT-RECORD FROM BP150-ACTUAL-SALES.            11330017
110600                                                                  11340000
110700******************************************************************11400000
110800*                                                                 11401002
110900*  WRITE INTO OUTPUT LY RECORD                                    11402002
111000******************************************************************11403002
111100 9200-WRITE-RECORD.                                               11404002
111200     INITIALIZE BP150-RECORD                                      11404103
111300     INITIALIZE BP150-ACTUAL-SALES                                11404217
111400     INITIALIZE BP150-ACTUAL-SALES-LY                             11404317
111500     INITIALIZE BP150-ACTUAL-RECEIPTS                             11404417
111600     INITIALIZE LY-OUT-RECORD.                                    11404517
111700     IF PS-NOT-E-BUS                                              11404617
111800         MOVE PC-PHYSSTR     TO BP150-ORGANIZATION-NAME4          11404717
111900     ELSE                                                         11404817
112000         MOVE PC-VIRTSTR     TO BP150-ORGANIZATION-NAME4          11404917
112100     END-IF.                                                      11405017
112200     MOVE WKMCLS-DEPT-NBR    TO BP150-DEPARTMENT-NBR4             11405117
112300     MOVE WKMCLS-MAJ-CL-NBR  TO BP150-CLASS-NBR4                  11406003
112400     MOVE PV-SEASON          TO BP150-SEASON4                     11409003
112500     MOVE PV-YEAR            TO BP150-YEAR4                       11409103
112600     MOVE WKMCLS-FSCL-WK-NBR TO BP150-WEEK-NBR4                   11409203
112700     EVALUATE PS-SLS-DLR-IND                                      11409314
112800       WHEN 'LC1'                                                 11409416
112900          DIVIDE WKMCLS-SLS-RTL-AMT BY 1000                       11409503
113000                                    GIVING BP150-C-SLS-DLR-LY     11409603
113100          MOVE ZEROES               TO  BP150-N-SLS-DLR-LY        11409719
113200       WHEN 'LC2'                                                 11409816
113300          DIVIDE WKMCLS-SLS-RTL-AMT BY 1000                       11409903
113400                                    GIVING BP150-C-SLS-DLR-LY     11410003
113500          MOVE ZEROES               TO  BP150-N-SLS-DLR-LY        11410119
113600       WHEN 'LN1'                                                 11410216
113700          DIVIDE WKMCLS-SLS-RTL-AMT BY 1000                       11410303
113800                                    GIVING BP150-N-SLS-DLR-LY     11410403
113900          MOVE ZEROES               TO  BP150-C-SLS-DLR-LY        11410519
114000       WHEN 'LN2'                                                 11410616
114100          DIVIDE WKMCLS-SLS-RTL-AMT BY 1000                       11410703
114200                                    GIVING BP150-N-SLS-DLR-LY     11410803
114300          MOVE ZEROES               TO  BP150-C-SLS-DLR-LY        11410919
114400       WHEN OTHER                                                 11411003
114500          DISPLAY 'BAD SALES DOLLAR VARIABLE'                     11411103
114600     END-EVALUATE.                                                11411203
114700     WRITE LY-OUT-RECORD FROM BP150-ACTUAL-SALES-LY.              11411317
114800                                                                  11411403
114900******************************************************************11411503
115000*                                                                 11412002
115100*   GET LAST YEAR DATE                                            11420000
115200******************************************************************11430000
115300 9200-GET-LY-DATES.                                               11440000
115400     MOVE PV-MTH1-YEAR    TO PV-YEAR-NBR-NUM                      11450000
115500     ADD 1                TO PV-YEAR-NBR-NUM                      11460000
115600     MOVE PV-YEAR-NBR-NUM TO PV-MTH1-YEAR                         11470000
115700                                                                  11480000
115800     EXEC SQL                                                     11490000
115900          SELECT DISTINCT                                         11500000
116000              FSCL_MN_END_DTE                                     11510000
116100             ,SEA_BEG_DTE                                         11520000
116200          INTO                                                    11530000
116300              :DTATTR-FSCL-MN-END-DTE                             11540000
116400             ,:DTATTR-SEA-BEG-DTE                                 11550000
116500          FROM                                                    11560000
116600              TDTATTR                                             11570000
116700          WHERE                                                   11580000
116800              FSCL_YR_NBR = :PV-MTH1-YEAR                         11590000
116900          AND FSCL_MN_NBR = :PV-MTH1-MONTH-NBR                    11600000
117000     END-EXEC.                                                    11610000
117100                                                                  11620000
117200     EVALUATE TRUE                                                11630000
117300         WHEN SQLCODE = ZERO                                      11640000
117400             MOVE DTATTR-FSCL-MN-END-DTE TO PV-MTH1-COMP-DTE      11650000
117500             MOVE DTATTR-SEA-BEG-DTE     TO PV-MTH1-SEAS-BEG-DTE  11660000
117600         WHEN OTHER                                               11670000
117700             DISPLAY '** DTATTR-KY-DTE: ' DTATTR-KY-DTE           11680000
117800             MOVE    '9200-GET-LY-DATES'                          11690000
117900                                          TO PV-PARAGRAPH-NAME    11700000
118000             MOVE    'SELECT ROW FROM TDTATTR'                    11710000
118100                                          TO PV-DB2-OPER-ATTEMPTED11720000
118200             PERFORM 9999-SQL-ABEND                               11730000
118300     END-EVALUATE.                                                11740000
118400                                                                  11750000
118500     IF PS-MULTIPLE-MONTHS                                        11760000
118600       MOVE PV-MTH2-YEAR    TO PV-YEAR-NBR-NUM                    11770000
118700       ADD 1                TO PV-YEAR-NBR-NUM                    11780000
118800       MOVE PV-YEAR-NBR-NUM TO PV-MTH2-YEAR                       11790000
118900                                                                  11800000
119000       EXEC SQL                                                   11810000
119100            SELECT DISTINCT                                       11820000
119200                FSCL_MN_END_DTE                                   11830000
119300               ,SEA_BEG_DTE                                       11840000
119400            INTO                                                  11850000
119500                :DTATTR-FSCL-MN-END-DTE                           11860000
119600               ,:DTATTR-SEA-BEG-DTE                               11870000
119700            FROM                                                  11880000
119800                TDTATTR                                           11890000
119900            WHERE                                                 11900000
120000                FSCL_YR_NBR = :PV-MTH2-YEAR                       11910000
120100            AND FSCL_MN_NBR = :PV-MTH2-MONTH-NBR                  11920000
120200       END-EXEC                                                   11930000
120300                                                                  11940000
120400       EVALUATE TRUE                                              11950000
120500           WHEN SQLCODE = ZERO                                    11960000
120600               MOVE DTATTR-FSCL-MN-END-DTE TO PV-MTH2-COMP-DTE    11970000
120700               MOVE DTATTR-SEA-BEG-DTE     TO PV-MTH2-SEAS-BEG-DTE11980000
120800           WHEN OTHER                                             11990000
120900               DISPLAY '** DTATTR-KY-DTE: ' DTATTR-KY-DTE         12000000
121000               MOVE    '9200-GET-LY-DATES'                        12010000
121100                                            TO PV-PARAGRAPH-NAME  12020000
121200               MOVE    'SELECT ROW FROM TDTATTR'                  12030000
121300                                          TO PV-DB2-OPER-ATTEMPTED12040000
121400               PERFORM 9999-SQL-ABEND                             12050000
121500       END-EVALUATE                                               12060000
121600     END-IF.                                                      12070000
121700                                                                  12080000
121800                                                                  12090000
121900******************************************************************12100000
122000*                                                                *12110000
122100*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL   *12120000
122200*                  ERROR OR WARNING CODE OCCURS                  *12130000
122300*                                                                *12140000
122400******************************************************************12150000
122500 9999-SQL-ABEND.                                                  12160000
122600                                                                  12170000
122700     MOVE SQLCODE        TO  SQLCODE2.                            12180000
122800     MOVE SQLERRD(3)     TO  SQLERRD3.                            12190000
122900                                                                  12200000
123000     DISPLAY '***************************'                        12210000
123100     DISPLAY '**       ABEND           **'                        12220000
123200     DISPLAY '**  IN PROGRAM BPKUT492  **'                        12230002
123300     DISPLAY '***************************'                        12240000
123400     DISPLAY '** PARAGRAPH **      = ' PV-PARAGRAPH-NAME          12250000
123500     DISPLAY '** OPERATION **      = ' PV-DB2-OPER-ATTEMPTED      12260000
123600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  12270000
123700     DISPLAY '** SQLCODE **        = ' SQLCODE2.                  12280000
123800                                                                  12290000
123900     MOVE +4013         TO PV-ABEND-CODE.                         12300000
124000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         12310000
