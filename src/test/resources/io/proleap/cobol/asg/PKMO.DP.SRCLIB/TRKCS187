000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    TRKCS187.                                         00040099
000500 AUTHOR.        NIRMAL KUMAR.                                     00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  02-19-98.                                         00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    Y187 - CONTAINER LIST PROGRAM.                             * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM GENERATES A LIST OF ALL OCCURENCES OF A       * 00130099
001400*    CONTAINER BY VOYAGE. THE APPROPRIATE PROGRAM IS INVOKED    * 00140099
001500*    WHEN THE OPERATOR SELECTS ONE OR MORE ITEMS AND PRESSES    * 00150099
001600*    A FUNCTION KEY.                                            * 00160099
001700*                                                               * 00170099
001800*---------------------------------------------------------------* 00180099
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED  1/16/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001900 EJECT                                                            00190099
002000 ENVIRONMENT DIVISION.                                            00200099
002100                                                                  00210099
002200 DATA DIVISION.                                                   00220099
002300                                                                  00230099
002400 WORKING-STORAGE SECTION.                                         00240099
002500                                                                  00250099
002600 01  DK-DB2-KEYS.                                                 00260099
002700     15  DK-CONTNR-NO                   PIC  X(12)  VALUE SPACE.  00270099
002800*                                                                 00280099
002900 01  PC-PROGRAM-CONSTANTS.                                        00290099
003000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00300099
003100                                                    'TR187A  '.   00310099
003200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00320099
003300                                                    'TRKM187 '.   00330099
003400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00340099
003500                                                    'TRKCS187'.   00350099
003600     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00360099
003700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00370099
003800     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00380099
003900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00390099
004000                                                    COMP SYNC.    00400099
004100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00410099
004200                                                    COMP SYNC.    00420099
004300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00430099
004400                                                    +1000000      00440099
004500                                                    COMP-3.       00450099
004600     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00460099
004700                                                    COMP SYNC.    00470099
004800     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00480099
004900                                                    COMP-3.       00490099
005000     05  PC-INIT-DATE                   PIC  X(10)  VALUE         00500099
005100                                                    '0001-01-01'. 00510099
005200     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00520099
005300                                                                  00530099
005400     05  PC-TSYMSG-NUMBERS.                                       00540099
005500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00550099
005600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00560099
005700         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00570099
005800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00580099
005900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00590099
006000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00600099
006100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00610099
006200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00620099
006300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00630099
006400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00640099
006500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00650099
006600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00660099
006700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00670099
006800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00680099
006900*                                                                 00690099
007000 01  PS-PROGRAM-SWITCHES.                                         00700099
007100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00710099
007200         88  PS-NO-ERROR                            VALUE 'Y'.    00720099
007300         88  PS-ERROR                               VALUE 'N'.    00730099
007400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00740099
007500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00750099
007600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00760099
007700*                                                                 00770099
007800 01  PV-PROGRAM-VARIABLES.                                        00780099
007900     05  PV-SUB                         PIC S9(04)  VALUE +0      00790099
008000                                                    COMP SYNC.    00800099
008100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00810099
008200                                                    COMP SYNC.    00820099
008300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00830099
008400                                                    COMP-3.       00840099
008500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00850099
008600                                                    COMP-3.       00860099
008700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00870099
008800                                                    COMP-3.       00880099
008900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00890099
009000                                                    COMP-3.       00900099
009100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00910099
009200                                                    COMP-3.       00920099
009300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00930099
009400                                                    COMP-3.       00940099
009500     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      00950099
009600                                                    COMP-3.       00960099
009700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00970099
009800                                                    COMP SYNC.    00980099
009900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00990099
010000                                                    COMP SYNC.    01000099
010100     05  PV-ITEM                        PIC S9(04)  VALUE +0      01010099
010200                                                    COMP SYNC.    01020099
010300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01030099
010400                                                    COMP SYNC.    01040099
010500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01050099
010600                                                    COMP SYNC.    01060099
010700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01070099
010800                                                    COMP SYNC.    01080099
010900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01090099
011000                                                    COMP SYNC.    01100099
011100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01110099
011200                                                    COMP SYNC.    01120099
011300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01130099
011400                                                    COMP SYNC.    01140099
011500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01150099
011600                                                    COMP SYNC.    01160099
011700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01170099
011800                                                    COMP SYNC.    01180099
011900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01190099
012000                                                    COMP SYNC.    01200099
012100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01210099
012200                                                    COMP SYNC.    01220099
012300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01230099
012400                                                    COMP SYNC.    01240099
012500     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01250099
012600                                                    COMP SYNC.    01260099
012700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01270099
012800                                                    COMP SYNC.    01280099
012900     05  PV-DATE-BREAK.                                           01290099
013000         10 FILLER                      PIC  X(02).               01300099
013100         10 PV-DB-YY                    PIC  X(02).               01310099
013200         10 FILLER                      PIC  X(01).               01320099
013300         10 PV-DB-MM                    PIC  X(02).               01330099
013400         10 FILLER                      PIC  X(01).               01340099
013500         10 PV-DB-DD                    PIC  X(02).               01350099
013600                                                                  01360099
013700     05 PV-DATE-DISPLAY.                                          01370099
013800         10 PV-DD-MM                    PIC  X(02).               01380099
013900         10 FILLER                      PIC  X(01)  VALUE '/'.    01390099
014000         10 PV-DD-DD                    PIC  X(02).               01400099
014100         10 FILLER                      PIC  X(01)  VALUE '/'.    01410099
014200         10 PV-DD-YY                    PIC  X(02).               01420099
014300**--------------------------------------------------------------**01430099
014400**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01440099
014500**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01450099
014600**  APPLICATION-SPECIFIC COMMAREA.                              **01460099
014700**--------------------------------------------------------------**01470099
014800 01  LQW-LIST-QUEUE-WORK-AREA.                                    01480099
014900     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01490099
015000     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01500099
015100                                        INDEXED BY LQW-IDX.       01510099
015200         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01520099
015300         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01530099
015400         10  LQW-SELECTED-SW            PIC  X(01).               01540099
015500             88  LQW-SELECT                         VALUE 'S'.    01550099
015600             88  LQW-DESELECT                       VALUE ' '.    01560099
015700         10  LQW-ACTION                 PIC  X(03).               01570099
015800         10  LQW-VSL-NAME               PIC  X(25).               01580099
015900         10  LQW-TRIP-TYP-CDE           PIC  X(01).               01590099
016000         10  LQW-VOY-NBR                PIC  X(10).               01600099
016100         10  LQW-SCAC                   PIC  X(04).               01610099
016200         10  LQW-ATD                    PIC  X(08).               01620099
016300         10  LQW-ETA                    PIC  X(08).               01630099
016400         10  LQW-ATA                    PIC  X(08).               01640099
016500         10  LQW-CONTNR-SEQ-NO          PIC S9(04) COMP.          01650099
016600                                                                  01660099
016700 EJECT                                                            01670099
016800*---------------------------------------------------------------* 01680099
016900*  RECORD LAYOUT FOR THE VOYAGE  SELECTION TEMP STORAGE QUEUE.  * 01690099
017000*---------------------------------------------------------------* 01700099
017100                                                                  01710099
017200     COPY TRWS101.                                                01720099
017300                                                                  01730099
017400 EJECT                                                            01740099
017500*---------------------------------------------------------------* 01750099
017600*    MAP LAYOUT                                                 * 01760099
017700*---------------------------------------------------------------* 01770099
017800                                                                  01780099
017900     COPY TRKM187.                                                01790099
018000*                                                                 01800099
018100 01  MR-OCCURS-LAYOUT                   REDEFINES  TR187AO.       01810099
018200     05  FILLER                         PIC X(59).                01820099
018300     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          01830099
018400         10  MR-SELECTL                 PIC S9(04) COMP.          01840099
018500         10  MR-SELECTA                 PIC  X(01).               01850099
018600         10  MR-SELECTC                 PIC  X(01).               01860099
018700         10  MR-SELECTH                 PIC  X(01).               01870099
018800         10  MR-SELECTI                 PIC  X(01).               01880099
018900                                                                  01890099
019000         10  MR-ACTIONL                 PIC S9(04) COMP.          01900099
019100         10  MR-ACTIONA                 PIC  X(01).               01910099
019200         10  MR-ACTIONC                 PIC  X(01).               01920099
019300         10  MR-ACTIONH                 PIC  X(01).               01930099
019400         10  MR-ACTION                  PIC  X(03).               01940099
019500                                                                  01950099
019600         10  MR-VSL-NAMEL               PIC S9(04) COMP.          01960099
019700         10  MR-VSL-NAMEA               PIC  X(01).               01970099
019800         10  MR-VSL-NAMEC               PIC  X(01).               01980099
019900         10  MR-VSL-NAMEH               PIC  X(01).               01990099
020000         10  MR-VSL-NAME                PIC  X(25).               02000099
020100                                                                  02010099
020200         10  MR-TRIP-TYP-CDEL           PIC S9(04) COMP.          02020099
020300         10  MR-TRIP-TYP-CDEA           PIC  X(01).               02030099
020400         10  MR-TRIP-TYP-CDEC           PIC  X(01).               02040099
020500         10  MR-TRIP-TYP-CDEH           PIC  X(01).               02050099
020600         10  MR-TRIP-TYP-CDE            PIC  X(01).               02060099
020700                                                                  02070099
020800         10  MR-VOY-NBRL                PIC S9(04) COMP.          02080099
020900         10  MR-VOY-NBRA                PIC  X(01).               02090099
021000         10  MR-VOY-NBRC                PIC  X(01).               02100099
021100         10  MR-VOY-NBRH                PIC  X(01).               02110099
021200         10  MR-VOY-NBR                 PIC  X(10).               02120099
021300                                                                  02130099
021400         10  MR-SCACL                   PIC S9(04) COMP.          02140099
021500         10  MR-SCACA                   PIC  X(01).               02150099
021600         10  MR-SCACC                   PIC  X(01).               02160099
021700         10  MR-SCACH                   PIC  X(01).               02170099
021800         10  MR-SCAC                    PIC  X(04).               02180099
021900                                                                  02190099
022000         10  MR-ATDL                    PIC S9(04) COMP.          02200099
022100         10  MR-ATDA                    PIC  X(01).               02210099
022200         10  MR-ATDC                    PIC  X(01).               02220099
022300         10  MR-ATDH                    PIC  X(01).               02230099
022400         10  MR-ATD                     PIC  X(08).               02240099
022500                                                                  02250099
022600         10  MR-ETAL                    PIC S9(04) COMP.          02260099
022700         10  MR-ETAA                    PIC  X(01).               02270099
022800         10  MR-ETAC                    PIC  X(01).               02280099
022900         10  MR-ETAH                    PIC  X(01).               02290099
023000         10  MR-ETA                     PIC  X(08).               02300099
023100                                                                  02310099
023200         10  MR-ATAL                    PIC S9(04) COMP.          02320099
023300         10  MR-ATAA                    PIC  X(01).               02330099
023400         10  MR-ATAC                    PIC  X(01).               02340099
023500         10  MR-ATAH                    PIC  X(01).               02350099
023600         10  MR-ATA                     PIC  X(08).               02360099
023700                                                                  02370099
023800     05  FILLER                         PIC  X(12).               02380099
023900                                                                  02390099
024000     EJECT                                                        02400099
024100*---------------------------------------------------------------* 02410099
024200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02420099
024300*---------------------------------------------------------------* 02430099
024400                                                                  02440099
024500     COPY DPWS015.                                                02450099
024600                                                                  02460099
024700*---------------------------------------------------------------* 02470099
024800*    FUNCTION KEYS COPYBOOK.                                    * 02480099
024900*---------------------------------------------------------------* 02490099
025000                                                                  02500099
025100     COPY DPWS016.                                                02510099
025200                                                                  02520099
025300*---------------------------------------------------------------* 02530099
025400*    NUMERIC EDIT LAYOUT.                                       * 02540099
025500*---------------------------------------------------------------* 02550099
025600                                                                  02560099
025700     COPY DPWS010I.                                               02570099
025800                                                                  02580099
025900*---------------------------------------------------------------* 02590099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02600099
026100*---------------------------------------------------------------* 02610099
026200                                                                  02620099
026300     COPY DPWS030.                                                02630099
CICS       COPY DPWS930.                                                        
026400 EJECT                                                            02640099
026500*---------------------------------------------------------------* 02650099
026600*    STANDARD COMMAREA.                                         * 02660099
026700*---------------------------------------------------------------* 02670099
026800                                                                  02680099
026900     COPY DPWS020.                                                02690099
027000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02700099
027100                                                                  02710099
027200*---------------------------------------------------------------* 02720099
027300* INTER-APPLICATION COMMAREA.                                   * 02730099
027400*   TRWS186 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02740099
027500*             SPEC SCREEN.                                      * 02750099
027600*   TRWS102 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02760099
027700*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02770099
027800*---------------------------------------------------------------* 02780099
027900                                                                  02790099
028000         10  INTER-APPL-COMM-AREA       PIC X(200).               02800099
028100     COPY TRWS186.                                                02810099
028200     COPY TRWS102.                                                02820099
028300*---------------------------------------------------------------* 02830099
028400*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02840099
028500*---------------------------------------------------------------* 02850099
028600         10  ASC-SPECIFIC-COMMAREA.                               02860099
028700             15  ASC-LIST-KEYS.                                   02870099
028800                 20  ASC-KEY-CONTNR-NO               PIC  X(12).  02880099
028900                 20  ASC-KEY-CONTNR-SEQ-NO           PIC S9(04)   02890099
029000                                                          COMP.   02900099
029100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02910099
029200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02920099
029300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02930099
029400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02940099
029500                                                                  02950099
029600                 20  ASC-ITEM-ARRAY.                              02960099
029700                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        02970099
029800                         30  ASC-LIST-ITEM-NUMBER                 02980099
029900                                                     PIC S9(09)   02990099
030000                                                     COMP-3.      03000099
030100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03010099
030200                             88  ASC-VALID-SELECT    VALUE ' '    03020099
030300                                                           'S'    03030099
030400                                                           'B'    03040099
030500                                                           'E'.   03050099
030600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03060099
030700                             88  ASC-TEMP-SELECT     VALUE 'S'.   03070099
030800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03080099
030900                             88  ASC-TEMP-END        VALUE 'E'.   03090099
031000                         30  ASC-SELECTED-SW         PIC  X(01).  03100099
031100                             88  ASC-NO-SELECT       VALUE ' '.   03110099
031200                             88  ASC-SELECT          VALUE 'S'.   03120099
031300                             88  ASC-BEGIN           VALUE 'B'.   03130099
031400                             88  ASC-END             VALUE 'E'.   03140099
031500                         30  ASC-ACTION              PIC  X(03).  03150099
031600                         30  ASC-VSL-NAME            PIC  X(25).  03160099
031700                         30  ASC-TRIP-TYP-CDE        PIC  X(01).  03170099
031800                         30  ASC-VOY-NBR             PIC  X(10).  03180099
031900                         30  ASC-SCAC                PIC  X(04).  03190099
032000                         30  ASC-ATD                 PIC  X(08).  03200099
032100                         30  ASC-ETA                 PIC  X(08).  03210099
032200                         30  ASC-ATA                 PIC  X(08).  03220099
032300                         30  ASC-CONTNR-SEQ-NO       PIC S9(04)   03230099
032400                                                          COMP.   03240099
032500                                                                  03250099
032600             15  ASC-BLK-SUB                         PIC S9(04)   03260099
032700                                                          COMP    03270099
032800                                                          SYNC.   03280099
032900             15  ASC-ITEM-SUB                        PIC S9(04)   03290099
033000                                                          COMP    03300099
033100                                                          SYNC.   03310099
033200             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03320099
033300                                                          COMP-3. 03330099
033400             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03340099
033500                                                          COMP-3. 03350099
033600             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03360099
033700                                                          COMP-3. 03370099
033800             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03380099
033900                                                          COMP-3. 03390099
034000             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03400099
034100                                                          COMP-3. 03410099
034200             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03420099
034300                                                          COMP    03430099
034400                                                          SYNC.   03440099
034500             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03450099
034600                                                          COMP-3. 03460099
034700             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03470099
034800                                                          COMP-3. 03480099
034900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03490099
035000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03500099
035100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03510099
035200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03520099
035300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03530099
035400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03540099
035500             15  ASC-LIST-QUEUE-NAME.                             03550099
035600                 20  ASC-LIST-TERM-ID                PIC  X(04).  03560099
035700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03570099
035800                                                          COMP-3. 03580099
035900                 20  ASC-LIST-SEQ                    PIC  9(01).  03590099
036000             15  ASC-SEL-QUEUE-NAME.                              03600099
036100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03610099
036200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03620099
036300                                                          COMP-3. 03630099
036400                 20  ASC-SEL-SEQ                     PIC  9(01).  03640099
036500                                                                  03650099
036600             15  ASC-START-ITEM-REQUEST.                          03660099
036700                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03670099
036800     EJECT                                                        03680099
036900*---------------------------------------------------------------* 03690099
037000*    ABEND PROCESSING COPYBOOK.                                 * 03700099
037100*---------------------------------------------------------------* 03710099
037200                                                                  03720099
037300     COPY DPWS013.                                                03730099
037400                                                                  03740099
037500 EJECT                                                            03750099
037600*---------------------------------------------------------------* 03760099
037700*    DB2 AREA FOR TIMCNTK                                       * 03770099
037800*---------------------------------------------------------------* 03780099
037900     EXEC SQL                                                     03790099
038000          INCLUDE TIMCNTK                                         03800099
038100     END-EXEC.                                                    03810099
038200*---------------------------------------------------------------* 03820099
038300*    DB2 AREA FOR COMMUNICATIONS                                * 03830099
038400*---------------------------------------------------------------* 03840099
038500     EXEC SQL                                                     03850099
038600          INCLUDE SQLCA                                           03860099
038700     END-EXEC.                                                    03870099
038800                                                                  03880099
038900*---------------------------------------------------------------* 03890099
039000*    CURSOR WHEN CONTAINER NUMBER IS REQUESTED                  * 03900099
039100*---------------------------------------------------------------* 03910099
039200                                                                  03920099
039300     EXEC SQL                                                     03930099
039400          DECLARE CONTNR-NBR-CSR CURSOR                           03940099
039500          FOR SELECT                                              03950099
039600                MOM_IMPRT_VEH_NM                                  03960099
039700              , MOM_TRIP_TYP_CDE                                  03970099
039800              , MOM_IMPRT_TRIP_ID                                 03980099
039900              , MOM_CARR_SCAC_ID                                  03990099
040000              , FDR_DPRTR_TMST                                    04000099
040100              , MOM_DPRTR_TMST                                    04010099
040200              , MOM_POE_DELY_TMST                                 04020099
040210              , ACTL_POE_DELY_TMST                                        
040300*------ PROVISION FOR ATA FROM CUSTOMS LOAD DATA                  04030099
040400              , CONTNR_SEQ_NBR                                    04040099
040500          FROM                                                    04050099
040600                TIMCNTK                                           04060099
040700          WHERE                                                   04070099
040800                UPPER(CONTNR_ID)      = :DK-CONTNR-NO             04080099
040900          ORDER BY                                                04090099
041000                MOM_POE_DELY_TMST  DESC                           04100099
041100     END-EXEC.                                                    04110099
041200                                                                  04120099
041300 EJECT                                                            04130099
041400*                                                                 04140099
041500 LINKAGE SECTION.                                                 04150099
041600                                                                  04160099
041700 01  DFHCOMMAREA.                                                 04170099
041800     05  FILLER                         OCCURS  1 TO 4072 TIMES   04180099
041900                                        DEPENDING ON EIBCALEN.    04190099
042000         10  FILLER                     PIC X.                    04200099
042100                                                                  04210099
042200 EJECT                                                            04220099
042300*                                                                 04230099
042400 PROCEDURE DIVISION.                                              04240099
042500******************************************************************04250099
042600**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04260099
042700**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04270099
042800**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04280099
042900******************************************************************04290099
043000 0000-MAIN-MODULE.                                                04300099
043100     INITIALIZE DP030-CICS-API-FIELDS.                            04310099
043200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04320099
043300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04330099
043400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04340099
043500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04350099
043600     MOVE LENGTH OF TR187AI        TO DP030-MAP-LENGTH (1).       04360099
043700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04370099
043800     PERFORM 0001-CALL-CICS-ARCH-API.                             04380099
043900*                                                                 04390099
044000     PERFORM 1000-CONTROL-PROCESSING                              04400099
044100*                                                                 04410099
044200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04420099
044300     PERFORM 0001-CALL-CICS-ARCH-API.                             04430099
044400                                                                  04440099
044500******************************************************************04450099
044600**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04460099
044700**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04470099
044800******************************************************************04480099
044900 0001-CALL-CICS-ARCH-API.                                         04490099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04500099
045100                                    DFHCOMMAREA                           
045200                                    DP030-CICS-API-FIELDS                 
045300                                    DP020-STANDARD-COMMAREA               
045400                                    TR187AI.                              
045500*                                                                 04550099
045600     IF  DP030-RC-CALL-SUCCESSFUL                                 04560099
045700         CONTINUE                                                 04570099
045800     ELSE                                                         04580099
045900         SET DP013-NO-ROLLBACK                                    04590099
046000             DP013-XCTL-DISPLAY-RESTART                           04600099
046100             DP013-CICS-ABEND      TO TRUE                        04610099
046200         MOVE '0001-CALL-CICS-ARCH-API'                           04620099
046300                                   TO DP013-PARAGRAPH             04630099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04640099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04650099
046600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04660099
046700         PERFORM DP013-0000-PROCESS-ABEND                         04670099
046800     END-IF.                                                      04680099
046900*----------------------------------------------------------------*04690099
047000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04700099
047100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04710099
047200*                                                                *04720099
047300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04730099
047400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04740099
047500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04750099
047600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04760099
047700*----------------------------------------------------------------*04770099
047800                                                                  04780099
047900 1000-CONTROL-PROCESSING.                                         04790099
048000                                                                  04800099
048100     EVALUATE TRUE                                                04810099
048200         WHEN DP020-NEXT-ACT-INITIAL                              04820099
048300             INITIALIZE ASC-SPECIFIC-COMMAREA                     04830099
048400             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04840099
048500                                      ASC-SEL-TERM-ID             04850099
048600             MOVE DP020-SRC-TASK-NUMBER                           04860099
048700                                   TO ASC-LIST-TASK-NUMBER        04870099
048800                                      ASC-SEL-TASK-NUMBER         04880099
048900             MOVE PC-LIST-QUEUE-SEQ                               04890099
049000                                   TO ASC-LIST-SEQ                04900099
049100             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 04910099
049200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04920099
049300***-----$TEMPLATE NOTE$-------------------------------------------04930099
049400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04940099
049500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04950099
049600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04960099
049700***---------------------------------------------------------------04970099
049800             IF  PS-COMMAREA-NOT-VALID                            04980099
049900                 SET DP020-NEXT-ACT-APPL-ERROR                    04990099
050000                                   TO TRUE                        05000099
050100             ELSE                                                 05010099
050200                 PERFORM 4000-BUILD-INITIAL-PANEL                 05020099
050300             END-IF                                               05030099
050400                                                                  05040099
050500         WHEN DP020-NEXT-ACT-READ-MAP                             05050099
050600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05060099
050700                                   TO PV-TOP-ITEM                 05070099
050800             PERFORM 2000-PROCESS-PANEL                           05080099
050900                                                                  05090099
051000         WHEN DP020-NEXT-ACT-RETURN                               05100099
051100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05110099
051200                                   TO PV-TOP-ITEM                 05120099
051300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05130099
051400             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05140099
051500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05150099
051600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05160099
051700                                                                  05170099
051800         WHEN OTHER                                               05180099
051900             SET DP013-LOGIC-ABEND TO TRUE                        05190099
052000             SET DP013-NO-ROLLBACK TO TRUE                        05200099
052100             MOVE '1000-CONTROL-PROCESSING'                       05210099
052200                                   TO DP013-PARAGRAPH             05220099
052300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05230099
052400                                   TO DP013-MESSAGE-TEXT(1)       05240099
052500             PERFORM DP013-0000-PROCESS-ABEND                     05250099
052600     END-EVALUATE.                                                05260099
052700                                                                  05270099
052800 EJECT                                                            05280099
052900*----------------------------------------------------------------*05290099
053000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05300099
053100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05310099
053200*----------------------------------------------------------------*05320099
053300                                                                  05330099
053400 1100-PROCESS-INTER-APPL-COMM.                                    05340099
053500                                                                  05350099
053600     SET PS-COMMAREA-VALID         TO TRUE.                       05360099
053700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05370099
053800     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          05380099
053900         MOVE TR186-CONTNR-NO                                     05390099
054000                                   TO ASC-KEY-CONTNR-NO           05400099
054100                                      DK-CONTNR-NO                05410099
054200     END-IF.                                                      05420099
054300                                                                  05430099
054400 EJECT                                                            05440099
054500*----------------------------------------------------------------*05450099
054600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05460099
054700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05470099
054800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05480099
054900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05490099
055000* FUNCTION KEYS CAN GET THIS FAR.                                *05500099
055100*----------------------------------------------------------------*05510099
055200                                                                  05520099
055300 2000-PROCESS-PANEL.                                              05530099
055400     EVALUATE TRUE                                                05540099
055500         WHEN DP020-SRC-AID = DP016-CLEAR                         05550099
055600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05560099
055700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05570099
055800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05580099
055900                                                                  05590099
056000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05600099
056100             MOVE ASC-KEY-CONTNR-NO                               05610099
056200                                   TO DK-CONTNR-NO                05620099
056300             PERFORM 2050-DELETE-LIST-QUEUE                       05630099
056400             PERFORM 4000-BUILD-INITIAL-PANEL                     05640099
056500                                                                  05650099
056600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    05660099
056700             PERFORM 2140-DESELECT-ALL-ITEMS                      05670099
056800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05680099
056900                                                                  05690099
057000         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  05700099
057100             PERFORM 2150-SELECT-ALL-ITEMS                        05710099
057200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05720099
057300                                                                  05730099
057400         WHEN OTHER                                               05740099
057500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05750099
057600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05760099
057700             IF  PS-NO-ERROR                                      05770099
057800                 SET DP030-CONTINUE-GO                            05780099
057900                                 TO TRUE                          05790099
058000                 PERFORM 2100-CHECK-FUNCTION-KEY                  05800099
058100             ELSE                                                 05810099
058200                 SET DP030-OVERRIDE-GO                            05820099
058300                                 TO TRUE                          05830099
058400             END-IF                                               05840099
058500     END-EVALUATE.                                                05850099
058600 EJECT                                                            05860099
058700*----------------------------------------------------------------*05870099
058800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05880099
058900*----------------------------------------------------------------*05890099
059000 2050-DELETE-LIST-QUEUE.                                          05900099
059100                                                                  05910099
059200     EXEC CICS                                                    05920099
059300         DELETEQ TS                                               05930099
059400             QUEUE (ASC-LIST-QUEUE-NAME)                          05940099
059500             RESP  (PV-CICS-RESP)                                 05950099
059600     END-EXEC.                                                    05960099
059700                                                                  05970099
059800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05980099
059900        (PV-CICS-RESP = DFHRESP(QIDERR))                          05990099
060000         CONTINUE                                                 06000099
060100     ELSE                                                         06010099
060200         SET DP013-CICS-ABEND      TO TRUE                        06020099
060300         SET DP013-NO-ROLLBACK     TO TRUE                        06030099
060400                                                                  06040099
060500         MOVE '2050-DELETE-LIST-QUEUE'                            06050099
060600                                   TO DP013-PARAGRAPH             06060099
060700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06070099
060800                                   TO DP013-MESSAGE-TEXT (1)      06080099
060900         PERFORM DP013-0000-PROCESS-ABEND                         06090099
061000     END-IF.                                                      06100099
061100                                                                  06110099
061200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06120099
061300 EJECT                                                            06130099
061400*----------------------------------------------------------------*06140099
061500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06150099
061600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06160099
061700* CICS ARCHITECTURE API.                                         *06170099
061800*----------------------------------------------------------------*06180099
061900 2100-CHECK-FUNCTION-KEY.                                         06190099
062000     EVALUATE TRUE                                                06200099
062100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06210099
062110         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              06210099
062120         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              06210099
062200            IF  ASC-NUMBER-OF-SELECTED-ITEMS = 1                  06220099
062300                INITIALIZE TR102-INTER-APPL-COMMAREA              06230099
062400                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                 06240099
062500                                TO TR102-NUMBER-OF-SELECTED-ITEMS 06250099
062600                MOVE ASC-KEY-CONTNR-NO                            06260099
062700                                TO TR102-CONTNR-NO                06270099
062800                PERFORM 5000-PREPARE-SEL-QUEUE                    06280099
062900            ELSE                                                  06290099
063000                IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1              06300099
063100                    SET DP030-OVERRIDE-GO                         06310099
063200                                   TO TRUE                        06320099
063300                    MOVE PC-TSYMSG-00047                          06330099
063400                                   TO DP020-MSG-NUMBER            06340099
063500                    SET DP020-MSG-WARNING                         06350099
063600                                   TO TRUE                        06360099
063700                ELSE                                              06370099
063800                    IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0          06380099
063900                        SET DP030-OVERRIDE-GO                     06390099
064000                                   TO TRUE                        06400099
064100                        MOVE PC-TSYMSG-00057                      06410099
064200                                   TO DP020-MSG-NUMBER            06420099
064300                        SET DP020-MSG-WARNING                     06430099
064400                                   TO TRUE                        06440099
064500                    END-IF                                        06450099
064600                END-IF                                            06460099
064700            END-IF                                                06470099
064701                                                                          
064900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06490099
065000             MOVE +1               TO PV-TOP-ITEM                 06500099
065100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06510099
065200             PERFORM 3200-RESET-ATTRIBUTES                        06520099
065300                                                                  06530099
065400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06540099
065500             PERFORM 2110-BROWSE-BACKWARD                         06550099
065600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06560099
065700             PERFORM 3200-RESET-ATTRIBUTES                        06570099
065800                                                                  06580099
065900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06590099
066000             PERFORM 2120-BROWSE-FORWARD                          06600099
066100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06610099
066200                                                                  06620099
066300         WHEN DP020-SRC-AID = DP016-ENTER                         06630099
066400             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06640099
066500             IF  PS-ERROR                                         06650099
066600                 CONTINUE                                         06660099
066700             ELSE                                                 06670099
066800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06680099
066900             END-IF                                               06690099
067000                                                                  06700099
067100         WHEN OTHER                                               06710099
067200             SET DP013-NO-ROLLBACK                                06720099
067300                 DP013-XCTL-DISPLAY-RESTART                       06730099
067400                 DP013-CICS-ABEND  TO TRUE                        06740099
067500             MOVE '2100-CHECK-FUNCTION-KEY'                       06750099
067600                                   TO DP013-PARAGRAPH             06760099
067700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06770099
067800                                   TO DP013-MESSAGE-TEXT (1)      06780099
067900             PERFORM DP013-0000-PROCESS-ABEND                     06790099
068000     END-EVALUATE.                                                06800099
068100*                                                                 06810099
068200*----------------------------------------------------------------*06820099
068300*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06830099
068400*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06840099
068500*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06850099
068600*    MESSAGE.                                                    *06860099
068700*----------------------------------------------------------------*06870099
068800                                                                  06880099
068900 2110-BROWSE-BACKWARD.                                            06890099
069000     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06900099
069100         GIVING PV-TOP-ITEM.                                      06910099
069200*                                                                 06920099
069300     IF  ((PV-TOP-ITEM < +1)                                      06930099
069400       OR (PV-TOP-ITEM = +1))                                     06940099
069500         MOVE +1                   TO PV-TOP-ITEM                 06950099
069600*---------- TOP OF LIST --                                        06960099
069700         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06970099
069800         SET DP020-MSG-INFORMATIONAL TO TRUE                      06980099
069900     END-IF.                                                      06990099
070000                                                                  07000099
070100 EJECT                                                            07010099
070200*----------------------------------------------------------------*07020099
070300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07030099
070400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07040099
070500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07050099
070600*----------------------------------------------------------------*07060099
070700                                                                  07070099
070800 2120-BROWSE-FORWARD.                                             07080099
070900                                                                  07090099
071000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07100099
071100         GIVING PV-TOP-ITEM.                                      07110099
071200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07120099
071300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07130099
071400                                   TO PV-TOP-ITEM                 07140099
071500*---------- BOTTOM OF LIST --                                     07150099
071600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07160099
071700         SET DP020-MSG-INFORMATIONAL                              07170099
071800                                   TO TRUE                        07180099
071900     ELSE                                                         07190099
072000         COMPUTE PV-BOTTOM-ITEM =                                 07200099
072100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07210099
072200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07220099
072300*-------------- BOTTOM OF LIST --                                 07230099
072400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07240099
072500             SET DP020-MSG-INFORMATIONAL                          07250099
072600                                   TO TRUE                        07260099
072700         END-IF                                                   07270099
072800     END-IF.                                                      07280099
072900 EJECT                                                            07290099
073000*----------------------------------------------------------------*07300099
073100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07310099
073200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07320099
073300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07330099
073400*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07340099
073500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07350099
073600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07360099
073700*----------------------------------------------------------------*07370099
073800                                                                  07380099
073900 2130-CHECK-FOR-JUMP-BROWSE.                                      07390099
074000     SET PS-NO-ERROR               TO TRUE.                       07400099
074100     IF (ASC-START-ITEM-REQUEST = SPACE)                          07410099
074200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07420099
074300                                   TO PV-TOP-ITEM                 07430099
074400     ELSE                                                         07440099
074500         MOVE ASC-START-ITEM-REQUEST                              07450099
074600                                   TO DP010I-UNEDITED-FIELD       07460099
074700         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07470099
074800         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07480099
074900         SET DP010I-NEGATIVE-NOT-ALLOWED                          07490099
075000                                   TO TRUE                        07500099
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
075200                                                                  07520099
075300         IF  NOT DP010I-ERROR-DETECTED                            07530099
075400             MOVE DP010I-NUMERIC-FIELD                            07540099
075500                                   TO  ASC-START-ITEM-REQUEST-N   07550099
075600             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07560099
075700                 IF  ASC-START-ITEM-REQUEST-N >                   07570099
075800                                          ASC-NUMBER-OF-ITEMS-READ07580099
075900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07590099
076000                     COMPUTE PV-TOP-ITEM =                        07600099
076100                             ASC-NUMBER-OF-ITEMS-READ             07610099
076200                             - PC-ITEMS-PER-PANEL + 1             07620099
076300                     IF  PV-TOP-ITEM < +1                         07630099
076400                         MOVE +1   TO PV-TOP-ITEM                 07640099
076500                         MOVE PC-TSYMSG-00070                     07650099
076600                                   TO DP020-MSG-NUMBER            07660099
076700                         SET DP020-MSG-INFORMATIONAL              07670099
076800                                   TO TRUE                        07680099
076900                     END-IF                                       07690099
077000                 ELSE                                             07700099
077100                     MOVE ASC-START-ITEM-REQUEST-N                07710099
077200                                   TO PV-TOP-ITEM                 07720099
077300                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07730099
077400                     COMPUTE PV-BOTTOM-ITEM =                     07740099
077500                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07750099
077600                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07760099
077700*                        -- BOTTOM OF LIST --                     07770099
077800                         MOVE PC-TSYMSG-00070                     07780099
077900                                   TO DP020-MSG-NUMBER            07790099
078000                         SET DP020-MSG-INFORMATIONAL              07800099
078100                                   TO TRUE                        07810099
078200                     END-IF                                       07820099
078300                 END-IF                                           07830099
078400             ELSE                                                 07840099
078500*                --- VALUE OUT OF RANGE ----                      07850099
078600                 MOVE PC-TSYMSG-00101                             07860099
078700                                   TO DP020-MSG-NUMBER            07870099
078800                 MOVE -1           TO ASTRTITL                    07880099
078900                 SET DP030-SET-CURSOR-APPL-1                      07890099
079000                                   TO TRUE                        07900099
079100                 MOVE DP015-REVERSE                               07910099
079200                                   TO ASTRTITH                    07920099
079300                 MOVE DP015-RED    TO ASTRTITC                    07930099
079400                 MOVE DP015-UNP-NUM-BRT-MDT                       07940099
079500                                   TO ASTRTITA                    07950099
079600                 SET DP020-MSG-FATAL                              07960099
079700                                   TO TRUE                        07970099
079800                 SET PS-ERROR      TO TRUE                        07980099
079900             END-IF                                               07990099
080000                                                                  08000099
080100         ELSE                                                     08010099
080200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08020099
080300             MOVE -1               TO ASTRTITL                    08030099
080400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08040099
080500             MOVE DP015-REVERSE    TO ASTRTITH                    08050099
080600             MOVE DP015-RED        TO ASTRTITC                    08060099
080700             MOVE DP015-UNP-NUM-BRT-MDT                           08070099
080800                                   TO ASTRTITA                    08080099
080900             SET DP020-MSG-FATAL   TO TRUE                        08090099
081000             SET PS-ERROR          TO TRUE                        08100099
081100         END-IF                                                   08110099
081200     END-IF.                                                      08120099
081300 EJECT                                                            08130099
081400*----------------------------------------------------------------*08140099
081500*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08150099
081600*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08160099
081700*----------------------------------------------------------------*08170099
081800 2140-DESELECT-ALL-ITEMS.                                         08180099
081900     MOVE +1                       TO ASC-BLK-SUB.                08190099
082000                                                                  08200099
082100     PERFORM 2141-CLEAR-SELECTED-INDS                             08210099
082200         VARYING ASC-ITEM-SUB                                     08220099
082300         FROM 1 BY 1                                              08230099
082400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08240099
082500                                                                  08250099
082600     ADD +1                        TO ASC-BLK-SUB.                08260099
082700                                                                  08270099
082800     PERFORM 2141-CLEAR-SELECTED-INDS                             08280099
082900         VARYING ASC-ITEM-SUB                                     08290099
083000         FROM 1 BY 1                                              08300099
083100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08310099
083200                                                                  08320099
083300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08330099
083400                                   TO PV-LIST-ITEM-NUMBER.        08340099
083500                                                                  08350099
083600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08360099
083700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08370099
083800                                                                  08380099
083900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08390099
084000        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08400099
084100         MOVE +1                   TO ASC-BLK-SUB                 08410099
084200                                                                  08420099
084300         PERFORM 5100-WRITE-TEMP-STORAGE                          08430099
084400                                                                  08440099
084500         MOVE +1                   TO PV-BLOCK-NUMBER             08450099
084600                                                                  08460099
084700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08470099
084800             PV-FIRST-BLOCK-IN-ARRAY - 1                          08480099
084900                                                                  08490099
085000         PERFORM                                                  08500099
085100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08510099
085200                                                                  08520099
085300             PERFORM 4410-READ-TEMP-STORAGE                       08530099
085400                                                                  08540099
085500             PERFORM 2141-CLEAR-SELECTED-INDS                     08550099
085600                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08560099
085700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08570099
085800                                                                  08580099
085900             PERFORM 5100-WRITE-TEMP-STORAGE                      08590099
086000                                                                  08600099
086100             ADD +1                TO PV-BLOCK-NUMBER             08610099
086200                                                                  08620099
086300         END-PERFORM                                              08630099
086400                                                                  08640099
086500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08650099
086600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08660099
086700                                                                  08670099
086800         PERFORM                                                  08680099
086900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08690099
087000                   ASC-HIGHEST-BLOCK-WRITTEN                      08700099
087100                                                                  08710099
087200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08720099
087300                                   TO PV-BLOCK-NUMBER             08730099
087400                                                                  08740099
087500             PERFORM 4410-READ-TEMP-STORAGE                       08750099
087600                                                                  08760099
087700             PERFORM 2141-CLEAR-SELECTED-INDS                     08770099
087800                 VARYING ASC-ITEM-SUB                             08780099
087900                 FROM 1 BY 1                                      08790099
088000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08800099
088100                                                                  08810099
088200             PERFORM 5100-WRITE-TEMP-STORAGE                      08820099
088300                                                                  08830099
088400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08840099
088500                                                                  08850099
088600         END-PERFORM                                              08860099
088700                                                                  08870099
088800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             08880099
088900                                   TO PV-BLOCK-NUMBER             08890099
089000                                                                  08900099
089100         PERFORM 4410-READ-TEMP-STORAGE                           08910099
089200     END-IF.                                                      08920099
089300                                                                  08930099
089400                                                                  08940099
089500     MOVE +0                    TO ASC-NUMBER-OF-SELECTED-ITEMS.  08950099
089600     MOVE +0                    TO ASC-START-OF-SELECTED-RANGE.   08960099
089700     MOVE +0                    TO ASC-END-OF-SELECTED-RANGE.     08970099
089800                                                                  08980099
089900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08990099
090000                                                                  09000099
090100 EJECT                                                            09010099
090200*----------------------------------------------------------------*09020099
090300*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09030099
090400*----------------------------------------------------------------*09040099
090500 2141-CLEAR-SELECTED-INDS.                                        09050099
090600                                                                  09060099
090700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09070099
090800             NOT EQUAL ZERO                                       09080099
090900         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09090099
091000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09100099
091100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09110099
091200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09120099
091300                                   TO TRUE                        09130099
091400         END-IF                                                   09140099
091500     END-IF.                                                      09150099
091600                                                                  09160099
091700 EJECT                                                            09170099
091800*----------------------------------------------------------------*09180099
091900*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09190099
092000*  FOR ALL ITEMS.                                                *09200099
092100*----------------------------------------------------------------*09210099
092200 2150-SELECT-ALL-ITEMS.                                           09220099
092300                                                                  09230099
092400     MOVE +1                       TO ASC-BLK-SUB.                09240099
092500                                                                  09250099
092600     PERFORM 2151-SET-SELECTED-INDS                               09260099
092700         VARYING ASC-ITEM-SUB                                     09270099
092800         FROM 1 BY 1                                              09280099
092900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09290099
093000                                                                  09300099
093100     ADD +1                        TO ASC-BLK-SUB.                09310099
093200                                                                  09320099
093300     PERFORM 2151-SET-SELECTED-INDS                               09330099
093400         VARYING ASC-ITEM-SUB                                     09340099
093500         FROM 1 BY 1                                              09350099
093600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09360099
093700                                                                  09370099
093800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09380099
093900                                   TO PV-LIST-ITEM-NUMBER.        09390099
094000                                                                  09400099
094100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09410099
094200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09420099
094300                                                                  09430099
094400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09440099
094500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09450099
094600         MOVE +1                   TO ASC-BLK-SUB                 09460099
094700                                                                  09470099
094800         PERFORM 5100-WRITE-TEMP-STORAGE                          09480099
094900                                                                  09490099
095000         MOVE +1                   TO PV-BLOCK-NUMBER             09500099
095100                                                                  09510099
095200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09520099
095300             PV-FIRST-BLOCK-IN-ARRAY - 1                          09530099
095400                                                                  09540099
095500         PERFORM                                                  09550099
095600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09560099
095700                                                                  09570099
095800             PERFORM 4410-READ-TEMP-STORAGE                       09580099
095900                                                                  09590099
096000             PERFORM 2151-SET-SELECTED-INDS                       09600099
096100                 VARYING ASC-ITEM-SUB                             09610099
096200                 FROM 1 BY 1                                      09620099
096300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09630099
096400                                                                  09640099
096500             PERFORM 5100-WRITE-TEMP-STORAGE                      09650099
096600                                                                  09660099
096700             ADD +1                TO PV-BLOCK-NUMBER             09670099
096800                                                                  09680099
096900         END-PERFORM                                              09690099
097000                                                                  09700099
097100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09710099
097200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09720099
097300                                                                  09730099
097400         PERFORM                                                  09740099
097500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09750099
097600                   ASC-HIGHEST-BLOCK-WRITTEN                      09760099
097700                                                                  09770099
097800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09780099
097900                                   TO PV-BLOCK-NUMBER             09790099
098000                                                                  09800099
098100             PERFORM 4410-READ-TEMP-STORAGE                       09810099
098200                                                                  09820099
098300             PERFORM 2151-SET-SELECTED-INDS                       09830099
098400                 VARYING ASC-ITEM-SUB                             09840099
098500                 FROM 1 BY 1                                      09850099
098600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09860099
098700                                                                  09870099
098800             PERFORM 5100-WRITE-TEMP-STORAGE                      09880099
098900                                                                  09890099
099000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09900099
099100                                                                  09910099
099200         END-PERFORM                                              09920099
099300                                                                  09930099
099400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09940099
099500                                   TO PV-BLOCK-NUMBER             09950099
099600                                                                  09960099
099700         PERFORM 4410-READ-TEMP-STORAGE                           09970099
099800     END-IF.                                                      09980099
099900                                                                  09990099
100000                                                                  10000099
100100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10010099
100200                       ASC-NUMBER-OF-SELECTED-ITEMS.              10020099
100300                                                                  10030099
100400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10040099
100500                                                                  10050099
100600 EJECT                                                            10060099
100700*----------------------------------------------------------------*10070099
100800*    MARK EACH ITEM AS BEING SELECTED.                           *10080099
100900*----------------------------------------------------------------*10090099
101000 2151-SET-SELECTED-INDS.                                          10100099
101100                                                                  10110099
101200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10120099
101300             NOT EQUAL ZERO                                       10130099
101400         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10140099
101500             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10150099
101600                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10160099
101700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10170099
101800                               TO  TRUE                           10180099
101900         END-IF                                                   10190099
102000     END-IF.                                                      10200099
102100******************************************************************10210099
102200** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10220099
102300** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10230099
102400******************************************************************10240099
102500 2200-MOVE-SCREEN-TO-COMMAREA.                                    10250099
102600                                                                  10260099
102700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10270099
102800     MOVE +1                       TO PV-SUB.                     10280099
102900*                                                                 10290099
103000     PERFORM 3100-SET-SUBSCRIPTS.                                 10300099
103100     IF  ASTRTITL > ZERO                                          10310099
103200         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10320099
103300     ELSE                                                         10330099
103400         IF  ASTRTITF = DP015-ERASE-EOF                           10340099
103500             INITIALIZE ASC-START-ITEM-REQUEST                    10350099
103600         END-IF                                                   10360099
103700     END-IF.                                                      10370099
103800     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10380099
103900         VARYING PV-SUB                                           10390099
104000         FROM 1 BY 1                                              10400099
104100         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10410099
104200******************************************************************10420099
104300** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**10430099
104400******************************************************************10440099
104500 2210-MOVE-LINES-TO-COMMAREA.                                     10450099
104600                                                                  10460099
104700     IF  MR-SELECTL (PV-SUB) > ZERO                               10470099
104800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10480099
104900         MOVE MR-SELECTI (PV-SUB)                                 10490099
105000                                   TO ASC-TEMP-SELECTED-SW        10500099
105100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10510099
105200     ELSE                                                         10520099
105300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10530099
105400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10540099
105500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10550099
105600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10560099
105700         END-IF                                                   10570099
105800     END-IF.                                                      10580099
105900     ADD +1                        TO ASC-ITEM-SUB.               10590099
106000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10600099
106100         ADD +1                    TO ASC-BLK-SUB                 10610099
106200         MOVE +1                   TO ASC-ITEM-SUB                10620099
106300     END-IF.                                                      10630099
106400******************************************************************10640099
106500** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10650099
106600** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **10660099
106700******************************************************************10670099
106800 3000-EDIT-DATA-IN-COMMAREA.                                      10680099
106900                                                                  10690099
107000     SET PS-NO-ERROR               TO TRUE.                       10700099
107100     PERFORM 3200-RESET-ATTRIBUTES.                               10710099
107200     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10720099
107300**                                                                10730099
107400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              10740099
107500* EDITTING IS DONE FROM THE BOTTOM UP.                            10750099
107600**                                                                10760099
107700     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       10770099
107800         ASC-ITEMS-DISPLAYED - 1.                                 10780099
107900     PERFORM 3100-SET-SUBSCRIPTS.                                 10790099
108000     PERFORM 3300-EDIT-SELECTIONS                                 10800099
108100         VARYING PV-SUB                                           10810099
108200         FROM PV-SUB BY -1                                        10820099
108300         UNTIL PV-SUB < +1                                        10830099
108400*                                                                 10840099
108500     IF  PS-NO-ERROR                                              10850099
108600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        10860099
108700     END-IF.                                                      10870099
108800*                                                                 10880099
108900     IF  ((PS-NO-ERROR)                                           10890099
109000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   10900099
109100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    10910099
109200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  10920099
109300     END-IF.                                                      10930099
109400 EJECT                                                            10940099
109500*----------------------------------------------------------------*10950099
109600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *10960099
109700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*10970099
109800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *10980099
109900*                                                                *10990099
110000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11000099
110100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11010099
110200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11020099
110300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11030099
110400*----------------------------------------------------------------*11040099
110500 3100-SET-SUBSCRIPTS.                                             11050099
110600                                                                  11060099
110700     COMPUTE ASC-ITEM-SUB =                                       11070099
110800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11080099
110900                                                                  11090099
111000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11100099
111100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11110099
111200                                                                  11120099
111300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11130099
111400     ELSE                                                         11140099
111500         MOVE +1                     TO ASC-BLK-SUB               11150099
111600     END-IF.                                                      11160099
111700*----------------------------------------------------------------*11170099
111800** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **11180099
111900*----------------------------------------------------------------*11190099
112000 3200-RESET-ATTRIBUTES.                                           11200099
112100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   11210099
112200     MOVE DP015-GREEN              TO ASTRTITC.                   11220099
112300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   11230099
112400*                                                                 11240099
112500     PERFORM                                                      11250099
112600         VARYING PV-SUB                                           11260099
112700         FROM 1 BY 1                                              11270099
112800         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   11280099
112900                         ASC-ITEMS-DISPLAYED)                     11290099
113000         MOVE DP015-UNP-ALP-NOR-OFF                               11300099
113100                                   TO MR-SELECTA (PV-SUB)         11310099
113200         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         11320099
113300         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         11330099
113400     END-PERFORM.                                                 11340099
113500******************************************************************11350099
113600** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **11360099
113700** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **11370099
113800** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **11380099
113900** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **11390099
114000******************************************************************11400099
114100 3300-EDIT-SELECTIONS.                                            11410099
114200                                                                  11420099
114300     EVALUATE TRUE                                                11430099
114400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11440099
114500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11450099
114600                 CONTINUE                                         11460099
114700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11470099
114800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11480099
114900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   11490099
115000                 MOVE ASC-TEMP-SELECTED-SW                        11500099
115100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11510099
115200                                TO ASC-SELECTED-SW                11520099
115300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11530099
115400             END-IF                                               11540099
115500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11550099
115600                 = SPACE                                          11560099
115700             EVALUATE TRUE                                        11570099
115800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       11580099
115900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS11590099
116000                     MOVE SPACE TO ASC-SELECTED-SW                11600099
116100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11610099
116200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        11620099
116300                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    11630099
116400                     MOVE SPACE TO ASC-SELECTED-SW                11640099
116500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11650099
116600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          11660099
116700                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      11670099
116800                     MOVE SPACE TO ASC-SELECTED-SW                11680099
116900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11690099
117000             END-EVALUATE                                         11700099
117100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           11710099
117200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11720099
117300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    11730099
117400             END-IF                                               11740099
117500             PERFORM 3310-EDIT-RANGE                              11750099
117600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             11760099
117700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11770099
117800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    11780099
117900             END-IF                                               11790099
118000             PERFORM 3310-EDIT-RANGE                              11800099
118100         WHEN OTHER                                               11810099
118200             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           11820099
118300             SET DP020-MSG-FATAL    TO TRUE                       11830099
118400             MOVE -1                TO MR-SELECTL (PV-SUB)        11840099
118500             SET DP030-SET-CURSOR-APPL-1                          11850099
118600                                    TO TRUE                       11860099
118700             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        11870099
118800             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        11880099
118900             SET PS-ERROR TO TRUE                                 11890099
119000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11900099
119100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     11910099
119200                 MOVE SPACE         TO ASC-SELECTED-SW            11920099
119300                                        (ASC-BLK-SUB ASC-ITEM-SUB)11930099
119400             END-IF                                               11940099
119500     END-EVALUATE.                                                11950099
119600                                                                  11960099
119700     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 11970099
119800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               11980099
119900     IF  ASC-ITEM-SUB < 1                                         11990099
120000         SUBTRACT +1 FROM ASC-BLK-SUB                             12000099
120100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12010099
120200     END-IF.                                                      12020099
120300******************************************************************12030099
120400** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **12040099
120500** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **12050099
120600** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**12060099
120700** THE ENDING.                                                  **12070099
120800******************************************************************12080099
120900 3310-EDIT-RANGE.                                                 12090099
121000                                                                  12100099
121100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12110099
121200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12120099
121300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12130099
121400                                   TO ASC-SELECTED-SW             12140099
121500                                        (ASC-BLK-SUB ASC-ITEM-SUB)12150099
121600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12160099
121700         ELSE                                                     12170099
121800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12180099
121900                 CONTINUE                                         12190099
122000             ELSE                                                 12200099
122100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        12210099
122200                 MOVE PC-TSYMSG-00054                             12220099
122300                                   TO DP020-MSG-NUMBER            12230099
122400                 SET DP020-MSG-FATAL                              12240099
122500                                   TO TRUE                        12250099
122600                 MOVE -1           TO MR-SELECTL (PV-SUB)         12260099
122700                 SET DP030-SET-CURSOR-APPL-1                      12270099
122800                                   TO TRUE                        12280099
122900                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12290099
123000                 MOVE DP015-UNDERLINE                             12300099
123100                                   TO MR-SELECTH (PV-SUB)         12310099
123200                 SET PS-ERROR      TO TRUE                        12320099
123300             END-IF                                               12330099
123400         END-IF                                                   12340099
123500     ELSE                                                         12350099
123600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12360099
123700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12370099
123800                                   TO ASC-SELECTED-SW             12380099
123900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12390099
124000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12400099
124100         ELSE                                                     12410099
124200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12420099
124300                 CONTINUE                                         12430099
124400             ELSE                                                 12440099
124500*------------------ ONLY ONE END-OF-RANGE ALLOWED --              12450099
124600                 MOVE PC-TSYMSG-00055                             12460099
124700                                   TO DP020-MSG-NUMBER            12470099
124800                 SET DP020-MSG-FATAL                              12480099
124900                                   TO TRUE                        12490099
125000                 MOVE -1           TO MR-SELECTL (PV-SUB)         12500099
125100                 SET DP030-SET-CURSOR-APPL-1                      12510099
125200                                   TO TRUE                        12520099
125300                 SET PS-ERROR      TO TRUE                        12530099
125400             END-IF                                               12540099
125500         END-IF                                                   12550099
125600     END-IF.                                                      12560099
125700                                                                  12570099
125800******************************************************************12580099
125900** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **12590099
126000** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **12600099
126100******************************************************************12610099
126200 3400-CHECK-RANGE-SEQUENCE.                                       12620099
126300                                                                  12630099
126400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       12640099
126500       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      12650099
126600       AND  ASC-START-OF-SELECTED-RANGE >                         12660099
126700                                         ASC-END-OF-SELECTED-RANGE12670099
126800*--------END-OF-RANGE BEFORE BEGINNING-OF-RANGE--                 12680099
126900         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 12690099
127000         SET DP020-MSG-FATAL TO TRUE                              12700099
127100         SET PS-ERROR TO TRUE                                     12710099
127200         PERFORM 3410-POSITION-AT-ERROR                           12720099
127300     END-IF.                                                      12730099
127400******************************************************************12740099
127500** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **12750099
127600** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **12760099
127700** SHOULD BE POSITIONED ON A RANGE ERROR.                       **12770099
127800******************************************************************12780099
127900 3410-POSITION-AT-ERROR.                                          12790099
128000                                                                  12800099
128100     SET DP030-SET-CURSOR-APPL-1                                  12810099
128200                                   TO TRUE.                       12820099
128300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 12830099
128400                    - PV-TOP-ITEM + 1.                            12840099
128500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12850099
128600         CONTINUE                                                 12860099
128700     ELSE                                                         12870099
128800         MOVE -1                   TO MR-SELECTL (PV-SUB)         12880099
128900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         12890099
129000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         12900099
129100     END-IF.                                                      12910099
129200*                                                                 12920099
129300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   12930099
129400                    - PV-TOP-ITEM + 1.                            12940099
129500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12950099
129600         CONTINUE                                                 12960099
129700     ELSE                                                         12970099
129800         MOVE -1                   TO MR-SELECTL (PV-SUB)         12980099
129900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         12990099
130000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13000099
130100     END-IF.                                                      13010099
130200 EJECT                                                            13020099
130300*----------------------------------------------------------------*13030099
130400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13040099
130500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13050099
130600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *13060099
130700*----------------------------------------------------------------*13070099
130800 3500-MARK-RANGE-AS-SELECTED.                                     13080099
130900                                                                  13090099
131000     MOVE +1                       TO  ASC-BLK-SUB.               13100099
131100     PERFORM 3510-MARK-SELECTED-INDS                              13110099
131200         VARYING ASC-ITEM-SUB                                     13120099
131300         FROM 1 BY 1                                              13130099
131400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13140099
131500                                                                  13150099
131600     ADD +1                        TO ASC-BLK-SUB.                13160099
131700     PERFORM 3510-MARK-SELECTED-INDS                              13170099
131800         VARYING ASC-ITEM-SUB                                     13180099
131900         FROM 1 BY 1                                              13190099
132000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13200099
132100                                                                  13210099
132200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13220099
132300                                   TO  PV-LIST-ITEM-NUMBER.       13230099
132400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13240099
132500         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13250099
132600               PC-ITEMS-PER-PANEL).                               13260099
132700                                                                  13270099
132800     MOVE ASC-START-OF-SELECTED-RANGE                             13280099
132900                                   TO PV-START-OF-SELECTED-RANGE. 13290099
133000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13300099
133100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13310099
133200               PC-ITEMS-PER-PANEL).                               13320099
133300                                                                  13330099
133400     MOVE ASC-END-OF-SELECTED-RANGE                               13340099
133500                                   TO  PV-END-OF-SELECTED-RANGE.  13350099
133600     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13360099
133700         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13370099
133800               PC-ITEMS-PER-PANEL).                               13380099
133900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13390099
134000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             13400099
134100                                                                  13410099
134200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13420099
134300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13430099
134400         MOVE +1                   TO ASC-BLK-SUB                 13440099
134500         PERFORM 5100-WRITE-TEMP-STORAGE                          13450099
134600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13460099
134700             PV-FIRST-BLOCK-IN-ARRAY - 1                          13470099
134800                                                                  13480099
134900         PERFORM                                                  13490099
135000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      13500099
135100                   PV-PREV-BLOCK-IN-ARRAY                         13510099
135200             MOVE PV-FIRST-BLOCK-IN-RANGE                         13520099
135300                                   TO PV-BLOCK-NUMBER             13530099
135400             PERFORM 4410-READ-TEMP-STORAGE                       13540099
135500             PERFORM 3510-MARK-SELECTED-INDS                      13550099
135600                 VARYING ASC-ITEM-SUB                             13560099
135700                 FROM 1 BY 1                                      13570099
135800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13580099
135900             PERFORM 5100-WRITE-TEMP-STORAGE                      13590099
136000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     13600099
136100         END-PERFORM                                              13610099
136200                                                                  13620099
136300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13630099
136400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13640099
136500         PERFORM                                                  13650099
136600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13660099
136700                   PV-LAST-BLOCK-IN-RANGE                         13670099
136800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13680099
136900                                   TO PV-BLOCK-NUMBER             13690099
137000             PERFORM 4410-READ-TEMP-STORAGE                       13700099
137100             PERFORM 3510-MARK-SELECTED-INDS                      13710099
137200                 VARYING ASC-ITEM-SUB                             13720099
137300                 FROM 1 BY 1                                      13730099
137400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13740099
137500             PERFORM 5100-WRITE-TEMP-STORAGE                      13750099
137600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13760099
137700         END-PERFORM                                              13770099
137800                                                                  13780099
137900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13790099
138000                                   TO PV-BLOCK-NUMBER             13800099
138100         PERFORM 4410-READ-TEMP-STORAGE                           13810099
138200     END-IF.                                                      13820099
138300                                                                  13830099
138400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 13840099
138500                                      ASC-END-OF-SELECTED-RANGE.  13850099
138600                                                                  13860099
138700 EJECT                                                            13870099
138800*----------------------------------------------------------------*13880099
138900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *13890099
139000*----------------------------------------------------------------*13900099
139100 3510-MARK-SELECTED-INDS.                                         13910099
139200                                                                  13920099
139300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13930099
139400                                ASC-ITEM-SUB) >                   13940099
139500         ASC-START-OF-SELECTED-RANGE)                             13950099
139600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13960099
139700                                ASC-ITEM-SUB) =                   13970099
139800         ASC-START-OF-SELECTED-RANGE)                             13980099
139900                                                                  13990099
140000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14000099
140100                                    ASC-ITEM-SUB) <               14010099
140200             ASC-END-OF-SELECTED-RANGE)                           14020099
140300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14030099
140400                                    ASC-ITEM-SUB) =               14040099
140500             ASC-END-OF-SELECTED-RANGE)                           14050099
140600                                                                  14060099
140700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14070099
140800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14080099
140900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14090099
141000                               TO TRUE                            14100099
141100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14110099
141200                               TO TRUE                            14120099
141300                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    14130099
141400             END-IF                                               14140099
141500         END-IF                                                   14150099
141600     END-IF.                                                      14160099
141700                                                                  14170099
141800 EJECT                                                            14180099
141900*----------------------------------------------------------------*14190099
142000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14200099
142100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14210099
142200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14220099
142300*    DISPLAY THE PANEL TO USER.                                  *14230099
142400*----------------------------------------------------------------*14240099
142500 4000-BUILD-INITIAL-PANEL.                                        14250099
142600                                                                  14260099
142700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            14270099
142800                                 ASC-BLOCK-ENTRIES (2).           14280099
142900     MOVE +1                 TO ASC-BLK-SUB.                      14290099
143000     SET ASC-ITEMS-LEFT-ON-DB                                     14300099
143100                             TO TRUE.                             14310099
143200                                                                  14320099
143300     MOVE +0                 TO ASC-ITEM-SUB                      14330099
143400                                ASC-NUMBER-OF-ITEMS-READ          14340099
143500                                ASC-NUMBER-OF-SELECTED-ITEMS      14350099
143600                                ASC-HIGHEST-BLOCK-WRITTEN         14360099
143700                                ASC-START-OF-SELECTED-RANGE       14370099
143800                                ASC-END-OF-SELECTED-RANGE         14380099
143900                                ASC-ITEM-AT-TOP-OF-PANEL.         14390099
144000     PERFORM 4010-OPEN-CURSOR.                                    14400099
144100                                                                  14410099
144200     PERFORM 4300-READ-ITEMS-FROM-DB.                             14420099
144300                                                                  14430099
144400     PERFORM 4020-CLOSE-CURSOR.                                   14440099
144500                                                                  14450099
144600     MOVE +1                   TO  PV-TOP-ITEM.                   14460099
144700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14470099
144800         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    14480099
144900         SET DP020-MSG-FATAL   TO  TRUE                           14490099
145000         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               14500099
145100     ELSE                                                         14510099
145200         MOVE -1               TO MR-SELECTL (1)                  14520099
145300         SET DP030-SET-CURSOR-APPL-1                              14530099
145400                               TO TRUE                            14540099
145500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     14550099
145600     END-IF.                                                      14560099
145700                                                                  14570099
145800 EJECT                                                            14580099
145900*----------------------------------------------------------------*14590099
146000*   OPEN THE CONTAINER CURSOR                                    *14600099
146100*----------------------------------------------------------------*14610099
146200 4010-OPEN-CURSOR.                                                14620099
146300                                                                  14630099
146400     PERFORM                                                      14640099
146500         WITH TEST AFTER                                          14650099
146600         VARYING PV-RETRY-COUNTER                                 14660099
146700         FROM 1 BY 1                                              14670099
146800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14680099
146900                   OR (SQLCODE = ZERO))                           14690099
147000         MOVE 'CURSOR:  CONTNR-NBR-CSR'                           14700099
147100                        TO DP013-MESSAGE-TEXT (2)                 14710099
147200         EXEC SQL                                                 14720099
147300              OPEN CONTNR-NBR-CSR                                 14730099
147400         END-EXEC                                                 14740099
147500                                                                  14750099
147600         EVALUATE TRUE                                            14760099
147700             WHEN SQLCODE = ZERO                                  14770099
147800             WHEN SQLCODE = -904                                  14780099
147900             WHEN SQLCODE = -913                                  14790099
148000                 CONTINUE                                         14800099
148100             WHEN SQLWARN0 NOT = SPACES                           14810099
148200             WHEN SQLCODE < ZERO                                  14820099
148300             WHEN SQLCODE > ZERO                                  14830099
148400                 MOVE '4010-OPEN-CURSOR'                          14840099
148500                                   TO DP013-PARAGRAPH             14850099
148600                 MOVE 'OPEN CONTAINER CURSOR - '                  14860099
148700                                   TO DP013-MESSAGE-TEXT (1)      14870099
148800                 MOVE SQLCA        TO DP013-SQLCA                 14880099
148900                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    14890099
149000                 SET DP013-DB2-ABEND                              14900099
149100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14910099
149200                 PERFORM DP013-0000-PROCESS-ABEND                 14920099
149300         END-EVALUATE                                             14930099
149400     END-PERFORM.                                                 14940099
149500*                                                                 14950099
149600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14960099
149700         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             14970099
149800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   14980099
149900                                   TO DP013-MESSAGE-TEXT (1)      14990099
150000         MOVE SQLCA                TO DP013-SQLCA                 15000099
150100         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    15010099
150200         SET DP013-DB2-ABEND                                      15020099
150300             DP013-XCTL-DISPLAY-RESTART                           15030099
150400                                   TO TRUE                        15040099
150500         PERFORM DP013-0000-PROCESS-ABEND                         15050099
150600     END-IF.                                                      15060099
150700                                                                  15070099
150800 EJECT                                                            15080099
150900*----------------------------------------------------------------*15090099
151000*   CLOSE THE CONTAINER CURSOR                                   *15100099
151100*----------------------------------------------------------------*15110099
151200 4020-CLOSE-CURSOR.                                               15120099
151300                                                                  15130099
151400     EXEC SQL                                                     15140099
151500          CLOSE CONTNR-NBR-CSR                                    15150099
151600     END-EXEC.                                                    15160099
151700*                                                                 15170099
151800     EVALUATE TRUE                                                15180099
151900         WHEN SQLCODE = ZERO                                      15190099
152000             CONTINUE                                             15200099
152100         WHEN SQLWARN0 NOT = SPACES                               15210099
152200         WHEN SQLCODE < ZERO                                      15220099
152300         WHEN SQLCODE > ZERO                                      15230099
152400             MOVE '4020-CLOSE-CURSOR'                             15240099
152500                               TO DP013-PARAGRAPH                 15250099
152600             MOVE 'CLOSE CONTAINER CURSOR '                       15260099
152700                               TO DP013-MESSAGE-TEXT (1)          15270099
152800             MOVE SQLCA        TO DP013-SQLCA                     15280099
152900             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        15290099
153000             SET DP013-DB2-ABEND                                  15300099
153100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15310099
153200             PERFORM DP013-0000-PROCESS-ABEND                     15320099
153300     END-EVALUATE.                                                15330099
153400                                                                  15340099
153500 EJECT                                                            15350099
153600*----------------------------------------------------------------*15360099
153700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *15370099
153800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *15380099
153900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *15390099
154000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15400099
154100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *15410099
154200*                                                                *15420099
154300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *15430099
154400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *15440099
154500*    UPON INITIALIZATION.                                        *15450099
154600*----------------------------------------------------------------*15460099
154700 4300-READ-ITEMS-FROM-DB.                                         15470099
154800                                                                  15480099
154900     PERFORM                                                      15490099
155000         VARYING PV-READ-COUNT                                    15500099
155100         FROM 1 BY 1                                              15510099
155200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15520099
155300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         15530099
155400                                                                  15540099
155500         PERFORM 4310-FETCH                                       15550099
155600                                                                  15560099
155700         IF  ASC-ITEMS-LEFT-ON-DB                                 15570099
155800             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                15580099
155900                 ADD +1            TO ASC-ITEM-SUB                15590099
156000             ELSE                                                 15600099
156100                 ADD +1            TO ASC-BLK-SUB                 15610099
156200                 MOVE +1           TO ASC-ITEM-SUB                15620099
156300                                                                  15630099
156400                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         15640099
156500                     MOVE +1       TO ASC-BLK-SUB                 15650099
156600                     SET ASC-BLOCK-MODIFIED (1)                   15660099
156700                                   TO TRUE                        15670099
156800                     PERFORM 5100-WRITE-TEMP-STORAGE              15680099
156900                     MOVE ASC-BLOCK-ENTRIES                       15690099
157000                               (PC-MAX-BLOCKS-IN-ARRAY)           15700099
157100                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 15710099
157200                     ADD +1        TO ASC-BLK-SUB                 15720099
157300                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   15730099
157400                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      15740099
157500                                   TO TRUE                        15750099
157600                 END-IF                                           15760099
157700             END-IF                                               15770099
157800             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    15780099
157900             MOVE ASC-NUMBER-OF-ITEMS-READ                        15790099
158000                                   TO ASC-LIST-ITEM-NUMBER        15800099
158100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15810099
158200             MOVE IMCNTK-CONTNR-SEQ-NBR   TO ASC-CONTNR-SEQ-NO    15820099
158300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15830099
158400             MOVE IMCNTK-MOM-IMPRT-VEH-NM TO ASC-VSL-NAME         15840099
158500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15850099
158600             MOVE IMCNTK-MOM-TRIP-TYP-CDE TO ASC-TRIP-TYP-CDE     15860099
158700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15870099
158800             MOVE IMCNTK-MOM-IMPRT-TRIP-ID                        15880099
158900                                   TO  ASC-VOY-NBR                15890099
159000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15900099
159100             MOVE IMCNTK-MOM-CARR-SCAC-ID                         15910099
159200                                   TO  ASC-SCAC                   15920099
159300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15930099
159400*                                                                 15940099
159500             IF IMCNTK-FDR-DPRTR-TMST (1:10)                      15950099
159600                                   = SPACES OR PC-INIT-DATE       15960099
159700                MOVE IMCNTK-MOM-DPRTR-TMST (1:10)                 15970099
159800                                   TO  PV-DATE-BREAK              15980099
159900             ELSE                                                 15990099
160000                MOVE IMCNTK-FDR-DPRTR-TMST (1:10)                 16000099
160100                                   TO  PV-DATE-BREAK              16010099
160200             END-IF                                               16020099
160300             IF PV-DATE-BREAK      = SPACES OR PC-INIT-DATE       16030099
160400                MOVE SPACES        TO  ASC-ATD                    16040099
160500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16050099
160600             ELSE                                                 16060099
160700                PERFORM 4320-FORMAT-DATE                          16070099
160800                MOVE PV-DATE-DISPLAY                              16080099
160900                                   TO  ASC-ATD                    16090099
161000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16100099
161100             END-IF                                               16110099
161200*                                                                 16120099
161300             MOVE IMCNTK-MOM-POE-DELY-TMST (1:10)                 16130099
161400                                   TO  PV-DATE-BREAK              16140099
161500             IF PV-DATE-BREAK       =  SPACES OR PC-INIT-DATE     16150099
161600                MOVE SPACES        TO  ASC-ETA                    16160099
161700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16170099
161800             ELSE                                                 16180099
161900                PERFORM 4320-FORMAT-DATE                          16190099
162000                MOVE PV-DATE-DISPLAY                              16200099
162100                                   TO  ASC-ETA                    16210099
162200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16220099
162300             END-IF                                               16230099
174501                                                                          
174502             MOVE IMCNTK-ACTL-POE-DELY-TMST (1:10)                        
174503                                   TO  PV-DATE-BREAK                    99
174504             IF PV-DATE-BREAK       =  SPACES OR PC-INIT-DATE             
174700                MOVE SPACES        TO  ASC-ATA                            
174800                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
174900             ELSE                                                         
175000                PERFORM 4320-FORMAT-DATE                                  
175100                MOVE PV-DATE-DISPLAY                                      
175200                                   TO ASC-ATA                             
175300                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
175500             END-IF                                                       
175501         END-IF                                                   16280099
175502     END-PERFORM.                                                 16290099
175503                                                                  16300099
175504     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          16310099
175505         MOVE +1               TO ASC-BLK-SUB                     16320099
175506         PERFORM 5100-WRITE-TEMP-STORAGE                          16330099
175507         ADD +1                TO ASC-BLK-SUB                     16340099
175508         PERFORM 5100-WRITE-TEMP-STORAGE                          16350099
175509                                                                  16360099
175510         MOVE 1                TO ASC-BLK-SUB                     16370099
175511                                  PV-BLOCK-NUMBER                 16380099
175512         PERFORM 4410-READ-TEMP-STORAGE                           16390099
175513         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             16400099
175514             MOVE 2            TO ASC-BLK-SUB                     16410099
175515                                  PV-BLOCK-NUMBER                 16420099
175516             PERFORM 4410-READ-TEMP-STORAGE                       16430099
175517         END-IF                                                   16440099
175518     END-IF.                                                      16450099
175519 EJECT                                                            16460099
175520*----------------------------------------------------------------*16470099
175521*    FETCH THE CONTAINER CURSOR                                  *16480099
175522*----------------------------------------------------------------*16490099
175523 4310-FETCH.                                                      16500099
175524                                                                  16510099
175525     EXEC SQL                                                     16520099
175526          FETCH CONTNR-NBR-CSR                                    16530099
175527          INTO  :IMCNTK-MOM-IMPRT-VEH-NM                          16540099
175528              , :IMCNTK-MOM-TRIP-TYP-CDE                          16550099
175529              , :IMCNTK-MOM-IMPRT-TRIP-ID                         16560099
175530              , :IMCNTK-MOM-CARR-SCAC-ID                          16570099
175531              , :IMCNTK-FDR-DPRTR-TMST                            16580099
175532              , :IMCNTK-MOM-DPRTR-TMST                            16590099
175533              , :IMCNTK-MOM-POE-DELY-TMST                         16600099
175534              , :IMCNTK-ACTL-POE-DELY-TMST                        16610099
175535              , :IMCNTK-CONTNR-SEQ-NBR                            16620099
175536     END-EXEC.                                                    16630099
175537                                                                  16640099
175538*    END-EVALUATE.                                                16650099
175539                                                                  16660099
175540     EVALUATE TRUE                                                16670099
175541         WHEN SQLCODE = ZERO                                      16680099
175542         WHEN SQLCODE = +100                                      16690099
175543              CONTINUE                                            16700099
175544         WHEN SQLWARN0 NOT = SPACE                                16710099
175545         WHEN SQLCODE NOT = ZERO                                  16720099
175546              MOVE '4310-FETCH-CURSOR'                            16730099
175547                               TO DP013-PARAGRAPH                 16740099
175548              MOVE 'FETCH CONTAINER CURSOR'                       16750099
175549                               TO DP013-MESSAGE-TEXT (1)          16760099
175550              MOVE SQLCA       TO DP013-SQLCA                     16770099
175551              SET DP013-DB2-ABEND                                 16780099
175552                               TO TRUE                            16790099
175553              PERFORM DP013-0000-PROCESS-ABEND                    16800099
175554     END-EVALUATE.                                                16810099
175555                                                                  16820099
175556     IF  SQLCODE EQUAL +100                                       16830099
175557         SET ASC-NO-ITEMS-LEFT-ON-DB                              16840099
175558                                   TO TRUE                        16850099
175559     END-IF.                                                      16860099
175560                                                                  16870099
175561 EJECT                                                            16880099
175562**--------------------------------------------------------------**16890099
175563**     FORMAT THE DB2 DATE TO MM/DD/YY.                         **16900099
175564**--------------------------------------------------------------**16910099
175565 4320-FORMAT-DATE.                                                16920099
175566                                                                  16930099
175567     MOVE PV-DB-MM          TO  PV-DD-MM.                         16940099
175568     MOVE PV-DB-DD          TO  PV-DD-DD.                         16950099
175569     MOVE PV-DB-YY          TO  PV-DD-YY.                         16960099
175570*----------------------------------------------------------------*16970099
175571* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *16980099
175572*----------------------------------------------------------------*16990099
175573 4400-MOVE-COMMAREA-TO-SCREEN.                                    17000099
175574                                                                  17010099
175575     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             17020099
175576         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          17030099
175577         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          17040099
175578             MOVE +1    TO ASC-BLK-SUB                            17050099
175579             PERFORM 5100-WRITE-TEMP-STORAGE                      17060099
175580             ADD +1     TO ASC-BLK-SUB                            17070099
175581             PERFORM 5100-WRITE-TEMP-STORAGE                      17080099
175582             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             17090099
175583                 GIVING PV-BLOCK-NUMBER                           17100099
175584                 REMAINDER PV-REMAINDER                           17110099
175585             IF  PV-REMAINDER > ZERO                              17120099
175586                 ADD +1 TO PV-BLOCK-NUMBER                        17130099
175587             END-IF                                               17140099
175588             MOVE +1    TO ASC-BLK-SUB                            17150099
175589             PERFORM 4410-READ-TEMP-STORAGE                       17160099
175590             ADD +1     TO ASC-BLK-SUB                            17170099
175591                           PV-BLOCK-NUMBER                        17180099
175592             PERFORM 4410-READ-TEMP-STORAGE                       17190099
175593     END-IF.                                                      17200099
175594     MOVE +1            TO ASC-BLK-SUB.                           17210099
175595     COMPUTE ASC-ITEM-SUB =                                       17220099
175596         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              17230099
175597         + PC-ITEMS-PER-PANEL).                                   17240099
175598*                                                                 17250099
175599     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17260099
175600         ADD +1         TO ASC-BLK-SUB                            17270099
175601         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17280099
175602     END-IF.                                                      17290099
175603*                                                                 17300099
175604     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           17310099
175605         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                17320099
175606     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        17330099
175607     PERFORM 4420-FORMAT-LIST-LINES                               17340099
175608         VARYING PV-SUB                                           17350099
175609         FROM PC-ITEMS-PER-PANEL BY -1                            17360099
175610         UNTIL PV-SUB < +1.                                       17370099
175611*                                                                 17380099
175612     COMPUTE ASC-ITEMS-DISPLAYED =                                17390099
175613         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          17400099
175614     MOVE ASC-KEY-CONTNR-NO        TO ACNTRNOO.                   17410099
175615     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    17420099
175616                                      ASTRTITO.                   17430099
175617     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    17440099
175618     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    17450099
175619     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            17460099
175620                                   TO ASELITO.                    17470099
175621*                                                                 17480099
175622     IF  DP020-MSG-NUMBER-X = SPACE                               17490099
175623         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  17500099
175624*            --- MORE ITEMS TO DISPLAY ----                       17510099
175625             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            17520099
175626             SET DP020-MSG-INFORMATIONAL TO TRUE                  17530099
175627         END-IF                                                   17540099
175628     END-IF.                                                      17550099
175629*----------------------------------------------------------------*17560099
175700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17570099
175800*----------------------------------------------------------------*17580099
175900 4410-READ-TEMP-STORAGE.                                          17590099
176000                                                                  17600099
176100     EXEC CICS                                                    17610099
176200         READQ TS                                                 17620099
176300             QUEUE (ASC-LIST-QUEUE-NAME)                          17630099
176400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17640099
176500             ITEM  (PV-BLOCK-NUMBER)                              17650099
176600             RESP  (PV-CICS-RESP)                                 17660099
176700     END-EXEC.                                                    17670099
176800                                                                  17680099
176900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17690099
177000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17700099
177100         CONTINUE                                                 17710099
177200     ELSE                                                         17720099
177300         SET DP013-CICS-ABEND     TO TRUE                         17730099
177400         SET DP013-NO-ROLLBACK    TO TRUE                         17740099
177500         MOVE '4410-READ-TEMP-STORAGE'                            17750099
177600                                  TO DP013-PARAGRAPH              17760099
177700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17770099
177800                                  TO DP013-MESSAGE-TEXT(1)        17780099
177900         PERFORM DP013-0000-PROCESS-ABEND                         17790099
178000     END-IF.                                                      17800099
178100                                                                  17810099
178200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17820099
178300                                                                  17830099
178400*                                                                 17840099
178500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17850099
178600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17860099
178700     END-IF.                                                      17870099
178800 EJECT                                                            17880099
178900*----------------------------------------------------------------*17890099
179000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *17900099
179100*----------------------------------------------------------------*17910099
179200 4420-FORMAT-LIST-LINES.                                          17920099
179300                                                                  17930099
179400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      17940099
179500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                17950099
179600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           17960099
179700         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           17970099
179800         MOVE SPACE              TO MR-SELECTI (PV-SUB)           17980099
179900                                    MR-ACTION (PV-SUB)            17990099
180000                                    MR-VSL-NAME (PV-SUB)          18000099
180100                                    MR-TRIP-TYP-CDE (PV-SUB)      18010099
180200                                    MR-VOY-NBR (PV-SUB)           18020099
180300                                    MR-SCAC (PV-SUB)              18030099
180400                                    MR-ATD (PV-SUB)               18040099
180500                                    MR-ETA (PV-SUB)               18050099
180600                                    MR-ATA (PV-SUB)               18060099
180700     ELSE                                                         18070099
180800         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      18080099
180900                                                   > SPACE        18090099
181000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18100099
181100                                 TO MR-SELECTI (PV-SUB)           18110099
181200         ELSE                                                     18120099
181300             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      18130099
181400                                 TO MR-SELECTI (PV-SUB)           18140099
181500         END-IF                                                   18150099
181600*                                                                 18160099
181700         IF  DP030-SET-CURSOR-TRAILER                             18170099
181800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)18180099
181900                 > SPACE)                                         18190099
182000               OR (PV-SUB = 1))                                   18200099
182100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               18210099
182200                MOVE -1          TO MR-SELECTL (PV-SUB)           18220099
182300             END-IF                                               18230099
182400         END-IF                                                   18240099
182500*                                                                 18250099
182600         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           18260099
182700             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           18270099
182800                                 TO MR-ACTION (PV-SUB)            18280099
182900             MOVE ASC-VSL-NAME (ASC-BLK-SUB ASC-ITEM-SUB)         18290099
183000                                 TO MR-VSL-NAME (PV-SUB)          18300099
183100             MOVE ASC-TRIP-TYP-CDE (ASC-BLK-SUB ASC-ITEM-SUB)     18310099
183200                                 TO MR-TRIP-TYP-CDE (PV-SUB)      18320099
183300             MOVE ASC-VOY-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          18330099
183400                                 TO MR-VOY-NBR (PV-SUB)           18340099
183500             MOVE ASC-SCAC (ASC-BLK-SUB ASC-ITEM-SUB)             18350099
183600                                 TO MR-SCAC (PV-SUB)              18360099
183700             MOVE ASC-ATD (ASC-BLK-SUB ASC-ITEM-SUB)              18370099
183800                                 TO MR-ATD (PV-SUB)               18380099
183900             MOVE ASC-ETA (ASC-BLK-SUB ASC-ITEM-SUB)              18390099
184000                                 TO MR-ETA (PV-SUB)               18400099
184100             MOVE ASC-ATA (ASC-BLK-SUB ASC-ITEM-SUB)              18410099
184200                                 TO MR-ATA (PV-SUB)               18420099
184300         END-IF                                                   18430099
184400     END-IF.                                                      18440099
184500     SUBTRACT +1 FROM ASC-ITEM-SUB                                18450099
184600     IF  ASC-ITEM-SUB < + 1                                       18460099
184700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  18470099
184800         MOVE +1                 TO ASC-BLK-SUB                   18480099
184900     END-IF.                                                      18490099
185000**--------------------------------------------------------------**18500099
185100** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **18510099
185200** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **18520099
185300** ISSUE A WARNING.                                             **18530099
185400**--------------------------------------------------------------**18540099
185500 4430-CHECK-FOR-BEGIN-AND-END.                                    18550099
185600                                                                  18560099
185700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       18570099
185800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18580099
185900*            -- NO END-OF-RANGE SPECFIED ---                      18590099
186000             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            18600099
186100             SET DP020-MSG-WARNING TO TRUE                        18610099
186200             PERFORM 4431-POSITION-AT-WARNING                     18620099
186300         END-IF                                                   18630099
186400     ELSE                                                         18640099
186500         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     18650099
186600*            -- NO BEGINNING-OF-RANGE SPECFIED ---                18660099
186700             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            18670099
186800             SET DP020-MSG-WARNING TO TRUE                        18680099
186900             PERFORM 4431-POSITION-AT-WARNING                     18690099
187000         END-IF                                                   18700099
187100     END-IF.                                                      18710099
187200**--------------------------------------------------------------**18720099
187300** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **18730099
187400** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **18740099
187500** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **18750099
187600** POSITION THE CURSOR THERE.                                   **18760099
187700**--------------------------------------------------------------**18770099
187800 4431-POSITION-AT-WARNING.                                        18780099
187900                                                                  18790099
188000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18800099
188100                    - PV-TOP-ITEM + 1.                            18810099
188200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18820099
188300         CONTINUE                                                 18830099
188400     ELSE                                                         18840099
188500         SET DP030-SET-CURSOR-APPL-1                              18850099
188600                                   TO TRUE                        18860099
188700         MOVE -1                   TO MR-SELECTL (PV-SUB)         18870099
188800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18880099
188900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18890099
189000     END-IF.                                                      18900099
189100*                                                                 18910099
189200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18920099
189300                    - PV-TOP-ITEM + 1.                            18930099
189400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18940099
189500         CONTINUE                                                 18950099
189600     ELSE                                                         18960099
189700         SET DP030-SET-CURSOR-APPL-1                              18970099
189800                                   TO TRUE                        18980099
189900         MOVE -1                   TO MR-SELECTL (PV-SUB)         18990099
190000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19000099
190100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19010099
190200     END-IF.                                                      19020099
190300 EJECT                                                            19030099
190400*----------------------------------------------------------------*19040099
190500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *19050099
190600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *19060099
190700* FOR THE SELECTED ITEMS QUEUE.                                  *19070099
190800*                                                                *19080099
190900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *19090099
191000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *19100099
191100* THE ARRAY IS FULL.                                             *19110099
191200*----------------------------------------------------------------*19120099
191300 5000-PREPARE-SEL-QUEUE.                                          19130099
191400                                                                  19140099
191500     MOVE +1                    TO  ASC-BLK-SUB.                  19150099
191600     PERFORM 5100-WRITE-TEMP-STORAGE.                             19160099
191700     ADD +1                     TO  ASC-BLK-SUB.                  19170099
191800     PERFORM 5100-WRITE-TEMP-STORAGE.                             19180099
191900                                                                  19190099
192000     MOVE ASC-SEL-QUEUE-NAME    TO  TR102-SEL-QUEUE-NAME.         19200099
192100     PERFORM 6010-DELETE-SEL-QUEUE.                               19210099
192200                                                                  19220099
192300     SET ASC-UPDATE-TSQ        TO  TRUE.                          19230099
192400                                                                  19240099
192500     SET TR101-IDX             TO  1.                             19250099
192600     MOVE ZERO                 TO TR102-NUMBER-OF-TS-ITEMS.       19260099
192700     INITIALIZE TR101-SELECTED-ITEM-ARRAY.                        19270099
192800                                                                  19280099
192900     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           19290099
193000             VARYING PV-ITEM                                      19300099
193100             FROM 1 BY 1                                          19310099
193200             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     19320099
193300                                                                  19330099
193400     IF  TR101-IDX > 1                                            19340099
193500         PERFORM 5205-WRITE-SEL-QUEUE                             19350099
193600         ADD +1                TO TR102-NUMBER-OF-TS-ITEMS        19360099
193700     END-IF.                                                      19370099
193800 EJECT                                                            19380099
193900*----------------------------------------------------------------*19390099
194000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *19400099
194100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *19410099
194200*----------------------------------------------------------------*19420099
194300 5100-WRITE-TEMP-STORAGE.                                         19430099
194400                                                                  19440099
194500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     19450099
194600                                   TO PV-LIST-ITEM-NUMBER.        19460099
194700     COMPUTE PV-BLOCK-NUMBER =                                    19470099
194800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19480099
194900                                                                  19490099
195000     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             19500099
195100     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             19510099
195200         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      19520099
195300             PERFORM 5105-REWRITE-ASC-LISTQ                       19530099
195400         END-IF                                                   19540099
195500     ELSE                                                         19550099
195600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19560099
195700         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19570099
195800         PERFORM 5110-WRITE-ASC-LISTQ                             19580099
195900         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19590099
196000     END-IF.                                                      19600099
196100                                                                  19610099
196200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19620099
196300**--------------------------------------------------------------**19630099
196400** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **19640099
196500** SPECIFIC COMMAREA.                                           **19650099
196600**--------------------------------------------------------------**19660099
196700 5105-REWRITE-ASC-LISTQ.                                          19670099
196800                                                                  19680099
196900     EXEC CICS                                                    19690099
197000         WRITEQ TS                                                19700099
197100             QUEUE (ASC-LIST-QUEUE-NAME)                          19710099
197200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19720099
197300             ITEM  (PV-BLOCK-NUMBER)                              19730099
197400             REWRITE                                              19740099
197500             RESP  (PV-CICS-RESP)                                 19750099
197600     END-EXEC.                                                    19760099
197700                                                                  19770099
197800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19780099
197900         CONTINUE                                                 19790099
198000     ELSE                                                         19800099
198100         SET DP013-CICS-ABEND            TO TRUE                  19810099
198200         SET DP013-NO-ROLLBACK           TO TRUE                  19820099
198300         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       19830099
198400         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19840099
198500                                         TO DP013-MESSAGE-TEXT(1) 19850099
198600         PERFORM DP013-0000-PROCESS-ABEND                         19860099
198700     END-IF.                                                      19870099
198800                                                                  19880099
198900**--------------------------------------------------------------**19890099
199000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **19900099
199100** SPECIFIC COMMAREA.                                           **19910099
199200**--------------------------------------------------------------**19920099
199300 5110-WRITE-ASC-LISTQ.                                            19930099
199400                                                                  19940099
199500     EXEC CICS                                                    19950099
199600         WRITEQ TS                                                19960099
199700             QUEUE (ASC-LIST-QUEUE-NAME)                          19970099
199800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19980099
199900             ITEM  (PV-BLOCK-NUMBER)                              19990099
200000             RESP  (PV-CICS-RESP)                                 20000099
200100     END-EXEC.                                                    20010099
200200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      20020099
200300         SET DP013-CICS-ABEND      TO TRUE                        20030099
200400         SET DP013-NO-ROLLBACK     TO TRUE                        20040099
200500         MOVE '5110-WRITE-ASC-LISTQ'                              20050099
200600                                   TO DP013-PARAGRAPH             20060099
200700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           20070099
200800                                   TO DP013-MESSAGE-TEXT(1)       20080099
200900         PERFORM DP013-0000-PROCESS-ABEND                         20090099
201000     END-IF.                                                      20100099
201100 EJECT                                                            20110099
201200*----------------------------------------------------------------*20120099
201300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *20130099
201400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *20140099
201500*----------------------------------------------------------------*20150099
201600 5200-FILL-SEL-QUEUE-RECORD.                                      20160099
201700                                                                  20170099
201800     PERFORM 6112-READ-LIST-QUEUE.                                20180099
201900                                                                  20190099
202000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       20200099
202100         PERFORM                                                  20210099
202200         VARYING LQW-IDX                                          20220099
202300         FROM 1 BY 1                                              20230099
202400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            20240099
202500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          20250099
202600                                                                  20260099
202700             IF  LQW-SELECT (LQW-IDX)                             20270099
202800                    MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)           20280099
202900                                   TO TR101-ITEM (TR101-IDX)      20290099
203000                    MOVE ASC-KEY-CONTNR-NO                        20300099
203100                                   TO TR101-CONTNR-NO             20310099
203200                                        (TR101-IDX)               20320099
203300                    MOVE LQW-CONTNR-SEQ-NO (LQW-IDX)              20330099
203400                                   TO TR102-CONTNR-SEQ-NO         20340099
203500                                      TR101-CONTNR-SEQ-NO         20350099
203600                                        (TR101-IDX)               20360099
203700                    MOVE 'I'       TO TR101-ACTION-SW (TR101-IDX) 20370099
203800                    SET TR101-IDX UP BY 1                         20380099
203900                    IF  TR101-IDX > TR101-MAX-ITEMS               20390099
204000                        PERFORM 5205-WRITE-SEL-QUEUE              20400099
204100                        ADD +1        TO TR102-NUMBER-OF-TS-ITEMS 20410099
204200                        INITIALIZE TR101-SELECTED-ITEM-ARRAY      20420099
204300                        SET TR101-IDX TO  1                       20430099
204400                    END-IF                                        20440099
204500*                END-IF                                           20450099
204600             END-IF                                               20460099
204700         END-PERFORM                                              20470099
204800     END-IF.                                                      20480099
204900                                                                  20490099
205000*----------------------------------------------------------------*20500099
205100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *20510099
205200*----------------------------------------------------------------*20520099
205300 5205-WRITE-SEL-QUEUE.                                            20530099
205400                                                                  20540099
205500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20550099
205600                                   TO TR101-SELECTED-ITEMS.       20560099
205700                                                                  20570099
205800     EXEC CICS                                                    20580099
205900          WRITEQ TS                                               20590099
206000              QUEUE (ASC-SEL-QUEUE-NAME)                          20600099
206100              FROM  (TR101-VOYAGE-SEL-REC)                        20610099
206200              ITEM  (PV-SEL-QUEUE-ITEM)                           20620099
206300              RESP  (PV-CICS-RESP)                                20630099
206400     END-EXEC.                                                    20640099
206500                                                                  20650099
206600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20660099
206700         CONTINUE                                                 20670099
206800     ELSE                                                         20680099
206900         SET DP013-CICS-ABEND      TO TRUE                        20690099
207000         SET DP013-NO-ROLLBACK     TO TRUE                        20700099
207100         MOVE '5205-WRITE-SEL-QUEUE'                              20710099
207200                                   TO DP013-PARAGRAPH             20720099
207300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          20730099
207400                                   TO DP013-MESSAGE-TEXT(1)       20740099
207500         PERFORM DP013-0000-PROCESS-ABEND                         20750099
207600     END-IF.                                                      20760099
207700 EJECT                                                            20770099
207800**--------------------------------------------------------------**20780099
207900** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **20790099
208000** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **20800099
208100** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **20810099
208200** THE USER.                                                    **20820099
208300**--------------------------------------------------------------**20830099
208400 6000-REFRESH-PANEL-FROM-TEMP.                                    20840099
208500     IF  ASC-UPDATE-TSQ                                           20850099
208600         SET ASC-NO-TSQ-UPDATE TO TRUE                            20860099
208700         MOVE ZERO                 TO PV-SAVE-ITEM                20870099
208800                                      PV-SEL-QUEUE-ITEM           20880099
208900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        20890099
209000                                   TO PV-HOLD-SELECTED-ITEMS      20900099
209100         MOVE +1                   TO PV-ITEMS-PROCESSED          20910099
209200         PERFORM 6100-UPDATE-TSQ                                  20920099
209300             UNTIL PV-ITEMS-PROCESSED >                           20930099
209400                                     PV-HOLD-SELECTED-ITEMS       20940099
209500         PERFORM 6010-DELETE-SEL-QUEUE                            20950099
209600         INITIALIZE ASC-BLOCK-ENTRIES (1)                         20960099
209700                    ASC-BLOCK-ENTRIES (2)                         20970099
209800     END-IF.                                                      20980099
209900                                                                  20990099
210000*----------------------------------------------------------------*21000099
210100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *21010099
210200*----------------------------------------------------------------*21020099
210300 6010-DELETE-SEL-QUEUE.                                           21030099
210400                                                                  21040099
210500     EXEC CICS                                                    21050099
210600         DELETEQ TS                                               21060099
210700             QUEUE (ASC-SEL-QUEUE-NAME)                           21070099
210800             RESP  (PV-CICS-RESP)                                 21080099
210900     END-EXEC.                                                    21090099
211000*                                                                 21100099
211100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      21110099
211200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         21120099
211300         CONTINUE                                                 21130099
211400     ELSE                                                         21140099
211500         SET DP013-CICS-ABEND TO TRUE                             21150099
211600         SET DP013-NO-ROLLBACK TO TRUE                            21160099
211700         MOVE '6010-DELETE-SEL-QUEUE'                             21170099
211800                        TO DP013-PARAGRAPH                        21180099
211900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         21190099
212000                        TO DP013-MESSAGE-TEXT (1)                 21200099
212100         PERFORM DP013-0000-PROCESS-ABEND                         21210099
212200     END-IF.                                                      21220099
212300                                                                  21230099
212400*----------------------------------------------------------------*21240099
212500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *21250099
212600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *21260099
212700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *21270099
212800*    THE TEMP QUEUE.                                             *21280099
212900*----------------------------------------------------------------*21290099
213000                                                                  21300099
213100 6100-UPDATE-TSQ.                                                 21310099
213200                                                                  21320099
213300     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             21330099
213400     PERFORM 6105-READ-SEL-QUEUE.                                 21340099
213500     PERFORM                                                      21350099
213600         VARYING TR101-IDX                                        21360099
213700         FROM 1 BY 1                                              21370099
213800         UNTIL ((PV-ITEMS-PROCESSED >                             21380099
213900                              PV-HOLD-SELECTED-ITEMS)             21390099
214000         OR (TR101-IDX GREATER THAN TR101-MAX-ITEMS))             21400099
214100         IF  TR101-ACTION-SW (TR101-IDX) > SPACE                  21410099
214200             PERFORM 6110-PROCESS-ITEMS                           21420099
214300         END-IF                                                   21430099
214400         ADD +1                TO PV-ITEMS-PROCESSED              21440099
214500     END-PERFORM.                                                 21450099
214600     PERFORM 6111-WRITE-LIST-QUEUE.                               21460099
214700*----------------------------------------------------------------*21470099
214800*    READ THE LIST QUEUE RECORD.                                 *21480099
214900*----------------------------------------------------------------*21490099
215000                                                                  21500099
215100 6105-READ-SEL-QUEUE.                                             21510099
215200                                                                  21520099
215300     EXEC CICS                                                    21530099
215400          READQ TS                                                21540099
215500              QUEUE (ASC-SEL-QUEUE-NAME)                          21550099
215600              INTO  (TR101-VOYAGE-SEL-REC)                        21560099
215700              ITEM  (PV-SEL-QUEUE-ITEM)                           21570099
215800              RESP  (PV-CICS-RESP)                                21580099
215900     END-EXEC.                                                    21590099
216000*                                                                 21600099
216100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21610099
216200         CONTINUE                                                 21620099
216300     ELSE                                                         21630099
216400         SET DP013-CICS-ABEND      TO  TRUE                       21640099
216500         SET DP013-NO-ROLLBACK     TO  TRUE                       21650099
216600         MOVE '6105-READ-SEL-QUEUE'                               21660099
216700                                   TO  DP013-PARAGRAPH            21670099
216800         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           21680099
216900                                   TO  DP013-MESSAGE-TEXT(1)      21690099
217000         PERFORM DP013-0000-PROCESS-ABEND                         21700099
217100     END-IF.                                                      21710099
217200 EJECT                                                            21720099
217300*----------------------------------------------------------------*21730099
217400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*21740099
217500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*21750099
217600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *21760099
217700*----------------------------------------------------------------*21770099
217800                                                                  21780099
217900 6110-PROCESS-ITEMS.                                              21790099
218000                                                                  21800099
218100     COMPUTE PV-ITEM = 1 + ((TR101-ITEM (TR101-IDX) - 1)          21810099
218200                     / PC-ITEMS-PER-PANEL).                       21820099
218300                                                                  21830099
218400     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           21840099
218500         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          21850099
218600             PERFORM 6111-WRITE-LIST-QUEUE                        21860099
218700         END-IF                                                   21870099
218800         MOVE PV-ITEM          TO PV-SAVE-ITEM                    21880099
218900                                                                  21890099
219000         PERFORM 6112-READ-LIST-QUEUE                             21900099
219100         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               21910099
219200             CONTINUE                                             21920099
219300         END-IF                                                   21930099
219400     END-IF.                                                      21940099
219500                                                                  21950099
219600     COMPUTE PV-SUB = (TR101-ITEM (TR101-IDX)                     21960099
219700                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              21970099
219800     SET LQW-DESELECT (PV-SUB) TO    TRUE                         21980099
219900     MOVE LQW-SELECTED-SW (PV-SUB)                                21990099
220000                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  22000099
220100                                                                  22010099
220200     IF TR101-INQ (TR101-IDX)                                     22020099
220300        MOVE PC-INQ      TO LQW-ACTION (PV-SUB)                   22030099
220400     END-IF.                                                      22040099
220500                                                                  22050099
220600     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                22060099
220700                                                                  22070099
220800*----------------------------------------------------------------*22080099
220900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *22090099
221000*----------------------------------------------------------------*22100099
221100                                                                  22110099
221200 6111-WRITE-LIST-QUEUE.                                           22120099
221300                                                                  22130099
221400     EXEC CICS                                                    22140099
221500         WRITEQ TS                                                22150099
221600             QUEUE (ASC-LIST-QUEUE-NAME)                          22160099
221700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     22170099
221800             ITEM  (PV-SAVE-ITEM)                                 22180099
221900             REWRITE                                              22190099
222000             RESP  (PV-CICS-RESP)                                 22200099
222100     END-EXEC.                                                    22210099
222200*                                                                 22220099
222300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22230099
222400         CONTINUE                                                 22240099
222500     ELSE                                                         22250099
222600         SET DP013-CICS-ABEND  TO  TRUE                           22260099
222700         SET DP013-NO-ROLLBACK TO  TRUE                           22270099
222800         MOVE '6111-WRITE-LIST-QUEUE'                             22280099
222900                               TO  DP013-PARAGRAPH                22290099
223000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  22300099
223100                               TO  DP013-MESSAGE-TEXT(1)          22310099
223200         PERFORM DP013-0000-PROCESS-ABEND                         22320099
223300     END-IF.                                                      22330099
223400                                                                  22340099
223500 EJECT                                                            22350099
223600*----------------------------------------------------------------*22360099
223700*   READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA  *22370099
223800*----------------------------------------------------------------*22380099
223900                                                                  22390099
224000 6112-READ-LIST-QUEUE.                                            22400099
224100                                                                  22410099
224200     EXEC CICS                                                    22420099
224300         READQ TS                                                 22430099
224400             QUEUE (ASC-LIST-QUEUE-NAME)                          22440099
224500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     22450099
224600             ITEM  (PV-ITEM)                                      22460099
224700             RESP  (PV-CICS-RESP)                                 22470099
224800     END-EXEC.                                                    22480099
224900*                                                                 22490099
225000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22500099
225100         CONTINUE                                                 22510099
225200     ELSE                                                         22520099
225300         SET DP013-CICS-ABEND        TO TRUE                      22530099
225400         SET DP013-NO-ROLLBACK       TO TRUE                      22540099
225500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           22550099
225600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    22560099
225700                                     TO DP013-MESSAGE-TEXT(1)     22570099
225800         PERFORM DP013-0000-PROCESS-ABEND                         22580099
225900     END-IF.                                                      22590099
226000                                                                  22600099
226100 EJECT                                                            22610099
226200*----------------------------------------------------------------*22620099
226300*    ABEND PROCESSOR MODULE                                      *22630099
226400*----------------------------------------------------------------*22640099
226500                                                                  22650099
226600     COPY DPPD013.                                                22660099
