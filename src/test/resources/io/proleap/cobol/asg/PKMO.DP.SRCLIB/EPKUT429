000100 IDENTIFICATION DIVISION.                                         00010052
000200 PROGRAM-ID.      EPKUT429.                                       00020063
000300 AUTHOR.          PAUL OMAN.                                      00030052
000400 DATE-WRITTEN.    MARCH 2003.                                     00040052
000500                                                                  00050052
000600*--------------------------------------------------------------*  00060052
000700*              MID TIER STORE LIST CREATOR                     *  00070052
000800*                                                              *  00080052
000900*  THIS PROGRAM CREATES THE NECESSARY STORE LISTS FOR THE MID  *  00090052
001000*  TIER FILE DISTRIBUTION PROCESS.                             *  00100052
001100*                                                              *  00110052
001200*    THE PROGRAM CREATES TWO OUTPUT FILES:                     *  00120052
001300*                                                              *  00130052
001400*    1.) NEW-FPLU-FILE - DD OUT01.                             *  00140052
001500*      THE RECORDS WHICH ARE WRITTEN TO THIS FILE COME AS A    *  00150052
001600*      RESULT OF THE NEW-FPLU-STORES CURSOR.   THE CURSOR IS A *  00160052
001700*      JOIN OF XST00001(XST_LOC) AND XST00025(XST_LOC_ATTR).   *  00170052
001800*                                                              *  00180052
001900*      THE OUTPUT REPRESENTS THOSE STORES THAT ARE CURRENTLY   *  00190052
002000*      OPEN AND USING THE NEW FPLU SYSTEM OR THOSE THAT WILL   *  00200052
002100*      OPEN WITHIN "X" DAYS OF THE BATCH DATE AND WILL USE THE *  00210052
002200*      NEW FPLU SYSTEM.                                        *  00220052
002300*                                                              *  00230052
002700*    2.) STORE-GROUP-FILE - DD OUT02.                          *  00240052
002800*      THE RECORDS WHICH ARE WRITTEN TO THIS FILE REPRESENT    *  00250052
002900*      THE VARIOUS STORE GROUP RELATIONSHIPS AND THE STORES    *  00260052
003000*      WHICH EITHER DO OR WILL BELONG TO THOSE RELATIONSHIPS   *  00270052
003100*      ON A GIVEN DATE.                                        *  00280052
003200*                                                              *  00290052
005800*      THE DATES TO BE PROCESSED COME FROM TWO LOCATIONS.  THE *  00300052
005900*      FIRST IS THE UNIQUE-DATE-CSR AND THE SECOND IS ALL      *  00310052
006000*      DATES BETWEEN "X" AND "Y".  THE "X" AND "Y" DATES ARE   *  00320052
006100*      CALCULATED BASED OFF OF THE BATCH DATE.                 *  00330052
006200*                                                              *  00340052
006300*      FOR EACH DATE PROCESSED THE STORE-GROUP-LIST, AND THE   *  00350052
006400*      ADHOC-STORE-LIST CURSORS ARE USED TO GET ALL OF THE     *  00360052
006500*      STORES AND THE ASSOCIATED STORE GROUPS WHICH THE STORE  *  00370052
006600*      WILL/DOES BELONG TO ON THAT DATE.  IN ADDITION, FOR THE *  00380052
006700*      BATCH DATE THE REFRESH-STORE-CSR IS USED TO CREATE      *  00390052
006800*      RECORDS FOR ALL THOSE STORES WHICH SHOULD RECEIVE FULL  *  00400052
006900*      PLU FILES.                                              *  00410052
007000*                                                              *  00420052
007100*      THERE IS ONE THING WHICH IS WORTH MENTIONING ABOUT SOME *  00430052
007200*      OF THE CURSORS IN THIS PROGRAM. TYPICALLY THE 'EP'      *  00440052
007300*      SYSTEM USES THE 'ACTL_STRT_TMST' AND 'ACTL_END_TMST'    *  00450052
007400*      VARIABLES.  THESE VALUES ARE A RESULT OF THE PROMO      *  00460052
007500*      SYSTEM ADDING 3 HOURS TO THE 'PROMO_STRT_TMST' AND THE  *  00470052
007600*      'PROMO_END_TMST'.  THE 3 HOURS IS ADDED TO THE START    *  00480052
007700*      TIMESTAMP WHEN THE PROMOTION IS SET TO START AT 00:00,  *  00490052
007800*      AND THE TIME IS ADDED TO THE END TIMESTAMP WHEN THE     *  00500052
007900*      PROMOTION IS SET TO END AT 23:59.  THE CURSORS BELOW    *  00510052
008000*      ONLY NEED THE DATE PORTION OF THE TIMESTAMP AND IN THIS *  00520052
008100*      PROGRAM WE CAN USE THE 'PROMO...' VARIABLES.  USING     *  00530052
008200*      THESE IS PREFERRED BECAUSE THERE IS AN INDEX WHICH WILL *  00540052
008300*      HELP IMPROVE PERFORMANCE.                               *  00550052
008400*                                                              *  00560052
008500*  INPUTS:                                                     *  00570052
008600*           EPRD045 - CONTAINS NUMBER OF ADVANCE DAYS FOR      *  00580052
008700*                     WHICH FILES SHOULD BE SENT TO STORES     *  00590052
008800*                     PRIOR TO THEM OPENING.                   *  00600052
008900*                                                              *  00610052
009000*           EPRD111 - CONTAINS CURRENT EP PROMO BATCH DATE.    *  00620052
009100*                                                              *  00630052
009200*--------------------------------------------------------------*  00640052
009300*--------------------------------------------------------------*  00650052
009400* HISTORY LOG:                                                    00660052
009500*--------------------------------------------------------------*  00670052
009600* DATE: 07/03/2003                                                00680052
009700* WR/IR#: WR#21428                                                00690052
009800* PROGRAMMER: SCOTT BARTELT                                       00700052
009900* DESCRIPTION: WHEN A NEW STORE IS SERVER READY, BUT NOT YET      00710052
010000*              OPEN THE POS CAPABILITY LEVEL IS SET TO A "5".     00720052
010100*              IN THE FUTURE WE WILL WANT STORES AT THIS STAGE    00730052
010200*              TO RECEIVE THE NEW PROMO PROJECT FILES.  HOWEVER,  00740052
010300*              WHILE THE NEW PROMO SYSTEM IS BEING ROLLED OUT     00750052
010400*              WE DO NOT WANT THIS TO OCCUR.  THEREFORE, AT THIS  00760052
010500*              POINT ONLY THOSE STORES WHICH HAVE A POS CAPABILITY00770052
010600*              LEVEL GREATER THAN "11" SHOULD RECIEVE THE NEW     00780052
010700*              SYSTEM FILES.  ONCE THE SYSTEM IS ROLLED OUT THE   00790052
010800*              "11"'S SHOULD BE CHANGED TO A "5" WHERE INDICATED. 00800052
010900*                                                                 00810052
011000* DATE: 07/21/2003                                                00820052
011100* WR/IR#: WR#21428                                                00830052
011200* PROGRAMMER: SCOTT BARTELT                                       00840052
011300* DESCRIPTION: CHANGED PROGRAM TO LOOK FOR BATCH DATE WHEN LOOKING00850052
011400*              FOR FULL FILE PLU STORES.                          00860052
011500*                                                                 00870052
011600* DATE: 09/09/2003                                                00880052
011700* WR/IR#: WR#21428                                                00890052
011800* PROGRAMMER: SCOTT BARTELT                                       00900052
011900* DESCRIPTION: PROGRAM NEEDED TO BE CHANGED TO INCLUDE E-COMMERCE 00910052
012000*                                                                 00920052
012100* DATE: 09/15/2003                                                00930052
012200* WR/IR#: WR#21428                                                00940052
012300* PROGRAMMER: SCOTT BARTELT                                       00950052
012400* DESCRIPTION: REVERTING THE CODE BACK TO ALLOWING A "5" IN       00960052
012500*              THE POS CAPABILITY LEVEL TO BE PICKED UP BY THIS   00970052
012600*              PROGRAM.                                           00980052
012700*                                                                 00990052
012800* DATE: 10/09/2003                                                01000052
012900* WR/IR#: IR#593693                                               01010052
013000* PROGRAMMER: SCOTT BARTELT                                       01020052
013100* DESCRIPTION: CHANGED THE UNIQUE DATE CURSOR TO PICK UP DATES    01030052
013200*              REGARDLESS OF STATUS CODE.  THE SITUATION OCCURED  01040052
013300*              WHERE A PROMOTION WAS CANCELLED IN THE MORNING     01050052
013400*              WHICH GENERATED AN EMERGENCY AND A NIGHTLY DELETE  01060052
013500*              RECORD.  HOWEVER, WHEN THE NIGHTLY STORE LIST WAS  01070052
013600*              CREATED THE DATE FOR THE DELETE WAS NOT INCLUDED   01080052
013700*              DUE TO THE STATUS.                                 01090052
013800*                                                                 01100052
013900* DATE: 02/17/2004                                                01110052
014000* WR/IR#: IR#633844                                               01120052
014100* PROGRAMMER: SCOTT BARTELT                                       01130052
014200* DESCRIPTION: A PROBLEM WAS HAPPENING WHERE THE ADHOC STORE      01140052
014300*              GROUPS WERE NOT BEING PUT OUT TO THE STORE GROUP   01150052
014400*              FILE IF THE PROMOTION START DATE WAS EQUAL TO      01160052
014500*              THE CURRENT BATCH DATE.                            01170052
014600*                                                                 01180052
014700* DATE: 02/19/2004                                                01190052
014800* WR/IR#: IR#623390                                               01200052
014900* PROGRAMMER: SANDY POTTER                                        01210052
015000* DESCRIPTION: NEW STORES WITH POS CAP LVL ID UPDATED TO 12 THE   01220052
015100*              BEFORE OPENING WERE NOT INCLUDED IN THE CONVERTED  01230052
015200*              STORES OR STORE LIST FILES.  TO FIX THIS, THREE    01240052
015300*              CURSORS WERE CHANGED TO SEPARATE OPEN/CLOSE DATE   01250052
015400*              LOGIC FROM POS CAP LVL ID LOGIC.                   01260052
015500*                                                                 01270052
015600* DATE: 03/01/2004                                                01280052
015700* WR/IR#: IR#636594                                               01290052
015800* PROGRAMMER: SCOTT BARTELT                                       01300052
015900* DESCRIPTION: FILE DISTRIBUTION DATES ARE AT TIMES MISSING IN    01310052
016000*              THE STORE GROUP FILE.  THIS IS BEING CAUSED BY     01320052
016100*              SITUATIONS WHERE A CHANGE IS MADE TO A PROMOTION   01330052
016200*              AND THEN LATER THAT SAME DAY ANOTHER CHANGE IS     01340052
016300*              MADE TO THE PROMOTION START DATE.  TO CORRECT      01350052
016400*              THIS THE PROGRAM IS BEING CHANGED TO PROCESS ALL   01360052
016500*              DATES BETWEEN "X" AND "Y".  ALSO, ANY DATES WHICH  01370052
016600*              ARE ON PROMOTIONS WHICH ARE STILL RUNNING BUT LESS 01380052
016700*              THAN "X" WILL BE PROCESSED.  ALSO, TO IMPROVE      01390052
016800*              PERFORMANCE THE 'ACLT_STRT/END_TMST' VARIABLES ARE 01400052
016900*              BEING REPLACED WITH THE 'PROMO_STRT/END_TMST       01410052
017000*              VARIABLES IN ORDER TO MAKE USE OF AN INDEX, AND    01420052
017100*              THEY HOST VARIABLES ARE BEING PUT INTO A TIMESTAMP 01430052
017200*              FORMAT TO CREATE MATCHING COLUMNS.                 01440052
017300*                                                                 01450052
017400* DATE: 07/14/2004                                                01460052
017500* WR/IR#: WR#270320                                               01470052
017600* PROGRAMMER: SANDY POTTER                                        01480052
017700* DESCRIPTION: NEW PROMO LIST OF CONVERTED STORES IS REPLACED WITH01490052
017800*              NEW FPLU (FUTURE PERM) LIST OF CONVERTED STORES.   01500052
017900*              SINCE THIS IS A NEW CONVERSION, THE POS_CAP_LVL_ID 01510052
018000*              TO BE INCLUDED IS NOW > 12 (HAD BEEN > 11).        01520052
018100*              FOR THE NEW FPLU LIST, TEMPORARILY OMIT STORES WITH01530052
018200*              POS_CAP_LVL_ID OF 5 (NEW STORES).  THIS MUST BE    01540052
018300*              CHANGED BACK DURING ROLLOUT, WHEN THESE STORES ARE 01550052
018400*              CONVERTED.                                         01560052
018500*                                                                 01570052
018600* DATE: 09/21/2004                                                01580052
018700* WR/IR#: IR#693452                                               01590052
018800* PROGRAMMER: SANDY POTTER                                        01600052
018900* DESCRIPTION: FPLU REQUIRES STORE LIST DATA FOR TOMORROW + 14    01610052
019000*              DAYS.  THE CURRENT CALCULATION IS TODAY + 14 DAYS. 01620052
019100*              CHANGED THE PC-STR-GRP-LST-FUT-DAYS VALUE FROM 14  01630052
019200*              TO 15, SO THE THAT THE EXTRA DAY WILL BE INCLUDED. 01640052
019300*                                                                 01650052
019400* DATE: 10/01/2004                                                01660052
019500* WR/IR#: WR#027626                                               01670052
019600* PROGRAMMER: TOM PETERSON/SCOTT BARTELT                          01680052
019700* DESCRIPTION: SPLIT UP ADHOC-STORE-LIST CURSOR INTO TWO CURSORS  01690052
019800*              - ADHOC-STORE-GROUP AND ADHOC-STORE-LIST - SO      01700052
019900*              XST_PROMO_ADHC_RLT TABLE IS PROCESSED FIRST.       01710052
020000*              CHANGED BOTH CURSORS TO USE TIMESTAMP FORMAT       01720052
020100*              INSTEAD OF DATE FORMAT WHERE APPLICABLE FOR        01730052
020200*              BETTER PERFORMANCE.                                01740052
020300*                                                                 01750052
020400* DATE: 08/01/2005                                                01760052
020500* WR/IR#: WR#029173                                               01770052
020600* PROGRAMMER: TOM HANSON                                          01780052
020700* DESCRIPTION: ADDED 'SM' TYPE CODE ONTO THE REFRESH-STORE-LIST   01790052
020800*              CURSOR. ALSO ADDED '99997' AS A LEGEL STORE GROUP  01800052
020900*              TYPE ID. NECESSARY TO SEND FULL FILES FOR THE      01810052
021000*              RF HA ADSET SIGN DATA PROJECT.                     01820052
021100*                                                                 01830052
021200* DATE: 02/23/2007                                                01840052
021300* WR/IR#: WR32706                                                 01850052
021400* PROGRAMMER: ERIC HELLAND                                        01860052
021500* DESCRIPTION: CLONED FROM EPKUT129 FOR NEXT GENERATION POS.      01870052
021600*            ADDED FILES AND LOGIC TO SEPARATE 3.X FROM 5.X STORES01880052
021700*            BASED ON THE POS_CAP_LVL_IND IN THE XST_LOC_ATTR TBL.01890052
021800*                                                                 01900052
018400* DATE: 02/23/2007, 03/20/2007                                    01910052
018500* WR/IR#: WR32706                                                 01920052
018600* PROGRAMMER: ERIC HELLAND, CHUCK HERO                            01930052
018700* DESCRIPTION: CHANGED OUTPUT FORMAT FROM BINARY TO EBCDIC.       01940052
018800*              CHANGED OUTPUT RECORD LRCL TO FIT DATA.            01950052
018800*              THE FTP TO THE MID-TIER WILL CONVERT TO ASCII.     01960052
018800*                                                                 01970052
021200* DATE: 04/19/2007                                                01980052
021300* WR/IR#: WR32706                                                 01990052
021400* PROGRAMMER: CHUCK HERO                                          02000052
021500* DESCRIPTION: ADD 'AD' TYPE CODE FOR THE REFRESH-STORE-LIST      02010052
021700*              CURSOR, AND '99996' STORE GROUP,                   02020052
021700*              FOR ASSOCIATE DISCOUNT FULL FILES.                 02030052
022300*                                                                 02040052
021200* DATE: 05/17/2007                                                02050052
021300* WR/IR#: WR32706                                                 02060052
021400* PROGRAMMER: CHUCK HERO                                          02070052
021500* DESCRIPTION: CHANGE 'SM' TO 'XS' TYPE CODE FOR THE              02080052
021700*              REFRESH-STORE-LIST CURSOR, FOR SIGN FULL FILES.    02090052
022300*                                                                 02100052
021200* DATE: 05/30/2007                                                02110052
021300* WR/IR#: WR32706                                                 02120052
021400* PROGRAMMER: CHUCK HERO                                          02130052
021500* DESCRIPTION: CHANGE TO EITHER 'SM' OR 'XS' TYPE CODE FOR THE    02140052
021700*              REFRESH-STORE-LIST CURSOR, FOR SIGN FULL FILES.    02150052
021700*              REMOVE POS_CAP_LVL_IND LOGIC, FOR NEXTGEN PHASE 1. 02160052
022300*                                                                 02170052
021200* DATE: 06/12/2007                                                02180052
021300* WR/IR#: WR32706                                                 02190052
021400* PROGRAMMER: CHUCK HERO                                          02200052
021500* DESCRIPTION: INCORPORATE CHANGES MADE TO EPKUT129 FOR MOS       02210052
021700*              PROJECT. (MARGARET MORRISON FOR WR#030069.)        02220052
018380*                                                                 02230053
018310* DATE: 08/21/2009                                                02240053
018320* WR/IR#: INC000000911721                                         02250053
018330* PROGRAMMER: DAVID WELLER                                        02260053
018340* DESCRIPTION: PREVENT CLOSED STORES FROM APPEARING ON THE        02270053
      *     STORE GROUP LIST FILE.                                      02280055
021800*                                                                 02290052
021900* DATE: 02/08/12                                                  02300059
      * CRQ#: 21029                                                 *   02310059
022100* PROGRAMMER: RICH KELLEN                                         02320058
022200* DESCRIPTION: ADD NEW 'AS' CODE TO ALLOW FOR FULL FILE           02330058
022300*              REFRESHES OF ASSOCIATE DATA.                       02340058
021800*                                                                 02350058
C99999* DATE: 04/08/2014                                                02360064
C99999* CHG#: CHG0078914                                                02370064
C99999* PROGRAMMER: DARYL WOELFEL                                       02380061
C99999* DESCRIPTION: ADDED NEW 'SI' CODE TO ALLOW FOR FULL FILE         02390061
C99999*              REFRESHES FOR NEW SIGNING SYSTEM                   02400061
021800*                                                                 02410061
021900* DATE: MM/DD/YY                                                  02420058
022000* WR/IR#:                                                         02430058
022100* PROGRAMMER:                                                     02440058
022200* DESCRIPTION:                                                    02450058
022300*                                                                 02460058
022400*--------------------------------------------------------------*  02470052
022500 ENVIRONMENT DIVISION.                                            02480052
022600*--------------------------------------------------------------*  02490052
022700 CONFIGURATION SECTION.                                           02500052
022800 SOURCE-COMPUTER.        IBM-3090.                                02510052
022900 OBJECT-COMPUTER.        IBM-3090.                                02520052
023000                                                                  02530052
023100 INPUT-OUTPUT SECTION.                                            02540052
023200                                                                  02550052
023300 FILE-CONTROL.                                                    02560052
023400                                                                  02570052
023500     SELECT CONTROL-CARD-BATCH-DATE                               02580052
023600            ASSIGN TO INP01.                                      02590052
023700     SELECT CONTROL-CARD-ADVANCE-DAYS                             02600052
023800            ASSIGN TO INP02.                                      02610052
023900                                                                  02620052
024000     SELECT NEW-FPLU-FILE                                         02630052
024100            ASSIGN TO OUT01.                                      02640052
024200     SELECT STORE-GROUP-FILE                                      02650052
024300            ASSIGN TO OUT02.                                      02660052
024800                                                                  02670052
024900 DATA DIVISION.                                                   02680052
025000 FILE SECTION.                                                    02690052
025100                                                                  02700052
025200 FD  CONTROL-CARD-ADVANCE-DAYS                                    02710052
025300     RECORDING MODE F                                             02720052
025400     BLOCK CONTAINS 0 RECORDS                                     02730052
025500     LABEL RECORDS ARE OMITTED                                    02740052
025600     DATA RECORD IS CONTROL-ADVANCE-DAYS-REC.                     02750052
025700 01  CONTROL-ADVANCE-DAYS-REC     PIC  X(080).                    02760052
025800                                                                  02770052
025900 FD  CONTROL-CARD-BATCH-DATE                                      02780052
026000     RECORDING MODE F                                             02790052
026100     BLOCK CONTAINS 0 RECORDS                                     02800052
026200     LABEL RECORDS ARE OMITTED                                    02810052
026300     DATA RECORD IS CONTROL-BATCH-DATE-RECORD.                    02820052
026400 01  CONTROL-BATCH-DATE-RECORD    PIC  X(080).                    02830052
026500                                                                  02840052
026600 FD  NEW-FPLU-FILE                                                02850052
026700     RECORDING MODE F                                             02860052
026800     BLOCK CONTAINS 0 RECORDS                                     02870052
026900     LABEL RECORDS ARE OMITTED                                    02880052
027000     DATA RECORD IS NEW-FPLU-RECORD.                              02890052
027100 01  NEW-FPLU-RECORD              PIC  X(006).                    02900052
027200                                                                  02910052
027300 FD  STORE-GROUP-FILE                                             02920052
027400     RECORDING MODE V                                             02930052
027500     BLOCK CONTAINS 0 RECORDS                                     02940052
027600     LABEL RECORDS ARE OMITTED                                    02950052
027700     RECORD IS VARYING FROM 21 TO 34                              02960052
027800     DATA RECORDS ARE STORE-HEADER-RECORD                         02970052
027900                      STORE-DETAIL-RECORD.                        02980052
028000 01  STORE-HEADER-RECORD          PIC  X(034).                    02990052
028100 01  STORE-DETAIL-RECORD          PIC  X(021).                    03000052
028200                                                                  03010052
030000 WORKING-STORAGE SECTION.                                         03020052
030100*--------------------------------------------------------------*  03030052
030200* PS - PROGRAM SWITCHES                                           03040052
030300*--------------------------------------------------------------*  03050052
030400 01  PS-PROGRAM-SWITCHES.                                         03060052
030500     05  PS-END-OF-CNTL-CRD-SW        PIC  X(001).                03070052
030600         88  PS-END-OF-CNTL-CRD-FILE              VALUE 'Y'.      03080052
030700         88  PS-NOT-END-OF-CNTL-CRD-FILE          VALUE 'N'.      03090052
030800     05  PS-END-OF-UNIQUE-DATE-SW     PIC X(01).                  03100052
030900         88  PS-END-OF-UNIQUE-DATE-CSR            VALUE 'Y'.      03110052
031000         88  PS-NOT-END-OF-UNIQUE-DATE-CSR        VALUE 'N'.      03120052
031100     05  PS-END-OF-STORE-CSR-SW       PIC X(01).                  03130052
031200         88  PS-END-OF-STORE-CSR                  VALUE 'Y'.      03140052
031300         88  PS-NOT-END-OF-STORE-CSR              VALUE 'N'.      03150052
031400     05  PS-END-OF-STORE-GRP-CSR-SW   PIC X(01).                  03160052
031500         88  PS-END-OF-STORE-GRP-CSR              VALUE 'Y'.      03170052
031600         88  PS-NOT-END-OF-STORE-GRP-CSR          VALUE 'N'.      03180052
031700     05  PS-END-OF-ADHOC-STORE-GRP-SW PIC X(01).                  03190052
031800         88  PS-END-OF-ADHOC-STORE-GRP            VALUE 'Y'.      03200052
031900         88  PS-NOT-END-OF-ADHOC-STORE-GRP        VALUE 'N'.      03210052
032000     05  PS-END-OF-ADHOC-STORE-LIST-SW PIC X(01).                 03220052
032100         88  PS-END-OF-ADHOC-STORE-LIST           VALUE 'Y'.      03230052
032200         88  PS-NOT-END-OF-ADHOC-STORE-LIST       VALUE 'N'.      03240052
032300     05  PS-END-OF-REFRESH-CSR-SW     PIC X(01).                  03250052
032400         88  PS-END-OF-REFRESH-CSR                VALUE 'Y'.      03260052
032500         88  PS-NOT-END-OF-REFRESH-CSR            VALUE 'N'.      03270052
032600     05  PS-FIRST-ADHOC-GRP-FETCH-SW  PIC X(01).                  03280052
032700         88  PS-FIRST-ADHOC-GRP-FETCH             VALUE 'Y'.      03290052
032800         88  PS-NOT-FIRST-ADHOC-GRP-FETCH         VALUE 'N'.      03300052
032900     05  PS-ADHOC-STORE-GROUP-CSR-SW  PIC X(01).                  03310052
033000         88  PS-ADHOC-STORE-GROUP-CSR-OPEN        VALUE 'O'.      03320052
033100         88  PS-ADHOC-STORE-GROUP-CSR-CLOSE       VALUE 'C'.      03330052
033200                                                                  03340052
033300*--------------------------------------------------------------*  03350052
033400* PC- PROGRAM CONSTANTS                                           03360052
033500*--------------------------------------------------------------*  03370052
033600 01  PC-PROGRAM-CONSTANTS.                                        03380052
033700     05  PC-PROGRAM-NAME          PIC X(08) VALUE 'EPKUT429'.     03390052
033800     05  PC-HEX-0A                PIC X(01) VALUE X'0A'.          03400052
033900     05  PC-DEC-ONE               PIC S9(1) VALUE 1.              03410052
034000     05  PC-MAX-RETRIES           PIC 9(9)  VALUE 5.              03420052
034100     05  PC-FIVE-BLANKS           PIC X(05) VALUE SPACES.         03430052
034200     05  PC-STR-GRP-LST-PAST-DAYS PIC 9(03) VALUE 7.              03440052
034300     05  PC-STR-GRP-LST-FUT-DAYS  PIC 9(03) VALUE 15.             03450052
034400                                                                  03460052
034500*--------------------------------------------------------------*  03470052
034600* PV- PROGRAM VARIABLES                                           03480052
034700*--------------------------------------------------------------*  03490052
034800 01  PV-PROGRAM-VARAIBLES.                                        03500052
034900     05  PV-PARAGRAPH-NAME          PIC X(40)   VALUE SPACES.     03510052
035000     05  PD-DB2-OPERATION           PIC X(15)   VALUE SPACES.     03520052
035100                                                                  03530052
035200     05  PV-SQL-SUB                 PIC S9(04)  VALUE 0  COMP.    03540052
035300     05  PV-ABEND-CODE              PIC 9999    VALUE 0  COMP.    03550052
035400     05  PV-LENGTH                  PIC S9(8)   VALUE 0  COMP.    03560052
035500                                                                  03570052
035600     05  PV-STORE-NUMBER            PIC 9(05)   VALUE 0.          03580052
035700     05  PV-STORE-GROUP-TYPE        PIC 9(05)   VALUE 0.          03590052
035800     05  PV-STORE-GROUP-ID          PIC 9(10)   VALUE 0.          03600052
035900                                                                  03610052
036000     05  PV-WORK-DATE-CCYYMMDD      PIC X(08)   VALUE SPACES.     03620052
036100     05  PV-WORK-DATE-CCYY-MM-DD    PIC X(10)   VALUE SPACES.     03630052
036200     05  PV-ADHOC-STR-GRP-DATE      PIC X(10)   VALUE SPACES.     03640052
036300     05  PV-BATCH-DATE              PIC X(10)   VALUE SPACES.     03650052
036400     05  PV-ADV-STR-OPEN-DATE       PIC X(10)   VALUE SPACES.     03660052
036500     05  PV-COMP-DTE-RNGE-STRT      PIC X(10)   VALUE SPACES.     03670052
036600     05  PV-COMP-DTE-RNGE-END       PIC X(10)   VALUE SPACES.     03680052
036700     05  PV-COMP-DTE-RNGE-NEXT-DAY  PIC X(10)   VALUE SPACES.     03690052
036800     05  PV-UNIQUE-DATE             PIC X(10)   VALUE SPACES.     03700052
036900                                                                  03710052
037000     05  PV-STORE-GROUP-RECORD      PIC X(80)   VALUE SPACES.     03720052
037100     05  PV-EBCDIC-RECORD           PIC X(80)   VALUE SPACES.     03730052
037200     05  PV-ASCII-RECORD            PIC X(80)   VALUE SPACES.     03740052
037300                                                                  03750052
037400     05  PV-STRT-RANGE-TIMESTAMP-DET.                             03760052
037500         10  PV-STRT-RANGE-DATE.                                  03770052
037600             15  PV-STRT-RANGE-CC   PIC X(02)   VALUE SPACES.     03780052
037700             15  PV-STRT-RANGE-YY   PIC X(02)   VALUE SPACES.     03790052
037800             15  FILLER             PIC X(01)   VALUE '-'.        03800052
037900             15  PV-STRT-RANGE-MM   PIC X(02)   VALUE SPACES.     03810052
038000             15  FILLER             PIC X(01)   VALUE '-'.        03820052
038100             15  PV-STRT-RANGE-DD   PIC X(02)   VALUE SPACES.     03830052
038200         10  PV-STRT-RANGE-TIME.                                  03840052
038300             15  FILLER             PIC X(01)   VALUE '-'.        03850052
038400             15  PV-STRT-RANGE-HH   PIC X(02)   VALUE '00'.       03860052
038500             15  FILLER             PIC X(01)   VALUE '.'.        03870052
038600             15  PV-STRT-RANGE-MN   PIC X(02)   VALUE '00'.       03880052
038700             15  FILLER             PIC X(01)   VALUE '.'.        03890052
038800             15  PV-STRT-RANGE-SS   PIC X(02)   VALUE '00'.       03900052
038900             15  FILLER             PIC X(01)   VALUE '.'.        03910052
039000             15  PV-STRT-RANGE-NN   PIC X(06)   VALUE '000000'.   03920052
039100                                                                  03930052
039200     05  PV-STRT-RANGE-TIMESTAMP REDEFINES                        03940052
039300           PV-STRT-RANGE-TIMESTAMP-DET                            03950052
039400                                    PIC X(26).                    03960052
039500                                                                  03970052
039600     05  PV-END-RANGE-TIMESTAMP-DET.                              03980052
039700         10  PV-END-RANGE-DATE.                                   03990052
039800             15  PV-END-RANGE-CC    PIC X(02)   VALUE SPACES.     04000052
039900             15  PV-END-RANGE-YY    PIC X(02)   VALUE SPACES.     04010052
040000             15  FILLER             PIC X(01)   VALUE '-'.        04020052
040100             15  PV-END-RANGE-MM    PIC X(02)   VALUE SPACES.     04030052
040200             15  FILLER             PIC X(01)   VALUE '-'.        04040052
040300             15  PV-END-RANGE-DD    PIC X(02)   VALUE SPACES.     04050052
040400         10  PV-END-RANGE-TIME.                                   04060052
040500             15  FILLER             PIC X(01)   VALUE '-'.        04070052
040600             15  PV-END-RANGE-HH    PIC X(02)   VALUE '23'.       04080052
040700             15  FILLER             PIC X(01)   VALUE '.'.        04090052
040800             15  PV-END-RANGE-MN    PIC X(02)   VALUE '59'.       04100052
040900             15  FILLER             PIC X(01)   VALUE '.'.        04110052
041000             15  PV-END-RANGE-SS    PIC X(02)   VALUE '59'.       04120052
041100             15  FILLER             PIC X(01)   VALUE '.'.        04130052
041200             15  PV-END-RANGE-NN    PIC X(06)   VALUE '999999'.   04140052
041300                                                                  04150052
041400     05  PV-END-RANGE-TIMESTAMP REDEFINES                         04160052
041500           PV-END-RANGE-TIMESTAMP-DET                             04170052
041600                                    PIC X(26).                    04180052
041700                                                                  04190052
041800     05  PV-EP111-TIMESTAMP-DET.                                  04200052
041900         10  PV-EP111-DATE.                                       04210052
042000             15  PV-EP111-CC        PIC X(02)   VALUE SPACES.     04220052
042100             15  PV-EP111-YY        PIC X(02)   VALUE SPACES.     04230052
042200             15  FILLER             PIC X(01)   VALUE '-'.        04240052
042300             15  PV-EP111-MM        PIC X(02)   VALUE SPACES.     04250052
042400             15  FILLER             PIC X(01)   VALUE '-'.        04260052
042500             15  PV-EP111-DD        PIC X(02)   VALUE SPACES.     04270052
042600         10  PV-EP111-TIME.                                       04280052
042700             15  FILLER             PIC X(01)   VALUE '-'.        04290052
042800             15  PV-EP111-HH        PIC X(02)   VALUE '00'.       04300052
042900             15  FILLER             PIC X(01)   VALUE '.'.        04310052
043000             15  PV-EP111-MN        PIC X(02)   VALUE '00'.       04320052
043100             15  FILLER             PIC X(01)   VALUE '.'.        04330052
043200             15  PV-EP111-SS        PIC X(02)   VALUE '00'.       04340052
043300             15  FILLER             PIC X(01)   VALUE '.'.        04350052
043400             15  PV-EP111-NN        PIC X(06)   VALUE '000000'.   04360052
043500                                                                  04370052
043600     05  PV-EP111-TIMESTAMP REDEFINES                             04380052
043700           PV-EP111-TIMESTAMP-DET   PIC X(26).                    04390052
043800                                                                  04400052
043900*--------------------------------------------------------------*  04410052
044000* LK52- WORK FIELDS FOR DPKUT052 EBCDIC TO ASCII CONVERSION       04420052
044100*       PROGRAM DPKUT052.                                         04430052
044200*--------------------------------------------------------------*  04440052
044300 01 LK52-DPKUT052-SUBRTN-WORK-AREA.                               04450052
044400    05 LK52-CONVERSION-TYPE           PIC  X(01) VALUE SPACES.    04460052
044500    05 LK52-LENGTH                    PIC S9(03) COMP-3.          04470052
044600    05 LK52-FROM-AREA                 PIC  X(50) VALUE SPACES.    04480052
044700    05 LK52-TO-AREA                   PIC  X(50) VALUE SPACES.    04490052
044800    05 LK52-RETURN-CODE               PIC  X(02) VALUE '00'.      04500052
044900       88 GOOD-LK52-RET-CODE                     VALUE '00'.      04510052
045000    05 LK52-FILE-NAME-LENGTH-50       PIC S9(03) VALUE 50         04520052
045100                                                 COMP-3.          04530052
045200    05 LK52-FILE-NAME-LENGTH-24       PIC S9(03) VALUE 24         04540052
045300                                                 COMP-3.          04550052
045400    05 LK52-STORE-NBR-LENGTH          PIC S9(03) VALUE 4          04560052
045500                                                 COMP-3.          04570052
045600                                                                  04580052
045700*--------------------------------------------------------------*  04590052
045800* EPCC045 CONTROL CARD LAYOUT - ADVANCE DAYS                      04600052
045900*--------------------------------------------------------------*  04610052
046000     COPY EPRD045.                                                04620052
046100                                                                  04630052
046200*--------------------------------------------------------------*  04640052
046300* EPCC111 CONTROL CARD LAYOUT - BATCH RUN DATE                    04650052
046400*--------------------------------------------------------------*  04660052
046500     COPY EPRD111.                                                04670052
046600                                                                  04680052
046700*--------------------------------------------------------------*  04690052
046800* EPCC425 RECORD LAYOUT FOR THE DETAIL RECORDS WHICH ARE          04700052
046900*         WRITTEN TO THE STORE-GROUP-FILE.  USED IN CONJUCTION    04710052
047000*         WITH EPCC427                                            04720052
047100*--------------------------------------------------------------*  04730052
047200     COPY EPRD425.                                                04740052
047300                                                                  04750052
047400*--------------------------------------------------------------*  04760052
047500* EPCC426 RECORD LAYOUT FOR THE DETAIL RECORDS WHICH ARE          04770052
047600*         WRITTEN TO THE NEW-FPLU-FILE                            04780052
047700*--------------------------------------------------------------*  04790052
047800     COPY EPRD426.                                                04800052
047900                                                                  04810052
048000*--------------------------------------------------------------*  04820052
048100* EPCC427 RECORD LAYOUT FOR THE HEADER RECORDS WHICH ARE          04830052
048200*         WRITTEN TO THE STORE GROUP FILE.  USED IN CONJUCTION    04840052
048300*         WITH EPCC425                                            04850052
048400*--------------------------------------------------------------*  04860052
048500     COPY EPRD427.                                                04870052
048600                                                                  04880052
048700*--------------------------------------------------------------*  04890052
048800* DATE ROUTINE COPY MEMBERS                                       04900052
048900*--------------------------------------------------------------*  04910052
049000     COPY DPWS500.                                                04920052
049100                                                                  04930052
049200*--------------------------------------------------------------*  04940052
049300* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         04950052
049400*--------------------------------------------------------------*  04960052
049500     COPY DPWS004.                                                04970052
049600                                                                  04980052
049700*--------------------------------------------------------------*  04990052
049800* DB2 ABEND COPYBOOK                                              05000052
049900*--------------------------------------------------------------*  05010052
050000     COPY DPWS900.                                                05020052
050100                                                                  05030052
050200*--------------------------------------------------------------*  05040052
050300* DB2 MESSAGE AREA                                                05050052
050400*--------------------------------------------------------------*  05060052
050500     COPY SQLCA2.                                                 05070052
050600                                                                  05080052
050700*--------------------------------------------------------------*  05090052
050800* PV- PROGRAM COUNTERS                                            05100052
050900*--------------------------------------------------------------*  05110052
051000 01  PV-PROGRAM-COUNTERS         COMP-3.                          05120052
051100     05  PV-UNIQUE-DATE-FETCHES     PIC 9(9) VALUE 0.             05130052
051200     05  PV-DAYS-IN-COMP-RANGE      PIC 9(9) VALUE 0.             05140052
051300     05  PV-STORE-GROUP-FETCHES     PIC 9(9) VALUE 0.             05150052
051400     05  PV-ADHOC-FETCHES           PIC 9(9) VALUE 0.             05160052
051500     05  PV-REFRESH-FETCHES         PIC 9(9) VALUE 0.             05170052
051700                                                                  05180052
051800     05  PV-COUNT-OUTPUT-RECORDS    PIC 9(9) VALUE 0.             05190052
051900     05  PV-COUNT-EP425-RECORDS     PIC 9(9) VALUE 0.             05200052
052100     05  PV-COUNT-EP426-RECORDS     PIC 9(9) VALUE 0.             05210052
052300     05  PV-COUNT-EP427-RECORDS     PIC 9(9) VALUE 0.             05220052
052400                                                                  05230052
052500*--------------------------------------------------------------*  05240052
052600* ERROR HANDLING VARIABLES                                        05250052
052700*--------------------------------------------------------------*  05260052
052800 01  PV-MISC-ABEND-FIELDS.                                        05270052
052900     05  PV-DB2-OPERATION        PIC X(30) VALUE SPACES.          05280052
053000                                                                  05290052
053100 01  ABEND-CODE                  PIC S9(4) VALUE 0  COMP SYNC.    05300052
053200     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           05310052
053300     88  ABEND-4013-DB2-ERROR              VALUE +4013.           05320052
053400     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           05330052
053500     88  ABEND-4020-MQ-ERROR               VALUE +4020.           05340052
053600     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           05350052
053700     88  ABEND-4008                        VALUE +4008.           05360052
053800     88  ABEND-4005                        VALUE +4005.           05370052
053900                                                                  05380052
054000*--------------------------------------------------------------*  05390052
054100* DB2 COMMUNICATIONS AREA                                         05400052
054200*--------------------------------------------------------------*  05410052
054300     EXEC SQL                                                     05420052
054400       INCLUDE SQLCA                                              05430052
054500     END-EXEC.                                                    05440052
054600                                                                  05450052
054700*--------------------------------------------------------------*  05460052
054800* DB2 TABLE EPT00010(EPT_STR_FIL_RFRSH) STORE REFRESH TABLE       05470052
054900*--------------------------------------------------------------*  05480052
055000     EXEC SQL                                                     05490052
055100       INCLUDE EPT00010                                           05500052
055200     END-EXEC.                                                    05510052
055300                                                                  05520052
055400*--------------------------------------------------------------*  05530052
055500* DB2 TABLE XST00001(XST_LOC) - LOCATION TABLE                    05540052
055600*--------------------------------------------------------------*  05550052
055700     EXEC SQL                                                     05560052
055800       INCLUDE XST00001                                           05570052
055900     END-EXEC.                                                    05580052
056000                                                                  05590052
056100*--------------------------------------------------------------*  05600052
056200* DB2 TABLE XST00025(XST_LOC_ATTR) - LOCATION ATTRIBUTE TABLE     05610052
056300*--------------------------------------------------------------*  05620052
056400     EXEC SQL                                                     05630052
056500       INCLUDE XST00025                                           05640052
056600     END-EXEC.                                                    05650052
056700                                                                  05660052
056800*--------------------------------------------------------------*  05670052
056900* DB2 TABLE XST00023(XST_STR_GP_MBSHP) - STORE GROUP              05680052
057000*                                        MEMBERSHIP TABLE         05690052
057100*--------------------------------------------------------------*  05700052
057200     EXEC SQL                                                     05710052
057300       INCLUDE XST00023                                           05720052
057400     END-EXEC.                                                    05730052
057500                                                                  05740052
057600*--------------------------------------------------------------*  05750052
057700* DB2 TABLE XST00029(XST_PROMO_STR_GP) - PROMO STORE GROUP        05760052
057800*--------------------------------------------------------------*  05770052
057900     EXEC SQL                                                     05780052
058000       INCLUDE XST00029                                           05790052
058100     END-EXEC.                                                    05800052
058200                                                                  05810052
058300*--------------------------------------------------------------*  05820052
058400* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) ADHOC RELATION           05830052
058500*--------------------------------------------------------------*  05840052
058600     EXEC SQL                                                     05850052
058700       INCLUDE XST00031                                           05860052
058800     END-EXEC.                                                    05870052
058900                                                                  05880052
059000*--------------------------------------------------------------*  05890052
059100* DB2 TABLE XST00033(XST_PROMO_ADHC_STR) ADHOC STORES             05900052
059200*--------------------------------------------------------------*  05910052
059300     EXEC SQL                                                     05920052
059400       INCLUDE XST00033                                           05930052
059500     END-EXEC.                                                    05940052
059600                                                                  05950052
059700*--------------------------------------------------------------*  05960052
059800* CURSOR USED TO SELECT THOSE STORES THAT ARE DEPARTMENT STORES   05970052
059900*  (LOC_TYPE_CDE = 'DS')                                          05980052
060000*                                                                 05990052
060100* AND ARE OPEN AND ON NEW FPLU  SYSTEM (POS_CAP_LVL_ID > 12) OR   06000052
060200*  AREN'T OPEN, BUT WILL BE ON NEW FPLU  SYSTEM WHEN THEY OPEN    06010052
060300*  (POS_CAP_LVL_ID = 5).  THE OPEN DATE MUST BE WITHIN THE        06020052
060400*  NUMBER OF ADVANCE DAYS SPECIFIED ON THE EPCC045 CONTROL CARD   06030052
060500*  FROM THE CURRENT BATCH DATE WHICH IS SPECIFIED ON THE EPCC111  06040052
060600*  CONTROL CARD.                                                  06050052
060700*                                                                 06060052
060800*--------------------------------------------------------------*  06070052
060900     EXEC SQL                                                     06080052
061000       DECLARE NEW-FPLU-STORES    CURSOR FOR                      06090052
061100                                                                  06100052
061200         SELECT  LOC.LOC_NBR                                      06110052
061300                ,LOC.LOC_TYP_CDE                                  06120052
061400                ,LOC.OPN_DTE                                      06130052
061500                ,LOC.CLO_DTE                                      06140052
061600                                                                  06150052
061700                ,ATTR.POS_CAP_LVL_ID                              06160052
061800                                                                  06170052
061900           FROM XST_LOC       LOC                                 06180052
062000               ,XST_LOC_ATTR  ATTR                                06190052
062100                                                                  06200052
062200          WHERE  LOC.LOC_NBR     =  ATTR.LOC_NBR                  06210052
062300            AND  LOC.LOC_TYP_CDE = 'DS'                           06220052
062400                                                                  06230052
062500            AND (ATTR.POS_CAP_LVL_ID > 12                         06240052
062600             OR  ATTR.POS_CAP_LVL_ID = 5)                         06250052
062700                                                                  06260052
062800            AND (:EP111-CC-CRNT-DTE                               06270052
062900                        BETWEEN  LOC.OPN_DTE                      06280052
063000                            AND  LOC.CLO_DTE                      06290052
063100             OR   LOC.OPN_DTE                                     06300052
063200                        BETWEEN :EP111-CC-CRNT-DTE                06310052
063300                            AND :PV-ADV-STR-OPEN-DATE)            06320052
063400                                                                  06330052
063500         FOR FETCH ONLY                                           06340052
063600         WITH UR                                                  06350052
063700                                                                  06360052
063800     END-EXEC.                                                    06370052
063900                                                                  06380052
064000*--------------------------------------------------------------*  06390052
064100* CURSOR SELECTS THOSE STORES FOR FULL PLU FILES.  ALL STORES     06400052
064200*  THAT HAVE A REFRESH DATE = BATCH DATE OR = NULL WILL HAVE AN   06410052
064300*  OUTPUT RECORD CREATED.                                         06420052
064400*                                                                 06430052
064500*--------------------------------------------------------------*  06440052
064600     EXEC SQL                                                     06450052
064700       DECLARE REFRESH-STORE-LIST CURSOR FOR                      06460052
064800                                                                  06470052
064900         SELECT  STR_NBR                                          06480052
065000                ,RFRSH_TYP_CDE                                    06490052
065100                                                                  06500052
065200           FROM  EPT_STR_FIL_RFRSH                                06510052
065300                                                                  06520052
065400          WHERE RFRSH_TYP_CDE IN ('PL', 'XS', 'SM', 'AD', 'AS',   06530060
065400                                  'SI')                           06540060
065500            AND (RFRSH_DTE   IS NULL                              06550052
065600             OR  RFRSH_DTE  =  :PV-WORK-DATE-CCYY-MM-DD)          06560052
065700                                                                  06570052
065800          ORDER BY RFRSH_TYP_CDE DESC                             06580052
065900                  ,STR_NBR                                        06590052
066000                                                                  06600052
066100         FOR FETCH ONLY                                           06610052
066200         WITH UR                                                  06620052
066300                                                                  06630052
066400     END-EXEC.                                                    06640052
066500                                                                  06650052
066600*--------------------------------------------------------------*  06660052
066700* CURSOR FINDS THE UNIQUE SET OF PROMOTION DATES BETWEEN THE      06670052
066800*  XST00029(XST_PROMO_STR_GRP) AND XST00031(XST_PROMO_ADHC_RLT)   06680052
066900*  TABLES WHICH STARTED PRIOR TO THE START OF THE COMPLETE DATE   06690052
067000*  RANGE SET(PROMO_STRT_TMST < PV-COMP-DTE-RNGE-STRT) AND ARE     06700052
067100*  STILL RUNNING(PROMO_END_TMST >= BATCH DATE).  THESE DATES      06710052
067200*  ARE THEN EACH USED IN THE STORE-GROUP-LIST AND IN THE          06720052
067300*  ADHOC-STORE-LIST CURSORS TO RETRIEVE THOSE STORES THAT NEED    06730052
067400*  TO RECEIVE THE FILES.                                          06740052
067500*                                                                 06750052
067600* SOMETHING TO NOTE ABOUT THIS CURSOR IS THAT IT MOVES THE        06760052
067700*  DATES IN TO A TIMESTAMP FORMAT EVEN THOUGH THE TIME IS SET     06770052
067800*  TO ZERO.  THIS IS DONE IN ORDER TO IMPROVE THE EFFICIENCY OF   06780052
067900*  THE CURSOR.  DOING THIS ALLOWS DB2 TO MATCH THE COLUMNS.       06790052
068000*--------------------------------------------------------------*  06800052
068100     EXEC SQL                                                     06810052
068200       DECLARE UNIQUE-DATE-CSR CURSOR FOR                         06820052
068300         SELECT DATE (PROMO_STRT_TMST)                            06830052
068400           FROM  XST_PROMO_STR_GP                                 06840052
068500          WHERE PROMO_STRT_TMST  < :PV-STRT-RANGE-TIMESTAMP       06850052
068600            AND PROMO_END_TMST  >= :PV-EP111-TIMESTAMP            06860052
068700                                                                  06870052
068800          UNION                                                   06880052
068900                                                                  06890052
069000         SELECT DATE (PROMO_STRT_TMST)                            06900052
069100           FROM  XST_PROMO_ADHC_RLT                               06910052
069200          WHERE PROMO_STRT_TMST  < :PV-STRT-RANGE-TIMESTAMP       06920052
069300            AND PROMO_END_TMST  >= :PV-EP111-TIMESTAMP            06930052
069400                                                                  06940052
069500         FOR FETCH ONLY                                           06950052
069600         WITH UR                                                  06960052
069700                                                                  06970052
069800     END-EXEC.                                                    06980052
069900                                                                  06990052
070000*--------------------------------------------------------------*  07000052
070100* CURSOR RETRIEVES ALL THE ADHOC STORE GROUPS FOR THE GIVEN DATE. 07010052
070200*                                                                 07020052
070300* SOMETHING TO NOTE ABOUT THIS CURSOR IS THAT IT MOVES THE        07030052
070400*  DATE INTO A TIMESTAMP FORMAT EVEN THOUGH THE TIME IS SET       07040052
070500*  TO ZERO.  THIS IS DONE IN ORDER TO IMPROVE THE EFFICIENCY OF   07050052
070600*  THE CURSOR.  DOING THIS ALLOWS DB2 TO MATCH THE COLUMNS.       07060052
070700*--------------------------------------------------------------*  07070052
070800     EXEC SQL                                                     07080052
070900       DECLARE ADHOC-STORE-GROUP CURSOR FOR                       07090052
071000                                                                  07100052
071100         SELECT  DISTINCT                                         07110052
071200                 DATE(PROMO_STRT_TMST) AS "PROMO STRT DATE"       07120052
071300                ,ADHC_STR_GP_ID                                   07130052
071400                                                                  07140052
071500         FROM XST_PROMO_ADHC_RLT                                  07150052
071600                                                                  07160052
071700          WHERE  PROMO_STRT_TMST BETWEEN                          07170052
071800            :PV-STRT-RANGE-TIMESTAMP AND :PV-END-RANGE-TIMESTAMP  07180052
071900                                                                  07190052
072000         ORDER BY "PROMO STRT DATE", ADHC_STR_GP_ID               07200052
072100         FOR FETCH ONLY                                           07210052
072200         WITH UR                                                  07220052
072300     END-EXEC.                                                    07230052
072400                                                                  07240052
072500*--------------------------------------------------------------*  07250052
072600* CURSOR RETRIEVES ALL THE STORES WHICH ARE PART OF THE ADHOC     07260052
072700*  STORE GROUPS FOR THE GIVEN DATE.                               07270052
072800*                                                                 07280052
072900* SOMETHING TO NOTE ABOUT THIS CURSOR IS THAT IT MOVES THE        07290052
073000*  DATES INTO A TIMESTAMP (AS NEEDED) EVEN THOUGH THE TIME IS SET 07300052
073100*  TO ZERO.  THIS IS DONE IN ORDER TO IMPROVE THE EFFICIENCY OF   07310052
073200*  THE CURSOR.  DOING THIS ALLOWS DB2 TO MATCH THE COLUMNS.       07320052
      *                                                                 07330053
      *  DAVE WELLER ADDED THE FOLLOWING LINE TO THIS CURSOR:           07340053
      *      AND   LOC.CLO_DTE > :EP111-CC-CRNT-DTE                     07350053
      *  IT WAS ADDED TO PREVENT CLOSED STORES FROM APPEARING IN ANY    07360053
      *  ADHOC STORE LIST, EVEN IN A LIST WITH A DATE SO OLD THAT THE   07370053
      *  CLOSED STORE WAS STILL OPEN THEN. THIS WAS DONE BECAUSE        07380053
      *  SERVERS FOR CLOSED STORES NO LONGER EXIST, AND                 07390053
      *  ATTEMPTING TO SEND CHANGES TO A SERVER THAT NO LONGER EXISTS   07400053
      *  CAUSES SEVERE MIDTIER PROBLEMS.                                07410053
073300*--------------------------------------------------------------*  07420052
073400     EXEC SQL                                                     07430052
073500       DECLARE ADHOC-STORE-LIST  CURSOR FOR                       07440052
073600                                                                  07450052
073700         SELECT  DISTINCT                                         07460052
073800                 MBSHP.ADHC_STR_GP_ID                             07470052
073900                ,MBSHP.STR_NBR                                    07480052
074000                                                                  07490052
074100                ,ATTR.POS_CAP_LVL_ID                              07500052
074200                                                                  07510052
074300           FROM XST_PROMO_ADHC_STR  MBSHP                         07520052
074400               ,XST_LOC             LOC                           07530052
074500               ,XST_LOC_ATTR        ATTR                          07540052
074600                                                                  07550052
074700          WHERE  MBSHP.ADHC_STR_GP_ID = :XST00031-ADHC-STR-GP-ID  07560052
074800            AND  MBSHP.STR_NBR       = LOC.LOC_NBR                07570052
074900            AND  LOC.LOC_NBR         = ATTR.LOC_NBR               07580052
075000                                                                  07590052
075100            AND  MBSHP.STAT_CDE      = 'S'                        07600052
075200                                                                  07610052
075300            AND  LOC.LOC_TYP_CDE     = 'DS'                       07620052
075400                                                                  07630052
075500            AND (ATTR.POS_CAP_LVL_ID > 11                         07640052
075600             OR  ATTR.POS_CAP_LVL_ID = 5)                         07650052
075700                                                                  07660052
075800            AND ((:PV-WORK-DATE-CCYY-MM-DD                        07670052
075900                        BETWEEN  LOC.OPN_DTE                      07680052
076000                            AND  LOC.CLO_DTE                      07690052
076100            AND  DATE (MBSHP.EFF_STRT_TMST) <=                    07700052
076200                                 :PV-WORK-DATE-CCYY-MM-DD         07710052
076300            AND  (DATE (MBSHP.EFF_END_TMST)  >=                   07720052
076400                                 :PV-WORK-DATE-CCYY-MM-DD         07730052
076500            OR    DATE (MBSHP.EFF_END_TMST) IS NULL))             07740052
076600                                                                  07750052
076700            OR   LOC.OPN_DTE                                      07760052
076800                       BETWEEN :EP111-CC-CRNT-DTE                 07770052
076900                           AND :PV-ADV-STR-OPEN-DATE)             07780052
076600                                                                  07790053
                  AND   :EP111-CC-CRNT-DTE <= LOC.CLO_DTE               07800054
077000                                                                  07810052
077100         FOR FETCH ONLY                                           07820052
077200         WITH UR                                                  07830052
077300                                                                  07840052
077400     END-EXEC.                                                    07850052
077500                                                                  07860052
077600*--------------------------------------------------------------*  07870052
077700* CURSOR RETRIEVES ALL THE RMS STORE GROUPS AND THE STORES THAT   07880052
077800*  ARE PART OF THE RMS STORE GROUPS FOR THE GIVEN DATE.           07890052
      *                                                                 07900053
      *  DAVE WELLER ADDED THE FOLLOWING LINE TO THIS CURSOR:           07910053
      *      AND   LOC.CLO_DTE > :EP111-CC-CRNT-DTE                     07920053
      *  IT WAS ADDED TO PREVENT CLOSED STORES FROM APPEARING IN ANY    07930053
      *  GROUP LIST, EVEN IN A LIST WITH A DATE SO OLD THAT THE         07940053
      *  CLOSED STORE WAS STILL OPEN THEN. THIS WAS DONE BECAUSE        07950053
      *  SERVERS FOR CLOSED STORES NO LONGER EXIST, AND                 07960053
      *  ATTEMPTING TO SEND CHANGES TO A SERVER THAT NO LONGER EXISTS   07970053
      *  CAUSES SEVERE MIDTIER PROBLEMS.                                07980053
078000*--------------------------------------------------------------*  07990052
078100                                                                  08000052
078200     EXEC SQL                                                     08010052
078300       DECLARE STORE-GROUP-LIST  CURSOR FOR                       08020052
078400                                                                  08030052
078500         SELECT  DISTINCT                                         08040052
078600                 MBSHP.STR_GP_TYP_CDE                             08050052
078700                ,MBSHP.STR_GP_ID                                  08060052
078800                ,MBSHP.STR_NBR                                    08070052
078900                                                                  08080052
079000                ,ATTR.POS_CAP_LVL_ID                              08090052
079100                                                                  08100052
079200           FROM XST_STR_GP_MBSHP    MBSHP                         08110052
079300               ,XST_LOC             LOC                           08120052
079400               ,XST_LOC_ATTR        ATTR                          08130052
079500                                                                  08140052
079600          WHERE  LOC.LOC_NBR     = MBSHP.STR_NBR                  08150052
079700            AND  LOC.LOC_NBR     =  ATTR.LOC_NBR                  08160052
079800            AND  LOC.LOC_TYP_CDE = 'DS'                           08170052
079900                                                                  08180052
080000            AND (ATTR.POS_CAP_LVL_ID > 11                         08190052
080100             OR  ATTR.POS_CAP_LVL_ID = 5)                         08200052
080200                                                                  08210052
PK5381            AND (((:PV-WORK-DATE-CCYY-MM-DD                       08220056
PK5381                        BETWEEN  LOC.OPN_DTE                      08230056
PK5381                            AND  LOC.CLO_DTE                      08240056
PK5381            AND   MBSHP.EFF_BEG_DTE <= :PV-WORK-DATE-CCYY-MM-DD   08250056
PK5381            AND   (MBSHP.EFF_END_DTE >= :PV-WORK-DATE-CCYY-MM-DD  08260056
PK5381             OR    MBSHP.EFF_END_DTE IS NULL)))                   08270056
PK5381                                                                  08280056
PK5381             OR  (LOC.OPN_DTE                                     08290056
PK5381                        BETWEEN :EP111-CC-CRNT-DTE                08300056
PK5381                            AND :PV-ADV-STR-OPEN-DATE             08310056
PK5381            AND   MBSHP.EFF_BEG_DTE <= :EP111-CC-CRNT-DTE         08320056
PK5381            AND   (MBSHP.EFF_END_DTE >= :EP111-CC-CRNT-DTE        08330056
PK5381             OR    MBSHP.EFF_END_DTE IS NULL)))                   08340056
081300                                                                  08350053
                  AND   :EP111-CC-CRNT-DTE <= LOC.CLO_DTE               08360054
081300                                                                  08370052
081400         FOR FETCH ONLY                                           08380052
081500         WITH UR                                                  08390052
081600                                                                  08400052
081700     END-EXEC.                                                    08410052
081800                                                                  08420052
081900 LINKAGE SECTION.                                                 08430052
082000                                                                  08440052
082100*--------------------------------------------------------------*  08450052
082200 PROCEDURE DIVISION.                                              08460052
082300*--------------------------------------------------------------*  08470052
082400 0000-MAINLINE.                                                   08480052
082500                                                                  08490052
082600     PERFORM 1000-INITIALIZATION.                                 08500052
082700                                                                  08510052
082800     PERFORM 2000-CREATE-NEW-FPLU-LIST.                           08520052
082900                                                                  08530052
083000     PERFORM 3000-SELECT-PROMO-DATES.                             08540052
083100                                                                  08550052
083200     PERFORM 4000-PROCESS-DIST-DATE-RANGE.                        08560052
083300                                                                  08570052
083400     PERFORM 9999-WRAPUP.                                         08580052
083500                                                                  08590052
083600     GOBACK.                                                      08600052
083700                                                                  08610052
083800*0000-EXIT.                                                       08620052
083900 EJECT.                                                           08630052
084000*--------------------------------------------------------------*  08640052
085000* 1000-INITIALIZATION.                                            08650052
084100*       - OPENS ALL INPUT/OUTPUT FILES.                           08660052
084200*       - READS THE CONTROL CARD FILES.                           08670052
084300*       - CALLS THE ROUTINES WHICH CALCULATE:                     08680052
084400*         - THE ADVANCE STORE OPEN DATE(BATCH DATE + EPCC045)     08690052
084500*         - THE COMPLETE DATE RANGE START DATE(BATCH DATE -       08700052
084600*           PC-STR-GRP-LST-PAST-DAYS).                            08710052
084700*         - THE COMPLETE DATE RANGE END DATE(BATCH DATE +         08720052
084800*           PC-STR-GRP-LST-FUT-DAYS).                             08730052
084900*--------------------------------------------------------------*  08740052
085000 1000-INITIALIZATION.                                             08750052
085100     MOVE '1000-INITIALIZATION           ' TO PV-PARAGRAPH-NAME.  08760052
085200                                                                  08770052
085300     OPEN INPUT  CONTROL-CARD-BATCH-DATE                          08780052
085400                 CONTROL-CARD-ADVANCE-DAYS.                       08790052
085500     OPEN OUTPUT STORE-GROUP-FILE                                 08800052
085600                 NEW-FPLU-FILE.                                   08810052
085900     DISPLAY ' '.                                                 08820052
086000     DISPLAY '*********************************************'.     08830052
086100     DISPLAY '       PROGRAM NAME: ' PC-PROGRAM-NAME.             08840052
086200     DISPLAY '*********************************************'.     08850052
086300     DISPLAY ' '.                                                 08860052
086400                                                                  08870052
086500     PERFORM 1100-READ-ADVANCE-DAYS-RECORD.                       08880052
086600     PERFORM 1200-READ-BATCH-DATE-RECORD.                         08890052
086700     PERFORM 1300-CALC-ADV-STR-OPN-DTE.                           08900052
086800     PERFORM 1400-CALC-STR-GRP-LST-STRT-DTE.                      08910052
086900     PERFORM 1500-CALC-STR-GRP-LST-END-DTE.                       08920052
087000                                                                  08930052
087100*1000-EXIT.                                                       08940052
087200 EJECT.                                                           08950052
087300*--------------------------------------------------------------*  08960052
087800* 1100-READ-ADVANCE-DAYS-RECORD.                                  08970052
087400*       - READ CONTROL CARD EPCC045.  THIS CONTROL CARD CONTAINS  08980052
087500*         THE NUMBER OF ADVANCE DAYS FOR WHICH FILES SHOULD BE    08990052
087600*         SENT TO STORES PRIOR TO THEM OPENING.                   09000052
087700*--------------------------------------------------------------*  09010052
087800 1100-READ-ADVANCE-DAYS-RECORD.                                   09020052
087900     MOVE '1100-READ-ADVANCE-DAYS-RECORD ' TO PV-PARAGRAPH-NAME.  09030052
088000                                                                  09040052
088100     READ CONTROL-CARD-ADVANCE-DAYS                               09050052
088200                                INTO EP045-ADVDAYS-TO-SND-RECORD  09060052
088300       AT END                                                     09070052
088400          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    09080052
088500                                                                  09090052
088600     IF PS-END-OF-CNTL-CRD-FILE                                   09100052
088700       DISPLAY ' '                                                09110052
088800       DISPLAY '** ABEND     **'                                  09120052
088900       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              09130052
089000       DISPLAY '** PARAGRAPH **  = ' PV-PARAGRAPH-NAME            09140052
089100       DISPLAY '** CONTROL FILE IS EMPTY  '                       09150052
089200       DISPLAY ' '                                                09160052
089300       MOVE +4002 TO ABEND-CODE                                   09170052
089400       CALL 'ILBOABN0' USING ABEND-CODE                           09180052
089500     ELSE                                                         09190052
089600       DISPLAY ' '                                                09200052
089700       DISPLAY '** ADVANCE DAYS FOR RCS FILES     **'             09210052
089800       DISPLAY '** EPCC045   *  = ' EP045-DAYS-TILL-STORE-OPN     09220052
089900       DISPLAY ' '                                                09230052
090000       DISPLAY '** ADVANCE DAYS FOR SV FILES      **'             09240052
090100       DISPLAY '** EPCC045   *  = ' EP045-DAYS-TO-INCR-METRO      09250052
090200       DISPLAY ' '                                                09260052
090300     END-IF.                                                      09270052
090400                                                                  09280052
090500*1100-EXIT.                                                       09290052
090600 EJECT.                                                           09300052
090700*--------------------------------------------------------------*  09310052
091100* 1200-READ-BATCH-DATE-RECORD.                                    09320052
090800*       - READ CONTROL CARD EPCC111.  THIS CONTROL CARD CONTAINS  09330052
090900*         THE CURRENT BATCH DATE.                                 09340052
091000*--------------------------------------------------------------*  09350052
091100 1200-READ-BATCH-DATE-RECORD.                                     09360052
091200     MOVE '1200-READ-BATCH-DATE-RECORD   ' TO PV-PARAGRAPH-NAME.  09370052
091300                                                                  09380052
091400     READ CONTROL-CARD-BATCH-DATE                                 09390052
091500                               INTO EP111-CC-CONTROL-CARD         09400052
091600       AT END                                                     09410052
091700          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    09420052
091800                                                                  09430052
091900     IF PS-END-OF-CNTL-CRD-FILE                                   09440052
092000       DISPLAY ' '                                                09450052
092100       DISPLAY '** ABEND     **'                                  09460052
092200       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              09470052
092300       DISPLAY '** PARAGRAPH **  = ' PV-PARAGRAPH-NAME            09480052
092400       DISPLAY '** CONTROL FILE IS EMPTY  '                       09490052
092500       DISPLAY ' '                                                09500052
092600       MOVE +4002 TO ABEND-CODE                                   09510052
092700       CALL 'ILBOABN0' USING ABEND-CODE                           09520052
092800     ELSE                                                         09530052
092900       DISPLAY '** CURRENT BATCH DATE CONTROL CARD    **'         09540052
093000       DISPLAY '** EPCC111       **  = ' EP111-CC-CRNT-DTE        09550052
093100       DISPLAY ' '                                                09560052
093200     END-IF.                                                      09570052
093300                                                                  09580052
093400     MOVE EP111-CC-CRNT-DTE          TO PV-BATCH-DATE.            09590052
093500                                                                  09600052
093600*1200-EXIT.                                                       09610052
093700 EJECT.                                                           09620052
093800*--------------------------------------------------------------*  09630052
094200* 1300-CALC-ADV-STR-OPN-DTE.                                      09640052
093900*       - CALCULATE THE DATE FOR WHICH FUTURE OPENING STORES      09650052
094000*         SHOULD BE INCLUDED.                                     09660052
094100*--------------------------------------------------------------*  09670052
094200 1300-CALC-ADV-STR-OPN-DTE.                                       09680052
094300     MOVE '1300-CALC-ADV-STR-OPN-DTE     ' TO PV-PARAGRAPH-NAME.  09690052
094400                                                                  09700052
094500     INITIALIZE DPG51 DPG52 DPG53                                 09710052
094600                DPG54 DPG55 DPG56.                                09720052
094700                                                                  09730052
094800     SET DPG51-INCREMENT-DATE       TO TRUE.                      09740052
094900     MOVE EP045-DAYS-TILL-STORE-OPN TO DPG51-INCR-DECR-DAYS-9.    09750052
095000     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    09760052
095100                                                                  09770052
095200     PERFORM 9800-CALL-DATE-ROUTINE.                              09780052
095300                                                                  09790052
095400     MOVE DPG55-DB2-ISO-DATE-FMT    TO PV-ADV-STR-OPEN-DATE.      09800052
095500     DISPLAY 'PV-ADV-STR-OPEN-DATE ---> '                         09810052
095600              PV-ADV-STR-OPEN-DATE.                               09820052
095700                                                                  09830052
095800*1300-EXIT.                                                       09840052
095900 EJECT.                                                           09850052
096000*--------------------------------------------------------------*  09860052
096400* 1400-CALC-STR-GRP-LST-STRT-DTE.                                 09870052
096100*       - CALCULATE THE DATE WHICH WILL SERVE AS THE START DATE   09880052
096200*         OF THE DATE RANGE.                                      09890052
096300*--------------------------------------------------------------*  09900052
096400 1400-CALC-STR-GRP-LST-STRT-DTE.                                  09910052
096500     MOVE '1400-CALC-STR-GRP-LST-STRT-DTE' TO PV-PARAGRAPH-NAME.  09920052
096600                                                                  09930052
096700     INITIALIZE DPG51 DPG52 DPG53                                 09940052
096800                DPG54 DPG55 DPG56.                                09950052
096900                                                                  09960052
097000     SET DPG51-DECREMENT-DATE       TO TRUE.                      09970052
097100     MOVE PC-STR-GRP-LST-PAST-DAYS  TO DPG51-INCR-DECR-DAYS-9.    09980052
097200     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    09990052
097300                                                                  10000052
097400     PERFORM 9800-CALL-DATE-ROUTINE.                              10010052
097500                                                                  10020052
097600     MOVE DPG55-DB2-ISO-DATE-FMT    TO PV-COMP-DTE-RNGE-STRT.     10030052
097700     DISPLAY 'PV-COMP-DTE-RNGE-STRT ---> '                        10040052
097800              PV-COMP-DTE-RNGE-STRT.                              10050052
097900                                                                  10060052
098000*1400-EXIT.                                                       10070052
098100 EJECT.                                                           10080052
098200*--------------------------------------------------------------*  10090052
098600* 1500-CALC-STR-GRP-LST-END-DTE.                                  10100052
098300*       - CALCULATE THE DATE WHICH WILL SERVE AS THE END DATE     10110052
098400*         OF THE DATE RANGE.                                      10120052
098500*--------------------------------------------------------------*  10130052
098600 1500-CALC-STR-GRP-LST-END-DTE.                                   10140052
098700     MOVE '1500-CALC-STR-GRP-LST-END-DTE ' TO PV-PARAGRAPH-NAME.  10150052
098800                                                                  10160052
098900     INITIALIZE DPG51 DPG52 DPG53                                 10170052
099000                DPG54 DPG55 DPG56.                                10180052
099100                                                                  10190052
099200     SET DPG51-INCREMENT-DATE       TO TRUE.                      10200052
099300     MOVE PC-STR-GRP-LST-FUT-DAYS   TO DPG51-INCR-DECR-DAYS-9.    10210052
099400     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    10220052
099500                                                                  10230052
099600     PERFORM 9800-CALL-DATE-ROUTINE.                              10240052
099700                                                                  10250052
099800     MOVE DPG55-DB2-ISO-DATE-FMT    TO PV-COMP-DTE-RNGE-END.      10260052
099900     DISPLAY 'PV-COMP-DTE-RNGE-END ---> '                         10270052
100000              PV-COMP-DTE-RNGE-END.                               10280052
100100                                                                  10290052
100200*1500-EXIT.                                                       10300052
100300 EJECT.                                                           10310052
100400*--------------------------------------------------------------*  10320052
101100* 2000-CREATE-NEW-FPLU-LIST.                                      10330052
100500*       - PERFORM THE ROUTINES WHICH ARE NEEDED TO CREATE THE     10340052
100600*         NEW FPLU  STORE LIST.  THIS LIST CONTAINS ALL STORES    10350052
100700*         THAT HAVE BEEN CONVERTED TO THE NEW FPLU  SYSTEM OR     10360052
100800*         STORES THAT ARE NOT OPEN YET BUT WILL HAVE THE NEW      10370052
100900*         SYSTEM WHEN THEY DO OPEN.                               10380052
101000*--------------------------------------------------------------*  10390052
101100 2000-CREATE-NEW-FPLU-LIST.                                       10400052
101200     MOVE '2000-CREATE-NEW-FPLU-LIST     ' TO PV-PARAGRAPH-NAME.  10410052
101300                                                                  10420052
101400     PERFORM 2100-OPEN-STORE-CURSOR.                              10430052
101500                                                                  10440052
101600     PERFORM 2200-FETCH-NEW-FPLU-STORES                           10450052
101700             UNTIL PS-END-OF-STORE-CSR.                           10460052
101800                                                                  10470052
101900     PERFORM 2300-CLOSE-STORE-CURSOR.                             10480052
102000                                                                  10490052
102100*2000-EXIT.                                                       10500052
102200 EJECT.                                                           10510052
102300*--------------------------------------------------------------*  10520052
102700* 2100-OPEN-STORE-CURSOR.                                         10530052
102400*       - OPEN THE NEW FPLU  STORES CURSOR.  THE OPEN WILL BE     10540052
102500*         ATTEMPTED PC-MAX-RETRIES TIMES.                         10550052
102600*--------------------------------------------------------------*  10560052
102700 2100-OPEN-STORE-CURSOR.                                          10570052
102800     MOVE '2100-OPEN-STORE-CURSOR' TO PV-PARAGRAPH-NAME.          10580052
102900                                                                  10590052
103000     PERFORM                                                      10600052
103100         WITH TEST AFTER                                          10610052
103200         VARYING PV-SQL-SUB                                       10620052
103300         FROM 1 BY 1                                              10630052
103400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 10640052
103500                   OR  SQLCODE = 0)                               10650052
103600                                                                  10660052
103700         EXEC SQL                                                 10670052
103800           OPEN NEW-FPLU-STORES                                   10680052
103900         END-EXEC                                                 10690052
104000                                                                  10700052
104100         EVALUATE TRUE                                            10710052
104200           WHEN SQLCODE = -904                                    10720052
104300           WHEN SQLCODE = -911                                    10730052
104400           WHEN SQLCODE = -913                                    10740052
104500             CONTINUE                                             10750052
104600                                                                  10760052
104700           WHEN SQLCODE = 0                                       10770052
104800             SET PS-NOT-END-OF-STORE-CSR TO TRUE                  10780052
104900                                                                  10790052
105000           WHEN SQLWARN0 NOT EQUAL SPACE                          10800052
105100           WHEN SQLCODE NOT EQUAL ZERO                            10810052
105200             MOVE 'ERROR ON OPEN OF STORE CURSOR'                 10820052
105300                                         TO PV-DB2-OPERATION      10830052
105400             PERFORM 9998-SQL-ABEND-ROUTINE                       10840052
105500                                                                  10850052
105600         END-EVALUATE                                             10860052
105700     END-PERFORM.                                                 10870052
105800                                                                  10880052
105900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         10890052
106000       MOVE 'OPEN RETRIES EXCEEDED'   TO  PV-DB2-OPERATION        10900052
106100       PERFORM 9998-SQL-ABEND-ROUTINE                             10910052
106200     END-IF.                                                      10920052
106300                                                                  10930052
106400*2100-EXIT.                                                       10940052
106500 EJECT.                                                           10950052
106600*--------------------------------------------------------------*  10960052
107800* 2200-FETCH-NEW-FPLU-STORES.                                     10970052
106700*       - FETCH THE NEW FPLU  STORES CURSOR.  STORES MUST BE      10980052
106800*         CURRENTLY OPEN OR OPENING WITHIN 'X' NUMBER OF          10990052
106900*         ADVANCE DAYS FROM THE CURRENT BATCH DATE.  THE 'X'      11000052
107000*         ADVANCE DAYS COMES FROM A CONTROL CARD.                 11010052
107100*                                                                 11020052
107200*         STORES ON THE NEW FPLU  SYSTEM OR THOSE THAT WILL BE    11030052
107300*         WHEN THEY OPEN SHOULD BE SELECTED. THIS IS INDICATED    11040052
107400*         BY THE POS_CAP_LVL_ID COLUMN HAVING A VALUE OF '5'      11050052
107500*         FOR STORES NOT OPEN YET OR A VALUE GREATER THAN '12'    11060052
107600*         INDICATING THEY ARE OPEN.                               11070052
107700*--------------------------------------------------------------*  11080052
107800 2200-FETCH-NEW-FPLU-STORES.                                      11090052
107900     MOVE '2200-FETCH-NEW-FPLU-STORES' TO PV-PARAGRAPH-NAME.      11100052
108000                                                                  11110052
108100     EXEC SQL                                                     11120052
108200          FETCH  NEW-FPLU-STORES                                  11130052
108300           INTO  :XST00001-LOC-NBR                                11140052
108400                ,:XST00001-LOC-TYP-CDE                            11150052
108500                ,:XST00001-OPN-DTE                                11160052
108600                ,:XST00001-CLO-DTE                                11170052
108700                ,:XST00025-POS-CAP-LVL-ID                         11180052
108800                                                                  11190052
108900     END-EXEC.                                                    11200052
109000                                                                  11210052
109100     EVALUATE TRUE                                                11220052
109200       WHEN SQLCODE = 0                                           11230052
109300         PERFORM 8000-FORMAT-NEW-FPLU-RECORD                      11240052
109400                                                                  11250052
109500       WHEN SQLCODE = +100                                        11260052
109600         SET PS-END-OF-STORE-CSR TO TRUE                          11270052
109700                                                                  11280052
109800       WHEN OTHER                                                 11290052
109900         MOVE 'ERROR ON FETCH OF NEW FPLU STORES CURSOR'          11300052
110000                            TO PV-DB2-OPERATION                   11310052
110100         PERFORM 9998-SQL-ABEND-ROUTINE                           11320052
110200                                                                  11330052
110300     END-EVALUATE.                                                11340052
110400                                                                  11350052
110500*2200-EXIT.                                                       11360052
110600 EJECT.                                                           11370052
110700*--------------------------------------------------------------*  11380052
111100* 2300-CLOSE-STORE-CURSOR.                                        11390052
110800*       - CLOSE THE NEW FPLU  STORES CURSOR.  THE CLOSE WILL BE   11400052
110900*         ATTEMPTED PC-MAX-RETRIES TIMES.                         11410052
111000*--------------------------------------------------------------*  11420052
111100 2300-CLOSE-STORE-CURSOR.                                         11430052
111200     MOVE '2300-CLOSE-STORE-CURSOR' TO PV-PARAGRAPH-NAME.         11440052
111300                                                                  11450052
111400     PERFORM                                                      11460052
111500         WITH TEST AFTER                                          11470052
111600         VARYING PV-SQL-SUB                                       11480052
111700         FROM 1 BY 1                                              11490052
111800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 11500052
111900                   OR  SQLCODE = 0)                               11510052
112000                                                                  11520052
112100         EXEC SQL                                                 11530052
112200           CLOSE NEW-FPLU-STORES                                  11540052
112300         END-EXEC                                                 11550052
112400                                                                  11560052
112500         EVALUATE TRUE                                            11570052
112600           WHEN SQLCODE = -904                                    11580052
112700           WHEN SQLCODE = -911                                    11590052
112800           WHEN SQLCODE = -913                                    11600052
112900             CONTINUE                                             11610052
113000                                                                  11620052
113100           WHEN SQLCODE = 0                                       11630052
113200             SET PS-NOT-END-OF-STORE-CSR TO TRUE                  11640052
113300                                                                  11650052
113400           WHEN SQLWARN0 NOT EQUAL SPACE                          11660052
113500           WHEN SQLCODE NOT EQUAL ZERO                            11670052
113600             MOVE 'ERROR ON CLOSE OF STORE CURSOR'                11680052
113700                                         TO PV-DB2-OPERATION      11690052
113800             PERFORM 9998-SQL-ABEND-ROUTINE                       11700052
113900         END-EVALUATE                                             11710052
114000     END-PERFORM.                                                 11720052
114100                                                                  11730052
114200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         11740052
114300       MOVE 'CLOSE RETRIES EXCEEDED'  TO  PV-DB2-OPERATION        11750052
114400       PERFORM 9998-SQL-ABEND-ROUTINE                             11760052
114500     END-IF.                                                      11770052
114600                                                                  11780052
114700*2300-EXIT.                                                       11790052
114800 EJECT.                                                           11800052
114900*--------------------------------------------------------------*  11810052
116500* 3000-SELECT-PROMO-DATES.                                        11820052
115000*       - PERFORM THE ROUTINES WHICH ARE NEEDED TO CREATE SOME    11830052
115100*         OF THE OUTPUT RECORDS IN THE STORE GROUP LIST.  THIS    11840052
115200*         LIST CONTAINS ALL OPEN STORES OR THOSE WHICH WILL BE    11850052
115300*         OPENING IN 'X' NUMBER OF ADVANCE DAYS FROM THE CURRENT  11860052
115400*         BATCH DATE.  THE 'X' NUMBER OF DAYS COMES FROM A        11870052
115500*         CONTROL CARD.                                           11880052
115600*                                                                 11890052
115700*         THE RECORDS SHOW WHICH STORE HIERARCHIES EACH STORE     11900052
115800*         BELONGED TO ON THE DATE BEING PROCESSED.  THE DATES     11910052
115900*         WHICH ARE PROCESSED HERE ARE ANY DATES WHERE THERE      11920052
116000*         IS STILL PROMOTIONS WHICH CAN BE/ARE ACTIVE(PROMO_      11930052
116100*         END_TMST >= BATCH DATE) AND WHERE THE PROMOTION START   11940052
116200*         DATE IS LESS THAN THE COMPLETE DATE RANGE WHICH WILL    11950052
116300*         BE PROCESSED(PROMO_STRT_TMST < PV-COMP-DTE-RNGE-STRT).  11960052
116400*--------------------------------------------------------------*  11970052
116500 3000-SELECT-PROMO-DATES.                                         11980052
116600     MOVE '3000-SELECT-PROMO-DATES       ' TO PV-PARAGRAPH-NAME.  11990052
116700                                                                  12000052
116800     PERFORM 3100-OPEN-UNIQUE-DATES.                              12010052
116900                                                                  12020052
117000     PERFORM 3200-FETCH-UNIQUE-DATES                              12030052
117100             UNTIL PS-END-OF-UNIQUE-DATE-CSR.                     12040052
117200                                                                  12050052
117300     PERFORM 3300-CLOSE-UNIQUE-DATES.                             12060052
117400                                                                  12070052
117500*3000-EXIT.                                                       12080052
117600 EJECT.                                                           12090052
117700*--------------------------------------------------------------*  12100052
118100* 3100-OPEN-UNIQUE-DATES.                                         12110052
117800*       - OPEN THE UNIQUE DATE CURSOR.  THE OPEN WILL BE TRIED    12120052
117900*         UP TO PC-MAX-RETRIES TIMES.                             12130052
118000*--------------------------------------------------------------*  12140052
118100 3100-OPEN-UNIQUE-DATES.                                          12150052
118200     MOVE '3100-OPEN-UNIQUE-DATES' TO PV-PARAGRAPH-NAME.          12160052
118300                                                                  12170052
118400     MOVE PV-COMP-DTE-RNGE-STRT    TO PV-STRT-RANGE-DATE.         12180052
118500     MOVE EP111-CC-CRNT-DTE        TO PV-EP111-DATE.              12190052
118600                                                                  12200052
118700     PERFORM                                                      12210052
118800         WITH TEST AFTER                                          12220052
118900         VARYING PV-SQL-SUB                                       12230052
119000         FROM 1 BY 1                                              12240052
119100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 12250052
119200                   OR  SQLCODE = 0)                               12260052
119300                                                                  12270052
119400         EXEC SQL                                                 12280052
119500           OPEN UNIQUE-DATE-CSR                                   12290052
119600         END-EXEC                                                 12300052
119700                                                                  12310052
119800         EVALUATE TRUE                                            12320052
119900           WHEN SQLCODE = -904                                    12330052
120000           WHEN SQLCODE = -911                                    12340052
120100           WHEN SQLCODE = -913                                    12350052
120200             CONTINUE                                             12360052
120300                                                                  12370052
120400           WHEN SQLCODE = 0                                       12380052
120500             SET PS-NOT-END-OF-UNIQUE-DATE-CSR TO TRUE            12390052
120600                                                                  12400052
120700           WHEN SQLWARN0 NOT EQUAL SPACE                          12410052
120800           WHEN SQLCODE NOT EQUAL ZERO                            12420052
120900             MOVE 'ERROR ON OPEN OF STORE CURSOR'                 12430052
121000                                TO PV-DB2-OPERATION               12440052
121100             PERFORM 9998-SQL-ABEND-ROUTINE                       12450052
121200                                                                  12460052
121300         END-EVALUATE                                             12470052
121400     END-PERFORM.                                                 12480052
121500                                                                  12490052
121600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         12500052
121700       MOVE 'OPEN RETRIES EXCEEDED'   TO  PV-DB2-OPERATION        12510052
121800       PERFORM 9998-SQL-ABEND-ROUTINE                             12520052
121900     END-IF.                                                      12530052
122000                                                                  12540052
122100*3100-EXIT.                                                       12550052
122200 EJECT.                                                           12560052
122300*--------------------------------------------------------------*  12570052
122900* 3200-FETCH-UNIQUE-DATES.                                        12580052
122400*       - FETCH THE UNIQUE DATE CURSOR.  THE DATES MUST BE FOR    12590052
122500*         PROMOTIONS WHICH CAN/ARE STILL GOING ON AND WHICH       12600052
122600*         STARTED EARLIER THAN THE START DATE OF THE COMPLETE     12610052
122700*         DATE RANGE SET.                                         12620052
122800*--------------------------------------------------------------*  12630052
122900 3200-FETCH-UNIQUE-DATES.                                         12640052
123000     MOVE '3200-FETCH-UNIQUE-DATES' TO PV-PARAGRAPH-NAME.         12650052
123100                                                                  12660052
123200     SET PS-FIRST-ADHOC-GRP-FETCH TO TRUE.                        12670052
123300                                                                  12680052
123400     EXEC SQL                                                     12690052
123500          FETCH  UNIQUE-DATE-CSR                                  12700052
123600           INTO  :PV-UNIQUE-DATE                                  12710052
123700                                                                  12720052
123800     END-EXEC.                                                    12730052
123900                                                                  12740052
124000     EVALUATE TRUE                                                12750052
124100       WHEN SQLCODE = 0                                           12760052
124200         ADD  1  TO  PV-UNIQUE-DATE-FETCHES                       12770052
124300         DISPLAY ' '                                              12780052
124400         STRING PV-UNIQUE-DATE (1:4)                              12790052
124500                PV-UNIQUE-DATE (6:2)                              12800052
124600                PV-UNIQUE-DATE (9:2)                              12810052
124700                DELIMITED BY SIZE                                 12820052
124800                INTO PV-WORK-DATE-CCYYMMDD                        12830052
124900         MOVE PV-UNIQUE-DATE  TO PV-WORK-DATE-CCYY-MM-DD          12840052
125000                                                                  12850052
125100         DISPLAY 'WORK DATES ---> ' PV-WORK-DATE-CCYYMMDD         12860052
125200                            ' - '   PV-WORK-DATE-CCYY-MM-DD       12870052
125300                                                                  12880052
125400         PERFORM 8200-FORMAT-FILE-NAME-OUTPUT                     12890052
125500         PERFORM 5000-CREATE-STORE-GROUP-LIST                     12900052
125600                                                                  12910052
125700         MOVE PV-WORK-DATE-CCYY-MM-DD TO PV-STRT-RANGE-DATE       12920052
125800                                         PV-END-RANGE-DATE        12930052
125900         PERFORM 6000-CREATE-ADHOC-STORE-GROUP                    12940052
126000                                                                  12950052
126100       WHEN SQLCODE = +100                                        12960052
126200         SET PS-END-OF-UNIQUE-DATE-CSR TO TRUE                    12970052
126300                                                                  12980052
126400       WHEN OTHER                                                 12990052
126500         MOVE 'ERROR ON FETCH OF UNIQUE-DATES-CSR    '            13000052
126600                            TO PV-DB2-OPERATION                   13010052
126700         PERFORM 9998-SQL-ABEND-ROUTINE                           13020052
126800                                                                  13030052
126900     END-EVALUATE.                                                13040052
127000                                                                  13050052
127100*3200-EXIT.                                                       13060052
127200 EJECT.                                                           13070052
127300*--------------------------------------------------------------*  13080052
127700* 3300-CLOSE-UNIQUE-DATES.                                        13090052
127400*       - CLOSE THE UNIQUE DATE CURSOR.  THE CLOSE WILL BE        13100052
127500*         ATTEMPTED UP TO PC-MAX-RETRIES TIMES.                   13110052
127600*--------------------------------------------------------------*  13120052
127700 3300-CLOSE-UNIQUE-DATES.                                         13130052
127800     MOVE '3300-CLOSE-UNIQUE-DATES' TO PV-PARAGRAPH-NAME.         13140052
127900                                                                  13150052
128000     PERFORM                                                      13160052
128100         WITH TEST AFTER                                          13170052
128200         VARYING PV-SQL-SUB                                       13180052
128300         FROM 1 BY 1                                              13190052
128400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 13200052
128500                   OR  SQLCODE = 0)                               13210052
128600                                                                  13220052
128700         EXEC SQL                                                 13230052
128800           CLOSE UNIQUE-DATE-CSR                                  13240052
128900         END-EXEC                                                 13250052
129000                                                                  13260052
129100         EVALUATE TRUE                                            13270052
129200           WHEN SQLCODE = -904                                    13280052
129300           WHEN SQLCODE = -911                                    13290052
129400           WHEN SQLCODE = -913                                    13300052
129500           WHEN SQLCODE = 0                                       13310052
129600             CONTINUE                                             13320052
129700                                                                  13330052
129800           WHEN SQLWARN0 NOT EQUAL SPACE                          13340052
129900           WHEN SQLCODE NOT EQUAL ZERO                            13350052
130000             MOVE 'ERROR ON CLOSE OF STORE CURSOR'                13360052
130100                                TO PV-DB2-OPERATION               13370052
130200             PERFORM 9998-SQL-ABEND-ROUTINE                       13380052
130300         END-EVALUATE                                             13390052
130400     END-PERFORM.                                                 13400052
130500                                                                  13410052
130600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13420052
130700       MOVE 'CLOSE RETRIES EXCEEDED'                              13430052
130800                             TO  PV-DB2-OPERATION                 13440052
130900       PERFORM 9998-SQL-ABEND-ROUTINE                             13450052
131000     END-IF.                                                      13460052
131100                                                                  13470052
131200*3300-EXIT.                                                       13480052
131300 EJECT.                                                           13490052
131400*--------------------------------------------------------------*  13500052
132900* 4000-PROCESS-DIST-DATE-RANGE.                                   13510052
131500*       - PERFORM THE ROUTINES WHICH ARE NEEDED TO CREATE SOME    13520052
131600*         OF THE OUTPUT RECORDS IN THE STORE GROUP LIST.  THIS    13530052
131700*         LIST CONTAINS ALL OPEN STORES OR THOSE WHICH WILL BE    13540052
131800*         OPENING IN 'X' NUMBER OF ADVANCE DAYS FROM THE CURRENT  13550052
131900*         BATCH DATE.  THE 'X' NUMBER OF DAYS COMES FROM A        13560052
132000*         CONTROL CARD.                                           13570052
132100*                                                                 13580052
132200*         THE RECORDS SHOW WHICH STORE HIERARCHIES EACH STORE     13590052
132300*         BELONGED TO ON THE DATE BEING PROCESSED.  THE DATES     13600052
132400*         WHICH ARE PROCESSED HERE ARE A RANGE OF DATES.  THE     13610052
132500*         STARTING DATE OF THE RANGE COMES FROM THE BATCH DATE    13620052
132600*         - PC-STR-GRP-LST-PAST DAYS, AND THE END OF THE RANGE    13630052
132700*         COMES FROM THE BATCH DATE + PC-STR-GRP-LST-FUT-DAYS.    13640052
132800*--------------------------------------------------------------*  13650052
132900 4000-PROCESS-DIST-DATE-RANGE.                                    13660052
133000     MOVE '4000-PROCESS-DIST-DATE-RANGE  ' TO PV-PARAGRAPH-NAME.  13670052
133100                                                                  13680052
133200     MOVE PV-COMP-DTE-RNGE-STRT TO PV-COMP-DTE-RNGE-NEXT-DAY.     13690052
133300     MOVE PV-COMP-DTE-RNGE-STRT TO PV-STRT-RANGE-DATE.            13700052
133400     MOVE PV-COMP-DTE-RNGE-END  TO PV-END-RANGE-DATE.             13710052
133500                                                                  13720052
133600     PERFORM UNTIL PV-COMP-DTE-RNGE-NEXT-DAY                      13730052
133700       > PV-COMP-DTE-RNGE-END                                     13740052
133800                                                                  13750052
133900           ADD 1 TO PV-DAYS-IN-COMP-RANGE                         13760052
134000           DISPLAY ' '                                            13770052
134100           STRING PV-COMP-DTE-RNGE-NEXT-DAY (1:4)                 13780052
134200                  PV-COMP-DTE-RNGE-NEXT-DAY (6:2)                 13790052
134300                  PV-COMP-DTE-RNGE-NEXT-DAY (9:2)                 13800052
134400                  DELIMITED BY SIZE                               13810052
134500                  INTO PV-WORK-DATE-CCYYMMDD                      13820052
134600           MOVE PV-COMP-DTE-RNGE-NEXT-DAY                         13830052
134700            TO PV-WORK-DATE-CCYY-MM-DD                            13840052
134800                                                                  13850052
134900           DISPLAY 'WORK DATES ---> ' PV-WORK-DATE-CCYYMMDD       13860052
135000                              ' - '   PV-WORK-DATE-CCYY-MM-DD     13870052
135100                                                                  13880052
135200           PERFORM 8200-FORMAT-FILE-NAME-OUTPUT                   13890052
135300           PERFORM 5000-CREATE-STORE-GROUP-LIST                   13900052
135400           PERFORM 6000-CREATE-ADHOC-STORE-GROUP                  13910052
135500                                                                  13920052
135600           IF PV-WORK-DATE-CCYY-MM-DD = PV-BATCH-DATE             13930052
135700             DISPLAY ' '                                          13940052
135800             DISPLAY '******************************'             13950052
135900             DISPLAY '   MATCHES BATCH DATE         '             13960052
136000             DISPLAY '   EXECUTE REFRESH CURSOR     '             13970052
136100             DISPLAY '******************************'             13980052
136200             DISPLAY ' '                                          13990052
136300             PERFORM 7000-CREATE-REFRESH-STORE-LIST               14000052
136400           END-IF                                                 14010052
136500                                                                  14020052
136600           PERFORM 9400-CALC-NEXT-DTE-RANGE-DAY                   14030052
136700                                                                  14040052
136800     END-PERFORM.                                                 14050052
136900                                                                  14060052
137000*4000-EXIT.                                                       14070052
137100 EJECT.                                                           14080052
137200*--------------------------------------------------------------*  14090052
137600* 5000-CREATE-STORE-GROUP-LIST.                                   14100052
137300*       - PERFORM THE NECESSARY ROUTINES TO RETRIEVE THE STORES   14110052
137400*         AND THE ASSOCIATED HIERARCHY RELATIONSHIPS.             14120052
137500*--------------------------------------------------------------*  14130052
137600 5000-CREATE-STORE-GROUP-LIST.                                    14140052
137700     MOVE '5000-CREATE-STORE-GROUP-LIST  ' TO PV-PARAGRAPH-NAME.  14150052
137800                                                                  14160052
137900     PERFORM 5100-OPEN-STORE-GRP-CURSOR.                          14170052
138000                                                                  14180052
138100     PERFORM 5200-FETCH-STORE-GROUP-LIST                          14190052
138200             UNTIL PS-END-OF-STORE-GRP-CSR.                       14200052
138300                                                                  14210052
138400     PERFORM 5300-CLOSE-STORE-GRP-CURSOR.                         14220052
138500                                                                  14230052
138600*5000-EXIT.                                                       14240052
138700 EJECT.                                                           14250052
138800*--------------------------------------------------------------*  14260052
139200* 5100-OPEN-STORE-GRP-CURSOR.                                     14270052
138900*       - OPEN THE STORE GROUP LIST CURSOR.  THE OPEN WILL BE     14280052
139000*         ATTEMPTED UP TO PC-MAX-RETRIES TIMES.                   14290052
139100*--------------------------------------------------------------*  14300052
139200 5100-OPEN-STORE-GRP-CURSOR.                                      14310052
139300     MOVE '5100-OPEN-STORE-GRP-CURSOR' TO PV-PARAGRAPH-NAME.      14320052
139400                                                                  14330052
139500     PERFORM                                                      14340052
139600         WITH TEST AFTER                                          14350052
139700         VARYING PV-SQL-SUB                                       14360052
139800         FROM 1 BY 1                                              14370052
139900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14380052
140000                   OR  SQLCODE = 0)                               14390052
140100                                                                  14400052
140200         EXEC SQL                                                 14410052
140300           OPEN STORE-GROUP-LIST                                  14420052
140400         END-EXEC                                                 14430052
140500                                                                  14440052
140600         EVALUATE TRUE                                            14450052
140700           WHEN SQLCODE = -904                                    14460052
140800           WHEN SQLCODE = -911                                    14470052
140900           WHEN SQLCODE = -913                                    14480052
141000             CONTINUE                                             14490052
141100                                                                  14500052
141200           WHEN SQLCODE = 0                                       14510052
141300             SET PS-NOT-END-OF-STORE-GRP-CSR TO TRUE              14520052
141400                                                                  14530052
141500           WHEN SQLWARN0 NOT EQUAL SPACE                          14540052
141600           WHEN SQLCODE NOT EQUAL ZERO                            14550052
141700             MOVE 'ERROR ON OPEN OF STORE CURSOR'                 14560052
141800                                TO PV-DB2-OPERATION               14570052
141900             PERFORM 9998-SQL-ABEND-ROUTINE                       14580052
142000                                                                  14590052
142100         END-EVALUATE                                             14600052
142200     END-PERFORM.                                                 14610052
142300                                                                  14620052
142400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         14630052
142500       MOVE 'OPEN RETRIES EXCEEDED'   TO  PV-DB2-OPERATION        14640052
142600       PERFORM 9998-SQL-ABEND-ROUTINE                             14650052
142700     END-IF.                                                      14660052
142800                                                                  14670052
142900*5100-EXIT.                                                       14680052
143000 EJECT.                                                           14690052
143100*--------------------------------------------------------------*  14700052
144300* 5200-FETCH-STORE-GROUP-LIST.                                    14710052
143200*       - FETCH THE STORE GROUP LIST RECORDS.  STORES MUST BE     14720052
143300*         CURRENTLY OPEN OR OPENING WITHIN 'X' NUMBER OF          14730052
143400*         ADVANCE DAYS FROM THE CURRENT BATCH DATE.  THE 'X'      14740052
143500*         ADVANCE DAYS COMES FROM A CONTROL CARD.                 14750052
143600*                                                                 14760052
143700*         STORES ON THE NEW PROMO SYSTEM OR THOSE THAT WILL BE    14770052
143800*         WHEN THEY OPEN SHOULD BE SELECTED. THIS IS INDICATED    14780052
143900*         BY THE POS_CAP_LVL_ID COLUMN HAVING A VALUE OF '5'      14790052
144000*         FOR STORES NOT OPEN YET OR A VALUE GREATER THAN '11'    14800052
144100*         INDICATING THEY ARE OPEN.                               14810052
144200*--------------------------------------------------------------*  14820052
144300 5200-FETCH-STORE-GROUP-LIST.                                     14830052
144400     MOVE '5200-FETCH-STORE-GROUP-LIST' TO PV-PARAGRAPH-NAME.     14840052
144500                                                                  14850052
144600     EXEC SQL                                                     14860052
144700          FETCH  STORE-GROUP-LIST                                 14870052
144800           INTO  :XST00029-STR-GP-TYP-CDE                         14880052
144900                ,:XST00029-STR-GP-ID                              14890052
145000                                                                  14900052
145100                ,:XST00023-STR-NBR                                14910052
145200                                                                  14920052
145300                ,:XST00025-POS-CAP-LVL-ID                         14930052
145400     END-EXEC.                                                    14940052
145500                                                                  14950052
145600     EVALUATE TRUE                                                14960052
145700       WHEN SQLCODE = 0                                           14970052
145800         ADD  1  TO  PV-STORE-GROUP-FETCHES                       14980052
145900         MOVE XST00029-STR-GP-TYP-CDE TO PV-STORE-GROUP-TYPE      14990052
146000         MOVE XST00029-STR-GP-ID      TO PV-STORE-GROUP-ID        15000052
146100         MOVE XST00023-STR-NBR        TO PV-STORE-NUMBER          15010052
146200                                                                  15020052
146300         PERFORM 8100-FORMAT-STORE-PROMO                          15030052
146400                                                                  15040052
146500       WHEN SQLCODE = +100                                        15050052
146600         SET PS-END-OF-STORE-GRP-CSR TO TRUE                      15060052
146700                                                                  15070052
146800       WHEN OTHER                                                 15080052
146900         MOVE 'ERROR ON FETCH OF NEW PROMO STORES CURSOR'         15090052
147000                            TO PV-DB2-OPERATION                   15100052
147100         PERFORM 9998-SQL-ABEND-ROUTINE                           15110052
147200                                                                  15120052
147300     END-EVALUATE.                                                15130052
147400                                                                  15140052
147500*5200-EXIT.                                                       15150052
147600 EJECT.                                                           15160052
147700*--------------------------------------------------------------*  15170052
148100* 5300-CLOSE-STORE-GRP-CURSOR.                                    15180052
147800*       - CLOSE THE STORE GROUP LIST CURSOR.  THE CLOSE WILL BE   15190052
147900*         ATTEMPTED UP TO PC-MAX-RETRIES TIMES.                   15200052
148000*--------------------------------------------------------------*  15210052
148100 5300-CLOSE-STORE-GRP-CURSOR.                                     15220052
148200     MOVE '5300-CLOSE-STORE-GRP-CURSOR' TO PV-PARAGRAPH-NAME.     15230052
148300                                                                  15240052
148400     PERFORM                                                      15250052
148500         WITH TEST AFTER                                          15260052
148600         VARYING PV-SQL-SUB                                       15270052
148700         FROM 1 BY 1                                              15280052
148800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 15290052
148900                   OR  SQLCODE = 0)                               15300052
149000                                                                  15310052
149100         EXEC SQL                                                 15320052
149200           CLOSE STORE-GROUP-LIST                                 15330052
149300         END-EXEC                                                 15340052
149400                                                                  15350052
149500         EVALUATE TRUE                                            15360052
149600           WHEN SQLCODE = -904                                    15370052
149700           WHEN SQLCODE = -911                                    15380052
149800           WHEN SQLCODE = -913                                    15390052
149900           WHEN SQLCODE = 0                                       15400052
150000             CONTINUE                                             15410052
150100                                                                  15420052
150200           WHEN SQLWARN0 NOT EQUAL SPACE                          15430052
150300           WHEN SQLCODE NOT EQUAL ZERO                            15440052
150400             MOVE 'ERROR ON CLOSE OF STORE CURSOR'                15450052
150500                                TO PV-DB2-OPERATION               15460052
150600             PERFORM 9998-SQL-ABEND-ROUTINE                       15470052
150700         END-EVALUATE                                             15480052
150800     END-PERFORM.                                                 15490052
150900                                                                  15500052
151000     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15510052
151100       MOVE 'CLOSE RETRIES EXCEEDED'  TO  PV-DB2-OPERATION        15520052
151200       PERFORM 9998-SQL-ABEND-ROUTINE                             15530052
151300     END-IF.                                                      15540052
151400                                                                  15550052
151500*5300-EXIT.                                                       15560052
151600 EJECT.                                                           15570052
151700*--------------------------------------------------------------*  15580052
152100* 6000-CREATE-ADHOC-STORE-GROUP.                                  15590052
151800*       - PERFORM THE NECESSARY ROUTINES TO RETRIEVE THE STORES   15600052
151900*         AND THE ADHOC STORE GROUP RELATIONSHIPS.                15610052
152000*--------------------------------------------------------------*  15620052
152100 6000-CREATE-ADHOC-STORE-GROUP.                                   15630052
152200     MOVE '6000-CREATE-ADHOC-STORE-GROUP' TO PV-PARAGRAPH-NAME.   15640052
152300                                                                  15650052
152400     IF PS-FIRST-ADHOC-GRP-FETCH                                  15660052
152500       PERFORM 6100-OPEN-ADHOC-STORE-GROUP                        15670052
152600       PERFORM 6200-FETCH-ADHOC-STORE-GROUP                       15680052
152700     END-IF.                                                      15690052
152800                                                                  15700052
152900     PERFORM UNTIL PS-END-OF-ADHOC-STORE-GRP                      15710052
153000       OR PV-ADHOC-STR-GRP-DATE > PV-WORK-DATE-CCYY-MM-DD         15720052
153100                                                                  15730052
153200         IF PV-ADHOC-STR-GRP-DATE = PV-WORK-DATE-CCYY-MM-DD       15740052
153300           PERFORM 6400-OPEN-ADHOC-STORE-LIST                     15750052
153400                                                                  15760052
153500           SET PS-NOT-END-OF-ADHOC-STORE-LIST TO TRUE             15770052
153600           PERFORM 6500-FETCH-ADHOC-STORE-LIST                    15780052
153700             UNTIL PS-END-OF-ADHOC-STORE-LIST                     15790052
153800                                                                  15800052
153900           PERFORM 6600-CLOSE-ADHOC-STORE-LIST                    15810052
154000                                                                  15820052
154100           PERFORM 6200-FETCH-ADHOC-STORE-GROUP                   15830052
154200         END-IF                                                   15840052
154300                                                                  15850052
154400     END-PERFORM.                                                 15860052
154500                                                                  15870052
154600     IF PS-END-OF-ADHOC-STORE-GRP                                 15880052
154700      AND PS-ADHOC-STORE-GROUP-CSR-OPEN                           15890052
154800        PERFORM 6300-CLOSE-ADHOC-STORE-GROUP                      15900052
154900     END-IF.                                                      15910052
155000                                                                  15920052
155100*6000-EXIT.                                                       15930052
155200 EJECT.                                                           15940052
155300*--------------------------------------------------------------*  15950052
155700* 6100-OPEN-ADHOC-STORE-GROUP.                                    15960052
155400*       - OPEN THE ADHOC STORE GROUP. THE OPEN WILL BE            15970052
155500*         ATTEMPTED UP TO PC-MAX-RETRIES TIMES.                   15980052
155600*--------------------------------------------------------------*  15990052
155700 6100-OPEN-ADHOC-STORE-GROUP.                                     16000052
155800     MOVE '6100-OPEN-ADHOC-STORE-GROUP' TO PV-PARAGRAPH-NAME.     16010052
155900                                                                  16020052
156000     PERFORM                                                      16030052
156100         WITH TEST AFTER                                          16040052
156200         VARYING PV-SQL-SUB                                       16050052
156300         FROM 1 BY 1                                              16060052
156400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 16070052
156500                   OR  SQLCODE = 0)                               16080052
156600                                                                  16090052
156700         EXEC SQL                                                 16100052
156800           OPEN ADHOC-STORE-GROUP                                 16110052
156900         END-EXEC                                                 16120052
157000                                                                  16130052
157100         EVALUATE TRUE                                            16140052
157200           WHEN SQLCODE = -904                                    16150052
157300           WHEN SQLCODE = -911                                    16160052
157400           WHEN SQLCODE = -913                                    16170052
157500             CONTINUE                                             16180052
157600                                                                  16190052
157700           WHEN SQLCODE = 0                                       16200052
157800             SET PS-NOT-FIRST-ADHOC-GRP-FETCH                     16210052
157900                 PS-NOT-END-OF-ADHOC-STORE-GRP                    16220052
158000                 PS-ADHOC-STORE-GROUP-CSR-OPEN TO TRUE            16230052
158100                                                                  16240052
158200           WHEN SQLWARN0 NOT EQUAL SPACE                          16250052
158300           WHEN SQLCODE NOT EQUAL ZERO                            16260052
158400             MOVE 'ERROR ON OPEN OF STORE GROUP'                  16270052
158500                                TO PV-DB2-OPERATION               16280052
158600             PERFORM 9998-SQL-ABEND-ROUTINE                       16290052
158700                                                                  16300052
158800         END-EVALUATE                                             16310052
158900     END-PERFORM.                                                 16320052
159000                                                                  16330052
159100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         16340052
159200       MOVE 'OPEN STORE GROUP RETRY EXCEEDED' TO PV-DB2-OPERATION 16350052
159300       PERFORM 9998-SQL-ABEND-ROUTINE                             16360052
159400     END-IF.                                                      16370052
159500                                                                  16380052
159600*6100-EXIT.                                                       16390052
159700 EJECT.                                                           16400052
159800*--------------------------------------------------------------*  16410052
160400* 6200-FETCH-ADHOC-STORE-GROUP.                                   16420052
159900*       - FETCH THE ADHOC STORE GROUPS FROM THE CURRENT BATCH     16430052
160000*         DATE.                                                   16440052
160100*       - PERFORM THE NECESSARY ROUTINES TO RETRIEVE THE STORES   16450052
160200*         FROM THE ADHOC STORE GROUPS.                            16460052
160300*--------------------------------------------------------------*  16470052
160400 6200-FETCH-ADHOC-STORE-GROUP.                                    16480052
160500     MOVE '6200-FETCH-ADHOC-STORE-GROUP' TO PV-PARAGRAPH-NAME.    16490052
160600                                                                  16500052
160700     EXEC SQL                                                     16510052
160800          FETCH  ADHOC-STORE-GROUP                                16520052
160900           INTO  :PV-ADHOC-STR-GRP-DATE                           16530052
161000                ,:XST00031-ADHC-STR-GP-ID                         16540052
161100     END-EXEC.                                                    16550052
161200                                                                  16560052
161300     EVALUATE TRUE                                                16570052
161400       WHEN SQLCODE = 0                                           16580052
161500         CONTINUE                                                 16590052
161600                                                                  16600052
161700       WHEN SQLCODE = +100                                        16610052
161800         SET PS-END-OF-ADHOC-STORE-GRP   TO TRUE                  16620052
161900                                                                  16630052
162000       WHEN OTHER                                                 16640052
162100         MOVE 'ERROR ON FETCH OF NEW PROMO STORE GROUP'           16650052
162200                            TO PV-DB2-OPERATION                   16660052
162300         PERFORM 9998-SQL-ABEND-ROUTINE                           16670052
162400                                                                  16680052
162500     END-EVALUATE.                                                16690052
162600                                                                  16700052
162700*6200-EXIT.                                                       16710052
162800 EJECT.                                                           16720052
162900*--------------------------------------------------------------*  16730052
163300* 6300-CLOSE-ADHOC-STORE-GROUP.                                   16740052
163000*       - CLOSE THE ADHOC STORE GROUP CURSOR. THE CLOSE WILL BE   16750052
163100*         ATTEMPTED UP TO PC-MAX-RETRIES TIMES.                   16760052
163200*--------------------------------------------------------------*  16770052
163300 6300-CLOSE-ADHOC-STORE-GROUP.                                    16780052
163400     MOVE '6300-CLOSE-ADHOC-STORE-GROUP' TO PV-PARAGRAPH-NAME.    16790052
163500                                                                  16800052
163600     PERFORM                                                      16810052
163700         WITH TEST AFTER                                          16820052
163800         VARYING PV-SQL-SUB                                       16830052
163900         FROM 1 BY 1                                              16840052
164000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 16850052
164100                   OR  SQLCODE = 0)                               16860052
164200                                                                  16870052
164300         EXEC SQL                                                 16880052
164400           CLOSE ADHOC-STORE-GROUP                                16890052
164500         END-EXEC                                                 16900052
164600                                                                  16910052
164700         EVALUATE TRUE                                            16920052
164800           WHEN SQLCODE = -904                                    16930052
164900           WHEN SQLCODE = -911                                    16940052
165000           WHEN SQLCODE = -913                                    16950052
165100             CONTINUE                                             16960052
165200                                                                  16970052
165300           WHEN SQLCODE = 0                                       16980052
165400             SET PS-ADHOC-STORE-GROUP-CSR-CLOSE TO TRUE           16990052
165500                                                                  17000052
165600           WHEN SQLWARN0 NOT EQUAL SPACE                          17010052
165700           WHEN SQLCODE NOT EQUAL ZERO                            17020052
165800             MOVE 'ERROR ON CLOSE OF STORE GROUP'                 17030052
165900                                TO PV-DB2-OPERATION               17040052
166000             PERFORM 9998-SQL-ABEND-ROUTINE                       17050052
166100         END-EVALUATE                                             17060052
166200     END-PERFORM.                                                 17070052
166300                                                                  17080052
166400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         17090052
166500       MOVE 'CLOSE RETRIES EXCEEDED'  TO  PV-DB2-OPERATION        17100052
166600       PERFORM 9998-SQL-ABEND-ROUTINE                             17110052
166700     END-IF.                                                      17120052
166800                                                                  17130052
166900*6300-EXIT.                                                       17140052
167000 EJECT.                                                           17150052
167100*--------------------------------------------------------------*  17160052
167500* 6400-OPEN-ADHOC-STORE-LIST.                                     17170052
167200*       - OPEN THE ADHOC STORE LIST CURSOR.  THE OPEN WILL BE     17180052
167300*         ATTEMPTED UP TO PC-MAX-RETRIES TIMES.                   17190052
167400*--------------------------------------------------------------*  17200052
167500 6400-OPEN-ADHOC-STORE-LIST.                                      17210052
167600     MOVE '6400-OPEN-ADHOC-STORE-LIST' TO PV-PARAGRAPH-NAME.      17220052
167700                                                                  17230052
167800     PERFORM                                                      17240052
167900         WITH TEST AFTER                                          17250052
168000         VARYING PV-SQL-SUB                                       17260052
168100         FROM 1 BY 1                                              17270052
168200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 17280052
168300                   OR  SQLCODE = 0)                               17290052
168400                                                                  17300052
168500         EXEC SQL                                                 17310052
168600           OPEN ADHOC-STORE-LIST                                  17320052
168700         END-EXEC                                                 17330052
168800                                                                  17340052
168900         EVALUATE TRUE                                            17350052
169000           WHEN SQLCODE = -904                                    17360052
169100           WHEN SQLCODE = -911                                    17370052
169200           WHEN SQLCODE = -913                                    17380052
169300             CONTINUE                                             17390052
169400                                                                  17400052
169500           WHEN SQLCODE = 0                                       17410052
169600             SET PS-NOT-END-OF-ADHOC-STORE-LIST TO TRUE           17420052
169700                                                                  17430052
169800           WHEN SQLWARN0 NOT EQUAL SPACE                          17440052
169900           WHEN SQLCODE NOT EQUAL ZERO                            17450052
170000             MOVE 'ERROR ON OPEN OF STORE LIST'                   17460052
170100                                TO PV-DB2-OPERATION               17470052
170200             PERFORM 9998-SQL-ABEND-ROUTINE                       17480052
170300                                                                  17490052
170400         END-EVALUATE                                             17500052
170500     END-PERFORM.                                                 17510052
170600                                                                  17520052
170700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         17530052
170800       MOVE 'OPEN STORE LIST RETRY EXCEEDED' TO PV-DB2-OPERATION  17540052
170900       PERFORM 9998-SQL-ABEND-ROUTINE                             17550052
171000     END-IF.                                                      17560052
171100                                                                  17570052
171200*6400-EXIT.                                                       17580052
171300 EJECT.                                                           17590052
171400*--------------------------------------------------------------*  17600052
172600* 6500-FETCH-ADHOC-STORE-LIST.                                    17610052
171500*       - FETCH THE ADHOC STORE LIST RECORDS.  STORES MUST BE     17620052
171600*         CURRENTLY OPEN OR OPENING WITHIN 'X' NUMBER OF          17630052
171700*         ADVANCE DAYS FROM THE CURRENT BATCH DATE.  THE 'X'      17640052
171800*         ADVANCE DAYS COMES FROM A CONTROL CARD.                 17650052
171900*                                                                 17660052
172000*         STORES ON THE NEW PROMO SYSTEM OR THOSE THAT WILL BE    17670052
172100*         WHEN THEY OPEN SHOULD BE SELECTED. THIS IS INDICATED    17680052
172200*         BY THE POS_CAP_LVL_ID COLUMN HAVING A VALUE OF '5'      17690052
172300*         FOR STORES NOT OPEN YET OR A VALUE GREATER THAN '11'    17700052
172400*         INDICATING THEY ARE OPEN.                               17710052
172500*--------------------------------------------------------------*  17720052
172600 6500-FETCH-ADHOC-STORE-LIST.                                     17730052
172700     MOVE '6500-FETCH-ADHOC-STORE-LIST' TO PV-PARAGRAPH-NAME.     17740052
172800                                                                  17750052
172900     EXEC SQL                                                     17760052
173000          FETCH  ADHOC-STORE-LIST                                 17770052
173100           INTO  :XST00033-ADHC-STR-GP-ID                         17780052
173200                ,:XST00033-STR-NBR                                17790052
173300                                                                  17800052
173400                ,:XST00025-POS-CAP-LVL-ID                         17810052
173500     END-EXEC.                                                    17820052
173600                                                                  17830052
173700     EVALUATE TRUE                                                17840052
173800       WHEN SQLCODE = 0                                           17850052
173900         ADD  1  TO  PV-ADHOC-FETCHES                             17860052
174000         MOVE ALL '9'                 TO PV-STORE-GROUP-TYPE      17870052
174100         MOVE XST00033-ADHC-STR-GP-ID TO PV-STORE-GROUP-ID        17880052
174200         MOVE XST00033-STR-NBR        TO PV-STORE-NUMBER          17890052
174300                                                                  17900052
174400         PERFORM 8100-FORMAT-STORE-PROMO                          17910052
174500                                                                  17920052
174600       WHEN SQLCODE = +100                                        17930052
174700         SET PS-END-OF-ADHOC-STORE-LIST TO TRUE                   17940052
174800                                                                  17950052
174900       WHEN OTHER                                                 17960052
175000         MOVE 'ERROR ON FETCH OF NEW PROMO STORE LIST'            17970052
175100                            TO PV-DB2-OPERATION                   17980052
175200         PERFORM 9998-SQL-ABEND-ROUTINE                           17990052
175300                                                                  18000052
175400     END-EVALUATE.                                                18010052
175500                                                                  18020052
175600*6500-EXIT.                                                       18030052
175700 EJECT.                                                           18040052
175800*--------------------------------------------------------------*  18050052
176200* 6600-CLOSE-ADHOC-STORE-LIST.                                    18060052
175900*       - CLOSE THE ADHOC STORE LIST CURSOR.  THE CLOSE WILL BE   18070052
176000*         ATTEMPTED UP TO PC-MAX-RETRIES TIMES.                   18080052
176100*--------------------------------------------------------------*  18090052
176200 6600-CLOSE-ADHOC-STORE-LIST.                                     18100052
176300     MOVE '6600-CLOSE-ADHOC-STORE-LIST' TO PV-PARAGRAPH-NAME.     18110052
176400                                                                  18120052
176500     PERFORM                                                      18130052
176600         WITH TEST AFTER                                          18140052
176700         VARYING PV-SQL-SUB                                       18150052
176800         FROM 1 BY 1                                              18160052
176900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 18170052
177000                   OR  SQLCODE = 0)                               18180052
177100                                                                  18190052
177200         EXEC SQL                                                 18200052
177300           CLOSE ADHOC-STORE-LIST                                 18210052
177400         END-EXEC                                                 18220052
177500                                                                  18230052
177600         EVALUATE TRUE                                            18240052
177700           WHEN SQLCODE = -904                                    18250052
177800           WHEN SQLCODE = -911                                    18260052
177900           WHEN SQLCODE = -913                                    18270052
178000             CONTINUE                                             18280052
178100                                                                  18290052
178200           WHEN SQLCODE = 0                                       18300052
178300             SET PS-NOT-END-OF-ADHOC-STORE-LIST TO TRUE           18310052
178400                                                                  18320052
178500           WHEN SQLWARN0 NOT EQUAL SPACE                          18330052
178600           WHEN SQLCODE NOT EQUAL ZERO                            18340052
178700             MOVE 'ERROR ON CLOSE OF STORE LIST'                  18350052
178800                                TO PV-DB2-OPERATION               18360052
178900             PERFORM 9998-SQL-ABEND-ROUTINE                       18370052
179000         END-EVALUATE                                             18380052
179100     END-PERFORM.                                                 18390052
179200                                                                  18400052
179300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         18410052
179400       MOVE 'CLOSE RETRIES EXCEEDED'  TO  PV-DB2-OPERATION        18420052
179500       PERFORM 9998-SQL-ABEND-ROUTINE                             18430052
179600     END-IF.                                                      18440052
179700                                                                  18450052
179800*6600-EXIT.                                                       18460052
179900 EJECT.                                                           18470052
180000*--------------------------------------------------------------*  18480052
180500* 7000-CREATE-REFRESH-STORE-LIST.                                 18490052
180100*       - PERFORM THE NECESSARY ROUTINES TO CREATE THE STORE      18500052
180200*         GROUP LIST RECORDS FOR THOSE STORES WHICH SHOULD        18510052
180300*         RECEIVE A FULL PLU FILE.                                18520052
180400*--------------------------------------------------------------*  18530052
180500 7000-CREATE-REFRESH-STORE-LIST.                                  18540052
180600     MOVE '7000-CREATE-REFRESH-STORE-LIST' TO PV-PARAGRAPH-NAME.  18550052
180700                                                                  18560052
180800     PERFORM 7100-OPEN-REFRESH-CURSOR.                            18570052
180900                                                                  18580052
181000     SET PS-NOT-END-OF-REFRESH-CSR TO TRUE.                       18590052
181100                                                                  18600052
181200     PERFORM 7200-FETCH-REFRESH-STORE-LIST                        18610052
181300             UNTIL PS-END-OF-REFRESH-CSR.                         18620052
181400                                                                  18630052
181500     PERFORM 7300-CLOSE-REFRESH-CURSOR.                           18640052
181600                                                                  18650052
181700*7000-EXIT.                                                       18660052
181800 EJECT.                                                           18670052
181900*--------------------------------------------------------------*  18680052
182300* 7100-OPEN-REFRESH-CURSOR.                                       18690052
182000*       - OPEN THE REFRESH STORE LIST CURSOR.  THE OPEN WILL BE   18700052
182100*         ATTEMPTED UP TO PC-MAX-RETRIES TIMES.                   18710052
182200*--------------------------------------------------------------*  18720052
182300 7100-OPEN-REFRESH-CURSOR.                                        18730052
182400     MOVE '7100-OPEN-REFRESH-CURSOR' TO PV-PARAGRAPH-NAME.        18740052
182500                                                                  18750052
182600     PERFORM                                                      18760052
182700         WITH TEST AFTER                                          18770052
182800         VARYING PV-SQL-SUB                                       18780052
182900         FROM 1 BY 1                                              18790052
183000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 18800052
183100                   OR  SQLCODE = 0)                               18810052
183200                                                                  18820052
183300         EXEC SQL                                                 18830052
183400           OPEN REFRESH-STORE-LIST                                18840052
183500         END-EXEC                                                 18850052
183600                                                                  18860052
183700         EVALUATE TRUE                                            18870052
183800           WHEN SQLCODE = -904                                    18880052
183900           WHEN SQLCODE = -911                                    18890052
184000           WHEN SQLCODE = -913                                    18900052
184100             CONTINUE                                             18910052
184200                                                                  18920052
184300           WHEN SQLCODE = 0                                       18930052
184400             SET PS-NOT-END-OF-REFRESH-CSR TO TRUE                18940052
184500                                                                  18950052
184600           WHEN SQLWARN0 NOT EQUAL SPACE                          18960052
184700           WHEN SQLCODE NOT EQUAL ZERO                            18970052
184800             MOVE 'ERROR ON OPEN OF STORE CURSOR'                 18980052
184900                                TO PV-DB2-OPERATION               18990052
185000             PERFORM 9998-SQL-ABEND-ROUTINE                       19000052
185100                                                                  19010052
185200         END-EVALUATE                                             19020052
185300     END-PERFORM.                                                 19030052
185400                                                                  19040052
185500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         19050052
185600       MOVE 'OPEN RETRIES EXCEEDED'   TO  PV-DB2-OPERATION        19060052
185700       PERFORM 9998-SQL-ABEND-ROUTINE                             19070052
185800     END-IF.                                                      19080052
185900                                                                  19090052
186000*7100-EXIT.                                                       19100052
186100 EJECT.                                                           19110052
186200*--------------------------------------------------------------*  19120052
187400* 7200-FETCH-REFRESH-STORE-LIST.                                  19130052
186300*       - FETCH THE REFRESH STORE LIST RECORDS.  STORES MUST BE   19140052
186400*         CURRENTLY OPEN OR OPENING WITHIN 'X' NUMBER OF          19150052
186500*         ADVANCE DAYS FROM THE CURRENT BATCH DATE.  THE 'X'      19160052
186600*         ADVANCE DAYS COMES FROM A CONTROL CARD.                 19170052
186700*                                                                 19180052
186800*         STORES ON THE NEW PROMO SYSTEM OR THOSE THAT WILL BE    19190052
186900*         WHEN THEY OPEN SHOULD BE SELECTED. THIS IS INDICATED    19200052
187000*         BY THE POS_CAP_LVL_ID COLUMN HAVING A VALUE OF '5'      19210052
187100*         FOR STORES NOT OPEN YET OR A VALUE GREATER THAN '11'    19220052
187200*         INDICATING THEY ARE OPEN.                               19230052
187300*--------------------------------------------------------------*  19240052
187400 7200-FETCH-REFRESH-STORE-LIST.                                   19250052
187500     MOVE '7200-FETCH-REFRESH-STORE-LIST' TO PV-PARAGRAPH-NAME.   19260052
187600                                                                  19270052
187700     EXEC SQL                                                     19280052
187800          FETCH  REFRESH-STORE-LIST                               19290052
187900           INTO  :EPT00010-STR-NBR                                19300052
188000                ,:EPT00010-RFRSH-TYP-CDE                          19310052
188100                                                                  19320052
188200     END-EXEC.                                                    19330052
188300                                                                  19340052
188400     EVALUATE TRUE                                                19350052
188500       WHEN SQLCODE = 0                                           19360052
188600         ADD  1  TO  PV-REFRESH-FETCHES                           19370052
188700         EVALUATE EPT00010-RFRSH-TYP-CDE                          19380052
188800           WHEN 'PL'                                              19390052
188900             MOVE '99998'             TO PV-STORE-GROUP-TYPE      19400052
189000           WHEN 'SM'                                              19410052
189000           WHEN 'XS'                                              19420052
189000           WHEN 'SI'                                              19430060
189100             MOVE '99997'             TO PV-STORE-GROUP-TYPE      19440052
189200           WHEN 'AD'                                              19450052
189300             MOVE '99996'             TO PV-STORE-GROUP-TYPE      19460052
189000           WHEN 'AS'                                              19470057
189100             MOVE '99991'             TO PV-STORE-GROUP-TYPE      19480057
189400         END-EVALUATE                                             19490052
189500         MOVE ALL '0'                 TO PV-STORE-GROUP-ID        19500052
189600         MOVE EPT00010-STR-NBR        TO PV-STORE-NUMBER          19510052
189700                                                                  19520052
190000         PERFORM 8100-FORMAT-STORE-PROMO                          19530052
190100         DISPLAY PC-FIVE-BLANKS                                   19540052
190200                 'REFRESH STORE NUMBER - ' EPT00010-STR-NBR       19550052
190300                                                                  19560052
190400       WHEN SQLCODE = +100                                        19570052
190500         SET PS-END-OF-REFRESH-CSR TO TRUE                        19580052
190600                                                                  19590052
190700       WHEN OTHER                                                 19600052
190800         MOVE 'ERROR ON FETCH OF REFRESH STORES CURSOR'           19610052
190900                            TO PV-DB2-OPERATION                   19620052
191000         PERFORM 9998-SQL-ABEND-ROUTINE                           19630052
191100                                                                  19640052
191200     END-EVALUATE.                                                19650052
191300                                                                  19660052
191400*7200-EXIT.                                                       19670052
191500 EJECT.                                                           19680052
196300*--------------------------------------------------------------*  19690052
196700* 7300-CLOSE-REFRESH-CURSOR.                                      19700052
196400*       - CLOSE THE REFRESH STORE LIST CURSOR.  THE CLOSE WILL    19710052
196500*         BE ATTEMPTED UP TO PC-MAX-RETRIES TIMES.                19720052
196600*--------------------------------------------------------------*  19730052
196700 7300-CLOSE-REFRESH-CURSOR.                                       19740052
196800     MOVE '7300-CLOSE-REFRESH-CURSOR' TO PV-PARAGRAPH-NAME.       19750052
196900                                                                  19760052
197000     PERFORM                                                      19770052
197100         WITH TEST AFTER                                          19780052
197200         VARYING PV-SQL-SUB                                       19790052
197300         FROM 1 BY 1                                              19800052
197400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 19810052
197500                   OR  SQLCODE = 0)                               19820052
197600                                                                  19830052
197700         EXEC SQL                                                 19840052
197800           CLOSE REFRESH-STORE-LIST                               19850052
197900         END-EXEC                                                 19860052
198000                                                                  19870052
198100         EVALUATE TRUE                                            19880052
198200           WHEN SQLCODE = -904                                    19890052
198300           WHEN SQLCODE = -911                                    19900052
198400           WHEN SQLCODE = -913                                    19910052
198500             CONTINUE                                             19920052
198600                                                                  19930052
198700           WHEN SQLCODE = 0                                       19940052
198800             SET PS-NOT-END-OF-REFRESH-CSR TO TRUE                19950052
198900                                                                  19960052
199000           WHEN SQLWARN0 NOT EQUAL SPACE                          19970052
199100           WHEN SQLCODE NOT EQUAL ZERO                            19980052
199200             MOVE 'ERROR ON CLOSE OF REFRESH CURSOR'              19990052
199300                                TO PV-DB2-OPERATION               20000052
199400             PERFORM 9998-SQL-ABEND-ROUTINE                       20010052
199500         END-EVALUATE                                             20020052
199600     END-PERFORM.                                                 20030052
199700                                                                  20040052
199800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         20050052
199900       MOVE 'CLOSE RETRIES EXCEEDED'  TO  PV-DB2-OPERATION        20060052
200000       PERFORM 9998-SQL-ABEND-ROUTINE                             20070052
200100     END-IF.                                                      20080052
200200                                                                  20090052
200300*7300-EXIT.                                                       20100052
200400 EJECT.                                                           20110052
200500*--------------------------------------------------------------*  20120052
201000* 8000-FORMAT-NEW-FPLU-RECORD.                                    20130052
200600*       - FORMAT THE OUTPUT RECORDS FOR THE NEW FPLU  FILE.       20140052
200700*       - PERFORM THE ROUTINE TO WRITE THE RECORDS TO THE NEW     20150052
200800*         FPLU  FILE.                                             20160052
200900*--------------------------------------------------------------*  20170052
201000 8000-FORMAT-NEW-FPLU-RECORD.                                     20180052
201100     MOVE '8000-FORMAT-NEW-FPLU-RECORD' TO PV-PARAGRAPH-NAME.     20190052
201200                                                                  20200052
201300     INITIALIZE EP426-NEW-PROMO-RECORD.                           20210052
201400     MOVE  XST00001-LOC-NBR  TO PV-STORE-NUMBER.                  20220052
201500     MOVE  PV-STORE-NUMBER   TO EP426-NEW-PROMO-STORE-NUMBER.     20230052
201600     MOVE  EP426-NEW-PROMO-RECORD (1:50) TO PV-EBCDIC-RECORD.     20240052
201700     MOVE LENGTH OF PV-EBCDIC-RECORD TO PV-LENGTH.                20250052
201800                                                                  20260052
201900     MOVE PV-EBCDIC-RECORD TO EP426-NEW-PROMO-RECORD(1:PV-LENGTH).20270052
202300     PERFORM 9500-WRITE-NEW-FPLU-RECORD.                          20280052
202000                                                                  20290052
203100*8000-EXIT.                                                       20300052
203200 EJECT.                                                           20310052
203300*--------------------------------------------------------------*  20320052
203900* 8100-FORMAT-STORE-PROMO.                                        20330052
203400*       - FORMAT THE DETAIL OUTPUT RECORDS FOR THE STORE GROUP    20340052
203500*         LIST FILE.                                              20350052
203600*       - PERFORM THE ROUTINE TO WRITE THE RECORDS TO THE STORE   20360052
203700*         GROUP LIST FILE.                                        20370052
203800*--------------------------------------------------------------*  20380052
203900 8100-FORMAT-STORE-PROMO.                                         20390052
204000     MOVE '8100-FORMAT-STORE-PROMO' TO PV-PARAGRAPH-NAME.         20400052
204100                                                                  20410052
204200     INITIALIZE EP425-STORE-PROMO-RECORD.                         20420052
204300     MOVE  PV-STORE-GROUP-TYPE  TO EP425-STORE-GROUP-TYPE.        20430052
204400     MOVE  PV-STORE-GROUP-ID    TO EP425-STORE-GROUP-ID.          20440052
204500     MOVE  PV-STORE-NUMBER      TO EP425-STORE-NUMBER             20450052
204600     MOVE  EP425-STORE-PROMO-RECORD TO PV-EBCDIC-RECORD.          20460052
204700     MOVE LENGTH OF PV-EBCDIC-RECORD TO PV-LENGTH.                20470052
204800                                                                  20480052
204900     INITIALIZE PV-STORE-GROUP-RECORD.                            20490052
205000     MOVE PV-EBCDIC-RECORD TO PV-STORE-GROUP-RECORD(1:PV-LENGTH). 20500052
                                                                        20510052
205400     PERFORM 9700-WRITE-STORE-DETAIL-RECORD.                      20520052
205500     ADD 1               TO PV-COUNT-EP425-RECORDS                20530052
205600                            PV-COUNT-OUTPUT-RECORDS.              20540052
205100                                                                  20550052
206900                                                                  20560052
207000*8100-EXIT.                                                       20570052
207100 EJECT.                                                           20580052
207200*--------------------------------------------------------------*  20590052
207800* 8200-FORMAT-FILE-NAME-OUTPUT.                                   20600052
207300*       - FORMAT THE HEADER OUTPUT RECORDS FOR THE STORE GROUP    20610052
207400*         LIST FILE.                                              20620052
207500*       - PERFORM THE ROUTINE TO WRITE THE RECORDS TO THE STORE   20630052
207600*         GROUP LIST FILE.                                        20640052
207700*--------------------------------------------------------------*  20650052
207800 8200-FORMAT-FILE-NAME-OUTPUT.                                    20660052
207900     MOVE '8200-FORMAT-FILE-NAME-OUTPUT' TO PV-PARAGRAPH-NAME.    20670052
208000                                                                  20680052
208100     MOVE 34 TO PV-LENGTH.                                        20690052
208200     INITIALIZE EP427-FILE-NAME-RECORD.                           20700052
208300     MOVE  'FILENAME=STR_GRP_LIST_' TO EP427-FILE-NAME-START.     20710052
208400     MOVE  PV-WORK-DATE-CCYYMMDD TO EP427-FILE-DATE-CCYYMMDD.     20720052
208500     MOVE  '.TXT'                TO EP427-FILE-NAME-END.          20730052
208600     MOVE  EP427-FILE-NAME-RECORD TO PV-EBCDIC-RECORD.            20740052
208700     MOVE LENGTH OF PV-EBCDIC-RECORD TO PV-LENGTH.                20750052
208800                                                                  20760052
208900     INITIALIZE PV-STORE-GROUP-RECORD.                            20770052
209000     MOVE PV-EBCDIC-RECORD TO PV-STORE-GROUP-RECORD(1:PV-LENGTH). 20780052
209100                                                                  20790052
209200     ADD 1           TO PV-COUNT-EP427-RECORDS                    20800052
209300                        PV-COUNT-OUTPUT-RECORDS.                  20810052
209400                                                                  20820052
209500     PERFORM 9600-WRITE-STORE-HEADER-RECORD.                      20830052
209600                                                                  20840052
209700*8200-EXIT.                                                       20850052
209800 EJECT.                                                           20860052
209900*--------------------------------------------------------------*  20870052
210500* 9400-CALC-NEXT-DTE-RANGE-DAY.                                   20880052
210000*       - THE STORE GROUP LIST WILL CONTAIN EVERY DATE FROM 'X'   20890052
210100*         NUMBER OF DAYS IN THE PAST TO 'Y' NUMBER OF DAYS IN     20900052
210200*         THE FUTURE.  THIS WILL INCREMENT THE DATE BY 1 DAY AS   20910052
210300*         THE RANGE IS PROCESSED.                                 20920052
210400*--------------------------------------------------------------*  20930052
210500 9400-CALC-NEXT-DTE-RANGE-DAY.                                    20940052
210600     MOVE '9400-CALC-NEXT-DTE-RANGE-DAY  ' TO PV-PARAGRAPH-NAME.  20950052
210700                                                                  20960052
210800     INITIALIZE DPG51 DPG52 DPG53                                 20970052
210900                DPG54 DPG55 DPG56.                                20980052
211000                                                                  20990052
211100     SET DPG51-INCREMENT-DATE       TO TRUE.                      21000052
211200     MOVE PC-DEC-ONE                TO DPG51-INCR-DECR-DAYS-9.    21010052
211300     MOVE PV-COMP-DTE-RNGE-NEXT-DAY TO DPG52-DB2-ISO-DATE-FMT.    21020052
211400                                                                  21030052
211500     PERFORM 9800-CALL-DATE-ROUTINE.                              21040052
211600                                                                  21050052
211700     MOVE DPG55-DB2-ISO-DATE-FMT    TO PV-COMP-DTE-RNGE-NEXT-DAY. 21060052
211800                                                                  21070052
211900*9400-EXIT.                                                       21080052
212000 EJECT.                                                           21090052
212100*--------------------------------------------------------------*  21100052
212400* 9500-WRITE-NEW-FPLU-RECORD.                                     21110052
212200*       - WRITE THE RECORDS TO THE NEW FPLU  OUTPUT FILE.         21120052
212300*--------------------------------------------------------------*  21130052
212400 9500-WRITE-NEW-FPLU-RECORD.                                      21140052
212500     MOVE '9500-WRITE-NEW-FPLU-RECORD' TO PV-PARAGRAPH-NAME.      21150052
212600                                                                  21160052
212700     WRITE NEW-FPLU-RECORD FROM EP426-NEW-PROMO-RECORD.           21170052
212800                                                                  21180052
212900     ADD 1           TO PV-COUNT-EP426-RECORDS                    21190052
213000                        PV-COUNT-OUTPUT-RECORDS.                  21200052
213100                                                                  21210052
213200*9500-EXIT.                                                       21220052
213300 EJECT.                                                           21230052
214700*--------------------------------------------------------------*  21240052
215100* 9600-WRITE-STORE-HEADER-RECORD.                                 21250052
214800*       - WRITE THE DATE HEADER RECORDS TO THE STORE GROUP LIST   21260052
214900*         FILE.                                                   21270052
215000*--------------------------------------------------------------*  21280052
215100 9600-WRITE-STORE-HEADER-RECORD.                                  21290052
215200     MOVE '9600-WRITE-STORE-HEADER-RECORD' TO PV-PARAGRAPH-NAME.  21300052
215300                                                                  21310052
215400     MOVE PV-STORE-GROUP-RECORD TO STORE-HEADER-RECORD.           21320052
215600                                                                  21330052
215700     WRITE STORE-HEADER-RECORD.                                   21340052
215900                                                                  21350052
216000*9600-EXIT.                                                       21360052
216100 EJECT.                                                           21370052
216200*--------------------------------------------------------------*  21380052
216500* 9700-WRITE-STORE-DETAIL-RECORD.                                 21390052
216300*       - WRITE THE DETAIL RECORDS TO THE STORE GROUP LIST FILE.  21400052
216400*--------------------------------------------------------------*  21410052
216500 9700-WRITE-STORE-DETAIL-RECORD.                                  21420052
216600     MOVE '9700-WRITE-STORE-DETAIL-RECORD' TO PV-PARAGRAPH-NAME.  21430052
216700                                                                  21440052
216800     MOVE PV-STORE-GROUP-RECORD TO STORE-DETAIL-RECORD.           21450052
216900                                                                  21460052
217000     WRITE STORE-DETAIL-RECORD.                                   21470052
217100                                                                  21480052
217200*9700-EXIT.                                                       21490052
218500 EJECT.                                                           21500052
218600*--------------------------------------------------------------*  21510052
218900* 9800-CALL-DATE-ROUTINE.                                         21520052
218700*       - CALL THE KOHLS DATE ROUTINE.                            21530052
218800*--------------------------------------------------------------*  21540052
218900 9800-CALL-DATE-ROUTINE.                                          21550052
219000     MOVE '9800-CALL-DATE-ROUTINE        ' TO PV-PARAGRAPH-NAME.  21560052
219100                                                                  21570052
219200     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      21580052
219300     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      21590052
219400                                                                  21600052
219500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    21610052
219600                                             DPG54 DPG55 DPG56.   21620052
219700                                                                  21630052
219800     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  21640052
219900       DISPLAY '**       ABEND         **'                        21650052
220000       DISPLAY '** PROGRAM = ** ' PC-PROGRAM-NAME                 21660052
220100       DISPLAY 'DATE = ' DPG52-DB2-ISO-DATE-FMT                   21670052
220300       DISPLAY DPG54-ERROR-MESSAGE                                21680052
220400       MOVE 4019 TO PV-ABEND-CODE                                 21690052
220500       CALL 'ILBOABN0' USING PV-ABEND-CODE                        21700052
220600     END-IF.                                                      21710052
220700                                                                  21720052
220800*9800-EXIT.                                                       21730052
220900 EJECT.                                                           21740052
221000*--------------------------------------------------------------*  21750052
221300* 9998-SQL-ABEND-ROUTINE.                                         21760052
221100*       - SQL ABEND ROUTINE.                                      21770052
221200*--------------------------------------------------------------*  21780052
221300 9998-SQL-ABEND-ROUTINE.                                          21790052
221400                                                                  21800052
221500     DISPLAY '** ABEND     **'.                                   21810052
221600     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                21820052
221700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              21830052
221800     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               21840052
221900                                                                  21850052
222000     COPY DPPD004.                                                21860052
222100     SET ABEND-4013-DB2-ERROR TO TRUE.                            21870052
222200     CALL 'ILBOABN0' USING ABEND-CODE.                            21880052
222300                                                                  21890052
222400*9998-EXIT.                                                       21900052
222500 EJECT.                                                           21910052
222600*--------------------------------------------------------------*  21920052
223000* 9999-WRAPUP.                                                    21930052
222700*       - END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND           21940052
222800*         DISPLAYS ANY DATA FROM THE PROGRAM.                     21950052
222900*--------------------------------------------------------------*  21960052
223000 9999-WRAPUP.                                                     21970052
223100     MOVE '9999-WRAPUP                   ' TO PV-PARAGRAPH-NAME.  21980052
223200                                                                  21990052
223300     CLOSE CONTROL-CARD-ADVANCE-DAYS                              22000052
223400           CONTROL-CARD-BATCH-DATE                                22010052
223500           STORE-GROUP-FILE                                       22020052
223600           NEW-FPLU-FILE.                                         22030052
223900                                                                  22040052
224000     DISPLAY ' '.                                                 22050052
224100     DISPLAY '*********************************************'.     22060052
224200     DISPLAY '       PROGRAM NAME: ' PC-PROGRAM-NAME.             22070052
224300     DISPLAY '*********************************************'.     22080052
224400     DISPLAY ' '.                                                 22090052
224500     DISPLAY 'NUMBER OF UNIQUE DATE FETCHES   : '                 22100052
224600              PV-UNIQUE-DATE-FETCHES.                             22110052
224700     DISPLAY 'NUMBER OF STORE GROUP FETCHES   : '                 22120052
224800              PV-STORE-GROUP-FETCHES.                             22130052
224900     DISPLAY 'NUMBER OF ADHOC FETCHES         : '                 22140052
225000              PV-ADHOC-FETCHES.                                   22150052
225100     DISPLAY 'NUMBER OF REFRESH FETCHES       : '                 22160052
225200              PV-REFRESH-FETCHES.                                 22170052
225500     DISPLAY 'NUMBER OF DAYS IN COMPLETE RANGE: '                 22180052
225600              PV-DAYS-IN-COMP-RANGE.                              22190052
225700     DISPLAY ' '.                                                 22200052
225800     DISPLAY 'NUMBER OF OUTPUT RECORDS WRITTEN: '                 22210052
225900              PV-COUNT-OUTPUT-RECORDS.                            22220052
226000     DISPLAY PC-FIVE-BLANKS                                       22230052
226100             'NUMBER OF EP426 RECORDS WRITTEN: '                  22240052
226200              PV-COUNT-EP426-RECORDS                              22250052
226300             ' - DD OUT01'.                                       22260052
226400     DISPLAY PC-FIVE-BLANKS                                       22270052
226500             'NUMBER OF EP427 RECORDS WRITTEN: '                  22280052
226600              PV-COUNT-EP427-RECORDS                              22290052
226700             ' - DD OUT02'.                                       22300052
226800     DISPLAY PC-FIVE-BLANKS                                       22310052
226900             'NUMBER OF EP425 RECORDS WRITTEN: '                  22320052
227000              PV-COUNT-EP425-RECORDS                              22330052
227100             ' - DD OUT02'.                                       22340052
228000     DISPLAY ' '.                                                 22350052
228100                                                                  22360052
228200*9999-EXIT.                                                       22370052
228300 EJECT.                                                           22380052
