000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    XLKUT035.                                         00020001
000300 AUTHOR.        RON KRIER.                                        00030001
000400 INSTALLATION.  KOHLS.                                            00040001
000500 DATE-WRITTEN   MARCH 29, 2003.                                   00050001
000600 DATE-COMPILED.                                                   00060001
000700                                                                  00070001
000800* ************************************************************** *00080001
000900* * XLKUT035.  "PURCHASE ORDER DOMAIN INTEGRITY"               * *00090001
001000* *                                                            * *00100001
001100* * PURPOSE:                                                   * *00110001
001200* * THIS PROGRAM CREATES AN EXTRACT FILE FROM: TMESTDS.        * *00120001
001300* * THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE TO PART  * *00130001
001400* * OF THE INTEGRITY PROCESS BETWEEN THE RMS PURCHASE ORDER    * *00140001
001500* * SYSTEM AND THE LOGISTICS DOMAIN PURCHASE ORDER TABLES.     * *00150001
001600* *                                                            * *00160001
001700* * PROCESSING OVERVIEW:                                       * *00170001
001800* *   THIS PROGRAM WILL READ THE INPUT DRIVER FILE AND THEN    * *00180001
001900* *   PERFORM A SELECT ON THE TMESTDS TABLE.  DATA RETRIEVED   * *00190001
002000* *   FROM THE SELECT WILL THEN BE WRITTEN TO THE OUTPUT FILE. * *00200001
002100**************************************************************** *00210001
002200 ENVIRONMENT DIVISION.                                            00220001
002300 CONFIGURATION SECTION.                                           00230001
002400 SOURCE-COMPUTER.        IBM-3090.                                00240001
002500 OBJECT-COMPUTER.        IBM-3090.                                00250001
002600                                                                  00260001
002700 INPUT-OUTPUT SECTION.                                            00270001
002800 FILE-CONTROL.                                                    00280001
002900                                                                  00290001
003000     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00300001
003100     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00310001
003200                                                                  00320001
003300******************************************************************00330001
003400 DATA DIVISION.                                                   00340001
003500 FILE SECTION.                                                    00350001
003600                                                                  00360001
003700 FD  IN-DRIVER-FILE                                               00370001
003800     RECORDING MODE IS F                                          00380001
003900     LABEL RECORDS ARE STANDARD                                   00390001
004000     BLOCK CONTAINS 0 RECORDS.                                    00400001
004100 01  IN-DRIVER-RECORD                PIC  X(030).                 00410001
004200                                                                  00420001
004300**** TMESTDS:                                                     00430001
004400 FD  OUT-EXTRACT-FILE                                             00440001
004500     RECORDING MODE IS F                                          00450001
004600     LABEL RECORDS ARE STANDARD                                   00460001
004700     BLOCK CONTAINS 0 RECORDS.                                    00470001
004800 01  OUT-EXTRACT-RECORD              PIC  X(024).                 00480001
004900                                                                  00490001
005000                                                                  00500001
005100                                                                  00510001
005200 WORKING-STORAGE SECTION.                                         00520001
005300                                                                  00530001
005400 01  PC-PROGRAM-CONSTANTS.                                        00540001
005500     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'XLKUT035'.  00550001
005600     05  PC-PGM-PROGRESS-DESC.                                    00560001
005700         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00570001
005800         10  PC-CONTINUING           PIC X(10) VALUE              00580001
005900                                               'CONTINUING'.      00590001
006000         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00600001
006100         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00610001
006200     05  PC-ABEND-INFO.                                           00620001
006300         10  PC-ABEND                PIC X(11) VALUE              00630001
006400                                               '** ABEND **'.     00640001
006500         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00650001
006600                                               '- PARA       : '. 00660001
006700         10  PC-ABEND-MSG-DISPLAY-PARA                            00670001
006800                                     PIC X(15) VALUE              00680001
006900                                               '  CALLED PARA: '. 00690001
007000         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00700001
007100                                               '  FOR ABEND# : '. 00710001
007200         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00720001
007300                                               '- ERROR IS   : '. 00730001
007400         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00740001
007500         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00750001
007600                                               '- ACTION     : '. 00760001
007700     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00770001
007800                                                                  00780001
007900 01  PS-PROGRAM-SWITCHES.                                         00790001
008000     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         00800001
008100         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         00810001
008200         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         00820001
008300     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         00830001
008400         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         00840001
008500         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         00850001
008600     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         00860001
008700         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         00870001
008800         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         00880001
008900                                                                  00890001
009000 01  PV-PROGRAM-VARIABLES.                                        00900001
009100     05  PV-PO-NBR-COMP              PIC S9(9) VALUE 0 COMP.      00910001
009200     05  PV-PO-NBR-NUM               PIC  9(9) VALUE 0.           00920001
009300     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           00930001
009400     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           00940001
009500     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           00950001
009600     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           00960001
009700                                                                  00970001
009800     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      00980001
009900     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      00990001
010000     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01000001
010100     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01010001
010200     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01020001
010300     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01030001
010400                                                                  01040001
010500     05  PV-TMST                     PIC X(26) VALUE SPACES.      01050001
010600     05  PV-TIMESTAMP-DETAIL                                      01060001
010700         REDEFINES                                                01070001
010800         PV-TMST.                                                 01080001
010900         10  PV-TIMESTAMP-19.                                     01090001
011000             15  PV-TMS-DATE.                                     01100001
011100                 20  PV-TMS-YEAR.                                 01110001
011200                     25  PV-TMS-CC   PIC X(02).                   01120001
011300                     25  PV-TMS-YY   PIC X(02).                   01130001
011400                 20  FILLER          PIC X(01).                   01140001
011500                 20  PV-TMS-MONTH    PIC X(02).                   01150001
011600                 20  FILLER          PIC X(01).                   01160001
011700                 20  PV-TMS-DAY      PIC X(02).                   01170001
011800             15  FILLER              PIC X(01).                   01180001
011900             15  PV-TMS-HOUR         PIC X(02).                   01190001
012000             15  FILLER              PIC X(01).                   01200001
012100             15  PV-TMS-MINUTE       PIC X(02).                   01210001
012200             15  FILLER              PIC X(01).                   01220001
012300             15  PV-TMS-SECOND       PIC X(02).                   01230001
012400         10  FILLER                  PIC X(01).                   01240001
012500         10  PV-TMS-MSECOND          PIC X(06).                   01250001
012600                                                                  01260001
012700 01  DM-DISPLAY-MESSAGE.                                          01270001
012800     05  DM-01-10.                                                01280001
012900         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01290001
013000         10  FILLER                  PIC X(02) VALUE ': '.        01300001
013100     05  DM-11-80.                                                01310001
013200         10  FILLER                  PIC X(37) VALUE              01320001
013300                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  01330001
013400         10  FILLER                  PIC X(30) VALUE              01340001
013500                        'CREATING TMESTDS EXTRACT FILE.'.         01350001
013600         10  FILLER                  PIC X(01) VALUE SPACE.       01360001
013700         10  FILLER                  PIC X(01) VALUE ALL '*'.     01370001
013800     05  DM-81-120.                                               01380001
013900         10  FILLER                  PIC X(40) VALUE ALL '*'.     01390001
014000                                                                  01400001
014100 01  DP-DISPLAY-PROGRESS-MSG.                                     01410001
014200     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01420001
014300     05  FILLER                      PIC X(02) VALUE SPACE.       01430001
014400     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01440001
014500     05  FILLER                      PIC X(04) VALUE ' AT '.      01450001
014600     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01460001
014700     05  FILLER                      PIC X(03) VALUE '.  '.       01470001
014800     05  FILLER                      PIC X(03) VALUE              01480001
014900                                         'IN:'.                   01490001
015000     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01500001
015100                                               VALUE ZERO.        01510001
015200     05  FILLER                      PIC X(02) VALUE ', '.        01520001
015300*    05  FILLER                      PIC X(16) VALUE              01530001
015400*                                        'DRIVER W/ROW(S):'.      01540001
015500*    05  DP-MATCHES-FOUND-CNT        PIC ZZZ,ZZZ,ZZ9              01550001
015600*                                              VALUE ZERO.        01560001
015700*    05  FILLER                      PIC X(02) VALUE ', '.        01570001
015800     05  FILLER                      PIC X(14) VALUE              01580001
015900                                         'ROWS SELECTED:'.        01590001
016000     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01600001
016100                                               VALUE ZERO.        01610001
016200     05  FILLER                      PIC X(02) VALUE ', '.        01620001
016300     05  FILLER                      PIC X(04) VALUE              01630001
016400                                         'OUT:'.                  01640001
016500     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01650001
016600                                               VALUE ZERO.        01660001
016700     05  FILLER                      PIC X(01) VALUE '.'.         01670001
016800                                                                  01680001
016900 01  ABEND-CODE                      PIC S9(04)                   01690001
017000                                               VALUE ZEROES       01700001
017100                                               COMP SYNC.         01710001
017200                                                                  01720001
017300*---------------------------------------------------------------* 01730001
017400*  DB2 FORMATTED MESSAGE AREA                                     01740001
017500*---------------------------------------------------------------* 01750001
017600     COPY DPWS004.                                                01760001
017700                                                                  01770001
017800                                                                  01780001
017900*---------------------------------------------------------------* 01790001
018000*  XLRD013  - RECORD LAYOUT FOR PO DRIVER FILE, INPUT.          * 01800001
018100*---------------------------------------------------------------* 01810001
018200     COPY XLRD013.                                                01820001
018300                                                                  01830001
018400                                                                  01840001
018500*---------------------------------------------------------------* 01850001
018600*    DB2 AREA FOR TMESTDS                                       * 01860001
018700*---------------------------------------------------------------* 01870001
018800     EXEC SQL                                                     01880001
018900          INCLUDE TMESTDS                                         01890001
019000     END-EXEC.                                                    01900001
019100                                                                  01910001
019200*---------------------------------------------------------------* 01920001
019300*    DB2 AREA FOR COMMUNICATIONS                                * 01930001
019400*---------------------------------------------------------------* 01940001
019500     EXEC SQL                                                     01950001
019600          INCLUDE SQLCA                                           01960001
019700     END-EXEC.                                                    01970001
019800                                                                  01980001
019900*---------------------------------------------------------------* 01990001
020000*    DEFINE CURSOR FOR TMESTDS :                                * 02000001
020100*    PULL ALL AVAILABLE COLUMNS, SO EXTRACT FILE WILL CONTAIN   * 02010001
020200*    ALL DATA TO POPULATE "ARCHIVE HISTORY" COPY OF THIS TABLE. * 02020001
020300*---------------------------------------------------------------* 02030001
020400     EXEC SQL                                                     02040001
020500          DECLARE TABLE-CURSOR CURSOR FOR                         02050001
020600           SELECT PO_NBR                                          02060001
020700                 ,PO_LNE_NBR                                      02070001
020800                 ,PLAN_NBR                                        02080001
020900                 ,STR_NBR                                         02090001
021000                 ,STR_DISTRO_QTY                                  02100001
021100                 ,ALLOC_SEQ_CDE                                   02110001
021200                 ,RNK_SEQ_NBR                                     02120001
021300                 ,STR_CNSTR_CDE                                   02130001
021400                 ,STR_CNSTR_QTY                                   02140001
023300           FROM   TMESTDS                                         02330001
023400          WHERE  (PO_NBR = :PV-PO-NBR-COMP)                       02340001
023600            FOR  FETCH ONLY                                       02360001
023700           WITH  UR                                               02370001
023800     END-EXEC.                                                    02380001
023900                                                                  02390001
024000                                                                  02400001
024100 PROCEDURE DIVISION.                                              02410001
024200********************                                              02420001
024300                                                                  02430001
024400 0000-PROGRAM-MAINLINE.                                           02440001
024500                                                                  02450001
024600     PERFORM 1000-INITIALIZE.                                     02460001
024700                                                                  02470001
024800     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02480001
024900     PERFORM 2000-PROCESS-DRIVER-FILE                             02490001
025000         UNTIL PS-IN-DRIVER-EOF.                                  02500001
025100                                                                  02510001
025200     PERFORM 6000-EOJ-ROUTINE.                                    02520001
025300     STOP RUN.                                                    02530001
025400                                                                  02540001
025500                                                                  02550001
025600* ************************************************************** *02560001
025700* * INITIALIZATIONS                                            * *02570001
025800* ************************************************************** *02580001
025900 1000-INITIALIZE.                                                 02590001
026000                                                                  02600001
026100     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02610001
026200     DISPLAY DM-DISPLAY-MESSAGE.                                  02620001
026300                                                                  02630001
026400     MOVE PC-BEGINNING              TO DP-STATUS-DESCRIPTION.     02640001
026500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02650001
026600                                                                  02660001
026700     PERFORM 9000-OPEN-IN-DRIVER-FILE.                            02670001
026800     PERFORM 9700-OPEN-OUT-EXTRACT-FILE.                          02680001
026900                                                                  02690001
027000                                                                  02700001
027100* ************************************************************** *02710001
027200* * 1) GET NEXT RECORD FROM DRIVER FILE, AND                   * *02720001
027300* *    1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR        * *02730001
027400* *    1B- OPEN TABLE CURSOR                                   * *02740001
027500* *    1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL               * *02750001
027600* *        ROWS FOR THIS INPUT DRIVER RECORD                   * *02760001
027700* *    2) FOR EACH ROW,                                        * *02770001
027800* *       2A- INCREMENT COUNTS                                 * *02780001
027900* *       2B- WRITE EXTRACT RECORD                             * *02790001
028000* *    1D- CLOSE TABLE CURSOR                                  * *02800001
028100* ************************************************************** *02810001
028200 2000-PROCESS-DRIVER-FILE.                                        02820001
028300                                                                  02830001
028400     PERFORM 9050-READ-IN-DRIVER-FILE.                            02840001
028500     IF PS-IN-DRIVER-EOF                                          02850001
028600         CONTINUE                                                 02860001
028700     ELSE                                                         02870001
028800         MOVE XL013-PO-NBR TO         PV-PO-NBR-COMP              02880001
028900                                      PV-PO-NBR-NUM               02890001
029000         PERFORM 2100-CHECK-PGM-PROGRESS                          02900001
029100         SET PS-TABLE-LOOP-NOT-DONE   TO TRUE                     02910001
029200         SET PS-CURSOR-HAS-NO-DATA    TO TRUE                     02920001
029300         PERFORM 9100-OPEN-TABLE-CURSOR                           02930001
029400         PERFORM 3000-EXTRACT-ROWS-FROM-TABLE                     02940001
029500             UNTIL PS-TABLE-LOOP-DONE                             02950001
029600         PERFORM 9190-CLOSE-TABLE-CURSOR                          02960001
029700     END-IF.                                                      02970001
029800                                                                  02980001
029900                                                                  02990001
030000* ************************************************************** *03000001
030100* *    EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT     * *03010001
030200* *    RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST   * *03020001
030300* *    WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.   * *03030001
030400* ************************************************************** *03040001
030500 2100-CHECK-PGM-PROGRESS.                                         03050001
030600     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         03060001
030700         BY        PC-HOW-OFTEN-TO-DISPLAY                        03070001
030800         GIVING    PV-DISPLAY-NTH-MULTIPLE                        03080001
030900         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      03090001
031000                                                                  03100001
031100     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           03110001
031200         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      03120001
031300         PERFORM 6200-DISPLAY-PGM-PROGRESS                        03130001
031400     END-IF.                                                      03140001
031500                                                                  03150001
031600                                                                  03160001
031700* ************************************************************** *03170001
031800* * EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD     * *03180001
031900* ************************************************************** *03190001
032000 3000-EXTRACT-ROWS-FROM-TABLE.                                    03200001
032100     INITIALIZE DCLTMESTDS.                                       03210001
032200     PERFORM 9150-FETCH-TABLE-CURSOR.                             03220001
032300     IF PS-TABLE-LOOP-DONE                                        03230001
032400         CONTINUE                                                 03240001
032500     ELSE                                                         03250001
032600         PERFORM 9750-WRITE-EXTRACT-RECORD                        03260001
032700     END-IF.                                                      03270001
032800                                                                  03280001
032900                                                                  03290001
033000* ************************************************************** *03300001
033100* * DISPLAY END OF RUN MESSAGE, CLOSE THE OUTPUT FILES         * *03310001
033200* ************************************************************** *03320001
033300 6000-EOJ-ROUTINE.                                                03330001
033400                                                                  03340001
033500     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           03350001
033600     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         03360001
033700                                                                  03370001
033800     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     03380001
033900     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           03390001
034000                                                                  03400001
034100                                                                  03410001
034200* ************************************************************** *03420001
034300* * DISPLAY PROGRAM PROGRESS.                                  * *03430001
034400* ************************************************************** *03440001
034500 6200-DISPLAY-PGM-PROGRESS.                                       03450001
034600                                                                  03460001
034700     EXEC SQL                                                     03470001
034800          SET :PV-TMST = CURRENT TIMESTAMP                        03480001
034900     END-EXEC.                                                    03490001
035000                                                                  03500001
035100     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03510001
035200     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03520001
035300     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03530001
035400                                    TO DP-IN-CNT.                 03540001
035500*    MOVE PV-RECS-WITH-MATCHES-CNT  TO DP-MATCHES-FOUND-CNT.      03550001
035600     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03560001
035700     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03570001
035800                                                                  03580001
035900     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03590001
036000                                                                  03600001
036100                                                                  03610001
036200* ************************************************************** *03620001
036300* * FILE AND DB2 TABLE ACCESS PARAGRAPHS.                      * *03630001
036400* * 90XX- INPUT:  DRIVER FILE                                  * *03640001
036500* * 91XX- INPUT:  TABLE CURSOR                                 * *03650001
036600* * 97XX- OUTPUT: TABLE EXTRACT                                * *03660001
036700* ************************************************************** *03670001
036800                                                                  03680001
036900* ************************************************************** *03690001
037000* * OPEN  INPUT DRIVER FILE                                    * *03700001
037100* ************************************************************** *03710001
037200 9000-OPEN-IN-DRIVER-FILE.                                        03720001
037300     OPEN  INPUT  IN-DRIVER-FILE.                                 03730001
037400                                                                  03740001
037500                                                                  03750001
037600* ************************************************************** *03760001
037700* * READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT        * *03770001
037800* ************************************************************** *03780001
037900 9050-READ-IN-DRIVER-FILE.                                        03790001
038000     READ IN-DRIVER-FILE                                          03800001
038100          INTO XL013-DRIVER-RECORD-LAYOUT                         03810001
038200          AT END                                                  03820001
038300              SET PS-IN-DRIVER-EOF TO TRUE.                       03830001
038400                                                                  03840001
038500     IF PS-IN-DRIVER-EOF                                          03850001
038600         CONTINUE                                                 03860001
038700     ELSE                                                         03870001
038800         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     03880001
038900     END-IF.                                                      03890001
039000                                                                  03900001
039100                                                                  03910001
039200* ************************************************************** *03920001
039300* * CLOSE INPUT DRIVER FILE                                    * *03930001
039400* ************************************************************** *03940001
039500 9090-CLOSE-IN-DRIVER-FILE.                                       03950001
039600     CLOSE IN-DRIVER-FILE.                                        03960001
039700                                                                  03970001
039800                                                                  03980001
039900* ************************************************************** *03990001
040000* * OPEN  TABLE CURSOR                                         * *04000001
040100* ************************************************************** *04010001
040200 9100-OPEN-TABLE-CURSOR.                                          04020001
040300     EXEC SQL                                                     04030001
040400          OPEN TABLE-CURSOR                                       04040001
040500     END-EXEC.                                                    04050001
040600                                                                  04060001
040700     EVALUATE TRUE                                                04070001
040800         WHEN SQLCODE = ZERO                                      04080001
040900              ADD +1 TO PV-RECS-WITH-MATCHES-CNT                  04090001
041000              SET PS-CURSOR-HAS-DATA TO TRUE                      04100001
041100         WHEN SQLCODE = +100                                      04110001
041200              SET PS-TABLE-LOOP-DONE TO TRUE                      04120001
041300         WHEN SQLWARN0 NOT EQUAL SPACE                            04130001
041400         WHEN SQLCODE  NOT EQUAL ZERO                             04140001
041500              MOVE '9100-OPEN-TABLE-CURSOR'                       04150001
041600                                 TO PV-PARAGRAPH-NAME             04160001
041700              MOVE 'OPEN TABLE CURSOR'                            04170001
041800                                 TO PV-DB2-OPERATION-MSG-1        04180001
041900              MOVE 'TMESTDS'     TO PV-DB2-TABLE-NAME             04190001
042000              PERFORM 9999-DB2-ABEND                              04200001
042100     END-EVALUATE.                                                04210001
042200                                                                  04220001
042300                                                                  04230001
042400* ************************************************************** *04240001
042500* * FETCH TABLE CURSOR                                         * *04250001
042600* ************************************************************** *04260001
042700 9150-FETCH-TABLE-CURSOR.                                         04270001
042800     EXEC SQL                                                     04280001
042900         FETCH TABLE-CURSOR                                       04290001
043000          INTO  :MESTDS-PO-NBR                                    04300001
043100               ,:MESTDS-PO-LNE-NBR                                04310001
043200               ,:MESTDS-PLAN-NBR                                  04320001
043300               ,:MESTDS-STR-NBR                                   04330001
043400               ,:MESTDS-STR-DISTRO-QTY                            04340001
043500               ,:MESTDS-ALLOC-SEQ-CDE                             04350001
043600               ,:MESTDS-RNK-SEQ-NBR                               04360001
043700               ,:MESTDS-STR-CNSTR-CDE                             04370001
043800               ,:MESTDS-STR-CNSTR-QTY                             04380001
045700     END-EXEC.                                                    04570001
045800                                                                  04580001
045900     EVALUATE TRUE                                                04590001
046000         WHEN SQLCODE = ZERO                                      04600001
046100              ADD +1                 TO PV-TABLE-ROW-SELECT-CNT   04610001
046200              SET PS-CURSOR-HAS-DATA TO TRUE                      04620001
046300         WHEN SQLCODE = +100                                      04630001
046400              SET PS-TABLE-LOOP-DONE TO TRUE                      04640001
046500         WHEN SQLWARN0 NOT EQUAL SPACE                            04650001
046600         WHEN SQLCODE NOT EQUAL ZERO                              04660001
046700              MOVE '9150-FETCH-TABLE-CURSOR'                      04670001
046800                                 TO PV-PARAGRAPH-NAME             04680001
046900              MOVE 'FETCH TABLE CURSOR'                           04690001
047000                                 TO PV-DB2-OPERATION-MSG-1        04700001
047100              MOVE 'TMESTDS'     TO PV-DB2-TABLE-NAME             04710001
047200              PERFORM 9999-DB2-ABEND                              04720001
047300     END-EVALUATE.                                                04730001
047400                                                                  04740001
047500                                                                  04750001
047600* ************************************************************** *04760001
047700* * CLOSE TABLE CURSOR                                         * *04770001
047800* ************************************************************** *04780001
047900 9190-CLOSE-TABLE-CURSOR.                                         04790001
048000     EXEC SQL                                                     04800001
048100          CLOSE TABLE-CURSOR                                      04810001
048200     END-EXEC.                                                    04820001
048300                                                                  04830001
048400     EVALUATE TRUE                                                04840001
048500         WHEN SQLCODE = ZERO                                      04850001
048600              CONTINUE                                            04860001
048700         WHEN SQLWARN0 NOT EQUAL SPACE                            04870001
048800         WHEN SQLCODE NOT EQUAL ZERO                              04880001
048900              MOVE '9190-CLOSE-TABLE-CURSOR'                      04890001
049000                                 TO PV-PARAGRAPH-NAME             04900001
049100              MOVE 'CLOSE TABLE CURSOR'                           04910001
049200                                 TO PV-DB2-OPERATION-MSG-1        04920001
049300              MOVE 'TMESTDS'     TO PV-DB2-TABLE-NAME             04930001
049400              PERFORM 9999-DB2-ABEND                              04940001
049500     END-EVALUATE.                                                04950001
049600                                                                  04960001
049700                                                                  04970001
049800* ************************************************************** *04980001
049900* * OPEN OUTPUT EXTRACT FILE                                   * *04990001
050000* ************************************************************** *05000001
050100 9700-OPEN-OUT-EXTRACT-FILE.                                      05010001
050200     OPEN OUTPUT OUT-EXTRACT-FILE.                                05020001
050300                                                                  05030001
050400                                                                  05040001
050500* ************************************************************** *05050001
050600* * WRITE A RECORD TO THE TABLE EXTRACT FILE                   * *05060001
050700* ************************************************************** *05070001
050800 9750-WRITE-EXTRACT-RECORD.                                       05080001
050900     WRITE  OUT-EXTRACT-RECORD  FROM  DCLTMESTDS.                 05090001
051000     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            05100001
051100                                                                  05110001
051200                                                                  05120001
051300* ************************************************************** *05130001
051400* * CLOSE OUTPUT EXTRACT FILE                                  * *05140001
051500* ************************************************************** *05150001
051600 9790-CLOSE-OUT-EXTRACT-FILE.                                     05160001
051700     CLOSE OUT-EXTRACT-FILE.                                      05170001
051800                                                                  05180001
051900                                                                  05190001
052000* ************************************************************** *05200001
052100* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *05210001
052200* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *05220001
052300* * SQL ERROR OR WARNING CODE OCCURS.                          * *05230001
052400* ************************************************************** *05240001
052500 9999-DB2-ABEND.                                                  05250001
052600                                                                  05260001
052700     DISPLAY PC-CURRENT-PROGRAM-NAME                              05270001
052800             ' 9999-DB2-ABEND'.                                   05280001
052900     DISPLAY PC-CURRENT-PROGRAM-NAME                              05290001
053000             ' ** ABEND           **'.                            05300001
053100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05310001
053200             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       05320001
053300     DISPLAY PC-CURRENT-PROGRAM-NAME                              05330001
053400             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       05340001
053500     DISPLAY PC-CURRENT-PROGRAM-NAME                              05350001
053600             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  05360001
053700                                                                  05370001
053800     DISPLAY PC-CURRENT-PROGRAM-NAME                              05380001
053900             ' ** SQLCODE         ** = ' SQLCODE.                 05390001
054000     MOVE SQLCODE TO PV-SQLCODE.                                  05400001
054100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05410001
054200             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          05420001
054300                                                                  05430001
054400     DISPLAY PC-CURRENT-PROGRAM-NAME                              05440001
054500             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            05450001
054600                                                                  05460001
054400     DISPLAY PC-CURRENT-PROGRAM-NAME                              05461002
054500             ' ** PO NUMBER       ** = ' PV-PO-NBR-NUM '.'.       05462002
054600                                                                  05463002
054700                                                                  05470001
054800*----------------------------------------------------------------*05480001
054900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *05490001
055000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *05500001
055100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *05510001
055200* FORMAT.                                                        *05520001
055300*----------------------------------------------------------------*05530001
055400     COPY DPPD004.                                                05540001
055500                                                                  05550001
055600     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     05560001
055700     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           05570001
055800     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           05580001
055900     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         05590001
056000                                                                  05600001
056100*----------------------------------------------------------------*05610001
056200* CALL ABEND                                                     *05620001
056300*----------------------------------------------------------------*05630001
056400     MOVE +4013                  TO ABEND-CODE.                   05640001
056500     CALL 'ILBOABN0' USING ABEND-CODE.                            05650001
056600*                                                                 05660001
