000100 ID  DIVISION.                                                    00010000
000200 PROGRAM-ID.         MRKUT113.                                    00020000
000300 AUTHOR.             S. MEYER.                                    00030000
000400 INSTALLATION.       KOHL'S CORPORATION.                          00040000
000500 DATE-WRITTEN.       JANUARY 2001.                                00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800***************************************************************** 00080000
000900*       THE PURPOSE OF THIS PROGRAM IS TO CAPTURE E-COM INFOREM * 00090000
001000*       SKU/STORES WHERE THE ONHAND < MIN                      *  00100000
001100*       ON ANY GIVEN DAY WITHIN THE WEEK   WR#21599             * 00110000
001200***************************************************************** 00120000
001300*                                                               * 00130000
001400*  CHANGED  99/99/99  AUTHOR.                     WR# 99998     * 00140000
001500*                                                               * 00150000
001600*                                                               * 00160000
001700***************************************************************** 00170000
001710* 04/24/2002 - DON TOMLINSON  NI-SKU MR PHASE 4 CHANGES         * 00171003
001730* -  TSKXREF ADDED.                                             * 00173003
001740* -  ADDED ISWS006 COPYBOOK TO HANDLE DIFFERENT FORMATS / SIZES * 00174003
001750*    IN FIELDS.                                                 * 00175003
001760* -  SQL CHANGED FOR WHERE STATEMENTS TO REFERENCE DCLGEN       * 00176003
001770*    FIELDS INSTEAD OF PROGRAM VARAIABLES IN WORKING STORAGE    * 00177003
001780***************************************************************** 00178003
001790* 06/10/2004 - BOB FORD  - STORE EXPANSION  WR#26363            * 00179012
001792*  CHANGED PROGRAM TO HANDLE 5-DIGIT STORE NUMBERS.  REPLACED   * 00179209
001793*  TSTR000 WITH XMT_LOC, CHANGED ALL CALLS TO USE NUMERIC STORE.* 00179309
001794***************************************************************** 00179409
001800*                                                               * 00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000 CONFIGURATION SECTION.                                           00200000
002100 SOURCE-COMPUTER.        IBM-370.                                 00210000
002200 OBJECT-COMPUTER.        IBM-370.                                 00220000
002300 INPUT-OUTPUT SECTION.                                            00230000
002400 FILE-CONTROL.                                                    00240000
002500     SELECT OH-LT-MIN-FILE                                        00250000
002600         ORGANIZATION IS INDEXED                                  00260000
002700         RECORD KEY IS MR113-OH-LT-MIN-KEY                        00270000
002800         ACCESS IS DYNAMIC                                        00280000
002900         FILE STATUS IS VSAM-STATUS                               00290000
003000         ASSIGN TO INOUT01.                                       00300000
003100                                                                  00310000
003200 DATA DIVISION.                                                   00320000
003300 FILE SECTION.                                                    00330000
003400 FD  OH-LT-MIN-FILE.                                              00340000
003410     COPY MRRD113.                                                00341004
003420                                                                  00342000
003430                                                                  00343000
003440 WORKING-STORAGE SECTION.                                         00344000
003450                                                                  00345000
003460 01  SWITCHES.                                                    00346000
003470     05  VSAM-STATUS                PIC X(2).                     00347000
003480         88  SUCCESSFUL                         VALUE '00'.       00348000
003490         88  DUPLICATE-KEY                      VALUE '22'.       00349000
003500     05  OH-LT-MIN-SW               PIC X(1)    VALUE 'N'.        00350000
003600         88  END-OF-OH-LT-MIN                   VALUE 'Y'.        00360000
003700         88  NOT-END-OF-OH-LT-MIN               VALUE 'N'.        00370000
003800     05  DESC-SW                    PIC X(1)    VALUE 'N'.        00380000
003900         88  DESC-FOUND                         VALUE 'Y'.        00390000
004000         88  DESC-NOT-FOUND                     VALUE 'N'.        00400000
004100                                                                  00410000
004200 01  VARIABLES.                                                   00420000
004300     05  SQL-SUB                     PIC S9(4)  VALUE +0          00430000
004400                                                COMP SYNC.        00440000
004500     05  SAVE-ITEM-NMBR             PIC S9(15)  COMP-3.           00450000
004600     05  ABEND-CODE                 PIC S9(4)   VALUE 0           00460000
004700                                                COMP SYNC.        00470000
004800     05  RCDS-WRITTEN               PIC S9(9)   VALUE 0           00480000
004900                                                COMP-3.           00490000
005000     05  DISPLAY-RCDS-WRITTEN       PIC 9(9).                     00500000
005200                                                                  00520000
005300 01  CONSTANTS.                                                   00530000
005400     05  MAX-RETRIES                PIC S9(3)   VALUE +3          00540000
005500                                                COMP-3.           00550000
005510                                                                  00551003
005520* NI SKU WORK FIELDS FOR CHANGING FIELD FORMATS AND LENGTHS       00552003
005530     COPY ISWS006.                                                00553003
005540*                                                                 00554003
005600                                                                  00560000
005610** NI-SKU DB2 CROSS REFERENCE TABLE                               00561003
005700     EXEC SQL                                                     00570000
005800         INCLUDE TSKXREF                                          00580003
005900     END-EXEC.                                                    00590000
006000                                                                  00600000
006010     EXEC SQL                                                     00601003
006020         INCLUDE TMRITST                                          00602003
006030     END-EXEC.                                                    00603003
006040                                                                  00604003
006100     EXEC SQL                                                     00610003
006200         INCLUDE TSKST                                            00620003
006300     END-EXEC.                                                    00630003
006400                                                                  00640003
006500     EXEC SQL                                                     00650003
006600         INCLUDE TSK                                              00660003
006700     END-EXEC.                                                    00670003
006800                                                                  00680003
007110     EXEC SQL                                                     00711010
007120         INCLUDE XMT00001                                         00712011
007130     END-EXEC.                                                    00713010
007200                                                                  00720003
007300*   DB2 COMMUNICATION AREA                                        00730003
007400     EXEC SQL                                                     00740003
007500        INCLUDE SQLCA                                             00750003
007600     END-EXEC.                                                    00760003
007700                                                                  00770003
007800*   DB2 COMMUNICATION AREA2                                       00780003
007900     COPY SQLCA2.                                                 00790003
008000                                                                  00800003
008100*                                                                 00810003
008200     EXEC SQL                                                     00820003
008300         DECLARE OH-LT-MIN CURSOR FOR                             00830003
008400         SELECT A.ITEM_NBR,                                       00840003
008500                A.STR_NBR                                         00850003
008600         FROM TMRITST A,                                          00860003
008700              TSKST   B,                                          00870003
008800              XMT_LOC C                                           00880008
008900         WHERE A.ITEM_NBR = B.ITEM_NMBR                           00890003
009000           AND A.STR_NBR  = B.LOC_NBR                             00900008
009100           AND A.STR_NBR  = C.LOC_NBR                             00910008
009200           AND B.ONHAND_QTY < A.USERMIN_QTY                       00920003
009300           AND A.FT_CDE = 'U'                                     00930003
009400           AND C.E_BUS_IND = 'Y'                                  00940008
009500           AND LOC_TYP_CDE = 'DS'                                 00950008
009600         FOR FETCH ONLY                                           00960003
009700     END-EXEC.                                                    00970003
009800                                                                  00980003
009900 PROCEDURE DIVISION.                                              00990003
010000 M000-MAINLINE.                                                   01000003
010100                                                                  01010003
010200     PERFORM A100-INITIALIZATION.                                 01020003
010300                                                                  01030003
010400     PERFORM B100-COLLECT-OH-LT-MIN-DATA                          01040003
010500        UNTIL END-OF-OH-LT-MIN.                                   01050003
010600                                                                  01060003
010700     PERFORM C100-CLOSE.                                          01070003
010800                                                                  01080003
010900 M000-EXIT.                                                       01090003
011000     EXIT.                                                        01100003
011100     STOP RUN.                                                    01110003
011200                                                                  01120003
011300                                                                  01130003
011400 A100-INITIALIZATION.                                             01140003
011500                                                                  01150003
011600     OPEN I-O OH-LT-MIN-FILE.                                     01160003
011700                                                                  01170003
011800     IF SUCCESSFUL                                                01180003
011900         NEXT SENTENCE                                            01190003
012000     ELSE                                                         01200003
012100         OPEN OUTPUT OH-LT-MIN-FILE                               01210003
012200         IF SUCCESSFUL                                            01220003
012300             NEXT SENTENCE                                        01230003
012400         ELSE                                                     01240003
012500             DISPLAY 'OPEN UNSUCCESSFUL FOR VSAM FILE INOUT01'    01250003
012600             DISPLAY 'VSAM STATUS CODE = ' VSAM-STATUS            01260003
012700             DISPLAY 'PROGRAM = MRKUT113'                         01270003
012800             DISPLAY 'PARAGRAPH A100-INITIALIZATION'              01280003
012900             MOVE 4001 TO ABEND-CODE                              01290003
013000             CALL 'ILBOABN0'  USING ABEND-CODE                    01300003
013100         END-IF                                                   01310003
013200     END-IF.                                                      01320003
013300                                                                  01330003
013400     EXEC SQL                                                     01340003
013500         OPEN OH-LT-MIN                                           01350003
013600     END-EXEC.                                                    01360003
013700                                                                  01370003
013800     IF SQLCODE < 0                                               01380003
013900         DISPLAY 'OPEN UNSUCCESSFUL FOR OH-LT-MIN CURSOR'         01390003
014000         PERFORM U998-SQL-ERROR                                   01400003
014100     END-IF.                                                      01410003
014200                                                                  01420003
014300     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               01430003
014400           SQLWARN0 = 'W'                                         01440003
014500         DISPLAY 'OPEN WARNING FOR OH-LT-MIN CURSOR'              01450003
014600         PERFORM U999-SQL-WARNING                                 01460003
014700     END-IF.                                                      01470003
014800                                                                  01480003
014900 A100-EXIT.                                                       01490003
015000     EXIT.                                                        01500003
015100                                                                  01510003
015200                                                                  01520003
015300 B100-COLLECT-OH-LT-MIN-DATA.                                     01530003
015400                                                                  01540003
015500     PERFORM B110-FETCH-OH-LT-MIN.                                01550003
015600                                                                  01560003
015700     IF NOT-END-OF-OH-LT-MIN                                      01570003
015800                                                                  01580003
015900       MOVE MRITST-STR-NBR        TO MR113-STORE-NBR              01590003
016000                                                                  01600003
016100       MOVE MRITST-ITEM-NBR       TO MR113-ITEM-NBR               01610003
016200                                     SAVE-ITEM-NMBR               01620003
016300                                                                  01630003
016400       SET DESC-FOUND TO TRUE                                     01640003
016500                                                                  01650003
016600       PERFORM B120-SELECT-TSK                                    01660003
016700                                                                  01670003
016800       IF DESC-FOUND                                              01680003
016900         MOVE SKXREF-DEPT           TO NI-DEPT-9-3                01690003
016910         MOVE NI-DEPT-X-3           TO MR113-DEPT-NBR             01691003
017000                                                                  01700003
017100         MOVE SKXREF-SUBCLASS       TO NI-SUB-CLASS-9-2           01710003
017110         MOVE NI-SUB-CLASS-X-2      TO MR113-CLASS-NBR            01711003
017200                                                                  01720003
017300         MOVE TSK-LONG-VENDOR-STYLE TO MR113-VENDOR-STYLE         01730003
017400                                                                  01740003
017500         MOVE TSK-LONG-COLOR-DESC   TO MR113-COLOR-DESC           01750003
017600                                                                  01760003
017900         PERFORM B130-WRITE-OH-LT-MIN-RCD                         01790003
018000       END-IF                                                     01800003
018100                                                                  01810003
018200     END-IF.                                                      01820003
018300                                                                  01830003
018400 B100-EXIT.                                                       01840003
018500     EXIT.                                                        01850003
018600                                                                  01860003
018700                                                                  01870003
018800 B110-FETCH-OH-LT-MIN.                                            01880003
018900                                                                  01890003
019000     PERFORM                                                      01900003
019100         WITH TEST AFTER                                          01910003
019200         VARYING SQL-SUB                                          01920003
019300         FROM 1 BY 1                                              01930003
019400         UNTIL SQL-SUB > MAX-RETRIES                              01940003
019500            OR SQLCODE = ZERO                                     01950003
019600            OR SQLCODE = +100                                     01960003
019700         EXEC SQL                                                 01970003
019800             FETCH OH-LT-MIN                                      01980003
019900                 INTO :MRITST-ITEM-NBR,                           01990003
020000                      :MRITST-STR-NBR                             02000003
020100         END-EXEC                                                 02010003
020200         EVALUATE TRUE                                            02020003
020300             WHEN SQLCODE = ZERO                                  02030003
020400             WHEN SQLCODE = -904                                  02040003
020500             WHEN SQLCODE = -913                                  02050003
020600                 CONTINUE                                         02060003
020700             WHEN SQLCODE = +100                                  02070003
020800                 SET END-OF-OH-LT-MIN TO TRUE                     02080003
020900             WHEN SQLWARN0 NOT = SPACES                           02090003
021000             WHEN SQLCODE  NOT = ZERO                             02100003
021100                  PERFORM U998-SQL-ERROR                          02110003
021200         END-EVALUATE                                             02120003
021300     END-PERFORM.                                                 02130003
021400                                                                  02140003
021500 B110-EXIT.                                                       02150003
021600     EXIT.                                                        02160003
021700                                                                  02170003
021800                                                                  02180003
021900 B120-SELECT-TSK.                                                 02190003
022000                                                                  02200003
022010     MOVE SAVE-ITEM-NMBR        TO TSK-ITEM-NMBR.                 02201003
022100     PERFORM                                                      02210003
022200         WITH TEST AFTER                                          02220003
022300         VARYING SQL-SUB                                          02230003
022400         FROM 1 BY 1                                              02240003
022500         UNTIL SQL-SUB > MAX-RETRIES                              02250003
022600            OR SQLCODE = ZERO                                     02260003
022700            OR SQLCODE = +100                                     02270003
022800         EXEC SQL                                                 02280003
022900             SELECT B.DEPT,                                       02290003
023000                    B.SUBCLASS,                                   02300003
023100                    LONG_VENDOR_STYLE,                            02310003
023200                    LONG_COLOR_DESC                               02320003
023300             INTO  :SKXREF-DEPT,                                  02330003
023400                   :SKXREF-SUBCLASS,                              02340003
023500                   :TSK-LONG-VENDOR-STYLE,                        02350003
023600                   :TSK-LONG-COLOR-DESC                           02360003
023700             FROM TSK,                                            02370003
023710                  TSKXREF  B                                      02371003
023800             WHERE ITEM_NMBR = :TSK-ITEM-NMBR                     02380003
023810              AND  ITEM_NMBR = B.ITM_NBR                          02381003
023900         END-EXEC                                                 02390003
024000         EVALUATE TRUE                                            02400003
024100             WHEN SQLCODE = ZERO                                  02410003
024200             WHEN SQLCODE = -904                                  02420003
024300             WHEN SQLCODE = -913                                  02430003
024400                 CONTINUE                                         02440003
024500             WHEN SQLCODE = +100                                  02450003
024600                 SET DESC-NOT-FOUND TO TRUE                       02460003
024700             WHEN SQLWARN0 NOT = SPACES                           02470003
024800             WHEN SQLCODE  NOT = ZERO                             02480003
024900                  PERFORM U998-SQL-ERROR                          02490003
025000         END-EVALUATE                                             02500003
025100     END-PERFORM.                                                 02510003
025200                                                                  02520003
025300 B120-EXIT.                                                       02530003
025400     EXIT.                                                        02540003
025500                                                                  02550003
025600                                                                  02560003
025700 B130-WRITE-OH-LT-MIN-RCD.                                        02570003
025800                                                                  02580003
025900     WRITE MR113-OH-LT-MIN-RECORD.                                02590004
026100                                                                  02610003
026200     IF SUCCESSFUL                                                02620003
026300         ADD 1 TO RCDS-WRITTEN                                    02630003
026400     ELSE                                                         02640003
026500         IF DUPLICATE-KEY                                         02650003
026600            CONTINUE                                              02660003
026700         ELSE                                                     02670003
026800             DISPLAY 'WRITE UNSUCCESSFUL FOR VSAM FILE INOUT01'   02680003
026900             DISPLAY 'VSAM STATUS CODE = ' VSAM-STATUS            02690003
027000             DISPLAY 'VSAM KEY = ' MR113-OH-LT-MIN-KEY            02700003
027100             DISPLAY 'PROGRAM = MRKUT113'                         02710003
027200             DISPLAY 'PARAGRAPH B130-WRITE-OH-LT-MIN-RCD'         02720003
027300             MOVE 4001 TO ABEND-CODE                              02730008
027400             CALL 'ILBOABN0'  USING ABEND-CODE                    02740003
027500         END-IF                                                   02750003
027600     END-IF.                                                      02760003
027700                                                                  02770003
027800 B130-EXIT.                                                       02780003
027900     EXIT.                                                        02790003
028000                                                                  02800003
028100                                                                  02810003
028200 C100-CLOSE.                                                      02820003
028300                                                                  02830003
028400     CLOSE OH-LT-MIN-FILE.                                        02840003
028500                                                                  02850003
028600     IF SUCCESSFUL                                                02860003
028800         NEXT SENTENCE                                            02880003
028900     ELSE                                                         02890003
029000         DISPLAY 'CLOSE UNSUCCESSFUL FOR VSAM FILE INOUT01'       02900003
029100         DISPLAY 'VSAM STATUS CODE = ' VSAM-STATUS                02910003
029200         DISPLAY 'PROGRAM = MRKUT113'                             02920003
029300         DISPLAY 'PARAGRAPH C100-CLOSE'                           02930003
029400         MOVE 4004 TO ABEND-CODE                                  02940003
029500         CALL 'ILBOABN0'  USING ABEND-CODE                        02950003
029600     END-IF.                                                      02960003
029700                                                                  02970003
029800     MOVE RCDS-WRITTEN TO DISPLAY-RCDS-WRITTEN.                   02980003
029900                                                                  02990003
030000     DISPLAY '*******************************************'.       03000003
030100     DISPLAY '*  TOTAL RCDS WRITTEN:  ' DISPLAY-RCDS-WRITTEN.     03010003
030200     DISPLAY '*******************************************'.       03020003
030300                                                                  03030003
030400     EXEC SQL                                                     03040003
030500         CLOSE OH-LT-MIN                                          03050003
030600     END-EXEC.                                                    03060003
030700                                                                  03070003
030800     IF SQLCODE < 0                                               03080003
030900         DISPLAY 'CLOSE UNSUCCESSFUL FOR OH-LT-MIN CURSOR'        03090003
031000         PERFORM U998-SQL-ERROR                                   03100003
031100     END-IF.                                                      03110003
031200                                                                  03120003
031300     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               03130003
031400           SQLWARN0 = 'W'                                         03140003
031500         DISPLAY 'CLOSE WARNING FOR OH-LT-MIN CURSOR'             03150003
031600         PERFORM U999-SQL-WARNING                                 03160003
031700     END-IF.                                                      03170003
031800                                                                  03180003
031900 C100-EXIT.                                                       03190003
032000     EXIT.                                                        03200003
032100                                                                  03210003
032200                                                                  03220003
032300 U998-SQL-ERROR.                                                  03230003
032400                                                                  03240003
032500     MOVE SQLCODE    TO SQLCODE2.                                 03250003
032600     MOVE SQLERRD(3) TO SQLERRD3.                                 03260003
032700     DISPLAY '** ABEND **       ** = SQLWARNING'.                 03270003
032800     DISPLAY '** PROGRAM        ** = MRKUT113'.                   03280003
032900     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  03290003
033000     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  03300003
033100     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   03310003
033200     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  03320003
033300                                                                  03330003
033400     MOVE 4013 TO ABEND-CODE.                                     03340003
033500     CALL 'ILBOABN0' USING ABEND-CODE.                            03350003
033600                                                                  03360003
033700 U998-EXIT.                                                       03370003
033800     EXIT.                                                        03380003
033900                                                                  03390003
034000                                                                  03400003
034100 U999-SQL-WARNING.                                                03410003
034200                                                                  03420003
034300     MOVE SQLCODE    TO SQLCODE2.                                 03430003
034400     MOVE SQLERRD(3) TO SQLERRD3.                                 03440003
034500     DISPLAY '** ABEND **       ** = SQLWARNING'.                 03450003
034600     DISPLAY '** PROGRAM        ** = MRKUT113'.                   03460003
034700     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  03470003
034800     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  03480003
034900     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  03490003
035000     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  03500003
035100     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  03510003
035200     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  03520003
035300     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  03530003
035400     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  03540003
035500     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  03550003
035600     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  03560003
035700                                                                  03570003
035800     MOVE 4013 TO ABEND-CODE.                                     03580003
035900     CALL 'ILBOABN0' USING ABEND-CODE.                            03590003
