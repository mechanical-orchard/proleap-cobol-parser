000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.                PCKCS150.                             00050001
000600 AUTHOR.                    BETH A. BILSKI.                       00060001
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070001
000800 DATE-WRITTEN.              12-15-93.                             00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110001
001200*  CICS PROGRAM - PCKCS150 - E150                                *00120001
001300*                                                                *00130001
001400*       MERCHANDISING SYSTEM - SKU MAINTENANCE                   *00140001
001500*                                                                *00150001
001600*       THIS PROGRAM SHOWS THE AVAILABLE PATHS TO ACCESS         *00160001
001700*  INFORMATION WITHIN THE WORK ORDER SYSTEM.                     *00170001
001800*                                                                *00180001
001900*                                                                *00190001
002000*       THE FOLLOWING PF KEYS FUNCTIONS ARE AVAILABLE:           *00200001
002100*                                                                *00210001
002200*         WO LIST                                                *00220001
002300*         RCP ITEM LIST                                          *00230001
002400*         RCV LIST                                               *00240001
002500*         WOI LIST                                               *00250001
002600*                                                                *00260001
002700*       DIRECT ENTRY INTO THIS TRANSACTION IS PROHIBITED.        *00270001
002800*  ATTEMPTING TO DO THIS RESULTS IN AN XCTL TO THE COMMON LOGON  *00280001
002900*  TRANSACTION FOR THIS SYSTEM, TO ACQUIRE THE SECURITY          *00290001
003000*  INFORMATION, AND POSITION THE USER INTO THE CORRECT MENU      *00300001
003100*  STRUCTURE FOR HIS/HER SECURITY LEVEL.                         *00310001
003200******************************************************************00320001
003210*  CHANGED 10/13/2014    BY COGNIZANT       WR: CHG0094517        00321005
003220*                                                                 00322006
003230* EXTENDED PO# FROM 7 TO 8 DIGITS WHERE NEEDED.                   00323006
003240*-----------------------------------------------------------------00324006
003250* DATE  11/04/2021                                                00325007
003260*            - CHANGE CALL OF 'DPKUT100' TO                     * 00326007
003270*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00327007
003280*              MAKING THE CALL DYNAMIC VS STATIC                * 00328007
003290*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00329008
1122RM*---------------------------------------------------------------- 00329109
1122RM* DATE  11/07/2022                                              * 00329209
1122RM*            - ADD COPYBOOK DPWS930                             * 00329309
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00329409
1122RM*              DYNAMIC.                                         * 00329509
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00329609
003291*-----------------------------------------------------------------00329707
003300                                                                  00330001
003400******************************************************************00340001
003500 ENVIRONMENT DIVISION.                                            00350001
003600******************************************************************00360001
003700                                                                  00370001
003800******************************************************************00380001
003900 DATA DIVISION.                                                   00390001
004000******************************************************************00400001
004100                                                                  00410001
004200 WORKING-STORAGE SECTION.                                         00420001
004300                                                                  00430001
004400*                                                                 00440001
004500*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 00450001
004600*                                                                 00460001
004700                                                                  00470001
004800     COPY DPWS010I.                                               00480001
004900                                                                  00490001
005000******************************************************************00500001
005100*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00510001
005200     COPY DPWS013.                                                00520001
005300*                                                                 00530001
005400******************************************************************00540001
005500*  CICS ATTRIBUTES COPYBOOK                                       00550001
005600     COPY DPWS015.                                                00560001
005700*                                                                 00570001
005800******************************************************************00580001
005900*  FUNCTION KEYS COPYBOOK                                         00590001
006000     COPY DPWS016.                                                00600001
006100*                                                                 00610001
006200******************************************************************00620001
006300*  STANDARD ATTENTION IDENTIFIER LIST                             00630001
006400*                                                                 00640001
006500                                                                  00650001
006600     COPY DFHAID.                                                 00660001
006700                                                                  00670001
006800*                                                                 00680001
006900*  STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST          00690001
007000*                                                                 00700001
007100                                                                  00710001
007200     COPY DFHBMSCA.                                               00720001
007300                                                                  00730001
007400*                                                                 00740001
007500*  DSECT FOR THE PCKM150 MAPSET                                   00750001
007600*                                                                 00760001
007700                                                                  00770001
007800     COPY PCKM150.                                                00780001
007900                                                                  00790001
008000                                                                  00800001
008100 01  DK-DB2-KEYS.                                                 00810001
008200     05  DK-OPER-UNT-ID                 PIC S9(04)  COMP VALUE +0.00820001
008300     05  DK-FCLTY-ID                    PIC S9(04)  COMP VALUE +0.00830001
008400     05  DK-STORE-NMBR                  PIC S9(04)  COMP VALUE +0.00840002
008700                                                                  00870001
008800 01  PS-PROGRAM-SWITCHES.                                         00880001
008900     05  PS-EDIT-ERROR-IND       PIC X(1)     VALUE 'N'.          00890001
009000         88  PS-NO-EDIT-ERROR                 VALUE 'N'.          00900001
009100         88  PS-EDIT-ERROR                    VALUE 'Y'.          00910001
009200                                                                  00920001
009300 01  PC-PROGRAM-CONSTANTS.                                        00930001
009400     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'PCKCS150'.   00940001
009500     05  PC-CURRENT-MAPSET-NAME  PIC X(08)    VALUE 'PCKM150'.    00950001
009600     05  PC-CURRENT-MAP-NAME     PIC X(08)    VALUE 'PC150A'.     00960001
009700     05  PC-DPKCS030             PIC X(08)    VALUE 'DPKCS030'.   00970001
009800     05  PC-MAX-RETRIES          PIC S9(4)    VALUE +2.           00980001
009900     05  PC-KOHLS-OPERATING-COMPANY                               00990001
010000                                 PIC X(2)     VALUE '03'.         01000001
010100     05  PC-EOF-KEYED-COMP       PIC S9(4)    VALUE +128          01010001
010200                                 COMP SYNC.                       01020001
010300     05  FILLER                  REDEFINES PC-EOF-KEYED-COMP.     01030001
010400         10  FILLER              PIC X(1).                        01040001
010500         10  PC-EOF-KEYED        PIC X(1).                        01050001
010600     05  PC-CLEAR                PIC X(03)    VALUE 'CLR'.        01060001
010700                                                                  01070001
010800 01  PC-TSYMSG-AREA.                                              01080001
010900*  INVALID ENTRY 00005                                            01090001
011000     05  PC-TSYMSG-00005      PIC 9(5) VALUE 00005.               01100001
011100*  REQUIRED ENTRY 00007                                           01110001
011200     05  PC-TSYMSG-00007      PIC 9(5) VALUE 00007.               01120001
011300*  MUST BE NUMBERIC                                               01130001
011400     05  PC-TSYMSG-00008      PIC 9(5) VALUE 00008.               01140001
011500*  PURCHASE ORDER DOES NOT EXIST 00083                            01150001
011600     05  PC-TSYMSG-00083      PIC 9(5) VALUE 00083.               01160001
011700                                                                  01170001
011800 01  PV-PROGRAM-VARIABLES.                                        01180001
011900     05  PV-SQL-SUB              PIC S9(04)   COMP VALUE +0.      01190001
012000     05  PV-TRANSFER-PROGRAM     PIC X(8)     VALUE SPACES.       01200001
012100     05  PV-LEAVE-SYSTEM-MESSAGE PIC X(400)   VALUE SPACES.       01210001
012200     05  PV-CICS-RESPONSE        PIC S9(9)    VALUE ZERO          01220001
012300                                 COMP SYNC.                       01230001
012400     05  PV-RETRY-COUNT          PIC S9(4)    VALUE ZERO          01240001
012500                                 COMP SYNC.                       01250001
012600     05  PV-CURRENT-YEAR         PIC S9(9)    VALUE ZERO          01260001
012700                                 COMP SYNC.                       01270001
012800     05  PV-KEY-FEEDBACK-AREA    PIC X(11)    VALUE SPACES.       01280001
012900     05  PV-MESSAGE-NBR          PIC 9(05)    VALUE ZEROES.       01290001
013000     05  PV-DEPT-NMBR            PIC X(03)    VALUE SPACES.       01300001
013800                                                                  01380001
013900 01  RF-ROLLBACK-FAILURE-MESSAGE.                                 01390001
014000     05  FILLER                  PIC X(5)     VALUE SPACES.       01400001
014100     05  FILLER                  PIC X(61)    VALUE               01410001
014200     '**  THE ATTEMPTED ROLLBACK FAILED  **'.                     01420001
014300     05  FILLER                  PIC X(10)    VALUE 'EIBRESP = '. 01430001
014400     05  RF-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.         01440001
014500                                                                  01450001
014600 01  IC-ISO-CURRENT-DATE-AREA.                                    01460001
014700     05  IC-ISO-CURRENT-DATE-X.                                   01470001
014800         10  IC-CURRENT-YEAR     PIC 9(4)     VALUE ZERO.         01480001
014900         10  FILLER              PIC X(6)     VALUE SPACES.       01490001
015000     05  FILLER                  REDEFINES IC-ISO-CURRENT-DATE-X. 01500001
015100         10  FILLER              PIC X(2).                        01510001
015200         10  IC-CURRENT-YY-MM-DD PIC X(8).                        01520001
015300     05  IC-ISO-CURRENT-DATE     REDEFINES IC-ISO-CURRENT-DATE-X  01530001
015400                                 PIC X(10).                       01540001
015500                                                                  01550001
015600 01  SE-SYSTEM-ERROR-MESSAGE.                                     01560001
015700     05  FILLER                  PIC X(51)    VALUE               01570001
015800         'A SYSTEM ERROR HAS OCCURRED - CONTACT DP - PROGRAM '.   01580001
015900     05  SE-CURRENT-PROGRAM-NAME PIC X(8)     VALUE SPACES.       01590001
016000     05  FILLER                  PIC X(7)     VALUE SPACES.       01600001
016100     05  FILLER                  PIC X(10)    VALUE 'EIBRESP = '. 01610001
016200     05  SE-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.         01620001
016300     05  FILLER                  PIC X(5)     VALUE SPACES.       01630001
016400     05  FILLER                  PIC X(14)    VALUE               01640001
016500         'ATTEMPTING TO '.                                        01650001
016600     05  SE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       01660001
016700                                                                  01670001
016800 01  DRU-DB2-RESOURCE-UNAVAIL-MSG.                                01680001
016900     05  FILLER                  PIC X(85)    VALUE               01690001
017000         'A RESOURCE WAS NOT AVAILABLE.  PLEASE TRY AGAIN.'.      01700001
017100     05  FILLER                  PIC X(45)    VALUE               01710001
017200         'IF THE PROBLEM PERSISTS, CONTACT DP (PROGRAM '.         01720001
017300     05  DRU-CURRENT-PROGRAM-NAME                                 01730001
017400                                 PIC X(8)     VALUE SPACES.       01740001
017500     05  FILLER                  PIC X(22)    VALUE ').'.         01750001
017600                                                                  01760001
017700 01  DE-DB2-ERROR-MESSAGE.                                        01770001
017800     05  FILLER                  PIC X(48)    VALUE               01780001
017900         'A DB2 ERROR HAS OCCURRED - CONTACT DP - PROGRAM '.      01790001
018000     05  DE-CURRENT-PROGRAM-NAME PIC X(8)     VALUE SPACES.       01800001
018100     05  FILLER                  PIC X(29)    VALUE SPACES.       01810001
018200     05  FILLER                  PIC X(11)    VALUE               01820001
018300         'SQLCODE = ('.                                           01830001
018400     05  DE-SQLCODE              PIC Z(8)9-   VALUE ZERO.         01840001
018500     05  FILLER                  PIC X(21)    VALUE               01850001
018600         ')  ROWS PROCESSED = ('.                                 01860001
018700     05  DE-ROWS-PROCESSED       PIC Z(8)9-   VALUE ZERO.         01870001
018800     05  FILLER                  PIC X(23)    VALUE ')'.          01880001
018900     05  FILLER                  PIC X(5)     VALUE SPACES.       01890001
019000     05  FILLER                  PIC X(14)    VALUE               01900001
019100         'ATTEMPTING TO '.                                        01910001
019200     05  DE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       01920001
019300                                                                  01930001
019400 01  DW-DB2-WARNING-MESSAGE.                                      01940001
019500     05  FILLER                  PIC X(50)    VALUE               01950001
019600         'A DB2 WARNING HAS OCCURRED - CONTACT DP - PROGRAM '.    01960001
019700     05  DW-CURRENT-PROGRAM-NAME PIC X(8)     VALUE SPACES.       01970001
019800     05  FILLER                  PIC X(27)    VALUE SPACES.       01980001
019900     05  FILLER                  PIC X(11)    VALUE               01990001
020000         'SQLCODE = ('.                                           02000001
020100     05  DW-SQLCODE              PIC Z(8)9-   VALUE ZERO.         02010001
020200     05  FILLER                  PIC X(21)    VALUE               02020001
020300         ')  ROWS PROCESSED = ('.                                 02030001
020400     05  DW-ROWS-PROCESSED       PIC Z(8)9-   VALUE ZERO.         02040001
020500     05  FILLER                  PIC X(14)    VALUE               02050001
020600         ')  SQLWARN = ('.                                        02060001
020700     05  DW-SQLWARN              PIC X(8)     VALUE SPACES.       02070001
020800     05  FILLER                  PIC X(1)     VALUE ')'.          02080001
020900     05  FILLER                  PIC X(5)     VALUE SPACES.       02090001
021000     05  FILLER                  PIC X(14)    VALUE               02100001
021100         'ATTEMPTING TO '.                                        02110001
021200     05  DW-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       02120001
021300                                                                  02130001
021400 01  ST-SYSTEM-TIME-AREA.                                         02140001
021500     05  ST-ABSTIME              PIC S9(18)   VALUE ZERO          02150001
021600                                 COMP SYNC.                       02160001
021700     05  ST-TIME-EDIT.                                            02170001
021800         10  ST-TIME-HHMM        PIC X(5)     VALUE SPACES.       02180001
021900         10  FILLER              PIC X(3)     VALUE SPACES.       02190001
022000                                                                  02200001
022100******************************************************************02210001
022200*    STANDARD COMMAREA DEFINITION                                 02220001
022300******************************************************************02230001
022400     COPY DPWS030.                                                02240001
1122RM     COPY DPWS930.                                                02241009
022500     COPY DPWS020.                                                02250001
022600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02260001
022700                                                                  02270001
022800*----------------------------------------------------------------*02280001
022900* INTER-APPLICATION COMMAREA.                                    *02290001
023000*----------------------------------------------------------------*02300001
023100                                                                  02310001
023200         10  INTER-APPL-COMM-AREA       PIC X(200).               02320001
023300     COPY PCWS000.                                                02330001
023400*-------------------------------------------------------------*   02340001
023500*    INTER-APPLICATION COMMAREA                               *   02350001
023600*-------------------------------------------------------------*   02360001
023700         10  ASC-PGM-SPECIFIC-COMMAREA.                           02370001
023800             15  ASC-OPER-UNT-ID           PIC X(04).             02380001
023900             15  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID      02390001
024000                                           PIC 9(04).             02400001
024100             15  ASC-FCLTY-ID              PIC X(04).             02410001
024200             15  ASC-FCLTY-ID-N    REDEFINES ASC-FCLTY-ID         02420001
024300                                           PIC 9(04).             02430001
024400             15  ASC-FCLTY-NME             PIC X(24).             02440001
024500             15  ASC-PO-NBR.                                      02450001
024600                 20  ASC-PO-NBR-N          PIC 9(08).             02460006
024700             15  ASC-SEQ-NBR.                                     02470001
024800                 20  ASC-SEQ-NBR-N         PIC 9(3).              02480001
024900             15  ASC-LINE-NBR-X            PIC X(04).             02490001
025000             15  ASC-LINE-NBR-N            PIC 9(04).             02500001
025100             15  ASC-WO-NBR.                                      02510001
025200                 20  ASC-WO-NBR-N          PIC 9(4).              02520001
025300             15  ASC-STATUS                PIC X(02).             02530001
025400             15  ASC-HOLD-INTER-APPL       PIC X(200).            02540001
025500                                                                  02550001
025600******************************************************************02560001
025700*                                                                 02570001
025800*  SQL AND COBOL DECLARATIONS FOR THE WORK ORDER TABLE (TWRKORD)  02580001
025900*                                                                 02590001
026000                                                                  02600001
026100     EXEC SQL                                                     02610001
026200         INCLUDE TWRKORD                                          02620001
026300     END-EXEC.                                                    02630001
026400                                                                  02640001
026500*                                                                 02650001
026600*  SQL AND COBOL DECLARATIONS FOR THE WORK ORDER INSTRUCTION      02660001
026700*  TABLE (TWKORIN)                                                02670001
026800*                                                                 02680001
026900                                                                  02690001
027000     EXEC SQL                                                     02700001
027100         INCLUDE TWKORIN                                          02710001
027200     END-EXEC.                                                    02720001
027300                                                                  02730001
027400*                                                                 02740001
027500*  SQL AND COBOL DECLARATIONS FOR THE RECEIVER TABLE (TRECEIV)    02750001
027600*                                                                 02760001
027700                                                                  02770001
027800     EXEC SQL                                                     02780001
027900         INCLUDE TRECEIV                                          02790001
028000     END-EXEC.                                                    02800001
028100*                                                                 02810001
028200*  SQL AND COBOL DECLARATIONS FOR THE LOGISTICS DOMAIN LOCATION   02820002
028210*  MASTER TABLE                                                   02821002
028300*                                                                 02830001
028400                                                                  02840001
028500     EXEC SQL                                                     02850001
028600         INCLUDE XLT00010                                         02860002
028700     END-EXEC.                                                    02870001
029500*                                                                 02950001
029600*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                02960001
029700*                                                                 02970001
029800                                                                  02980001
029900     EXEC SQL                                                     02990001
030000         INCLUDE SQLCA                                            03000001
030100     END-EXEC.                                                    03010001
030200                                                                  03020001
030300******************************************************************03030001
030400 LINKAGE SECTION.                                                 03040001
030500******************************************************************03050001
030600 01  DFHCOMMAREA.                                                 03060001
030700     05  FILLER                       OCCURS 1 TO 4072 TIMES      03070001
030800                                      DEPENDING ON EIBCALEN.      03080001
030900         10  FILLER                   PIC X.                      03090001
031000******************************************************************03100001
031100 PROCEDURE DIVISION.                                              03110001
031200******************************************************************03120001
031300                                                                  03130001
031400 0000-MAIN-MODULE.                                                03140001
031500     INITIALIZE DP030-CICS-API-FIELDS.                            03150001
031600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03160001
031700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03170001
031800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03180001
031900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03190001
032000     MOVE LENGTH OF PC150AI        TO DP030-MAP-LENGTH (1).       03200001
032100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03210001
032200     PERFORM 0001-CALL-CICS-ARCH-API.                             03220001
032300*                                                                 03230001
032400     PERFORM 1000-CONTROL-PROCESSING                              03240001
032500*                                                                 03250001
032600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03260001
032700     PERFORM 0001-CALL-CICS-ARCH-API.                             03270001
032800                                                                  03280001
032900 0001-CALL-CICS-ARCH-API.                                         03290001
1122RM*    CALL PC-DPKCS030 USING DFHEIBLK                              03300009
1122RM     CALL DP930-CICS-ARCH-API                                     03301009
1122RM                     USING DFHEIBLK                               03302009
033100                            DFHCOMMAREA                           03310001
033200                            DP030-CICS-API-FIELDS                 03320001
033300                            DP020-STANDARD-COMMAREA               03330001
033400                            PC150AI.                              03340001
033500*                                                                 03350001
033600     IF  DP030-RC-CALL-SUCCESSFUL                                 03360001
033700         CONTINUE                                                 03370001
033800     ELSE                                                         03380001
033900         SET DP013-NO-ROLLBACK                                    03390001
034000             DP013-XCTL-DISPLAY-RESTART                           03400001
034100             DP013-CICS-ABEND      TO TRUE                        03410001
034200         MOVE 'BEFORE 0000-MAIN-MODULE'                           03420001
034300                                   TO DP013-PARAGRAPH             03430001
1122RM*        MOVE 'CALL TO PCKCS150 NOT SUCCESSFUL, RETURN-CODE ON NEX03440009
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      03450009
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03451009
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03452009
034600         MOVE DP030-RETURN-CODE                                   03460001
034700                                   TO DP013-MESSAGE-TEXT (3)      03470001
034800         PERFORM DP013-0000-PROCESS-ABEND                         03480001
034900     END-IF.                                                      03490001
035000 EJECT                                                            03500001
035100*----------------------------------------------------------------*03510001
035200*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03520001
035300*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03530001
035400*----------------------------------------------------------------*03540001
035500                                                                  03550001
035600 1000-CONTROL-PROCESSING.                                         03560001
035700                                                                  03570001
035800     EVALUATE TRUE                                                03580001
035900         WHEN DP020-NEXT-ACT-INITIAL                              03590001
036000             MOVE INTER-APPL-COMM-AREA  TO ASC-HOLD-INTER-APPL    03600001
036100         WHEN OTHER                                               03610001
036200             MOVE ASC-HOLD-INTER-APPL   TO INTER-APPL-COMM-AREA   03620001
036300     END-EVALUATE.                                                03630001
036400                                                                  03640001
036500     EVALUATE TRUE                                                03650001
036600         WHEN DP020-NEXT-ACT-INITIAL                              03660001
036700*            INITIALIZE PC000-INTER-APPL-COMMAREA                 03670001
036800             INITIALIZE ASC-PGM-SPECIFIC-COMMAREA                 03680001
036900             MOVE DP020-LOCATION-NBR                              03690002
036910                                 TO ASC-OPER-UNT-ID               03691002
037000             MOVE DP020-FCLTY-ID TO ASC-FCLTY-ID                  03700001
037200*            MOVE 0001           TO ASC-FCLTY-ID                  03720001
037300             PERFORM 3200-RESET-ATTRIBUTES                        03730001
037400             PERFORM 4000-BUILD-INITIAL-PANEL                     03740001
037500                                                                  03750001
037600         WHEN DP020-NEXT-ACT-READ-MAP                             03760001
037700             PERFORM 2000-FKEY-PROCESSING                         03770001
037800                                                                  03780001
037900         WHEN DP020-NEXT-ACT-RETURN                               03790001
038000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03800001
038100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03810001
038200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  03820001
038300             MOVE -1      TO APONBRL                              03830001
038400                                                                  03840001
038500         WHEN OTHER                                               03850001
038600             SET DP013-LOGIC-ABEND                                03860001
038700                 DP013-NO-ROLLBACK TO TRUE                        03870001
038800             MOVE '1000-CONTROL-PROCESSING'                       03880001
038900                                   TO  DP013-PARAGRAPH            03890001
039000             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03900001
039100                                   TO  DP013-MESSAGE-TEXT(1)      03910001
039200             MOVE DP020-NEXT-APPL-ACTIVITY                        03920001
039300                                   TO DP013-MESSAGE-TEXT(2)       03930001
039400             PERFORM DP013-0000-PROCESS-ABEND                     03940001
039500     END-EVALUATE.                                                03950001
039600                                                                  03960001
039700*----------------------------------------------------------------*03970001
039800* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*03980001
039900* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*03990001
040000* EDITS.                                                         *04000001
040100*----------------------------------------------------------------*04010001
040200                                                                  04020001
040300 2000-FKEY-PROCESSING.                                            04030001
040400                                                                  04040001
040500     EVALUATE TRUE                                                04050001
040600                                                                  04060001
040700         WHEN DP020-SRC-AID = DP016-CLEAR                         04070001
040800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04080001
040900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04090001
041000                                                                  04100001
041100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04110001
041200             PERFORM 4000-BUILD-INITIAL-PANEL                     04120001
041300             PERFORM 3200-RESET-ATTRIBUTES                        04130001
041400                                                                  04140001
041500         WHEN OTHER                                               04150001
041600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04160001
041700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04170001
041800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04180001
041900             IF  PS-NO-EDIT-ERROR                                 04190001
042000                 SET DP030-CONTINUE-GO TO TRUE                    04200001
042100                 MOVE -1      TO APONBRL                          04210001
042200*                PERFORM 2100-CHECK-FUNCTION-KEY                  04220001
042300             ELSE                                                 04230001
042400                 SET DP030-OVERRIDE-GO TO TRUE                    04240001
042500             END-IF                                               04250001
042600     END-EVALUATE.                                                04260001
042700******************************************************************04270001
042800* BAB - PERFORM THIS PARAGRAPH AFTER ALL THE EDITS HAVE           04280001
042900*       BEEN MADE AND THEN CHECK THE INT-APPL-FORMAT-IND          04290001
043000*       TO SEE WHAT PF KEY HAS BEEN SELECTED.                     04300001
043100*                                                                 04310001
043200*                                                                 04320001
043300** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **04330001
043400** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **04340001
043500** FROM THE CICS ARCHITECTURE API.                              **04350001
043600******************************************************************04360001
043700 2100-CHECK-FUNCTION-KEY.                                         04370001
043800     EVALUATE TRUE                                                04380001
043900         WHEN DP020-SRC-AID = DP016-ENTER                         04390001
044000         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 04400001
044100         MOVE -1      TO APONBRL                                  04410001
044200*            CONTINUE                                             04420001
044300                                                                  04430001
044400         WHEN OTHER                                               04440001
044500             SET DP013-NO-ROLLBACK                                04450001
044600                 DP013-XCTL-DISPLAY-RESTART                       04460001
044700                 DP013-CICS-ABEND  TO TRUE                        04470001
044800             MOVE '2100-CHECK-FUNCTION-KEY'                       04480001
044900                                   TO DP013-PARAGRAPH             04490001
045000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04500001
045100                                   TO DP013-MESSAGE-TEXT (1)      04510001
045200             PERFORM DP013-0000-PROCESS-ABEND                     04520001
045300     END-EVALUATE.                                                04530001
045400 EJECT                                                            04540001
045500*----------------------------------------------------------------*04550001
045600* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*04560001
045700* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *04570001
045800* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *04580001
045900*----------------------------------------------------------------*04590001
046000                                                                  04600001
046100 2200-MOVE-SCREEN-TO-COMMAREA.                                    04610001
046200                                                                  04620001
046300     IF  AOPRIDL > ZERO                                           04630001
046400         MOVE AOPRIDI              TO ASC-OPER-UNT-ID             04640001
046500     ELSE                                                         04650001
046600         IF  AOPRIDF = DP015-ERASE-EOF                            04660001
046700             MOVE SPACE            TO ASC-OPER-UNT-ID             04670001
046800         END-IF                                                   04680001
046900     END-IF.                                                      04690001
047000                                                                  04700001
047100     IF  AFACIDL > ZERO                                           04710001
047200         MOVE AFACIDI              TO ASC-FCLTY-ID                04720001
047300     ELSE                                                         04730001
047400         IF  AFACIDF = DP015-ERASE-EOF                            04740001
047500             MOVE SPACE            TO ASC-FCLTY-ID                04750001
047600         END-IF                                                   04760001
047700     END-IF.                                                      04770001
047800                                                                  04780001
047900     IF  APONBRL > ZERO                                           04790001
048000         MOVE APONBRI              TO ASC-PO-NBR                  04800001
048100     ELSE                                                         04810001
048200         IF  APONBRF = DP015-ERASE-EOF                            04820001
048300             MOVE SPACE            TO ASC-PO-NBR                  04830001
048400         END-IF                                                   04840001
048500     END-IF.                                                      04850001
048600                                                                  04860001
048700     IF  ARCSEQL > ZERO                                           04870001
048800         MOVE ARCSEQI              TO ASC-SEQ-NBR                 04880001
048900     ELSE                                                         04890001
049000         IF  ARCSEQF = DP015-ERASE-EOF                            04900001
049100             MOVE SPACE            TO ASC-SEQ-NBR                 04910001
049200         END-IF                                                   04920001
049300     END-IF.                                                      04930001
049400                                                                  04940001
049500     IF  ALNNBRL > ZERO                                           04950001
049600         MOVE ALNNBRI              TO ASC-LINE-NBR-N              04960001
049700                                      ASC-LINE-NBR-X              04970001
049800     ELSE                                                         04980001
049900         IF  ASC-LINE-NBR-N > 0                                   04990001
050000             IF  ALNNBRF = DP015-ERASE-EOF                        05000001
050100                 MOVE SPACE        TO ASC-LINE-NBR-X              05010001
050200                 MOVE ZEROES       TO ASC-LINE-NBR-N              05020001
050300             END-IF                                               05030001
050400         ELSE                                                     05040001
050500             MOVE SPACE            TO ASC-LINE-NBR-X              05050001
050600             MOVE ZEROES           TO ASC-LINE-NBR-N              05060001
050700         END-IF                                                   05070001
050800     END-IF.                                                      05080001
050900                                                                  05090001
051000     IF  AWONBRL > ZERO                                           05100001
051100         MOVE AWONBRI              TO ASC-WO-NBR                  05110001
051200     ELSE                                                         05120001
051300         IF  AWONBRF = DP015-ERASE-EOF                            05130001
051400             MOVE SPACE            TO ASC-WO-NBR                  05140001
051500         END-IF                                                   05150001
051600     END-IF.                                                      05160001
051700                                                                  05170001
051800     IF  ARSTATL > ZERO                                           05180001
051900         MOVE ARSTATI              TO ASC-STATUS                  05190001
052000     ELSE                                                         05200001
052100         IF  ARSTATF = DP015-ERASE-EOF                            05210001
052200             MOVE SPACE            TO ASC-STATUS                  05220001
052300         END-IF                                                   05230001
052400     END-IF.                                                      05240001
052500                                                                  05250001
052600/                                                                 05260001
052700*----------------------------------------------------------------*05270001
052800* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *05280001
052900* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *05290001
053000* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*05300001
053100* IN THE DESTINATION PROGRAM, NOT HERE.                          *05310001
053200*----------------------------------------------------------------*05320001
053300                                                                  05330001
053400 3000-EDIT-DATA-IN-COMMAREA.                                      05340001
053500                                                                  05350001
053600     PERFORM 3200-RESET-ATTRIBUTES.                               05360001
053700                                                                  05370001
053800     IF  ASC-OPER-UNT-ID  > SPACE                                 05380001
053900         MOVE ASC-OPER-UNT-ID      TO DP010I-UNEDITED-FIELD       05390001
054000         MOVE LENGTH OF ASC-OPER-UNT-ID  TO DP010I-MAXIMUM-DIGITS 05400001
054100         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     05410001
054200         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  05420001
054310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         05431006
054320                         USING DP010I-NUMERIC-EDIT-AREA           05432006
054400         IF  DP010I-ERROR-DETECTED                                05440001
054500             SET PS-EDIT-ERROR                                    05450001
054600                 DP020-MSG-FATAL   TO TRUE                        05460001
054700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            05470001
054800             MOVE DP015-UNP-ALP-BRT-OFF                           05480001
054900                                   TO AOPRIDA                     05490001
055000             MOVE DP015-RED        TO AOPRIDC                     05500001
055100             MOVE DP015-REVERSE    TO AOPRIDH                     05510001
055200             MOVE -1               TO AOPRIDL                     05520001
055300             MOVE SPACES           TO ASC-FCLTY-NME               05530001
055400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05540001
055500         ELSE                                                     05550001
055600             MOVE DP010I-NUMERIC-FIELD                            05560001
055700                                   TO ASC-OPER-UNT-ID-N           05570001
055800                                      DK-OPER-UNT-ID              05580001
055900         END-IF                                                   05590001
057100     END-IF.                                                      05710001
057200                                                                  05720001
057300     IF  ASC-FCLTY-ID     > SPACE                                 05730001
057400         MOVE ASC-FCLTY-ID         TO DP010I-UNEDITED-FIELD       05740001
057500         MOVE LENGTH OF ASC-FCLTY-ID     TO DP010I-MAXIMUM-DIGITS 05750001
057600         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     05760001
057700         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  05770001
057810         CALL DP010I-NUMERIC-EDIT-ROUTINE                         05781006
057820                         USING DP010I-NUMERIC-EDIT-AREA           05782006
057900         IF  DP010I-ERROR-DETECTED                                05790001
058000             SET PS-EDIT-ERROR                                    05800001
058100                 DP020-MSG-FATAL   TO TRUE                        05810001
058200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            05820001
058300             MOVE DP015-UNP-ALP-BRT-OFF                           05830001
058400                                   TO AFACIDA                     05840001
058500             MOVE DP015-RED        TO AFACIDC                     05850001
058600             MOVE DP015-REVERSE    TO AFACIDH                     05860001
058700             MOVE -1               TO AFACIDL                     05870001
058800             MOVE SPACES           TO ASC-FCLTY-NME               05880001
058900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05890001
059000         ELSE                                                     05900001
059100             MOVE DP010I-NUMERIC-FIELD                            05910001
059200                                   TO ASC-FCLTY-ID-N              05920001
059300                                      DK-FCLTY-ID                 05930001
059400         END-IF                                                   05940001
060600     END-IF.                                                      06060001
060700                                                                  06070001
060800     IF  PS-NO-EDIT-ERROR                                         06080001
060900         IF  ASC-OPER-UNT-ID = SPACES                             06090001
061000             CONTINUE                                             06100001
061100         ELSE                                                     06110001
061200             MOVE ASC-OPER-UNT-ID      TO DK-STORE-NMBR           06120001
061300             PERFORM 3400-VALIDATE-OPER-UNT-ID                    06130001
061400             IF  PS-EDIT-ERROR                                    06140001
061500                 SET DP020-MSG-FATAL   TO TRUE                    06150001
061600                MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER         06160001
061700                 MOVE DP015-UNP-ALP-BRT-OFF                       06170001
061800                                       TO AOPRIDA                 06180001
061900                 MOVE DP015-RED        TO AOPRIDC                 06190001
062000                 MOVE DP015-REVERSE    TO AOPRIDH                 06200001
062100                 MOVE -1               TO AOPRIDL                 06210001
062200                 MOVE SPACES           TO ASC-FCLTY-NME           06220001
062300                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              06230001
064100             END-IF                                               06410001
064200         END-IF                                                   06420001
064300     END-IF.                                                      06430001
064400                                                                  06440001
064500     IF  ASC-PO-NBR       > SPACE                                 06450001
064600         MOVE ASC-PO-NBR           TO DP010I-UNEDITED-FIELD       06460001
064700         MOVE LENGTH OF ASC-PO-NBR       TO DP010I-MAXIMUM-DIGITS 06470001
064800         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     06480001
064900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06490001
065010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06501006
065020                         USING DP010I-NUMERIC-EDIT-AREA           06502006
065100         IF  DP010I-ERROR-DETECTED                                06510001
065200             SET PS-EDIT-ERROR                                    06520001
065300                 DP020-MSG-FATAL   TO TRUE                        06530001
065400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            06540001
065500             MOVE DP015-UNP-ALP-BRT-OFF                           06550001
065600                                   TO APONBRA                     06560001
065700             MOVE DP015-RED        TO APONBRC                     06570001
065800             MOVE DP015-REVERSE    TO APONBRH                     06580001
065900             MOVE -1               TO APONBRL                     06590001
066000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06600001
066100         ELSE                                                     06610001
066200             MOVE DP010I-NUMERIC-FIELD                            06620001
066300                                   TO ASC-PO-NBR-N                06630001
066400         END-IF                                                   06640001
066500     ELSE                                                         06650001
066600         SET PS-EDIT-ERROR                                        06660001
066700             DP020-MSG-FATAL   TO TRUE                            06670001
066800         MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER                06680001
066900         MOVE DP015-UNP-ALP-BRT-OFF                               06690001
067000                               TO APONBRA                         06700001
067100         MOVE DP015-RED        TO APONBRC                         06710001
067200         MOVE DP015-REVERSE    TO APONBRH                         06720001
067300         MOVE -1               TO APONBRL                         06730001
067400         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      06740001
067500     END-IF.                                                      06750001
067600                                                                  06760001
067700     IF  ASC-SEQ-NBR         > SPACE                              06770001
067800         MOVE ASC-SEQ-NBR          TO DP010I-UNEDITED-FIELD       06780001
067900         MOVE LENGTH OF ASC-SEQ-NBR         TO                    06790001
068000              DP010I-MAXIMUM-DIGITS                               06800001
068100         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     06810001
068200         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06820001
068310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06831006
068320                         USING DP010I-NUMERIC-EDIT-AREA           06832006
068400         IF  DP010I-ERROR-DETECTED                                06840001
068500             SET PS-EDIT-ERROR                                    06850001
068600                 DP020-MSG-FATAL   TO TRUE                        06860001
068700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            06870001
068800             MOVE DP015-UNP-ALP-BRT-OFF                           06880001
068900                                   TO ARCSEQA                     06890001
069000             MOVE DP015-RED        TO ARCSEQC                     06900001
069100             MOVE DP015-REVERSE    TO ARCSEQH                     06910001
069200             MOVE -1               TO ARCSEQL                     06920001
069300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06930001
069400         ELSE                                                     06940001
069500             MOVE DP010I-NUMERIC-FIELD                            06950001
069600                                   TO ASC-SEQ-NBR-N               06960001
069700         END-IF                                                   06970001
069800     END-IF.                                                      06980001
069900                                                                  06990001
070000     IF  ASC-LINE-NBR-X   > SPACE                                 07000001
070100         MOVE ASC-LINE-NBR-X       TO DP010I-UNEDITED-FIELD       07010001
070200         MOVE LENGTH OF ASC-LINE-NBR-X   TO DP010I-MAXIMUM-DIGITS 07020001
070300         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     07030001
070400         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07040001
070510         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07051006
070520                         USING DP010I-NUMERIC-EDIT-AREA           07052006
070600         IF  DP010I-ERROR-DETECTED                                07060001
070700             SET PS-EDIT-ERROR                                    07070001
070800                 DP020-MSG-FATAL   TO TRUE                        07080001
070900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07090001
071000             MOVE DP015-UNP-ALP-BRT-OFF                           07100001
071100                                   TO ALNNBRA                     07110001
071200             MOVE DP015-RED        TO ALNNBRC                     07120001
071300             MOVE DP015-REVERSE    TO ALNNBRH                     07130001
071400             MOVE -1               TO ALNNBRL                     07140001
071500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07150001
071600         ELSE                                                     07160001
071700             MOVE DP010I-NUMERIC-FIELD                            07170001
071800                                   TO ASC-LINE-NBR-N              07180001
071900         END-IF                                                   07190001
072000     END-IF.                                                      07200001
072100                                                                  07210001
072200     IF  ASC-WO-NBR      > SPACE                                  07220001
072300         MOVE ASC-WO-NBR           TO DP010I-UNEDITED-FIELD       07230001
072400         MOVE LENGTH OF ASC-WO-NBR      TO DP010I-MAXIMUM-DIGITS  07240001
072500         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     07250001
072600         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07260001
072710         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07271006
072720                         USING DP010I-NUMERIC-EDIT-AREA           07272006
072800         IF  DP010I-ERROR-DETECTED                                07280001
072900             SET PS-EDIT-ERROR                                    07290001
073000                 DP020-MSG-FATAL   TO TRUE                        07300001
073100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07310001
073200             MOVE DP015-UNP-ALP-BRT-OFF                           07320001
073300                                   TO AWONBRA                     07330001
073400             MOVE DP015-RED        TO AWONBRC                     07340001
073500             MOVE DP015-REVERSE    TO AWONBRH                     07350001
073600             MOVE -1               TO AWONBRL                     07360001
073700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07370001
073800         ELSE                                                     07380001
073900             MOVE DP010I-NUMERIC-FIELD                            07390001
074000                                   TO ASC-WO-NBR-N                07400001
074100         END-IF                                                   07410001
074200     END-IF.                                                      07420001
074300                                                                  07430001
074400     IF  PS-NO-EDIT-ERROR                                         07440001
074500         MOVE -1                     TO APONBRL                   07450001
074600         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      07460001
074700     END-IF.                                                      07470001
074800     EJECT                                                        07480001
074900******************************************************************07490001
075000** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **07500001
075100** MAP.                                                         **07510001
075200******************************************************************07520001
075300 3200-RESET-ATTRIBUTES.                                           07530001
075400                                                                  07540001
075500     MOVE DP015-UNP-ALP-NOR-OFF    TO AOPRIDA                     07550001
075600                                      AFACIDA                     07560001
075700                                      APONBRA                     07570001
075800                                      ARCSEQA                     07580001
075900                                      ALNNBRA                     07590001
076000                                      AWONBRA                     07600001
076100                                      ARSTATA                     07610001
076200     MOVE DP015-GREEN              TO AOPRIDC                     07620001
076300                                      AFACIDC                     07630001
076400                                      APONBRC                     07640001
076500                                      ARCSEQC                     07650001
076600                                      ALNNBRC                     07660001
076700                                      AWONBRC                     07670001
076800                                      ARSTATC                     07680001
076900     MOVE DP015-UNDERLINE          TO AOPRIDH                     07690001
077000                                      AFACIDH                     07700001
077100                                      APONBRH                     07710001
077200                                      ARCSEQH                     07720001
077300                                      ALNNBRH                     07730001
077400                                      AWONBRH                     07740001
077500                                      ARSTATH.                    07750001
077600*                                                                 07760001
077700 3300-VALIDATE-PO.                                                07770001
077800                                                                  07780001
077900     PERFORM                                                      07790001
078000         WITH TEST AFTER                                          07800001
078100         VARYING PV-SQL-SUB                                       07810001
078200         FROM 1 BY 1                                              07820001
078300         UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                      07830001
078400            OR   SQLCODE = +0                                     07840001
078500            OR   SQLCODE = +100)                                  07850001
078600                                                                  07860001
078700         EXEC SQL                                                 07870001
078800            SELECT  ORD_NBR                                       07880001
078900              INTO :RECEIV-ORD-NBR                                07890001
079000              FROM  TRECEIV                                       07900001
079100             WHERE  ORD_NBR = :PC000-PO-NBR-N                     07910001
079200         END-EXEC                                                 07920001
079300                                                                  07930001
079400         EVALUATE TRUE                                            07940001
079500             WHEN SQLCODE = -904                                  07950001
079600             WHEN SQLCODE = -913                                  07960001
079700                 CONTINUE                                         07970001
079800             WHEN SQLCODE = +100                                  07980001
079900                 SET PS-EDIT-ERROR TO TRUE                        07990001
080000             WHEN SQLCODE = +0                                    08000001
080100                 CONTINUE                                         08010001
080200             WHEN SQLCODE < +0                                    08020001
080300             WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))     08030001
080400             WHEN SQLWARN0 NOT = SPACES                           08040001
080500                  MOVE '3300-VALIDATE-PO'                         08050001
080600                                   TO DP013-PARAGRAPH             08060001
080700                  MOVE 'SELECT PO'                                08070001
080800                                   TO DP013-MESSAGE-TEXT (1)      08080001
080900                  MOVE SQLCA       TO DP013-SQLCA                 08090001
081000                  SET DP013-DB2-ABEND                             08100001
081100                                   TO TRUE                        08110001
081200                  PERFORM DP013-0000-PROCESS-ABEND                08120001
081300         END-EVALUATE                                             08130001
081400     END-PERFORM.                                                 08140001
081500                                                                  08150001
081600     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   08160001
081700         MOVE '3300-VALIDATE-PO'                                  08170001
081800                               TO  DP013-PARAGRAPH                08180001
081900         MOVE 'SELECT TSK'     TO  DP013-MESSAGE-TEXT (1)         08190001
082000         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   08200001
082100                               TO  DP013-MESSAGE-TEXT (2)         08210001
082200         MOVE SQLCA            TO  DP013-SQLCA                    08220001
082300         SET DP013-DB2-ABEND   TO  TRUE                           08230001
082400         PERFORM DP013-0000-PROCESS-ABEND                         08240001
082500     END-IF.                                                      08250001
082600     EJECT                                                        08260001
082700*----------------------------------------------------------------*08270001
082800*  VALIDATE THE OPERATING UNIT ID                                *08280002
083000*----------------------------------------------------------------*08300001
083100 3400-VALIDATE-OPER-UNT-ID.                                       08310001
083200                                                                  08320001
083300     PERFORM                                                      08330001
083400         WITH TEST AFTER                                          08340001
083500         VARYING PV-SQL-SUB                                       08350001
083600         FROM 1 BY 1                                              08360001
083700         UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                      08370001
083800            OR   SQLCODE = +0                                     08380001
083900            OR   SQLCODE = +100)                                  08390001
084000                                                                  08400001
084100         EXEC SQL                                                 08410001
084200            SELECT LOC_NBR                                        08420002
084210                 , LOC_NM                                         08421002
084300              INTO :XLT00010-LOC-NBR                              08430002
084310                 , :XLT00010-LOC-NM                               08431002
084400              FROM XLT_LOC                                        08440002
084500             WHERE LOC_NBR = :DK-STORE-NMBR                       08450002
084800         END-EXEC                                                 08480001
084900                                                                  08490001
085000         EVALUATE TRUE                                            08500001
085100             WHEN SQLCODE = -904                                  08510001
085200             WHEN SQLCODE = -913                                  08520001
085300                 CONTINUE                                         08530001
085400             WHEN SQLCODE = +100                                  08540001
085500                 SET PS-EDIT-ERROR TO TRUE                        08550001
085510                 MOVE SPACES       TO ASC-FCLTY-NME               08551002
085600             WHEN SQLCODE = +0                                    08560001
085610                 MOVE XLT00010-LOC-NM                             08561002
085620                                   TO ASC-FCLTY-NME               08562002
085800             WHEN SQLCODE < +0                                    08580001
085900             WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))     08590001
086000             WHEN SQLWARN0 NOT = SPACES                           08600001
086100                  MOVE '3400-VALIDATE-OPER-UNT-ID'                08610001
086200                                   TO DP013-PARAGRAPH             08620001
086300                  MOVE 'SELECT OPERATING UNIT ID'                 08630001
086400                                   TO DP013-MESSAGE-TEXT (1)      08640001
086500                  MOVE SQLCA       TO DP013-SQLCA                 08650001
086600                  MOVE 'XLT_LOC '  TO DP013-DB2-TABLE-NAME (1)    08660002
086700                  SET DP013-DB2-ABEND                             08670001
086800                      DP013-XCTL-DISPLAY-RESTART                  08680001
086900                                   TO TRUE                        08690001
087000                  PERFORM DP013-0000-PROCESS-ABEND                08700001
087100         END-EVALUATE                                             08710001
087200     END-PERFORM.                                                 08720001
087300                                                                  08730001
087400     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   08740001
087500         MOVE '3400-VALIDATE-OPER-UNT-ID'                         08750001
087600                               TO  DP013-PARAGRAPH                08760001
087700         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   08770001
087800                               TO  DP013-MESSAGE-TEXT (1)         08780001
087900         MOVE 'OF AN OPERATING UNIT ID        '                   08790001
088000                               TO  DP013-MESSAGE-TEXT (2)         08800001
088100         MOVE SQLCA            TO  DP013-SQLCA                    08810001
088200         MOVE 'XLT_LOC '       TO DP013-DB2-TABLE-NAME (1)        08820002
088300         SET DP013-DB2-ABEND                                      08830001
088400             DP013-XCTL-DISPLAY-RESTART                           08840001
088500                               TO  TRUE                           08850001
088600         PERFORM DP013-0000-PROCESS-ABEND                         08860001
088700     END-IF.                                                      08870001
088800     EJECT                                                        08880001
095400*----------------------------------------------------------------*09540001
095500*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *09550001
095600*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *09560001
095700*  IT HERE.                                                      *09570001
095800*----------------------------------------------------------------*09580001
095900 4000-BUILD-INITIAL-PANEL.                                        09590001
096000                                                                  09600001
096100     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        09610001
096200     MOVE -1                       TO APONBRL.                    09620001
096300                                                                  09630001
096400     MOVE ASC-OPER-UNT-ID-N        TO AOPRIDO                     09640001
096500                                      DK-OPER-UNT-ID.             09650001
096600     MOVE ASC-FCLTY-ID-N           TO AFACIDO                     09660001
096700                                      DK-FCLTY-ID.                09670001
096800                                                                  09680001
096900     PERFORM 4010-GET-OPER-UNIT-NAME.                             09690002
097000                                                                  09700001
097100     MOVE ASC-FCLTY-NME            TO AFDESCO.                    09710001
097200*                                                                 09720001
097300*----------------------------------------------------------------*09730001
097400*    GET THE FACILITY NAME                                       *09740001
097500*----------------------------------------------------------------*09750001
097600 4010-GET-OPER-UNIT-NAME.                                         09760002
097700                                                                  09770001
097800     PERFORM                                                      09780001
097900         WITH TEST AFTER                                          09790001
098000         VARYING PV-RETRY-COUNT                                   09800001
098100         FROM 1 BY 1                                              09810001
098200         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 09820001
098300             OR (SQLCODE = +0)                                    09830001
098400             OR (SQLCODE = +100))                                 09840001
098500                                                                  09850001
098510         EXEC SQL                                                 09851002
098530            SELECT LOC_NM                                         09853002
098550              INTO :XLT00010-LOC-NM                               09855002
098560              FROM XLT_LOC                                        09856002
098570             WHERE LOC_NBR = :DK-OPER-UNT-ID                      09857002
098580         END-EXEC                                                 09858002
099300                                                                  09930001
099400         EVALUATE TRUE                                            09940001
099500             WHEN SQLCODE = +0                                    09950001
099600                  MOVE XLT00010-LOC-NM                            09960002
099700                                  TO ASC-FCLTY-NME                09970001
099800                                                                  09980001
099900             WHEN SQLCODE = +100                                  09990001
100000                  MOVE SPACES     TO ASC-FCLTY-NME                10000001
100100                                                                  10010001
100200             WHEN SQLCODE = -904                                  10020001
100300             WHEN SQLCODE = -913                                  10030001
100400                  CONTINUE                                        10040001
100500                                                                  10050001
100600             WHEN SQLWARN0 NOT = SPACES                           10060001
100700             WHEN SQLCODE < +0                                    10070001
100800             WHEN SQLCODE > +0                                    10080001
100900                  MOVE '4010-GET-OPER-UNIT-NAME'                  10090002
101000                                  TO DP013-PARAGRAPH              10100001
101100                  MOVE 'UNSUCCESSFUL SELECT ON FACILITY TABLE'    10110001
101200                                  TO DP013-MESSAGE-TEXT (1)       10120001
101300                  MOVE SQLCA      TO DP013-SQLCA                  10130001
101400                  MOVE 'XLT_LOC ' TO DP013-DB2-TABLE-NAME (1)     10140002
101500                  SET DP013-DB2-ABEND                             10150001
101600                      DP013-XCTL-DISPLAY-RESTART                  10160001
101700                                  TO TRUE                         10170001
101800                  PERFORM DP013-0000-PROCESS-ABEND                10180001
101900         END-EVALUATE                                             10190001
102000     END-PERFORM.                                                 10200001
102100                                                                  10210001
102200     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          10220001
102300         MOVE '4010-GET-OPER-UNIT-NAME'                           10230002
102400                                  TO DP013-PARAGRAPH              10240001
102500         MOVE 'MAX RETRIES EXCEEDED ON SELECT FACILITY TABLE'     10250001
102600                                  TO DP013-MESSAGE-TEXT (1)       10260001
102700         MOVE SQLCA               TO DP013-SQLCA                  10270001
102800         MOVE 'XLT_LOC'           TO DP013-DB2-TABLE-NAME (1)     10280002
102900         SET DP013-DB2-ABEND                                      10290001
103000             DP013-XCTL-DISPLAY-RESTART                           10300001
103100                                  TO TRUE                         10310001
103200         PERFORM DP013-0000-PROCESS-ABEND                         10320001
103300     END-IF.                                                      10330001
103400                                                                  10340001
103500/                                                                 10350001
103600*----------------------------------------------------------------*10360001
103700*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *10370001
103800*----------------------------------------------------------------*10380001
103900 4400-MOVE-COMMAREA-TO-SCREEN.                                    10390001
104000*    MOVE ASC-OPER-UNT-ID-N        TO AOPRIDO                     10400001
104100*                                     PC000-OPERATING-UNIT-ID.    10410001
104200*    MOVE ASC-FCLTY-ID-N           TO AFACIDO                     10420001
104300*                                     PC000-FACILITY-ID.          10430001
104400     IF  ASC-OPER-UNT-ID NOT NUMERIC                              10440001
104500         IF  ASC-OPER-UNT-ID = SPACES                             10450001
104600             MOVE ZEROES           TO AOPRIDO                     10460001
104700                                      PC000-OPERATING-UNIT-ID     10470001
104800         ELSE                                                     10480001
104900             MOVE ASC-OPER-UNT-ID  TO AOPRIDI                     10490001
105000             MOVE ZEROS            TO PC000-OPERATING-UNIT-ID     10500001
105100         END-IF                                                   10510001
105200     ELSE                                                         10520001
105300         MOVE ASC-OPER-UNT-ID      TO AOPRIDO                     10530001
105400                                      PC000-OPERATING-UNIT-ID     10540001
105500     END-IF.                                                      10550001
105600                                                                  10560001
105700     IF  ASC-FCLTY-ID NOT NUMERIC                                 10570001
105800         MOVE SPACES               TO AFDESCO                     10580001
105900         IF  ASC-FCLTY-ID = SPACES                                10590001
106000             MOVE ZEROES           TO AFACIDO                     10600001
106100                                      PC000-FACILITY-ID           10610001
106200         ELSE                                                     10620001
106300             MOVE ASC-FCLTY-ID     TO AFACIDI                     10630001
106400             MOVE ZEROES           TO PC000-FACILITY-ID           10640001
106500         END-IF                                                   10650001
106600     ELSE                                                         10660001
106700         MOVE ASC-FCLTY-ID         TO AFACIDO                     10670001
106800                                      PC000-FACILITY-ID           10680001
106900         MOVE ASC-FCLTY-NME        TO AFDESCO                     10690001
107000     END-IF                                                       10700001
107100                                                                  10710001
107200     IF ASC-PO-NBR-N NUMERIC                                      10720001
107300         MOVE ASC-PO-NBR-N         TO APONBRO                     10730001
107400                                      PC000-PO-NBR-N              10740001
107500     ELSE                                                         10750001
107600         MOVE ASC-PO-NBR           TO APONBRI                     10760001
107700         MOVE ZEROS                TO PC000-PO-NBR-N              10770001
107800     END-IF                                                       10780001
107900                                                                  10790001
108000     IF ASC-SEQ-NBR-N NUMERIC                                     10800001
108100         MOVE ASC-SEQ-NBR-N        TO ARCSEQO                     10810001
108200                                      PC000-REC-SEQ-NBR-N         10820001
108300     ELSE                                                         10830001
108400         MOVE ASC-SEQ-NBR          TO ARCSEQI                     10840001
108500         MOVE +0                   TO PC000-REC-SEQ-NBR-N         10850001
108600     END-IF                                                       10860001
108700                                                                  10870001
108800     IF  ASC-LINE-NBR-N NOT NUMERIC                               10880001
108900         MOVE SPACES               TO PC000-LINE-NBR-X            10890001
109000         MOVE ZEROES               TO PC000-LINE-NBR-N            10900001
109100         IF  ASC-LINE-NBR-X = SPACES                              10910001
109200             MOVE ZEROES           TO ALNNBRO                     10920001
109300         ELSE                                                     10930001
109400             MOVE ASC-LINE-NBR-X   TO ALNNBRI                     10940001
109500         END-IF                                                   10950001
109600     ELSE                                                         10960001
109700         MOVE ASC-LINE-NBR-N       TO ALNNBRO                     10970001
109800                                      PC000-LINE-NBR-N            10980001
109900         MOVE ASC-LINE-NBR-X       TO PC000-LINE-NBR-X            10990001
110000     END-IF.                                                      11000001
110100                                                                  11010001
110200     IF ASC-WO-NBR NUMERIC                                        11020001
110300         MOVE ASC-WO-NBR-N         TO AWONBRO                     11030001
110400                                      PC000-WO-NBR-N              11040001
110500     ELSE                                                         11050001
110600         MOVE ASC-WO-NBR           TO AWONBRI                     11060001
110700         MOVE +0                   TO PC000-WO-NBR-N              11070001
110800     END-IF                                                       11080001
110900                                                                  11090001
111000     MOVE ASC-STATUS               TO ARSTATO                     11100001
111100                                      PC000-RECVR-STATUS-CDE.     11110001
111200                                                                  11120001
111300 EJECT                                                            11130001
111400*----------------------------------------------------------------*11140001
111500*    ABEND PROCESSOR MODULE                                      *11150001
111600*----------------------------------------------------------------*11160001
111700                                                                  11170001
111800     COPY DPPD013.                                                11180001
