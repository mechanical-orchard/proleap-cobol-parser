      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
                                                                        00040000
       PROGRAM-ID.             ARKUT038.                                00050000
       AUTHOR.                 DAN PAYNTER.                             00060000
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
       DATE-WRITTEN.           APRIL 2022.                              00080000
       DATE-COMPILED.                                                   00090000
      ******************************************************************00100000
      *  PROGRAM: ARKUT038 CASH PAYMENTS TO KOHL'S CHARGE ACCOUNTS      00120000
      *  --  ARKUT038 EXTRACT THE KOHL'S CASH PAYMENT TRANSACTIONS      00130000
      *      FROM COSA TO GENERATE A FILE.                              00140000
      *---------------------------------------------------------------- 00160000
      * CHANGES:                                                        00170000
      ******************************************************************00191000
      * DATE:        04/27/2022                                        *00192000
      * WR/IR#:      CHG0268678                                        *00193000
      * PROGRAMMER:  DAN PAYNTER                                       *00194000
      * DESCRIPTION: NEW PROGRAM.                                       00195000
      ******************************************************************00197000
042922* DATE:        04/29/2022                                        *00198002
042922* WR/IR#:      CHG0269558                                        *00199002
042922* PROGRAMMER:  DAN PAYNTER                                       *00200002
042922* DESCRIPTION: FIX ISSUE WITH ACCOUNT NUMBER DETOKENIZATION.      00210002
042922******************************************************************00220002
      ******************************************************************02020100
       ENVIRONMENT DIVISION.                                            02021000
      ******************************************************************02030000
                                                                        02040000
       CONFIGURATION SECTION.                                           02050000
                                                                        02060000
       SOURCE-COMPUTER.    IBM-3090.                                    02070000
       OBJECT-COMPUTER.    IBM-3090.                                    02080000
                                                                        02090000
       INPUT-OUTPUT SECTION.                                            02100000
                                                                        02110000
       FILE-CONTROL.                                                    02120000
                                                                        02130000
           SELECT POS-DATE-CARD-FILE                                    02140000
               ASSIGN TO INP01.                                         02150000
                                                                        02160000
           SELECT ACCOUNT-PAYMENT-FILE                                  02170000
               ASSIGN TO OUT01.                                         02180000
                                                                        02190000
           SELECT ACCOUNT-PAYMENT-CSV-FILE                              02191000
               ASSIGN TO OUT02.                                         02192000
                                                                        02193000
      ******************************************************************02200000
       DATA DIVISION.                                                   02210000
      ******************************************************************02220000
                                                                        02230000
       FILE SECTION.                                                    02240000
                                                                        02250000
       FD  POS-DATE-CARD-FILE                                           02260000
           RECORDING MODE IS F                                          02270000
           BLOCK CONTAINS 0 RECORDS                                     02280000
           LABEL RECORDS ARE STANDARD.                                  02290000
                                                                        02300000
       01  POS-DATE-CARD-RECORD            PIC X(80).                   02310000
                                                                        02320000
       FD  ACCOUNT-PAYMENT-FILE                                         02330000
           RECORDING MODE IS F                                          02340000
           LABEL RECORDS ARE STANDARD                                   02350000
           BLOCK CONTAINS 0 RECORDS                                     02360000
           RECORD CONTAINS 300 CHARACTERS                               02370000
           DATA RECORD IS AR-ACCT-PAYMENTS-RECORD.                      02380000
                                                                        02390000
       01  AR-ACCT-PAYMENTS-RECORD     PIC X(300).                      02400000
                                                                        02410000
                                                                        02420000
       FD  ACCOUNT-PAYMENT-CSV-FILE                                     02421000
           RECORDING MODE IS F                                          02422000
           LABEL RECORDS ARE STANDARD                                   02423000
           BLOCK CONTAINS 0 RECORDS                                     02424000
           RECORD CONTAINS 300 CHARACTERS                               02425000
           DATA RECORD IS AR-ACCT-PAYMENTS-CSV-RECORD.                  02426000
       01  AR-ACCT-PAYMENTS-CSV-RECORD PIC X(300).                      02428000
                                                                        02429000
                                                                        02429100
       WORKING-STORAGE SECTION.                                         02430000
                                                                        02440000
      ******************************************************************02450000
      * RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    02460000
      ******************************************************************02470000
       01  CC-CONTROL-CARD.                                             02480000
           05  CC-CONTROL-CARD-DISPLAY.                                 02490000
               10  CC-CONTROL-NAME     PIC X(14)    VALUE               02500000
                                                    'P.O.S. DATE = '.   02510000
               10  CC-POS-DATE-MMDDYY.                                  02520000
                   15  CC-POS-DATE-MM  PIC 9(2)     VALUE ZERO.         02530000
                   15  CC-POS-DATE-DD  PIC 9(2)     VALUE ZERO.         02540000
                   15  CC-POS-DATE-YY  PIC 9(2)     VALUE ZERO.         02550000
           05  FILLER                  PIC X(60)    VALUE SPACE.        02560000
                                                                        02570000
       01  PV-POS-CCYY-MM-DD.                                           02580000
           05  PV-POS-CC               PIC X(02).                       02590000
           05  PV-POS-YY               PIC X(02).                       02600000
           05  FILLER                  PIC X(01).                       02610000
           05  PV-POS-MM               PIC X(02).                       02620000
           05  FILLER                  PIC X(01).                       02630000
           05  PV-POS-DD               PIC X(02).                       02640000
                                                                        02650000
       01  PV-TRN-CCYY-MM-DD.                                           02660000
           05  PV-TRN-CC               PIC X(02).                       02670000
           05  PV-TRN-YY               PIC X(02).                       02680000
           05  FILLER                  PIC X(01).                       02690000
           05  PV-TRN-MM               PIC X(02).                       02700000
           05  FILLER                  PIC X(01).                       02710000
           05  PV-TRN-DD               PIC X(02).                       02720000
                                                                        02730000
       01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      02740000
                                                        COMP SYNC.      02750000
           88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    02760000
           88  AC-TABLE-OVERFLOW                        VALUE +4004.    02770000
           88  AC-INVALID-DATA-ERROR                    VALUE +4008.    02780000
           88  AC-DB2-ERROR                             VALUE +4013.    02790000
                                                                        02800000
       01  ABEND-CODE                        PIC S9(04) VALUE ZERO      02810000
                                                        COMP SYNC.      02820000
           88  AC-CONVERSION-ERROR                      VALUE +4008.    02830000
                                                                        02840000
       01  PS-PROGRAM-SWITCHES.                                         02850000
           05  PS-END-OF-ECOM-TABLE-SWITCH                              02860000
                                       PIC X(1)     VALUE 'N'.          02870000
               88  PS-NOT-END-OF-ECOM-TABLE         VALUE 'N'.          02880000
               88  PS-END-OF-ECOM-TABLE             VALUE 'Y'.          02890000
           05  PS-END-OF-ZIP-TABLE-SWITCH                               02900000
                                       PIC X(1)     VALUE 'N'.          02910000
               88  PS-NOT-END-OF-ZIP-TABLE          VALUE 'N'.          02920000
               88  PS-END-OF-ZIP-TABLE              VALUE 'Y'.          02930000
           05  PS-END-OF-CARD-FILE-SW        PIC X(01)  VALUE 'N'.      02940000
               88  PS-END-OF-CARD-FILE-YES              VALUE 'Y'.      02950000
           05  PS-LINE-ITEM-TYPE-SW    PIC X(1)     VALUE SPACE.        02960000
               88  PS-ITEM-LINE-ITEM                VALUE 'I'.          02970000
               88  PS-TLCD-LINE-ITEM                VALUE 'T'.          02980000
               88  PS-TAX-LINE-ITEM                 VALUE 'X'.          02990000
               88  PS-TENDER-LINE-ITEM              VALUE 'E'.          03000000
               88  PS-PAYMENT-LINE-ITEM             VALUE 'P'.          03010000
               88  PS-WRAP-LINE-ITEM                VALUE 'W'.          03020000
               88  PS-SHIP-LINE-ITEM                VALUE 'S'.          03030000
               88  PS-FEE-LINE-ITEM                 VALUE 'F'.          03040000
           05  PS-TENDER-GIFT-CARD-SW  PIC X(1)     VALUE 'N'.          03050000
               88  PS-TENDER-IS-NOT-GIFT-CARD       VALUE 'N'.          03060000
               88  PS-TENDER-IS-GIFT-CARD           VALUE 'Y'.          03070000
           05  PS-END-OF-TENDER-CURSOR-SW                               03080000
                                       PIC X(1)     VALUE SPACE.        03090000
               88  PS-END-OF-TENDER-CURSOR          VALUE 'Y'.          03100000
           05  PS-END-OF-LATE-COR-CURSOR-SW                             03110000
                                       PIC X(1)     VALUE SPACE.        03120000
               88  PS-END-OF-LATE-COR-CURSOR        VALUE 'Y'.          03130000
           05  PS-END-OF-LATE-VOID-CURSOR-SW                            03140000
                                       PIC X(1)     VALUE SPACE.        03150000
               88  PS-END-OF-LATE-VOID-CURSOR       VALUE 'Y'.          03160000
           05  PS-END-OF-POS-TRAN-CURSOR-SW                             03230000
                                       PIC X(1)     VALUE SPACE.        03240000
               88  PS-END-OF-POS-TRAN-CURSOR        VALUE 'Y'.          03250000
           05  PS-NULL-IND1            PIC S9(4)     COMP VALUE ZERO.   03660000
           05  PS-NULL-IND2            PIC S9(4)     COMP VALUE ZERO.   03670000
               88  PS-IND2-IS-NULL                   VALUE -1.          03680000
           05  PS-NULL-IND3            PIC S9(4)     COMP VALUE ZERO.   03690000
           05  PS-NULL-IND4            PIC S9(4)     COMP VALUE ZERO.   03700000
                                                                        03830000
       01  PC-PROGRAM-CONSTANTS.                                        03840000
           05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'ARKUT038'.   03850000
           05  PC-PAYMENT-TRAN-TYPE-CDE                                 03880000
                                       PIC X(02)    VALUE '30'.         03890000
           05  PC-KEYED-SRC-CDE        PIC X(02)    VALUE '00'.         03900000
           05  PC-NINES                PIC S9(4)    COMP                03940000
                                                    VALUE +9999.        03950000
           05  PC-STORE-MAX            PIC S9(4)    COMP                03960000
                                                    VALUE +5000.        03970000
           05  PC-ZIP-MAX              PIC S9(5)    COMP                03980000
                                                    VALUE +99999.       03990000
           05  PC-SPACES               PIC X(10)    VALUE SPACES.       04020000
                                                                        04030000
       01  PV-PROGRAM-VARIABLES.                                        04040000
           05  PV-PARAGRAPH-NAME       PIC  X(30)    VALUE SPACE.       04050000
           05  PV-OPERATION-MSG-1      PIC  X(40)    VALUE SPACE.       04060000
           05  PV-OPERATION-MSG-2      PIC  X(40)    VALUE SPACE.       04070000
           05  PV-STORE-SUB            PIC S9(04)   VALUE ZERO COMP.    04080000
           05  PV-STORE-SUB2           PIC S9(04)   VALUE ZERO COMP.    04090000
           05  PV-LINE-ITEM-NBR        PIC S9(04)   VALUE ZERO COMP.    04100000
           05  PV-GIFT-RECPT-CDE       PIC  X(01)   VALUE SPACE.        04110000
           05  PV-PARTN-NBR            PIC S9(04)   VALUE ZERO COMP.    04120000
           05  PV-STRT-TM              PIC  X(08)   VALUE SPACE.        04130000
           05  PV-SEQ-NBR              PIC S9(04)   VALUE ZERO COMP.    04140000
           05  PV-PAYMENT-RVRSL-IND    PIC X VALUE 'N'.                 04150000
           05  PV-SSN-LOOKUP-IND       PIC X VALUE 'N'.                 04150100
           05  PV-NET-CHRGD-AMT        PIC S9(7)V99 VALUE ZERO          04151000
                                       COMP-3.                          04160000
           05  PV-SBJCT-TO-TX-AMT      PIC S9(7)V99 VALUE ZERO          04170000
                                       COMP-3.                          04180000
           05  PV-EMPL-DISC-TRN-AMT    PIC S9(7)V99 VALUE ZERO          04190000
                                       COMP-3.                          04200000
           05  PV-CUST-CHRGD-AMT       PIC S9(7)V99 VALUE ZERO          04210000
                                       COMP-3.                          04220000
           05  PV-EMPLOYEE-CDE         PIC X(1)     VALUE SPACES.       04230000
           05  PV-KC-ACCT-NBR          PIC X(12)    VALUE SPACES.       04240000
           05  FILLER  REDEFINES  PV-KC-ACCT-NBR.                       04240100
               10  PV-KC-ACCT-FIRST10  PIC X(10).                       04240200
               10  PV-KC-ACCT-LAST2    PIC X(02).                       04240300
           05  PV-ASSOC-ID             PIC X(11)    VALUE SPACES.       04241000
           05  PV-ACCOUNT-NBR          PIC 9(10)    VALUE ZERO.         04250000
           05  PV-ACCOUNT-NBR-X REDEFINES PV-ACCOUNT-NBR                04260000
                                       PIC X(10).                       04270000
           05  PV-UPC                  PIC 9(13).                       04280000
           05  PV-TIME-HHMM            PIC 9(04)    VALUE ZERO.         04290000
           05  FILLER  REDEFINES  PV-TIME-HHMM.                         04300000
               10  PV-TIME-HH          PIC  9(02).                      04310000
               10  PV-TIME-MM          PIC  9(02).                      04320000
           05  PV-STR-NBR-9            PIC  9(04)   VALUE ZERO.         04330000
           05  PV-RGST-ID-9            PIC  9(04)   VALUE ZERO.         04340000
           05  PV-TRN-NBR-9            PIC  9(04)   VALUE ZERO.         04350000
           05  PV-STR-ZIP-CODE         PIC  X(05)   VALUE SPACES.       04480000
           05  PV-STR-GEO-CODE         PIC  X(02)   VALUE SPACES.       04490000
           05  PV-BUS-LOC-IND          PIC  X(01)   VALUE SPACE.        04500000
           05  PV-TNDR-TYP-CDE         PIC  X(02)     VALUE SPACE.      04520000
           05  PV-TNDR-AMT             PIC S9(7)V9(2) COMP-3 VALUE ZERO.04530000
           05  PV-TNDR-ID              PIC  X(33)     VALUE ZERO.       04540000
           05  PV-DB2-OPERATION        PIC  X(40)     VALUE SPACE.      04550000
           05  PV-TNDR-ID-LEN-NBR      PIC  S9(2)V    COMP-3            04610000
                                                      VALUE ZERO.       04620000
           05  PV-DISPLAY-PARTN         PIC  9(4).                      04830000
           05  PV-DISPLAY-STR           PIC  9(4).                      04840000
           05  PV-DISPLAY-RGST          PIC  9(4).                      04850000
           05  PV-DISPLAY-TRN           PIC  9(4).                      04860000
           05  PV-INPUT-TEXT              PIC X(24).                    04980000
           05  PV-OUTPUT-TEXT             PIC X(18)      VALUE SPACES.  04990000
                                                                        05000000
       01  PA-PROGRAM-ACCUMULATORS COMP-3.                              05060000
           05  PA-TRANSACTIONS-FETCHED         PIC S9(9) VALUE ZERO.    05070000
           05  PA-LATE-COR-ROWS-FETCHED        PIC S9(9) VALUE ZERO.    05080000
           05  PA-LATE-VOID-ROWS-FETCHED       PIC S9(9) VALUE ZERO.    05090000
           05  PA-RECORDS-WRITTEN              PIC S9(9) VALUE ZERO.    05100000
                                                                        05110000
       01  AR-HEADER-FILE.                                              05201000
           05  ARPAY-HEADER            PIC X(6) VALUE 'HEADER'.         05201100
           05  ARPAY-HEADER-DTE        PIC X(10) VALUE 'CCYY-MM-DD'.    05201200
           05  FILLER                  PIC X(284) VALUE SPACES.         05201300
                                                                        05201500
       01  AR-TRAILER-FILE.                                             05201600
           05  ARPAY-TRAILER           PIC X(7) VALUE 'TRAILER'.        05201700
           05  ARPAY-RECORD-COUNT      PIC 9(9) VALUE ZEROES.           05201800
           05  FILLER                  PIC X(284) VALUE SPACES.         05202000
                                                                        05202100
       01  AR-OUTPUT-FILE.                                              05202200
           05  ARPAY-STR-NBR           PIC 9(4).                        05202400
           05  ARPAY-RGST-ID           PIC 9(4).                        05202500
           05  ARPAY-TRN-NBR           PIC 9(4).                        05202600
           05  ARPAY-STRT-TM           PIC X(8).                        05202700
           05  ARPAY-SLS-CORR-SEQ-NBR  PIC -(2)9.                       05202800
           05  ARPAY-TRN-STAT-CDE      PIC X(2).                        05202900
           05  ARPAY-VOID-ABRT-CDE     PIC X.                           05203000
           05  ARPAY-TRN-TYP-CDE       PIC X(02).                       05203100
           05  ARPAY-SLS-DTE           PIC X(10).                       05203200
           05  ARPAY-TRN-DTE           PIC X(10).                       05203300
           05  ARPAY-PRCG-DTE          PIC X(10).                       05203400
           05  ARPAY-ASSOC-ID          PIC 9(9).                        05203500
           05  ARPAY-KC-ACCT-NBR       PIC X(12).                       05203800
           05  ARPAY-KC-ACCT-SRC-CDE   PIC X(2).                        05203900
           05  ARPAY-PAYT-AMT          PIC -9(5).9(2).                  05204000
           05  ARPAY-TNDR-SEQ-NBR      PIC 9(4).                        05204500
           05  ARPAY-TNDR-TYP-CDE      PIC X(02).                       05204700
           05  ARPAY-TNDR-AMT          PIC -9(7).9(2).                  05204900
           05  ARPAY-PAYMENT-RVRSL-IND PIC X VALUE 'N'.                 05205300
           05  ARPAY-SSN-LOOKUP-IND    PIC X VALUE 'N'.                 05205400
           05  FILLER                  PIC X(191).                      05205500
                                                                        05206000
       01  AR-OUTPUT-FILE-CSV.                                          05207000
           05  ARPAYC-PARTN-NBR        PIC 9(3).                        05208000
           05  FILLER                  PIC X VALUE ','.                 05208100
           05  ARPAYC-STR-NBR          PIC 9(4).                        05209000
           05  FILLER                  PIC X VALUE ','.                 05209100
           05  ARPAYC-RGST-ID          PIC 9(4).                        05210000
           05  FILLER                  PIC X VALUE ','.                 05211000
           05  ARPAYC-TRN-NBR          PIC 9(4).                        05220000
           05  FILLER                  PIC X VALUE ','.                 05221000
           05  ARPAYC-SLS-CORR-SEQ-NBR PIC 9(3).                        05230000
           05  FILLER                  PIC X VALUE ','.                 05231000
           05  ARPAYC-STRT-TM          PIC X(8).                        05240000
           05  FILLER                  PIC X VALUE ','.                 05241000
           05  ARPAYC-TRN-STAT-CDE     PIC X(2).                        05250000
           05  FILLER                  PIC X VALUE ','.                 05251000
           05  ARPAYC-VOID-ABRT-CDE    PIC X.                           05260000
           05  FILLER                  PIC X VALUE ','.                 05261000
           05  ARPAYC-TRN-TYP-CDE      PIC X(02).                       05270000
           05  FILLER                  PIC X VALUE ','.                 05271000
           05  ARPAYC-SLS-DTE          PIC X(10).                       05280000
           05  FILLER                  PIC X VALUE ','.                 05281000
           05  ARPAYC-TRN-DTE          PIC X(10).                       05290000
           05  FILLER                  PIC X VALUE ','.                 05291000
           05  ARPAYC-PRCG-DTE         PIC X(10).                       05300000
           05  FILLER                  PIC X VALUE ','.                 05301000
           05  ARPAYC-ASSOC-ID         PIC 9(9).                        05310000
           05  FILLER                  PIC X VALUE ','.                 05311000
           05  ARPAYC-POS-CPBL-LVL-NBR PIC X(4).                        05320000
           05  FILLER                  PIC X VALUE ','.                 05321000
           05  ARPAYC-STTLMNT-PRCD-CDE PIC X.                           05330000
           05  FILLER                  PIC X VALUE ','.                 05331000
           05  ARPAYC-KC-ACCT-NBR      PIC X(12).                       05340000
           05  FILLER                  PIC X VALUE ','.                 05341000
           05  ARPAYC-KC-ACCT-SRC-CDE  PIC X(2).                        05350000
           05  FILLER                  PIC X VALUE ','.                 05351000
           05  ARPAYC-PAYT-AMT         PIC -9(5).9(2).                  05360000
           05  FILLER                  PIC X VALUE ','.                 05361000
           05  ARPAYC-AUTH-NBR         PIC X(6).                        05370000
           05  FILLER                  PIC X VALUE ','.                 05371000
           05  ARPAYC-AUTH-TYP-CDE     PIC X.                           05380000
           05  FILLER                  PIC X VALUE ','.                 05380100
           05  ARPAYC-AUTH-APVL-CDE    PIC X(2).                        05381000
           05  FILLER                  PIC X VALUE ','.                 05381100
           05  ARPAYC-AUTH-SRC-CDE     PIC X(2).                        05382000
           05  FILLER                  PIC X VALUE ','.                 05382100
           05  ARPAYC-TNDR-SEQ-NBR     PIC 9(4).                        05384000
           05  FILLER                  PIC X VALUE ','.                 05384100
           05  ARPAYC-TNDR-VOID-IND    PIC X.                           05385000
           05  FILLER                  PIC X VALUE ','.                 05385100
           05  ARPAYC-TNDR-TYP-CDE     PIC X(02).                       05386000
           05  FILLER                  PIC X VALUE ','.                 05386100
           05  ARPAYC-TNDR-ID          PIC X(33).                       05387000
           05  FILLER                  PIC X VALUE ','.                 05387100
           05  ARPAYC-TNDR-AMT         PIC -9(7).9(2).                  05388000
           05  FILLER                  PIC X VALUE ','.                 05388100
           05  ARPAYC-TNDR-ID-SRC-CDE  PIC X(2).                        05389000
           05  FILLER                  PIC X VALUE ','.                 05389100
           05  ARPAYC-TNDR-ID-LEN-NBR  PIC 9(2).                        05389200
           05  FILLER                  PIC X VALUE ','.                 05389300
           05  ARPAYC-TNDR-ID-ERR-CDE  PIC X.                           05389400
           05  FILLER                  PIC X VALUE ','.                 05389500
           05  ARPAYC-PAYMENT-RVRSL-IND PIC X VALUE 'N'.                05389800
           05  FILLER                  PIC X VALUE ','.                 05389900
           05  ARPAYC-SSN-LOOKUP-IND   PIC X VALUE 'N'.                 05390000
           05  FILLER                  PIC X(102).                      05390200
                                                                        05530000
      ***************************************************************** 05590000
      *  INCLUDE FOR POS CONSTANT VALUES                                05600000
      ***************************************************************** 05610000
           COPY PSWS110.                                                05620000
                                                                        05630000
042922******************************************************************05640002
042922* LAYOUT FOR THE PARAMETERS NEEDED TO INVOKE PROTEGRITY MODULE   *05650002
042922******************************************************************05660002
042922     COPY PTYCCSIP.                                               05670002
042922                                                                  05680002
042922******************************************************************05681002
042922* LAYOUT FOR THE WORKING VARIABLES TO INVOKE PROTEGRITY MODULE   *05682002
042922******************************************************************05683002
042922     COPY DPWS031.                                                05684002
                                                                        05685001
      ******************************************************************05690000
      *  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             05700000
      ******************************************************************05710000
           COPY DPWS500.                                                05720000
                                                                        05730000
      ******************************************************************05890000
      *  DB2 ERROR COPYBOOK                                             05900000
      ******************************************************************05910000
           COPY DPWS004.                                                05920000
                                                                        05930000
      ******************************************************************05940000
      *  POS TRANSACTION TABLE LAYOUT                                   05950000
      ******************************************************************05960000
           EXEC SQL                                                     05970000
               INCLUDE TEPTRN                                           05980000
           END-EXEC.                                                    05990000
                                                                        06000000
      ******************************************************************06150000
      *  POS TENDER TABLE LAYOUT                                        06160000
      ******************************************************************06170000
           EXEC SQL                                                     06180000
               INCLUDE TEPTND                                           06190000
           END-EXEC.                                                    06200000
                                                                        06210000
      ******************************************************************06360000
      *  POS PROCESSING KEY TABLE LAYOUT (FOR LATE AND SALES CORRECTION 06370000
      *  TRANSACTIONS)                                                  06380000
      ******************************************************************06390000
           EXEC SQL                                                     06400000
               INCLUDE TEPDKEY                                          06410000
           END-EXEC.                                                    06420000
                                                                        06430000
      ******************************************************************06440000
      *  POS KOHLS PAYMENT TABLE                                        06450000
      ******************************************************************06460000
           EXEC SQL                                                     06470000
               INCLUDE TEPPAY                                           06480000
           END-EXEC.                                                    06490000
                                                                        06500000
      ******************************************************************06510000
      *  POS PARTITION TABLE                                            06520000
      ******************************************************************06530000
           EXEC SQL                                                     06540000
               INCLUDE TEPPART                                          06550000
           END-EXEC.                                                    06560000
                                                                        06570000
      ******************************************************************07210000
      * XS DOMAIN LOCATION TABLE.  XST_LOC                              07220000
      ******************************************************************07230000
           EXEC SQL                                                     07240000
               INCLUDE XST00001                                         07250000
           END-EXEC.                                                    07260000
                                                                        07270000
      ******************************************************************07280000
      * XS LOCATION ATTRIBUTE TABLE   XST_LOC_ATTR                      07290000
      ******************************************************************07300000
           EXEC SQL                                                     07310000
               INCLUDE XST00025                                         07320000
           END-EXEC.                                                    07330000
                                                                        07340000
      ******************************************************************07350000
      * EMPLOYEE DISCOUNT TABLE.   ART_EMP_DISC                         07360000
      ******************************************************************07370000
           EXEC SQL                                                     07380000
               INCLUDE ART00001                                         07390000
           END-EXEC.                                                    07400000
                                                                        07410000
      ******************************************************************07630000
      *  DB2 AREA FOR COMMUNICATIONS                                    07640000
      ******************************************************************07650000
           EXEC SQL                                                     07660000
               INCLUDE SQLCA                                            07670000
           END-EXEC.                                                    07680000
                                                                        07690000
      ******************************************************************07700000
      *  CURSOR TO CONTROL THE MAIN PROCESSING OF THE PROGRAM           07710000
      ******************************************************************07720000
           EXEC SQL                                                     07730000
               DECLARE POS-TRN-CSR CURSOR FOR                           07740000
                   SELECT                                               08280000
                          T.PARTN_NBR                                   08281000
                         ,T.STR_NBR                                     08290000
                         ,T.RGST_ID                                     08300000
                         ,T.TRN_NBR                                     08310000
                         ,T.SLS_CORR_SEQ_NBR                            08320000
                         ,T.STRT_TM                                     08330000
                         ,T.TRN_STAT_CDE                                08340000
                         ,T.VOID_ABRT_CDE                               08350000
                         ,T.TRN_TYP_CDE                                 08360000
                         ,T.SLS_DTE                                     08370000
                         ,T.TRN_DTE                                     08380000
                         ,T.PRCG_DTE                                    08390000
                         ,T.ASSOC_ID                                    08410000
                         ,T.POS_CPBL_LVL_NBR                            08420000
                         ,P.STTLMNT_PRCD_CDE                            08430000
                         ,P.KC_ACCT_NBR                                 08440000
                         ,P.KC_ACCT_SRC_CDE                             08441000
                         ,P.PAYT_AMT                                    08442000
                         ,P.AUTH_NBR                                    08443000
                         ,P.AUTH_TYP_CDE                                08444000
                         ,P.AUTH_APVL_CDE                               08445000
                         ,P.AUTH_SRC_CDE                                08446000
                         ,D.TNDR_SEQ_NBR                                08448000
                         ,D.TNDR_VOID_IND                               08449000
                         ,D.TNDR_TYP_CDE                                08450000
                         ,D.TNDR_ID                                     08460000
                         ,D.TNDR_AMT                                    08470000
                         ,D.TNDR_ID_SRC_CDE                             08480000
                         ,D.TNDR_ID_LEN_NBR                             08490000
                         ,D.TNDR_ID_ERR_CDE                             08500000
                   FROM   TEPTRN T                                      08550000
                         ,TEPPAY P                                      08560000
                         ,TEPTND D                                      08561000
                         ,TEPPART E                                     08570000
                   WHERE T.PARTN_NBR     = E.PARTN_NBR                  08580000
                     AND E.SLS_DTE       = :EPPART-SLS-DTE              08581000
                     AND E.STR_GP_CDE    = 'A'                          08582000
                     AND T.PARTN_NBR     = P.PARTN_NBR                  08590000
                     AND T.STR_NBR       = P.STR_NBR                    08600000
                     AND T.RGST_ID       = P.RGST_ID                    08610000
                     AND T.TRN_NBR       = P.TRN_NBR                    08620000
                     AND T.STRT_TM       = P.STRT_TM                    08630000
                     AND T.SLS_CORR_SEQ_NBR = P.SLS_CORR_SEQ_NBR        08640000
                     AND T.PARTN_NBR     = D.PARTN_NBR                  08641000
                     AND T.STR_NBR       = D.STR_NBR                    08642000
                     AND T.RGST_ID       = D.RGST_ID                    08643000
                     AND T.TRN_NBR       = D.TRN_NBR                    08644000
                     AND T.STRT_TM       = D.STRT_TM                    08645000
                     AND T.SLS_CORR_SEQ_NBR = D.SLS_CORR_SEQ_NBR        08646000
                     AND T.VOID_ABRT_CDE   = 'N'                        08670000
                     AND T.TRN_STAT_CDE    = 'Z'                        08680000
                     AND T.TRN_TYP_CDE     = '30'                       08680100
                     AND D.TNDR_VOID_IND   = 'N'                        08681000
                     AND D.TNDR_TYP_CDE NOT IN ('04')                   08682000
               AND EXISTS                                               08683000
                  (SELECT 1 FROM TEPTND L                               08684000
                   WHERE                                                08685000
                        L.PARTN_NBR         = T.PARTN_NBR               08685100
                    AND L.STR_NBR           = T.STR_NBR                 08688000
                    AND L.RGST_ID           = T.RGST_ID                 08689000
                    AND L.TRN_NBR           = T.TRN_NBR                 08689100
                    AND L.STRT_TM           = T.STRT_TM                 08689200
                    AND L.SLS_CORR_SEQ_NBR  = T.SLS_CORR_SEQ_NBR        08689300
                    AND L.TNDR_VOID_IND     = 'N'                       08689400
                    AND L.TNDR_TYP_CDE      = '00'                      08689500
                  )                                                     08689600
                   ORDER BY 2                                           08690000
                           ,3                                           08700000
                           ,4                                           08710000
                   WITH UR                                              08720000
           END-EXEC.                                                    08730000
                                                                        08740000
      ******************************************************************08750000
      *  CURSOR TO CONTROL THE RETRIEVAL OF THE LATE AND CORRECTION     08760000
      *  TRANSACTIONS                                                   08770000
      ******************************************************************08780000
           EXEC SQL                                                     08790000
            DECLARE LATE-COR-CSR CURSOR FOR                             08800000
             SELECT                                                     08810000
                    T.PARTN_NBR                                         08820000
                   ,T.STR_NBR                                           08830000
                   ,T.RGST_ID                                           08840000
                   ,T.TRN_NBR                                           08850000
                   ,T.SLS_CORR_SEQ_NBR                                  08860000
                   ,T.STRT_TM                                           08870000
                   ,T.TRN_STAT_CDE                                      08880000
                   ,T.VOID_ABRT_CDE                                     08890000
                   ,T.TRN_TYP_CDE                                       08900000
                   ,T.SLS_DTE                                           08910000
                   ,T.TRN_DTE                                           08920000
                   ,T.PRCG_DTE                                          08930000
                   ,T.ASSOC_ID                                          08940000
                   ,T.POS_CPBL_LVL_NBR                                  08950000
                   ,P.STTLMNT_PRCD_CDE                                  08960000
                   ,P.KC_ACCT_NBR                                       08970000
                   ,P.KC_ACCT_SRC_CDE                                   08980000
                   ,P.PAYT_AMT                                          08990000
                   ,P.AUTH_NBR                                          09000000
                   ,P.AUTH_TYP_CDE                                      09010000
                   ,P.AUTH_APVL_CDE                                     09020000
                   ,P.AUTH_SRC_CDE                                      09030000
                   ,D.TNDR_SEQ_NBR                                      09050000
                   ,D.TNDR_VOID_IND                                     09060000
                   ,D.TNDR_TYP_CDE                                      09070000
                   ,D.TNDR_ID                                           09080000
                   ,D.TNDR_AMT                                          09090000
                   ,D.TNDR_ID_SRC_CDE                                   09100000
                   ,D.TNDR_ID_LEN_NBR                                   09110000
                   ,D.TNDR_ID_ERR_CDE                                   09120000
               FROM   TEPTRN T                                          10380000
                     ,TEPPAY P                                          10390000
                     ,TEPTND D                                          10391000
                     ,TEPDKEY K                                         10400000
                     ,TEPPART E                                         10410000
             WHERE                                                      10420000
                   T.PARTN_NBR     = P.PARTN_NBR                        10421000
               AND T.STR_NBR       = P.STR_NBR                          10430000
               AND T.RGST_ID       = P.RGST_ID                          10440000
               AND T.TRN_NBR       = P.TRN_NBR                          10450000
               AND T.STRT_TM       = P.STRT_TM                          10460000
               AND T.SLS_CORR_SEQ_NBR = P.SLS_CORR_SEQ_NBR              10470000
               AND T.PARTN_NBR     = D.PARTN_NBR                        10471000
               AND T.STR_NBR       = D.STR_NBR                          10472000
               AND T.RGST_ID       = D.RGST_ID                          10473000
               AND T.TRN_NBR       = D.TRN_NBR                          10474000
               AND T.STRT_TM       = D.STRT_TM                          10475000
               AND T.SLS_CORR_SEQ_NBR = D.SLS_CORR_SEQ_NBR              10476000
               AND T.STR_NBR       = K.STR_NBR                          10480000
               AND T.RGST_ID       = K.RGST_ID                          10490000
               AND T.TRN_NBR       = K.TRN_NBR                          10500000
               AND T.STRT_TM       = K.STRT_TM                          10510000
               AND T.SLS_CORR_SEQ_NBR = K.SLS_CORR_SEQ_NBR              10520000
               AND T.PARTN_NBR     = E.PARTN_NBR                        10530000
               AND K.PRCG_DTE      = :EPDKEY-PRCG-DTE                   10540000
               AND K.SLS_DTE       = E.SLS_DTE                          10550000
               AND T.VOID_ABRT_CDE   = 'N'                              10560000
               AND T.TRN_STAT_CDE    IN ('V', 'L')                      10570000
               AND T.TRN_TYP_CDE     = '30'                             10570300
               AND D.TNDR_VOID_IND   = 'N'                              10570400
               AND D.TNDR_TYP_CDE NOT IN ('04')                         10570500
               AND EXISTS                                               10571000
                  (SELECT 1 FROM TEPTND L                               10572000
                   WHERE                                                10573000
                        L.PARTN_NBR         = T.PARTN_NBR               10574000
                    AND L.STR_NBR           = T.STR_NBR                 10575000
                    AND L.RGST_ID           = T.RGST_ID                 10576000
                    AND L.TRN_NBR           = T.TRN_NBR                 10577000
                    AND L.STRT_TM           = T.STRT_TM                 10578000
                    AND L.SLS_CORR_SEQ_NBR  = T.SLS_CORR_SEQ_NBR        10579000
                    AND L.TNDR_VOID_IND     = 'N'                       10579100
                    AND L.TNDR_TYP_CDE      = '00'                      10579200
                  )                                                     10579300
              UNION ALL                                                 10580000
                    SELECT                                              10590000
                          T.PARTN_NBR                                   10600000
                         ,T.STR_NBR                                     10610000
                         ,T.RGST_ID                                     10620000
                         ,T.TRN_NBR                                     10630000
                         ,T.SLS_CORR_SEQ_NBR                            10640000
                         ,T.STRT_TM                                     10650000
                         ,T.TRN_STAT_CDE                                10660000
                         ,T.VOID_ABRT_CDE                               10670000
                         ,T.TRN_TYP_CDE                                 10680000
                         ,T.SLS_DTE                                     10690000
                         ,T.TRN_DTE                                     10700000
                         ,T.PRCG_DTE                                    10710000
                         ,T.ASSOC_ID                                    10720000
                         ,T.POS_CPBL_LVL_NBR                            10730000
                         ,P.STTLMNT_PRCD_CDE                            10740000
                         ,P.KC_ACCT_NBR                                 10750000
                         ,P.KC_ACCT_SRC_CDE                             10760000
                         ,P.PAYT_AMT                                    10770000
                         ,P.AUTH_NBR                                    10780000
                         ,P.AUTH_TYP_CDE                                10790000
                         ,P.AUTH_APVL_CDE                               10800000
                         ,P.AUTH_SRC_CDE                                10810000
                         ,D.TNDR_SEQ_NBR                                10830000
                         ,D.TNDR_VOID_IND                               10840000
                         ,D.TNDR_TYP_CDE                                10850000
                         ,D.TNDR_ID                                     10851000
                         ,D.TNDR_AMT                                    10852000
                         ,D.TNDR_ID_SRC_CDE                             10853000
                         ,D.TNDR_ID_LEN_NBR                             10854000
                         ,D.TNDR_ID_ERR_CDE                             10855000
             FROM   TEPTRN T                                            10860000
                   ,TEPPAY P                                            10870000
                   ,TEPTND D                                            10871000
                   ,TEPDKEY K                                           10880000
                   ,TEPPART E                                           10890000
             WHERE                                                      10900000
                   T.PARTN_NBR     = P.PARTN_NBR                        10901000
               AND T.STR_NBR       = P.STR_NBR                          10910000
               AND T.RGST_ID       = P.RGST_ID                          10920000
               AND T.TRN_NBR       = P.TRN_NBR                          10930000
               AND T.STRT_TM       = P.STRT_TM                          10940000
               AND T.SLS_CORR_SEQ_NBR = P.SLS_CORR_SEQ_NBR              10950000
               AND T.PARTN_NBR     = D.PARTN_NBR                        10951000
               AND T.STR_NBR       = D.STR_NBR                          10960000
               AND T.RGST_ID       = D.RGST_ID                          10970000
               AND T.TRN_NBR       = D.TRN_NBR                          10980000
               AND T.STRT_TM       = D.STRT_TM                          10990000
               AND T.SLS_CORR_SEQ_NBR = D.SLS_CORR_SEQ_NBR              11000000
               AND T.STR_NBR       = K.STR_NBR                          11001000
               AND T.RGST_ID       = K.RGST_ID                          11002000
               AND T.TRN_NBR       = K.TRN_NBR                          11003000
               AND T.STRT_TM       = K.STRT_TM                          11004000
               AND T.SLS_CORR_SEQ_NBR = K.SLS_CORR_SEQ_NBR              11005000
               AND T.PARTN_NBR     = E.PARTN_NBR                        11010000
               AND K.PRCG_DTE      = :EPDKEY-PRCG-DTE                   11020000
               AND K.SLS_DTE       = E.SLS_DTE                          11030000
               AND T.VOID_ABRT_CDE = 'N'                                11040000
               AND T.TRN_STAT_CDE  ='R'                                 11050000
               AND T.TRN_TYP_CDE     = '30'                             11051000
               AND D.TNDR_VOID_IND   = 'N'                              11052000
               AND D.TNDR_TYP_CDE NOT IN ('04')                         11053000
               AND EXISTS                                               11054000
                  (SELECT 1 FROM TEPTND L                               11055000
                   WHERE                                                11056000
                        L.PARTN_NBR         = T.PARTN_NBR               11057000
                    AND L.STR_NBR           = T.STR_NBR                 11058000
                    AND L.RGST_ID           = T.RGST_ID                 11059000
                    AND L.TRN_NBR           = T.TRN_NBR                 11059100
                    AND L.STRT_TM           = T.STRT_TM                 11059200
                    AND L.SLS_CORR_SEQ_NBR  = T.SLS_CORR_SEQ_NBR        11059300
                    AND L.TNDR_VOID_IND     = 'N'                       11059400
                    AND L.TNDR_TYP_CDE      = '00'                      11059500
                  )                                                     11059600
               AND NOT EXISTS                                           11060000
                  (SELECT 1 FROM TEPTRN T1                              11070000
                   WHERE  T1.PARTN_NBR      = T.PARTN_NBR               11080000
                    AND T1.SLS_DTE          = T.SLS_DTE                 11090000
                    AND T1.PRCG_DTE         = T.PRCG_DTE                11100000
                    AND T1.STR_NBR          = T.STR_NBR                 11110000
                    AND T1.RGST_ID          = T.RGST_ID                 11120000
                    AND T1.TRN_NBR          = T.TRN_NBR                 11130000
                    AND T1.STRT_TM          = T.STRT_TM                 11140000
                    AND T1.VOID_ABRT_CDE    = 'R'                       11150000
                    AND T1.TRN_STAT_CDE     =  'V'                      11160000
                  )                                                     11170000
            ORDER BY 2                                                  11180000
                    ,3                                                  11190000
                    ,4                                                  11200000
            WITH UR                                                     11210000
           END-EXEC.                                                    11220000
                                                                        11230000
      ******************************************************************11240000
      *  CURSOR TO RETRIEVE LATE VOID TRANSACTIONS                     *11250000
      *                                                                *11260000
      * TEPDKEY - IDENTIFIES LATE TRANSACTIONS PROCESSED TODAY.        *11270000
      *                                                                *11280000
      * TEPPART - PROVIDES THE PARTITION NUMBER FOR THE LATE           *11290000
      *           TRANSACTION.                                         *11300000
      *                                                                *11310000
      * TEPVDA  - PROVIDES THE TRANSACTION NUMBER THAT WAS VOIDED.     *11320000
      *                                                                *11330000
      * TEPTRN  - TRANSACTION INFORMATION.                             *11340000
      *                                                                *11350000
      * TEPTND  - TENDER INFORMATION FOR SALES AND RETURNS             *11360000
      *                                                                *11370000
      * TEPPAY  - ACCOUNT PAYMENT INFORMATION.                         *11380000
      *                                                                *11390000
      ******************************************************************11400000
           EXEC SQL                                                     11410000
               DECLARE LATE-VOID-CSR CURSOR FOR                         11420000
               SELECT                                                   11430000
                    T.PARTN_NBR                                         11440000
                   ,T.STR_NBR                                           11450000
                   ,T.RGST_ID                                           11460000
                   ,T.TRN_NBR                                           11470000
                   ,T.SLS_CORR_SEQ_NBR                                  11480000
                   ,T.STRT_TM                                           11490000
                   ,T.TRN_STAT_CDE                                      11500000
                   ,T.VOID_ABRT_CDE                                     11510000
                   ,T.TRN_TYP_CDE                                       11520000
                   ,T.SLS_DTE                                           11530000
                   ,T.TRN_DTE                                           11540000
                   ,T.PRCG_DTE                                          11550000
                   ,T.ASSOC_ID                                          11560000
                   ,T.POS_CPBL_LVL_NBR                                  11570000
                   ,P.STTLMNT_PRCD_CDE                                  11580000
                   ,P.KC_ACCT_NBR                                       11590000
                   ,P.KC_ACCT_SRC_CDE                                   11600000
                   ,P.PAYT_AMT                                          11610000
                   ,P.AUTH_NBR                                          11620000
                   ,P.AUTH_TYP_CDE                                      11630000
                   ,P.AUTH_APVL_CDE                                     11640000
                   ,P.AUTH_SRC_CDE                                      11650000
                   ,D.TNDR_SEQ_NBR                                      11670000
                   ,D.TNDR_VOID_IND                                     11680000
                   ,D.TNDR_TYP_CDE                                      11690000
                   ,D.TNDR_ID                                           11691000
                   ,D.TNDR_AMT                                          11692000
                   ,D.TNDR_ID_SRC_CDE                                   11693000
                   ,D.TNDR_ID_LEN_NBR                                   11694000
                   ,D.TNDR_ID_ERR_CDE                                   11695000
               FROM   TEPTRN T                                          11697000
                     ,TEPPAY P                                          11698000
                     ,TEPTND D                                          11699000
                     ,TEPDKEY K                                         11699100
                     ,TEPPART E                                         11699200
                     ,TEPVDA  C                                         11699300
                 WHERE E.SLS_DTE       = K.SLS_DTE                      12430000
                   AND C.PARTN_NBR     = E.PARTN_NBR                    12440000
                   AND C.STR_NBR       = K.STR_NBR                      12450000
                   AND C.RGST_ID       = K.RGST_ID                      12460000
                   AND C.TRN_NBR       = K.TRN_NBR                      12470000
                   AND T.PARTN_NBR     = C.PARTN_NBR                    12480000
                   AND T.STR_NBR       = C.STR_NBR                      12490000
                   AND T.RGST_ID       = C.RGST_ID                      12500000
                   AND T.TRN_NBR       = C.VOID_TRN_NBR                 12510000
                   AND P.PARTN_NBR     = T.PARTN_NBR                    12520000
                   AND P.STR_NBR       = T.STR_NBR                      12530000
                   AND P.RGST_ID       = T.RGST_ID                      12540000
                   AND P.TRN_NBR       = T.TRN_NBR                      12550000
                   AND P.STRT_TM       = T.STRT_TM                      12560000
                   AND P.SLS_CORR_SEQ_NBR                               12570000
                                       = T.SLS_CORR_SEQ_NBR             12580000
                   AND D.PARTN_NBR     = T.PARTN_NBR                    12581000
                   AND D.STR_NBR       = T.STR_NBR                      12582000
                   AND D.RGST_ID       = T.RGST_ID                      12583000
                   AND D.TRN_NBR       = T.TRN_NBR                      12584000
                   AND D.STRT_TM       = T.STRT_TM                      12585000
                   AND D.SLS_CORR_SEQ_NBR                               12586000
                                       = T.SLS_CORR_SEQ_NBR             12587000
                   AND K.PRCG_DTE      = :EPDKEY-PRCG-DTE               12590000
                   AND T.TRN_STAT_CDE  = 'Z'                            12610000
                   AND T.TRN_TYP_CDE   = '30'                           12620000
                   AND D.TNDR_VOID_IND = 'N'                            12621000
                   AND D.TNDR_TYP_CDE NOT IN ('04')                     12622000
                   AND EXISTS                                           12623000
                      (SELECT 1 FROM TEPTND L                           12624000
                       WHERE                                            12625000
                            L.PARTN_NBR         = T.PARTN_NBR           12626000
                        AND L.STR_NBR           = T.STR_NBR             12627000
                        AND L.RGST_ID           = T.RGST_ID             12628000
                        AND L.TRN_NBR           = T.TRN_NBR             12629000
                        AND L.STRT_TM           = T.STRT_TM             12629100
                        AND L.SLS_CORR_SEQ_NBR  = T.SLS_CORR_SEQ_NBR    12629200
                        AND L.TNDR_VOID_IND     = 'N'                   12629300
                        AND L.TNDR_TYP_CDE      = '00'                  12629400
                      )                                                 12629500
                 ORDER BY 2                                             12630000
                         ,3                                             12640000
                         ,4                                             12650000
                 WITH UR                                                12660000
           END-EXEC.                                                    12670000
                                                                        15540000
      ******************************************************************15550000
       PROCEDURE DIVISION.                                              15560000
      ******************************************************************15570000
       0000-MAINLINE.                                                   15580000
                                                                        15590000
           PERFORM 1000-INITIALIZE.                                     15600000
                                                                        15610000
           PERFORM 2000-PROCESS-DATA.                                   15620000
                                                                        15630000
           PERFORM 9000-EOJ-ROUTINE.                                    15640000
                                                                        15650000
           GOBACK.                                                      15660000
                                                                        15670000
      ******************************************************************15680000
      *  SET UP FOR PROGRAM PROCESSING BY OPENING ALL FILES,           *15690000
      *                                 FILLING THE FIELDS OF THE      *15700000
      *  STANDARD REPORT HEADER, INITIALIZING NECESSARY VARIABLES, AND *15710000
      *  READING THE FIRST PROCESSABLE RECORD FROM THE P.O.S. KOHL'S   *15720000
      *  CHARGE FILE.                                                  *15730000
      ******************************************************************15740000
       1000-INITIALIZE.                                                 15750000
                                                                        15760000
042922     MOVE PC-CURRENT-PROGRAM-NAME  TO DP031-PROGRAM-NAME.         15761002
                                                                        15762002
           OPEN INPUT  POS-DATE-CARD-FILE.                              15770000
           OPEN OUTPUT ACCOUNT-PAYMENT-FILE.                            15780000
           OPEN OUTPUT ACCOUNT-PAYMENT-CSV-FILE.                        15781000
                                                                        15790000
           READ POS-DATE-CARD-FILE INTO CC-CONTROL-CARD                 15900000
              AT END                                                    15910000
                 SET PS-END-OF-CARD-FILE-YES TO TRUE.                   15920000
                                                                        15930000
           DISPLAY 'ARKUT038 CONTROL CARD: ' CC-CONTROL-CARD.           15940000
                                                                        15950000
           CLOSE POS-DATE-CARD-FILE.                                    15960000
                                                                        15970000
           IF PS-END-OF-CARD-FILE-YES                                   15980000
              DISPLAY '** ABEND ** ' PC-CURRENT-PROGRAM-NAME            15990000
              DISPLAY 'DATE CONTROL CARD EMPTY'                         16000000
              SET AC-CONTROL-CARD-ERROR TO TRUE                         16010000
              CALL 'ILBOABN0' USING AC-ABEND-CODE                       16020000
           END-IF.                                                      16030000
                                                                        16040000
           PERFORM 1115-CONVERT-INPUT-DATE.                             16050000
           MOVE PV-POS-CCYY-MM-DD TO ARPAY-HEADER-DTE.                  16050100
           PERFORM 8001-WRITE-AR-RECORD-HEADER.                         16051000
                                                                        16060000
      ******************************************************************16150000
      *     CALL KOHLS CALENDAR ROUTINE:                                16160000
      *         PASS: CONTROL CARD POS DATE (MMDDYY FORMAT).            16170000
      *       RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT). 16180000
      ******************************************************************16190000
       1115-CONVERT-INPUT-DATE.                                         16200000
                                                                        16210000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              16220000
                                                                        16230000
           SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   16240000
           SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   16250000
           SET  DPG52-LK-DTE-GREG            TO TRUE.                   16260000
           MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    16270000
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    16280000
                                                   DPG54 DPG55 DPG56.   16290000
           EVALUATE TRUE                                                16300000
               WHEN DPG54-SEVERE-ERROR                                  16310000
                  DISPLAY '** ABEND ** ' PC-CURRENT-PROGRAM-NAME        16320000
                  DISPLAY 'DATE CONTROL CARD INVALID'                   16330000
                  SET AC-CONTROL-CARD-ERROR TO TRUE                     16340000
                  CALL 'ILBOABN0' USING AC-ABEND-CODE                   16350000
           END-EVALUATE.                                                16360000
                                                                        16370000
           DISPLAY 'EXECUTION DATE USED = ' DPG55-DB2-ISO-DATE-FMT.     16380000
                                                                        16390000
           MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-POS-CCYY-MM-DD       16400000
                                                EPPART-SLS-DTE          16410000
                                                EPDKEY-PRCG-DTE.        16420000
                                                                        16430000
      ******************************************************************17590000
      *  PERFORMS THE PARAGRAPHS THAT CONTROL THE CURSORS THAT DRIVE   *17600000
      *  THE PROGRAM.                                                  *17610000
      ******************************************************************17620000
       2000-PROCESS-DATA.                                               17630000
                                                                        17640000
           PERFORM 2100-PROCESS-LATE-VOIDS.                             17650000
                                                                        17660000
           PERFORM 2200-PROCESS-LATES-AND-CORRS.                        17670000
                                                                        17680000
           PERFORM 2300-PROCESS-TODAYS-TRNS.                            17690000
                                                                        17700000
      ******************************************************************17710000
      *  PROCESS LATE VOID TRANSACTIONS.                               *17720000
      ******************************************************************17730000
       2100-PROCESS-LATE-VOIDS.                                         17740000
                                                                        17750000
           PERFORM 7800-OPEN-LATE-VOID-CURSOR.                          17760000
           PERFORM 7810-FETCH-LATE-VOID-CURSOR.                         17770000
           PERFORM UNTIL PS-END-OF-LATE-VOID-CURSOR                     17860000
               PERFORM 3000-PROCESS-TRANSACTION                         17870000
               PERFORM 7810-FETCH-LATE-VOID-CURSOR                      17880000
           END-PERFORM.                                                 17940000
           PERFORM 7820-CLOSE-LATE-VOID-CURSOR.                         17950000
                                                                        17960000
      ******************************************************************17970000
      *  PROCESS LATE TRANSACTIONS AND CORRECTIONS.                    *17980000
      ******************************************************************17990000
       2200-PROCESS-LATES-AND-CORRS.                                    18000000
                                                                        18010000
           PERFORM 7100-OPEN-LATE-COR-CURSOR.                           18020000
           PERFORM 7110-FETCH-LATE-COR-CURSOR.                          18030000
           PERFORM UNTIL PS-END-OF-LATE-COR-CURSOR                      18110000
               PERFORM 3000-PROCESS-TRANSACTION                         18120000
               PERFORM 7110-FETCH-LATE-COR-CURSOR                       18130000
           END-PERFORM.                                                 18190000
           PERFORM 7120-CLOSE-LATE-COR-CURSOR.                          18200000
                                                                        18210000
      ******************************************************************18220000
      *  PROCESS THE CURRENT DAYS TRANSACTIONS                         *18230000
      ******************************************************************18240000
       2300-PROCESS-TODAYS-TRNS.                                        18250000
                                                                        18260000
           PERFORM 7000-OPEN-POS-TRAN-CURSOR.                           18270000
           PERFORM 7010-FETCH-POS-TRANS-CURSOR.                         18280000
           PERFORM UNTIL PS-END-OF-POS-TRAN-CURSOR                      18350000
               PERFORM 3000-PROCESS-TRANSACTION                         18360000
               PERFORM 7010-FETCH-POS-TRANS-CURSOR                      18370000
           END-PERFORM.                                                 18430000
           PERFORM 7020-CLOSE-POS-TRAN-CURSOR.                          18450000
                                                                        18460000
      ******************************************************************18470000
      *  PROCESS A KOHL'S CHARGE PAYMENT                               *18480000
      ******************************************************************18490000
       3000-PROCESS-TRANSACTION.                                        18500000
                                                                        18510000
           IF EPPAY-PAYT-AMT > 0                                        18910000
               MOVE 'N' TO PV-PAYMENT-RVRSL-IND                         18920000
           ELSE                                                         18930000
      *** A NEGATIVE PAYMENT AMOUNT IS A SALES AUDIT PAYMENT REVERSAL   18940000
               MOVE 'Y' TO PV-PAYMENT-RVRSL-IND                         18943000
           END-IF.                                                      18944000
                                                                        18945000
           INITIALIZE AR-OUTPUT-FILE.                                   18947000
           INITIALIZE AR-OUTPUT-FILE-CSV.                               18948000
                                                                        18949000
           PERFORM 4700-PROCESS-OUTPUT-RECORD.                          18949100
                                                                        19250000
      ******************************************************************35750000
      *  PROCESS THE OUTPUT RECORD                                      35760000
      ******************************************************************35770000
       4700-PROCESS-OUTPUT-RECORD.                                      35780000
                                                                        35790000
           IF EPTRN-VOID-ABRT-CDE = 'V'                                 35801000
               COMPUTE EPPAY-PAYT-AMT =                                 35801100
                       EPPAY-PAYT-AMT * -1                              35801200
               END-COMPUTE                                              35801300
               COMPUTE EPTND-TNDR-AMT =                                 35801400
                       EPTND-TNDR-AMT * -1                              35801500
               END-COMPUTE                                              35801600
               MOVE 'Y' TO PV-PAYMENT-RVRSL-IND                         35801700
           END-IF.                                                      35801800
                                                                        35801900
           MOVE PV-PAYMENT-RVRSL-IND   TO ARPAY-PAYMENT-RVRSL-IND.      35802000
           MOVE EPTRN-STR-NBR          TO ARPAY-STR-NBR.                35802200
           MOVE EPTRN-RGST-ID          TO ARPAY-RGST-ID.                35802300
           MOVE EPTRN-TRN-NBR          TO ARPAY-TRN-NBR.                35802400
           MOVE EPTRN-SLS-CORR-SEQ-NBR TO ARPAY-SLS-CORR-SEQ-NBR.       35802500
           MOVE EPTRN-STRT-TM          TO ARPAY-STRT-TM.                35802600
           MOVE EPTRN-TRN-STAT-CDE     TO ARPAY-TRN-STAT-CDE.           35802700
           MOVE EPTRN-VOID-ABRT-CDE    TO ARPAY-VOID-ABRT-CDE.          35802800
           MOVE EPTRN-TRN-TYP-CDE      TO ARPAY-TRN-TYP-CDE.            35802900
           MOVE EPTRN-SLS-DTE          TO ARPAY-SLS-DTE.                35803000
           MOVE EPTRN-TRN-DTE          TO ARPAY-TRN-DTE.                35803100
           MOVE EPTRN-PRCG-DTE         TO ARPAY-PRCG-DTE.               35803200
           MOVE EPTRN-ASSOC-ID         TO ARPAY-ASSOC-ID.               35803300
042922     PERFORM 6110-DETOKENIZE-ACCT.                                35803802
042922     MOVE DP031-CLEAR-TEXT       TO ARPAY-KC-ACCT-NBR             35803902
                                          PV-KC-ACCT-NBR.               35804001
           IF PV-KC-ACCT-LAST2 = '99'                                   35804100
               MOVE 'Y' TO PV-SSN-LOOKUP-IND                            35804200
           ELSE                                                         35804300
               MOVE 'N' TO PV-SSN-LOOKUP-IND                            35804400
           END-IF.                                                      35804500
           MOVE PV-SSN-LOOKUP-IND      TO ARPAY-SSN-LOOKUP-IND.         35804600
           MOVE EPPAY-KC-ACCT-SRC-CDE  TO ARPAY-KC-ACCT-SRC-CDE.        35804700
           MOVE EPPAY-PAYT-AMT         TO ARPAY-PAYT-AMT.               35804800
           MOVE EPTND-TNDR-SEQ-NBR     TO ARPAY-TNDR-SEQ-NBR.           35805000
           MOVE EPTND-TNDR-TYP-CDE     TO ARPAY-TNDR-TYP-CDE.           35805200
           MOVE EPTND-TNDR-AMT         TO ARPAY-TNDR-AMT.               35805400
                                                                        35805800
           MOVE PV-PAYMENT-RVRSL-IND   TO ARPAYC-PAYMENT-RVRSL-IND.     35805900
           MOVE EPTRN-PARTN-NBR        TO ARPAYC-PARTN-NBR.             35806000
           MOVE EPTRN-STR-NBR          TO ARPAYC-STR-NBR.               35806100
           MOVE EPTRN-RGST-ID          TO ARPAYC-RGST-ID.               35806200
           MOVE EPTRN-TRN-NBR          TO ARPAYC-TRN-NBR.               35806300
           MOVE EPTRN-SLS-CORR-SEQ-NBR TO ARPAYC-SLS-CORR-SEQ-NBR.      35806400
           MOVE EPTRN-STRT-TM          TO ARPAYC-STRT-TM.               35806500
           MOVE EPTRN-TRN-STAT-CDE     TO ARPAYC-TRN-STAT-CDE.          35807000
           MOVE EPTRN-VOID-ABRT-CDE    TO ARPAYC-VOID-ABRT-CDE.         35808000
           MOVE EPTRN-TRN-TYP-CDE      TO ARPAYC-TRN-TYP-CDE.           35809000
           MOVE EPTRN-SLS-DTE          TO ARPAYC-SLS-DTE.               35810000
           MOVE EPTRN-TRN-DTE          TO ARPAYC-TRN-DTE.               35820000
           MOVE EPTRN-PRCG-DTE         TO ARPAYC-PRCG-DTE.              35830000
           MOVE EPTRN-ASSOC-ID         TO ARPAYC-ASSOC-ID.              35840000
           MOVE EPTRN-POS-CPBL-LVL-NBR TO ARPAYC-POS-CPBL-LVL-NBR.      35850000
           MOVE EPPAY-STTLMNT-PRCD-CDE TO ARPAYC-STTLMNT-PRCD-CDE.      35860000
           MOVE PV-SSN-LOOKUP-IND      TO ARPAYC-SSN-LOOKUP-IND.        35861000
042922     MOVE DP031-CLEAR-TEXT       TO ARPAYC-KC-ACCT-NBR.           35870002
           MOVE EPPAY-KC-ACCT-SRC-CDE  TO ARPAYC-KC-ACCT-SRC-CDE.       35880000
           MOVE EPPAY-PAYT-AMT         TO ARPAYC-PAYT-AMT.              35890000
           MOVE EPPAY-AUTH-NBR         TO ARPAYC-AUTH-NBR.              35900000
           MOVE EPPAY-AUTH-TYP-CDE     TO ARPAYC-AUTH-TYP-CDE.          35910000
           MOVE EPPAY-AUTH-APVL-CDE    TO ARPAYC-AUTH-APVL-CDE.         35920000
           MOVE EPPAY-AUTH-SRC-CDE     TO ARPAYC-AUTH-SRC-CDE.          35930000
           MOVE EPTND-TNDR-SEQ-NBR     TO ARPAYC-TNDR-SEQ-NBR.          35950000
           MOVE EPTND-TNDR-VOID-IND    TO ARPAYC-TNDR-VOID-IND.         35960000
           MOVE EPTND-TNDR-TYP-CDE     TO ARPAYC-TNDR-TYP-CDE.          35970000
           MOVE EPTND-TNDR-ID          TO ARPAYC-TNDR-ID.               35980000
           MOVE EPTND-TNDR-AMT         TO ARPAYC-TNDR-AMT.              35990000
           MOVE EPTND-TNDR-ID-SRC-CDE  TO ARPAYC-TNDR-ID-SRC-CDE.       36000000
           MOVE EPTND-TNDR-ID-LEN-NBR  TO ARPAYC-TNDR-ID-LEN-NBR.       36010000
           MOVE EPTND-TNDR-ID-ERR-CDE  TO ARPAYC-TNDR-ID-ERR-CDE.       36020000
                                                                        38090000
           PERFORM 8000-WRITE-AR-RECORD.                                38091000
                                                                        44160000
042922******************************************************************44161002
042922* CALLS THE PROTEGRITY MODULE TO DETOKENIZE THE CARD NUMBER.      44162002
042922******************************************************************44163002
042922 6110-DETOKENIZE-ACCT.                                            44164002
042922                                                                  44165002
042922     INITIALIZE DP031-PROTEG-PGM-PARAMETERS                       44166002
042922                CSI-PARAMETERS.                                   44167002
042922                                                                  44168002
042922     MOVE EPPAY-KC-ACCT-NBR         TO DP031-CIPHER-TEXT.         44169202
042922     MOVE 12                        TO DP031-INPUT-LEN.           44169302
042922                                                                  44169802
042922     MOVE 'ACCOUNT-NUMBER'          TO DP031-FIELD.               44169902
042922     SET CSI-DECRYPT-FUNCTION       TO TRUE.                      44170002
042922     SET DP031-ACCTNBR              TO TRUE.                      44170102
042922     PERFORM DP031-0000-PROTG-TOKEN-DETOKEN.                      44170202
042922     IF CSI-RETURN-CODE NOT = ZERO                                44170302
042922        DISPLAY '6110-DETOKENIZE-ACCT ERROR '                     44170402
042922        DISPLAY 'PARTN NBR      : '    EPTRN-PARTN-NBR            44170502
042922        DISPLAY 'STORE NBR      : '    EPTRN-STR-NBR              44170602
042922        DISPLAY 'REGISTER ID    : '    EPTRN-RGST-ID              44170702
042922        DISPLAY 'TRANS NBR      : '    EPTRN-TRN-NBR              44170802
042922        DISPLAY 'ACCOUNT NBR    : '    EPPAY-KC-ACCT-NBR          44170902
042922        PERFORM DP031-9999-ABEND                                  44171002
042922     END-IF.                                                      44171102
042922                                                                  44171202
      ***************************************************************** 44172000
      *  OPEN THE POS TRANSACTION CURSOR                                44180000
      ***************************************************************** 44190000
       7000-OPEN-POS-TRAN-CURSOR.                                       44200000
                                                                        44210000
           EXEC SQL                                                     44220000
               OPEN POS-TRN-CSR                                         44230000
           END-EXEC.                                                    44240000
                                                                        44250000
           EVALUATE TRUE                                                44260000
               WHEN SQLCODE = ZERO                                      44270000
                   CONTINUE                                             44280000
               WHEN SQLWARN0 NOT EQUAL SPACE                            44290000
               WHEN SQLCODE NOT EQUAL ZERO                              44300000
                   MOVE '7000-OPEN-POS-TRAN-CURSOR'                     44310000
                                                  TO PV-PARAGRAPH-NAME  44320000
                   MOVE 'ERROR ON OPENING POS TRANS CURSOR '            44330000
                                                  TO PV-DB2-OPERATION   44340000
                   PERFORM 9200-SQL-ABEND                               44350000
           END-EVALUATE.                                                44360000
                                                                        44370000
      ******************************************************************44380000
      *  FETCH THE ORIGINAL POS CURSOR                                 *44390000
      ******************************************************************44400000
       7010-FETCH-POS-TRANS-CURSOR.                                     44410000
                                                                        44420000
           EXEC SQL                                                     44460000
               FETCH POS-TRN-CSR                                        44470000
               INTO                                                     44471000
                    :EPTRN-PARTN-NBR                                    44471100
                   ,:EPTRN-STR-NBR                                      44471200
                   ,:EPTRN-RGST-ID                                      44471300
                   ,:EPTRN-TRN-NBR                                      44471400
                   ,:EPTRN-SLS-CORR-SEQ-NBR                             44471500
                   ,:EPTRN-STRT-TM                                      44471600
                   ,:EPTRN-TRN-STAT-CDE                                 44471700
                   ,:EPTRN-VOID-ABRT-CDE                                44471800
                   ,:EPTRN-TRN-TYP-CDE                                  44471900
                   ,:EPTRN-SLS-DTE                                      44472000
                   ,:EPTRN-TRN-DTE                                      44472100
                   ,:EPTRN-PRCG-DTE                                     44472200
                   ,:EPTRN-ASSOC-ID                                     44472300
                   ,:EPTRN-POS-CPBL-LVL-NBR                             44472400
                   ,:EPPAY-STTLMNT-PRCD-CDE                             44472500
                   ,:EPPAY-KC-ACCT-NBR                                  44472600
                   ,:EPPAY-KC-ACCT-SRC-CDE                              44472700
                   ,:EPPAY-PAYT-AMT                                     44472800
                   ,:EPPAY-AUTH-NBR                                     44472900
                   ,:EPPAY-AUTH-TYP-CDE                                 44473000
                   ,:EPPAY-AUTH-APVL-CDE                                44473100
                   ,:EPPAY-AUTH-SRC-CDE                                 44473200
                   ,:EPTND-TNDR-SEQ-NBR                                 44473400
                   ,:EPTND-TNDR-VOID-IND                                44473500
                   ,:EPTND-TNDR-TYP-CDE                                 44473600
                   ,:EPTND-TNDR-ID                                      44473700
                   ,:EPTND-TNDR-AMT                                     44473800
                   ,:EPTND-TNDR-ID-SRC-CDE                              44473900
                   ,:EPTND-TNDR-ID-LEN-NBR                              44474000
                   ,:EPTND-TNDR-ID-ERR-CDE                              44474100
           END-EXEC.                                                    44750000
                                                                        44760000
           EVALUATE TRUE                                                44770000
               WHEN SQLCODE = ZERO                                      44780000
                   MOVE EPTRN-PARTN-NBR        TO PV-PARTN-NBR          44790000
                   MOVE EPTRN-STRT-TM          TO PV-STRT-TM            44800000
                   MOVE EPTRN-SLS-CORR-SEQ-NBR TO PV-SEQ-NBR            44810000
                   ADD +1 TO PA-TRANSACTIONS-FETCHED                    44820000
               WHEN SQLCODE = +100                                      44830000
                   SET PS-END-OF-POS-TRAN-CURSOR                        44840000
                                         TO TRUE                        44850000
                   MOVE ZERO             TO PV-PARTN-NBR                44860000
                   MOVE SPACE            TO PV-STRT-TM                  44870000
                   MOVE ZERO             TO PV-SEQ-NBR                  44880000
               WHEN SQLWARN0 NOT EQUAL SPACE                            44890000
               WHEN SQLCODE NOT EQUAL ZERO                              44900000
                   MOVE '7000-FETCH-POS-TRANS-CURSOR'                   44910000
                                                  TO PV-PARAGRAPH-NAME  44920000
                   MOVE 'ERROR ON FETCHING POS TRANS INFO '             44930000
                                                  TO PV-DB2-OPERATION   44940000
                   PERFORM 9200-SQL-ABEND                               44950000
           END-EVALUATE.                                                44960000
                                                                        44970000
      ***************************************************************** 44980000
      *  CLOSE THE POS TRANSACTION CURSOR                               44990000
      ***************************************************************** 45000000
       7020-CLOSE-POS-TRAN-CURSOR.                                      45010000
                                                                        45020000
           EXEC SQL                                                     45030000
               CLOSE POS-TRN-CSR                                        45040000
           END-EXEC.                                                    45050000
                                                                        45060000
           EVALUATE TRUE                                                45070000
               WHEN SQLCODE = ZERO                                      45080000
                   CONTINUE                                             45090000
               WHEN SQLWARN0 NOT EQUAL SPACE                            45100000
               WHEN SQLCODE NOT EQUAL ZERO                              45110000
                   MOVE '7020-CLOSE-POS-TRAN-CURSOR'                    45120000
                                                  TO PV-PARAGRAPH-NAME  45130000
                   MOVE 'ERROR ON CLOSING POS TRANS CURSOR '            45140000
                                                  TO PV-DB2-OPERATION   45150000
                   PERFORM 9200-SQL-ABEND                               45160000
           END-EVALUATE.                                                45170000
                                                                        45180000
      ***************************************************************** 45190000
      *  OPEN THE LATE / CORRECTIONS CURSOR                             45200000
      ***************************************************************** 45210000
       7100-OPEN-LATE-COR-CURSOR.                                       45220000
                                                                        45230000
           EXEC SQL                                                     45240000
               OPEN LATE-COR-CSR                                        45250000
           END-EXEC.                                                    45260000
                                                                        45270000
           EVALUATE TRUE                                                45280000
               WHEN SQLCODE = ZERO                                      45290000
                   CONTINUE                                             45300000
               WHEN SQLWARN0 NOT EQUAL SPACE                            45310000
               WHEN SQLCODE NOT EQUAL ZERO                              45320000
                   MOVE '7100-OPEN-LATE-COR-CURSOR'                     45330000
                                                  TO PV-PARAGRAPH-NAME  45340000
                   MOVE 'ERROR ON OPENING LATE COR CURSOR '             45350000
                                                  TO PV-DB2-OPERATION   45360000
                   PERFORM 9200-SQL-ABEND                               45370000
           END-EVALUATE.                                                45380000
                                                                        45390000
      ******************************************************************45400000
      *  FETCH THE LATE AND SALES CORRECTION CURSOR                     45410000
      ******************************************************************45420000
       7110-FETCH-LATE-COR-CURSOR.                                      45430000
                                                                        45460000
           EXEC SQL                                                     45470000
               FETCH LATE-COR-CSR                                       45480000
               INTO                                                     45490000
                    :EPTRN-PARTN-NBR                                    45500000
                   ,:EPTRN-STR-NBR                                      45510000
                   ,:EPTRN-RGST-ID                                      45520000
                   ,:EPTRN-TRN-NBR                                      45530000
                   ,:EPTRN-SLS-CORR-SEQ-NBR                             45540000
                   ,:EPTRN-STRT-TM                                      45550000
                   ,:EPTRN-TRN-STAT-CDE                                 45560000
                   ,:EPTRN-VOID-ABRT-CDE                                45570000
                   ,:EPTRN-TRN-TYP-CDE                                  45580000
                   ,:EPTRN-SLS-DTE                                      45590000
                   ,:EPTRN-TRN-DTE                                      45600000
                   ,:EPTRN-PRCG-DTE                                     45610000
                   ,:EPTRN-ASSOC-ID                                     45620000
                   ,:EPTRN-POS-CPBL-LVL-NBR                             45630000
                   ,:EPPAY-STTLMNT-PRCD-CDE                             45640000
                   ,:EPPAY-KC-ACCT-NBR                                  45650000
                   ,:EPPAY-KC-ACCT-SRC-CDE                              45660000
                   ,:EPPAY-PAYT-AMT                                     45670000
                   ,:EPPAY-AUTH-NBR                                     45680000
                   ,:EPPAY-AUTH-TYP-CDE                                 45690000
                   ,:EPPAY-AUTH-APVL-CDE                                45700000
                   ,:EPPAY-AUTH-SRC-CDE                                 45710000
                   ,:EPTND-TNDR-SEQ-NBR                                 45730000
                   ,:EPTND-TNDR-VOID-IND                                45740000
                   ,:EPTND-TNDR-TYP-CDE                                 45750000
                   ,:EPTND-TNDR-ID                                      45751000
                   ,:EPTND-TNDR-AMT                                     45752000
                   ,:EPTND-TNDR-ID-SRC-CDE                              45753000
                   ,:EPTND-TNDR-ID-LEN-NBR                              45754000
                   ,:EPTND-TNDR-ID-ERR-CDE                              45755000
           END-EXEC.                                                    45760000
                                                                        45770000
           EVALUATE TRUE                                                45780000
               WHEN SQLCODE = ZERO                                      45790000
                   ADD +1 TO PA-LATE-COR-ROWS-FETCHED                   45800000
                   MOVE EPTRN-PARTN-NBR TO PV-PARTN-NBR                 45810000
                   MOVE EPTRN-STRT-TM    TO PV-STRT-TM                  45820000
                   MOVE EPTRN-SLS-CORR-SEQ-NBR                          45830000
                                         TO PV-SEQ-NBR                  45840000
               WHEN SQLCODE = +100                                      45850000
                   SET PS-END-OF-LATE-COR-CURSOR                        45860000
                                         TO TRUE                        45870000
               WHEN SQLWARN0 NOT EQUAL SPACE                            45880000
               WHEN SQLCODE NOT EQUAL ZERO                              45890000
                   MOVE '7110-FETCH-LATE-COR-CURSOR'                    45900000
                                                  TO PV-PARAGRAPH-NAME  45910000
                   MOVE 'ERROR ON FETCHING LATE COR CURSOR '            45920000
                                                  TO PV-DB2-OPERATION   45930000
                   PERFORM 9200-SQL-ABEND                               45940000
           END-EVALUATE.                                                45950000
                                                                        45960000
      ***************************************************************** 45970000
      *  CLOSE THE LATE COR CURSOR                                      45980000
      ***************************************************************** 45990000
       7120-CLOSE-LATE-COR-CURSOR.                                      46000000
                                                                        46010000
           EXEC SQL                                                     46020000
               CLOSE LATE-COR-CSR                                       46030000
           END-EXEC.                                                    46040000
                                                                        46050000
           EVALUATE TRUE                                                46060000
               WHEN SQLCODE = ZERO                                      46070000
                   CONTINUE                                             46080000
               WHEN SQLWARN0 NOT EQUAL SPACE                            46090000
               WHEN SQLCODE NOT EQUAL ZERO                              46100000
                   MOVE '7120-CLOSE-LATE-COR-CURSOR'                    46110000
                                                  TO PV-PARAGRAPH-NAME  46120000
                   MOVE 'ERROR ON CLOSING LATE COR CURSOR '             46130000
                                                  TO PV-DB2-OPERATION   46140000
                   PERFORM 9200-SQL-ABEND                               46150000
           END-EVALUATE.                                                46160000
                                                                        49260000
      ***************************************************************** 49270000
      *  OPEN THE LATE VOID CURSOR.                                     49280000
      ***************************************************************** 49290000
       7800-OPEN-LATE-VOID-CURSOR.                                      49300000
                                                                        49310000
           EXEC SQL                                                     49320000
               OPEN LATE-VOID-CSR                                       49330000
           END-EXEC.                                                    49340000
                                                                        49350000
           EVALUATE TRUE                                                49360000
               WHEN SQLCODE = ZERO                                      49370000
                   CONTINUE                                             49380000
               WHEN SQLWARN0 NOT EQUAL SPACE                            49390000
               WHEN SQLCODE NOT EQUAL ZERO                              49400000
                   MOVE '7800-OPEN-LATE-VOID-CURSOR'                    49410000
                                                  TO PV-PARAGRAPH-NAME  49420000
                   MOVE 'ERROR ON OPENING LATE VOID CURSOR '            49430000
                                                  TO PV-DB2-OPERATION   49440000
                   PERFORM 9200-SQL-ABEND                               49450000
           END-EVALUATE.                                                49460000
                                                                        49470000
      ******************************************************************49480000
      *  FETCH THE LATE VOID TRANSACTIONS                               49490000
      ******************************************************************49500000
       7810-FETCH-LATE-VOID-CURSOR.                                     49510000
                                                                        49520000
                                                                        49550000
           EXEC SQL                                                     49560000
               FETCH LATE-VOID-CSR                                      49570000
               INTO                                                     49580000
                    :EPTRN-PARTN-NBR                                    49580100
                   ,:EPTRN-STR-NBR                                      49580200
                   ,:EPTRN-RGST-ID                                      49580300
                   ,:EPTRN-TRN-NBR                                      49580400
                   ,:EPTRN-SLS-CORR-SEQ-NBR                             49580500
                   ,:EPTRN-STRT-TM                                      49580600
                   ,:EPTRN-TRN-STAT-CDE                                 49580700
                   ,:EPTRN-VOID-ABRT-CDE                                49580800
                   ,:EPTRN-TRN-TYP-CDE                                  49580900
                   ,:EPTRN-SLS-DTE                                      49581000
                   ,:EPTRN-TRN-DTE                                      49581100
                   ,:EPTRN-PRCG-DTE                                     49581200
                   ,:EPTRN-ASSOC-ID                                     49581300
                   ,:EPTRN-POS-CPBL-LVL-NBR                             49581400
                   ,:EPPAY-STTLMNT-PRCD-CDE                             49581500
                   ,:EPPAY-KC-ACCT-NBR                                  49581600
                   ,:EPPAY-KC-ACCT-SRC-CDE                              49581700
                   ,:EPPAY-PAYT-AMT                                     49581800
                   ,:EPPAY-AUTH-NBR                                     49581900
                   ,:EPPAY-AUTH-TYP-CDE                                 49582000
                   ,:EPPAY-AUTH-APVL-CDE                                49582100
                   ,:EPPAY-AUTH-SRC-CDE                                 49582200
                   ,:EPTND-TNDR-SEQ-NBR                                 49582400
                   ,:EPTND-TNDR-VOID-IND                                49582500
                   ,:EPTND-TNDR-TYP-CDE                                 49582600
                   ,:EPTND-TNDR-ID                                      49582700
                   ,:EPTND-TNDR-AMT                                     49582800
                   ,:EPTND-TNDR-ID-SRC-CDE                              49582900
                   ,:EPTND-TNDR-ID-LEN-NBR                              49583000
                   ,:EPTND-TNDR-ID-ERR-CDE                              49583100
           END-EXEC.                                                    49850000
                                                                        49860000
           EVALUATE TRUE                                                49870000
               WHEN SQLCODE = ZERO                                      49880000
                   ADD +1               TO PA-LATE-VOID-ROWS-FETCHED    49890000
                   MOVE EPTRN-PARTN-NBR TO PV-PARTN-NBR                 49900000
                   MOVE EPTRN-STRT-TM   TO PV-STRT-TM                   49910000
                   MOVE EPTRN-SLS-CORR-SEQ-NBR                          49920000
                                        TO PV-SEQ-NBR                   49930000
      *  MOVING 'V' HERE BECAUSE ABENDS AND TRANSACTIONS THAT COME      49940000
      *  THROUGH DATA COLLECT IN THE WRONG ORDER WILL NOT HAVE THE      49950000
      *  VOID ABORT CODE SET.                                           49960000
                   MOVE 'V'             TO EPTRN-VOID-ABRT-CDE          49970000
               WHEN SQLCODE = +100                                      49980000
                   SET PS-END-OF-LATE-VOID-CURSOR                       49990000
                                        TO TRUE                         50000000
               WHEN SQLWARN0 NOT EQUAL SPACE                            50010000
               WHEN SQLCODE NOT EQUAL ZERO                              50020000
                   MOVE '7810-FETCH-LATE-VOID-CURSOR'                   50030000
                                                  TO PV-PARAGRAPH-NAME  50040000
                   MOVE 'ERROR ON FETCHING LATE VOID CURSOR '           50050000
                                                  TO PV-DB2-OPERATION   50060000
                   PERFORM 9200-SQL-ABEND                               50070000
           END-EVALUATE.                                                50080000
                                                                        50090000
      ***************************************************************** 50100000
      *  CLOSE THE LATE VOID CURSOR                                     50110000
      ***************************************************************** 50120000
       7820-CLOSE-LATE-VOID-CURSOR.                                     50130000
                                                                        50140000
           EXEC SQL                                                     50150000
               CLOSE LATE-VOID-CSR                                      50160000
           END-EXEC.                                                    50170000
                                                                        50180000
           EVALUATE TRUE                                                50190000
               WHEN SQLCODE = ZERO                                      50200000
                   CONTINUE                                             50210000
               WHEN SQLWARN0 NOT EQUAL SPACE                            50220000
               WHEN SQLCODE NOT EQUAL ZERO                              50230000
                   MOVE '7820-CLOSE-LATE-VOID-CURSOR'                   50240000
                                                  TO PV-PARAGRAPH-NAME  50250000
                   MOVE 'ERROR ON CLOSING LATE VOID CURSOR '            50260000
                                                  TO PV-DB2-OPERATION   50270000
                   PERFORM 9200-SQL-ABEND                               50280000
           END-EVALUATE.                                                50290000
                                                                        50300000
      ******************************************************************50310000
      *  WRITE AN ACCOUNT PAYMENT TRANSACTION RECORD.                   50320000
      ******************************************************************50330000
       8000-WRITE-AR-RECORD.                                            50340000
                                                                        50350000
           WRITE AR-ACCT-PAYMENTS-RECORD                                50360000
               FROM AR-OUTPUT-FILE.                                     50370000
                                                                        50380000
           WRITE AR-ACCT-PAYMENTS-CSV-RECORD                            50381000
               FROM AR-OUTPUT-FILE-CSV.                                 50382000
                                                                        50383000
           ADD +1 TO PA-RECORDS-WRITTEN.                                50390000
                                                                        50400000
      ******************************************************************50410000
      *  WRITE AN ACCOUNT PAYMENT TRANSACTION RECORD HEADER             50420000
      ******************************************************************50430000
       8001-WRITE-AR-RECORD-HEADER.                                     50440000
                                                                        50450000
           WRITE AR-ACCT-PAYMENTS-RECORD                                50460000
               FROM AR-HEADER-FILE.                                     50470000
                                                                        50480000
      ******************************************************************50490000
      *  WRITE AN ACCOUNT PAYMENT TRANSACTION RECORD TRAILER            50500000
      ******************************************************************50510000
       8002-WRITE-AR-RECORD-TRAILER.                                    50520000
                                                                        50521000
           WRITE AR-ACCT-PAYMENTS-RECORD                                50522000
               FROM AR-TRAILER-FILE.                                    50523000
                                                                        50524000
      ******************************************************************51560000
      *  CLOSE ALL FILES.                                              *51570000
      ******************************************************************51580000
       9000-EOJ-ROUTINE.                                                51590000
                                                                        51600000
           DISPLAY ' '.                                                 51610000
           DISPLAY '************** CONTROL TOTALS ***************'.     51620000
           DISPLAY ' '.                                                 51630000
           DISPLAY 'LATE VOID TRANSACTIONS============ '                51640000
                    PA-LATE-VOID-ROWS-FETCHED.                          51650000
           DISPLAY 'LATE AND CORRECTION TRANSACTIONS== '                51660000
                    PA-LATE-COR-ROWS-FETCHED.                           51670000
           DISPLAY 'CURRENT TRANSACTIONS============== '                51680000
                    PA-TRANSACTIONS-FETCHED.                            51690000
           DISPLAY 'DETAIL RECORDS WRITTEN TO AR FILE= '                51700000
                    PA-RECORDS-WRITTEN.                                 51710000
                                                                        51720000
           MOVE PA-RECORDS-WRITTEN TO ARPAY-RECORD-COUNT.               51720100
           PERFORM 8002-WRITE-AR-RECORD-TRAILER.                        51721000
           CLOSE ACCOUNT-PAYMENT-FILE.                                  51730000
           CLOSE ACCOUNT-PAYMENT-CSV-FILE.                              51731000
                                                                        51740000
      ******************************************************************51880000
      * 9200-SQL-ABEND                                                  51890000
      *     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.51900000
      ******************************************************************51910000
       9200-SQL-ABEND.                                                  51920000
                                                                        51930000
           DISPLAY '** ABEND        **'.                                51940000
           DISPLAY '** PROGRAM      ** = ' PC-CURRENT-PROGRAM-NAME.     51950000
           DISPLAY '** PARAGRAPH    ** = ' PV-PARAGRAPH-NAME.           51960000
           DISPLAY '** OPERATION    ** = ' PV-DB2-OPERATION.            51970000
                                                                        51980000
      ******************************************************************51990000
      * COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     52000000
      * TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      52010000
      ******************************************************************52020000
           COPY DPPD004.                                                52030000
                                                                        52040000
           SET AC-DB2-ERROR TO TRUE.                                    52050000
           CALL 'ILBOABN0' USING AC-ABEND-CODE.                         52060000
                                                                        52070000
042922******************************************************************52080002
042922* COPY MEMBER DPPD031 CONTAINS STATEMENTS NEEDED TO INVOKE      * 52090002
042922* PROTEGRITY MODULE FOR PROTECTION / UNPROTECTION               * 52100002
042922******************************************************************52110002
042922     COPY DPPD031.                                                52120002
                                                                        52130001
