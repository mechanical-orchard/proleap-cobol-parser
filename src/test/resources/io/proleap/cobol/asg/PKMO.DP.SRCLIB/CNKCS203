000100 IDENTIFICATION DIVISION.                                         04/23/94
000200 PROGRAM-ID.    CNKCS203.                                         CNKCS203
000300 AUTHOR.        TOM RUSKA. G&R.                                      LV002
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          CNKCS203
000500 DATE-WRITTEN.  04-30-93.                                         CNKCS203
000600 DATE-COMPILED.                                                   CNKCS203
000700                                                                  CNKCS203
000800*---------------------------------------------------------------* CNKCS203
000900*    Y203 - TICKET FORMAT LIST.                                 * CNKCS203
001000*                                                               * CNKCS203
001100*    THIS PROGRAM GENERATES A LIST OF PREVIOUSLY DEFINED TICKET * CNKCS203
001200*    FORMATS WITHIN A FACILITY.                                 * CNKCS203
001300*    RECORDS CAN BE SELECTED FOR UPDATE AND DELETE.  ADD IS ALSO* CNKCS203
001400*    ALLOWED.  THE APPROPRIATE PROGRAM IS INVOKED WHEN THE      * CNKCS203
001500*    OPERATOR SELECTS ONE OR MORE ITEMS AND PRESSES A FUNCTION  * CNKCS203
001600*    KEY.  NO SELECTION IS NECESSARY TO ADD A LOCATION.         * CNKCS203
001700*                                                               * CNKCS203
001800*---------------------------------------------------------------* CNKCS203
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455                 
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263455* MAKING THE CALL DYNAMIC VS STATIC.                                      
263455*----------------------------------------------------------------*        
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001900                                                                  CNKCS203
002000/                                                                 CNKCS203
002100 ENVIRONMENT DIVISION.                                            CNKCS203
002200                                                                  CNKCS203
002300 DATA DIVISION.                                                   CNKCS203
002400                                                                  CNKCS203
002500 WORKING-STORAGE SECTION.                                         CNKCS203
002600                                                                  CNKCS203
002700 01  DK-DB2-KEYS.                                                 CNKCS203
002800     05  DK-OPER-UNT-ID                 PIC  S9(04) COMP.         CNKCS203
002900     05  DK-FCLTY-ID-LOW                PIC  S9(04) COMP.         CNKCS203
003000     05  DK-FCLTY-ID-HIGH               PIC  S9(04) COMP.         CNKCS203
003100     05  DK-FCLTY-ID                    PIC  S9(04) COMP.         CNKCS203
003200     05  DK-TKT-FMT-ID-LOW              PIC  X(06).               CNKCS203
003300     05  DK-TKT-FMT-ID-HIGH             PIC  X(06).               CNKCS203
003400                                                                  CNKCS203
003500 01  DN-DB2-NULL-INDICATORS.                                      CNKCS203
003600     05  DN-CMPANON-OPER-UNT-ID         PIC S9(04) VALUE +0       CNKCS203
003700                                                    COMP.         CNKCS203
003800     05  DN-CMPANON-FCLTY-ID            PIC S9(04) VALUE +0       CNKCS203
003900                                                    COMP.         CNKCS203
004000     05  DN-CMPANON-TKT-ID              PIC S9(04) VALUE +0       CNKCS203
004100                                                    COMP.         CNKCS203
004200                                                                  CNKCS203
004300 01  PC-PROGRAM-CONSTANTS.                                        CNKCS203
004400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         CNKCS203
004500                                                    'CN203A  '.   CNKCS203
004600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         CNKCS203
004700                                                    'CNKM203 '.   CNKCS203
004800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         CNKCS203
004900                                                    'CNKCS203'.   CNKCS203
005000     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      CNKCS203
005100     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      CNKCS203
005200     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    CNKCS203
005300     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     CNKCS203
005400                                                    COMP SYNC.    CNKCS203
005500     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      CNKCS203
005600                                                    COMP SYNC.    CNKCS203
005700     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         CNKCS203
005800                                                    +1000000      CNKCS203
005900                                                    COMP-3.       CNKCS203
006000     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      CNKCS203
006100                                                    COMP SYNC.    CNKCS203
006200     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      CNKCS203
006300                                                    COMP-3.       CNKCS203
006400     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    CNKCS203
006500     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  CNKCS203
006600     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  CNKCS203
006700     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  CNKCS203
006800     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  CNKCS203
006900     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  CNKCS203
007000                                                                  CNKCS203
007100     05  PC-TSYMSG-NUMBERS.                                       CNKCS203
007200         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  CNKCS203
007300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  CNKCS203
007400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  CNKCS203
007500         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  CNKCS203
007600         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  CNKCS203
007700         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  CNKCS203
007800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  CNKCS203
007900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  CNKCS203
008000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  CNKCS203
008100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  CNKCS203
008200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  CNKCS203
008300         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  CNKCS203
008400         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  CNKCS203
008500                                                                  CNKCS203
008600 01  PS-PROGRAM-SWITCHES.                                         CNKCS203
008700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    CNKCS203
008800         88  PS-NO-ERROR                            VALUE 'Y'.    CNKCS203
008900         88  PS-ERROR                               VALUE 'N'.    CNKCS203
009000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    CNKCS203
009100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    CNKCS203
009200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    CNKCS203
009300     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    CNKCS203
009400         88  PS-DONE                                VALUE 'Y'.    CNKCS203
009500         88  PS-NOT-DONE                            VALUE 'N'.    CNKCS203
009600                                                                  CNKCS203
009700 01  PV-PROGRAM-VARIABLES.                                        CNKCS203
009800     05  PV-SUB                         PIC S9(04)  VALUE +0      CNKCS203
009900                                                    COMP SYNC.    CNKCS203
010000     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      CNKCS203
010100                                                    COMP SYNC.    CNKCS203
010200     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      CNKCS203
010300                                                    COMP-3.       CNKCS203
010400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      CNKCS203
010500                                                    COMP-3.       CNKCS203
010600     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      CNKCS203
010700                                                    COMP-3.       CNKCS203
010800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      CNKCS203
010900                                                    COMP-3.       CNKCS203
011000     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      CNKCS203
011100                                                    COMP-3.       CNKCS203
011200     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      CNKCS203
011300                                                    COMP-3.       CNKCS203
011400     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      CNKCS203
011500                                                    COMP-3.       CNKCS203
011600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      CNKCS203
011700                                                    COMP SYNC.    CNKCS203
011800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      CNKCS203
011900                                                    COMP SYNC.    CNKCS203
012000     05  PV-ITEM                        PIC S9(04)  VALUE +0      CNKCS203
012100                                                    COMP SYNC.    CNKCS203
012200     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      CNKCS203
012300                                                    COMP SYNC.    CNKCS203
012400     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      CNKCS203
012500                                                    COMP SYNC.    CNKCS203
012600     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      CNKCS203
012700                                                    COMP SYNC.    CNKCS203
012800     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      CNKCS203
012900                                                    COMP SYNC.    CNKCS203
013000     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      CNKCS203
013100                                                    COMP SYNC.    CNKCS203
013200     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      CNKCS203
013300                                                    COMP SYNC.    CNKCS203
013400     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      CNKCS203
013500                                                    COMP SYNC.    CNKCS203
013600     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      CNKCS203
013700                                                    COMP SYNC.    CNKCS203
013800     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      CNKCS203
013900                                                    COMP SYNC.    CNKCS203
014000     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      CNKCS203
014100                                                    COMP SYNC.    CNKCS203
014200     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      CNKCS203
014300                                                    COMP SYNC.    CNKCS203
014400     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      CNKCS203
014500                                                    COMP SYNC.    CNKCS203
014600                                                                  CNKCS203
014700*---------------------------------------------------------------* CNKCS203
014800*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * CNKCS203
014900*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * CNKCS203
015000*   APPLICATION-SPECIFIC COMMAREA.                              * CNKCS203
015100*---------------------------------------------------------------* CNKCS203
015200 01  LQW-LIST-QUEUE-WORK-AREA.                                    CNKCS203
015300     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  CNKCS203
015400     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           CNKCS203
015500                                        INDEXED BY LQW-IDX.       CNKCS203
015600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       CNKCS203
015700         10  LQW-TEMP-SELECTED-SW       PIC X(01).                CNKCS203
015800         10  LQW-SELECTED-SW            PIC X(01).                CNKCS203
015900             88  LQW-SELECT                         VALUE 'S'.    CNKCS203
016000             88  LQW-DESELECT                       VALUE ' '.    CNKCS203
016100         10  LQW-ACTION                 PIC X(03).                CNKCS203
016200         10  LQW-FCLTY-ID               PIC 9(04).                CNKCS203
016300         10  LQW-FORMAT                 PIC X(06).                CNKCS203
016400         10  LQW-DESC                   PIC X(06).                CNKCS203
016500         10  LQW-TYP                    PIC X(01).                CNKCS203
016600         10  LQW-TYPE                   PIC X(04).                CNKCS203
016700         10  LQW-APPL                   PIC X(01).                CNKCS203
016800         10  LQW-TTYP                   PIC X(01).                CNKCS203
016900         10  LQW-NR                     PIC 9(03).                CNKCS203
017000         10  LQW-STKR                   PIC X(06).                CNKCS203
017100         10  LQW-TEXT                   PIC X(01).                CNKCS203
017200         10  LQW-SIZE                   PIC X(01).                CNKCS203
017300         10  LQW-COLOR                  PIC X(01).                CNKCS203
017400         10  LQW-PRICE                  PIC X(01).                CNKCS203
017500         10  LQW-OPER-UNT-ID            PIC 9(04).                CNKCS203
017600                                                                  CNKCS203
017700/                                                                 CNKCS203
017800*---------------------------------------------------------------* CNKCS203
017900*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * CNKCS203
018000*---------------------------------------------------------------* CNKCS203
018100                                                                  CNKCS203
018200     COPY CNWS004.                                                CNKCS203
018300                                                                  CNKCS203
018400/                                                                 CNKCS203
018500*---------------------------------------------------------------* CNKCS203
018600*    MAP LAYOUT                                                 * CNKCS203
018700*---------------------------------------------------------------* CNKCS203
018800                                                                  CNKCS203
018900     COPY CNKM203.                                                CNKCS203
019000                                                                  CNKCS203
019100 01  MR-OCCURS-LAYOUT                   REDEFINES  CN203AO.       CNKCS203
019200     05  FILLER                         PIC X(48).                CNKCS203
019300                                                                  CNKCS203
019400     05  MR-OPERL                       PIC S9(04) COMP.          CNKCS203
019500     05  MR-OPERA                       PIC X(01).                CNKCS203
019600     05  MR-OPERC                       PIC X(01).                CNKCS203
019700     05  MR-OPERH                       PIC X(01).                CNKCS203
019800     05  MR-OPER                        PIC X(04).                CNKCS203
019900                                                                  CNKCS203
020000     05  MR-FCLTYL                      PIC S9(04) COMP.          CNKCS203
020100     05  MR-FCLTYA                      PIC X(01).                CNKCS203
020200     05  MR-FCLTYC                      PIC X(01).                CNKCS203
020300     05  MR-FCLTYH                      PIC X(01).                CNKCS203
020400     05  MR-FCLTY                       PIC X(04).                CNKCS203
020500                                                                  CNKCS203
020600     05  MR-FDESCL                      PIC S9(04) COMP.          CNKCS203
020700     05  MR-FDESCA                      PIC X(01).                CNKCS203
020800     05  MR-FDESCC                      PIC X(01).                CNKCS203
020900     05  MR-FDESCH                      PIC X(01).                CNKCS203
021000     05  MR-FDESC                       PIC X(25).                CNKCS203
021100                                                                  CNKCS203
021200     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          CNKCS203
021300         10  MR-SELECTL                 PIC S9(04) COMP.          CNKCS203
021400         10  MR-SELECTA                 PIC X(01).                CNKCS203
021500         10  MR-SELECTC                 PIC X(01).                CNKCS203
021600         10  MR-SELECTH                 PIC X(01).                CNKCS203
021700         10  MR-SELECT                  PIC X(01).                CNKCS203
021800                                                                  CNKCS203
021900         10  MR-ACTIONL                 PIC S9(04) COMP.          CNKCS203
022000         10  MR-ACTIONA                 PIC X(01).                CNKCS203
022100         10  MR-ACTIONC                 PIC X(01).                CNKCS203
022200         10  MR-ACTIONH                 PIC X(01).                CNKCS203
022300         10  MR-ACTION                  PIC X(03).                CNKCS203
022400                                                                  CNKCS203
022500         10  MR-FACL                    PIC S9(04) COMP.          CNKCS203
022600         10  MR-FACA                    PIC X(01).                CNKCS203
022700         10  MR-FACC                    PIC X(01).                CNKCS203
022800         10  MR-FACH                    PIC X(01).                CNKCS203
022900         10  MR-FCLTY-ID                PIC X(04).                CNKCS203
023000                                                                  CNKCS203
023100         10  MR-FORMATL                 PIC S9(04) COMP.          CNKCS203
023200         10  MR-FORMATA                 PIC X(01).                CNKCS203
023300         10  MR-FORMATC                 PIC X(01).                CNKCS203
023400         10  MR-FORMATH                 PIC X(01).                CNKCS203
023500         10  MR-FORMAT                  PIC X(06).                CNKCS203
023600                                                                  CNKCS203
023700         10  MR-DESCL                   PIC S9(04) COMP.          CNKCS203
023800         10  MR-DESCA                   PIC X(01).                CNKCS203
023900         10  MR-DESCC                   PIC X(01).                CNKCS203
024000         10  MR-DESCH                   PIC X(01).                CNKCS203
024100         10  MR-DESC                    PIC X(06).                CNKCS203
024200                                                                  CNKCS203
024300         10  MR-TYPL                    PIC S9(04) COMP.          CNKCS203
024400         10  MR-TYPA                    PIC X(01).                CNKCS203
024500         10  MR-TYPC                    PIC X(01).                CNKCS203
024600         10  MR-TYPH                    PIC X(01).                CNKCS203
024700         10  MR-TYP                     PIC X(01).                CNKCS203
024800                                                                  CNKCS203
024900         10  MR-TYPEL                   PIC S9(04) COMP.          CNKCS203
025000         10  MR-TYPEA                   PIC X(01).                CNKCS203
025100         10  MR-TYPEC                   PIC X(01).                CNKCS203
025200         10  MR-TYPEH                   PIC X(01).                CNKCS203
025300         10  MR-TYPE                    PIC X(04).                CNKCS203
025400                                                                  CNKCS203
025500         10  MR-APPLL                   PIC S9(04) COMP.          CNKCS203
025600         10  MR-APPLA                   PIC X(01).                CNKCS203
025700         10  MR-APPLC                   PIC X(01).                CNKCS203
025800         10  MR-APPLH                   PIC X(01).                CNKCS203
025900         10  MR-APPL                    PIC X(01).                CNKCS203
026000                                                                  CNKCS203
026100         10  MR-TTYPL                   PIC S9(04) COMP.          CNKCS203
026200         10  MR-TTYPA                   PIC X(01).                CNKCS203
026300         10  MR-TTYPC                   PIC X(01).                CNKCS203
026400         10  MR-TTYPH                   PIC X(01).                CNKCS203
026500         10  MR-TTYP                    PIC X(01).                CNKCS203
026600                                                                  CNKCS203
026700         10  MR-NRL                     PIC S9(04) COMP.          CNKCS203
026800         10  MR-NRA                     PIC X(01).                CNKCS203
026900         10  MR-NRC                     PIC X(01).                CNKCS203
027000         10  MR-NRH                     PIC X(01).                CNKCS203
027100         10  MR-NR-X.                                             CNKCS203
027200             15  MR-NR                  PIC ZZ9.                  CNKCS203
027300                                                                  CNKCS203
027400         10  MR-STKRL                   PIC S9(04) COMP.          CNKCS203
027500         10  MR-STKRA                   PIC X(01).                CNKCS203
027600         10  MR-STKRC                   PIC X(01).                CNKCS203
027700         10  MR-STKRH                   PIC X(01).                CNKCS203
027800         10  MR-STKR                    PIC X(06).                CNKCS203
027900                                                                  CNKCS203
028000         10  MR-TEXTL                   PIC S9(04) COMP.          CNKCS203
028100         10  MR-TEXTA                   PIC X(01).                CNKCS203
028200         10  MR-TEXTC                   PIC X(01).                CNKCS203
028300         10  MR-TEXTH                   PIC X(01).                CNKCS203
028400         10  MR-TEXT                    PIC X(01).                CNKCS203
028500                                                                  CNKCS203
028600         10  MR-SIZEL                   PIC S9(04) COMP.          CNKCS203
028700         10  MR-SIZEA                   PIC X(01).                CNKCS203
028800         10  MR-SIZEC                   PIC X(01).                CNKCS203
028900         10  MR-SIZEH                   PIC X(01).                CNKCS203
029000         10  MR-SIZE                    PIC X(01).                CNKCS203
029100                                                                  CNKCS203
029200         10  MR-COLORL                  PIC S9(04) COMP.          CNKCS203
029300         10  MR-COLORA                  PIC X(01).                CNKCS203
029400         10  MR-COLORC                  PIC X(01).                CNKCS203
029500         10  MR-COLORH                  PIC X(01).                CNKCS203
029600         10  MR-COLOR                   PIC X(01).                CNKCS203
029700                                                                  CNKCS203
029800         10  MR-PRICEL                  PIC S9(04) COMP.          CNKCS203
029900         10  MR-PRICEA                  PIC X(01).                CNKCS203
030000         10  MR-PRICEC                  PIC X(01).                CNKCS203
030100         10  MR-PRICEH                  PIC X(01).                CNKCS203
030200         10  MR-PRICE                   PIC X(01).                CNKCS203
030300                                                                  CNKCS203
030400/                                                                 CNKCS203
030500*---------------------------------------------------------------* CNKCS203
030600*    ATTRIBUTE SETTINGS COPYBOOK.                               * CNKCS203
030700*---------------------------------------------------------------* CNKCS203
030800                                                                  CNKCS203
030900     COPY DPWS015.                                                CNKCS203
031000                                                                  CNKCS203
031100*---------------------------------------------------------------* CNKCS203
031200*    FUNCTION KEYS COPYBOOK.                                    * CNKCS203
031300*---------------------------------------------------------------* CNKCS203
031400                                                                  CNKCS203
031500     COPY DPWS016.                                                CNKCS203
031600                                                                  CNKCS203
031700*---------------------------------------------------------------* CNKCS203
031800*    NUMERIC EDIT LAYOUT.                                       * CNKCS203
031900*---------------------------------------------------------------* CNKCS203
032000                                                                  CNKCS203
032100     COPY DPWS010I.                                               CNKCS203
032200                                                                  CNKCS203
032300/                                                                 CNKCS203
032400*---------------------------------------------------------------* CNKCS203
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *         
032600*---------------------------------------------------------------* CNKCS203
032700                                                                  CNKCS203
032800     COPY DPWS030.                                                CNKCS203
CICS       COPY DPWS930.                                                        
032900                                                                  CNKCS203
033000/                                                                 CNKCS203
033100*---------------------------------------------------------------* CNKCS203
033200*    STANDARD COMMAREA.                                         * CNKCS203
033300*---------------------------------------------------------------* CNKCS203
033400                                                                  CNKCS203
033500     COPY DPWS020.                                                CNKCS203
033600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                CNKCS203
033700                                                                  CNKCS203
033800*---------------------------------------------------------------* CNKCS203
033900* INTER-APPLICATION COMMAREA.                                   * CNKCS203
034000*   CNWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * CNKCS203
034100*             SPEC SCREEN.                                      * CNKCS203
034200*   CNWS003 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * CNKCS203
034300*             THIS LIST PROGRAM FOR A LOCAL-GO FUNCTION.        * CNKCS203
034400*---------------------------------------------------------------* CNKCS203
034500                                                                  CNKCS203
034600         10  INTER-APPL-COMM-AREA       PIC X(200).               CNKCS203
034700     COPY CNWS001.                                                CNKCS203
034800     COPY CNWS003.                                                CNKCS203
034900*---------------------------------------------------------------* CNKCS203
035000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * CNKCS203
035100*---------------------------------------------------------------* CNKCS203
035200         10  ASC-SPECIFIC-COMMAREA.                               CNKCS203
035300             15  ASC-LIST-KEYS.                                   CNKCS203
035400                 20  ASC-KEY-OPER-UNT-ID   PIC S9(04) COMP.       CNKCS203
035500                 20  ASC-KEY-FCLTY-ID-LOW  PIC S9(04) COMP.       CNKCS203
035600                 20  ASC-KEY-FCLTY-ID-HIGH PIC S9(04) COMP.       CNKCS203
035700                 20  ASC-KEY-FCLTY-ID      PIC S9(04) COMP.       CNKCS203
035800                 20  ASC-KEY-FMT-ID-LOW    PIC X(06).             CNKCS203
035900                 20  ASC-KEY-FMT-ID-HIGH   PIC X(06).             CNKCS203
036000             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           CNKCS203
036100                 20  ASC-BLOCK-MODIFIED-SW                        CNKCS203
036200                                        PIC X(01).                CNKCS203
036300                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     CNKCS203
036400                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     CNKCS203
036500                                                                  CNKCS203
036600                 20  ASC-ITEM-ARRAY.                              CNKCS203
036700                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        CNKCS203
036800                         30  ASC-LIST-ITEM-NUMBER                 CNKCS203
036900                                        PIC S9(09) COMP-3.        CNKCS203
037000                         30  ASC-TEMP-SELECTED-SW                 CNKCS203
037100                                        PIC X(01).                CNKCS203
037200                             88  ASC-VALID-SELECT  VALUE ' '      CNKCS203
037300                                                         'S'      CNKCS203
037400                                                         'B'      CNKCS203
037500                                                         'E'.     CNKCS203
037600                             88  ASC-TEMP-NO-SELECT               CNKCS203
037700                                                   VALUE ' '.     CNKCS203
037800                             88  ASC-TEMP-SELECT   VALUE 'S'.     CNKCS203
037900                             88  ASC-TEMP-BEGIN    VALUE 'B'.     CNKCS203
038000                             88  ASC-TEMP-END      VALUE 'E'.     CNKCS203
038100                         30  ASC-SELECTED-SW                      CNKCS203
038200                                        PIC X(01).                CNKCS203
038300                             88  ASC-NO-SELECT     VALUE ' '.     CNKCS203
038400                             88  ASC-SELECT        VALUE 'S'.     CNKCS203
038500                             88  ASC-BEGIN         VALUE 'B'.     CNKCS203
038600                             88  ASC-END           VALUE 'E'.     CNKCS203
038700                         30  ASC-ACTION PIC X(03).                CNKCS203
038800                         30  ASC-FCLTY-ID                         CNKCS203
038900                                        PIC 9(04).                CNKCS203
039000                         30  ASC-FORMAT PIC X(06).                CNKCS203
039100                         30  ASC-DESC   PIC X(06).                CNKCS203
039200                         30  ASC-TYP    PIC X(01).                CNKCS203
039300                         30  ASC-TYPE   PIC X(04).                CNKCS203
039400                         30  ASC-APPL   PIC X(01).                CNKCS203
039500                         30  ASC-TTYP   PIC X(01).                CNKCS203
039600                         30  ASC-NR     PIC 9(03).                CNKCS203
039700                         30  ASC-STKR   PIC X(06).                CNKCS203
039800                         30  ASC-TEXT   PIC X(01).                CNKCS203
039900                         30  ASC-SIZE   PIC X(01).                CNKCS203
040000                         30  ASC-COLOR  PIC X(01).                CNKCS203
040100                         30  ASC-PRICE  PIC X(01).                CNKCS203
040200                         30  ASC-OPER-UNT-ID                      CNKCS203
040300                                        PIC 9(04).                CNKCS203
040400                                                                  CNKCS203
040500             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     CNKCS203
040600             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     CNKCS203
040700             15  ASC-NUMBER-OF-ITEMS-READ                         CNKCS203
040800                                        PIC S9(09) COMP-3.        CNKCS203
040900             15  ASC-NUMBER-OF-SELECTED-ITEMS                     CNKCS203
041000                                        PIC S9(09) COMP-3.        CNKCS203
041100             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        CNKCS203
041200             15  ASC-ITEM-AT-TOP-OF-PANEL                         CNKCS203
041300                                        PIC S9(09) COMP-3.        CNKCS203
041400             15  ASC-ITEM-AT-BOT-OF-PANEL                         CNKCS203
041500                                        PIC S9(09) COMP-3.        CNKCS203
041600             15  ASC-HIGHEST-BLOCK-WRITTEN                        CNKCS203
041700                                        PIC S9(04) COMP SYNC.     CNKCS203
041800             15  ASC-START-OF-SELECTED-RANGE                      CNKCS203
041900                                        PIC S9(09) COMP-3.        CNKCS203
042000             15  ASC-END-OF-SELECTED-RANGE                        CNKCS203
042100                                        PIC S9(09) COMP-3.        CNKCS203
042200             15  ASC-ITEMS-LEFT-INDICATOR                         CNKCS203
042300                                        PIC X(01).                CNKCS203
042400                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     CNKCS203
042500                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     CNKCS203
042600             15  ASC-TEMP-QUEUE-UPDATE-SW                         CNKCS203
042700                                        PIC X(01).                CNKCS203
042800                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     CNKCS203
042900                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     CNKCS203
043000             15  ASC-LIST-QUEUE-NAME.                             CNKCS203
043100                 20  ASC-LIST-TERM-ID   PIC X(04).                CNKCS203
043200                 20  ASC-LIST-TASK-NUMBER                         CNKCS203
043300                                        PIC S9(05) COMP-3.        CNKCS203
043400                 20  ASC-LIST-SEQ       PIC 9(01).                CNKCS203
043500             15  ASC-SEL-QUEUE-NAME.                              CNKCS203
043600                 20  ASC-SEL-TERM-ID    PIC X(04).                CNKCS203
043700                 20  ASC-SEL-TASK-NUMBER                          CNKCS203
043800                                        PIC S9(05) COMP-3.        CNKCS203
043900                 20  ASC-SEL-SEQ        PIC 9(01).                CNKCS203
044000                                                                  CNKCS203
044100             15  ASC-CURSOR-SW          PIC X(01).                CNKCS203
044200                 88  ASC-NO-CURSOR                 VALUE 'Z'.     CNKCS203
044300                 88  ASC-TYPE-CURSOR               VALUE 'S'.     CNKCS203
044400                 88  ASC-LOC-CURSOR                VALUE 'N'.     CNKCS203
044500                 88  ASC-DESC-CURSOR               VALUE 'T'.     CNKCS203
044600             15  ASC-START-ITEM-REQUEST.                          CNKCS203
044700                 20  ASC-START-ITEM-REQUEST-N                     CNKCS203
044800                                        PIC 9(07).                CNKCS203
044900             15  ASC-FCLTY-NME          PIC X(25).                CNKCS203
045000/                                                                 CNKCS203
045100*---------------------------------------------------------------* CNKCS203
045200*    ABEND PROCESSING COPYBOOK.                                 * CNKCS203
045300*---------------------------------------------------------------* CNKCS203
045400                                                                  CNKCS203
045500     COPY DPWS013.                                                CNKCS203
045600                                                                  CNKCS203
045700/                                                                 CNKCS203
045800*---------------------------------------------------------------* CNKCS203
045900*    DB2 AREA FOR THE TICKET FORMAT TABLE                       * CNKCS203
046000*---------------------------------------------------------------* CNKCS203
046100     EXEC SQL                                                     CNKCS203
046200          INCLUDE TTKTFMT                                         CNKCS203
046300     END-EXEC.                                                    CNKCS203
046400                                                                  CNKCS203
046500/                                                                 CNKCS203
046600*---------------------------------------------------------------* CNKCS203
046700*    DB2 AREA FOR THE PRINT STOCK TYPE TABLE                    * CNKCS203
046800*---------------------------------------------------------------* CNKCS203
046900     EXEC SQL                                                     CNKCS203
047000          INCLUDE TPRTSTK                                         CNKCS203
047100     END-EXEC.                                                    CNKCS203
047200                                                                  CNKCS203
047300/                                                                 CNKCS203
047400*---------------------------------------------------------------* CNKCS203
047500*    COMMAREA USED TO CALL XLKUT071                             * CNKCS203
047600*---------------------------------------------------------------* CNKCS203
047700     COPY XLWS071.                                                CNKCS203
048000                                                                  CNKCS203
048100/                                                                 CNKCS203
048200*---------------------------------------------------------------* CNKCS203
048300*    DB2 AREA FOR COMMUNICATIONS                                * CNKCS203
048400*---------------------------------------------------------------* CNKCS203
048500     EXEC SQL                                                     CNKCS203
048600          INCLUDE SQLCA                                           CNKCS203
048700     END-EXEC.                                                    CNKCS203
048800                                                                  CNKCS203
048900/                                                                 CNKCS203
049000*---------------------------------------------------------------* CNKCS203
049100*    TICKET-CSR FOR SELECT OF ALL TICKET FORMATS WITHIN STORE   * CNKCS203
049200*---------------------------------------------------------------* CNKCS203
049300                                                                  CNKCS203
049400     EXEC SQL                                                     CNKCS203
049500          DECLARE TICKET-CSR CURSOR FOR                           CNKCS203
049600           SELECT FCLTY_ID                                        CNKCS203
049700                 ,TKT_FMT_ID                                      CNKCS203
049800                 ,TKT_FMT_DESC                                    CNKCS203
049900                 ,TYP_CDE                                         CNKCS203
050000                 ,OPT_BLK_TAGS_IND                                   CL**2
050100                 ,PRT_SIZE_IND                                    CNKCS203
050200                 ,PRT_COLOR_IND                                   CNKCS203
050300                 ,PRT_GP_PR_IND                                   CNKCS203
050400                 ,CMPANON_TKT_ID                                  CNKCS203
050500                 ,PAPER_TYP_ID                                    CNKCS203
050600             FROM TTKTFMT                                         CNKCS203
050700            WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                   CNKCS203
050800              AND FCLTY_ID  BETWEEN :DK-FCLTY-ID-LOW              CNKCS203
050900                                AND :DK-FCLTY-ID-HIGH             CNKCS203
051000              AND VALUE (TKT_FMT_ID, '      ')                    CNKCS203
051100                            BETWEEN :DK-TKT-FMT-ID-LOW            CNKCS203
051200                                AND :DK-TKT-FMT-ID-HIGH           CNKCS203
051300         ORDER BY FCLTY_ID                                        CNKCS203
051400                 ,TKT_FMT_ID                                      CNKCS203
051500                 ,PAPER_TYP_ID                                    CNKCS203
051600     END-EXEC.                                                    CNKCS203
051700                                                                  CNKCS203
051800/                                                                 CNKCS203
051900 LINKAGE SECTION.                                                 CNKCS203
052000                                                                  CNKCS203
052100 01  DFHCOMMAREA.                                                 CNKCS203
052200     05  FILLER                         OCCURS  1 TO 4072 TIMES   CNKCS203
052300                                        DEPENDING ON EIBCALEN.    CNKCS203
052400         10  FILLER                     PIC X.                    CNKCS203
052500                                                                  CNKCS203
052600/                                                                 CNKCS203
052700 PROCEDURE DIVISION.                                              CNKCS203
052800*---------------------------------------------------------------* CNKCS203
052900*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * CNKCS203
053000*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * CNKCS203
053100*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * CNKCS203
053200*---------------------------------------------------------------* CNKCS203
053300 0000-MAIN-MODULE.                                                CNKCS203
053400                                                                  CNKCS203
053500     INITIALIZE DP030-CICS-API-FIELDS.                            CNKCS203
053600                                                                  CNKCS203
053700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       CNKCS203
053800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          CNKCS203
053900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         CNKCS203
054000                                                                  CNKCS203
054100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       CNKCS203
054200                                                                  CNKCS203
054300     MOVE LENGTH OF CN203AI        TO DP030-MAP-LENGTH (1).       CNKCS203
054400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     CNKCS203
054500                                                                  CNKCS203
054600     PERFORM 0001-CALL-CICS-ARCH-API.                             CNKCS203
054700     PERFORM 1000-CONTROL-PROCESSING                              CNKCS203
054800                                                                  CNKCS203
054900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     CNKCS203
055000     PERFORM 0001-CALL-CICS-ARCH-API.                             CNKCS203
055100                                                                  CNKCS203
055200*---------------------------------------------------------------* CNKCS203
055300*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * CNKCS203
055400*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * CNKCS203
055500*---------------------------------------------------------------* CNKCS203
055600 0001-CALL-CICS-ARCH-API.                                         CNKCS203
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
055800                                    DFHCOMMAREA                           
055900                                    DP030-CICS-API-FIELDS                 
056000                                    DP020-STANDARD-COMMAREA               
056100                                    CN203AI.                              
056200                                                                  CNKCS203
056300     IF  DP030-RC-CALL-SUCCESSFUL                                 CNKCS203
056400         CONTINUE                                                 CNKCS203
056500     ELSE                                                         CNKCS203
056600         SET DP013-NO-ROLLBACK                                    CNKCS203
056700             DP013-XCTL-DISPLAY-RESTART                           CNKCS203
056800             DP013-CICS-ABEND      TO TRUE                        CNKCS203
056900         MOVE '0001-CALL-CICS-ARCH-API'                           CNKCS203
057000                                   TO DP013-PARAGRAPH             CNKCS203
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
057300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      CNKCS203
057400         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
057500     END-IF.                                                      CNKCS203
057600                                                                  CNKCS203
057700*----------------------------------------------------------------*CNKCS203
057800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *CNKCS203
057900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *CNKCS203
058000*                                                                *CNKCS203
058100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *CNKCS203
058200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *CNKCS203
058300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *CNKCS203
058400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *CNKCS203
058500*----------------------------------------------------------------*CNKCS203
058600                                                                  CNKCS203
058700 1000-CONTROL-PROCESSING.                                         CNKCS203
058800                                                                  CNKCS203
058900     EVALUATE TRUE                                                CNKCS203
059000         WHEN DP020-NEXT-ACT-INITIAL                              CNKCS203
059100             INITIALIZE ASC-SPECIFIC-COMMAREA                     CNKCS203
059200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            CNKCS203
059300                                      ASC-SEL-TERM-ID             CNKCS203
059400             MOVE DP020-SRC-TASK-NUMBER                           CNKCS203
059500                                   TO ASC-LIST-TASK-NUMBER        CNKCS203
059600                                      ASC-SEL-TASK-NUMBER         CNKCS203
059700             MOVE PC-LIST-QUEUE-SEQ                               CNKCS203
059800                                   TO ASC-LIST-SEQ                CNKCS203
059900             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 CNKCS203
060000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 CNKCS203
060100                                                                  CNKCS203
060200***-----$TEMPLATE NOTE$-------------------------------------------CNKCS203
060300*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,CNKCS203
060400*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  CNKCS203
060500*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.CNKCS203
060600***---------------------------------------------------------------CNKCS203
060700             IF  PS-COMMAREA-NOT-VALID                            CNKCS203
060800                 SET DP020-NEXT-ACT-APPL-ERROR                    CNKCS203
060900                                   TO TRUE                        CNKCS203
061000             ELSE                                                 CNKCS203
061100                 PERFORM 4000-BUILD-INITIAL-PANEL                 CNKCS203
061200             END-IF                                               CNKCS203
061300                                                                  CNKCS203
061400         WHEN DP020-NEXT-ACT-READ-MAP                             CNKCS203
061500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        CNKCS203
061600                                   TO PV-TOP-ITEM                 CNKCS203
061700             PERFORM 2000-PROCESS-PANEL                           CNKCS203
061800                                                                  CNKCS203
061900         WHEN DP020-NEXT-ACT-RETURN                               CNKCS203
062000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        CNKCS203
062100                                   TO PV-TOP-ITEM                 CNKCS203
062200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    CNKCS203
062300             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 CNKCS203
062400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS203
062500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS203
062600                                                                  CNKCS203
062700         WHEN OTHER                                               CNKCS203
062800             SET DP013-LOGIC-ABEND TO TRUE                        CNKCS203
062900             SET DP013-NO-ROLLBACK TO TRUE                        CNKCS203
063000             MOVE '1000-CONTROL-PROCESSING'                       CNKCS203
063100                                   TO DP013-PARAGRAPH             CNKCS203
063200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    CNKCS203
063300                                   TO DP013-MESSAGE-TEXT(1)       CNKCS203
063400             PERFORM DP013-0000-PROCESS-ABEND                     CNKCS203
063500     END-EVALUATE.                                                CNKCS203
063600                                                                  CNKCS203
063700/                                                                 CNKCS203
063800*----------------------------------------------------------------*CNKCS203
063900* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *CNKCS203
064000*----------------------------------------------------------------*CNKCS203
064100                                                                  CNKCS203
064200 1100-PROCESS-INTER-APPL-COMM.                                    CNKCS203
064300                                                                  CNKCS203
064400     SET PS-COMMAREA-VALID         TO TRUE.                       CNKCS203
064500     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     CNKCS203
064600                                                                  CNKCS203
064700     IF DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT           CNKCS203
064800        MOVE CN001-OPER-UNT-ID     TO DK-OPER-UNT-ID              CNKCS203
064900                                      ASC-KEY-OPER-UNT-ID         CNKCS203
065000        MOVE CN001-FCLTY-ID        TO DK-FCLTY-ID                 CNKCS203
065100                                      DK-FCLTY-ID-LOW             CNKCS203
065200                                      DK-FCLTY-ID-HIGH            CNKCS203
065300                                      ASC-KEY-FCLTY-ID-LOW        CNKCS203
065400                                      ASC-KEY-FCLTY-ID-HIGH       CNKCS203
065500                                      ASC-KEY-FCLTY-ID            CNKCS203
065600        MOVE CN001-TKT-FMT-ID      TO DK-TKT-FMT-ID-LOW           CNKCS203
065700                                      DK-TKT-FMT-ID-HIGH          CNKCS203
065800                                      ASC-KEY-FMT-ID-LOW          CNKCS203
065900                                      ASC-KEY-FMT-ID-HIGH         CNKCS203
066000     END-IF.                                                      CNKCS203
066100                                                                  CNKCS203
066200/                                                                 CNKCS203
066300*----------------------------------------------------------------*CNKCS203
066400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *CNKCS203
066500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *CNKCS203
066600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *CNKCS203
066700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *CNKCS203
066800* FUNCTION KEYS CAN GET THIS FAR.                                *CNKCS203
066900*----------------------------------------------------------------*CNKCS203
067000                                                                  CNKCS203
067100 2000-PROCESS-PANEL.                                              CNKCS203
067200     EVALUATE TRUE                                                CNKCS203
067300         WHEN DP020-SRC-AID = DP016-CLEAR                         CNKCS203
067400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    CNKCS203
067500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS203
067600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS203
067700                                                                  CNKCS203
067800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    CNKCS203
067900             MOVE ASC-KEY-OPER-UNT-ID                             CNKCS203
068000                                   TO DK-OPER-UNT-ID              CNKCS203
068100             MOVE ASC-KEY-FCLTY-ID TO DK-FCLTY-ID                 CNKCS203
068200             MOVE ASC-KEY-FCLTY-ID-LOW                            CNKCS203
068300                                   TO DK-FCLTY-ID-LOW             CNKCS203
068400             MOVE ASC-KEY-FCLTY-ID-HIGH                           CNKCS203
068500                                   TO DK-FCLTY-ID-HIGH            CNKCS203
068600             MOVE ASC-KEY-FMT-ID-LOW                              CNKCS203
068700                                   TO DK-TKT-FMT-ID-LOW           CNKCS203
068800             MOVE ASC-KEY-FMT-ID-HIGH                             CNKCS203
068900                                   TO DK-TKT-FMT-ID-HIGH          CNKCS203
069000             PERFORM 2050-DELETE-LIST-QUEUE                       CNKCS203
069100             PERFORM 4000-BUILD-INITIAL-PANEL                     CNKCS203
069200                                                                  CNKCS203
069300         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    CNKCS203
069400             PERFORM 2140-DESELECT-ALL-ITEMS                      CNKCS203
069500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS203
069600                                                                  CNKCS203
069700         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  CNKCS203
069800             PERFORM 2150-SELECT-ALL-ITEMS                        CNKCS203
069900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS203
070000                                                                  CNKCS203
070100         WHEN OTHER                                               CNKCS203
070200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 CNKCS203
070300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS203
070400             IF  PS-NO-ERROR                                      CNKCS203
070500                 SET DP030-CONTINUE-GO TO TRUE                    CNKCS203
070600                 PERFORM 2100-CHECK-FUNCTION-KEY                  CNKCS203
070700             ELSE                                                 CNKCS203
070800                 SET DP030-OVERRIDE-GO TO TRUE                    CNKCS203
070900             END-IF                                               CNKCS203
071000     END-EVALUATE.                                                CNKCS203
071100                                                                  CNKCS203
071200/                                                                 CNKCS203
071300*----------------------------------------------------------------*CNKCS203
071400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *CNKCS203
071500*----------------------------------------------------------------*CNKCS203
071600 2050-DELETE-LIST-QUEUE.                                          CNKCS203
071700                                                                  CNKCS203
071800     EXEC CICS                                                    CNKCS203
071900         DELETEQ TS                                               CNKCS203
072000           QUEUE (ASC-LIST-QUEUE-NAME)                            CNKCS203
072100            RESP (PV-CICS-RESP)                                   CNKCS203
072200     END-EXEC.                                                    CNKCS203
072300                                                                  CNKCS203
072400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       CNKCS203
072500        (PV-CICS-RESP = DFHRESP(QIDERR))                          CNKCS203
072600         CONTINUE                                                 CNKCS203
072700     ELSE                                                         CNKCS203
072800         SET DP013-CICS-ABEND      TO TRUE                        CNKCS203
072900         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS203
073000                                                                  CNKCS203
073100         MOVE '2050-DELETE-LIST-QUEUE'                            CNKCS203
073200                                   TO DP013-PARAGRAPH             CNKCS203
073300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    CNKCS203
073400                                   TO DP013-MESSAGE-TEXT (1)      CNKCS203
073500         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
073600     END-IF.                                                      CNKCS203
073700                                                                  CNKCS203
073800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  CNKCS203
073900                                                                  CNKCS203
074000/                                                                 CNKCS203
074100*----------------------------------------------------------------*CNKCS203
074200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*CNKCS203
074300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *CNKCS203
074400* CICS ARCHITECTURE API.                                         *CNKCS203
074500*----------------------------------------------------------------*CNKCS203
074600 2100-CHECK-FUNCTION-KEY.                                         CNKCS203
074700                                                                  CNKCS203
074800     EVALUATE TRUE                                                CNKCS203
074900         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  CNKCS203
075000              IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO             CNKCS203
075100                  SET ASC-NO-TSQ-UPDATE TO TRUE                   CNKCS203
075200              END-IF                                              CNKCS203
075300              INITIALIZE CN003-INTER-APPL-COMMAREA                CNKCS203
075400              MOVE ASC-KEY-OPER-UNT-ID                            CNKCS203
075500                                   TO CN003-OPER-UNT-ID           CNKCS203
075600              MOVE ASC-KEY-FCLTY-ID                               CNKCS203
075700                                   TO CN003-FCLTY-ID              CNKCS203
075800              MOVE ASC-NUMBER-OF-SELECTED-ITEMS                   CNKCS203
075900                                 TO CN003-NUMBER-OF-SELECTED-ITEMSCNKCS203
076000              PERFORM 5000-PREPARE-SEL-QUEUE                      CNKCS203
076100                                                                  CNKCS203
076200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  CNKCS203
076300             MOVE +1               TO PV-TOP-ITEM                 CNKCS203
076400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS203
076500             PERFORM 3200-RESET-ATTRIBUTES                        CNKCS203
076600                                                                  CNKCS203
076700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   CNKCS203
076800             PERFORM 2110-BROWSE-BACKWARD                         CNKCS203
076900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS203
077000             PERFORM 3200-RESET-ATTRIBUTES                        CNKCS203
077100                                                                  CNKCS203
077200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   CNKCS203
077300             PERFORM 2120-BROWSE-FORWARD                          CNKCS203
077400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS203
077500             PERFORM 3200-RESET-ATTRIBUTES                        CNKCS203
077600                                                                  CNKCS203
077700         WHEN DP020-SRC-AID = DP016-ENTER                         CNKCS203
077800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   CNKCS203
077900             IF  PS-ERROR                                         CNKCS203
078000                 CONTINUE                                         CNKCS203
078100             ELSE                                                 CNKCS203
078200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             CNKCS203
078300             END-IF                                               CNKCS203
078400                                                                  CNKCS203
078500         WHEN OTHER                                               CNKCS203
078600             SET DP013-NO-ROLLBACK                                CNKCS203
078700                 DP013-XCTL-DISPLAY-RESTART                       CNKCS203
078800                 DP013-CICS-ABEND  TO TRUE                        CNKCS203
078900             MOVE '2100-CHECK-FUNCTION-KEY'                       CNKCS203
079000                                   TO DP013-PARAGRAPH             CNKCS203
079100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      CNKCS203
079200                                   TO DP013-MESSAGE-TEXT (1)      CNKCS203
079300             PERFORM DP013-0000-PROCESS-ABEND                     CNKCS203
079400     END-EVALUATE.                                                CNKCS203
079500                                                                  CNKCS203
079600/                                                                 CNKCS203
079700*----------------------------------------------------------------*CNKCS203
079800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *CNKCS203
079900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *CNKCS203
080000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *CNKCS203
080100*    MESSAGE.                                                    *CNKCS203
080200*----------------------------------------------------------------*CNKCS203
080300                                                                  CNKCS203
080400 2110-BROWSE-BACKWARD.                                            CNKCS203
080500                                                                  CNKCS203
080600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    CNKCS203
080700         GIVING PV-TOP-ITEM.                                      CNKCS203
080800                                                                  CNKCS203
080900     IF  ((PV-TOP-ITEM < +1)                                      CNKCS203
081000       OR (PV-TOP-ITEM = +1))                                     CNKCS203
081100         MOVE +1                   TO PV-TOP-ITEM                 CNKCS203
081200*        -- TOP OF LIST --                                        CNKCS203
081300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            CNKCS203
081400         SET DP020-MSG-INFORMATIONAL                              CNKCS203
081500                                   TO TRUE                        CNKCS203
081600     END-IF.                                                      CNKCS203
081700                                                                  CNKCS203
081800/                                                                 CNKCS203
081900*----------------------------------------------------------------*CNKCS203
082000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *CNKCS203
082100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *CNKCS203
082200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *CNKCS203
082300*----------------------------------------------------------------*CNKCS203
082400                                                                  CNKCS203
082500 2120-BROWSE-FORWARD.                                             CNKCS203
082600                                                                  CNKCS203
082700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              CNKCS203
082800         GIVING PV-TOP-ITEM.                                      CNKCS203
082900                                                                  CNKCS203
083000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   CNKCS203
083100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            CNKCS203
083200                                   TO PV-TOP-ITEM                 CNKCS203
083300*        -- BOTTOM OF LIST --                                     CNKCS203
083400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            CNKCS203
083500         SET DP020-MSG-INFORMATIONAL                              CNKCS203
083600                                   TO TRUE                        CNKCS203
083700     ELSE                                                         CNKCS203
083800         COMPUTE PV-BOTTOM-ITEM =                                 CNKCS203
083900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 CNKCS203
084000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            CNKCS203
084100*            -- BOTTOM OF LIST --                                 CNKCS203
084200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            CNKCS203
084300             SET DP020-MSG-INFORMATIONAL                          CNKCS203
084400                                   TO TRUE                        CNKCS203
084500         END-IF                                                   CNKCS203
084600     END-IF.                                                      CNKCS203
084700                                                                  CNKCS203
084800/                                                                 CNKCS203
084900*----------------------------------------------------------------*CNKCS203
085000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *CNKCS203
085100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *CNKCS203
085200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *CNKCS203
085300*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *CNKCS203
085400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *CNKCS203
085500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *CNKCS203
085600*----------------------------------------------------------------*CNKCS203
085700                                                                  CNKCS203
085800 2130-CHECK-FOR-JUMP-BROWSE.                                      CNKCS203
085900                                                                  CNKCS203
086000     SET PS-NO-ERROR               TO TRUE.                       CNKCS203
086100     IF (ASC-START-ITEM-REQUEST = SPACE)                          CNKCS203
086200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            CNKCS203
086300                                   TO PV-TOP-ITEM                 CNKCS203
086400     ELSE                                                         CNKCS203
086500         MOVE ASC-START-ITEM-REQUEST                              CNKCS203
086600                                   TO DP010I-UNEDITED-FIELD       CNKCS203
086700         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       CNKCS203
086800         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     CNKCS203
086900         SET DP010I-NEGATIVE-NOT-ALLOWED                          CNKCS203
087000                                   TO TRUE                        CNKCS203
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263455              USING DP010I-NUMERIC-EDIT-AREA                              
087200                                                                  CNKCS203
087300         IF  NOT DP010I-ERROR-DETECTED                            CNKCS203
087400             MOVE DP010I-NUMERIC-FIELD                            CNKCS203
087500                                   TO ASC-START-ITEM-REQUEST-N    CNKCS203
087600             IF  ASC-START-ITEM-REQUEST-N > ZERO                  CNKCS203
087700                 IF  ASC-START-ITEM-REQUEST-N >                   CNKCS203
087800                                          ASC-NUMBER-OF-ITEMS-READCNKCS203
087900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         CNKCS203
088000                     COMPUTE PV-TOP-ITEM =                        CNKCS203
088100                             ASC-NUMBER-OF-ITEMS-READ             CNKCS203
088200                             - PC-ITEMS-PER-PANEL + 1             CNKCS203
088300                     IF  PV-TOP-ITEM < +1                         CNKCS203
088400                         MOVE +1   TO PV-TOP-ITEM                 CNKCS203
088500                         MOVE PC-TSYMSG-00070                     CNKCS203
088600                                   TO DP020-MSG-NUMBER            CNKCS203
088700                         SET DP020-MSG-INFORMATIONAL              CNKCS203
088800                                   TO TRUE                        CNKCS203
088900                     END-IF                                       CNKCS203
089000                 ELSE                                             CNKCS203
089100                     MOVE ASC-START-ITEM-REQUEST-N                CNKCS203
089200                                   TO PV-TOP-ITEM                 CNKCS203
089300                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      CNKCS203
089400                     COMPUTE PV-BOTTOM-ITEM =                     CNKCS203
089500                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     CNKCS203
089600                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READCNKCS203
089700*                        -- BOTTOM OF LIST --                     CNKCS203
089800                         MOVE PC-TSYMSG-00070                     CNKCS203
089900                                   TO DP020-MSG-NUMBER            CNKCS203
090000                         SET DP020-MSG-INFORMATIONAL              CNKCS203
090100                                   TO TRUE                        CNKCS203
090200                     END-IF                                       CNKCS203
090300                 END-IF                                           CNKCS203
090400             ELSE                                                 CNKCS203
090500*                --- VALUE OUT OF RANGE ----                      CNKCS203
090600                 MOVE PC-TSYMSG-00101                             CNKCS203
090700                                   TO DP020-MSG-NUMBER            CNKCS203
090800                 MOVE -1           TO ASTRTITL                    CNKCS203
090900                 SET DP030-SET-CURSOR-APPL-1                      CNKCS203
091000                                   TO TRUE                        CNKCS203
091100                 MOVE DP015-REVERSE                               CNKCS203
091200                                   TO ASTRTITH                    CNKCS203
091300                 MOVE DP015-RED    TO ASTRTITC                    CNKCS203
091400                 MOVE DP015-UNP-NUM-BRT-MDT                       CNKCS203
091500                                   TO ASTRTITA                    CNKCS203
091600                 SET DP020-MSG-FATAL                              CNKCS203
091700                                   TO TRUE                        CNKCS203
091800                 SET PS-ERROR      TO TRUE                        CNKCS203
091900             END-IF                                               CNKCS203
092000                                                                  CNKCS203
092100         ELSE                                                     CNKCS203
092200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            CNKCS203
092300             MOVE -1               TO ASTRTITL                    CNKCS203
092400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  CNKCS203
092500             MOVE DP015-REVERSE    TO ASTRTITH                    CNKCS203
092600             MOVE DP015-RED        TO ASTRTITC                    CNKCS203
092700             MOVE DP015-UNP-NUM-BRT-MDT                           CNKCS203
092800                                   TO ASTRTITA                    CNKCS203
092900             SET DP020-MSG-FATAL   TO TRUE                        CNKCS203
093000             SET PS-ERROR          TO TRUE                        CNKCS203
093100         END-IF                                                   CNKCS203
093200     END-IF.                                                      CNKCS203
093300                                                                  CNKCS203
093400/                                                                 CNKCS203
093500*----------------------------------------------------------------*CNKCS203
093600*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *CNKCS203
093700*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *CNKCS203
093800*----------------------------------------------------------------*CNKCS203
093900 2140-DESELECT-ALL-ITEMS.                                         CNKCS203
094000                                                                  CNKCS203
094100     MOVE +1                       TO ASC-BLK-SUB.                CNKCS203
094200                                                                  CNKCS203
094300     PERFORM 2141-CLEAR-SELECTED-INDS                             CNKCS203
094400         VARYING ASC-ITEM-SUB                                     CNKCS203
094500         FROM 1 BY 1                                              CNKCS203
094600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS203
094700                                                                  CNKCS203
094800     ADD +1                        TO ASC-BLK-SUB.                CNKCS203
094900                                                                  CNKCS203
095000     PERFORM 2141-CLEAR-SELECTED-INDS                             CNKCS203
095100         VARYING ASC-ITEM-SUB                                     CNKCS203
095200         FROM 1 BY 1                                              CNKCS203
095300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS203
095400                                                                  CNKCS203
095500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               CNKCS203
095600                                   TO PV-LIST-ITEM-NUMBER.        CNKCS203
095700                                                                  CNKCS203
095800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            CNKCS203
095900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    CNKCS203
096000                                                                  CNKCS203
096100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     CNKCS203
096200        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      CNKCS203
096300         MOVE +1                   TO ASC-BLK-SUB                 CNKCS203
096400                                                                  CNKCS203
096500         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS203
096600                                                                  CNKCS203
096700         MOVE +1                   TO PV-BLOCK-NUMBER             CNKCS203
096800                                                                  CNKCS203
096900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         CNKCS203
097000             PV-FIRST-BLOCK-IN-ARRAY - 1                          CNKCS203
097100                                                                  CNKCS203
097200         PERFORM                                                  CNKCS203
097300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       CNKCS203
097400                                                                  CNKCS203
097500             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS203
097600                                                                  CNKCS203
097700             PERFORM 2141-CLEAR-SELECTED-INDS                     CNKCS203
097800                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 CNKCS203
097900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS203
098000                                                                  CNKCS203
098100             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS203
098200                                                                  CNKCS203
098300             ADD +1                TO PV-BLOCK-NUMBER             CNKCS203
098400                                                                  CNKCS203
098500         END-PERFORM                                              CNKCS203
098600                                                                  CNKCS203
098700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         CNKCS203
098800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     CNKCS203
098900                                                                  CNKCS203
099000         PERFORM                                                  CNKCS203
099100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       CNKCS203
099200                   ASC-HIGHEST-BLOCK-WRITTEN                      CNKCS203
099300                                                                  CNKCS203
099400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          CNKCS203
099500                                   TO PV-BLOCK-NUMBER             CNKCS203
099600                                                                  CNKCS203
099700             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS203
099800                                                                  CNKCS203
099900             PERFORM 2141-CLEAR-SELECTED-INDS                     CNKCS203
100000                 VARYING ASC-ITEM-SUB                             CNKCS203
100100                 FROM 1 BY 1                                      CNKCS203
100200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS203
100300                                                                  CNKCS203
100400             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS203
100500                                                                  CNKCS203
100600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      CNKCS203
100700                                                                  CNKCS203
100800         END-PERFORM                                              CNKCS203
100900                                                                  CNKCS203
101000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             CNKCS203
101100                                   TO PV-BLOCK-NUMBER             CNKCS203
101200                                                                  CNKCS203
101300         PERFORM 4410-READ-TEMP-STORAGE                           CNKCS203
101400     END-IF.                                                      CNKCS203
101500                                                                  CNKCS203
101600                                                                  CNKCS203
101700     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS203
101800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.CNKCS203
101900     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  CNKCS203
102000                                                                  CNKCS203
102100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        CNKCS203
102200                                                                  CNKCS203
102300/                                                                 CNKCS203
102400*----------------------------------------------------------------*CNKCS203
102500*    MARK EACH ITEM AS BEING NOT SELECTED.                       *CNKCS203
102600*----------------------------------------------------------------*CNKCS203
102700                                                                  CNKCS203
102800 2141-CLEAR-SELECTED-INDS.                                        CNKCS203
102900                                                                  CNKCS203
103000     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS203
103100             NOT EQUAL ZERO                                       CNKCS203
103200         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS203
103300             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS203
103400                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    CNKCS203
103500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  CNKCS203
103600                                   TO TRUE                        CNKCS203
103700         END-IF                                                   CNKCS203
103800     END-IF.                                                      CNKCS203
103900                                                                  CNKCS203
104000/                                                                 CNKCS203
104100*----------------------------------------------------------------*CNKCS203
104200*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *CNKCS203
104300*  FOR ALL ITEMS.                                                *CNKCS203
104400*----------------------------------------------------------------*CNKCS203
104500                                                                  CNKCS203
104600 2150-SELECT-ALL-ITEMS.                                           CNKCS203
104700                                                                  CNKCS203
104800     MOVE +1                       TO ASC-BLK-SUB.                CNKCS203
104900                                                                  CNKCS203
105000     PERFORM 2151-SET-SELECTED-INDS                               CNKCS203
105100         VARYING ASC-ITEM-SUB                                     CNKCS203
105200         FROM 1 BY 1                                              CNKCS203
105300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS203
105400                                                                  CNKCS203
105500     ADD +1                        TO ASC-BLK-SUB.                CNKCS203
105600                                                                  CNKCS203
105700     PERFORM 2151-SET-SELECTED-INDS                               CNKCS203
105800         VARYING ASC-ITEM-SUB                                     CNKCS203
105900         FROM 1 BY 1                                              CNKCS203
106000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS203
106100                                                                  CNKCS203
106200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               CNKCS203
106300                                   TO PV-LIST-ITEM-NUMBER.        CNKCS203
106400                                                                  CNKCS203
106500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            CNKCS203
106600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    CNKCS203
106700                                                                  CNKCS203
106800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     CNKCS203
106900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    CNKCS203
107000         MOVE +1                   TO ASC-BLK-SUB                 CNKCS203
107100                                                                  CNKCS203
107200         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS203
107300                                                                  CNKCS203
107400         MOVE +1                   TO PV-BLOCK-NUMBER             CNKCS203
107500                                                                  CNKCS203
107600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         CNKCS203
107700             PV-FIRST-BLOCK-IN-ARRAY - 1                          CNKCS203
107800                                                                  CNKCS203
107900         PERFORM                                                  CNKCS203
108000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       CNKCS203
108100                                                                  CNKCS203
108200             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS203
108300                                                                  CNKCS203
108400             PERFORM 2151-SET-SELECTED-INDS                       CNKCS203
108500                 VARYING ASC-ITEM-SUB                             CNKCS203
108600                 FROM 1 BY 1                                      CNKCS203
108700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS203
108800                                                                  CNKCS203
108900             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS203
109000                                                                  CNKCS203
109100             ADD +1                TO PV-BLOCK-NUMBER             CNKCS203
109200         END-PERFORM                                              CNKCS203
109300                                                                  CNKCS203
109400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         CNKCS203
109500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     CNKCS203
109600                                                                  CNKCS203
109700         PERFORM                                                  CNKCS203
109800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       CNKCS203
109900                   ASC-HIGHEST-BLOCK-WRITTEN                      CNKCS203
110000                                                                  CNKCS203
110100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          CNKCS203
110200                                   TO PV-BLOCK-NUMBER             CNKCS203
110300                                                                  CNKCS203
110400             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS203
110500                                                                  CNKCS203
110600             PERFORM 2151-SET-SELECTED-INDS                       CNKCS203
110700                 VARYING ASC-ITEM-SUB                             CNKCS203
110800                 FROM 1 BY 1                                      CNKCS203
110900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS203
111000                                                                  CNKCS203
111100             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS203
111200                                                                  CNKCS203
111300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      CNKCS203
111400         END-PERFORM                                              CNKCS203
111500                                                                  CNKCS203
111600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             CNKCS203
111700                                   TO PV-BLOCK-NUMBER             CNKCS203
111800                                                                  CNKCS203
111900         PERFORM 4410-READ-TEMP-STORAGE                           CNKCS203
112000     END-IF.                                                      CNKCS203
112100                                                                  CNKCS203
112200                                                                  CNKCS203
112300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             CNKCS203
112400          ASC-NUMBER-OF-SELECTED-ITEMS.                           CNKCS203
112500                                                                  CNKCS203
112600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        CNKCS203
112700                                                                  CNKCS203
112800/                                                                 CNKCS203
112900*----------------------------------------------------------------*CNKCS203
113000*    MARK EACH ITEM AS BEING SELECTED.                           *CNKCS203
113100*----------------------------------------------------------------*CNKCS203
113200                                                                  CNKCS203
113300 2151-SET-SELECTED-INDS.                                          CNKCS203
113400                                                                  CNKCS203
113500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
113600             NOT EQUAL ZERO                                       CNKCS203
113700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             CNKCS203
113800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             CNKCS203
113900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        CNKCS203
114000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  CNKCS203
114100                                   TO TRUE                        CNKCS203
114200         END-IF                                                   CNKCS203
114300     END-IF.                                                      CNKCS203
114400                                                                  CNKCS203
114500*----------------------------------------------------------------*CNKCS203
114600*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *CNKCS203
114700*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *CNKCS203
114800*----------------------------------------------------------------*CNKCS203
114900 2200-MOVE-SCREEN-TO-COMMAREA.                                    CNKCS203
115000                                                                  CNKCS203
115100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             CNKCS203
115200     MOVE +1                       TO PV-SUB.                     CNKCS203
115300                                                                  CNKCS203
115400     PERFORM 3100-SET-SUBSCRIPTS.                                 CNKCS203
115500                                                                  CNKCS203
115600     IF  ASTRTITL > ZERO                                          CNKCS203
115700         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      CNKCS203
115800     ELSE                                                         CNKCS203
115900         IF  ASTRTITF = DP015-ERASE-EOF                           CNKCS203
116000             INITIALIZE ASC-START-ITEM-REQUEST                    CNKCS203
116100         END-IF                                                   CNKCS203
116200     END-IF.                                                      CNKCS203
116300                                                                  CNKCS203
116400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          CNKCS203
116500         VARYING PV-SUB                                           CNKCS203
116600         FROM 1 BY 1                                              CNKCS203
116700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      CNKCS203
116800                                                                  CNKCS203
116900/                                                                 CNKCS203
117000*----------------------------------------------------------------*CNKCS203
117100*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *CNKCS203
117200*----------------------------------------------------------------*CNKCS203
117300 2210-MOVE-LINES-TO-COMMAREA.                                     CNKCS203
117400                                                                  CNKCS203
117500     IF  MR-SELECTL (PV-SUB) > ZERO                               CNKCS203
117600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     CNKCS203
117700                                   TO TRUE                        CNKCS203
117800         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        CNKCS203
117900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      CNKCS203
118000     ELSE                                                         CNKCS203
118100         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                CNKCS203
118200             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         CNKCS203
118300             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        CNKCS203
118400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      CNKCS203
118500         END-IF                                                   CNKCS203
118600     END-IF.                                                      CNKCS203
118700                                                                  CNKCS203
118800     ADD +1                        TO ASC-ITEM-SUB.               CNKCS203
118900                                                                  CNKCS203
119000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        CNKCS203
119100         ADD +1                    TO ASC-BLK-SUB                 CNKCS203
119200         MOVE +1                   TO ASC-ITEM-SUB                CNKCS203
119300     END-IF.                                                      CNKCS203
119400                                                                  CNKCS203
119500/                                                                 CNKCS203
119600*----------------------------------------------------------------*CNKCS203
119700*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *CNKCS203
119800*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *CNKCS203
119900*----------------------------------------------------------------*CNKCS203
120000 3000-EDIT-DATA-IN-COMMAREA.                                      CNKCS203
120100                                                                  CNKCS203
120200     SET PS-NO-ERROR               TO TRUE.                       CNKCS203
120300                                                                  CNKCS203
120400     PERFORM 3200-RESET-ATTRIBUTES.                               CNKCS203
120500                                                                  CNKCS203
120600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     CNKCS203
120700**                                                                CNKCS203
120800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              CNKCS203
120900* EDITTING IS DONE FROM THE BOTTOM UP.                            CNKCS203
121000**                                                                CNKCS203
121100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       CNKCS203
121200         ASC-ITEMS-DISPLAYED - 1.                                 CNKCS203
121300                                                                  CNKCS203
121400     PERFORM 3100-SET-SUBSCRIPTS.                                 CNKCS203
121500     PERFORM 3300-EDIT-SELECTIONS                                 CNKCS203
121600         VARYING PV-SUB                                           CNKCS203
121700         FROM PV-SUB BY -1                                        CNKCS203
121800         UNTIL PV-SUB < +1                                        CNKCS203
121900                                                                  CNKCS203
122000     IF  PS-NO-ERROR                                              CNKCS203
122100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        CNKCS203
122200     END-IF.                                                      CNKCS203
122300                                                                  CNKCS203
122400     IF  ((PS-NO-ERROR)                                           CNKCS203
122500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   CNKCS203
122600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    CNKCS203
122700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  CNKCS203
122800     END-IF.                                                      CNKCS203
122900                                                                  CNKCS203
123000/                                                                 CNKCS203
123100*----------------------------------------------------------------*CNKCS203
123200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *CNKCS203
123300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*CNKCS203
123400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *CNKCS203
123500*                                                                *CNKCS203
123600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *CNKCS203
123700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *CNKCS203
123800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *CNKCS203
123900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *CNKCS203
124000*----------------------------------------------------------------*CNKCS203
124100                                                                  CNKCS203
124200 3100-SET-SUBSCRIPTS.                                             CNKCS203
124300                                                                  CNKCS203
124400     COMPUTE ASC-ITEM-SUB =                                       CNKCS203
124500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        CNKCS203
124600                                                                  CNKCS203
124700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         CNKCS203
124800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            CNKCS203
124900                                                                  CNKCS203
125000         MOVE PC-MAX-BLOCKS-IN-ARRAY                              CNKCS203
125100                                   TO ASC-BLK-SUB                 CNKCS203
125200     ELSE                                                         CNKCS203
125300         MOVE +1                   TO ASC-BLK-SUB                 CNKCS203
125400     END-IF.                                                      CNKCS203
125500                                                                  CNKCS203
125600*----------------------------------------------------------------*CNKCS203
125700*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *CNKCS203
125800*----------------------------------------------------------------*CNKCS203
125900                                                                  CNKCS203
126000 3200-RESET-ATTRIBUTES.                                           CNKCS203
126100                                                                  CNKCS203
126200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   CNKCS203
126300     MOVE DP015-GREEN              TO ASTRTITC.                   CNKCS203
126400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   CNKCS203
126500                                                                  CNKCS203
126600     IF DP020-NEXT-ACT-RETURN                                     CNKCS203
126700     OR DP020-NEXT-ACT-READ-MAP                                   CNKCS203
126800        PERFORM                                                   CNKCS203
126900            VARYING PV-SUB                                        CNKCS203
127000            FROM 1 BY 1                                           CNKCS203
127100            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    CNKCS203
127200            MOVE DP015-UNP-ALP-NOR-OFF                            CNKCS203
127300                                      TO MR-SELECTA (PV-SUB)      CNKCS203
127400            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      CNKCS203
127500            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      CNKCS203
127600        END-PERFORM                                               CNKCS203
127700     ELSE                                                         CNKCS203
127800        PERFORM                                                   CNKCS203
127900            VARYING PV-SUB                                        CNKCS203
128000            FROM 1 BY 1                                           CNKCS203
128100            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     CNKCS203
128200            MOVE DP015-UNP-ALP-NOR-OFF                            CNKCS203
128300                                      TO MR-SELECTA (PV-SUB)      CNKCS203
128400            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      CNKCS203
128500            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      CNKCS203
128600        END-PERFORM                                               CNKCS203
128700     END-IF.                                                      CNKCS203
128800                                                                  CNKCS203
128900/                                                                 CNKCS203
129000*----------------------------------------------------------------*CNKCS203
129100*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *CNKCS203
129200*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *CNKCS203
129300*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *CNKCS203
129400*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *CNKCS203
129500*----------------------------------------------------------------*CNKCS203
129600 3300-EDIT-SELECTIONS.                                            CNKCS203
129700                                                                  CNKCS203
129800     EVALUATE TRUE                                                CNKCS203
129900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     CNKCS203
130000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         CNKCS203
130100                 CONTINUE                                         CNKCS203
130200                                                                  CNKCS203
130300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         CNKCS203
130400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        CNKCS203
130500                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS203
130600                 MOVE ASC-TEMP-SELECTED-SW                        CNKCS203
130700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS203
130800                                   TO ASC-SELECTED-SW             CNKCS203
130900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS203
131000             END-IF                                               CNKCS203
131100                                                                  CNKCS203
131200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     CNKCS203
131300                 = SPACE                                          CNKCS203
131400             EVALUATE TRUE                                        CNKCS203
131500                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       CNKCS203
131600                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSCNKCS203
131700                     MOVE SPACE    TO ASC-SELECTED-SW             CNKCS203
131800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS203
131900                                                                  CNKCS203
132000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        CNKCS203
132100                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE CNKCS203
132200                     MOVE SPACE    TO ASC-SELECTED-SW             CNKCS203
132300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS203
132400                                                                  CNKCS203
132500                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS203
132600                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   CNKCS203
132700                     MOVE SPACE    TO ASC-SELECTED-SW             CNKCS203
132800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS203
132900             END-EVALUATE                                         CNKCS203
133000                                                                  CNKCS203
133100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
133200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            CNKCS203
133300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    CNKCS203
133400             END-IF                                               CNKCS203
133500             PERFORM 3310-EDIT-RANGE                              CNKCS203
133600                                                                  CNKCS203
133700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             CNKCS203
133800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            CNKCS203
133900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    CNKCS203
134000             END-IF                                               CNKCS203
134100             PERFORM 3310-EDIT-RANGE                              CNKCS203
134200                                                                  CNKCS203
134300         WHEN OTHER                                               CNKCS203
134400             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            CNKCS203
134500             SET DP020-MSG-FATAL   TO TRUE                        CNKCS203
134600             MOVE -1               TO MR-SELECTL (PV-SUB)         CNKCS203
134700             SET DP030-SET-CURSOR-APPL-1                          CNKCS203
134800                                   TO TRUE                        CNKCS203
134900             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         CNKCS203
135000             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         CNKCS203
135100             SET PS-ERROR          TO TRUE                        CNKCS203
135200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            CNKCS203
135300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     CNKCS203
135400                 MOVE SPACE        TO ASC-SELECTED-SW             CNKCS203
135500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS203
135600             END-IF                                               CNKCS203
135700     END-EVALUATE.                                                CNKCS203
135800                                                                  CNKCS203
135900     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             CNKCS203
136000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               CNKCS203
136100                                                                  CNKCS203
136200     IF  ASC-ITEM-SUB < 1                                         CNKCS203
136300         SUBTRACT +1 FROM ASC-BLK-SUB                             CNKCS203
136400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                CNKCS203
136500     END-IF.                                                      CNKCS203
136600                                                                  CNKCS203
136700*----------------------------------------------------------------*CNKCS203
136800*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *CNKCS203
136900*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *CNKCS203
137000*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *CNKCS203
137100*  THE ENDING.                                                   *CNKCS203
137200*----------------------------------------------------------------*CNKCS203
137300 3310-EDIT-RANGE.                                                 CNKCS203
137400                                                                  CNKCS203
137500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                CNKCS203
137600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   CNKCS203
137700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)CNKCS203
137800                                   TO ASC-SELECTED-SW             CNKCS203
137900                                        (ASC-BLK-SUB ASC-ITEM-SUB)CNKCS203
138000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE CNKCS203
138100         ELSE                                                     CNKCS203
138200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     CNKCS203
138300                 CONTINUE                                         CNKCS203
138400             ELSE                                                 CNKCS203
138500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        CNKCS203
138600                 MOVE PC-TSYMSG-00054                             CNKCS203
138700                                   TO DP020-MSG-NUMBER            CNKCS203
138800                 SET DP020-MSG-FATAL                              CNKCS203
138900                                   TO TRUE                        CNKCS203
139000                 MOVE -1           TO MR-SELECTL (PV-SUB)         CNKCS203
139100                 SET DP030-SET-CURSOR-APPL-1                      CNKCS203
139200                                   TO TRUE                        CNKCS203
139300                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         CNKCS203
139400                 MOVE DP015-UNDERLINE                             CNKCS203
139500                                   TO MR-SELECTH (PV-SUB)         CNKCS203
139600                 SET PS-ERROR      TO TRUE                        CNKCS203
139700             END-IF                                               CNKCS203
139800         END-IF                                                   CNKCS203
139900     ELSE                                                         CNKCS203
140000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     CNKCS203
140100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
140200                                   TO ASC-SELECTED-SW             CNKCS203
140300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS203
140400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   CNKCS203
140500         ELSE                                                     CNKCS203
140600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       CNKCS203
140700                 CONTINUE                                         CNKCS203
140800             ELSE                                                 CNKCS203
140900*                -- ONLY ONE END-OF-RANGE ALLOWED --              CNKCS203
141000                 MOVE PC-TSYMSG-00055                             CNKCS203
141100                                   TO DP020-MSG-NUMBER            CNKCS203
141200                 SET DP020-MSG-FATAL                              CNKCS203
141300                                   TO TRUE                        CNKCS203
141400                 MOVE -1           TO MR-SELECTL (PV-SUB)         CNKCS203
141500                 SET DP030-SET-CURSOR-APPL-1                      CNKCS203
141600                                   TO TRUE                        CNKCS203
141700                 SET PS-ERROR      TO TRUE                        CNKCS203
141800             END-IF                                               CNKCS203
141900         END-IF                                                   CNKCS203
142000     END-IF.                                                      CNKCS203
142100                                                                  CNKCS203
142200*----------------------------------------------------------------*CNKCS203
142300*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *CNKCS203
142400*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *CNKCS203
142500*----------------------------------------------------------------*CNKCS203
142600 3400-CHECK-RANGE-SEQUENCE.                                       CNKCS203
142700                                                                  CNKCS203
142800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       CNKCS203
142900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      CNKCS203
143000       AND  ASC-START-OF-SELECTED-RANGE >                         CNKCS203
143100                                         ASC-END-OF-SELECTED-RANGECNKCS203
143200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                CNKCS203
143300         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            CNKCS203
143400         SET DP020-MSG-FATAL       TO TRUE                        CNKCS203
143500         SET PS-ERROR              TO TRUE                        CNKCS203
143600         PERFORM 3410-POSITION-AT-ERROR                           CNKCS203
143700     END-IF.                                                      CNKCS203
143800                                                                  CNKCS203
143900*----------------------------------------------------------------*CNKCS203
144000*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *CNKCS203
144100*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *CNKCS203
144200*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *CNKCS203
144300*----------------------------------------------------------------*CNKCS203
144400 3410-POSITION-AT-ERROR.                                          CNKCS203
144500                                                                  CNKCS203
144600     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       CNKCS203
144700                                                                  CNKCS203
144800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 CNKCS203
144900                    - PV-TOP-ITEM + 1.                            CNKCS203
145000                                                                  CNKCS203
145100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      CNKCS203
145200         CONTINUE                                                 CNKCS203
145300     ELSE                                                         CNKCS203
145400         MOVE -1                   TO MR-SELECTL (PV-SUB)         CNKCS203
145500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         CNKCS203
145600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         CNKCS203
145700     END-IF.                                                      CNKCS203
145800                                                                  CNKCS203
145900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   CNKCS203
146000                    - PV-TOP-ITEM + 1.                            CNKCS203
146100                                                                  CNKCS203
146200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      CNKCS203
146300         CONTINUE                                                 CNKCS203
146400     ELSE                                                         CNKCS203
146500         MOVE -1                   TO MR-SELECTL (PV-SUB)         CNKCS203
146600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         CNKCS203
146700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         CNKCS203
146800     END-IF.                                                      CNKCS203
146900                                                                  CNKCS203
147000/                                                                 CNKCS203
147100*----------------------------------------------------------------*CNKCS203
147200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *CNKCS203
147300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *CNKCS203
147400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *CNKCS203
147500*----------------------------------------------------------------*CNKCS203
147600                                                                  CNKCS203
147700 3500-MARK-RANGE-AS-SELECTED.                                     CNKCS203
147800                                                                  CNKCS203
147900     MOVE +1                       TO ASC-BLK-SUB.                CNKCS203
148000                                                                  CNKCS203
148100     PERFORM 3510-MARK-SELECTED-INDS                              CNKCS203
148200         VARYING ASC-ITEM-SUB                                     CNKCS203
148300         FROM 1 BY 1                                              CNKCS203
148400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS203
148500                                                                  CNKCS203
148600     ADD +1                        TO ASC-BLK-SUB.                CNKCS203
148700                                                                  CNKCS203
148800     PERFORM 3510-MARK-SELECTED-INDS                              CNKCS203
148900         VARYING ASC-ITEM-SUB                                     CNKCS203
149000         FROM 1 BY 1                                              CNKCS203
149100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS203
149200                                                                  CNKCS203
149300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               CNKCS203
149400                                   TO PV-LIST-ITEM-NUMBER.        CNKCS203
149500                                                                  CNKCS203
149600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            CNKCS203
149700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         CNKCS203
149800               PC-ITEMS-PER-PANEL).                               CNKCS203
149900                                                                  CNKCS203
150000     MOVE ASC-START-OF-SELECTED-RANGE                             CNKCS203
150100                                   TO PV-START-OF-SELECTED-RANGE. CNKCS203
150200                                                                  CNKCS203
150300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            CNKCS203
150400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  CNKCS203
150500               PC-ITEMS-PER-PANEL).                               CNKCS203
150600                                                                  CNKCS203
150700     MOVE ASC-END-OF-SELECTED-RANGE                               CNKCS203
150800                                   TO PV-END-OF-SELECTED-RANGE.   CNKCS203
150900                                                                  CNKCS203
151000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             CNKCS203
151100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    CNKCS203
151200               PC-ITEMS-PER-PANEL).                               CNKCS203
151300                                                                  CNKCS203
151400     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             CNKCS203
151500         PV-FIRST-BLOCK-IN-ARRAY + 1.                             CNKCS203
151600                                                                  CNKCS203
151700     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    CNKCS203
151800        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        CNKCS203
151900         MOVE +1                   TO ASC-BLK-SUB                 CNKCS203
152000         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS203
152100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         CNKCS203
152200             PV-FIRST-BLOCK-IN-ARRAY - 1                          CNKCS203
152300                                                                  CNKCS203
152400         PERFORM                                                  CNKCS203
152500             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      CNKCS203
152600                   PV-PREV-BLOCK-IN-ARRAY                         CNKCS203
152700             MOVE PV-FIRST-BLOCK-IN-RANGE                         CNKCS203
152800                                   TO PV-BLOCK-NUMBER             CNKCS203
152900             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS203
153000             PERFORM 3510-MARK-SELECTED-INDS                      CNKCS203
153100                 VARYING ASC-ITEM-SUB                             CNKCS203
153200                 FROM 1 BY 1                                      CNKCS203
153300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS203
153400             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS203
153500             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     CNKCS203
153600         END-PERFORM                                              CNKCS203
153700                                                                  CNKCS203
153800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         CNKCS203
153900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     CNKCS203
154000         PERFORM                                                  CNKCS203
154100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       CNKCS203
154200                   PV-LAST-BLOCK-IN-RANGE                         CNKCS203
154300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          CNKCS203
154400                                   TO PV-BLOCK-NUMBER             CNKCS203
154500             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS203
154600             PERFORM 3510-MARK-SELECTED-INDS                      CNKCS203
154700                 VARYING ASC-ITEM-SUB                             CNKCS203
154800                 FROM 1 BY 1                                      CNKCS203
154900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS203
155000             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS203
155100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      CNKCS203
155200         END-PERFORM                                              CNKCS203
155300                                                                  CNKCS203
155400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             CNKCS203
155500                                   TO PV-BLOCK-NUMBER             CNKCS203
155600         PERFORM 4410-READ-TEMP-STORAGE                           CNKCS203
155700     END-IF.                                                      CNKCS203
155800                                                                  CNKCS203
155900     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE CNKCS203
156000                                      ASC-END-OF-SELECTED-RANGE.  CNKCS203
156100                                                                  CNKCS203
156200/                                                                 CNKCS203
156300*----------------------------------------------------------------*CNKCS203
156400* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *CNKCS203
156500*----------------------------------------------------------------*CNKCS203
156600                                                                  CNKCS203
156700 3510-MARK-SELECTED-INDS.                                         CNKCS203
156800                                                                  CNKCS203
156900     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         CNKCS203
157000         ASC-START-OF-SELECTED-RANGE)                             CNKCS203
157100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         CNKCS203
157200         ASC-START-OF-SELECTED-RANGE)                             CNKCS203
157300                                                                  CNKCS203
157400         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     CNKCS203
157500             ASC-END-OF-SELECTED-RANGE)                           CNKCS203
157600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     CNKCS203
157700             ASC-END-OF-SELECTED-RANGE)                           CNKCS203
157800                                                                  CNKCS203
157900             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS203
158000                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   CNKCS203
158100                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   CNKCS203
158200                                   TO TRUE                        CNKCS203
158300                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              CNKCS203
158400                                   TO TRUE                        CNKCS203
158500                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS203
158600             END-IF                                               CNKCS203
158700         END-IF                                                   CNKCS203
158800     END-IF.                                                      CNKCS203
158900                                                                  CNKCS203
159000/                                                                 CNKCS203
159100*----------------------------------------------------------------*CNKCS203
159200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *CNKCS203
159300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *CNKCS203
159400*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *CNKCS203
159500*    DISPLAY THE PANEL TO USER.                                  *CNKCS203
159600*----------------------------------------------------------------*CNKCS203
159700                                                                  CNKCS203
159800 4000-BUILD-INITIAL-PANEL.                                        CNKCS203
159900                                                                  CNKCS203
160000     INITIALIZE ASC-BLOCK-ENTRIES (1)                             CNKCS203
160100                ASC-BLOCK-ENTRIES (2).                            CNKCS203
160200                                                                  CNKCS203
160300     MOVE +1                       TO ASC-BLK-SUB.                CNKCS203
160400                                                                  CNKCS203
160500     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       CNKCS203
160600                                                                  CNKCS203
160700     MOVE +0                       TO ASC-ITEM-SUB                CNKCS203
160800                                      ASC-NUMBER-OF-ITEMS-READ    CNKCS203
160900                                      ASC-NUMBER-OF-SELECTED-ITEMSCNKCS203
161000                                      ASC-HIGHEST-BLOCK-WRITTEN   CNKCS203
161100                                      ASC-START-OF-SELECTED-RANGE CNKCS203
161200                                      ASC-END-OF-SELECTED-RANGE   CNKCS203
161300                                      ASC-ITEM-AT-TOP-OF-PANEL.   CNKCS203
161400                                                                  CNKCS203
161500     PERFORM 4100-PREPARE-CURSOR.                                 CNKCS203
161600                                                                  CNKCS203
161700     PERFORM 4010-OPEN-CURSOR.                                    CNKCS203
161800                                                                  CNKCS203
161900     PERFORM 4300-READ-ITEMS-FROM-DB.                             CNKCS203
162000                                                                  CNKCS203
162100     PERFORM 4020-CLOSE-CURSOR.                                   CNKCS203
162200                                                                  CNKCS203
162300     MOVE +1                       TO PV-TOP-ITEM.                CNKCS203
162400                                                                  CNKCS203
162500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          CNKCS203
162600         SET DP020-NEXT-ACT-APPL-ERROR                            CNKCS203
162700                                   TO TRUE                        CNKCS203
162800         SET DP020-MSG-FATAL       TO TRUE                        CNKCS203
162900         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            CNKCS203
163000     ELSE                                                         CNKCS203
163100         MOVE -1                   TO MR-SELECTL (1)              CNKCS203
163200         SET DP030-SET-CURSOR-APPL-1                              CNKCS203
163300                                   TO TRUE                        CNKCS203
163400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     CNKCS203
163500     END-IF.                                                      CNKCS203
163600                                                                  CNKCS203
163700/                                                                 CNKCS203
163800*----------------------------------------------------------------*CNKCS203
163900* OPEN THE TICKET CURSOR                                         *CNKCS203
164000*----------------------------------------------------------------*CNKCS203
164100                                                                  CNKCS203
164200 4010-OPEN-CURSOR.                                                CNKCS203
164300                                                                  CNKCS203
164400     PERFORM                                                      CNKCS203
164500         WITH TEST AFTER                                          CNKCS203
164600         VARYING PV-RETRY-COUNTER                                 CNKCS203
164700         FROM 1 BY 1                                              CNKCS203
164800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS203
164900            OR (SQLCODE = +0))                                    CNKCS203
165000                                                                  CNKCS203
165100         EXEC SQL                                                 CNKCS203
165200             OPEN TICKET-CSR                                      CNKCS203
165300         END-EXEC                                                 CNKCS203
165400                                                                  CNKCS203
165500         EVALUATE TRUE                                            CNKCS203
165600             WHEN SQLCODE = +0                                    CNKCS203
165700                  CONTINUE                                        CNKCS203
165800             WHEN SQLCODE = -904                                  CNKCS203
165900             WHEN SQLCODE = -913                                  CNKCS203
166000                  CONTINUE                                        CNKCS203
166100             WHEN SQLWARN0 NOT = SPACE                            CNKCS203
166200             WHEN SQLCODE  NOT = +0                               CNKCS203
166300                  MOVE '4010-OPEN-CURSOR'                         CNKCS203
166400                                   TO DP013-PARAGRAPH             CNKCS203
166500                  MOVE 'OPEN TICKET-CSR CURSOR'                   CNKCS203
166600                                   TO DP013-MESSAGE-TEXT (1)      CNKCS203
166700                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS203
166800                  MOVE 'TTKTFMT'   TO DP013-DB2-TABLE-NAME (1)    CNKCS203
166900                  SET DP013-DB2-ABEND                             CNKCS203
167000                                   TO TRUE                        CNKCS203
167100                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS203
167200         END-EVALUATE                                             CNKCS203
167300     END-PERFORM.                                                 CNKCS203
167400                                                                  CNKCS203
167500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS203
167600         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             CNKCS203
167700         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              CNKCS203
167800                                   TO DP013-MESSAGE-TEXT (1)      CNKCS203
167900         MOVE SQLCA                TO DP013-SQLCA                 CNKCS203
168000         SET DP013-DB2-ABEND       TO TRUE                        CNKCS203
168100         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
168200     END-IF.                                                      CNKCS203
168300                                                                  CNKCS203
168400/                                                                 CNKCS203
168500*----------------------------------------------------------------*CNKCS203
168600* CLOSE THE TICKET CURSOR                                        *CNKCS203
168700*----------------------------------------------------------------*CNKCS203
168800                                                                  CNKCS203
168900 4020-CLOSE-CURSOR.                                               CNKCS203
169000                                                                  CNKCS203
169100     EXEC SQL                                                     CNKCS203
169200         CLOSE TICKET-CSR                                         CNKCS203
169300     END-EXEC.                                                    CNKCS203
169400                                                                  CNKCS203
169500     EVALUATE TRUE                                                CNKCS203
169600         WHEN SQLCODE = +0                                        CNKCS203
169700              CONTINUE                                            CNKCS203
169800         WHEN SQLWARN0 NOT = SPACE                                CNKCS203
169900         WHEN SQLCODE  NOT = +0                                   CNKCS203
170000              MOVE '4020-CLOSE-CURSOR'                            CNKCS203
170100                                   TO DP013-PARAGRAPH             CNKCS203
170200              MOVE 'CLOSE TICKET-CSR CURSOR'                      CNKCS203
170300                                   TO DP013-MESSAGE-TEXT (1)      CNKCS203
170400              MOVE SQLCA           TO DP013-SQLCA                 CNKCS203
170500              MOVE 'TTKTFMT'       TO DP013-DB2-TABLE-NAME (1)    CNKCS203
170600              SET DP013-DB2-ABEND  TO TRUE                        CNKCS203
170700              PERFORM DP013-0000-PROCESS-ABEND                    CNKCS203
170800     END-EVALUATE.                                                CNKCS203
170900                                                                  CNKCS203
171000/                                                                 CNKCS203
171100*----------------------------------------------------------------*CNKCS203
171200*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *CNKCS203
171300*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *CNKCS203
171400*----------------------------------------------------------------*CNKCS203
171500                                                                  CNKCS203
171600 4100-PREPARE-CURSOR.                                             CNKCS203
171700                                                                  CNKCS203
171800     IF DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT           CNKCS203
171900        IF CN001-FCLTY-ID > ZEROES                                CNKCS203
172000           MOVE CN001-FCLTY-ID        TO DK-FCLTY-ID-LOW          CNKCS203
172100                                         DK-FCLTY-ID-HIGH         CNKCS203
172200                                         DK-FCLTY-ID              CNKCS203
172300        ELSE                                                      CNKCS203
172400           MOVE ZEROES                TO DK-FCLTY-ID-LOW          CNKCS203
172500                                         DK-FCLTY-ID              CNKCS203
172600           MOVE 9999                  TO DK-FCLTY-ID-HIGH         CNKCS203
172700        END-IF                                                    CNKCS203
172800        IF CN001-TKT-FMT-ID > SPACES                              CNKCS203
172900           MOVE CN001-TKT-FMT-ID      TO DK-TKT-FMT-ID-LOW        CNKCS203
173000                                         DK-TKT-FMT-ID-HIGH       CNKCS203
173100        ELSE                                                      CNKCS203
173200           MOVE SPACES                TO DK-TKT-FMT-ID-LOW        CNKCS203
173300           MOVE '999999'              TO DK-TKT-FMT-ID-HIGH       CNKCS203
173400        END-IF                                                    CNKCS203
173500     ELSE                                                         CNKCS203
173600        IF ASC-KEY-FCLTY-ID-LOW > ZEROES                          CNKCS203
173700           MOVE ASC-KEY-FCLTY-ID-LOW  TO DK-FCLTY-ID-LOW          CNKCS203
173800        ELSE                                                      CNKCS203
173900           MOVE ZEROES                TO DK-FCLTY-ID-LOW          CNKCS203
174000        END-IF                                                    CNKCS203
174100        IF ASC-KEY-FCLTY-ID-HIGH > ZEROES                         CNKCS203
174200           MOVE ASC-KEY-FCLTY-ID-HIGH TO DK-FCLTY-ID-HIGH         CNKCS203
174300        ELSE                                                      CNKCS203
174400           MOVE 9999                  TO DK-FCLTY-ID-HIGH         CNKCS203
174500        END-IF                                                    CNKCS203
174600        IF ASC-KEY-FMT-ID-LOW > SPACES                            CNKCS203
174700           MOVE ASC-KEY-FMT-ID-LOW    TO DK-TKT-FMT-ID-LOW        CNKCS203
174800        ELSE                                                      CNKCS203
174900           MOVE SPACES                TO DK-TKT-FMT-ID-LOW        CNKCS203
175000        END-IF                                                    CNKCS203
175100        IF ASC-KEY-FMT-ID-HIGH > SPACES                           CNKCS203
175200           MOVE ASC-KEY-FMT-ID-HIGH   TO DK-TKT-FMT-ID-HIGH       CNKCS203
175300        ELSE                                                      CNKCS203
175400           MOVE '999999'              TO DK-TKT-FMT-ID-HIGH       CNKCS203
175500        END-IF                                                    CNKCS203
175600     END-IF.                                                      CNKCS203
175700                                                                  CNKCS203
175800/                                                                 CNKCS203
175900*----------------------------------------------------------------*CNKCS203
176000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *CNKCS203
176100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *CNKCS203
176200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *CNKCS203
176300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *CNKCS203
176400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *CNKCS203
176500*                                                                *CNKCS203
176600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *CNKCS203
176700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *CNKCS203
176800*    UPON INITIALIZATION.                                        *CNKCS203
176900*----------------------------------------------------------------*CNKCS203
177000                                                                  CNKCS203
177100 4300-READ-ITEMS-FROM-DB.                                         CNKCS203
177200                                                                  CNKCS203
177300     PERFORM 4320-GET-STORE-INFORMATION.                          CNKCS203
177500                                                                  CNKCS203
177600     PERFORM                                                      CNKCS203
177700         VARYING PV-READ-COUNT                                    CNKCS203
177800         FROM 1 BY 1                                              CNKCS203
177900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    CNKCS203
178000            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         CNKCS203
178100                                                                  CNKCS203
178200         PERFORM 4310-FETCH                                       CNKCS203
178300                                                                  CNKCS203
178400         IF  ASC-ITEMS-LEFT-ON-DB                                 CNKCS203
178500             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                CNKCS203
178600                 ADD +1            TO ASC-ITEM-SUB                CNKCS203
178700             ELSE                                                 CNKCS203
178800                 ADD +1            TO ASC-BLK-SUB                 CNKCS203
178900                 MOVE +1           TO ASC-ITEM-SUB                CNKCS203
179000                                                                  CNKCS203
179100                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         CNKCS203
179200                     MOVE +1       TO ASC-BLK-SUB                 CNKCS203
179300                     SET ASC-BLOCK-MODIFIED (1)                   CNKCS203
179400                                   TO TRUE                        CNKCS203
179500                     PERFORM 5100-WRITE-TEMP-STORAGE              CNKCS203
179600                     MOVE ASC-BLOCK-ENTRIES                       CNKCS203
179700                               (PC-MAX-BLOCKS-IN-ARRAY)           CNKCS203
179800                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) CNKCS203
179900                     ADD +1        TO ASC-BLK-SUB                 CNKCS203
180000                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   CNKCS203
180100                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      CNKCS203
180200                                   TO TRUE                        CNKCS203
180300                 END-IF                                           CNKCS203
180400             END-IF                                               CNKCS203
180500             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    CNKCS203
180600             MOVE ASC-NUMBER-OF-ITEMS-READ                        CNKCS203
180700                                   TO ASC-LIST-ITEM-NUMBER        CNKCS203
180800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  CNKCS203
180900             MOVE TKTFMT-FCLTY-ID  TO ASC-FCLTY-ID                CNKCS203
181000                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
181100             MOVE TKTFMT-TKT-FMT-ID                               CNKCS203
181200                                   TO ASC-FORMAT                  CNKCS203
181300                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
181400             MOVE TKTFMT-TKT-FMT-DESC                             CNKCS203
181500                                   TO ASC-DESC                    CNKCS203
181600                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
181700             MOVE TKTFMT-TYP-CDE   TO ASC-TYP                     CNKCS203
181800                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
181900             MOVE TKTFMT-PAPER-TYP-ID                             CNKCS203
182000                                   TO ASC-TYPE                    CNKCS203
182100                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
182200             IF DN-CMPANON-TKT-ID = -1                            CNKCS203
182300                MOVE SPACES        TO ASC-STKR                    CNKCS203
182400                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
182500             ELSE                                                 CNKCS203
182600                MOVE TKTFMT-CMPANON-TKT-ID                        CNKCS203
182700                                   TO ASC-STKR                    CNKCS203
182800                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
182900             END-IF                                               CNKCS203
183000             MOVE TKTFMT-OPT-BLK-TAGS-IND                            CL**2
183100                                   TO ASC-TEXT                    CNKCS203
183200                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
183300             MOVE TKTFMT-PRT-SIZE-IND                             CNKCS203
183400                                   TO ASC-SIZE                    CNKCS203
183500                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
183600             MOVE TKTFMT-PRT-COLOR-IND                            CNKCS203
183700                                   TO ASC-COLOR                   CNKCS203
183800                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
183900             MOVE TKTFMT-PRT-GP-PR-IND                            CNKCS203
184000                                   TO ASC-PRICE                   CNKCS203
184100                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
184200             PERFORM 4330-SELECT-TPRTSTK                          CNKCS203
184300             MOVE PRTSTK-EXTRA-TKTS-PRT-CDE                       CNKCS203
184400                                   TO ASC-APPL                    CNKCS203
184500                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
184600             IF PRTSTK-EXTRA-TKTS-NBR > ZERO                      CNKCS203
184700                MOVE 'C'           TO ASC-TTYP                    CNKCS203
184800                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
184900                MOVE PRTSTK-EXTRA-TKTS-NBR                        CNKCS203
185000                                    TO ASC-NR                     CNKCS203
185100                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
185200             ELSE                                                 CNKCS203
185300                MOVE 'P'           TO ASC-TTYP                    CNKCS203
185400                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
185500                MOVE PRTSTK-EXTRA-TKTS-PCT                        CNKCS203
185600                                    TO ASC-NR                     CNKCS203
185700                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
185800             END-IF                                               CNKCS203
185900         END-IF                                                   CNKCS203
186000         MOVE ASC-KEY-OPER-UNT-ID   TO ASC-OPER-UNT-ID            CNKCS203
186100                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
186200     END-PERFORM.                                                 CNKCS203
186300                                                                  CNKCS203
186400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          CNKCS203
186500         MOVE +1                   TO ASC-BLK-SUB                 CNKCS203
186600         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS203
186700         ADD +1                    TO ASC-BLK-SUB                 CNKCS203
186800         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS203
186900                                                                  CNKCS203
187000         MOVE 1                    TO ASC-BLK-SUB                 CNKCS203
187100                                      PV-BLOCK-NUMBER             CNKCS203
187200         PERFORM 4410-READ-TEMP-STORAGE                           CNKCS203
187300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             CNKCS203
187400             MOVE 2                TO ASC-BLK-SUB                 CNKCS203
187500                                      PV-BLOCK-NUMBER             CNKCS203
187600             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS203
187700         END-IF                                                   CNKCS203
187800     END-IF.                                                      CNKCS203
187900                                                                  CNKCS203
188000/                                                                 CNKCS203
188100*----------------------------------------------------------------*CNKCS203
188200*    FETCH A TICKET FORMAT ROW                                   *CNKCS203
188300*----------------------------------------------------------------*CNKCS203
188400                                                                  CNKCS203
188500 4310-FETCH.                                                      CNKCS203
188600                                                                  CNKCS203
188700     EXEC SQL                                                     CNKCS203
188800         FETCH TICKET-CSR                                         CNKCS203
188900          INTO :TKTFMT-FCLTY-ID                                   CNKCS203
189000              ,:TKTFMT-TKT-FMT-ID                                 CNKCS203
189100              ,:TKTFMT-TKT-FMT-DESC                               CNKCS203
189200              ,:TKTFMT-TYP-CDE                                    CNKCS203
189300              ,:TKTFMT-OPT-BLK-TAGS-IND                              CL**2
189400              ,:TKTFMT-PRT-SIZE-IND                               CNKCS203
189500              ,:TKTFMT-PRT-COLOR-IND                              CNKCS203
189600              ,:TKTFMT-PRT-GP-PR-IND                              CNKCS203
189700              ,:TKTFMT-CMPANON-TKT-ID                             CNKCS203
189800                 :DN-CMPANON-TKT-ID                               CNKCS203
189900              ,:TKTFMT-PAPER-TYP-ID                               CNKCS203
190000     END-EXEC.                                                    CNKCS203
190100                                                                  CNKCS203
190200     EVALUATE TRUE                                                CNKCS203
190300         WHEN SQLCODE = +0                                        CNKCS203
190400              CONTINUE                                            CNKCS203
190500         WHEN SQLCODE = +100                                      CNKCS203
190600              SET ASC-NO-ITEMS-LEFT-ON-DB                         CNKCS203
190700                                   TO TRUE                        CNKCS203
190800         WHEN SQLWARN0 NOT = SPACE                                CNKCS203
190900         WHEN SQLCODE < +0                                        CNKCS203
191000         WHEN SQLCODE > +0                                        CNKCS203
191100              MOVE '4310-FETCH-CURSOR'                            CNKCS203
191200                                   TO DP013-PARAGRAPH             CNKCS203
191300              MOVE 'FETCH MESSAGE CURSOR'                         CNKCS203
191400                                   TO DP013-MESSAGE-TEXT (1)      CNKCS203
191500              MOVE SQLCA           TO DP013-SQLCA                 CNKCS203
191600              MOVE 'TTKTFMT'       TO DP013-DB2-TABLE-NAME (1)    CNKCS203
191700              SET DP013-DB2-ABEND  TO TRUE                        CNKCS203
191800              PERFORM DP013-0000-PROCESS-ABEND                    CNKCS203
191900     END-EVALUATE.                                                CNKCS203
192000                                                                  CNKCS203
192100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS203
192200         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             CNKCS203
192300         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             CNKCS203
192400                                   TO DP013-MESSAGE-TEXT (1)      CNKCS203
192500         MOVE SQLCA                TO DP013-SQLCA                 CNKCS203
192600         SET DP013-DB2-ABEND                                      CNKCS203
192700             DP013-XCTL-DISPLAY-RESTART                           CNKCS203
192800                                   TO TRUE                        CNKCS203
192900         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
193000     END-IF.                                                      CNKCS203
193100                                                                  CNKCS203
193200/                                                                 CNKCS203
199100                                                                  18470003
199200****************************************************************  18480003
199300*    THIS PARAGRAPH RETRIEVES THE STORE INFORMATION.           *  18490003
199400*                                                              *  18500003
199500****************************************************************  18510003
199600                                                                  18520003
199700 4320-GET-STORE-INFORMATION.                                      18530003
199800                                                                  18540003
199900     INITIALIZE XL071-COMMAREA.                                   18550003
200000     MOVE DK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.                18560003
200100                                                                  18570003
200200     CALL XL071-LOCATION-MODULE USING                             18580003
200300                                DFHEIBLK                          18590003
200400                                XL071-COMMAREA                    18600003
200500                                XL071-COMMAREA-REC.               18610003
200600                                                                  18620003
200700     EVALUATE TRUE                                                18630003
200800         WHEN XL071-NO-ERRORS                                     18640003
200900         WHEN XL071-DC-ASGMT-NOT-FND                              18650003
201000              MOVE XL071-LOC-NM TO ASC-FCLTY-NME                  18660003
201100                                                                  18670003
201200         WHEN XL071-LOC-NOT-FOUND                                 18680003
201300              MOVE SPACES       TO ASC-FCLTY-NME                  18690003
201400                                                                  18700003
201500         WHEN OTHER                                               18710003
201600              MOVE '4320-GET-STORE-INFORMATION'                   18720003
201700                                  TO DP013-PARAGRAPH              18730003
201710              STRING 'SELECT STORE NUMBER - '                             
201720                      XL071-LOCATION-NUMBER                               
201730                     ' - BAD RETURN CODE FROM XLKUT071 - '                
201740                      XL071-RETURN-CODE                                   
201750                      DELIMITED BY SIZE                                   
201760                      INTO DP013-MESSAGE-TEXT (1)                         
201770              STRING 'BAD SQLCODE - '                                     
201780                      XL071-SQLCODE                                       
201790                     ' - '                                                
201791                      XL071-DB2-TABLE                                     
201792                      DELIMITED BY SIZE                                   
201793                      INTO DP013-MESSAGE-TEXT (2)                         
201794              MOVE XL071-SQLCA     TO DP013-SQLCA                         
201795              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)            
202400              MOVE XL071-SQLCODE TO SQLCODE                       18800003
202700              SET DP013-DB2-ABEND                                 18830003
202800                  DP013-XCTL-DISPLAY-RESTART TO TRUE              18840003
202900              PERFORM DP013-0000-PROCESS-ABEND                    18850003
203000                                                                  18860003
203100     END-EVALUATE.                                                18870003
203200                                                                  CNKCS203
203300/                                                                 CNKCS203
203400*----------------------------------------------------------------*CNKCS203
203500*    READ PRINT STOCK TYPE TABLE                                 *CNKCS203
203600*----------------------------------------------------------------*CNKCS203
203700                                                                  CNKCS203
203800 4330-SELECT-TPRTSTK.                                             CNKCS203
203900                                                                  CNKCS203
204000     PERFORM                                                      CNKCS203
204100         WITH TEST AFTER                                          CNKCS203
204200         VARYING PV-RETRY-COUNTER                                 CNKCS203
204300         FROM 1 BY 1                                              CNKCS203
204400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS203
204500            OR  (SQLCODE = +0))                                   CNKCS203
204600                                                                  CNKCS203
204700         EXEC SQL                                                 CNKCS203
204800             SELECT EXTRA_TKTS_PRT_CDE                            CNKCS203
204900                   ,EXTRA_TKTS_PCT                                CNKCS203
205000                   ,EXTRA_TKTS_NBR                                CNKCS203
205100              INTO :PRTSTK-EXTRA-TKTS-PRT-CDE                     CNKCS203
205200                  ,:PRTSTK-EXTRA-TKTS-PCT                         CNKCS203
205300                  ,:PRTSTK-EXTRA-TKTS-NBR                         CNKCS203
205400              FROM TPRTSTK                                        CNKCS203
205500             WHERE PAPER_TYPE_ID = :TKTFMT-PAPER-TYP-ID           CNKCS203
205600         END-EXEC                                                 CNKCS203
205700                                                                  CNKCS203
205800         EVALUATE TRUE                                            CNKCS203
205900             WHEN SQLCODE = +0                                    CNKCS203
206000             WHEN SQLCODE = -904                                  CNKCS203
206100             WHEN SQLCODE = -913                                  CNKCS203
206200                  CONTINUE                                        CNKCS203
206300             WHEN SQLWARN0 NOT = SPACE                            CNKCS203
206400             WHEN SQLCODE < +0                                    CNKCS203
206500             WHEN SQLCODE > +0                                    CNKCS203
206600                  MOVE '4330-SELECT-TPRTSTK'                      CNKCS203
206700                                   TO DP013-PARAGRAPH             CNKCS203
206800                  MOVE 'SELECT ON TPRTSTK'                        CNKCS203
206900                                   TO DP013-MESSAGE-TEXT (1)      CNKCS203
207000                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS203
207100                  MOVE 'TPRTSTK'   TO DP013-DB2-TABLE-NAME (1)    CNKCS203
207200                  SET DP013-DB2-ABEND                             CNKCS203
207300                      DP013-XCTL-DISPLAY-RESTART                  CNKCS203
207400                                   TO TRUE                        CNKCS203
207500                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS203
207600         END-EVALUATE                                             CNKCS203
207700     END-PERFORM.                                                 CNKCS203
207800                                                                  CNKCS203
207900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS203
208000         MOVE '4330-SELECT-TPRTSTL'                               CNKCS203
208100                                   TO DP013-PARAGRAPH             CNKCS203
208200         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   CNKCS203
208300                                   TO DP013-MESSAGE-TEXT (1)      CNKCS203
208400         MOVE 'ON TABLE TPRTSTK '  TO DP013-MESSAGE-TEXT (2)      CNKCS203
208500         MOVE SQLCA                TO DP013-SQLCA                 CNKCS203
208600         SET DP013-DB2-ABEND                                      CNKCS203
208700             DP013-XCTL-DISPLAY-RESTART                           CNKCS203
208800                                   TO TRUE                        CNKCS203
208900         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
209000     END-IF.                                                      CNKCS203
209100                                                                  CNKCS203
209200/                                                                 CNKCS203
209300*----------------------------------------------------------------*CNKCS203
209400* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *CNKCS203
209500*----------------------------------------------------------------*CNKCS203
209600                                                                  CNKCS203
209700 4400-MOVE-COMMAREA-TO-SCREEN.                                    CNKCS203
209800                                                                  CNKCS203
209900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             CNKCS203
210000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          CNKCS203
210100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          CNKCS203
210200             MOVE +1               TO ASC-BLK-SUB                 CNKCS203
210300             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS203
210400             ADD +1                TO ASC-BLK-SUB                 CNKCS203
210500             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS203
210600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             CNKCS203
210700                 GIVING PV-BLOCK-NUMBER                           CNKCS203
210800                 REMAINDER PV-REMAINDER                           CNKCS203
210900             IF  PV-REMAINDER > ZERO                              CNKCS203
211000                 ADD +1            TO PV-BLOCK-NUMBER             CNKCS203
211100             END-IF                                               CNKCS203
211200             MOVE +1               TO ASC-BLK-SUB                 CNKCS203
211300             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS203
211400             ADD +1                TO ASC-BLK-SUB                 CNKCS203
211500                                      PV-BLOCK-NUMBER             CNKCS203
211600             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS203
211700     END-IF.                                                      CNKCS203
211800                                                                  CNKCS203
211900     MOVE +1                       TO ASC-BLK-SUB.                CNKCS203
212000                                                                  CNKCS203
212100     COMPUTE ASC-ITEM-SUB =                                       CNKCS203
212200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              CNKCS203
212300         + PC-ITEMS-PER-PANEL).                                   CNKCS203
212400                                                                  CNKCS203
212500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        CNKCS203
212600         ADD +1                    TO ASC-BLK-SUB                 CNKCS203
212700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            CNKCS203
212800     END-IF.                                                      CNKCS203
212900                                                                  CNKCS203
213000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           CNKCS203
213100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                CNKCS203
213200                                                                  CNKCS203
213300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        CNKCS203
213400     PERFORM 4420-FORMAT-LIST-LINES                               CNKCS203
213500         VARYING PV-SUB                                           CNKCS203
213600         FROM PC-ITEMS-PER-PANEL BY -1                            CNKCS203
213700         UNTIL PV-SUB < +1.                                       CNKCS203
213800                                                                  CNKCS203
213900     COMPUTE ASC-ITEMS-DISPLAYED =                                CNKCS203
214000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          CNKCS203
214100                                                                  CNKCS203
214200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    CNKCS203
214300                                      ASTRTITO.                   CNKCS203
214400                                                                  CNKCS203
214500     MOVE ASC-KEY-OPER-UNT-ID      TO MR-OPER.                    CNKCS203
214600     MOVE ASC-KEY-FCLTY-ID         TO MR-FCLTY.                   CNKCS203
214700     MOVE ASC-FCLTY-NME            TO MR-FDESC.                   CNKCS203
214800                                                                  CNKCS203
214900     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    CNKCS203
215000     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    CNKCS203
215100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            CNKCS203
215200                                   TO ASELITO.                    CNKCS203
215300                                                                  CNKCS203
215400     IF  DP020-MSG-NUMBER-X = SPACE                               CNKCS203
215500         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  CNKCS203
215600*            --- MORE ITEMS TO DISPLAY ----                       CNKCS203
215700             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            CNKCS203
215800             SET DP020-MSG-INFORMATIONAL                          CNKCS203
215900                                   TO TRUE                        CNKCS203
216000         END-IF                                                   CNKCS203
216100     END-IF.                                                      CNKCS203
216200                                                                  CNKCS203
216300*----------------------------------------------------------------*CNKCS203
216400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *CNKCS203
216500*----------------------------------------------------------------*CNKCS203
216600                                                                  CNKCS203
216700 4410-READ-TEMP-STORAGE.                                          CNKCS203
216800                                                                  CNKCS203
216900     EXEC CICS                                                    CNKCS203
217000         READQ TS                                                 CNKCS203
217100             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS203
217200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               CNKCS203
217300             ITEM  (PV-BLOCK-NUMBER)                              CNKCS203
217400             RESP  (PV-CICS-RESP)                                 CNKCS203
217500     END-EXEC.                                                    CNKCS203
217600                                                                  CNKCS203
217700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       CNKCS203
217800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     CNKCS203
217900         CONTINUE                                                 CNKCS203
218000     ELSE                                                         CNKCS203
218100         SET DP013-CICS-ABEND      TO TRUE                        CNKCS203
218200         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS203
218300         MOVE '4410-READ-TEMP-STORAGE'                            CNKCS203
218400                                   TO DP013-PARAGRAPH             CNKCS203
218500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      CNKCS203
218600                                   TO DP013-MESSAGE-TEXT(1)       CNKCS203
218700         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
218800     END-IF.                                                      CNKCS203
218900                                                                  CNKCS203
219000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      CNKCS203
219100                                   TO TRUE.                       CNKCS203
219200                                                                  CNKCS203
219300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         CNKCS203
219400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               CNKCS203
219500     END-IF.                                                      CNKCS203
219600                                                                  CNKCS203
219700/                                                                 CNKCS203
219800*----------------------------------------------------------------*CNKCS203
219900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *CNKCS203
220000*----------------------------------------------------------------*CNKCS203
220100                                                                  CNKCS203
220200 4420-FORMAT-LIST-LINES.                                          CNKCS203
220300                                                                  CNKCS203
220400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      CNKCS203
220500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                CNKCS203
220600         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         CNKCS203
220700         MOVE SPACES               TO MR-OPER                     CNKCS203
220800                                      MR-FCLTY                    CNKCS203
220900                                      MR-FDESC                    CNKCS203
221000         MOVE SPACE                TO MR-SELECT  (PV-SUB)         CNKCS203
221100                                      MR-ACTION  (PV-SUB)         CNKCS203
221200                                      MR-FCLTY-ID(PV-SUB)         CNKCS203
221300                                      MR-FORMAT  (PV-SUB)         CNKCS203
221400                                      MR-DESC    (PV-SUB)         CNKCS203
221500                                      MR-TYP     (PV-SUB)         CNKCS203
221600                                      MR-TYPE    (PV-SUB)         CNKCS203
221700                                      MR-APPL    (PV-SUB)         CNKCS203
221800                                      MR-TTYP    (PV-SUB)         CNKCS203
221900                                      MR-NR-X    (PV-SUB)         CNKCS203
222000                                      MR-STKR    (PV-SUB)         CNKCS203
222100                                      MR-TEXT    (PV-SUB)         CNKCS203
222200                                      MR-SIZE    (PV-SUB)         CNKCS203
222300                                      MR-COLOR   (PV-SUB)         CNKCS203
222400                                      MR-PRICE   (PV-SUB)         CNKCS203
222500     ELSE                                                         CNKCS203
222600         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      CNKCS203
222700                                                   > SPACE        CNKCS203
222800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS203
222900                                   TO MR-SELECT (PV-SUB)          CNKCS203
223000         ELSE                                                     CNKCS203
223100             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      CNKCS203
223200                                   TO MR-SELECT (PV-SUB)          CNKCS203
223300         END-IF                                                   CNKCS203
223400                                                                  CNKCS203
223500         IF  DP030-SET-CURSOR-TRAILER                             CNKCS203
223600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)CNKCS203
223700                 > SPACE)                                         CNKCS203
223800               OR (PV-SUB = 1))                                   CNKCS203
223900                SET DP030-SET-CURSOR-APPL-1 TO TRUE               CNKCS203
224000                MOVE -1            TO MR-SELECTL (PV-SUB)         CNKCS203
224100             END-IF                                               CNKCS203
224200         END-IF                                                   CNKCS203
224300                                                                  CNKCS203
224400         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           CNKCS203
224500             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
224600                                   TO MR-ACTION (PV-SUB)          CNKCS203
224700             MOVE ASC-FCLTY-ID (ASC-BLK-SUB ASC-ITEM-SUB)         CNKCS203
224800                                   TO MR-FCLTY-ID (PV-SUB)        CNKCS203
224900             MOVE ASC-FORMAT (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
225000                                   TO MR-FORMAT (PV-SUB)          CNKCS203
225100             MOVE ASC-DESC   (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
225200                                   TO MR-DESC (PV-SUB)            CNKCS203
225300             MOVE ASC-TYP    (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
225400                                   TO MR-TYP  (PV-SUB)            CNKCS203
225500             MOVE ASC-TYPE   (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
225600                                   TO MR-TYPE (PV-SUB)            CNKCS203
225700             MOVE ASC-APPL   (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
225800                                   TO MR-APPL (PV-SUB)            CNKCS203
225900             MOVE ASC-TTYP   (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
226000                                   TO MR-TTYP (PV-SUB)            CNKCS203
226100             MOVE ASC-NR     (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
226200                                   TO MR-NR   (PV-SUB)            CNKCS203
226300             MOVE ASC-STKR   (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
226400                                   TO MR-STKR (PV-SUB)            CNKCS203
226500             MOVE ASC-TEXT   (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
226600                                   TO MR-TEXT (PV-SUB)            CNKCS203
226700             MOVE ASC-SIZE   (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
226800                                   TO MR-SIZE (PV-SUB)            CNKCS203
226900             MOVE ASC-COLOR  (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
227000                                   TO MR-COLOR(PV-SUB)            CNKCS203
227100             MOVE ASC-PRICE  (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS203
227200                                   TO MR-PRICE(PV-SUB)            CNKCS203
227300         END-IF                                                   CNKCS203
227400     END-IF.                                                      CNKCS203
227500                                                                  CNKCS203
227600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               CNKCS203
227700                                                                  CNKCS203
227800     IF  ASC-ITEM-SUB < + 1                                       CNKCS203
227900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                CNKCS203
228000         MOVE +1                   TO ASC-BLK-SUB                 CNKCS203
228100     END-IF.                                                      CNKCS203
228200                                                                  CNKCS203
228300*----------------------------------------------------------------*CNKCS203
228400*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *CNKCS203
228500*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *CNKCS203
228600*  ISSUE A WARNING.                                              *CNKCS203
228700*----------------------------------------------------------------*CNKCS203
228800 4430-CHECK-FOR-BEGIN-AND-END.                                    CNKCS203
228900                                                                  CNKCS203
229000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       CNKCS203
229100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     CNKCS203
229200*            -- NO END-OF-RANGE SPECFIED ---                      CNKCS203
229300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            CNKCS203
229400             SET DP020-MSG-WARNING TO TRUE                        CNKCS203
229500             PERFORM 4431-POSITION-AT-WARNING                     CNKCS203
229600         END-IF                                                   CNKCS203
229700     ELSE                                                         CNKCS203
229800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     CNKCS203
229900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                CNKCS203
230000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            CNKCS203
230100             SET DP020-MSG-WARNING TO TRUE                        CNKCS203
230200             PERFORM 4431-POSITION-AT-WARNING                     CNKCS203
230300         END-IF                                                   CNKCS203
230400     END-IF.                                                      CNKCS203
230500                                                                  CNKCS203
230600*----------------------------------------------------------------*CNKCS203
230700*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *CNKCS203
230800*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *CNKCS203
230900*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *CNKCS203
231000*  POSITION THE CURSOR THERE.                                    *CNKCS203
231100*----------------------------------------------------------------*CNKCS203
231200 4431-POSITION-AT-WARNING.                                        CNKCS203
231300                                                                  CNKCS203
231400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 CNKCS203
231500                    - PV-TOP-ITEM + 1.                            CNKCS203
231600                                                                  CNKCS203
231700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      CNKCS203
231800         CONTINUE                                                 CNKCS203
231900     ELSE                                                         CNKCS203
232000         SET DP030-SET-CURSOR-APPL-1                              CNKCS203
232100                                   TO TRUE                        CNKCS203
232200         MOVE -1                   TO MR-SELECTL (PV-SUB)         CNKCS203
232300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         CNKCS203
232400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         CNKCS203
232500     END-IF.                                                      CNKCS203
232600                                                                  CNKCS203
232700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   CNKCS203
232800                    - PV-TOP-ITEM + 1.                            CNKCS203
232900                                                                  CNKCS203
233000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      CNKCS203
233100         CONTINUE                                                 CNKCS203
233200     ELSE                                                         CNKCS203
233300         SET DP030-SET-CURSOR-APPL-1                              CNKCS203
233400                                   TO TRUE                        CNKCS203
233500         MOVE -1                   TO MR-SELECTL (PV-SUB)         CNKCS203
233600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         CNKCS203
233700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         CNKCS203
233800     END-IF.                                                      CNKCS203
233900                                                                  CNKCS203
234000/                                                                 CNKCS203
234100*----------------------------------------------------------------*CNKCS203
234200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *CNKCS203
234300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *CNKCS203
234400* FOR THE SELECTED ITEMS QUEUE.                                  *CNKCS203
234500*                                                                *CNKCS203
234600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *CNKCS203
234700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *CNKCS203
234800* THE ARRAY IS FULL.                                             *CNKCS203
234900*----------------------------------------------------------------*CNKCS203
235000                                                                  CNKCS203
235100 5000-PREPARE-SEL-QUEUE.                                          CNKCS203
235200                                                                  CNKCS203
235300     MOVE +1                       TO ASC-BLK-SUB.                CNKCS203
235400     PERFORM 5100-WRITE-TEMP-STORAGE.                             CNKCS203
235500     ADD +1                        TO ASC-BLK-SUB.                CNKCS203
235600     PERFORM 5100-WRITE-TEMP-STORAGE.                             CNKCS203
235700                                                                  CNKCS203
235800     MOVE ASC-SEL-QUEUE-NAME       TO CN003-SEL-QUEUE-NAME.       CNKCS203
235900     PERFORM 6010-DELETE-SEL-QUEUE.                               CNKCS203
236000                                                                  CNKCS203
236100     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      CNKCS203
236200         SET ASC-UPDATE-TSQ        TO TRUE                        CNKCS203
236300     END-IF.                                                      CNKCS203
236400                                                                  CNKCS203
236500     SET CN004-IDX                 TO 1.                          CNKCS203
236600     MOVE ZERO                     TO CN003-NUMBER-OF-TS-ITEMS.   CNKCS203
236700     INITIALIZE CN004-SELECTED-ITEM-ARRAY.                        CNKCS203
236800                                                                  CNKCS203
236900     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           CNKCS203
237000             VARYING PV-ITEM                                      CNKCS203
237100             FROM 1 BY 1                                          CNKCS203
237200             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     CNKCS203
237300                                                                  CNKCS203
237400     IF  CN004-IDX > 1                                            CNKCS203
237500         PERFORM 5205-WRITE-SEL-QUEUE                             CNKCS203
237600         ADD +1                    TO CN003-NUMBER-OF-TS-ITEMS    CNKCS203
237700     END-IF.                                                      CNKCS203
237800                                                                  CNKCS203
237900/                                                                 CNKCS203
238000*----------------------------------------------------------------*CNKCS203
238100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *CNKCS203
238200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *CNKCS203
238300*----------------------------------------------------------------*CNKCS203
238400                                                                  CNKCS203
238500 5100-WRITE-TEMP-STORAGE.                                         CNKCS203
238600                                                                  CNKCS203
238700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     CNKCS203
238800                                   TO PV-LIST-ITEM-NUMBER.        CNKCS203
238900     COMPUTE PV-BLOCK-NUMBER =                                    CNKCS203
239000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    CNKCS203
239100                                                                  CNKCS203
239200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             CNKCS203
239300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             CNKCS203
239400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      CNKCS203
239500             PERFORM 5105-REWRITE-ASC-LISTQ                       CNKCS203
239600         END-IF                                                   CNKCS203
239700     ELSE                                                         CNKCS203
239800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       CNKCS203
239900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            CNKCS203
240000         PERFORM 5110-WRITE-ASC-LISTQ                             CNKCS203
240100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   CNKCS203
240200     END-IF.                                                      CNKCS203
240300                                                                  CNKCS203
240400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      CNKCS203
240500                                   TO TRUE.                       CNKCS203
240600                                                                  CNKCS203
240700/                                                                 CNKCS203
240800*----------------------------------------------------------------*CNKCS203
240900*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *CNKCS203
241000*  SPECIFIC COMMAREA.                                            *CNKCS203
241100*----------------------------------------------------------------*CNKCS203
241200 5105-REWRITE-ASC-LISTQ.                                          CNKCS203
241300                                                                  CNKCS203
241400     EXEC CICS                                                    CNKCS203
241500         WRITEQ TS                                                CNKCS203
241600             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS203
241700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               CNKCS203
241800             ITEM  (PV-BLOCK-NUMBER)                              CNKCS203
241900             REWRITE                                              CNKCS203
242000             RESP  (PV-CICS-RESP)                                 CNKCS203
242100     END-EXEC.                                                    CNKCS203
242200                                                                  CNKCS203
242300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           CNKCS203
242400         CONTINUE                                                 CNKCS203
242500     ELSE                                                         CNKCS203
242600         SET DP013-CICS-ABEND      TO TRUE                        CNKCS203
242700         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS203
242800         MOVE '5105-REWRITE-ASC-LISTQ'                            CNKCS203
242900                                   TO DP013-PARAGRAPH             CNKCS203
243000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     CNKCS203
243100                                   TO DP013-MESSAGE-TEXT(1)       CNKCS203
243200         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
243300     END-IF.                                                      CNKCS203
243400                                                                  CNKCS203
243500/                                                                 CNKCS203
243600*----------------------------------------------------------------*CNKCS203
243700*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *CNKCS203
243800*  SPECIFIC COMMAREA.                                            *CNKCS203
243900*----------------------------------------------------------------*CNKCS203
244000 5110-WRITE-ASC-LISTQ.                                            CNKCS203
244100                                                                  CNKCS203
244200     EXEC CICS                                                    CNKCS203
244300         WRITEQ TS                                                CNKCS203
244400             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS203
244500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               CNKCS203
244600             ITEM  (PV-BLOCK-NUMBER)                              CNKCS203
244700             RESP  (PV-CICS-RESP)                                 CNKCS203
244800     END-EXEC.                                                    CNKCS203
244900                                                                  CNKCS203
245000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      CNKCS203
245100         SET DP013-CICS-ABEND      TO TRUE                        CNKCS203
245200         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS203
245300         MOVE '5110-WRITE-ASC-LISTQ'                              CNKCS203
245400                                   TO DP013-PARAGRAPH             CNKCS203
245500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           CNKCS203
245600                                   TO DP013-MESSAGE-TEXT(1)       CNKCS203
245700         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
245800     END-IF.                                                      CNKCS203
245900                                                                  CNKCS203
246000/                                                                 CNKCS203
246100*----------------------------------------------------------------*CNKCS203
246200* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *CNKCS203
246300* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *CNKCS203
246400*----------------------------------------------------------------*CNKCS203
246500                                                                  CNKCS203
246600 5200-FILL-SEL-QUEUE-RECORD.                                      CNKCS203
246700                                                                  CNKCS203
246800     PERFORM 6112-READ-LIST-QUEUE.                                CNKCS203
246900                                                                  CNKCS203
247000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       CNKCS203
247100         PERFORM                                                  CNKCS203
247200         VARYING LQW-IDX                                          CNKCS203
247300         FROM 1 BY 1                                              CNKCS203
247400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            CNKCS203
247500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          CNKCS203
247600                                                                  CNKCS203
247700             IF  LQW-SELECT (LQW-IDX)                             CNKCS203
247800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              CNKCS203
247900                                   TO CN004-ITEM (CN004-IDX)      CNKCS203
248000                 MOVE LQW-FORMAT (LQW-IDX)                        CNKCS203
248100                                   TO CN004-TKT-FMT-ID            CNKCS203
248200                                                      (CN004-IDX) CNKCS203
248300                 MOVE LQW-OPER-UNT-ID (LQW-IDX)                   CNKCS203
248400                                TO CN004-OPER-UNT-ID  (CN004-IDX) CNKCS203
248500                 MOVE LQW-FCLTY-ID (LQW-IDX)                      CNKCS203
248600                                   TO CN004-FCLTY-ID  (CN004-IDX) CNKCS203
248700                 MOVE SPACE        TO CN004-ACTION-SW (CN004-IDX) CNKCS203
248800                 SET CN004-IDX UP BY 1                            CNKCS203
248900                 IF  CN004-IDX > CN004-MAX-ITEMS                  CNKCS203
249000                     PERFORM 5205-WRITE-SEL-QUEUE                 CNKCS203
249100                     ADD +1        TO CN003-NUMBER-OF-TS-ITEMS    CNKCS203
249200                     INITIALIZE CN004-SELECTED-ITEM-ARRAY         CNKCS203
249300                     SET CN004-IDX TO 1                           CNKCS203
249400                 END-IF                                           CNKCS203
249500             END-IF                                               CNKCS203
249600         END-PERFORM                                              CNKCS203
249700     END-IF.                                                      CNKCS203
249800                                                                  CNKCS203
249900/                                                                 CNKCS203
250000*----------------------------------------------------------------*CNKCS203
250100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *CNKCS203
250200*----------------------------------------------------------------*CNKCS203
250300                                                                  CNKCS203
250400 5205-WRITE-SEL-QUEUE.                                            CNKCS203
250500                                                                  CNKCS203
250600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            CNKCS203
250700                                   TO CN004-SELECTED-ITEMS.       CNKCS203
250800                                                                  CNKCS203
250900     EXEC CICS                                                    CNKCS203
251000          WRITEQ TS                                               CNKCS203
251100              QUEUE (ASC-SEL-QUEUE-NAME)                          CNKCS203
251200              FROM  (CN004-TS-SEL-REC)                            CNKCS203
251300              ITEM  (PV-SEL-QUEUE-ITEM)                           CNKCS203
251400              RESP  (PV-CICS-RESP)                                CNKCS203
251500     END-EXEC.                                                    CNKCS203
251600                                                                  CNKCS203
251700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          CNKCS203
251800         CONTINUE                                                 CNKCS203
251900     ELSE                                                         CNKCS203
252000         SET DP013-CICS-ABEND      TO TRUE                        CNKCS203
252100         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS203
252200         MOVE '5205-WRITE-SEL-QUEUE'                              CNKCS203
252300                                   TO DP013-PARAGRAPH             CNKCS203
252400         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          CNKCS203
252500                                   TO DP013-MESSAGE-TEXT(1)       CNKCS203
252600         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
252700     END-IF.                                                      CNKCS203
252800                                                                  CNKCS203
252900/                                                                 CNKCS203
253000*----------------------------------------------------------------*CNKCS203
253100*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *CNKCS203
253200*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *CNKCS203
253300*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *CNKCS203
253400*  THE USER.                                                     *CNKCS203
253500*----------------------------------------------------------------*CNKCS203
253600 6000-REFRESH-PANEL-FROM-TEMP.                                    CNKCS203
253700                                                                  CNKCS203
253800     IF  ASC-UPDATE-TSQ                                           CNKCS203
253900         SET ASC-NO-TSQ-UPDATE     TO TRUE                        CNKCS203
254000         MOVE ZERO                 TO PV-SAVE-ITEM                CNKCS203
254100                                      PV-SEL-QUEUE-ITEM           CNKCS203
254200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        CNKCS203
254300                                   TO PV-HOLD-SELECTED-ITEMS      CNKCS203
254400         PERFORM 6100-UPDATE-TSQ                                  CNKCS203
254500             UNTIL PV-ITEMS-PROCESSED >                           CNKCS203
254600                                     ASC-NUMBER-OF-SELECTED-ITEMS CNKCS203
254700         PERFORM 6010-DELETE-SEL-QUEUE                            CNKCS203
254800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         CNKCS203
254900                    ASC-BLOCK-ENTRIES (2)                         CNKCS203
255000     END-IF.                                                      CNKCS203
255100                                                                  CNKCS203
255200/                                                                 CNKCS203
255300*----------------------------------------------------------------*CNKCS203
255400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *CNKCS203
255500*----------------------------------------------------------------*CNKCS203
255600 6010-DELETE-SEL-QUEUE.                                           CNKCS203
255700                                                                  CNKCS203
255800     EXEC CICS                                                    CNKCS203
255900         DELETEQ TS                                               CNKCS203
256000             QUEUE (ASC-SEL-QUEUE-NAME)                           CNKCS203
256100             RESP  (PV-CICS-RESP)                                 CNKCS203
256200     END-EXEC.                                                    CNKCS203
256300                                                                  CNKCS203
256400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      CNKCS203
256500         (PV-CICS-RESP = DFHRESP(QIDERR)))                        CNKCS203
256600         CONTINUE                                                 CNKCS203
256700     ELSE                                                         CNKCS203
256800         SET DP013-CICS-ABEND      TO TRUE                        CNKCS203
256900         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS203
257000         MOVE '6010-DELETE-SEL-QUEUE'                             CNKCS203
257100                                   TO DP013-PARAGRAPH             CNKCS203
257200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         CNKCS203
257300                                   TO DP013-MESSAGE-TEXT (1)      CNKCS203
257400         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
257500     END-IF.                                                      CNKCS203
257600                                                                  CNKCS203
257700/                                                                 CNKCS203
257800*----------------------------------------------------------------*CNKCS203
257900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *CNKCS203
258000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *CNKCS203
258100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *CNKCS203
258200*    THE TEMP QUEUE.                                             *CNKCS203
258300*----------------------------------------------------------------*CNKCS203
258400                                                                  CNKCS203
258500 6100-UPDATE-TSQ.                                                 CNKCS203
258600                                                                  CNKCS203
258700     ADD 1                         TO PV-SEL-QUEUE-ITEM.          CNKCS203
258800     PERFORM 6105-READ-SEL-QUEUE.                                 CNKCS203
258900                                                                  CNKCS203
259000     PERFORM                                                      CNKCS203
259100         VARYING CN004-IDX                                        CNKCS203
259200         FROM 1 BY 1                                              CNKCS203
259300         UNTIL ((PV-ITEMS-PROCESSED >                             CNKCS203
259400                              PV-HOLD-SELECTED-ITEMS)             CNKCS203
259500         OR (CN004-IDX GREATER THAN CN004-MAX-ITEMS))             CNKCS203
259600         IF  CN004-ACTION-SW (CN004-IDX) > SPACE                  CNKCS203
259700             PERFORM 6110-PROCESS-ITEMS                           CNKCS203
259800         END-IF                                                   CNKCS203
259900         ADD +1                    TO PV-ITEMS-PROCESSED          CNKCS203
260000     END-PERFORM.                                                 CNKCS203
260100                                                                  CNKCS203
260200     PERFORM 6111-WRITE-LIST-QUEUE.                               CNKCS203
260300                                                                  CNKCS203
260400/                                                                 CNKCS203
260500*----------------------------------------------------------------*CNKCS203
260600*    READ THE LIST QUEUE RECORD.                                 *CNKCS203
260700*----------------------------------------------------------------*CNKCS203
260800                                                                  CNKCS203
260900 6105-READ-SEL-QUEUE.                                             CNKCS203
261000                                                                  CNKCS203
261100     EXEC CICS                                                    CNKCS203
261200          READQ TS                                                CNKCS203
261300              QUEUE (ASC-SEL-QUEUE-NAME)                          CNKCS203
261400              INTO  (CN004-TS-SEL-REC)                            CNKCS203
261500              ITEM  (PV-SEL-QUEUE-ITEM)                           CNKCS203
261600              RESP  (PV-CICS-RESP)                                CNKCS203
261700     END-EXEC.                                                    CNKCS203
261800                                                                  CNKCS203
261900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          CNKCS203
262000         CONTINUE                                                 CNKCS203
262100     ELSE                                                         CNKCS203
262200         SET DP013-CICS-ABEND      TO TRUE                        CNKCS203
262300         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS203
262400         MOVE '6105-READ-SEL-QUEUE'                               CNKCS203
262500                                   TO DP013-PARAGRAPH             CNKCS203
262600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           CNKCS203
262700                                   TO DP013-MESSAGE-TEXT(1)       CNKCS203
262800         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
262900     END-IF.                                                      CNKCS203
263000                                                                  CNKCS203
263100/                                                                 CNKCS203
263200*----------------------------------------------------------------*CNKCS203
263300*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*CNKCS203
263400*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*CNKCS203
263500*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *CNKCS203
263600*----------------------------------------------------------------*CNKCS203
263700                                                                  CNKCS203
263800 6110-PROCESS-ITEMS.                                              CNKCS203
263900                                                                  CNKCS203
264000     COMPUTE PV-ITEM = 1 + ((CN004-ITEM (CN004-IDX) - 1)          CNKCS203
264100                     / PC-ITEMS-PER-PANEL).                       CNKCS203
264200                                                                  CNKCS203
264300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           CNKCS203
264400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          CNKCS203
264500             PERFORM 6111-WRITE-LIST-QUEUE                        CNKCS203
264600         END-IF                                                   CNKCS203
264700         MOVE PV-ITEM              TO PV-SAVE-ITEM                CNKCS203
264800                                                                  CNKCS203
264900         PERFORM 6112-READ-LIST-QUEUE                             CNKCS203
265000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               CNKCS203
265100             CONTINUE                                             CNKCS203
265200         END-IF                                                   CNKCS203
265300     END-IF.                                                      CNKCS203
265400                                                                  CNKCS203
265500     COMPUTE PV-SUB = (CN004-ITEM (CN004-IDX)                     CNKCS203
265600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              CNKCS203
265700                                                                  CNKCS203
265800     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       CNKCS203
265900     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        CNKCS203
266000                                     (PV-SUB).                    CNKCS203
266100     EVALUATE TRUE                                                CNKCS203
266200         WHEN CN004-INQ (CN004-IDX)                               CNKCS203
266300              MOVE PC-INQ          TO LQW-ACTION (PV-SUB)         CNKCS203
266400                                                                  CNKCS203
266500         WHEN CN004-UPD (CN004-IDX)                               CNKCS203
266600              MOVE PC-UPD          TO LQW-ACTION (PV-SUB)         CNKCS203
266700                                                                  CNKCS203
266800         WHEN CN004-DEL (CN004-IDX)                               CNKCS203
266900              MOVE PC-DEL          TO LQW-ACTION (PV-SUB)         CNKCS203
267000                                                                  CNKCS203
267100         WHEN CN004-ERR (CN004-IDX)                               CNKCS203
267200              MOVE PC-ERR          TO LQW-ACTION (PV-SUB)         CNKCS203
267300     END-EVALUATE.                                                CNKCS203
267400                                                                  CNKCS203
267500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                CNKCS203
267600                                                                  CNKCS203
267700/                                                                 CNKCS203
267800*----------------------------------------------------------------*CNKCS203
267900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *CNKCS203
268000*----------------------------------------------------------------*CNKCS203
268100                                                                  CNKCS203
268200 6111-WRITE-LIST-QUEUE.                                           CNKCS203
268300                                                                  CNKCS203
268400     EXEC CICS                                                    CNKCS203
268500         WRITEQ TS                                                CNKCS203
268600             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS203
268700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     CNKCS203
268800             ITEM  (PV-SAVE-ITEM)                                 CNKCS203
268900             REWRITE                                              CNKCS203
269000             RESP  (PV-CICS-RESP)                                 CNKCS203
269100     END-EXEC.                                                    CNKCS203
269200                                                                  CNKCS203
269300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          CNKCS203
269400         CONTINUE                                                 CNKCS203
269500     ELSE                                                         CNKCS203
269600         SET DP013-CICS-ABEND      TO TRUE                        CNKCS203
269700         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS203
269800         MOVE '6111-WRITE-LIST-QUEUE'                             CNKCS203
269900                                   TO DP013-PARAGRAPH             CNKCS203
270000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  CNKCS203
270100                                   TO DP013-MESSAGE-TEXT(1)       CNKCS203
270200         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
270300     END-IF.                                                      CNKCS203
270400                                                                  CNKCS203
270500/                                                                 CNKCS203
270600*----------------------------------------------------------------*CNKCS203
270700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*CNKCS203
270800*----------------------------------------------------------------*CNKCS203
270900                                                                  CNKCS203
271000 6112-READ-LIST-QUEUE.                                            CNKCS203
271100                                                                  CNKCS203
271200     EXEC CICS                                                    CNKCS203
271300         READQ TS                                                 CNKCS203
271400             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS203
271500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     CNKCS203
271600             ITEM  (PV-ITEM)                                      CNKCS203
271700             RESP  (PV-CICS-RESP)                                 CNKCS203
271800     END-EXEC.                                                    CNKCS203
271900                                                                  CNKCS203
272000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          CNKCS203
272100         CONTINUE                                                 CNKCS203
272200     ELSE                                                         CNKCS203
272300         SET DP013-CICS-ABEND      TO TRUE                        CNKCS203
272400         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS203
272500         MOVE '6112-READ-LIST-QUEUE'                              CNKCS203
272600                                   TO DP013-PARAGRAPH             CNKCS203
272700         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    CNKCS203
272800                                   TO DP013-MESSAGE-TEXT(1)       CNKCS203
272900         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS203
273000     END-IF.                                                      CNKCS203
273100                                                                  CNKCS203
273200/                                                                 CNKCS203
273300*----------------------------------------------------------------*CNKCS203
273400*    ABEND PROCESSOR MODULE                                      *CNKCS203
273500*----------------------------------------------------------------*CNKCS203
273600                                                                  CNKCS203
273700     COPY DPPD013.                                                CNKCS203
