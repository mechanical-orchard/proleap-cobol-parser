000100 IDENTIFICATION DIVISION.                                         00010013
000200                                                                  00020013
000300 PROGRAM-ID.      SAKUT047.                                       00030013
000400 AUTHOR.          STEVEN NOWAK.                                   00040013
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050013
000600 DATE-WRITTEN.    04/15/09.                                       00060013
000700 DATE-COMPILED.                                                   00070013
000800                                                                  00080013
000900******************************************************************00090013
001000*            ***  E-COMMERCE TSAADSU LOADER  ***                  00100013
001100*=================================================================00110013
001200*                                                                 00120013
001300*  THE E-STORE WILL NOT HAVE A CASH OFFICE, SO THE TSAADSU TABLE  00130013
001400*  WILL NOT BE GETTING LOADED FROM THAT SOURCE.  THIS PROGRAM     00140013
001500*  WILL COPY DATA FROM THE TSASUM TABLE INTO A EXTRACT FILE WHICH 00150013
001510*  WILL BE USED TO UPDATE THE TSAADSU TABLE FOR THE E-STORE.      00160013
001700*                                                                 00170013
001800*  THIS PROGRAM WILL RUN ON A DAILY BASIS                         00180013
002000*                                                                 00190013
002100*  INPUT: INP01 - CONTAINS POS DATE, WHICH IS USED AS THE         00200013
002200*                  PROCESS DATE.                                  00210013
002300*                                                                 00220013
002400*========================== CHANGE LOG ===========================00230013
002500*  AUTH      BY       DATE                 DESCRIPTION            00240013
002600*=================================================================00250013
002700* WR36527  TKMA409  04-15-09   CREATE PROGRAM                     00260013
002800*                                                                 00270013
002900******************************************************************00280013
M92405* CHG0092405 TKMA555  12-02-14   ADDED COMMISSION BUCKETS, 'WFC'  00281013
M92405*   'WRC' AND 'DWF' FOR MARKETPLACE.                              00282013
002900******************************************************************00283013
P10530* CHG0105300 TKMA555  02-19-15   MADE A CHANGE TO ADD INSTEAD OF  00283113
P10530*   SUBTRACT 'WRT', 'WRH', AND 'WFR' FROM 'DWF'                   00283213
255393******************************************************************00283314
255393* CHG0255393 TKMAC09  03-19-21   ADDED LOGIC FOR SEPHORA.         00283514
255393*  ADD TSASUM CODES:  'SCS' - SEPHORA CHARGE SALES                00283614
255393*                     'SCR' - SEPHORA CHARGE SALES                00283714
255393*                     'SGS' - SEPHORA GIFT CARD SALES             00283814
255393*                     'SGT' - SEPHORA GIFT CARD TENDERS           00283914
255393*  ADD TSAADSU CODES: 'SCN' - SEPHORA CHARGE NET                  00284014
255393*                     'SGS' - SEPHORA GIFT CARD SALES             00284114
255393*                     'SGT' - SEPHORA GIFT CARD TENDERS           00284214
267791******************************************************************00284314
267791* CHG0267791 TKMAC09  03-11-22   REMOVING SEPHORA CATEGORIES      00284414
267791*                                ADDED PREV YEAR BECAUSE THEY WILL00284514
267791*                                NOT BE IN CASH OFFICE.           00284614
267791******************************************************************00284714
PAYVEN* CHG0289270 TKMAC09  05-25-23   ADD LOGIC FOR PAYPAL AND VENMO.  00285317
PAYVEN*  ADD TSASUM CODES:  'PPS' - PAYPAL CHARGE SALES                 00285415
PAYVEN*                     'PPR' - PAYPAL CHARGE RETURNS               00285515
PAYVEN*                     'VMS' - VENMO CHARGE SALES                  00285615
PAYVEN*                     'VMR' - VENMO CHARGE RETURNS                00285715
PAYVEN*  ADD TSAADSU CODES: 'PPN' - PAYPAL CHARGE NET                   00285815
PAYVEN*                     'VMN' - VENMO CHARGE NET                    00285915
PAYVEN*  ALSO, REMOVE ALL LOGIC FOR OBSOLETE WAYFAIR CODES:             00286015
PAYVEN*        WFC, WRC, WFS, WFR, WFT, WRT, WFH, WRH, DWF              00286115
PAYVEN*  ELIMINATE WRITING ROWS WITH VALUES OF ZEROES, INCLUDING        00286215
PAYVEN*  CATEGORIES THAT AREN'T RELAVENT TO ECOM: COH, CUD, ROS, SOS    00286315
PAYVEN******************************************************************00288315
003000                                                                  00288415
003100 ENVIRONMENT DIVISION.                                            00288515
003200 CONFIGURATION SECTION.                                           00288615
003300                                                                  00288715
003400 SOURCE-COMPUTER.        IBM-3090.                                00288815
003500 OBJECT-COMPUTER.        IBM-3090.                                00288915
003600                                                                  00289015
003700 INPUT-OUTPUT SECTION.                                            00289115
003800 FILE-CONTROL.                                                    00289215
003900                                                                  00289315
004000     SELECT POS-DATE-CARD-FILE ASSIGN TO INP01.                   00289413
004100     SELECT TSAADSU-FILE       ASSIGN TO OUT01.                   00289513
004200                                                                  00290013
004300 DATA DIVISION.                                                   00300013
004400 FILE SECTION.                                                    00310013
004500                                                                  00320013
004600 FD  POS-DATE-CARD-FILE                                           00330013
004700     RECORDING MODE IS F                                          00340013
004800     BLOCK CONTAINS 0 RECORDS                                     00350013
004900     LABEL RECORDS ARE STANDARD.                                  00360013
005000                                                                  00370013
005100 01  POS-DATE-CARD-RECORD             PIC  X(80).                 00380013
005200                                                                  00390013
005300 FD  TSAADSU-FILE                                                 00400013
005400     RECORDING MODE IS F                                          00410013
005500     BLOCK CONTAINS 0 RECORDS                                     00420013
005600     LABEL RECORDS ARE STANDARD.                                  00430013
005700                                                                  00440013
005800 01  TSAADSU-REC                      PIC  X(28).                 00450013
005900                                                                  00460013
006000                                                                  00470013
006100******************************************************************00480013
006200*                       WORKING STORAGE                           00490013
006300******************************************************************00500013
006400 WORKING-STORAGE SECTION.                                         00510013
006500                                                                  00520013
006600 01  W-START                          PIC  X(50)    VALUE         00530013
006700     ' *** WORKING STORAGE STARTS HERE FOR SAKUT047 *** '.        00540013
006800                                                                  00550013
006900******************************************************************00560013
007000*                          SWITCHES                               00570013
007100******************************************************************00580013
007200 01  PS-PROGRAM-SWITCHES.                                         00590013
007300                                                                  00600013
007400     05  PS-END-OF-ESTORE-CURSOR-SW   PIC  X(01)    VALUE 'N'.    00610013
007500         88  PS-END-OF-ESTORE-CURSOR                VALUE 'Y'.    00620013
007600     05  PS-END-OF-SUM-CURSOR-SW      PIC  X(01)    VALUE 'N'.    00630013
007700         88  PS-END-OF-SUM-CURSOR                   VALUE 'Y'.    00640013
007800     05  PS-END-OF-CARD-FILE-SW       PIC  X(01)    VALUE 'N'.    00650013
007900         88  PS-END-OF-CARD-FILE                    VALUE 'Y'.    00660013
008000                                                                  00670013
008100******************************************************************00680013
008200*                         CONSTANTS                               00690013
008300******************************************************************00700013
008400 01  PC-CONSTANTS.                                                00710013
008500                                                                  00720013
008600     05  PC-JOB-NAME                  PIC  X(08)    VALUE         00730013
008700                                                    'SAK051  '.   00740013
008800     05  PC-PGM-NAME                  PIC  X(08)    VALUE         00750013
008900                                                    'SAKUT047'.   00760013
009000                                                                  00770013
009100     05  PC-ROW-NOT-FOUND             PIC S9(04)    VALUE +100    00780013
009200                                                    COMP SYNC.    00790013
009300     05  PC-SUM-CTG-CDE               PIC  X(03).                 00800013
009400         88  PC-SUM-CTG-CDE-KMT                     VALUE 'KMT'.  00810013
009500         88  PC-SUM-CTG-CDE-POS                     VALUE 'POS'.  00820013
009600         88  PC-SUM-CTG-CDE-GTT                     VALUE 'GTT'.  00830013
009700         88  PC-SUM-CTG-CDE-GDT                     VALUE 'GDT'.  00840013
009800         88  PC-SUM-CTG-CDE-TAX                     VALUE 'TAX'.  00850013
009900         88  PC-SUM-CTG-CDE-GTS                     VALUE 'GTS'.  00860013
010000         88  PC-SUM-CTG-CDE-GDS                     VALUE 'GDS'.  00870013
010100         88  PC-SUM-CTG-CDE-CRI                     VALUE 'CRI'.  00880013
010200         88  PC-SUM-CTG-CDE-KMI                     VALUE 'KMI'.  00890013
010300         88  PC-SUM-CTG-CDE-POR                     VALUE 'POR'.  00900013
010400         88  PC-SUM-CTG-CDE-KCP                     VALUE 'KCP'.  00910013
010500         88  PC-SUM-CTG-CDE-NSF                     VALUE 'NSF'.  00920013
010600         88  PC-SUM-CTG-CDE-ECR                     VALUE 'ECR'.  00930013
010700         88  PC-SUM-CTG-CDE-BCS                     VALUE 'BCS'.  00940013
010800         88  PC-SUM-CTG-CDE-BCR                     VALUE 'BCR'.  00950013
010900         88  PC-SUM-CTG-CDE-NCS                     VALUE 'NCS'.  00960013
011000         88  PC-SUM-CTG-CDE-NCR                     VALUE 'NCR'.  00970013
011100         88  PC-SUM-CTG-CDE-AXS                     VALUE 'AXS'.  00980013
011200         88  PC-SUM-CTG-CDE-AXR                     VALUE 'AXR'.  00990013
011300         88  PC-SUM-CTG-CDE-KCS                     VALUE 'KCS'.  01000013
011400         88  PC-SUM-CTG-CDE-KCR                     VALUE 'KCR'.  01010013
011500         88  PC-SUM-CTG-CDE-RET                     VALUE 'RET'.  01020013
011600         88  PC-SUM-CTG-CDE-SAL                     VALUE 'SAL'.  01030013
011700         88  PC-SUM-CTG-CDE-SHS                     VALUE 'SHS'.  01040013
011800         88  PC-SUM-CTG-CDE-SHR                     VALUE 'SHR'.  01050013
011900         88  PC-SUM-CTG-CDE-GWS                     VALUE 'GWS'.  01060013
012000         88  PC-SUM-CTG-CDE-GWR                     VALUE 'GWR'.  01070013
PAYVEN         88  PC-SUM-CTG-CDE-PPS                     VALUE 'PPS'.  01080015
PAYVEN         88  PC-SUM-CTG-CDE-PPR                     VALUE 'PPR'.  01090015
PAYVEN         88  PC-SUM-CTG-CDE-VMS                     VALUE 'VMS'.  01100015
PAYVEN         88  PC-SUM-CTG-CDE-VMR                     VALUE 'VMR'.  01110015
012100                                                                  01170013
012200******************************************************************01180013
012300*                      ACCUMULATORS                               01190013
012400******************************************************************01200013
012500 01  PA-ACCULATORS.                                               01201013
012600                                                                  01202013
012700     05  PA-ESTORE-CURSOR-CNT         PIC  9(07)    VALUE ZEROS.  01203013
012800     05  PA-SUM-CURSOR-CNT            PIC  9(07)    VALUE ZEROS.  01204013
012900                                                                  01205013
013000     05  PA-TSAADSU-WRITTEN           PIC  9(07)    VALUE ZEROS.  01206013
013100                                                                  01207013
013200******************************************************************01208013
013300*                       VARIABLES                                 01209013
013400******************************************************************01210013
013500 01  PV-VARIABLES.                                                01220013
013600     05  PV-SQL                       PIC S9(04)    VALUE ZEROS.  01230013
013700     05  PV-PARAGRAPH-NAME            PIC  X(30)    VALUE SPACES. 01240013
013800     05  PV-DB2-TABLE-NAME            PIC  X(12)    VALUE SPACES. 01250013
013900     05  PV-DB2-OPERATION-MSG         PIC  X(60)    VALUE SPACES. 01260013
014000     05  PV-OPERATION-MSG-1           PIC  X(40)    VALUE SPACES. 01270013
014100     05  PV-OPERATION-MSG-2           PIC  X(40)    VALUE SPACES. 01280013
014200                                                                  01290013
014300     05  PV-ABEND-PARTN-NBR           PIC  9(04)    VALUE ZEROS.  01300013
014400     05  PV-ABEND-STR-NBR             PIC  9(04)    VALUE ZEROS.  01310013
014500     05  PV-ABEND-SUM-CTG-CDE         PIC  X(03)    VALUE SPACES. 01320013
014600                                                                  01330013
014700 01  PV-DB2-VARIABLES.                                            01340013
014800                                                                  01350013
014900     05  PV-DB2-PARTN-NBR             PIC S9(04)    COMP          01360013
015000                                                    VALUE ZERO.   01370013
015100     05  PV-DB2-SUM                   PIC S9(09)V99 COMP-3        01380013
015200                                                    VALUE ZERO.   01390013
015300                                                                  01400013
015400******************************************************************01410013
015500*                       WORK AREA                                 01420013
015600******************************************************************01430013
015700 01  PV-MISC-FIELDS.                                              01440013
015800                                                                  01450013
015900     05  PV-HOLD-ESTORE               PIC S9(04)    COMP          01460013
016000                                                    VALUE ZERO.   01470013
016100                                                                  01480013
016200     05  PV-BCN-AMT                   PIC S9(09)V99 COMP-3        01490013
016300                                                    VALUE ZERO.   01500013
016400     05  PV-NCN-AMT                   PIC S9(09)V99 COMP-3        01510013
016500                                                    VALUE ZERO.   01520013
016600     05  PV-AEN-AMT                   PIC S9(09)V99 COMP-3        01530013
016700                                                    VALUE ZERO.   01540013
016800     05  PV-KCN-AMT                   PIC S9(09)V99 COMP-3        01550013
016900                                                    VALUE ZERO.   01560013
017000     05  PV-STM-AMT                   PIC S9(09)V99 COMP-3        01570013
017100                                                    VALUE ZERO.   01580013
017200     05  PV-TAX-AMT                   PIC S9(09)V99 COMP-3        01590013
017300                                                    VALUE ZERO.   01600013
017400     05  PV-GDS-AMT                   PIC S9(09)V99 COMP-3        01610013
017500                                                    VALUE ZERO.   01620013
017600     05  PV-GTS-AMT                   PIC S9(09)V99 COMP-3        01630013
017700                                                    VALUE ZERO.   01640013
017800     05  PV-KMT-AMT                   PIC S9(09)V99 COMP-3        01650013
017900                                                    VALUE ZERO.   01660013
018000     05  PV-POS-AMT                   PIC S9(09)V99 COMP-3        01670013
018100                                                    VALUE ZERO.   01680013
018200     05  PV-GTT-AMT                   PIC S9(09)V99 COMP-3        01690013
018300                                                    VALUE ZERO.   01700013
018400     05  PV-GDT-AMT                   PIC S9(09)V99 COMP-3        01710013
018500                                                    VALUE ZERO.   01720013
018600     05  PV-CRI-AMT                   PIC S9(09)V99 COMP-3        01730013
018700                                                    VALUE ZERO.   01740013
018800     05  PV-KMI-AMT                   PIC S9(09)V99 COMP-3        01750013
018900                                                    VALUE ZERO.   01760013
019000     05  PV-POR-AMT                   PIC S9(09)V99 COMP-3        01770013
019100                                                    VALUE ZERO.   01780013
019200     05  PV-KCP-AMT                   PIC S9(09)V99 COMP-3        01790013
019300                                                    VALUE ZERO.   01800013
019400     05  PV-NSF-AMT                   PIC S9(09)V99 COMP-3        01810013
019500                                                    VALUE ZERO.   01820013
019600     05  PV-ECR-AMT                   PIC S9(09)V99 COMP-3        01830013
019700                                                    VALUE ZERO.   01840013
019800     05  PV-TMR-AMT                   PIC S9(09)V99 COMP-3        01850013
019900                                                    VALUE ZERO.   01860013
020000     05  PV-SHS-AMT                   PIC S9(09)V99 COMP-3        01870013
020100                                                    VALUE ZERO.   01880013
020200     05  PV-SHR-AMT                   PIC S9(09)V99 COMP-3        01890013
020300                                                    VALUE ZERO.   01900013
020400     05  PV-GWS-AMT                   PIC S9(09)V99 COMP-3        01910013
020500                                                    VALUE ZERO.   01920013
020600     05  PV-GWR-AMT                   PIC S9(09)V99 COMP-3        01930013
020700                                                    VALUE ZERO.   01940013
PAYVEN     05  PV-PPN-AMT                   PIC S9(09)V99 COMP-3        01950015
PAYVEN                                                    VALUE ZERO.   01960015
PAYVEN     05  PV-VMN-AMT                   PIC S9(09)V99 COMP-3        01970015
PAYVEN                                                    VALUE ZERO.   01980015
020800                                                                  02090815
020900******************************************************************02090915
021000*                       DATE/TIME                                 02091015
021100******************************************************************02091115
021200 01  PV-DATE-AND-TIME-FIELDS.                                     02091215
021300                                                                  02091315
021400     05  PV-POS-CCYY-MM-DD            PIC  X(10)    VALUE SPACE.  02091415
021500     05  FILLER REDEFINES PV-POS-CCYY-MM-DD.                      02092013
021600         10  PV-POS-CCYY              PIC  X(04).                 02093013
021700         10  FILLER                   PIC  X(01).                 02093113
021800         10  PV-POS-MM                PIC  X(02).                 02093213
021900         10  FILLER                   PIC  X(01).                 02093313
022000         10  PV-POS-DD                PIC  X(02).                 02093413
022100                                                                  02093513
022200     05  PV-CURR-DATE-CCYYMMDD.                                   02093613
022300         10  PV-CURR-DATE-CCYY        PIC  9(04).                 02093713
022400         10  PV-CURR-DATE-MM          PIC  9(02).                 02093813
022500         10  PV-CURR-DATE-DD          PIC  9(02).                 02093913
022600                                                                  02094013
022700     05  PV-CURR-TIME.                                            02095013
022800         10  PV-CURR-TIME-HH          PIC  9(02)    VALUE ZERO.   02096013
022900         10  PV-CURR-TIME-MM          PIC  9(02)    VALUE ZERO.   02097013
023000         10  PV-CURR-TIME-SSHH        PIC  9(04)    VALUE ZERO.   02098013
023100                                                                  02099013
023200     05  PV-POS-DATE-FORMATTED        PIC  X(10)    VALUE SPACE.  02100013
023300     05  PV-SLS-DTE-MM-DD-CCYY.                                   02110013
023400         10  PV-SLS-DTE-MM            PIC  X(02)    VALUE SPACE.  02120013
023500         10  FILLER                   PIC  X(01)    VALUE '/'.    02130013
023600         10  PV-SLS-DTE-DD            PIC  X(02)    VALUE SPACE.  02140013
023700         10  FILLER                   PIC  X(01)    VALUE '/'.    02150013
023800         10  PV-SLS-DTE-CCYY          PIC  X(04)    VALUE SPACE.  02160013
023900                                                                  02170013
024000******************************************************************02180013
024100*               SYSTEM TIME AND DATE VARIABLES                    02190013
024200******************************************************************02200013
024300 01  SYS-DATE-TIME.                                               02210013
024400     05  SYS-DATE                     PIC  X(08)    VALUE SPACES. 02220013
024500     05  SYS-TIME                     PIC  X(08)    VALUE SPACES. 02230013
024600                                                                  02240013
024700 01  ST-BEG-TIME.                                                 02250013
024800     05  ST-BEG-HR                    PIC  9(02)    VALUE ZEROS.  02260013
024900     05  FILLER                       PIC  X(01)    VALUE ':'.    02270013
025000     05  ST-BEG-MN                    PIC  9(02)    VALUE ZEROS.  02280013
025100                                                                  02290013
025200 01  ST-END-TIME.                                                 02300013
025300     05  ST-END-HR                    PIC  9(02)    VALUE ZEROS.  02310013
025400     05  FILLER                       PIC  X(01)    VALUE ':'.    02320013
025500     05  ST-END-MN                    PIC  9(02)    VALUE ZEROS.  02330013
025600                                                                  02340013
025700 01  SD-EDIT-DATE.                                                02350013
025800     05  SD-MONTH                     PIC  9(02)    VALUE ZEROS.  02360013
025900     05  FILLER                       PIC  X(01)    VALUE '-'.    02370013
026000     05  SD-DAY                       PIC  9(02)    VALUE ZEROS.  02380013
026100     05  FILLER                       PIC  X(01)    VALUE '-'.    02390013
026200     05  SD-CENT                      PIC  9(02)    VALUE ZEROS.  02400013
026300     05  SD-YEAR                      PIC  9(02)    VALUE ZEROS.  02410013
026400                                                                  02420013
026500******************************************************************02430013
026600*                        ERROR HANDLING                           02440013
026700******************************************************************02450013
026800 01  ABEND-CODE                       PIC S9(04)    VALUE ZEROS   02460013
026900                                                    COMP SYNC.    02470013
027000     88  ABEND-4001-WRITE-ERROR                     VALUE +4001.  02480013
027100     88  ABEND-4002-READ-ERROR                      VALUE +4002.  02490013
027200     88  ABEND-4003-CTRL-CARD-ERROR                 VALUE +4003.  02500013
027300     88  ABEND-4004-TABLE-ERROR                     VALUE +4004.  02510013
027400     88  ABEND-4005-OPEN-ERROR                      VALUE +4005.  02520013
027500     88  ABEND-4006-CLOSE-ERROR                     VALUE +4006.  02530013
027600     88  ABEND-4007-SEQUENCE-ERROR                  VALUE +4007.  02540013
027700     88  ABEND-4008-DATA-ERROR                      VALUE +4008.  02550013
027800     88  ABEND-4009-KEY-DATA-ERROR                  VALUE +4009.  02560013
027900     88  ABEND-4013-DB2-ERROR                       VALUE +4013.  02570013
028000     88  ABEND-4019-CAL-SUB-ERROR                   VALUE +4019.  02580013
028100     88  ABEND-4444-FORCED-ABEND                    VALUE +4444.  02590013
028200                                                                  02600013
028300                                                                  02610013
028400******************************************************************02620013
028500* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    02630013
028600******************************************************************02640013
028700 01  CC-CONTROL-CARD.                                             02650013
028800                                                                  02660013
028900     05  CC-CONTROL-CARD-DISPLAY.                                 02670013
029000         10  CC-CONTROL-NAME          PIC  X(14)    VALUE SPACE.  02680013
029100             88  CC-VALID-CONTROL-NAME              VALUE         02690013
029200                    'P.O.S. DATE = '.                             02700013
029300         10  CC-POS-DATE-MMDDYY       PIC  9(06)    VALUE ZERO.   02710013
029400     05  FILLER                       PIC  X(60)    VALUE SPACE.  02720013
029500                                                                  02730013
029600                                                                  02740013
029700******************************************************************02750013
029800*  TSAADSU - STORE TOTALS RECORD LAYOUT                           02760013
029900******************************************************************02770013
030000     COPY SARD007.                                                02780013
030100                                                                  02790013
030200******************************************************************02800013
030300*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             02810013
030400******************************************************************02820013
030500     COPY DPWS500.                                                02830013
030600                                                                  02840013
030700******************************************************************02850013
030800*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            02860013
030900******************************************************************02870013
031000     COPY DPWS004.                                                02880013
031100                                                                  02890013
031200******************************************************************02900013
031300*  DB2 MESSAGE AREA                                               02910013
031400******************************************************************02920013
031500     COPY SQLCA2.                                                 02930013
031600                                                                  02940013
031700******************************************************************02950013
031800*  DB2 COMMUNICATION AREA.                                        02960013
031900******************************************************************02970013
032000     EXEC SQL                                                     02980013
032100          INCLUDE SQLCA                                           02990013
032200     END-EXEC.                                                    03000013
032300                                                                  03010013
032400******************************************************************03020013
032500*  DB2 TABLE XST_LOC - STORE LOCATION TABLE                       03030013
032600******************************************************************03040013
032700     EXEC SQL                                                     03050013
032800          INCLUDE XST00001                                        03060013
032900     END-EXEC.                                                    03070013
033000                                                                  03080013
033100******************************************************************03090013
033200*  DB2 TABLE TSASUM - TOTALS BY STORE REGISTER TABLE              03100013
033300******************************************************************03110013
033400     EXEC SQL                                                     03120013
033500          INCLUDE TSASUM                                          03130013
033600     END-EXEC.                                                    03140013
033700                                                                  03150013
033800******************************************************************03160013
033900*  DB2 TABLE TEPPART - PARTITION TABLE                            03170013
034000******************************************************************03180013
034100     EXEC SQL                                                     03190013
034200          INCLUDE TEPPART                                         03200013
034300     END-EXEC.                                                    03210013
034400                                                                  03220013
034500******************************************************************03230013
034600*  ESTORE-CURSOR -- CURSOR TO RETURN ESTORES                      03240013
034700******************************************************************03250013
034800     EXEC SQL                                                     03260013
034900       DECLARE ESTORE-CURSOR CURSOR FOR                           03270013
035000            SELECT  LOC.LOC_NBR                                   03280013
035100              FROM  XST_LOC LOC                                   03290013
035200             WHERE  LOC.E_BUS_IND   = 'Y'                         03300013
035300               AND  LOC.LOC_TYP_CDE = 'DS'                        03310013
035400               AND  LOC.OPN_DTE <= :PV-POS-CCYY-MM-DD             03320013
035500               AND  LOC.CLO_DTE >= :PV-POS-CCYY-MM-DD             03330013
035600             ORDER BY LOC.LOC_NBR                                 03340013
035700            WITH UR                                               03350013
035800     END-EXEC.                                                    03360013
035900                                                                  03370013
036000                                                                  03380013
036100******************************************************************03390013
036200*  SUM-CURSOR -- CURSOR TO SUM CTG_AMT GROUPED BY THE VARIOUS     03400013
036300*  CATEGORY CODES.                                                03410013
036400******************************************************************03420013
036500     EXEC SQL                                                     03430013
036600       DECLARE SUM-CURSOR CURSOR FOR                              03440013
036700            SELECT  SUM(CTG_AMT) AS PV-DB2-SUM                    03450013
036800                   ,SUM_CTG_CDE                                   03460013
036900              FROM  TSASUM                                        03470013
037000             WHERE  PARTN_NBR   = :PV-DB2-PARTN-NBR               03480013
037100               AND  STR_NBR     = :PV-HOLD-ESTORE                 03490013
037200               AND  SUM_TYP_CDE IN ('D', 'S')                     03500013
037300               AND  RGST_ID     <> 0                              03510013
037400          GROUP BY  SUM_CTG_CDE                                   03520013
037500           WITH UR                                                03530013
037600     END-EXEC.                                                    03540013
037700                                                                  03550013
037900                                                                  03560013
038000 PROCEDURE DIVISION.                                              03570013
038100******************************************************************03580013
038200* MAINLINE                                                        03590013
038300******************************************************************03600013
038400 0000-MAINLINE-PARAGRAPH.                                         03610013
038500                                                                  03620013
038600     PERFORM 1000-INITIALIZE-PROGRAM.                             03630013
038700                                                                  03640013
038800     PERFORM 2000-PROCESS-SUM-CTG-CDE                             03650013
038900       UNTIL PS-END-OF-ESTORE-CURSOR.                             03660013
039000                                                                  03670013
039100     PERFORM 9900-END-PROC.                                       03680013
039200                                                                  03690013
039300     STOP RUN.                                                    03700013
039400                                                                  03710013
039500                                                                  03720013
039600******************************************************************03730013
039700* OPEN FILES, PROCESS CONTROL CARD, FORMAT REPORT HEADINGS,       03740013
039800* FIND PARTITION NUMBER, OPEN MASTER-CURSOR                       03750013
039900******************************************************************03760013
040000 1000-INITIALIZE-PROGRAM.                                         03770013
040100                                                                  03780013
040200     OPEN INPUT  POS-DATE-CARD-FILE.                              03790013
040300     OPEN OUTPUT TSAADSU-FILE.                                    03800013
040400                                                                  03810013
040500     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 03820013
040600                                                                  03830013
040700     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            03840013
040800     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            03850013
040900                                                                  03860013
041000     MOVE SYS-DATE (1:2) TO SD-CENT.                              03870013
041100     MOVE SYS-DATE (3:2) TO SD-YEAR.                              03880013
041200     MOVE SYS-DATE (5:2) TO SD-MONTH.                             03890013
041300     MOVE SYS-DATE (7:2) TO SD-DAY.                               03900013
041400                                                                  03910013
041500     PERFORM 1100-PROCESS-CONTROL-CARD.                           03920013
041600                                                                  03930013
041700     PERFORM 1200-SELECT-PARTITION-NBR.                           03940013
041800                                                                  03950013
041900     PERFORM 1300-OPEN-ESTORE-CURSOR.                             03960013
042000                                                                  03970013
042100                                                                  03980013
042200******************************************************************03990013
042300* READ CONTROL CARD TO GET POS DATE IN MMDDYY FORMAT.  CALL       04000013
042400* DATE ROUTINE TO CONVERT DATE TO A CCYY-MM-DD PROCESS DATE.      04010013
042500******************************************************************04020013
042600 1100-PROCESS-CONTROL-CARD.                                       04030013
042700                                                                  04040013
042800     PERFORM 1110-READ-POS-DATE-CARD-FILE.                        04050013
042900                                                                  04060013
043000     CLOSE POS-DATE-CARD-FILE.                                    04070013
043100                                                                  04080013
043200     IF PS-END-OF-CARD-FILE                                       04090013
043300         MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   04100013
043400         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  04110013
043500                                                                  04120013
043600         SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   04130013
043700         PERFORM 9200-ABEND                                       04140013
043800     END-IF.                                                      04150013
043900                                                                  04160013
044000     DISPLAY '         '.                                         04170013
044100     DISPLAY PC-PGM-NAME                                          04180013
044200             ' - CONTROL CARD = (' CC-CONTROL-CARD-DISPLAY  ')'.  04190013
044300                                                                  04200013
044400     PERFORM 1115-CONVERT-INPUT-DATE.                             04210013
044500                                                                  04220013
044600                                                                  04230013
044700******************************************************************04240013
044800* READ DATE CONTROL CARD.                                         04250013
044900******************************************************************04260013
045000 1110-READ-POS-DATE-CARD-FILE.                                    04270013
045100                                                                  04280013
045200     READ POS-DATE-CARD-FILE INTO CC-CONTROL-CARD                 04290013
045300        AT END                                                    04300013
045400           SET PS-END-OF-CARD-FILE TO TRUE.                       04310013
045500                                                                  04320013
045600                                                                  04330013
045700******************************************************************04340013
045800* CALL KOHLS CALENDAR ROUTINE:                                    04350013
045900*     PASS: CONTROL CARD POS DATE (MMDDYY FORMAT).                04360013
046000*   RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT).     04370013
046100******************************************************************04380013
046200 1115-CONVERT-INPUT-DATE.                                         04390013
046300                                                                  04400013
046400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04410013
046500                                                                  04420013
046600     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   04430013
046700     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   04440013
046800     SET  DPG52-LK-DTE-GREG            TO TRUE.                   04450013
046900                                                                  04460013
047000     MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    04470013
047100                                                                  04480013
047200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    04490013
047300                                             DPG54 DPG55 DPG56.   04500013
047400     EVALUATE TRUE                                                04510013
047500         WHEN DPG54-SEVERE-ERROR                                  04520013
047600         WHEN DPG54-DATE-INVALID                                  04530013
047700             MOVE '1115-CONVERT-INPUT-DATE'                       04540013
047800                                       TO PV-PARAGRAPH-NAME       04550013
047900             MOVE 'ERROR CONVERTING INPUT CARD DATE'              04560013
048000                                       TO PV-OPERATION-MSG-1      04570013
048100             SET ABEND-4019-CAL-SUB-ERROR                         04580013
048200                                       TO TRUE                    04590013
048300             MOVE DPG54-ERROR-MESSAGE                             04600013
048400                                       TO PV-OPERATION-MSG-2      04610013
048500             PERFORM 9200-ABEND                                   04620013
048600     END-EVALUATE.                                                04630013
048700                                                                  04640013
048800     MOVE DPG55-GREG-CC-DATE-FMT       TO PV-POS-DATE-FORMATTED.  04650013
048900     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-POS-CCYY-MM-DD.      04660013
049000                                                                  04670013
049100                                                                  04680013
049200******************************************************************04690013
049300* FIND PARTITION NUMBER THAT CORRESPONDS WITH CONTROL CARD DATE   04700013
049400******************************************************************04710013
049500 1200-SELECT-PARTITION-NBR.                                       04720013
049600                                                                  04730013
049700     EXEC SQL                                                     04740013
049800          SELECT  PARTN_NBR                                       04750013
049900            INTO :PV-DB2-PARTN-NBR                                04760013
050000             FROM TEPPART                                         04770013
050100            WHERE SLS_DTE      = :PV-POS-CCYY-MM-DD               04780013
050200              AND STR_GP_CDE   = 'A'                              04790013
050300              AND DB_STRUC_CDE = 'O'                              04800013
050400          WITH UR                                                 04810013
050500     END-EXEC.                                                    04820013
050600                                                                  04830013
050700     EVALUATE TRUE                                                04840013
050800        WHEN SQLCODE = ZERO                                       04850013
050900            CONTINUE                                              04860013
051000                                                                  04870013
051100        WHEN SQLCODE NOT EQUAL ZERO                               04880013
051200            MOVE SQLCODE TO PV-SQL                                04890013
051300                                                                  04900013
051400            MOVE '1200-SELECT-PARTITION-NBR' TO PV-PARAGRAPH-NAME 04910013
051500            MOVE 'TEPPART'                   TO PV-DB2-TABLE-NAME 04920013
051600                                                                  04930013
051700            STRING 'ERROR ON SELECT OF TEPPART - SQLCODE = '      04940013
051800                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG04950013
051900            END-STRING                                            04960013
052000                                                                  04970013
052100            SET ABEND-4004-TABLE-ERROR TO TRUE                    04980013
052200            PERFORM 9100-SQL-ABEND                                04990013
052300     END-EVALUATE.                                                05000013
052400                                                                  05010013
052500                                                                  05020013
052600******************************************************************05030013
052700*  OPEN THE ESTORE-CURSOR                                         05040013
052800******************************************************************05050013
052900 1300-OPEN-ESTORE-CURSOR.                                         05060013
053000                                                                  05070013
053100     EXEC SQL                                                     05080013
053200          OPEN ESTORE-CURSOR                                      05090013
053300     END-EXEC.                                                    05100013
053400                                                                  05110013
053500     EVALUATE TRUE                                                05120013
053600         WHEN SQLCODE = ZERO                                      05130013
053700             CONTINUE                                             05140013
053800                                                                  05150013
053900         WHEN SQLWARN0 NOT EQUAL SPACE                            05160013
054000         WHEN SQLCODE NOT EQUAL ZERO                              05170013
054100             MOVE SQLCODE TO PV-SQL                               05180013
054200                                                                  05190013
054300             MOVE '1300-OPEN-ESTORE-CURSOR' TO PV-PARAGRAPH-NAME  05200013
054400             MOVE 'XST_LOC'                 TO PV-DB2-TABLE-NAME  05210013
054500                                                                  05220013
054600             STRING 'ERROR ON OPEN OF ESTORE-CURSOR - SQLCODE = ' 05230013
054700                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG05240013
054800             END-STRING                                           05250013
054900                                                                  05260013
055000             SET ABEND-4005-OPEN-ERROR TO TRUE                    05270013
055100             PERFORM 9100-SQL-ABEND                               05280013
055200     END-EVALUATE.                                                05290013
055300                                                                  05300013
055400                                                                  05310013
055500******************************************************************05320013
055600* 2000-PROCESS-SUM-CTG-CDE                                        05330013
055700*     - FETCH ESTORE-CURSOR                                       05340013
055800*     - OPEN, FETCH & CLOSE SUM-CURSOR                            05350013
055900*     - PROCESS AND COMMIT SUMS/CODES FOR ESTORES                 05360013
056000******************************************************************05370013
056100 2000-PROCESS-SUM-CTG-CDE.                                        05380013
056200                                                                  05390013
056300     PERFORM 2100-FETCH-ESTORE-CURSOR.                            05400013
056400                                                                  05410013
056500     IF SQLCODE = ZERO                                            05420013
056600         MOVE XST00001-LOC-NBR  TO PV-HOLD-ESTORE                 05430013
056700         MOVE 'N'               TO PS-END-OF-SUM-CURSOR-SW        05440013
056800                                                                  05450013
056900         PERFORM 3000-OPEN-SUM-CURSOR                             05460013
057000         PERFORM 3100-FETCH-SUM-CURSOR                            05470013
057100           UNTIL PS-END-OF-SUM-CURSOR                             05480013
057200         PERFORM 3200-CLOSE-SUM-CURSOR                            05490013
057300                                                                  05500013
057400         PERFORM 4000-MOVE-SUM-CTG-CDE-AMT                        05510013
057500                                                                  05520013
057600         INITIALIZE PV-BCN-AMT                                    05530013
057700                    PV-NCN-AMT                                    05540013
057800                    PV-AEN-AMT                                    05550013
057900                    PV-KCN-AMT                                    05560013
058000                    PV-STM-AMT                                    05570013
058100                    PV-TAX-AMT                                    05580013
058200                    PV-GDS-AMT                                    05590013
058300                    PV-GTS-AMT                                    05600013
058400                    PV-KMT-AMT                                    05610013
058500                    PV-POS-AMT                                    05620013
058600                    PV-GTT-AMT                                    05630013
058700                    PV-GDT-AMT                                    05640013
058800                    PV-CRI-AMT                                    05650013
058900                    PV-KMI-AMT                                    05660013
059000                    PV-POR-AMT                                    05670013
059100                    PV-KCP-AMT                                    05680013
059200                    PV-NSF-AMT                                    05690013
059300                    PV-ECR-AMT                                    05700013
059400                    PV-TMR-AMT                                    05701013
059500                    PV-SHS-AMT                                    05701113
059600                    PV-SHR-AMT                                    05701213
059700                    PV-GWS-AMT                                    05701313
059800                    PV-GWR-AMT                                    05701413
PAYVEN                    PV-PPN-AMT                                    05701715
PAYVEN                    PV-VMN-AMT                                    05702015
059900     END-IF.                                                      05702515
060000                                                                  05702615
060100                                                                  05702715
060200******************************************************************05702815
060300*  FETCH THE ESTORE-CURSOR                                        05702915
060400******************************************************************05703015
060500 2100-FETCH-ESTORE-CURSOR.                                        05703115
060600                                                                  05704013
060700     EXEC SQL                                                     05705013
060800          FETCH ESTORE-CURSOR                                     05706013
060900           INTO :XST00001-LOC-NBR                                 05707013
061000     END-EXEC.                                                    05708013
061100                                                                  05709013
061200     EVALUATE TRUE                                                05710013
061300         WHEN SQLCODE = ZERO                                      05720013
061400             ADD 1 TO PA-ESTORE-CURSOR-CNT                        05730013
061500                                                                  05740013
061600         WHEN SQLCODE = PC-ROW-NOT-FOUND                          05750013
061700             SET PS-END-OF-ESTORE-CURSOR TO TRUE                  05760013
061800                                                                  05770013
061900         WHEN SQLWARN0 NOT EQUAL SPACE                            05780013
062000         WHEN SQLCODE NOT EQUAL ZERO                              05790013
062100             MOVE SQLCODE TO PV-SQL                               05800013
062200                                                                  05810013
062300             MOVE PV-DB2-PARTN-NBR       TO PV-ABEND-PARTN-NBR    05820013
062400             MOVE XST00001-LOC-NBR       TO PV-ABEND-STR-NBR      05830013
062500                                                                  05840013
062600             MOVE '2100-FETCH-ESTORE-CURSOR'                      05850013
062700                                         TO PV-PARAGRAPH-NAME     05860013
062800             MOVE 'XST_LOC'              TO PV-DB2-TABLE-NAME     05870013
062900                                                                  05880013
063000             STRING 'ERROR ON FETCH OF ESTORE-CURSOR - SQLCODE = '05890013
063100                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG05900013
063200             END-STRING                                           05910013
063300                                                                  05920013
063400             SET ABEND-4002-READ-ERROR TO TRUE                    05930013
063500             PERFORM 9100-SQL-ABEND                               05940013
063600     END-EVALUATE.                                                05950013
063700                                                                  05960013
063800                                                                  05970013
063900******************************************************************05980013
064000*  OPEN THE SUM-CURSOR                                            05990013
064100******************************************************************06000013
064200 3000-OPEN-SUM-CURSOR.                                            06010013
064300                                                                  06020013
064400     EXEC SQL                                                     06030013
064500          OPEN SUM-CURSOR                                         06040013
064600     END-EXEC.                                                    06050013
064700                                                                  06060013
064800     EVALUATE TRUE                                                06070013
064900         WHEN SQLCODE = ZERO                                      06080013
065000             CONTINUE                                             06090013
065100                                                                  06100013
065200         WHEN SQLWARN0 NOT EQUAL SPACE                            06110013
065300         WHEN SQLCODE NOT EQUAL ZERO                              06120013
065400             MOVE SQLCODE TO PV-SQL                               06130013
065500                                                                  06140013
065600             MOVE '3000-OPEN-SUM-CURSOR' TO PV-PARAGRAPH-NAME     06150013
065700             MOVE 'TSASUM'               TO PV-DB2-TABLE-NAME     06160013
065800                                                                  06170013
065900             STRING 'ERROR ON OPEN OF SUM-CURSOR - SQLCODE = '    06180013
066000                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG06190013
066100             END-STRING                                           06200013
066200                                                                  06210013
066300             SET ABEND-4005-OPEN-ERROR TO TRUE                    06220013
066400             PERFORM 9100-SQL-ABEND                               06230013
066500     END-EVALUATE.                                                06240013
066600                                                                  06250013
066700                                                                  06260013
066800******************************************************************06270013
066900*  FETCH THE SUM CURSOR.                                          06280013
067000******************************************************************06290013
067100 3100-FETCH-SUM-CURSOR.                                           06300013
067200                                                                  06310013
067300     EXEC SQL                                                     06320013
067400          FETCH SUM-CURSOR                                        06330013
067500           INTO :PV-DB2-SUM                                       06340013
067600               ,:SASUM-SUM-CTG-CDE                                06350013
067700     END-EXEC.                                                    06360013
067800                                                                  06370013
067900     EVALUATE TRUE                                                06380013
068000         WHEN SQLCODE = ZERO                                      06390013
068100             ADD 1 TO PA-SUM-CURSOR-CNT                           06400013
068200                                                                  06410013
068300         WHEN SQLCODE = PC-ROW-NOT-FOUND                          06420013
068400             SET PS-END-OF-SUM-CURSOR  TO TRUE                    06430013
068500                                                                  06440013
068600         WHEN SQLWARN0 NOT EQUAL SPACE                            06450013
068700         WHEN SQLCODE NOT EQUAL ZERO                              06460013
068800             MOVE SQLCODE TO PV-SQL                               06470013
068900                                                                  06480013
069000             MOVE PV-DB2-PARTN-NBR  TO PV-ABEND-PARTN-NBR         06490013
069100             MOVE PV-HOLD-ESTORE    TO PV-ABEND-STR-NBR           06500013
069200             MOVE SASUM-SUM-CTG-CDE TO PV-ABEND-SUM-CTG-CDE       06510013
069300                                                                  06520013
069400             MOVE '3100-FETCH-SUM-CURSOR' TO PV-PARAGRAPH-NAME    06530013
069500             MOVE 'TSASUM'                TO PV-DB2-TABLE-NAME    06540013
069600                                                                  06550013
069700             STRING 'ERROR ON FETCH OF SUM-CURSOR - SQLCODE = '   06560013
069800                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG06570013
069900             END-STRING                                           06580013
070000                                                                  06590013
070100             SET ABEND-4002-READ-ERROR TO TRUE                    06600013
070200             PERFORM 9100-SQL-ABEND                               06610013
070300     END-EVALUATE.                                                06620013
070400                                                                  06630013
070500                                                                  06640013
070600     IF SQLCODE = ZERO                                            06650013
070700         MOVE SASUM-SUM-CTG-CDE TO PC-SUM-CTG-CDE                 06660013
070800                                                                  06670013
070900         PERFORM 3150-EVALUATE-SUM-CTG-CDE                        06680013
071000     END-IF.                                                      06690013
071100                                                                  06700013
071200                                                                  06710013
071300******************************************************************06720013
071400* EVALUATE THE DIFFERENT SUM-CTG-CDE AND PROCESS ACCORDINGLY      06730013
071500******************************************************************06740013
071600 3150-EVALUATE-SUM-CTG-CDE.                                       06750013
071700                                                                  06760013
071800     EVALUATE TRUE                                                06770013
071900         WHEN PC-SUM-CTG-CDE-BCS                                  06780013
072000         WHEN PC-SUM-CTG-CDE-BCR                                  06790013
072100             ADD PV-DB2-SUM            TO PV-BCN-AMT              06800013
072200                                                                  06810013
072300         WHEN PC-SUM-CTG-CDE-NCS                                  06820013
072400         WHEN PC-SUM-CTG-CDE-NCR                                  06830013
072500             ADD PV-DB2-SUM            TO PV-NCN-AMT              06840013
072600                                                                  06850013
072700         WHEN PC-SUM-CTG-CDE-AXS                                  06860013
072800         WHEN PC-SUM-CTG-CDE-AXR                                  06870013
072900             ADD PV-DB2-SUM            TO PV-AEN-AMT              06880013
073000                                                                  06890013
073100         WHEN PC-SUM-CTG-CDE-KCS                                  06900013
073200         WHEN PC-SUM-CTG-CDE-KCR                                  06910013
073300             ADD PV-DB2-SUM            TO PV-KCN-AMT              06920013
073400                                                                  06930013
073500         WHEN PC-SUM-CTG-CDE-SAL                                  06940013
073600             ADD PV-DB2-SUM            TO PV-STM-AMT              06950013
073700                                                                  06960013
073800         WHEN PC-SUM-CTG-CDE-TAX                                  06970013
073900             SUBTRACT PV-DB2-SUM     FROM PV-STM-AMT              06980013
074000             MOVE PV-DB2-SUM           TO PV-TAX-AMT              06990013
074100                                                                  07000013
074200         WHEN PC-SUM-CTG-CDE-GDS                                  07010013
074300             SUBTRACT PV-DB2-SUM     FROM PV-STM-AMT              07020013
074400             MOVE PV-DB2-SUM           TO PV-GDS-AMT              07030013
074500                                                                  07040013
074600         WHEN PC-SUM-CTG-CDE-GTS                                  07050013
074700             SUBTRACT PV-DB2-SUM     FROM PV-STM-AMT              07060013
074800             MOVE PV-DB2-SUM           TO PV-GTS-AMT              07070013
074900                                                                  07080013
075000         WHEN PC-SUM-CTG-CDE-KMT                                  07090013
075100             MOVE PV-DB2-SUM           TO PV-KMT-AMT              07100013
075200                                                                  07110013
075300         WHEN PC-SUM-CTG-CDE-POS                                  07120013
075400             MOVE PV-DB2-SUM           TO PV-POS-AMT              07130013
075500                                                                  07140013
075600         WHEN PC-SUM-CTG-CDE-GTT                                  07150013
075700             MOVE PV-DB2-SUM           TO PV-GTT-AMT              07160013
075800                                                                  07170013
075900         WHEN PC-SUM-CTG-CDE-GDT                                  07180013
076000             MOVE PV-DB2-SUM           TO PV-GDT-AMT              07190013
076100                                                                  07200013
076200         WHEN PC-SUM-CTG-CDE-CRI                                  07210013
076300             MOVE PV-DB2-SUM           TO PV-CRI-AMT              07220013
076400                                                                  07230013
076500         WHEN PC-SUM-CTG-CDE-KMI                                  07240013
076600             MOVE PV-DB2-SUM           TO PV-KMI-AMT              07250013
076700                                                                  07260013
076800         WHEN PC-SUM-CTG-CDE-POR                                  07270013
076900             MOVE PV-DB2-SUM           TO PV-POR-AMT              07280013
077000                                                                  07290013
077100         WHEN PC-SUM-CTG-CDE-KCP                                  07300013
077200             MOVE PV-DB2-SUM           TO PV-KCP-AMT              07310013
077300                                                                  07320013
077400         WHEN PC-SUM-CTG-CDE-NSF                                  07330013
077500             MOVE PV-DB2-SUM           TO PV-NSF-AMT              07340013
077600                                                                  07350013
077700         WHEN PC-SUM-CTG-CDE-ECR                                  07360013
077800             MOVE PV-DB2-SUM           TO PV-ECR-AMT              07370013
077900                                                                  07380013
078000         WHEN PC-SUM-CTG-CDE-RET                                  07390013
078100             MOVE PV-DB2-SUM           TO PV-TMR-AMT              07400013
078200                                                                  07410013
078300         WHEN PC-SUM-CTG-CDE-SHS                                  07420013
078400             MOVE PV-DB2-SUM           TO PV-SHS-AMT              07430013
078500                                                                  07440013
078600         WHEN PC-SUM-CTG-CDE-SHR                                  07450013
078700             MOVE PV-DB2-SUM           TO PV-SHR-AMT              07460013
078800                                                                  07470013
078900         WHEN PC-SUM-CTG-CDE-GWS                                  07480013
079000             MOVE PV-DB2-SUM           TO PV-GWS-AMT              07490013
079100                                                                  07500013
079200         WHEN PC-SUM-CTG-CDE-GWR                                  07510013
079300             MOVE PV-DB2-SUM           TO PV-GWR-AMT              07520013
079100                                                                  07530013
PAYVEN         WHEN PC-SUM-CTG-CDE-PPS                                  07532015
PAYVEN         WHEN PC-SUM-CTG-CDE-PPR                                  07533015
PAYVEN             ADD PV-DB2-SUM            TO PV-PPN-AMT              07534015
PAYVEN                                                                  07535015
PAYVEN         WHEN PC-SUM-CTG-CDE-VMS                                  07537015
PAYVEN         WHEN PC-SUM-CTG-CDE-VMR                                  07538015
PAYVEN             ADD PV-DB2-SUM            TO PV-VMN-AMT              07539015
PAYVEN                                                                  07539115
079400     END-EVALUATE.                                                07840013
079500                                                                  07850013
079600                                                                  07860013
079700******************************************************************07870013
079800*  CLOSE THE SUM CURSOR.                                          07880013
079900******************************************************************07890013
080000 3200-CLOSE-SUM-CURSOR.                                           07900013
080100                                                                  07910013
080200     EXEC SQL                                                     07920013
080300          CLOSE SUM-CURSOR                                        07930013
080400     END-EXEC.                                                    07940013
080500                                                                  07950013
080600     EVALUATE TRUE                                                07960013
080700         WHEN SQLCODE = ZERO                                      07970013
080800              CONTINUE                                            07980013
080900                                                                  07990013
081000         WHEN SQLWARN0 NOT EQUAL SPACE                            08000013
081100         WHEN SQLCODE NOT EQUAL ZERO                              08010013
081200             MOVE SQLCODE TO PV-SQL                               08020013
081300                                                                  08030013
081400             MOVE '3200-CLOSE-SUM-CURSOR' TO PV-PARAGRAPH-NAME    08040013
081500             MOVE 'TSASUM'                TO PV-DB2-TABLE-NAME    08050013
081600                                                                  08060013
081700             STRING 'ERROR ON CLOSE OF SUM-CURSOR - SQLCODE = '   08070013
081800                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG08080013
081900             END-STRING                                           08090013
082000                                                                  08100013
082100             SET ABEND-4006-CLOSE-ERROR TO TRUE                   08110013
082200             PERFORM 9100-SQL-ABEND                               08120013
082300     END-EVALUATE.                                                08130013
082400                                                                  08140013
082600******************************************************************08150013
082700*  MOVE AMOUNTS AND CATEGORIES IN PREPARATION FOR INSERTION       08160013
082800*  INTO TSAADSU TABLE.  ALL CATEGORIES WILL BE INSERTED INTO      08170013
082900*  THE TABLE, REGARDLESS IF THE TOTAL AMOUNT = ZERO.              08180013
083000******************************************************************08190013
083100 4000-MOVE-SUM-CTG-CDE-AMT.                                       08200013
083200                                                                  08210013
083300     MOVE PV-POS-CCYY-MM-DD            TO SA007-SLS-DTE.          08220013
083400     MOVE PV-HOLD-ESTORE               TO SA007-STR-NBR.          08230013
083500     MOVE 'N'                          TO SA007-ADJ-IND.          08240013
083600                                                                  08250013
PAYVEN     IF PV-TAX-AMT NOT EQUAL 0                                    08260015
083700         MOVE PV-TAX-AMT               TO SA007-ORIG-AMT          08261015
083800                                          SA007-ADJ-AMT           08270015
083900         MOVE 'TAX'                    TO SA007-SUM-CTG-CDE       08280015
084000     PERFORM 4100-WRITE-TSAADSU.                                  08290013
084100                                                                  08300013
PAYVEN     IF PV-GDS-AMT NOT EQUAL 0                                    08301015
084200         MOVE PV-GDS-AMT               TO SA007-ORIG-AMT          08310015
084300                                          SA007-ADJ-AMT           08320015
084400         MOVE 'GDS'                    TO SA007-SUM-CTG-CDE       08330015
084500     PERFORM 4100-WRITE-TSAADSU.                                  08340013
084600                                                                  08350013
PAYVEN     IF PV-GTS-AMT NOT EQUAL 0                                    08351015
084700         MOVE PV-GTS-AMT               TO SA007-ORIG-AMT          08360015
084800                                          SA007-ADJ-AMT           08370015
084900         MOVE 'GTS'                    TO SA007-SUM-CTG-CDE       08380015
085000     PERFORM 4100-WRITE-TSAADSU.                                  08390013
085100                                                                  08400013
PAYVEN     IF PV-KMT-AMT NOT EQUAL 0                                    08401015
085200         MOVE PV-KMT-AMT               TO SA007-ORIG-AMT          08410015
085300                                          SA007-ADJ-AMT           08420015
085400         MOVE 'KMT'                    TO SA007-SUM-CTG-CDE       08430015
085500     PERFORM 4100-WRITE-TSAADSU.                                  08440013
085600                                                                  08450013
PAYVEN     IF PV-POS-AMT NOT EQUAL 0                                    08451015
085700         MOVE PV-POS-AMT               TO SA007-ORIG-AMT          08460015
085800                                          SA007-ADJ-AMT           08470015
085900         MOVE 'POS'                    TO SA007-SUM-CTG-CDE       08480015
086000     PERFORM 4100-WRITE-TSAADSU.                                  08490013
086100                                                                  08500013
PAYVEN     IF PV-GTT-AMT NOT EQUAL 0                                    08501015
086200         MOVE PV-GTT-AMT               TO SA007-ORIG-AMT          08510015
086300                                          SA007-ADJ-AMT           08520015
086400         MOVE 'GTT'                    TO SA007-SUM-CTG-CDE       08530015
086500     PERFORM 4100-WRITE-TSAADSU.                                  08540013
086600                                                                  08550013
PAYVEN     IF PV-GDT-AMT NOT EQUAL 0                                    08551015
086700         MOVE PV-GDT-AMT               TO SA007-ORIG-AMT          08560015
086800                                          SA007-ADJ-AMT           08570015
086900         MOVE 'GDT'                    TO SA007-SUM-CTG-CDE       08580015
087000     PERFORM 4100-WRITE-TSAADSU.                                  08590013
087100                                                                  08600013
PAYVEN     IF PV-CRI-AMT NOT EQUAL 0                                    08601015
087200         MOVE PV-CRI-AMT               TO SA007-ORIG-AMT          08610015
087300                                          SA007-ADJ-AMT           08620015
087400         MOVE 'CRI'                    TO SA007-SUM-CTG-CDE       08630015
087500     PERFORM 4100-WRITE-TSAADSU.                                  08640013
087600                                                                  08650013
PAYVEN     IF PV-KMI-AMT NOT EQUAL 0                                    08651015
087700         MOVE PV-KMI-AMT               TO SA007-ORIG-AMT          08660015
087800                                          SA007-ADJ-AMT           08670015
087900         MOVE 'KMI'                    TO SA007-SUM-CTG-CDE       08680015
088000     PERFORM 4100-WRITE-TSAADSU.                                  08690013
088100                                                                  08700013
PAYVEN     IF PV-POR-AMT NOT EQUAL 0                                    08701015
088200         MOVE PV-POR-AMT               TO SA007-ORIG-AMT          08710015
088300                                          SA007-ADJ-AMT           08720015
088400         MOVE 'POR'                    TO SA007-SUM-CTG-CDE       08730015
088500     PERFORM 4100-WRITE-TSAADSU.                                  08740013
088600                                                                  08750013
PAYVEN     IF PV-KCP-AMT NOT EQUAL 0                                    08751015
088700         MOVE PV-KCP-AMT               TO SA007-ORIG-AMT          08760015
088800                                          SA007-ADJ-AMT           08770015
088900         MOVE 'KCP'                    TO SA007-SUM-CTG-CDE       08780015
089000     PERFORM 4100-WRITE-TSAADSU.                                  08790013
089100                                                                  08800013
PAYVEN     IF PV-NSF-AMT NOT EQUAL 0                                    08801015
089200         MOVE PV-NSF-AMT               TO SA007-ORIG-AMT          08810015
089300                                          SA007-ADJ-AMT           08820015
089400         MOVE 'NSF'                    TO SA007-SUM-CTG-CDE       08830015
089500     PERFORM 4100-WRITE-TSAADSU.                                  08840013
089600                                                                  08850013
PAYVEN     IF PV-ECR-AMT NOT EQUAL 0                                    08851015
089700         MOVE PV-ECR-AMT               TO SA007-ORIG-AMT          08860015
089800                                          SA007-ADJ-AMT           08870015
089900         MOVE 'ECR'                    TO SA007-SUM-CTG-CDE       08880015
090000     PERFORM 4100-WRITE-TSAADSU.                                  08890013
090100                                                                  08900013
PAYVEN     IF PV-SHS-AMT NOT EQUAL 0                                    08901015
090200         MOVE PV-SHS-AMT               TO SA007-ORIG-AMT          08910015
090300                                          SA007-ADJ-AMT           08920015
090400         MOVE 'SHS'                    TO SA007-SUM-CTG-CDE       08930015
090500     PERFORM 4100-WRITE-TSAADSU.                                  08940013
090600                                                                  08950013
PAYVEN     IF PV-SHR-AMT NOT EQUAL 0                                    08951015
090700         MOVE PV-SHR-AMT               TO SA007-ORIG-AMT          08960015
090800                                          SA007-ADJ-AMT           08970015
090900         MOVE 'SHR'                    TO SA007-SUM-CTG-CDE       08980015
091000     PERFORM 4100-WRITE-TSAADSU.                                  08990013
091100                                                                  09000013
PAYVEN     IF PV-GWS-AMT NOT EQUAL 0                                    09001015
091200         MOVE PV-GWS-AMT               TO SA007-ORIG-AMT          09010015
091300                                          SA007-ADJ-AMT           09020015
091400         MOVE 'GWS'                    TO SA007-SUM-CTG-CDE       09030015
091500     PERFORM 4100-WRITE-TSAADSU.                                  09040013
091600                                                                  09050013
PAYVEN     IF PV-GWR-AMT NOT EQUAL 0                                    09051015
091700         MOVE PV-GWR-AMT               TO SA007-ORIG-AMT          09060015
091800                                          SA007-ADJ-AMT           09070015
091900         MOVE 'GWR'                    TO SA007-SUM-CTG-CDE       09080015
092000     PERFORM 4100-WRITE-TSAADSU.                                  09090013
092100                                                                  09100013
PAYVEN     IF PV-TMR-AMT NOT EQUAL 0                                    09101015
092200         MOVE PV-TMR-AMT               TO SA007-ORIG-AMT          09110015
092300                                          SA007-ADJ-AMT           09120015
092400         MOVE 'TMR'                    TO SA007-SUM-CTG-CDE       09130015
092500     PERFORM 4100-WRITE-TSAADSU.                                  09140013
092600                                                                  09150013
PAYVEN     IF PV-BCN-AMT NOT EQUAL 0                                    09151015
092700         MOVE PV-BCN-AMT               TO SA007-ORIG-AMT          09160015
092800                                          SA007-ADJ-AMT           09170015
092900         MOVE 'BCN'                    TO SA007-SUM-CTG-CDE       09180015
093000     PERFORM 4100-WRITE-TSAADSU.                                  09190013
093100                                                                  09200013
PAYVEN     IF PV-NCN-AMT NOT EQUAL 0                                    09201015
093200         MOVE PV-NCN-AMT               TO SA007-ORIG-AMT          09210015
093300                                          SA007-ADJ-AMT           09220015
093400         MOVE 'NCN'                    TO SA007-SUM-CTG-CDE       09221015
093500     PERFORM 4100-WRITE-TSAADSU.                                  09222013
093600                                                                  09223013
PAYVEN     IF PV-AEN-AMT NOT EQUAL 0                                    09223115
093700         MOVE PV-AEN-AMT               TO SA007-ORIG-AMT          09224015
093800                                          SA007-ADJ-AMT           09225015
093900         MOVE 'AEN'                    TO SA007-SUM-CTG-CDE       09226015
094000     PERFORM 4100-WRITE-TSAADSU.                                  09227013
094100                                                                  09228013
PAYVEN     IF PV-KCN-AMT NOT EQUAL 0                                    09228115
094200         MOVE PV-KCN-AMT               TO SA007-ORIG-AMT          09229015
094300                                          SA007-ADJ-AMT           09230015
094400         MOVE 'KCN'                    TO SA007-SUM-CTG-CDE       09240015
094500     PERFORM 4100-WRITE-TSAADSU.                                  09250013
094600                                                                  09260013
PAYVEN     IF PV-STM-AMT NOT EQUAL 0                                    09261015
094700         MOVE PV-STM-AMT               TO SA007-ORIG-AMT          09270015
094800                                          SA007-ADJ-AMT           09280015
094900         MOVE 'STM'                    TO SA007-SUM-CTG-CDE       09290015
095000     PERFORM 4100-WRITE-TSAADSU.                                  09300013
095100                                                                  09310013
PAYVEN     IF PV-PPN-AMT NOT EQUAL 0                                    09311015
PAYVEN         MOVE PV-PPN-AMT               TO SA007-ORIG-AMT          09312016
PAYVEN                                          SA007-ADJ-AMT           09313016
PAYVEN         MOVE 'PPN'                    TO SA007-SUM-CTG-CDE       09314015
PAYVEN     PERFORM 4100-WRITE-TSAADSU.                                  09315015
PAYVEN                                                                  09316015
PAYVEN     IF PV-VMN-AMT NOT EQUAL 0                                    09316115
PAYVEN         MOVE PV-VMN-AMT               TO SA007-ORIG-AMT          09317015
PAYVEN                                          SA007-ADJ-AMT           09318015
PAYVEN         MOVE 'VMN'                    TO SA007-SUM-CTG-CDE       09319015
PAYVEN     PERFORM 4100-WRITE-TSAADSU.                                  09319115
PAYVEN                                                                  09319215
097400                                                                  09600013
097500******************************************************************09610013
097600* WRITE THE TSAADSU RECORDS                                       09620013
097700******************************************************************09630013
097800 4100-WRITE-TSAADSU.                                              09640013
097900                                                                  09650013
098000     WRITE TSAADSU-REC FROM SA007-TSAADSU-REC.                    09660013
098100                                                                  09670013
098200     ADD 1 TO PA-TSAADSU-WRITTEN.                                 09680013
098300                                                                  09690013
098400                                                                  09700013
098500******************************************************************09710013
098600* ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.    09720013
098700******************************************************************09730013
098800 9100-SQL-ABEND.                                                  09740013
098900                                                                  09750013
099000     MOVE SQLCODE    TO SQLCODE2.                                 09760013
099100     MOVE SQLERRD(3) TO SQLERRD3.                                 09770013
099200                                                                  09780013
099300     DISPLAY '** ABEND           ** = SQLABEND'.                  09790013
099400     DISPLAY '** PROGRAM         ** = ' PC-PGM-NAME.              09800013
099500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        09810013
099600     DISPLAY '** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.        09820013
099700     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG.     09830013
099800     DISPLAY '** PARTN NBR       ** = ' PV-ABEND-PARTN-NBR.       09840013
099900     DISPLAY '** STORE NBR       ** = ' PV-ABEND-STR-NBR.         09850013
100000     DISPLAY '** CTG CODE        ** = ' PV-ABEND-SUM-CTG-CDE.     09860013
100100     DISPLAY '** SQLCODE         ** = ' SQLCODE2.                 09870013
100200     DISPLAY '** ROWS PROCESSED  ** = ' SQLERRD3.                 09880013
100300     DISPLAY '** SQLERRM         ** = ' SQLERRM.                  09890013
100400     DISPLAY '** SQLERRMC        ** = ' SQLERRMC.                 09900013
100500                                                                  09910013
100600******************************************************************09920013
100700*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   09930013
100800*  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        09940013
100900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09950013
101000*  FORMAT.                                                        09960013
101100******************************************************************09970013
101200                                                                  09980013
101300     COPY DPPD004.                                                09990013
101400                                                                  10000013
101500     CALL 'ILBOABN0' USING ABEND-CODE.                            10010013
101600                                                                  10020013
101700                                                                  10030013
101800******************************************************************10040013
101900*  ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                     10050013
102000******************************************************************10060013
102100 9200-ABEND.                                                      10070013
102200                                                                  10080013
102300     PERFORM 9900-END-PROC.                                       10090013
102400                                                                  10100013
102500     DISPLAY '** ABEND           **'.                             10110013
102600     DISPLAY '** PROGRAM         ** = ' PC-PGM-NAME.              10120013
102700     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        10130013
102800     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       10140013
102900     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       10150013
103000                                                                  10160013
103100     CALL 'ILBOABN0' USING ABEND-CODE.                            10170013
103200                                                                  10180013
103300                                                                  10190013
103400******************************************************************10200013
103500* PREFORMS TASK TERMINATION PROCESSING                            10210013
103600******************************************************************10220013
103700 9900-END-PROC.                                                   10230013
103800                                                                  10240013
103900     CLOSE TSAADSU-FILE.                                          10250013
104000                                                                  10260013
104100     PERFORM 9950-CLOSE-ESTORE-CURSOR.                            10270013
104200                                                                  10280013
104300     PERFORM 9999-CONTROLS.                                       10290013
104400                                                                  10300013
104500                                                                  10310013
104600******************************************************************10320013
104700* CLOSE THE ESTORE-CURSOR                                         10330013
104800******************************************************************10340013
104900 9950-CLOSE-ESTORE-CURSOR.                                        10350013
105000                                                                  10360013
105100     EXEC SQL                                                     10370013
105200          CLOSE ESTORE-CURSOR                                     10380013
105300     END-EXEC.                                                    10390013
105400                                                                  10400013
105500     EVALUATE TRUE                                                10410013
105600         WHEN SQLCODE = ZERO                                      10420013
105700              CONTINUE                                            10430013
105800                                                                  10440013
105900         WHEN SQLWARN0 NOT EQUAL SPACE                            10450013
106000         WHEN SQLCODE NOT EQUAL ZERO                              10460013
106100             MOVE SQLCODE TO PV-SQL                               10470013
106200                                                                  10480013
106300             MOVE '9950-CLOSE-ESTORE-CURSOR' TO PV-PARAGRAPH-NAME 10490013
106400             MOVE 'XST_LOC'                  TO PV-DB2-TABLE-NAME 10500013
106500                                                                  10510013
106600             STRING 'ERROR ON CLOSE OF ESTORE-CURSOR - SQLCODE = '10520013
106700                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG10530013
106800             END-STRING                                           10540013
106900                                                                  10550013
107000             SET ABEND-4006-CLOSE-ERROR TO TRUE                   10560013
107100             PERFORM 9100-SQL-ABEND                               10570013
107200     END-EVALUATE.                                                10580013
107300                                                                  10590013
107400                                                                  10600013
107500******************************************************************10610013
107600* DISPLAY CONTROLS FROM THE PROGRAM                               10620013
107700******************************************************************10630013
107800 9999-CONTROLS.                                                   10640013
107900                                                                  10650013
108000     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 10660013
108100                                                                  10670013
108200     MOVE SYS-TIME (1:2) TO ST-END-HR.                            10680013
108300     MOVE SYS-TIME (3:2) TO ST-END-MN.                            10690013
108400                                                                  10700013
108500     DISPLAY '                    '.                              10710013
108600     DISPLAY '**********************'.                            10720013
108700     DISPLAY '   SAKUT047 CONTROLS  '.                            10730013
108800     DISPLAY '**********************'.                            10740013
108900     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         10750013
109000     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          10760013
109100     DISPLAY 'END TIME  = ' ST-END-TIME.                          10770013
109200     DISPLAY '======================'.                            10780013
109300     DISPLAY 'ESTORE CURSOR ROWS FETCHED = '                      10790013
109400                                PA-ESTORE-CURSOR-CNT.             10800013
109500     DISPLAY 'SUM CURSOR ROWS FETCHED    = '                      10810013
109600                                PA-SUM-CURSOR-CNT.                10820013
109700     DISPLAY '                    '.                              10830013
109800     DISPLAY 'TSAADSU WRITTEN = ' PA-TSAADSU-WRITTEN.             10840013
109900     DISPLAY '                    '.                              10850013
110000                                                                  10860013
110100                                                                  10870013
