000100*----------------------------------------------------------       00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300*----------------------------------------------------------       00030002
000400 PROGRAM-ID.    EPKUT115.                                         00040002
000500 AUTHOR.        ALEXIS KEIKER.                                    00050002
000600 DATE-WRITTEN.  DECEMBER 10, 2002.                                00060002
000700                                                                  00070002
000800*----------------------------------------------------------       00080002
000900*          PLU AND XREF CONTROL CARD POPULATOR                    00090002
001000*----------------------------------------------------------       00100002
001100* THIS PROGRAM UPDATES CONTROL CARD EPCC105.  IT GETS A           00110005
001101* A CURRENT TIMESTAMP AND UPDATES THE CONTROL CARD WITH THIS      00110105
001102* TIMESTAMP.  IT ALSO MOVES THE OLD CURRENT TIMESTAMP TO THE      00110205
001103* FIELD MARKED PREVIOUS IN THE CONTROL CARD.                      00110305
001110*----------------------------------------------------------       00111002
001120* HISTORY LOG:                                                    00112002
001130*                                                                 00113002
001131*----------------------------------------------------------       00113102
001132* DATE:                                                           00113202
001133* WR/IR#:                                                         00113302
001134* PROGRAMMER:                                                     00113402
001135* DESCRIPTION:                                                    00113502
001136*                                                                 00113602
001137*----------------------------------------------------------       00113702
001138 ENVIRONMENT DIVISION.                                            00113802
001139*----------------------------------------------------------       00113902
001140 CONFIGURATION SECTION.                                           00114002
001150 SOURCE-COMPUTER. IBM-3090.                                       00115002
001160 OBJECT-COMPUTER. IBM-3090.                                       00116002
001170                                                                  00117002
001180 INPUT-OUTPUT SECTION.                                            00118002
001190                                                                  00119002
001200 FILE-CONTROL.                                                    00120002
001300                                                                  00130002
001340     SELECT CC-TIMESTAMP-FILE                                     00134002
001350       ASSIGN TO UPD01.                                           00135002
001360                                                                  00136002
001370*----------------------------------------------------------       00137005
001380 DATA DIVISION.                                                   00138005
001390*----------------------------------------------------------       00139005
001400 FILE SECTION.                                                    00140005
001500                                                                  00150005
001510 FD  CC-TIMESTAMP-FILE                                            00151005
001520     RECORDING MODE IS F                                          00152005
001530     LABEL RECORDS ARE STANDARD                                   00153005
001540     RECORD CONTAINS 80 CHARACTERS                                00154005
001550     DATA RECORD IS CC-TIMESTAMP-RECORD.                          00155005
001560                                                                  00156005
001570 01  CC-TIMESTAMP-RECORD          PIC X(80).                      00157005
001580                                                                  00158005
001590*---------------------------------------------------------        00159005
001600                                                                  00160005
001700 WORKING-STORAGE SECTION.                                         00170005
001800                                                                  00180005
001900 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      00190005
001910                                                  COMP SYNC.      00191005
001920     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    00192005
001930     88  AC-DB2-ERROR                             VALUE +4013.    00193005
001940     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    00194005
001950                                                                  00195005
001960*---------------------------------------------------------        00196005
001970* PC- PROGRAM CONSTANTS                                           00197005
001980*----------------------------------------------------------       00198005
001990 01  PC-PROGRAM-CONSTANTS.                                        00199005
002000     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'EPKUT115'. 00200005
002100     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00210005
002400                                                                  00240002
002500*----------------------------------------------------------       00250002
002600* PS- PROGRAM SWITCHES                                            00260002
002700*----------------------------------------------------------       00270002
002800 01  PS-PROGRAM-SWITCHES.                                         00280002
002900     05  PS-END-OF-FILE-SW            PIC X(01)  VALUE 'N'.       00290002
003000         88  PS-END-OF-FILE                      VALUE 'Y'.       00300002
003100         88  PS-NOT-END-OF-FILE                  VALUE 'N'.       00310002
003200                                                                  00320002
003300*----------------------------------------------------------       00330002
003400* PV- PROGRAM VARIABLES                                           00340002
003500*----------------------------------------------------------       00350002
003600 01 PV-PROGRAM-VARIABLES.                                         00360002
003700    05  PV-PARAGRAPH-NAME             PIC X(30) VALUE SPACES.     00370002
003800    05  PV-OPERATION-MSG-1            PIC X(40) VALUE SPACES.     00380002
003900    05  PV-OPERATION-MSG-2            PIC X(40) VALUE SPACES.     00390002
003901    05  PV-DB2-OPERATION              PIC X(30) VALUE SPACE.      00390102
003902    05  PV-SQL-SUB                    PIC S9(4) VALUE +0 COMP.    00390202
003903    05  PV-SAVE-PREV-TIMESTAMP        PIC X(26) VALUE SPACES.     00390305
003904    05  PV-TIMESTAMP                  PIC X(26) VALUE SPACES.     00390405
003905                                                                  00390505
003906*----------------------------------------------------------       00390605
003907* CONTROL CARD EPCC105 LAYOUT                                     00390705
003908*----------------------------------------------------------       00390805
003909     COPY EPWS105.                                                00390905
003910                                                                  00391005
003920*-----------------------------------------------------------      00392005
003930* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         00393005
003940*-----------------------------------------------------------      00394005
003950     COPY DPWS004.                                                00395005
003960                                                                  00396005
003970*-----------------------------------------------------------      00397005
003980* DB2 ABEND COPYBOOK                                              00398005
003990*-----------------------------------------------------------      00399005
004000     COPY DPWS900.                                                00400005
004100                                                                  00410005
004200*-----------------------------------------------------------      00420005
004300* DB2 MESSAGE AREA                                                00430005
004400*-----------------------------------------------------------      00440005
004500     COPY SQLCA2.                                                 00450005
004600                                                                  00460005
004700*-----------------------------------------------------------      00470005
004800* DB2 COMMUNICATIONS AREA                                         00480005
004900*-----------------------------------------------------------      00490005
005000     EXEC SQL                                                     00500005
005100          INCLUDE SQLCA                                           00510005
005200     END-EXEC.                                                    00520005
005300                                                                  00530005
005400*----------------------------------------------------------       00540005
005500 PROCEDURE DIVISION.                                              00550005
005600*----------------------------------------------------------       00560005
005700 0000-MAINLINE.                                                   00570005
005800                                                                  00580005
005900     PERFORM 1000-INITIALIZATION.                                 00590005
006000                                                                  00600005
006100     PERFORM 2000-PROCESS-CNTL-CARDS.                             00610005
006200                                                                  00620005
006300     PERFORM 9999-WRAPUP.                                         00630005
006400                                                                  00640005
006500     GOBACK.                                                      00650005
006600                                                                  00660005
006700*0000-EXIT.                                                       00670005
006800 EJECT.                                                           00680005
006900                                                                  00690005
007000*----------------------------------------------------------       00700005
007100* 1000-INITIALIZATION.                                            00710005
007200*     INTIALIZES VARIABLES, OPENS ANY FILES, AND READS            00720005
007300*     THE INPUT FILES, SAVES VARIABLES, AND CLOSES THE INPUT      00730005
007400*     FILES.                                                      00740005
007500*----------------------------------------------------------       00750005
007600 1000-INITIALIZATION.                                             00760005
007700                                                                  00770005
007800     INITIALIZE CC-EPCC105-CONTROL-CARD.                          00780005
007900                                                                  00790005
008000     OPEN INPUT CC-TIMESTAMP-FILE.                                00800005
008100                                                                  00810005
008200     PERFORM 1100-READ-TIMESTAMP-CARD.                            00820005
008300                                                                  00830005
008400     MOVE CC-EPCC105-CRNT-TIMESTAMP TO PV-SAVE-PREV-TIMESTAMP.    00840005
008500                                                                  00850005
008600     CLOSE CC-TIMESTAMP-FILE.                                     00860005
008700                                                                  00870005
008800*1000-EXIT.                                                       00880005
008900 EJECT.                                                           00890005
009000                                                                  00900005
009100*----------------------------------------------------------       00910005
009200* 1100-READ-TIMESTAMP-CARD.                                       00920005
009300*     READS IN THE TIMESTAMP(EPCC105) CONTROL CARD.               00930005
009400*----------------------------------------------------------       00940005
009500 1100-READ-TIMESTAMP-CARD.                                        00950005
009600                                                                  00960005
009700     READ CC-TIMESTAMP-FILE                                       00970005
009800         INTO CC-EPCC105-CONTROL-CARD                             00980005
009900     END-READ.                                                    00990005
010000                                                                  01000005
010100*1100-EXIT.                                                       01010005
010200 EJECT.                                                           01020005
010300                                                                  01030005
010301*----------------------------------------------------------       01030105
010302* 2000-PROCESS-CNTL-CARDS.                                        01030205
010303*     UPDATES EPCC105 CONTROL CARDS FOR PROCESSING.               01030305
010304*----------------------------------------------------------       01030405
010305 2000-PROCESS-CNTL-CARDS.                                         01030505
010306                                                                  01030605
010307     INITIALIZE CC-EPCC105-CONTROL-CARD.                          01030705
010308                                                                  01030805
010309     SET CC-EPCC105-VALID-PREV-NM      TO TRUE.                   01030905
010310     SET CC-EPCC105-VALID-CRNT-NM      TO TRUE.                   01031005
010320                                                                  01032005
010330     PERFORM 2100-SELECT-DB2-TIMESTAMP.                           01033005
010340                                                                  01034005
010350     PERFORM 2200-UPDATE-CNTL-CARDS.                              01035005
010360                                                                  01036005
010370*2000-EXIT.                                                       01037005
010380 EJECT.                                                           01038005
010390                                                                  01039005
010400*----------------------------------------------------------       01040005
010500* 2100-SELECT-DB2-TIMESTAMP.                                      01050005
010600*     RETRIEVE TIMESTAMP FROM DB2.                                01060005
010700*----------------------------------------------------------       01070005
010800 2100-SELECT-DB2-TIMESTAMP.                                       01080005
010900                                                                  01090005
011000     EXEC SQL                                                     01100005
011100          SELECT CURRENT TIMESTAMP                                01110005
011200          INTO  :PV-TIMESTAMP                                     01120005
011300          FROM   SYSIBM.SYSDUMMY1                                 01130005
011400     END-EXEC.                                                    01140005
011500                                                                  01150005
011600     IF SQLCODE NOT EQUAL ZERO                                    01160005
011700        MOVE '2100-SELECT-DB2-TIME' TO PV-PARAGRAPH-NAME          01170005
011800        MOVE 'CANNOT GET CURRENT TIMESTAMP'                       01180005
011900                                      TO PV-DB2-OPERATION         01190005
012000        PERFORM 9100-SQL-ABEND                                    01200005
012100     END-IF.                                                      01210005
012200                                                                  01220005
012300*2100-EXIT.                                                       01230005
012400 EJECT.                                                           01240005
012500                                                                  01250005
012600*----------------------------------------------------------       01260005
012700* 2200-UPDATE-CNTL-CARDS.                                         01270005
012800*     UPDATES CONTROL CARDS EPCC105.                              01280005
012900*----------------------------------------------------------       01290005
013000 2200-UPDATE-CNTL-CARDS.                                          01300005
013100                                                                  01310005
013200     MOVE PV-SAVE-PREV-TIMESTAMP  TO CC-EPCC105-PREV-TIMESTAMP.   01320005
013300     MOVE PV-TIMESTAMP            TO CC-EPCC105-CRNT-TIMESTAMP.   01330005
013400                                                                  01340005
013500     OPEN OUTPUT CC-TIMESTAMP-FILE.                               01350005
013700     PERFORM 8000-WRITE-TIMESTAMP-CARD.                           01370005
013710     CLOSE CC-TIMESTAMP-FILE.                                     01371006
013800                                                                  01380005
013900*2200-EXIT.                                                       01390005
014000 EJECT.                                                           01400005
014100                                                                  01410005
014200*----------------------------------------------------------       01420005
014210* 8000-WRITE-TIMESTAMP-CARD.                                      01421005
014220*     WRITES TIMESTAMP CONTROL CARD RECORD TO EPCC105 CONTROL     01422005
014230*     CARD.                                                       01423005
014240*----------------------------------------------------------       01424005
014250 8000-WRITE-TIMESTAMP-CARD.                                       01425005
014260                                                                  01426005
014270     WRITE CC-TIMESTAMP-RECORD                                    01427005
014280         FROM CC-EPCC105-CONTROL-CARD.                            01428005
014290                                                                  01429005
014300*8000-EXIT.                                                       01430005
014400 EJECT.                                                           01440005
014500                                                                  01450005
016200*---------------------------------------------------------        01620005
016300* 9100-SQL-ABEND.                                                 01630005
016400*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.01640005
016500*---------------------------------------------------------        01650005
016600 9100-SQL-ABEND.                                                  01660005
016700                                                                  01670005
016800     SET AC-DB2-ERROR TO TRUE.                                    01680005
016900                                                                  01690005
017000     DISPLAY '** ABEND     **'.                                   01700005
017100     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                01710005
017200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              01720005
017300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               01730005
017400                                                                  01740005
017500     COPY DPPD004.                                                01750005
017600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         01760005
017700                                                                  01770005
017800*9100-EXIT.                                                       01780005
017900 EJECT.                                                           01790005
018000                                                                  01800005
018100*----------------------------------------------------------       01810005
018200* 9999-WRAPUP.                                                    01820005
018300*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.       01830005
018400*----------------------------------------------------------       01840005
018500 9999-WRAPUP.                                                     01850005
018600                                                                  01860005
018900     DISPLAY 'EPCC105 CONTROL CARD'.                              01890005
019000     DISPLAY CC-EPCC105-CONTROL-CARD-DISPLY.                      01900005
019100                                                                  01910005
019200*9999-EXIT.                                                       01920005
019300 EJECT.                                                           01930005
019400                                                                  01940005
