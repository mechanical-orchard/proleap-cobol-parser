000100 TITLE 'LABOR SYSTEM - GLOBAL ISTOP'.                             00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300                                                                  00030000
000400 PROGRAM-ID.             DLKRF457.                                00040000
000500 AUTHOR.                 AYAN SARKAR.                             00050000
000600 INSTALLATION.           KOHLS.                                   00060000
000700 DATE-WRITTEN.           JULY 2016.                               00070000
000800 DATE-COMPILED.                                                   00080000
000801*                                                                 00080100
000802******************************************************************00080200
000803* THIS PROGRAM DOES GLOBAL I-STOP FOR THE VARIOUS AREAS/FUNCTIONS 00080300
000804* DEFINED IN WST PARM DATABASE.                                   00080400
000805* ALL THE OPEN ASSIGNMENTS THAT ARE PART OF THE AREA/FUNCTION     00080500
000806* PROVIDED AS INPUT, WILL BE CLOSED.                              00080600
000807******************************************************************00080700
000808*                                                                 00080800
000809 ENVIRONMENT DIVISION.                                            00080900
000810 DATA DIVISION.                                                   00081000
000820                                                                  00082000
000830 WORKING-STORAGE SECTION.                                         00083000
000840*                                                                 00084000
000850 01  PC-PROGRAM-CONSTANTS.                                        00085000
000860     05  PC-TRANID                    PIC  X(04) VALUE 'D457'.    00086000
000870     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08) VALUE 'DLKRF457'.00087000
000880     05  PC-MAX-RETRIES               PIC S9(03) VALUE 3          00088000
000890                                                 COMP-3.          00089000
000900                                                                  00090000
001000     05  PC-UNRECOGNIZED-PF-KEY-MSG   PIC  X(19) VALUE            00100000
001100         'UNRECOGNIZED PF KEY'.                                   00110000
001200     05  PC-ENTER-THROUGH-MENU-MSG    PIC  X(19) VALUE            00120000
001300         'ENTER THROUGH MENU '.                                   00130000
001400     05  PC-TRANS-UNAVAILABLE-MSG     PIC  X(19) VALUE            00140000
001500         'TRANS NOT AVAILABLE'.                                   00150000
001600     05  PC-INVALID-FUNCTION-MSG      PIC  X(19) VALUE            00160000
001700         'INVALID FUNCTION   '.                                   00170000
001800     05  PC-INVALID-GROUP-MSG         PIC  X(19) VALUE            00180000
001900         'INVALID GROUP      '.                                   00190000
002000     05  PC-EMPTY-GROUP-MSG           PIC  X(19) VALUE            00200000
002100         'EMPTY GROUP NAME   '.                                   00210000
002200     05  PC-NO-ACTIVE-ASSOCIATE       PIC  X(19) VALUE            00220000
002300         'NO ACTIVE ASSOCIATE'.                                   00230000
002400                                                                  00240000
002500 01  PS-PROGRAM-SWITCHES.                                         00250000
002600     05  PS-ERROR-SW                  PIC  X(01) VALUE 'N'.       00260000
002700         88  PS-ERRORS-YES                       VALUE 'Y'.       00270000
002800         88  PS-ERRORS-NO                        VALUE 'N'.       00280000
002900     05  PS-EOC-ACT-TEM-ASGMT-CSR-SW  PIC  X(01) VALUE 'N'.       00290000
003000         88  PS-EOC-ACT-TEM-ASGMT-CSR            VALUE 'Y'.       00300000
003100         88  PS-NOT-EOC-ACT-TEM-ASGMT-CSR        VALUE 'N'.       00310000
003200     05  PS-EOC-ACT-ASGMT-CSR-SW      PIC  X(01) VALUE 'N'.       00320000
003300         88  PS-EOC-ACT-ASGMT-CSR                VALUE 'Y'.       00330000
003310         88  PS-NOT-EOC-ACT-ASGMT-CSR            VALUE 'N'.       00331000
003320     05  PS-VALID-GROUP-CSR-SW        PIC  X(01) VALUE 'N'.       00332000
003330         88  PS-END-OF-VALID-GROUP-CSR-NO        VALUE 'N'.       00333000
003340         88  PS-END-OF-VALID-GROUP-CSR           VALUE 'Y'.       00334000
003350     05  PS-TYPE-OF-REQ-SW            PIC  X(01) VALUE 'N'.       00335000
003360         88  PS-GET-IMPACTED-REC-CNT             VALUE 'Y'.       00336000
003370         88  PS-GET-IMPACTED-REC-CNT-NO          VALUE 'N'.       00337000
003380     05  PS-VALID-ISTOP-GROUP-SW      PIC  X(01) VALUE 'N'.       00338000
003390         88  PS-VALID-ISTOP-GROUP                VALUE 'Y'.       00339000
003400         88  PS-VALID-ISTOP-GROUP-NO             VALUE 'N'.       00340000
003500     05  PS-PROCESS-ERROR-SW          PIC  X(01) VALUE 'N'.       00350000
003600         88  PS-PROCESS-ERROR-NO                 VALUE 'N'.       00360000
003700         88  PS-PROCESS-ERROR                    VALUE 'Y'.       00370000
003800                                                                  00380000
003900 01  DN-NULL-INDICATORS.                                          00390000
004000     05  DN-KOHLS-USR-NULL-IND        PIC S9(04) VALUE ZERO       00400000
004100                                                 COMP SYNC.       00410000
004200     05  DN-TEMP-USR-NULL-IND         PIC S9(04) VALUE ZERO       00420000
004300                                                 COMP SYNC.       00430000
004400     05  DN-WST-FROM-TMST-NULL-IND    PIC S9(04) VALUE ZERO       00440000
004500                                                 COMP SYNC.       00450000
004600     05  DN-WST-TO-TMST-NULL-IND      PIC S9(04) VALUE ZERO       00460000
004700                                                 COMP SYNC.       00470000
004800                                                                  00480000
004900 01  DK-DB2-KEYS.                                                 00490000
005000     05  DK-DC-NBR                    PIC S9(04) COMP VALUE ZERO. 00500000
005100     05  DK-INPUT-GROUP               PIC  X(06) VALUE SPACES.    00510000
005200                                                                  00520000
005300 01  PV-PROGRAM-VARIABLES.                                        00530000
005400     05  PV-DISP-NBR                  PIC  9(09) VALUE ZEROS.     00540000
005500     05  PV-UNSTRING-COUNT            PIC S9(03) COMP-3.          00550000
005600     05  PV-POINTER                   PIC S9(03) COMP-3.          00560000
005700     05  PV-TALLY                     PIC S9(03) COMP-3.          00570000
005800     05  PV-KEY-NBR-SEQ-NBR           PIC  9(09).                 00580000
005900                                                                  00590000
006000     05  PV-COMMAREA-LENGTH           PIC S9(04) VALUE +0         00600000
006100                                                 COMP SYNC.       00610000
006200     05  PV-MESSAGE-AREA              PIC  X(19) VALUE SPACE.     00620000
006300     05  PV-CICS-RESPONSE             PIC S9(09) VALUE ZEROS      00630000
006400                                                 COMP SYNC.       00640000
006500     05  PV-TRANSFER-PROGRAM          PIC  X(08) VALUE SPACE.     00650000
006600     05  PV-USERID                    PIC  X(08) VALUE SPACES.    00660000
006700     05  PV-TEM-ASGMT-SEQ-NBR         PIC S9(09) COMP VALUE ZERO. 00670000
006800     05  PV-USER-TYPE                 PIC  X(01) VALUE SPACES.    00680000
006900     05  PV-DUMMY-USERID              PIC  X(08) VALUE SPACES.    00690000
007000     05  PV-CURR-TMST                 PIC  X(26) VALUE SPACES.    00700000
007100     05  PV-LABOR-CURRENT-TIMESTAMP   PIC  X(26).                 00710000
007200     05  PV-HOLD-TIMESTAMP            PIC  X(26).                 00720000
007300     05  PV-DISPLAY-SQLCODE           PIC  9(04) VALUE ZERO.      00730000
007400     05  PV-DISPLAY-ASGMT-NBR         PIC  9(09) VALUE ZERO.      00740000
007500     05  PV-DISPLAY-TEM-ASGMT-NBR     PIC  9(09) VALUE ZERO.      00750000
007600     05  PV-ACTV-TEM-ASGMT-COUNT      PIC S9(04) COMP-3           00760000
007700                                                 VALUE ZERO.      00770000
007800     05  PV-ACTV-ASGMT-COUNT          PIC S9(04) COMP-3           00780000
007900                                                 VALUE ZERO.      00790000
008000     05  PV-TOT-ACTV-ASGMT            PIC S9(04) COMP-3           00800000
008100                                                 VALUE ZERO.      00810000
008200     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         00820000
008300                                                 COMP SYNC.       00830000
008400                                                                  00840000
008500     05  PV-USER-ID-KOHL-TEMP-IND     PIC  X(01) VALUE SPACES.    00850000
008600     05  PV-WST-GLBL-ISTOP-GRP        PIC  X(06) VALUE SPACES.    00860000
008700     05  PV-WST-WORK-TYP              PIC  X(07) VALUE SPACES.    00870000
008800     05  PV-WST-DC-NBR                PIC S9(10)V9(5) COMP-3.     00880000
008810     05  PV-WST-ACTV-IND              PIC  X(01) VALUE SPACES.    00881000
008811     05  PV-WST-FROM-TMST             PIC  X(26) VALUE SPACES.    00881100
008812     05  PV-WST-TO-TMST               PIC  X(26) VALUE SPACES.    00881200
008813     05  PV-WST-GROUP-DESC            PIC  X(26) VALUE SPACES.    00881300
008814                                                                  00881400
008815** DISPLAY INSTRUCTIONS FOR ISTOP                                 00881500
008816     05  PV-DISPLAY-MSG-1.                                        00881600
008817         10  FILLER                   PIC  X(19) VALUE            00881700
008818             ' CONFIRM ISTOP FOR '.                               00881800
008819     05  PV-DISPLAY-MSG-2.                                        00881900
008820         10  FILLER                   PIC  X(04) VALUE            00882000
008821             'ALL '.                                              00882100
008822         10  PV-ASSOCIATE-COUNT       PIC  9(03) VALUE ZERO.      00882200
008823         10  FILLER                   PIC  X(12) VALUE            00882300
008824             ' ASSOCIATES '.                                      00882400
008825     05  PV-DISPLAY-MSG-3.                                        00882500
008826         10  FILLER                   PIC  X(04) VALUE            00882600
008827             ' AT '.                                              00882700
008828         10  PV-LOC-NBR               PIC  9(04) VALUE ZERO.      00882800
008829         10  FILLER                   PIC  X(11) VALUE            00882900
008830             ' IN GROUP: '.                                       00883000
008831     05  PV-DISPLAY-MSG-4.                                        00883100
008832         10  PV-ISTOP-AREA            PIC  X(19) VALUE SPACES.    00883200
008833     05  PV-DISPLAY-MSG-5.                                        00883300
008834         10  FILLER                   PIC  X(19) VALUE            00883400
008835             ' F2-CNFRM F9-RESET '.                               00883500
008836                                                                  00883600
008837 01  PV-MSG-LOG.                                                  00883700
008838     05  PV-MSG-PROG-NAME             PIC  X(08) VALUE SPACES.    00883800
008839     05  FILLER                       PIC  X(03) VALUE ' - '.     00883900
008840     05  PV-MSG-USER-ID               PIC  X(08) VALUE SPACES.    00884000
008850     05  FILLER                       PIC  X(01) VALUE SPACES.    00885000
008860     05  FILLER                       PIC  X(16) VALUE            00886000
008870         'GLOBAL ISTOP FOR'.                                      00887000
008880     05  FILLER                       PIC  X(01) VALUE SPACES.    00888000
008890     05  PV-MSG-GROUP-NAME            PIC  X(06) VALUE SPACES.    00889000
008900     05  FILLER                       PIC  X(01) VALUE SPACES.    00890000
009000     05  FILLER                       PIC  X(03) VALUE            00900000
009100         'FOR'.                                                   00910000
009200     05  FILLER                       PIC  X(01) VALUE SPACES.    00920000
009300     05  PV-MSG-ISTOP-CNT             PIC  9(03) VALUE ZEROES.    00930000
009400     05  FILLER                       PIC  X(01) VALUE SPACES.    00940000
009500     05  FILLER                       PIC  X(18) VALUE            00950000
009600         'ASSOCIATES FOR DC '.                                    00960000
009700     05  PV-MSG-DC-NBR                PIC  9(04) VALUE ZEROES.    00970000
009800     05  FILLER                       PIC  X(01) VALUE SPACES.    00980000
009900     05  PV-MSG-DATE.                                             00990000
010000         10 PV-MSG-DTE-MM             PIC  X(02) VALUE SPACES.    01000000
010100         10 FILLER                    PIC  X(01) VALUE '/'.       01010000
010101         10 PV-MSG-DTE-DD             PIC  X(02) VALUE SPACES.    01010100
010102     05  FILLER                       PIC  X(01) VALUE SPACES.    01010200
010103     05  FILLER                       PIC  X(01) VALUE '@'.       01010300
010104     05  FILLER                       PIC  X(01) VALUE SPACES.    01010400
010105     05  PV-MSG-TIME.                                             01010500
010106         10 PV-MSG-TME-HR             PIC  X(02) VALUE SPACES.    01010600
010107         10 FILLER                    PIC  X(01) VALUE ':'.       01010700
010108         10 PV-MSG-TME-MN             PIC  X(02) VALUE SPACES.    01010800
010109         10 FILLER                    PIC  X(01) VALUE ':'.       01010900
010110         10 PV-MSG-TME-SC             PIC  X(02) VALUE SPACES.    01011000
010120                                                                  01012000
010130 01  PV-ERR-MSG-LOG.                                              01013000
010140     05  FILLER                       PIC  X(12) VALUE            01014000
010150         ' D457 ERROR '.                                          01015000
010160     05  FILLER                       PIC  X(06) VALUE            01016000
010170         'USER= '.                                                01017000
010180     05  PV-LOG-USER-ID               PIC  X(08) VALUE SPACES.    01018000
010190     05  FILLER                       PIC  X(10) VALUE            01019000
010200         ' SQLCODE= '.                                            01020000
010210     05  PV-SQLCODE                   PIC -9(03).                 01021000
010220     05  FILLER                       PIC  X(06) VALUE            01022000
010230         ' ERR= '.                                                01023000
010240     05  PV-ERROR-NBR                 PIC  9(03) VALUE ZERO.      01024000
010250                                                                  01025000
010260* COMMAREA FOR DLKRF SCREENS                                      01026000
010270     COPY DLWS010.                                                01027000
010280* FULL SCREEN MESSAGES                                            01028000
010290     COPY DLWS012.                                                01029000
010300                                                                  01030000
010400* COMMAREA FOR XLKUT067                                           01040000
010500     COPY XLWS067.                                                01050000
010600                                                                  01060000
010700* COMMAREA FOR XLKUP003                                           01070000
010800     COPY XLWS072.                                                01080000
010900                                                                  01090000
011000* COMMAREA FOR DLKUT001                                           01100000
011100     COPY DLWS003.                                                01110000
011200                                                                  01120000
011300* COMMAREA FOR DLKUP002                                           01130000
011400     COPY DLWS005.                                                01140000
011500                                                                  01150000
011600* COMMAREA FOR DLKUP003                                           01160000
011700     COPY DLWS007.                                                01170000
011800                                                                  01180000
011900*    DLKCS410 COMMAREA                                            01190000
012000*    COPY DLWS016.                                                01200000
012100                                                                  01210000
012200*  MAP LAYOUT                                                     01220000
012300     COPY DLKM457.                                                01230000
012400                                                                  01240000
012500* HELP SCREEN COMMAREA                                            01250000
012600     COPY PCWS192.                                                01260000
012700* HELP SCREEN WORK AREA                                           01270000
012800     COPY PCWS188.                                                01280000
012900                                                                  01290000
013000*  NUMERIC EDITS                                                  01300000
013100     COPY DPWS010I.                                               01310000
013200*                                                                 01320000
013300*  KOHL'S STANDARD ATTRIBUTES                                     01330000
013400     COPY DPWS015.                                                01340000
013500                                                                  01350000
013600*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01360000
013700     COPY DFHAID.                                                 01370000
013800                                                                  01380000
013900*  CICS CHARACTER ATTRIBUTES                                      01390000
014000     COPY DFHBMSCA.                                               01400000
014100                                                                  01410000
014200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01420000
014300     COPY DPWS013.                                                01430000
014400                                                                  01440000
014500*    DLT_TEM_ASGMT                                                01450000
014600     EXEC SQL                                                     01460000
014700         INCLUDE DLT00003                                         01470000
014800     END-EXEC                                                     01480000
014900                                                                  01490000
015000*    DLT__ASGMT                                                   01500000
015100     EXEC SQL                                                     01510000
015200         INCLUDE DLT00004                                         01520000
015300     END-EXEC                                                     01530000
015400                                                                  01540000
015410*    WST_INTGRTN_TYP                                              01541000
015420     EXEC SQL                                                     01542000
015430         INCLUDE WST00008                                         01543000
015440     END-EXEC                                                     01544000
015450                                                                  01545000
015460*    WST_ATTR_DEFN                                                01546000
015470     EXEC SQL                                                     01547000
015480         INCLUDE WST00009                                         01548000
015490     END-EXEC                                                     01549000
015491                                                                  01549100
015492*    WST_ATTR_ELEM                                                01549200
015493     EXEC SQL                                                     01549300
015494         INCLUDE WST00010                                         01549400
015495     END-EXEC                                                     01549500
015496                                                                  01549600
015497     EXEC SQL                                                     01549700
015498         INCLUDE TKRPRPM                                          01549800
015499     END-EXEC                                                     01549900
015500                                                                  01550000
015600*    USED FOR VALIDATING GROUP NAMES PROVIDED AS INPUT            01560000
015700     EXEC SQL                                                     01570000
015800         DECLARE VALID-GROUP-CSR CURSOR WITH HOLD FOR             01580000
015900           SELECT  C.ATTR_ELEM_TXT    AS GLOBAL_ISTOP_GROUP       01590000
016000                 , D.ATTR_ELEM_TXT    AS WORK_TYPE_DESCR          01600000
016100                 , E.ATTR_ELEM_NBR    AS DC_NBR                   01610000
016200                 , F.ATTR_ELEM_TXT    AS ACTIVE_INDICATOR         01620000
016300                 , G.ATTR_ELEM_TXT    AS FROM_TIMESTAMP           01630000
016400                 , H.ATTR_ELEM_TXT    AS TO_TIMESTAMP             01640000
016500                 , I.ATTR_ELEM_TXT    AS SCREEN_GLOBAL_DESCR      01650000
016600             FROM  WST_INTGRTN_TYP A                              01660000
016700                 , WST_ATTR_DEFN   B                              01670000
016800                 , WST_ATTR_ELEM   C                              01680000
016900                 , WST_ATTR_ELEM   D                              01690000
017000                 , WST_ATTR_ELEM   E                              01700000
017010                 , WST_ATTR_ELEM   F                              01701000
017020                 , WST_ATTR_ELEM   G                              01702000
017030                 , WST_ATTR_ELEM   H                              01703000
017040                 , WST_ATTR_ELEM   I                              01704000
017050            WHERE A.INTGRTN_TYP_CDE    =  'DLGISTOP'              01705000
017060              AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE       01706000
017070              AND A.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE       01707000
017080              AND A.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE       01708000
017090              AND A.INTGRTN_TYP_CDE    =  E.INTGRTN_TYP_CDE       01709000
017100              AND A.INTGRTN_TYP_CDE    =  F.INTGRTN_TYP_CDE       01710000
017200              AND A.INTGRTN_TYP_CDE    =  G.INTGRTN_TYP_CDE       01720000
017210              AND A.INTGRTN_TYP_CDE    =  H.INTGRTN_TYP_CDE       01721000
017220              AND A.INTGRTN_TYP_CDE    =  I.INTGRTN_TYP_CDE       01722000
017230              AND C.ATTR_ELEM_SEQ_NBR  =  D.ATTR_ELEM_SEQ_NBR     01723000
017240              AND C.ATTR_ELEM_SEQ_NBR  =  E.ATTR_ELEM_SEQ_NBR     01724000
017250              AND C.ATTR_ELEM_SEQ_NBR  =  F.ATTR_ELEM_SEQ_NBR     01725000
017260              AND C.ATTR_ELEM_SEQ_NBR  =  G.ATTR_ELEM_SEQ_NBR     01726000
017270              AND C.ATTR_ELEM_SEQ_NBR  =  H.ATTR_ELEM_SEQ_NBR     01727000
017280              AND C.ATTR_ELEM_SEQ_NBR  =  I.ATTR_ELEM_SEQ_NBR     01728000
017290              AND B.ATTR_DEFN_SEQ_NBR  =  1                       01729000
017291              AND C.ATTR_DEFN_SEQ_NBR  =  1                       01729100
017292              AND D.ATTR_DEFN_SEQ_NBR  =  2                       01729200
017293              AND E.ATTR_DEFN_SEQ_NBR  =  3                       01729300
017294              AND F.ATTR_DEFN_SEQ_NBR  =  4                       01729400
017295              AND G.ATTR_DEFN_SEQ_NBR  =  5                       01729500
017296              AND H.ATTR_DEFN_SEQ_NBR  =  6                       01729600
017297              AND I.ATTR_DEFN_SEQ_NBR  =  7                       01729700
017298              AND C.ATTR_ELEM_TXT      =  :DK-INPUT-GROUP         01729800
017299              AND E.ATTR_ELEM_NBR      =  :DK-DC-NBR              01729900
017300              AND F.ATTR_ELEM_TXT      =  'Y'                     01730000
017301              AND G.ATTR_ELEM_TMST    <=  CURRENT TIMESTAMP       01730100
017302              AND H.ATTR_ELEM_TMST    >=  CURRENT TIMESTAMP       01730200
017303         WITH UR                                                  01730300
017304     END-EXEC                                                     01730400
017305                                                                  01730500
017306** GET THE ACTIVE ASSIGNMENTS                                     01730600
017307     EXEC SQL                                                     01730700
017308         DECLARE ACT-TEM-ASGMT-CSR CURSOR WITH HOLD FOR           01730800
017309            SELECT A.ASGMT_STRT_DTE                               01730900
017310                 , A.ASGMT_NBR_TXT                                01731000
017320                 , A.ASGMT_NBR_SEQ_NBR                            01732000
017330                 , B.TEM_ASGMT_SEQ_NBR                            01733000
017340                 , CASE                                           01734000
017350                     WHEN B.KOHLS_USR_ID IS NOT NULL              01735000
017360                      THEN 'K'                                    01736000
017370                      ELSE 'T'                                    01737000
017380                   END                                            01738000
017390                ,  B.KOHLS_USR_ID                                 01739000
017400                ,  B.TMP_USR_ID                                   01740000
017500             FROM DLT_ASGMT         A                             01750000
017510                , DLT_TEM_ASGMT     B                             01751000
017520            WHERE A.WK_TYP_DESC       = :PV-WST-WORK-TYP          01752000
017530              AND A.DC_NBR            = :DK-DC-NBR                01753000
017540              AND A.ASGMT_STP_RSN_CDE = 'N'                       01754000
017550              AND A.ASGMT_STRT_DTE    = B.ASGMT_STRT_DTE          01755000
017560              AND A.ASGMT_NBR_TXT     = B.ASGMT_NBR_TXT           01756000
017570              AND A.ASGMT_NBR_SEQ_NBR = B.ASGMT_NBR_SEQ_NBR       01757000
017580              AND B.LVE_RSN_CDE       = 'N'                       01758000
017590     END-EXEC.                                                    01759000
017600                                                                  01760000
017601     EXEC SQL                                                     01760100
017602         DECLARE ACT-ASGMT-CSR CURSOR WITH HOLD FOR               01760200
017603          SELECT A.ASGMT_STRT_DTE                                 01760300
017604               , A.ASGMT_NBR_TXT                                  01760400
017605               , A.ASGMT_NBR_SEQ_NBR                              01760500
017606            FROM DLT_ASGMT A                                      01760600
017607           WHERE A.WK_TYP_DESC       = :PV-WST-WORK-TYP           01760700
017608             AND A.DC_NBR            = :DK-DC-NBR                 01760800
017609             AND A.ASGMT_STP_RSN_CDE = 'N'                        01760900
017610             AND NOT EXISTS                                       01761000
017611                (SELECT B.ASGMT_NBR_SEQ_NBR                       01761100
017612                   FROM DLT_TEM_ASGMT B                           01761200
017613                  WHERE A.ASGMT_STRT_DTE    = B.ASGMT_STRT_DTE    01761300
017614                    AND A.ASGMT_NBR_TXT     = B.ASGMT_NBR_TXT     01761400
017615                    AND A.ASGMT_NBR_SEQ_NBR = B.ASGMT_NBR_SEQ_NBR 01761500
017616                    AND B.LVE_RSN_CDE       = 'N')                01761600
017617     END-EXEC.                                                    01761700
017618                                                                  01761800
017619     EXEC SQL                                                     01761900
017620         INCLUDE SQLCA                                            01762000
017630     END-EXEC.                                                    01763000
017640                                                                  01764000
017650 LINKAGE SECTION.                                                 01765000
017660 01  DFHCOMMAREA.                                                 01766000
017670     05  FILLER                         OCCURS  1 TO 4072 TIMES   01767000
017680                                      DEPENDING ON EIBCALEN.      01768000
017690         10  FILLER                   PIC X.                      01769000
017700/                                                                 01770000
017800 PROCEDURE DIVISION.                                              01780000
017900 0000-PROGRAM-MAINLINE.                                           01790000
018000                                                                  01800000
018100     INITIALIZE DL010-COMMAREA                                    01810000
018200     MOVE DFHCOMMAREA                 TO DL010-COMMAREA           01820000
018300                                                                  01830000
018400     EVALUATE TRUE                                                01840000
018500         WHEN EIBCALEN = ZERO                                     01850000
018600             MOVE PC-ENTER-THROUGH-MENU-MSG                       01860000
018700                                      TO PV-MESSAGE-AREA          01870000
018800             PERFORM 8110-RETURN                                  01880000
018900                                                                  01890000
019000         WHEN EIBTRNID = 'Z278'                                   01900000
019100             MOVE DFHCOMMAREA         TO PC192-COMMAREA           01910000
019200             MOVE PC192-HOST-SAVE-AREA                            01920000
019300                                      TO DL010-COMMAREA           01930000
019400             SET DL010-PROCESS-SCREEN TO TRUE                     01940000
019500             MOVE PC192-HOST-SAVE-MAP TO DL457AO                  01950000
019600             PERFORM 8000-SEND-MAP                                01960000
019700             PERFORM 8100-RETURN-TRANID                           01970000
019800                                                                  01980000
019900         WHEN DL010-INITIALIZE-SCREEN                             01990000
020000         WHEN EIBAID = DFHCLEAR                                   02000000
020100             SET DL010-PROCESS-SCREEN TO TRUE                     02010000
020200             SET DL010-FORCE-F3-NO    TO TRUE                     02020000
020300             PERFORM 1000-INITIALIZE                              02030000
020400                                                                  02040000
020500             PERFORM 8000-SEND-MAP                                02050000
020600             PERFORM 8100-RETURN-TRANID                           02060000
020700                                                                  02070000
020800         WHEN EIBAID = DFHPF2                                     02080000
020900             IF DL010-WAIT-FOR-CONFIRM                            02090000
021000                 PERFORM 8020-RECEIVE-MAP                         02100000
021100                 MOVE AGROUPI                   TO DK-INPUT-GROUP 02110000
021200                 MOVE DL010-OPER-UNT-ID         TO DK-DC-NBR      02120000
021300                 SET PS-GET-IMPACTED-REC-CNT-NO TO TRUE           02130000
021400                 PERFORM 2000-PROCESS-REQUEST                     02140000
021500                 IF PS-ERRORS-NO                                  02150000
021600                     SET DL010-UPDATE-CONFIRMED TO TRUE           02160000
021700                     PERFORM 9904-WRITE-SUMMARY-IN-CICS-LOG       02170000
021800                     MOVE '   F5 TO APPLY     ' TO AMSG5O         02180000
021900                     PERFORM 1000-INITIALIZE                      02190000
022000                     MOVE '   SUCCESSFUL      ' TO AERMSGO        02200000
022100                     SET DL010-FORCE-F3         TO TRUE           02210000
022200                     PERFORM 8000-SEND-MAP                        02220000
022300                     PERFORM 8100-RETURN-TRANID                   02230000
022400                 ELSE                                             02240000
022500                     PERFORM 8000-SEND-MAP                        02250000
022600                     PERFORM 8100-RETURN-TRANID                   02260000
022700             ELSE                                                 02270000
022800                 PERFORM 8020-RECEIVE-MAP                         02280000
022900                 MOVE DFHBMFSE                  TO AGROUPA        02290000
023000                 MOVE PC-UNRECOGNIZED-PF-KEY-MSG                  02300000
023100                                                TO AERMSGO        02310000
023200                 PERFORM 8000-SEND-MAP                            02320000
023300                 PERFORM 8100-RETURN-TRANID                       02330000
023400             END-IF                                               02340000
023500                                                                  02350000
023600         WHEN EIBAID = DFHPF3                                     02360000
023700             SET DL010-INITIALIZE-SCREEN                          02370000
023800                                      TO TRUE                     02380000
023900             MOVE DL010-LAST-PROGRAM  TO PV-TRANSFER-PROGRAM      02390000
024000             PERFORM 8200-XCTL                                    02400000
024100                                                                  02410000
024200         WHEN EIBAID = DFHPF5                                     02420000
024300             PERFORM 8020-RECEIVE-MAP                             02430000
024400             IF AGROUPI = SPACES                                  02440000
024500                MOVE PC-EMPTY-GROUP-MSG    TO AERMSGO             02450000
024600             ELSE                                                 02460000
024700                 MOVE AGROUPI              TO DK-INPUT-GROUP      02470000
024800                 MOVE DL010-OPER-UNT-ID    TO DK-DC-NBR           02480000
024900                                              PV-LOC-NBR          02490000
025000                 SET PS-GET-IMPACTED-REC-CNT                      02500000
025100                     DL010-WAIT-FOR-CONFIRM                       02510000
025200                     PS-VALID-ISTOP-GROUP-NO TO TRUE              02520000
025300                                                                  02530000
025400                 PERFORM 2000-PROCESS-REQUEST                     02540000
025500                                                                  02550000
025600                 IF PS-VALID-ISTOP-GROUP                          02560000
025700                    IF PV-TOT-ACTV-ASGMT > ZERO                   02570000
025800                       MOVE PV-TOT-ACTV-ASGMT                     02580000
025900                                           TO PV-ASSOCIATE-COUNT  02590000
026000                       MOVE PV-WST-GROUP-DESC                     02600000
026100                                           TO PV-ISTOP-AREA       02610000
026200                       MOVE DFHBMPRF       TO AGROUPA             02620000
026300                       MOVE DFHBLUE        TO AGROUPC             02630000
026400                       MOVE DFHDFT         TO AGROUPH             02640000
026500                       MOVE PV-DISPLAY-MSG-1  TO AMSG1O           02650000
026600                       MOVE PV-DISPLAY-MSG-2  TO AMSG2O           02660000
026700                       MOVE PV-DISPLAY-MSG-3  TO AMSG3O           02670000
026800                       MOVE PV-DISPLAY-MSG-4  TO AMSG4O           02680000
026900                       MOVE PV-DISPLAY-MSG-5  TO AMSG5O           02690000
027000                       MOVE SPACES            TO AERMSGO          02700000
027100                    ELSE                                          02710000
027200                       MOVE PC-NO-ACTIVE-ASSOCIATE                02720000
027300                                           TO AERMSGO             02730000
027400                       MOVE DFHBMUNP       TO AGROUPA             02740000
027500                       MOVE DFHGREEN       TO AGROUPC             02750000
027600                 ELSE                                             02760000
027700                    MOVE PC-INVALID-GROUP-MSG                     02770000
027800                                           TO AERMSGO             02780000
027900                 END-IF                                           02790000
028000             END-IF                                               02800000
028100             PERFORM 8000-SEND-MAP                                02810000
028200             PERFORM 8100-RETURN-TRANID                           02820000
028300                                                                  02830000
028400         WHEN EIBAID = DFHPF9                                     02840000
028500                                                                  02850000
028600             MOVE DFHBMUNP                 TO AGROUPA             02860000
028700             MOVE '   F5 TO APPLY     '    TO AMSG5O              02870000
028800             SET DL010-PROCESS-SCREEN      TO TRUE                02880000
028900             PERFORM 1000-INITIALIZE                              02890000
029000             PERFORM 8000-SEND-MAP                                02900000
029100             PERFORM 8100-RETURN-TRANID                           02910000
029200                                                                  02920000
029300         WHEN EIBAID = DFHPF1                                     02930000
029400             PERFORM 8020-RECEIVE-MAP                             02940000
029500             MOVE DL457AO                  TO PC192-HOST-SAVE-MAP 02950000
029600             PERFORM 1200-HELP-SCREEN                             02960000
029700                                                                  02970000
029800         WHEN OTHER                                               02980000
029900             PERFORM 8020-RECEIVE-MAP                             02990000
030000             IF DL010-WAIT-FOR-CONFIRM                            03000000
030100                 MOVE DFHBMPRF             TO AGROUPA             03010000
030200                 MOVE DFHBLUE              TO AGROUPC             03020000
030300                 MOVE DFHDFT               TO AGROUPH             03030000
030400             ELSE                                                 03040000
030500                 MOVE DFHBMFSE             TO AGROUPA             03050000
030600                 MOVE DFHGREEN             TO AGROUPC             03060000
030700             END-IF                                               03070000
030800             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                      03080000
030900                                           TO AERMSGO             03090000
031000             PERFORM 8000-SEND-MAP                                03100000
031100             PERFORM 8100-RETURN-TRANID                           03110000
031200     END-EVALUATE.                                                03120000
031300                                                                  03130000
031400     GOBACK.                                                      03140000
031500                                                                  03150000
031600 1000-INITIALIZE.                                                 03160000
031700                                                                  03170000
031800     INITIALIZE AMSG1O                                            03180000
031900                AMSG2O                                            03190000
032000                AMSG3O                                            03200000
032100                AMSG4O                                            03210000
032200                AERMSGO                                           03220000
032300                PV-ACTV-TEM-ASGMT-COUNT                           03230000
032400                PV-ACTV-ASGMT-COUNT                               03240000
032500                PV-TOT-ACTV-ASGMT                                 03250000
032600                DK-INPUT-GROUP.                                   03260000
032700     MOVE DFHUNDLN                    TO AGROUPH.                 03270000
032800     MOVE DFHGREEN                    TO AGROUPC.                 03280000
032900                                                                  03290000
033000 1200-HELP-SCREEN.                                                03300000
033100     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      03310000
033200     MOVE 'DLKRF457'                  TO PC192-PROGRAM-NAME       03320000
033300     COPY PCPD188.                                                03330000
033400     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      03340000
033500     MOVE DL010-COMMAREA              TO PC192-HOST-SAVE-AREA     03350000
033600     PERFORM 8220-XCTL-TO-HELP.                                   03360000
033700                                                                  03370000
033800******************************************************************03380000
033900 2000-PROCESS-REQUEST.                                            03390000
034000******************************************************************03400000
034100                                                                  03410000
034200     SET PS-END-OF-VALID-GROUP-CSR-NO TO TRUE.                    03420000
034300                                                                  03430000
034400     PERFORM 6000-OPEN-VALIDATE-GROUP-CSR.                        03440000
034500     PERFORM 6100-FETCH-VALIDATE-GROUP-CSR                        03450000
034600       UNTIL PS-END-OF-VALID-GROUP-CSR.                           03460000
034700     PERFORM 6200-CLOSE-VALIDATE-GROUP-CSR.                       03470000
034800                                                                  03480000
034900******************************************************************03490000
035000 6000-OPEN-VALIDATE-GROUP-CSR.                                    03500000
035100******************************************************************03510000
035200                                                                  03520000
035300     EXEC SQL                                                     03530000
035400         OPEN VALID-GROUP-CSR                                     03540000
035500     END-EXEC.                                                    03550000
035600                                                                  03560000
035700     EVALUATE TRUE                                                03570000
035800         WHEN SQLCODE = ZERO                                      03580000
035900             CONTINUE                                             03590000
036000         WHEN SQLCODE = -904                                      03600000
036100         WHEN SQLCODE = -913                                      03610000
036200         WHEN SQLCODE = -911                                      03620000
036300             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           03630000
036400             MOVE SQLCODE             TO PV-SQLCODE               03640000
036500             MOVE 1                   TO PV-ERROR-NBR             03650000
036600                                         DL010-ERROR-NBR          03660000
036700             PERFORM 9903-WRITE-CICS-LOG                          03670000
036800             PERFORM 9000-SOFT-ABORT                              03680000
036900             PERFORM 8210-XCTL-ERROR-SCREEN                       03690000
037000         WHEN SQLWARN0 NOT = SPACES                               03700000
037100         WHEN SQLCODE  NOT = ZERO                                 03710000
037200             MOVE 2                   TO PV-ERROR-NBR             03720000
037300                                         DL010-ERROR-NBR          03730000
037400             PERFORM 9903-WRITE-CICS-LOG                          03740000
037500             MOVE '6000-OPEN-VALIDATE-GROUP-CSR'                  03750000
037600                                      TO DL010-PARAGRAPH          03760000
037700             MOVE 'DLKRF457 - OPEN GROUP CURSOR'                  03770000
037800                                      TO DL010-MESSAGE-TEXT(1)    03780000
037900             MOVE SQLCA               TO DL010-SQLCA              03790000
038000             MOVE 'WST_INTGRTN_TYP'   TO DL010-DB2-TABLE-NAME(1)  03800000
038100             MOVE 'WST_ATTR_DEFN'     TO DL010-DB2-TABLE-NAME(2)  03810000
038200             MOVE 'WST_ATTR_ELEM'     TO DL010-DB2-TABLE-NAME(3)  03820000
038300             SET DL010-ABEND          TO TRUE                     03830000
038400             MOVE 3                   TO DL010-PGM-MSG-NBR        03840000
038500             PERFORM 8210-XCTL-ERROR-SCREEN                       03850000
038600     END-EVALUATE.                                                03860000
038700                                                                  03870000
038800******************************************************************03880000
038900 6100-FETCH-VALIDATE-GROUP-CSR.                                   03890000
039000******************************************************************03900000
039100                                                                  03910000
039200     EXEC SQL                                                     03920000
039300         FETCH VALID-GROUP-CSR                                    03930000
039400          INTO :PV-WST-GLBL-ISTOP-GRP                             03940000
039500              ,:PV-WST-WORK-TYP                                   03950000
039600              ,:PV-WST-DC-NBR                                     03960000
039700              ,:PV-WST-ACTV-IND                                   03970000
039800              ,:PV-WST-FROM-TMST :DN-WST-FROM-TMST-NULL-IND       03980000
039900              ,:PV-WST-TO-TMST   :DN-WST-TO-TMST-NULL-IND         03990000
040000              ,:PV-WST-GROUP-DESC                                 04000000
040100     END-EXEC.                                                    04010000
040200                                                                  04020000
040300     EVALUATE TRUE                                                04030000
040400         WHEN SQLCODE = ZERO                                      04040000
040500             SET PS-VALID-ISTOP-GROUP      TO TRUE                04050000
040600             IF PS-GET-IMPACTED-REC-CNT                           04060000
040700                PERFORM 6500-GET-TOTAL-ACTIVE-ASGMT               04070000
040800             ELSE                                                 04080000
040900                PERFORM 7000-PROCEED-FOR-ISTOP                    04090000
041000             END-IF                                               04100000
041100         WHEN SQLCODE = +100                                      04110000
041200             SET PS-END-OF-VALID-GROUP-CSR TO TRUE                04120000
041300         WHEN SQLCODE = -904                                      04130000
041400         WHEN SQLCODE = -913                                      04140000
041500         WHEN SQLCODE = -911                                      04150000
041600             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           04160000
041700             MOVE SQLCODE             TO PV-SQLCODE               04170000
041800             MOVE 3                   TO PV-ERROR-NBR             04180000
041900                                         DL010-ERROR-NBR          04190000
042000             PERFORM 9903-WRITE-CICS-LOG                          04200000
042100             PERFORM 9000-SOFT-ABORT                              04210000
042200             PERFORM 8210-XCTL-ERROR-SCREEN                       04220000
042300         WHEN SQLWARN0 NOT = SPACES                               04230000
042400         WHEN SQLCODE  NOT = ZERO                                 04240000
042500             MOVE 4                   TO PV-ERROR-NBR             04250000
042600                                         DL010-ERROR-NBR          04260000
042700             PERFORM 9903-WRITE-CICS-LOG                          04270000
042800             MOVE '6100-FETCH-VALIDATE-GROUP-CSR'                 04280000
042900                                      TO DL010-PARAGRAPH          04290000
043000             MOVE 'DLKRF457 - FETCH GROUP CURSOR'                 04300000
043100                                      TO DL010-MESSAGE-TEXT(1)    04310000
043200             MOVE SQLCA               TO DL010-SQLCA              04320000
043300             MOVE 'WST_INTGRTN_TYP'   TO DL010-DB2-TABLE-NAME(1)  04330000
043400             MOVE 'WST_ATTR_DEFN'     TO DL010-DB2-TABLE-NAME(2)  04340000
043500             MOVE 'WST_ATTR_ELEM'     TO DL010-DB2-TABLE-NAME(3)  04350000
043600             SET DL010-ABEND          TO TRUE                     04360000
043700             MOVE 3                   TO DL010-PGM-MSG-NBR        04370000
043800             PERFORM 8210-XCTL-ERROR-SCREEN                       04380000
043900     END-EVALUATE.                                                04390000
044000                                                                  04400000
044100******************************************************************04410000
044200 6200-CLOSE-VALIDATE-GROUP-CSR.                                   04420000
044300******************************************************************04430000
044400                                                                  04440000
044500     EXEC SQL                                                     04450000
044600         CLOSE VALID-GROUP-CSR                                    04460000
044700     END-EXEC.                                                    04470000
044800                                                                  04480000
044900     EVALUATE TRUE                                                04490000
045000         WHEN SQLCODE = ZERO                                      04500000
045100             CONTINUE                                             04510000
045200         WHEN SQLCODE = -904                                      04520000
045300         WHEN SQLCODE = -913                                      04530000
045400         WHEN SQLCODE = -911                                      04540000
045500             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           04550000
045600             MOVE SQLCODE             TO PV-SQLCODE               04560000
045700             MOVE 5                   TO PV-ERROR-NBR             04570000
045800                                         DL010-ERROR-NBR          04580000
045900             PERFORM 9903-WRITE-CICS-LOG                          04590000
046000             PERFORM 9000-SOFT-ABORT                              04600000
046100             PERFORM 8210-XCTL-ERROR-SCREEN                       04610000
046200         WHEN SQLWARN0 NOT = SPACES                               04620000
046300         WHEN SQLCODE  NOT = ZERO                                 04630000
046400             MOVE 6                   TO PV-ERROR-NBR             04640000
046500                                         DL010-ERROR-NBR          04650000
046600             PERFORM 9903-WRITE-CICS-LOG                          04660000
046700             MOVE '6200-CLOSE-VALIDATE-GROUP-CSR'                 04670000
046800                                      TO DL010-PARAGRAPH          04680000
046900             MOVE 'DLKRF457 - CLOSE GROUP CURSOR'                 04690000
047000                                      TO DL010-MESSAGE-TEXT(1)    04700000
047100             MOVE SQLCA               TO DL010-SQLCA              04710000
047200             MOVE 'WST_INTGRTN_TYP'   TO DL010-DB2-TABLE-NAME(1)  04720000
047300             MOVE 'WST_ATTR_DEFN'     TO DL010-DB2-TABLE-NAME(2)  04730000
047400             MOVE 'WST_ATTR_ELEM'     TO DL010-DB2-TABLE-NAME(3)  04740000
047500             SET DL010-ABEND          TO TRUE                     04750000
047600             MOVE 3                   TO DL010-PGM-MSG-NBR        04760000
047700             PERFORM 8210-XCTL-ERROR-SCREEN                       04770000
047800     END-EVALUATE.                                                04780000
047900                                                                  04790000
048000******************************************************************04800000
048100 6500-GET-TOTAL-ACTIVE-ASGMT.                                     04810000
048200******************************************************************04820000
048300     PERFORM 6510-GET-TOT-ACTV-TEAM-ASGMT.                        04830000
048400     PERFORM 6520-GET-TOT-ACTV-ASGMT.                             04840000
048500                                                                  04850000
048600******************************************************************04860000
048700 6510-GET-TOT-ACTV-TEAM-ASGMT.                                    04870000
048800******************************************************************04880000
048900                                                                  04890000
049000     EXEC SQL                                                     04900000
049100         SELECT COUNT(*)                                          04910000
049200           INTO :PV-ACTV-TEM-ASGMT-COUNT                          04920000
049300           FROM DLT_ASGMT         A                               04930000
049400              , DLT_TEM_ASGMT     B                               04940000
049500          WHERE A.WK_TYP_DESC       = :PV-WST-WORK-TYP            04950000
049600            AND A.DC_NBR            = :DK-DC-NBR                  04960000
049700            AND A.ASGMT_STP_RSN_CDE = 'N'                         04970000
049800            AND A.ASGMT_STRT_DTE    = B.ASGMT_STRT_DTE            04980000
049900            AND A.ASGMT_NBR_TXT     = B.ASGMT_NBR_TXT             04990000
050000            AND A.ASGMT_NBR_SEQ_NBR = B.ASGMT_NBR_SEQ_NBR         05000000
050100            AND B.LVE_RSN_CDE       = 'N'                         05010000
050200     END-EXEC.                                                    05020000
050300                                                                  05030000
050400     EVALUATE TRUE                                                05040000
050500         WHEN SQLCODE = ZERO                                      05050000
050600             COMPUTE PV-TOT-ACTV-ASGMT =  PV-TOT-ACTV-ASGMT       05060000
050700                                        + PV-ACTV-TEM-ASGMT-COUNT 05070000
050800         WHEN SQLCODE = -904                                      05080000
050900         WHEN SQLCODE = -913                                      05090000
051000         WHEN SQLCODE = -911                                      05100000
051100             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           05110000
051200             MOVE SQLCODE             TO PV-SQLCODE               05120000
051300             MOVE 7                   TO PV-ERROR-NBR             05130000
051400                                         DL010-ERROR-NBR          05140000
051500             PERFORM 9903-WRITE-CICS-LOG                          05150000
051600             PERFORM 9000-SOFT-ABORT                              05160000
051700             PERFORM 8210-XCTL-ERROR-SCREEN                       05170000
051800         WHEN SQLWARN0 NOT = SPACES                               05180000
051900         WHEN SQLCODE  NOT = ZERO                                 05190000
052000             MOVE 8                   TO PV-ERROR-NBR             05200000
052100                                         DL010-ERROR-NBR          05210000
052200             PERFORM 9903-WRITE-CICS-LOG                          05220000
052300             MOVE '6510-GET-TOT-ACTV-TEAM-ASGMT'                  05230000
052400                                      TO DL010-PARAGRAPH          05240000
052500             MOVE 'DLKRF457 - TEAM ASGMT COUNT'                   05250000
052600                                      TO DL010-MESSAGE-TEXT(1)    05260000
052700             MOVE SQLCA               TO DL010-SQLCA              05270000
052800             MOVE 'DLT_ASGMT'         TO DL010-DB2-TABLE-NAME(1)  05280000
052900             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(2)  05290000
053000             SET DL010-ABEND          TO TRUE                     05300000
053100             MOVE 3                   TO DL010-PGM-MSG-NBR        05310000
053200             PERFORM 8210-XCTL-ERROR-SCREEN                       05320000
053300     END-EVALUATE.                                                05330000
053400                                                                  05340000
053500******************************************************************05350000
053600 6520-GET-TOT-ACTV-ASGMT.                                         05360000
053700******************************************************************05370000
053800                                                                  05380000
053900     EXEC SQL                                                     05390000
054000         SELECT COUNT(*)                                          05400000
054100           INTO :PV-ACTV-ASGMT-COUNT                              05410000
054200           FROM DLT_ASGMT A                                       05420000
054300          WHERE A.WK_TYP_DESC       = :PV-WST-WORK-TYP            05430000
054400            AND A.DC_NBR            = :DK-DC-NBR                  05440000
054500            AND A.ASGMT_STP_RSN_CDE = 'N'                         05450000
054600            AND NOT EXISTS                                        05460000
054700               (SELECT B.ASGMT_NBR_SEQ_NBR                        05470000
054800                  FROM DLT_TEM_ASGMT B                            05480000
054900                 WHERE A.ASGMT_STRT_DTE    = B.ASGMT_STRT_DTE     05490000
055000                   AND A.ASGMT_NBR_TXT     = B.ASGMT_NBR_TXT      05500000
055100                   AND A.ASGMT_NBR_SEQ_NBR = B.ASGMT_NBR_SEQ_NBR  05510000
055200                   AND B.LVE_RSN_CDE       = 'N')                 05520000
055300     END-EXEC.                                                    05530000
055400                                                                  05540000
055500     EVALUATE TRUE                                                05550000
055600         WHEN SQLCODE = ZERO                                      05560000
055700             COMPUTE PV-TOT-ACTV-ASGMT =  PV-TOT-ACTV-ASGMT       05570000
055800                                        + PV-ACTV-ASGMT-COUNT     05580000
055900         WHEN SQLCODE = -904                                      05590000
056000         WHEN SQLCODE = -913                                      05600000
056100         WHEN SQLCODE = -911                                      05610000
056200             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           05620000
056300             MOVE SQLCODE             TO PV-SQLCODE               05630000
056400             MOVE 9                   TO PV-ERROR-NBR             05640000
056500                                         DL010-ERROR-NBR          05650000
056600             PERFORM 9903-WRITE-CICS-LOG                          05660000
056700             PERFORM 9000-SOFT-ABORT                              05670000
056800             PERFORM 8210-XCTL-ERROR-SCREEN                       05680000
056900         WHEN SQLWARN0 NOT = SPACES                               05690000
057000         WHEN SQLCODE  NOT = ZERO                                 05700000
057100             MOVE 10                  TO PV-ERROR-NBR             05710000
057200                                         DL010-ERROR-NBR          05720000
057300             PERFORM 9903-WRITE-CICS-LOG                          05730000
057400             MOVE '6520-GET-TOT-ACTV-ASGMT'                       05740000
057500                                      TO DL010-PARAGRAPH          05750000
057600             MOVE 'DLKRF457 - ACTIVE ASGMT COUNT'                 05760000
057700                                      TO DL010-MESSAGE-TEXT(1)    05770000
057800             MOVE SQLCA               TO DL010-SQLCA              05780000
057900             MOVE 'DLT_ASGMT'         TO DL010-DB2-TABLE-NAME(1)  05790000
058000             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(2)  05800000
058100             SET DL010-ABEND          TO TRUE                     05810000
058200             MOVE 3                   TO DL010-PGM-MSG-NBR        05820000
058300             PERFORM 8210-XCTL-ERROR-SCREEN                       05830000
058400     END-EVALUATE.                                                05840000
058500                                                                  05850000
058600******************************************************************05860000
058700 7000-PROCEED-FOR-ISTOP.                                          05870000
058800******************************************************************05880000
058900                                                                  05890000
059000     PERFORM 7500-PROCESS-ACTV-TEM-ASGMT                          05900000
059100     PERFORM 7600-PROCESS-ACTV-ASGMT                              05910000
059200     COMPUTE PV-TOT-ACTV-ASGMT =   PV-TOT-ACTV-ASGMT              05920000
059300                                 + PV-ACTV-TEM-ASGMT-COUNT        05930000
059400                                 + PV-ACTV-ASGMT-COUNT.           05940000
059500                                                                  05950000
059600******************************************************************05960000
059700 7500-PROCESS-ACTV-TEM-ASGMT.                                     05970000
059800******************************************************************05980000
059900                                                                  05990000
060000     MOVE +0                           TO PV-ACTV-TEM-ASGMT-COUNT.06000000
060100     SET  PS-PROCESS-ERROR-NO                                     06010000
060200          PS-NOT-EOC-ACT-TEM-ASGMT-CSR TO TRUE.                   06020000
060300     MOVE DL010-OPER-UNT-ID            TO DK-DC-NBR               06030000
060400     PERFORM 7515-OPEN-ACT-TEM-ASGMT-CSR                          06040000
060500     PERFORM 7530-FETCH-ACT-TEM-ASGMT-CSR                         06050000
060600             UNTIL PS-EOC-ACT-TEM-ASGMT-CSR                       06060000
060700                OR PS-PROCESS-ERROR                               06070000
060800     PERFORM 7550-CLOSE-ACT-TEM-ASGMT-CSR.                        06080000
060900                                                                  06090000
061000******************************************************************06100000
061100 7515-OPEN-ACT-TEM-ASGMT-CSR.                                     06110000
061200******************************************************************06120000
061300                                                                  06130000
061400     EXEC SQL                                                     06140000
061500          OPEN ACT-TEM-ASGMT-CSR                                  06150000
061600     END-EXEC.                                                    06160000
061700                                                                  06170000
061800     EVALUATE TRUE                                                06180000
061900         WHEN SQLCODE = ZERO                                      06190000
062000             CONTINUE                                             06200000
062100         WHEN SQLCODE = -904                                      06210000
062200         WHEN SQLCODE = -913                                      06220000
062300         WHEN SQLCODE = -911                                      06230000
062400             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           06240000
062500             MOVE SQLCODE             TO PV-SQLCODE               06250000
062600             MOVE 11                  TO PV-ERROR-NBR             06260000
062700                                         DL010-ERROR-NBR          06270000
062800             PERFORM 9903-WRITE-CICS-LOG                          06280000
062900             PERFORM 9000-SOFT-ABORT                              06290000
063000             PERFORM 8210-XCTL-ERROR-SCREEN                       06300000
063100         WHEN SQLWARN0 NOT = SPACES                               06310000
063200         WHEN SQLCODE  NOT = ZERO                                 06320000
063300             MOVE 12                  TO PV-ERROR-NBR             06330000
063400                                         DL010-ERROR-NBR          06340000
063500             PERFORM 9903-WRITE-CICS-LOG                          06350000
063600             MOVE '7515-OPEN-ACT-TEM-ASGMT-CSR'                   06360000
063700                                      TO DL010-PARAGRAPH          06370000
063800             MOVE 'DLKRF457 - OPEN ACTV ASGMT CURSOR'             06380000
063900                                      TO DL010-MESSAGE-TEXT(1)    06390000
064000             MOVE 'CURSOR: ACT-TEM-ASGMT-CSR'                     06400000
064100                                      TO DL010-MESSAGE-TEXT(2)    06410000
064200             MOVE SQLCA               TO DL010-SQLCA              06420000
064300             MOVE 'DLT_ASGMT'         TO DL010-DB2-TABLE-NAME(1)  06430000
064400             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(2)  06440000
064500             SET DL010-ABEND          TO TRUE                     06450000
064600             MOVE 3                   TO DL010-PGM-MSG-NBR        06460000
064700             PERFORM 8210-XCTL-ERROR-SCREEN                       06470000
064800     END-EVALUATE.                                                06480000
064900                                                                  06490000
065000******************************************************************06500000
065100 7530-FETCH-ACT-TEM-ASGMT-CSR.                                    06510000
065200******************************************************************06520000
065300                                                                  06530000
065400     MOVE SPACES TO PV-USER-ID-KOHL-TEMP-IND.                     06540000
065500                                                                  06550000
065600     EXEC SQL                                                     06560000
065700          FETCH ACT-TEM-ASGMT-CSR                                 06570000
065800           INTO :DLT00004-ASGMT-STRT-DTE                          06580000
065900              , :DLT00004-ASGMT-NBR-TXT                           06590000
066000              , :DLT00004-ASGMT-NBR-SEQ-NBR                       06600000
066100              , :DLT00003-TEM-ASGMT-SEQ-NBR                       06610000
066200              , :PV-USER-ID-KOHL-TEMP-IND                         06620000
066300              , :DLT00003-KOHLS-USR-ID  :DN-KOHLS-USR-NULL-IND    06630000
066400              , :DLT00003-TMP-USR-ID    :DN-TEMP-USR-NULL-IND     06640000
066500     END-EXEC.                                                    06650000
066600                                                                  06660000
066700     EVALUATE TRUE                                                06670000
066800         WHEN SQLCODE = ZERO                                      06680000
066900            ADD +1                    TO PV-ACTV-TEM-ASGMT-COUNT  06690000
067000            PERFORM 7560-PROCESS-CLOSE-ASSIGNMENTS                06700000
067100         WHEN SQLCODE = +100                                      06710000
067200             SET PS-EOC-ACT-TEM-ASGMT-CSR TO TRUE                 06720000
067300         WHEN SQLCODE = -904                                      06730000
067400         WHEN SQLCODE = -913                                      06740000
067500         WHEN SQLCODE = -911                                      06750000
067600             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           06760000
067700             MOVE SQLCODE             TO PV-SQLCODE               06770000
067800             MOVE 13                  TO PV-ERROR-NBR             06780000
067900                                         DL010-ERROR-NBR          06790000
068000             PERFORM 9903-WRITE-CICS-LOG                          06800000
068100             PERFORM 9000-SOFT-ABORT                              06810000
068200             PERFORM 8210-XCTL-ERROR-SCREEN                       06820000
068300         WHEN SQLWARN0 NOT = SPACES                               06830000
068400         WHEN SQLCODE  NOT = ZERO                                 06840000
068500             MOVE 14                  TO PV-ERROR-NBR             06850000
068600                                         DL010-ERROR-NBR          06860000
068700             PERFORM 9903-WRITE-CICS-LOG                          06870000
068800             MOVE '7530-FETCH-ACT-TEM-ASGMT-CSR'                  06880000
068900                                      TO DL010-PARAGRAPH          06890000
069000             MOVE 'DLKRF457 - FETCH ACTV ASGMT CURSOR'            06900000
069100                                      TO DL010-MESSAGE-TEXT(1)    06910000
069110             MOVE 'CURSOR: ACT-TEM-ASGMT-CSR'                     06911000
069120                                      TO DL010-MESSAGE-TEXT(2)    06912000
069130             MOVE SQLCA               TO DL010-SQLCA              06913000
069140             MOVE 'DLT_ASGMT'         TO DL010-DB2-TABLE-NAME(1)  06914000
069150             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(2)  06915000
069160             SET DL010-ABEND          TO TRUE                     06916000
069170             MOVE 3                   TO DL010-PGM-MSG-NBR        06917000
069180             PERFORM 8210-XCTL-ERROR-SCREEN                       06918000
069181     END-EVALUATE.                                                06918100
069182                                                                  06918200
069183******************************************************************06918300
069184 7550-CLOSE-ACT-TEM-ASGMT-CSR.                                    06918400
069185******************************************************************06918500
069186                                                                  06918600
069187     EXEC SQL                                                     06918700
069188          CLOSE ACT-TEM-ASGMT-CSR                                 06918800
069189     END-EXEC.                                                    06918900
069190                                                                  06919000
069200     EVALUATE TRUE                                                06920000
069210         WHEN SQLCODE = ZERO                                      06921000
069220             CONTINUE                                             06922000
069221         WHEN SQLCODE = -904                                      06922100
069222         WHEN SQLCODE = -913                                      06922200
069223         WHEN SQLCODE = -911                                      06922300
069224             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           06922400
069225             MOVE SQLCODE             TO PV-SQLCODE               06922500
069226             MOVE 15                  TO PV-ERROR-NBR             06922600
069227                                         DL010-ERROR-NBR          06922700
069228             PERFORM 9903-WRITE-CICS-LOG                          06922800
069229             PERFORM 9000-SOFT-ABORT                              06922900
069230             PERFORM 8210-XCTL-ERROR-SCREEN                       06923000
069231         WHEN SQLWARN0 NOT = SPACES                               06923100
069232         WHEN SQLCODE  NOT = ZERO                                 06923200
069233             MOVE 16                  TO PV-ERROR-NBR             06923300
069234                                         DL010-ERROR-NBR          06923400
069235             PERFORM 9903-WRITE-CICS-LOG                          06923500
069236             MOVE '7550-CLOSE-ACT-TEM-ASGMT-CSR'                  06923600
069237                                      TO DL010-PARAGRAPH          06923700
069238             MOVE 'DLKRF457 - CLOSE ACTV ASGMT CURSOR'            06923800
069239                                      TO DL010-MESSAGE-TEXT(1)    06923900
069240             MOVE 'CURSOR: ACT-TEM-ASGMT-CSR'                     06924000
069241                                      TO DL010-MESSAGE-TEXT(2)    06924100
069242             MOVE SQLCA               TO DL010-SQLCA              06924200
069243             MOVE 'DLT_ASGMT'         TO DL010-DB2-TABLE-NAME(1)  06924300
069244             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(2)  06924400
069245             SET DL010-ABEND          TO TRUE                     06924500
069246             MOVE 3                   TO DL010-PGM-MSG-NBR        06924600
069247             PERFORM 8210-XCTL-ERROR-SCREEN                       06924700
069248     END-EVALUATE.                                                06924800
069249                                                                  06924900
069250******************************************************************06925000
069260 7560-PROCESS-CLOSE-ASSIGNMENTS.                                  06926000
069270******************************************************************06927000
069280                                                                  06928000
069290     INITIALIZE DL005-ASGMT-COMMAREA                              06929000
069291     SET DL005-BY-ASGMT-NBR                                       06929100
069292         DL005-END-FROM-ASGMT                                     06929200
069293         DL005-DO-NOT-COMMIT-UPDATE   TO TRUE                     06929300
069294                                                                  06929400
069295     MOVE DLT00004-ASGMT-STRT-DTE     TO DL005-KEY-START-DTE      06929500
069296     MOVE DLT00004-ASGMT-NBR-TXT      TO DL005-KEY-NBR-TXT        06929600
069297     MOVE DLT00004-ASGMT-NBR-SEQ-NBR  TO DL005-KEY-NBR-SEQ-NBR    06929700
069298                                         PV-KEY-NBR-SEQ-NBR       06929800
069299     MOVE DLT00003-TEM-ASGMT-SEQ-NBR  TO                          06929900
069300                                      DL005-KEY-TEM-ASGMT-SEQ-NBR 06930000
069301     MOVE PV-USER-ID-KOHL-TEMP-IND    TO DL005-KEY-USR-TYPE-CDE   06930100
069302     IF   DL005-KEY-USR-IS-KOHLS                                  06930200
069303          MOVE DLT00003-KOHLS-USR-ID  TO DL005-KEY-USER-ID        06930300
069304                                         DL005-KEY-ADD-BY-USER-ID 06930400
069305     ELSE                                                         06930500
069306          MOVE DLT00003-TMP-USR-ID    TO DL005-KEY-USER-ID        06930600
069307                                         DL005-KEY-ADD-BY-USER-ID 06930700
069308     END-IF                                                       06930800
069309     MOVE PC-CURRENT-PROGRAM-NAME     TO DL005-ORIG-CALLING-PGM-NM06930900
069310                                         DL005-KEY-LVE-PGM-NM     06931000
069320     SET DL005-KEY-LVE-RSN-SSTOP      TO TRUE                     06932000
069321                                                                  06932100
069322     PERFORM 8620-CALL-DLKUP002.                                  06932200
069323     IF PS-PROCESS-ERROR-NO                                       06932300
069324        PERFORM 8410-CALL-XLKUP033                                06932400
069325     END-IF.                                                      06932500
069326/                                                                 06932600
069327******************************************************************06932700
069328 7600-PROCESS-ACTV-ASGMT.                                         06932800
069329******************************************************************06932900
069330                                                                  06933000
069331     MOVE +0                       TO PV-ACTV-ASGMT-COUNT.        06933100
069332     SET  PS-PROCESS-ERROR-NO                                     06933200
069333          PS-NOT-EOC-ACT-ASGMT-CSR TO TRUE.                       06933300
069334     MOVE DL010-OPER-UNT-ID        TO DK-DC-NBR                   06933400
069335     PERFORM 7615-OPEN-ACT-ASGMT-CSR                              06933500
069336     PERFORM 7630-FETCH-ACT-ASGMT-CSR                             06933600
069337             UNTIL PS-EOC-ACT-ASGMT-CSR                           06933700
069338                OR PS-PROCESS-ERROR                               06933800
069339     PERFORM 7650-CLOSE-ACT-ASGMT-CSR.                            06933900
069340                                                                  06934000
069341******************************************************************06934100
069342 7615-OPEN-ACT-ASGMT-CSR.                                         06934200
069343******************************************************************06934300
069344                                                                  06934400
069345     EXEC SQL                                                     06934500
069346          OPEN ACT-ASGMT-CSR                                      06934600
069347     END-EXEC.                                                    06934700
069348                                                                  06934800
069349     EVALUATE TRUE                                                06934900
069350         WHEN SQLCODE = ZERO                                      06935000
069351             CONTINUE                                             06935100
069352         WHEN SQLCODE = -904                                      06935200
069353         WHEN SQLCODE = -913                                      06935300
069354         WHEN SQLCODE = -911                                      06935400
069355             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           06935500
069356             MOVE SQLCODE             TO PV-SQLCODE               06935600
069357             MOVE 19                  TO PV-ERROR-NBR             06935700
069358                                         DL010-ERROR-NBR          06935800
069359             PERFORM 9903-WRITE-CICS-LOG                          06935900
069360             PERFORM 9000-SOFT-ABORT                              06936000
069361             PERFORM 8210-XCTL-ERROR-SCREEN                       06936100
069362         WHEN SQLWARN0 NOT = SPACES                               06936200
069363         WHEN SQLCODE  NOT = ZERO                                 06936300
069364             MOVE 20                  TO PV-ERROR-NBR             06936400
069365                                         DL010-ERROR-NBR          06936500
069366             PERFORM 9903-WRITE-CICS-LOG                          06936600
069367             MOVE '7615-OPEN-ACT-ASGMT-CSR'                       06936700
069368                                      TO DL010-PARAGRAPH          06936800
069369             MOVE 'DLKRF457 - OPEN ACTV ASGMT CURSOR'             06936900
069370                                      TO DL010-MESSAGE-TEXT(1)    06937000
069371             MOVE 'CURSOR: ACT-ASGMT-CSR'                         06937100
069372                                      TO DL010-MESSAGE-TEXT(2)    06937200
069373             MOVE SQLCA               TO DL010-SQLCA              06937300
069374             MOVE 'DLT_ASGMT'         TO DL010-DB2-TABLE-NAME(1)  06937400
069375             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(2)  06937500
069376             SET DL010-ABEND          TO TRUE                     06937600
069377             MOVE 3                   TO DL010-PGM-MSG-NBR        06937700
069378             PERFORM 8210-XCTL-ERROR-SCREEN                       06937800
069379     END-EVALUATE.                                                06937900
069380                                                                  06938000
069390******************************************************************06939000
069400 7630-FETCH-ACT-ASGMT-CSR.                                        06940000
069410******************************************************************06941000
069420                                                                  06942000
069421     EXEC SQL                                                     06942100
069422          FETCH ACT-ASGMT-CSR                                     06942200
069423           INTO :DLT00004-ASGMT-STRT-DTE                          06942300
069424              , :DLT00004-ASGMT-NBR-TXT                           06942400
069425              , :DLT00004-ASGMT-NBR-SEQ-NBR                       06942500
069426     END-EXEC.                                                    06942600
069427                                                                  06942700
069428     EVALUATE TRUE                                                06942800
069429         WHEN SQLCODE = ZERO                                      06942900
069430             ADD +1                   TO PV-ACTV-ASGMT-COUNT      06943000
069431             PERFORM 7660-CLOSE-ASSIGNMENT                        06943100
069432         WHEN SQLCODE = +100                                      06943200
069433             SET PS-EOC-ACT-ASGMT-CSR TO TRUE                     06943300
069434         WHEN SQLCODE = -904                                      06943400
069435         WHEN SQLCODE = -913                                      06943500
069436         WHEN SQLCODE = -911                                      06943600
069437             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           06943700
069438             MOVE SQLCODE             TO PV-SQLCODE               06943800
069439             MOVE 21                  TO PV-ERROR-NBR             06943900
069440                                         DL010-ERROR-NBR          06944000
069441             PERFORM 9903-WRITE-CICS-LOG                          06944100
069442             PERFORM 9000-SOFT-ABORT                              06944200
069443             PERFORM 8210-XCTL-ERROR-SCREEN                       06944300
069444         WHEN SQLWARN0 NOT = SPACES                               06944400
069445         WHEN SQLCODE  NOT = ZERO                                 06944500
069446             MOVE 22                  TO PV-ERROR-NBR             06944600
069447                                         DL010-ERROR-NBR          06944700
069448             PERFORM 9903-WRITE-CICS-LOG                          06944800
069449             MOVE '7630-OPEN-ACT-ASGMT-CSR'                       06944900
069450                                      TO DL010-PARAGRAPH          06945000
069451             MOVE 'DLKRF457 - FETCH ACTV ASGMT CURSOR'            06945100
069452                                      TO DL010-MESSAGE-TEXT(1)    06945200
069453             MOVE 'CURSOR: ACT-ASGMT-CSR'                         06945300
069454                                      TO DL010-MESSAGE-TEXT(2)    06945400
069455             MOVE SQLCA               TO DL010-SQLCA              06945500
069456             MOVE 'DLT_ASGMT'         TO DL010-DB2-TABLE-NAME(1)  06945600
069457             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(2)  06945700
069458             SET DL010-ABEND          TO TRUE                     06945800
069459             MOVE 3                   TO DL010-PGM-MSG-NBR        06945900
069460             PERFORM 8210-XCTL-ERROR-SCREEN                       06946000
069470     END-EVALUATE.                                                06947000
069480                                                                  06948000
069490******************************************************************06949000
069491 7650-CLOSE-ACT-ASGMT-CSR.                                        06949100
069492******************************************************************06949200
069493                                                                  06949300
069494     EXEC SQL                                                     06949400
069495          CLOSE ACT-ASGMT-CSR                                     06949500
069496     END-EXEC.                                                    06949600
069497                                                                  06949700
069498     EVALUATE TRUE                                                06949800
069499         WHEN SQLCODE = ZERO                                      06949900
069500             CONTINUE                                             06950000
069501         WHEN SQLCODE = -904                                      06950100
069502         WHEN SQLCODE = -913                                      06950200
069503         WHEN SQLCODE = -911                                      06950300
069504             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           06950400
069505             MOVE SQLCODE             TO PV-SQLCODE               06950500
069506             MOVE 23                  TO PV-ERROR-NBR             06950600
069507                                         DL010-ERROR-NBR          06950700
069508             PERFORM 9903-WRITE-CICS-LOG                          06950800
069509             PERFORM 9000-SOFT-ABORT                              06950900
069510             PERFORM 8210-XCTL-ERROR-SCREEN                       06951000
069511         WHEN SQLWARN0 NOT = SPACES                               06951100
069512         WHEN SQLCODE  NOT = ZERO                                 06951200
069513             MOVE 24                  TO PV-ERROR-NBR             06951300
069514                                         DL010-ERROR-NBR          06951400
069515             PERFORM 9903-WRITE-CICS-LOG                          06951500
069516             MOVE '7630-OPEN-ACT-ASGMT-CSR'                       06951600
069517                                      TO DL010-PARAGRAPH          06951700
069518             MOVE 'DLKRF457 - CLOSE ACTV ASGMT CURSOR'            06951800
069519                                      TO DL010-MESSAGE-TEXT(1)    06951900
069520             MOVE 'CURSOR: ACT-ASGMT-CSR'                         06952000
069521                                      TO DL010-MESSAGE-TEXT(2)    06952100
069522             MOVE SQLCA               TO DL010-SQLCA              06952200
069523             MOVE 'DLT_ASGMT'         TO DL010-DB2-TABLE-NAME(1)  06952300
069524             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(2)  06952400
069525             SET DL010-ABEND          TO TRUE                     06952500
069526             MOVE 3                   TO DL010-PGM-MSG-NBR        06952600
069527             PERFORM 8210-XCTL-ERROR-SCREEN                       06952700
069528     END-EVALUATE.                                                06952800
069529                                                                  06952900
069530******************************************************************06953000
069540 7660-CLOSE-ASSIGNMENT.                                           06954000
069550******************************************************************06955000
069560                                                                  06956000
069570     SET DL005-KEY-LVE-RSN-SSTOP  TO TRUE                         06957000
069571                                                                  06957100
069572     PERFORM                                                      06957200
069573         WITH TEST AFTER                                          06957300
069574         VARYING PV-RETRY-COUNTER                                 06957400
069575         FROM 1 BY 1                                              06957500
069576         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  06957600
069577            OR SQLCODE = ZERO                                     06957700
069578                                                                  06957800
069579         EXEC SQL                                                 06957900
069580             UPDATE DLT_ASGMT                                     06958000
069581                SET ASGMT_STP_TMST    = CURRENT TIMESTAMP         06958100
069582                   ,ASGMT_STP_RSN_CDE = :DL005-KEY-LVE-RSN-CDE    06958200
069583                   ,STP_BY_PGM_NM     = :PC-CURRENT-PROGRAM-NAME  06958300
069584                                                                  06958400
069585            WHERE  ASGMT_STRT_DTE    = :DLT00004-ASGMT-STRT-DTE   06958500
069586              AND  ASGMT_NBR_TXT     = :DLT00004-ASGMT-NBR-TXT    06958600
069587              AND  ASGMT_NBR_SEQ_NBR = :DLT00004-ASGMT-NBR-SEQ-NBR06958700
069588              AND  ASGMT_STP_RSN_CDE = 'N'                        06958800
069589         END-EXEC                                                 06958900
069590                                                                  06959000
069591         EVALUATE TRUE                                            06959100
069592             WHEN SQLCODE = ZERO                                  06959200
069593             WHEN SQLCODE = -904                                  06959300
069594             WHEN SQLCODE = -911                                  06959400
069595             WHEN SQLCODE = -913                                  06959500
069596                 CONTINUE                                         06959600
069597             WHEN SQLWARN0 NOT = SPACE                            06959700
069598             WHEN SQLCODE  NOT = ZERO                             06959800
069599                  MOVE 4           TO PV-RETRY-COUNTER            06959900
069600                  MOVE PC-CURRENT-PROGRAM-NAME                    06960000
069601                                   TO DP013-PROGRAM               06960100
069602                  MOVE '7660-CLOSE-ASSIGNMENT'                    06960200
069603                                   TO DP013-PARAGRAPH             06960300
069604                  MOVE 'DB2 ERROR TRYING TO CLOSE ASSIGNMENT'     06960400
069605                                   TO DP013-MESSAGE-TEXT (1)      06960500
069606                  MOVE SQLCA       TO DP013-SQLCA                 06960600
069607                  MOVE 'DLT_ASGMT' TO DP013-DB2-TABLE-NAME (1)    06960700
069608                  SET DP013-DB2-ABEND                             06960800
069609                      DP013-XCTL-DISPLAY-RESTART                  06960900
069610                                   TO TRUE                        06961000
069611                  PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG          06961100
069612         END-EVALUATE                                             06961200
069613     END-PERFORM.                                                 06961300
069614                                                                  06961400
069615     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         06961500
069616         MOVE PC-CURRENT-PROGRAM-NAME                             06961600
069617                                   TO DP013-PROGRAM               06961700
069618         MOVE '7660-CLOSE-ASSIGNMENT'                             06961800
069619                                   TO DP013-PARAGRAPH             06961900
069620         MOVE 'DB2 CONTENTION TRYING TO CLOSE ASSIGNMENT'         06962000
069621                                   TO DP013-MESSAGE-TEXT (1)      06962100
069622         MOVE SQLCA                TO DP013-SQLCA                 06962200
069623         MOVE 'DLT_ASGMT'          TO DP013-DB2-TABLE-NAME (1)    06962300
069624         SET DP013-DB2-ABEND                                      06962400
069625             DP013-XCTL-DISPLAY-RESTART                           06962500
069626                                   TO TRUE                        06962600
069627         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   06962700
069628     END-IF.                                                      06962800
069629                                                                  06962900
069630******************************************************************06963000
069631 8000-SEND-MAP.                                                   06963100
069632******************************************************************06963200
069633                                                                  06963300
069634     EXEC CICS                                                    06963400
069635         SEND MAP       ('DL457A')                                06963500
069636              MAPSET    ('DLKM457')                               06963600
069637              ERASE                                               06963700
069638              RESP      (PV-CICS-RESPONSE)                        06963800
069639     END-EXEC.                                                    06963900
069640                                                                  06964000
069650     EVALUATE TRUE                                                06965000
069660         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06966000
069670             CONTINUE                                             06967000
069680         WHEN OTHER                                               06968000
069690             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH          06969000
069700             MOVE 'DLKRF457 - UNABLE TO SEND MAP'                 06970000
069800                                      TO DP013-MESSAGE-TEXT (1)   06980000
069900             SET DP013-CICS-ABEND                                 06990000
070000                 DP013-ROLLBACK       TO TRUE                     07000000
070100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07010000
070200     END-EVALUATE.                                                07020000
070300                                                                  07030000
072900******************************************************************07290000
073000 8020-RECEIVE-MAP.                                                07300000
073100******************************************************************07310000
073200                                                                  07320000
073300     EXEC CICS                                                    07330000
073400         RECEIVE MAP    ('DL457A')                                07340000
073500                 MAPSET ('DLKM457')                               07350000
073600                 RESP   (PV-CICS-RESPONSE)                        07360000
073700     END-EXEC.                                                    07370000
073800                                                                  07380000
073900     EVALUATE TRUE                                                07390000
074000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07400000
074100             CONTINUE                                             07410000
074200         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                07420000
074300             CONTINUE                                             07430000
074400         WHEN OTHER                                               07440000
074500            MOVE '8020-RECEIVE-MAP'      TO DP013-PARAGRAPH       07450000
074600            MOVE 'DLKRF457 - UNABLE TO RECEIVE MAP'               07460000
074700                                         TO DP013-MESSAGE-TEXT (1)07470000
074800            SET DP013-LOGIC-ABEND        TO TRUE                  07480000
074900            SET DP013-ROLLBACK           TO TRUE                  07490000
075000            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                07500000
075100     END-EVALUATE.                                                07510000
075200                                                                  07520000
075300******************************************************************07530000
075400 8100-RETURN-TRANID.                                              07540000
075500******************************************************************07550000
075600                                                                  07560000
075700     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH       07570000
075800     EXEC CICS                                                    07580000
075900         RETURN TRANSID  (PC-TRANID)                              07590000
076000                COMMAREA (DL010-COMMAREA)                         07600000
076100                LENGTH   (PV-COMMAREA-LENGTH)                     07610000
076200                RESP     (PV-CICS-RESPONSE)                       07620000
076300     END-EXEC.                                                    07630000
076400                                                                  07640000
076500     EVALUATE TRUE                                                07650000
076600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07660000
076700             CONTINUE                                             07670000
076800         WHEN OTHER                                               07680000
076900             MOVE '8100-RETURN-TRANIND' TO DP013-PARAGRAPH        07690000
077000             MOVE 'DLKRF457 - UNABLE TO RETURN TO TRANID'         07700000
077100                 TO DP013-MESSAGE-TEXT (1)                        07710000
077200             SET DP013-CICS-ABEND       TO TRUE                   07720000
077300             SET DP013-ROLLBACK         TO TRUE                   07730000
077400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07740000
077500     END-EVALUATE.                                                07750000
077600                                                                  07760000
077700******************************************************************07770000
077800 8110-RETURN.                                                     07780000
077900******************************************************************07790000
078000                                                                  07800000
078100     EXEC CICS                                                    07810000
078200         SEND FROM (PV-MESSAGE-AREA)                              07820000
078300              LENGTH (19)                                         07830000
078400              ERASE                                               07840000
078500     END-EXEC.                                                    07850000
078600                                                                  07860000
078700     EXEC CICS                                                    07870000
078800         RETURN                                                   07880000
078900     END-EXEC.                                                    07890000
079000                                                                  07900000
079010******************************************************************07901000
079020 8200-XCTL.                                                       07902000
079030******************************************************************07903000
079040     SET DL010-INITIALIZE-SCREEN      TO TRUE.                    07904000
079050     MOVE PC-CURRENT-PROGRAM-NAME     TO DL010-LAST-PROGRAM       07905000
079060     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH       07906000
079070                                                                  07907000
079080     EXEC CICS                                                    07908000
079090         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    07909000
079100               COMMAREA  (DL010-COMMAREA)                         07910000
079200               LENGTH    (PV-COMMAREA-LENGTH)                     07920000
079300               RESP      (PV-CICS-RESPONSE)                       07930000
079400     END-EXEC.                                                    07940000
079500                                                                  07950000
079600     EVALUATE TRUE                                                07960000
079700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07970000
079800             CONTINUE                                             07980000
079900         WHEN OTHER                                               07990000
080000             MOVE '8200-XCTL'         TO DP013-PARAGRAPH          08000000
080100             MOVE 'DLKRF457 - UNABLE TO XCTL TO PROGRAM: '        08010000
080200                                      TO DP013-MESSAGE-TEXT (1)   08020000
080300             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   08030000
080400             SET DP013-CICS-ABEND                                 08040000
080500                 DP013-ROLLBACK       TO TRUE                     08050000
080600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08060000
080700             SET DL010-PROCESS-SCREEN TO TRUE                     08070000
080800             PERFORM 8000-SEND-MAP                                08080000
080900             PERFORM 8100-RETURN-TRANID                           08090000
081000     END-EVALUATE.                                                08100000
081100                                                                  08110000
081200******************************************************************08120000
081300 8210-XCTL-ERROR-SCREEN.                                          08130000
081400******************************************************************08140000
081500                                                                  08150000
081600     IF NOT DL010-ABEND                                           08160000
081700         SET DL010-INITIALIZE-SCREEN  TO TRUE                     08170000
081800     END-IF                                                       08180000
081900     MOVE DFHEIBLK                    TO DL010-DFHEIBLK.          08190000
082000     MOVE PC-CURRENT-PROGRAM-NAME     TO DL010-LAST-PROGRAM.      08200000
082100     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH       08210000
082200     MOVE 'DLKRF456'                  TO PV-TRANSFER-PROGRAM      08220000
082300     IF DL010-PGM-MSG-NBR = ZERO                                  08230000
082400         MOVE 1                       TO DL010-PGM-MSG-NBR        08240000
082500     END-IF                                                       08250000
082600                                                                  08260000
082700     EXEC CICS                                                    08270000
082800         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    08280000
082900               COMMAREA  (DL010-COMMAREA)                         08290000
083000               LENGTH    (PV-COMMAREA-LENGTH)                     08300000
083100               RESP      (PV-CICS-RESPONSE)                       08310000
083200     END-EXEC.                                                    08320000
083300                                                                  08330000
083400     EVALUATE TRUE                                                08340000
083500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08350000
083600             CONTINUE                                             08360000
083700         WHEN OTHER                                               08370000
083800             MOVE '8200-XCTL'                                     08380000
083900                                      TO DP013-PARAGRAPH          08390000
084000             MOVE 'DLKRF457 - UNABLE TO XCTL TO PROGRAM: '        08400000
084100                                      TO DP013-MESSAGE-TEXT (1)   08410000
084200             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   08420000
084300             SET DP013-CICS-ABEND                                 08430000
084400                 DP013-ROLLBACK       TO TRUE                     08440000
084500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08450000
084600             SET DL010-PROCESS-SCREEN TO TRUE                     08460000
084700             PERFORM 8000-SEND-MAP                                08470000
084800             PERFORM 8100-RETURN-TRANID                           08480000
084900     END-EVALUATE.                                                08490000
085000                                                                  08500000
085100******************************************************************08510000
085200 8220-XCTL-TO-HELP.                                               08520000
085300******************************************************************08530000
085400                                                                  08540000
085500     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       08550000
085600                                                                  08560000
085700     EXEC CICS                                                    08570000
085800         XCTL                                                     08580000
085900             PROGRAM   (PV-TRANSFER-PROGRAM)                      08590000
086000             COMMAREA  (PC192-COMMAREA)                           08600000
086100             LENGTH    (PV-COMMAREA-LENGTH)                       08610000
086200             RESP      (PV-CICS-RESPONSE)                         08620000
086300     END-EXEC.                                                    08630000
086400                                                                  08640000
086500     EVALUATE TRUE                                                08650000
086600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08660000
086700              CONTINUE                                            08670000
086800         WHEN OTHER                                               08680000
086900             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          08690000
087000             MOVE 'DLKRF457 - UNABLE TO XCTL TO PROGRAM: '        08700000
087100                                      TO DP013-MESSAGE-TEXT (1)   08710000
087200             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   08720000
087300             SET DP013-CICS-ABEND                                 08730000
087400                 DP013-ROLLBACK       TO TRUE                     08740000
087500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08750000
087600             SET DL010-PROCESS-SCREEN TO TRUE                     08760000
087700             PERFORM 8000-SEND-MAP                                08770000
087800             PERFORM 8100-RETURN-TRANID                           08780000
087900     END-EVALUATE.                                                08790000
088000                                                                  08800000
088100******************************************************************08810000
088200 8410-CALL-XLKUP033.                                              08820000
088300******************************************************************08830000
088400                                                                  08840000
088500     INITIALIZE XL072-EAI-EXPORT-COMMAREA                         08850000
088600                                                                  08860000
088700     SET XL072-PC-APP-ID          TO TRUE.                        08870000
088800     MOVE 'DC LABOR'              TO XL072-EVNT-OBJ-TXT           08880000
088900     MOVE 'INDIRECT LABOR'        TO XL072-EVNT-OBJ-ACTN-TXT      08890000
089000     MOVE DL005-KEY-ADD-BY-USER-ID                                08900000
089100                                  TO XL072-CRE-BY-USR-ID.         08910000
089200     MOVE 'DLKRF457'              TO XL072-CRE-PGM-NM.            08920000
089300     MOVE DL010-OPER-UNT-ID       TO XL072-EVNT-KY-1-NBR.         08930000
089400     MOVE 'N/A'                   TO XL072-DTL-COPYBOOK-NM.       08940000
089500     MOVE 'IDONE'                 TO XL072-EVNT-KY-1-TXT.         08950000
089600     SET XL072-COMMIT-UPDATE      TO TRUE.                        08960000
089700     MOVE 'DLKRF457'              TO XL072-ORIG-CALLING-PGM-NM.   08970000
089800                                                                  08980000
089900     EXEC SQL                                                     08990000
090000         SET :XL072-EVNT-KY-1-TMST = CURRENT TIMESTAMP            09000000
090100           , :PV-LABOR-CURRENT-TIMESTAMP =                        09010000
090200              CURRENT TIMESTAMP + 1 SECOND                        09020000
090300     END-EXEC                                                     09030000
090400                                                                  09040000
090500     CALL XL072-USER-PGM USING DFHEIBLK                           09050000
090600                               XL072-COMMAREA                     09060000
090700                               XL072-EAI-EXPORT-COMMAREA          09070000
090800                                                                  09080000
090900     EVALUATE TRUE                                                09090000
091000         WHEN XL072-SUCCESSFUL                                    09100000
091100             CONTINUE                                             09110000
091200         WHEN XL072-SQL-ERROR                                     09120000
091300             SET PS-PROCESS-ERROR     TO TRUE                     09130000
091400             MOVE 17                  TO PV-ERROR-NBR             09140000
091500                                         DL010-ERROR-NBR          09150000
091600             MOVE DL010-USERID        TO PV-LOG-USER-ID           09160000
091700             MOVE XL072-EAI-DB-SQLCODE TO PV-SQLCODE              09170000
091800             PERFORM 9903-WRITE-CICS-LOG                          09180000
091900             MOVE '8410-CALL-XLKUP033'                            09190000
092000                                      TO DL010-PARAGRAPH          09200000
092100             MOVE 'DLKRF457 - END ASSIGNMENT'                     09210000
092200                                      TO DL010-MESSAGE-TEXT(1)    09220000
092300             MOVE XL072-SQL-ERROR-PARA                            09230000
092400                                      TO DL010-MESSAGE-TEXT(2)    09240000
092500             MOVE XL072-SQLCA         TO DL010-SQLCA              09250000
092600             SET DL010-ABEND          TO TRUE                     09260000
092700             MOVE 3                   TO DL010-PGM-MSG-NBR        09270000
092800             PERFORM 8210-XCTL-ERROR-SCREEN                       09280000
092900         WHEN XL072-INVALID-ACCESS                                09290000
093000             MOVE '8410-CALL-XLKUP033' TO DP013-PARAGRAPH         09300000
093100             MOVE 'DLKRF457 - DB2 ERROR IN PROGRAM: '             09310000
093200                                      TO DP013-MESSAGE-TEXT (1)   09320000
093300             MOVE 'XLKUP033'          TO DP013-MESSAGE-TEXT (2)   09330000
093400             SET DP013-CICS-ABEND                                 09340000
093500                 DP013-ROLLBACK       TO TRUE                     09350000
093600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               09360000
093700             SET DL010-PROCESS-SCREEN TO TRUE                     09370000
093800             PERFORM 8000-SEND-MAP                                09380000
093900             PERFORM 8100-RETURN-TRANID                           09390000
094000         WHEN OTHER                                               09400000
094100             MOVE '8410-CALL-XLKUP033' TO DP013-PARAGRAPH         09410000
094200             MOVE 'DLKRF457 - UNDETERMINED ERROR IN PGM: '        09420000
094300                                      TO DP013-MESSAGE-TEXT (1)   09430000
094400             MOVE 'XLKUP033'          TO DP013-MESSAGE-TEXT (2)   09440000
094500             SET DP013-CICS-ABEND                                 09450000
094600                 DP013-ROLLBACK       TO TRUE                     09460000
094700             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               09470000
094800             SET DL010-PROCESS-SCREEN TO TRUE                     09480000
094900             PERFORM 8000-SEND-MAP                                09490000
095000             PERFORM 8100-RETURN-TRANID                           09500000
095100     END-EVALUATE.                                                09510000
095200                                                                  09520000
095300******************************************************************09530000
095400 8620-CALL-DLKUP002.                                              09540000
095500******************************************************************09550000
095600                                                                  09560000
095700     CALL DL005-USER-PGM USING DFHEIBLK                           09570000
095800                               DL005-COMMAREA                     09580000
095900                               DL005-ASGMT-COMMAREA               09590000
096000                                                                  09600000
096100     EVALUATE TRUE                                                09610000
096200         WHEN DL005-SUCCESSFUL                                    09620000
096300         WHEN DL005-ASGMT-NOT-ACTIVE                              09630000
096400             CONTINUE                                             09640000
096500         WHEN DL005-SQL-ERROR                                     09650000
096600             MOVE 18                  TO PV-ERROR-NBR             09660000
096700                                         DL010-ERROR-NBR          09670000
096800             MOVE DL010-USERID        TO PV-LOG-USER-ID           09680000
096900             MOVE DL005-ASGMT-SQLCODE TO PV-SQLCODE               09690000
097000             PERFORM 9903-WRITE-CICS-LOG                          09700000
097100             MOVE '8620-CALL-DLKUP002'                            09710000
097200                                      TO DL010-PARAGRAPH          09720000
097300             MOVE 'DLKRF457 - END ASSIGNMENT'                     09730000
097400                                      TO DL010-MESSAGE-TEXT(1)    09740000
097500             MOVE DL005-SQL-ERROR-PARA                            09750000
097600                                      TO DL010-MESSAGE-TEXT(2)    09760000
097700             MOVE DL005-SQLCA         TO DL010-SQLCA              09770000
097800             SET DL010-ABEND          TO TRUE                     09780000
097900             MOVE 3                   TO DL010-PGM-MSG-NBR        09790000
098000             PERFORM 8210-XCTL-ERROR-SCREEN                       09800000
098100         WHEN DL005-INVALID-ACCESS                                09810000
098200             MOVE '8620-CALL-DLKUP002' TO DP013-PARAGRAPH         09820000
098300             MOVE 'DLKRF457 - DB2 ERROR IN PROGRAM: '             09830000
098400                                      TO DP013-MESSAGE-TEXT (1)   09840000
098500             MOVE 'DLKUP002'          TO DP013-MESSAGE-TEXT (2)   09850000
098600             SET DP013-CICS-ABEND                                 09860000
098700                 DP013-ROLLBACK       TO TRUE                     09870000
098800             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               09880000
098900             SET DL010-PROCESS-SCREEN TO TRUE                     09890000
099000             PERFORM 8000-SEND-MAP                                09900000
099100             PERFORM 8100-RETURN-TRANID                           09910000
099200         WHEN OTHER                                               09920000
099300             MOVE '8620-CALL-DLKUP002' TO DP013-PARAGRAPH         09930000
099400             MOVE 'DLKRF457 - UNDETERMINED ERROR IN PGM: '        09940000
099500                                      TO DP013-MESSAGE-TEXT (1)   09950000
099600             MOVE DL005-ASGMT-SQLCODE TO PV-DISPLAY-SQLCODE       09960000
099700           MOVE DL005-KEY-NBR-SEQ-NBR TO PV-DISPLAY-ASGMT-NBR     09970000
099800           MOVE DL005-KEY-TEM-ASGMT-SEQ-NBR                       09980000
099900                                      TO PV-DISPLAY-TEM-ASGMT-NBR 09990000
100000             STRING 'DLKUP002 KEYS = ' DELIMITED BY SIZE          10000000
100100                DL005-KEYS             DELIMITED BY SIZE          10010000
100200                           INTO DP013-MESSAGE-TEXT(2)             10020000
100300             STRING '* NBR-SEQ      = ' DELIMITED BY SIZE         10030000
100400          PV-DISPLAY-ASGMT-NBR     DELIMITED BY SIZE              10040000
100500                    ' * TEM-SEQ       = ' DELIMITED BY SIZE       10050000
100600          PV-DISPLAY-TEM-ASGMT-NBR     DELIMITED BY SIZE          10060000
100700                           INTO DP013-MESSAGE-TEXT(3)             10070000
100800             SET DP013-CICS-ABEND                                 10080000
100900                 DP013-ROLLBACK       TO TRUE                     10090000
101000             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               10100000
101100             SET DL010-PROCESS-SCREEN TO TRUE                     10110000
101200             PERFORM 8000-SEND-MAP                                10120000
101300             PERFORM 8100-RETURN-TRANID                           10130000
101400     END-EVALUATE.                                                10140000
101500                                                                  10150000
101600******************************************************************10160000
101700 9000-SOFT-ABORT.                                                 10170000
101800******************************************************************10180000
101900                                                                  10190000
102000     EXEC CICS                                                    10200000
102100         SYNCPOINT ROLLBACK                                       10210000
102200     END-EXEC.                                                    10220000
102300                                                                  10230000
102400     MOVE 2                           TO DL010-PGM-MSG-NBR        10240000
102500     MOVE SQLCODE                     TO DL010-SQLCODE            10250000
102600     MOVE SQLCA                       TO DL010-SQLCA              10260000
102700     MOVE 'D457'                      TO DL010-TRAN-ID            10270000
102800     PERFORM 8210-XCTL-ERROR-SCREEN.                              10280000
102900                                                                  10290000
103000******************************************************************10300000
103100 9903-WRITE-CICS-LOG.                                             10310000
103200******************************************************************10320000
103300                                                                  10330000
103400     MOVE SQLCODE                     TO PV-SQLCODE               10340000
103500                                                                  10350000
103600     EXEC CICS                                                    10360000
103700         WRITEQ TD                                                10370000
103800             QUEUE  ('CSSL')                                      10380000
103900             FROM   (PV-ERR-MSG-LOG)                              10390000
104000             RESP   (PV-CICS-RESPONSE)                            10400000
104100     END-EXEC.                                                    10410000
104200                                                                  10420000
104300******************************************************************10430000
104400 9904-WRITE-SUMMARY-IN-CICS-LOG.                                  10440000
104500******************************************************************10450000
104600                                                                  10460000
104700     EXEC SQL                                                     10470000
104800        SET :PV-CURR-TMST = CURRENT TIMESTAMP                     10480000
104900     END-EXEC.                                                    10490000
105000                                                                  10500000
105100     MOVE PC-CURRENT-PROGRAM-NAME     TO PV-MSG-PROG-NAME         10510000
105200     MOVE DL010-USERID                TO PV-MSG-USER-ID           10520000
105300     MOVE PV-WST-GLBL-ISTOP-GRP       TO PV-MSG-GROUP-NAME        10530000
105400     MOVE PV-TOT-ACTV-ASGMT           TO PV-MSG-ISTOP-CNT         10540000
105500     MOVE DL010-OPER-UNT-ID           TO PV-MSG-DC-NBR            10550000
105600     MOVE PV-CURR-TMST(6:2)           TO PV-MSG-DTE-MM            10560000
105700     MOVE PV-CURR-TMST(9:2)           TO PV-MSG-DTE-DD            10570000
105800     MOVE PV-CURR-TMST(12:2)          TO PV-MSG-TME-HR            10580000
105900     MOVE PV-CURR-TMST(15:2)          TO PV-MSG-TME-MN            10590000
106000     MOVE PV-CURR-TMST(18:2)          TO PV-MSG-TME-SC            10600000
106100                                                                  10610000
106200     EXEC CICS                                                    10620000
106300         WRITEQ TD                                                10630000
106400             QUEUE  ('CSSL')                                      10640000
106500             FROM   (PV-MSG-LOG)                                  10650000
106600             RESP   (PV-CICS-RESPONSE)                            10660000
106700     END-EXEC.                                                    10670000
106800                                                                  10680000
106900******************************************************************10690000
107000 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  10700000
107100******************************************************************10710000
107200                                                                  10720000
107300     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           10730000
107400     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          10740000
107500     INITIALIZE DP013-SRC-TASK-NUMBER                             10750000
107600                DP013-STACK.                                      10760000
107700     SET DP013-LINK-RETURN            TO TRUE.                    10770000
107800                                                                  10780000
107900     EXEC CICS                                                    10790000
108000         LINK                                                     10800000
108100             PROGRAM   (DP013-NAME)                               10810000
108200             COMMAREA  (DP013-PARAMETERS)                         10820000
108300             LENGTH    (DP013-LENGTH)                             10830000
108400     END-EXEC.                                                    10840000
108500                                                                  10850000
