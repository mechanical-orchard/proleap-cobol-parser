000100 IDENTIFICATION DIVISION.                                         00010000
000200******************************************************************00020000
000300*                                                                *00030000
000400* BATCH VIRTUAL LABEL CALCULATION                                 00040000
000500*                                                                *00050000
000600******************************************************************00060000
000700                                                                  00070000
000800 PROGRAM-ID.    PCKUT719.                                         00080000
000900 AUTHOR.        GERMAN BANDA.                                     00090000
001000 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00100000
001100 DATE-WRITTEN   MARCH 2005.                                       00110000
001200 DATE-COMPILED.                                                   00120000
001300                                                                  00130000
001400 ENVIRONMENT DIVISION.                                            00140000
001500 CONFIGURATION SECTION.                                           00150000
001600 SOURCE-COMPUTER.        IBM-3090.                                00160000
001700 OBJECT-COMPUTER.        IBM-3090.                                00170000
001800                                                                  00180000
001900 DATA DIVISION.                                                   00190000
002000 WORKING-STORAGE SECTION.                                         00200000
002100                                                                  00210000
002200*----------------------------------------------------------------*00220000
002300*   PROGRAM SWITCHES                                             *00230000
002400*----------------------------------------------------------------*00240000
002500 01  PS-PROGRAM-SWITCHES.                                         00250000
002600                                                                  00260000
002700     05  PS-EOF-UCC128-SW             PIC X(01) VALUE 'N'.        00270000
002800         88  PS-NOT-EOF-UCC128-CSR              VALUE 'N'.        00280000
002900         88  PS-EOF-UCC128-CSR                  VALUE 'Y'.        00290000
003000     05  PS-EOF-EXPECT-SW             PIC X(01) VALUE 'N'.        00300000
003100         88  PS-NOT-EOF-EXPECT-CSR              VALUE 'N'.        00310000
003200         88  PS-EOF-EXPECT-CSR                  VALUE 'Y'.        00320000
003300     05  PS-EOF-PREPK-SW              PIC X(01) VALUE 'N'.        00330000
003400         88  PS-NOT-EOF-PREPK-CSR               VALUE 'N'.        00340000
003500         88  PS-EOF-PREPK-CSR                   VALUE 'Y'.        00350000
003600     05  PS-EOF-SHPSUM-SW             PIC X(01) VALUE 'N'.        00360000
003700         88  PS-NOT-EOF-SHPSUM-CSR              VALUE 'N'.        00370000
003800         88  PS-EOF-SHPSUM-CSR                  VALUE 'Y'.        00380000
003900     05  PS-ERROR-SW                  PIC X(01) VALUE 'N'.        00390000
004000         88  PS-NO-ERROR                        VALUE 'N'.        00400000
004100         88  PS-ERROR                           VALUE 'Y'.        00410000
004200     05  PS-UCC128-FCSE-MATCH-SW      PIC X(01) VALUE 'N'.        00420000
004300         88  PS-NOT-UCC128-FCSE-MATCH           VALUE 'N'.        00430000
004400         88  PS-UCC128-FCSE-MATCH               VALUE 'Y'.        00440000
004500     05  PS-UCC128-FCSE-PARTIAL-SW    PIC X(01) VALUE 'N'.        00450000
004600         88  PS-NOT-UCC128-FCSE-PARTIAL         VALUE 'N'.        00460000
004700         88  PS-UCC128-FCSE-PARTIAL             VALUE 'Y'.        00470000
004800     05  PS-CARTON-USE-SW             PIC X(01) VALUE ' '.        00480000
004900         88  PS-CARTON-USE-FCSE                 VALUE 'F'.        00490000
005000         88  PS-CARTON-USE-INPK                 VALUE 'I'.        00500000
005100     05  PS-CARTON-LABEL-SW           PIC X(01) VALUE ' '.        00510000
005200         88  PS-CARTON-LABEL-SML                VALUE 'S'.        00520000
005300         88  PS-CARTON-LABEL-P2L                VALUE 'P'.        00530000
005400     05  PS-CARTON-MASTER-SW          PIC X(01) VALUE 'Y'.        00540000
005500         88  PS-CARTON-MASTER-YES               VALUE 'Y'.        00550000
005600         88  PS-CARTON-MASTER-NO                VALUE 'N'.        00560000
005700     05  PS-INSERT-UPDATE-SW          PIC X(01) VALUE ' '.        00570000
005800         88  PS-DISTHD-INSERT                   VALUE 'I'.        00580000
005900         88  PS-DISTHD-UPDATE                   VALUE 'U'.        00590000
006000     05  PS-SAME-SUMMARY-SW           PIC X(01) VALUE ' '.        00600000
006100         88  PS-SAME-SUMMARY-YES                VALUE 'Y'.        00610000
006200         88  PS-SAME-SUMMARY-NO                 VALUE 'N'.        00620000
006300     05  PS-COMBO-LNE-IN-PREPK-SW     PIC X(01) VALUE ' '.        00630000
006400         88  PS-COMBO-LNE-IN-PREPK              VALUE 'Y'.        00640000
006500         88  PS-COMBO-LNE-IN-UNKNOWN            VALUE ' '.        00650000
006600     05  PS-COMBO-LNE-NOT-PREPK-SW     PIC X(01) VALUE ' '.       00660000
006700         88  PS-COMBO-LNE-NOT-PREPK              VALUE 'Y'.       00670000
006800         88  PS-COMBO-LNE-NOT-UNKNOWN            VALUE ' '.       00680000
006900     05  PS-COMBO-ENTRY-PREPK-SW      PIC X(01) VALUE ' '.        00690000
007000         88  PS-COMBO-ENTRY-PREPK               VALUE 'Y'.        00700000
007100         88  PS-COMBO-ENTRY-PREPK-UNK           VALUE ' '.        00710000
007200     05  PS-COMBO-ENTRY-NOT-PREPK-SW  PIC X(01) VALUE ' '.        00720000
007300         88  PS-COMBO-ENTRY-NOT-PREPK           VALUE 'N'.        00730000
007400         88  PS-COMBO-ENTRY-NOT-PREPK-UNK       VALUE ' '.        00740000
007500     05  PS-ENTRIES-PREPK-SW          PIC X(01) VALUE 'Y'.        00750000
007600         88  PS-ENTRIES-MIS-PREPK               VALUE 'N'.        00760000
007700         88  PS-ENTRIES-ALL-PREPK               VALUE 'Y'.        00770000
007800     05  PS-RATIO-MULT-SW             PIC X(01) VALUE 'N'.        00780000
007900         88  PS-SAME-RATIO-MULT                 VALUE 'N'.        00790000
008000         88  PS-DIFF-RATIO-MULT                 VALUE 'Y'.        00800000
008100     05  PS-RATIO-REMAINDER-SW        PIC X(01) VALUE 'N'.        00810000
008200         88  PS-NO-RATIO-REMAINDER-ERROR        VALUE 'N'.        00820000
008300         88  PS-RATIO-REMAINDER-ERROR           VALUE 'Y'.        00830000
008400     05  PS-PREPK-LINES-LEFT-SW       PIC X(01) VALUE 'Y'.        00840000
008500         88  PS-PREPK-LINES-LEFT                VALUE 'Y'.        00850000
008600         88  PS-NO-PREPK-LINES-LEFT             VALUE 'N'.        00860000
008700     05  PS-POG-DATA-FOUND-SW         PIC X(01) VALUE 'Y'.        00870000
008800         88  PS-POG-DATA-FOUND                  VALUE 'Y'.        00880000
008900         88  PS-NO-POG-DATA-FOUND               VALUE 'N'.        00890000
009000     05  PS-SEASET-DATA-FOUND-SW      PIC X(01) VALUE 'Y'.        00900000
009100         88  PS-SEASET-DATA-FOUND               VALUE 'Y'.        00910000
009200         88  PS-NO-SEASET-DATA-FOUND            VALUE 'N'.        00920000
009300     05  PS-EOF-DOOR-SEQ-CSR-SW       PIC X(01) VALUE 'N'.        00930000
009400         88  PS-NOT-EOF-DOOR-SEQ-CSR            VALUE 'N'.        00940000
009500         88  PS-EOF-DOOR-SEQ-CSR                VALUE 'Y'.        00950000
009510     05  PS-P2L-LABEL-DISPLAY-SW         PIC  X(01)  VALUE 'N'.   00951000
009520         88  PS-TRIP-ARRIVE-DATE-ON-LABEL            VALUE 'Y'.   00952000
009530         88  PS-P2L-MOD-ON-LABEL                     VALUE 'N'.   00953000
009600                                                                  00960000
009700*----------------------------------------------------------------*00970000
009800*   DB2 KEYS                                                     *00980000
009900*----------------------------------------------------------------*00990000
010000 01  DB2-KEYS.                                                    01000000
010100                                                                  01010000
010200     05  DK-OPER-UNT-ID               PIC S9(4) COMP VALUE ZERO.  01020000
010300     05  DK-STORE-NBR                 PIC S9(4) COMP VALUE ZEROES.01030000
010400     05  DK-PO-NBR                    PIC S9(9) COMP VALUE ZERO.  01040000
010500     05  DK-RCVR-SEQ-NBR              PIC S9(9) COMP VALUE ZERO.  01050000
010600     05  DK-ORD-LNE-NBR               PIC S9(9) COMP VALUE ZERO.  01060000
010700     05  DK-MOD-NBR                   PIC S9(4) COMP VALUE ZERO.  01070000
010800     05  DK-WORK-ORD-SEQ-NBR          PIC S9(4) COMP VALUE ZEROES.01080000
010900     05  DK-PREPK-ID                  PIC S9(4) COMP VALUE ZEROES.01090000
011000     05  DK-PREPK-LNE-NBR             PIC S9(9) COMP VALUE ZEROES.01100000
011100     05  DK-PREPK-RATIO-QTY           PIC S9(4) COMP VALUE ZEROES.01110000
011110     05  DK-STR-NBR                   PIC S9(4) COMP VALUE ZEROES.01111000
011120                                                                  01112000
011130*----------------------------------------------------------------*01113000
011140*   PROGRAM CONSTANTS                                            *01114000
011150*----------------------------------------------------------------*01115000
011160 01  PC-PROGRAM-CONSTANTS.                                        01116000
011170                                                                  01117000
011180     05  PC-DEFAULT-TIMESTAMP        PIC  X(26)  VALUE            01118000
011190                                     '9999-09-09-09.09.09.999999'.01119000
011200     05  PC-DEFAULT-DTE              PIC  X(10)  VALUE            01120000
011300                                                     '9999-09-09'.01130000
011400     05  PC-DEFAULT-TM               PIC  X(08)  VALUE '01.01.01'.01140000
011500                                                                  01150000
011600     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)  VALUE 'PCKUT719'.01160000
011700                                                                  01170000
011800     05  PC-MANIFEST-NBR-MODULE      PIC  X(08)  VALUE 'PCKCS721'.01180000
011900                                                                  01190000
012000***  05  PC-MAX-UCC128-TBL-ENTRY     PIC S9(04)  VALUE  +5000     01200004
012010     05  PC-MAX-UCC128-TBL-ENTRY     PIC S9(05)  VALUE  +9999     01201006
012100                                                 COMP SYNC.       01210000
012200     05  PC-MAX-EXPTED-TBL-ENTRY     PIC S9(04)  VALUE  +1500     01220000
012300                                                 COMP SYNC.       01230000
012400***  05  PC-MAX-CARTON-TBL-ENTRY     PIC S9(04)  VALUE  +5000     01240004
012410     05  PC-MAX-CARTON-TBL-ENTRY     PIC S9(05)  VALUE  +9999     01241006
012500                                                 COMP SYNC.       01250000
012600     05  PC-MAX-PREPK-LINE-ENTRY     PIC S9(04)  VALUE  +50       01260000
012700                                                 COMP SYNC.       01270000
012800***  05  PC-MAX-BEST-CASE-ENTRY      PIC S9(04)  VALUE  +5000     01280004
012810     05  PC-MAX-BEST-CASE-ENTRY      PIC S9(05)  VALUE  +9999     01281006
012900                                                 COMP SYNC.       01290000
013000     05  PC-A                        PIC  X(01)  VALUE  'A'.      01300000
013100     05  PC-C                        PIC  X(01)  VALUE  'C'.      01310000
013200     05  PC-E                        PIC  X(01)  VALUE  'E'.      01320000
013300     05  PC-F                        PIC  X(01)  VALUE  'F'.      01330000
013400     05  PC-I                        PIC  X(01)  VALUE  'I'.      01340000
013500     05  PC-M                        PIC  X(01)  VALUE  'M'.      01350000
013600     05  PC-N                        PIC  X(01)  VALUE  'N'.      01360000
013700     05  PC-P                        PIC  X(01)  VALUE  'P'.      01370000
013800     05  PC-S                        PIC  X(01)  VALUE  'S'.      01380000
013900     05  PC-U                        PIC  X(01)  VALUE  'U'.      01390000
014000                                                                  01400000
014100     05  PC-0001                     PIC  9(04)  VALUE  0001.     01410000
014200     05  PC-DOWNLOADED-STATUS        PIC  X(01)  VALUE  'D'.      01420000
014300     05  PC-READY-TO-POST-STATUS     PIC  X(01)  VALUE  'N'.      01430000
014400     05  PC-P2L-PROCESSOR            PIC  X(04)  VALUE  'P2L '.   01440000
014500     05  PC-PREPK-P2L-DWNLD          PIC  X(01)  VALUE  'D'.      01450000
014600     05  PC-PREPK-NOT-DWNLD          PIC  X(01)  VALUE  'P'.      01460000
014700     05  PC-NON-PREPK                PIC  X(01)  VALUE  'N'.      01470000
014800                                                                  01480000
014900*----------------------------------------------------------------*01490000
015000*   PROGRAM VARIABLES                                            *01500000
015100*----------------------------------------------------------------*01510000
015200 01  PV-VARIABLES.                                                01520000
015300                                                                  01530000
015400     05  PV-DB2-CURRENT-DATE          PIC X(10) VALUE SPACES.     01540000
015500     05  PV-WORK-DATE                PIC  X(05)  VALUE SPACES.    01550000
015600     05  PV-CURRENT-DATE             PIC  X(10)  VALUE SPACES.    01560000
015700     05  PV-CURRENT-DATE-R REDEFINES PV-CURRENT-DATE.             01570000
015800         10 PV-CURRENT-CC            PIC  9(02).                  01580000
015900         10 PV-CURRENT-YY            PIC  9(02).                  01590000
016000         10 FILLER                   PIC  X(01).                  01600000
016100         10 PV-CURRENT-MM            PIC  9(02).                  01610000
016200         10 FILLER                   PIC  X(01).                  01620000
016300         10 PV-CURRENT-DD            PIC  9(02).                  01630000
016400     05  PV-CURRENT-TIME             PIC  X(08)  VALUE SPACES.    01640000
016500     05  PV-CURRENT-TIME-R REDEFINES PV-CURRENT-TIME.             01650000
016600         10 PV-CURRENT-HR            PIC  9(02).                  01660000
016700         10 FILLER                   PIC  X(01).                  01670000
016800         10 PV-CURRENT-MN            PIC  9(02).                  01680000
016900         10 FILLER                   PIC  X(03).                  01690000
017000     05  PV-USER-ID-8.                                            01700000
017100         10  PV-USER-ID              PIC  X(07)  VALUE SPACES.    01710000
017200         10  FILLER                  PIC  X(01)  VALUE 'Q'.       01720000
017300     05  PV-SYSTEM-ID.                                            01730000
017400         10  FILLER                  PIC  X(04)  VALUE SPACE.     01740000
017500         10  PV-REGION-IND           PIC  X(01).                  01750000
017600             88  PV-TEST-CICS                    VALUE 'T'.       01760000
017700             88  PV-QA-CICS                      VALUE 'Q'.       01770000
017800             88  PV-PROD-CICS                    VALUE 'P'.       01780000
017900             88  PV-LEARN-CICS                   VALUE 'L'.       01790000
018000         10  FILLER                  PIC  X(01)  VALUE SPACES.    01800000
018100     05  PV-ABS-TIME                 PIC S9(15)  COMP-3.          01810000
018200     05  PV-DATE-TIME.                                            01820000
018300         10  PV-DATE                  PIC X(10) VALUE SPACES.     01830000
018400         10  FILLER                   PIC X(01) VALUE SPACES.     01840000
018500         10  PV-TIME                  PIC X(08) VALUE SPACES.     01850000
018600     05  PV-LBL-PRT-DATE.                                         01860000
018700         10  PV-LBL-PRT-MM            PIC 9(02)      VALUE ZEROES.01870000
018800         10  FILLER                   PIC X(01)      VALUE '-'.   01880000
018900         10  PV-LBL-PRT-DD            PIC 9(02)      VALUE ZEROES.01890000
019000         10  FILLER                   PIC X(01)      VALUE '-'.   01900000
019100         10  PV-LBL-PRT-YY            PIC 9(02)      VALUE ZEROES.01910000
019200     05  PV-LBL-PRT-TIME.                                         01920000
019300         10  PV-LBL-PRT-HR            PIC 9(02)      VALUE ZEROES.01930000
019400         10  FILLER                   PIC X(01)      VALUE ':'.   01940000
019500         10  PV-LBL-PRT-MN            PIC 9(02)      VALUE ZEROES.01950000
019600     05  PV-SQL-RETURN-CD             PIC 999-.                   01960000
019700                                                                  01970000
019800 01  PV-VARIABLES-QUANTITIES.                                     01980000
019900     05  PV-NBR-CRTNS-FOR-OTPK       PIC S9(09)  COMP.            01990000
020000     05  PV-SHIPPED-QTY              PIC S9(09)  COMP.            02000000
020100     05  PV-UCC128-TABLE-ENTRIES     PIC  9(04)  VALUE ZERO.      02010000
020200     05  PV-UCC128-MAX-OTPK          PIC  9(04)  VALUE ZERO.      02020000
020300     05  PV-UCC128-MIN-OTPK          PIC  9(04)  VALUE ZERO.      02030000
020400     05  PV-EXPECT-TABLE-ENTRIES     PIC  9(04)  VALUE ZERO.      02040000
020500     05  PV-CARTON-TABLE-ENTRIES     PIC  9(04)  VALUE ZERO.      02050000
020600     05  PV-PREPK-TABLE-ENTRIES      PIC  9(04)  VALUE ZERO.      02060000
020700     05  PV-BEST-CASE-TBL-ENTRIES    PIC  9(04)  VALUE ZERO.      02070000
020800     05  PV-TYPE-CODE-SEQ            PIC  X(01)  VALUE SPACE.     02080000
020900     05  PV-FCSE-ALLOCATED           PIC  9(04)  VALUE ZEROES.    02090000
021000     05  PV-INPK-ALLOCATED           PIC  9(04)  VALUE ZEROES.    02100000
021100     05  PV-NBR-OF-INPKS             PIC  9(04)  VALUE ZEROES.    02110000
021200     05  PV-NEEDED-MIN-OTPK          PIC  9(05)  VALUE ZEROES.    02120002
021300     05  PV-NEEDED-MAX-OTPK          PIC  9(05)  VALUE ZEROES.    02130002
021400     05  PV-CARTON-NBR               PIC  9(04)  VALUE ZEROES.    02140000
021500     05  PV-MSTR-CARTON-NBR          PIC  9(04)  VALUE ZEROES.    02150000
021600     05  PV-P2L-QTY-NEEDED           PIC  9(09)  VALUE ZEROES.    02160000
021700     05  PV-FCSE-CRTN-CNT            PIC  9(04)  VALUE ZEROES.    02170000
021800     05  PV-INPK-CRTN-CNT            PIC  9(04)  VALUE ZEROES.    02180000
021900     05  PV-P2L-CRTN-CNT             PIC  9(04)  VALUE ZEROES.    02190000
022000     05  PV-TOTAL-LBL-CNT            PIC S9(09)  VALUE ZEROES     02200000
022100                                                 COMP.            02210000
022200     05  PV-MANIFEST-NBR             PIC S9(09)  VALUE ZEROES     02220000
022300                                                 COMP.            02230000
022400     05  PV-DC-BOUND-UNTS            PIC  9(05)  VALUE ZEROES.    02240002
022500     05  PV-DC-BOUND-CTNS            PIC  9(04)  VALUE ZEROES.    02250000
022600     05  PV-RTV-BOUND-UNTS           PIC  9(05)  VALUE ZEROES.    02260002
022700     05  PV-RTV-BOUND-CTNS           PIC  9(04)  VALUE ZEROES.    02270000
022800     05  PV-CS-BOUND-UNTS            PIC  9(05)  VALUE ZEROES.    02280002
022900     05  PV-CS-BOUND-CTNS            PIC  9(04)  VALUE ZEROES.    02290000
023000     05  PV-INPK-OTPK-RESULT         PIC  9(04)  VALUE ZEROES.    02300000
023100     05  PV-INPK-OTPK-REMAINDER      PIC  9(04)  VALUE ZEROES.    02310000
023200     05  PV-MSTR-CRTN-ASSGN          PIC  9(08)  VALUE ZEROES     02320000
023300                                                 COMP.            02330000
023400     05  PV-MASTER-CRTN-SEQ-ID       PIC  9(04)  VALUE ZEROES.    02340000
023500     05  PV-SML-CRTN-SEQ             PIC  9(04)  VALUE ZEROES.    02350000
023600     05  PV-P2L-CRTN-SEQ             PIC  9(04)  VALUE ZEROES.    02360000
023700     05  PV-DEPT-NAME                PIC  X(25)  VALUE SPACES.    02370000
023800     05  PV-MAJOR-CLASS              PIC  X(25)  VALUE SPACES.    02380000
023900     05  PV-SEASET-SHRT-NM           PIC  X(25)  VALUE SPACES.    02390000
024000     05  PV-SEASET-RLSE-DT           PIC  X(10)  VALUE SPACES.    02400000
024100     05  PV-STORE-ZONE               PIC  X(05)  VALUE SPACES.    02410000
024200     05  PV-P2L-STR-ZONE             PIC  X(05)  VALUE SPACES.    02420000
024300     05  PV-FIXTURE                  PIC  X(05)  VALUE SPACES.    02430000
024400     05  PV-CL-NBR                   PIC  X(02)  VALUE SPACES.    02440000
024500     05  PV-BARCODE                  PIC  X(22)  VALUE SPACES.    02450000
024600     05  PV-DIVERT-STORE.                                         02460000
024700         10  PV-DIVERT-CODE          PIC  9(01)  VALUE ZEROES.    02470000
024800         10  PV-STORE-NBR            PIC  9(04)  VALUE ZEROES.    02480000
024900     05  PV-DIVERT-PFX-NBR           PIC  9(01)  VALUE ZEROES.    02490000
025000                                                                  02500000
025100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02510000
025200                                                    COMP SYNC.    02520000
025300     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 02530000
025400     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 02540000
025500     05  PV-CICS-MSG-HOLD.                                        02550000
025600         10  FILLER                      PIC  X(01)  VALUE SPACE. 02560000
025700         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 02570000
025800     05  PV-CICS-MSG-HOLD3.                                       02580000
025900         10  FILLER                      PIC  X(01)  VALUE SPACE. 02590000
026000         10  FILLER                      PIC  X(11)  VALUE        02600000
026100                                         ' PO/RCVR - '.           02610000
026200         10  PV-HOLD3-PO                 PIC  Z(09).              02620000
026300         10  FILLER                      PIC  X(01)  VALUE '-'.   02630000
026400         10  PV-HOLD3-RCVR               PIC  9(04).              02640000
026500         10  FILLER                      PIC  X(11)  VALUE        02650000
026600                                         '    LINE - '.           02660000
026700         10  PV-HOLD3-LINE               PIC  Z(04).              02670000
026800         10  FILLER                      PIC  X(12)  VALUE        02680000
026900                                         '    STORE - '.          02690000
027000         10  PV-HOLD3-STORE              PIC  Z(04).              02700000
027100         10  FILLER                      PIC  X(43)  VALUE SPACE. 02710000
027200                                                                  02720000
027300     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     02730000
027400                                                     COMP SYNC.   02740000
027500     05  PV-PREVIOUS-SHPD-QTY            PIC  S9(9)V VALUE ZEROS  02750000
027600                                                     COMP-3.      02760000
027700     05  PV-OTPK-CARTON-COUNT            PIC  9(04)  VALUE ZEROS. 02770000
027800     05  PV-TOTAL-CARTON-COUNT           PIC  9(04)  VALUE ZEROS. 02780000
027900*                                                                 02790000
028000     05  PV-PREV-PO-NBR                  PIC  9(08)  VALUE ZEROS. 02800000
028100     05  PV-PREV-PKSL-SEQ                PIC  9(04)  VALUE ZEROS. 02810000
028200     05  PV-PREV-COMBO-NBR               PIC  9(04)  VALUE ZEROS. 02820000
028300     05  PV-PREV-OTPK-QTY                PIC  9(04)  VALUE ZEROS. 02830000
028400     05  PV-PREV-CRTN-CNT                PIC  9(04)  VALUE ZEROS. 02840000
028500     05  PV-TOTAL-PREPK-OTPK             PIC  9(04)  VALUE ZEROS. 02850000
028600     05  PV-DRVR-LNE-OTPK                PIC  9(04)  VALUE ZEROS. 02860000
028700     05  PV-DRVR-LNE-RATIO-MULT          PIC  9(04)  VALUE ZEROS. 02870000
028800     05  PV-PREPK-REMAINDER              PIC  9(04)  VALUE ZEROS. 02880000
028900     05  PV-RATIO-MULTIPLE               PIC  9(04)  VALUE ZEROS. 02890000
029000                                                                  02900000
029100     05  PV-P2L-SPLT-UNT-QTY-RATIO       PIC  S9(9) COMP.         02910000
029200     05  PV-FCSE-SPLT-UNT-QTY-RATIO      PIC  S9(9) COMP.         02920000
029300     05  PV-INPK-SPLT-UNT-QTY-RATIO      PIC  S9(9) COMP.         02930000
029400     05  PV-FCSE-ACTL-UNT-QTY-RATIO      PIC  S9(9) COMP.         02940000
029500     05  PV-EXPTED-ITM-QTY-RATIO         PIC  S9(9) COMP.         02950000
029600     05  PV-ACTL-ALLOC-QTY-RATIO         PIC  S9(9) COMP.         02960000
029700     05  PV-PRCS-QTY-UNT-RATIO           PIC  S9(9) COMP.         02970000
029800     05  PV-OTPK-UNT-RATIO               PIC  S9(4) COMP.         02980000
029900*                                                                 02990000
030000 01  PV-WORK-FIELDS.                                              03000000
030100     05  PV-DPKUT038                  PIC X(08)  VALUE 'DPKUT038'.03010000
030200     05  PV-DPKUT038-CA-LENGTH        PIC S9(04) VALUE +1237      03020000
030300                                                 COMP.            03030000
030400     05  PV-DPKUT038-CICS-RESP        PIC S9(04) VALUE +0         03040000
030500                                                 COMP SYNC.       03050000
030600     05  PV-DPKUT038-DATE             PIC X(06)  VALUE SPACES.    03060000
030700     05  PV-DPKUT038-DATE-R REDEFINES PV-DPKUT038-DATE.           03070000
030800         10 PV-DPKUT038-YY               PIC  X(02).              03080000
030900         10 PV-DPKUT038-MM               PIC  X(02).              03090000
031000         10 PV-DPKUT038-DD               PIC  X(02).              03100000
031100     05  PV-DPKUT038-MJR-CL.                                      03110000
031200         10 FILLER                       PIC  X(01) VALUE SPACE.  03120000
031300         10 PV-DPKUT038-MJR-CL-2         PIC  X(01) VALUE SPACE.  03130000
031310                                                                  03131000
031320     05  PV-MOD-DATE.                                             03132000
031330         10  PV-MOD                  PIC   99     VALUE ZEROES.   03133000
031340         10  PV-MOD-DATE-DASH        PIC   X      VALUE SPACE.    03134000
031350         10  PV-ARRIVE-MM            PIC   XX     VALUE ZEROES.   03135000
031360         10  PV-ARRIVE-DD            PIC   XX     VALUE ZEROES.   03136000
031400                                                                  03140000
031500                                                                  03150000
031600*----------------------------------------------------------------*03160000
031700*    20 & 22 DIGIT LAYOUT FOR BARCODES                            03170000
031800*----------------------------------------------------------------*03180000
031900     COPY PCWS160.                                                03190000
032000                                                                  03200000
032100*----------------------------------------------------------------*03210000
032200*    COMMAREA FOR MANIFEST NUMBER MODULE (PCKCS721)               03220000
032300*----------------------------------------------------------------*03230000
032400     COPY PCWS187.                                                03240000
032500                                                                  03250000
032600*----------------------------------------------------------------*03260000
032700*    COMMAREA FOR SEASONAL SET AND FIXT ID MODULE (PCKUT025)      03270000
032800*----------------------------------------------------------------*03280000
032900     COPY PCWS240.                                                03290000
033000                                                                  03300000
033100*----------------------------------------------------------------*03310000
033200*    COMMAREA FOR DEPARTMENT CLASS MODULE (XLKUT073)              03320000
033300*----------------------------------------------------------------*03330000
033400     COPY XLWS073.                                                03340000
033500                                                                  03350000
033600*----------------------------------------------------------------*03360000
033700*    COPYBOOK USED BY MBS SYSTEM TO GET BUYER NAME               *03370000
033800*----------------------------------------------------------------*03380000
033900     COPY DPWS003.                                                03390000
034000                                                                  03400000
034700*================================================================*03470000
034800* UCC128 DATA TABLE - THIS TABLE WILL CONTAIN THE OUTER PACK     *03480000
034900*      AND THE NUMBER OF CARTONS FOR EACH OUTER PACK, BASED ON   *03490000
035000*      UCC128 DATA.   MAXIMUM TABLE ENTRIES = 9999               *03500006
035100*================================================================*03510000
035200 01  PT-UCC128-DATA-TABLE.                                        03520000
035300***  05  PT-UCC128-DATA OCCURS 5000 TIMES                         03530004
035310     05  PT-UCC128-DATA OCCURS 9999 TIMES                         03531006
035400                              INDEXED BY PT-U128-IDX.             03540000
035500         10  PT-UCC128-OTPK           PIC S9(04) COMP.            03550000
035600         10  PT-UCC128-CRTNS          PIC  9(04).                 03560000
035700                                                                  03570000
035800*================================================================*03580000
035900* STORE EXPECTED TABLE - THIS TABLE WILL CONTAIN AN ENTRY FOR EACH03590000
036000*      EACH STORE FOR THE LINE BEING PROCESSED. MAX ENTRIES 1500 *03600000
036100*================================================================*03610000
036200 01  PT-STORE-EXPECT-TABLE.                                       03620000
036300     05  PT-STORE-EXPECT OCCURS 1500 TIMES                        03630000
036400                              INDEXED BY PT-EXPT-IDX.             03640000
036500         10  PT-EXPT-STR-TYP-ORDER    PIC  X(01).                 03650000
036600             88 PT-EXPT-DISTRB-CNTR             VALUES 'A'.       03660000
036700             88 PT-EXPT-RETURN-VNDR             VALUES 'B'.       03670000
036800             88 PT-EXPT-CENTRL-STCK             VALUES 'C'.       03680000
036900             88 PT-EXPT-E-COMMERCE              VALUES 'D'.       03690000
037000             88 PT-EXPT-STORE                   VALUES 'E'.       03700000
037100         10  PT-EXPT-STR-NBR          PIC S9(04) COMP.            03710000
037200         10  PT-EXPT-STR-TYP          PIC  X(02).                 03720000
037300         10  PT-EXPT-EXPTED-QTY       PIC  9(09).                 03730001
037400         10  PT-EXPT-NEEDED-QTY       PIC  9(09).                 03740001
037500         10  PT-EXPT-ALLOC-QTY        PIC  9(09).                 03750001
037600         10  PT-EXPT-FCSE-CNT         PIC  9(09).                 03760001
037700         10  PT-EXPT-INPK-CNT         PIC  9(09).                 03770001
037800         10  PT-EXPT-FCSE-UNTS        PIC  9(09).                 03780001
037900         10  PT-EXPT-INPK-UNTS        PIC  9(09).                 03790001
038000         10  PT-EXPT-P2L-UNTS         PIC  9(09).                 03800001
038100         10  PT-EXPT-E-COMMERCE-IND   PIC  X(01).                 03810000
038200             88  PT-EXPT-E-COMMERCE-YES          VALUE 'Y'.       03820000
038300             88  PT-EXPT-E-COMMERCE-NO           VALUE 'N'.       03830000
038400         10  PT-EXPT-SEASET-IND       PIC  X(01).                 03840000
038500             88  PT-EXPT-SEASET-YES              VALUE 'Y'.       03850000
038600             88  PT-EXPT-SEASET-NO               VALUE 'N'.       03860000
038700         10  PT-EXPT-POG-IND          PIC  X(01).                 03870000
038800             88  PT-EXPT-POG-YES                 VALUE 'Y'.       03880000
038900             88  PT-EXPT-POG-NO                  VALUE 'N'.       03890000
039000         10  PT-EXPT-FIXT-ID          PIC  X(10).                 03900000
039100         10  PT-EXPT-SEASONAL-SET     PIC  X(25).                 03910000
039200                                                                  03920000
039300*================================================================*03930000
039400* CARTON TABLE - THIS TABLE WILL CONTAIN AN ENTRY FOR EACH CRTN  *03940000
039500*      ASSIGNED.  THIS TABLE WILL ONLY BE CREATED IF VIRTUAL     *03950000
039600*      LABELS ARE BEING CREATED.  THIS TABLE WILL BE USED TO     *03960000
039700*      CREATE ENTRIES                                            *03970000
039800*                     MAXIMUM TABLE ENTRIES = 9999               *03980006
039900*================================================================*03990000
040000 01  PT-CARTON-TABLE.                                             04000000
040100***  05  PT-CARTON OCCURS 5000 TIMES                              04010004
040110     05  PT-CARTON OCCURS 9999 TIMES                              04011006
040200                              INDEXED BY PT-CRTN-IDX.             04020000
040300         10  PT-CRTN-ASSGN-SEQ-NBR    PIC  9(04).                 04030000
040400         10  PT-CRTN-MSTR-CRTN        PIC  9(04).                 04040000
040500         10  PT-CRTN-STORE-NBR        PIC  9(04).                 04050000
040600         10  PT-CRTN-STORE-TYP        PIC  X(02).                 04060000
040700             88  PT-CRTN-CENTRL-STCK             VALUE 'CS'.      04070000
040800             88  PT-CRTN-DISTRB-CNTR             VALUE 'DC'.      04080000
040900             88  PT-CRTN-STORE                   VALUE 'DS'.      04090000
041000             88  PT-CRTN-RETURN-VNDR             VALUE 'RV'.      04100000
041100         10  PT-CRTN-OTPK-QTY         PIC  9(04).                 04110000
041200         10  PT-CRTN-MSTR             PIC  X(01).                 04120000
041300         10  PT-CRTN-USE              PIC  X(01).                 04130000
041400             88  PT-CRTN-FCSE-SML                VALUE 'F'.       04140000
041500             88  PT-CRTN-INPK-SML                VALUE 'I'.       04150000
041600         10  PT-CRTN-LBL-TYP          PIC  X(01).                 04160000
041700             88  PT-CRTN-SML                     VALUE 'S'.       04170000
041800             88  PT-CRTN-P2L                     VALUE 'P'.       04180000
041900         10  PT-CRTN-E-COMMERCE-IND   PIC  X(01).                 04190000
042000             88  PT-CRTN-E-COMMERCE-YES          VALUE 'Y'.       04200000
042100             88  PT-CRTN-E-COMMERCE-NO           VALUE 'N'.       04210000
042200         10  PT-CRTN-MANIFEST-NBR     PIC S9(09) VALUE ZEROES     04220000
042300                                                 COMP.            04230000
042400         10  PT-CRTN-SEASET-IND       PIC  X(01).                 04240000
042500             88  PT-CRTN-SEASET-YES              VALUE 'Y'.       04250000
042600             88  PT-CRTN-SEASET-NO               VALUE 'N'.       04260000
042700         10  PT-CRTN-FIXT-ID          PIC  X(10).                 04270000
042800         10  PT-CRTN-SEASONAL-SET     PIC  X(25).                 04280000
042900                                                                  04290000
043000                                                                  04300000
043100*================================================================*04310000
043200* PREPACK LINE TABLE - THIS TABLE WILL CONTAIN AN ENTRY FOR EACH *04320000
043300*      LINE WITHIN THE PREPACK BEING PROCESSED.                  *04330000
043400*      MAXIMUM TABLE ENTRIES = 100                               *04340000
043500*================================================================*04350000
043600 01  PT-PREPK-LINE-TABLE.                                         04360000
043700     05  PT-PREPK-LINE OCCURS 100 TIMES                           04370000
043800                              INDEXED BY PT-PRPK-IDX.             04380000
043900         10  PT-PREPK-LNE-NBR         PIC  9(08).                 04390000
044000         10  PT-PREPK-RATIO           PIC  9(04).                 04400000
044100         10  PT-PREPK-DATA-SW         PIC  X.                     04410000
044200             88  PT-PREPK-DATA-AVAIL-YES         VALUE 'Y'.       04420000
044300             88  PT-PREPK-DATA-AVAIL-NO          VALUE 'N'.       04430000
044400         10  PT-PREPK-RATIO-MULT      PIC  9(04).                 04440000
044500         10  PT-PREPK-OTPK-QTY        PIC  9(04).                 04450000
044600                                                                  04460000
044700                                                                  04470000
044800*================================================================*04480000
044900* PREPACK BEST CASE TABLE - THIS TABLE WILL CONTAIN THE CARTORS  *04490000
045000*      THAT HAVE UCC128 DATA FOR ALL OF THE LINES WITHIN THE     *04500000
045100*      PREPACK.                                                  *04510000
045200*      MAXIMUM TABLE ENTRIES = 9999                              *04520006
045300*================================================================*04530000
045400 01  PT-BEST-CASE-TABLE.                                          04540000
045500***  05  PT-BEST-CASE OCCURS 5000 TIMES                           04550004
045510     05  PT-BEST-CASE OCCURS 9999 TIMES                           04551006
045600                              INDEXED BY PT-BEST-IDX.             04560000
045700         10  PT-BEST-CRTN-COMB        PIC  9(04).                 04570000
045800         10  PT-BEST-RATIO-MULT       PIC  9(04).                 04580000
045900         10  PT-BEST-CRTN-CNT         PIC  9(04).                 04590000
046000         10  PT-BEST-OTPK-QTY         PIC  9(04).                 04600000
046100         10  PT-BEST-DRVR-LNE-OTPK    PIC  9(04).                 04610000
046200         10  PT-BEST-EXTEND-UNTS      PIC  9(08).                 04620000
046300                                                                  04630000
046400                                                                  04640000
046500*================================================================*04650000
046600* RC-PACK SLIP TABLE                                             *04660000
046700*================================================================*04670000
046800     EXEC SQL                                                     04680000
046900          INCLUDE TPKSLIP                                         04690000
047000     END-EXEC.                                                    04700000
047100                                                                  04710000
047200*================================================================*04720000
047300* SU-INBOUND EDI PACKLIST/VENDOR SHIPMENT UNIT ASSOCIATION TABLE *04730000
047400*================================================================*04740000
047500     EXEC SQL                                                     04750000
047600          INCLUDE TINPKSU                                         04760000
047700     END-EXEC.                                                    04770000
047800                                                                  04780000
047900*================================================================*04790000
048000* SU-SHIPMENT UNIT/UPC ASSOCIATION TABLE                         *04800000
048100*================================================================*04810000
048200     EXEC SQL                                                     04820000
048300          INCLUDE TSHUUPC                                         04830000
048400     END-EXEC.                                                    04840000
048500                                                                  04850000
048600*================================================================*04860000
048700* RC-RECEIPT DISTRIBUTION TABLE                                  *04870000
048800*================================================================*04880000
048900     EXEC SQL                                                     04890000
049000          INCLUDE TRECDIS                                         04900000
049100     END-EXEC.                                                    04910000
049200                                                                  04920000
049300*================================================================*04930000
049400* RC-RECEIPT ITEM TABLE                                          *04940000
049500*================================================================*04950000
049600     EXEC SQL                                                     04960000
049700          INCLUDE TRECITM                                         04970000
049800     END-EXEC.                                                    04980000
049900                                                                  04990000
050000*================================================================*05000000
050100* PO-PURCHASE ITEM TABLE                                         *05010000
050200*================================================================*05020000
050300     EXEC SQL                                                     05030000
050400          INCLUDE TPURITM                                         05040000
050500     END-EXEC.                                                    05050000
050600                                                                  05060000
050700*================================================================*05070000
050800* CR-STORE TABLE   (XLT_LOC)                                     *05080000
050900*================================================================*05090000
051000     EXEC SQL                                                     05100000
051100          INCLUDE XLT00010                                        05110000
051200     END-EXEC.                                                    05120000
051300                                                                  05130000
051400*================================================================*05140000
051500* RC-COMPANY CONTROL TABLE                                       *05150000
051600*================================================================*05160000
051700     EXEC SQL                                                     05170000
051800          INCLUDE TCOCNTL                                         05180000
051900     END-EXEC.                                                    05190000
052000                                                                  05200000
052100*================================================================*05210000
052200* SU-VIRTUAL LABEL DATA                                          *05220000
052300*================================================================*05230000
052400     EXEC SQL                                                     05240000
052500          INCLUDE TLBVRDA                                         05250000
052600     END-EXEC.                                                    05260000
052700                                                                  05270000
052800*================================================================*05280000
052900* PC-PACK-TO-LIGHT MODULE                                        *05290000
053000*================================================================*05300000
053100     EXEC SQL                                                     05310000
053200          INCLUDE TP2LMOD                                         05320000
053300     END-EXEC.                                                    05330000
053400                                                                  05340000
053500*================================================================*05350000
053600* PO-PURCHASE TABLE                                              *05360000
053700*================================================================*05370000
053800     EXEC SQL                                                     05380000
053900          INCLUDE TPURCHS                                         05390000
054000     END-EXEC.                                                    05400000
054100                                                                  05410000
054200*================================================================*05420000
054300* PO-SEASONAL SET                                                *05430000
054400*================================================================*05440000
054500     EXEC SQL                                                     05450000
054600          INCLUDE TSEASET                                         05460000
054700     END-EXEC.                                                    05470000
054800                                                                  05480000
055600*================================================================*05560000
055700* DC-DISTRIBUTION TRANSACTION DETAIL                             *05570000
055800*================================================================*05580000
055900     EXEC SQL                                                     05590000
056000          INCLUDE TDISTDT                                         05600000
056100     END-EXEC.                                                    05610000
056200                                                                  05620000
056300*================================================================*05630000
056400* DC-DISTRIBUTION TRANSACTION HEADER                             *05640000
056500*================================================================*05650000
056600     EXEC SQL                                                     05660000
056700          INCLUDE TDISTHD                                         05670000
056800     END-EXEC.                                                    05680000
056900                                                                  05690000
057000*================================================================*05700000
057100* SU-ASN RECEIVER PACKSLIPS                                      *05710000
057200*================================================================*05720000
057300     EXEC SQL                                                     05730000
057400          INCLUDE TSHPSUM                                         05740000
057500     END-EXEC.                                                    05750000
057600                                                                  05760000
057700*================================================================*05770000
057800* DC DOOR TABLE                                                  *05780000
057900*================================================================*05790000
058000     EXEC SQL                                                     05800000
058100          INCLUDE TCNDCDR                                         05810000
058200     END-EXEC.                                                    05820000
058300                                                                  05830000
058400*================================================================*05840000
058500* DC DOOR TO STORE TABLE                                         *05850000
058600*================================================================*05860000
058700     EXEC SQL                                                     05870000
058800          INCLUDE TCNDRST                                         05880000
058900     END-EXEC.                                                    05890000
059000                                                                  05900000
059100*================================================================*05910000
059200* DB2 AREA FOR THE STORE MANIFEST TABLE                          *05920000
059300*================================================================*05930000
059400     EXEC SQL                                                     05940000
059500          INCLUDE TDCSTMF                                         05950000
059600     END-EXEC.                                                    05960000
059610                                                                  05961000
059611*================================================================*05961100
059612* PARM TABLE                                                      05961200
059613*================================================================*05961300
059614     EXEC SQL                                                     05961400
059615          INCLUDE TKRPRPM                                         05961500
059616     END-EXEC.                                                    05961600
059617                                                                  05961700
059620*================================================================*05962000
059630* OUTER-PACK CURSOR                                              *05963000
059640*================================================================*05964000
059650                                                                  05965000
059660     EXEC SQL                                                     05966000
059670     DECLARE UCC128-CSR CURSOR FOR                                05967000
059680         SELECT C.SHIPT_UNT_ID                                    05968000
059690               ,C.TRN_LNE_NBR                                     05969000
059700               ,SUM(C.SHPD_QTY)                                   05970000
059800           FROM TPKSLIP A                                         05980000
059900               ,TINPKSU B                                         05990000
060000               ,TSHUUPC C                                         06000000
060100          WHERE A.PO_NBR                 = :DK-PO-NBR             06010000
060200            AND A.REC_SEQ_NBR            = :DK-RCVR-SEQ-NBR       06020000
060300            AND A.VER_STAT_CDE           = 'A'                    06030000
060400            AND A.PKSL_STAT_CDE          = 'AC'                   06040000
060500            AND B.PO_NBR                 = A.PO_NBR               06050000
060600            AND B.SEQ_NBR                = A.SEQ_NBR              06060000
060700            AND C.SHIPT_UNT_ID           = B.SHIPT_UNT_ID         06070000
060800            AND C.TRN_NBR                = B.PO_NBR               06080000
060900            AND C.TRN_LNE_NBR            = :DK-ORD-LNE-NBR        06090000
061000          GROUP BY                                                06100000
061100                C.SHIPT_UNT_ID                                    06110000
061200               ,C.TRN_LNE_NBR                                     06120000
061300          ORDER BY 3                                              06130000
061310          WITH UR                                                 06131000
061400     END-EXEC.                                                    06140000
061500                                                                  06150000
061600*================================================================*06160000
061700* STORE EXPECTED CURSOR                                          *06170000
061800*================================================================*06180000
061900     EXEC SQL                                                     06190000
062000     DECLARE EXPECT-CSR CURSOR FOR                                06200000
062100         SELECT                                                   06210000
062200           CASE                                                   06220000
062300                WHEN B.LOC_TYP_CDE = 'DC' THEN 'A'                06230000
062400                WHEN B.LOC_TYP_CDE = 'RV' THEN 'B'                06240000
062500                WHEN B.LOC_TYP_CDE = 'CS' THEN 'C'                06250000
062600                WHEN B.LOC_TYP_CDE = 'DS'                         06260000
062700                     AND B.E_BUS_IND     = 'Y'                    06270000
062800                                        THEN 'D'                  06280000
062900                WHEN B.LOC_TYP_CDE = 'DS'                         06290000
063000                     AND B.E_BUS_IND     = 'N'                    06300000
063100                                        THEN 'E'                  06310000
063200                ELSE 'Z'                                          06320000
063300            END                                                   06330000
063400               ,B.LOC_TYP_CDE                                     06340000
063500               ,B.E_BUS_IND                                       06350000
063600               ,A.STR_NBR                                         06360000
063700               ,A.EXPTED_ITM_QTY                                  06370000
063800               ,B.OPN_DTE                                         06380000
063900           FROM TRECDIS A                                         06390000
064000               ,XLT_LOC B                                         06400000
064100          WHERE A.ORD_NBR                = :DK-PO-NBR             06410000
064200            AND A.REC_SEQ_NBR            = :DK-RCVR-SEQ-NBR       06420000
064300            AND A.ORD_LNE_NBR            = :DK-ORD-LNE-NBR        06430000
064400            AND A.STR_NBR                = B.LOC_NBR              06440000
064500          ORDER BY 1,4                                            06450000
064510          WITH UR                                                 06451000
064600     END-EXEC.                                                    06460000
064700                                                                  06470000
064800                                                                  06480000
064900*================================================================*06490000
065000* EXPECTED CURSOR IN DOOR SEQ ORDER                        *      06500000
065100*================================================================*06510000
065200     EXEC SQL                                                     06520000
065300     DECLARE DOOR-SEQ-CSR CURSOR FOR                              06530000
065400        SELECT                                                    06540000
065500                LOC_TYPE                                          06550000
065600              , LOC_TYP_CDE                                       06560000
065700              , E_BUS_IND                                         06570000
065800              , STR_NBR                                           06580000
065900              , EXPTED_ITM_QTY                                    06590000
066000              , MIN(LBL_SEQ)  AS LBL_SEQ                          06600000
066100              , OPN_DTE                                           06610000
066200          FROM                                                    06620000
066300          (SELECT DISTINCT                                        06630000
066400             CASE                                                 06640000
066500                  WHEN M.LOC_TYP_CDE = 'DC' THEN 'A'              06650000
066600                  WHEN M.LOC_TYP_CDE = 'RV' THEN 'B'              06660000
066700                  WHEN M.LOC_TYP_CDE = 'CS' THEN 'C'              06670000
066800                  WHEN M.LOC_TYP_CDE = 'DS'                       06680000
066900                       AND M.E_BUS_IND  = 'Y'                     06690000
067000                                            THEN 'D'              06700000
067100                  WHEN M.LOC_TYP_CDE = 'DS'                       06710000
067200                       AND M.E_BUS_IND  = 'N'                     06720000
067300                                            THEN 'E'              06730000
067400                  ELSE 'Z'                                        06740000
067500              END     AS LOC_TYPE                                 06750000
067600                                                                  06760000
067700                 ,M.LOC_TYP_CDE                                   06770000
067800                 ,M.E_BUS_IND                                     06780000
067900                 ,M.STR_NBR                                       06790000
068000                 ,M.EXPTED_ITM_QTY  AS EXPTED_ITM_QTY             06800000
068100                                                                  06810000
068200           , CASE                                                 06820000
068300                  WHEN N.DOOR_LBL_SEQ_NBR = 0     THEN 9998       06830000
068400                  WHEN N.DOOR_LBL_SEQ_NBR IS NULL THEN 9999       06840000
068500                  WHEN N.END_TMST <  '9999-09-09-09.09.09.999999' 06850000
068600                                                  THEN  9999      06860000
068700                  ELSE N.DOOR_LBL_SEQ_NBR                         06870000
068800             END AS LBL_SEQ                                       06880000
068900                                                                  06890000
069000                 ,M.OPN_DTE         AS OPN_DTE                    06900000
069100         FROM                                                     06910000
069200             ((SELECT DISTINCT                                    06920000
069300                      B.LOC_TYP_CDE                               06930000
069400                     ,B.E_BUS_IND                                 06940000
069500                     ,A.STR_NBR                                   06950000
069600                     ,A.EXPTED_ITM_QTY                            06960000
069700                     ,B.OPN_DTE                                   06970000
069800                 FROM TRECDIS A                                   06980000
069900                     ,XLT_LOC B                                   06990000
070000                WHERE A.ORD_NBR         = :DK-PO-NBR              07000000
070100                  AND A.REC_SEQ_NBR     = :DK-RCVR-SEQ-NBR        07010000
070200                  AND A.ORD_LNE_NBR     = :DK-ORD-LNE-NBR         07020000
070300                  AND A.EXPTED_ITM_QTY  > +0                      07030000
070400                  AND A.STR_NBR         = B.LOC_NBR               07040000
070500              )  M                                                07050000
070600          LEFT OUTER JOIN                                         07060000
070700              (SELECT  DISTINCT                                   07070000
070800                       B.LOC_TYP_CDE                              07080000
070900                      ,B.E_BUS_IND                                07090000
071000                      ,A.STR_NBR                                  07100000
071100                      ,A.EXPTED_ITM_QTY                           07110000
071200                      ,E.END_TMST                                 07120000
071300                      ,F.DOOR_LBL_SEQ_NBR                         07130000
071400                      ,B.OPN_DTE                                  07140000
071500                 FROM                                             07150000
071600                       TRECDIS A                                  07160000
071700                     , XLT_LOC B                                  07170000
071800                     , TCNDRST E                                  07180000
071900                     , TCNDCDR F                                  07190000
072000                WHERE  A.ORD_NBR         = :DK-PO-NBR             07200000
072100                  AND  A.REC_SEQ_NBR     = :DK-RCVR-SEQ-NBR       07210000
072200                  AND  A.ORD_LNE_NBR     = :DK-ORD-LNE-NBR        07220000
072300                  AND  A.EXPTED_ITM_QTY  > +0                     07230000
072400                  AND  A.STR_NBR         = B.LOC_NBR              07240000
072500                  AND  E.DOOR_ID         = F.DOOR_ID              07250000
072600                  AND  E.OPER_UNT_ID     = F.OPER_UNT_ID          07260000
072601                  AND  E.END_TMST  = '9999-09-09-09.09.09.999999' 07260103
072610                  AND  B.LOC_NBR         = E.STR_NBR              07261000
072620                  AND  A.OPER_UNT_ID     = F.OPER_UNT_ID          07262000
072630                  AND  F.DOOR_LOC_DESC NOT LIKE '%RE-OPEN%'       07263000
072640                  AND  F.DOOR_LOC_DESC NOT LIKE '%UPS%'           07264000
072650                  AND  F.DOOR_LOC_DESC NOT LIKE '%VIRTUAL%'       07265000
072660              )  N                                                07266000
072670                                                                  07267000
072680          ON           M.LOC_TYP_CDE     =  N.LOC_TYP_CDE         07268000
072690                  AND  M.E_BUS_IND       =  N.E_BUS_IND           07269000
072691                  AND  M.STR_NBR         =  N.STR_NBR             07269100
072692                  AND  M.EXPTED_ITM_QTY  =  N.EXPTED_ITM_QTY      07269200
072693                  AND  M.OPN_DTE         =  N.OPN_DTE             07269300
072694             ))  Y                                                07269400
072695                                                                  07269500
072696             GROUP BY                                             07269600
072697                     LOC_TYPE                                     07269700
072698                  ,  LOC_TYP_CDE                                  07269800
072699                  ,  E_BUS_IND                                    07269900
072700                  ,  STR_NBR                                      07270000
072701                  ,  EXPTED_ITM_QTY                               07270100
072702                  ,  OPN_DTE                                      07270200
072703             ORDER BY                                             07270300
072704                  6,4                                             07270400
072705          WITH UR                                                 07270500
072710     END-EXEC.                                                    07271000
072800                                                                  07280000
072900                                                                  07290000
073000*================================================================*07300000
073100* PREPACK LINE CURSOR                                            *07310000
073200*================================================================*07320000
073300     EXEC SQL                                                     07330000
073400          DECLARE PRE_PACK_CSR CURSOR FOR                         07340000
073500              SELECT DISTINCT                                     07350000
073600                     A.ORD_LNE_NBR                                07360000
073700                    ,A.PREPK_RATO_QTY                             07370000
073800                FROM TRECITM A                                    07380000
073900                    ,TPURITM B                                    07390000
074000               WHERE A.ORD_NBR           = :DK-PO-NBR             07400000
074100                 AND A.REC_SEQ_NBR       = :DK-RCVR-SEQ-NBR       07410000
074200                 AND A.PREPK_ID          = :DK-PREPK-ID           07420000
074300                 AND A.ORD_NBR           = B.PO_NBR               07430000
074400                 AND A.VER_STATUS_CDE    = 'A'                    07440000
074500                 AND A.PO_VER_NBR        = B.VER_NBR              07450000
074600                 AND A.ORD_LNE_NBR       = B.APP_PO_LNE_NBR       07460000
074700          ORDER BY                                                07470000
074800                A.ORD_LNE_NBR                                     07480000
074810          WITH UR                                                 07481000
074900     END-EXEC.                                                    07490000
075000                                                                  07500000
075100                                                                  07510000
075200*================================================================*07520000
075300* SHIPMENT CARTON SUMMARY CURSOR                                 *07530000
075400*================================================================*07540000
075500     EXEC SQL                                                     07550000
075600          DECLARE SHIP_SUM_CSR CURSOR FOR                         07560000
075700              SELECT A.PO_NBR                                     07570000
075800                    ,A.PKSL_SEQ_NBR                               07580000
075900                    ,A.CART_COMB_NBR                              07590000
076000                    ,A.PO_LNE_NBR                                 07600000
076100                    ,A.TOT_CART_CNT                               07610000
076200                    ,A.OTPK_UNT_QTY                               07620000
076300                FROM TSHPSUM A                                    07630000
076400                    ,TPKSLIP B                                    07640000
076500               WHERE A.PO_NBR            = :DK-PO-NBR             07650000
076600                 AND A.PO_NBR            =  B.PO_NBR              07660000
076700                 AND A.PKSL_SEQ_NBR      =  B.SEQ_NBR             07670000
076800                 AND B.REC_SEQ_NBR       = :DK-RCVR-SEQ-NBR       07680000
076900                 AND B.VER_STAT_CDE      = 'A'                    07690000
077000                 AND B.PKSL_STAT_CDE     = 'AC'                   07700000
077100          ORDER BY                                                07710000
077200                A.PKSL_SEQ_NBR                                    07720000
077300               ,A.CART_COMB_NBR                                   07730000
077400               ,A.PO_LNE_NBR                                      07740000
077410          WITH UR                                                 07741000
077500     END-EXEC.                                                    07750000
077600                                                                  07760000
077700                                                                  07770000
077800*================================================================*07780000
077900* PREPACK DELETE CURSOR                                          *07790000
078000*================================================================*07800000
078100     EXEC SQL                                                     07810000
078200          DECLARE PRE_PACK_DEL_CSR CURSOR FOR                     07820000
078300              SELECT DISTINCT                                     07830000
078400                     A.ORD_LNE_NBR                                07840000
078500                    ,A.PREPK_RATO_QTY                             07850000
078600                FROM TRECITM A                                    07860000
078700               WHERE A.ORD_NBR           = :DK-PO-NBR             07870000
078800                 AND A.REC_SEQ_NBR       = :DK-RCVR-SEQ-NBR       07880000
078900                 AND A.PREPK_ID          = :DK-PREPK-ID           07890000
079000                 AND A.ORD_LNE_NBR      <> :DK-ORD-LNE-NBR        07900000
079100                 AND A.VER_STATUS_CDE    = 'A'                    07910000
079200          ORDER BY                                                07920000
079300                A.ORD_LNE_NBR                                     07930000
079310          WITH UR                                                 07931000
079400     END-EXEC.                                                    07940000
079500                                                                  07950000
079600******************************************************************07960000
079700*    DECLARATION FOR CURSOR SELECTING MANIFEST NBR FROM TDCSTMF   07970000
079800******************************************************************07980000
079900                                                                  07990000
080000     EXEC SQL                                                     08000000
080100         DECLARE  DCSTMF_CSR CURSOR FOR                           08010000
080200          SELECT  MFST_NBR                                        08020000
080300            FROM  TDCSTMF                                         08030000
080310        WHERE STR_NBR = :DK-STR-NBR                               08031000
080320        FOR UPDATE OF MFST_NBR                                    08032000
080330     END-EXEC.                                                    08033000
080340                                                                  08034000
080350                                                                  08035000
080360*================================================================*08036000
080370*                                                                *08037000
080380*================================================================*08038000
080390     EXEC SQL                                                     08039000
080400          INCLUDE SQLCA                                           08040000
080500     END-EXEC.                                                    08050000
080600                                                                  08060000
080700 LINKAGE SECTION.                                                 08070000
080800     COPY PCWS251.                                                08080000
080900                                                                  08090000
081000*================================================================*08100000
081100*                                                                *08110000
081200*================================================================*08120000
081300 PROCEDURE DIVISION USING PC251-FIELDS.                           08130000
081400                                                                  08140000
081500 0000-PROGRAM-MAINLINE.                                           08150000
081600     INITIALIZE    PV-VARIABLES-QUANTITIES.                       08160000
081700     MOVE    'N'            TO PS-ERROR-SW                        08170000
081800                               PS-EOF-UCC128-SW                   08180000
081900                               PS-EOF-EXPECT-SW                   08190000
082000                               PS-EOF-PREPK-SW                    08200000
082100                               PS-EOF-SHPSUM-SW                   08210000
082110                               PS-ERROR-SW                        08211000
082120                               PS-UCC128-FCSE-MATCH-SW            08212000
082130                               PS-UCC128-FCSE-PARTIAL-SW          08213000
082140                               PS-RATIO-MULT-SW                   08214000
082150                               PS-RATIO-REMAINDER-SW              08215000
082160                               PS-EOF-DOOR-SEQ-CSR-SW.            08216000
082170                                                                  08217000
082180     MOVE    'Y' TO            PS-CARTON-MASTER-SW                08218000
082190                               PS-ENTRIES-PREPK-SW                08219000
082200                               PS-PREPK-LINES-LEFT-SW             08220000
082210                               PS-POG-DATA-FOUND-SW               08221000
082220                               PS-SEASET-DATA-FOUND-SW.           08222000
082230     INITIALIZE                PV-VARIABLES-QUANTITIES            08223000
082240                               PT-CARTON-TABLE.                   08224000
082241                                                                  08224100
082242     SET   PT-CRTN-IDX      TO  +1.                               08224200
082243     SET   PT-BEST-IDX      TO  +1.                               08224300
082244                                                                  08224400
082245     PERFORM 1000-INITIAL-PROCESS.                                08224500
082246                                                                  08224600
082247     IF  PS-ERROR                                                 08224700
082248         CONTINUE                                                 08224800
082249     ELSE                                                         08224900
082250       IF  PC251-CREATE-BOTH                                      08225000
082260         PERFORM 2000-CREATE-SML-P2L                              08226000
082270       ELSE                                                       08227000
082280         IF  PC251-CREATE-SML                                     08228000
082290           PERFORM 2200-CREATE-SML-ONLY                           08229000
082300         ELSE                                                     08230000
082400           IF  PC251-CREATE-P2L                                   08240000
082500             PERFORM 2400-CREATE-P2L-ONLY                         08250000
082600           END-IF                                                 08260000
082700         END-IF                                                   08270000
082800       END-IF                                                     08280000
082900     END-IF.                                                      08290000
083000                                                                  08300000
083100     IF  PS-ERROR                                                 08310000
083200         CONTINUE                                                 08320000
083300     ELSE                                                         08330000
083400         PERFORM 2600-SUM-LBL-QTYS                                08340000
083500     END-IF.                                                      08350000
083600                                                                  08360000
083700     MOVE  PV-FCSE-CRTN-CNT      TO  PC251-FCSE-LBL-CNT.          08370000
083800     MOVE  PV-INPK-CRTN-CNT      TO  PC251-INPK-LBL-CNT.          08380000
083900     MOVE  PV-P2L-CRTN-CNT       TO  PC251-P2L-LBL-CNT.           08390000
084000     MOVE  PV-DC-BOUND-UNTS      TO  PC251-DC-BOUND-UNTS.         08400000
084100     MOVE  PV-DC-BOUND-CTNS      TO  PC251-DC-BOUND-CTNS.         08410000
084200     MOVE  PV-RTV-BOUND-UNTS     TO  PC251-RTV-BOUND-UNTS.        08420000
084300     MOVE  PV-RTV-BOUND-CTNS     TO  PC251-RTV-BOUND-CTNS.        08430000
084400     MOVE  PV-CS-BOUND-UNTS      TO  PC251-CS-BOUND-UNTS.         08440000
084500     MOVE  PV-CS-BOUND-CTNS      TO  PC251-CS-BOUND-CTNS.         08450000
084600     IF  PV-UCC128-TABLE-ENTRIES  >  1                            08460000
084700         SET  PC251-MULT-OTPK    TO  TRUE                         08470000
084800         MOVE ZEROES             TO  PC251-OTPK-UNT-QTY           08480000
084900     ELSE                                                         08490000
085000         SET  PC251-SINGLE-OTPK  TO  TRUE                         08500000
085100         MOVE PT-UCC128-OTPK(+1) TO  PC251-OTPK-UNT-QTY           08510000
085200     END-IF.                                                      08520000
085300     MOVE PV-TOTAL-CARTON-COUNT  TO PC251-TOTAL-CARTONS.          08530000
085400                                                                  08540000
085500     SET  PC251-SUCCESSFUL      TO  TRUE.                         08550000
085600                                                                  08560000
085700     IF PS-ERROR                                                  08570000
085800         CONTINUE                                                 08580000
085900     ELSE                                                         08590000
086000       IF  PC251-FUNC-CRE-VRTL-LBL                                08600000
086100           PERFORM  5400-GET-LBL-DATA                             08610000
086200           IF  PS-NO-ERROR                                        08620000
086300               PERFORM  5050-GET-MANIFEST-NBRS                    08630000
086400           END-IF                                                 08640000
086500           IF  PS-NO-ERROR                                        08650000
086600               PERFORM  5100-CREATE-VRTL-LABEL                    08660000
086700           END-IF                                                 08670000
086800           IF  PS-NO-ERROR                                        08680000
086900               PERFORM  5500-CREATE-HDR-DTL-TBL                   08690000
087000           END-IF                                                 08700000
087100       END-IF                                                     08710000
087200     END-IF.                                                      08720000
087300                                                                  08730000
087400     PERFORM 9000-RETURN-CALL.                                    08740000
087500                                                                  08750000
087600                                                                  08760000
087700*================================================================*08770000
087800*                                                                *08780000
087900*================================================================*08790000
088000 1000-INITIAL-PROCESS.                                            08800000
088100                                                                  08810000
088200     SET  PC251-SUCCESSFUL                                        08820000
088300          PS-SEASET-DATA-FOUND                                    08830000
088400          PS-POG-DATA-FOUND           TO TRUE                     08840000
088500                                                                  08850000
088600                                                                  08860000
088700     PERFORM 1010-GET-CURRENT-DATE.                               08870000
088800                                                                  08880000
088900     MOVE PC251-OPER-UNT-ID           TO DK-OPER-UNT-ID.          08890000
089000     MOVE PC251-PO-NBR                TO DK-PO-NBR.               08900000
089100     MOVE PC251-RCVR-SEQ-NBR          TO DK-RCVR-SEQ-NBR.         08910000
089200     MOVE PC251-PO-LNE-NBR            TO DK-ORD-LNE-NBR.          08920000
089300     MOVE PC251-MOD-NBR               TO DK-MOD-NBR.              08930000
089400     MOVE PC251-PREPK-ID              TO DK-PREPK-ID.             08940000
089500                                                                  08950000
089600     IF  PC251-PRE-PACK-ORDER                                     08960000
089700         PERFORM 1275-CHECK-TSHPSUM-ZERO                          08970000
089800         IF  PS-NO-ERROR                                          08980000
089900             PERFORM 1300-PREPACK-ROUTINE                         08990000
090000         END-IF                                                   09000000
090100     ELSE                                                         09010000
090200         PERFORM 1100-BUILD-UCC128-DATA-TABLE                     09020000
090300     END-IF.                                                      09030000
090400                                                                  09040000
090500     IF  PS-ERROR                                                 09050000
090600         CONTINUE                                                 09060000
090700     ELSE                                                         09070000
090800         IF PC251-PRT-DOOR-SEQ                                    09080000
090900            PERFORM 1250-BUILD-DOOR-SEQ-TABLE                     09090000
091000         ELSE                                                     09100000
091100            PERFORM 1200-BUILD-STORE-EXPECT-TABLE                 09110000
091200         END-IF                                                   09120000
091300     END-IF.                                                      09130000
091301                                                                  09130100
091310*                                                                 09131000
091320*** DMH - 10-5-10 - BEGIN                                         09132000
091330*                                                                 09133000
091340     PERFORM 1015-CHECK-TRIP-ON-P2L-LABEL.                        09134000
091350*                                                                 09135000
091360*** DMH - 10-5-10 - END                                           09136000
091370*                                                                 09137000
091400                                                                  09140000
091500     IF  PV-EXPECT-TABLE-ENTRIES  >  0                            09150000
091600         PERFORM 7200-GET-AD-DATE                                 09160000
091700     END-IF.                                                      09170000
091800                                                                  09180000
091900                                                                  09190000
092000*-----------------------------------------------------------------09200000
092100*  GET CURRENT DATE TO PRINT ON LABEL                             09210000
092200*-----------------------------------------------------------------09220000
092300 1010-GET-CURRENT-DATE.                                           09230000
092400                                                                  09240000
092500     EXEC SQL                                                     09250000
092600         SELECT  CURRENT DATE                                     09260000
092700                ,CURRENT TIME                                     09270000
092800           INTO  :PV-CURRENT-DATE                                 09280000
092900                ,:PV-CURRENT-TIME                                 09290000
093000           FROM  TCOCNTL                                          09300000
093100          WHERE  OPER_UNT_ID = 90                                 09310000
093110          WITH UR                                                 09311001
093200     END-EXEC.                                                    09320000
093300                                                                  09330000
093400     EVALUATE TRUE                                                09340000
093500         WHEN SQLCODE = ZERO                                      09350000
093600              MOVE  PV-CURRENT-MM  TO  PV-LBL-PRT-MM              09360000
093700              MOVE  PV-CURRENT-DD  TO  PV-LBL-PRT-DD              09370000
093800              MOVE  PV-CURRENT-YY  TO  PV-LBL-PRT-YY              09380000
093900              MOVE  PV-CURRENT-HR  TO  PV-LBL-PRT-HR              09390000
094000              MOVE  PV-CURRENT-MN  TO  PV-LBL-PRT-MN              09400000
094100                                                                  09410000
094200         WHEN OTHER                                               09420000
094300              CONTINUE                                            09430000
094400      END-EVALUATE.                                               09440000
094500                                                                  09450000
094600                                                                  09460000
094610*================================================================*09461000
094620* DETERMINE IF THE TRIP ARRIVE DATE IS TO APPEAR ON THE P2L      *09462000
094630* LABEL                                                          *09463000
094640*================================================================*09464000
094650 1015-CHECK-TRIP-ON-P2L-LABEL.                                    09465000
094660                                                                  09466000
094670     SET PS-P2L-MOD-ON-LABEL TO TRUE                              09467000
094680                                                                  09468000
094690     EXEC SQL                                                     09469000
094691          SELECT FUNC_TXT                                         09469100
094692          INTO  :PS-P2L-LABEL-DISPLAY-SW                          09469200
094693          FROM   TKRPRPM                                          09469300
094694          WHERE  SYS_PRC_FUNC_CDE  = 'P2LARV'                     09469400
094695            AND  LOC_ID            = :DK-OPER-UNT-ID              09469500
094696            AND  INTFC_SYS_CDE     = 'KHL'                        09469600
094697            AND  FUNC_PRC_STAT_CDE = 'AC'                         09469700
094698          WITH UR                                                 09469802
094699     END-EXEC.                                                    09469900
094700                                                                  09470000
094701     EVALUATE TRUE                                                09470100
094702         WHEN SQLCODE = ZERO                                      09470200
094703             SET PS-TRIP-ARRIVE-DATE-ON-LABEL   TO  TRUE          09470300
094704         WHEN SQLCODE = +100                                      09470400
094705             SET PS-P2L-MOD-ON-LABEL   TO TRUE                    09470500
094706         WHEN OTHER                                               09470600
094707              SET PS-P2L-MOD-ON-LABEL TO TRUE                     09470700
094708              CONTINUE                                            09470800
094709      END-EVALUATE.                                               09470900
094710                                                                  09471000
094711                                                                  09471100
094720*================================================================*09472000
094800* BUILD INITIAL UCC128 DATA TABLE                                *09480000
094900*================================================================*09490000
095000 1100-BUILD-UCC128-DATA-TABLE.                                    09500000
095100                                                                  09510000
095200     INITIALIZE PT-UCC128-DATA-TABLE.                             09520000
095300                                                                  09530000
095400     SET PS-NOT-EOF-UCC128-CSR       TO TRUE.                     09540000
095500                                                                  09550000
095600     PERFORM 7000-OPEN-UCC128-CSR.                                09560000
095700     PERFORM 7010-FETCH-UCC128-CSR.                               09570000
095800                                                                  09580000
095900     IF  PS-EOF-UCC128-CSR                                        09590000
096000         CONTINUE                                                 09600000
096100     ELSE                                                         09610000
096200         MOVE  SHUUPC-SHPD-QTY  TO  PV-PREVIOUS-SHPD-QTY          09620000
096300                                    PV-UCC128-MAX-OTPK            09630000
096400                                    PV-UCC128-MIN-OTPK            09640000
096500     END-IF.                                                      09650000
096600                                                                  09660000
096700     SET   PT-U128-IDX      TO  +1.                               09670000
096800                                                                  09680000
096900     PERFORM                                                      09690000
097000       UNTIL PS-EOF-UCC128-CSR OR                                 09700000
097100             PT-U128-IDX > PC-MAX-UCC128-TBL-ENTRY                09710000
097200                                                                  09720000
097300             IF  SHUUPC-SHPD-QTY  =  PV-PREVIOUS-SHPD-QTY         09730000
097400                 ADD  1          TO  PV-OTPK-CARTON-COUNT         09740000
097500             ELSE                                                 09750000
097600                 MOVE  PV-PREVIOUS-SHPD-QTY TO  PT-UCC128-OTPK    09760000
097700                                                (PT-U128-IDX)     09770000
097800                 MOVE  PV-OTPK-CARTON-COUNT TO  PT-UCC128-CRTNS   09780000
097900                                                (PT-U128-IDX)     09790000
098000                 ADD   PV-OTPK-CARTON-COUNT                       09800000
098100                  TO   PV-TOTAL-CARTON-COUNT                      09810000
098200                 ADD   +1        TO PV-UCC128-TABLE-ENTRIES       09820000
098300                 IF  PC251-CREATE-P2L                             09830000
098400                     CONTINUE                                     09840000
098500                 ELSE                                             09850000
098600                                                                  09860000
098700                     IF  PC251-INPK-UNT-QTY  >  0                 09870000
098800                         DIVIDE SHUUPC-SHPD-QTY                   09880000
098900                             BY PC251-INPK-UNT-QTY                09890000
099000                         GIVING PV-INPK-OTPK-RESULT               09900000
099100                         REMAINDER PV-INPK-OTPK-REMAINDER         09910000
099200                     ELSE                                         09920000
099300                         MOVE ZEROES  TO  PV-INPK-OTPK-RESULT     09930000
099400                         MOVE SHUUPC-SHPD-QTY                     09940000
099500                                      TO  PV-INPK-OTPK-REMAINDER  09950000
099600                     END-IF                                       09960000
099700                                                                  09970000
099800                     IF PV-INPK-OTPK-REMAINDER > 0                09980000
099900                         SET PC251-ERR-OTPK-BY-INPK               09990000
100000                              PS-ERROR           TO  TRUE         10000000
100100                     END-IF                                       10010000
100200                 END-IF                                           10020000
100300                                                                  10030000
100400                 IF PV-UCC128-MAX-OTPK = ZEROES                   10040000
100500                     MOVE SHUUPC-SHPD-QTY                         10050000
100600                       TO PV-UCC128-MAX-OTPK                      10060000
100700                           PV-UCC128-MIN-OTPK                     10070000
100800                 ELSE                                             10080000
100900                 IF SHUUPC-SHPD-QTY >  PV-UCC128-MAX-OTPK         10090000
101000                     MOVE SHUUPC-SHPD-QTY                         10100000
101100                       TO PV-UCC128-MAX-OTPK                      10110000
101200                 ELSE                                             10120000
101300                 IF SHUUPC-SHPD-QTY <  PV-UCC128-MIN-OTPK         10130000
101400                     MOVE SHUUPC-SHPD-QTY                         10140000
101500                       TO PV-UCC128-MIN-OTPK                      10150000
101600                 END-IF                                           10160000
101700                 END-IF                                           10170000
101800                 END-IF                                           10180000
101900                                                                  10190000
102000                 MOVE  ZEROES           TO  PV-OTPK-CARTON-COUNT  10200000
102100                 MOVE  SHUUPC-SHPD-QTY  TO  PV-PREVIOUS-SHPD-QTY  10210000
102200                 ADD   1                TO  PV-OTPK-CARTON-COUNT  10220000
102300                 SET   PT-U128-IDX          UP BY +1              10230000
102400             END-IF                                               10240000
102500                                                                  10250000
102600                                                                  10260000
102700         PERFORM 7010-FETCH-UCC128-CSR                            10270000
102800                                                                  10280000
102900     END-PERFORM.                                                 10290000
103000     IF  PV-OTPK-CARTON-COUNT  >  0                               10300000
103100         MOVE  PV-PREVIOUS-SHPD-QTY TO  PT-UCC128-OTPK            10310000
103200                                        (PT-U128-IDX)             10320000
103300         MOVE  PV-OTPK-CARTON-COUNT TO  PT-UCC128-CRTNS           10330000
103400                                        (PT-U128-IDX)             10340000
103500         ADD   PV-OTPK-CARTON-COUNT                               10350000
103600          TO   PV-TOTAL-CARTON-COUNT                              10360000
103700         ADD   +1                   TO PV-UCC128-TABLE-ENTRIES    10370000
103800         IF  PC251-CREATE-P2L                                     10380000
103900             CONTINUE                                             10390000
104000         ELSE                                                     10400000
104100             IF  PC251-INPK-UNT-QTY  >  0                         10410000
104200                 DIVIDE SHUUPC-SHPD-QTY                           10420000
104300                     BY PC251-INPK-UNT-QTY                        10430000
104400                 GIVING PV-INPK-OTPK-RESULT                       10440000
104500                 REMAINDER PV-INPK-OTPK-REMAINDER                 10450000
104600             ELSE                                                 10460000
104700                 MOVE  ZEROES  TO  PV-INPK-OTPK-RESULT            10470000
104800                 MOVE  SHUUPC-SHPD-QTY                            10480000
104900                               TO  PV-INPK-OTPK-REMAINDER         10490000
105000             END-IF                                               10500000
105100                                                                  10510000
105200             IF PV-INPK-OTPK-REMAINDER > 0                        10520000
105300                 SET PC251-ERR-OTPK-BY-INPK                       10530000
105400                      PS-ERROR                   TO  TRUE         10540000
105500             END-IF                                               10550000
105600         END-IF                                                   10560000
105700                                                                  10570000
105800         IF PV-UCC128-MAX-OTPK = ZEROES                           10580000
105900             MOVE SHUUPC-SHPD-QTY                                 10590000
106000               TO PV-UCC128-MAX-OTPK                              10600000
106100                   PV-UCC128-MIN-OTPK                             10610000
106200         ELSE                                                     10620000
106300         IF SHUUPC-SHPD-QTY >          PV-UCC128-MAX-OTPK         10630000
106400             MOVE SHUUPC-SHPD-QTY                                 10640000
106500               TO PV-UCC128-MAX-OTPK                              10650000
106600         ELSE                                                     10660000
106700         IF SHUUPC-SHPD-QTY <          PV-UCC128-MIN-OTPK         10670000
106800             MOVE SHUUPC-SHPD-QTY                                 10680000
106900               TO PV-UCC128-MIN-OTPK                              10690000
107000         END-IF                                                   10700000
107100         END-IF                                                   10710000
107200         END-IF                                                   10720000
107300                                                                  10730000
107400         MOVE          ZEROES           TO  PV-OTPK-CARTON-COUNT  10740000
107500         MOVE          SHUUPC-SHPD-QTY  TO  PV-PREVIOUS-SHPD-QTY  10750000
107600         ADD           1                TO  PV-OTPK-CARTON-COUNT  10760000
107700     END-IF                                                       10770000
107800                                                                  10780000
107900                                                                  10790000
108000     PERFORM 7020-CLOSE-UCC128-CSR.                               10800000
108100                                                                  10810000
108200     MOVE  PV-TOTAL-CARTON-COUNT  TO  PC251-TOTAL-CARTONS.        10820000
108300                                                                  10830000
108400                                                                  10840000
108500                                                                  10850000
108600*================================================================*10860000
108700* BUILD INITIAL STORE EXPECTED TABLE                             *10870000
108800*================================================================*10880000
108900 1200-BUILD-STORE-EXPECT-TABLE.                                   10890000
109000                                                                  10900000
109100     INITIALIZE PT-STORE-EXPECT-TABLE.                            10910000
109200     SET PS-NOT-EOF-EXPECT-CSR        TO TRUE                     10920000
109300                                                                  10930000
109400     PERFORM 7030-OPEN-EXPECT-CSR.                                10940000
109500     PERFORM 7040-FETCH-EXPECT-CSR.                               10950000
109600     PERFORM                                                      10960000
109700         VARYING PT-EXPT-IDX                                      10970000
109800            FROM 1 BY 1                                           10980000
109900           UNTIL PS-EOF-EXPECT-CSR OR                             10990000
110000                 PT-EXPT-IDX > PC-MAX-EXPTED-TBL-ENTRY            11000000
110100                                                                  11010000
110200            MOVE PV-TYPE-CODE-SEQ       TO  PT-EXPT-STR-TYP-ORDER 11020000
110300                                            (PT-EXPT-IDX)         11030000
110400            MOVE RECDIS-STR-NBR         TO  PT-EXPT-STR-NBR       11040000
110500                                            (PT-EXPT-IDX)         11050000
110600            MOVE XLT00010-LOC-TYP-CDE   TO  PT-EXPT-STR-TYP       11060000
110700                                            (PT-EXPT-IDX)         11070000
110800            MOVE XLT00010-E-BUS-IND     TO  PT-EXPT-E-COMMERCE-IND11080000
110900                                            (PT-EXPT-IDX)         11090000
111000            MOVE RECDIS-EXPTED-ITM-QTY  TO  PT-EXPT-EXPTED-QTY    11100000
111100                                            (PT-EXPT-IDX)         11110000
111200                                            PT-EXPT-NEEDED-QTY    11120000
111300                                            (PT-EXPT-IDX)         11130000
111400            MOVE ZEROES                 TO  PT-EXPT-ALLOC-QTY     11140000
111500                                            (PT-EXPT-IDX)         11150000
111600                                            PT-EXPT-FCSE-CNT      11160000
111700                                            (PT-EXPT-IDX)         11170000
111800                                            PT-EXPT-INPK-CNT      11180000
111900                                            (PT-EXPT-IDX)         11190000
112000                                            PT-EXPT-P2L-UNTS      11200000
112100                                            (PT-EXPT-IDX)         11210000
112200                                            PT-EXPT-FCSE-UNTS     11220000
112300                                            (PT-EXPT-IDX)         11230000
112400                                            PT-EXPT-INPK-UNTS     11240000
112500                                            (PT-EXPT-IDX)         11250000
112600            IF  PV-UCC128-MAX-OTPK  =  ZEROES                     11260000
112700                MOVE  RECDIS-EXPTED-ITM-QTY                       11270000
112800                  TO  PV-NEEDED-MAX-OTPK                          11280000
112900                      PV-NEEDED-MIN-OTPK                          11290000
113000            ELSE                                                  11300000
113100            IF  RECDIS-EXPTED-ITM-QTY  >  PV-NEEDED-MAX-OTPK      11310000
113200                MOVE  RECDIS-EXPTED-ITM-QTY                       11320000
113300                  TO  PV-NEEDED-MAX-OTPK                          11330000
113400            ELSE                                                  11340000
113500            IF  RECDIS-EXPTED-ITM-QTY  <  PV-NEEDED-MIN-OTPK      11350000
113600                MOVE  RECDIS-EXPTED-ITM-QTY                       11360000
113700                  TO  PV-NEEDED-MIN-OTPK                          11370000
113800            END-IF                                                11380000
113900            END-IF                                                11390000
114000            END-IF                                                11400000
114100                                                                  11410000
114200            IF PC251-FUNC-CRE-VRTL-LBL                            11420000
114300               IF  PS-SEASET-DATA-FOUND OR                        11430000
114400                  (PV-CURRENT-DATE < XLT00010-OPN-DTE)            11440000
114500                   PERFORM 5430-CALL-SET-FIXT-ID-MOD              11450000
114600                   MOVE PC240-FIXT-ID    TO                       11460000
114700                                PT-EXPT-FIXT-ID (PT-EXPT-IDX)     11470000
114800                   MOVE PC240-SEASET-NM  TO                       11480000
114900                                PT-EXPT-SEASONAL-SET (PT-EXPT-IDX)11490000
115000               ELSE                                               11500000
115100                   MOVE SPACES           TO                       11510000
115200                        PT-EXPT-FIXT-ID (PT-EXPT-IDX)             11520000
115300                        PT-EXPT-SEASONAL-SET (PT-EXPT-IDX)        11530000
115400               END-IF                                             11540000
115500            END-IF                                                11550000
115600                                                                  11560000
115700            MOVE PS-SEASET-DATA-FOUND-SW TO                       11570000
115800                                 PT-EXPT-SEASET-IND (PT-EXPT-IDX) 11580000
115900                                                                  11590000
116000            PERFORM 7040-FETCH-EXPECT-CSR                         11600000
116100                                                                  11610000
116200     END-PERFORM.                                                 11620000
116300                                                                  11630000
116400     PERFORM 7050-CLOSE-EXPECT-CSR.                               11640000
116500                                                                  11650000
116600                                                                  11660000
116700*================================================================*11670000
116800* BUILD INITIAL EXPECTED TABLE IN DOOR SEQ                       *11680000
116900*================================================================*11690000
117000 1250-BUILD-DOOR-SEQ-TABLE.                                       11700000
117100                                                                  11710000
117200     INITIALIZE PT-STORE-EXPECT-TABLE.                            11720000
117300     SET PS-NOT-EOF-DOOR-SEQ-CSR      TO TRUE                     11730000
117400                                                                  11740000
117500     PERFORM 8030-OPEN-DOOR-SEQ-CSR.                              11750000
117600     PERFORM 8040-FETCH-DOOR-SEQ-CSR.                             11760000
117700     PERFORM                                                      11770000
117800         VARYING PT-EXPT-IDX                                      11780000
117900            FROM 1 BY 1                                           11790000
118000           UNTIL PS-EOF-DOOR-SEQ-CSR OR                           11800000
118100                 PT-EXPT-IDX > PC-MAX-EXPTED-TBL-ENTRY            11810000
118200                                                                  11820000
118300            MOVE PV-TYPE-CODE-SEQ       TO  PT-EXPT-STR-TYP-ORDER 11830000
118400                                            (PT-EXPT-IDX)         11840000
118500            MOVE RECDIS-STR-NBR         TO  PT-EXPT-STR-NBR       11850000
118600                                            (PT-EXPT-IDX)         11860000
118700            MOVE XLT00010-LOC-TYP-CDE   TO  PT-EXPT-STR-TYP       11870000
118800                                            (PT-EXPT-IDX)         11880000
118900            MOVE XLT00010-E-BUS-IND     TO  PT-EXPT-E-COMMERCE-IND11890000
119000                                            (PT-EXPT-IDX)         11900000
119100            MOVE RECDIS-EXPTED-ITM-QTY  TO  PT-EXPT-EXPTED-QTY    11910000
119200                                            (PT-EXPT-IDX)         11920000
119300                                            PT-EXPT-NEEDED-QTY    11930000
119400                                            (PT-EXPT-IDX)         11940000
119500            MOVE ZEROES                 TO  PT-EXPT-ALLOC-QTY     11950000
119600                                            (PT-EXPT-IDX)         11960000
119700                                            PT-EXPT-FCSE-CNT      11970000
119800                                            (PT-EXPT-IDX)         11980000
119900                                            PT-EXPT-INPK-CNT      11990000
120000                                            (PT-EXPT-IDX)         12000000
120100                                            PT-EXPT-P2L-UNTS      12010000
120200                                            (PT-EXPT-IDX)         12020000
120300                                            PT-EXPT-FCSE-UNTS     12030000
120400                                            (PT-EXPT-IDX)         12040000
120500                                            PT-EXPT-INPK-UNTS     12050000
120600                                            (PT-EXPT-IDX)         12060000
120700            IF  PV-UCC128-MAX-OTPK  =  ZEROES                     12070000
120800                MOVE  RECDIS-EXPTED-ITM-QTY                       12080000
120900                  TO  PV-NEEDED-MAX-OTPK                          12090000
121000                      PV-NEEDED-MIN-OTPK                          12100000
121100            ELSE                                                  12110000
121200            IF  RECDIS-EXPTED-ITM-QTY  >  PV-NEEDED-MAX-OTPK      12120000
121300                MOVE  RECDIS-EXPTED-ITM-QTY                       12130000
121400                  TO  PV-NEEDED-MAX-OTPK                          12140000
121500            ELSE                                                  12150000
121600            IF  RECDIS-EXPTED-ITM-QTY  <  PV-NEEDED-MIN-OTPK      12160000
121700                MOVE  RECDIS-EXPTED-ITM-QTY                       12170000
121800                  TO  PV-NEEDED-MIN-OTPK                          12180000
121900            END-IF                                                12190000
122000            END-IF                                                12200000
122100            END-IF                                                12210000
122200                                                                  12220000
122300            IF PC251-FUNC-CRE-VRTL-LBL                            12230000
122400               IF  PS-SEASET-DATA-FOUND OR                        12240000
122500                  (PV-CURRENT-DATE < XLT00010-OPN-DTE)            12250000
122600                   PERFORM 5430-CALL-SET-FIXT-ID-MOD              12260000
122700                   MOVE PC240-FIXT-ID    TO                       12270000
122800                                PT-EXPT-FIXT-ID (PT-EXPT-IDX)     12280000
122900                   MOVE PC240-SEASET-NM  TO                       12290000
123000                                PT-EXPT-SEASONAL-SET (PT-EXPT-IDX)12300000
123100               ELSE                                               12310000
123200                   MOVE SPACES           TO                       12320000
123300                        PT-EXPT-FIXT-ID (PT-EXPT-IDX)             12330000
123400                        PT-EXPT-SEASONAL-SET (PT-EXPT-IDX)        12340000
123500               END-IF                                             12350000
123600            END-IF                                                12360000
123700                                                                  12370000
123800            MOVE PS-SEASET-DATA-FOUND-SW TO                       12380000
123900                                 PT-EXPT-SEASET-IND (PT-EXPT-IDX) 12390000
124000                                                                  12400000
124100            PERFORM 8040-FETCH-DOOR-SEQ-CSR                       12410000
124200                                                                  12420000
124300     END-PERFORM.                                                 12430000
124400                                                                  12440000
124500     PERFORM 8050-CLOSE-DOOR-SEQ-CSR.                             12450000
124600                                                                  12460000
124700                                                                  12470000
124800*================================================================*12480000
124900* CHECK TO SEE IF ANY OF THE PACKSLIP CARTON COMBINATION UNIT    *12490000
125000* QUANTITIES = 0.  IF THERE ARE ANY FOR PO-PACKSLIP THEN THE     *12500000
125100* UCC128 DATA CANNOT BE USED BECAUSE THE CARTONS ARE EMPTY.      *12510000
125200*================================================================*12520000
125300 1275-CHECK-TSHPSUM-ZERO.                                         12530000
125400                                                                  12540000
125500     MOVE '1275-CHECK-TSHPSUM-ZERO'                               12550000
125600                                 TO PC251-ERROR-PARA-NBR          12560000
125700                                                                  12570000
125800     EXEC SQL                                                     12580000
125900          SELECT  A.PO_NBR                                        12590000
126000                 ,A.PKSL_SEQ_NBR                                  12600000
126100                 ,A.CART_COMB_NBR                                 12610000
126200                 ,SUM(A.OTPK_UNT_QTY)                             12620000
126300            INTO  :SHPSUM-PO-NBR                                  12630000
126400                 ,:SHPSUM-PKSL-SEQ-NBR                            12640000
126500                 ,:SHPSUM-CART-COMB-NBR                           12650000
126600                 ,:SHPSUM-OTPK-UNT-QTY                            12660000
126700            FROM  TSHPSUM A                                       12670000
126800                 ,TPKSLIP B                                       12680000
126900           WHERE  A.PO_NBR            = :DK-PO-NBR                12690000
127000             AND  A.PO_NBR            =  B.PO_NBR                 12700000
127100             AND  A.PKSL_SEQ_NBR      =  B.SEQ_NBR                12710000
127200             AND  B.REC_SEQ_NBR       = :DK-RCVR-SEQ-NBR          12720000
127300             AND  B.VER_STAT_CDE      = 'A'                       12730000
127400             AND  B.PKSL_STAT_CDE     = 'AC'                      12740000
127500             GROUP BY A.PO_NBR                                    12750000
127600                     ,A.PKSL_SEQ_NBR                              12760000
127700                     ,A.CART_COMB_NBR                             12770000
127800             HAVING SUM(A.OTPK_UNT_QTY) = 0                       12780000
127810          WITH UR                                                 12781000
127900     END-EXEC.                                                    12790000
128000                                                                  12800000
128100     EVALUATE TRUE                                                12810000
128200         WHEN SQLCODE = ZERO                                      12820000
128300         WHEN SQLCODE = -811                                      12830000
128400              IF  SHPSUM-OTPK-UNT-QTY  =  0                       12840000
128500                  SET  PS-ERROR                                   12850000
128600                       PC251-PREPK-UCC128-NO   TO  TRUE           12860000
128700              END-IF                                              12870000
128800                                                                  12880000
128900         WHEN SQLCODE = +100                                      12890000
129000              CONTINUE                                            12900000
129100         WHEN SQLWARN0 NOT = SPACES                               12910000
129200         WHEN SQLCODE < ZERO                                      12920000
129300         WHEN SQLCODE > ZERO                                      12930000
129400              SET  PC251-INVALID-SQL TO TRUE                      12940000
129500              MOVE SQLCODE           TO PC251-SQL-CODE            12950000
129600              MOVE 'TSHPSUM'         TO PC251-ERROR-TABLE-NME     12960000
129610              PERFORM 9000-RETURN-CALL                            12961000
129620     END-EVALUATE.                                                12962000
129630                                                                  12963000
129640                                                                  12964000
129650*================================================================*12965000
129660* PRE-PACK ROUTINE TO DETERMINE IF VALID UCC128 DATA             *12966000
129670*================================================================*12967000
129671 1300-PREPACK-ROUTINE.                                            12967100
129672                                                                  12967200
129673     PERFORM 1400-BUILD-PREPK-LNE-TBL.                            12967300
129674                                                                  12967400
129675     PERFORM 7075-OPEN-SHPSUM-CURSOR.                             12967500
129676     PERFORM 7080-FETCH-SHPSUM-CSR.                               12967600
129677                                                                  12967700
129678     IF  PS-EOF-SHPSUM-CSR                                        12967800
129679         SET  PS-ERROR               TO TRUE                      12967900
129680     ELSE                                                         12968000
129690         MOVE  SHPSUM-PO-NBR         TO  PV-PREV-PO-NBR           12969000
129700         MOVE  SHPSUM-PKSL-SEQ-NBR   TO  PV-PREV-PKSL-SEQ         12970000
129800         MOVE  SHPSUM-CART-COMB-NBR  TO  PV-PREV-COMBO-NBR        12980000
129900         MOVE  SHPSUM-OTPK-UNT-QTY   TO  PV-PREV-OTPK-QTY         12990000
130000         MOVE  SHPSUM-TOT-CART-CNT   TO  PV-PREV-CRTN-CNT         13000000
130100         SET   PS-SAME-SUMMARY-YES                                13010000
130200               PS-COMBO-LNE-IN-UNKNOWN                            13020000
130300               PS-COMBO-LNE-NOT-UNKNOWN                           13030000
130400               PS-COMBO-ENTRY-PREPK-UNK                           13040000
130500               PS-COMBO-ENTRY-NOT-PREPK-UNK TO TRUE               13050000
130600     END-IF.                                                      13060000
130700                                                                  13070000
130800     PERFORM                                                      13080000
130900       UNTIL PS-EOF-SHPSUM-CSR                                    13090000
131000          OR PS-ERROR                                             13100000
131100             PERFORM 1410-PROCESS-SUMMARY                         13110000
131200     END-PERFORM.                                                 13120000
131300                                                                  13130000
131400     PERFORM 7085-CLOSE-SHPSUM-CSR.                               13140000
131500                                                                  13150000
131600     IF  PS-NO-ERROR                                              13160000
131700         IF  PV-BEST-CASE-TBL-ENTRIES  >  0                       13170000
131800             SET  PC251-PREPK-UCC128-YES  TO  TRUE                13180000
131900             PERFORM 1470-BUILD-PREPK-UCC128                      13190000
132000             IF  PV-UCC128-MIN-OTPK  =  ZERO  AND                 13200000
132100                 PV-UCC128-MAX-OTPK  =  ZERO                      13210000
132200                 SET  PS-ERROR                                    13220000
132300                      PC251-PREPK-UCC128-NO   TO  TRUE            13230000
132400             END-IF                                               13240000
132500         ELSE                                                     13250000
132600             SET  PS-ERROR                                        13260000
132700                  PC251-PREPK-UCC128-NO   TO  TRUE                13270000
132800         END-IF                                                   13280000
132900     ELSE                                                         13290000
133000         SET  PC251-PREPK-UCC128-NO   TO  TRUE                    13300000
133100     END-IF.                                                      13310000
133200                                                                  13320000
133300                                                                  13330000
133400*================================================================*13340000
133500* BUILD TABLE CONTAINING ALL LINES FOR A PREPACK                 *13350000
133600*================================================================*13360000
133700 1400-BUILD-PREPK-LNE-TBL.                                        13370000
133800                                                                  13380000
133900     PERFORM 7060-OPEN-PREPK-CURSOR.                              13390000
134000     PERFORM 7065-FETCH-PREPK-CSR.                                13400000
134100                                                                  13410000
134200     IF  PS-EOF-PREPK-CSR                                         13420000
134300         SET  PS-ERROR  TO  TRUE                                  13430000
134400     END-IF.                                                      13440000
134500                                                                  13450000
134600     PERFORM                                                      13460000
134700         VARYING PT-PRPK-IDX                                      13470000
134800            FROM 1 BY 1                                           13480000
134900           UNTIL PS-EOF-PREPK-CSR  OR                             13490000
135000                 PT-PRPK-IDX  >  PC-MAX-PREPK-LINE-ENTRY          13500000
135100                                                                  13510000
135200            MOVE RECITM-ORD-LNE-NBR     TO PT-PREPK-LNE-NBR       13520000
135300                                           (PT-PRPK-IDX)          13530000
135400            MOVE RECITM-PREPK-RATO-QTY  TO PT-PREPK-RATIO         13540000
135500                                           (PT-PRPK-IDX)          13550000
135600            SET  PT-PREPK-DATA-AVAIL-NO    (PT-PRPK-IDX)          13560000
135700                                        TO TRUE                   13570000
135800            MOVE ZEROES                 TO PT-PREPK-RATIO-MULT    13580000
135900                                           (PT-PRPK-IDX)          13590000
136000                                           PT-PREPK-OTPK-QTY      13600000
136100                                           (PT-PRPK-IDX)          13610000
136200            PERFORM 7065-FETCH-PREPK-CSR                          13620000
136300     END-PERFORM.                                                 13630000
136400                                                                  13640000
136500     PERFORM 7070-CLOSE-PREPK-CSR.                                13650000
136600                                                                  13660000
136700                                                                  13670000
136800*================================================================*13680000
136900* PROCESS SHIPMENT SUMMARY TABLE                                 *13690000
137000*   -ENSURE ALL LINES FOR A PREPACK ARE IN CARTON                *13700000
137100*   -ENSURE ALL LINE ALLOCATIONS ARE DIVISIBLE BY LINE RATIO     *13710000
137200*   -ENSURE ALL LINES CARTON/RATIO ARE THE SAME MULTIPLE         *13720000
137300*================================================================*13730000
137400 1410-PROCESS-SUMMARY.                                            13740000
137500                                                                  13750000
137600     IF  SHPSUM-PO-NBR         =  PV-PREV-PO-NBR     AND          13760000
137700         SHPSUM-PKSL-SEQ-NBR   =  PV-PREV-PKSL-SEQ   AND          13770000
137800         SHPSUM-CART-COMB-NBR  =  PV-PREV-COMBO-NBR               13780000
137900         PERFORM 1420-CHECK-PREPK-LNE                             13790000
138000     ELSE                                                         13800000
138100         PERFORM 1425-CHECK-COMBO-ENTRIES                         13810000
138200         PERFORM 1430-RESET-PREPK-TABLE                           13820000
138300         IF  PS-NO-ERROR                                          13830000
138400             MOVE  SHPSUM-PO-NBR         TO  PV-PREV-PO-NBR       13840000
138500             MOVE  SHPSUM-PKSL-SEQ-NBR   TO  PV-PREV-PKSL-SEQ     13850000
138600             MOVE  SHPSUM-CART-COMB-NBR  TO  PV-PREV-COMBO-NBR    13860000
138700             MOVE  SHPSUM-OTPK-UNT-QTY   TO  PV-PREV-OTPK-QTY     13870000
138800             MOVE  SHPSUM-TOT-CART-CNT   TO  PV-PREV-CRTN-CNT     13880000
138900             SET   PS-COMBO-LNE-IN-UNKNOWN                        13890000
139000                   PS-COMBO-LNE-NOT-UNKNOWN                       13900000
139100                   PS-COMBO-ENTRY-PREPK-UNK                       13910000
139200                   PS-COMBO-ENTRY-NOT-PREPK-UNK  TO TRUE          13920000
139300             PERFORM 1420-CHECK-PREPK-LNE                         13930000
139400         END-IF                                                   13940000
139500     END-IF.                                                      13950000
139600                                                                  13960000
139700     IF  PS-NO-ERROR                                              13970000
139800         PERFORM 7080-FETCH-SHPSUM-CSR                            13980000
139900     END-IF.                                                      13990000
140000                                                                  14000000
140100     IF  PS-NO-ERROR                                              14010000
140200         IF  PS-EOF-SHPSUM-CSR                                    14020000
140300             PERFORM 1425-CHECK-COMBO-ENTRIES                     14030000
140400             PERFORM 1430-RESET-PREPK-TABLE                       14040000
140500         END-IF                                                   14050000
140600     END-IF.                                                      14060000
140700                                                                  14070000
140800                                                                  14080000
140900                                                                  14090000
141000*================================================================*14100000
141100* CHECK TO SEE IF CARTON COMBINATION IS FOR LINE WITHIN THE PRE- *14110000
141200* PACK                                                           *14120000
141300*================================================================*14130000
141400 1420-CHECK-PREPK-LNE.                                            14140000
141500                                                                  14150000
141600     SET  PS-COMBO-LNE-IN-UNKNOWN                                 14160000
141700          PS-COMBO-LNE-NOT-UNKNOWN                                14170000
141800          PS-NO-RATIO-REMAINDER-ERROR TO  TRUE                    14180000
141900                                                                  14190000
142000     PERFORM                                                      14200000
142100        VARYING PT-PRPK-IDX                                       14210000
142200           FROM 1  BY  1                                          14220000
142300          UNTIL PT-PRPK-IDX  >  PV-PREPK-TABLE-ENTRIES            14230000
142400             OR PS-ERROR                                          14240000
142500                IF  PT-PREPK-LNE-NBR (PT-PRPK-IDX) =              14250000
142600                    SHPSUM-PO-LNE-NBR                             14260000
142700                    SET  PS-COMBO-LNE-IN-PREPK                    14270000
142800                         PS-COMBO-ENTRY-PREPK                     14280000
142900                         PT-PREPK-DATA-AVAIL-YES (PT-PRPK-IDX)    14290000
143000                                                 TO  TRUE         14300000
143100                    DIVIDE  SHPSUM-OTPK-UNT-QTY                   14310000
143200                        BY  PT-PREPK-RATIO       (PT-PRPK-IDX)    14320000
143300                    GIVING  PT-PREPK-RATIO-MULT  (PT-PRPK-IDX)    14330000
143400                    REMAINDER  PV-PREPK-REMAINDER                 14340000
143500                    MOVE  SHPSUM-OTPK-UNT-QTY                     14350000
143600                      TO  PT-PREPK-OTPK-QTY (PT-PRPK-IDX)         14360000
143700                    IF  PV-PREPK-REMAINDER  >  0                  14370000
143800                       SET  PS-RATIO-REMAINDER-ERROR              14380000
143900                            PS-ERROR                 TO  TRUE     14390000
144000                    END-IF                                        14400000
144100                END-IF                                            14410000
144200     END-PERFORM.                                                 14420000
144300                                                                  14430000
144400*  IF COMBINATION LINE ENTRY IS NOT IN PREPACK SET SWITCH         14440000
144500*  INDICATING COMBINATION HAS ENTRIES OUTSIDE OF PREPK            14450000
144600                                                                  14460000
144700     IF  PS-COMBO-LNE-IN-UNKNOWN   AND                            14470000
144800         PS-COMBO-LNE-NOT-UNKNOWN                                 14480000
144900         SET  PS-COMBO-ENTRY-NOT-PREPK  TO  TRUE                  14490000
145000     END-IF.                                                      14500000
145100                                                                  14510000
145200                                                                  14520000
145300*================================================================*14530000
145400* CHECK CARTON COMBINATION ENTRY                                 *14540000
145500*    - HAS ENTRIES FOR PREPACK                                   *14550000
145600*    - HAS ENTRIES FOR PREPACK & HAS ENTRIES NOT IN PREPACK      *14560000
145700*================================================================*14570000
145800 1425-CHECK-COMBO-ENTRIES.                                        14580000
145900                                                                  14590000
146000     IF  PS-COMBO-ENTRY-PREPK-UNK                                 14600000
146100         CONTINUE                                                 14610000
146200     ELSE                                                         14620000
146300     IF  PS-COMBO-ENTRY-PREPK  AND                                14630000
146400         PS-COMBO-ENTRY-NOT-PREPK                                 14640000
146500         SET  PS-ERROR                                            14650000
146600              PC251-ERR-LNES-NOT-PRPK  TO  TRUE                   14660000
146700     ELSE                                                         14670000
146800         PERFORM 1440-CHECK-LINE-RATIO                            14680000
146900         IF  PS-SAME-RATIO-MULT  AND                              14690000
147000             PS-ENTRIES-ALL-PREPK                                 14700000
147100             PERFORM 1445-POPULATE-BEST-CASE                      14710000
147200         END-IF                                                   14720000
147300     END-IF.                                                      14730000
147400                                                                  14740000
147500                                                                  14750000
147600*================================================================*14760000
147700* RESET LINE ENTRIES IN PREPK LINE TABLE                         *14770000
147800*================================================================*14780000
147900 1430-RESET-PREPK-TABLE.                                          14790000
148000                                                                  14800000
148100     PERFORM                                                      14810000
148200        VARYING PT-PRPK-IDX                                       14820000
148300           FROM 1  BY  1                                          14830000
148400          UNTIL PT-PRPK-IDX  >  PV-PREPK-TABLE-ENTRIES            14840000
148500             OR PS-ERROR                                          14850000
148600                SET  PT-PREPK-DATA-AVAIL-NO (PT-PRPK-IDX)         14860000
148700                            TO  TRUE                              14870000
148800                MOVE ZEROES TO PT-PREPK-RATIO-MULT (PT-PRPK-IDX)  14880000
148900     END-PERFORM.                                                 14890000
149000                                                                  14900000
149100                                                                  14910000
149200*================================================================*14920000
149300* CHECK TO MAKE SURE THAT ALL LINE HAVE THE SAME RATIO MULTIPLE  *14930000
149400*================================================================*14940000
149500 1440-CHECK-LINE-RATIO.                                           14950000
149600                                                                  14960000
149700     MOVE  PT-PREPK-RATIO-MULT(+1)  TO  PV-RATIO-MULTIPLE.        14970000
149800     SET   PS-SAME-RATIO-MULT                                     14980000
149900           PS-ENTRIES-ALL-PREPK     TO  TRUE.                     14990000
150000     MOVE  ZEROES                   TO  PV-TOTAL-PREPK-OTPK       15000000
150100                                        PV-DRVR-LNE-OTPK          15010000
150200                                        PV-DRVR-LNE-RATIO-MULT.   15020000
150300                                                                  15030000
150400     PERFORM                                                      15040000
150500        VARYING PT-PRPK-IDX                                       15050000
150600           FROM 1  BY  1                                          15060000
150700          UNTIL PT-PRPK-IDX  >  PV-PREPK-TABLE-ENTRIES            15070000
150800             OR PS-ERROR                                          15080000
150900                IF  PT-PREPK-DATA-AVAIL-NO (PT-PRPK-IDX)          15090000
151000                    SET  PS-ENTRIES-MIS-PREPK TO TRUE             15100000
151100                ELSE                                              15110000
151200                    ADD PT-PREPK-OTPK-QTY   (PT-PRPK-IDX)         15120000
151300                     TO PV-TOTAL-PREPK-OTPK                       15130000
151400                    IF  PT-PREPK-LNE-NBR    (PT-PRPK-IDX)  =      15140000
151500                        PC251-PO-LNE-NBR                          15150000
151600                        MOVE PT-PREPK-OTPK-QTY (PT-PRPK-IDX)      15160000
151700                          TO PV-DRVR-LNE-OTPK                     15170000
151800                        MOVE PT-PREPK-RATIO-MULT (PT-PRPK-IDX)    15180000
151900                          TO PV-DRVR-LNE-RATIO-MULT               15190000
152000                    END-IF                                        15200000
152100                    IF  PT-PREPK-RATIO-MULT (PT-PRPK-IDX)  =      15210000
152200                        PV-RATIO-MULTIPLE                         15220000
152300                        CONTINUE                                  15230000
152400                    ELSE                                          15240000
152500                        SET  PS-DIFF-RATIO-MULT    TO  TRUE       15250000
152600                    END-IF                                        15260000
152700                END-IF                                            15270000
152800     END-PERFORM.                                                 15280000
152900                                                                  15290000
153000     IF  PS-ENTRIES-ALL-PREPK  AND                                15300000
153100         PS-DIFF-RATIO-MULT                                       15310000
153200         SET  PS-ERROR        TO  TRUE                            15320000
153300     END-IF.                                                      15330000
153400                                                                  15340000
153500                                                                  15350000
153600*================================================================*15360000
153700* RESET LINE ENTRIES IN PREPK LINE TABLE                         *15370000
153800*================================================================*15380000
153900 1445-POPULATE-BEST-CASE.                                         15390000
154000                                                                  15400000
154100                                                                  15410000
154200     MOVE PV-PREV-COMBO-NBR             TO  PT-BEST-CRTN-COMB     15420000
154300                                            (PT-BEST-IDX).        15430000
154400     MOVE PV-DRVR-LNE-RATIO-MULT        TO  PT-BEST-RATIO-MULT    15440000
154500                                            (PT-BEST-IDX).        15450000
154600     MOVE PV-PREV-CRTN-CNT              TO  PT-BEST-CRTN-CNT      15460000
154700                                            (PT-BEST-IDX).        15470000
154800     MOVE PV-DRVR-LNE-OTPK              TO  PT-BEST-DRVR-LNE-OTPK 15480000
154900                                            (PT-BEST-IDX).        15490000
155000     MOVE PV-DRVR-LNE-OTPK              TO  PT-BEST-OTPK-QTY      15500000
155100                                            (PT-BEST-IDX).        15510000
155200     MULTIPLY  PT-BEST-OTPK-QTY (PT-BEST-IDX)                     15520000
155300           BY  PT-BEST-CRTN-CNT (PT-BEST-IDX)                     15530000
155400       GIVING  PT-BEST-EXTEND-UNTS (PT-BEST-IDX)                  15540000
155500                                                                  15550000
155600     ADD  1  TO  PV-BEST-CASE-TBL-ENTRIES.                        15560000
155700     SET  PT-BEST-IDX  UP BY +1.                                  15570000
155800                                                                  15580000
155900                                                                  15590000
156000*================================================================*15600000
156100* BUILD UCC128 DATA FOR PREPK FROM BEST CASE TABLE               *15610000
156200*================================================================*15620000
156300 1470-BUILD-PREPK-UCC128.                                         15630000
156400                                                                  15640000
156500     PERFORM                                                      15650000
156600       VARYING PT-BEST-IDX                                        15660000
156700          FROM 1 BY 1                                             15670000
156800         UNTIL PT-BEST-IDX  >  PC-MAX-BEST-CASE-ENTRY             15680000
156900            OR PT-BEST-IDX  >  PV-BEST-CASE-TBL-ENTRIES           15690000
157000               IF  PT-BEST-CRTN-CNT (PT-BEST-IDX)  >  0           15700000
157100                   SET  PT-U128-IDX TO PT-BEST-IDX                15710000
157200                   MOVE PT-BEST-CRTN-CNT (PT-BEST-IDX)            15720000
157300                     TO PT-UCC128-CRTNS  (PT-U128-IDX)            15730000
157400                   MOVE PT-BEST-OTPK-QTY (PT-BEST-IDX)            15740000
157500                     TO PT-UCC128-OTPK   (PT-U128-IDX)            15750000
157600                   ADD  1  TO  PV-UCC128-TABLE-ENTRIES            15760000
157700                   ADD  PT-BEST-CRTN-CNT (PT-BEST-IDX)            15770000
157800                    TO  PV-TOTAL-CARTON-COUNT                     15780000
157900                   IF  PV-UCC128-MAX-OTPK = ZEROES                15790000
158000                       MOVE PT-BEST-OTPK-QTY (PT-BEST-IDX)        15800000
158100                         TO PV-UCC128-MAX-OTPK                    15810000
158200                            PV-UCC128-MIN-OTPK                    15820000
158300                   ELSE                                           15830000
158400                   IF  PT-BEST-OTPK-QTY (PT-BEST-IDX)             15840000
158500                                      >  PV-UCC128-MAX-OTPK       15850000
158600                       MOVE PT-BEST-OTPK-QTY (PT-BEST-IDX)        15860000
158700                         TO PV-UCC128-MAX-OTPK                    15870000
158800                   ELSE                                           15880000
158900                   IF  PT-BEST-OTPK-QTY (PT-BEST-IDX)             15890000
159000                                       <  PV-UCC128-MIN-OTPK      15900000
159100                       MOVE PT-BEST-OTPK-QTY (PT-BEST-IDX)        15910000
159200                         TO PV-UCC128-MIN-OTPK                    15920000
159300                   END-IF                                         15930000
159400                   END-IF                                         15940000
159500                   END-IF                                         15950000
159600               END-IF                                             15960000
159700     END-PERFORM.                                                 15970000
159800                                                                  15980000
159900                                                                  15990000
160000*================================================================*16000000
160100* CALCULATE LABEL COUNT - PROCESSING SML & P2L LABELS            *16010000
160200*================================================================*16020000
160300 2000-CREATE-SML-P2L.                                             16030000
160400                                                                  16040000
160500      IF  PC251-PRT-SHUFFLED                                      16050000
160600          PERFORM 4000-SML-FULLCASE-MATCH                         16060000
160700      END-IF.                                                     16070000
160800                                                                  16080000
160900* DISTRIBUTION CENTER AND RETURN TO VENDOR NEED TO BE IN FULLCASE 16090000
161000* ALLOCATIONS.  IF NOT ALL ALLOCATED FORCE AN ERROR.              16100000
161100      PERFORM                                                     16110000
161200        VARYING PT-EXPT-IDX                                       16120000
161300           FROM 1  BY  1                                          16130000
161400          UNTIL PT-EXPT-IDX  >  PV-EXPECT-TABLE-ENTRIES           16140000
161500                IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX) >  ZERO  AND 16150000
161600                    PT-EXPT-STR-TYP (PT-EXPT-IDX) = ('DC' OR 'RV')16160000
161700                    SET  PS-ERROR  TO  TRUE                       16170000
161800                    SET  PC251-ERR-DC-RTV-NOT-OTPK  TO  TRUE      16180000
161900                END-IF                                            16190000
162000      END-PERFORM.                                                16200000
162100                                                                  16210000
162200      IF  PV-FCSE-ALLOCATED  =  PC251-TOTAL-CARTONS  OR           16220000
162300          PS-ERROR                                                16230000
162400          CONTINUE                                                16240000
162500      ELSE                                                        16250000
162600      IF  PC251-PRT-SHUFFLED                                      16260000
162700          PERFORM 3000-SHUFFLED-SEQUENCE                          16270000
162800      ELSE                                                        16280000
162900      IF  PC251-PRT-STR-SEQ OR PC251-PRT-DOOR-SEQ                 16290000
163000          PERFORM 3100-STORE-SEQUENCE                             16300000
163100      END-IF                                                      16310000
163200      END-IF                                                      16320000
163300      END-IF.                                                     16330000
163400                                                                  16340000
163500                                                                  16350000
163600*================================================================*16360000
163700* CALCULATE LABEL COUNT - PROCESSING SML LABELS ONLY             *16370000
163800*================================================================*16380000
163900 2200-CREATE-SML-ONLY.                                            16390000
164000                                                                  16400000
164100      IF  PC251-PRT-SHUFFLED                                      16410000
164200          PERFORM 4000-SML-FULLCASE-MATCH                         16420000
164300*         PERFORM 4010-SML-FULLCASE-MATCH-STR                     16430000
164400      END-IF.                                                     16440000
164500                                                                  16450000
164600* DISTRIBUTION CENTER AND RETURN TO VENDOR NEED TO BE IN FULLCASE 16460000
164700* ALLOCATIONS.  IF NOT ALL ALLOCATED FORCE AN ERROR.              16470000
164800                                                                  16480000
164900     PERFORM                                                      16490000
165000        VARYING PT-EXPT-IDX                                       16500000
165100           FROM 1  BY  1                                          16510000
165200          UNTIL PT-EXPT-IDX  >  PV-EXPECT-TABLE-ENTRIES           16520000
165300                IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX) >  ZERO  AND 16530000
165400                    PT-EXPT-STR-TYP (PT-EXPT-IDX) = ('DC' OR 'RV')16540000
165500                    SET  PS-ERROR  TO  TRUE                       16550000
165600                END-IF                                            16560000
165700     END-PERFORM.                                                 16570000
165800                                                                  16580000
165900      IF  PV-FCSE-ALLOCATED  =  PC251-TOTAL-CARTONS  OR           16590000
166000          PS-ERROR                                                16600000
166100          CONTINUE                                                16610000
166200      ELSE                                                        16620000
166300      IF  PC251-PRT-SHUFFLED                                      16630000
166400          PERFORM 3000-SHUFFLED-SEQUENCE                          16640000
166500      ELSE                                                        16650000
166600      IF  PC251-PRT-STR-SEQ OR PC251-PRT-DOOR-SEQ                 16660000
166700          PERFORM 3100-STORE-SEQUENCE                             16670000
166800      END-IF                                                      16680000
166900      END-IF                                                      16690000
167000      END-IF.                                                     16700000
167100                                                                  16710000
167200                                                                  16720000
167300*================================================================*16730000
167400* CALCULATE LABEL COUNT - PROCESSING P2L LABELS ONLY             *16740000
167500*================================================================*16750000
167600 2400-CREATE-P2L-ONLY.                                            16760000
167700                                                                  16770000
167800* CENTRAL STOCK ALLOCATION                                        16780000
167900                                                                  16790000
168000     PERFORM                                                      16800000
168100        VARYING PT-EXPT-IDX                                       16810000
168200           FROM 1  BY  1                                          16820000
168300          UNTIL PT-EXPT-IDX  >  PV-EXPECT-TABLE-ENTRIES           16830000
168400                IF  PT-EXPT-EXPTED-QTY (PT-EXPT-IDX) >=           16840000
168500                    PV-UCC128-MIN-OTPK                  AND       16850000
168600                   (PT-EXPT-CENTRL-STCK (PT-EXPT-IDX) OR          16860000
168700                    PT-EXPT-E-COMMERCE  (PT-EXPT-IDX))            16870000
168800                    PERFORM 4120-SML-CS                           16880000
168900                END-IF                                            16890000
169000     END-PERFORM.                                                 16900000
169100                                                                  16910000
169200* P2L ALLOCATIONS                                                 16920000
169300                                                                  16930000
169400     MOVE  ZEROES  TO  PV-P2L-QTY-NEEDED.                         16940000
169500     PERFORM                                                      16950000
169600       VARYING PT-EXPT-IDX                                        16960000
169700          FROM 1 BY 1                                             16970000
169800         UNTIL PT-EXPT-IDX > PV-EXPECT-TABLE-ENTRIES              16980000
169900            IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX) > 0              16990000
170000                ADD  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)             17000000
170100                 TO  PV-P2L-QTY-NEEDED                            17010000
170200            END-IF                                                17020000
170300     END-PERFORM                                                  17030000
170400                                                                  17040000
170500     IF  PV-P2L-QTY-NEEDED  >  0                                  17050000
170600         PERFORM 4300-SPLIT-P2L-UNITS                             17060000
170700     END-IF.                                                      17070000
170800                                                                  17080000
170900                                                                  17090000
171000*================================================================*17100000
171100* SUM THE LABEL QUANTITIES TO SEND BACK TO CASEPACK SPLIT LIST   *17110000
171200*================================================================*17120000
171300 2600-SUM-LBL-QTYS.                                               17130000
171400                                                                  17140000
171500      PERFORM                                                     17150000
171600         VARYING PT-EXPT-IDX                                      17160000
171700            FROM 1 BY 1                                           17170000
171800           UNTIL PT-EXPT-IDX  >  PV-EXPECT-TABLE-ENTRIES          17180000
171900                 IF  PT-EXPT-STR-TYP (PT-EXPT-IDX)  =  'DC'       17190000
172000                     ADD  PT-EXPT-ALLOC-QTY (PT-EXPT-IDX)         17200000
172100                      TO  PV-DC-BOUND-UNTS                        17210000
172200                     ADD   PT-EXPT-FCSE-CNT (PT-EXPT-IDX)         17220000
172300                      TO  PV-DC-BOUND-CTNS                        17230000
172400                 ELSE                                             17240000
172500                 IF  PT-EXPT-STR-TYP (PT-EXPT-IDX)  =  'RV'       17250000
172600                     ADD  PT-EXPT-ALLOC-QTY (PT-EXPT-IDX)         17260000
172700                      TO  PV-RTV-BOUND-UNTS                       17270000
172800                     ADD  PT-EXPT-FCSE-CNT (PT-EXPT-IDX)          17280000
172900                      TO  PV-RTV-BOUND-CTNS                       17290000
173000                 ELSE                                             17300000
173100                 IF (PT-EXPT-CENTRL-STCK (PT-EXPT-IDX) OR         17310000
173200                     PT-EXPT-E-COMMERCE  (PT-EXPT-IDX))           17320000
173300                     ADD  PT-EXPT-ALLOC-QTY (PT-EXPT-IDX)         17330000
173400                      TO  PV-CS-BOUND-UNTS                        17340000
173500                     ADD  PT-EXPT-FCSE-CNT (PT-EXPT-IDX)          17350000
173600                      TO  PV-CS-BOUND-CTNS                        17360000
173700                 END-IF                                           17370000
173800                 END-IF                                           17380000
173900                 END-IF                                           17390000
174000     END-PERFORM.                                                 17400000
174100                                                                  17410000
174200     PERFORM                                                      17420000
174300        VARYING PT-CRTN-IDX                                       17430000
174400           FROM 1 BY 1                                            17440000
174500          UNTIL PT-CRTN-IDX  >  PV-CARTON-TABLE-ENTRIES           17450000
174600                EVALUATE TRUE                                     17460000
174700                    WHEN PT-CRTN-SML      (PT-CRTN-IDX)  AND      17470000
174800                         PT-CRTN-FCSE-SML (PT-CRTN-IDX)           17480000
174900                         ADD 1 TO  PV-FCSE-CRTN-CNT               17490000
175000                    WHEN PT-CRTN-SML      (PT-CRTN-IDX)  AND      17500000
175100                         PT-CRTN-INPK-SML (PT-CRTN-IDX)           17510000
175200                         ADD 1 TO  PV-INPK-CRTN-CNT               17520000
175300                    WHEN PT-CRTN-P2L      (PT-CRTN-IDX)           17530000
175400                         ADD 1 TO  PV-P2L-CRTN-CNT                17540000
175500                END-EVALUATE                                      17550000
175600     END-PERFORM.                                                 17560000
175700                                                                  17570000
175800                                                                  17580000
175900*================================================================*17590000
176000* CALCULATE LABEL COUNT - SHUFFLED SEQUENCE                      *17600000
176100*================================================================*17610000
176200 3000-SHUFFLED-SEQUENCE.                                          17620000
176300                                                                  17630000
176400     PERFORM 4200-GET-MAX-MIN-NEEDED.                             17640000
176500                                                                  17650000
176600* PROCESS STORE EXPECTED TABLE TO SEE IF STORES ALLOCATION CAN BE 17660000
176700* PARTIALLY FILLED BY FULLCASE - BASED ON UCC128 DATA TABLE.      17670000
176800                                                                  17680000
176900     IF  PV-NEEDED-MAX-OTPK >  ZERO    AND                        17690000
177000         PV-NEEDED-MAX-OTPK >= PV-UCC128-MIN-OTPK                 17700000
177100         PERFORM                                                  17710000
177200           UNTIL PV-NEEDED-MAX-OTPK < PV-UCC128-MIN-OTPK          17720000
177300              OR PV-FCSE-ALLOCATED  =  PC251-TOTAL-CARTONS        17730000
177400              OR PV-UCC128-MIN-OTPK =  ZEROES                     17740000
177500                 PERFORM                                          17750000
177600                 VARYING  PT-EXPT-IDX                             17760000
177700                    FROM  1 BY 1                                  17770000
177800                   UNTIL  PT-EXPT-IDX > PV-EXPECT-TABLE-ENTRIES   17780000
177900                      IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX) > 0    17790000
178000                          OR  PS-ERROR                            17800000
178100                          PERFORM 4170-SML-FCSE-PARTIAL           17810000
178200                      END-IF                                      17820000
178300                 END-PERFORM                                      17830000
178400                 PERFORM 4200-GET-MAX-MIN-NEEDED                  17840000
178500         END-PERFORM                                              17850000
178600     END-IF.                                                      17860000
178700                                                                  17870000
178800* PROCESS STORE EXPECTED TABLE TO SEE IF STORES ALLOCATION CAN BE 17880000
178900* PARTIALLY FILLED BY INNER-PACKS - BASED ON UCC128 DATA TABLE.   17890000
179000* ONLY IF INNERPACK CONVEYABLE                                    17900000
179100                                                                  17910000
179200     IF  PV-NEEDED-MAX-OTPK = ZERO    OR                          17920000
179300         PV-FCSE-ALLOCATED  =  PC251-TOTAL-CARTONS                17930000
179400         CONTINUE                                                 17940000
179500     ELSE                                                         17950000
179600     IF  PC251-INPK-CNVY-YES                                      17960000
179700         MOVE  PC251-INPK-UNT-QTY  TO  PV-UCC128-MIN-OTPK         17970000
179800                                       PV-UCC128-MAX-OTPK         17980000
179900         PERFORM 4200-GET-MAX-MIN-NEEDED                          17990000
180000         IF  PV-NEEDED-MAX-OTPK  >=  PV-UCC128-MIN-OTPK           18000000
180100             PERFORM                                              18010000
180200               UNTIL PV-NEEDED-MAX-OTPK    < PV-UCC128-MIN-OTPK   18020000
180300                  OR PV-FCSE-ALLOCATED = PC251-TOTAL-CARTONS      18030000
180400                     PERFORM                                      18040000
180500                     VARYING PT-EXPT-IDX                          18050000
180600                        FROM 1 BY 1                               18060000
180700                       UNTIL PT-EXPT-IDX > PV-EXPECT-TABLE-ENTRIES18070000
180800                          IF PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)     18080000
180900                                 >  0 AND                         18090000
181000                             PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)     18100000
181100                                 >= PV-UCC128-MIN-OTPK            18110000
181200                                 PERFORM 4190-SML-INPK-PARTIAL    18120000
181300                                 PERFORM 4200-GET-MAX-MIN-NEEDED  18130000
181400                         END-IF                                   18140000
181500                     END-PERFORM                                  18150000
181600             END-PERFORM                                          18160000
181700         END-IF                                                   18170000
181800     END-IF                                                       18180000
181900     END-IF.                                                      18190000
182000                                                                  18200000
182100* PROCESS STORE EXPECTED TABLE TO SEE IF STORES STILL NEED        18210000
182200* ALLOCATIONS.  THESE WILL BE SENT TO P2L.                        18220000
182300                                                                  18230000
182400     MOVE  ZEROES  TO  PV-P2L-QTY-NEEDED.                         18240000
182500     PERFORM                                                      18250000
182600       VARYING PT-EXPT-IDX                                        18260000
182700          FROM 1 BY 1                                             18270000
182800         UNTIL PT-EXPT-IDX > PV-EXPECT-TABLE-ENTRIES              18280000
182900            IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX) > 0              18290000
183000                ADD  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)             18300000
183100                 TO  PV-P2L-QTY-NEEDED                            18310000
183200            END-IF                                                18320000
183300     END-PERFORM                                                  18330000
183400                                                                  18340000
183500     IF  PV-P2L-QTY-NEEDED  >  0                                  18350000
183600         PERFORM 4300-SPLIT-P2L-UNITS                             18360000
183700     END-IF.                                                      18370000
183800                                                                  18380000
183900                                                                  18390000
184000*================================================================*18400000
184100* CALCULATE LABEL COUNT - STORE ORDER SEQUENCE                   *18410000
184200*================================================================*18420000
184300 3100-STORE-SEQUENCE.                                             18430000
184400                                                                  18440000
184500     PERFORM 4200-GET-MAX-MIN-NEEDED.                             18450000
184600                                                                  18460000
184700* PROCESS STORE EXPECTED TABLE TO SEE IF STORES ALLOCATION CAN BE 18470000
184800* PARTIALLY FILLED BY FULLCASE - BASED ON UCC128 DATA TABLE.      18480000
184900                                                                  18490000
185000     IF  PV-NEEDED-MAX-OTPK >  ZERO  AND                          18500000
185100         PV-NEEDED-MAX-OTPK >= PV-UCC128-MIN-OTPK                 18510000
185200         PERFORM                                                  18520000
185300           UNTIL PV-NEEDED-MAX-OTPK < PV-UCC128-MIN-OTPK          18530000
185400              OR PV-FCSE-ALLOCATED  =  PC251-TOTAL-CARTONS        18540000
185500              OR PV-UCC128-MIN-OTPK =  ZEROES                     18550000
185600                 PERFORM                                          18560000
185700                 VARYING  PT-EXPT-IDX                             18570000
185800                    FROM  1 BY 1                                  18580000
185900                   UNTIL  PT-EXPT-IDX > PV-EXPECT-TABLE-ENTRIES   18590000
186000                      IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX) > 0    18600000
186100                          PERFORM                                 18610000
186200                            UNTIL PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)18620000
186300                                  = 0                             18630000
186400                               OR PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)18640000
186500                                  <  PV-UCC128-MIN-OTPK           18650000
186600                               OR (PV-UCC128-MIN-OTPK  =  0  AND  18660000
186700                                   PV-UCC128-MAX-OTPK  =  0)      18670000
186800                               OR  PS-ERROR                       18680000
186900                                  PERFORM 4170-SML-FCSE-PARTIAL   18690000
187000                          END-PERFORM                             18700000
187100                      END-IF                                      18710000
187200                 END-PERFORM                                      18720000
187300                 PERFORM 4200-GET-MAX-MIN-NEEDED                  18730000
187400         END-PERFORM                                              18740000
187500     END-IF.                                                      18750000
187600                                                                  18760000
187700* PROCESS STORE EXPECTED TABLE TO SEE IF STORES ALLOCATION CAN BE 18770000
187800* PARTIALLY FILLED BY INNER-PACKS - BASED ON UCC128 DATA TABLE.   18780000
187900* ONLY IF INNERPACK CONVEYABLE                                    18790000
188000                                                                  18800000
188100     IF  PV-NEEDED-MAX-OTPK =  ZERO  OR                           18810000
188200         PV-FCSE-ALLOCATED  =  PC251-TOTAL-CARTONS                18820000
188300         CONTINUE                                                 18830000
188400     ELSE                                                         18840000
188500     IF  PC251-INPK-CNVY-YES                                      18850000
188600         MOVE  PC251-INPK-UNT-QTY  TO  PV-UCC128-MIN-OTPK         18860000
188700                                       PV-UCC128-MAX-OTPK         18870000
188800         PERFORM 4200-GET-MAX-MIN-NEEDED                          18880000
188900         IF  PV-NEEDED-MAX-OTPK  >=  PV-UCC128-MIN-OTPK           18890000
189000             PERFORM                                              18900000
189100               UNTIL PV-NEEDED-MAX-OTPK < PV-UCC128-MIN-OTPK      18910000
189200                  OR PV-FCSE-ALLOCATED  = PC251-TOTAL-CARTONS     18920000
189300                     PERFORM                                      18930000
189400                     VARYING PT-EXPT-IDX                          18940000
189500                        FROM 1 BY 1                               18950000
189600                       UNTIL PT-EXPT-IDX > PV-EXPECT-TABLE-ENTRIES18960000
189700                          IF PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)     18970000
189800                                 >  0 AND                         18980000
189900                             PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)     18990000
190000                                 >= PV-UCC128-MIN-OTPK            19000000
190100                                 PERFORM                          19010000
190200                                   UNTIL PT-EXPT-NEEDED-QTY       19020000
190300                                         (PT-EXPT-IDX) = 0        19030000
190400                                      OR PT-EXPT-NEEDED-QTY       19040000
190500                                         (PT-EXPT-IDX) <          19050000
190600                                             PV-UCC128-MIN-OTPK   19060000
190700                                         PERFORM                  19070000
190800                                            4190-SML-INPK-PARTIAL 19080000
190900                                 END-PERFORM                      19090000
191000                                 PERFORM 4200-GET-MAX-MIN-NEEDED  19100000
191100                         END-IF                                   19110000
191200                     END-PERFORM                                  19120000
191300             END-PERFORM                                          19130000
191400         END-IF                                                   19140000
191500     END-IF                                                       19150000
191600     END-IF.                                                      19160000
191700                                                                  19170000
191800* PROCESS STORE EXPECTED TABLE TO SEE IF STORES STILL NEED        19180000
191900* ALLOCATIONS.  THESE WILL BE SENT TO P2L.                        19190000
192000                                                                  19200000
192100     MOVE  ZEROES  TO  PV-P2L-QTY-NEEDED.                         19210000
192200     PERFORM                                                      19220000
192300       VARYING PT-EXPT-IDX                                        19230000
192400          FROM 1 BY 1                                             19240000
192500         UNTIL PT-EXPT-IDX > PV-EXPECT-TABLE-ENTRIES              19250000
192600            IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX) > 0              19260000
192700                ADD  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)             19270000
192800                 TO  PV-P2L-QTY-NEEDED                            19280000
192900            END-IF                                                19290000
193000     END-PERFORM                                                  19300000
193100                                                                  19310000
193200     IF  PV-P2L-QTY-NEEDED  >  0                                  19320000
193300         PERFORM 4300-SPLIT-P2L-UNITS                             19330000
193400     END-IF.                                                      19340000
193500                                                                  19350000
193600                                                                  19360000
193700*================================================================*19370000
193800* CHECK TO SEE IF ALLOCATION CAN BE FILLED COMPLETELY BY 1 FCSE  *19380000
193900*================================================================*19390000
194000 4000-SML-FULLCASE-MATCH.                                         19400000
194100                                                                  19410000
194200* DISTRIBUTION CENTER ALLOCATION                                  19420000
194300                                                                  19430000
194400     PERFORM                                                      19440000
194500        WITH TEST AFTER                                           19450000
194600        VARYING PT-EXPT-IDX                                       19460000
194700           FROM 1  BY  1                                          19470000
194800          UNTIL PT-EXPT-IDX  >  PV-EXPECT-TABLE-ENTRIES           19480000
194900                IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX) >=           19490000
195000                    PV-UCC128-MIN-OTPK                  AND       19500000
195100                    PT-EXPT-STR-TYP (PT-EXPT-IDX)  =  'DC'        19510000
195200                    PERFORM 4100-SML-DC-RV                        19520000
195300                END-IF                                            19530000
195400     END-PERFORM.                                                 19540000
195500                                                                  19550000
195600* RETURN TO VENDOR ALLOCATION                                     19560000
195700                                                                  19570000
195800     PERFORM                                                      19580000
195900        WITH TEST AFTER                                           19590000
196000        VARYING PT-EXPT-IDX                                       19600000
196100           FROM 1  BY  1                                          19610000
196200          UNTIL PT-EXPT-IDX  >  PV-EXPECT-TABLE-ENTRIES           19620000
196300                IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX) >=           19630000
196400                    PV-UCC128-MIN-OTPK                  AND       19640000
196500                    PT-EXPT-STR-TYP (PT-EXPT-IDX)  =  'RV'        19650000
196600                    PERFORM 4100-SML-DC-RV                        19660000
196700                END-IF                                            19670000
196800     END-PERFORM.                                                 19680000
196900                                                                  19690000
197000* CENTRAL STOCK ALLOCATION                                        19700000
197100                                                                  19710000
197200     PERFORM                                                      19720000
197300        WITH TEST AFTER                                           19730000
197400        VARYING PT-EXPT-IDX                                       19740000
197500           FROM 1  BY  1                                          19750000
197600          UNTIL PT-EXPT-IDX  >  PV-EXPECT-TABLE-ENTRIES           19760000
197700                IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX) >=           19770000
197800                    PV-UCC128-MIN-OTPK                  AND       19780000
197900                   (PT-EXPT-CENTRL-STCK (PT-EXPT-IDX) OR          19790000
198000                    PT-EXPT-E-COMMERCE  (PT-EXPT-IDX))            19800000
198100                    PERFORM 4120-SML-CS                           19810000
198200                END-IF                                            19820000
198300     END-PERFORM.                                                 19830000
198400                                                                  19840000
198500******************************************************************19850000
198600 4010-SML-FULLCASE-MATCH-STR.                                     19860000
198700******************************************************************19870000
198800* STORE ALLOCATION                                                19880000
198900                                                                  19890000
199000     PERFORM                                                      19900000
199100        WITH TEST AFTER                                           19910000
199200        VARYING PT-EXPT-IDX                                       19920000
199300           FROM 1  BY  1                                          19930000
199400          UNTIL PT-EXPT-IDX  >  PV-EXPECT-TABLE-ENTRIES           19940000
199500                IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX) >=           19950000
199600                    PV-UCC128-MIN-OTPK                            19960000
199700                    PERFORM 4150-SML-FCSE-MATCH                   19970000
199800                END-IF                                            19980000
199900     END-PERFORM.                                                 19990000
200000                                                                  20000000
200100                                                                  20010000
200200                                                                  20020000
200300*================================================================*20030000
200400* PROCESS DISTRIBUTION CENTER & RETURN TO VENDOR FULLCASE MATCH  *20040000
200500*================================================================*20050000
200600 4100-SML-DC-RV.                                                  20060000
200700                                                                  20070000
200800     PERFORM 4150-SML-FCSE-MATCH.                                 20080000
200900     IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  >  0                   20090000
201000         PERFORM                                                  20100000
201100           UNTIL PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  =  0           20110000
201200              OR PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  <              20120000
201300                 PV-UCC128-MIN-OTPK                               20130000
201400              OR PS-ERROR                                         20140000
201500              OR PV-UCC128-MIN-OTPK = 0                           20150000
201600                 PERFORM 4170-SML-FCSE-PARTIAL                    20160000
201700         END-PERFORM                                              20170000
201800     END-IF.                                                      20180000
201900     PERFORM 4200-GET-MAX-MIN-NEEDED.                             20190000
202000                                                                  20200000
202100                                                                  20210000
202200*================================================================*20220000
202300* PROCESS CENTRAL STOCK - FULLCASE MATCH                         *20230000
202400*================================================================*20240000
202500 4120-SML-CS.                                                     20250000
202600                                                                  20260000
202700     PERFORM 4150-SML-FCSE-MATCH.                                 20270000
202800     IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  >  0                   20280000
202900         PERFORM                                                  20290000
203000           UNTIL PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  =  0           20300000
203100              OR PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  <              20310000
203200                 PV-UCC128-MIN-OTPK                               20320000
203300              OR  PS-ERROR                                        20330000
203400              OR (PV-UCC128-MIN-OTPK  =  ZERO  AND                20340000
203500                  PV-UCC128-MAX-OTPK  =  ZERO)                    20350000
203600                 PERFORM 4170-SML-FCSE-PARTIAL                    20360000
203700         END-PERFORM                                              20370000
203800     END-IF.                                                      20380000
203900                                                                  20390000
204000     IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  >  0  AND              20400000
204100         PC251-INPK-CNVY-YES                                      20410000
204200         MOVE  PC251-INPK-UNT-QTY  TO  PV-UCC128-MIN-OTPK         20420000
204300                                       PV-UCC128-MAX-OTPK         20430000
204400         IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  >=                 20440000
204500                  PV-UCC128-MIN-OTPK                              20450000
204600             PERFORM                                              20460000
204700               UNTIL PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  =  0       20470000
204800                  OR PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  <          20480000
204900                     PV-UCC128-MIN-OTPK                           20490000
205000                     PERFORM 4190-SML-INPK-PARTIAL                20500000
205100             END-PERFORM                                          20510000
205200     END-IF.                                                      20520000
205300     PERFORM 4200-GET-MAX-MIN-NEEDED.                             20530000
205400     PERFORM 4220-GET-NEW-MAX-MIN-OTPK.                           20540000
205500                                                                  20550000
205600                                                                  20560000
205700*================================================================*20570000
205800* PROCESS STORE - FULLCASE MATCH                                 *20580000
205900*================================================================*20590000
206000 4150-SML-FCSE-MATCH.                                             20600000
206100                                                                  20610000
206200     SET  PS-NOT-UCC128-FCSE-MATCH  TO  TRUE.                     20620000
206300                                                                  20630000
206400     PERFORM                                                      20640000
206500        VARYING PT-U128-IDX                                       20650000
206600           FROM 1 BY 1                                            20660000
206700          UNTIL PT-U128-IDX    >  PV-UCC128-TABLE-ENTRIES         20670000
206800             OR PS-UCC128-FCSE-MATCH                              20680000
206900            IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  =               20690000
207000                PT-UCC128-OTPK (PT-U128-IDX)           AND        20700000
207100                PT-UCC128-CRTNS (PT-U128-IDX)  >  0               20710000
207200                    MOVE PT-EXPT-EXPTED-QTY (PT-EXPT-IDX)         20720000
207300                      TO PT-EXPT-ALLOC-QTY  (PT-EXPT-IDX)         20730000
207400                    ADD  1  TO  PV-FCSE-ALLOCATED                 20740000
207500                                PT-EXPT-FCSE-CNT (PT-EXPT-IDX)    20750000
207600                                PV-CARTON-NBR                     20760000
207700                                PV-MSTR-CARTON-NBR                20770000
207800                    ADD  PT-UCC128-OTPK (PT-U128-IDX)             20780000
207900                             TO PT-EXPT-FCSE-UNTS (PT-EXPT-IDX)   20790000
208000                    MOVE ZEROES                                   20800000
208100                      TO PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)         20810000
208200                    SUBTRACT 1                                    20820000
208300                         FROM PT-UCC128-CRTNS (PT-U128-IDX)       20830000
208400                    SET  PS-UCC128-FCSE-MATCH                     20840000
208500                         PS-CARTON-USE-FCSE                       20850000
208600                         PS-CARTON-LABEL-SML                      20860000
208700                         PS-CARTON-MASTER-YES  TO  TRUE           20870000
208800                    PERFORM 5000-CARTON-TABLE-ENTRY               20880000
208900                    IF  (PT-UCC128-OTPK (PT-U128-IDX)             20890000
209000                                        =  PV-UCC128-MIN-OTPK  OR 20900000
209100                         PT-UCC128-OTPK (PT-U128-IDX)             20910000
209200                                        =  PV-UCC128-MAX-OTPK) AND20920000
209300                         PT-UCC128-CRTNS (PT-U128-IDX)    =  0    20930000
209400                         PERFORM 4220-GET-NEW-MAX-MIN-OTPK        20940000
209500                     END-IF                                       20950000
209600            ELSE                                                  20960000
209700                IF  PT-UCC128-CRTNS (PT-U128-IDX)     >  0  AND   20970000
209800                    PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  >           20980000
209900                    PT-UCC128-OTPK (PT-U128-IDX)           AND    20990000
210000                    PT-UCC128-CRTNS (PT-U128-IDX)  >  0           21000000
210100                    AND  PS-NO-ERROR                              21010000
210200                    SUBTRACT PT-UCC128-OTPK (PT-U128-IDX)         21020000
210300                        FROM PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)     21030000
210400                    ADD  PT-UCC128-OTPK (PT-U128-IDX)             21040000
210500                      TO PT-EXPT-ALLOC-QTY  (PT-EXPT-IDX)         21050000
210600                    ADD  1  TO  PV-FCSE-ALLOCATED                 21060000
210700                                PT-EXPT-FCSE-CNT (PT-EXPT-IDX)    21070000
210800                                PV-CARTON-NBR                     21080000
210900                                PV-MSTR-CARTON-NBR                21090000
211000                    ADD  PT-UCC128-OTPK (PT-U128-IDX)             21100000
211100                             TO PT-EXPT-FCSE-UNTS (PT-EXPT-IDX)   21110000
211200                    SUBTRACT 1                                    21120000
211300                         FROM PT-UCC128-CRTNS (PT-U128-IDX)       21130000
211400                    SET  PS-UCC128-FCSE-PARTIAL                   21140000
211500                         PS-CARTON-USE-FCSE                       21150000
211600                         PS-CARTON-LABEL-SML                      21160000
211700                         PS-CARTON-MASTER-YES    TO  TRUE         21170000
211800                    PERFORM 5000-CARTON-TABLE-ENTRY               21180000
211900                    IF  (PT-UCC128-OTPK (PT-U128-IDX)             21190000
212000                                        =  PV-UCC128-MIN-OTPK  OR 21200000
212100                         PT-UCC128-OTPK (PT-U128-IDX)             21210000
212200                                        =  PV-UCC128-MAX-OTPK) AND21220000
212300                         PT-UCC128-CRTNS (PT-U128-IDX)    =  0    21230000
212400                         PERFORM 4220-GET-NEW-MAX-MIN-OTPK        21240000
212500                    END-IF                                        21250000
212600                END-IF                                            21260000
212700            END-IF                                                21270000
212800     END-PERFORM.                                                 21280000
212900                                                                  21290000
213000                                                                  21300000
213100*================================================================*21310000
213200* PROCESS STORE - FULLCASE MATCH (PARTIAL ALLOCATION)            *21320000
213300*================================================================*21330000
213400 4170-SML-FCSE-PARTIAL.                                           21340000
213500                                                                  21350000
213600     SET  PS-NOT-UCC128-FCSE-PARTIAL  TO  TRUE.                   21360000
213700                                                                  21370000
213800     PERFORM                                                      21380000
213900        WITH TEST AFTER                                           21390000
214000        VARYING PT-U128-IDX                                       21400000
214100           FROM 1 BY 1                                            21410000
214200          UNTIL PT-U128-IDX    >  PV-UCC128-TABLE-ENTRIES         21420000
214300             OR PS-UCC128-FCSE-PARTIAL                            21430000
214400             OR PS-ERROR                                          21440000
214500                IF  PT-UCC128-CRTNS (PT-U128-IDX)     >  0  AND   21450000
214600                    PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  >=          21460000
214700                    PT-UCC128-OTPK (PT-U128-IDX)           AND    21470000
214800                    PT-UCC128-CRTNS (PT-U128-IDX)  >  0           21480000
214900                    AND  PS-NO-ERROR                              21490000
215000                    SUBTRACT PT-UCC128-OTPK (PT-U128-IDX)         21500000
215100                        FROM PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)     21510000
215200                    ADD  PT-UCC128-OTPK (PT-U128-IDX)             21520000
215300                      TO PT-EXPT-ALLOC-QTY  (PT-EXPT-IDX)         21530000
215400                    ADD  1  TO  PV-FCSE-ALLOCATED                 21540000
215500                                PT-EXPT-FCSE-CNT (PT-EXPT-IDX)    21550000
215600                                PV-CARTON-NBR                     21560000
215700                                PV-MSTR-CARTON-NBR                21570000
215800                    ADD  PT-UCC128-OTPK (PT-U128-IDX)             21580000
215900                             TO PT-EXPT-FCSE-UNTS (PT-EXPT-IDX)   21590000
216000                    SUBTRACT 1                                    21600000
216100                         FROM PT-UCC128-CRTNS (PT-U128-IDX)       21610000
216200                    SET  PS-UCC128-FCSE-PARTIAL                   21620000
216300                         PS-CARTON-USE-FCSE                       21630000
216400                         PS-CARTON-LABEL-SML                      21640000
216500                         PS-CARTON-MASTER-YES    TO  TRUE         21650000
216600                    PERFORM 5000-CARTON-TABLE-ENTRY               21660000
216700                    IF  (PT-UCC128-OTPK (PT-U128-IDX)             21670000
216800                                        =  PV-UCC128-MIN-OTPK  OR 21680000
216900                         PT-UCC128-OTPK (PT-U128-IDX)             21690000
217000                                        =  PV-UCC128-MAX-OTPK) AND21700000
217100                         PT-UCC128-CRTNS (PT-U128-IDX)    =  0    21710000
217200                         PERFORM 4220-GET-NEW-MAX-MIN-OTPK        21720000
217300                     END-IF                                       21730000
217400                 END-IF                                           21740000
217500     END-PERFORM.                                                 21750000
217600                                                                  21760000
217700                                                                  21770000
217800*================================================================*21780000
217900* PROCESS STORE - INNER PACK MATCH (PARTIAL ALLOCATION)          *21790000
218000*================================================================*21800000
218100 4190-SML-INPK-PARTIAL.                                           21810000
218200                                                                  21820000
218300     IF  PV-NBR-OF-INPKS  =  ZERO                                 21830000
218400         PERFORM                                                  21840000
218500            WITH TEST AFTER                                       21850000
218600            VARYING PT-U128-IDX                                   21860000
218700               FROM 1 BY 1                                        21870000
218800              UNTIL PT-U128-IDX      >  PV-UCC128-TABLE-ENTRIES   21880000
218900                 OR PV-NBR-OF-INPKS  >  ZERO                      21890000
219000                    IF  PT-UCC128-CRTNS (PT-U128-IDX)    >  0     21900000
219100                                                                  21910000
219200                      IF PC251-INPK-UNT-QTY  >  0                 21920000
219300                        DIVIDE  PT-UCC128-OTPK (PT-U128-IDX)      21930000
219400                            BY  PC251-INPK-UNT-QTY                21940000
219500                        GIVING  PV-NBR-OF-INPKS                   21950000
219600                      ELSE                                        21960000
219700                        MOVE  ZEROES  TO  PV-NBR-OF-INPKS         21970000
219800                      END-IF                                      21980000
219900                                                                  21990000
220000                        ADD  1  TO  PV-MSTR-CARTON-NBR            22000000
220100                        SET  PS-CARTON-MASTER-YES  TO  TRUE       22010000
220200                    END-IF                                        22020000
220300         END-PERFORM                                              22030000
220400     ELSE                                                         22040000
220500         SET  PS-CARTON-MASTER-NO   TO  TRUE                      22050000
220600     END-IF.                                                      22060000
220700                                                                  22070000
220800     IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  >=                     22080000
220900         PC251-INPK-UNT-QTY                                       22090000
221000         SUBTRACT PC251-INPK-UNT-QTY                              22100000
221100             FROM PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)                22110000
221200         ADD  PC251-INPK-UNT-QTY                                  22120000
221300          TO PT-EXPT-ALLOC-QTY  (PT-EXPT-IDX)                     22130000
221400         ADD  1  TO  PT-EXPT-INPK-CNT (PT-EXPT-IDX)               22140000
221500         ADD  1  TO  PV-CARTON-NBR                                22150000
221600         ADD  PC251-INPK-UNT-QTY                                  22160000
221700                 TO PT-EXPT-INPK-UNTS (PT-EXPT-IDX)               22170000
221800         SUBTRACT 1                                               22180000
221900             FROM PV-NBR-OF-INPKS                                 22190000
222000         IF  PV-NBR-OF-INPKS  =  ZERO                             22200000
222100             ADD  1  TO PV-FCSE-ALLOCATED                         22210000
222200             SUBTRACT  1                                          22220000
222300                 FROM  PT-UCC128-CRTNS (PT-U128-IDX)              22230000
222400         END-IF                                                   22240000
222500         SET PS-CARTON-USE-INPK                                   22250000
222600             PS-CARTON-LABEL-SML TO  TRUE                         22260000
222700         PERFORM 5000-CARTON-TABLE-ENTRY                          22270000
222800     END-IF.                                                      22280000
222900                                                                  22290000
223000                                                                  22300000
223100*================================================================*22310000
223200* DETERMINE THE MAX & MIN OTPK NEEDED IN EXPTED TABLE            *22320000
223300*================================================================*22330000
223400 4200-GET-MAX-MIN-NEEDED.                                         22340000
223500                                                                  22350000
223600     MOVE  ZEROES  TO  PV-NEEDED-MIN-OTPK                         22360000
223700                       PV-NEEDED-MAX-OTPK.                        22370000
223800                                                                  22380000
223900     PERFORM                                                      22390000
224000        VARYING PT-EXPT-IDX                                       22400000
224100           FROM 1 BY 1                                            22410000
224200          UNTIL PT-EXPT-IDX  >  PV-EXPECT-TABLE-ENTRIES           22420000
224300                IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)  >  0        22430000
224400                    IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)          22440000
224500                          >  PV-NEEDED-MAX-OTPK                   22450000
224600                        MOVE  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)    22460000
224700                          TO  PV-NEEDED-MAX-OTPK                  22470000
224800                    END-IF                                        22480000
224900                    IF  PV-NEEDED-MIN-OTPK  =  ZERO               22490000
225000                        MOVE  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)    22500000
225100                          TO  PV-NEEDED-MIN-OTPK                  22510000
225200                    ELSE                                          22520000
225300                    IF  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)          22530000
225400                           <  PV-NEEDED-MIN-OTPK                  22540000
225500                        MOVE  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)    22550000
225600                          TO  PV-NEEDED-MIN-OTPK                  22560000
225700                    END-IF                                        22570000
225800                    END-IF                                        22580000
225900                END-IF                                            22590000
226000     END-PERFORM.                                                 22600000
226100                                                                  22610000
226200                                                                  22620000
226300*================================================================*22630000
226400* GET THE NEW OTPK MAX AND OTPK MIN FROM THE UCC128 OTPK TABLE   *22640000
226500*================================================================*22650000
226600 4220-GET-NEW-MAX-MIN-OTPK.                                       22660000
226700                                                                  22670000
226800     MOVE  ZEROES  TO  PV-UCC128-MIN-OTPK                         22680000
226900                       PV-UCC128-MAX-OTPK.                        22690000
227000                                                                  22700000
227100     PERFORM                                                      22710000
227200        VARYING PT-U128-IDX                                       22720000
227300           FROM 1 BY 1                                            22730000
227400          UNTIL PT-U128-IDX > PV-UCC128-TABLE-ENTRIES             22740000
227500                IF  PT-UCC128-CRTNS (PT-U128-IDX)    >  0         22750000
227600                    IF  PT-UCC128-OTPK (PT-U128-IDX)              22760000
227700                          >  PV-UCC128-MAX-OTPK                   22770000
227800                        MOVE  PT-UCC128-OTPK (PT-U128-IDX)        22780000
227900                          TO  PV-UCC128-MAX-OTPK                  22790000
228000                    END-IF                                        22800000
228100                    IF  PV-UCC128-MIN-OTPK  =  ZERO               22810000
228200                        MOVE  PT-UCC128-OTPK (PT-U128-IDX)        22820000
228300                          TO  PV-UCC128-MIN-OTPK                  22830000
228400                    ELSE                                          22840000
228500                    IF  PT-UCC128-OTPK (PT-U128-IDX)              22850000
228600                           < PV-UCC128-MIN-OTPK                   22860000
228700                        MOVE  PT-UCC128-OTPK (PT-U128-IDX)        22870000
228800                          TO  PV-UCC128-MIN-OTPK                  22880000
228900                    END-IF                                        22890000
229000                    END-IF                                        22900000
229100                END-IF                                            22910000
229200     END-PERFORM.                                                 22920000
229300                                                                  22930000
229400                                                                  22940000
229500*================================================================*22950000
229600* REMAINING CARTONS/UNITS WILL BE ASSIGNED TO P2L.               *22960000
229700*================================================================*22970000
229800 4300-SPLIT-P2L-UNITS.                                            22980000
229900                                                                  22990000
230000     PERFORM                                                      23000000
230100       VARYING PT-EXPT-IDX                                        23010000
230200          FROM 1 BY 1                                             23020000
230300         UNTIL PT-EXPT-IDX  >  PV-EXPECT-TABLE-ENTRIES            23030000
230400               ADD  PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)              23040000
230500                TO  PT-EXPT-ALLOC-QTY  (PT-EXPT-IDX)              23050000
230600               MOVE PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)              23060000
230700                 TO PT-EXPT-P2L-UNTS   (PT-EXPT-IDX)              23070000
230800               MOVE ZEROES                                        23080000
230900                 TO PT-EXPT-NEEDED-QTY (PT-EXPT-IDX)              23090000
231000     END-PERFORM.                                                 23100000
231100                                                                  23110000
231200     IF  PC251-INPK-CNVY-YES  AND                                 23120000
231300         PV-NBR-OF-INPKS  >  0                                    23130000
231400         PERFORM                                                  23140000
231500           UNTIL PV-NBR-OF-INPKS  =  0                            23150000
231600                 SUBTRACT  PC251-INPK-UNT-QTY                     23160000
231700                     FROM  PV-P2L-QTY-NEEDED                      23170000
231800                 SUBTRACT  1                                      23180000
231900                     FROM  PV-NBR-OF-INPKS                        23190000
232000                 IF  PV-NBR-OF-INPKS  =  0                        23200000
232100                     ADD  1  TO PV-FCSE-ALLOCATED                 23210000
232200                     SUBTRACT  1                                  23220000
232300                         FROM  PT-UCC128-CRTNS (PT-U128-IDX)      23230000
232400                 END-IF                                           23240000
232500                 SET  PS-CARTON-USE-INPK                          23250000
232600                      PS-CARTON-LABEL-P2L                         23260000
232700                      PS-CARTON-MASTER-NO TO  TRUE                23270000
232800                 PERFORM 5000-CARTON-TABLE-ENTRY                  23280000
232900         END-PERFORM                                              23290000
233000     END-IF.                                                      23300000
233100                                                                  23310000
233200     IF  PV-P2L-QTY-NEEDED  >  ZERO  AND                          23320000
233300         PV-UCC128-MAX-OTPK =  0                                  23330000
233400         SET  PS-ERROR                                            23340000
233500              PC251-PREPK-UCC128-NO  TO  TRUE                     23350000
233600         MOVE ZEROES  TO  PC251-TOTAL-CARTONS                     23360000
233700                          PC251-OTPK-UNT-QTY                      23370000
233800                          PC251-INPK-UNT-QTY                      23380000
233900                          PC251-FCSE-LBL-CNT                      23390000
234000                          PC251-INPK-LBL-CNT                      23400000
234100                          PC251-P2L-LBL-CNT                       23410000
234200     ELSE                                                         23420000
234300                                                                  23430000
234400     IF  PV-P2L-QTY-NEEDED  >  ZERO                               23440000
234500         PERFORM                                                  23450000
234600           WITH TEST AFTER                                        23460000
234700           UNTIL PV-P2L-QTY-NEEDED <= 0  OR                       23470000
234800                 PT-U128-IDX > PV-UCC128-TABLE-ENTRIES            23480000
234900                 PERFORM                                          23490000
235000                   WITH TEST AFTER                                23500000
235100                   VARYING PT-U128-IDX                            23510000
235200                      FROM 1 BY 1                                 23520000
235300                     UNTIL PT-U128-IDX > PV-UCC128-TABLE-ENTRIES  23530000
235400                        IF  PT-UCC128-CRTNS (PT-U128-IDX) > 0     23540000
235500                            PERFORM                               23550000
235600                              UNTIL PT-UCC128-CRTNS (PT-U128-IDX) 23560000
235700                                    = 0                           23570000
235800                                    SUBTRACT PT-UCC128-OTPK       23580000
235900                                             (PT-U128-IDX)        23590000
236000                                        FROM PV-P2L-QTY-NEEDED    23600000
236100                                    SUBTRACT 1                    23610000
236200                                        FROM PT-UCC128-CRTNS      23620000
236300                                             (PT-U128-IDX)        23630000
236400                                    SET  PS-CARTON-USE-FCSE       23640000
236500                                         PS-CARTON-LABEL-P2L      23650000
236600                                    PS-CARTON-MASTER-YES          23660000
236700                                                      TO  TRUE    23670000
236800                                    PERFORM                       23680000
236900                                          5000-CARTON-TABLE-ENTRY 23690000
237000                            END-PERFORM                           23700000
237100                        END-IF                                    23710000
237200                 END-PERFORM                                      23720000
237300         END-PERFORM                                              23730000
237400     END-IF                                                       23740000
237500     END-IF.                                                      23750000
237600                                                                  23760000
237700                                                                  23770000
237800*================================================================*23780000
237900* CREATE TABLE ENTRY FOR CARTON JUST ASSIGNED.  THIS TABLE WILL  *23790000
238000* BE USED TO CREATE THE VIRTUAL TABLE.                           *23800000
238100*================================================================*23810000
238200 5000-CARTON-TABLE-ENTRY.                                         23820000
238300                                                                  23830000
238400     IF  PS-CARTON-MASTER-YES                                     23840000
238500         MOVE PC-M            TO PT-CRTN-MSTR (PT-CRTN-IDX)       23850000
238600     ELSE                                                         23860000
238700         MOVE PC-I            TO PT-CRTN-MSTR (PT-CRTN-IDX)       23870000
238800     END-IF.                                                      23880000
238900                                                                  23890000
239000     IF  PS-CARTON-LABEL-P2L                                      23900000
239100         MOVE PC251-OPER-UNT-ID                                   23910000
239200           TO  PT-CRTN-STORE-NBR  (PT-CRTN-IDX)                   23920000
239300         MOVE  'DC'                                               23930000
239400           TO  PT-CRTN-STORE-TYP  (PT-CRTN-IDX)                   23940000
239500         MOVE  PT-EXPT-SEASET-IND     (PT-EXPT-IDX)               23950000
239600           TO  PT-CRTN-SEASET-IND     (PT-CRTN-IDX)               23960000
239700         SET   PT-CRTN-P2L (PT-CRTN-IDX)  TO  TRUE                23970000
239800     ELSE                                                         23980000
239900         MOVE  PT-EXPT-STR-NBR        (PT-EXPT-IDX)               23990000
240000           TO  PT-CRTN-STORE-NBR      (PT-CRTN-IDX)               24000000
240100         MOVE  PT-EXPT-STR-TYP        (PT-EXPT-IDX)               24010000
240200           TO  PT-CRTN-STORE-TYP      (PT-CRTN-IDX)               24020000
240300         MOVE  PT-EXPT-E-COMMERCE-IND (PT-EXPT-IDX)               24030000
240400           TO  PT-CRTN-E-COMMERCE-IND (PT-CRTN-IDX)               24040000
240500         MOVE  PT-EXPT-SEASET-IND     (PT-EXPT-IDX)               24050000
240600           TO  PT-CRTN-SEASET-IND     (PT-CRTN-IDX)               24060000
240700         MOVE  PT-EXPT-FIXT-ID        (PT-EXPT-IDX)               24070000
240800           TO  PT-CRTN-FIXT-ID        (PT-CRTN-IDX)               24080000
240900         MOVE  PT-EXPT-SEASONAL-SET   (PT-EXPT-IDX)               24090000
241000           TO  PT-CRTN-SEASONAL-SET   (PT-CRTN-IDX)               24100000
241100         SET   PT-CRTN-SML (PT-CRTN-IDX)  TO  TRUE                24110000
241200     END-IF.                                                      24120000
241300                                                                  24130000
241400     MOVE PT-UCC128-OTPK (PT-U128-IDX)                            24140000
241500       TO PT-CRTN-OTPK-QTY (PT-CRTN-IDX).                         24150000
241600                                                                  24160000
241700     IF  PS-CARTON-USE-FCSE                                       24170000
241800         SET  PT-CRTN-FCSE-SML (PT-CRTN-IDX)  TO  TRUE            24180000
241900         MOVE PV-CARTON-NBR                                       24190000
242000          TO  PT-CRTN-MSTR-CRTN (PT-CRTN-IDX)                     24200000
242100     ELSE                                                         24210000
242200     IF  PS-CARTON-USE-INPK                                       24220000
242300         SET  PT-CRTN-INPK-SML (PT-CRTN-IDX)  TO  TRUE            24230000
242400         MOVE PV-MSTR-CARTON-NBR                                  24240000
242500          TO  PT-CRTN-MSTR-CRTN (PT-CRTN-IDX)                     24250000
242600     END-IF                                                       24260000
242700     END-IF.                                                      24270000
242800                                                                  24280000
242900     ADD +1                   TO PV-CARTON-TABLE-ENTRIES.         24290000
243000     SET  PT-CRTN-IDX UP BY 1.                                    24300000
243100                                                                  24310000
243200                                                                  24320000
243300*================================================================*24330000
243400* GET START MANIFEST NUMBER FOR EACH ENTRY IN TABLE              *24340000
243500*================================================================*24350000
243600 5050-GET-MANIFEST-NBRS.                                          24360000
243700                                                                  24370000
243800     PERFORM                                                      24380000
243900         VARYING PT-CRTN-IDX                                      24390000
244000            FROM 1 BY 1                                           24400000
244100            UNTIL PT-CRTN-IDX  >  PV-CARTON-TABLE-ENTRIES OR      24410000
244200                  PT-CRTN-IDX  >  PC-MAX-CARTON-TBL-ENTRY         24420000
244300            IF  PT-CRTN-SML        (PT-CRTN-IDX)                  24430000
244400                PERFORM 5435-MANIFEST-NBR                         24440000
244500            END-IF                                                24450000
244600     END-PERFORM.                                                 24460000
244700                                                                  24470000
244800                                                                  24480000
244900*================================================================*24490000
245000* CREATE ENTRIES IN VIRTUAL LABEL TABLE                          *24500000
245100*================================================================*24510000
245200 5100-CREATE-VRTL-LABEL.                                          24520000
245300                                                                  24530000
245400     MOVE  ZEROES  TO  LBVRDA-LBL-ASG-SEQ-NBR.                    24540000
245500     PERFORM                                                      24550000
245600         VARYING PT-CRTN-IDX                                      24560000
245700            FROM 1 BY 1                                           24570000
245800            UNTIL PT-CRTN-IDX  >  PV-CARTON-TABLE-ENTRIES OR      24580000
245900                  PT-CRTN-IDX  >  PC-MAX-CARTON-TBL-ENTRY         24590000
246000                                                                  24600000
246100            MOVE PC251-PO-NBR       TO LBVRDA-PO-NBR              24610000
246200            MOVE PC251-RCVR-SEQ-NBR TO LBVRDA-RCVR-SEQ-NBR        24620000
246300                                                                  24630000
246400            IF  PC251-PREPK-ID  >  0                              24640000
246500                MOVE  ZEROES        TO LBVRDA-PO-LNE-NBR          24650000
246600                MOVE PC251-PREPK-ID TO LBVRDA-PREPK-ID            24660000
246700                MOVE PC251-PREPK-RATIO                            24670000
246800                                    TO LBVRDA-PREPK-RATO-QTY      24680000
246900                MOVE PC251-TOT-PREPK-UNTS                         24690000
247000                                    TO LBVRDA-PREPK-UNT-QTY       24700000
247100                MOVE PC251-PO-LNE-NBR                             24710000
247200                                    TO LBVRDA-PREPK-PRCG-LNE-NBR  24720000
247300            ELSE                                                  24730000
247400                MOVE PC251-PO-LNE-NBR                             24740000
247500                                    TO LBVRDA-PO-LNE-NBR          24750000
247600                MOVE ZEROES         TO LBVRDA-PREPK-ID            24760000
247700                                       LBVRDA-PREPK-RATO-QTY      24770000
247800                                       LBVRDA-PREPK-UNT-QTY       24780000
247900                                       LBVRDA-PREPK-PRCG-LNE-NBR  24790000
248000            END-IF                                                24800000
248100                                                                  24810000
248200            MOVE PT-CRTN-OTPK-QTY (PT-CRTN-IDX)                   24820000
248300                                    TO LBVRDA-OTPK-UNT-QTY        24830000
248400            MOVE PC-N               TO LBVRDA-LBL-ASG-IND         24840000
248500            ADD  1                  TO LBVRDA-LBL-ASG-SEQ-NBR     24850000
248600            IF  PT-CRTN-MSTR (PT-CRTN-IDX) = PC-I                 24860000
248700                MOVE PC-I           TO LBVRDA-LBL-TYP-CDE         24870000
248800                MOVE PV-MASTER-CRTN-SEQ-ID                        24880000
248900                                    TO LBVRDA-PRNT-CART-SEQ-ID    24890000
249000            ELSE                                                  24900000
249100                MOVE PC-M           TO LBVRDA-LBL-TYP-CDE         24910000
249200                MOVE LBVRDA-LBL-ASG-SEQ-NBR                       24920000
249300                                    TO LBVRDA-PRNT-CART-SEQ-ID    24930000
249400                                       PV-MASTER-CRTN-SEQ-ID      24940000
249500            END-IF                                                24950000
249600                                                                  24960000
249700            MOVE PC251-INPK-UNT-QTY TO LBVRDA-INPK-UNT-QTY        24970000
249800            MOVE PT-CRTN-STORE-NBR (PT-CRTN-IDX)                  24980000
249900                                    TO LBVRDA-DEST-OPER-UNT-ID    24990000
250000            MOVE PT-CRTN-OTPK-QTY (PT-CRTN-IDX)                   25000000
250100                                    TO LBVRDA-CSE-PK-QTY          25010000
250200            MOVE SPACES             TO LBVRDA-ODD-CART-IND        25020000
250300            IF  PT-CRTN-INPK-SML (PT-CRTN-IDX)                    25030000
250400                MOVE 'Y'            TO LBVRDA-INPK-CNVYB-IND      25040000
250500            ELSE                                                  25050000
250600                MOVE 'N'            TO LBVRDA-INPK-CNVYB-IND      25060000
250700            END-IF                                                25070000
250800                                                                  25080000
250900            IF  PT-CRTN-SML        (PT-CRTN-IDX)                  25090000
251000                IF  PT-CRTN-E-COMMERCE-YES (PT-CRTN-IDX)  AND     25100000
251100                    PT-CRTN-STORE (PT-CRTN-IDX)           AND     25110000
251200                    PC251-PRE-PACK-ORDER                          25120000
251300                    MOVE PC-S       TO LBVRDA-CART-LBL-TYP-CDE    25130000
251400                ELSE                                              25140000
251500                IF  PT-CRTN-E-COMMERCE-YES (PT-CRTN-IDX)  AND     25150000
251600                    PT-CRTN-STORE (PT-CRTN-IDX)                   25160000
251700                    MOVE PC-E       TO LBVRDA-CART-LBL-TYP-CDE    25170000
251800                ELSE                                              25180000
251900                IF  PT-CRTN-CENTRL-STCK (PT-CRTN-IDX)             25190000
252000                    MOVE PC-C       TO LBVRDA-CART-LBL-TYP-CDE    25200000
252100                ELSE                                              25210000
252200                    MOVE PC-S       TO LBVRDA-CART-LBL-TYP-CDE    25220000
252300                END-IF                                            25230000
252400                END-IF                                            25240000
252500                END-IF                                            25250000
252600                ADD  1              TO PV-SML-CRTN-SEQ            25260000
252700                MOVE PV-SML-CRTN-SEQ                              25270000
252800                                    TO LBVRDA-LBL-TYP-LBL-SEQ-ID  25280000
252900                ADD  PV-FCSE-CRTN-CNT                             25290000
253000                     PV-INPK-CRTN-CNT                             25300000
253100                     GIVING            LBVRDA-LBL-TYP-TOT-QTY     25310000
253200                MOVE SPACES         TO LBVRDA-MODU-DESC           25320000
253300                MOVE PV-STORE-ZONE  TO LBVRDA-STR-ZN-ID           25330000
253400                                                                  25340000
253500                MOVE ZEROES         TO PC160-20-SML-CONTAINER-CDE 25350000
253600                SET  PC160-20-SML-INTERNAL-LBL                    25360000
253700                     PC160-20-SML-FROM-KOHLS   TO  TRUE           25370000
253800                MOVE PT-CRTN-STORE-NBR (PT-CRTN-IDX)              25380000
253900                                    TO PV-STORE-NBR               25390000
254000                MOVE PV-DIVERT-STORE                              25400000
254100                                    TO PC160-20-SML-BC-DIVERT     25410000
254200                MOVE PC251-OPER-UNT-ID                            25420000
254300                                    TO PC160-20-SML-BC-DC-ORIGIN  25430000
254400                MOVE PT-CRTN-MANIFEST-NBR (PT-CRTN-IDX)           25440000
254500                                    TO PC160-20-SML-BC-MNFST-NBR  25450000
254600                ADD  1              TO PT-CRTN-MANIFEST-NBR       25460000
254700                                           (PT-CRTN-IDX)          25470000
254800                MOVE PC160-20-DIGIT-BARCODE                       25480000
254900                                   TO LBVRDA-BRCDE-NBR            25490000
255000                                                                  25500000
255100            ELSE                                                  25510000
255200                MOVE PC-P           TO LBVRDA-CART-LBL-TYP-CDE    25520000
255300                ADD  1              TO PV-P2L-CRTN-SEQ            25530000
255400                MOVE PV-P2L-CRTN-SEQ                              25540000
255500                                    TO LBVRDA-LBL-TYP-LBL-SEQ-ID  25550000
255600                MOVE PV-P2L-CRTN-CNT                              25560000
255700                                    TO LBVRDA-LBL-TYP-TOT-QTY     25570000
255800                MOVE PC251-MODU-DESC                              25580000
255900                                    TO LBVRDA-MODU-DESC           25590000
256000                MOVE PV-STORE-ZONE  TO LBVRDA-STR-ZN-ID           25600000
256100                                                                  25610000
256200                SET   PC160-DEST-TYP-0                            25620000
256300                                    TO  TRUE                      25630000
256400                MOVE P2LMOD-DIVERT-CDE                            25640000
256500                                   TO  PC160-DEST-DIVERT-CODE     25650000
256600                MOVE PC251-PO-NBR   TO  PC160-DEST-PO-NBR         25660000
256700                MOVE PC251-RCVR-SEQ-NBR                           25670000
256800                                    TO  PC160-DEST-RCVR-SEQ-NBR   25680000
256900                MOVE PC251-PO-LNE-NBR                             25690000
257000                                    TO  PC160-DEST-PO-LNE-NBR     25700000
257100                MOVE LBVRDA-LBL-TYP-LBL-SEQ-ID                    25710000
257200                                    TO  PC160-DEST-LBL-SEQ-NBR    25720000
257300                MOVE PC160-DEST-BARCODE-TEXT                      25730000
257400                                    TO LBVRDA-BRCDE-NBR           25740000
257500            END-IF                                                25750000
257600                                                                  25760000
257700            MOVE PC251-SKU          TO LBVRDA-ITM-NBR             25770000
257800            MOVE PV-DEPT-NAME       TO LBVRDA-DEPT-DESC           25780000
257900            MOVE PV-MAJOR-CLASS     TO LBVRDA-MAJ-CL-DESC         25790000
258000                                                                  25800000
258100           IF PT-CRTN-SEASET-YES (PT-CRTN-IDX)                    25810000
258200               MOVE PT-CRTN-SEASONAL-SET (PT-CRTN-IDX)            25820000
258300                                       TO LBVRDA-SEASET-NM        25830000
258400               MOVE PV-DIVERT-PFX-NBR  TO                         25840000
258500                                   PC160-20-SML-BC-DIVERT-PFX     25850000
258600               MOVE PC160-20-DIGIT-BARCODE                        25860000
258700                                       TO LBVRDA-BRCDE-NBR        25870000
258800            ELSE                                                  25880000
258900               MOVE SPACES             TO LBVRDA-SEASET-NM        25890000
259000            END-IF                                                25900000
259100            MOVE PT-CRTN-FIXT-ID (PT-CRTN-IDX)                    25910000
259200                                         TO LBVRDA-FIXT-ID        25920000
259300            IF  PT-CRTN-P2L (PT-CRTN-IDX)                         25930000
259400                MOVE SPACES              TO LBVRDA-FIXT-ID        25940000
259500                IF  PV-SEASET-SHRT-NM > SPACES                    25950000
259600                    IF  PV-CURRENT-DATE > PV-SEASET-RLSE-DT       25960000
259700                       CONTINUE                                   25970000
259800                    ELSE                                          25980000
259900                        MOVE PV-SEASET-SHRT-NM TO LBVRDA-STR-ZN-ID25990000
260000                    END-IF                                        26000000
260100                END-IF                                            26010000
260200            END-IF                                                26020000
260300            MOVE SPACES             TO LBVRDA-STRG-AREA-CDE       26030000
260400            PERFORM 5120-INSERT-VIRTUAL-TBL                       26040000
260500     END-PERFORM.                                                 26050000
260600                                                                  26060000
260700                                                                  26070000
260800*================================================================*26080000
260900* INSERT ROW INTO VIRTUAL LABEL TABLE                            *26090000
261000*================================================================*26100000
261100 5120-INSERT-VIRTUAL-TBL.                                         26110000
261200     MOVE '5120-INSERT-VIRTUAL-TBL'                               26120000
261300                                    TO PC251-ERROR-PARA-NBR       26130000
261400     EXEC SQL                                                     26140000
261500          INSERT                                                  26150000
261600          INTO  TLBVRDA                                           26160000
261700              ( PO_NBR                                            26170000
261800              ,RCVR_SEQ_NBR                                       26180000
261900               ,PO_LNE_NBR                                        26190000
262000               ,PREPK_ID                                          26200000
262100               ,OTPK_UNT_QTY                                      26210000
262200               ,LBL_ASG_IND                                       26220000
262300               ,LBL_TYP_CDE                                       26230000
262400               ,LBL_ASG_SEQ_NBR                                   26240000
262500               ,PRNT_CART_SEQ_ID                                  26250000
262600               ,CART_LBL_TYP_CDE                                  26260000
262700               ,PREPK_PRCG_LNE_NBR                                26270000
262800               ,INPK_UNT_QTY                                      26280000
262900               ,PREPK_RATO_QTY                                    26290000
263000              ,PREPK_UNT_QTY                                      26300000
263100               ,DEST_OPER_UNT_ID                                  26310000
263200               ,CSE_PK_QTY                                        26320000
263300               ,ODD_CART_IND                                      26330000
263400               ,INPK_CNVYB_IND                                    26340000
263500               ,LBL_TYP_LBL_SEQ_ID                                26350000
263600               ,LBL_TYP_TOT_QTY                                   26360000
263700               ,BRCDE_NBR                                         26370000
263800               ,STR_ZN_ID                                         26380000
263900               ,MODU_DESC                                         26390000
264000               ,ITM_NBR                                           26400000
264100               ,DEPT_DESC                                         26410000
264200               ,MAJ_CL_DESC                                       26420000
264300               ,SEASET_NM                                         26430000
264400               ,FIXT_ID                                           26440000
264500               ,STRG_AREA_CDE)                                    26450000
264600       VALUES                                                     26460000
264700              (:LBVRDA-PO-NBR                                     26470000
264800              ,:LBVRDA-RCVR-SEQ-NBR                               26480000
264900              ,:LBVRDA-PO-LNE-NBR                                 26490000
265000              ,:LBVRDA-PREPK-ID                                   26500000
265100              ,:LBVRDA-OTPK-UNT-QTY                               26510000
265200              ,:LBVRDA-LBL-ASG-IND                                26520000
265300              ,:LBVRDA-LBL-TYP-CDE                                26530000
265400              ,:LBVRDA-LBL-ASG-SEQ-NBR                            26540000
265500              ,:LBVRDA-PRNT-CART-SEQ-ID                           26550000
265600              ,:LBVRDA-CART-LBL-TYP-CDE                           26560000
265700              ,:LBVRDA-PREPK-PRCG-LNE-NBR                         26570000
265800              ,:LBVRDA-INPK-UNT-QTY                               26580000
265900              ,:LBVRDA-PREPK-RATO-QTY                             26590000
266000              ,:LBVRDA-PREPK-UNT-QTY                              26600000
266100              ,:LBVRDA-DEST-OPER-UNT-ID                           26610000
266200             ,:LBVRDA-CSE-PK-QTY                                  26620000
266300              ,:LBVRDA-ODD-CART-IND                               26630000
266400              ,:LBVRDA-INPK-CNVYB-IND                             26640000
266500              ,:LBVRDA-LBL-TYP-LBL-SEQ-ID                         26650000
266600              ,:LBVRDA-LBL-TYP-TOT-QTY                            26660000
266700              ,:LBVRDA-BRCDE-NBR                                  26670000
266800              ,:LBVRDA-STR-ZN-ID                                  26680000
266900              ,:LBVRDA-MODU-DESC                                  26690000
267000              ,:LBVRDA-ITM-NBR                                    26700000
267100              ,:LBVRDA-DEPT-DESC                                  26710000
267200              ,:LBVRDA-MAJ-CL-DESC                                26720000
267300              ,:LBVRDA-SEASET-NM                                  26730000
267400              ,:LBVRDA-FIXT-ID                                    26740000
267500              ,:LBVRDA-STRG-AREA-CDE)                             26750000
267600     END-EXEC.                                                    26760000
267700                                                                  26770000
267800     EVALUATE TRUE                                                26780000
267900          WHEN SQLCODE = ZERO                                     26790000
268000               CONTINUE                                           26800000
268100          WHEN SQLWARN0 NOT = SPACES                              26810000
268200          WHEN SQLCODE < ZERO                                     26820000
268300          WHEN SQLCODE > ZERO                                     26830000
268400               SET  PC251-INVALID-SQL TO TRUE                     26840000
268500               MOVE SQLCODE           TO PC251-SQL-CODE           26850000
268600               MOVE 'TLBVRDA'         TO PC251-ERROR-TABLE-NME    26860000
268700               PERFORM 9000-RETURN-CALL                           26870000
268800      END-EVALUATE.                                               26880000
268900                                                                  26890000
269000*                                                                 26900000
269100*================================================================*26910000
269200* GET LABEL INFORMATION                                          *26920000
269300*================================================================*26930000
269400 5400-GET-LBL-DATA.                                               26940000
269500                                                                  26950000
269600     MOVE ZEROES       TO  PV-DIVERT-CODE.                        26960000
269700     MOVE ZEROES       TO  PV-STORE-NBR.                          26970000
269800                                                                  26980000
269900     IF  PC251-CREATE-SML                                         26990000
270000         IF  PC251-MOD-NBR  > 0                                   27000000
270100             PERFORM 5405-GET-MODULE-DESC                         27010000
270200          ELSE                                                    27020000
270300             MOVE  SPACES  TO  PC251-MODU-DESC                    27030000
270400          END-IF                                                  27040000
270500     ELSE                                                         27050000
270600         PERFORM 5405-GET-MODULE-DESC                             27060000
270700     END-IF.                                                      27070000
270800                                                                  27080000
270900     PERFORM 5410-DEPT-MAJOR-CLASS.                               27090000
271000                                                                  27100000
271100*                                                                 27110000
271200*================================================================*27120000
271300* P2L MODULE DESCRIPTION                                         *27130000
271400*================================================================*27140000
271500 5405-GET-MODULE-DESC.                                            27150000
271600                                                                  27160000
271700     MOVE '5405-GET-MODULE-DESC '                                 27170000
271800                                    TO PC251-ERROR-PARA-NBR.      27180000
271900     MOVE PC251-OPER-UNT-ID  TO  DK-OPER-UNT-ID.                  27190000
272000     MOVE PC251-MOD-NBR      TO  DK-MOD-NBR.                      27200000
272100                                                                  27210000
272200     EXEC SQL                                                     27220000
272300         SELECT                                                   27230000
272400         MODU_NBR                                                 27240000
272500     ,   MODU_DESC                                                27250000
272600     ,   DIVERT_CDE                                               27260000
272700     INTO                                                         27270000
272800         :P2LMOD-MODU-NBR                                         27280000
272900     ,   :P2LMOD-MODU-DESC                                        27290000
273000     ,   :P2LMOD-DIVERT-CDE                                       27300000
273100     FROM                                                         27310000
273200         TP2LMOD                                                  27320000
273300     WHERE                                                        27330000
273400         OPER_UNT_ID   = :DK-OPER-UNT-ID                          27340000
273500     AND MODU_NBR      = :DK-MOD-NBR                              27350000
273510     WITH UR                                                      27351000
273600     END-EXEC.                                                    27360000
273700                                                                  27370000
273800     EVALUATE TRUE                                                27380000
273900         WHEN SQLCODE = ZERO                                      27390000
273910              IF  PS-P2L-MOD-ON-LABEL                             27391000
273920                  MOVE P2LMOD-MODU-DESC     TO PC251-MODU-DESC    27392000
273930              ELSE                                                27393000
273940                  MOVE P2LMOD-MODU-NBR      TO PV-MOD             27394000
273950                  MOVE '-'                  TO PV-MOD-DATE-DASH   27395000
273960                  MOVE '99'                 TO PV-ARRIVE-MM       27396000
273970                  MOVE '99'                 TO PV-ARRIVE-DD       27397000
273980                  MOVE PV-MOD-DATE          TO PC251-MODU-DESC    27398000
273990              END-IF                                              27399000
274000                                                                  27400000
274100         WHEN SQLWARN0 NOT = SPACES                               27410000
274200         WHEN SQLCODE < ZERO                                      27420000
274300         WHEN SQLCODE > ZERO                                      27430000
274400              SET  PC251-INVALID-SQL TO TRUE                      27440000
274500              MOVE SQLCODE           TO PC251-SQL-CODE            27450000
274600              MOVE 'TP2LMOD'         TO PC251-ERROR-TABLE-NME     27460000
274700              PERFORM 9000-RETURN-CALL                            27470000
274800                                                                  27480000
274900     END-EVALUATE.                                                27490000
275000                                                                  27500000
275100                                                                  27510000
275200*================================================================*27520000
275300* DEPARTMENT DESCRIPTION AND MAJOR CLASS                         *27530000
275400*================================================================*27540000
275500 5410-DEPT-MAJOR-CLASS.                                           27550000
275600     MOVE '5410-DEPT-MAJOR-CLASS'                                 27560000
275700                                    TO PC251-ERROR-PARA-NBR.      27570000
275800     MOVE PC251-DEPT-NBR               TO XL073-DEPT-NBR.         27580000
275900     MOVE PC251-CL-NBR                 TO XL073-MAJ-CL-NBR.       27590000
276000                                                                  27600000
276100     CALL XL073-DEPT-CL-MODULE USING XL073-COMMAREA-REC           27610000
276200     EVALUATE TRUE                                                27620000
276300        WHEN XL073-NO-ERRORS                                      27630000
276400             MOVE XL073-DEPT-NAME       TO PV-DEPT-NAME           27640000
276500             MOVE XL073-MAJ-CL-NAME     TO PV-MAJOR-CLASS         27650000
276600             MOVE XL073-STR-ZN-CDE      TO PV-STORE-ZONE          27660000
276700        WHEN XL073-MAJ-CL-NOT-FND                                 27670000
276800             MOVE XL073-DEPT-NAME       TO PV-DEPT-NAME           27680000
276900             MOVE SPACES                TO PV-MAJOR-CLASS         27690000
277000        WHEN XL073-DEPT-NOT-FND                                   27700000
277100             MOVE SPACES                TO PV-DEPT-NAME           27710000
277200                                           PV-MAJOR-CLASS         27720000
277300             MOVE XL073-STR-ZN-CDE      TO PV-STORE-ZONE          27730000
277400        WHEN XL073-BAD-DB2-RETURN                                 27740000
277500              SET  PC251-INVALID-SQL TO TRUE                      27750000
277600              MOVE SPACES                TO PV-DEPT-NAME          27760000
277700                                            PV-MAJOR-CLASS        27770000
277800                                            PV-STORE-ZONE         27780000
277900              MOVE XL073-SQLCODE     TO PC251-SQL-CODE            27790000
278000              MOVE XL073-DB2-TABLE   TO PC251-ERROR-TABLE-NME     27800000
278100              PERFORM 9000-RETURN-CALL                            27810000
278200     END-EVALUATE.                                                27820000
278300                                                                  27830000
278400*================================================================*27840000
278500 5430-CALL-SET-FIXT-ID-MOD.                                       27850000
278600     MOVE '5430-CALL-SET-FIXT-ID-MOD'                             27860000
278700                                    TO PC251-ERROR-PARA-NBR       27870000
278800     INITIALIZE PC240-ITEM-COMMAREA                               27880000
278900     MOVE PC251-PO-NBR                TO PC240-KEY-PO             27890000
279000     MOVE RECDIS-STR-NBR              TO PC240-KEY-DEST-LOC       27900000
279100     MOVE PC251-SKU                   TO PC240-KEY-SKU            27910000
279200     SET  PC240-CSEPK-SPLIT-VRTL      TO TRUE                     27920000
279300                                                                  27930000
279400     IF PC251-PRE-PACK-ORDER                                      27940000
279500        SET PC240-PREPK-ORDER-YES       TO TRUE                   27950000
279600        MOVE PC251-PREPK-ID             TO PC240-KEY-PREPK-ID     27960000
279700        MOVE PC251-RCVR-SEQ-NBR         TO PC240-KEY-REC-SEQ-NBR  27970000
279800     ELSE                                                         27980000
279900        SET PC240-PREPK-ORDER-NO        TO TRUE                   27990000
280000     END-IF                                                       28000000
280100                                                                  28010000
280200     CALL PC240-VSM-PGM  USING PC240-ITEM-COMMAREA.               28020000
280300                                                                  28030000
280400     EVALUATE TRUE                                                28040000
280500         WHEN PC240-SUCCESSFUL                                    28050000
280600                                                                  28060000
280700             IF PC240-NO-SEASONAL-SET-FOUND                       28070000
280800                SET PS-NO-SEASET-DATA-FOUND TO TRUE               28080000
280900             ELSE                                                 28090000
281000                MOVE PC240-SEASET-SHRT-NM TO PV-SEASET-SHRT-NM    28100000
281100                MOVE PC240-STR-RLSE-END-DTE TO PV-SEASET-RLSE-DT  28110000
281200             END-IF                                               28120000
281300                                                                  28130000
281400             IF PC240-DIVERT-PFX-NBR = ZEROES                     28140000
281500                MOVE ZEROES TO PV-DIVERT-PFX-NBR                  28150000
281600             ELSE                                                 28160000
281700                MOVE PC240-DIVERT-PFX-NBR TO                      28170000
281800                                   PV-DIVERT-PFX-NBR              28180000
281900             END-IF                                               28190000
282000                                                                  28200000
282100             IF PC240-POG-SEASET-IND = 'Y'                        28210000
282200                SET PS-POG-DATA-FOUND TO TRUE                     28220000
282300             ELSE                                                 28230000
282400                IF (PC240-POG-SEASET-YR    > SPACES) AND          28240000
282500                   (PC240-POG-SEASET-SHRT-NM  > SPACES)           28250000
282600                   SET PS-POG-DATA-FOUND TO TRUE                  28260000
282700                ELSE                                              28270000
282800                   SET PS-NO-POG-DATA-FOUND TO TRUE               28280000
282900                END-IF                                            28290000
283000             END-IF                                               28300000
283100         WHEN PC240-ITEM-NOT-FOUND                                28310000
283200             MOVE PC240-DIVERT-PFX-NBR TO PV-DIVERT-CODE          28320000
283300             MOVE SPACES               TO PV-SEASET-SHRT-NM       28330000
283400         WHEN PC240-SQL-ERROR                                     28340000
283500         WHEN PC240-INVALID-ACCESS                                28350000
283600              SET  PC251-INVALID-SQL TO TRUE                      28360000
283700              MOVE PC240-ERROR-NBR   TO PC251-SQL-CODE            28370000
283800              PERFORM 9000-RETURN-CALL                            28380000
283900                                                                  28390000
284000         WHEN OTHER                                               28400000
284100              SET  PC251-INVALID-SQL TO TRUE                      28410000
284200              MOVE PC240-ERROR-NBR     TO   PC251-SQL-CODE        28420000
284300              PERFORM 9000-RETURN-CALL                            28430000
284400                                                                  28440000
284500     END-EVALUATE.                                                28450000
284600*================================================================*28460000
284700* GET MANIFEST NUMBER                                            *28470000
284800*================================================================*28480000
284900 5435-MANIFEST-NBR.                                               28490000
285000                                                                  28500000
285100     MOVE  PT-CRTN-STORE-NBR (PT-CRTN-IDX)  TO  DK-STR-NBR.       28510000
285200                                                                  28520000
285300     PERFORM 5440-OPEN-DCSTMF-CSR.                                28530000
285400     PERFORM 5445-FETCH-DCSTMF-CSR.                               28540000
285500                                                                  28550000
285600     IF DCSTMF-MFST-NBR > 90000000                                28560000
285700        INITIALIZE DCSTMF-MFST-NBR                                28570000
285800        MOVE +1 TO DCSTMF-MFST-NBR                                28580000
285900     END-IF                                                       28590000
286000     ADD  +1                TO DCSTMF-MFST-NBR.                   28600000
286100                                                                  28610000
286200     PERFORM 5447-UPDATE-DCSTMF                                   28620000
286300*    PERFORM 3500-SYNCPOINT                                       28630000
286400                                                                  28640000
286500     PERFORM 5450-CLOSE-DCSTMF-CSR.                               28650000
286600     MOVE  DCSTMF-MFST-NBR       TO PT-CRTN-MANIFEST-NBR          28660000
286700                                              (PT-CRTN-IDX).      28670000
286800                                                                  28680000
286900******************************************************************28690000
287000******************************************************************28700000
287100 5440-OPEN-DCSTMF-CSR.                                            28710000
287200     MOVE '5440-OPEN-DCSTMF-CSR'  TO PC251-ERROR-PARA-NBR.        28720000
287300     EXEC SQL                                                     28730000
287400         OPEN DCSTMF_CSR                                          28740000
287500     END-EXEC.                                                    28750000
287600                                                                  28760000
287700     EVALUATE TRUE                                                28770000
287800         WHEN SQLCODE = ZERO                                      28780000
287900             CONTINUE                                             28790000
288000         WHEN SQLWARN0 NOT = SPACES                               28800000
288100         WHEN SQLCODE < ZERO                                      28810000
288200         WHEN SQLCODE > ZERO                                      28820000
288300              SET  PC251-INVALID-SQL TO TRUE                      28830000
288400              MOVE SQLCODE           TO PC251-SQL-CODE            28840000
288500              MOVE 'TDCMFST'         TO PC251-ERROR-TABLE-NME     28850000
288510              PERFORM 9000-RETURN-CALL                            28851000
288520                                                                  28852000
288530     END-EVALUATE.                                                28853000
288540                                                                  28854000
288550                                                                  28855000
288560******************************************************************28856000
288570******************************************************************28857000
288580 5445-FETCH-DCSTMF-CSR.                                           28858000
288590                                                                  28859000
288600     MOVE '5445-FETCH-DCSTMF-CSR' TO PC251-ERROR-PARA-NBR.        28860000
288610                                                                  28861000
288620     EXEC SQL                                                     28862000
288621         FETCH DCSTMF_CSR                                         28862100
288622          INTO :DCSTMF-MFST-NBR                                   28862200
288623     END-EXEC.                                                    28862300
288624                                                                  28862400
288625     EVALUATE TRUE                                                28862500
288626         WHEN SQLCODE = ZERO                                      28862600
288627         WHEN SQLCODE = +100                                      28862700
288628             CONTINUE                                             28862800
288629         WHEN SQLWARN0 NOT = SPACES                               28862900
288630         WHEN SQLCODE < ZERO                                      28863000
288640         WHEN SQLCODE > ZERO                                      28864000
288641              MOVE SQLCODE           TO PC251-SQL-CODE            28864100
288642              MOVE 'TDCMFST'         TO PC251-ERROR-TABLE-NME     28864200
288643              PERFORM 9000-RETURN-CALL                            28864300
288644                                                                  28864400
288645     END-EVALUATE.                                                28864500
288646                                                                  28864600
288647                                                                  28864700
288648******************************************************************28864800
288649******************************************************************28864900
288650 5447-UPDATE-DCSTMF.                                              28865000
288651                                                                  28865100
288652     MOVE '5447-UPDATE-DCSTMF'    TO PC251-ERROR-PARA-NBR.        28865200
288653                                                                  28865300
288654                                                                  28865400
288655     EXEC SQL                                                     28865500
288656          UPDATE TDCSTMF                                          28865600
288657             SET MFST_NBR   = :DCSTMF-MFST-NBR                    28865700
288658           WHERE CURRENT OF DCSTMF_CSR                            28865800
288659     END-EXEC.                                                    28865900
288660                                                                  28866000
288661     EVALUATE TRUE                                                28866100
288662         WHEN SQLCODE = ZERO                                      28866200
288663         WHEN SQLCODE = +100                                      28866300
288664             CONTINUE                                             28866400
288665         WHEN SQLWARN0 NOT = SPACES                               28866500
288666         WHEN SQLCODE < ZERO                                      28866600
288667         WHEN SQLCODE > ZERO                                      28866700
288668              SET  PC251-INVALID-SQL TO TRUE                      28866800
288669              MOVE SQLCODE           TO PC251-SQL-CODE            28866900
288670              MOVE 'TDCMFST'         TO PC251-ERROR-TABLE-NME     28867000
288671              PERFORM 9000-RETURN-CALL                            28867100
288672                                                                  28867200
288673     END-EVALUATE.                                                28867300
288674                                                                  28867400
288675                                                                  28867500
288676******************************************************************28867600
288677******************************************************************28867700
288678 5450-CLOSE-DCSTMF-CSR.                                           28867800
288679     MOVE '5450-CLOSE-DCSTMF-CSR' TO PC251-ERROR-PARA-NBR.        28867900
288680                                                                  28868000
288681     EXEC SQL                                                     28868100
288682        CLOSE DCSTMF_CSR                                          28868200
288683     END-EXEC.                                                    28868300
288684                                                                  28868400
288685     EVALUATE TRUE                                                28868500
288686         WHEN SQLCODE = ZERO                                      28868600
288687             CONTINUE                                             28868700
288688         WHEN SQLWARN0 NOT = SPACES                               28868800
288689         WHEN SQLCODE < ZERO                                      28868900
288690         WHEN SQLCODE > ZERO                                      28869000
288691              SET  PC251-INVALID-SQL TO TRUE                      28869100
288692              MOVE SQLCODE           TO PC251-SQL-CODE            28869200
288693              MOVE 'TDCMFST'         TO PC251-ERROR-TABLE-NME     28869300
288694              PERFORM 9000-RETURN-CALL                            28869400
288695                                                                  28869500
288696     END-EVALUATE.                                                28869600
288697                                                                  28869700
288698                                                                  28869800
288699*================================================================*28869900
288700* CREATE ENTRIES IN DISTRIBUTION HEADER & DETAIL TABLES          *28870000
288800*================================================================*28880000
288900 5500-CREATE-HDR-DTL-TBL.                                         28890000
289000                                                                  28900000
289100     PERFORM 5510-BUILD-TDISTHD.                                  28910000
289200     IF  PS-NO-ERROR                                              28920000
289300         IF  PC251-PRE-PACK-ORDER                                 28930000
289400             PERFORM 5700-PREPK-DISTHD                            28940000
289500         END-IF                                                   28950000
289600         MOVE PC251-PO-LNE-NBR        TO  DK-ORD-LNE-NBR          28960000
289700     END-IF.                                                      28970000
289800                                                                  28980000
289900     IF  PS-NO-ERROR                                              28990000
290000         PERFORM 5600-BUILD-TDISTDT                               29000000
290100     END-IF.                                                      29010000
290200                                                                  29020000
290300                                                                  29030000
290400*================================================================*29040000
290500* BUILD DISTHD TABLE ENTRY                                       *29050000
290600*================================================================*29060000
290700 5510-BUILD-TDISTHD.                                              29070000
290800     INITIALIZE DCLTDISTHD.                                       29080000
290900                                                                  29090000
291000     MOVE PC251-PO-NBR            TO  DK-PO-NBR.                  29100000
291100     MOVE PC251-RCVR-SEQ-NBR      TO  DK-RCVR-SEQ-NBR.            29110000
291200     MOVE PC251-PO-LNE-NBR        TO  DK-ORD-LNE-NBR              29120000
291300     MOVE PC-0001                 TO  DK-WORK-ORD-SEQ-NBR.        29130000
291400     MOVE PC251-OPER-UNT-ID       TO  DK-OPER-UNT-ID.             29140000
291500                                                                  29150000
291600     PERFORM 5520-UPDATE-HDR-ZEROES.                              29160000
291700                                                                  29170000
291800                                                                  29180000
291900     IF  PS-NO-ERROR                                              29190000
292000         IF  PS-DISTHD-UPDATE                                     29200000
292100             PERFORM 5522-GET-PRC-CNT                             29210000
292200         ELSE                                                     29220000
292300             MOVE ZEROES  TO  DISTHD-VRTL-LBL-PRC-CNT             29230000
292400         END-IF                                                   29240000
292500     END-IF.                                                      29250000
292600                                                                  29260000
292700                                                                  29270000
292800     IF  PS-NO-ERROR                                              29280000
292900         MOVE PC251-TOTAL-CARTONS  TO DISTHD-TOT-CART-CNT         29290000
293000         MOVE PV-P2L-CRTN-CNT      TO DISTHD-P2L-CART-CNT         29300000
293100         MOVE PV-FCSE-CRTN-CNT     TO DISTHD-FCSE-CART-CNT        29310000
293200         MOVE PC251-MOD-NBR        TO DISTHD-PRC-AREA-MODU-ID     29320000
293300         MOVE PC-U                 TO DISTHD-FCSE-LBL-TYP-CDE     29330000
293400         MOVE PC-F                 TO DISTHD-SYS-CRE-CDE          29340000
293500         MOVE PC251-INPK-UNT-QTY   TO DISTHD-INPK-UNT-QTY         29350000
293600         MOVE PV-INPK-CRTN-CNT     TO DISTHD-INPK-CART-CNT        29360000
293700         IF PC251-MULT-OTPK                                       29370000
293800             MOVE ZEROES           TO DISTHD-OTPK-UNT-QTY         29380000
293900         ELSE                                                     29390000
294000             MOVE PC251-OTPK-UNT-QTY TO DISTHD-OTPK-UNT-QTY       29400000
294100         END-IF                                                   29410000
294200                                                                  29420000
294300         MOVE PC251-INPK-CNVY-IND  TO DISTHD-INPK-CNVYB-IND       29430000
294400*        MOVE PC251-SPEC-INST-DESC TO DISTHD-SPC-INSTR-DESC       29440000
294500         MOVE PC251-USER-ID        TO DISTHD-CRE-USR-ID           29450000
294600         MOVE PC-DOWNLOADED-STATUS TO DISTHD-PRCG-STAT-CDE        29460000
294700         MOVE PC-P2L-PROCESSOR     TO DISTHD-DISTRB-PRC-AREA-ID   29470000
294800         MOVE PC-DEFAULT-TIMESTAMP TO DISTHD-RSLTS-RCVD-TMST      29480000
294900         MOVE PC-DEFAULT-TIMESTAMP TO DISTHD-VRFD-TMST            29490000
295000         MOVE PC-DEFAULT-TIMESTAMP TO DISTHD-FCSE-CNFRMN-TMST     29500000
295100*        MOVE PC251-FCSE-AREA      TO DISTHD-FCSE-FCLTY-AREA-ID   29510000
295200         MOVE ZEROES               TO DISTHD-ODD-CART-UNT-QTY     29520000
295300         MOVE PC251-CASEPACK-FUNCTION TO DISTHD-CRE-LBL-OPT-CDE   29530000
295400         MOVE PC251-PRCS-QTY       TO DISTHD-CAL-UNT-PRCD-QTY     29540000
295500         MOVE PC-U                 TO DISTHD-UCC128-DAT-USG-CDE   29550000
295600                                                                  29560000
295700         IF PS-DISTHD-UPDATE                                      29570000
295800             MOVE PC251-USER-ID    TO DISTHD-CART-DWNLD-USR-ID    29580000
295900         END-IF                                                   29590000
296000                                                                  29600000
296100         IF PC251-PRE-PACK-ORDER                                  29610000
296200             MOVE PC-PREPK-P2L-DWNLD TO DISTHD-PREPK-LNE-PRC-CDE  29620000
296300         ELSE                                                     29630000
296400             MOVE PC-NON-PREPK     TO DISTHD-PREPK-LNE-PRC-CDE    29640000
296500         END-IF                                                   29650000
296600                                                                  29660000
296700                                                                  29670000
296800         ADD  1  TO   DISTHD-VRTL-LBL-PRC-CNT                     29680000
296900                                                                  29690000
297000                                                                  29700000
297100         IF PS-DISTHD-UPDATE                                      29710000
297200             PERFORM 5535-UPDATE-HEADER                           29720000
297300         ELSE                                                     29730000
297400         IF PS-DISTHD-INSERT                                      29740000
297500             PERFORM 5536-INSERT-HEADER                           29750000
297600         END-IF                                                   29760000
297700         END-IF                                                   29770000
297800     END-IF.                                                      29780000
297900                                                                  29790000
298000                                                                  29800000
298100*----------------------------------------------------------------*29810000
298200* THIS PARAGRAPH WILL RESET ALL VALUES IN DISTHD.  IF FOUND      *29820000
298300* DELETE ALL CORESPONDING DISTDT RECORDS AND SET PS-DISTHD-UPDATE*29830000
298400* TO TRUE                                                        *29840000
298500* IF NO RECORD WAS FOUND ON UPDATE SET PS-DISTHD-INSERT TO TRUE  *29850000
298600*----------------------------------------------------------------*29860000
298700 5520-UPDATE-HDR-ZEROES.                                          29870000
298800                                                                  29880000
298900     MOVE  SPACE  TO  PS-INSERT-UPDATE-SW.                        29890000
299000                                                                  29900000
299100     PERFORM 5530-DEL-UPD-HEADER.                                 29910000
299200                                                                  29920000
299300     IF  PS-DISTHD-UPDATE                                         29930000
299400         PERFORM 5527-DELETE-DETAIL                               29940000
299500         IF  PS-NO-ERROR                                          29950000
299600             IF  PC251-PRE-PACK-ORDER                             29960000
299700                 PERFORM  5540-DEL-PREPK-DTL                      29970000
299800             END-IF                                               29980000
299900         END-IF                                                   29990000
300000     END-IF.                                                      30000000
300100                                                                  30010000
300200                                                                  30020000
300300*----------------------------------------------------------------*30030000
300400* THIS PARAGRAPH WILL GET THE LABEL PROCESS COUNTS               *30040000
300500*----------------------------------------------------------------*30050000
300600 5522-GET-PRC-CNT.                                                30060000
300700     MOVE '5522-GET-PRC-CNT'                                      30070000
300800                                    TO PC251-ERROR-PARA-NBR       30080000
300900                                                                  30090000
301000     EXEC SQL                                                     30100000
301100          SELECT  VRTL_LBL_PRC_CNT                                30110000
301200            INTO  :DISTHD-VRTL-LBL-PRC-CNT                        30120000
301300            FROM  TDISTHD                                         30130000
301400           WHERE ORD_NBR           = :DK-PO-NBR                   30140000
301500             AND RCVR_SEQ_NBR      = :DK-RCVR-SEQ-NBR             30150000
301600             AND ORD_LNE_NBR       = :DK-ORD-LNE-NBR              30160000
301610          WITH UR                                                 30161000
301700     END-EXEC.                                                    30170000
301800                                                                  30180000
301900     EVALUATE TRUE                                                30190000
302000         WHEN SQLCODE = ZERO                                      30200000
302100         WHEN SQLCODE = +100                                      30210000
302200              CONTINUE                                            30220000
302300         WHEN SQLWARN0 NOT = SPACES                               30230000
302400         WHEN SQLCODE < ZERO                                      30240000
302500         WHEN SQLCODE > ZERO                                      30250000
302600              SET  PC251-INVALID-SQL TO TRUE                      30260000
302700              MOVE SQLCODE           TO PC251-SQL-CODE            30270000
302800              MOVE 'TDISTHD'         TO PC251-ERROR-TABLE-NME     30280000
302900              PERFORM 9000-RETURN-CALL                            30290000
303000     END-EVALUATE.                                                30300000
303100                                                                  30310000
303200*----------------------------------------------------------------*30320000
303300                                                                  30330000
303400*----------------------------------------------------------------*30340000
303500 5527-DELETE-DETAIL.                                              30350000
303600                                                                  30360000
303700     MOVE '5527-DELETE-DETAIL'                                    30370000
303800                                    TO PC251-ERROR-PARA-NBR       30380000
303900     EXEC SQL                                                     30390000
304000          DELETE FROM TDISTDT                                     30400000
304100           WHERE ORD_NBR         = :DK-PO-NBR                     30410000
304200             AND RCVR_SEQ_NBR    = :DK-RCVR-SEQ-NBR               30420000
304300             AND ORD_LNE_NBR     = :DK-ORD-LNE-NBR                30430000
304400     END-EXEC.                                                    30440000
304500                                                                  30450000
304600     EVALUATE TRUE                                                30460000
304700         WHEN SQLCODE = ZERO                                      30470000
304800         WHEN SQLCODE = +100                                      30480000
304900                  CONTINUE                                        30490000
305000         WHEN SQLWARN0 NOT = SPACES                               30500000
305100         WHEN SQLCODE < ZERO                                      30510000
305200         WHEN SQLCODE > ZERO                                      30520000
305300              SET  PC251-INVALID-SQL TO TRUE                      30530000
305400              MOVE SQLCODE           TO PC251-SQL-CODE            30540000
305500              MOVE 'TDISTDT'         TO PC251-ERROR-TABLE-NME     30550000
305600              PERFORM 9000-RETURN-CALL                            30560000
305700     END-EVALUATE.                                                30570000
305800                                                                  30580000
305900                                                                  30590000
306000*----------------------------------------------------------------*30600000
306100*  UPDATE TRANSACTION HEADER ROW FOR THIS PO/RCVR/LINE            30610000
306200*----------------------------------------------------------------*30620000
306300 5530-DEL-UPD-HEADER.                                             30630000
306400     MOVE '5530-DEL-UPD-HEADER'                                   30640000
306500                                    TO PC251-ERROR-PARA-NBR       30650000
306600                                                                  30660000
306700     MOVE SPACES                  TO DISTHD-CART-DWNLD-USR-ID     30670000
306800                                     DISTHD-CRE-USR-ID            30680000
306900                                     DISTHD-SYS-CRE-CDE           30690000
307000                                     DISTHD-PRC-AREA-MODU-ID      30700000
307100                                     DISTHD-FCSE-LBL-TYP-CDE      30710000
307200                                     DISTHD-SPC-INSTR-DESC        30720000
307300                                     DISTHD-INPK-CNVYB-IND        30730000
307400                                     DISTHD-FCSE-CNFRMN-PGM-ID    30740000
307500                                     DISTHD-UCC128-DAT-USG-CDE.   30750000
307600                                                                  30760000
307700     MOVE ZERO                    TO DISTHD-TOT-CART-CNT          30770000
307800                                     DISTHD-FCSE-CART-CNT         30780000
307900                                     DISTHD-P2L-CART-CNT          30790000
308000                                     DISTHD-INPK-CART-CNT         30800000
308100                                     DISTHD-INPK-UNT-QTY          30810000
308200                                     DISTHD-OTPK-UNT-QTY          30820000
308300                                     DISTHD-ODD-CART-UNT-QTY      30830000
308400                                     DISTHD-CAL-UNT-PRCD-QTY.     30840000
308500                                                                  30850000
308600     EXEC SQL                                                     30860000
308700          UPDATE TDISTHD                                          30870000
308800             SET                                                  30880000
308900                 PRC_AREA_MODU_ID  = :DISTHD-PRC-AREA-MODU-ID     30890000
309000               , TOT_CART_CNT      = :DISTHD-TOT-CART-CNT         30900000
309100               , P2L_CART_CNT      = :DISTHD-P2L-CART-CNT         30910000
309200               , CRE_USR_ID        = :DISTHD-CRE-USR-ID           30920000
309300               , SYS_CRE_CDE       = :DISTHD-SYS-CRE-CDE          30930000
309400               , INPK_UNT_QTY      = :DISTHD-INPK-UNT-QTY         30940000
309500               , OTPK_UNT_QTY      = :DISTHD-OTPK-UNT-QTY         30950000
309600               , SPC_INSTR_DESC    = :DISTHD-SPC-INSTR-DESC       30960000
309700               , FCSE_CART_CNT     = :DISTHD-FCSE-CART-CNT        30970000
309800               , FCSE_LBL_TYP_CDE  = :DISTHD-FCSE-LBL-TYP-CDE     30980000
309900               , INPK_CART_CNT     = :DISTHD-INPK-CART-CNT        30990000
310000               , CART_DWNLD_DTE    = :PC-DEFAULT-DTE              31000000
310100               , CART_DWNLD_TM     = :PC-DEFAULT-TM               31010000
310200               ,CART_DWNLD_USR_ID  = :DISTHD-CART-DWNLD-USR-ID    31020000
310300               ,INPK_CNVYB_IND     = :DISTHD-INPK-CNVYB-IND       31030000
310400               ,FCSE_CNFRMN_PGM_ID = :DISTHD-FCSE-CNFRMN-PGM-ID   31040000
310500               ,ODD_CART_UNT_QTY   = :DISTHD-ODD-CART-UNT-QTY     31050000
310600               ,CAL_UNT_PRCD_QTY   = :DISTHD-CAL-UNT-PRCD-QTY     31060000
310700               ,UCC128_DAT_USG_CDE = :DISTHD-UCC128-DAT-USG-CDE   31070000
310800           WHERE ORD_NBR           = :DK-PO-NBR                   31080000
310900             AND RCVR_SEQ_NBR      = :DK-RCVR-SEQ-NBR             31090000
311000             AND ORD_LNE_NBR       = :DK-ORD-LNE-NBR              31100000
311100     END-EXEC.                                                    31110000
311200                                                                  31120000
311300     EVALUATE TRUE                                                31130000
311400         WHEN SQLCODE = ZERO                                      31140000
311500              SET PS-DISTHD-UPDATE   TO  TRUE                     31150000
311600         WHEN SQLCODE = +100                                      31160000
311700              SET PS-DISTHD-INSERT   TO  TRUE                     31170000
311800         WHEN SQLWARN0 NOT = SPACES                               31180000
311900         WHEN SQLCODE < ZERO                                      31190000
312000         WHEN SQLCODE > ZERO                                      31200000
312100              SET  PC251-INVALID-SQL TO TRUE                      31210000
312200              MOVE SQLCODE           TO PC251-SQL-CODE            31220000
312300              MOVE 'TDISTHD'         TO PC251-ERROR-TABLE-NME     31230000
312400              PERFORM 9000-RETURN-CALL                            31240000
312500     END-EVALUATE.                                                31250000
312600                                                                  31260000
312700                                                                  31270000
312800*----------------------------------------------------------------*31280000
312900                                                                  31290000
313000*----------------------------------------------------------------*31300000
313100 5535-UPDATE-HEADER.                                              31310000
313200                                                                  31320000
313300     MOVE '5535-UPDATE-HEADER '                                   31330000
313400                                    TO PC251-ERROR-PARA-NBR       31340000
313500     EXEC SQL                                                     31350000
313600          UPDATE TDISTHD                                          31360000
313700             SET                                                  31370000
313800                 TOT_CART_CNT        = :DISTHD-TOT-CART-CNT       31380000
313900               , P2L_CART_CNT        = :DISTHD-P2L-CART-CNT       31390000
314000               , INPK_UNT_QTY        = :DISTHD-INPK-UNT-QTY       31400000
314100               , OTPK_UNT_QTY        = :DISTHD-OTPK-UNT-QTY       31410000
314200               , CART_DWNLD_USR_ID   = :DISTHD-CART-DWNLD-USR-ID  31420000
314300               , FCSE_CART_CNT       = :DISTHD-FCSE-CART-CNT      31430000
314400               , INPK_CART_CNT       = :DISTHD-INPK-CART-CNT      31440000
314500               , PRC_AREA_MODU_ID    = :DISTHD-PRC-AREA-MODU-ID   31450000
314600               , PRCG_STAT_CDE       = :DISTHD-PRCG-STAT-CDE      31460000
314700               , CRE_USR_ID          = :PC251-USER-ID             31470000
314800               , CART_DWNLD_DTE      =  CURRENT DATE              31480000
314900               , CART_DWNLD_TM       =  CURRENT TIME              31490000
315000               , FCSE_LBL_TYP_CDE    = :DISTHD-FCSE-LBL-TYP-CDE   31500000
315100               , INPK_CNVYB_IND      = :DISTHD-INPK-CNVYB-IND     31510000
315200               , SYS_CRE_CDE         = :DISTHD-SYS-CRE-CDE        31520000
315300               , CRE_TMST            =  CURRENT TIMESTAMP         31530000
315400               , FCSE_FCLTY_AREA_ID  = :DISTHD-FCSE-FCLTY-AREA-ID 31540000
315500               , CRE_LBL_OPT_CDE     = :DISTHD-CRE-LBL-OPT-CDE    31550000
315600               , ODD_CART_UNT_QTY    = :DISTHD-ODD-CART-UNT-QTY   31560000
315700               , PREPK_LNE_PRC_CDE   = :DISTHD-PREPK-LNE-PRC-CDE  31570000
315800               , CAL_UNT_PRCD_QTY    = :DISTHD-CAL-UNT-PRCD-QTY   31580000
315900               , UCC128_DAT_USG_CDE  = :DISTHD-UCC128-DAT-USG-CDE 31590000
316000               , VRTL_LBL_PRC_CNT    = :DISTHD-VRTL-LBL-PRC-CNT   31600000
316100           WHERE ORD_NBR             = :DK-PO-NBR                 31610000
316200             AND RCVR_SEQ_NBR        = :DK-RCVR-SEQ-NBR           31620000
316300             AND ORD_LNE_NBR         = :DK-ORD-LNE-NBR            31630000
316400     END-EXEC.                                                    31640000
316500                                                                  31650000
316600     EVALUATE TRUE                                                31660000
316700         WHEN SQLCODE = ZERO                                      31670000
316800              CONTINUE                                            31680000
316900         WHEN SQLCODE = +100                                      31690000
317000              PERFORM 5536-INSERT-HEADER                          31700000
317100         WHEN SQLWARN0 NOT = SPACES                               31710000
317200         WHEN SQLCODE < ZERO                                      31720000
317300         WHEN SQLCODE > ZERO                                      31730000
317400              SET  PC251-INVALID-SQL TO TRUE                      31740000
317500              MOVE SQLCODE           TO PC251-SQL-CODE            31750000
317600              MOVE 'TDISTHD'         TO PC251-ERROR-TABLE-NME     31760000
317700              PERFORM 9000-RETURN-CALL                            31770000
317800     END-EVALUATE.                                                31780000
317900                                                                  31790000
318000                                                                  31800000
318100*----------------------------------------------------------------*31810000
318200                                                                  31820000
318300*----------------------------------------------------------------*31830000
318400 5536-INSERT-HEADER.                                              31840000
318500                                                                  31850000
318600     MOVE '5536-INSERT-HEADER '                                   31860000
318700                                    TO PC251-ERROR-PARA-NBR.      31870000
318800     MOVE  PC-DEFAULT-TIMESTAMP  TO  DISTHD-FCSE-CNFRMN-TMST.     31880000
318900     MOVE  PC-DEFAULT-TIMESTAMP  TO  DISTHD-DLT-REQ-TMST.         31890000
319000                                                                  31900000
319100     EXEC SQL                                                     31910000
319200          INSERT INTO TDISTHD                                     31920000
319300           ( ORD_NBR                                              31930000
319400            ,RCVR_SEQ_NBR                                         31940000
319500            ,ORD_LNE_NBR                                          31950000
319600            ,WRK_ORD_SEQ_NBR                                      31960000
319700            ,OPER_UNT_ID                                          31970000
319800            ,DISTRB_PRC_AREA_ID                                   31980000
319900            ,PRCG_STAT_CDE                                        31990000
320000            ,CRE_TMST                                             32000000
320100            ,RSLTS_RCVD_TMST                                      32010000
320200            ,VRFD_TMST                                            32020000
320300            ,PRC_AREA_MODU_ID                                     32030000
320400            ,CRE_USR_ID                                           32040000
320500            ,TOT_CART_CNT                                         32050000
320600            ,CART_DWNLD_DTE                                       32060000
320700            ,CART_DWNLD_TM                                        32070000
320800            ,CART_DWNLD_USR_ID                                    32080000
320900            ,FCSE_CART_CNT                                        32090000
321000            ,FCSE_LBL_TYP_CDE                                     32100000
321100            ,P2L_CART_CNT                                         32110000
321200            ,INPK_CART_CNT                                        32120000
321300            ,INPK_UNT_QTY                                         32130000
321400            ,INPK_CNVYB_IND                                       32140000
321500            ,OTPK_UNT_QTY                                         32150000
321600            ,SYS_CRE_CDE                                          32160000
321700            ,SPC_INSTR_DESC                                       32170000
321800            ,FCSE_CNFRMN_TMST                                     32180000
321900            ,FCSE_FCLTY_AREA_ID                                   32190000
322000            ,CRE_LBL_OPT_CDE                                      32200000
322100            ,ODD_CART_UNT_QTY                                     32210000
322200            ,DLT_REQ_TMST                                         32220000
322300            ,PREPK_LNE_PRC_CDE                                    32230000
322400            ,CAL_UNT_PRCD_QTY                                     32240000
322500            ,UCC128_DAT_USG_CDE                                   32250000
322600            ,VRTL_LBL_PRC_CNT                                     32260000
322700           )                                                      32270000
322800         VALUES (                                                 32280000
322900             :DK-PO-NBR                                           32290000
323000           , :DK-RCVR-SEQ-NBR                                     32300000
323100           , :DK-ORD-LNE-NBR                                      32310000
323200           , :DK-WORK-ORD-SEQ-NBR                                 32320000
323300           , :DK-OPER-UNT-ID                                      32330000
323400           , :DISTHD-DISTRB-PRC-AREA-ID                           32340000
323500           , :DISTHD-PRCG-STAT-CDE                                32350000
323600           ,  CURRENT TIMESTAMP                                   32360000
323700           , :DISTHD-RSLTS-RCVD-TMST                              32370000
323800           , :DISTHD-VRFD-TMST                                    32380000
323900           , :DISTHD-PRC-AREA-MODU-ID                             32390000
324000           , :DISTHD-CRE-USR-ID                                   32400000
324100           , :DISTHD-TOT-CART-CNT                                 32410000
324200           ,  CURRENT DATE                                        32420000
324300           ,  CURRENT TIME                                        32430000
324400           , :PC251-USER-ID                                       32440000
324500           , :DISTHD-FCSE-CART-CNT                                32450000
324600           , :DISTHD-FCSE-LBL-TYP-CDE                             32460000
324700           , :DISTHD-P2L-CART-CNT                                 32470000
324800           , :DISTHD-INPK-CART-CNT                                32480000
324900           , :DISTHD-INPK-UNT-QTY                                 32490000
325000           , :DISTHD-INPK-CNVYB-IND                               32500000
325100           , :DISTHD-OTPK-UNT-QTY                                 32510000
325200           , :DISTHD-SYS-CRE-CDE                                  32520000
325300           , :DISTHD-SPC-INSTR-DESC                               32530000
325400           , :DISTHD-FCSE-CNFRMN-TMST                             32540000
325500           , :DISTHD-FCSE-FCLTY-AREA-ID                           32550000
325600           , :DISTHD-CRE-LBL-OPT-CDE                              32560000
325700           , :DISTHD-ODD-CART-UNT-QTY                             32570000
325800           , :DISTHD-DLT-REQ-TMST                                 32580000
325900           , :DISTHD-PREPK-LNE-PRC-CDE                            32590000
326000           , :DISTHD-CAL-UNT-PRCD-QTY                             32600000
326100           , :DISTHD-UCC128-DAT-USG-CDE                           32610000
326200           , :DISTHD-VRTL-LBL-PRC-CNT                             32620000
326300         )                                                        32630000
326400     END-EXEC.                                                    32640000
326500                                                                  32650000
326600     EVALUATE TRUE                                                32660000
326700         WHEN SQLCODE = ZERO                                      32670000
326800              CONTINUE                                            32680000
326900                                                                  32690000
327000         WHEN SQLCODE = -803                                      32700000
327100              PERFORM 5535-UPDATE-HEADER                          32710000
327200         WHEN SQLWARN0 NOT = SPACES                               32720000
327300         WHEN SQLCODE < ZERO                                      32730000
327400         WHEN SQLCODE > ZERO                                      32740000
327500              MOVE SQLCODE           TO PC251-SQL-CODE            32750000
327600              MOVE 'TDISTHD'         TO PC251-ERROR-TABLE-NME     32760000
327700              PERFORM 9000-RETURN-CALL                            32770000
327800                                                                  32780000
327900     END-EVALUATE.                                                32790000
328000                                                                  32800000
328100                                                                  32810000
328200*----------------------------------------------------------------*32820000
328300*  ROUTINE TO DELETE DETAIL ROWS ASSOCIATED WITH PREPACK          32830000
328400*----------------------------------------------------------------*32840000
328500 5540-DEL-PREPK-DTL.                                              32850000
328600                                                                  32860000
328700     SET  PS-PREPK-LINES-LEFT TO TRUE.                            32870000
328800     PERFORM 5545-OPEN-DEL-PREPK-CSR.                             32880000
328900     PERFORM 5550-FETCH-DEL-PREPK-CSR                             32890000
329000       UNTIL PS-ERROR                                             32900000
329100          OR PS-NO-PREPK-LINES-LEFT.                              32910000
329200     PERFORM 5555-CLOSE-DEL-PREPK-CSR.                            32920000
329300                                                                  32930000
329400                                                                  32940000
329500*----------------------------------------------------------------*32950000
329600***OPEN DELETE DETAIL CURSOR FOR PREPACKS                         32960000
329700*----------------------------------------------------------------*32970000
329800 5545-OPEN-DEL-PREPK-CSR.                                         32980000
329900                                                                  32990000
330000     MOVE '5545-OPEN-DEL-PREPK-CSR'                               33000000
330100                                    TO PC251-ERROR-PARA-NBR.      33010000
330200     EXEC SQL                                                     33020000
330300          OPEN PRE_PACK_DEL_CSR                                   33030000
330400     END-EXEC.                                                    33040000
330500                                                                  33050000
330600     EVALUATE TRUE                                                33060000
330700         WHEN SQLCODE = ZERO                                      33070000
330800             CONTINUE                                             33080000
330900         WHEN SQLWARN0 NOT = SPACES                               33090000
331000         WHEN SQLCODE < ZERO                                      33100000
331100         WHEN SQLCODE > ZERO                                      33110000
331200              SET  PC251-INVALID-SQL TO TRUE                      33120000
331300              MOVE SQLCODE           TO PC251-SQL-CODE            33130000
331400              MOVE 'TRECITM'         TO PC251-ERROR-TABLE-NME     33140000
331500              PERFORM 9000-RETURN-CALL                            33150000
331600     END-EVALUATE.                                                33160000
331700                                                                  33170000
331800                                                                  33180000
331900*----------------------------------------------------------------*33190000
332000**FETCH DELETE DETAIL CURSOR FOR PREPACKS                         33200000
332100*----------------------------------------------------------------*33210000
332200 5550-FETCH-DEL-PREPK-CSR.                                        33220000
332300     MOVE '5550-FETCH-DEL-PREPK-CSR'                              33230000
332400                                    TO PC251-ERROR-PARA-NBR.      33240000
332500                                                                  33250000
332600     EXEC SQL                                                     33260000
332700          FETCH PRE_PACK_DEL_CSR                                  33270000
332800           INTO :DK-PREPK-LNE-NBR                                 33280000
332900               ,:DK-PREPK-RATIO-QTY                               33290000
333000     END-EXEC.                                                    33300000
333100                                                                  33310000
333200     EVALUATE TRUE                                                33320000
333300         WHEN SQLCODE = ZERO                                      33330000
333400              PERFORM 5560-DELETE-PREPK-DETAIL                    33340000
333500                                                                  33350000
333600         WHEN SQLCODE = +100                                      33360000
333700         SET PS-NO-PREPK-LINES-LEFT                               33370000
333800                                   TO TRUE                        33380000
333900         WHEN SQLWARN0 NOT = SPACES                               33390000
334000         WHEN SQLCODE < ZERO                                      33400000
334100         WHEN SQLCODE > ZERO                                      33410000
334200              SET  PC251-INVALID-SQL TO TRUE                      33420000
334300              MOVE SQLCODE           TO PC251-SQL-CODE            33430000
334400              MOVE 'TRECITM'         TO PC251-ERROR-TABLE-NME     33440000
334500              PERFORM 9000-RETURN-CALL                            33450000
334600     END-EVALUATE.                                                33460000
334700                                                                  33470000
334800                                                                  33480000
334900*----------------------------------------------------------------*33490000
335000**CLOSE DELETE DETAIL CURSOR FOR PREPACKS                         33500000
335100*----------------------------------------------------------------*33510000
335200 5555-CLOSE-DEL-PREPK-CSR.                                        33520000
335300                                                                  33530000
335400     MOVE '5555-CLOSE-DEL-PREPK-CSR'                              33540000
335500                                    TO PC251-ERROR-PARA-NBR.      33550000
335600     EXEC SQL                                                     33560000
335700          CLOSE PRE_PACK_DEL_CSR                                  33570000
335800     END-EXEC.                                                    33580000
335900                                                                  33590000
336000     EVALUATE TRUE                                                33600000
336100         WHEN SQLCODE = ZERO                                      33610000
336200             CONTINUE                                             33620000
336300         WHEN SQLWARN0 NOT = SPACES                               33630000
336400         WHEN SQLCODE < ZERO                                      33640000
336500         WHEN SQLCODE > ZERO                                      33650000
336600              SET  PC251-INVALID-SQL TO TRUE                      33660000
336700              MOVE SQLCODE           TO PC251-SQL-CODE            33670000
336800              MOVE 'TRECITM'         TO PC251-ERROR-TABLE-NME     33680000
336900              PERFORM 9000-RETURN-CALL                            33690000
337000     END-EVALUATE.                                                33700000
337100                                                                  33710000
337200                                                                  33720000
337300*----------------------------------------------------------------*33730000
337400**DELETE DETAIL FOR PREPACKS                                      33740000
337500*----------------------------------------------------------------*33750000
337600 5560-DELETE-PREPK-DETAIL.                                        33760000
337700                                                                  33770000
337800     MOVE '5560-DELETE-PREPK-DETAIL'                              33780000
337900                                    TO PC251-ERROR-PARA-NBR.      33790000
338000     EXEC SQL                                                     33800000
338100          DELETE FROM TDISTDT                                     33810000
338200           WHERE ORD_NBR         = :DK-PO-NBR                     33820000
338300             AND RCVR_SEQ_NBR    = :DK-RCVR-SEQ-NBR               33830000
338400             AND ORD_LNE_NBR     = :DK-PREPK-LNE-NBR              33840000
338500     END-EXEC.                                                    33850000
338600                                                                  33860000
338700     EVALUATE TRUE                                                33870000
338800         WHEN SQLCODE = ZERO                                      33880000
338900         WHEN SQLCODE = +100                                      33890000
339000                  CONTINUE                                        33900000
339100         WHEN SQLWARN0 NOT = SPACES                               33910000
339200         WHEN SQLCODE < ZERO                                      33920000
339300         WHEN SQLCODE > ZERO                                      33930000
339400              SET  PC251-INVALID-SQL TO TRUE                      33940000
339500              MOVE SQLCODE           TO PC251-SQL-CODE            33950000
339600              MOVE 'TDISTDT'         TO PC251-ERROR-TABLE-NME     33960000
339700              PERFORM 9000-RETURN-CALL                            33970000
339800     END-EVALUATE.                                                33980000
339900                                                                  33990000
340000                                                                  34000000
340100*================================================================*34010000
340200*                                                                *34020000
340300*================================================================*34030000
340400 5600-BUILD-TDISTDT.                                              34040000
340500                                                                  34050000
340600     MOVE PC251-PO-NBR         TO DISTDT-ORD-NBR.                 34060000
340700     MOVE PC251-RCVR-SEQ-NBR   TO DISTDT-RCVR-SEQ-NBR.            34070000
340800     MOVE PC251-PO-LNE-NBR     TO DISTDT-ORD-LNE-NBR.             34080000
340900     MOVE PC-0001              TO DISTDT-WRK-ORD-SEQ-NBR.         34090000
341000     MOVE SPACE                TO DISTDT-ODD-CART-IND             34100000
341100     MOVE ZEROES               TO DISTDT-PREPK-ODD-UNT-QTY        34110000
341200     MOVE PC-READY-TO-POST-STATUS                                 34120000
341300                               TO DISTDT-RCVG-PSTD-STAT-CDE       34130000
341400                                                                  34140000
341500     PERFORM                                                      34150000
341600        VARYING PT-EXPT-IDX                                       34160000
341700           FROM 1  BY  1                                          34170000
341800          UNTIL PT-EXPT-IDX  >  PV-EXPECT-TABLE-ENTRIES           34180000
341900                MOVE PT-EXPT-STR-NBR (PT-EXPT-IDX)                34190000
342000                               TO DISTDT-STR-NBR                  34200000
342100                MOVE PT-EXPT-EXPTED-QTY (PT-EXPT-IDX)             34210000
342200                               TO DISTDT-EXPTED-ALLOC-QTY         34220000
342300                IF (PT-EXPT-DISTRB-CNTR (PT-EXPT-IDX)  OR         34230000
342400                    PT-EXPT-RETURN-VNDR (PT-EXPT-IDX))   AND      34240000
342500                    PT-EXPT-P2L-UNTS  (PT-EXPT-IDX)  >  0         34250000
342600                    MOVE PT-EXPT-P2L-UNTS   (PT-EXPT-IDX)         34260000
342700                               TO DISTDT-ACTL-ALLOC-QTY           34270000
342800                ELSE                                              34280000
342900                    MOVE ZEROES                                   34290000
343000                               TO DISTDT-ACTL-ALLOC-QTY           34300000
343100                END-IF                                            34310000
343200                MOVE PT-EXPT-P2L-UNTS (PT-EXPT-IDX)               34320000
343300                               TO DISTDT-P2L-SPLT-UNT-QTY         34330000
343400                MOVE PT-EXPT-FCSE-UNTS (PT-EXPT-IDX)              34340000
343500                               TO DISTDT-FCSE-SPLT-UNT-QTY        34350000
343600                MOVE PT-EXPT-INPK-UNTS (PT-EXPT-IDX)              34360000
343700                               TO DISTDT-INPK-SPLT-UNT-QTY        34370000
343800                ADD  PT-EXPT-FCSE-UNTS (PT-EXPT-IDX)              34380000
343900                     PT-EXPT-INPK-UNTS (PT-EXPT-IDX)              34390000
344000                           GIVING DISTDT-FCSE-ACTL-UNT-QTY        34400000
344100                PERFORM 5610-INSERT-DISTDT                        34410000
344200     END-PERFORM.                                                 34420000
344300                                                                  34430000
344400                                                                  34440000
344500*================================================================*34450000
344600*                                                                *34460000
344700*================================================================*34470000
344800 5610-INSERT-DISTDT.                                              34480000
344900                                                                  34490000
345000     MOVE '5610-INSERT-DISTDT '                                   34500000
345100                                    TO PC251-ERROR-PARA-NBR.      34510000
345200     EXEC SQL                                                     34520000
345300          INSERT                                                  34530000
345400          INTO  TDISTDT                                           34540000
345500               (ORD_NBR                                           34550000
345600               ,RCVR_SEQ_NBR                                      34560000
345700               ,ORD_LNE_NBR                                       34570000
345800               ,WRK_ORD_SEQ_NBR                                   34580000
345900               ,STR_NBR                                           34590000
346000               ,EXPTED_ALLOC_QTY                                  34600000
346100               ,ACTL_ALLOC_QTY                                    34610000
346200               ,RCVG_PSTD_STAT_CDE                                34620000
346300              , P2L_SPLT_UNT_QTY                                  34630000
346400              , FCSE_SPLT_UNT_QTY                                 34640000
346500              , INPK_SPLT_UNT_QTY                                 34650000
346600              , FCSE_ACTL_UNT_QTY                                 34660000
346700              , ODD_CART_IND                                      34670000
346800              , PREPK_ODD_UNT_QTY)                                34680000
346900        VALUES                                                    34690000
347000              (:DK-PO-NBR                                         34700000
347100              ,:DK-RCVR-SEQ-NBR                                   34710000
347200              ,:DK-ORD-LNE-NBR                                    34720000
347300              ,:DK-WORK-ORD-SEQ-NBR                               34730000
347400              ,:DISTDT-STR-NBR                                    34740000
347500              ,:DISTDT-EXPTED-ALLOC-QTY                           34750000
347600              ,:DISTDT-ACTL-ALLOC-QTY                             34760000
347700              ,:DISTDT-RCVG-PSTD-STAT-CDE                         34770000
347800              ,:DISTDT-P2L-SPLT-UNT-QTY                           34780000
347900              ,:DISTDT-FCSE-SPLT-UNT-QTY                          34790000
348000              ,:DISTDT-INPK-SPLT-UNT-QTY                          34800000
348100              ,:DISTDT-FCSE-ACTL-UNT-QTY                          34810000
348200              ,:DISTDT-ODD-CART-IND                               34820000
348300              ,:DISTDT-PREPK-ODD-UNT-QTY)                         34830000
348400     END-EXEC.                                                    34840000
348500                                                                  34850000
348600     EVALUATE TRUE                                                34860000
348700         WHEN SQLCODE = ZERO                                      34870000
348800              IF  PC251-PRE-PACK-ORDER                            34880000
348900                  PERFORM 5730-PREPK-DISTDT                       34890000
349000                  MOVE PC251-PO-LNE-NBR  TO  DK-ORD-LNE-NBR       34900000
349100              END-IF                                              34910000
349200         WHEN SQLWARN0 NOT = SPACES                               34920000
349300         WHEN SQLCODE < ZERO                                      34930000
349400         WHEN SQLCODE > ZERO                                      34940000
349500              SET  PC251-INVALID-SQL TO TRUE                      34950000
349600              MOVE SQLCODE           TO PC251-SQL-CODE            34960000
349700              MOVE 'TDISTDT'         TO PC251-ERROR-TABLE-NME     34970000
349800              PERFORM 9000-RETURN-CALL                            34980000
349900                                                                  34990000
350000     END-EVALUATE.                                                35000000
350100                                                                  35010000
350200                                                                  35020000
350300*================================================================*35030000
350400* ROUTINE TO CREATE DISTHD ROWS FOR ALL LINES IN PREPK           *35040000
350500*================================================================*35050000
350600 5700-PREPK-DISTHD.                                               35060000
350700                                                                  35070000
350800     SET  PS-PREPK-LINES-LEFT TO TRUE.                            35080000
350900     PERFORM 5545-OPEN-DEL-PREPK-CSR.                             35090000
351000     IF  PS-NO-ERROR                                              35100000
351100         PERFORM 5710-FETCH-DEL-PREPK-CSR                         35110000
351200           UNTIL PS-ERROR                                         35120000
351300              OR PS-NO-PREPK-LINES-LEFT                           35130000
351400     END-IF.                                                      35140000
351500     PERFORM 5555-CLOSE-DEL-PREPK-CSR.                            35150000
351600                                                                  35160000
351700                                                                  35170000
351800*================================================================*35180000
351900* PROCESS PREPK CURSOR TO INSERT/UPDATE DISTHD FOR PREPK LINES   *35190000
352000*================================================================*35200000
352100 5710-FETCH-DEL-PREPK-CSR.                                        35210000
352200                                                                  35220000
352300     MOVE '5710-FETCH-DEL-PREPK-CSR'                              35230000
352400                                    TO PC251-ERROR-PARA-NBR.      35240000
352500     EXEC SQL                                                     35250000
352600          FETCH PRE_PACK_DEL_CSR                                  35260000
352700           INTO :DK-PREPK-LNE-NBR                                 35270000
352800               ,:DK-PREPK-RATIO-QTY                               35280000
352900     END-EXEC.                                                    35290000
353000                                                                  35300000
353100     EVALUATE TRUE                                                35310000
353200         WHEN SQLCODE = ZERO                                      35320000
353300              PERFORM 5720-PREPK-DISTHD                           35330000
353400                                                                  35340000
353500         WHEN SQLCODE = +100                                      35350000
353600         SET PS-NO-PREPK-LINES-LEFT                               35360000
353700                                   TO TRUE                        35370000
353800         WHEN SQLWARN0 NOT = SPACES                               35380000
353900         WHEN SQLCODE < ZERO                                      35390000
354000         WHEN SQLCODE > ZERO                                      35400000
354100              SET  PC251-INVALID-SQL TO TRUE                      35410000
354200              MOVE SQLCODE           TO PC251-SQL-CODE            35420000
354300              MOVE 'TRECITM'         TO PC251-ERROR-TABLE-NME     35430000
354400              PERFORM 9000-RETURN-CALL                            35440000
354500                                                                  35450000
354600     END-EVALUATE.                                                35460000
354700                                                                  35470000
354800                                                                  35480000
354900*================================================================*35490000
355000*                                                                *35500000
355100*================================================================*35510000
355200 5720-PREPK-DISTHD.                                               35520000
355300                                                                  35530000
355400     MOVE DK-PREPK-LNE-NBR        TO  DK-ORD-LNE-NBR              35540000
355500                                                                  35550000
355600     MOVE 'X'                     TO  DISTHD-FCSE-LBL-TYP-CDE.    35560000
355700     MOVE 'P'                     TO  DISTHD-PREPK-LNE-PRC-CDE.   35570000
355800                                                                  35580000
355900     IF  PC251-OTPK-UNT-QTY  >  0                                 35590000
356000         DIVIDE  PC251-OTPK-UNT-QTY                               35600000
356100             BY  PC251-PREPK-RATIO                                35610000
356200         GIVING  PV-OTPK-UNT-RATIO                                35620000
356300     ELSE                                                         35630000
356400        MOVE ZEROES  TO  PV-OTPK-UNT-RATIO                        35640000
356500     END-IF.                                                      35650000
356600                                                                  35660000
356700     COMPUTE DISTHD-OTPK-UNT-QTY                                  35670000
356800           = DISTHD-OTPK-UNT-QTY                                  35680000
356900           * DK-PREPK-RATIO-QTY.                                  35690000
357000                                                                  35700000
357100     DIVIDE  PC251-PRCS-QTY                                       35710000
357200         BY  PC251-PREPK-RATIO                                    35720000
357300     GIVING  PV-PRCS-QTY-UNT-RATIO.                               35730000
357400                                                                  35740000
357500     COMPUTE DISTHD-CAL-UNT-PRCD-QTY                              35750000
357600           = PV-PRCS-QTY-UNT-RATIO                                35760000
357700           * DK-PREPK-RATIO-QTY.                                  35770000
357800                                                                  35780000
357900     MOVE DK-PREPK-RATIO-QTY      TO  DISTHD-INPK-UNT-QTY.        35790000
358000                                                                  35800000
358100     IF  PS-DISTHD-UPDATE                                         35810000
358200         PERFORM 5535-UPDATE-HEADER                               35820000
358300     ELSE                                                         35830000
358400     IF  PS-DISTHD-INSERT                                         35840000
358500         PERFORM 5536-INSERT-HEADER                               35850000
358600     END-IF                                                       35860000
358700     END-IF.                                                      35870000
358800                                                                  35880000
358900                                                                  35890000
359000*================================================================*35900000
359100* ROUTINE TO CREATE DISTDT ROWS FOR ALL LINES IN PREPK           *35910000
359200*================================================================*35920000
359300 5730-PREPK-DISTDT.                                               35930000
359400                                                                  35940000
359500     DIVIDE    DISTDT-P2L-SPLT-UNT-QTY                            35950000
359600         BY    PC251-PREPK-RATIO                                  35960000
359700     GIVING    PV-P2L-SPLT-UNT-QTY-RATIO.                         35970000
359800                                                                  35980000
359900     DIVIDE    DISTDT-FCSE-SPLT-UNT-QTY                           35990000
360000         BY    PC251-PREPK-RATIO                                  36000000
360100     GIVING    PV-FCSE-SPLT-UNT-QTY-RATIO.                        36010000
360200                                                                  36020000
360300     DIVIDE    DISTDT-INPK-SPLT-UNT-QTY                           36030000
360400         BY    PC251-PREPK-RATIO                                  36040000
360500     GIVING    PV-INPK-SPLT-UNT-QTY-RATIO.                        36050000
360600                                                                  36060000
360700     DIVIDE    DISTDT-FCSE-ACTL-UNT-QTY                           36070000
360800         BY    PC251-PREPK-RATIO                                  36080000
360900     GIVING    PV-FCSE-ACTL-UNT-QTY-RATIO.                        36090000
361000                                                                  36100000
361100     DIVIDE    DISTDT-EXPTED-ALLOC-QTY                            36110000
361200         BY    PC251-PREPK-RATIO                                  36120000
361300     GIVING    PV-EXPTED-ITM-QTY-RATIO.                           36130000
361400                                                                  36140000
361500     DIVIDE    DISTDT-ACTL-ALLOC-QTY                              36150000
361600         BY    PC251-PREPK-RATIO                                  36160000
361700     GIVING    PV-ACTL-ALLOC-QTY-RATIO.                           36170000
361800                                                                  36180000
361900     SET  PS-PREPK-LINES-LEFT TO TRUE.                            36190000
362000     PERFORM 5545-OPEN-DEL-PREPK-CSR.                             36200000
362100     PERFORM 5740-FETCH-DEL-PREPK-CSR                             36210000
362200       UNTIL PS-ERROR                                             36220000
362300          OR PS-NO-PREPK-LINES-LEFT.                              36230000
362400     PERFORM 5555-CLOSE-DEL-PREPK-CSR.                            36240000
362500                                                                  36250000
362600                                                                  36260000
362700*================================================================*36270000
362800* PROCESS PREPK CURSOR TO INSERT/UPDATE DISTDT FOR PREPK LINES   *36280000
362900*================================================================*36290000
363000 5740-FETCH-DEL-PREPK-CSR.                                        36300000
363100                                                                  36310000
363200     MOVE '5740-FETCH-DEL-PREPK-CSR'                              36320000
363300                                    TO PC251-ERROR-PARA-NBR.      36330000
363400     EXEC SQL                                                     36340000
363500          FETCH PRE_PACK_DEL_CSR                                  36350000
363600           INTO :DK-PREPK-LNE-NBR                                 36360000
363700               ,:DK-PREPK-RATIO-QTY                               36370000
363800     END-EXEC.                                                    36380000
363900                                                                  36390000
364000     EVALUATE TRUE                                                36400000
364100         WHEN SQLCODE = ZERO                                      36410000
364200              PERFORM 5750-PREPK-DISTDT                           36420000
364300                                                                  36430000
364400         WHEN SQLCODE = +100                                      36440000
364500         SET PS-NO-PREPK-LINES-LEFT                               36450000
364600                                   TO TRUE                        36460000
364700         WHEN SQLWARN0 NOT = SPACES                               36470000
364800         WHEN SQLCODE < ZERO                                      36480000
364900         WHEN SQLCODE > ZERO                                      36490000
365000              SET  PC251-INVALID-SQL TO TRUE                      36500000
365100              MOVE SQLCODE           TO PC251-SQL-CODE            36510000
365200              MOVE 'TRECITM'         TO PC251-ERROR-TABLE-NME     36520000
365300              PERFORM 9000-RETURN-CALL                            36530000
365400     END-EVALUATE.                                                36540000
365500                                                                  36550000
365600                                                                  36560000
365700*================================================================*36570000
365800*                                                                *36580000
365900*================================================================*36590000
366000 5750-PREPK-DISTDT.                                               36600000
366100                                                                  36610000
366200     MOVE '5750-PREPK-DISTDT '                                    36620000
366300                                    TO PC251-ERROR-PARA-NBR.      36630000
366400     COMPUTE DISTDT-P2L-SPLT-UNT-QTY                              36640000
366500           = PV-P2L-SPLT-UNT-QTY-RATIO                            36650000
366600           * DK-PREPK-RATIO-QTY.                                  36660000
366700                                                                  36670000
366800     COMPUTE DISTDT-FCSE-SPLT-UNT-QTY                             36680000
366900           = PV-FCSE-SPLT-UNT-QTY-RATIO                           36690000
367000           * DK-PREPK-RATIO-QTY.                                  36700000
367100                                                                  36710000
367200     COMPUTE DISTDT-INPK-SPLT-UNT-QTY                             36720000
367300           = PV-INPK-SPLT-UNT-QTY-RATIO                           36730000
367400           * DK-PREPK-RATIO-QTY.                                  36740000
367500                                                                  36750000
367600     COMPUTE DISTDT-FCSE-ACTL-UNT-QTY                             36760000
367700           = PV-FCSE-ACTL-UNT-QTY-RATIO                           36770000
367800           * DK-PREPK-RATIO-QTY.                                  36780000
367900                                                                  36790000
368000     COMPUTE DISTDT-EXPTED-ALLOC-QTY                              36800000
368100           = PV-EXPTED-ITM-QTY-RATIO                              36810000
368200           * DK-PREPK-RATIO-QTY.                                  36820000
368300                                                                  36830000
368400     COMPUTE DISTDT-ACTL-ALLOC-QTY                                36840000
368500           = PV-ACTL-ALLOC-QTY-RATIO                              36850000
368600           * DK-PREPK-RATIO-QTY.                                  36860000
368700                                                                  36870000
368800     MOVE ZEROES  TO  DISTDT-PREPK-ODD-UNT-QTY.                   36880000
368900                                                                  36890000
369000     EXEC SQL                                                     36900000
369100          INSERT                                                  36910000
369200          INTO  TDISTDT                                           36920000
369300               (ORD_NBR                                           36930000
369400               ,RCVR_SEQ_NBR                                      36940000
369500               ,ORD_LNE_NBR                                       36950000
369600               ,WRK_ORD_SEQ_NBR                                   36960000
369700               ,STR_NBR                                           36970000
369800               ,EXPTED_ALLOC_QTY                                  36980000
369900               ,ACTL_ALLOC_QTY                                    36990000
370000               ,RCVG_PSTD_STAT_CDE                                37000000
370100              , P2L_SPLT_UNT_QTY                                  37010000
370200              , FCSE_SPLT_UNT_QTY                                 37020000
370300              , INPK_SPLT_UNT_QTY                                 37030000
370400              , FCSE_ACTL_UNT_QTY                                 37040000
370500              , ODD_CART_IND                                      37050000
370600              , PREPK_ODD_UNT_QTY)                                37060000
370700        VALUES                                                    37070000
370800              (:DK-PO-NBR                                         37080000
370900              ,:DK-RCVR-SEQ-NBR                                   37090000
371000              ,:DK-PREPK-LNE-NBR                                  37100000
371100              ,:DK-WORK-ORD-SEQ-NBR                               37110000
371200              ,:DISTDT-STR-NBR                                    37120000
371300              ,:DISTDT-EXPTED-ALLOC-QTY                           37130000
371400              ,:DISTDT-ACTL-ALLOC-QTY                             37140000
371500              ,:DISTDT-RCVG-PSTD-STAT-CDE                         37150000
371600              ,:DISTDT-P2L-SPLT-UNT-QTY                           37160000
371700              ,:DISTDT-FCSE-SPLT-UNT-QTY                          37170000
371800              ,:DISTDT-INPK-SPLT-UNT-QTY                          37180000
371900              ,:DISTDT-FCSE-ACTL-UNT-QTY                          37190000
372000              ,:DISTDT-ODD-CART-IND                               37200000
372100              ,:DISTDT-PREPK-ODD-UNT-QTY)                         37210000
372200     END-EXEC.                                                    37220000
372300                                                                  37230000
372400     EVALUATE TRUE                                                37240000
372500         WHEN SQLCODE = ZERO                                      37250000
372600              CONTINUE                                            37260000
372700         WHEN SQLWARN0 NOT = SPACES                               37270000
372800         WHEN SQLCODE < ZERO                                      37280000
372900         WHEN SQLCODE > ZERO                                      37290000
373000              SET  PC251-INVALID-SQL TO TRUE                      37300000
373100              MOVE SQLCODE           TO PC251-SQL-CODE            37310000
373200              MOVE 'TDISTDT'         TO PC251-ERROR-TABLE-NME     37320000
373300              PERFORM 9000-RETURN-CALL                            37330000
373400                                                                  37340000
373500     END-EVALUATE.                                                37350000
373600                                                                  37360000
373700                                                                  37370000
373800*================================================================*37380000
373900* OPEN UCC128 CURSOR - CURSOR USED TO DETERMINE # OF OTPK QTYS   *37390000
374000*================================================================*37400000
374100 7000-OPEN-UCC128-CSR.                                            37410000
374200                                                                  37420000
374300     MOVE '7000-OPEN-UCC128-CSR'                                  37430000
374400                                    TO PC251-ERROR-PARA-NBR.      37440000
374500     EXEC SQL                                                     37450000
374600         OPEN UCC128-CSR                                          37460000
374700     END-EXEC.                                                    37470000
374800                                                                  37480000
374900     EVALUATE TRUE                                                37490000
375000         WHEN SQLCODE = ZERO                                      37500000
375100             CONTINUE                                             37510000
375200         WHEN SQLWARN0 NOT = SPACES                               37520000
375300         WHEN SQLCODE < ZERO                                      37530000
375400         WHEN SQLCODE > ZERO                                      37540000
375500              SET  PC251-INVALID-SQL TO TRUE                      37550000
375600              MOVE SQLCODE           TO PC251-SQL-CODE            37560000
375700              MOVE 'TSHUUPC'         TO PC251-ERROR-TABLE-NME     37570000
375800              PERFORM 9000-RETURN-CALL                            37580000
375900                                                                  37590000
376000     END-EVALUATE.                                                37600000
376100                                                                  37610000
376200                                                                  37620000
376300*================================================================*37630000
376400* FETCH UCC128 CURSOR - CURSOR USED TO DETERMINE # OF OTPK QTYS  *37640000
376500*================================================================*37650000
376600 7010-FETCH-UCC128-CSR.                                           37660000
376700                                                                  37670000
376800     MOVE '7010-FETCH-UCC128-CSR'                                 37680000
376900                                    TO PC251-ERROR-PARA-NBR.      37690000
377000     EXEC SQL                                                     37700000
377100         FETCH UCC128-CSR                                         37710000
377200          INTO :SHUUPC-SHIPT-UNT-ID                               37720000
377300              ,:SHUUPC-TRN-LNE-NBR                                37730000
377400              ,:SHUUPC-SHPD-QTY                                   37740000
377500     END-EXEC.                                                    37750000
377600                                                                  37760000
377700     EVALUATE TRUE                                                37770000
377800         WHEN SQLCODE = ZERO                                      37780000
377900             CONTINUE                                             37790000
378000         WHEN SQLCODE = +100                                      37800000
378100             SET PS-EOF-UCC128-CSR    TO TRUE                     37810000
378200         WHEN SQLWARN0 NOT = SPACES                               37820000
378300         WHEN SQLCODE < ZERO                                      37830000
378400         WHEN SQLCODE > ZERO                                      37840000
378500              SET  PC251-INVALID-SQL TO TRUE                      37850000
378600              MOVE SQLCODE           TO PC251-SQL-CODE            37860000
378700              MOVE 'TSHUUPC'         TO PC251-ERROR-TABLE-NME     37870000
378800              PERFORM 9000-RETURN-CALL                            37880000
378900                                                                  37890000
379000     END-EVALUATE.                                                37900000
379100                                                                  37910000
379200                                                                  37920000
379300                                                                  37930000
379400*================================================================*37940000
379500* CLOSE UCC128 CURSOR - CURSOR USED TO DETERMINE # OF OTPK QTYS  *37950000
379600*================================================================*37960000
379700 7020-CLOSE-UCC128-CSR.                                           37970000
379800                                                                  37980000
379900     MOVE '7020-CLOSE-UCC128-CSR'                                 37990000
380000                                    TO PC251-ERROR-PARA-NBR.      38000000
380100     EXEC SQL                                                     38010000
380200         CLOSE UCC128-CSR                                         38020000
380300     END-EXEC.                                                    38030000
380400                                                                  38040000
380500     EVALUATE TRUE                                                38050000
380600         WHEN SQLCODE = ZERO                                      38060000
380700             CONTINUE                                             38070000
380800         WHEN SQLWARN0 NOT = SPACES                               38080000
380900         WHEN SQLCODE < ZERO                                      38090000
381000         WHEN SQLCODE > ZERO                                      38100000
381100              SET  PC251-INVALID-SQL TO TRUE                      38110000
381200              MOVE SQLCODE           TO PC251-SQL-CODE            38120000
381300              MOVE 'TSHUUPC'         TO PC251-ERROR-TABLE-NME     38130000
381400              PERFORM 9000-RETURN-CALL                            38140000
381500     END-EVALUATE.                                                38150000
381600                                                                  38160000
381700                                                                  38170000
381800*================================================================*38180000
381900* OPEN EXPECT CURSOR - STORE EXPECTED ALLOCATION TABLE           *38190000
382000*================================================================*38200000
382100 7030-OPEN-EXPECT-CSR.                                            38210000
382200                                                                  38220000
382300     MOVE '7030-OPEN-EXPECT-CSR '                                 38230000
382400                                    TO PC251-ERROR-PARA-NBR.      38240000
382500     EXEC SQL                                                     38250000
382600         OPEN EXPECT-CSR                                          38260000
382700     END-EXEC.                                                    38270000
382800                                                                  38280000
382900     EVALUATE TRUE                                                38290000
383000         WHEN SQLCODE = ZERO                                      38300000
383100             CONTINUE                                             38310000
383200         WHEN SQLWARN0 NOT = SPACES                               38320000
383300         WHEN SQLCODE < ZERO                                      38330000
383400         WHEN SQLCODE > ZERO                                      38340000
383500              SET  PC251-INVALID-SQL TO TRUE                      38350000
383600              MOVE SQLCODE           TO PC251-SQL-CODE            38360000
383700              MOVE 'TRECDIS'         TO PC251-ERROR-TABLE-NME     38370000
383800              PERFORM 9000-RETURN-CALL                            38380000
383900                                                                  38390000
384000     END-EVALUATE.                                                38400000
384100                                                                  38410000
384200                                                                  38420000
384300*================================================================*38430000
384400* FETCH EXPECT CURSOR - STORE ALLOCATION CURSOR                  *38440000
384500*================================================================*38450000
384600 7040-FETCH-EXPECT-CSR.                                           38460000
384700                                                                  38470000
384800     MOVE '7040-FETCH-EXPECT-CSR'                                 38480000
384900                                    TO PC251-ERROR-PARA-NBR.      38490000
385000     EXEC SQL                                                     38500000
385100         FETCH EXPECT-CSR                                         38510000
385200          INTO :PV-TYPE-CODE-SEQ                                  38520000
385300              ,:XLT00010-LOC-TYP-CDE                              38530000
385400              ,:XLT00010-E-BUS-IND                                38540000
385500              ,:RECDIS-STR-NBR                                    38550000
385600              ,:RECDIS-EXPTED-ITM-QTY                             38560000
385700              ,:XLT00010-OPN-DTE                                  38570000
385800     END-EXEC.                                                    38580000
385900                                                                  38590000
386000     EVALUATE TRUE                                                38600000
386100         WHEN SQLCODE = ZERO                                      38610000
386200             ADD +1                   TO PV-EXPECT-TABLE-ENTRIES  38620000
386300         WHEN SQLCODE = +100                                      38630000
386400             SET PS-EOF-EXPECT-CSR    TO TRUE                     38640000
386500         WHEN SQLWARN0 NOT = SPACES                               38650000
386600         WHEN SQLCODE < ZERO                                      38660000
386700         WHEN SQLCODE > ZERO                                      38670000
386800              SET  PC251-INVALID-SQL TO TRUE                      38680000
386900              MOVE SQLCODE           TO PC251-SQL-CODE            38690000
387000              MOVE 'TRECDIS'         TO PC251-ERROR-TABLE-NME     38700000
387100              PERFORM 9000-RETURN-CALL                            38710000
387200     END-EVALUATE.                                                38720000
387300                                                                  38730000
387400                                                                  38740000
387500*================================================================*38750000
387600* CLOSE EXPECT CURSOR - STORE ALLOCATION CURSOR                  *38760000
387700*================================================================*38770000
387800 7050-CLOSE-EXPECT-CSR.                                           38780000
387900     MOVE '7050-CLOSE-EXPECT-CSR '                                38790000
388000                                    TO PC251-ERROR-PARA-NBR.      38800000
388100                                                                  38810000
388200     EXEC SQL                                                     38820000
388300         CLOSE EXPECT-CSR                                         38830000
388400     END-EXEC.                                                    38840000
388500                                                                  38850000
388600     EVALUATE TRUE                                                38860000
388700         WHEN SQLCODE = ZERO                                      38870000
388800             CONTINUE                                             38880000
388900         WHEN SQLWARN0 NOT = SPACES                               38890000
389000         WHEN SQLCODE < ZERO                                      38900000
389100         WHEN SQLCODE > ZERO                                      38910000
389200              SET  PC251-INVALID-SQL TO TRUE                      38920000
389300              MOVE SQLCODE           TO PC251-SQL-CODE            38930000
389400              MOVE 'TRECDIS'         TO PC251-ERROR-TABLE-NME     38940000
389500              PERFORM 9000-RETURN-CALL                            38950000
389600     END-EVALUATE.                                                38960000
389700                                                                  38970000
389800                                                                  38980000
389900*----------------------------------------------------------------*38990000
390000* PRE-PACK ORDER - OPEN CURSOR                                    39000000
390100*----------------------------------------------------------------*39010000
390200 7060-OPEN-PREPK-CURSOR.                                          39020000
390300                                                                  39030000
390400     MOVE '7060-OPEN-PREPK-CURSOR'                                39040000
390500                                    TO PC251-ERROR-PARA-NBR.      39050000
390600     EXEC SQL                                                     39060000
390700          OPEN PRE_PACK_CSR                                       39070000
390800     END-EXEC.                                                    39080000
390900                                                                  39090000
391000     EVALUATE TRUE                                                39100000
391100         WHEN SQLCODE = ZERO                                      39110000
391200             CONTINUE                                             39120000
391300         WHEN SQLWARN0 NOT = SPACES                               39130000
391400         WHEN SQLCODE < ZERO                                      39140000
391500         WHEN SQLCODE > ZERO                                      39150000
391600              SET  PC251-INVALID-SQL TO TRUE                      39160000
391700              MOVE SQLCODE           TO PC251-SQL-CODE            39170000
391800              MOVE 'TRECITM'         TO PC251-ERROR-TABLE-NME     39180000
391900              PERFORM 9000-RETURN-CALL                            39190000
392000     END-EVALUATE.                                                39200000
392100                                                                  39210000
392200                                                                  39220000
392300*================================================================*39230000
392400* FETCH PREPK CURSOR                                             *39240000
392500*================================================================*39250000
392600 7065-FETCH-PREPK-CSR.                                            39260000
392700                                                                  39270000
392800     MOVE '7065-FETCH-PREPK-CSR'                                  39280000
392900                                    TO PC251-ERROR-PARA-NBR.      39290000
393000     EXEC SQL                                                     39300000
393100         FETCH PRE_PACK_CSR                                       39310000
393200          INTO :RECITM-ORD-LNE-NBR                                39320000
393300              ,:RECITM-PREPK-RATO-QTY                             39330000
393400     END-EXEC.                                                    39340000
393500                                                                  39350000
393600     EVALUATE TRUE                                                39360000
393700         WHEN SQLCODE = ZERO                                      39370000
393800             ADD +1                   TO PV-PREPK-TABLE-ENTRIES   39380000
393900             IF  RECITM-PREPK-RATO-QTY  =  0                      39390000
394000                 SET PS-EOF-PREPK-CSR     TO TRUE                 39400000
394100             END-IF                                               39410000
394200                                                                  39420000
394300         WHEN SQLCODE = +100                                      39430000
394400             SET PS-EOF-PREPK-CSR     TO TRUE                     39440000
394500         WHEN SQLWARN0 NOT = SPACES                               39450000
394600         WHEN SQLCODE < ZERO                                      39460000
394700         WHEN SQLCODE > ZERO                                      39470000
394800              SET  PC251-INVALID-SQL TO TRUE                      39480000
394900              MOVE SQLCODE           TO PC251-SQL-CODE            39490000
395000              MOVE 'TRECITM'         TO PC251-ERROR-TABLE-NME     39500000
395100              PERFORM 9000-RETURN-CALL                            39510000
395200     END-EVALUATE.                                                39520000
395300                                                                  39530000
395400                                                                  39540000
395500*================================================================*39550000
395600* CLOSE PREPACK CURSOR                                           *39560000
395700*================================================================*39570000
395800 7070-CLOSE-PREPK-CSR.                                            39580000
395900                                                                  39590000
396000     MOVE '7070-CLOSE-PREPK-CSR'                                  39600000
396100                                    TO PC251-ERROR-PARA-NBR.      39610000
396200     EXEC SQL                                                     39620000
396300         CLOSE PRE_PACK_CSR                                       39630000
396400     END-EXEC.                                                    39640000
396500                                                                  39650000
396600     EVALUATE TRUE                                                39660000
396700         WHEN SQLCODE = ZERO                                      39670000
396800             CONTINUE                                             39680000
396900         WHEN SQLWARN0 NOT = SPACES                               39690000
397000         WHEN SQLCODE < ZERO                                      39700000
397100         WHEN SQLCODE > ZERO                                      39710000
397200              SET  PC251-INVALID-SQL TO TRUE                      39720000
397300              MOVE SQLCODE           TO PC251-SQL-CODE            39730000
397400              MOVE 'TRECITM'         TO PC251-ERROR-TABLE-NME     39740000
397500              PERFORM 9000-RETURN-CALL                            39750000
397600     END-EVALUATE.                                                39760000
397700                                                                  39770000
397800                                                                  39780000
397900*----------------------------------------------------------------*39790000
398000* SHIPMENT SUMMARY - OPEN CURSOR                                  39800000
398100*----------------------------------------------------------------*39810000
398200 7075-OPEN-SHPSUM-CURSOR.                                         39820000
398300     MOVE '7075-OPEN-SHPSUM-CURSOR'                               39830000
398400                                    TO PC251-ERROR-PARA-NBR.      39840000
398500                                                                  39850000
398600     EXEC SQL                                                     39860000
398700          OPEN SHIP_SUM_CSR                                       39870000
398800     END-EXEC.                                                    39880000
398900                                                                  39890000
399000     EVALUATE TRUE                                                39900000
399100         WHEN SQLCODE = ZERO                                      39910000
399200             CONTINUE                                             39920000
399300         WHEN SQLWARN0 NOT = SPACES                               39930000
399400         WHEN SQLCODE < ZERO                                      39940000
399500         WHEN SQLCODE > ZERO                                      39950000
399600              SET  PC251-INVALID-SQL TO TRUE                      39960000
399700              MOVE SQLCODE           TO PC251-SQL-CODE            39970000
399800              MOVE 'TSHPSUM'         TO PC251-ERROR-TABLE-NME     39980000
399900              PERFORM 9000-RETURN-CALL                            39990000
400000     END-EVALUATE.                                                40000000
400100                                                                  40010000
400200                                                                  40020000
400300*================================================================*40030000
400400* FETCH SHIPMENT SUMMARY CURSOR                                  *40040000
400500*================================================================*40050000
400600 7080-FETCH-SHPSUM-CSR.                                           40060000
400700                                                                  40070000
400800     MOVE '7080-FETCH-SHPSUM-CSR'                                 40080000
400900                                    TO PC251-ERROR-PARA-NBR.      40090000
401000     EXEC SQL                                                     40100000
401100         FETCH SHIP_SUM_CSR                                       40110000
401200          INTO :SHPSUM-PO-NBR                                     40120000
401300              ,:SHPSUM-PKSL-SEQ-NBR                               40130000
401400              ,:SHPSUM-CART-COMB-NBR                              40140000
401500              ,:SHPSUM-PO-LNE-NBR                                 40150000
401600              ,:SHPSUM-TOT-CART-CNT                               40160000
401700              ,:SHPSUM-OTPK-UNT-QTY                               40170000
401800     END-EXEC.                                                    40180000
401900                                                                  40190000
402000     EVALUATE TRUE                                                40200000
402100         WHEN SQLCODE = ZERO                                      40210000
402200             CONTINUE                                             40220000
402300         WHEN SQLCODE = +100                                      40230000
402400             SET PS-EOF-SHPSUM-CSR     TO TRUE                    40240000
402500         WHEN SQLWARN0 NOT = SPACES                               40250000
402600         WHEN SQLCODE < ZERO                                      40260000
402700         WHEN SQLCODE > ZERO                                      40270000
402800              SET  PC251-INVALID-SQL TO TRUE                      40280000
402900              MOVE SQLCODE           TO PC251-SQL-CODE            40290000
403000              MOVE 'TSHPSUM'         TO PC251-ERROR-TABLE-NME     40300000
403100              PERFORM 9000-RETURN-CALL                            40310000
403200     END-EVALUATE.                                                40320000
403300                                                                  40330000
403400                                                                  40340000
403500*================================================================*40350000
403600* CLOSE SHIPMENU CARTON SUMMARY CURSOR                           *40360000
403700*================================================================*40370000
403800 7085-CLOSE-SHPSUM-CSR.                                           40380000
403900                                                                  40390000
404000     MOVE '7085-CLOSE-SHPSUM-CSR'                                 40400000
404100                                    TO PC251-ERROR-PARA-NBR.      40410000
404200     EXEC SQL                                                     40420000
404300         CLOSE SHIP_SUM_CSR                                       40430000
404400     END-EXEC.                                                    40440000
404500                                                                  40450000
404600     EVALUATE TRUE                                                40460000
404700         WHEN SQLCODE = ZERO                                      40470000
404800             CONTINUE                                             40480000
404900         WHEN SQLWARN0 NOT = SPACES                               40490000
405000         WHEN SQLCODE < ZERO                                      40500000
405100         WHEN SQLCODE > ZERO                                      40510000
405200              SET  PC251-INVALID-SQL TO TRUE                      40520000
405300              MOVE SQLCODE           TO PC251-SQL-CODE            40530000
405400              MOVE 'TSHPSUM'         TO PC251-ERROR-TABLE-NME     40540000
405500              PERFORM 9000-RETURN-CALL                            40550000
405600     END-EVALUATE.                                                40560000
405700                                                                  40570000
405800                                                                  40580000
405900*================================================================*40590000
406000* GET AD DATE TO APPEAR ON LABELS                                *40600000
406100*================================================================*40610000
406200 7200-GET-AD-DATE.                                                40620000
406300                                                                  40630000
406400     MOVE '7200-GET-AD-DATE'                                      40640000
406500                                    TO PC251-ERROR-PARA-NBR.      40650000
406600     EXEC SQL                                                     40660000
406700          SELECT  CHAR(AD_EVNT_DTE, USA)                          40670000
406800                , B.GP_QTY                                        40680000
406900                , B.GP_RTL_AMT                                    40690000
407000                , B.UNT_RTL_PR_AMT                                40700000
407100            INTO  :PV-WORK-DATE                                   40710000
407200                , :PURITM-GP-QTY                                  40720000
407300                , :PURITM-GP-RTL-AMT                              40730000
407400                , :PURITM-UNT-RTL-PR-AMT                          40740000
407500            FROM  TRECITM A                                       40750000
407600                , TPURITM B                                       40760000
407700           WHERE  A.ORD_NBR        = :DK-PO-NBR                   40770000
407800             AND  A.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR             40780000
407900             AND  A.ORD_LNE_NBR    = :DK-ORD-LNE-NBR              40790000
408000             AND  A.VER_STATUS_CDE = 'A'                          40800000
408100             AND  A.ORD_NBR        = B.PO_NBR                     40810000
408200             AND  A.PO_VER_NBR     = B.VER_NBR                    40820000
408300             AND  A.ORD_LNE_NBR    = B.APP_PO_LNE_NBR             40830000
408310          WITH UR                                                 40831000
408400     END-EXEC.                                                    40840000
408500                                                                  40850000
408600     EVALUATE TRUE                                                40860000
408700         WHEN SQLCODE = ZERO                                      40870000
408800              CONTINUE                                            40880000
408900         WHEN SQLCODE = +100                                      40890000
409000              MOVE '0001-01-01'       TO PURITM-AD-EVNT-DTE       40900000
409100         WHEN SQLWARN0 NOT = SPACES                               40910000
409200         WHEN SQLCODE < ZERO                                      40920000
409300         WHEN SQLCODE > ZERO                                      40930000
409400              SET  PC251-INVALID-SQL TO TRUE                      40940000
409500              MOVE SQLCODE           TO PC251-SQL-CODE            40950000
409600              MOVE 'TRECITM'         TO PC251-ERROR-TABLE-NME     40960000
409700              PERFORM 9000-RETURN-CALL                            40970000
409800     END-EVALUATE.                                                40980000
409900                                                                  40990000
410000*================================================================*41000000
410100* OPEN DOOR SEQ CURSOR                                           *41010000
410200*================================================================*41020000
410300 8030-OPEN-DOOR-SEQ-CSR.                                          41030000
410400                                                                  41040000
410500     MOVE '8030-OPEN-DOOR-SEQ-CSR'                                41050000
410600                                    TO PC251-ERROR-PARA-NBR.      41060000
410700     EXEC SQL                                                     41070000
410800         OPEN DOOR-SEQ-CSR                                        41080000
410900     END-EXEC.                                                    41090000
411000                                                                  41100000
411100     EVALUATE TRUE                                                41110000
411200         WHEN SQLCODE = ZERO                                      41120000
411300             CONTINUE                                             41130000
411400         WHEN SQLWARN0 NOT = SPACES                               41140000
411500         WHEN SQLCODE < ZERO                                      41150000
411600         WHEN SQLCODE > ZERO                                      41160000
411700              SET  PC251-INVALID-SQL TO TRUE                      41170000
411800              MOVE SQLCODE           TO PC251-SQL-CODE            41180000
411900              MOVE 'TRECDIS'         TO PC251-ERROR-TABLE-NME     41190000
412000              PERFORM 9000-RETURN-CALL                            41200000
412100     END-EVALUATE.                                                41210000
412200                                                                  41220000
412300                                                                  41230000
412400*================================================================*41240000
412500* FETCH DOOR SEQ CURSOR                                          *41250000
412600*================================================================*41260000
412700 8040-FETCH-DOOR-SEQ-CSR.                                         41270000
412800     MOVE '8040-FETCH-DOOR-SEQ-CSR'                               41280000
412900                                    TO PC251-ERROR-PARA-NBR.      41290000
413000                                                                  41300000
413100     EXEC SQL                                                     41310000
413200         FETCH DOOR-SEQ-CSR                                       41320000
413300          INTO :PV-TYPE-CODE-SEQ                                  41330000
413400              ,:XLT00010-LOC-TYP-CDE                              41340000
413500              ,:XLT00010-E-BUS-IND                                41350000
413600              ,:RECDIS-STR-NBR                                    41360000
413700              ,:RECDIS-EXPTED-ITM-QTY                             41370000
413800              ,:CNDCDR-DOOR-LBL-SEQ-NBR                           41380000
413900              ,:XLT00010-OPN-DTE                                  41390000
414000     END-EXEC.                                                    41400000
414100                                                                  41410000
414200     EVALUATE TRUE                                                41420000
414300         WHEN SQLCODE = ZERO                                      41430000
414400             ADD +1                   TO PV-EXPECT-TABLE-ENTRIES  41440000
414500         WHEN SQLCODE = +100                                      41450000
414600             SET PS-EOF-DOOR-SEQ-CSR  TO TRUE                     41460000
414700         WHEN SQLWARN0 NOT = SPACES                               41470000
414800         WHEN SQLCODE < ZERO                                      41480000
414900         WHEN SQLCODE > ZERO                                      41490000
415000              SET  PC251-INVALID-SQL TO TRUE                      41500000
415100              MOVE SQLCODE           TO PC251-SQL-CODE            41510000
415200              MOVE 'TRECDIS'         TO PC251-ERROR-TABLE-NME     41520000
415300              PERFORM 9000-RETURN-CALL                            41530000
415400     END-EVALUATE.                                                41540000
415500                                                                  41550000
415600                                                                  41560000
415700*================================================================*41570000
415800* CLOSE DOOR-SEQ CURSOR -                                        *41580000
415900*================================================================*41590000
416000 8050-CLOSE-DOOR-SEQ-CSR.                                         41600000
416100     MOVE '8050-CLOSE-DOOR-SEQ-CSR'                               41610000
416200                                    TO PC251-ERROR-PARA-NBR.      41620000
416300                                                                  41630000
416400     EXEC SQL                                                     41640000
416500         CLOSE DOOR-SEQ-CSR                                       41650000
416600     END-EXEC.                                                    41660000
416700                                                                  41670000
416800     EVALUATE TRUE                                                41680000
416900         WHEN SQLCODE = ZERO                                      41690000
417000             CONTINUE                                             41700000
417100         WHEN SQLWARN0 NOT = SPACES                               41710000
417200         WHEN SQLCODE < ZERO                                      41720000
417300         WHEN SQLCODE > ZERO                                      41730000
417400              SET  PC251-INVALID-SQL TO TRUE                      41740000
417500              MOVE SQLCODE           TO PC251-SQL-CODE            41750000
417600              MOVE 'TRECDIS'         TO PC251-ERROR-TABLE-NME     41760000
417700              PERFORM 9000-RETURN-CALL                            41770000
417800     END-EVALUATE.                                                41780000
417900                                                                  41790000
418000                                                                  41800000
418100*----------------------------------------------------------------*41810000
418200*  PREPARES INFO TO BE RETURNED TO THE 'CALLING' PROGRAM.        *41820000
418300*----------------------------------------------------------------*41830000
418400 9000-RETURN-CALL.                                                41840000
418500                                                                  41850000
418600     MOVE SQLCA                         TO PC251-SQLCA.           41860000
418700     GOBACK.                                                      41870000
418800                                                                  41880000
418900                                                                  41890000
