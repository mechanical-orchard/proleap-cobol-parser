000100*-----------------------*                                                 
000200 IDENTIFICATION DIVISION.                                                 
000300*-----------------------*                                                 
000400 PROGRAM-ID.    TRKCS149.                                                 
000500 AUTHOR.        LARRY SCHLEICHER (STRATAGEM).                             
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000700 DATE-WRITTEN.  06-12-97.                                                 
000800 DATE-COMPILED.                                                           
000900*                                                                         
001000*---------------------------------------------------------------*         
001100*    Y149 - COUNTRY CODE LIST PROGRAM.                          *         
001200*                                                               *         
001300*    THIS PROGRAM GENERATES A LIST OF COUNTRY CODES.  THE       *         
001400*    ASSOCIATED COUNTRY NAME IS DISPLAYED.  THE                 *         
001500*    APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR SELECTS   *         
001600*    ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.              *         
001700*---------------------------------------------------------------*         
P5207 *DATE: 11/27/2013 CHANGE MADE BY: COGNIZANT(SHEBENA)            *         
P5207 *CHANGE MADE: RECOMPILED THE PROGRAM AS THE TRWS019 COPYBOOK HAS*         
P5207 *             NEW FIELDS INCOTERM CODE AND DESCRIPTION ADDED TO *         
P5207 *             IT.  CHANGE TAG : P5207  CR # : CHG0081355        *         
P5207 *---------------------------------------------------------------*         
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001800 EJECT                                                                    
001900 ENVIRONMENT DIVISION.                                                    
002000                                                                          
002100 DATA DIVISION.                                                           
002200                                                                          
002300 WORKING-STORAGE SECTION.                                                 
002400                                                                          
002500 01  DK-DB2-KEYS.                                                         
002600     15  DK-COUNTRY-CODE                PIC  X(03)  VALUE SPACE.          
002610     15  DK-STAT-CDE                    PIC  X(01)  VALUE SPACE.          
002700                                                                          
002800 01  PC-PROGRAM-CONSTANTS.                                                
002900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE                 
003000                                                    'TR149A  '.           
003100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE                 
003200                                                    'TRKM149 '.           
003300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE                 
003400                                                    'TRKCS149'.           
003500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.              
003600     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.              
003700     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.            
003800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15             
003900                                                    COMP SYNC.            
004000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2              
004100                                                    COMP SYNC.            
004200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE                 
004300                                                    +1000000              
004400                                                    COMP-3.               
004500     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5              
004600                                                    COMP SYNC.            
004700     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.            
004800     05  PC-ASTRK                       PIC  X(01)  VALUE '*'.            
004810     05  PC-SPACE                       PIC  X(01)  VALUE ' '.            
004900     05  PC-A                           PIC  X(01)  VALUE 'A'.            
005000     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.          
005100     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.          
005200     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.          
005300     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.          
005310     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.          
005311     05  PC-INTER-APPL-CODES.                                             
005314         10  PC-INTER-APPL-LIST-ACT                                       
005320                                  PIC  X(01)  VALUE  '2'.                 
005400*                                                                         
005500     05  PC-TSYMSG-NUMBERS.                                               
005600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.          
005700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.          
005800         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.          
005900         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.          
006000         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.          
006100         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.          
006200         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.          
006300         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.          
006400         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.          
006500         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.          
006600         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.          
006700         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.          
006800         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.          
006900         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.          
006910         10  PC-TSYMSG-00352            PIC  9(05)  VALUE 00352.          
006920         10  PC-TSYMSG-01645            PIC  9(05)  VALUE 01645.          
006930         10  PC-TSYMSG-01646            PIC  9(05)  VALUE 01646.          
007000         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.          
007100*                                                                         
007200 01  PS-PROGRAM-SWITCHES.                                                 
007300     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.            
007400         88  PS-NO-ERROR                            VALUE 'Y'.            
007500         88  PS-ERROR                               VALUE 'N'.            
007600     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.            
007700         88  PS-COMMAREA-VALID                      VALUE 'Y'.            
007800         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.            
007900     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.            
008000         88  PS-DONE                                VALUE 'Y'.            
008100         88  PS-NOT-DONE                            VALUE 'N'.            
008110     05  PS-INACTIVE-SW                 PIC  X(01)  VALUE 'N'.            
008120         88  PS-INACTIVES                           VALUE 'Y'.            
008130         88  PS-NO-INACTIVES                        VALUE 'N'.            
008200*                                                                         
008300 01  PV-PROGRAM-VARIABLES.                                                
008400     05  PV-SUB                         PIC S9(04)  VALUE +0              
008500                                                    COMP SYNC.            
008600     05  PV-ASTRK-CNT                   PIC S9(04)  VALUE +0              
008700                                                    COMP SYNC.            
008710     05  PV-NUMBER-OF-SELECTED-ITEMS    PIC S9(09)                        
008720                                                    COMP-3.               
008800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0              
008900                                                    COMP SYNC.            
009000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0              
009100                                                    COMP-3.               
009110     05  PV-INACTIVE-COUNT              PIC S9(09)  VALUE +0              
009120                                                    COMP-3.               
009200     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0              
009300                                                    COMP-3.               
009400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0              
009500                                                    COMP-3.               
009600     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0              
009700                                                    COMP-3.               
009800     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0              
009900                                                    COMP-3.               
010000     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0              
010100                                                    COMP-3.               
010200     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0              
010300                                                    COMP-3.               
010400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0              
010500                                                    COMP SYNC.            
010600     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0              
010700                                                    COMP SYNC.            
010800     05  PV-ITEM                        PIC S9(04)  VALUE +0              
010900                                                    COMP SYNC.            
011000     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0              
011100                                                    COMP SYNC.            
011200     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0              
011300                                                    COMP SYNC.            
011400     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0              
011500                                                    COMP SYNC.            
011600     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0              
011700                                                    COMP SYNC.            
011800     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0              
011900                                                    COMP SYNC.            
012000     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
012100                                                    COMP SYNC.            
012200     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
012300                                                    COMP SYNC.            
012400     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0              
012500                                                    COMP SYNC.            
012600     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0              
012700                                                    COMP SYNC.            
012800     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0              
012900                                                    COMP SYNC.            
013000     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0              
013100                                                    COMP SYNC.            
013200     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0              
013201                                                    COMP SYNC.            
013210     05  PV-COUNTRY-CODE.                                                 
013220         10  PV-CC-1                    PIC  X(01)  VALUE SPACE.          
013230         10  PV-CC-2                    PIC  X(01)  VALUE SPACE.          
013240         10  PV-CC-3                    PIC  X(01)  VALUE SPACE.          
013400******************************************************************        
013500**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **        
013600**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **        
013700**  APPLICATION-SPECIFIC COMMAREA.                              **        
013800******************************************************************        
013900 01  LQW-LIST-QUEUE-WORK-AREA.                                            
014000     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.          
014100     05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES                   
014200                                        INDEXED BY LQW-IDX.               
014300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.               
014400         10  LQW-TEMP-SELECTED-SW       PIC  X(01).                       
014500         10  LQW-SELECTED-SW            PIC  X(01).                       
014600             88  LQW-SELECT                         VALUE 'S'.            
014700             88  LQW-DESELECT                       VALUE ' '.            
014800         10  LQW-ACTION                 PIC  X(03).                       
014900         10  LQW-COUNTRY-CODE           PIC  X(03).                       
015000         10  LQW-COUNTRY-DESC           PIC  X(40).                       
015100                                                                          
015200     EJECT                                                                
015300*---------------------------------------------------------------*         
015400*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  *         
015500*---------------------------------------------------------------*         
015600                                                                          
015700     COPY TRWS020.                                                        
015800                                                                          
015900     EJECT                                                                
016000*---------------------------------------------------------------*         
016100*    MAP LAYOUT                                                 *         
016200*---------------------------------------------------------------*         
016300                                                                          
016400     COPY TRKM149.                                                        
016500*                                                                         
016600 01  MR-OCCURS-LAYOUT                   REDEFINES  TR149AO.               
016700     05  FILLER                         PIC X(42).                        
016800     05  MR-SCROLL-AREA                 OCCURS 15 TIMES.                  
016900         10  MR-SELECTL                 PIC S9(04) COMP.                  
017000         10  MR-SELECTA                 PIC  X(01).                       
017100         10  MR-SELECTC                 PIC  X(01).                       
017200         10  MR-SELECTH                 PIC  X(01).                       
017300         10  MR-SELECTI                 PIC  X(01).                       
017400                                                                          
017500         10  MR-ACTIONL                 PIC S9(04) COMP.                  
017600         10  MR-ACTIONA                 PIC  X(01).                       
017700         10  MR-ACTIONC                 PIC  X(01).                       
017800         10  MR-ACTIONH                 PIC  X(01).                       
017900         10  MR-ACTION                  PIC  X(03).                       
018000                                                                          
018100         10  MR-COUNTRY-CODEL           PIC S9(04) COMP.                  
018200         10  MR-COUNTRY-CODEA           PIC  X(01).                       
018300         10  MR-COUNTRY-CODEC           PIC  X(01).                       
018400         10  MR-COUNTRY-CODEH           PIC  X(01).                       
018500         10  MR-COUNTRY-CODE            PIC  X(03).                       
018600                                                                          
018700         10  MR-COUNTRY-DESCL           PIC S9(04) COMP.                  
018800         10  MR-COUNTRY-DESCA           PIC  X(01).                       
018900         10  MR-COUNTRY-DESCC           PIC  X(01).                       
019000         10  MR-COUNTRY-DESCH           PIC  X(01).                       
019100         10  MR-COUNTRY-DESC            PIC  X(40).                       
019200                                                                          
019300     EJECT                                                                
019400*---------------------------------------------------------------*         
019500*    ATTRIBUTE SETTINGS COPYBOOK.                               *         
019600*---------------------------------------------------------------*         
019700                                                                          
019800     COPY DPWS015.                                                        
019900                                                                          
020000*---------------------------------------------------------------*         
020100*    FUNCTION KEYS COPYBOOK.                                    *         
020200*---------------------------------------------------------------*         
020300                                                                          
020400     COPY DPWS016.                                                        
020500                                                                          
020600*---------------------------------------------------------------*         
020700*    NUMERIC EDIT LAYOUT.                                       *         
020800*---------------------------------------------------------------*         
020900                                                                          
021000     COPY DPWS010I.                                                       
021100 EJECT                                                                    
021200*---------------------------------------------------------------*         
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *         
021400*---------------------------------------------------------------*         
021500                                                                          
021600     COPY DPWS030.                                                        
CICS       COPY DPWS930.                                                        
021700 EJECT                                                                    
021800*---------------------------------------------------------------*         
021900*    STANDARD COMMAREA.                                         *         
022000*---------------------------------------------------------------*         
022100                                                                          
022200     COPY DPWS020.                                                        
022300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
022400                                                                          
022500*---------------------------------------------------------------*         
022600* INTER-APPLICATION COMMAREA.                                   *         
022700*   TRWS019 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    *         
022800*             SPEC SCREEN.                                      *         
022900*---------------------------------------------------------------*         
023000                                                                          
023100         10  INTER-APPL-COMM-AREA       PIC X(200).                       
023200     COPY TRWS019.                                                        
023300*---------------------------------------------------------------*         
023400*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   *         
023500*---------------------------------------------------------------*         
023600         10  ASC-SPECIFIC-COMMAREA.                                       
023700             15  ASC-LIST-KEYS.                                           
023800                 20  ASC-KEY-COUNTRY-CODE            PIC  X(03).          
023810                 20  ASC-KEY-COUNTRY-STAT            PIC  X(01).          
023900             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                        
024000                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).          
024100                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.           
024200                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.           
024300                                                                          
024400                 20  ASC-ITEM-ARRAY.                                      
024500                     25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.                
024600                         30  ASC-LIST-ITEM-NUMBER                         
024700                                                     PIC S9(09)           
024800                                                     COMP-3.              
024900                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).          
025000                             88  ASC-VALID-SELECT    VALUE ' '            
025100                                                           'S'            
025200                                                           'B'            
025300                                                           'E'.           
025400                             88  ASC-TEMP-NO-SELECT  VALUE ' '.           
025500                             88  ASC-TEMP-SELECT     VALUE 'S'.           
025600                             88  ASC-TEMP-BEGIN      VALUE 'B'.           
025700                             88  ASC-TEMP-END        VALUE 'E'.           
025800                         30  ASC-SELECTED-SW         PIC  X(01).          
025900                             88  ASC-NO-SELECT       VALUE ' '.           
026000                             88  ASC-SELECT          VALUE 'S'.           
026100                             88  ASC-BEGIN           VALUE 'B'.           
026200                             88  ASC-END             VALUE 'E'.           
026300                         30  ASC-ACTION              PIC  X(03).          
026400                         30  ASC-COUNTRY-CODE        PIC  X(03).          
026500                         30  ASC-COUNTRY-DESC        PIC  X(40).          
026600                                                                          
026700             15  ASC-BLK-SUB                         PIC S9(04)           
026800                                                          COMP            
026900                                                          SYNC.           
027000             15  ASC-ITEM-SUB                        PIC S9(04)           
027100                                                          COMP            
027200                                                          SYNC.           
027300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)           
027400                                                          COMP-3.         
027500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)           
027600                                                          COMP-3.         
027700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)           
027800                                                          COMP-3.         
027900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)           
028000                                                          COMP-3.         
028100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)           
028200                                                          COMP-3.         
028300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)           
028400                                                          COMP            
028500                                                          SYNC.           
028600             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)           
028700                                                          COMP-3.         
028800             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)           
028900                                                          COMP-3.         
029000             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).          
029100                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.           
029200                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.           
029300             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).          
029400                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.           
029500                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.           
029600             15  ASC-LIST-QUEUE-NAME.                                     
029700                 20  ASC-LIST-TERM-ID                PIC  X(04).          
029800                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)           
029900                                                          COMP-3.         
030000                 20  ASC-LIST-SEQ                    PIC  9(01).          
030100             15  ASC-SEL-QUEUE-NAME.                                      
030200                 20  ASC-SEL-TERM-ID                 PIC  X(04).          
030300                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)           
030400                                                          COMP-3.         
030500                 20  ASC-SEL-SEQ                     PIC  9(01).          
030600                                                                          
030700             15  ASC-CURSOR-SW                       PIC  X(01).          
030800                 88  ASC-USE-LIKE-CURSOR             VALUE 'L'.           
030900                 88  ASC-USE-ALL-CURSOR              VALUE 'A'.           
031000             15  ASC-START-ITEM-REQUEST.                                  
031100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).          
031200     EJECT                                                                
031300*---------------------------------------------------------------*         
031400*    ABEND PROCESSING COPYBOOK.                                 *         
031500*---------------------------------------------------------------*         
031600                                                                          
031700     COPY DPWS013.                                                        
031800                                                                          
031900 EJECT                                                                    
032000*---------------------------------------------------------------*         
032100*    DB2 AREA FOR TCNRTY                                        *         
032200*---------------------------------------------------------------*         
032300     EXEC SQL                                                             
032400          INCLUDE TCNTRY                                                  
032500     END-EXEC.                                                            
032600*---------------------------------------------------------------*         
032700*    DB2 AREA FOR COMMUNICATIONS                                *         
032800*---------------------------------------------------------------*         
032900     EXEC SQL                                                             
033000          INCLUDE SQLCA                                                   
033100     END-EXEC.                                                            
033200                                                                          
033300*---------------------------------------------------------------*         
033400*    TCNTRY CURSOR FOR ALL COUNTRY CODES                        *         
033500*---------------------------------------------------------------*         
033600                                                                          
033700     EXEC SQL                                                             
033800          DECLARE COUNTRY-ALL-CSR CURSOR                                  
033900          FOR SELECT                                                      
034000                CNTRY_CDE                                                 
034100              , CNTRY_NM                                                  
034110              , STAT_CDE                                                  
034200          FROM  TCNTRY                                                    
034300          WHERE STAT_CDE = :DK-STAT-CDE                                   
034400          ORDER BY                                                        
034500                CNTRY_CDE                                                 
034600     END-EXEC.                                                            
034700                                                                          
034800*---------------------------------------------------------------*         
034900*    TCNTRY CURSOR FOR ALL COUNTRY CODES BEGINNING WITH ENTERED *         
035000*    CHARACTERS                                                 *         
035100*---------------------------------------------------------------*         
035200                                                                          
035300     EXEC SQL                                                             
035400          DECLARE COUNTRY-LIKE-CSR CURSOR                                 
035500          FOR SELECT                                                      
035600                CNTRY_CDE                                                 
035700              , CNTRY_NM                                                  
035710              , STAT_CDE                                                  
035800          FROM  TCNTRY                                                    
035900          WHERE CNTRY_CDE   LIKE :DK-COUNTRY-CODE                         
036000            AND STAT_CDE = :DK-STAT-CDE                                   
036100          ORDER BY                                                        
036200                CNTRY_CDE                                                 
036300     END-EXEC.                                                            
036400                                                                          
036500                                                                          
036600 EJECT                                                                    
036700 LINKAGE SECTION.                                                         
036800                                                                          
036900 01  DFHCOMMAREA.                                                         
037000     05  FILLER                         OCCURS  1 TO 4072 TIMES           
037100                                        DEPENDING ON EIBCALEN.            
037200         10  FILLER                     PIC X.                            
037300                                                                          
037400 EJECT                                                                    
037500 PROCEDURE DIVISION.                                                      
037600******************************************************************        
037700**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **        
037800**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **        
037900**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **        
038000******************************************************************        
038100 0000-MAIN-MODULE.                                                        
038200     INITIALIZE DP030-CICS-API-FIELDS.                                    
038300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
038400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
038500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
038600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
038700     MOVE LENGTH OF TR149AI        TO DP030-MAP-LENGTH (1).               
038800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
038900     PERFORM 0001-CALL-CICS-ARCH-API.                                     
039000*                                                                         
039100     PERFORM 1000-CONTROL-PROCESSING                                      
039200*                                                                         
039300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
039400     PERFORM 0001-CALL-CICS-ARCH-API.                                     
039500                                                                          
039600******************************************************************        
039700**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **        
039800**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **        
039900******************************************************************        
040000 0001-CALL-CICS-ARCH-API.                                                 
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
040200                                    DFHCOMMAREA                           
040300                                    DP030-CICS-API-FIELDS                 
040400                                    DP020-STANDARD-COMMAREA               
040500                                    TR149AI.                              
040600*                                                                         
040700     IF  DP030-RC-CALL-SUCCESSFUL                                         
040800         CONTINUE                                                         
040900     ELSE                                                                 
041000         SET DP013-NO-ROLLBACK                                            
041100             DP013-XCTL-DISPLAY-RESTART                                   
041200             DP013-CICS-ABEND      TO TRUE                                
041300         MOVE '0001-CALL-CICS-ARCH-API'                                   
041400                                   TO DP013-PARAGRAPH                     
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
041700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)              
041800         PERFORM DP013-0000-PROCESS-ABEND                                 
041900     END-IF.                                                              
042000*----------------------------------------------------------------*        
042100* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *        
042200* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *        
042300*                                                                *        
042400* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *        
042500*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *        
042600*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *        
042700*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *        
042800*----------------------------------------------------------------*        
042900                                                                          
043000 1000-CONTROL-PROCESSING.                                                 
043100                                                                          
043200     EVALUATE TRUE                                                        
043300         WHEN DP020-NEXT-ACT-INITIAL                                      
043301             IF ASC-NUMBER-OF-SELECTED-ITEMS NUMERIC                      
043310                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO                    
043320                  PV-NUMBER-OF-SELECTED-ITEMS                             
043330             ELSE                                                         
043340                 MOVE 0 TO PV-NUMBER-OF-SELECTED-ITEMS                    
043350             END-IF                                                       
043400             INITIALIZE ASC-SPECIFIC-COMMAREA                             
043500             MOVE EIBTRMID         TO ASC-LIST-TERM-ID                    
043600                                      ASC-SEL-TERM-ID                     
043700             MOVE DP020-SRC-TASK-NUMBER                                   
043800                                   TO ASC-LIST-TASK-NUMBER                
043900                                      ASC-SEL-TASK-NUMBER                 
044000             MOVE PC-LIST-QUEUE-SEQ                                       
044100                                   TO ASC-LIST-SEQ                        
044200             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                         
044300             PERFORM 1100-PROCESS-INTER-APPL-COMM                         
044400***-----$TEMPLATE NOTE$-------------------------------------------        
044500*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,        
044600*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO          
044700*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.        
044800***---------------------------------------------------------------        
044900             IF  PS-COMMAREA-NOT-VALID                                    
045000***              MOVE PC-TSYMSG-99901                                     
045100***                                TO DP020-MSG-NUMBER                    
045200***              SET DP020-MSG-FATAL                                      
045300***                                TO TRUE                                
045400                 SET DP020-NEXT-ACT-APPL-ERROR                            
045500                                   TO TRUE                                
045600             ELSE                                                         
045700                 PERFORM 4000-BUILD-INITIAL-PANEL                         
045800             END-IF                                                       
045900                                                                          
046000         WHEN DP020-NEXT-ACT-READ-MAP                                     
046100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
046200                                   TO PV-TOP-ITEM                         
046300             PERFORM 2000-PROCESS-PANEL                                   
046400                                                                          
046500         WHEN DP020-NEXT-ACT-RETURN                                       
046501            IF  TR019-RECORD-UPDATED                                      
046504                MOVE +0 TO  ASC-NUMBER-OF-SELECTED-ITEMS                *6
046505                MOVE 'A' TO DK-STAT-CDE                                   
046506                MOVE ASC-ITEM-AT-TOP-OF-PANEL                       RCK000
046507                                     TO PV-TOP-ITEM                 RCK000
046508                MOVE ZERO          TO ASC-ITEM-AT-TOP-OF-PANEL            
046509                PERFORM 2050-DELETE-LIST-QUEUE                      RCK000
046511                IF ASC-USE-LIKE-CURSOR                                    
046512                    MOVE ASC-KEY-COUNTRY-CODE TO                          
046513                         DK-COUNTRY-CODE                                  
046514                    INSPECT DK-COUNTRY-CODE TALLYING                      
046515                         PV-ASTRK-CNT FOR ALL                             
046516                                          PC-ASTRK                        
046517                    IF PV-ASTRK-CNT > 0                                   
046518                        SET ASC-USE-LIKE-CURSOR TO TRUE                   
046519                        INSPECT DK-COUNTRY-CODE                           
046520                            REPLACING FIRST PC-ASTRK                      
046521                                BY PC-PERCENT                             
046522                        INSPECT DK-COUNTRY-CODE                           
046523                            REPLACING FIRST PC-ASTRK                      
046524                                BY PC-PERCENT                             
046525                        INSPECT DK-COUNTRY-CODE                           
046526                            REPLACING FIRST PC-SPACE                      
046527                                BY PC-PERCENT                             
046528                    END-IF                                                
046529                END-IF                                                    
046530                PERFORM 4000-BUILD-INITIAL-PANEL                        00
046540             ELSE                                                         
046600                 MOVE ASC-ITEM-AT-TOP-OF-PANEL                            
046700                                       TO PV-TOP-ITEM                     
046800                 MOVE ZERO           TO ASC-ITEM-AT-TOP-OF-PANEL          
047116                 PERFORM 6000-REFRESH-PANEL-FROM-TEMP                     
047120                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
047130                 PERFORM 3000-EDIT-DATA-IN-COMMAREA                       
047210             END-IF                                                       
047300         WHEN OTHER                                                       
047400             SET DP013-LOGIC-ABEND TO TRUE                                
047500             SET DP013-NO-ROLLBACK TO TRUE                                
047600             MOVE '1000-CONTROL-PROCESSING'                               
047700                                   TO DP013-PARAGRAPH                     
047800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'            
047900                                   TO DP013-MESSAGE-TEXT(1)               
048000             PERFORM DP013-0000-PROCESS-ABEND                             
048100     END-EVALUATE.                                                        
048200                                                                          
048300 EJECT                                                                    
048400*----------------------------------------------------------------*        
048500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *        
048600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *        
048700*----------------------------------------------------------------*        
048800                                                                          
048900 1100-PROCESS-INTER-APPL-COMM.                                            
049000                                                                          
049100     SET PS-COMMAREA-VALID         TO TRUE.                               
049200     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.             
049300     MOVE TR019-COUNTRY-CODE       TO ASC-KEY-COUNTRY-CODE                
049401                                      DK-COUNTRY-CODE.                    
049402     MOVE TR019-STAT-CDE           TO DK-STAT-CDE.                        
049410     IF TR019-COUNTRY-CODE = SPACES                                       
049500         SET ASC-USE-ALL-CURSOR TO TRUE                                   
049510     ELSE                                                                 
049520         SET ASC-USE-LIKE-CURSOR TO TRUE                                  
049530     END-IF.                                                              
049600     INSPECT DK-COUNTRY-CODE TALLYING PV-ASTRK-CNT FOR ALL                
049700                                       PC-ASTRK.                          
049800     IF PV-ASTRK-CNT > 0                                                  
049900         SET ASC-USE-LIKE-CURSOR TO TRUE                                  
050000         INSPECT DK-COUNTRY-CODE                                          
050100             REPLACING FIRST PC-ASTRK BY PC-PERCENT                       
050200         INSPECT DK-COUNTRY-CODE                                          
050300             REPLACING FIRST PC-ASTRK BY PC-PERCENT                       
050310         INSPECT DK-COUNTRY-CODE                                          
050320             REPLACING FIRST PC-SPACE BY PC-PERCENT                       
050400     END-IF.                                                              
050500                                                                          
050600 EJECT                                                                    
050700*----------------------------------------------------------------*        
050800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *        
050900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *        
051000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *        
051100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *        
051200* FUNCTION KEYS CAN GET THIS FAR.                                *        
051300*----------------------------------------------------------------*        
051400                                                                          
051500 2000-PROCESS-PANEL.                                                      
051600     EVALUATE TRUE                                                        
051700         WHEN DP020-SRC-AID = DP016-CLEAR                                 
051800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL            
051900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
052000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
052100                                                                          
052200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                            
052500             PERFORM 2050-DELETE-LIST-QUEUE                               
052510             MOVE 0 TO PV-NUMBER-OF-SELECTED-ITEMS                        
052524             MOVE ASC-COUNTRY-CODE                                        
052525                           (ASC-BLK-SUB ASC-ITEM-SUB)                     
052526                                   TO DK-COUNTRY-CODE                     
052527             MOVE ASC-KEY-COUNTRY-STAT  TO DK-STAT-CDE                    
052528             IF ASC-USE-LIKE-CURSOR                                       
052537                 MOVE ASC-KEY-COUNTRY-CODE TO                             
052538                      DK-COUNTRY-CODE                                     
052539                 INSPECT DK-COUNTRY-CODE TALLYING                         
052540                      PV-ASTRK-CNT FOR ALL                                
052541                                       PC-ASTRK                           
052542                 IF PV-ASTRK-CNT > 0                                      
052543                     SET ASC-USE-LIKE-CURSOR TO TRUE                      
052544                     INSPECT DK-COUNTRY-CODE                              
052545                         REPLACING FIRST PC-ASTRK BY PC-PERCENT           
052546                     INSPECT DK-COUNTRY-CODE                              
052547                         REPLACING FIRST PC-ASTRK BY PC-PERCENT           
052548                     INSPECT DK-COUNTRY-CODE                              
052549                         REPLACING FIRST PC-SPACE BY PC-PERCENT           
052550                 END-IF                                                   
052551             END-IF                                                       
052560*            MOVE TR019-STAT-CDE   TO DK-STAT-CDE                         
052600             PERFORM 4000-BUILD-INITIAL-PANEL                             
052620             MOVE +0 TO  ASC-NUMBER-OF-SELECTED-ITEMS                   *6
052700                                                                          
052800         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                            
052900             PERFORM 2140-DESELECT-ALL-ITEMS                              
053000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
053100                                                                          
053200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                          
053300             PERFORM 2150-SELECT-ALL-ITEMS                                
053400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
053500                                                                          
053600         WHEN OTHER                                                       
053700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
053800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
053900             IF  PS-NO-ERROR                                              
054000                 SET DP030-CONTINUE-GO                                    
054100                                 TO TRUE                                  
054200                 PERFORM 2100-CHECK-FUNCTION-KEY                          
054300             ELSE                                                         
054400                 SET DP030-OVERRIDE-GO                                    
054500                                 TO TRUE                                  
054600             END-IF                                                       
054700     END-EVALUATE.                                                        
054800 EJECT                                                                    
054900*----------------------------------------------------------------*        
055000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *        
055100*----------------------------------------------------------------*        
055200 2050-DELETE-LIST-QUEUE.                                                  
055300                                                                          
055400     EXEC CICS                                                            
055500         DELETEQ TS                                                       
055600             QUEUE (ASC-LIST-QUEUE-NAME)                                  
055700             RESP  (PV-CICS-RESP)                                         
055800     END-EXEC.                                                            
055900                                                                          
056000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                               
056100        (PV-CICS-RESP = DFHRESP(QIDERR))                                  
056200         CONTINUE                                                         
056300     ELSE                                                                 
056400         SET DP013-CICS-ABEND      TO TRUE                                
056500         SET DP013-NO-ROLLBACK     TO TRUE                                
056600                                                                          
056700         MOVE '2050-DELETE-LIST-QUEUE'                                    
056800                                   TO DP013-PARAGRAPH                     
056900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'            
057000                                   TO DP013-MESSAGE-TEXT (1)              
057100         PERFORM DP013-0000-PROCESS-ABEND                                 
057200     END-IF.                                                              
057300                                                                          
057400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.          
057500 EJECT                                                                    
057600*----------------------------------------------------------------*        
057700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*        
057800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *        
057900* CICS ARCHITECTURE API.                                         *        
058000*----------------------------------------------------------------*        
058100 2100-CHECK-FUNCTION-KEY.                                                 
058200     EVALUATE TRUE                                                        
058210         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                      
058300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
058301             IF  ASC-NUMBER-OF-SELECTED-ITEMS > 0                         
058302                 INITIALIZE TR019-INTER-APPL-COMMAREA                     
058303                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        
058304                            TO TR019-NUMBER-OF-SELECTED-ITEMS             
058305                 PERFORM 5000-PREPARE-SEL-QUEUE                           
058306             ELSE                                                         
058307                 SET DP030-OVERRIDE-GO                                    
058308                                   TO TRUE                                
058309                 MOVE PC-TSYMSG-00057                                     
058310                                   TO DP020-MSG-NUMBER                    
058311                 SET DP020-MSG-WARNING                                    
058312                                   TO TRUE                                
058313             END-IF                                                       
058315         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                      
058318             IF  ASC-NUMBER-OF-SELECTED-ITEMS > 0                         
058319                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        
058320                            TO TR019-NUMBER-OF-SELECTED-ITEMS             
058321*                                                                         
058322                 MOVE +1 TO ASC-NUMBER-OF-SELECTED-ITEMS                  
058323                 INITIALIZE TR019-INTER-APPL-COMMAREA                     
058324                 MOVE 'I' TO TR019-STAT-CDE                               
058325                 MOVE SPACES TO TR019-COUNTRY-CODE                        
058328                 PERFORM 5000-PREPARE-SEL-QUEUE                           
058329             ELSE                                                         
058330                 IF  ASC-NUMBER-OF-SELECTED-ITEMS < +1                    
058331                     MOVE +0 TO ASC-NUMBER-OF-SELECTED-ITEMS              
058332                     INITIALIZE TR019-INTER-APPL-COMMAREA                 
058333                     MOVE 'I' TO TR019-STAT-CDE                           
058334                     MOVE SPACES TO TR019-COUNTRY-CODE                    
058350                     PERFORM 5000-PREPARE-SEL-QUEUE                       
059800                  END-IF                                                  
059810             END-IF                                                       
059900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                          
060000             MOVE +1               TO PV-TOP-ITEM                         
060100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
060110             PERFORM 3200-RESET-ATTRIBUTES                                
060200                                                                          
060300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                           
060400             PERFORM 2110-BROWSE-BACKWARD                                 
060500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
060510             PERFORM 3200-RESET-ATTRIBUTES                                
060600                                                                          
060700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                           
060800             PERFORM 2120-BROWSE-FORWARD                                  
060900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
060910             PERFORM 3200-RESET-ATTRIBUTES                                
061000                                                                          
061100         WHEN DP020-SRC-AID = DP016-ENTER                                 
061200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                           
061300             IF  PS-ERROR                                                 
061400                 CONTINUE                                                 
061500             ELSE                                                         
061600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
061700             END-IF                                                       
061800                                                                          
061900         WHEN OTHER                                                       
062000             SET DP013-NO-ROLLBACK                                        
062100                 DP013-XCTL-DISPLAY-RESTART                               
062200                 DP013-CICS-ABEND  TO TRUE                                
062300             MOVE '2100-CHECK-FUNCTION-KEY'                               
062400                                   TO DP013-PARAGRAPH                     
062500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
062600                                   TO DP013-MESSAGE-TEXT (1)              
062700             PERFORM DP013-0000-PROCESS-ABEND                             
062800     END-EVALUATE.                                                        
062900*                                                                         
063000*----------------------------------------------------------------*        
063100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *        
063200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *        
063300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *        
063400*    MESSAGE.                                                    *        
063500*----------------------------------------------------------------*        
063600                                                                          
063700 2110-BROWSE-BACKWARD.                                                    
063800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL            
063900         GIVING PV-TOP-ITEM.                                              
064000*                                                                         
064100     IF  ((PV-TOP-ITEM < +1)                                              
064200       OR (PV-TOP-ITEM = +1))                                             
064300         MOVE +1                   TO PV-TOP-ITEM                         
064400*        -- TOP OF LIST --                                                
064500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER                    
064600         SET DP020-MSG-INFORMATIONAL TO TRUE                              
064700     END-IF.                                                              
064800                                                                          
064900 EJECT                                                                    
065000*----------------------------------------------------------------*        
065100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *        
065200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *        
065300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *        
065400*----------------------------------------------------------------*        
065500                                                                          
065600 2120-BROWSE-FORWARD.                                                     
065700                                                                          
065800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                      
065900         GIVING PV-TOP-ITEM.                                              
066000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                           
066100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
066200                                   TO PV-TOP-ITEM                         
066300*        -- BOTTOM OF LIST --                                             
066400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER                    
066500         SET DP020-MSG-INFORMATIONAL                                      
066600                                   TO TRUE                                
066700     ELSE                                                                 
066800         COMPUTE PV-BOTTOM-ITEM =                                         
066900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                         
067000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ                    
067100*            -- BOTTOM OF LIST --                                         
067200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER                    
067300             SET DP020-MSG-INFORMATIONAL                                  
067400                                   TO TRUE                                
067500         END-IF                                                           
067600     END-IF.                                                              
067700 EJECT                                                                    
067800*----------------------------------------------------------------*        
067900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *        
068000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *        
068100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *        
068200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *        
068300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *        
068400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *        
068500*----------------------------------------------------------------*        
068600                                                                          
068700 2130-CHECK-FOR-JUMP-BROWSE.                                              
068800     SET PS-NO-ERROR               TO TRUE.                               
068900     IF (ASC-START-ITEM-REQUEST = SPACE)                                  
069000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
069100                                   TO PV-TOP-ITEM                         
069200     ELSE                                                                 
069300         MOVE ASC-START-ITEM-REQUEST                                      
069400                                   TO DP010I-UNEDITED-FIELD               
069500         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS               
069600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS             
069700         SET DP010I-NEGATIVE-NOT-ALLOWED                                  
069800                                   TO TRUE                                
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
070000                                                                          
070100         IF  NOT DP010I-ERROR-DETECTED                                    
070200             MOVE DP010I-NUMERIC-FIELD                                    
070300                                   TO  ASC-START-ITEM-REQUEST-N           
070400             IF  ASC-START-ITEM-REQUEST-N > ZERO                          
070500                 IF  ASC-START-ITEM-REQUEST-N >                           
070600                                          ASC-NUMBER-OF-ITEMS-READ        
070700                     MOVE SPACE TO ASC-START-ITEM-REQUEST                 
070800                     COMPUTE PV-TOP-ITEM =                                
070900                             ASC-NUMBER-OF-ITEMS-READ                     
071000                             - PC-ITEMS-PER-PANEL + 1                     
071100                     IF  PV-TOP-ITEM < +1                                 
071200                         MOVE +1   TO PV-TOP-ITEM                         
071300                         MOVE PC-TSYMSG-00070                             
071400                                   TO DP020-MSG-NUMBER                    
071500                         SET DP020-MSG-INFORMATIONAL                      
071600                                   TO TRUE                                
071700                     END-IF                                               
071800                 ELSE                                                     
071900                     MOVE ASC-START-ITEM-REQUEST-N                        
072000                                   TO PV-TOP-ITEM                         
072100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST              
072200                     COMPUTE PV-BOTTOM-ITEM =                             
072300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1             
072400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ        
072500*                        -- BOTTOM OF LIST --                             
072600                         MOVE PC-TSYMSG-00070                             
072700                                   TO DP020-MSG-NUMBER                    
072800                         SET DP020-MSG-INFORMATIONAL                      
072900                                   TO TRUE                                
073000                     END-IF                                               
073100                 END-IF                                                   
073200             ELSE                                                         
073300*                --- VALUE OUT OF RANGE ----                              
073400                 MOVE PC-TSYMSG-00101                                     
073500                                   TO DP020-MSG-NUMBER                    
073600                 MOVE -1           TO ASTRTITL                            
073700                 SET DP030-SET-CURSOR-APPL-1                              
073800                                   TO TRUE                                
073900                 MOVE DP015-REVERSE                                       
074000                                   TO ASTRTITH                            
074100                 MOVE DP015-RED    TO ASTRTITC                            
074200                 MOVE DP015-UNP-NUM-BRT-MDT                               
074300                                   TO ASTRTITA                            
074400                 SET DP020-MSG-FATAL                                      
074500                                   TO TRUE                                
074600                 SET PS-ERROR      TO TRUE                                
074700             END-IF                                                       
074800                                                                          
074900         ELSE                                                             
075000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER                    
075100             MOVE -1               TO ASTRTITL                            
075200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
075300             MOVE DP015-REVERSE    TO ASTRTITH                            
075400             MOVE DP015-RED        TO ASTRTITC                            
075500             MOVE DP015-UNP-NUM-BRT-MDT                                   
075600                                   TO ASTRTITA                            
075700             SET DP020-MSG-FATAL   TO TRUE                                
075800             SET PS-ERROR          TO TRUE                                
075900         END-IF                                                           
076000     END-IF.                                                              
076100 EJECT                                                                    
076200*----------------------------------------------------------------*        
076300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *        
076400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *        
076500*----------------------------------------------------------------*        
076600 2140-DESELECT-ALL-ITEMS.                                                 
076700     MOVE +1                       TO ASC-BLK-SUB.                        
076800                                                                          
076900     PERFORM 2141-CLEAR-SELECTED-INDS                                     
077000         VARYING ASC-ITEM-SUB                                             
077100         FROM 1 BY 1                                                      
077200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
077300                                                                          
077400     ADD +1                        TO ASC-BLK-SUB.                        
077500                                                                          
077600     PERFORM 2141-CLEAR-SELECTED-INDS                                     
077700         VARYING ASC-ITEM-SUB                                             
077800         FROM 1 BY 1                                                      
077900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
078000                                                                          
078100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
078200                                   TO PV-LIST-ITEM-NUMBER.                
078300                                                                          
078400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
078500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
078600                                                                          
078700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                             
078800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)              
078900         MOVE +1                   TO ASC-BLK-SUB                         
079000                                                                          
079100         PERFORM 5100-WRITE-TEMP-STORAGE                                  
079200                                                                          
079300         MOVE +1                   TO PV-BLOCK-NUMBER                     
079400                                                                          
079500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
079600             PV-FIRST-BLOCK-IN-ARRAY - 1                                  
079700                                                                          
079800         PERFORM                                                          
079900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY               
080000                                                                          
080100             PERFORM 4410-READ-TEMP-STORAGE                               
080200                                                                          
080300             PERFORM 2141-CLEAR-SELECTED-INDS                             
080400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                         
080500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
080600                                                                          
080700             PERFORM 5100-WRITE-TEMP-STORAGE                              
080800                                                                          
080900             ADD +1                TO PV-BLOCK-NUMBER                     
081000                                                                          
081100         END-PERFORM                                                      
081200                                                                          
081300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
081400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
081500                                                                          
081600         PERFORM                                                          
081700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
081800                   ASC-HIGHEST-BLOCK-WRITTEN                              
081900                                                                          
082000             MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
082100                                   TO PV-BLOCK-NUMBER                     
082200                                                                          
082300             PERFORM 4410-READ-TEMP-STORAGE                               
082400                                                                          
082500             PERFORM 2141-CLEAR-SELECTED-INDS                             
082600                 VARYING ASC-ITEM-SUB                                     
082700                 FROM 1 BY 1                                              
082800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
082900                                                                          
083000             PERFORM 5100-WRITE-TEMP-STORAGE                              
083100                                                                          
083200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
083300                                                                          
083400         END-PERFORM                                                      
083500                                                                          
083600         MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
083700                                   TO PV-BLOCK-NUMBER                     
083800                                                                          
083900         PERFORM 4410-READ-TEMP-STORAGE                                   
084000     END-IF.                                                              
084100                                                                          
084200                                                                          
084300     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS          
084310                                     PV-NUMBER-OF-SELECTED-ITEMS.         
084400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.        
084500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.          
084600                                                                          
084700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
084800                                                                          
084900 EJECT                                                                    
085000*----------------------------------------------------------------*        
085100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *        
085200*----------------------------------------------------------------*        
085300                                                                          
085400 2141-CLEAR-SELECTED-INDS.                                                
085500                                                                          
085600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)                   
085700             NOT EQUAL ZERO                                               
085800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                  
085900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                  
086000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            
086100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                          
086200                                   TO TRUE                                
086300         END-IF                                                           
086400     END-IF.                                                              
086500                                                                          
086600 EJECT                                                                    
086700*----------------------------------------------------------------*        
086800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *        
086900*  FOR ALL ITEMS.                                                *        
087000*----------------------------------------------------------------*        
087100                                                                          
087200 2150-SELECT-ALL-ITEMS.                                                   
087300                                                                          
087400     MOVE +1                       TO ASC-BLK-SUB.                        
087500                                                                          
087600     PERFORM 2151-SET-SELECTED-INDS                                       
087700         VARYING ASC-ITEM-SUB                                             
087800         FROM 1 BY 1                                                      
087900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
088000                                                                          
088100     ADD +1                        TO ASC-BLK-SUB.                        
088200                                                                          
088300     PERFORM 2151-SET-SELECTED-INDS                                       
088400         VARYING ASC-ITEM-SUB                                             
088500         FROM 1 BY 1                                                      
088600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
088700                                                                          
088800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
088900                                   TO PV-LIST-ITEM-NUMBER.                
089000                                                                          
089100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
089200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
089300                                                                          
089400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                             
089500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)            
089600         MOVE +1                   TO ASC-BLK-SUB                         
089700                                                                          
089800         PERFORM 5100-WRITE-TEMP-STORAGE                                  
089900                                                                          
090000         MOVE +1                   TO PV-BLOCK-NUMBER                     
090100                                                                          
090200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
090300             PV-FIRST-BLOCK-IN-ARRAY - 1                                  
090400                                                                          
090500         PERFORM                                                          
090600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY               
090700                                                                          
090800             PERFORM 4410-READ-TEMP-STORAGE                               
090900                                                                          
091000             PERFORM 2151-SET-SELECTED-INDS                               
091100                 VARYING ASC-ITEM-SUB                                     
091200                 FROM 1 BY 1                                              
091300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
091400                                                                          
091500             PERFORM 5100-WRITE-TEMP-STORAGE                              
091600                                                                          
091700             ADD +1                TO PV-BLOCK-NUMBER                     
091800                                                                          
091900         END-PERFORM                                                      
092000                                                                          
092100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
092200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
092300                                                                          
092400         PERFORM                                                          
092500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
092600                   ASC-HIGHEST-BLOCK-WRITTEN                              
092700                                                                          
092800             MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
092900                                   TO PV-BLOCK-NUMBER                     
093000                                                                          
093100             PERFORM 4410-READ-TEMP-STORAGE                               
093200                                                                          
093300             PERFORM 2151-SET-SELECTED-INDS                               
093400                 VARYING ASC-ITEM-SUB                                     
093500                 FROM 1 BY 1                                              
093600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
093700                                                                          
093800             PERFORM 5100-WRITE-TEMP-STORAGE                              
093900                                                                          
094000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
094100                                                                          
094200         END-PERFORM                                                      
094300                                                                          
094400         MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
094500                                   TO PV-BLOCK-NUMBER                     
094600                                                                          
094700         PERFORM 4410-READ-TEMP-STORAGE                                   
094800     END-IF.                                                              
094900                                                                          
095000                                                                          
095100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                                     
095200                       ASC-NUMBER-OF-SELECTED-ITEMS                       
095210                        PV-NUMBER-OF-SELECTED-ITEMS.                      
095300                                                                          
095400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
095500                                                                          
095600 EJECT                                                                    
095700*----------------------------------------------------------------*        
095800*    MARK EACH ITEM AS BEING SELECTED.                           *        
095900*----------------------------------------------------------------*        
096000                                                                          
096100 2151-SET-SELECTED-INDS.                                                  
096200                                                                          
096300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)                   
096400             NOT EQUAL ZERO                                               
096500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                     
096600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                     
096700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                
096800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                          
096900                               TO  TRUE                                   
097000         END-IF                                                           
097100     END-IF.                                                              
097200******************************************************************        
097300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **        
097400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **        
097500******************************************************************        
097600 2200-MOVE-SCREEN-TO-COMMAREA.                                            
097700                                                                          
097800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.                     
097900     MOVE +1                       TO PV-SUB.                             
098000*                                                                         
098100     PERFORM 3100-SET-SUBSCRIPTS.                                         
098200     IF  ASTRTITL > ZERO                                                  
098300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST                  
098400     ELSE                                                                 
098500         IF  ASTRTITF = DP015-ERASE-EOF                                   
098600             INITIALIZE ASC-START-ITEM-REQUEST                            
098700         END-IF                                                           
098800     END-IF.                                                              
098900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                                  
099000         VARYING PV-SUB                                                   
099100         FROM 1 BY 1                                                      
099200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                              
099300******************************************************************        
099400** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**        
099500******************************************************************        
099600 2210-MOVE-LINES-TO-COMMAREA.                                             
099700     IF  MR-SELECTL (PV-SUB) > ZERO                                       
099800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE                     
099900         MOVE MR-SELECTI (PV-SUB)                                         
100000                                   TO ASC-TEMP-SELECTED-SW                
100100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)              
100200     ELSE                                                                 
100300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                        
100400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             
100500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW                
100600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)              
100700         END-IF                                                           
100800     END-IF.                                                              
100900     ADD +1                        TO ASC-ITEM-SUB.                       
101000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
101100         ADD +1                    TO ASC-BLK-SUB                         
101200         MOVE +1                   TO ASC-ITEM-SUB                        
101300     END-IF.                                                              
101400******************************************************************        
101500** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **        
101600** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **        
101700******************************************************************        
101800 3000-EDIT-DATA-IN-COMMAREA.                                              
101900     SET PS-NO-ERROR               TO TRUE.                               
102000     PERFORM 3200-RESET-ATTRIBUTES.                                       
102100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                             
102200**                                                                        
102300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.                      
102400* EDITTING IS DONE FROM THE BOTTOM UP.                                    
102500**                                                                        
102600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                               
102700         ASC-ITEMS-DISPLAYED - 1.                                         
102800     PERFORM 3100-SET-SUBSCRIPTS.                                         
102900     PERFORM 3300-EDIT-SELECTIONS                                         
103000         VARYING PV-SUB                                                   
103100         FROM PV-SUB BY -1                                                
103200         UNTIL PV-SUB < +1                                                
103300*                                                                         
103400     IF  PS-NO-ERROR                                                      
103500         PERFORM 3400-CHECK-RANGE-SEQUENCE                                
103600     END-IF.                                                              
103700*                                                                         
103800     IF  ((PS-NO-ERROR)                                                   
103900       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                           
104000       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                            
104100             PERFORM 3500-MARK-RANGE-AS-SELECTED                          
104200     END-IF.                                                              
104300 EJECT                                                                    
104400*----------------------------------------------------------------*        
104500*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *        
104600*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*        
104700*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *        
104800*                                                                *        
104900*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *        
105000*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *        
105100*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *        
105200*    US IN THE 2ND BLOCK OF THE ARRAY.                           *        
105300*----------------------------------------------------------------*        
105400                                                                          
105500 3100-SET-SUBSCRIPTS.                                                     
105600                                                                          
105700     COMPUTE ASC-ITEM-SUB =                                               
105800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.                
105900                                                                          
106000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                 
106100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
106200                                                                          
106300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB                       
106400     ELSE                                                                 
106500         MOVE +1                     TO ASC-BLK-SUB                       
106600     END-IF.                                                              
106700******************************************************************        
106800** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **        
106900******************************************************************        
107000                                                                          
107100 3200-RESET-ATTRIBUTES.                                                   
107200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                           
107300     MOVE DP015-GREEN              TO ASTRTITC.                           
107400     MOVE DP015-UNDERLINE          TO ASTRTITH.                           
107500                                                                          
107600     PERFORM                                                              
107700         VARYING PV-SUB                                                   
107800         FROM 1 BY 1                                                      
107900*        UNTIL PV-SUB > PC-ITEMS-PER-PANEL                                
107910         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                               
108000         MOVE DP015-UNP-ALP-NOR-OFF                                       
108100                                   TO MR-SELECTA (PV-SUB)                 
108200         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)                 
108300         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)                 
108400     END-PERFORM.                                                         
108500******************************************************************        
108600** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **        
108700** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **        
108800** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **        
108900** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **        
109000******************************************************************        
109100 3300-EDIT-SELECTIONS.                                                    
109200     EVALUATE TRUE                                                        
109300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)             
109400             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)                 
109500                 CONTINUE                                                 
109600         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)                 
109700             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                
109800                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS           
109900                 MOVE ASC-TEMP-SELECTED-SW                                
110000                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
110100                                TO ASC-SELECTED-SW                        
110200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
110300             END-IF                                                       
110400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)             
110500                 = SPACE                                                  
110600             EVALUATE TRUE                                                
110700                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)               
110800                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS        
110900                     MOVE SPACE TO ASC-SELECTED-SW                        
111000                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
111100                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                
111200                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE            
111300                     MOVE SPACE TO ASC-SELECTED-SW                        
111400                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
111500                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)                  
111600                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE              
111700                     MOVE SPACE TO ASC-SELECTED-SW                        
111800                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
111900             END-EVALUATE                                                 
112000         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                   
112100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
112200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            
112300             END-IF                                                       
112400             PERFORM 3310-EDIT-RANGE                                      
112500         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)                     
112600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
112700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            
112800             END-IF                                                       
112900             PERFORM 3310-EDIT-RANGE                                      
113000         WHEN OTHER                                                       
113100             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER                   
113200             SET DP020-MSG-FATAL    TO TRUE                               
113300             MOVE -1                TO MR-SELECTL (PV-SUB)                
113400             SET DP030-SET-CURSOR-APPL-1                                  
113500                                    TO TRUE                               
113600             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)                
113700             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)                
113800             SET PS-ERROR TO TRUE                                         
113900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
114000                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS             
114100                 MOVE SPACE         TO ASC-SELECTED-SW                    
114200                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
114300             END-IF                                                       
114400     END-EVALUATE.                                                        
114500                                                                          
114600     SUBTRACT +1             FROM PV-ITEM-IN-USE.                         
114700     SUBTRACT +1 FROM ASC-ITEM-SUB.                                       
114800     IF  ASC-ITEM-SUB < 1                                                 
114900         SUBTRACT +1 FROM ASC-BLK-SUB                                     
115000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                        
115100     END-IF.                                                              
115200******************************************************************        
115300** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **        
115400** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **        
115500** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**        
115600** THE ENDING.                                                  **        
115700******************************************************************        
115800 3310-EDIT-RANGE.                                                         
115900     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                        
116000         IF  ASC-START-OF-SELECTED-RANGE = ZERO                           
116100             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)        
116200                                   TO ASC-SELECTED-SW                     
116300                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
116400             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE         
116500         ELSE                                                             
116600             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE             
116700                 CONTINUE                                                 
116800             ELSE                                                         
116900*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --                
117000                 MOVE PC-TSYMSG-00054                                     
117100                                   TO DP020-MSG-NUMBER                    
117200                 SET DP020-MSG-FATAL                                      
117300                                   TO TRUE                                
117400                 MOVE -1           TO MR-SELECTL (PV-SUB)                 
117500                 SET DP030-SET-CURSOR-APPL-1                              
117600                                   TO TRUE                                
117700                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)                 
117800                 MOVE DP015-UNDERLINE                                     
117900                                   TO MR-SELECTH (PV-SUB)                 
118000                 SET PS-ERROR      TO TRUE                                
118100             END-IF                                                       
118200         END-IF                                                           
118300     ELSE                                                                 
118400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                             
118500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         
118600                                   TO ASC-SELECTED-SW                     
118700                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
118800             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE           
118900         ELSE                                                             
119000             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE               
119100                 CONTINUE                                                 
119200             ELSE                                                         
119300*                -- ONLY ONE END-OF-RANGE ALLOWED --                      
119400                 MOVE PC-TSYMSG-00055                                     
119500                                   TO DP020-MSG-NUMBER                    
119600                 SET DP020-MSG-FATAL                                      
119700                                   TO TRUE                                
119800                 MOVE -1           TO MR-SELECTL (PV-SUB)                 
119900                 SET DP030-SET-CURSOR-APPL-1                              
120000                                   TO TRUE                                
120100                 SET PS-ERROR      TO TRUE                                
120200             END-IF                                                       
120300         END-IF                                                           
120400     END-IF.                                                              
120500*                                                                         
120600******************************************************************        
120700** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **        
120800** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **        
120900******************************************************************        
121000 3400-CHECK-RANGE-SEQUENCE.                                               
121100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
121200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                              
121300       AND  ASC-START-OF-SELECTED-RANGE >                                 
121400                                         ASC-END-OF-SELECTED-RANGE        
121500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                        
121600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                         
121700         SET DP020-MSG-FATAL TO TRUE                                      
121800         SET PS-ERROR TO TRUE                                             
121900         PERFORM 3410-POSITION-AT-ERROR                                   
122000     END-IF.                                                              
122100******************************************************************        
122200** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **        
122300** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **        
122400** SHOULD BE POSITIONED ON A RANGE ERROR.                       **        
122500******************************************************************        
122600 3410-POSITION-AT-ERROR.                                                  
122700     SET DP030-SET-CURSOR-APPL-1                                          
122800                                   TO TRUE.                               
122900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
123000                    - PV-TOP-ITEM + 1.                                    
123100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
123200         CONTINUE                                                         
123300     ELSE                                                                 
123400         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
123500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
123600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)                 
123700     END-IF.                                                              
123800*                                                                         
123900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
124000                    - PV-TOP-ITEM + 1.                                    
124100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
124200         CONTINUE                                                         
124300     ELSE                                                                 
124400         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
124500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
124600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)                 
124700     END-IF.                                                              
124800 EJECT                                                                    
124900*----------------------------------------------------------------*        
125000*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *        
125100*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *        
125200*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *        
125300*----------------------------------------------------------------*        
125400                                                                          
125500 3500-MARK-RANGE-AS-SELECTED.                                             
125600     MOVE +1                       TO  ASC-BLK-SUB.                       
125700     PERFORM 3510-MARK-SELECTED-INDS                                      
125800         VARYING ASC-ITEM-SUB                                             
125900         FROM 1 BY 1                                                      
126000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
126100                                                                          
126200     ADD +1                        TO ASC-BLK-SUB.                        
126300     PERFORM 3510-MARK-SELECTED-INDS                                      
126400         VARYING ASC-ITEM-SUB                                             
126500         FROM 1 BY 1                                                      
126600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
126700                                                                          
126800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
126900                                   TO  PV-LIST-ITEM-NUMBER.               
127000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
127100         1 + ((PV-LIST-ITEM-NUMBER - 1) /                                 
127200               PC-ITEMS-PER-PANEL).                                       
127300                                                                          
127400     MOVE ASC-START-OF-SELECTED-RANGE                                     
127500                                   TO PV-START-OF-SELECTED-RANGE.         
127600     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                                    
127700         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                          
127800               PC-ITEMS-PER-PANEL).                                       
127900                                                                          
128000     MOVE ASC-END-OF-SELECTED-RANGE                                       
128100                                   TO  PV-END-OF-SELECTED-RANGE.          
128200     COMPUTE PV-LAST-BLOCK-IN-RANGE =                                     
128300         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                            
128400               PC-ITEMS-PER-PANEL).                                       
128500     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                     
128600         PV-FIRST-BLOCK-IN-ARRAY + 1.                                     
128700                                                                          
128800     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR            
128900        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)                
129000         MOVE +1                   TO ASC-BLK-SUB                         
129100         PERFORM 5100-WRITE-TEMP-STORAGE                                  
129200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
129300             PV-FIRST-BLOCK-IN-ARRAY - 1                                  
129400                                                                          
129500         PERFORM                                                          
129600             UNTIL PV-FIRST-BLOCK-IN-RANGE >                              
129700                   PV-PREV-BLOCK-IN-ARRAY                                 
129800             MOVE PV-FIRST-BLOCK-IN-RANGE                                 
129900                                   TO PV-BLOCK-NUMBER                     
130000             PERFORM 4410-READ-TEMP-STORAGE                               
130100             PERFORM 3510-MARK-SELECTED-INDS                              
130200                 VARYING ASC-ITEM-SUB                                     
130300                 FROM 1 BY 1                                              
130400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
130500             PERFORM 5100-WRITE-TEMP-STORAGE                              
130600             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE             
130700         END-PERFORM                                                      
130800                                                                          
130900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
131000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
131100         PERFORM                                                          
131200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
131300                   PV-LAST-BLOCK-IN-RANGE                                 
131400             MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
131500                                   TO PV-BLOCK-NUMBER                     
131600             PERFORM 4410-READ-TEMP-STORAGE                               
131700             PERFORM 3510-MARK-SELECTED-INDS                              
131800                 VARYING ASC-ITEM-SUB                                     
131900                 FROM 1 BY 1                                              
132000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
132100             PERFORM 5100-WRITE-TEMP-STORAGE                              
132200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
132300         END-PERFORM                                                      
132400                                                                          
132500         MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
132600                                   TO PV-BLOCK-NUMBER                     
132700         PERFORM 4410-READ-TEMP-STORAGE                                   
132800     END-IF.                                                              
132900                                                                          
133000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE         
133100                                      ASC-END-OF-SELECTED-RANGE.          
133200                                                                          
133300 EJECT                                                                    
133400*----------------------------------------------------------------*        
133500* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *        
133600*----------------------------------------------------------------*        
133700                                                                          
133800 3510-MARK-SELECTED-INDS.                                                 
133900                                                                          
134000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                                 
134100                                ASC-ITEM-SUB) >                           
134200         ASC-START-OF-SELECTED-RANGE)                                     
134300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                                 
134400                                ASC-ITEM-SUB) =                           
134500         ASC-START-OF-SELECTED-RANGE)                                     
134600                                                                          
134700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                             
134800                                    ASC-ITEM-SUB) <                       
134900             ASC-END-OF-SELECTED-RANGE)                                   
135000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                             
135100                                    ASC-ITEM-SUB) =                       
135200             ASC-END-OF-SELECTED-RANGE)                                   
135300                                                                          
135400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                  
135500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)           
135600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)           
135700                               TO TRUE                                    
135800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      
135900                               TO TRUE                                    
136000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS            
136100             END-IF                                                       
136200         END-IF                                                           
136300     END-IF.                                                              
136400                                                                          
136500 EJECT                                                                    
136600*----------------------------------------------------------------*        
136700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *        
136800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *        
136900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *        
137000*    DISPLAY THE PANEL TO USER.                                  *        
137100*----------------------------------------------------------------*        
137200                                                                          
137300 4000-BUILD-INITIAL-PANEL.                                                
137400                                                                          
137500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)                    
137600                                 ASC-BLOCK-ENTRIES (2).                   
137700     MOVE +1                 TO ASC-BLK-SUB.                              
137800     SET ASC-ITEMS-LEFT-ON-DB                                             
137900                             TO TRUE.                                     
138000                                                                          
138100     MOVE +0                 TO ASC-ITEM-SUB                              
138200                                ASC-NUMBER-OF-ITEMS-READ                  
138300*                               ASC-NUMBER-OF-SELECTED-ITEMS              
138400                                ASC-HIGHEST-BLOCK-WRITTEN                 
138500                                ASC-START-OF-SELECTED-RANGE               
138600                                ASC-END-OF-SELECTED-RANGE                 
138700                                ASC-ITEM-AT-TOP-OF-PANEL.                 
138800     PERFORM 4100-PREPARE-CURSOR                                          
138900                                                                          
139000     PERFORM 4010-OPEN-CURSOR.                                            
139100                                                                          
139200     PERFORM 4300-READ-ITEMS-FROM-DB.                                     
139300                                                                          
139400     PERFORM 4020-CLOSE-CURSOR.                                           
139500                                                                          
139600     MOVE +1                   TO  PV-TOP-ITEM.                           
139700     IF (ASC-NUMBER-OF-ITEMS-READ = ZERO                                  
139710         AND PV-NUMBER-OF-SELECTED-ITEMS > 0                              
139720         AND DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-LIST-ACT)          
139800         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                            
139900         SET DP020-MSG-FATAL   TO  TRUE                                   
140000         MOVE PC-TSYMSG-01646  TO  DP020-MSG-NUMBER                       
140010         MOVE -1               TO MR-SELECTL (1)                          
140020         SET DP030-SET-CURSOR-APPL-1                                      
140030                               TO TRUE                                    
140040                 SET DP030-OVERRIDE-GO                                    
140050                                 TO TRUE                                  
140100     ELSE                                                                 
140200         MOVE -1               TO MR-SELECTL (1)                          
140300         SET DP030-SET-CURSOR-APPL-1                                      
140400                               TO TRUE                                    
140500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                             
140600     END-IF.                                                              
140700 EJECT                                                                    
140800*----------------------------------------------------------------*        
140900* OPEN THE TMESSAGE CURSOR.                                      *        
141000*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *        
141100*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *        
141200*   USER.                                                        *        
141300*----------------------------------------------------------------*        
141400                                                                          
141500 4010-OPEN-CURSOR.                                                        
141600     EVALUATE TRUE                                                        
141700         WHEN ASC-USE-LIKE-CURSOR                                         
141800             MOVE 'CURSOR:  COUNTRY-LIKE-CSR'                             
141900                               TO DP013-MESSAGE-TEXT (2)                  
142000             EXEC SQL                                                     
142100                  OPEN COUNTRY-LIKE-CSR                                   
142200             END-EXEC                                                     
142300                                                                          
142400         WHEN ASC-USE-ALL-CURSOR                                          
142500             MOVE 'CURSOR:  COUNTRY-ALL-CSR'                              
142600                               TO DP013-MESSAGE-TEXT (2)                  
142700             EXEC SQL                                                     
142800                  OPEN COUNTRY-ALL-CSR                                    
142900             END-EXEC                                                     
143000                                                                          
143100     END-EVALUATE.                                                        
143200                                                                          
143300     EVALUATE TRUE                                                        
143400         WHEN SQLCODE = ZERO                                              
143500             CONTINUE                                                     
143600         WHEN SQLWARN0 NOT = SPACES                                       
143700         WHEN SQLCODE < ZERO                                              
143800         WHEN SQLCODE > ZERO                                              
143900             MOVE '4010-OPEN-CURSOR'                                      
144000                               TO DP013-PARAGRAPH                         
144100             MOVE 'OPEN SYSTEM MESSAGE CURSOR - '                         
144200                               TO DP013-MESSAGE-TEXT (1)                  
144300             MOVE SQLCA        TO DP013-SQLCA                             
144400             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)                
144500             SET DP013-DB2-ABEND                                          
144600                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
144700             PERFORM DP013-0000-PROCESS-ABEND                             
144800     END-EVALUATE.                                                        
144900*                                                                         
145000 EJECT                                                                    
145100*----------------------------------------------------------------*        
145200* CLOSE THE TMESSAGE CURSOR.                                     *        
145300*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *        
145400*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *        
145500*   USER.                                                        *        
145600*----------------------------------------------------------------*        
145700                                                                          
145800 4020-CLOSE-CURSOR.                                                       
145900     EVALUATE TRUE                                                        
146000         WHEN ASC-USE-LIKE-CURSOR                                         
146100             MOVE 'CURSOR:  COUNTRY-LIKE-CSR'                             
146200                               TO DP013-MESSAGE-TEXT (2)                  
146300             EXEC SQL                                                     
146400                  CLOSE COUNTRY-LIKE-CSR                                  
146500             END-EXEC                                                     
146600                                                                          
146700         WHEN ASC-USE-ALL-CURSOR                                          
146800             MOVE 'CURSOR:  COUNTRY-ALL-CSR'                              
146900                               TO DP013-MESSAGE-TEXT (2)                  
147000             EXEC SQL                                                     
147100                  CLOSE COUNTRY-ALL-CSR                                   
147200             END-EXEC                                                     
147300                                                                          
147400     END-EVALUATE.                                                        
147500*                                                                         
147600     EVALUATE TRUE                                                        
147700         WHEN SQLCODE = ZERO                                              
147800             CONTINUE                                                     
147900         WHEN SQLWARN0 NOT = SPACES                                       
148000         WHEN SQLCODE < ZERO                                              
148100         WHEN SQLCODE > ZERO                                              
148200             MOVE '4020-CLOSE-CURSOR'                                     
148300                               TO DP013-PARAGRAPH                         
148400             MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                          
148500                               TO DP013-MESSAGE-TEXT (1)                  
148600             MOVE SQLCA        TO DP013-SQLCA                             
148700             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)                
148800             SET DP013-DB2-ABEND                                          
148900                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
149000             PERFORM DP013-0000-PROCESS-ABEND                             
149100     END-EVALUATE.                                                        
149200                                                                          
149300 EJECT                                                                    
149400*----------------------------------------------------------------*        
149500*    SET UP THE HOST VARIABLES.                                  *        
149600*----------------------------------------------------------------*        
149700                                                                          
149800 4100-PREPARE-CURSOR.                                                     
149900                                                                          
150000                                                                          
150100 EJECT                                                                    
150200*----------------------------------------------------------------*        
150300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *        
150400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *        
150500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *        
150600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *        
150700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *        
150800*                                                                *        
150900*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *        
151000*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *        
151100*    UPON INITIALIZATION.                                        *        
151200*----------------------------------------------------------------*        
151300                                                                          
151400 4300-READ-ITEMS-FROM-DB.                                                 
151500                                                                          
151600     PERFORM                                                              
151700         VARYING PV-READ-COUNT                                            
151800         FROM 1 BY 1                                                      
151900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                            
152000            OR (ASC-NO-ITEMS-LEFT-ON-DB))                                 
152100                                                                          
152200         PERFORM 4310-FETCH                                               
152300                                                                          
152400         IF  ASC-ITEMS-LEFT-ON-DB                                         
152500             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        
152600                 ADD +1            TO ASC-ITEM-SUB                        
152700             ELSE                                                         
152800                 ADD +1            TO ASC-BLK-SUB                         
152900                 MOVE +1           TO ASC-ITEM-SUB                        
153000                                                                          
153100                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 
153200                     MOVE +1       TO ASC-BLK-SUB                         
153300                     SET ASC-BLOCK-MODIFIED (1)                           
153400                                   TO TRUE                                
153500                     PERFORM 5100-WRITE-TEMP-STORAGE                      
153600                     MOVE ASC-BLOCK-ENTRIES                               
153700                               (PC-MAX-BLOCKS-IN-ARRAY)                   
153800                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)         
153900                     ADD +1        TO ASC-BLK-SUB                         
154000                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           
154100                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              
154200                                   TO TRUE                                
154300                 END-IF                                                   
154400             END-IF                                                       
154500             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ            
154600             MOVE ASC-NUMBER-OF-ITEMS-READ                                
154700                                   TO ASC-LIST-ITEM-NUMBER                
154800                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
154900             MOVE CNTRY-CNTRY-CDE  TO ASC-COUNTRY-CODE                    
155000                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
155100             MOVE CNTRY-CNTRY-NM                                          
155200                               TO  ASC-COUNTRY-DESC                       
155300                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
155310             MOVE CNTRY-STAT-CDE    TO   ASC-KEY-COUNTRY-STAT             
155400         END-IF                                                           
155500     END-PERFORM.                                                         
155600                                                                          
155700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                                  
155800         MOVE +1               TO ASC-BLK-SUB                             
155900         PERFORM 5100-WRITE-TEMP-STORAGE                                  
156000         ADD +1                TO ASC-BLK-SUB                             
156100         PERFORM 5100-WRITE-TEMP-STORAGE                                  
156200                                                                          
156300         MOVE 1                TO ASC-BLK-SUB                             
156400                                  PV-BLOCK-NUMBER                         
156500         PERFORM 4410-READ-TEMP-STORAGE                                   
156600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                     
156700             MOVE 2            TO ASC-BLK-SUB                             
156800                                  PV-BLOCK-NUMBER                         
156900             PERFORM 4410-READ-TEMP-STORAGE                               
157000         END-IF                                                           
157100     END-IF.                                                              
157200 EJECT                                                                    
157300*----------------------------------------------------------------*        
157400*    FETCH THE MESSAGE CURSOR.                                   *        
157500*----------------------------------------------------------------*        
157600                                                                          
157700 4310-FETCH.                                                              
157800                                                                          
157900     EVALUATE TRUE                                                        
158000         WHEN ASC-USE-LIKE-CURSOR                                         
158100             MOVE 'CURSOR:  COUNTRY-LIKE-CSR'                             
158200                               TO DP013-MESSAGE-TEXT (2)                  
158300             EXEC SQL                                                     
158400                  FETCH COUNTRY-LIKE-CSR                                  
158500                  INTO  :CNTRY-CNTRY-CDE                                  
158600                      , :CNTRY-CNTRY-NM                                   
158610                      , :CNTRY-STAT-CDE                                   
158700             END-EXEC                                                     
158800                                                                          
158900         WHEN ASC-USE-ALL-CURSOR                                          
159000             MOVE 'CURSOR:  COUNTRY-ALL-CSR'                              
159100                               TO DP013-MESSAGE-TEXT (2)                  
159200             EXEC SQL                                                     
159300                  FETCH COUNTRY-ALL-CSR                                   
159400                  INTO  :CNTRY-CNTRY-CDE                                  
159500                      , :CNTRY-CNTRY-NM                                   
159501                      , :CNTRY-STAT-CDE                                   
159600             END-EXEC                                                     
159700                                                                          
159800     END-EVALUATE.                                                        
159900                                                                          
160000     EVALUATE TRUE                                                        
160100         WHEN SQLCODE = ZERO                                              
160200         WHEN SQLCODE = +100                                              
160210              IF PV-NUMBER-OF-SELECTED-ITEMS NOT NUMERIC                  
160220                   MOVE 0  TO PV-NUMBER-OF-SELECTED-ITEMS                 
160230               END-IF                                                     
160400         WHEN SQLWARN0 NOT = SPACE                                        
160500         WHEN SQLCODE NOT = ZERO                                          
160600              MOVE '4310-FETCH-CURSOR'                                    
160700                               TO DP013-PARAGRAPH                         
160800              MOVE 'FETCH MESSAGE CURSOR'                                 
160900                               TO DP013-MESSAGE-TEXT (1)                  
161000              MOVE SQLCA       TO DP013-SQLCA                             
161100              SET DP013-DB2-ABEND                                         
161200                               TO TRUE                                    
161300              PERFORM DP013-0000-PROCESS-ABEND                            
161400     END-EVALUATE.                                                        
161500                                                                          
161600     IF  SQLCODE EQUAL +100                                               
161700         SET ASC-NO-ITEMS-LEFT-ON-DB                                      
161800                                   TO TRUE                                
161900     END-IF.                                                              
162000                                                                          
162100 EJECT                                                                    
162200*----------------------------------------------------------------*        
162300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *        
162400*----------------------------------------------------------------*        
162500                                                                          
162600 4400-MOVE-COMMAREA-TO-SCREEN.                                            
162700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                     
162800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))                  
162900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))                  
163000             MOVE +1    TO ASC-BLK-SUB                                    
163100             PERFORM 5100-WRITE-TEMP-STORAGE                              
163200             ADD +1     TO ASC-BLK-SUB                                    
163300             PERFORM 5100-WRITE-TEMP-STORAGE                              
163400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                     
163500                 GIVING PV-BLOCK-NUMBER                                   
163600                 REMAINDER PV-REMAINDER                                   
163700             IF  PV-REMAINDER > ZERO                                      
163800                 ADD +1 TO PV-BLOCK-NUMBER                                
163900             END-IF                                                       
164000             MOVE +1    TO ASC-BLK-SUB                                    
164100             PERFORM 4410-READ-TEMP-STORAGE                               
164200             ADD +1     TO ASC-BLK-SUB                                    
164300                           PV-BLOCK-NUMBER                                
164400             PERFORM 4410-READ-TEMP-STORAGE                               
164500     END-IF.                                                              
164600     MOVE +1            TO ASC-BLK-SUB.                                   
164700     COMPUTE ASC-ITEM-SUB =                                               
164800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                      
164900         + PC-ITEMS-PER-PANEL).                                           
165000*                                                                         
165100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
165200         ADD +1         TO ASC-BLK-SUB                                    
165300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
165400     END-IF.                                                              
165500*                                                                         
165600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                                   
165700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                        
165800     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                                
165900     PERFORM 4420-FORMAT-LIST-LINES                                       
166000         VARYING PV-SUB                                                   
166100         FROM PC-ITEMS-PER-PANEL BY -1                                    
166200         UNTIL PV-SUB < +1.                                               
166300*                                                                         
166400     COMPUTE ASC-ITEMS-DISPLAYED =                                        
166500         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).                  
166600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL            
166700                                      ASTRTITO.                           
166800     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                            
166900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                            
167000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                    
167100                                   TO ASELITO.                            
167200*                                                                         
167300     IF  DP020-MSG-NUMBER-X = SPACE                                       
167400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ          
167500*            --- MORE ITEMS TO DISPLAY ----                               
167600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER                    
167700             SET DP020-MSG-INFORMATIONAL TO TRUE                          
167800         END-IF                                                           
167811     IF ASC-KEY-COUNTRY-STAT = 'I' MOVE                                   
167820         PC-TSYMSG-01645  TO DP020-MSG-NUMBER                             
167821             SET DP020-MSG-INFORMATIONAL TO TRUE                          
167830     END-IF                                                               
167900     END-IF.                                                              
168000*----------------------------------------------------------------*        
168100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *        
168200*----------------------------------------------------------------*        
168300                                                                          
168400 4410-READ-TEMP-STORAGE.                                                  
168500                                                                          
168600     EXEC CICS                                                            
168700         READQ TS                                                         
168800             QUEUE (ASC-LIST-QUEUE-NAME)                                  
168900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
169000             ITEM  (PV-BLOCK-NUMBER)                                      
169100             RESP  (PV-CICS-RESP)                                         
169200     END-EXEC.                                                            
169300                                                                          
169400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                               
169500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                             
169600         CONTINUE                                                         
169700     ELSE                                                                 
169800         SET DP013-CICS-ABEND     TO TRUE                                 
169900         SET DP013-NO-ROLLBACK    TO TRUE                                 
170000         MOVE '4410-READ-TEMP-STORAGE'                                    
170100                                  TO DP013-PARAGRAPH                      
170200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'              
170300                                  TO DP013-MESSAGE-TEXT(1)                
170400         PERFORM DP013-0000-PROCESS-ABEND                                 
170500     END-IF.                                                              
170600                                                                          
170700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
170800*                                                                         
170900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                                 
171000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                       
171100     END-IF.                                                              
171200 EJECT                                                                    
171300*----------------------------------------------------------------*        
171400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *        
171500*----------------------------------------------------------------*        
171600                                                                          
171700 4420-FORMAT-LIST-LINES.                                                  
171800     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ              
171900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                        
172000         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)                   
172100         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)                   
172200         MOVE SPACE              TO MR-SELECTI (PV-SUB)                   
172300                                    MR-ACTION (PV-SUB)                    
172400                                    MR-COUNTRY-CODE (PV-SUB)              
172500                                    MR-COUNTRY-DESC (PV-SUB)              
172600     ELSE                                                                 
172700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)              
172800                                                   > SPACE                
172900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         
173000                                 TO MR-SELECTI (PV-SUB)                   
173100         ELSE                                                             
173200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)              
173300                                 TO MR-SELECTI (PV-SUB)                   
173400         END-IF                                                           
173500*                                                                         
173600         IF  DP030-SET-CURSOR-TRAILER                                     
173700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)        
173800                 > SPACE)                                                 
173900               OR (PV-SUB = 1))                                           
174000                SET DP030-SET-CURSOR-APPL-1 TO TRUE                       
174100                MOVE -1          TO MR-SELECTL (PV-SUB)                   
174200             END-IF                                                       
174300         END-IF                                                           
174400*                                                                         
174500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL                   
174610             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)                   
174700                                 TO MR-ACTION (PV-SUB)                    
174800             MOVE ASC-COUNTRY-CODE (ASC-BLK-SUB ASC-ITEM-SUB)             
174900                                 TO MR-COUNTRY-CODE (PV-SUB)              
175000             MOVE ASC-COUNTRY-DESC (ASC-BLK-SUB ASC-ITEM-SUB)             
175100                                 TO MR-COUNTRY-DESC (PV-SUB)              
175200         END-IF                                                           
175300     END-IF.                                                              
175310                                                                          
175400     SUBTRACT +1 FROM ASC-ITEM-SUB                                        
175500     IF  ASC-ITEM-SUB < + 1                                               
175600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                          
175700         MOVE +1                 TO ASC-BLK-SUB                           
175810     END-IF.                                                              
175900******************************************************************        
176000** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **        
176100** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **        
176200** ISSUE A WARNING.                                             **        
176300******************************************************************        
176400 4430-CHECK-FOR-BEGIN-AND-END.                                            
176500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
176600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                             
176700*            -- NO END-OF-RANGE SPECFIED ---                              
176800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER                    
176900             SET DP020-MSG-WARNING TO TRUE                                
177000             PERFORM 4431-POSITION-AT-WARNING                             
177100         END-IF                                                           
177200     ELSE                                                                 
177300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                             
177400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                        
177500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER                    
177600             SET DP020-MSG-WARNING TO TRUE                                
177700             PERFORM 4431-POSITION-AT-WARNING                             
177800         END-IF                                                           
177900     END-IF.                                                              
178000******************************************************************        
178100** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **        
178200** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **        
178300** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **        
178400** POSITION THE CURSOR THERE.                                   **        
178500******************************************************************        
178600 4431-POSITION-AT-WARNING.                                                
178700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
178800                    - PV-TOP-ITEM + 1.                                    
178900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
179000         CONTINUE                                                         
179100     ELSE                                                                 
179200         SET DP030-SET-CURSOR-APPL-1                                      
179300                                   TO TRUE                                
179400         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
179500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
179600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)                 
179700     END-IF.                                                              
179800*                                                                         
179900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
180000                    - PV-TOP-ITEM + 1.                                    
180100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
180200         CONTINUE                                                         
180300     ELSE                                                                 
180400         SET DP030-SET-CURSOR-APPL-1                                      
180500                                   TO TRUE                                
180600         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
180700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
180800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)                 
180900     END-IF.                                                              
181000 EJECT                                                                    
181100*----------------------------------------------------------------*        
181200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *        
181300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *        
181400* FOR THE SELECTED ITEMS QUEUE.                                  *        
181500*                                                                *        
181600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *        
181700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *        
181800* THE ARRAY IS FULL.                                             *        
181900*----------------------------------------------------------------*        
182000                                                                          
182100 5000-PREPARE-SEL-QUEUE.                                                  
182200                                                                          
182300     MOVE +1                   TO  ASC-BLK-SUB.                           
182400     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
182500     ADD +1                    TO  ASC-BLK-SUB.                           
182600     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
182700                                                                          
182800     MOVE ASC-SEL-QUEUE-NAME   TO  TR019-SEL-QUEUE-NAME.                  
182900     PERFORM 6010-DELETE-SEL-QUEUE.                                       
183000                                                                          
183100     SET ASC-UPDATE-TSQ        TO  TRUE.                                  
183200                                                                          
183300     SET TR020-IDX             TO  1.                                     
183400     MOVE ZERO                 TO TR019-NUMBER-OF-TS-ITEMS.               
183500     INITIALIZE TR020-SELECTED-ITEM-ARRAY.                                
183600                                                                          
183700     PERFORM 5200-FILL-SEL-QUEUE-RECORD                                   
183800             VARYING PV-ITEM                                              
183900             FROM 1 BY 1                                                  
184000             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.             
184100                                                                          
184200     IF  TR020-IDX > 1                                                    
184300         PERFORM 5205-WRITE-SEL-QUEUE                                     
184400         ADD +1                TO TR019-NUMBER-OF-TS-ITEMS                
184500     END-IF.                                                              
184600 EJECT                                                                    
184700*----------------------------------------------------------------*        
184800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *        
184900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *        
185000*----------------------------------------------------------------*        
185100                                                                          
185200 5100-WRITE-TEMP-STORAGE.                                                 
185300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                             
185400                                   TO PV-LIST-ITEM-NUMBER.                
185500     COMPUTE PV-BLOCK-NUMBER =                                            
185600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
185700                                                                          
185800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)                     
185900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)                     
186000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                              
186100             PERFORM 5105-REWRITE-ASC-LISTQ                               
186200         END-IF                                                           
186300     ELSE                                                                 
186400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                               
186500         ASC-HIGHEST-BLOCK-WRITTEN + 1                                    
186600         PERFORM 5110-WRITE-ASC-LISTQ                                     
186700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN           
186800     END-IF.                                                              
186900                                                                          
187000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
187100******************************************************************        
187200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **        
187300** SPECIFIC COMMAREA.                                           **        
187400******************************************************************        
187500 5105-REWRITE-ASC-LISTQ.                                                  
187600     EXEC CICS                                                            
187700         WRITEQ TS                                                        
187800             QUEUE (ASC-LIST-QUEUE-NAME)                                  
187900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
188000             ITEM  (PV-BLOCK-NUMBER)                                      
188100             REWRITE                                                      
188200             RESP  (PV-CICS-RESP)                                         
188300     END-EXEC.                                                            
188400                                                                          
188500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                                   
188600         CONTINUE                                                         
188700     ELSE                                                                 
188800         SET DP013-CICS-ABEND            TO TRUE                          
188900         SET DP013-NO-ROLLBACK           TO TRUE                          
189000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH               
189100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'             
189200                                         TO DP013-MESSAGE-TEXT(1)         
189300         PERFORM DP013-0000-PROCESS-ABEND                                 
189400     END-IF.                                                              
189500                                                                          
189600******************************************************************        
189700** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **        
189800** SPECIFIC COMMAREA.                                           **        
189900******************************************************************        
190000 5110-WRITE-ASC-LISTQ.                                                    
190100     EXEC CICS                                                            
190200         WRITEQ TS                                                        
190300             QUEUE (ASC-LIST-QUEUE-NAME)                                  
190400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
190500             ITEM  (PV-BLOCK-NUMBER)                                      
190600             RESP  (PV-CICS-RESP)                                         
190700     END-EXEC.                                                            
190800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                              
190900         SET DP013-CICS-ABEND      TO TRUE                                
191000         SET DP013-NO-ROLLBACK     TO TRUE                                
191100         MOVE '5110-WRITE-ASC-LISTQ'                                      
191200                                   TO DP013-PARAGRAPH                     
191300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'                   
191400                                   TO DP013-MESSAGE-TEXT(1)               
191500         PERFORM DP013-0000-PROCESS-ABEND                                 
191600     END-IF.                                                              
191700 EJECT                                                                    
191800*----------------------------------------------------------------*        
191900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *        
192000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *        
192100*----------------------------------------------------------------*        
192200                                                                          
192300 5200-FILL-SEL-QUEUE-RECORD.                                              
192400                                                                          
192500     PERFORM 6112-READ-LIST-QUEUE.                                        
192600                                                                          
192700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                               
192800         PERFORM                                                          
192900         VARYING LQW-IDX                                                  
193000         FROM 1 BY 1                                                      
193100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL                    
193200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO                  
193300                                                                          
193400             IF  LQW-SELECT (LQW-IDX)                                     
193500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                      
193600                                   TO TR020-ITEM (TR020-IDX)              
193700                 MOVE LQW-COUNTRY-CODE (LQW-IDX)                          
193800                                   TO TR020-COUNTRY-CODE                  
193900                                                (TR020-IDX)               
193910                                      TR019-COUNTRY-CODE                  
193920*                MOVE LQW-COUNTRY-DESC (LQW-IDX)                          
193950*                                  TO TR019-COUNTRY-CODE-DESC             
194000                 MOVE SPACE        TO TR020-ACTION-SW (TR020-IDX)         
194100                 SET TR020-IDX UP BY 1                                    
194200                 IF  TR020-IDX > TR020-MAX-ITEMS                          
194300                     PERFORM 5205-WRITE-SEL-QUEUE                         
194400                     ADD +1        TO TR019-NUMBER-OF-TS-ITEMS            
194500                     INITIALIZE TR020-SELECTED-ITEM-ARRAY                 
194600                     SET TR020-IDX TO  1                                  
194700                 END-IF                                                   
194800             END-IF                                                       
194900         END-PERFORM                                                      
195000     END-IF.                                                              
195100                                                                          
195200*----------------------------------------------------------------*        
195300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *        
195400*----------------------------------------------------------------*        
195500                                                                          
195600 5205-WRITE-SEL-QUEUE.                                                    
195700                                                                          
195800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                    
195900                                   TO TR020-SELECTED-ITEMS.               
196000                                                                          
196100     EXEC CICS                                                            
196200          WRITEQ TS                                                       
196300              QUEUE (ASC-SEL-QUEUE-NAME)                                  
196400              FROM  (TR020-COUNTRY-SEL-REC)                               
196500              ITEM  (PV-SEL-QUEUE-ITEM)                                   
196600              RESP  (PV-CICS-RESP)                                        
196700     END-EXEC.                                                            
196800                                                                          
196900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
197000         CONTINUE                                                         
197100     ELSE                                                                 
197200         SET DP013-CICS-ABEND      TO TRUE                                
197300         SET DP013-NO-ROLLBACK     TO TRUE                                
197400         MOVE '5205-WRITE-SEL-QUEUE'                                      
197500                                   TO DP013-PARAGRAPH                     
197600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'                  
197700                                   TO DP013-MESSAGE-TEXT(1)               
197800         PERFORM DP013-0000-PROCESS-ABEND                                 
197900     END-IF.                                                              
198000 EJECT                                                                    
198100******************************************************************        
198200** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **        
198300** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **        
198400** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **        
198500** THE USER.                                                    **        
198600******************************************************************        
198700 6000-REFRESH-PANEL-FROM-TEMP.                                            
198800     IF  ASC-UPDATE-TSQ                                                   
198900         SET ASC-NO-TSQ-UPDATE TO TRUE                                    
199000         MOVE ZERO                 TO PV-SAVE-ITEM                        
199100                                      PV-SEL-QUEUE-ITEM                   
199200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                
199300                                   TO PV-HOLD-SELECTED-ITEMS              
199400         MOVE +1                   TO PV-ITEMS-PROCESSED                  
199500         PERFORM 6100-UPDATE-TSQ                                          
199600             UNTIL PV-ITEMS-PROCESSED >                                   
199700                                     PV-HOLD-SELECTED-ITEMS               
199800         PERFORM 6010-DELETE-SEL-QUEUE                                    
199900         INITIALIZE ASC-BLOCK-ENTRIES (1)                                 
200000                    ASC-BLOCK-ENTRIES (2)                                 
200100     END-IF.                                                              
200200                                                                          
200300*----------------------------------------------------------------*        
200400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *        
200500*----------------------------------------------------------------*        
200600 6010-DELETE-SEL-QUEUE.                                                   
200700                                                                          
200800     EXEC CICS                                                            
200900         DELETEQ TS                                                       
201000             QUEUE (ASC-SEL-QUEUE-NAME)                                   
201100             RESP  (PV-CICS-RESP)                                         
201200     END-EXEC.                                                            
201300*                                                                         
201400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                              
201500        (PV-CICS-RESP = DFHRESP(QIDERR)))                                 
201600         CONTINUE                                                         
201700     ELSE                                                                 
201800         SET DP013-CICS-ABEND TO TRUE                                     
201900         SET DP013-NO-ROLLBACK TO TRUE                                    
202000         MOVE '6010-DELETE-SEL-QUEUE'                                     
202100                        TO DP013-PARAGRAPH                                
202200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'                 
202300                        TO DP013-MESSAGE-TEXT (1)                         
202400         PERFORM DP013-0000-PROCESS-ABEND                                 
202500     END-IF.                                                              
202600                                                                          
202700*----------------------------------------------------------------*        
202800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *        
202900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *        
203000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *        
203100*    THE TEMP QUEUE.                                             *        
203200*----------------------------------------------------------------*        
203300                                                                          
203400 6100-UPDATE-TSQ.                                                         
203500                                                                          
203600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.                     
203700     PERFORM 6105-READ-SEL-QUEUE.                                         
203800     PERFORM                                                              
203900         VARYING TR020-IDX                                                
204000         FROM 1 BY 1                                                      
204100         UNTIL ((PV-ITEMS-PROCESSED >                                     
204200                              PV-HOLD-SELECTED-ITEMS)                     
204300         OR (TR020-IDX GREATER THAN TR020-MAX-ITEMS))                     
204400         IF  TR020-ACTION-SW (TR020-IDX) > SPACE                          
204500              PERFORM 6110-PROCESS-ITEMS                                  
204600         END-IF                                                           
204700         ADD +1                TO PV-ITEMS-PROCESSED                      
204800     END-PERFORM.                                                         
204900     PERFORM 6111-WRITE-LIST-QUEUE.                                       
205000*----------------------------------------------------------------*        
205100*    READ THE LIST QUEUE RECORD.                                 *        
205200*----------------------------------------------------------------*        
205300                                                                          
205400 6105-READ-SEL-QUEUE.                                                     
205500                                                                          
205600     EXEC CICS                                                            
205700          READQ TS                                                        
205800              QUEUE (ASC-SEL-QUEUE-NAME)                                  
205900              INTO  (TR020-COUNTRY-SEL-REC)                               
206000              ITEM  (PV-SEL-QUEUE-ITEM)                                   
206100              RESP  (PV-CICS-RESP)                                        
206200     END-EXEC.                                                            
206300*                                                                         
206400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
206500         CONTINUE                                                         
206600     ELSE                                                                 
206700         SET DP013-CICS-ABEND      TO  TRUE                               
206800         SET DP013-NO-ROLLBACK     TO  TRUE                               
206900         MOVE '6105-READ-SEL-QUEUE'                                       
207000                                   TO  DP013-PARAGRAPH                    
207100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'                   
207200                                   TO  DP013-MESSAGE-TEXT(1)              
207300         PERFORM DP013-0000-PROCESS-ABEND                                 
207400     END-IF.                                                              
207500 EJECT                                                                    
207600*----------------------------------------------------------------*        
207700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*        
207800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*        
207900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *        
208000*----------------------------------------------------------------*        
208100                                                                          
208200 6110-PROCESS-ITEMS.                                                      
208300                                                                          
208400     COMPUTE PV-ITEM = 1 + ((TR020-ITEM (TR020-IDX) - 1)                  
208500                     / PC-ITEMS-PER-PANEL).                               
208600                                                                          
208700     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                                   
208800         IF  PV-SAVE-ITEM NOT EQUAL ZERO                                  
208900             PERFORM 6111-WRITE-LIST-QUEUE                                
209000         END-IF                                                           
209100         MOVE PV-ITEM          TO PV-SAVE-ITEM                            
209200                                                                          
209300         PERFORM 6112-READ-LIST-QUEUE                                     
209400         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                       
209500             CONTINUE                                                     
209600         END-IF                                                           
209700     END-IF.                                                              
209800                                                                          
209900     COMPUTE PV-SUB = (TR020-ITEM (TR020-IDX)                             
210000                    - LQW-LIST-ITEM-NUMBER (1)) + 1.                      
210100     SET LQW-DESELECT (PV-SUB) TO    TRUE                                 
210200     MOVE LQW-SELECTED-SW (PV-SUB)                                        
210300                               TO LQW-TEMP-SELECTED-SW (PV-SUB).          
210400     EVALUATE TRUE                                                        
210500         WHEN TR020-INQ (TR020-IDX)                                       
210600              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)                     
210700                                                                          
210800         WHEN TR020-UPD (TR020-IDX)                                       
210900              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)                     
210910*             MOVE TR019-COUNTRY-CODE-DESC                                
210911*                              TO LQW-COUNTRY-DESC (PV-SUB)               
211000                                                                          
211100         WHEN TR020-DEL (TR020-IDX)                                       
211200              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)                     
211210*             MOVE SPACE       TO LQW-ACTION (PV-SUB)                     
211300                                                                          
211400         WHEN TR020-ERR (TR020-IDX)                                       
211500              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)                     
211600     END-EVALUATE.                                                        
211700                                                                          
211710     IF ASC-NUMBER-OF-SELECTED-ITEMS = 0                                  
211720         CONTINUE                                                         
211730     ELSE                                                                 
211800         SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS                     
211900     END-IF.                                                              
212000*----------------------------------------------------------------*        
212100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *        
212200*----------------------------------------------------------------*        
212300                                                                          
212400 6111-WRITE-LIST-QUEUE.                                                   
212500                                                                          
212600     EXEC CICS                                                            
212700         WRITEQ TS                                                        
212800             QUEUE (ASC-LIST-QUEUE-NAME)                                  
212900             FROM  (LQW-LIST-QUEUE-WORK-AREA)                             
213000             ITEM  (PV-SAVE-ITEM)                                         
213100             REWRITE                                                      
213200             RESP  (PV-CICS-RESP)                                         
213300     END-EXEC.                                                            
213400*                                                                         
213500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
213600         CONTINUE                                                         
213700     ELSE                                                                 
213800         SET DP013-CICS-ABEND  TO  TRUE                                   
213900         SET DP013-NO-ROLLBACK TO  TRUE                                   
214000         MOVE '6111-WRITE-LIST-QUEUE'                                     
214100                               TO  DP013-PARAGRAPH                        
214200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                          
214300                               TO  DP013-MESSAGE-TEXT(1)                  
214400         PERFORM DP013-0000-PROCESS-ABEND                                 
214500     END-IF.                                                              
214600                                                                          
214700 EJECT                                                                    
214800*----------------------------------------------------------------*        
214900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*        
215000*----------------------------------------------------------------*        
215100                                                                          
215200 6112-READ-LIST-QUEUE.                                                    
215300                                                                          
215400     EXEC CICS                                                            
215500         READQ TS                                                         
215600             QUEUE (ASC-LIST-QUEUE-NAME)                                  
215700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                             
215800             ITEM  (PV-ITEM)                                              
215900             RESP  (PV-CICS-RESP)                                         
216000     END-EXEC.                                                            
216100*                                                                         
216200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
216300         CONTINUE                                                         
216400     ELSE                                                                 
216500         SET DP013-CICS-ABEND        TO TRUE                              
216600         SET DP013-NO-ROLLBACK       TO TRUE                              
216700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH                   
216800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                            
216900                                     TO DP013-MESSAGE-TEXT(1)             
217000         PERFORM DP013-0000-PROCESS-ABEND                                 
217100     END-IF.                                                              
217200                                                                          
217300 EJECT                                                                    
217400*----------------------------------------------------------------*        
217500*    ABEND PROCESSOR MODULE                                      *        
217600*----------------------------------------------------------------*        
217700                                                                          
217800     COPY DPPD013.                                                        
