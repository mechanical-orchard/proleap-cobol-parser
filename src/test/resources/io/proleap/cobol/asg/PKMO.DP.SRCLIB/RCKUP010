000100******************************************************************00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300******************************************************************00030002
000400                                                                  00040002
000500 PROGRAM-ID.             RCKUP010.                                00050002
000600 AUTHOR.                 LYNN MCADAMS.                            00060002
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070002
000800 DATE-WRITTEN            MAY, 2005.                               00080002
000900 DATE-COMPILED.                                                   00090002
001000                                                                  00100002
001100*----------------------------------------------------------------*00110002
001200* THIS PROGRAM WILL TAKE THE RECORDS ON THE PO "NOT ON FILE"     *00120002
001300* FILE AND DETERMINE IF THEY CAN BE SENT TO BE PROCESSED         *00130002
001400* AGAIN, OR IF THEY ARE X NUMBER OF DAYS OLD, THEN WRITTEN       *00140002
001500* TO THE DEAD RECORD FILE.                                       *00150002
001600*                                                                *00160002
001700* THIS PROGRAM CREATES 4 OUTPUT FILES:                           *00170002
001800* THE FIRST OUTPUT FILE IS THE WRAP PO NOF FILE, WHICH WILL      *00180002
001900* CONTAIN THE RECORDS THAT ARE NOT OLD ENOUGH TO HIT THE         *00190002
002000* "DEAD RECORD" FILE OR THE "READY TO BE PROCESSED" FILE.        *00200002
002100*                                                                *00210002
002200* THE SECOND OUTPUT FILE IS THE DEAD RECORD FILE, WHICH WILL     *00220002
002300* CONTAIN ALL THE RECORDS THAT ARE X NUMBER OF DAYS OLD BASED    *00230002
002400* ON THE PARM VALUE FROM TKRPRPM.  DATA WRITTEN TO THIS FILE     *00240002
002500* WILL TRIGGER A RETURN CODE TO BE SENT FROM THIS PROGRAM WHICH  *00250002
002600* WILL TRIGGER A STEP LATER IN THE JOB TO SEND AN EMAIL TO THE   *00260002
002700* SUPPORT TEAM FOR FURTHER RESEARCH.                             *00270002
002800*                                                                *00280002
002900* THE THIRD OUTPUT FILE IS THE READY FILE, WHICH WILL CONTAIN    *00290002
003000* THE PO THAT WAS ON THE PO NOF FILE IS NOW IN THE SYSTEM AND    *00300002
003100* IS READY TO BE PROCESSED.                                      *00310002
003200*                                                                *00320002
003300* THE FILE LAYOUT FOR INPUT AND OUTPUT FILES IS RCRD074.         *00330002
003400*----------------------------------------------------------------*00340002
003500******************************************************************00350002
003600* 03/09/2010 DONALD TEGELER WR#38216                              00360002
003601*      IN PARAGRAPH 2700-CHECK-INV-IN-PROCESS:                    00360102
003602*           -ADDED CALL TO NEW PARAGRAPH 5400-CALL-XLKUT071.      00360202
003603*           -CHANGED THE CONDITION TO CHECK THE E-BUSINESS        00360302
003604*            INDICATOR='Y' THE TYPE='DS'                          00360402
003605*            IF RC074-STR-NBR = 873                               00360502
003606*            TO                                                   00360602
003607*            IF XL071-E-BUS-IND = Y                               00360702
003608*            AND XL071-LOC-TYP-CDE = DS                           00360802
003609*      ADDED NEW PARAGRAPH 5400-CALL-XLKUT071.                    00360902
003610*           -USED RC074-STR-NBR OF DIRECT SHIP QUE                00361002
003620*            TO FILL CALLING PARAMETER                            00362002
003630*            (MOVE RC074-STR-NBR TO XL071-LOCATION-NUMBER)        00363002
003640******************************************************************00364002
003650 ENVIRONMENT DIVISION.                                            00365002
003660                                                                  00366002
003670 INPUT-OUTPUT SECTION.                                            00367002
003680 FILE-CONTROL.                                                    00368002
003690                                                                  00369002
003700     SELECT INPUT-FILE ASSIGN TO INP01.                           00370002
003800                                                                  00380002
003900     SELECT EXTRACT-WRAP-FILE             ASSIGN TO OUT01.        00390002
004000                                                                  00400002
004100     SELECT EXTRACT-DEAD-FILE             ASSIGN TO OUT02.        00410002
004200                                                                  00420002
004300     SELECT EXTRACT-READY-FILE            ASSIGN TO OUT03.        00430002
004400                                                                  00440002
004500***************************************************************** 00450002
004600 DATA DIVISION.                                                   00460002
004700 FILE SECTION.                                                    00470002
004800*                                                                 00480002
004900 FD  INPUT-FILE                                                   00490002
005000     RECORDING MODE IS F                                          00500002
005100     LABEL RECORDS ARE STANDARD                                   00510002
005200     BLOCK CONTAINS 0 RECORDS.                                    00520002
005300 01  INPUT-RECORD                   PIC X(100).                   00530002
005400                                                                  00540002
005500 FD  EXTRACT-WRAP-FILE                                            00550002
005600     RECORDING MODE IS F                                          00560002
005700     LABEL RECORDS ARE STANDARD                                   00570002
005800     BLOCK CONTAINS 0 RECORDS.                                    00580002
005900 01  EXTRACT-WRAP-RECORD            PIC X(100).                   00590002
006000                                                                  00600002
006100 FD  EXTRACT-DEAD-FILE                                            00610002
006200     RECORDING MODE IS F                                          00620002
006300     LABEL RECORDS ARE STANDARD                                   00630002
006400     BLOCK CONTAINS 0 RECORDS.                                    00640002
006500 01  EXTRACT-DEAD-RECORD            PIC X(100).                   00650002
006600*                                                                 00660002
006700 FD  EXTRACT-READY-FILE                                           00670002
006800     RECORDING MODE IS F                                          00680002
006900     LABEL RECORDS ARE STANDARD                                   00690002
007000     BLOCK CONTAINS 0 RECORDS.                                    00700002
007100 01  EXTRACT-READY-RECORD           PIC X(100).                   00710002
007200*                                                                 00720002
007300***************************************************************** 00730002
007400 WORKING-STORAGE SECTION.                                         00740002
007500                                                                  00750002
007600 01  PS-PROGRAM-SWITCHES.                                         00760002
007700     05  PS-END-OF-INPUT-FILE-SW      PIC X(01)  VALUE 'N'.       00770002
007800         88  PS-END-OF-INPUT-FILE                VALUE 'Y'.       00780002
007900         88  PS-NOT-END-OF-INPUT-FILE            VALUE 'N'.       00790002
008000     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00800002
008100         88  PS-ERROR-YES                        VALUE 'Y'.       00810002
008200         88  PS-ERROR-NO                         VALUE 'N'.       00820002
008300     05  PS-DC-FLUSH-SW               PIC X(01)  VALUE 'N'.       00830002
008400         88  PS-DC-FLUSH-YES                     VALUE 'Y'.       00840002
008500         88  PS-DC-FLUSH-NO                      VALUE 'N'.       00850002
008600                                                                  00860002
008700 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       00870002
008800                                                 COMP SYNC.       00880002
008900     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     00890002
009000                                                                  00900002
009100 01  PV-PROGRAM-VARIABLES.                                        00910002
009200     05  PV-READ-COUNT                PIC S9(09) VALUE ZERO       00920002
009300                                                  COMP SYNC.      00930002
009400     05  PV-WRITE-WRAP-EXTR-COUNT     PIC S9(09) VALUE ZERO       00940002
009500                                                  COMP SYNC.      00950002
009600     05  PV-WRITE-DEAD-EXTR-COUNT     PIC S9(09) VALUE ZERO       00960002
009700                                                  COMP SYNC.      00970002
009800     05  PV-WRITE-READY-EXTR-COUNT    PIC S9(09) VALUE ZERO       00980002
009900                                                  COMP SYNC.      00990002
010000                                                                  01000002
010100     05  PV-XL071-OK                  PIC S9(09) VALUE ZERO       01010002
010200                                                  COMP SYNC.      01020002
010300                                                                  01030002
010400     05  PV-DISPLAY-READ-CNT          PIC ZZZ,ZZZ,ZZ9.            01040002
010500     05  PV-DISPLAY-WRITE-WRAP-CNT    PIC ZZZ,ZZZ,ZZ9.            01050002
010600     05  PV-DISPLAY-WRITE-DEAD-CNT    PIC ZZZ,ZZZ,ZZ9.            01060002
010700     05  PV-DISPLAY-WRITE-READY-CNT   PIC ZZZ,ZZZ,ZZ9.            01070002
010800                                                                  01080002
010900     05  PV-DISPLAY-PO-NBR             PIC 9(09).                 01090002
011000     05  PV-DISPLAY-SKU-NBR            PIC 9(09).                 01100002
011100     05  PV-DISPLAY-STR-NBR            PIC 9(09).                 01110002
011200     05  PV-DISPLAY-SQLCODE            PIC -9(09).                01120002
011300                                                                  01130002
011400     05  PV-DB2-COUNT                 PIC S9(9) VALUE +0          01140002
011500                                                COMP-3.           01150002
011600                                                                  01160002
011700     05  PV-DIR-SHP-AGE-TMST          PIC X(26)  VALUE SPACES.    01170002
011800                                                                  01180002
011900     05  PV-WORK-DATE-PLUS-7        PIC  X(10)  VALUE ZEROS.      01190002
012000                                                                  01200002
012100     05  PV-DB2-FUNCTION              PIC X(30)  VALUE SPACES.    01210002
012200     05  PV-DB2-TABLE-NAME1           PIC X(08)  VALUE SPACES.    01220002
012300     05  PV-DB2-TABLE-NAME2           PIC X(08)  VALUE SPACES.    01230002
012400     05  PV-DB2-TABLE-NAME3           PIC X(08)  VALUE SPACES.    01240002
012500                                                                  01250002
012600 01  DK-DB-KEYS.                                                  01260002
012700     05  DK-PO-NBR                   PIC  S9(9) COMP.             01270002
012800     05  DK-SKU-NBR                  PIC  S9(8)V COMP-3.          01280002
012900     05  DK-STR-NBR                  PIC  S9(4) COMP.             01290002
013000                                                                  01300002
013100 01 PC-PROGRAM-CONSTANTS.                                         01310002
013200     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'RCKUP010'. 01320002
013300                                                                  01330002
013400     05  PC-Y                         PIC  X     VALUE 'Y'.       01340002
013500     05  PC-ES                        PIC  X(02) VALUE 'ES'.      01350002
013510                                                                  01351002
013520 01  PV-ABEND-FIELDS.                                             01352002
013530     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01353002
013540                                                 COMP SYNC.       01354002
013550     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'RCKUP010'.01355002
013560     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01356002
013570     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01357002
013580     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01358002
013590     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    01359002
013600     05  PV-SQL-RETURN-CD             PIC  999-.                  01360002
013700     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01370002
013800     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01380002
013900     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01390002
014000     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01400002
014100                                                                  01410002
014200     05  PV-DAYS-QTY                  PIC  S9(9) COMP.            01420002
014300                                                                  01430002
014400******************************************************************01440002
014500*  USED FOR DB2 ERROR MESSAGE BUILDING                            01450002
014600******************************************************************01460002
014700     COPY DPWS004.                                                01470002
014800                                                                  01480002
014900*----------------------------------------------------------------*01490002
015000*    ABEND PROCESSING COPYBOOK.                                  *01500002
015100*----------------------------------------------------------------*01510002
015200                                                                  01520002
015300     COPY DPWS013.                                                01530002
015400******************************************************************01540002
015500*   DB2 SQL COMMUNICATION AREA                                    01550002
015600******************************************************************01560002
015700     EXEC SQL                                                     01570002
015800          INCLUDE SQLCA                                           01580002
015900     END-EXEC.                                                    01590002
016000                                                                  01600002
016100*DB2 AREA FOR COMMUNICATIONS AREA2                                01610002
016200     COPY SQLCA2.                                                 01620002
016300                                                                  01630002
016400******************************************************************01640002
016500*   DB2 DCLGEN FOR TKRPRPM - RC - KOHLS TO RETEK PROCESSING       01650002
016600*   PARAMETERS TABLE                                              01660002
016700******************************************************************01670002
016800     EXEC SQL                                                     01680002
016900          INCLUDE TKRPRPM                                         01690002
017000     END-EXEC.                                                    01700002
017100                                                                  01710002
017200******************************************************************01720002
017300*   DB2 DCLGEN FOR TPURCHS - PO PURCHASE TABLE                    01730002
017400******************************************************************01740002
017500     EXEC SQL                                                     01750002
017600          INCLUDE TPURCHS                                         01760002
017700     END-EXEC.                                                    01770002
017800                                                                  01780002
017900******************************************************************01790002
018000*   DB2 DCLGEN FOR TPURITM - PO PURCHASE ITEM TABLE               01800002
018100******************************************************************01810002
018200     EXEC SQL                                                     01820002
018300          INCLUDE TPURITM                                         01830002
018400     END-EXEC.                                                    01840002
018500                                                                  01850002
018600******************************************************************01860002
018700*   DB2 DCLGEN FOR XLT_SKU - LOGISTICS-SKU TABLE                  01870002
018800******************************************************************01880002
018900     EXEC SQL                                                     01890002
019000          INCLUDE XLT00003                                        01900002
019100     END-EXEC.                                                    01910002
019200                                                                  01920002
019300*---------------------------------------------------------------* 01930002
019400*    DB2 AREA FOR XLT_MDSE_INV_PARM-INVENTORY PARAMENTERS TABLE * 01940002
019500*---------------------------------------------------------------* 01950002
019600     EXEC SQL                                                     01960002
019700          INCLUDE XLT00025                                        01970002
019800     END-EXEC.                                                    01980002
019900                                                                  01990002
019910*---------------------------------------------------------------* 01991004
019920*    DB2 AREA FOR TALLPLN - ALLOCATION TABLE                      01992004
019930*---------------------------------------------------------------* 01993004
019940     EXEC SQL                                                     01994004
019950          INCLUDE TALLPLN                                         01995004
019960     END-EXEC.                                                    01996004
019970                                                                  01997004
019980*---------------------------------------------------------------* 01998004
019990*    DB2 AREA FOR TMESTDS - STORE DISTO TABLE                     01999004
019991*---------------------------------------------------------------* 01999104
019992     EXEC SQL                                                     01999204
019993          INCLUDE TMESTDS                                         01999304
019994     END-EXEC.                                                    01999404
019995                                                                  01999504
020000***********************************************************       02000002
020100*  RECORD LAYOUT - DIRECT SHIP                                    02010002
020200***********************************************************       02020002
020300*INPUT FILE LAYOUT                                                02030002
020400*OUTPUT FILE LAYOUT                                               02040002
020500     COPY RCRD074.                                                02050002
020600                                                                  02060002
020700***********************************************************       02070002
020800*  XL071 COMMAREA REC                                             02080002
020900***********************************************************       02090002
021000*COMMAREA LAYOUT                                                  02100002
021100     COPY XLWS071.                                                02110002
021200                                                                  02120002
021300***********************************************************       02130002
021400 PROCEDURE DIVISION.                                              02140002
021500***********************************************************       02150002
021600     DISPLAY '***BEGINNING RCKUP010***'.                          02160002
021700                                                                  02170002
021800     PERFORM 1000-INITIALIZE.                                     02180002
021900                                                                  02190002
022000     PERFORM 2000-PROCESS-EXTRACTS                                02200002
022100         UNTIL PS-END-OF-INPUT-FILE.                              02210002
022200                                                                  02220002
022300     PERFORM 9000-CLOSE-FILES.                                    02230002
022400                                                                  02240002
022500     IF PV-WRITE-DEAD-EXTR-COUNT > 0                              02250002
022600        MOVE 1 TO RETURN-CODE                                     02260002
022700     END-IF.                                                      02270002
022800     GOBACK.                                                      02280002
022900                                                                  02290002
023000******************************************************************02300002
023100*  DO FIRST TIME PROGRAM INITIALIZE TASKS.                        02310002
023200 1000-INITIALIZE.                                                 02320002
023300******************************************************************02330002
023400                                                                  02340002
023500     OPEN INPUT  INPUT-FILE                                       02350002
023600          OUTPUT EXTRACT-WRAP-FILE                                02360002
023700                 EXTRACT-DEAD-FILE                                02370002
023800                 EXTRACT-READY-FILE.                              02380002
023900                                                                  02390002
024000     INITIALIZE RC074-ITEM-REC.                                   02400002
024100                                                                  02410002
024200*FIRST READ                                                       02420002
024300     PERFORM 7000-READ-INPUT-FILE.                                02430002
024400                                                                  02440002
024500     IF PS-END-OF-INPUT-FILE                                      02450002
024600         DISPLAY '** FILE IS EMPTY **'                            02460002
024700     ELSE                                                         02470002
024800         PERFORM 1100-SELECT-TKRPRPM                              02480002
024900     END-IF.                                                      02490002
025000                                                                  02500002
025100                                                                  02510002
025200***************************************************************** 02520002
025300 1100-SELECT-TKRPRPM.                                             02530002
025400**   GET NUMBER OF DAYS OLD PARM                                  02540002
025500***************************************************************** 02550002
025600                                                                  02560002
025700     EXEC SQL                                                     02570002
025800         SELECT FUNC_QTY                                          02580002
025900           INTO   :PV-DAYS-QTY                                    02590002
026000           FROM   TKRPRPM                                         02600002
026100          WHERE LOC_ID           =  90                            02610002
026200            AND SYS_PRC_FUNC_CDE = 'DSAGE'                        02620002
026300     END-EXEC.                                                    02630002
026400                                                                  02640002
026500     EVALUATE TRUE                                                02650002
026600         WHEN SQLCODE = +0                                        02660002
026700              DISPLAY 'NUMBER OF DAYS OLD = ' PV-DAYS-QTY         02670002
026800         WHEN SQLCODE = +100                                      02680002
026900              CONTINUE                                            02690002
027000         WHEN SQLWARN0 NOT = SPACE                                02700002
027100         WHEN SQLCODE  NOT = +0                                   02710002
027200              MOVE '1100-SELECT-TKRPRPM'                          02720002
027300                                   TO PV-ABEND-PARAGRAPH          02730002
027400              MOVE 'ATTEMPTING TO SELECT TKRPRPM '                02740002
027500                                   TO PV-ABEND-OPERATION          02750002
027600              PERFORM Z999-SQL-ABEND                              02760002
027700     END-EVALUATE.                                                02770002
027800                                                                  02780002
027900***************************************************************** 02790002
028000 2000-PROCESS-EXTRACTS.                                           02800002
028100***************************************************************** 02810002
028200     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       02820002
028300                                                                  02830002
028400        EVALUATE TRUE                                             02840002
028500           WHEN RC074-ERROR-TYPE = '01'                           02850002
028600              PERFORM 2500-SELECT-TPURCHS                         02860002
028700              IF PS-ERROR-NO                                      02870002
028800                 PERFORM 8300-WRITE-TO-READY-FILE                 02880002
028900              END-IF                                              02890002
029000           WHEN RC074-ERROR-TYPE = '02'                           02900002
029100              PERFORM 2600-SELECT-PO-LINE                         02910002
029200              IF PS-ERROR-NO                                      02920002
029300                 PERFORM 8300-WRITE-TO-READY-FILE                 02930002
029400              END-IF                                              02940002
029410           WHEN RC074-ERROR-TYPE = '03'                           02941002
029420                PERFORM 8300-WRITE-TO-READY-FILE                  02942002
029430           WHEN RC074-ERROR-TYPE = '04'                           02943002
029440              PERFORM 2700A-CHECK-DC-FLUSH-PARM                   02944002
029450              IF PS-DC-FLUSH-YES                                  02945002
029460                  PERFORM 2700-CHECK-INV-IN-PROCESS               02946002
029470                  IF PS-ERROR-NO                                  02947002
029480                     PERFORM 8300-WRITE-TO-READY-FILE             02948002
029490                  END-IF                                          02949002
029500              END-IF                                              02950002
029510           WHEN RC074-ERROR-TYPE = '06'                           02951003
029520              PERFORM 2800-CHECK-DC-SPLIT                         02952003
029521              IF PS-ERROR-NO                                      02952103
029522                 PERFORM 8300-WRITE-TO-READY-FILE                 02952203
029523              END-IF                                              02952303
029524           WHEN RC074-ERROR-TYPE = '07'                           02952403
029525              PERFORM 2900-CHECK-STORE-ALLOC                      02952503
029526              IF PS-ERROR-NO                                      02952603
029527                 PERFORM 8300-WRITE-TO-READY-FILE                 02952703
029528              END-IF                                              02952803
029600           WHEN OTHER                                             02960002
029700              DISPLAY 'RC074-ERROR-TYPE = ' RC074-ERROR-TYPE      02970002
029800              MOVE 'INVALID RC074-ERROR-TYPE     '                02980002
029900                                   TO PV-ABEND-OPERATION          02990002
030000              PERFORM 9999-ABEND                                  03000002
030100        END-EVALUATE                                              03010002
030200                                                                  03020002
030300        IF PS-ERROR-YES                                           03030002
030400           PERFORM 3000-CHECK-WRAP-FILE                           03040002
030500        END-IF.                                                   03050002
030600                                                                  03060002
030700     PERFORM 7000-READ-INPUT-FILE.                                03070002
030800                                                                  03080002
030900***************************************************************** 03090002
031000 2500-SELECT-TPURCHS.                                             03100002
031100**   GET ACTIVE RECORD FOR PO.                                    03110002
031200***************************************************************** 03120002
031300                                                                  03130002
031400     MOVE RC074-PO-NUMBER      TO DK-PO-NBR.                      03140002
031500                                                                  03150002
031600     EXEC SQL                                                     03160002
031700        SELECT  PO_NBR                                            03170002
031800             ,  VER_STATUS_CDE                                    03180002
031900          INTO  :PURCHS-PO-NBR                                    03190002
032000             ,  :PURCHS-VER-STATUS-CDE                            03200002
032100          FROM  TPURCHS                                           03210002
032200         WHERE  PO_NBR           = :DK-PO-NBR                     03220002
032300           AND  VER_STATUS_CDE   = 'A'                            03230002
032400     END-EXEC.                                                    03240002
032500                                                                  03250002
032600     EVALUATE TRUE                                                03260002
032700         WHEN SQLCODE = +0                                        03270002
032800              SET PS-ERROR-NO    TO TRUE                          03280002
032900         WHEN SQLCODE = +100                                      03290002
033000              SET PS-ERROR-YES   TO TRUE                          03300002
033100         WHEN SQLWARN0 NOT = SPACE                                03310002
033200         WHEN SQLCODE  NOT = +0                                   03320002
033300              MOVE '2500-SELECT-TPURCHS'                          03330002
033400                                   TO PV-ABEND-PARAGRAPH          03340002
033500              MOVE 'ATTEMPTING TO SELECT TPURCHS '                03350002
033600                                   TO PV-ABEND-OPERATION          03360002
033700              MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR           03370002
033800              PERFORM Z999-SQL-ABEND                              03380002
033900     END-EVALUATE.                                                03390002
034000                                                                  03400002
034100***************************************************************** 03410002
034200 2600-SELECT-PO-LINE.                                             03420002
034300**   GET ACTIVE RECORD FOR PO/LINE.                               03430002
034400***************************************************************** 03440002
034500     MOVE RC074-PO-NUMBER      TO DK-PO-NBR.                      03450002
034600     MOVE RC074-SKU            TO DK-SKU-NBR.                     03460002
034700                                                                  03470002
034800     EXEC SQL                                                     03480002
034900        SELECT  A.APP_PO_LNE_NBR                                  03490002
035000           ,    A.VER_NBR                                         03500002
035100           ,    A.ITM_NBR                                         03510002
035200           ,    A.PIC_ITM_IND                                     03520002
035300           ,    A.PO_LNE_NBR                                      03530002
035400           ,    A.VEND_STYL_NAME                                  03540002
035500           ,    A.SKU_SEQ_NBR                                     03550002
035600           ,    A.UNT_RTL_PR_AMT                                  03560002
035700           ,    A.UNT_COST_AMT                                    03570002
035800           ,    A.GP_RTL_AMT                                      03580002
035900           ,    A.GP_QTY                                          03590002
036000          INTO :PURITM-APP-PO-LNE-NBR                             03600002
036100           ,    :PURITM-VER-NBR                                   03610002
036200           ,    :PURITM-ITM-NBR                                   03620002
036300           ,    :PURITM-PIC-ITM-IND                               03630002
036400           ,    :PURITM-PO-LNE-NBR                                03640002
036500           ,    :PURITM-VEND-STYL-NAME                            03650002
036600           ,    :PURITM-SKU-SEQ-NBR                               03660002
036700           ,    :PURITM-UNT-RTL-PR-AMT                            03670002
036800           ,    :PURITM-UNT-COST-AMT                              03680002
036900           ,    :PURITM-GP-RTL-AMT                                03690002
037000           ,    :PURITM-GP-QTY                                    03700002
037100          FROM TPURITM A                                          03710002
037200            ,  XLT_SKU B                                          03720002
037300          WHERE A.PO_NBR          = :DK-PO-NBR                    03730002
037400            AND A.ITM_NBR         = B.ITM_NBR                     03740002
037500            AND A.VER_STATUS_CDE  = 'A'                           03750002
037600            AND B.SKU_NBR         = :DK-SKU-NBR                   03760002
037700     END-EXEC.                                                    03770002
037800                                                                  03780002
037900     EVALUATE TRUE                                                03790002
038000         WHEN SQLCODE = +0                                        03800002
038100              SET PS-ERROR-NO     TO TRUE                         03810002
038200         WHEN SQLCODE = +100                                      03820002
038300              SET PS-ERROR-YES    TO TRUE                         03830002
038400         WHEN SQLWARN0 NOT = SPACES                               03840002
038500         WHEN SQLCODE < +0                                        03850002
038600         WHEN SQLCODE > +0                                        03860002
038700              MOVE '2600-SELECT-PO-LINE'                          03870002
038800                              TO PV-ABEND-PARAGRAPH               03880002
038900              MOVE 'ATTEMPTING TO SELECT TPURITM,XLT_SKU '        03890002
039000                                   TO PV-ABEND-OPERATION          03900002
039100              MOVE DK-PO-NBR   TO PV-DISPLAY-PO-NBR               03910002
039200              MOVE DK-SKU-NBR  TO PV-DISPLAY-SKU-NBR              03920002
039300              PERFORM Z999-SQL-ABEND                              03930002
039400     END-EVALUATE.                                                03940002
039500                                                                  03950002
039600*---------------------------------------------------------------* 03960002
039700* CHECK TO SEE IF DC IS FLUSHING THEIR BUILDING.                  03970002
039800*---------------------------------------------------------------* 03980002
039900 2700A-CHECK-DC-FLUSH-PARM.                                       03990002
040000                                                                  04000002
040100     EXEC SQL                                                     04010002
040200          SELECT  FUNC_TXT                                        04020002
040300          INTO   :KRPRPM-FUNC-TXT                                 04030002
040400          FROM  TKRPRPM                                           04040002
040500          WHERE LOC_ID            =  90                           04050002
040600            AND SYS_PRC_FUNC_CDE  =  'FLUSH'                      04060002
040700            AND FUNC_PRC_STAT_CDE =  'AC'                         04070002
040800     END-EXEC.                                                    04080002
040900                                                                  04090002
041000     EVALUATE TRUE                                                04100002
041100         WHEN SQLCODE = +0                                        04110002
041200            IF KRPRPM-FUNC-TXT = 'N'                              04120002
041300                SET PS-DC-FLUSH-NO  TO TRUE                       04130002
041400            ELSE                                                  04140002
041500                SET PS-DC-FLUSH-YES TO TRUE                       04150002
041600            END-IF                                                04160002
041700         WHEN OTHER                                               04170002
041800                SET PS-DC-FLUSH-NO  TO TRUE                       04180002
041900     END-EVALUATE.                                                04190002
042000                                                                  04200002
042100                                                                  04210002
042200*---------------------------------------------------------------* 04220002
042300* CHECK TO SEE IF STORE IS IN INVENTORY CYCLE                     04230002
042400*---------------------------------------------------------------* 04240002
042500 2700-CHECK-INV-IN-PROCESS.                                       04250002
042600                                                                  04260002
042700     PERFORM 5400-CALL-XLKUT071.                                  04270002
042800                                                                  04280002
042900     MOVE RC074-STR-NBR      TO DK-STR-NBR                        04290002
043000                                                                  04300002
043100     EXEC SQL                                                     04310002
043200          SELECT                                                  04320002
043300                 A.DC_CTOFF_DTE                                   04330002
043400             ,   (A.DC_CTOFF_DTE + 7 DAYS)                        04340002
043500          INTO                                                    04350002
043600                 :XLT00025-DC-CTOFF-DTE                           04360002
043700             ,   :PV-WORK-DATE-PLUS-7                             04370002
043800          FROM                                                    04380002
043900                XLT_MDSE_INV_PARM A                               04390002
044000          WHERE A.LOC_NBR           =  :DK-STR-NBR                04400002
044100           AND  A.DC_CTOFF_DTE >= (CURRENT_DATE - 7 DAYS)         04410002
044200           AND  A.DC_CTOFF_DTE <= (CURRENT_DATE + 7 DAYS)         04420002
044300           AND  A.ACTV_IND         = 'Y'                          04430002
044400           AND  A.LOC_INV_STAT_CDE = 'IN'                         04440002
044500     END-EXEC.                                                    04450002
044600                                                                  04460002
044700     EVALUATE TRUE                                                04470002
044800         WHEN SQLCODE = +0                                        04480002
044900                                                                  04490002
045000             IF  XL071-E-BUS-IND = PC-Y                           04500002
045100             AND XL071-LOC-TYP-CDE = 'DS'                         04510002
045200                                                                  04520002
045300                SET RC074-STORE-INV-CYCLE                         04530002
045400                    PS-ERROR-YES    TO TRUE                       04540002
045401             ELSE                                                 04540102
045402                CONTINUE                                          04540202
045403             END-IF                                               04540302
045404         WHEN SQLCODE = +100                                      04540402
045405             CONTINUE                                             04540502
045406         WHEN SQLWARN0 NOT = SPACES                               04540602
045407         WHEN SQLCODE < +0                                        04540702
045408         WHEN SQLCODE > +0                                        04540802
045409             MOVE RC074-STR-NBR  TO PV-DISPLAY-STR-NBR            04540902
045410             MOVE SQLCODE     TO PV-DISPLAY-SQLCODE               04541002
045420             MOVE '2700-CHECK-INV-IN-PROCESS'                     04542002
045421                              TO RC074-ERROR-PARA-NAME            04542102
045422             SET RC074-DB-ERROR                                   04542202
045423                 PS-ERROR-YES    TO TRUE                          04542302
045424             DISPLAY '******************************************' 04542402
045425             DISPLAY '*ABEND                                   *' 04542502
045426             DISPLAY '*PROGRAM   = RCKUP010                    *' 04542602
045427             DISPLAY '*DB2 OPER  = SELECT ON XLT_MDSE_INV_PARM *' 04542702
045428             DISPLAY '*PARAGRAPH = 2700-CHECK-INV-IN-PROCESS   *' 04542802
045429             DISPLAY '*SQLCODE = ' PV-DISPLAY-SQLCODE             04542902
045430             DISPLAY '*STORE = ' PV-DISPLAY-STR-NBR               04543002
045431             DISPLAY '******************************************' 04543102
045432     END-EVALUATE.                                                04543202
045433***************************************************************** 04543303
045434 2800-CHECK-DC-SPLIT.                                             04543403
045436***************************************************************** 04543603
045437     MOVE RC074-PO-NUMBER      TO DK-PO-NBR.                      04543703
045438     MOVE RC074-STR-NBR        TO ALLPLN-DEST-NBR.                04543803
045439     MOVE RC074-PO-LNE-NBR     TO ALLPLN-PO-LNE-NBR.              04543903
045440                                                                  04544003
045441     EXEC SQL                                                     04544103
045450          SELECT  A.PO_NBR                                        04545003
045460            INTO :ALLPLN-PO-NBR                                   04546003
045461            FROM  TALLPLN A                                       04546103
045462           WHERE  A.PO_NBR          =  :DK-PO-NBR                 04546203
045463             AND  A.PO_LNE_NBR      =  :ALLPLN-PO-LNE-NBR         04546303
045464             AND  A.DEST_NBR        =  :ALLPLN-DEST-NBR           04546403
045465             AND  A.STATUS_CDE      = 'AC'                        04546503
045466          WITH UR                                                 04546603
045469     END-EXEC.                                                    04546903
045470                                                                  04547003
045471     EVALUATE TRUE                                                04547103
045472         WHEN SQLCODE = +0                                        04547203
045473              SET PS-ERROR-NO     TO TRUE                         04547303
045474         WHEN SQLCODE = +100                                      04547403
045475              SET PS-ERROR-YES    TO TRUE                         04547503
045476         WHEN SQLWARN0 NOT = SPACES                               04547603
045477         WHEN SQLCODE < +0                                        04547703
045478         WHEN SQLCODE > +0                                        04547803
045479              MOVE '2800-CHECK-DC-SPLIT '                         04547903
045480                              TO PV-ABEND-PARAGRAPH               04548003
045481              MOVE 'ATTEMPTING TO SELECT TALLPLN'                 04548103
045482                                   TO PV-ABEND-OPERATION          04548203
045483              MOVE DK-PO-NBR   TO PV-DISPLAY-PO-NBR               04548303
045484              MOVE DK-SKU-NBR  TO PV-DISPLAY-SKU-NBR              04548403
045485              PERFORM Z999-SQL-ABEND                              04548503
045486     END-EVALUATE.                                                04548603
045487                                                                  04548703
045488                                                                  04548802
045489***************************************************************** 04548903
045490 2900-CHECK-STORE-ALLOC.                                          04549003
045491***************************************************************** 04549103
045492     MOVE RC074-PO-NUMBER      TO DK-PO-NBR.                      04549203
045493     MOVE RC074-STR-NBR        TO ALLPLN-DEST-NBR.                04549303
045494     MOVE RC074-PO-LNE-NBR     TO ALLPLN-PO-LNE-NBR.              04549403
045495                                                                  04549503
045496     EXEC SQL                                                     04549603
045497          SELECT  STR_NBR                                         04549705
045498            INTO :MESTDS-STR-NBR                                  04549805
045499            FROM  TALLPLN A                                       04549903
045500                 ,TMESTDS B                                       04550003
045501           WHERE  A.PO_NBR          =  :DK-PO-NBR                 04550103
045502             AND  A.PO_NBR          =  B.PO_NBR                   04550203
045503             AND  A.DEST_NBR        =  :ALLPLN-DEST-NBR           04550303
045504             AND  A.STATUS_CDE      = 'AC'                        04550403
045505             AND  A.PO_LNE_NBR      =  :ALLPLN-PO-LNE-NBR         04550503
045506             AND  A.PO_LNE_NBR      =  B.PO_LNE_NBR               04550603
045507             AND  A.DEST_NBR        =  B.STR_NBR                  04550703
045508             AND  A.PLAN_NBR        =  B.PLAN_NBR                 04550803
045509          WITH UR                                                 04550903
045510     END-EXEC.                                                    04551003
045511                                                                  04551103
045512     EVALUATE TRUE                                                04551203
045513         WHEN SQLCODE = +0                                        04551303
045514              SET PS-ERROR-NO     TO TRUE                         04551403
045515         WHEN SQLCODE = +100                                      04551503
045516              SET PS-ERROR-YES    TO TRUE                         04551603
045517         WHEN SQLWARN0 NOT = SPACES                               04551703
045518         WHEN SQLCODE < +0                                        04551803
045519         WHEN SQLCODE > +0                                        04551903
045520              MOVE '2800-CHECK-DC-SPLIT '                         04552003
045521                              TO PV-ABEND-PARAGRAPH               04552103
045522              MOVE 'ATTEMPTING TO SELECT TALLPLN'                 04552203
045523                                   TO PV-ABEND-OPERATION          04552303
045524              MOVE DK-PO-NBR   TO PV-DISPLAY-PO-NBR               04552403
045525              MOVE DK-SKU-NBR  TO PV-DISPLAY-SKU-NBR              04552503
045526              PERFORM Z999-SQL-ABEND                              04552603
045527     END-EVALUATE.                                                04552703
045528                                                                  04552803
045529                                                                  04552903
045530***************************************************************** 04553003
045531 3000-CHECK-WRAP-FILE.                                            04553103
045532**   COMPARE DATE ON WRAP FILE WITH DATE ON TKRPRPM               04553203
045533***************************************************************** 04553303
045534                                                                  04553403
045535     EXEC SQL                                                     04553503
045536        SET :PV-DIR-SHP-AGE-TMST                                  04553603
045537                = (CURRENT TIMESTAMP - :PV-DAYS-QTY DAYS)         04553703
045538     END-EXEC.                                                    04553803
045539                                                                  04553903
045540     IF RC074-DATE-ADD-WRAP < PV-DIR-SHP-AGE-TMST(1:10)           04554003
045541        PERFORM 8200-WRITE-TO-DEAD-FILE                           04554103
045550     ELSE                                                         04555003
045600        PERFORM 8100-WRITE-TO-WRAP-FILE                           04560002
045700     END-IF.                                                      04570002
045800                                                                  04580002
045900****************************************************************  04590002
046000* CALL XLKUT071                                               *   04600002
046100****************************************************************  04610002
046200 5400-CALL-XLKUT071.                                              04620002
046300                                                                  04630002
046400     INITIALIZE XL071-COMMAREA-REC.                               04640002
046500     MOVE RC074-STR-NBR       TO XL071-LOCATION-NUMBER.           04650002
046600                                                                  04660002
046700     CALL XL071-LOCATION-MODULE USING                             04670002
046800                                XL071-COMMAREA-REC.               04680002
046900                                                                  04690002
046910     EVALUATE TRUE                                                04691002
046920         WHEN XL071-NO-ERRORS                                     04692002
046930              ADD 1  TO PV-XL071-OK                               04693002
046940         WHEN OTHER                                               04694002
046950              DISPLAY 'XL071-RETURN-CODE ----> '                  04695002
046960                       XL071-RETURN-CODE                          04696002
046970                      ' - '                                       04697002
046980                       XL071-LOCATION-NUMBER                      04698002
046990                      ' - '                                       04699002
047000                       XL071-SQLCODE                              04700002
047010                      ' - '                                       04701002
047020                       XL071-DB2-TABLE                            04702002
047021              MOVE XL071-SQLCODE TO SQLCODE                       04702102
047022              MOVE '5400-CALL-XLKUT071'                           04702202
047023                                TO PV-ABEND-PARAGRAPH             04702302
047024              MOVE 'BAD RETURN FROM XLKUT071'                     04702402
047025                            TO PV-ABEND-OPERATION                 04702502
047026              PERFORM Z999-SQL-ABEND                              04702602
047027                                                                  04702702
047028     END-EVALUATE.                                                04702802
047029                                                                  04702902
047030***************************************************************** 04703002
047031 7000-READ-INPUT-FILE.                                            04703102
047032***************************************************************** 04703202
047033      READ INPUT-FILE INTO RC074-ITEM-REC                         04703302
047034        AT END                                                    04703402
047035           SET PS-END-OF-INPUT-FILE TO TRUE                       04703502
047036        NOT AT END                                                04703602
047037           ADD +1 TO PV-READ-COUNT                                04703702
047038      END-READ.                                                   04703802
047039                                                                  04703902
047040***************************************************************** 04704002
047050 8100-WRITE-TO-WRAP-FILE.                                         04705002
047060***************************************************************** 04706002
047070     WRITE EXTRACT-WRAP-RECORD                                    04707002
047080       FROM RC074-ITEM-REC.                                       04708002
047090                                                                  04709002
047100     ADD +1 TO PV-WRITE-WRAP-EXTR-COUNT.                          04710002
047200                                                                  04720002
047300***************************************************************** 04730002
047400 8200-WRITE-TO-DEAD-FILE.                                         04740002
047500***************************************************************** 04750002
047600     WRITE EXTRACT-DEAD-RECORD                                    04760002
047700       FROM RC074-ITEM-REC.                                       04770002
047800                                                                  04780002
047900     ADD +1 TO PV-WRITE-DEAD-EXTR-COUNT.                          04790002
048000                                                                  04800002
048100***************************************************************** 04810002
048200 8300-WRITE-TO-READY-FILE.                                        04820002
048300***************************************************************** 04830002
048400     WRITE EXTRACT-READY-RECORD                                   04840002
048500       FROM RC074-ITEM-REC.                                       04850002
048600                                                                  04860002
048700     ADD +1 TO PV-WRITE-READY-EXTR-COUNT.                         04870002
048800                                                                  04880002
048900                                                                  04890002
049000***************************************************************** 04900002
049100 9000-CLOSE-FILES.                                                04910002
049200                                                                  04920002
049300     DISPLAY ' '.                                                 04930002
049400     DISPLAY '**************************************************'.04940002
049500     DISPLAY 'PROGRAM.................'   PC-PROGRAM-NAME.        04950002
049600     DISPLAY ' '.                                                 04960002
049700     MOVE PV-READ-COUNT              TO PV-DISPLAY-READ-CNT.      04970002
049800     DISPLAY 'TOT RECS READ       : '   PV-DISPLAY-READ-CNT.      04980002
049900     DISPLAY ' '.                                                 04990002
050000***                                                               05000002
050100     MOVE PV-WRITE-WRAP-EXTR-COUNT                                05010002
050200                                TO PV-DISPLAY-WRITE-WRAP-CNT      05020002
050300     DISPLAY 'TOT WRAP RECS WRITTEN : '                           05030002
050400                                PV-DISPLAY-WRITE-WRAP-CNT         05040002
050500***                                                               05050002
050600     MOVE PV-WRITE-DEAD-EXTR-COUNT                                05060002
050700                                TO PV-DISPLAY-WRITE-DEAD-CNT      05070002
050800     DISPLAY 'TOT DEAD RECS WRITTEN : '                           05080002
050900                                PV-DISPLAY-WRITE-DEAD-CNT         05090002
051000***                                                               05100002
051100     MOVE PV-WRITE-READY-EXTR-COUNT                               05110002
051200                                TO PV-DISPLAY-WRITE-READY-CNT     05120002
051300     DISPLAY 'TOT READY RECS WRITTEN : '                          05130002
051400                                PV-DISPLAY-WRITE-READY-CNT        05140002
051500***                                                               05150002
051600                                                                  05160002
051700     CLOSE INPUT-FILE                                             05170002
051800           EXTRACT-WRAP-FILE                                      05180002
051900           EXTRACT-DEAD-FILE                                      05190002
052000           EXTRACT-READY-FILE.                                    05200002
052100                                                                  05210002
052200***************************************************************** 05220002
052300 Z999-SQL-ABEND.                                                  05230002
052400***************************************************************** 05240002
052500     MOVE SQLCODE                     TO PV-DISPLAY-SQLCODE.      05250002
052600                                                                  05260002
052700     DISPLAY '** ABEND **         ** = SQLERROR'.                 05270002
052800     DISPLAY '** PROGRAM          ** = ' PC-PROGRAM-NAME.         05280002
052900     DISPLAY '** PO NUMBER        ** = ' PV-DISPLAY-PO-NBR.       05290002
053000     DISPLAY '** SKU NUMBER       ** = ' PV-DISPLAY-SKU-NBR.      05300002
053100                                                                  05310002
053200     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             05320002
053300     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                05330002
053400     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME1.             05340002
053500     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME2.             05350002
053600     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME3.             05360002
053700     DISPLAY '** SQLCODE   ** = ' PV-DISPLAY-SQLCODE.             05370002
053800                                                                  05380002
053900     MOVE +4013                  TO PV-ABEND-CODE.                05390002
054000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05400002
054100************************************************************      05410002
054200 9999-ABEND.                                                      05420002
054300                                                                  05430002
054400     DISPLAY '***************'.                                   05440002
054500     DISPLAY '** ABEND     **'.                                   05450002
054600     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                05460002
054700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05470002
054800     DISPLAY '** RC074-ERROR-TYPE   ** = ' PV-ABEND-OPERATION.    05480002
054900     DISPLAY '***************'.                                   05490002
055000                                                                  05500002
055100     MOVE +4013                  TO PV-ABEND-CODE.                05510002
055200     CALL 'ILBOABN0' USING ABEND-CODE.                            05520002
055300                                                                  05530002
