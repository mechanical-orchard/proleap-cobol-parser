000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    XLKUP026.                                         00040000
000500 AUTHOR.        PAUL JORGENSEN.                                   00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   MAY 2003.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS BATCH DB2 PROGRAM LOADS XLT_PK FROM PACKHEAD EXTRACT FILE 00100000
001400***************************************************************** 00140000
001500 ENVIRONMENT DIVISION.                                            00150000
001600 INPUT-OUTPUT SECTION.                                            00160000
001700                                                                  00170000
001800 FILE-CONTROL.                                                    00180000
001900                                                                  00190000
002000     SELECT XLT-PK-IN                                             00200000
002010         ASSIGN TO INP01.                                         00201000
002100                                                                  00210000
002200***************************************************************** 00220000
002300 DATA DIVISION.                                                   00230000
002400***************************************************************** 00240000
002500 FILE SECTION.                                                    00250000
002600                                                                  00260000
002700 FD  XLT-PK-IN                                                    00270000
002800     RECORDING MODE IS F                                          00280000
002810     BLOCK CONTAINS 0 RECORDS                                     00281000
002900     LABEL RECORDS ARE STANDARD.                                  00290000
003000                                                                  00300000
003300 01  XLT-PK-IN-RECORD                 PIC X(119).                 00330000
003700                                                                  00370000
003800                                                                  00380000
003900***************************************************************** 00390000
004000 WORKING-STORAGE SECTION.                                         00400000
004100                                                                  00410000
       01  PA-DB2-COMMIT-COUNT              PIC S9(09) VALUE +0         00411000
                                                          COMP-3.       00412000
004200 01  PS-PROGRAM-SWITCHES.                                         00420000
004300     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00430000
004400         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00440000
004500         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00450000
004600                                                                  00460000
004700 01  PC-PROGRAM-CONSTANTS.                                        00470000
004800     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'XLKUP026'.00480000
005000                                                                  00500000
005100 01  PV-PROGRAM-VARIABLES.                                        00510000
005900     05  PV-RECORDS-READ              PIC  9(09) VALUE  0.        00590000
006000     05  PV-RECORDS-INSERTED          PIC  9(09) VALUE  0.        00600000
006000     05  PV-RECORDS-SKIP              PIC  9(09) VALUE  0.        00610000
006400     05  PV-DISP-UPC-ID               PIC  9(09) VALUE  0.        00640000
           05  PV-DISP-UPC-NBR              PIC  9(15) VALUE  0.        00650000
006700     05  PV-SQLCODE                   PIC  S9(9) VALUE +0.        00670000
006800     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00680000
006900                                                                  00690000
007000                                                                  00700000
007100 01  PV-ABEND-FIELDS.                                             00710000
007200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         00720000
007300                                                 COMP SYNC.       00730000
007400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'XLKUP026'.00740000
007500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00750000
007600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00760000
007700     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00770000
007900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00790000
008000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00800000
008100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00810000
008200                                                                  00820000
008300                                                                  00830000
008400***********************************************************       00840000
008500*  COPYBOOK USED FOR THE PACKHEAD INPUT FILE              *       00850000
008600***********************************************************       00860000
008700     COPY IMRD076.                                                00870000
008800                                                                  00880000
008900***********************************************************       00890000
009000*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00900000
009100***********************************************************       00910000
009200     COPY DPWS004.                                                00920000
009300                                                                  00930000
009400***********************************************************       00940000
009500*  DB2 SQL COMMUNICATION AREA                             *       00950000
009600***********************************************************       00960000
009700     EXEC SQL                                                     00970000
009800          INCLUDE SQLCA                                           00980000
009900     END-EXEC.                                                    00990000
010000                                                                  01000000
010100***********************************************************       01010000
010200*  XLT_PK TABLE                                          *        01020000
010300***********************************************************       01030000
010400     EXEC SQL                                                     01040000
010500          INCLUDE XLT00007                                        01050000
010600     END-EXEC.                                                    01060000
010700                                                                  01070000
010800***************************************************************** 01080000
010900 PROCEDURE DIVISION.                                              01090000
011000***************************************************************** 01100000
011100     DISPLAY '**** BEGINNING XLKUP026 ****'.                      01110000
011200     DISPLAY ' '.                                                 01120000
011300                                                                  01130000
011400     OPEN INPUT  XLT-PK-IN.                                       01140000
011500                                                                  01150000
011600     PERFORM 1000-READ-INPUT-FILE.                                01160000
011700                                                                  01170000
012100     PERFORM 2000-PROCESS-INPUT-FILE                              01210000
012200       UNTIL PS-EOF-INPUT-YES.                                    01220000
012300                                                                  01230000
012400     CLOSE XLT-PK-IN.                                             01240000
012500                                                                  01250000
012510     PERFORM 3000-TABLE-COMMIT.                                   01251000
012520                                                                  01252000
012600     DISPLAY '  INPUT PK RECS READ    = ' PV-RECORDS-READ.        01260000
012700     DISPLAY '  XLT_PK ROWS INSERTED  = ' PV-RECORDS-INSERTED.    01270000
012700     DISPLAY '  XLT_PK ROWS SKIPED    = ' PV-RECORDS-SKIP.        01271000
012800     DISPLAY ' '.                                                 01280000
012900     DISPLAY '****  END OF  XLKUP026  ****'.                      01290000
013000                                                                  01300000
013100     STOP RUN.                                                    01310000
013200                                                                  01320000
013300                                                                  01330000
013400***************************************************************** 01340000
013500*  READ A PACKHEAD EXTRACT RECORD THAT WILL BE USED TO INSERT    *01350000
013510*  A ROW OF DATA INTO THE XLT_PK TABLE.                        *  01351000
013600***************************************************************** 01360000
013700 1000-READ-INPUT-FILE.                                            01370000
013800                                                                  01380000
013900     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       01390000
014000                                                                  01400000
           INITIALIZE PA-DB2-COMMIT-COUNT.                              01401100
014020                                                                  01402000
014100     READ XLT-PK-IN                                               01410000
014200          INTO IMRD076-PACK-DATA                                  01420000
014300            AT END                                                01430000
014400               SET PS-EOF-INPUT-YES TO TRUE                       01440000
014500                                                                  01450000
014600            NOT AT END                                            01460000
014700               SET PS-EOF-INPUT-NO  TO TRUE                       01470000
014800               ADD +1 TO PV-RECORDS-READ                          01480000
014900     END-READ.                                                    01490000
015000                                                                  01500000
015100                                                                  01510000
015200***************************************************************** 01520000
015300*  LOAD THE INFORMATION FROM THE PACKHEAD EXTRACT FILE INTO THE * 01530000
015310*  HOST VARIABLES AND PERFORM A PARAGRAPH TO INSERT THE NEW ROW * 01531000
015320*  INTO THE XLT_PK  TABLE.                                      * 01532000
015400***************************************************************** 01540000
015500 2000-PROCESS-INPUT-FILE.                                         01550000
015600                                                                  01560000
015700     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       01570000
015800                                                                  01580000
016361     MOVE IM076-PACK-PK-SKU-NBR      TO XLT00007-PK-SKU-NBR       01636100
016362     MOVE IM076-PACK-DEPT-NBR        TO XLT00007-DEPT-NBR         01636200
016363     MOVE IM076-PACK-MAJ-CL-NBR      TO XLT00007-MAJ-CL-NBR       01636300
016364     MOVE IM076-PACK-SUB-CL-NBR      TO XLT00007-SUB-CL-NBR       01636400
016365     MOVE IM076-PACK-PK-DESC         TO XLT00007-PK-DESC          01636500
016366     MOVE IM076-PACK-DC-ORD-MULT-QTY TO XLT00007-DC-ORD-MULT-QTY  01636600
016380                                                                  01638000
016400     PERFORM 2100-INSERT-XLT-PK.                                  01640000
017700                                                                  01770000
017800     PERFORM 1000-READ-INPUT-FILE.                                01780000
018500                                                                  01850000
018600                                                                  01860000
021600***************************************************************** 02160000
021700*  INSERT A ROW TO THE XLT_PK TABLE.                           *  02170000
021800***************************************************************** 02180000
021900 2100-INSERT-XLT-PK.                                              02190000
022000                                                                  02200000
022100     EXEC SQL                                                     02210000
022200          INSERT                                                  02220000
022300          INTO  XLT_PK                                            02230000
023093              ( PK_SKU_NBR                                        02309300
023094               ,PK_DESC                                           02309400
023095               ,DEPT_NBR                                          02309500
023096               ,MAJ_CL_NBR                                        02309600
023097               ,SUB_CL_NBR                                        02309700
023098               ,DC_ORD_MULT_QTY)                                  02309800
023200          VALUES                                                  02320000
023993             (  :XLT00007-PK-SKU-NBR                              02399300
023994               ,:XLT00007-PK-DESC                                 02399400
023995               ,:XLT00007-DEPT-NBR                                02399500
023996               ,:XLT00007-MAJ-CL-NBR                              02399600
023997               ,:XLT00007-SUB-CL-NBR                              02399700
023998               ,:XLT00007-DC-ORD-MULT-QTY)                        02399800
024010     END-EXEC.                                                    02401000
024100                                                                  02410000
024200     EVALUATE TRUE                                                02420000
024300         WHEN SQLCODE = ZERO                                      02430000
024400              ADD +1                 TO PV-RECORDS-INSERTED       02440000
                    ADD +1                 TO PA-DB2-COMMIT-COUNT       02440100
                    IF PA-DB2-COMMIT-COUNT > 4500                       02440200
                        PERFORM 3000-TABLE-COMMIT                       02440300
                        MOVE 0 TO PA-DB2-COMMIT-COUNT                   02440400
                    END-IF                                              02440500
               WHEN SQLCODE = -803                                      02441000
                    CONTINUE                                            02442000
               WHEN SQLCODE = -530                                      02443000
024400              ADD +1                 TO PV-RECORDS-SKIP           02443100
024500         WHEN SQLCODE NOT = +0                                    02450000
024600              MOVE '2100-INSERT-XLT-PK'                           02460000
024700                                     TO PV-ABEND-PARAGRAPH        02470000
024800              MOVE 'INSERT XLT_PK'                                02480000
024810                                     TO PV-ABEND-OPERATION        02481000
025500              STRING 'SKU NBR: '           DELIMITED BY SIZE      02550000
025600                     IM076-PACK-PK-SKU-NBR DELIMITED BY SIZE      02560000
026700                                   INTO PV-DB2-OPERATION-MESSAGE-102670000
026800                                                                  02680000
026900              MOVE 'XLT_PK'          TO PV-ABEND-TABLE            02690000
027000              PERFORM Z999-SQL-ABEND                              02700000
027100     END-EVALUATE.                                                02710000
027200                                                                  02720000
027300                                                                  02730000
027400***************************************************************** 02740000
027500* COMMIT THE PENDING TABLE CHANGES.                             * 02750000
027600***************************************************************** 02760000
027700 3000-TABLE-COMMIT.                                               02770000
027800                                                                  02780000
027900     EXEC SQL                                                     02790000
028000          COMMIT                                                  02800000
028100     END-EXEC.                                                    02810000
028200                                                                  02820000
028300                                                                  02830000
028400***************************************************************** 02840000
028500*  DISPLAY DB2 ERROR INFORMATION, ROLLBACK ANY PENDING CHANGES, * 02850000
028510*  AND ABEND THE PROGRAM.                                       * 02851000
028600***************************************************************** 02860000
028700 Z999-SQL-ABEND.                                                  02870000
028800                                                                  02880000
028900     MOVE SQLCODE            TO PV-SQLCODE.                       02890000
029000     MOVE PV-SQLCODE         TO PV-DISP-SQLCODE.                  02900000
029100     DISPLAY '*** DB2 ERROR '.                                    02910000
029200     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  02920000
029300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02930000
029400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02940000
029500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02950000
029600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02960000
029700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02970000
029800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02980000
029900     DISPLAY '*** TABLE 1   = ' PV-ABEND-TABLE.                   02990000
030000                                                                  03000000
030100     COPY DPPD004.                                                03010000
030200                                                                  03020000
030300     MOVE +4013         TO PV-ABEND-CODE.                         03030000
030400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         03040000
