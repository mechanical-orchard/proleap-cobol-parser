000100*-----------------------*                                         00010030
000200 IDENTIFICATION DIVISION.                                         00020030
000300*-----------------------*                                         00030030
000400 PROGRAM-ID.    PEKCS195.                                         00040030
000500 AUTHOR.        AMY REILAND.                                      00050030
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060030
000700 DATE-WRITTEN.  08-11-93.                                         00070030
000800 DATE-COMPILED.                                                   00080030
000900                                                                  00090030
001000*---------------------------------------------------------------* 00100030
001100*    Q195 - IN-STORE DOCUMENT ENTRY LIST.                       * 00110030
001200*                                                               * 00120030
001300*    THIS PROGRAM GENERATES A LIST OF DOCUMENT FOR THE CRITERIA * 00130030
001400*    SPECIFIED ON THE CRITERIA SPEC.                            * 00140030
001500*                                                               * 00150030
001600*    FROM THIS LIST, THE USER MAY GO TO THE IN-STORE DOCUMENT   * 00160030
001700*    CANCEL, UPDATE OR HEADER INQUIRY.                          * 00170030
001800*                                                               * 00180030
001900*    THE DP030-OVERRIDE-APPL-ERROR SWITCH IS SET TO TRUE WHEN   * 00190030
002000*    ENTERING THE PROGRAM IN ORDER TO GIVE CONTROL BACK TO THE  * 00200030
002100*    LIST WHEN A NEXT-ACT-APPL-ERROR IS SENT BACK FROM THE      * 00210030
002200*    UPDATE.  THE DP030-RC-APPL-ERROR IS CHECKED TO DETERMINE   * 00220030
002300*    IF A NEXT-ACT-APPL-ERROR IS BEING RETURNED TO THE LIST.    * 00230030
002400*                                                               * 00240030
002500*    IF THE USER IS CORPORATE AND ENTERS A STORE NUMBER OF      * 00250030
002600*    SPACES ON THE CRITERIA SPEC, INFORMATION FOR ALL STORES    * 00260030
002700*    WILL BE DISPLAYED FOR THE CRITERIA SPECIFIED.              * 00270030
002800*                                                               * 00280030
002900*    IF THE USER IS CORPORATE AND ENTERS A VALID STORE NUMBER,  * 00290030
003000*    THE NEXT STORES' INFORMATION CAN BE DISPLAYED FOR THE      * 00300030
003100*    CRITERIA SPECIFIED BY PRESSING PF17.                       * 00310030
003200*                                                               * 00320030
003300*---------------------------------------------------------------* 00330030
003400* DATE  01/22/2001                                                00340030
003500*  CHANGE MADE: CHANGED PICTURE CLAUSE FOR PV-LIST-ITEM-NUMBER    00350030
003600*  FROM S9(04) COMP SYNC TO S9(09) COMP-3 TO ELIMINATE            00360030
003700*  ITEMERR ABENDS IN PARAGRAPH 5105-REWRITE-ASC-LISTQ.            00370030
003800*  MADE BY: JACK KRAMER             IR #: 388918                  00380030
003900*---------------------------------------------------------------* 00390030
004000*---------------------------------------------------------------* 00400030
004100* DATE  03/18/2003                                                00410030
004200*  CHANGE MADE: FOR NI-SKU CONVERSION THE STRUCTURE OF            00420030
004300*  ASC-KEY-DEPT-NBR IS CHANGED AND THE PICTURE CLAUSE OF          00430030
004400*  ASC-DEPT-NBR-LOW, ASC-DEPT-NBR-HIGH ARE CHANGED TO 9(04) COMP-300440030
004500*  MADE BY: SUKUMAR, IGSI           WR #: 24472                   00450030
004600*---------------------------------------------------------------* 00460030
004700* DATE  02/09/2005                                                00470030
004800*  CHANGE MADE:                                                   00480030
004900*    - CHANGED ALL STORE NUMBER LENGTH REFERENCES FROM 3 TO 4     00490030
005000*      DIGITS IN LENGTH AND ADDED A 4 DIGIT NUMERIC STORE         00500030
005100*      NUMBER FIELD(S)                                            00510030
005200*    - SHORTENED THE DEPT_AREA_DEST SCREEN DISPLAY DUE TO THE     00520030
005300*      AMOUNT OF INFORMATION BEING DISPLAYED                      00530030
005400*    - REPLACED TSTR000 STORE TABLE CALL(S) WITH STORE TABLE      00540030
005500*      CALL(S) TO XST_LOC                                         00550030
005600*    - CHANGED THE FILLER REDEFINES DP020-VARIABLE-COMMAREA       00560030
005700*      FILLER LENGTH AND THE APPROPRIATE MNEMONIC LENGTH          00570030
005800*    - REMOVED THE OPERCO_NBR FIELD FROM ALL IN-STORE PERM TABLE  00580030
005900*      CALLS                                                      00590030
006000*  MADE BY: TODD C. MICHALEK        IR #: WR27559                 00600030
006100*---------------------------------------------------------------* 00610030
006110* 09/14/2021 - GERMAN BANDA - CHG0261678                          00611033
006120* DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         00612031
006130*              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00613031
006140*              MAKING THE CALL DYNAMIC VS STATIC                  00614031
006150*---------------------------------------------------------------* 00615031
CICS  *  CHANGED 10/18/2022    BY BARB SCHULTZ    WR: CHG0276658        00616035
CICS  *                                                                 00617034
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00618036
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00619034
CICS  *-----------------------------------------------------------------00619134
006200 EJECT                                                            00620030
006300 ENVIRONMENT DIVISION.                                            00630030
006400                                                                  00640030
006500 DATA DIVISION.                                                   00650030
006600                                                                  00660030
006700 WORKING-STORAGE SECTION.                                         00670030
006800                                                                  00680030
006900 01  DK-DB2-KEYS.                                                 00690030
007000     15  DK-CURRENT-DATE-ISO            PIC  X(10)  VALUE SPACE.  00700030
007100     15  DK-DOC-NBR                     PIC S9(07)  VALUE +0      00710030
007200                                                    COMP-3.       00720030
007300     15  DK-STORE-NBR                   PIC S9(04)  VALUE +0      00730030
007400                                                    COMP.         00740030
007500                                                                  00750030
007600 01  PC-PROGRAM-CONSTANTS.                                        00760030
007700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00770030
007800                                                    'PE195A  '.   00780030
007900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00790030
008000                                                    'PEKM195 '.   00800030
008100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00810030
008200                                                    'PEKCS195'.   00820030
008300     05  PC-HIGH-DOC                    PIC S9(07)  VALUE         00830030
008400                                                    +9999999      00840030
008500                                                    COMP-3.       00850030
008600     05  PC-HIGH-RSN                    PIC S9(02)  VALUE +99     00860030
008700                                                    COMP-3.       00870030
008800     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00880030
008900     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00890030
009000     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00900030
009100     05  PC-ITEM-NUMBER-LENGTH          PIC S9(04)  VALUE +5      00910030
009200                                                    COMP SYNC.    00920030
009300     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00930030
009400                                                    COMP SYNC.    00940030
009500     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00950030
009600                                                    COMP SYNC.    00960030
009700     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00970030
009800                                                    +1000000      00980030
009900                                                    COMP-3.       00990030
010000     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       01000030
010100                                                    COMP-3.       01010030
010200     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  01020030
010300     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  01030030
010400     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  01040030
010500     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  01050030
010600     05  PC-CAN                         PIC  X(03)  VALUE 'CAN'.  01060030
010700*                                                                 01070030
010800     05  PC-TSYMSG-NUMBERS.                                       01080030
010900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01090030
011000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01100030
011100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01110030
011200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01120030
011300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01130030
011400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01140030
011500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01150030
011600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01160030
011700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01170030
011800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01180030
011900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01190030
012000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01200030
012100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01210030
012200         10  PC-TSYMSG-00283            PIC  9(05)  VALUE 00283.  01220030
012300         10  PC-TSYMSG-00508            PIC  9(05)  VALUE 00508.  01230030
012400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01240030
012500*                                                                 01250030
012600 01  PS-PROGRAM-SWITCHES.                                         01260030
012700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01270030
012800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01280030
012900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01290030
013000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01300030
013100         88  PS-NO-ERROR                            VALUE 'Y'.    01310030
013200         88  PS-ERROR                               VALUE 'N'.    01320030
013300     05  PS-NEXT-STR-INFO-FOUND-SW      PIC  X(01)  VALUE 'N'.    01330030
013400         88  PS-NEXT-STR-INFO-FOUND                 VALUE 'Y'.    01340030
013500         88  PS-NEXT-STR-INFO-NOT-FOUND             VALUE 'N'.    01350030
013600*                                                                 01360030
013700 01  PV-PROGRAM-VARIABLES.                                        01370030
013800     05  PV-HOLD-ISO-DATE.                                        01380030
013900         10  PV-HOLD-ISO-CC             PIC  X(02)  VALUE SPACES. 01390030
014000         10  PV-HOLD-ISO-YY             PIC  X(02)  VALUE SPACES. 01400030
014100         10  FILLER                     PIC  X(01)  VALUE SPACES. 01410030
014200         10  PV-HOLD-ISO-MM             PIC  X(02)  VALUE SPACES. 01420030
014300         10  FILLER                     PIC  X(01)  VALUE SPACES. 01430030
014400         10  PV-HOLD-ISO-DD             PIC  X(02)  VALUE SPACES. 01440030
014500     05  PV-HOLD-GREG-DATE.                                       01450030
014600         10  PV-HOLD-GREG-MM            PIC  X(02)  VALUE SPACES. 01460030
014700         10  FILLER                     PIC  X(01)  VALUE '/'.    01470030
014800         10  PV-HOLD-GREG-DD            PIC  X(02)  VALUE SPACES. 01480030
014900         10  FILLER                     PIC  X(01)  VALUE '/'.    01490030
015000         10  PV-HOLD-GREG-YY            PIC  X(02)  VALUE SPACES. 01500030
015100     05  PV-HOLD-TYPE-REASON.                                     01510030
015200         10  PV-HOLD-TYPE-CODE          PIC  X(01)  VALUE SPACES. 01520030
015300         10  PV-HOLD-REASON-CODE        PIC  X(02)  VALUE SPACES. 01530030
015400     05  PV-HOLD-DEPT-AREA-DEST.                                  01540030
015500         10  PV-HOLD-PARTIAL-DEPT-AREA  PIC  X(30)  VALUE SPACES. 01550030
015600         10  FILLER                     PIC  X(10)  VALUE SPACES. 01560030
015700     05  PV-SUB                         PIC S9(04)  VALUE +0      01570030
015800                                                    COMP SYNC.    01580030
015900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01590030
016000                                                    COMP SYNC.    01600030
016100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01610030
016200                                                    COMP-3.       01620030
016300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01630030
016400                                                    COMP-3.       01640030
016500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01650030
016600                                                    COMP-3.       01660030
016700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01670030
016800                                                    COMP-3.       01680030
016900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01690030
017000                                                    COMP-3.       01700030
017100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01710030
017200                                                    COMP-3.       01720030
017300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01730030
017400                                                    COMP-3.       01740030
017500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01750030
017600                                                    COMP SYNC.    01760030
017700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01770030
017800                                                    COMP SYNC.    01780030
017900     05  PV-ITEM                        PIC S9(04)  VALUE +0      01790030
018000                                                    COMP SYNC.    01800030
018100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01810030
018200                                                    COMP SYNC.    01820030
018300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01830030
018400                                                    COMP SYNC.    01840030
018500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01850030
018600                                                    COMP SYNC.    01860030
018700     05  PV-LIST-ITEM-NUMBER            PIC S9(09)  VALUE +0      01870030
018800                                                    COMP-3.       01880030
018900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01890030
019000                                                    COMP SYNC.    01900030
019100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01910030
019200                                                    COMP SYNC.    01920030
019300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01930030
019400                                                    COMP SYNC.    01940030
019500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01950030
019600                                                    COMP SYNC.    01960030
019700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01970030
019800                                                    COMP SYNC.    01980030
019900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01990030
020000                                                    COMP SYNC.    02000030
020100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02010030
020200                                                    COMP SYNC.    02020030
020300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02030030
020400                                                    COMP SYNC.    02040030
020500     05  PV-SORT-FIELD                  PIC  X(01)  VALUE SPACES. 02050030
020600     05  PV-TEMP-DEPT                   PIC  9(04)  VALUE ZEROES. 02060030
020700*                                                                 02070030
020800 EJECT                                                            02080030
020900*---------------------------------------------------------------* 02090030
021000*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 02100030
021100*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 02110030
021200*   APPLICATION-SPECIFIC COMMAREA.                              * 02120030
021300*---------------------------------------------------------------* 02130030
021400 01  LQW-LIST-QUEUE-WORK-AREA.                                    02140030
021500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02150030
021600     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           02160030
021700                                        INDEXED BY LQW-IDX.       02170030
021800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02180030
021900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02190030
022000         10  LQW-SELECTED-SW            PIC  X(01).               02200030
022100             88  LQW-SELECT                         VALUE 'S'.    02210030
022200             88  LQW-DESELECT                       VALUE ' '.    02220030
022300         10  LQW-ACTION                 PIC  X(03).               02230030
022400         10  LQW-STORE-NBR              PIC  X(04).               02240030
022500         10  LQW-DOC-NBR                PIC S9(07)   COMP-3.      02250030
022600         10  LQW-ISSUED-DATE            PIC  X(08).               02260030
022700         10  LQW-DEPT-AREA-DEST         PIC  X(29).               02270030
022800         10  LQW-REASON-CODE            PIC  X(03).               02280030
022900         10  LQW-STATUS-CODE            PIC  X(02).               02290030
023000         10  LQW-STATUS-DESC            PIC  X(10).               02300030
023100                                                                  02310030
023200*                                                                 02320030
023300 EJECT                                                            02330030
023400*---------------------------------------------------------------* 02340030
023500*  RECORD LAYOUT FOR THE DOCUMENT SELECTION TEMP STORAGE QUEUE. * 02350030
023600*---------------------------------------------------------------* 02360030
023700                                                                  02370030
023800     COPY PEWS067.                                                02380030
023900                                                                  02390030
024000*                                                                 02400030
024100 EJECT                                                            02410030
024200*---------------------------------------------------------------* 02420030
024300*    MAP LAYOUT                                                 * 02430030
024400*---------------------------------------------------------------* 02440030
024500                                                                  02450030
024600     COPY PEKM195.                                                02460030
024700*                                                                 02470030
024800 01  MR-OCCURS-LAYOUT                   REDEFINES  PE195AO.       02480030
024900     05  FILLER                         PIC X(55).                02490030
025000     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          02500030
025100         10  MR-SELECTL                 PIC S9(04) COMP.          02510030
025200         10  MR-SELECTA                 PIC  X(01).               02520030
025300         10  MR-SELECTC                 PIC  X(01).               02530030
025400         10  MR-SELECTH                 PIC  X(01).               02540030
025500         10  MR-SELECTI                 PIC  X(01).               02550030
025600                                                                  02560030
025700         10  MR-ACTIONL                 PIC S9(04) COMP.          02570030
025800         10  MR-ACTIONA                 PIC  X(01).               02580030
025900         10  MR-ACTIONC                 PIC  X(01).               02590030
026000         10  MR-ACTIONH                 PIC  X(01).               02600030
026100         10  MR-ACTION                  PIC  X(03).               02610030
026200                                                                  02620030
026300         10  MR-STORE-NBRL              PIC S9(04) COMP.          02630030
026400         10  MR-STORE-NBRA              PIC  X(01).               02640030
026500         10  MR-STORE-NBRC              PIC  X(01).               02650030
026600         10  MR-STORE-NBRH              PIC  X(01).               02660030
026700         10  MR-STORE-NBR               PIC  X(04).               02670030
026800                                                                  02680030
026900         10  MR-DOC-NBRL                PIC S9(04) COMP.          02690030
027000         10  MR-DOC-NBRA                PIC  X(01).               02700030
027100         10  MR-DOC-NBRC                PIC  X(01).               02710030
027200         10  MR-DOC-NBRH                PIC  X(01).               02720030
027300         10  MR-DOC-NBR                 PIC  X(07).               02730030
027400                                                                  02740030
027500         10  MR-ISSUED-DATEL            PIC S9(04) COMP.          02750030
027600         10  MR-ISSUED-DATEA            PIC  X(01).               02760030
027700         10  MR-ISSUED-DATEC            PIC  X(01).               02770030
027800         10  MR-ISSUED-DATEH            PIC  X(01).               02780030
027900         10  MR-ISSUED-DATE             PIC  X(08).               02790030
028000                                                                  02800030
028100         10  MR-DEPT-AREA-DESTL         PIC S9(04) COMP.          02810030
028200         10  MR-DEPT-AREA-DESTA         PIC  X(01).               02820030
028300         10  MR-DEPT-AREA-DESTC         PIC  X(01).               02830030
028400         10  MR-DEPT-AREA-DESTH         PIC  X(01).               02840030
028500         10  MR-DEPT-AREA-DEST          PIC  X(29).               02850030
028600                                                                  02860030
028700         10  MR-REASON-CODEL            PIC S9(04) COMP.          02870030
028800         10  MR-REASON-CODEA            PIC  X(01).               02880030
028900         10  MR-REASON-CODEC            PIC  X(01).               02890030
029000         10  MR-REASON-CODEH            PIC  X(01).               02900030
029100         10  MR-REASON-CODE             PIC  X(03).               02910030
029200                                                                  02920030
029300         10  MR-STATUS-CODEL            PIC S9(04) COMP.          02930030
029400         10  MR-STATUS-CODEA            PIC  X(01).               02940030
029500         10  MR-STATUS-CODEC            PIC  X(01).               02950030
029600         10  MR-STATUS-CODEH            PIC  X(01).               02960030
029700         10  MR-STATUS-CODE             PIC  X(02).               02970030
029800                                                                  02980030
029900         10  MR-STATUS-DESCL            PIC S9(04) COMP.          02990030
030000         10  MR-STATUS-DESCA            PIC  X(01).               03000030
030100         10  MR-STATUS-DESCC            PIC  X(01).               03010030
030200         10  MR-STATUS-DESCH            PIC  X(01).               03020030
030300         10  MR-STATUS-DESC             PIC  X(10).               03030030
030400*                                                                 03040030
030500 EJECT                                                            03050030
030600*---------------------------------------------------------------* 03060030
030700*    FORMATTED DATE COPYBOOK.                                   * 03070030
030800*---------------------------------------------------------------* 03080030
030900                                                                  03090030
031000     COPY DPWS017.                                                03100030
031100*                                                                 03110030
031200 EJECT                                                            03120030
031300*---------------------------------------------------------------* 03130030
031400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03140030
031500*---------------------------------------------------------------* 03150030
031600                                                                  03160030
031700     COPY DPWS015.                                                03170030
031800*                                                                 03180030
031900 EJECT                                                            03190030
032000*---------------------------------------------------------------* 03200030
032100*    PERM PRICE CHANGE CONSTANTS AND WORK AREAS                 * 03210030
032200*---------------------------------------------------------------* 03220030
032300                                                                  03230030
032400     COPY PEWS049.                                                03240030
032500*                                                                 03250030
032600 EJECT                                                            03260030
032700*---------------------------------------------------------------* 03270030
032800*    FUNCTION KEYS COPYBOOK.                                    * 03280030
032900*---------------------------------------------------------------* 03290030
033000                                                                  03300030
033100     COPY DPWS016.                                                03310030
033200*                                                                 03320030
033300 EJECT                                                            03330030
033400*---------------------------------------------------------------* 03340030
033500*    NUMERIC EDIT LAYOUT.                                       * 03350030
033600*---------------------------------------------------------------* 03360030
033700                                                                  03370030
033800     COPY DPWS010I.                                               03380030
033900*                                                                 03390030
034000 EJECT                                                            03400030
034100*---------------------------------------------------------------* 03410030
CICS  *    PARAMETERS FOR CALLING CICS ARCHITECTURE API.              * 03420034
034300*---------------------------------------------------------------* 03430030
034400                                                                  03440030
034500     COPY DPWS030.                                                03450030
CICS       COPY DPWS930.                                                03451034
034600*                                                                 03460030
034700 EJECT                                                            03470030
034800*---------------------------------------------------------------* 03480030
034900*    STANDARD COMMAREA.                                         * 03490030
035000*---------------------------------------------------------------* 03500030
035100                                                                  03510030
035200     COPY DPWS020.                                                03520030
035300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03530030
035400*                                                                 03540030
035500 EJECT                                                            03550030
035600*---------------------------------------------------------------* 03560030
035700* INTER-APPLICATION COMMAREA.                                   * 03570030
035800*   PEWS064 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03580030
035900*             SPEC SCREEN.                                      * 03590030
036000*   PEWS066 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03600030
036100*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03610030
036200*---------------------------------------------------------------* 03620030
036300                                                                  03630030
036400         10  INTER-APPL-COMMAREA        PIC X(200).               03640030
036500     COPY PEWS064.                                                03650030
036600*                                                                 03660030
036700 EJECT                                                            03670030
036800     COPY PEWS066.                                                03680030
036900*                                                                 03690030
037000 EJECT                                                            03700030
037100*---------------------------------------------------------------* 03710030
037200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03720030
037300*---------------------------------------------------------------* 03730030
037400         10  ASC-SPECIFIC-COMMAREA.                               03740030
037500             15  ASC-LIST-KEYS.                                   03750030
037600                 20  ASC-KEY-STORE-NBR               PIC  X(04).  03760030
037700                 20  FILLER REDEFINES ASC-KEY-STORE-NBR.          03770030
037800                     25 ASC-KEY-STORE-NBR-N          PIC  9(04).  03780030
037900                 20  ASC-KEY-DOC-NBR.                             03790030
038000                     25  ASC-KEY-DOC-NBR-N           PIC  9(07).  03800030
038100                 20  ASC-KEY-DEPT-NBR-X.                          03810030
038200                     25  FILLER                      PIC  X(01).  03820030
038300                     25  ASC-KEY-DEPT-NBR            PIC  X(03).  03830030
038400                 20  ASC-KEY-STATUS-CODE             PIC  X(02).  03840030
038500                 20  ASC-KEY-REASON-CODE             PIC  X(03).  03850030
038600                 20  ASC-KEY-FROM-DATE               PIC  X(10).  03860030
038700                 20  ASC-KEY-TO-DATE                 PIC  X(10).  03870030
038800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03880030
038900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03890030
039000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03900030
039100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03910030
039200                                                                  03920030
039300                 20  ASC-ITEM-ARRAY.                              03930030
039400                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        03940030
039500                         30  ASC-LIST-ITEM-NUMBER                 03950030
039600                                                     PIC S9(09)   03960030
039700                                                     COMP-3.      03970030
039800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03980030
039900                             88  ASC-VALID-SELECT    VALUE ' '    03990030
040000                                                           'S'    04000030
040100                                                           'B'    04010030
040200                                                           'E'.   04020030
040300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04030030
040400                             88  ASC-TEMP-SELECT     VALUE 'S'.   04040030
040500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04050030
040600                             88  ASC-TEMP-END        VALUE 'E'.   04060030
040700                         30  ASC-SELECTED-SW         PIC  X(01).  04070030
040800                             88  ASC-NO-SELECT       VALUE ' '.   04080030
040900                             88  ASC-SELECT          VALUE 'S'.   04090030
041000                             88  ASC-BEGIN           VALUE 'B'.   04100030
041100                             88  ASC-END             VALUE 'E'.   04110030
041200                         30  ASC-ACTION              PIC  X(03).  04120030
041300                         30  ASC-STORE-NBR           PIC  X(04).  04130030
041400                         30  FILLER REDEFINES ASC-STORE-NBR.      04140030
041500                             35  ASC-STORE-NBR-N     PIC  9(04).  04150030
041600                         30  ASC-DOC-NBR             PIC  9(07)   04160030
041700                                                     COMP-3.      04170030
041800                         30  ASC-ISSUED-DATE         PIC  X(08).  04180030
041900                         30  ASC-DEPT-AREA-DEST      PIC  X(29).  04190030
042000                         30  ASC-REASON-CODE         PIC  X(03).  04200030
042100                         30  ASC-STATUS-CODE         PIC  X(02).  04210030
042200                         30  ASC-STATUS-DESC         PIC  X(10).  04220030
042300                                                                  04230030
042400             15  ASC-STORE-NBR-LOW                   PIC S9(04)   04240030
042500                                                     COMP.        04250030
042600             15  ASC-STORE-NBR-HIGH                  PIC S9(04)   04260030
042700                                                     COMP.        04270030
042800             15  ASC-DOC-NBR-LOW                     PIC S9(07)   04280030
042900                                                     COMP-3.      04290030
043000             15  ASC-DOC-NBR-HIGH                    PIC S9(07)   04300030
043100                                                     COMP-3.      04310030
043200             15  ASC-DEPT-NBR-LOW                    PIC S9(04)V  04320030
043300                                               USAGE COMP-3.      04330030
043400             15  ASC-DEPT-NBR-HIGH                   PIC S9(04)V  04340030
043500                                               USAGE COMP-3.      04350030
043600             15  ASC-STATUS-CODE-LOW                 PIC  X(02).  04360030
043700             15  ASC-STATUS-CODE-HIGH                PIC  X(02).  04370030
043800             15  ASC-REASON-CODE-LOW                 PIC S9(02)   04380030
043900                                                     COMP-3.      04390030
044000             15  ASC-REASON-CODE-HIGH                PIC S9(02)   04400030
044100                                                     COMP-3.      04410030
044200             15  ASC-TYPE-CODE-LOW                   PIC  X(01).  04420030
044300             15  ASC-TYPE-CODE-HIGH                  PIC  X(01).  04430030
044400             15  ASC-FROM-DATE                       PIC  X(10).  04440030
044500             15  ASC-TO-DATE                         PIC  X(10).  04450030
044600             15  ASC-BLK-SUB                         PIC S9(04)   04460030
044700                                                          COMP    04470030
044800                                                          SYNC.   04480030
044900             15  ASC-ITEM-SUB                        PIC S9(04)   04490030
045000                                                          COMP    04500030
045100                                                          SYNC.   04510030
045200             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04520030
045300                                                          COMP-3. 04530030
045400             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04540030
045500                                                          COMP-3. 04550030
045600             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04560030
045700                                                          COMP-3. 04570030
045800             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04580030
045900                                                          COMP-3. 04590030
046000             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04600030
046100                                                          COMP-3. 04610030
046200             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04620030
046300                                                          COMP    04630030
046400                                                          SYNC.   04640030
046500             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04650030
046600                                                          COMP-3. 04660030
046700             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04670030
046800                                                          COMP-3. 04680030
046900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04690030
047000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04700030
047100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04710030
047200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04720030
047300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04730030
047400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04740030
047500             15  ASC-LIST-QUEUE-NAME.                             04750030
047600                 20  ASC-LIST-TERM-ID                PIC  X(04).  04760030
047700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04770030
047800                                                          COMP-3. 04780030
047900                 20  ASC-LIST-SEQ                    PIC  9(01).  04790030
048000             15  ASC-SEL-QUEUE-NAME.                              04800030
048100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04810030
048200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04820030
048300                                                          COMP-3. 04830030
048400                 20  ASC-SEL-SEQ                     PIC  9(01).  04840030
048500                                                                  04850030
048600             15  ASC-CURSOR-SW                       PIC  X(02).  04860030
048700                 88  ASC-NO-CURSOR                   VALUE ' '.   04870030
048800                 88  ASC-CURRENT-CURSOR              VALUE 'C '.  04880030
048900                 88  ASC-CURRENT-DEPT-CURSOR         VALUE 'CP'.  04890030
049000                 88  ASC-CURRENT-STATUS-CURSOR       VALUE 'CS'.  04900030
049100                 88  ASC-CURRENT-STATUS-DEPT-CURSOR  VALUE 'CD'.  04910030
049200                 88  ASC-HISTORY-STATUS-CURSOR       VALUE 'HS'.  04920030
049300                 88  ASC-HISTORY-STATUS-DEPT-CURSOR  VALUE 'HD'.  04930030
049400                 88  ASC-HISTORY-CURRENT-CURSOR      VALUE 'B '.  04940030
049500                 88  ASC-HIST-CURR-DEPT-CURSOR       VALUE 'BD'.  04950030
049600             15  ASC-START-ITEM-REQUEST.                          04960030
049700                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04970030
049800         10  FILLER                                  PIC  X(0891).04980030
049900*                                                                 04990030
050000 EJECT                                                            05000030
050100*---------------------------------------------------------------* 05010030
050200*    ABEND PROCESSING COPYBOOK.                                 * 05020030
050300*---------------------------------------------------------------* 05030030
050400                                                                  05040030
050500     COPY DPWS013.                                                05050030
050600*                                                                 05060030
050700 EJECT                                                            05070030
050800*---------------------------------------------------------------* 05080030
050900*    SELLING AND CUSTOMER SERVICE LOCATION TABLE                * 05090030
051000*---------------------------------------------------------------* 05100030
051100     EXEC SQL                                                     05110030
051200          INCLUDE XST00001                                        05120030
051300     END-EXEC.                                                    05130030
051400*--------------------------------------------------------------*  05140030
051500*    SELLING AND CUSTOMER SERVICE DC-LOCATION ASSIGNEMENT         05150030
051600*--------------------------------------------------------------*  05160030
051700     EXEC SQL                                                     05170030
051800         INCLUDE XST00020                                         05180030
051900     END-EXEC.                                                    05190030
052000*---------------------------------------------------------------* 05200030
052100*    DB2 AREA FOR CURRENT INSTORE HEADER TABLE                  * 05210030
052200*---------------------------------------------------------------* 05220030
052300     EXEC SQL                                                     05230030
052400          INCLUDE TSTRPPC                                         05240030
052500     END-EXEC.                                                    05250030
052600*                                                                 05260030
052700 EJECT                                                            05270030
052800*---------------------------------------------------------------* 05280030
052900*    DB2 AREA FOR HISTORY INSTORE HEADER TABLE                  * 05290030
053000*---------------------------------------------------------------* 05300030
053100     EXEC SQL                                                     05310030
053200          INCLUDE TSTRPCH                                         05320030
053300     END-EXEC.                                                    05330030
053400*                                                                 05340030
053500 EJECT                                                            05350030
053600*---------------------------------------------------------------* 05360030
053700*    DB2 AREA FOR CURRENT INSTORE DETAIL TABLE                  * 05370030
053800*---------------------------------------------------------------* 05380030
053900     EXEC SQL                                                     05390030
054000          INCLUDE TSPPCDT                                         05400030
054100     END-EXEC.                                                    05410030
054200*                                                                 05420030
054300 EJECT                                                            05430030
054400*---------------------------------------------------------------* 05440030
054500*    DB2 AREA FOR HISTORY INSTORE DETAIL TABLE                  * 05450030
054600*---------------------------------------------------------------* 05460030
054700     EXEC SQL                                                     05470030
054800          INCLUDE TSPCDTH                                         05480030
054900     END-EXEC.                                                    05490030
055000*                                                                 05500030
055100 EJECT                                                            05510030
055200*---------------------------------------------------------------* 05520030
055300*    DB2 AREA FOR COMMUNICATIONS                                * 05530030
055400*---------------------------------------------------------------* 05540030
055500     EXEC SQL                                                     05550030
055600          INCLUDE SQLCA                                           05560030
055700     END-EXEC.                                                    05570030
055800*                                                                 05580030
055900 EJECT                                                            05590030
056000*---------------------------------------------------------------* 05600030
056100*    NEXT STORE CURSOR TO RETRIEVE THE NEXT STORE WHEN PF17 IS  * 05610030
056200*    PRESSED.                                                   * 05620030
056300*---------------------------------------------------------------* 05630030
056400                                                                  05640030
056500     EXEC SQL                                                     05650030
056600         DECLARE NEXT-STORE-CSR CURSOR                            05660030
056700         FOR SELECT TEMP1.LOC_NBR                                 05670030
056800                  , MIN(COALESCE(T2.EFF_BEG_DTE,'0001-01-01'))    05680030
056900             FROM (SELECT LOC_NBR                                 05690030
057000                   FROM XST_LOC                                   05700030
057100                   WHERE LOC_NBR = :ASC-STORE-NBR-LOW             05710030
057200                     AND CLO_DTE > :DK-CURRENT-DATE-ISO) AS TEMP1 05720030
057300             LEFT OUTER JOIN                                      05730030
057400                  (SELECT LOC_NBR                                 05740030
057500                        , EFF_BEG_DTE                             05750030
057600                   FROM XST_DC_LOC_ASGMT                          05760030
057700                   WHERE EFF_BEG_DTE < :DK-CURRENT-DATE-ISO) AS T205770030
057800             ON TEMP1.LOC_NBR = T2.LOC_NBR                        05780030
057900             GROUP BY TEMP1.LOC_NBR                               05790030
058000             ORDER BY TEMP1.LOC_NBR                               05800030
058100                                                                  05810030
058200     END-EXEC.                                                    05820030
058300*                                                                 05830030
058400 EJECT                                                            05840030
058500*---------------------------------------------------------------* 05850030
058600*    IN-STORE HEADER CURSOR TO RETRIEVE HISTORY ONLY DATA       * 05860030
058700*    WHEN NO DEPT IS SPECIFIED.                                 * 05870030
058800*---------------------------------------------------------------* 05880030
058900                                                                  05890030
059000     EXEC SQL                                                     05900030
059100          DECLARE HISTORY-STATUS-CSR CURSOR                       05910030
059200          FOR SELECT                                              05920030
059300                DEST_LOC_NBR                                      05930030
059400              , DOC_NBR                                           05940030
059500              , RSN_CDE                                           05950030
059600              , TYP_CDE                                           05960030
059700              , STATUS_CDE                                        05970030
059800              , DEPT_AREA_DEST                                    05980030
059900              , CRE_DTE                                           05990030
060000          FROM  TSTRPCH                                           06000030
060100          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          06010030
060200            AND  STATUS_CDE  = :PE049-IS-HISTORY-STATUS-CDE       06020030
060300            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          06030030
060400                                  AND :ASC-STORE-NBR-HIGH)        06040030
060500            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              06050030
060600                                AND :ASC-DOC-NBR-HIGH)            06060030
060700            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          06070030
060800                                AND :ASC-REASON-CODE-HIGH)        06080030
060900            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            06090030
061000                                AND :ASC-TYPE-CODE-HIGH)          06100030
061100            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                06110030
061200                                AND :ASC-TO-DATE))                06120030
061300          ORDER BY                                                06130030
061400                DEST_LOC_NBR                                      06140030
061500              , CRE_DTE                                           06150030
061600              , DOC_NBR                                           06160030
061700     END-EXEC.                                                    06170030
061800*                                                                 06180030
061900 EJECT                                                            06190030
062000*---------------------------------------------------------------* 06200030
062100*    IN-STORE HEADER CURSOR TO RETRIEVE HISTORY ONLY DATA       * 06210030
062200*    WHEN DEPT IS SPECIFIED.                                    * 06220030
062300*---------------------------------------------------------------* 06230030
062400                                                                  06240030
062500     EXEC SQL                                                     06250030
062600          DECLARE HIST-STAT-DEPT-CSR CURSOR                       06260030
062700          FOR SELECT                                              06270030
062800                DEST_LOC_NBR                                      06280030
062900              , DOC_NBR                                           06290030
063000              , RSN_CDE                                           06300030
063100              , TYP_CDE                                           06310030
063200              , STATUS_CDE                                        06320030
063300              , DEPT_AREA_DEST                                    06330030
063400              , CRE_DTE                                           06340030
063500          FROM  TSTRPCH                                           06350030
063600          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      06360030
063700                FROM TSTRPCH H,                                   06370030
063800                     TSPCDTH D                                    06380030
063900                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    06390030
064000                  AND STATUS_CDE   = :PE049-IS-HISTORY-STATUS-CDE 06400030
064100                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  06410030
064200                                         AND :ASC-STORE-NBR-HIGH) 06420030
064300                  AND  H.DEST_LOC_NBR  =  D.DEST_LOC_NBR          06430030
064400                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        06440030
064500                                      AND :ASC-DOC-NBR-HIGH)      06450030
064600                  AND  H.DOC_NBR   =  D.DOC_NBR                   06460030
064700                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    06470030
064800                                      AND :ASC-REASON-CODE-HIGH)  06480030
064900                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      06490030
065000                                      AND :ASC-TYPE-CODE-HIGH)    06500030
065100                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          06510030
065200                                      AND :ASC-TO-DATE)           06520030
065300                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       06530030
065400                                      AND :ASC-DEPT-NBR-HIGH))    06540030
065500          ORDER BY                                                06550030
065600                DEST_LOC_NBR                                      06560030
065700              , CRE_DTE                                           06570030
065800              , DOC_NBR                                           06580030
065900     END-EXEC.                                                    06590030
066000*                                                                 06600030
066100 EJECT                                                            06610030
066200*---------------------------------------------------------------* 06620030
066300*    IN-STORE HEADER CURSOR TO RETRIEVE CURRENT INFORMATION     * 06630030
066400*    WHEN STATUS IS KNOWN AND DEPT IS SPECIFIED.                * 06640030
066500*---------------------------------------------------------------* 06650030
066600                                                                  06660030
066700     EXEC SQL                                                     06670030
066800          DECLARE CURR-STAT-DEPT-CSR CURSOR                       06680030
066900          FOR SELECT                                              06690030
067000                DEST_LOC_NBR                                      06700030
067100              , DOC_NBR                                           06710030
067200              , RSN_CDE                                           06720030
067300              , TYP_CDE                                           06730030
067400              , STATUS_CDE                                        06740030
067500              , DEPT_AREA_DEST                                    06750030
067600              , CRE_DTE                                           06760030
067700          FROM  TSTRPPC                                           06770030
067800          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      06780030
067900                FROM TSTRPPC H,                                   06790030
068000                     TSPPCDT D                                    06800030
068100                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    06810030
068200                  AND (STATUS_CDE BETWEEN :ASC-STATUS-CODE-LOW    06820030
068300                                      AND :ASC-STATUS-CODE-HIGH)  06830030
068400                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  06840030
068500                                          AND :ASC-STORE-NBR-HIGH)06850030
068600                  AND H.DEST_LOC_NBR = D.DEST_LOC_NBR             06860030
068700                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        06870030
068800                                      AND :ASC-DOC-NBR-HIGH)      06880030
068900                  AND H.DOC_NBR    = D.DOC_NBR                    06890030
069000                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    06900030
069100                                      AND :ASC-REASON-CODE-HIGH)  06910030
069200                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      06920030
069300                                      AND :ASC-TYPE-CODE-HIGH)    06930030
069400                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          06940030
069500                                      AND :ASC-TO-DATE)           06950030
069600                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       06960030
069700                                      AND :ASC-DEPT-NBR-HIGH))    06970030
069800          ORDER BY                                                06980030
069900                DEST_LOC_NBR                                      06990030
070000              , CRE_DTE                                           07000030
070100              , DOC_NBR                                           07010030
070200     END-EXEC.                                                    07020030
070300*                                                                 07030030
070400 EJECT                                                            07040030
070500*---------------------------------------------------------------* 07050030
070600*    IN-STORE HEADER CURSOR TO RETRIEVE CURRENT INFORMATION     * 07060030
070700*    WHEN STATUS IS KNOWN AND DEPT IS NOT SPECIFIED             * 07070030
070800*---------------------------------------------------------------* 07080030
070900                                                                  07090030
071000     EXEC SQL                                                     07100030
071100          DECLARE CURRENT-STATUS-CSR CURSOR                       07110030
071200          FOR SELECT                                              07120030
071300                DEST_LOC_NBR                                      07130030
071400              , DOC_NBR                                           07140030
071500              , RSN_CDE                                           07150030
071600              , TYP_CDE                                           07160030
071700              , STATUS_CDE                                        07170030
071800              , DEPT_AREA_DEST                                    07180030
071900              , CRE_DTE                                           07190030
072000          FROM  TSTRPPC                                           07200030
072100          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          07210030
072200            AND (DEST_LOC_NBR  BETWEEN :ASC-STORE-NBR-LOW         07220030
072300                                   AND :ASC-STORE-NBR-HIGH)       07230030
072400            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              07240030
072500                                AND :ASC-DOC-NBR-HIGH)            07250030
072600            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          07260030
072700                                AND :ASC-REASON-CODE-HIGH)        07270030
072800            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            07280030
072900                                AND :ASC-TYPE-CODE-HIGH)          07290030
073000            AND (STATUS_CDE BETWEEN :ASC-STATUS-CODE-LOW          07300030
073100                                AND :ASC-STATUS-CODE-HIGH)        07310030
073200            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                07320030
073300                                AND :ASC-TO-DATE))                07330030
073400          ORDER BY                                                07340030
073500                DEST_LOC_NBR                                      07350030
073600              , CRE_DTE                                           07360030
073700              , DOC_NBR                                           07370030
073800     END-EXEC.                                                    07380030
073900*                                                                 07390030
074000 EJECT                                                            07400030
074100*---------------------------------------------------------------* 07410030
074200*    IN-STORE HEADER CURSOR TO RETRIEVE CURRENT ONLY DATA       * 07420030
074300*    IN THE ORDER SPECIFIED BY THE UNIONS (NO DEPT SPECIFIED)   * 07430030
074400*---------------------------------------------------------------* 07440030
074500                                                                  07450030
074600     EXEC SQL                                                     07460030
074700          DECLARE CURRENT-CSR CURSOR                              07470030
074800          FOR SELECT                                              07480030
074900                '1'                                               07490030
075000              , DEST_LOC_NBR                                      07500030
075100              , DOC_NBR                                           07510030
075200              , RSN_CDE                                           07520030
075300              , TYP_CDE                                           07530030
075400              , STATUS_CDE                                        07540030
075500              , DEPT_AREA_DEST                                    07550030
075600              , CRE_DTE                                           07560030
075700          FROM  TSTRPPC                                           07570030
075800          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          07580030
075900            AND  STATUS_CDE  = :PE049-IS-DELINQUENT-STATUS-CDE    07590030
076000            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          07600030
076100                                  AND :ASC-STORE-NBR-HIGH)        07610030
076200            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              07620030
076300                                AND :ASC-DOC-NBR-HIGH)            07630030
076400            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          07640030
076500                                AND :ASC-REASON-CODE-HIGH)        07650030
076600            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            07660030
076700                                AND :ASC-TYPE-CODE-HIGH)          07670030
076800            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                07680030
076900                                AND :ASC-TO-DATE))                07690030
077000     UNION ALL                                                    07700030
077100          SELECT                                                  07710030
077200                '2'                                               07720030
077300              , DEST_LOC_NBR                                      07730030
077400              , DOC_NBR                                           07740030
077500              , RSN_CDE                                           07750030
077600              , TYP_CDE                                           07760030
077700              , STATUS_CDE                                        07770030
077800              , DEPT_AREA_DEST                                    07780030
077900              , CRE_DTE                                           07790030
078000          FROM  TSTRPPC                                           07800030
078100          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          07810030
078200            AND  STATUS_CDE  = :PE049-IS-AVAILABLE-STATUS-CDE     07820030
078300            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          07830030
078400                                  AND :ASC-STORE-NBR-HIGH)        07840030
078500            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              07850030
078600                                AND :ASC-DOC-NBR-HIGH)            07860030
078700            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          07870030
078800                                AND :ASC-REASON-CODE-HIGH)        07880030
078900            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            07890030
079000                                AND :ASC-TYPE-CODE-HIGH)          07900030
079100            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                07910030
079200                                AND :ASC-TO-DATE))                07920030
079300     UNION ALL                                                    07930030
079400          SELECT                                                  07940030
079500                '3'                                               07950030
079600              , DEST_LOC_NBR                                      07960030
079700              , DOC_NBR                                           07970030
079800              , RSN_CDE                                           07980030
079900              , TYP_CDE                                           07990030
080000              , STATUS_CDE                                        08000030
080100              , DEPT_AREA_DEST                                    08010030
080200              , CRE_DTE                                           08020030
080300          FROM  TSTRPPC                                           08030030
080400          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          08040030
080500            AND  STATUS_CDE  = :PE049-IS-GENERATED-STATUS-CDE     08050030
080600            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          08060030
080700                                  AND :ASC-STORE-NBR-HIGH)        08070030
080800            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              08080030
080900                                AND :ASC-DOC-NBR-HIGH)            08090030
081000            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          08100030
081100                                AND :ASC-REASON-CODE-HIGH)        08110030
081200            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            08120030
081300                                AND :ASC-TYPE-CODE-HIGH)          08130030
081400            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                08140030
081500                                AND :ASC-TO-DATE))                08150030
081600     UNION ALL                                                    08160030
081700          SELECT                                                  08170030
081800                '4'                                               08180030
081900              , DEST_LOC_NBR                                      08190030
082000              , DOC_NBR                                           08200030
082100              , RSN_CDE                                           08210030
082200              , TYP_CDE                                           08220030
082300              , STATUS_CDE                                        08230030
082400              , DEPT_AREA_DEST                                    08240030
082500              , CRE_DTE                                           08250030
082600          FROM  TSTRPPC                                           08260030
082700          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          08270030
082800            AND  STATUS_CDE  = :PE049-IS-CNTS-ENTER-STATUS-CDE    08280030
082900            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          08290030
083000                                  AND :ASC-STORE-NBR-HIGH)        08300030
083100            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              08310030
083200                                AND :ASC-DOC-NBR-HIGH)            08320030
083300            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          08330030
083400                                AND :ASC-REASON-CODE-HIGH)        08340030
083500            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            08350030
083600                                AND :ASC-TYPE-CODE-HIGH)          08360030
083700            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                08370030
083800                                AND :ASC-TO-DATE))                08380030
083900*                                                                 08390030
084000     UNION ALL                                                    08400030
084100          SELECT                                                  08410030
084200                '5'                                               08420030
084300              , DEST_LOC_NBR                                      08430030
084400              , DOC_NBR                                           08440030
084500              , RSN_CDE                                           08450030
084600              , TYP_CDE                                           08460030
084700              , STATUS_CDE                                        08470030
084800              , DEPT_AREA_DEST                                    08480030
084900              , CRE_DTE                                           08490030
085000          FROM  TSTRPPC                                           08500030
085100          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          08510030
085200            AND  STATUS_CDE  = :PE049-IS-CANCELLED-STATUS-CDE     08520030
085300            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          08530030
085400                                  AND :ASC-STORE-NBR-HIGH)        08540030
085500            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              08550030
085600                                AND :ASC-DOC-NBR-HIGH)            08560030
085700            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          08570030
085800                                AND :ASC-REASON-CODE-HIGH)        08580030
085900            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            08590030
086000                                AND :ASC-TYPE-CODE-HIGH)          08600030
086100            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                08610030
086200                                AND :ASC-TO-DATE))                08620030
086300*                                                                 08630030
086400     UNION ALL                                                    08640030
086500          SELECT                                                  08650030
086600                '6'                                               08660030
086700              , DEST_LOC_NBR                                      08670030
086800              , DOC_NBR                                           08680030
086900              , RSN_CDE                                           08690030
087000              , TYP_CDE                                           08700030
087100              , STATUS_CDE                                        08710030
087200              , DEPT_AREA_DEST                                    08720030
087300              , CRE_DTE                                           08730030
087400          FROM  TSTRPPC                                           08740030
087500          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          08750030
087600            AND  STATUS_CDE  = :PE049-IS-COMPLETED-STATUS-CDE     08760030
087700            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          08770030
087800                                  AND :ASC-STORE-NBR-HIGH)        08780030
087900            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              08790030
088000                                AND :ASC-DOC-NBR-HIGH)            08800030
088100            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          08810030
088200                                AND :ASC-REASON-CODE-HIGH)        08820030
088300            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            08830030
088400                                AND :ASC-TYPE-CODE-HIGH)          08840030
088500            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                08850030
088600                                AND :ASC-TO-DATE))                08860030
088700*                                                                 08870030
088800          ORDER BY                                                08880030
088900                1                                                 08890030
089000              , 2                                                 08900030
089100              , 8                                                 08910030
089200              , 3                                                 08920030
089300     END-EXEC.                                                    08930030
089400*                                                                 08940030
089500 EJECT                                                            08950030
089600*---------------------------------------------------------------* 08960030
089700*    IN-STORE HEADER CURSOR TO RETRIEVE BOTH CURRENT AND        * 08970030
089800*    HISTORY DATA IN THE ORDER SPECIFIED BY THE UNIONS (NO DEPT * 08980030
089900*    SPECIFIED)                                                 * 08990030
090000*---------------------------------------------------------------* 09000030
090100                                                                  09010030
090200     EXEC SQL                                                     09020030
090300          DECLARE HIST-CURR-CSR CURSOR                            09030030
090400          FOR SELECT                                              09040030
090500                '1'                                               09050030
090600              , DEST_LOC_NBR                                      09060030
090700              , DOC_NBR                                           09070030
090800              , RSN_CDE                                           09080030
090900              , TYP_CDE                                           09090030
091000              , STATUS_CDE                                        09100030
091100              , DEPT_AREA_DEST                                    09110030
091200              , CRE_DTE                                           09120030
091300          FROM  TSTRPPC                                           09130030
091400          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          09140030
091500            AND  STATUS_CDE  = :PE049-IS-DELINQUENT-STATUS-CDE    09150030
091600            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          09160030
091700                                  AND :ASC-STORE-NBR-HIGH)        09170030
091800            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              09180030
091900                                AND :ASC-DOC-NBR-HIGH)            09190030
092000            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          09200030
092100                                AND :ASC-REASON-CODE-HIGH)        09210030
092200            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            09220030
092300                                AND :ASC-TYPE-CODE-HIGH)          09230030
092400            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                09240030
092500                                AND :ASC-TO-DATE))                09250030
092600     UNION ALL                                                    09260030
092700          SELECT                                                  09270030
092800                '2'                                               09280030
092900              , DEST_LOC_NBR                                      09290030
093000              , DOC_NBR                                           09300030
093100              , RSN_CDE                                           09310030
093200              , TYP_CDE                                           09320030
093300              , STATUS_CDE                                        09330030
093400              , DEPT_AREA_DEST                                    09340030
093500              , CRE_DTE                                           09350030
093600          FROM  TSTRPPC                                           09360030
093700          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          09370030
093800            AND  STATUS_CDE  = :PE049-IS-AVAILABLE-STATUS-CDE     09380030
093900            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          09390030
094000                                  AND :ASC-STORE-NBR-HIGH)        09400030
094100            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              09410030
094200                                AND :ASC-DOC-NBR-HIGH)            09420030
094300            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          09430030
094400                                AND :ASC-REASON-CODE-HIGH)        09440030
094500            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            09450030
094600                                AND :ASC-TYPE-CODE-HIGH)          09460030
094700            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                09470030
094800                                AND :ASC-TO-DATE))                09480030
094900     UNION ALL                                                    09490030
095000          SELECT                                                  09500030
095100                '3'                                               09510030
095200              , DEST_LOC_NBR                                      09520030
095300              , DOC_NBR                                           09530030
095400              , RSN_CDE                                           09540030
095500              , TYP_CDE                                           09550030
095600              , STATUS_CDE                                        09560030
095700              , DEPT_AREA_DEST                                    09570030
095800              , CRE_DTE                                           09580030
095900          FROM  TSTRPPC                                           09590030
096000          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          09600030
096100            AND  STATUS_CDE  = :PE049-IS-GENERATED-STATUS-CDE     09610030
096200            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          09620030
096300                                  AND :ASC-STORE-NBR-HIGH)        09630030
096400            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              09640030
096500                                AND :ASC-DOC-NBR-HIGH)            09650030
096600            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          09660030
096700                                AND :ASC-REASON-CODE-HIGH)        09670030
096800            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            09680030
096900                                AND :ASC-TYPE-CODE-HIGH)          09690030
097000            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                09700030
097100                                AND :ASC-TO-DATE))                09710030
097200     UNION ALL                                                    09720030
097300          SELECT                                                  09730030
097400                '4'                                               09740030
097500              , DEST_LOC_NBR                                      09750030
097600              , DOC_NBR                                           09760030
097700              , RSN_CDE                                           09770030
097800              , TYP_CDE                                           09780030
097900              , STATUS_CDE                                        09790030
098000              , DEPT_AREA_DEST                                    09800030
098100              , CRE_DTE                                           09810030
098200          FROM  TSTRPPC                                           09820030
098300          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          09830030
098400            AND  STATUS_CDE  = :PE049-IS-CNTS-ENTER-STATUS-CDE    09840030
098500            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          09850030
098600                                  AND :ASC-STORE-NBR-HIGH)        09860030
098700            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              09870030
098800                                AND :ASC-DOC-NBR-HIGH)            09880030
098900            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          09890030
099000                                AND :ASC-REASON-CODE-HIGH)        09900030
099100            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            09910030
099200                                AND :ASC-TYPE-CODE-HIGH)          09920030
099300            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                09930030
099400                                AND :ASC-TO-DATE))                09940030
099500*                                                                 09950030
099600     UNION ALL                                                    09960030
099700          SELECT                                                  09970030
099800                '5'                                               09980030
099900              , DEST_LOC_NBR                                      09990030
100000              , DOC_NBR                                           10000030
100100              , RSN_CDE                                           10010030
100200              , TYP_CDE                                           10020030
100300              , STATUS_CDE                                        10030030
100400              , DEPT_AREA_DEST                                    10040030
100500              , CRE_DTE                                           10050030
100600          FROM  TSTRPPC                                           10060030
100700          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          10070030
100800            AND  STATUS_CDE  = :PE049-IS-CANCELLED-STATUS-CDE     10080030
100900            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          10090030
101000                                  AND :ASC-STORE-NBR-HIGH)        10100030
101100            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              10110030
101200                                AND :ASC-DOC-NBR-HIGH)            10120030
101300            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          10130030
101400                                AND :ASC-REASON-CODE-HIGH)        10140030
101500            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            10150030
101600                                AND :ASC-TYPE-CODE-HIGH)          10160030
101700            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                10170030
101800                                AND :ASC-TO-DATE))                10180030
101900*                                                                 10190030
102000     UNION ALL                                                    10200030
102100          SELECT                                                  10210030
102200                '6'                                               10220030
102300              , DEST_LOC_NBR                                      10230030
102400              , DOC_NBR                                           10240030
102500              , RSN_CDE                                           10250030
102600              , TYP_CDE                                           10260030
102700              , STATUS_CDE                                        10270030
102800              , DEPT_AREA_DEST                                    10280030
102900              , CRE_DTE                                           10290030
103000          FROM  TSTRPPC                                           10300030
103100          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          10310030
103200            AND  STATUS_CDE  = :PE049-IS-COMPLETED-STATUS-CDE     10320030
103300            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          10330030
103400                                  AND :ASC-STORE-NBR-HIGH)        10340030
103500            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              10350030
103600                                AND :ASC-DOC-NBR-HIGH)            10360030
103700            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          10370030
103800                                AND :ASC-REASON-CODE-HIGH)        10380030
103900            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            10390030
104000                                AND :ASC-TYPE-CODE-HIGH)          10400030
104100            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                10410030
104200                                AND :ASC-TO-DATE))                10420030
104300     UNION ALL                                                    10430030
104400          SELECT                                                  10440030
104500                '7'                                               10450030
104600              , DEST_LOC_NBR                                      10460030
104700              , DOC_NBR                                           10470030
104800              , RSN_CDE                                           10480030
104900              , TYP_CDE                                           10490030
105000              , STATUS_CDE                                        10500030
105100              , DEPT_AREA_DEST                                    10510030
105200              , CRE_DTE                                           10520030
105300          FROM  TSTRPCH                                           10530030
105400          WHERE (DOC_TYP_CDE = :PE049-STORE-DOC-TYPE-CDE          10540030
105500            AND  STATUS_CDE  = :PE049-IS-HISTORY-STATUS-CDE       10550030
105600            AND (DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW          10560030
105700                                  AND :ASC-STORE-NBR-HIGH)        10570030
105800            AND (DOC_NBR    BETWEEN :ASC-DOC-NBR-LOW              10580030
105900                                AND :ASC-DOC-NBR-HIGH)            10590030
106000            AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW          10600030
106100                                AND :ASC-REASON-CODE-HIGH)        10610030
106200            AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW            10620030
106300                                AND :ASC-TYPE-CODE-HIGH)          10630030
106400            AND (EFF_DTE    BETWEEN :ASC-FROM-DATE                10640030
106500                                AND :ASC-TO-DATE))                10650030
106600*                                                                 10660030
106700          ORDER BY                                                10670030
106800                1                                                 10680030
106900              , 2                                                 10690030
107000              , 8                                                 10700030
107100              , 3                                                 10710030
107200     END-EXEC.                                                    10720030
107300*                                                                 10730030
107400 EJECT                                                            10740030
107500*---------------------------------------------------------------* 10750030
107600*    IN-STORE HEADER CURSOR TO RETRIEVE CURRENT DATA IN THE     * 10760030
107700*    ORDER SPECIFIED BY THE UNIONS. (DEPT IS SPECIFIED)         * 10770030
107800*---------------------------------------------------------------* 10780030
107900                                                                  10790030
108000     EXEC SQL                                                     10800030
108100          DECLARE CURRENT-DEPT-CSR CURSOR                         10810030
108200          FOR SELECT                                              10820030
108300                '1'                                               10830030
108400              , DEST_LOC_NBR                                      10840030
108500              , DOC_NBR                                           10850030
108600              , RSN_CDE                                           10860030
108700              , TYP_CDE                                           10870030
108800              , STATUS_CDE                                        10880030
108900              , DEPT_AREA_DEST                                    10890030
109000              , CRE_DTE                                           10900030
109100          FROM  TSTRPPC                                           10910030
109200          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      10920030
109300                FROM TSTRPPC H,                                   10930030
109400                     TSPPCDT D                                    10940030
109500                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    10950030
109600                  AND STATUS_CDE   =                              10960030
109700                                   :PE049-IS-DELINQUENT-STATUS-CDE10970030
109800                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  10980030
109900                                          AND :ASC-STORE-NBR-HIGH)10990030
110000                  AND H.DEST_LOC_NBR =  D.DEST_LOC_NBR            11000030
110100                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        11010030
110200                                      AND :ASC-DOC-NBR-HIGH)      11020030
110300                  AND H.DOC_NBR    =  D.DOC_NBR                   11030030
110400                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    11040030
110500                                      AND :ASC-REASON-CODE-HIGH)  11050030
110600                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      11060030
110700                                      AND :ASC-TYPE-CODE-HIGH)    11070030
110800                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          11080030
110900                                      AND :ASC-TO-DATE)           11090030
111000                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       11100030
111100                                      AND :ASC-DEPT-NBR-HIGH))    11110030
111200*                                                                 11120030
111300     UNION ALL                                                    11130030
111400          SELECT                                                  11140030
111500                '2'                                               11150030
111600              , DEST_LOC_NBR                                      11160030
111700              , DOC_NBR                                           11170030
111800              , RSN_CDE                                           11180030
111900              , TYP_CDE                                           11190030
112000              , STATUS_CDE                                        11200030
112100              , DEPT_AREA_DEST                                    11210030
112200              , CRE_DTE                                           11220030
112300          FROM  TSTRPPC                                           11230030
112400          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      11240030
112500                FROM TSTRPPC H,                                   11250030
112600                     TSPPCDT D                                    11260030
112700                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    11270030
112800                  AND STATUS_CDE   =                              11280030
112900                                   :PE049-IS-AVAILABLE-STATUS-CDE 11290030
113000                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  11300030
113100                                          AND :ASC-STORE-NBR-HIGH)11310030
113200                  AND H.DEST_LOC_NBR =  D.DEST_LOC_NBR            11320030
113300                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        11330030
113400                                      AND :ASC-DOC-NBR-HIGH)      11340030
113500                  AND H.DOC_NBR    =  D.DOC_NBR                   11350030
113600                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    11360030
113700                                      AND :ASC-REASON-CODE-HIGH)  11370030
113800                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      11380030
113900                                      AND :ASC-TYPE-CODE-HIGH)    11390030
114000                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          11400030
114100                                      AND :ASC-TO-DATE)           11410030
114200                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       11420030
114300                                      AND :ASC-DEPT-NBR-HIGH))    11430030
114400*                                                                 11440030
114500     UNION ALL                                                    11450030
114600          SELECT                                                  11460030
114700                '3'                                               11470030
114800              , DEST_LOC_NBR                                      11480030
114900              , DOC_NBR                                           11490030
115000              , RSN_CDE                                           11500030
115100              , TYP_CDE                                           11510030
115200              , STATUS_CDE                                        11520030
115300              , DEPT_AREA_DEST                                    11530030
115400              , CRE_DTE                                           11540030
115500          FROM  TSTRPPC                                           11550030
115600          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      11560030
115700                FROM TSTRPPC H,                                   11570030
115800                     TSPPCDT D                                    11580030
115900                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    11590030
116000                  AND STATUS_CDE   =                              11600030
116100                                   :PE049-IS-GENERATED-STATUS-CDE 11610030
116200                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  11620030
116300                                          AND :ASC-STORE-NBR-HIGH)11630030
116400                  AND H.DEST_LOC_NBR =  D.DEST_LOC_NBR            11640030
116500                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        11650030
116600                                      AND :ASC-DOC-NBR-HIGH)      11660030
116700                  AND H.DOC_NBR    =  D.DOC_NBR                   11670030
116800                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    11680030
116900                                      AND :ASC-REASON-CODE-HIGH)  11690030
117000                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      11700030
117100                                      AND :ASC-TYPE-CODE-HIGH)    11710030
117200                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          11720030
117300                                      AND :ASC-TO-DATE)           11730030
117400                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       11740030
117500                                      AND :ASC-DEPT-NBR-HIGH))    11750030
117600*                                                                 11760030
117700     UNION ALL                                                    11770030
117800          SELECT                                                  11780030
117900                '4'                                               11790030
118000              , DEST_LOC_NBR                                      11800030
118100              , DOC_NBR                                           11810030
118200              , RSN_CDE                                           11820030
118300              , TYP_CDE                                           11830030
118400              , STATUS_CDE                                        11840030
118500              , DEPT_AREA_DEST                                    11850030
118600              , CRE_DTE                                           11860030
118700          FROM  TSTRPPC                                           11870030
118800          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      11880030
118900                FROM TSTRPPC H,                                   11890030
119000                     TSPPCDT D                                    11900030
119100                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    11910030
119200                  AND STATUS_CDE   =                              11920030
119300                                   :PE049-IS-CNTS-ENTER-STATUS-CDE11930030
119400                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  11940030
119500                                          AND :ASC-STORE-NBR-HIGH)11950030
119600                  AND H.DEST_LOC_NBR =  D.DEST_LOC_NBR            11960030
119700                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        11970030
119800                                      AND :ASC-DOC-NBR-HIGH)      11980030
119900                  AND H.DOC_NBR    =  D.DOC_NBR                   11990030
120000                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    12000030
120100                                      AND :ASC-REASON-CODE-HIGH)  12010030
120200                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      12020030
120300                                      AND :ASC-TYPE-CODE-HIGH)    12030030
120400                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          12040030
120500                                      AND :ASC-TO-DATE)           12050030
120600                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       12060030
120700                                      AND :ASC-DEPT-NBR-HIGH))    12070030
120800*                                                                 12080030
120900     UNION ALL                                                    12090030
121000          SELECT                                                  12100030
121100                '5'                                               12110030
121200              , DEST_LOC_NBR                                      12120030
121300              , DOC_NBR                                           12130030
121400              , RSN_CDE                                           12140030
121500              , TYP_CDE                                           12150030
121600              , STATUS_CDE                                        12160030
121700              , DEPT_AREA_DEST                                    12170030
121800              , CRE_DTE                                           12180030
121900          FROM  TSTRPPC                                           12190030
122000          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      12200030
122100                FROM TSTRPPC H,                                   12210030
122200                     TSPPCDT D                                    12220030
122300                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    12230030
122400                  AND STATUS_CDE   =                              12240030
122500                                   :PE049-IS-CANCELLED-STATUS-CDE 12250030
122600                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  12260030
122700                                          AND :ASC-STORE-NBR-HIGH)12270030
122800                  AND H.DEST_LOC_NBR =  D.DEST_LOC_NBR            12280030
122900                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        12290030
123000                                      AND :ASC-DOC-NBR-HIGH)      12300030
123100                  AND H.DOC_NBR    =  D.DOC_NBR                   12310030
123200                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    12320030
123300                                      AND :ASC-REASON-CODE-HIGH)  12330030
123400                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      12340030
123500                                      AND :ASC-TYPE-CODE-HIGH)    12350030
123600                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          12360030
123700                                      AND :ASC-TO-DATE)           12370030
123800                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       12380030
123900                                      AND :ASC-DEPT-NBR-HIGH))    12390030
124000*                                                                 12400030
124100     UNION ALL                                                    12410030
124200          SELECT                                                  12420030
124300                '6'                                               12430030
124400              , DEST_LOC_NBR                                      12440030
124500              , DOC_NBR                                           12450030
124600              , RSN_CDE                                           12460030
124700              , TYP_CDE                                           12470030
124800              , STATUS_CDE                                        12480030
124900              , DEPT_AREA_DEST                                    12490030
125000              , CRE_DTE                                           12500030
125100          FROM  TSTRPPC                                           12510030
125200          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      12520030
125300                FROM TSTRPPC H,                                   12530030
125400                     TSPPCDT D                                    12540030
125500                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    12550030
125600                  AND STATUS_CDE   =                              12560030
125700                                   :PE049-IS-COMPLETED-STATUS-CDE 12570030
125800                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  12580030
125900                                          AND :ASC-STORE-NBR-HIGH)12590030
126000                  AND H.DEST_LOC_NBR =  D.DEST_LOC_NBR            12600030
126100                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        12610030
126200                                      AND :ASC-DOC-NBR-HIGH)      12620030
126300                  AND H.DOC_NBR    =  D.DOC_NBR                   12630030
126400                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    12640030
126500                                      AND :ASC-REASON-CODE-HIGH)  12650030
126600                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      12660030
126700                                      AND :ASC-TYPE-CODE-HIGH)    12670030
126800                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          12680030
126900                                      AND :ASC-TO-DATE)           12690030
127000                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       12700030
127100                                      AND :ASC-DEPT-NBR-HIGH))    12710030
127200*                                                                 12720030
127300          ORDER BY                                                12730030
127400                1                                                 12740030
127500              , 2                                                 12750030
127600              , 8                                                 12760030
127700              , 3                                                 12770030
127800     END-EXEC.                                                    12780030
127900*                                                                 12790030
128000 EJECT                                                            12800030
128100*---------------------------------------------------------------* 12810030
128200*    IN-STORE HEADER CURSOR TO RETRIEVE CURRENT AND HISTORY DATA* 12820030
128300*    IN THE ORDER SPECIFIED BY THE UNIONS.  (DEPT IS SPECIFIED) * 12830030
128400*---------------------------------------------------------------* 12840030
128500                                                                  12850030
128600     EXEC SQL                                                     12860030
128700          DECLARE HIST-CURR-DEPT-CSR CURSOR                       12870030
128800          FOR SELECT                                              12880030
128900                '1'                                               12890030
129000              , DEST_LOC_NBR                                      12900030
129100              , DOC_NBR                                           12910030
129200              , RSN_CDE                                           12920030
129300              , TYP_CDE                                           12930030
129400              , STATUS_CDE                                        12940030
129500              , DEPT_AREA_DEST                                    12950030
129600              , CRE_DTE                                           12960030
129700          FROM  TSTRPPC                                           12970030
129800          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      12980030
129900                FROM TSTRPPC H,                                   12990030
130000                     TSPPCDT D                                    13000030
130100                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    13010030
130200                  AND STATUS_CDE   =                              13020030
130300                                   :PE049-IS-DELINQUENT-STATUS-CDE13030030
130400                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  13040030
130500                                          AND :ASC-STORE-NBR-HIGH)13050030
130600                  AND H.DEST_LOC_NBR =  D.DEST_LOC_NBR            13060030
130700                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        13070030
130800                                      AND :ASC-DOC-NBR-HIGH)      13080030
130900                  AND H.DOC_NBR    =  D.DOC_NBR                   13090030
131000                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    13100030
131100                                      AND :ASC-REASON-CODE-HIGH)  13110030
131200                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      13120030
131300                                      AND :ASC-TYPE-CODE-HIGH)    13130030
131400                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          13140030
131500                                      AND :ASC-TO-DATE)           13150030
131600                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       13160030
131700                                      AND :ASC-DEPT-NBR-HIGH))    13170030
131800*                                                                 13180030
131900     UNION ALL                                                    13190030
132000          SELECT                                                  13200030
132100                '2'                                               13210030
132200              , DEST_LOC_NBR                                      13220030
132300              , DOC_NBR                                           13230030
132400              , RSN_CDE                                           13240030
132500              , TYP_CDE                                           13250030
132600              , STATUS_CDE                                        13260030
132700              , DEPT_AREA_DEST                                    13270030
132800              , CRE_DTE                                           13280030
132900          FROM  TSTRPPC                                           13290030
133000          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      13300030
133100                FROM TSTRPPC H,                                   13310030
133200                     TSPPCDT D                                    13320030
133300                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    13330030
133400                  AND STATUS_CDE   =                              13340030
133500                                   :PE049-IS-AVAILABLE-STATUS-CDE 13350030
133600                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  13360030
133700                                          AND :ASC-STORE-NBR-HIGH)13370030
133800                  AND H.DEST_LOC_NBR =  D.DEST_LOC_NBR            13380030
133900                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        13390030
134000                                      AND :ASC-DOC-NBR-HIGH)      13400030
134100                  AND H.DOC_NBR    =  D.DOC_NBR                   13410030
134200                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    13420030
134300                                      AND :ASC-REASON-CODE-HIGH)  13430030
134400                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      13440030
134500                                      AND :ASC-TYPE-CODE-HIGH)    13450030
134600                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          13460030
134700                                      AND :ASC-TO-DATE)           13470030
134800                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       13480030
134900                                      AND :ASC-DEPT-NBR-HIGH))    13490030
135000*                                                                 13500030
135100     UNION ALL                                                    13510030
135200          SELECT                                                  13520030
135300                '3'                                               13530030
135400              , DEST_LOC_NBR                                      13540030
135500              , DOC_NBR                                           13550030
135600              , RSN_CDE                                           13560030
135700              , TYP_CDE                                           13570030
135800              , STATUS_CDE                                        13580030
135900              , DEPT_AREA_DEST                                    13590030
136000              , CRE_DTE                                           13600030
136100          FROM  TSTRPPC                                           13610030
136200          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      13620030
136300                FROM TSTRPPC H,                                   13630030
136400                     TSPPCDT D                                    13640030
136500                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    13650030
136600                  AND STATUS_CDE   =                              13660030
136700                                   :PE049-IS-GENERATED-STATUS-CDE 13670030
136800                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  13680030
136900                                          AND :ASC-STORE-NBR-HIGH)13690030
137000                  AND H.DEST_LOC_NBR = D.DEST_LOC_NBR             13700030
137100                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        13710030
137200                                      AND :ASC-DOC-NBR-HIGH)      13720030
137300                  AND H.DOC_NBR    = D.DOC_NBR                    13730030
137400                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    13740030
137500                                      AND :ASC-REASON-CODE-HIGH)  13750030
137600                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      13760030
137700                                      AND :ASC-TYPE-CODE-HIGH)    13770030
137800                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          13780030
137900                                      AND :ASC-TO-DATE)           13790030
138000                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       13800030
138100                                      AND :ASC-DEPT-NBR-HIGH))    13810030
138200*                                                                 13820030
138300     UNION ALL                                                    13830030
138400          SELECT                                                  13840030
138500                '4'                                               13850030
138600              , DEST_LOC_NBR                                      13860030
138700              , DOC_NBR                                           13870030
138800              , RSN_CDE                                           13880030
138900              , TYP_CDE                                           13890030
139000              , STATUS_CDE                                        13900030
139100              , DEPT_AREA_DEST                                    13910030
139200              , CRE_DTE                                           13920030
139300          FROM  TSTRPPC                                           13930030
139400          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      13940030
139500                FROM TSTRPPC H,                                   13950030
139600                     TSPPCDT D                                    13960030
139700                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    13970030
139800                  AND STATUS_CDE   =                              13980030
139900                                   :PE049-IS-CNTS-ENTER-STATUS-CDE13990030
140000                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  14000030
140100                                          AND :ASC-STORE-NBR-HIGH)14010030
140200                  AND H.DEST_LOC_NBR =  D.DEST_LOC_NBR            14020030
140300                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        14030030
140400                                      AND :ASC-DOC-NBR-HIGH)      14040030
140500                  AND H.DOC_NBR    =  D.DOC_NBR                   14050030
140600                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    14060030
140700                                      AND :ASC-REASON-CODE-HIGH)  14070030
140800                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      14080030
140900                                      AND :ASC-TYPE-CODE-HIGH)    14090030
141000                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          14100030
141100                                      AND :ASC-TO-DATE)           14110030
141200                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       14120030
141300                                      AND :ASC-DEPT-NBR-HIGH))    14130030
141400*                                                                 14140030
141500     UNION ALL                                                    14150030
141600          SELECT                                                  14160030
141700                '5'                                               14170030
141800              , DEST_LOC_NBR                                      14180030
141900              , DOC_NBR                                           14190030
142000              , RSN_CDE                                           14200030
142100              , TYP_CDE                                           14210030
142200              , STATUS_CDE                                        14220030
142300              , DEPT_AREA_DEST                                    14230030
142400              , CRE_DTE                                           14240030
142500          FROM  TSTRPPC                                           14250030
142600          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      14260030
142700                FROM TSTRPPC H,                                   14270030
142800                     TSPPCDT D                                    14280030
142900                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    14290030
143000                  AND STATUS_CDE   =                              14300030
143100                                   :PE049-IS-CANCELLED-STATUS-CDE 14310030
143200                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  14320030
143300                                          AND :ASC-STORE-NBR-HIGH)14330030
143400                  AND H.DEST_LOC_NBR =  D.DEST_LOC_NBR            14340030
143500                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        14350030
143600                                      AND :ASC-DOC-NBR-HIGH)      14360030
143700                  AND H.DOC_NBR    =  D.DOC_NBR                   14370030
143800                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    14380030
143900                                      AND :ASC-REASON-CODE-HIGH)  14390030
144000                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      14400030
144100                                      AND :ASC-TYPE-CODE-HIGH)    14410030
144200                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          14420030
144300                                      AND :ASC-TO-DATE)           14430030
144400                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       14440030
144500                                      AND :ASC-DEPT-NBR-HIGH))    14450030
144600*                                                                 14460030
144700     UNION ALL                                                    14470030
144800          SELECT                                                  14480030
144900                '6'                                               14490030
145000              , DEST_LOC_NBR                                      14500030
145100              , DOC_NBR                                           14510030
145200              , RSN_CDE                                           14520030
145300              , TYP_CDE                                           14530030
145400              , STATUS_CDE                                        14540030
145500              , DEPT_AREA_DEST                                    14550030
145600              , CRE_DTE                                           14560030
145700          FROM  TSTRPPC                                           14570030
145800          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      14580030
145900                FROM TSTRPPC H,                                   14590030
146000                     TSPPCDT D                                    14600030
146100                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    14610030
146200                  AND STATUS_CDE   =                              14620030
146300                                   :PE049-IS-COMPLETED-STATUS-CDE 14630030
146400                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  14640030
146500                                          AND :ASC-STORE-NBR-HIGH)14650030
146600                  AND H.DEST_LOC_NBR =  D.DEST_LOC_NBR            14660030
146700                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        14670030
146800                                      AND :ASC-DOC-NBR-HIGH)      14680030
146900                  AND H.DOC_NBR    =  D.DOC_NBR                   14690030
147000                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    14700030
147100                                      AND :ASC-REASON-CODE-HIGH)  14710030
147200                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      14720030
147300                                      AND :ASC-TYPE-CODE-HIGH)    14730030
147400                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          14740030
147500                                      AND :ASC-TO-DATE)           14750030
147600                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       14760030
147700                                      AND :ASC-DEPT-NBR-HIGH))    14770030
147800*                                                                 14780030
147900     UNION ALL                                                    14790030
148000          SELECT                                                  14800030
148100                '7'                                               14810030
148200              , DEST_LOC_NBR                                      14820030
148300              , DOC_NBR                                           14830030
148400              , RSN_CDE                                           14840030
148500              , TYP_CDE                                           14850030
148600              , STATUS_CDE                                        14860030
148700              , DEPT_AREA_DEST                                    14870030
148800              , CRE_DTE                                           14880030
148900          FROM  TSTRPCH                                           14890030
149000          WHERE DOC_NBR IN (SELECT D.DOC_NBR                      14900030
149100                FROM TSTRPCH H,                                   14910030
149200                     TSPCDTH D                                    14920030
149300                WHERE DOC_TYP_CDE  = :PE049-STORE-DOC-TYPE-CDE    14930030
149400                  AND STATUS_CDE   =                              14940030
149500                                   :PE049-IS-COMPLETED-STATUS-CDE 14950030
149600                  AND (H.DEST_LOC_NBR BETWEEN :ASC-STORE-NBR-LOW  14960030
149700                                          AND :ASC-STORE-NBR-HIGH)14970030
149800                  AND H.DEST_LOC_NBR =  D.DEST_LOC_NBR            14980030
149900                  AND (H.DOC_NBR  BETWEEN :ASC-DOC-NBR-LOW        14990030
150000                                      AND :ASC-DOC-NBR-HIGH)      15000030
150100                  AND H.DOC_NBR    =  D.DOC_NBR                   15010030
150200                  AND (RSN_CDE    BETWEEN :ASC-REASON-CODE-LOW    15020030
150300                                      AND :ASC-REASON-CODE-HIGH)  15030030
150400                  AND (TYP_CDE    BETWEEN :ASC-TYPE-CODE-LOW      15040030
150500                                      AND :ASC-TYPE-CODE-HIGH)    15050030
150600                  AND (EFF_DTE    BETWEEN :ASC-FROM-DATE          15060030
150700                                      AND :ASC-TO-DATE)           15070030
150800                  AND (DEPT_NBR   BETWEEN :ASC-DEPT-NBR-LOW       15080030
150900                                      AND :ASC-DEPT-NBR-HIGH))    15090030
151000*                                                                 15100030
151100          ORDER BY                                                15110030
151200                1                                                 15120030
151300              , 2                                                 15130030
151400              , 8                                                 15140030
151500              , 3                                                 15150030
151600     END-EXEC.                                                    15160030
151700*                                                                 15170030
151800 EJECT                                                            15180030
151900 LINKAGE SECTION.                                                 15190030
152000                                                                  15200030
152100 01  DFHCOMMAREA.                                                 15210030
152200     05  FILLER                         OCCURS  1 TO 4072 TIMES   15220030
152300                                        DEPENDING ON EIBCALEN.    15230030
152400         10  FILLER                     PIC X.                    15240030
152500                                                                  15250030
152600*                                                                 15260030
152700 EJECT                                                            15270030
152800 PROCEDURE DIVISION.                                              15280030
152900******************************************************************15290030
153000**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **15300030
153100**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **15310030
153200**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **15320030
153300******************************************************************15330030
153400 0000-MAIN-MODULE.                                                15340030
153500     INITIALIZE DP030-CICS-API-FIELDS.                            15350030
153600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       15360030
153700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          15370030
153800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         15380030
153900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       15390030
154000     MOVE LENGTH OF PE195AI        TO DP030-MAP-LENGTH (1).       15400030
154100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     15410030
154200     SET DP030-OVERRIDE-APPL-ERROR TO TRUE.                       15420030
154300     PERFORM 0001-CALL-CICS-ARCH-API.                             15430030
154400*                                                                 15440030
154500     PERFORM 1000-CONTROL-PROCESSING                              15450030
154600*                                                                 15460030
154700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     15470030
154800     PERFORM 0001-CALL-CICS-ARCH-API.                             15480030
154900                                                                  15490030
155000******************************************************************15500030
155100**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **15510030
155200**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **15520030
155300******************************************************************15530030
155400 0001-CALL-CICS-ARCH-API.                                         15540030
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      15550034
155600                                    DFHCOMMAREA                   15560034
155700                                    DP030-CICS-API-FIELDS         15570034
155800                                    DP020-STANDARD-COMMAREA       15580034
155900                                    PE195AI.                      15590034
156000*                                                                 15600030
156100     IF (DP030-RC-CALL-SUCCESSFUL                                 15610030
156200      OR DP030-RC-APPL-ERROR)                                     15620030
156300         CONTINUE                                                 15630030
156400     ELSE                                                         15640030
156500         SET DP013-NO-ROLLBACK                                    15650030
156600             DP013-XCTL-DISPLAY-RESTART                           15660030
156700             DP013-CICS-ABEND      TO TRUE                        15670030
156800         MOVE '0001-CALL-CICS-ARCH-API'                           15680030
156900                                   TO DP013-PARAGRAPH             15690030
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O15700034
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      15710034
157200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      15720030
157300         PERFORM DP013-0000-PROCESS-ABEND                         15730030
157400     END-IF.                                                      15740030
157500*                                                                 15750030
157600 EJECT                                                            15760030
157700*----------------------------------------------------------------*15770030
157800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *15780030
157900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *15790030
158000*                                                                *15800030
158100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *15810030
158200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *15820030
158300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *15830030
158400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *15840030
158500*----------------------------------------------------------------*15850030
158600                                                                  15860030
158700 1000-CONTROL-PROCESSING.                                         15870030
158800                                                                  15880030
158900     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       15890030
159000     SET DP017-EDITED-YMD-DATE-DASH-1                             15900030
159100         DP017-EDITED-YMD-DATE-DASH-2                             15910030
159200                                  TO TRUE.                        15920030
159300     MOVE DP017-EDITED-DATE-YYYYMMDD                              15930030
159400                                  TO DK-CURRENT-DATE-ISO.         15940030
159500     EVALUATE TRUE                                                15950030
159600         WHEN DP030-RC-APPL-ERROR                                 15960030
159700*  THE API WILL DEFAULT TO SEND-MAP-AND-DATA, AND ERASE THE MAP   15970030
159800*  CURRENTLY ON THE SCREEN, WHEN RC-APPL-ERROR IS TRUE            15980030
159900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        15990030
160000                                   TO PV-TOP-ITEM                 16000030
160100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    16010030
160200             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 16020030
160300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   16030030
160400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16040030
160500                                                                  16050030
160600         WHEN DP020-NEXT-ACT-INITIAL                              16060030
160700             INITIALIZE ASC-SPECIFIC-COMMAREA                     16070030
160800             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            16080030
160900                                      ASC-SEL-TERM-ID             16090030
161000             MOVE DP020-SRC-TASK-NUMBER                           16100030
161100                                   TO ASC-LIST-TASK-NUMBER        16110030
161200                                      ASC-SEL-TASK-NUMBER         16120030
161300             MOVE PC-LIST-QUEUE-SEQ                               16130030
161400                                   TO ASC-LIST-SEQ                16140030
161500             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 16150030
161600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 16160030
161700***-----$TEMPLATE NOTE$-------------------------------------------16170030
161800*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,16180030
161900*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  16190030
162000*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.16200030
162100***---------------------------------------------------------------16210030
162200             IF  PS-COMMAREA-NOT-VALID                            16220030
162300                 MOVE PC-TSYMSG-99901                             16230030
162400                                   TO DP020-MSG-NUMBER            16240030
162500                 SET DP020-MSG-FATAL                              16250030
162600                                   TO TRUE                        16260030
162700                 SET DP020-NEXT-ACT-APPL-ERROR                    16270030
162800                                   TO TRUE                        16280030
162900             ELSE                                                 16290030
163000                 IF PS-NO-ERROR                                   16300030
163100                     PERFORM 4000-BUILD-INITIAL-PANEL             16310030
163200                 END-IF                                           16320030
163300             END-IF                                               16330030
163400                                                                  16340030
163500         WHEN DP020-NEXT-ACT-READ-MAP                             16350030
163600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        16360030
163700                                   TO PV-TOP-ITEM                 16370030
163800             PERFORM 2000-PROCESS-PANEL                           16380030
163900                                                                  16390030
164000         WHEN DP020-NEXT-ACT-RETURN                               16400030
164100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        16410030
164200                                   TO PV-TOP-ITEM                 16420030
164300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    16430030
164400             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 16440030
164500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   16450030
164600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16460030
164700                                                                  16470030
164800                                                                  16480030
164900         WHEN OTHER                                               16490030
165000             SET DP013-LOGIC-ABEND TO TRUE                        16500030
165100             SET DP013-NO-ROLLBACK TO TRUE                        16510030
165200             MOVE '1000-CONTROL-PROCESSING'                       16520030
165300                                   TO DP013-PARAGRAPH             16530030
165400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    16540030
165500                                   TO DP013-MESSAGE-TEXT(1)       16550030
165600             PERFORM DP013-0000-PROCESS-ABEND                     16560030
165700     END-EVALUATE.                                                16570030
165800*                                                                 16580030
165900 EJECT                                                            16590030
166000*----------------------------------------------------------------*16600030
166100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *16610030
166200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *16620030
166300*----------------------------------------------------------------*16630030
166400                                                                  16640030
166500 1100-PROCESS-INTER-APPL-COMM.                                    16650030
166600                                                                  16660030
166700     SET PS-COMMAREA-VALID         TO TRUE.                       16670030
166800     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     16680030
166900     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          16690030
167000         MOVE PE064-STORE-NUMBER   TO ASC-KEY-STORE-NBR-N         16700030
167100         MOVE PE064-DOCUMENT-NUMBER                               16710030
167200                                   TO ASC-KEY-DOC-NBR             16720030
167300         MOVE ZEROES               TO ASC-KEY-DEPT-NBR-X          16730030
167400         MOVE PE064-DEPT-NUMBER    TO ASC-KEY-DEPT-NBR            16740030
167500         MOVE PE064-STATUS-CODE    TO ASC-KEY-STATUS-CODE         16750030
167600         MOVE PE064-REASON-CODE    TO ASC-KEY-REASON-CODE         16760030
167700         MOVE PE064-DATE-FROM      TO ASC-KEY-FROM-DATE           16770030
167800         MOVE PE064-DATE-TO        TO ASC-KEY-TO-DATE             16780030
167900         IF (ASC-KEY-STORE-NBR NOT = SPACES                       16790030
168000         AND ASC-KEY-DOC-NBR   NOT = SPACES)                      16800030
168100             MOVE ASC-KEY-DOC-NBR-N                               16810030
168200                                   TO DK-DOC-NBR                  16820030
168300             MOVE ASC-KEY-STORE-NBR-N                             16830030
168400                                   TO DK-STORE-NBR                16840030
168500             PERFORM 1200-VALIDATE-STORE-DOC                      16850030
168600             IF SQLCODE = +100                                    16860030
168700                 SET PS-ERROR                                     16870030
168800                     DP020-MSG-FATAL                              16880030
168900                     DP020-NEXT-ACT-APPL-ERROR                    16890030
169000                                   TO TRUE                        16900030
169100                 MOVE PC-TSYMSG-00283                             16910030
169200                                   TO DP020-MSG-NUMBER            16920030
169300             END-IF                                               16930030
169400         END-IF                                                   16940030
169500                                                                  16950030
169600         IF  (ASC-KEY-STORE-NBR     = SPACES                      16960030
169700          AND PE064-DOCUMENT-NUMBER = SPACES                      16970030
169800          AND PE064-DEPT-NUMBER     = SPACES                      16980030
169900          AND PE064-STATUS-CODE     = SPACES                      16990030
170000          AND PE064-REASON-CODE     = SPACES                      17000030
170100          AND PE064-DATE-FROM       = SPACES                      17010030
170200          AND PE064-DATE-TO         = SPACES)                     17020030
170300             SET PS-ERROR                                         17030030
170400                 DP020-MSG-FATAL                                  17040030
170500                 DP020-NEXT-ACT-APPL-ERROR                        17050030
170600                                   TO TRUE                        17060030
170700             MOVE PC-TSYMSG-00508                                 17070030
170800                                   TO DP020-MSG-NUMBER            17080030
170900         END-IF                                                   17090030
171000     END-IF.                                                      17100030
171100*                                                                 17110030
171200 EJECT                                                            17120030
171300*----------------------------------------------------------------*17130030
171400* DETERMINE IF THE STORE AND DOCUMENT PASSED TO THE LIST WAS     *17140030
171500* VALID.                                                         *17150030
171600*----------------------------------------------------------------*17160030
171700                                                                  17170030
171800 1200-VALIDATE-STORE-DOC.                                         17180030
171900                                                                  17190030
172000     PERFORM                                                      17200030
172100         WITH TEST AFTER                                          17210030
172200         VARYING PV-RETRY-COUNTER                                 17220030
172300         FROM 1 BY 1                                              17230030
172400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17240030
172500                 OR (SQLCODE      = ZERO)                         17250030
172600                 OR (SQLCODE      = +100))                        17260030
172700         EXEC SQL                                                 17270030
172800             SELECT DOC_NBR                                       17280030
172900             INTO  :STRPPC-DOC-NBR                                17290030
173000             FROM  TSTRPPC                                        17300030
173100             WHERE (DEST_LOC_NBR  = :DK-STORE-NBR                 17310030
173200               AND  DOC_NBR       = :DK-DOC-NBR                   17320030
173300               AND  DOC_TYP_CDE   = :PE049-STORE-DOC-TYPE-CDE)    17330030
173400         END-EXEC                                                 17340030
173500                                                                  17350030
173600         EVALUATE TRUE                                            17360030
173700             WHEN SQLCODE = ZERO                                  17370030
173800             WHEN SQLCODE = +100                                  17380030
173900             WHEN SQLCODE = -904                                  17390030
174000             WHEN SQLCODE = -913                                  17400030
174100                 CONTINUE                                         17410030
174200             WHEN SQLWARN0 NOT = SPACES                           17420030
174300             WHEN SQLCODE < ZERO                                  17430030
174400             WHEN SQLCODE > ZERO                                  17440030
174500                 MOVE '1200-VALIDATE-STORE-DOC'                   17450030
174600                                   TO DP013-PARAGRAPH             17460030
174700                 MOVE 'VALIDATE THE STORE/DOC IS ON TSTRPPC'      17470030
174800                                   TO DP013-MESSAGE-TEXT (1)      17480030
174900                 MOVE SQLCA        TO DP013-SQLCA                 17490030
175000                 SET DP013-DB2-ABEND                              17500030
175100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17510030
175200                 PERFORM DP013-0000-PROCESS-ABEND                 17520030
175300         END-EVALUATE                                             17530030
175400     END-PERFORM.                                                 17540030
175500*                                                                 17550030
175600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17560030
175700         MOVE '1200-VALIDATE-STORE-DOC'                           17570030
175800                                   TO DP013-PARAGRAPH             17580030
175900         MOVE 'MAX RETRIES EXCEEDED - TSTRPPC FETCH STR/DOC'      17590030
176000                                   TO DP013-MESSAGE-TEXT (1)      17600030
176100         MOVE SQLCA                TO DP013-SQLCA                 17610030
176200         SET DP013-DB2-ABEND                                      17620030
176300             DP013-XCTL-DISPLAY-RESTART                           17630030
176400                                   TO TRUE                        17640030
176500         PERFORM DP013-0000-PROCESS-ABEND                         17650030
176600     END-IF.                                                      17660030
176700*                                                                 17670030
176800 EJECT                                                            17680030
176900*----------------------------------------------------------------*17690030
177000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *17700030
177100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *17710030
177200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *17720030
177300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *17730030
177400* FUNCTION KEYS CAN GET THIS FAR.                                *17740030
177500*----------------------------------------------------------------*17750030
177600                                                                  17760030
177700 2000-PROCESS-PANEL.                                              17770030
177800     EVALUATE TRUE                                                17780030
177900         WHEN DP020-SRC-AID = DP016-CLEAR                         17790030
178000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    17800030
178100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   17810030
178200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 17820030
178300                                                                  17830030
178400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    17840030
178500             PERFORM 2050-DELETE-LIST-QUEUE                       17850030
178600             PERFORM 4000-BUILD-INITIAL-PANEL                     17860030
178700                                                                  17870030
178800         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    17880030
178900             PERFORM 2140-DESELECT-ALL-ITEMS                      17890030
179000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 17900030
179100                                                                  17910030
179200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  17920030
179300             PERFORM 2150-SELECT-ALL-ITEMS                        17930030
179400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 17940030
179500                                                                  17950030
179600         WHEN DP020-SRC-AID = DP016-ENTER                         17960030
179700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 17970030
179800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   17980030
179900             IF  PS-NO-ERROR                                      17990030
180000                 PERFORM 2130-CHECK-FOR-JUMP-BROWSE               18000030
180100             END-IF                                               18010030
180200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 18020030
180300                                                                  18030030
180400         WHEN OTHER                                               18040030
180500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 18050030
180600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   18060030
180700             IF  PS-NO-ERROR                                      18070030
180800                 SET DP030-CONTINUE-GO                            18080030
180900                                 TO TRUE                          18090030
181000                 PERFORM 2100-CHECK-FUNCTION-KEY                  18100030
181100             ELSE                                                 18110030
181200                 SET DP030-OVERRIDE-GO                            18120030
181300                                 TO TRUE                          18130030
181400             END-IF                                               18140030
181500     END-EVALUATE.                                                18150030
181600*                                                                 18160030
181700 EJECT                                                            18170030
181800*----------------------------------------------------------------*18180030
181900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *18190030
182000*----------------------------------------------------------------*18200030
182100 2050-DELETE-LIST-QUEUE.                                          18210030
182200                                                                  18220030
182300     EXEC CICS                                                    18230030
182400         DELETEQ TS                                               18240030
182500             QUEUE (ASC-LIST-QUEUE-NAME)                          18250030
182600             RESP  (PV-CICS-RESP)                                 18260030
182700     END-EXEC.                                                    18270030
182800                                                                  18280030
182900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       18290030
183000        (PV-CICS-RESP = DFHRESP(QIDERR))                          18300030
183100         CONTINUE                                                 18310030
183200     ELSE                                                         18320030
183300         SET DP013-CICS-ABEND      TO TRUE                        18330030
183400         SET DP013-NO-ROLLBACK     TO TRUE                        18340030
183500                                                                  18350030
183600         MOVE '2050-DELETE-LIST-QUEUE'                            18360030
183700                                   TO DP013-PARAGRAPH             18370030
183800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    18380030
183900                                   TO DP013-MESSAGE-TEXT (1)      18390030
184000         PERFORM DP013-0000-PROCESS-ABEND                         18400030
184100     END-IF.                                                      18410030
184200                                                                  18420030
184300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  18430030
184400*                                                                 18440030
184500 EJECT                                                            18450030
184600*----------------------------------------------------------------*18460030
184700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*18470030
184800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *18480030
184900* CICS ARCHITECTURE API.                                         *18490030
185000*----------------------------------------------------------------*18500030
185100 2100-CHECK-FUNCTION-KEY.                                         18510030
185200     EVALUATE TRUE                                                18520030
185300         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  18530030
185400             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              18540030
185500                 INITIALIZE PE066-INTER-APPL-COMMAREA             18550030
185600                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                18560030
185700                                TO PE066-NUMBER-OF-SELECTED-ITEMS 18570030
185800                 PERFORM 5000-PREPARE-SEL-QUEUE                   18580030
185900             ELSE                                                 18590030
186000                 SET DP030-OVERRIDE-GO                            18600030
186100                                   TO TRUE                        18610030
186200                 MOVE PC-TSYMSG-00057                             18620030
186300                                   TO DP020-MSG-NUMBER            18630030
186400                 SET DP020-MSG-WARNING                            18640030
186500                                   TO TRUE                        18650030
186600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             18660030
186700             END-IF                                               18670030
186800                                                                  18680030
186900         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               18690030
187000             IF ASC-KEY-STORE-NBR = SPACES                        18700030
187100*  THE NEXT STORE FUNCTION CAN ONLY BE PROCESSED IF THERE IS A    18710030
187200*  STORE NUMBER ENTERED ON THE CRIT SPEC SCREEN AND PASSED TO THIS18720030
187300*  PROGRAM.  IF STORE NUMBER IS PASSED TO THIS PROGRAM AS SPACES, 18730030
187400*  THE SCREEN WILL JUST BE RE-DISPLAYED.                          18740030
187500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             18750030
187600             ELSE                                                 18760030
187700                 PERFORM 2050-DELETE-LIST-QUEUE                   18770030
187800                 PERFORM 6010-DELETE-SEL-QUEUE                    18780030
187900                 SET PS-NEXT-STR-INFO-NOT-FOUND                   18790030
188000                                   TO TRUE                        18800030
188100                 PERFORM 7010-OPEN-NEXT-STORE-CSR                 18810030
188200                 PERFORM 4005-BUILD-NEXT-STR-INIT-PANEL           18820030
188300                     UNTIL PS-NEXT-STR-INFO-FOUND                 18830030
188400                 PERFORM 7020-CLOSE-NEXT-STORE-CSR                18840030
188500             END-IF                                               18850030
188600                                                                  18860030
188700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  18870030
188800             PERFORM 3200-RESET-ATTRIBUTES                        18880030
188900             MOVE +1               TO PV-TOP-ITEM                 18890030
189000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 18900030
189100                                                                  18910030
189200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   18920030
189300             PERFORM 3200-RESET-ATTRIBUTES                        18930030
189400             PERFORM 2110-BROWSE-BACKWARD                         18940030
189500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 18950030
189600                                                                  18960030
189700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   18970030
189800             PERFORM 3200-RESET-ATTRIBUTES                        18980030
189900             PERFORM 2120-BROWSE-FORWARD                          18990030
190000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 19000030
190100                                                                  19010030
190200         WHEN OTHER                                               19020030
190300             SET DP013-NO-ROLLBACK                                19030030
190400                 DP013-XCTL-DISPLAY-RESTART                       19040030
190500                 DP013-CICS-ABEND  TO TRUE                        19050030
190600             MOVE '2100-CHECK-FUNCTION-KEY'                       19060030
190700                                   TO DP013-PARAGRAPH             19070030
190800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      19080030
190900                                   TO DP013-MESSAGE-TEXT (1)      19090030
191000             PERFORM DP013-0000-PROCESS-ABEND                     19100030
191100     END-EVALUATE.                                                19110030
191200*                                                                 19120030
191300 EJECT                                                            19130030
191400*----------------------------------------------------------------*19140030
191500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *19150030
191600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *19160030
191700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *19170030
191800*    MESSAGE.                                                    *19180030
191900*----------------------------------------------------------------*19190030
192000                                                                  19200030
192100 2110-BROWSE-BACKWARD.                                            19210030
192200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    19220030
192300         GIVING PV-TOP-ITEM.                                      19230030
192400*                                                                 19240030
192500     IF  ((PV-TOP-ITEM < +1)                                      19250030
192600       OR (PV-TOP-ITEM = +1))                                     19260030
192700         MOVE +1                   TO PV-TOP-ITEM                 19270030
192800*        -- TOP OF LIST --                                        19280030
192900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            19290030
193000         SET DP020-MSG-INFORMATIONAL TO TRUE                      19300030
193100     END-IF.                                                      19310030
193200*                                                                 19320030
193300 EJECT                                                            19330030
193400*----------------------------------------------------------------*19340030
193500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *19350030
193600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *19360030
193700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *19370030
193800*----------------------------------------------------------------*19380030
193900                                                                  19390030
194000 2120-BROWSE-FORWARD.                                             19400030
194100                                                                  19410030
194200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              19420030
194300         GIVING PV-TOP-ITEM.                                      19430030
194400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   19440030
194500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            19450030
194600                                   TO PV-TOP-ITEM                 19460030
194700*        -- BOTTOM OF LIST --                                     19470030
194800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            19480030
194900         SET DP020-MSG-INFORMATIONAL                              19490030
195000                                   TO TRUE                        19500030
195100     ELSE                                                         19510030
195200         COMPUTE PV-BOTTOM-ITEM =                                 19520030
195300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 19530030
195400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            19540030
195500*            -- BOTTOM OF LIST --                                 19550030
195600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            19560030
195700             SET DP020-MSG-INFORMATIONAL                          19570030
195800                                   TO TRUE                        19580030
195900         END-IF                                                   19590030
196000     END-IF.                                                      19600030
196100*                                                                 19610030
196200 EJECT                                                            19620030
196300*----------------------------------------------------------------*19630030
196400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *19640030
196500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *19650030
196600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *19660030
196700*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *19670030
196800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *19680030
196900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *19690030
197000*----------------------------------------------------------------*19700030
197100                                                                  19710030
197200 2130-CHECK-FOR-JUMP-BROWSE.                                      19720030
197300     SET PS-NO-ERROR               TO TRUE.                       19730030
197400     IF (ASC-START-ITEM-REQUEST = SPACE)                          19740030
197500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            19750030
197600                                   TO PV-TOP-ITEM                 19760030
197700     ELSE                                                         19770030
197800         MOVE ASC-START-ITEM-REQUEST                              19780030
197900                                   TO DP010I-UNEDITED-FIELD       19790030
198000         MOVE PC-ITEM-NUMBER-LENGTH                               19800030
198100                                   TO DP010I-MAXIMUM-DIGITS       19810030
198200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     19820030
198300         SET DP010I-NEGATIVE-NOT-ALLOWED                          19830030
198400                                   TO TRUE                        19840030
198510         CALL DP010I-NUMERIC-EDIT-ROUTINE                         19851032
198520                         USING DP010I-NUMERIC-EDIT-AREA           19852032
198600                                                                  19860030
198700         IF  NOT DP010I-ERROR-DETECTED                            19870030
198800             MOVE DP010I-NUMERIC-FIELD                            19880030
198900                                   TO  ASC-START-ITEM-REQUEST-N   19890030
199000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  19900030
199100                 IF  ASC-START-ITEM-REQUEST-N >                   19910030
199200                                          ASC-NUMBER-OF-ITEMS-READ19920030
199300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         19930030
199400                     COMPUTE PV-TOP-ITEM =                        19940030
199500                             ASC-NUMBER-OF-ITEMS-READ             19950030
199600                             - PC-ITEMS-PER-PANEL + 1             19960030
199700                     IF  PV-TOP-ITEM < +1                         19970030
199800                         MOVE +1   TO PV-TOP-ITEM                 19980030
199900                         MOVE PC-TSYMSG-00070                     19990030
200000                                   TO DP020-MSG-NUMBER            20000030
200100                         SET DP020-MSG-INFORMATIONAL              20010030
200200                                   TO TRUE                        20020030
200300                     END-IF                                       20030030
200400                 ELSE                                             20040030
200500                     MOVE ASC-START-ITEM-REQUEST-N                20050030
200600                                   TO PV-TOP-ITEM                 20060030
200700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      20070030
200800                     COMPUTE PV-BOTTOM-ITEM =                     20080030
200900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     20090030
201000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ20100030
201100*                        -- BOTTOM OF LIST --                     20110030
201200                         MOVE PC-TSYMSG-00070                     20120030
201300                                   TO DP020-MSG-NUMBER            20130030
201400                         SET DP020-MSG-INFORMATIONAL              20140030
201500                                   TO TRUE                        20150030
201600                     END-IF                                       20160030
201700                 END-IF                                           20170030
201800             ELSE                                                 20180030
201900*                --- VALUE OUT OF RANGE ----                      20190030
202000                 MOVE PC-TSYMSG-00101                             20200030
202100                                   TO DP020-MSG-NUMBER            20210030
202200                 MOVE -1           TO ASTRTITL                    20220030
202300                 SET DP030-SET-CURSOR-APPL-1                      20230030
202400                                   TO TRUE                        20240030
202500                 MOVE DP015-REVERSE                               20250030
202600                                   TO ASTRTITH                    20260030
202700                 MOVE DP015-RED    TO ASTRTITC                    20270030
202800                 MOVE DP015-UNP-NUM-BRT-MDT                       20280030
202900                                   TO ASTRTITA                    20290030
203000                 SET DP020-MSG-FATAL                              20300030
203100                                   TO TRUE                        20310030
203200                 SET PS-ERROR      TO TRUE                        20320030
203300             END-IF                                               20330030
203400                                                                  20340030
203500         ELSE                                                     20350030
203600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            20360030
203700             MOVE -1               TO ASTRTITL                    20370030
203800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  20380030
203900             MOVE DP015-REVERSE    TO ASTRTITH                    20390030
204000             MOVE DP015-RED        TO ASTRTITC                    20400030
204100             MOVE DP015-UNP-NUM-BRT-MDT                           20410030
204200                                   TO ASTRTITA                    20420030
204300             SET DP020-MSG-FATAL   TO TRUE                        20430030
204400             SET PS-ERROR          TO TRUE                        20440030
204500         END-IF                                                   20450030
204600     END-IF.                                                      20460030
204700*                                                                 20470030
204800 EJECT                                                            20480030
204900*----------------------------------------------------------------*20490030
205000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *20500030
205100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *20510030
205200*----------------------------------------------------------------*20520030
205300 2140-DESELECT-ALL-ITEMS.                                         20530030
205400     MOVE +1                       TO ASC-BLK-SUB.                20540030
205500                                                                  20550030
205600     PERFORM 2141-CLEAR-SELECTED-INDS                             20560030
205700         VARYING ASC-ITEM-SUB                                     20570030
205800         FROM 1 BY 1                                              20580030
205900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20590030
206000                                                                  20600030
206100     ADD +1                        TO ASC-BLK-SUB.                20610030
206200                                                                  20620030
206300     PERFORM 2141-CLEAR-SELECTED-INDS                             20630030
206400         VARYING ASC-ITEM-SUB                                     20640030
206500         FROM 1 BY 1                                              20650030
206600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20660030
206700                                                                  20670030
206800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               20680030
206900                                   TO PV-LIST-ITEM-NUMBER.        20690030
207000                                                                  20700030
207100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            20710030
207200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20720030
207300                                                                  20730030
207400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     20740030
207500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      20750030
207600         MOVE +1                   TO ASC-BLK-SUB                 20760030
207700                                                                  20770030
207800         PERFORM 5100-WRITE-TEMP-STORAGE                          20780030
207900                                                                  20790030
208000         MOVE +1                   TO PV-BLOCK-NUMBER             20800030
208100                                                                  20810030
208200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         20820030
208300             PV-FIRST-BLOCK-IN-ARRAY - 1                          20830030
208400                                                                  20840030
208500         PERFORM                                                  20850030
208600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       20860030
208700                                                                  20870030
208800             PERFORM 4410-READ-TEMP-STORAGE                       20880030
208900                                                                  20890030
209000             PERFORM 2141-CLEAR-SELECTED-INDS                     20900030
209100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 20910030
209200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20920030
209300                                                                  20930030
209400             PERFORM 5100-WRITE-TEMP-STORAGE                      20940030
209500                                                                  20950030
209600             ADD +1                TO PV-BLOCK-NUMBER             20960030
209700                                                                  20970030
209800         END-PERFORM                                              20980030
209900                                                                  20990030
210000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         21000030
210100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     21010030
210200                                                                  21020030
210300         PERFORM                                                  21030030
210400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       21040030
210500                   ASC-HIGHEST-BLOCK-WRITTEN                      21050030
210600                                                                  21060030
210700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          21070030
210800                                   TO PV-BLOCK-NUMBER             21080030
210900                                                                  21090030
211000             PERFORM 4410-READ-TEMP-STORAGE                       21100030
211100                                                                  21110030
211200             PERFORM 2141-CLEAR-SELECTED-INDS                     21120030
211300                 VARYING ASC-ITEM-SUB                             21130030
211400                 FROM 1 BY 1                                      21140030
211500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          21150030
211600                                                                  21160030
211700             PERFORM 5100-WRITE-TEMP-STORAGE                      21170030
211800                                                                  21180030
211900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      21190030
212000                                                                  21200030
212100         END-PERFORM                                              21210030
212200                                                                  21220030
212300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             21230030
212400                                   TO PV-BLOCK-NUMBER             21240030
212500                                                                  21250030
212600         PERFORM 4410-READ-TEMP-STORAGE                           21260030
212700     END-IF.                                                      21270030
212800                                                                  21280030
212900                                                                  21290030
213000     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 21300030
213100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.21310030
213200     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  21320030
213300                                                                  21330030
213400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        21340030
213500*                                                                 21350030
213600 EJECT                                                            21360030
213700*----------------------------------------------------------------*21370030
213800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *21380030
213900*----------------------------------------------------------------*21390030
214000                                                                  21400030
214100 2141-CLEAR-SELECTED-INDS.                                        21410030
214200                                                                  21420030
214300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           21430030
214400             NOT EQUAL ZERO                                       21440030
214500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          21450030
214600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          21460030
214700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    21470030
214800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  21480030
214900                                   TO TRUE                        21490030
215000         END-IF                                                   21500030
215100     END-IF.                                                      21510030
215200*                                                                 21520030
215300 EJECT                                                            21530030
215400*----------------------------------------------------------------*21540030
215500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *21550030
215600*  FOR ALL ITEMS.                                                *21560030
215700*----------------------------------------------------------------*21570030
215800                                                                  21580030
215900 2150-SELECT-ALL-ITEMS.                                           21590030
216000                                                                  21600030
216100     MOVE +1                       TO ASC-BLK-SUB.                21610030
216200                                                                  21620030
216300     PERFORM 2151-SET-SELECTED-INDS                               21630030
216400         VARYING ASC-ITEM-SUB                                     21640030
216500         FROM 1 BY 1                                              21650030
216600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 21660030
216700                                                                  21670030
216800     ADD +1                        TO ASC-BLK-SUB.                21680030
216900                                                                  21690030
217000     PERFORM 2151-SET-SELECTED-INDS                               21700030
217100         VARYING ASC-ITEM-SUB                                     21710030
217200         FROM 1 BY 1                                              21720030
217300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 21730030
217400                                                                  21740030
217500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               21750030
217600                                   TO PV-LIST-ITEM-NUMBER.        21760030
217700                                                                  21770030
217800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            21780030
217900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    21790030
218000                                                                  21800030
218100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     21810030
218200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    21820030
218300         MOVE +1                   TO ASC-BLK-SUB                 21830030
218400                                                                  21840030
218500         PERFORM 5100-WRITE-TEMP-STORAGE                          21850030
218600                                                                  21860030
218700         MOVE +1                   TO PV-BLOCK-NUMBER             21870030
218800                                                                  21880030
218900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         21890030
219000             PV-FIRST-BLOCK-IN-ARRAY - 1                          21900030
219100                                                                  21910030
219200         PERFORM                                                  21920030
219300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       21930030
219400                                                                  21940030
219500             PERFORM 4410-READ-TEMP-STORAGE                       21950030
219600                                                                  21960030
219700             PERFORM 2151-SET-SELECTED-INDS                       21970030
219800                 VARYING ASC-ITEM-SUB                             21980030
219900                 FROM 1 BY 1                                      21990030
220000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          22000030
220100                                                                  22010030
220200             PERFORM 5100-WRITE-TEMP-STORAGE                      22020030
220300                                                                  22030030
220400             ADD +1                TO PV-BLOCK-NUMBER             22040030
220500                                                                  22050030
220600         END-PERFORM                                              22060030
220700                                                                  22070030
220800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         22080030
220900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     22090030
221000                                                                  22100030
221100         PERFORM                                                  22110030
221200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       22120030
221300                   ASC-HIGHEST-BLOCK-WRITTEN                      22130030
221400                                                                  22140030
221500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          22150030
221600                                   TO PV-BLOCK-NUMBER             22160030
221700                                                                  22170030
221800             PERFORM 4410-READ-TEMP-STORAGE                       22180030
221900                                                                  22190030
222000             PERFORM 2151-SET-SELECTED-INDS                       22200030
222100                 VARYING ASC-ITEM-SUB                             22210030
222200                 FROM 1 BY 1                                      22220030
222300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          22230030
222400                                                                  22240030
222500             PERFORM 5100-WRITE-TEMP-STORAGE                      22250030
222600                                                                  22260030
222700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      22270030
222800                                                                  22280030
222900         END-PERFORM                                              22290030
223000                                                                  22300030
223100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             22310030
223200                                   TO PV-BLOCK-NUMBER             22320030
223300                                                                  22330030
223400         PERFORM 4410-READ-TEMP-STORAGE                           22340030
223500     END-IF.                                                      22350030
223600                                                                  22360030
223700                                                                  22370030
223800     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             22380030
223900                       ASC-NUMBER-OF-SELECTED-ITEMS.              22390030
224000                                                                  22400030
224100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        22410030
224200*                                                                 22420030
224300 EJECT                                                            22430030
224400*----------------------------------------------------------------*22440030
224500*    MARK EACH ITEM AS BEING SELECTED.                           *22450030
224600*----------------------------------------------------------------*22460030
224700                                                                  22470030
224800 2151-SET-SELECTED-INDS.                                          22480030
224900                                                                  22490030
225000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           22500030
225100             NOT EQUAL ZERO                                       22510030
225200         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             22520030
225300             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             22530030
225400                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        22540030
225500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  22550030
225600                               TO  TRUE                           22560030
225700         END-IF                                                   22570030
225800     END-IF.                                                      22580030
225900*                                                                 22590030
226000 EJECT                                                            22600030
226100*----------------------------------------------------------------*22610030
226200*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *22620030
226300*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *22630030
226400*----------------------------------------------------------------*22640030
226500 2200-MOVE-SCREEN-TO-COMMAREA.                                    22650030
226600                                                                  22660030
226700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             22670030
226800     MOVE +1                       TO PV-SUB.                     22680030
226900*                                                                 22690030
227000     PERFORM 3100-SET-SUBSCRIPTS.                                 22700030
227100     IF  ASTRTITL > ZERO                                          22710030
227200         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          22720030
227300     ELSE                                                         22730030
227400         IF  ASTRTITF = DP015-ERASE-EOF                           22740030
227500             INITIALIZE ASC-START-ITEM-REQUEST                    22750030
227600         END-IF                                                   22760030
227700     END-IF.                                                      22770030
227800     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          22780030
227900         VARYING PV-SUB                                           22790030
228000         FROM 1 BY 1                                              22800030
228100         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      22810030
228200*                                                                 22820030
228300 EJECT                                                            22830030
228400*----------------------------------------------------------------*22840030
228500*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *22850030
228600*----------------------------------------------------------------*22860030
228700 2210-MOVE-LINES-TO-COMMAREA.                                     22870030
228800     IF  MR-SELECTL (PV-SUB) > ZERO                               22880030
228900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             22890030
229000         MOVE MR-SELECTI (PV-SUB)                                 22900030
229100                                   TO ASC-TEMP-SELECTED-SW        22910030
229200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      22920030
229300     ELSE                                                         22930030
229400         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                22940030
229500                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     22950030
229600                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        22960030
229700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      22970030
229800         END-IF                                                   22980030
229900     END-IF.                                                      22990030
230000     ADD +1                        TO ASC-ITEM-SUB.               23000030
230100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        23010030
230200         ADD +1                    TO ASC-BLK-SUB                 23020030
230300         MOVE +1                   TO ASC-ITEM-SUB                23030030
230400     END-IF.                                                      23040030
230500*                                                                 23050030
230600 EJECT                                                            23060030
230700*----------------------------------------------------------------*23070030
230800*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *23080030
230900*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *23090030
231000*----------------------------------------------------------------*23100030
231100 3000-EDIT-DATA-IN-COMMAREA.                                      23110030
231200     SET PS-NO-ERROR               TO TRUE.                       23120030
231300     PERFORM 3200-RESET-ATTRIBUTES.                               23130030
231400     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     23140030
231500**                                                                23150030
231600* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              23160030
231700* EDITTING IS DONE FROM THE BOTTOM UP.                            23170030
231800**                                                                23180030
231900     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       23190030
232000         ASC-ITEMS-DISPLAYED - 1.                                 23200030
232100     PERFORM 3100-SET-SUBSCRIPTS.                                 23210030
232200     PERFORM 3300-EDIT-SELECTIONS                                 23220030
232300         VARYING PV-SUB                                           23230030
232400         FROM PV-SUB BY -1                                        23240030
232500         UNTIL PV-SUB < +1                                        23250030
232600*                                                                 23260030
232700     IF  PS-NO-ERROR                                              23270030
232800         PERFORM 3400-CHECK-RANGE-SEQUENCE                        23280030
232900     END-IF.                                                      23290030
233000*                                                                 23300030
233100     IF  ((PS-NO-ERROR)                                           23310030
233200       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   23320030
233300       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    23330030
233400             PERFORM 3500-MARK-RANGE-AS-SELECTED                  23340030
233500     END-IF.                                                      23350030
233600*                                                                 23360030
233700 EJECT                                                            23370030
233800*----------------------------------------------------------------*23380030
233900*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *23390030
234000*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*23400030
234100*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *23410030
234200*                                                                *23420030
234300*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *23430030
234400*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *23440030
234500*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *23450030
234600*    US IN THE 2ND BLOCK OF THE ARRAY.                           *23460030
234700*----------------------------------------------------------------*23470030
234800                                                                  23480030
234900 3100-SET-SUBSCRIPTS.                                             23490030
235000                                                                  23500030
235100     COMPUTE ASC-ITEM-SUB =                                       23510030
235200         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        23520030
235300                                                                  23530030
235400     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         23540030
235500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            23550030
235600                                                                  23560030
235700         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               23570030
235800     ELSE                                                         23580030
235900         MOVE +1                     TO ASC-BLK-SUB               23590030
236000     END-IF.                                                      23600030
236100*                                                                 23610030
236200 EJECT                                                            23620030
236300*----------------------------------------------------------------*23630030
236400*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *23640030
236500*----------------------------------------------------------------*23650030
236600                                                                  23660030
236700 3200-RESET-ATTRIBUTES.                                           23670030
236800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   23680030
236900     MOVE DP015-GREEN              TO ASTRTITC.                   23690030
237000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   23700030
237100*                                                                 23710030
237200     PERFORM                                                      23720030
237300         VARYING PV-SUB                                           23730030
237400         FROM 1 BY 1                                              23740030
237500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        23750030
237600         MOVE DP015-UNP-ALP-NOR-OFF                               23760030
237700                                   TO MR-SELECTA (PV-SUB)         23770030
237800         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         23780030
237900         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         23790030
238000     END-PERFORM.                                                 23800030
238100*                                                                 23810030
238200 EJECT                                                            23820030
238300*----------------------------------------------------------------*23830030
238400*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *23840030
238500*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *23850030
238600*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *23860030
238700*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *23870030
238800*----------------------------------------------------------------*23880030
238900 3300-EDIT-SELECTIONS.                                            23890030
239000     EVALUATE TRUE                                                23900030
239100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     23910030
239200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         23920030
239300                 CONTINUE                                         23930030
239400                                                                  23940030
239500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         23950030
239600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        23960030
239700                 EVALUATE TRUE                                    23970030
239800                     WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)    23980030
239900                         MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE23990030
240000                     WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)      24000030
240100                         MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE  24010030
240200                 END-EVALUATE                                     24020030
240300                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   24030030
240400                 MOVE ASC-TEMP-SELECTED-SW                        24040030
240500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  24050030
240600                                TO ASC-SELECTED-SW                24060030
240700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  24070030
240800             END-IF                                               24080030
240900                                                                  24090030
241000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     24100030
241100                 = SPACE                                          24110030
241200             EVALUATE TRUE                                        24120030
241300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       24130030
241400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS24140030
241500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        24150030
241600                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    24160030
241700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          24170030
241800                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      24180030
241900             END-EVALUATE                                         24190030
242000             MOVE SPACE         TO ASC-SELECTED-SW                24200030
242100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  24210030
242200                                                                  24220030
242300         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           24230030
242400             IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)             24240030
242500                 SUBTRACT +1                                      24250030
242600                             FROM ASC-NUMBER-OF-SELECTED-ITEMS    24260030
242700             END-IF                                               24270030
242800             PERFORM 3310-EDIT-RANGE                              24280030
242900                                                                  24290030
243000         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             24300030
243100             IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)             24310030
243200                 SUBTRACT +1                                      24320030
243300                             FROM ASC-NUMBER-OF-SELECTED-ITEMS    24330030
243400             END-IF                                               24340030
243500             PERFORM 3310-EDIT-RANGE                              24350030
243600                                                                  24360030
243700         WHEN OTHER                                               24370030
243800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           24380030
243900             SET DP020-MSG-FATAL    TO TRUE                       24390030
244000             MOVE -1                TO MR-SELECTL (PV-SUB)        24400030
244100             SET DP030-SET-CURSOR-APPL-1                          24410030
244200                                    TO TRUE                       24420030
244300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        24430030
244400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        24440030
244500             SET PS-ERROR TO TRUE                                 24450030
244600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            24460030
244700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     24470030
244800                 MOVE SPACE         TO ASC-SELECTED-SW            24480030
244900                                        (ASC-BLK-SUB ASC-ITEM-SUB)24490030
245000             END-IF                                               24500030
245100     END-EVALUATE.                                                24510030
245200                                                                  24520030
245300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 24530030
245400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               24540030
245500     IF  ASC-ITEM-SUB < 1                                         24550030
245600         SUBTRACT +1 FROM ASC-BLK-SUB                             24560030
245700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                24570030
245800     END-IF.                                                      24580030
245900*                                                                 24590030
246000 EJECT                                                            24600030
246100*----------------------------------------------------------------*24610030
246200*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *24620030
246300*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *24630030
246400*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *24640030
246500*  THE ENDING.                                                   *24650030
246600*----------------------------------------------------------------*24660030
246700 3310-EDIT-RANGE.                                                 24670030
246800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                24680030
246900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   24690030
247000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)24700030
247100                                   TO ASC-SELECTED-SW             24710030
247200                                        (ASC-BLK-SUB ASC-ITEM-SUB)24720030
247300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 24730030
247400         ELSE                                                     24740030
247500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     24750030
247600                 CONTINUE                                         24760030
247700             ELSE                                                 24770030
247800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        24780030
247900                 MOVE PC-TSYMSG-00054                             24790030
248000                                   TO DP020-MSG-NUMBER            24800030
248100                 SET DP020-MSG-FATAL                              24810030
248200                                   TO TRUE                        24820030
248300                 MOVE -1           TO MR-SELECTL (PV-SUB)         24830030
248400                 SET DP030-SET-CURSOR-APPL-1                      24840030
248500                                   TO TRUE                        24850030
248600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         24860030
248700                 MOVE DP015-UNDERLINE                             24870030
248800                                   TO MR-SELECTH (PV-SUB)         24880030
248900                 SET PS-ERROR      TO TRUE                        24890030
249000             END-IF                                               24900030
249100         END-IF                                                   24910030
249200     ELSE                                                         24920030
249300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24930030
249400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 24940030
249500                                   TO ASC-SELECTED-SW             24950030
249600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   24960030
249700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   24970030
249800         ELSE                                                     24980030
249900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       24990030
250000                 CONTINUE                                         25000030
250100             ELSE                                                 25010030
250200*                -- ONLY ONE END-OF-RANGE ALLOWED --              25020030
250300                 MOVE PC-TSYMSG-00055                             25030030
250400                                   TO DP020-MSG-NUMBER            25040030
250500                 SET DP020-MSG-FATAL                              25050030
250600                                   TO TRUE                        25060030
250700                 MOVE -1           TO MR-SELECTL (PV-SUB)         25070030
250800                 SET DP030-SET-CURSOR-APPL-1                      25080030
250900                                   TO TRUE                        25090030
251000                 SET PS-ERROR      TO TRUE                        25100030
251100             END-IF                                               25110030
251200         END-IF                                                   25120030
251300     END-IF.                                                      25130030
251400*                                                                 25140030
251500 EJECT                                                            25150030
251600*----------------------------------------------------------------*25160030
251700*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *25170030
251800*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *25180030
251900*----------------------------------------------------------------*25190030
252000 3400-CHECK-RANGE-SEQUENCE.                                       25200030
252100     IF (ASC-START-OF-SELECTED-RANGE > ZERO                       25210030
252200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      25220030
252300       AND  ASC-START-OF-SELECTED-RANGE >                         25230030
252400                                        ASC-END-OF-SELECTED-RANGE)25240030
252500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                25250030
252600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 25260030
252700         SET DP020-MSG-FATAL                                      25270030
252800             PS-ERROR         TO TRUE                             25280030
252900         PERFORM 3410-POSITION-AT-ERROR                           25290030
253000     END-IF.                                                      25300030
253100*                                                                 25310030
253200 EJECT                                                            25320030
253300*----------------------------------------------------------------*25330030
253400*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *25340030
253500*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *25350030
253600*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *25360030
253700*----------------------------------------------------------------*25370030
253800 3410-POSITION-AT-ERROR.                                          25380030
253900     SET DP030-SET-CURSOR-APPL-1                                  25390030
254000                                   TO TRUE.                       25400030
254100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 25410030
254200                    - PV-TOP-ITEM + 1.                            25420030
254300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25430030
254400         CONTINUE                                                 25440030
254500     ELSE                                                         25450030
254600         MOVE -1                   TO MR-SELECTL (PV-SUB)         25460030
254700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25470030
254800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         25480030
254900     END-IF.                                                      25490030
255000*                                                                 25500030
255100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   25510030
255200                    - PV-TOP-ITEM + 1.                            25520030
255300     IF (PV-SUB < +1                                              25530030
255400      OR PV-SUB > PC-ITEMS-PER-PANEL)                             25540030
255500         CONTINUE                                                 25550030
255600     ELSE                                                         25560030
255700         MOVE -1                   TO MR-SELECTL (PV-SUB)         25570030
255800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25580030
255900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         25590030
256000     END-IF.                                                      25600030
256100*                                                                 25610030
256200 EJECT                                                            25620030
256300*----------------------------------------------------------------*25630030
256400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *25640030
256500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *25650030
256600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *25660030
256700*----------------------------------------------------------------*25670030
256800                                                                  25680030
256900 3500-MARK-RANGE-AS-SELECTED.                                     25690030
257000     MOVE +1                       TO  ASC-BLK-SUB.               25700030
257100     PERFORM 3510-MARK-SELECTED-INDS                              25710030
257200         VARYING ASC-ITEM-SUB                                     25720030
257300         FROM 1 BY 1                                              25730030
257400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 25740030
257500                                                                  25750030
257600     ADD +1                        TO ASC-BLK-SUB.                25760030
257700     PERFORM 3510-MARK-SELECTED-INDS                              25770030
257800         VARYING ASC-ITEM-SUB                                     25780030
257900         FROM 1 BY 1                                              25790030
258000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 25800030
258100                                                                  25810030
258200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               25820030
258300                                   TO  PV-LIST-ITEM-NUMBER.       25830030
258400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            25840030
258500         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         25850030
258600               PC-ITEMS-PER-PANEL).                               25860030
258700                                                                  25870030
258800     MOVE ASC-START-OF-SELECTED-RANGE                             25880030
258900                                   TO PV-START-OF-SELECTED-RANGE. 25890030
259000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            25900030
259100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  25910030
259200               PC-ITEMS-PER-PANEL).                               25920030
259300                                                                  25930030
259400     MOVE ASC-END-OF-SELECTED-RANGE                               25940030
259500                                   TO  PV-END-OF-SELECTED-RANGE.  25950030
259600     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             25960030
259700         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    25970030
259800               PC-ITEMS-PER-PANEL).                               25980030
259900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             25990030
260000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             26000030
260100                                                                  26010030
260200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    26020030
260300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        26030030
260400         MOVE +1                   TO ASC-BLK-SUB                 26040030
260500         PERFORM 5100-WRITE-TEMP-STORAGE                          26050030
260600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         26060030
260700             PV-FIRST-BLOCK-IN-ARRAY - 1                          26070030
260800                                                                  26080030
260900         PERFORM                                                  26090030
261000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      26100030
261100                   PV-PREV-BLOCK-IN-ARRAY                         26110030
261200             MOVE PV-FIRST-BLOCK-IN-RANGE                         26120030
261300                                   TO PV-BLOCK-NUMBER             26130030
261400             PERFORM 4410-READ-TEMP-STORAGE                       26140030
261500             PERFORM 3510-MARK-SELECTED-INDS                      26150030
261600                 VARYING ASC-ITEM-SUB                             26160030
261700                 FROM 1 BY 1                                      26170030
261800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          26180030
261900             PERFORM 5100-WRITE-TEMP-STORAGE                      26190030
262000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     26200030
262100         END-PERFORM                                              26210030
262200                                                                  26220030
262300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         26230030
262400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     26240030
262500         PERFORM                                                  26250030
262600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       26260030
262700                   PV-LAST-BLOCK-IN-RANGE                         26270030
262800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          26280030
262900                                   TO PV-BLOCK-NUMBER             26290030
263000             PERFORM 4410-READ-TEMP-STORAGE                       26300030
263100             PERFORM 3510-MARK-SELECTED-INDS                      26310030
263200                 VARYING ASC-ITEM-SUB                             26320030
263300                 FROM 1 BY 1                                      26330030
263400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          26340030
263500             PERFORM 5100-WRITE-TEMP-STORAGE                      26350030
263600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      26360030
263700         END-PERFORM                                              26370030
263800                                                                  26380030
263900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             26390030
264000                                   TO PV-BLOCK-NUMBER             26400030
264100         PERFORM 4410-READ-TEMP-STORAGE                           26410030
264200     END-IF.                                                      26420030
264300                                                                  26430030
264400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 26440030
264500                                      ASC-END-OF-SELECTED-RANGE.  26450030
264600*                                                                 26460030
264700 EJECT                                                            26470030
264800*----------------------------------------------------------------*26480030
264900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *26490030
265000*----------------------------------------------------------------*26500030
265100                                                                  26510030
265200 3510-MARK-SELECTED-INDS.                                         26520030
265300                                                                  26530030
265400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         26540030
265500                                ASC-ITEM-SUB) >                   26550030
265600         ASC-START-OF-SELECTED-RANGE)                             26560030
265700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         26570030
265800                                ASC-ITEM-SUB) =                   26580030
265900         ASC-START-OF-SELECTED-RANGE)                             26590030
266000                                                                  26600030
266100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     26610030
266200                                    ASC-ITEM-SUB) <               26620030
266300             ASC-END-OF-SELECTED-RANGE)                           26630030
266400         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     26640030
266500                                    ASC-ITEM-SUB) =               26650030
266600             ASC-END-OF-SELECTED-RANGE)                           26660030
266700                                                                  26670030
266800             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          26680030
266900                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   26690030
267000                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   26700030
267100                               TO TRUE                            26710030
267200                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              26720030
267300                               TO TRUE                            26730030
267400                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    26740030
267500             END-IF                                               26750030
267600         END-IF                                                   26760030
267700     END-IF.                                                      26770030
267800*                                                                 26780030
267900 EJECT                                                            26790030
268000*----------------------------------------------------------------*26800030
268100*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *26810030
268200*    INITIALIZE ALL COUNTERS AND FLAGS.                          *26820030
268300*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *26830030
268400*    DISPLAY THE PANEL TO USER.                                  *26840030
268500*----------------------------------------------------------------*26850030
268600                                                                  26860030
268700 4000-BUILD-INITIAL-PANEL.                                        26870030
268800                                                                  26880030
268900     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            26890030
269000                                 ASC-BLOCK-ENTRIES (2).           26900030
269100     MOVE +1                 TO ASC-BLK-SUB.                      26910030
269200     SET ASC-ITEMS-LEFT-ON-DB                                     26920030
269300                             TO TRUE.                             26930030
269400                                                                  26940030
269500     MOVE +0                 TO ASC-ITEM-SUB                      26950030
269600                                ASC-NUMBER-OF-ITEMS-READ          26960030
269700                                ASC-NUMBER-OF-SELECTED-ITEMS      26970030
269800                                ASC-HIGHEST-BLOCK-WRITTEN         26980030
269900                                ASC-START-OF-SELECTED-RANGE       26990030
270000                                ASC-END-OF-SELECTED-RANGE         27000030
270100                                ASC-ITEM-AT-TOP-OF-PANEL.         27010030
270200     PERFORM 4100-PREPARE-CURSOR                                  27020030
270300                                                                  27030030
270400     PERFORM 4010-OPEN-CURSOR.                                    27040030
270500                                                                  27050030
270600     PERFORM 4300-READ-ITEMS-FROM-DB.                             27060030
270700                                                                  27070030
270800     PERFORM 4020-CLOSE-CURSOR.                                   27080030
270900                                                                  27090030
271000     MOVE +1                   TO  PV-TOP-ITEM.                   27100030
271100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          27110030
271200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    27120030
271300         SET DP020-MSG-FATAL   TO  TRUE                           27130030
271400         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               27140030
271500     ELSE                                                         27150030
271600         MOVE -1               TO MR-SELECTL (1)                  27160030
271700         SET DP030-SET-CURSOR-APPL-1                              27170030
271800                               TO TRUE                            27180030
271900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     27190030
272000     END-IF.                                                      27200030
272100*                                                                 27210030
272200 EJECT                                                            27220030
272300*----------------------------------------------------------------*27230030
272400*    GET THE NEXT STORE NUMBER AND FIND OUT IF THERE IS INFO     *27240030
272500*    THAT MATCHES THE CRITERIA FOR THAT STORE.  IF NOT, GET THE  *27250030
272600*    NEXT STORE.  IF AT END OF STORE TABLE, START OVER TO THE    *27260030
272700*    FIRST STORE.                                                *27270030
272800*----------------------------------------------------------------*27280030
272900                                                                  27290030
273000 4005-BUILD-NEXT-STR-INIT-PANEL.                                  27300030
273100                                                                  27310030
273200     PERFORM 7000-GET-NEXT-STORE.                                 27320030
273300     IF SQLCODE = +100                                            27330030
273400         PERFORM 7020-CLOSE-NEXT-STORE-CSR                        27340030
273500         MOVE ZERO           TO ASC-STORE-NBR-LOW                 27350030
273600                                ASC-STORE-NBR-HIGH                27360030
273700                                ASC-KEY-STORE-NBR-N               27370030
273800         PERFORM 7010-OPEN-NEXT-STORE-CSR                         27380030
273900     ELSE                                                         27390030
274000         MOVE XST00001-LOC-NBR                                    27400030
274100                             TO ASC-STORE-NBR-LOW                 27410030
274200                                ASC-STORE-NBR-HIGH                27420030
274300                                ASC-KEY-STORE-NBR-N               27430030
274400         PERFORM 4006-GET-NEXT-STR-INFO                           27440030
274500     END-IF.                                                      27450030
274600*                                                                 27460030
274700 EJECT                                                            27470030
274800*----------------------------------------------------------------*27480030
274900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *27490030
275000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *27500030
275100*    DETERMINE IF THERE IS INFORMATION WHICH MATCHES THE         *27510030
275200*    CRITERIA FOR THE NEXT STORE.                                *27520030
275300*----------------------------------------------------------------*27530030
275400                                                                  27540030
275500 4006-GET-NEXT-STR-INFO.                                          27550030
275600     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            27560030
275700                                 ASC-BLOCK-ENTRIES (2).           27570030
275800     MOVE +1                 TO ASC-BLK-SUB.                      27580030
275900     SET ASC-ITEMS-LEFT-ON-DB                                     27590030
276000                             TO TRUE.                             27600030
276100                                                                  27610030
276200     MOVE +0                 TO ASC-ITEM-SUB                      27620030
276300                                ASC-NUMBER-OF-ITEMS-READ          27630030
276400                                ASC-NUMBER-OF-SELECTED-ITEMS      27640030
276500                                ASC-HIGHEST-BLOCK-WRITTEN         27650030
276600                                ASC-START-OF-SELECTED-RANGE       27660030
276700                                ASC-END-OF-SELECTED-RANGE         27670030
276800                                ASC-ITEM-AT-TOP-OF-PANEL.         27680030
276900     PERFORM 4100-PREPARE-CURSOR                                  27690030
277000                                                                  27700030
277100     PERFORM 4010-OPEN-CURSOR.                                    27710030
277200                                                                  27720030
277300     PERFORM 4300-READ-ITEMS-FROM-DB.                             27730030
277400                                                                  27740030
277500     PERFORM 4020-CLOSE-CURSOR.                                   27750030
277600                                                                  27760030
277700     MOVE +1                   TO  PV-TOP-ITEM.                   27770030
277800     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          27780030
277900         CONTINUE                                                 27790030
278000     ELSE                                                         27800030
278100         MOVE -1               TO MR-SELECTL (1)                  27810030
278200         SET DP030-SET-CURSOR-APPL-1                              27820030
278300             PS-NEXT-STR-INFO-FOUND                               27830030
278400                               TO TRUE                            27840030
278500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     27850030
278600     END-IF.                                                      27860030
278700*                                                                 27870030
278800 EJECT                                                            27880030
278900*----------------------------------------------------------------*27890030
279000* OPEN THE INSTORE DOCUMENT HEADER CURSOR.                       *27900030
279100*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *27910030
279200*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *27920030
279300*   USER.                                                        *27930030
279400*----------------------------------------------------------------*27940030
279500                                                                  27950030
279600 4010-OPEN-CURSOR.                                                27960030
279700                                                                  27970030
279800     EVALUATE TRUE                                                27980030
279900         WHEN ASC-CURRENT-CURSOR                                  27990030
280000             MOVE 'CURSOR: CURRENT-CSR'                           28000030
280100                                   TO DP013-MESSAGE-TEXT (2)      28010030
280200             MOVE 'TSTRPPC '       TO DP013-DB2-TABLE-NAME (1)    28020030
280300             EXEC SQL                                             28030030
280400                  OPEN CURRENT-CSR                                28040030
280500             END-EXEC                                             28050030
280600                                                                  28060030
280700         WHEN ASC-CURRENT-DEPT-CURSOR                             28070030
280800             MOVE 'CURSOR: CURRENT-DEPT-CSR'                      28080030
280900                                   TO DP013-MESSAGE-TEXT (2)      28090030
281000             MOVE 'TSTRPPC '       TO DP013-DB2-TABLE-NAME (1)    28100030
281100             MOVE 'TSPPCDT '       TO DP013-DB2-TABLE-NAME (2)    28110030
281200             EXEC SQL                                             28120030
281300                  OPEN CURRENT-DEPT-CSR                           28130030
281400             END-EXEC                                             28140030
281500                                                                  28150030
281600         WHEN ASC-CURRENT-STATUS-CURSOR                           28160030
281700             MOVE 'CURSOR: CURRENT-STATUS-CSR'                    28170030
281800                                   TO DP013-MESSAGE-TEXT (2)      28180030
281900             MOVE 'TSTRPPC '       TO DP013-DB2-TABLE-NAME (1)    28190030
282000             EXEC SQL                                             28200030
282100                  OPEN CURRENT-STATUS-CSR                         28210030
282200             END-EXEC                                             28220030
282300                                                                  28230030
282400         WHEN ASC-CURRENT-STATUS-DEPT-CURSOR                      28240030
282500             MOVE 'CURSOR: CURR-STAT-DEPT-CSR'                    28250030
282600                                   TO DP013-MESSAGE-TEXT (2)      28260030
282700             MOVE 'TSTRPPC '       TO DP013-DB2-TABLE-NAME (1)    28270030
282800             EXEC SQL                                             28280030
282900                  OPEN CURR-STAT-DEPT-CSR                         28290030
283000             END-EXEC                                             28300030
283100                                                                  28310030
283200         WHEN ASC-HISTORY-CURRENT-CURSOR                          28320030
283300             MOVE 'CURSOR:  HIST-CURR-CSR'                        28330030
283400                                   TO DP013-MESSAGE-TEXT (2)      28340030
283500             MOVE 'TSTRPPC '       TO DP013-DB2-TABLE-NAME (1)    28350030
283600             MOVE 'TSTRPCH '       TO DP013-DB2-TABLE-NAME (2)    28360030
283700             EXEC SQL                                             28370030
283800                  OPEN HIST-CURR-CSR                              28380030
283900             END-EXEC                                             28390030
284000                                                                  28400030
284100         WHEN ASC-HISTORY-STATUS-CURSOR                           28410030
284200             MOVE 'CURSOR:  HISTORY-STATUS-CSR'                   28420030
284300                                   TO DP013-MESSAGE-TEXT (2)      28430030
284400             MOVE 'TSTRPCH '       TO DP013-DB2-TABLE-NAME (1)    28440030
284500             EXEC SQL                                             28450030
284600                  OPEN HISTORY-STATUS-CSR                         28460030
284700             END-EXEC                                             28470030
284800                                                                  28480030
284900         WHEN ASC-HISTORY-STATUS-DEPT-CURSOR                      28490030
285000             MOVE 'CURSOR:  HIST-STAT-DEPT-CSR'                   28500030
285100                                   TO DP013-MESSAGE-TEXT (2)      28510030
285200             MOVE 'TSTRPCH '       TO DP013-DB2-TABLE-NAME (1)    28520030
285300             MOVE 'TSPCDTH '       TO DP013-DB2-TABLE-NAME (2)    28530030
285400             EXEC SQL                                             28540030
285500                  OPEN HIST-STAT-DEPT-CSR                         28550030
285600             END-EXEC                                             28560030
285700                                                                  28570030
285800         WHEN ASC-HIST-CURR-DEPT-CURSOR                           28580030
285900             MOVE 'CURSOR:  HIST-CURR-DEPT-CSR'                   28590030
286000                                   TO DP013-MESSAGE-TEXT (2)      28600030
286100             MOVE 'TSTRPCH '       TO DP013-DB2-TABLE-NAME (1)    28610030
286200             MOVE 'TSTRPPC '       TO DP013-DB2-TABLE-NAME (2)    28620030
286300             EXEC SQL                                             28630030
286400                  OPEN HIST-CURR-DEPT-CSR                         28640030
286500             END-EXEC                                             28650030
286600     END-EVALUATE.                                                28660030
286700                                                                  28670030
286800     EVALUATE TRUE                                                28680030
286900         WHEN SQLCODE = ZERO                                      28690030
287000             CONTINUE                                             28700030
287100         WHEN SQLWARN0 NOT = SPACES                               28710030
287200         WHEN SQLCODE < ZERO                                      28720030
287300         WHEN SQLCODE > ZERO                                      28730030
287400             MOVE '4010-OPEN-CURSOR'                              28740030
287500                                   TO DP013-PARAGRAPH             28750030
287600             MOVE 'OPEN IN-STORE HEADER CURSOR - '                28760030
287700                                   TO DP013-MESSAGE-TEXT (1)      28770030
287800             MOVE SQLCA            TO DP013-SQLCA                 28780030
287900             SET DP013-DB2-ABEND                                  28790030
288000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               28800030
288100             PERFORM DP013-0000-PROCESS-ABEND                     28810030
288200     END-EVALUATE.                                                28820030
288300*                                                                 28830030
288400 EJECT                                                            28840030
288500*----------------------------------------------------------------*28850030
288600* CLOSE THE INSTORE DOCUMENT HEADER CURSOR.                      *28860030
288700*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *28870030
288800*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *28880030
288900*   USER.                                                        *28890030
289000*----------------------------------------------------------------*28900030
289100                                                                  28910030
289200 4020-CLOSE-CURSOR.                                               28920030
289300     EVALUATE TRUE                                                28930030
289400                                                                  28940030
289500         WHEN ASC-CURRENT-CURSOR                                  28950030
289600             MOVE 'CURSOR: CURRENT-CSR'                           28960030
289700                                   TO DP013-MESSAGE-TEXT (2)      28970030
289800             MOVE 'TSTRPPC '       TO DP013-DB2-TABLE-NAME (1)    28980030
289900             EXEC SQL                                             28990030
290000                 CLOSE CURRENT-CSR                                29000030
290100             END-EXEC                                             29010030
290200                                                                  29020030
290300         WHEN ASC-CURRENT-DEPT-CURSOR                             29030030
290400             MOVE 'CURSOR: CURRENT-DEPT-CSR'                      29040030
290500                                   TO DP013-MESSAGE-TEXT (2)      29050030
290600             MOVE 'TSTRPPC '       TO DP013-DB2-TABLE-NAME (1)    29060030
290700             MOVE 'TSPPCDT '       TO DP013-DB2-TABLE-NAME (2)    29070030
290800             EXEC SQL                                             29080030
290900                 CLOSE CURRENT-DEPT-CSR                           29090030
291000             END-EXEC                                             29100030
291100                                                                  29110030
291200         WHEN ASC-CURRENT-STATUS-CURSOR                           29120030
291300             MOVE 'CURSOR: CURRENT-STATUS-CSR'                    29130030
291400                                   TO DP013-MESSAGE-TEXT (2)      29140030
291500             MOVE 'TSTRPPC '       TO DP013-DB2-TABLE-NAME (1)    29150030
291600             EXEC SQL                                             29160030
291700                 CLOSE CURRENT-STATUS-CSR                         29170030
291800             END-EXEC                                             29180030
291900                                                                  29190030
292000         WHEN ASC-CURRENT-STATUS-DEPT-CURSOR                      29200030
292100             MOVE 'CURSOR: CURR-STAT-DEPT-CSR'                    29210030
292200                                   TO DP013-MESSAGE-TEXT (2)      29220030
292300             MOVE 'TSTRPPC '       TO DP013-DB2-TABLE-NAME (1)    29230030
292400             EXEC SQL                                             29240030
292500                 CLOSE CURR-STAT-DEPT-CSR                         29250030
292600             END-EXEC                                             29260030
292700                                                                  29270030
292800         WHEN ASC-HISTORY-CURRENT-CURSOR                          29280030
292900             MOVE 'CURSOR:  HIST-CURR-CSR'                        29290030
293000                                   TO DP013-MESSAGE-TEXT (2)      29300030
293100             MOVE 'TSTRPPC '       TO DP013-DB2-TABLE-NAME (1)    29310030
293200             MOVE 'TSTRPCH '       TO DP013-DB2-TABLE-NAME (2)    29320030
293300             EXEC SQL                                             29330030
293400                 CLOSE HIST-CURR-CSR                              29340030
293500             END-EXEC                                             29350030
293600                                                                  29360030
293700         WHEN ASC-HISTORY-STATUS-CURSOR                           29370030
293800             MOVE 'CURSOR:  HISTORY-STATUS-CSR'                   29380030
293900                                   TO DP013-MESSAGE-TEXT (2)      29390030
294000             MOVE 'TSTRPCH '       TO DP013-DB2-TABLE-NAME (1)    29400030
294100             EXEC SQL                                             29410030
294200                 CLOSE HISTORY-STATUS-CSR                         29420030
294300             END-EXEC                                             29430030
294400                                                                  29440030
294500         WHEN ASC-HISTORY-STATUS-DEPT-CURSOR                      29450030
294600             MOVE 'CURSOR:  HIST-STAT-DEPT-CSR'                   29460030
294700                                   TO DP013-MESSAGE-TEXT (2)      29470030
294800             MOVE 'TSTRPCH '       TO DP013-DB2-TABLE-NAME (1)    29480030
294900             MOVE 'TSPCDTH '       TO DP013-DB2-TABLE-NAME (2)    29490030
295000             EXEC SQL                                             29500030
295100                 CLOSE HIST-STAT-DEPT-CSR                         29510030
295200             END-EXEC                                             29520030
295300                                                                  29530030
295400         WHEN ASC-HIST-CURR-DEPT-CURSOR                           29540030
295500             MOVE 'CURSOR:  HIST-CURR-DEPT-CSR'                   29550030
295600                                   TO DP013-MESSAGE-TEXT (2)      29560030
295700             MOVE 'TSTRPCH '       TO DP013-DB2-TABLE-NAME (1)    29570030
295800             MOVE 'TSTRPPC '       TO DP013-DB2-TABLE-NAME (2)    29580030
295900             EXEC SQL                                             29590030
296000                 CLOSE HIST-CURR-DEPT-CSR                         29600030
296100             END-EXEC                                             29610030
296200                                                                  29620030
296300     END-EVALUATE.                                                29630030
296400*                                                                 29640030
296500     EVALUATE TRUE                                                29650030
296600         WHEN SQLCODE = ZERO                                      29660030
296700             CONTINUE                                             29670030
296800         WHEN SQLWARN0 NOT = SPACES                               29680030
296900         WHEN SQLCODE < ZERO                                      29690030
297000         WHEN SQLCODE > ZERO                                      29700030
297100             MOVE '4020-CLOSE-CURSOR'                             29710030
297200                               TO DP013-PARAGRAPH                 29720030
297300             MOVE 'CLOSE IN-STORE HEADER CURSOR '                 29730030
297400                               TO DP013-MESSAGE-TEXT (1)          29740030
297500             MOVE SQLCA        TO DP013-SQLCA                     29750030
297600             SET DP013-DB2-ABEND                                  29760030
297700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               29770030
297800             PERFORM DP013-0000-PROCESS-ABEND                     29780030
297900     END-EVALUATE.                                                29790030
298000*                                                                 29800030
298100 EJECT                                                            29810030
298200*----------------------------------------------------------------*29820030
298300*    SET UP THE HOST VARIABLES.                                  *29830030
298400*----------------------------------------------------------------*29840030
298500                                                                  29850030
298600 4100-PREPARE-CURSOR.                                             29860030
298700                                                                  29870030
298800     SET ASC-NO-CURSOR         TO TRUE.                           29880030
298900     MOVE ZERO                 TO ASC-STORE-NBR-LOW.              29890030
299000     MOVE ZERO                 TO ASC-DOC-NBR-LOW                 29900030
299100                                  ASC-REASON-CODE-LOW.            29910030
299200     MOVE PC-HIGH-DOC          TO ASC-DOC-NBR-HIGH.               29920030
299300     MOVE PC-HIGH-RSN          TO ASC-REASON-CODE-HIGH.           29930030
299400     MOVE ALL '0'              TO ASC-DEPT-NBR-LOW                29940030
299500                                  ASC-STATUS-CODE-LOW             29950030
299600                                  ASC-TYPE-CODE-LOW.              29960030
299700     MOVE ALL '9'              TO ASC-DEPT-NBR-HIGH               29970030
299800                                  ASC-STATUS-CODE-HIGH            29980030
299900                                  ASC-STORE-NBR-HIGH              29990030
300000                                  ASC-TYPE-CODE-HIGH.             30000030
300100     MOVE PE049-DEFAULT-DATE   TO ASC-TO-DATE.                    30010030
300200     MOVE '1900-01-01'         TO ASC-FROM-DATE.                  30020030
300300                                                                  30030030
300400     IF  ASC-KEY-STORE-NBR NOT = SPACES                           30040030
300500         MOVE ASC-KEY-STORE-NBR-N                                 30050030
300600                               TO ASC-STORE-NBR-LOW               30060030
300700                                  ASC-STORE-NBR-HIGH              30070030
300800     END-IF.                                                      30080030
300900*                                                                 30090030
301000     IF  ASC-KEY-DOC-NBR NOT = SPACES                             30100030
301100         MOVE ASC-KEY-DOC-NBR-N                                   30110030
301200                               TO ASC-DOC-NBR-LOW                 30120030
301300                                  ASC-DOC-NBR-HIGH                30130030
301400     END-IF.                                                      30140030
301500*                                                                 30150030
301600     IF  ASC-KEY-DEPT-NBR NOT = SPACES                            30160030
301700         MOVE ASC-KEY-DEPT-NBR-X TO PV-TEMP-DEPT                  30170030
301800         MOVE PV-TEMP-DEPT       TO ASC-DEPT-NBR-LOW              30180030
301900                                  ASC-DEPT-NBR-HIGH               30190030
302000     END-IF.                                                      30200030
302100*                                                                 30210030
302200     IF  ASC-KEY-REASON-CODE NOT = SPACES                         30220030
302300         MOVE ASC-KEY-REASON-CODE                                 30230030
302400                               TO PV-HOLD-TYPE-REASON             30240030
302500         MOVE PV-HOLD-REASON-CODE                                 30250030
302600                               TO ASC-REASON-CODE-LOW             30260030
302700                                  ASC-REASON-CODE-HIGH            30270030
302800         MOVE PV-HOLD-TYPE-CODE                                   30280030
302900                               TO ASC-TYPE-CODE-LOW               30290030
303000                                  ASC-TYPE-CODE-HIGH              30300030
303100     END-IF.                                                      30310030
303200*                                                                 30320030
303300     IF  ASC-KEY-STATUS-CODE NOT = SPACES                         30330030
303400         MOVE ASC-KEY-STATUS-CODE                                 30340030
303500                               TO ASC-STATUS-CODE-LOW             30350030
303600                                  ASC-STATUS-CODE-HIGH            30360030
303700         IF ASC-KEY-STATUS-CODE = PE049-IS-HISTORY-STATUS-CDE     30370030
303800             IF ASC-KEY-DEPT-NBR NOT = SPACES                     30380030
303900                 SET ASC-HISTORY-STATUS-DEPT-CURSOR               30390030
304000                               TO TRUE                            30400030
304100             ELSE                                                 30410030
304200                 SET ASC-HISTORY-STATUS-CURSOR                    30420030
304300                               TO TRUE                            30430030
304400             END-IF                                               30440030
304500         ELSE                                                     30450030
304600             IF ASC-KEY-DEPT-NBR NOT = SPACES                     30460030
304700                 SET ASC-CURRENT-STATUS-DEPT-CURSOR               30470030
304800                               TO TRUE                            30480030
304900             ELSE                                                 30490030
305000                 SET ASC-CURRENT-STATUS-CURSOR                    30500030
305100                               TO TRUE                            30510030
305200             END-IF                                               30520030
305300         END-IF                                                   30530030
305400     END-IF.                                                      30540030
305500*                                                                 30550030
305600     IF (ASC-KEY-FROM-DATE NOT = SPACES                           30560030
305700     AND ASC-KEY-TO-DATE NOT = SPACES)                            30570030
305800         MOVE ASC-KEY-FROM-DATE                                   30580030
305900                               TO ASC-FROM-DATE                   30590030
306000         MOVE ASC-KEY-TO-DATE  TO ASC-TO-DATE                     30600030
306100         IF ASC-NO-CURSOR                                         30610030
306200             IF ASC-KEY-DEPT-NBR NOT = SPACE                      30620030
306300                 SET ASC-HIST-CURR-DEPT-CURSOR                    30630030
306400                               TO TRUE                            30640030
306500             ELSE                                                 30650030
306600                 SET ASC-HISTORY-CURRENT-CURSOR                   30660030
306700                               TO TRUE                            30670030
306800             END-IF                                               30680030
306900         END-IF                                                   30690030
307000     END-IF.                                                      30700030
307100*                                                                 30710030
307200     IF ASC-NO-CURSOR                                             30720030
307300         IF ASC-KEY-DEPT-NBR NOT = SPACES                         30730030
307400             SET ASC-CURRENT-DEPT-CURSOR                          30740030
307500                               TO TRUE                            30750030
307600         ELSE                                                     30760030
307700             SET ASC-CURRENT-CURSOR                               30770030
307800                               TO TRUE                            30780030
307900         END-IF                                                   30790030
308000     END-IF.                                                      30800030
308100*                                                                 30810030
308200 EJECT                                                            30820030
308300*----------------------------------------------------------------*30830030
308400*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *30840030
308500*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *30850030
308600*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *30860030
308700*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *30870030
308800*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *30880030
308900*                                                                *30890030
309000*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *30900030
309100*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *30910030
309200*    UPON INITIALIZATION.                                        *30920030
309300*----------------------------------------------------------------*30930030
309400                                                                  30940030
309500 4300-READ-ITEMS-FROM-DB.                                         30950030
309600                                                                  30960030
309700     PERFORM                                                      30970030
309800         VARYING PV-READ-COUNT                                    30980030
309900         FROM 1 BY 1                                              30990030
310000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    31000030
310100            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         31010030
310200                                                                  31020030
310300         PERFORM 4310-FETCH                                       31030030
310400                                                                  31040030
310500         IF  ASC-ITEMS-LEFT-ON-DB                                 31050030
310600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                31060030
310700                 ADD +1            TO ASC-ITEM-SUB                31070030
310800             ELSE                                                 31080030
310900                 ADD +1            TO ASC-BLK-SUB                 31090030
311000                 MOVE +1           TO ASC-ITEM-SUB                31100030
311100                                                                  31110030
311200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         31120030
311300                     MOVE +1       TO ASC-BLK-SUB                 31130030
311400                     SET ASC-BLOCK-MODIFIED (1)                   31140030
311500                                   TO TRUE                        31150030
311600                     PERFORM 5100-WRITE-TEMP-STORAGE              31160030
311700                     MOVE ASC-BLOCK-ENTRIES                       31170030
311800                               (PC-MAX-BLOCKS-IN-ARRAY)           31180030
311900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 31190030
312000                     ADD +1        TO ASC-BLK-SUB                 31200030
312100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   31210030
312200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      31220030
312300                                   TO TRUE                        31230030
312400                 END-IF                                           31240030
312500             END-IF                                               31250030
312600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    31260030
312700             MOVE ASC-NUMBER-OF-ITEMS-READ                        31270030
312800                                   TO ASC-LIST-ITEM-NUMBER        31280030
312900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31290030
313000             MOVE STRPPC-DEST-LOC-NBR                             31300030
313100                                   TO ASC-STORE-NBR-N             31310030
313200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31320030
313300             MOVE STRPPC-DOC-NBR                                  31330030
313400                                   TO ASC-DOC-NBR                 31340030
313500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31350030
313600             MOVE STRPPC-CRE-DTE                                  31360030
313700                                   TO PV-HOLD-ISO-DATE            31370030
313800             MOVE PV-HOLD-ISO-MM   TO PV-HOLD-GREG-MM             31380030
313900             MOVE PV-HOLD-ISO-DD   TO PV-HOLD-GREG-DD             31390030
314000             MOVE PV-HOLD-ISO-YY   TO PV-HOLD-GREG-YY             31400030
314100             MOVE PV-HOLD-GREG-DATE                               31410030
314200                                   TO ASC-ISSUED-DATE             31420030
314300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31430030
314400             MOVE STRPPC-DEPT-AREA-DEST                           31440030
314500                                   TO PV-HOLD-DEPT-AREA-DEST      31450030
314600             MOVE PV-HOLD-PARTIAL-DEPT-AREA                       31460030
314700                                   TO ASC-DEPT-AREA-DEST          31470030
314800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31480030
314900             MOVE STRPPC-TYP-CDE   TO PV-HOLD-TYPE-CODE           31490030
315000             MOVE STRPPC-RSN-CDE   TO PV-HOLD-REASON-CODE         31500030
315100             IF PV-HOLD-TYPE-REASON = ZEROS                       31510030
315200                 MOVE SPACES       TO ASC-REASON-CODE             31520030
315300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31530030
315400             ELSE                                                 31540030
315500                 MOVE PV-HOLD-TYPE-REASON                         31550030
315600                                   TO ASC-REASON-CODE             31560030
315700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31570030
315800             END-IF                                               31580030
315900             MOVE STRPPC-STATUS-CDE                               31590030
316000                                   TO ASC-STATUS-CODE             31600030
316100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31610030
316200             EVALUATE TRUE                                        31620030
316300                 WHEN STRPPC-STATUS-CDE                           31630030
316400                                 = PE049-IS-AVAILABLE-STATUS-CDE  31640030
316500                     MOVE PE049-AVAILABLE-STATUS-DESC             31650030
316600                                   TO ASC-STATUS-DESC             31660030
316700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31670030
316800                 WHEN STRPPC-STATUS-CDE                           31680030
316900                                 = PE049-IS-CNTS-ENTER-STATUS-CDE 31690030
317000                     MOVE PE049-CNTS-ENTERED-STATUS-DESC          31700030
317100                                   TO ASC-STATUS-DESC             31710030
317200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31720030
317300                 WHEN STRPPC-STATUS-CDE                           31730030
317400                                 = PE049-IS-DELINQUENT-STATUS-CDE 31740030
317500                     MOVE PE049-DELINQUENT-STATUS-DESC            31750030
317600                                   TO ASC-STATUS-DESC             31760030
317700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31770030
317800                 WHEN STRPPC-STATUS-CDE                           31780030
317900                                 = PE049-IS-GENERATED-STATUS-CDE  31790030
318000                     MOVE PE049-GENERATED-STATUS-DESC             31800030
318100                                   TO ASC-STATUS-DESC             31810030
318200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31820030
318300                 WHEN STRPPC-STATUS-CDE                           31830030
318400                                 = PE049-IS-CANCELLED-STATUS-CDE  31840030
318500                     MOVE PE049-CANCELLED-STATUS-DESC             31850030
318600                                   TO ASC-STATUS-DESC             31860030
318700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31870030
318800                 WHEN STRPPC-STATUS-CDE                           31880030
318900                                 = PE049-IS-COMPLETED-STATUS-CDE  31890030
319000                     MOVE PE049-COMPLETE-STATUS-DESC              31900030
319100                                   TO ASC-STATUS-DESC             31910030
319200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31920030
319300                 WHEN STRPPC-STATUS-CDE                           31930030
319400                                 = PE049-IS-HISTORY-STATUS-CDE    31940030
319500                     MOVE PE049-HISTORY-STATUS-DESC               31950030
319600                                   TO ASC-STATUS-DESC             31960030
319700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 31970030
319800             END-EVALUATE                                         31980030
319900         END-IF                                                   31990030
320000     END-PERFORM.                                                 32000030
320100                                                                  32010030
320200     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          32020030
320300         MOVE +1               TO ASC-BLK-SUB                     32030030
320400         PERFORM 5100-WRITE-TEMP-STORAGE                          32040030
320500         ADD +1                TO ASC-BLK-SUB                     32050030
320600         PERFORM 5100-WRITE-TEMP-STORAGE                          32060030
320700                                                                  32070030
320800         MOVE 1                TO ASC-BLK-SUB                     32080030
320900                                  PV-BLOCK-NUMBER                 32090030
321000         PERFORM 4410-READ-TEMP-STORAGE                           32100030
321100         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             32110030
321200             MOVE 2            TO ASC-BLK-SUB                     32120030
321300                                  PV-BLOCK-NUMBER                 32130030
321400             PERFORM 4410-READ-TEMP-STORAGE                       32140030
321500         END-IF                                                   32150030
321600     END-IF.                                                      32160030
321700*                                                                 32170030
321800 EJECT                                                            32180030
321900*----------------------------------------------------------------*32190030
322000*    FETCH THE MESSAGE CURSOR.                                   *32200030
322100*----------------------------------------------------------------*32210030
322200                                                                  32220030
322300 4310-FETCH.                                                      32230030
322400                                                                  32240030
322500     EVALUATE TRUE                                                32250030
322600         WHEN ASC-CURRENT-CURSOR                                  32260030
322700              EXEC SQL                                            32270030
322800                   FETCH CURRENT-CSR                              32280030
322900                   INTO  :PV-SORT-FIELD                           32290030
323000                       , :STRPPC-DEST-LOC-NBR                     32300030
323100                       , :STRPPC-DOC-NBR                          32310030
323200                       , :STRPPC-RSN-CDE                          32320030
323300                       , :STRPPC-TYP-CDE                          32330030
323400                       , :STRPPC-STATUS-CDE                       32340030
323500                       , :STRPPC-DEPT-AREA-DEST                   32350030
323600                       , :STRPPC-CRE-DTE                          32360030
323700              END-EXEC                                            32370030
323800                                                                  32380030
323900         WHEN ASC-CURRENT-STATUS-CURSOR                           32390030
324000              EXEC SQL                                            32400030
324100                   FETCH CURRENT-STATUS-CSR                       32410030
324200                   INTO  :STRPPC-DEST-LOC-NBR                     32420030
324300                       , :STRPPC-DOC-NBR                          32430030
324400                       , :STRPPC-RSN-CDE                          32440030
324500                       , :STRPPC-TYP-CDE                          32450030
324600                       , :STRPPC-STATUS-CDE                       32460030
324700                       , :STRPPC-DEPT-AREA-DEST                   32470030
324800                       , :STRPPC-CRE-DTE                          32480030
324900              END-EXEC                                            32490030
325000                                                                  32500030
325100         WHEN ASC-CURRENT-DEPT-CURSOR                             32510030
325200              EXEC SQL                                            32520030
325300                   FETCH CURRENT-DEPT-CSR                         32530030
325400                   INTO  :PV-SORT-FIELD                           32540030
325500                       , :STRPPC-DEST-LOC-NBR                     32550030
325600                       , :STRPPC-DOC-NBR                          32560030
325700                       , :STRPPC-RSN-CDE                          32570030
325800                       , :STRPPC-TYP-CDE                          32580030
325900                       , :STRPPC-STATUS-CDE                       32590030
326000                       , :STRPPC-DEPT-AREA-DEST                   32600030
326100                       , :STRPPC-CRE-DTE                          32610030
326200              END-EXEC                                            32620030
326300                                                                  32630030
326400         WHEN ASC-CURRENT-STATUS-DEPT-CURSOR                      32640030
326500              EXEC SQL                                            32650030
326600                   FETCH CURR-STAT-DEPT-CSR                       32660030
326700                   INTO  :STRPPC-DEST-LOC-NBR                     32670030
326800                       , :STRPPC-DOC-NBR                          32680030
326900                       , :STRPPC-RSN-CDE                          32690030
327000                       , :STRPPC-TYP-CDE                          32700030
327100                       , :STRPPC-STATUS-CDE                       32710030
327200                       , :STRPPC-DEPT-AREA-DEST                   32720030
327300                       , :STRPPC-CRE-DTE                          32730030
327400              END-EXEC                                            32740030
327500                                                                  32750030
327600         WHEN ASC-HISTORY-STATUS-CURSOR                           32760030
327700              EXEC SQL                                            32770030
327800                   FETCH HISTORY-STATUS-CSR                       32780030
327900                   INTO  :STRPPC-DEST-LOC-NBR                     32790030
328000                       , :STRPPC-DOC-NBR                          32800030
328100                       , :STRPPC-RSN-CDE                          32810030
328200                       , :STRPPC-TYP-CDE                          32820030
328300                       , :STRPPC-STATUS-CDE                       32830030
328400                       , :STRPPC-DEPT-AREA-DEST                   32840030
328500                       , :STRPPC-CRE-DTE                          32850030
328600              END-EXEC                                            32860030
328700                                                                  32870030
328800         WHEN ASC-HISTORY-STATUS-DEPT-CURSOR                      32880030
328900              EXEC SQL                                            32890030
329000                   FETCH HIST-STAT-DEPT-CSR                       32900030
329100                   INTO  :STRPPC-DEST-LOC-NBR                     32910030
329200                       , :STRPPC-DOC-NBR                          32920030
329300                       , :STRPPC-RSN-CDE                          32930030
329400                       , :STRPPC-TYP-CDE                          32940030
329500                       , :STRPPC-STATUS-CDE                       32950030
329600                       , :STRPPC-DEPT-AREA-DEST                   32960030
329700                       , :STRPPC-CRE-DTE                          32970030
329800              END-EXEC                                            32980030
329900                                                                  32990030
330000         WHEN ASC-HISTORY-CURRENT-CURSOR                          33000030
330100              EXEC SQL                                            33010030
330200                   FETCH HIST-CURR-CSR                            33020030
330300                   INTO  :PV-SORT-FIELD                           33030030
330400                       , :STRPPC-DEST-LOC-NBR                     33040030
330500                       , :STRPPC-DOC-NBR                          33050030
330600                       , :STRPPC-RSN-CDE                          33060030
330700                       , :STRPPC-TYP-CDE                          33070030
330800                       , :STRPPC-STATUS-CDE                       33080030
330900                       , :STRPPC-DEPT-AREA-DEST                   33090030
331000                       , :STRPPC-CRE-DTE                          33100030
331100              END-EXEC                                            33110030
331200                                                                  33120030
331300         WHEN ASC-HIST-CURR-DEPT-CURSOR                           33130030
331400              EXEC SQL                                            33140030
331500                   FETCH HIST-CURR-DEPT-CSR                       33150030
331600                   INTO  :PV-SORT-FIELD                           33160030
331700                       , :STRPPC-DEST-LOC-NBR                     33170030
331800                       , :STRPPC-DOC-NBR                          33180030
331900                       , :STRPPC-RSN-CDE                          33190030
332000                       , :STRPPC-TYP-CDE                          33200030
332100                       , :STRPPC-STATUS-CDE                       33210030
332200                       , :STRPPC-DEPT-AREA-DEST                   33220030
332300                       , :STRPPC-CRE-DTE                          33230030
332400              END-EXEC                                            33240030
332500     END-EVALUATE.                                                33250030
332600                                                                  33260030
332700     EVALUATE TRUE                                                33270030
332800         WHEN SQLCODE = ZERO                                      33280030
332900         WHEN SQLCODE = +100                                      33290030
333000              CONTINUE                                            33300030
333100         WHEN SQLWARN0 NOT = SPACE                                33310030
333200         WHEN SQLCODE NOT = ZERO                                  33320030
333300              MOVE '4310-FETCH-CURSOR'                            33330030
333400                               TO DP013-PARAGRAPH                 33340030
333500              MOVE 'FETCH IN-STORE HEADER CURSOR'                 33350030
333600                               TO DP013-MESSAGE-TEXT (1)          33360030
333700              MOVE SQLCA       TO DP013-SQLCA                     33370030
333800              SET DP013-DB2-ABEND                                 33380030
333900                               TO TRUE                            33390030
334000              PERFORM DP013-0000-PROCESS-ABEND                    33400030
334100     END-EVALUATE.                                                33410030
334200                                                                  33420030
334300     IF  SQLCODE EQUAL +100                                       33430030
334400         SET ASC-NO-ITEMS-LEFT-ON-DB                              33440030
334500                                   TO TRUE                        33450030
334600     END-IF.                                                      33460030
334700*                                                                 33470030
334800 EJECT                                                            33480030
334900*----------------------------------------------------------------*33490030
335000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *33500030
335100*----------------------------------------------------------------*33510030
335200                                                                  33520030
335300 4400-MOVE-COMMAREA-TO-SCREEN.                                    33530030
335400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             33540030
335500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          33550030
335600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          33560030
335700             MOVE +1    TO ASC-BLK-SUB                            33570030
335800             PERFORM 5100-WRITE-TEMP-STORAGE                      33580030
335900             ADD +1     TO ASC-BLK-SUB                            33590030
336000             PERFORM 5100-WRITE-TEMP-STORAGE                      33600030
336100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             33610030
336200                 GIVING PV-BLOCK-NUMBER                           33620030
336300                 REMAINDER PV-REMAINDER                           33630030
336400             IF  PV-REMAINDER > ZERO                              33640030
336500                 ADD +1 TO PV-BLOCK-NUMBER                        33650030
336600             END-IF                                               33660030
336700             MOVE +1    TO ASC-BLK-SUB                            33670030
336800             PERFORM 4410-READ-TEMP-STORAGE                       33680030
336900             ADD +1     TO ASC-BLK-SUB                            33690030
337000                           PV-BLOCK-NUMBER                        33700030
337100             PERFORM 4410-READ-TEMP-STORAGE                       33710030
337200     END-IF.                                                      33720030
337300     MOVE +1            TO ASC-BLK-SUB.                           33730030
337400     COMPUTE ASC-ITEM-SUB =                                       33740030
337500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              33750030
337600         + PC-ITEMS-PER-PANEL).                                   33760030
337700*                                                                 33770030
337800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        33780030
337900         ADD +1         TO ASC-BLK-SUB                            33790030
338000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            33800030
338100     END-IF.                                                      33810030
338200*                                                                 33820030
338300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           33830030
338400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                33840030
338500     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        33850030
338600     PERFORM 4420-FORMAT-LIST-LINES                               33860030
338700         VARYING PV-SUB                                           33870030
338800         FROM PC-ITEMS-PER-PANEL BY -1                            33880030
338900         UNTIL PV-SUB < +1.                                       33890030
339000*                                                                 33900030
339100     COMPUTE ASC-ITEMS-DISPLAYED =                                33910030
339200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          33920030
339300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    33930030
339400                                      ASTRTITO.                   33940030
339500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    33950030
339600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    33960030
339700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            33970030
339800                                   TO ASELITO.                    33980030
339900*                                                                 33990030
340000     IF  DP020-MSG-NUMBER = 0                                     34000030
340100         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  34010030
340200*            --- MORE ITEMS TO DISPLAY ----                       34020030
340300             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            34030030
340400             SET DP020-MSG-INFORMATIONAL TO TRUE                  34040030
340500         END-IF                                                   34050030
340600     END-IF.                                                      34060030
340700*                                                                 34070030
340800 EJECT                                                            34080030
340900*----------------------------------------------------------------*34090030
341000*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *34100030
341100*----------------------------------------------------------------*34110030
341200                                                                  34120030
341300 4410-READ-TEMP-STORAGE.                                          34130030
341400                                                                  34140030
341500     EXEC CICS                                                    34150030
341600         READQ TS                                                 34160030
341700             QUEUE (ASC-LIST-QUEUE-NAME)                          34170030
341800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               34180030
341900             ITEM  (PV-BLOCK-NUMBER)                              34190030
342000             RESP  (PV-CICS-RESP)                                 34200030
342100     END-EXEC.                                                    34210030
342200                                                                  34220030
342300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       34230030
342400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     34240030
342500         CONTINUE                                                 34250030
342600     ELSE                                                         34260030
342700         SET DP013-CICS-ABEND     TO TRUE                         34270030
342800         SET DP013-NO-ROLLBACK    TO TRUE                         34280030
342900         MOVE '4410-READ-TEMP-STORAGE'                            34290030
343000                                  TO DP013-PARAGRAPH              34300030
343100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      34310030
343200                                  TO DP013-MESSAGE-TEXT(1)        34320030
343300         PERFORM DP013-0000-PROCESS-ABEND                         34330030
343400     END-IF.                                                      34340030
343500                                                                  34350030
343600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             34360030
343700*                                                                 34370030
343800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         34380030
343900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               34390030
344000     END-IF.                                                      34400030
344100*                                                                 34410030
344200 EJECT                                                            34420030
344300*----------------------------------------------------------------*34430030
344400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *34440030
344500*----------------------------------------------------------------*34450030
344600                                                                  34460030
344700 4420-FORMAT-LIST-LINES.                                          34470030
344800     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      34480030
344900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                34490030
345000         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA        (PV-SUB)    34500030
345100         MOVE DP015-HL-OFF       TO MR-STORE-NBRH (PV-SUB)        34510030
345200                                    MR-DOC-NBRH (PV-SUB)          34520030
345300                                    MR-ISSUED-DATEH (PV-SUB)      34530030
345400                                    MR-DEPT-AREA-DESTH (PV-SUB)   34540030
345500                                    MR-REASON-CODEH (PV-SUB)      34550030
345600                                    MR-STATUS-CODEH (PV-SUB)      34560030
345700                                    MR-STATUS-DESCH (PV-SUB)      34570030
345800         MOVE SPACE              TO MR-SELECTI        (PV-SUB)    34580030
345900                                    MR-ACTION         (PV-SUB)    34590030
346000                                    MR-STORE-NBR      (PV-SUB)    34600030
346100                                    MR-DOC-NBR        (PV-SUB)    34610030
346200                                    MR-ISSUED-DATE    (PV-SUB)    34620030
346300                                    MR-DEPT-AREA-DEST (PV-SUB)    34630030
346400                                    MR-REASON-CODE    (PV-SUB)    34640030
346500                                    MR-STATUS-CODE    (PV-SUB)    34650030
346600                                    MR-STATUS-DESC    (PV-SUB)    34660030
346700     ELSE                                                         34670030
346800         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      34680030
346900                                                   > SPACE        34690030
347000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 34700030
347100                                 TO MR-SELECTI (PV-SUB)           34710030
347200         ELSE                                                     34720030
347300             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      34730030
347400                                 TO MR-SELECTI (PV-SUB)           34740030
347500         END-IF                                                   34750030
347600*                                                                 34760030
347700         IF  DP030-SET-CURSOR-TRAILER                             34770030
347800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)34780030
347900                 > SPACE)                                         34790030
348000               OR (PV-SUB = 1))                                   34800030
348100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               34810030
348200                MOVE -1          TO MR-SELECTL (PV-SUB)           34820030
348300             END-IF                                               34830030
348400         END-IF                                                   34840030
348500*                                                                 34850030
348600         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           34860030
348700             MOVE ASC-ACTION         (ASC-BLK-SUB ASC-ITEM-SUB)   34870030
348800                                 TO MR-ACTION         (PV-SUB)    34880030
348900             MOVE ASC-STORE-NBR      (ASC-BLK-SUB ASC-ITEM-SUB)   34890030
349000                                 TO MR-STORE-NBR      (PV-SUB)    34900030
349100             MOVE ASC-DOC-NBR        (ASC-BLK-SUB ASC-ITEM-SUB)   34910030
349200                                 TO MR-DOC-NBR        (PV-SUB)    34920030
349300             MOVE ASC-ISSUED-DATE    (ASC-BLK-SUB ASC-ITEM-SUB)   34930030
349400                                 TO MR-ISSUED-DATE    (PV-SUB)    34940030
349500             MOVE ASC-DEPT-AREA-DEST (ASC-BLK-SUB ASC-ITEM-SUB)   34950030
349600                                 TO MR-DEPT-AREA-DEST (PV-SUB)    34960030
349700             MOVE ASC-REASON-CODE    (ASC-BLK-SUB ASC-ITEM-SUB)   34970030
349800                                 TO MR-REASON-CODE    (PV-SUB)    34980030
349900             MOVE ASC-STATUS-CODE    (ASC-BLK-SUB ASC-ITEM-SUB)   34990030
350000                                 TO MR-STATUS-CODE    (PV-SUB)    35000030
350100             MOVE ASC-STATUS-DESC    (ASC-BLK-SUB ASC-ITEM-SUB)   35010030
350200                                 TO MR-STATUS-DESC    (PV-SUB)    35020030
350300             IF ASC-STATUS-CODE (ASC-BLK-SUB ASC-ITEM-SUB) =      35030030
350400                                PE049-IS-DELINQUENT-STATUS-CDE    35040030
350500                 MOVE DP015-YELLOW                                35050030
350600                                 TO MR-STORE-NBRC (PV-SUB)        35060030
350700                                    MR-DOC-NBRC (PV-SUB)          35070030
350800                                    MR-ISSUED-DATEC (PV-SUB)      35080030
350900                                    MR-DEPT-AREA-DESTC (PV-SUB)   35090030
351000                                    MR-REASON-CODEC (PV-SUB)      35100030
351100                                    MR-STATUS-CODEC (PV-SUB)      35110030
351200                                    MR-STATUS-DESCC (PV-SUB)      35120030
351300                 MOVE DP015-REVERSE                               35130030
351400                                 TO MR-STORE-NBRH (PV-SUB)        35140030
351500                                    MR-DOC-NBRH (PV-SUB)          35150030
351600                                    MR-ISSUED-DATEH (PV-SUB)      35160030
351700                                    MR-DEPT-AREA-DESTH (PV-SUB)   35170030
351800                                    MR-REASON-CODEH (PV-SUB)      35180030
351900                                    MR-STATUS-CODEH (PV-SUB)      35190030
352000                                    MR-STATUS-DESCH (PV-SUB)      35200030
352100             ELSE                                                 35210030
352200                 MOVE DP015-BLUE TO MR-STORE-NBRC (PV-SUB)        35220030
352300                                    MR-DOC-NBRC (PV-SUB)          35230030
352400                                    MR-ISSUED-DATEC (PV-SUB)      35240030
352500                                    MR-DEPT-AREA-DESTC (PV-SUB)   35250030
352600                                    MR-REASON-CODEC (PV-SUB)      35260030
352700                                    MR-STATUS-CODEC (PV-SUB)      35270030
352800                                    MR-STATUS-DESCC (PV-SUB)      35280030
352900                 MOVE DP015-HL-OFF                                35290030
353000                                 TO MR-STORE-NBRH (PV-SUB)        35300030
353100                                    MR-DOC-NBRH (PV-SUB)          35310030
353200                                    MR-ISSUED-DATEH (PV-SUB)      35320030
353300                                    MR-DEPT-AREA-DESTH (PV-SUB)   35330030
353400                                    MR-REASON-CODEH (PV-SUB)      35340030
353500                                    MR-STATUS-CODEH (PV-SUB)      35350030
353600                                    MR-STATUS-DESCH (PV-SUB)      35360030
353700             END-IF                                               35370030
353800         END-IF                                                   35380030
353900     END-IF.                                                      35390030
354000     SUBTRACT +1 FROM ASC-ITEM-SUB                                35400030
354100     IF  ASC-ITEM-SUB < + 1                                       35410030
354200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  35420030
354300         MOVE +1                 TO ASC-BLK-SUB                   35430030
354400     END-IF.                                                      35440030
354500*                                                                 35450030
354600 EJECT                                                            35460030
354700*----------------------------------------------------------------*35470030
354800*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *35480030
354900*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *35490030
355000*  ISSUE A WARNING.                                              *35500030
355100*----------------------------------------------------------------*35510030
355200 4430-CHECK-FOR-BEGIN-AND-END.                                    35520030
355300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       35530030
355400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     35540030
355500*            -- NO END-OF-RANGE SPECFIED ---                      35550030
355600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            35560030
355700             SET DP020-MSG-WARNING TO TRUE                        35570030
355800             PERFORM 4431-POSITION-AT-WARNING                     35580030
355900         END-IF                                                   35590030
356000     ELSE                                                         35600030
356100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     35610030
356200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                35620030
356300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            35630030
356400             SET DP020-MSG-WARNING TO TRUE                        35640030
356500             PERFORM 4431-POSITION-AT-WARNING                     35650030
356600         END-IF                                                   35660030
356700     END-IF.                                                      35670030
356800*                                                                 35680030
356900 EJECT                                                            35690030
357000*----------------------------------------------------------------*35700030
357100*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *35710030
357200*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *35720030
357300*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *35730030
357400*  POSITION THE CURSOR THERE.                                    *35740030
357500*----------------------------------------------------------------*35750030
357600 4431-POSITION-AT-WARNING.                                        35760030
357700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 35770030
357800                    - PV-TOP-ITEM + 1.                            35780030
357900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      35790030
358000         CONTINUE                                                 35800030
358100     ELSE                                                         35810030
358200         SET DP030-SET-CURSOR-APPL-1                              35820030
358300                                   TO TRUE                        35830030
358400         MOVE -1                   TO MR-SELECTL (PV-SUB)         35840030
358500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         35850030
358600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         35860030
358700     END-IF.                                                      35870030
358800*                                                                 35880030
358900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   35890030
359000                    - PV-TOP-ITEM + 1.                            35900030
359100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      35910030
359200         CONTINUE                                                 35920030
359300     ELSE                                                         35930030
359400         SET DP030-SET-CURSOR-APPL-1                              35940030
359500                                   TO TRUE                        35950030
359600         MOVE -1                   TO MR-SELECTL (PV-SUB)         35960030
359700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         35970030
359800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         35980030
359900     END-IF.                                                      35990030
360000*                                                                 36000030
360100 EJECT                                                            36010030
360200*----------------------------------------------------------------*36020030
360300* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *36030030
360400* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *36040030
360500* FOR THE SELECTED ITEMS QUEUE.                                  *36050030
360600*                                                                *36060030
360700* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *36070030
360800* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *36080030
360900* THE ARRAY IS FULL.                                             *36090030
361000*----------------------------------------------------------------*36100030
361100                                                                  36110030
361200 5000-PREPARE-SEL-QUEUE.                                          36120030
361300                                                                  36130030
361400     MOVE +1                   TO  ASC-BLK-SUB.                   36140030
361500     PERFORM 5100-WRITE-TEMP-STORAGE.                             36150030
361600     ADD +1                    TO  ASC-BLK-SUB.                   36160030
361700     PERFORM 5100-WRITE-TEMP-STORAGE.                             36170030
361800                                                                  36180030
361900     MOVE ASC-SEL-QUEUE-NAME   TO  PE066-SEL-QUEUE-NAME.          36190030
362000     PERFORM 6010-DELETE-SEL-QUEUE.                               36200030
362100                                                                  36210030
362200     SET ASC-UPDATE-TSQ        TO  TRUE.                          36220030
362300                                                                  36230030
362400     SET PE067-IDX             TO  1.                             36240030
362500     MOVE ZERO                 TO PE066-NUMBER-OF-TS-ITEMS.       36250030
362600     INITIALIZE PE067-SELECTED-ITEM-ARRAY.                        36260030
362700                                                                  36270030
362800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           36280030
362900             VARYING PV-ITEM                                      36290030
363000             FROM 1 BY 1                                          36300030
363100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     36310030
363200                                                                  36320030
363300     IF  PE067-IDX > 1                                            36330030
363400         PERFORM 5205-WRITE-SEL-QUEUE                             36340030
363500         ADD +1                TO PE066-NUMBER-OF-TS-ITEMS        36350030
363600     END-IF.                                                      36360030
363700*                                                                 36370030
363800 EJECT                                                            36380030
363900*----------------------------------------------------------------*36390030
364000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *36400030
364100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *36410030
364200*----------------------------------------------------------------*36420030
364300                                                                  36430030
364400 5100-WRITE-TEMP-STORAGE.                                         36440030
364500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     36450030
364600                                   TO PV-LIST-ITEM-NUMBER.        36460030
364700     COMPUTE PV-BLOCK-NUMBER =                                    36470030
364800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    36480030
364900                                                                  36490030
365000     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             36500030
365100     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             36510030
365200         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      36520030
365300             PERFORM 5105-REWRITE-ASC-LISTQ                       36530030
365400         END-IF                                                   36540030
365500     ELSE                                                         36550030
365600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       36560030
365700         ASC-HIGHEST-BLOCK-WRITTEN + 1                            36570030
365800         PERFORM 5110-WRITE-ASC-LISTQ                             36580030
365900         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   36590030
366000     END-IF.                                                      36600030
366100                                                                  36610030
366200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             36620030
366300*                                                                 36630030
366400 EJECT                                                            36640030
366500*----------------------------------------------------------------*36650030
366600*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *36660030
366700*  SPECIFIC COMMAREA.                                            *36670030
366800*----------------------------------------------------------------*36680030
366900 5105-REWRITE-ASC-LISTQ.                                          36690030
367000     EXEC CICS                                                    36700030
367100         WRITEQ TS                                                36710030
367200             QUEUE (ASC-LIST-QUEUE-NAME)                          36720030
367300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               36730030
367400             ITEM  (PV-BLOCK-NUMBER)                              36740030
367500             REWRITE                                              36750030
367600             RESP  (PV-CICS-RESP)                                 36760030
367700     END-EXEC.                                                    36770030
367800                                                                  36780030
367900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           36790030
368000         CONTINUE                                                 36800030
368100     ELSE                                                         36810030
368200         SET DP013-CICS-ABEND            TO TRUE                  36820030
368300         SET DP013-NO-ROLLBACK           TO TRUE                  36830030
368400         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       36840030
368500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     36850030
368600                                         TO DP013-MESSAGE-TEXT(1) 36860030
368700         PERFORM DP013-0000-PROCESS-ABEND                         36870030
368800     END-IF.                                                      36880030
368900*                                                                 36890030
369000 EJECT                                                            36900030
369100*----------------------------------------------------------------*36910030
369200*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *36920030
369300*  SPECIFIC COMMAREA.                                            *36930030
369400*----------------------------------------------------------------*36940030
369500 5110-WRITE-ASC-LISTQ.                                            36950030
369600     EXEC CICS                                                    36960030
369700         WRITEQ TS                                                36970030
369800             QUEUE (ASC-LIST-QUEUE-NAME)                          36980030
369900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               36990030
370000             ITEM  (PV-BLOCK-NUMBER)                              37000030
370100             RESP  (PV-CICS-RESP)                                 37010030
370200     END-EXEC.                                                    37020030
370300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      37030030
370400         SET DP013-CICS-ABEND      TO TRUE                        37040030
370500         SET DP013-NO-ROLLBACK     TO TRUE                        37050030
370600         MOVE '5110-WRITE-ASC-LISTQ'                              37060030
370700                                   TO DP013-PARAGRAPH             37070030
370800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           37080030
370900                                   TO DP013-MESSAGE-TEXT(1)       37090030
371000         PERFORM DP013-0000-PROCESS-ABEND                         37100030
371100     END-IF.                                                      37110030
371200*                                                                 37120030
371300 EJECT                                                            37130030
371400*----------------------------------------------------------------*37140030
371500* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *37150030
371600* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *37160030
371700*----------------------------------------------------------------*37170030
371800                                                                  37180030
371900 5200-FILL-SEL-QUEUE-RECORD.                                      37190030
372000                                                                  37200030
372100     PERFORM 6112-READ-LIST-QUEUE.                                37210030
372200                                                                  37220030
372300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       37230030
372400         PERFORM                                                  37240030
372500         VARYING LQW-IDX                                          37250030
372600         FROM 1 BY 1                                              37260030
372700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            37270030
372800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          37280030
372900                                                                  37290030
373000             IF  LQW-SELECT (LQW-IDX)                             37300030
373100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              37310030
373200                                   TO PE067-ITEM (PE067-IDX)      37320030
373300                 MOVE LQW-STORE-NBR (LQW-IDX)                     37330030
373400                                   TO PE067-STORE-NUMBER          37340030
373500                                        (PE067-IDX)               37350030
373600                 MOVE LQW-DOC-NBR (LQW-IDX)                       37360030
373700                                   TO PE067-DOCUMENT-NUMBER       37370030
373800                                        (PE067-IDX)               37380030
373900                 MOVE SPACE        TO PE067-ACTION-SW (PE067-IDX) 37390030
374000                 SET PE067-IDX UP BY 1                            37400030
374100                 IF  PE067-IDX > PE067-MAX-ITEMS                  37410030
374200                     PERFORM 5205-WRITE-SEL-QUEUE                 37420030
374300                     ADD +1        TO PE066-NUMBER-OF-TS-ITEMS    37430030
374400                     INITIALIZE PE067-SELECTED-ITEM-ARRAY         37440030
374500                     SET PE067-IDX TO  1                          37450030
374600                 END-IF                                           37460030
374700             END-IF                                               37470030
374800         END-PERFORM                                              37480030
374900     END-IF.                                                      37490030
375000*                                                                 37500030
375100 EJECT                                                            37510030
375200*----------------------------------------------------------------*37520030
375300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *37530030
375400*----------------------------------------------------------------*37540030
375500                                                                  37550030
375600 5205-WRITE-SEL-QUEUE.                                            37560030
375700                                                                  37570030
375800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            37580030
375900                                   TO PE067-SELECTED-ITEMS.       37590030
376000                                                                  37600030
376100     EXEC CICS                                                    37610030
376200          WRITEQ TS                                               37620030
376300              QUEUE (ASC-SEL-QUEUE-NAME)                          37630030
376400              FROM  (PE067-DOCUMENT-SEL-REC)                      37640030
376500              ITEM  (PV-SEL-QUEUE-ITEM)                           37650030
376600              RESP  (PV-CICS-RESP)                                37660030
376700     END-EXEC.                                                    37670030
376800                                                                  37680030
376900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          37690030
377000         CONTINUE                                                 37700030
377100     ELSE                                                         37710030
377200         SET DP013-CICS-ABEND      TO TRUE                        37720030
377300         SET DP013-NO-ROLLBACK     TO TRUE                        37730030
377400         MOVE '5205-WRITE-SEL-QUEUE'                              37740030
377500                                   TO DP013-PARAGRAPH             37750030
377600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          37760030
377700                                   TO DP013-MESSAGE-TEXT(1)       37770030
377800         PERFORM DP013-0000-PROCESS-ABEND                         37780030
377900     END-IF.                                                      37790030
378000*                                                                 37800030
378100 EJECT                                                            37810030
378200*----------------------------------------------------------------*37820030
378300*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *37830030
378400*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *37840030
378500*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *37850030
378600*  THE USER.                                                     *37860030
378700*----------------------------------------------------------------*37870030
378800 6000-REFRESH-PANEL-FROM-TEMP.                                    37880030
378900     IF  ASC-UPDATE-TSQ                                           37890030
379000         SET ASC-NO-TSQ-UPDATE TO TRUE                            37900030
379100         MOVE ZERO                 TO PV-SAVE-ITEM                37910030
379200                                      PV-SEL-QUEUE-ITEM           37920030
379300         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        37930030
379400                                   TO PV-HOLD-SELECTED-ITEMS      37940030
379500         PERFORM 6100-UPDATE-TSQ                                  37950030
379600             UNTIL PV-ITEMS-PROCESSED >                           37960030
379700                                     ASC-NUMBER-OF-SELECTED-ITEMS 37970030
379800         PERFORM 6010-DELETE-SEL-QUEUE                            37980030
379900         INITIALIZE ASC-BLOCK-ENTRIES (1)                         37990030
380000                    ASC-BLOCK-ENTRIES (2)                         38000030
380100         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 38010030
380200             GIVING PV-BLOCK-NUMBER                               38020030
380300             REMAINDER PV-REMAINDER                               38030030
380400         IF PV-REMAINDER > ZERO                                   38040030
380500             ADD +1      TO PV-BLOCK-NUMBER                       38050030
380600         END-IF                                                   38060030
380700         MOVE +1         TO ASC-BLK-SUB                           38070030
380800         PERFORM 4410-READ-TEMP-STORAGE                           38080030
380900         ADD +1          TO ASC-BLK-SUB                           38090030
381000                            PV-BLOCK-NUMBER                       38100030
381100         PERFORM 4410-READ-TEMP-STORAGE                           38110030
381200     END-IF.                                                      38120030
381300*                                                                 38130030
381400 EJECT                                                            38140030
381500*----------------------------------------------------------------*38150030
381600*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *38160030
381700*----------------------------------------------------------------*38170030
381800 6010-DELETE-SEL-QUEUE.                                           38180030
381900                                                                  38190030
382000     EXEC CICS                                                    38200030
382100         DELETEQ TS                                               38210030
382200             QUEUE (ASC-SEL-QUEUE-NAME)                           38220030
382300             RESP  (PV-CICS-RESP)                                 38230030
382400     END-EXEC.                                                    38240030
382500*                                                                 38250030
382600     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      38260030
382700        (PV-CICS-RESP = DFHRESP(QIDERR)))                         38270030
382800         CONTINUE                                                 38280030
382900     ELSE                                                         38290030
383000         SET DP013-CICS-ABEND TO TRUE                             38300030
383100         SET DP013-NO-ROLLBACK TO TRUE                            38310030
383200         MOVE '6010-DELETE-SEL-QUEUE'                             38320030
383300                        TO DP013-PARAGRAPH                        38330030
383400         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         38340030
383500                        TO DP013-MESSAGE-TEXT (1)                 38350030
383600         PERFORM DP013-0000-PROCESS-ABEND                         38360030
383700     END-IF.                                                      38370030
383800*                                                                 38380030
383900 EJECT                                                            38390030
384000*----------------------------------------------------------------*38400030
384100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *38410030
384200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *38420030
384300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *38430030
384400*    THE TEMP QUEUE.                                             *38440030
384500*----------------------------------------------------------------*38450030
384600                                                                  38460030
384700 6100-UPDATE-TSQ.                                                 38470030
384800                                                                  38480030
384900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             38490030
385000     PERFORM 6105-READ-SEL-QUEUE.                                 38500030
385100     PERFORM                                                      38510030
385200         VARYING PE067-IDX                                        38520030
385300         FROM 1 BY 1                                              38530030
385400         UNTIL ((PV-ITEMS-PROCESSED >                             38540030
385500                              PV-HOLD-SELECTED-ITEMS)             38550030
385600         OR (PE067-IDX GREATER THAN PE067-MAX-ITEMS))             38560030
385700         IF  PE067-ACTION-SW (PE067-IDX) > SPACE                  38570030
385800             PERFORM 6110-PROCESS-ITEMS                           38580030
385900         END-IF                                                   38590030
386000         ADD +1                TO PV-ITEMS-PROCESSED              38600030
386100     END-PERFORM.                                                 38610030
386200     PERFORM 6111-WRITE-LIST-QUEUE.                               38620030
386300*                                                                 38630030
386400 EJECT                                                            38640030
386500*----------------------------------------------------------------*38650030
386600*    READ THE LIST QUEUE RECORD.                                 *38660030
386700*----------------------------------------------------------------*38670030
386800                                                                  38680030
386900 6105-READ-SEL-QUEUE.                                             38690030
387000                                                                  38700030
387100     EXEC CICS                                                    38710030
387200          READQ TS                                                38720030
387300              QUEUE (ASC-SEL-QUEUE-NAME)                          38730030
387400              INTO  (PE067-DOCUMENT-SEL-REC)                      38740030
387500              ITEM  (PV-SEL-QUEUE-ITEM)                           38750030
387600              RESP  (PV-CICS-RESP)                                38760030
387700     END-EXEC.                                                    38770030
387800*                                                                 38780030
387900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          38790030
388000         CONTINUE                                                 38800030
388100     ELSE                                                         38810030
388200         SET DP013-CICS-ABEND      TO  TRUE                       38820030
388300         SET DP013-NO-ROLLBACK     TO  TRUE                       38830030
388400         MOVE '6105-READ-SEL-QUEUE'                               38840030
388500                                   TO  DP013-PARAGRAPH            38850030
388600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           38860030
388700                                   TO  DP013-MESSAGE-TEXT(1)      38870030
388800         PERFORM DP013-0000-PROCESS-ABEND                         38880030
388900     END-IF.                                                      38890030
389000*                                                                 38900030
389100 EJECT                                                            38910030
389200*----------------------------------------------------------------*38920030
389300*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*38930030
389400*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*38940030
389500*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *38950030
389600*----------------------------------------------------------------*38960030
389700                                                                  38970030
389800 6110-PROCESS-ITEMS.                                              38980030
389900                                                                  38990030
390000     COMPUTE PV-ITEM = 1 + ((PE067-ITEM (PE067-IDX) - 1)          39000030
390100                     / PC-ITEMS-PER-PANEL).                       39010030
390200                                                                  39020030
390300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           39030030
390400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          39040030
390500             PERFORM 6111-WRITE-LIST-QUEUE                        39050030
390600         END-IF                                                   39060030
390700         MOVE PV-ITEM          TO PV-SAVE-ITEM                    39070030
390800                                                                  39080030
390900         PERFORM 6112-READ-LIST-QUEUE                             39090030
391000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               39100030
391100             CONTINUE                                             39110030
391200         END-IF                                                   39120030
391300     END-IF.                                                      39130030
391400                                                                  39140030
391500     COMPUTE PV-SUB = (PE067-ITEM (PE067-IDX)                     39150030
391600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              39160030
391700     SET LQW-DESELECT (PV-SUB) TO    TRUE                         39170030
391800     MOVE LQW-SELECTED-SW (PV-SUB)                                39180030
391900                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  39190030
392000     EVALUATE TRUE                                                39200030
392100         WHEN PE067-INQ (PE067-IDX)                               39210030
392200              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             39220030
392300                                                                  39230030
392400         WHEN PE067-CAN (PE067-IDX)                               39240030
392500              MOVE PC-CAN      TO LQW-ACTION (PV-SUB)             39250030
392600                                                                  39260030
392700         WHEN PE067-UPD (PE067-IDX)                               39270030
392800              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             39280030
392900                                                                  39290030
393000         WHEN PE067-DEL (PE067-IDX)                               39300030
393100              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             39310030
393200                                                                  39320030
393300         WHEN PE067-ERR (PE067-IDX)                               39330030
393400              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             39340030
393500     END-EVALUATE.                                                39350030
393600                                                                  39360030
393700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                39370030
393800*                                                                 39380030
393900 EJECT                                                            39390030
394000*----------------------------------------------------------------*39400030
394100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *39410030
394200*----------------------------------------------------------------*39420030
394300                                                                  39430030
394400 6111-WRITE-LIST-QUEUE.                                           39440030
394500                                                                  39450030
394600     EXEC CICS                                                    39460030
394700         WRITEQ TS                                                39470030
394800             QUEUE (ASC-LIST-QUEUE-NAME)                          39480030
394900             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     39490030
395000             ITEM  (PV-SAVE-ITEM)                                 39500030
395100             REWRITE                                              39510030
395200             RESP  (PV-CICS-RESP)                                 39520030
395300     END-EXEC.                                                    39530030
395400*                                                                 39540030
395500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          39550030
395600         CONTINUE                                                 39560030
395700     ELSE                                                         39570030
395800         SET DP013-CICS-ABEND  TO  TRUE                           39580030
395900         SET DP013-NO-ROLLBACK TO  TRUE                           39590030
396000         MOVE '6111-WRITE-LIST-QUEUE'                             39600030
396100                               TO  DP013-PARAGRAPH                39610030
396200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  39620030
396300                               TO  DP013-MESSAGE-TEXT(1)          39630030
396400         PERFORM DP013-0000-PROCESS-ABEND                         39640030
396500     END-IF.                                                      39650030
396600*                                                                 39660030
396700 EJECT                                                            39670030
396800*----------------------------------------------------------------*39680030
396900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*39690030
397000*----------------------------------------------------------------*39700030
397100                                                                  39710030
397200 6112-READ-LIST-QUEUE.                                            39720030
397300                                                                  39730030
397400     EXEC CICS                                                    39740030
397500         READQ TS                                                 39750030
397600             QUEUE (ASC-LIST-QUEUE-NAME)                          39760030
397700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     39770030
397800             ITEM  (PV-ITEM)                                      39780030
397900             RESP  (PV-CICS-RESP)                                 39790030
398000     END-EXEC.                                                    39800030
398100*                                                                 39810030
398200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          39820030
398300         CONTINUE                                                 39830030
398400     ELSE                                                         39840030
398500         SET DP013-CICS-ABEND        TO TRUE                      39850030
398600         SET DP013-NO-ROLLBACK       TO TRUE                      39860030
398700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           39870030
398800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    39880030
398900                                     TO DP013-MESSAGE-TEXT(1)     39890030
399000         PERFORM DP013-0000-PROCESS-ABEND                         39900030
399100     END-IF.                                                      39910030
399200*                                                                 39920030
399300 EJECT                                                            39930030
399400*----------------------------------------------------------------*39940030
399500* GET THE NEXT STORE NUMBER BASED ON THE LAST STORE PROCESSED.   *39950030
399600* IF IT IS AT END OF TABLE, READ THE FIRST STORE NUMBER.         *39960030
399700*----------------------------------------------------------------*39970030
399800                                                                  39980030
399900 7000-GET-NEXT-STORE.                                             39990030
400000                                                                  40000030
400100     EXEC SQL                                                     40010030
400200         FETCH NEXT-STORE-CSR                                     40020030
400300         INTO :XST00001-LOC-NBR                                   40030030
400400            , :XST00020-EFF-BEG-DTE                               40040030
400500     END-EXEC.                                                    40050030
400600                                                                  40060030
400700     EVALUATE TRUE                                                40070030
400800         WHEN SQLCODE = ZERO                                      40080030
400900         WHEN SQLCODE = +100                                      40090030
401000             CONTINUE                                             40100030
401100         WHEN SQLWARN0 NOT = SPACES                               40110030
401200         WHEN SQLCODE < ZERO                                      40120030
401300         WHEN SQLCODE > ZERO                                      40130030
401400             MOVE '7000-GET-NEXT-STORE'                           40140030
401500                               TO DP013-PARAGRAPH                 40150030
401600             MOVE 'RETRIEVE NEXT STR ON XST_LOC/XST_DC_LOC_ASGMT' 40160030
401700                               TO DP013-MESSAGE-TEXT (1)          40170030
401800             MOVE SQLCA            TO DP013-SQLCA                 40180030
401900             SET DP013-DB2-ABEND                                  40190030
402000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               40200030
402100             PERFORM DP013-0000-PROCESS-ABEND                     40210030
402200     END-EVALUATE.                                                40220030
402300*                                                                 40230030
402400 EJECT                                                            40240030
402500*----------------------------------------------------------------*40250030
402600*   OPEN THE NEXT STORE CURSOR.                                  *40260030
402700*----------------------------------------------------------------*40270030
402800                                                                  40280030
402900 7010-OPEN-NEXT-STORE-CSR.                                        40290030
403000                                                                  40300030
403100     EXEC SQL                                                     40310030
403200          OPEN NEXT-STORE-CSR                                     40320030
403300     END-EXEC.                                                    40330030
403400                                                                  40340030
403500     EVALUATE TRUE                                                40350030
403600         WHEN SQLCODE = ZERO                                      40360030
403700             CONTINUE                                             40370030
403800         WHEN SQLWARN0 NOT = SPACES                               40380030
403900         WHEN SQLCODE < ZERO                                      40390030
404000         WHEN SQLCODE > ZERO                                      40400030
404100             MOVE '7010-OPEN-NEXT-STORE-CSR'                      40410030
404200                                   TO DP013-PARAGRAPH             40420030
404300             MOVE 'OPEN NEXT STORE CURSOR '                       40430030
404400                                   TO DP013-MESSAGE-TEXT (1)      40440030
404500             MOVE 'XST_LOC '       TO DP013-DB2-TABLE-NAME (1)    40450030
404600             MOVE 'XST_DC_LOC_ASGMT'                              40460030
404700                                   TO DP013-DB2-TABLE-NAME (2)    40470030
404800             MOVE SQLCA            TO DP013-SQLCA                 40480030
404900             SET DP013-DB2-ABEND                                  40490030
405000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               40500030
405100             PERFORM DP013-0000-PROCESS-ABEND                     40510030
405200     END-EVALUATE.                                                40520030
405300*                                                                 40530030
405400 EJECT                                                            40540030
405500*----------------------------------------------------------------*40550030
405600*   CLOSE THE NEXT STORE CURSOR.                                 *40560030
405700*----------------------------------------------------------------*40570030
405800                                                                  40580030
405900 7020-CLOSE-NEXT-STORE-CSR.                                       40590030
406000                                                                  40600030
406100     EXEC SQL                                                     40610030
406200          CLOSE NEXT-STORE-CSR                                    40620030
406300     END-EXEC.                                                    40630030
406400                                                                  40640030
406500     EVALUATE TRUE                                                40650030
406600         WHEN SQLCODE = ZERO                                      40660030
406700             CONTINUE                                             40670030
406800         WHEN SQLWARN0 NOT = SPACES                               40680030
406900         WHEN SQLCODE < ZERO                                      40690030
407000         WHEN SQLCODE > ZERO                                      40700030
407100             MOVE '7020-CLOSE-NEXT-STORE-CSR'                     40710030
407200                                   TO DP013-PARAGRAPH             40720030
407300             MOVE 'CLOSE NEXT STORE CURSOR '                      40730030
407400                                   TO DP013-MESSAGE-TEXT (1)      40740030
407500             MOVE 'XST_LOC '       TO DP013-DB2-TABLE-NAME (1)    40750030
407600             MOVE 'XST_DC_LOC_ASGMT'                              40760030
407700                                   TO DP013-DB2-TABLE-NAME (2)    40770030
407800             MOVE SQLCA            TO DP013-SQLCA                 40780030
407900             SET DP013-DB2-ABEND                                  40790030
408000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               40800030
408100             PERFORM DP013-0000-PROCESS-ABEND                     40810030
408200     END-EVALUATE.                                                40820030
408300*                                                                 40830030
408400 EJECT                                                            40840030
408500*----------------------------------------------------------------*40850030
408600*    DATE PROCESSOR MODULE                                       *40860030
408700*----------------------------------------------------------------*40870030
408800                                                                  40880030
408900     COPY DPPD017.                                                40890030
409000*                                                                 40900030
409100 EJECT                                                            40910030
409200*----------------------------------------------------------------*40920030
409300*    ABEND PROCESSOR MODULE                                      *40930030
409400*----------------------------------------------------------------*40940030
409500                                                                  40950030
409600     COPY DPPD013.                                                40960030
