000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XSKUP025.                                         00020000
000300 AUTHOR.        BARB ERTL.                                        00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  10/15/2002.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800**       LOCATION MESSAGE TO POPULATE XST_DIST AND XST_DIST_REGN  00080001
000900******************************************************************00090000
001000**THIS IS A CALLED MODULE FOR LOCATION TABLES.  THIS PROGRAM      00100000
001100**     WILL PERFORM UPDATES/INSERTS/DELETES FOR THE XST_DIST AND  00110001
001200**     XST_DIST_REGN TABLES.  IT DOES THE FOLLOWING WITH THESE    00120001
001300**     RETURN CODES:                                              00130000
001400**     0000 - END PROGRAM                                         00140000
001500**    -0530 - END PROGRAM                                         00150000
001600**    -0803 - END PROGRAM                                         00160000
001700**    -0911 - RETRY INSERT UP TO 5 TIMES AND THEN END PROGRAM     00170000
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000 CONFIGURATION SECTION.                                           00200000
002100 SOURCE-COMPUTER.  IBM-3090.                                      00210000
002200 OBJECT-COMPUTER.  IBM-3090.                                      00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600******************************************************************00260000
002700**PROGRAM SWITCHES                                                00270000
002800******************************************************************00280000
002900 01  PS-PROGRAM-SWITCHES.                                         00290000
003000     05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00300000
003100         88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00310000
003200         88  PS-PROCESS-COMPLETE                VALUE 'N'.        00320000
003300******************************************************************00330000
003400**PROGRAM CONSTANTS                                               00340000
003500******************************************************************00350000
003600 01  PC-PROGRAM-CONSTANTS.                                        00360000
003700     05  PC-PROGRAM-NAME             PIC X(08)  VALUE 'XSKUP025'. 00370010
003800     05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00380000
003900******************************************************************00390000
004000**PROGRAM VARIABLES                                               00400000
004100******************************************************************00410000
004200 01  PV-PROGRAM-VARIABLES.                                        00420000
004300     05  PV-RETRY-COUNTER               PIC  9(01)  VALUE ZEROS.  00430000
004400     05  PV-4-COMP-3                    PIC S9(04) COMP-3 VALUE 0.00440000
004500     05  PV-DIST-REGN-IND               PIC  X(01)  VALUE SPACES. 00450001
004600     05  PV-BEG-DTE                     PIC  X(10)  VALUE SPACES. 00460005
004700******************************************************************00470000
004800**COPYBOOKS                                                       00480000
004900******************************************************************00490000
005000***DB2 MESSAGE AREA                                               00500000
005100     COPY SQLCA2.                                                 00510016
005200***MESSAGE COPYBOOK                                               00520000
005300     COPY HORD100.                                                00530016
005400***KOHL'S CALENDAR ROUTINE COPYBOOK                               00540014
005500     COPY DPWS500.                                                00550016
005600******************************************************************00560000
005700**TABLE INCLUSIONS                                                00570000
005800******************************************************************00580000
005900***DB2 COMMUNICATIONS AREA                                        00590000
006000     EXEC SQL                                                     00600000
006100          INCLUDE SQLCA                                           00610000
006200     END-EXEC.                                                    00620000
006300* ------------------------------------------------------------- * 00630000
006400*  SQL AND COBOL DECLARATIONS FOR DISTRICT TABLE (XST_DIST)       00640001
006500* ------------------------------------------------------------- * 00650000
006600     EXEC SQL                                                     00660000
006700         INCLUDE XST00003                                         00670001
006800     END-EXEC.                                                    00680000
006900                                                                  00690000
007000* ------------------------------------------------------------- * 00700000
007100*  SQL AND COBOL DECLARATIONS FOR DISTRICT/REGION TABLE           00710001
007200*  (XST_DIST_REGN)                                                00720001
007300* ------------------------------------------------------------- * 00730000
007400     EXEC SQL                                                     00740000
007500         INCLUDE XST00004                                         00750001
007600     END-EXEC.                                                    00760000
007700                                                                  00770000
007800 LINKAGE SECTION.                                                 00780000
007900******************************************************************00790000
008000**LINKAGE VARIABLES                                               00800000
008100******************************************************************00810000
008200 01  LV-LINKAGE-VARIABLES.                                        00820003
008300     05  LV-HORD100-RECORD               PIC X(500).              00830003
008400     05  LV-RETURN-CODE                  PIC S9(04).              00840003
008500                                                                  00850000
008600 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   00860003
008700******************************************************************00870000
008800 0000-MAINLINE.                                                   00880000
008900                                                                  00890000
009000      PERFORM 1000-INITIALIZATION.                                00900000
009100      IF PS-PROCESS-CONTINUE                                      00910011
009200          PERFORM 2000-PROCESS-MESSAGE                            00920011
009300      END-IF.                                                     00930011
009400      PERFORM 9999-WRAPUP.                                        00940000
009500                                                                  00950000
009600***************************************************************** 00960000
009700**INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                00970000
009800***************************************************************** 00980000
009900 1000-INITIALIZATION.                                             00990000
010000                                                                  01000000
010100     INITIALIZE PV-RETRY-COUNTER.                                 01010000
010200     SET PS-PROCESS-CONTINUE TO TRUE.                             01020009
010300                                                                  01030000
010400     MOVE LV-HORD100-RECORD          TO HORD100-RECORD.           01040000
010500     MOVE HO100-DISTRICT           TO XST00003-DIST-NBR           01050001
010600                                      XST00004-DIST-NBR.          01060001
010700     MOVE HO100-DISTRICT-REGION    TO XST00004-REGN-NBR.          01070001
010800     MOVE HO100-DISTRICT-AREA-NAME TO XST00003-DIST-NM.           01080001
010900     MOVE HO100-DISTRICT-MGR-NAME  TO XST00003-DIST-MGR-NM.       01090001
011000                                                                  01100000
011100     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01110010
011200                                                                  01120010
011300     EXEC SQL                                                     01130010
011400         SET :DPG52-LK-DATE-INPUT = CURRENT DATE                  01140010
011500     END-EXEC.                                                    01150010
011600                                                                  01160010
011700     SET DPG51-FISCAL-454-CALENDAR                                01170010
011800         DPG52-LK-DTE-ISO-FMT TO TRUE.                            01180010
011900                                                                  01190010
012000     PERFORM 1500-CALL-CALENDAR-ROUTINE.                          01200010
012100                                                                  01210010
012200     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO XST00004-BEG-DTE.         01220010
012300                                                                  01230010
012400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01240010
012500                                                                  01250010
012600     MOVE XST00004-BEG-DTE TO DPG52-LK-DATE-INPUT.                01260010
012700                                                                  01270010
012800     SET DPG51-ACTUAL-CALENDAR-ONLY                               01280010
012900         DPG51-DECREMENT-DATE                                     01290010
013000         DPG52-LK-DTE-ISO-FMT TO TRUE.                            01300010
013100                                                                  01310010
013200     MOVE 1 TO DPG51-INCR-DECR-DAYS-9.                            01320010
013300                                                                  01330010
013400     PERFORM 1500-CALL-CALENDAR-ROUTINE.                          01340010
013500                                                                  01350010
013600     MOVE DPG55-DB2-ISO-DATE-FMT TO XST00004-END-DTE.             01360010
013700                                                                  01370010
013800***************************************************************** 01380010
013900**CALL CALENDAR ROUTINE FOR BEGINNING AND ENDING DATES.           01390010
014000***************************************************************** 01400010
014100 1500-CALL-CALENDAR-ROUTINE.                                      01410010
014200                                                                  01420010
014300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                01430010
014400                                             DPG52                01440010
014500                                             DPG53                01450010
014600                                             DPG54                01460010
014700                                             DPG55                01470010
014800                                             DPG56.               01480010
014900                                                                  01490010
015000     EVALUATE TRUE                                                01500010
015100         WHEN DPG54-SEVERE-ERROR                                  01510010
015200         WHEN DPG54-WARNING-ERROR                                 01520010
015300             DISPLAY ' '                                          01530010
015400             DISPLAY '** ABEND     **'                            01540010
015500             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        01550010
015600             DISPLAY '** PARAGRAPH **  = '                        01560010
015700                                    '1500-CALL-CALENDAR-ROUTINE'  01570010
015800             DISPLAY '** BAD CALL TO CALENDAR MODULE '            01580010
015900                     DP500-KOHLS-CALENDAR-ROUTINE                 01590010
016000             DISPLAY '** DETERMINE VALID DATE **'                 01600010
016100             DISPLAY 'DATE = ' DPG52-LK-DATE-INPUT                01610010
016200             DISPLAY DPG54-ERROR-MESSAGE                          01620010
016300             DISPLAY ' '                                          01630010
016400             SET PS-PROCESS-COMPLETE TO TRUE                      01640010
016500             MOVE +4019 TO LV-RETURN-CODE                         01650010
016600     END-EVALUATE.                                                01660010
016700                                                                  01670010
016800***************************************************************** 01680000
016900**MAIN PROGRAM LOGIC - READS ACTION TYPE ON HORD100 RECORD        01690000
017000***************************************************************** 01700000
017100 2000-PROCESS-MESSAGE.                                            01710000
017200                                                                  01720000
017300     EVALUATE TRUE                                                01730000
017400        WHEN HO100-ACTN-TYP-INSERT                                01740000
017500             PERFORM 2100-INSERT-DATA                             01750000
017600             IF PS-PROCESS-CONTINUE                               01760000
017700                 IF HO100-DISTRICT-REGION EQUAL SPACES            01770001
017800                     SET PS-PROCESS-COMPLETE TO TRUE              01780000
017900                 ELSE                                             01790000
018000                     PERFORM 3100-INSERT-DIST-REGN                01800001
018100                 END-IF                                           01810000
018200             END-IF                                               01820000
018300                                                                  01830000
018400        WHEN HO100-ACTN-TYP-UPDATE                                01840000
018500             PERFORM 2200-UPDATE-DATA                             01850000
018600             IF PS-PROCESS-CONTINUE                               01860000
018700                 IF HO100-DISTRICT-REGION EQUAL SPACES            01870001
018800                     SET PS-PROCESS-COMPLETE TO TRUE              01880000
018900                 ELSE                                             01890000
019000                     MOVE 0 TO PV-4-COMP-3                        01900000
019100                     MOVE SPACES TO PV-BEG-DTE                    01910005
019200                     PERFORM 3200-SELECT-DIST-REGN-ROW            01920001
019300                     IF PV-4-COMP-3 = XST00004-REGN-NBR           01930001
019400                         SET PS-PROCESS-COMPLETE TO TRUE          01940000
019500                     ELSE                                         01950000
019600                         IF PV-4-COMP-3 = 0                       01960000
019700                             PERFORM 3100-INSERT-DIST-REGN        01970001
019800                         ELSE                                     01980000
019900                             IF PV-BEG-DTE < XST00004-BEG-DTE     01990015
020000                                 PERFORM 3300-UPDATE-DIST-REGN-ROW02000005
020100                             ELSE                                 02010005
020200                                 PERFORM 3400-DELETE-DIST-REGN-ROW02020007
020300                             END-IF                               02030005
020400                             IF PS-PROCESS-CONTINUE               02040000
020500                                 PERFORM 3100-INSERT-DIST-REGN    02050001
020600                             END-IF                               02060000
020700                         END-IF                                   02070000
020800                     END-IF                                       02080000
020900                 END-IF                                           02090000
021000             END-IF                                               02100000
021100                                                                  02110000
021200        WHEN HO100-ACTN-TYP-DELETE                                02120000
021300             PERFORM 2400-SELECT-DIST-REGN                        02130001
021400             IF PS-PROCESS-CONTINUE                               02140000
021500                 PERFORM 2300-DELETE-DATA                         02150000
021600             END-IF                                               02160000
021700     END-EVALUATE.                                                02170000
021800                                                                  02180000
021900***************************************************************** 02190000
022000**INSERT ACTION TYPE                                              02200000
022100***************************************************************** 02210000
022200 2100-INSERT-DATA.                                                02220000
022300                                                                  02230000
022400     PERFORM                                                      02240000
022500         WITH TEST AFTER                                          02250000
022600         VARYING PV-RETRY-COUNTER                                 02260000
022700         FROM 1 BY 1                                              02270000
022800         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    02280000
022900            OR SQLCODE = 0                                        02290000
023000            OR PS-PROCESS-COMPLETE                                02300000
023100                                                                  02310000
023200           EXEC SQL                                               02320001
023300               INSERT INTO XST_DIST                               02330001
023400                       ( DIST_NBR                                 02340001
023500                       , DIST_NM                                  02350001
023600                       , DIST_MGR_NM)                             02360001
023700               VALUES                                             02370001
023800                     ( : XST00003-DIST-NBR                        02380001
023900                     , : XST00003-DIST-NM                         02390001
024000                     , : XST00003-DIST-MGR-NM)                    02400001
024100           END-EXEC                                               02410001
024200                                                                  02420000
024300         EVALUATE TRUE                                            02430000
024400             WHEN SQLCODE = -911                                  02440000
024500             WHEN SQLCODE = -913                                  02450000
024600             WHEN SQLCODE = 0                                     02460000
024700                 CONTINUE                                         02470000
024800             WHEN SQLWARN0 NOT = SPACE                            02480000
024900             WHEN SQLCODE NOT =  ZERO                             02490000
025000                 SET PS-PROCESS-COMPLETE TO TRUE                  02500000
025100         END-EVALUATE                                             02510000
025200     END-PERFORM.                                                 02520000
025300                                                                  02530000
025400     EVALUATE TRUE                                                02540000
025500        WHEN SQLCODE = 0                                          02550000
025600            CONTINUE                                              02560000
025700        WHEN OTHER                                                02570000
025800             SET PS-PROCESS-COMPLETE     TO TRUE                  02580000
025900     END-EVALUATE.                                                02590000
026000                                                                  02600000
026100******************************************************************02610000
026200**UPDATE ACTION TYPE                                              02620000
026300******************************************************************02630000
026400 2200-UPDATE-DATA.                                                02640000
026500                                                                  02650000
026600     PERFORM                                                      02660000
026700         WITH TEST AFTER                                          02670000
026800         VARYING PV-RETRY-COUNTER                                 02680000
026900         FROM 1 BY 1                                              02690000
027000         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    02700000
027100            OR SQLCODE = 0                                        02710000
027200            OR PS-PROCESS-COMPLETE                                02720000
027300                                                                  02730000
027400           EXEC SQL                                               02740001
027500               UPDATE XST_DIST                                    02750001
027600               SET DIST_NM     = : XST00003-DIST-NM               02760001
027700                 , DIST_MGR_NM = : XST00003-DIST-MGR-NM           02770001
027800               WHERE  DIST_NBR = :XST00003-DIST-NBR               02780001
027900           END-EXEC                                               02790001
028000                                                                  02800000
028100         EVALUATE TRUE                                            02810000
028200             WHEN SQLCODE = -911                                  02820000
028300             WHEN SQLCODE = -913                                  02830000
028400             WHEN SQLCODE = 0                                     02840000
028500                 CONTINUE                                         02850000
028600             WHEN SQLWARN0 NOT = SPACE                            02860000
028700             WHEN SQLCODE NOT =  ZERO                             02870000
028800                 SET PS-PROCESS-COMPLETE TO TRUE                  02880000
028900         END-EVALUATE                                             02890000
029000     END-PERFORM.                                                 02900000
029100                                                                  02910000
029200     EVALUATE TRUE                                                02920000
029300        WHEN SQLCODE = 0                                          02930000
029400            CONTINUE                                              02940000
029500        WHEN OTHER                                                02950000
029600             SET PS-PROCESS-COMPLETE     TO TRUE                  02960000
029700     END-EVALUATE.                                                02970000
029800                                                                  02980000
029900******************************************************************02990000
030000**DELETE TYPE ACTION                                              03000000
030100******************************************************************03010000
030200 2300-DELETE-DATA.                                                03020000
030300                                                                  03030000
030400     PERFORM                                                      03040000
030500         WITH TEST AFTER                                          03050000
030600         VARYING PV-RETRY-COUNTER                                 03060000
030700         FROM 1 BY 1                                              03070000
030800         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    03080000
030900            OR SQLCODE = 0                                        03090000
031000            OR PS-PROCESS-COMPLETE                                03100000
031100                                                                  03110000
031200           EXEC SQL                                               03120000
031300               DELETE FROM XST_DIST                               03130001
031400             WHERE  (DIST_NBR = :XST00003-DIST-NBR)               03140001
031500           END-EXEC                                               03150001
031600                                                                  03160000
031700         EVALUATE TRUE                                            03170000
031800             WHEN SQLCODE = -911                                  03180000
031900             WHEN SQLCODE = -913                                  03190000
032000             WHEN SQLCODE = 0                                     03200000
032100                 CONTINUE                                         03210000
032200             WHEN SQLWARN0 NOT = SPACE                            03220000
032300             WHEN SQLCODE NOT =  ZERO                             03230000
032400                 SET PS-PROCESS-COMPLETE TO TRUE                  03240000
032500         END-EVALUATE                                             03250000
032600     END-PERFORM.                                                 03260000
032700                                                                  03270000
032800     SET PS-PROCESS-COMPLETE     TO TRUE.                         03280000
032900                                                                  03290000
033000******************************************************************03300000
033100**SELECT DIST_REGN ROW FOR DELETED DISTRICT                       03310001
033200******************************************************************03320000
033300 2400-SELECT-DIST-REGN.                                           03330001
033400                                                                  03340000
033500     EXEC SQL                                                     03350000
033600         SELECT 'Y'                                               03360000
033700           INTO :PV-DIST-REGN-IND                                 03370001
033800           FROM XST_DIST_REGN                                     03380001
033900          WHERE  DIST_NBR = :XST00004-DIST-NBR                    03390001
034000     END-EXEC                                                     03400000
034100                                                                  03410000
034200     EVALUATE TRUE                                                03420000
034300        WHEN SQLCODE = 0                                          03430000
034400        WHEN SQLCODE = -811                                       03440000
034500            SET PS-PROCESS-COMPLETE     TO TRUE                   03450000
034600        WHEN OTHER                                                03460000
034700            CONTINUE                                              03470000
034800     END-EVALUATE.                                                03480000
034900                                                                  03490000
035000******************************************************************03500000
035100**INSERT DIST_REGN ROW                                            03510001
035200******************************************************************03520000
035300 3100-INSERT-DIST-REGN.                                           03530001
035400                                                                  03540000
035500     PERFORM                                                      03550000
035600         WITH TEST AFTER                                          03560000
035700         VARYING PV-RETRY-COUNTER                                 03570000
035800         FROM 1 BY 1                                              03580000
035900         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    03590000
036000            OR SQLCODE = 0                                        03600000
036100            OR PS-PROCESS-COMPLETE                                03610000
036200                                                                  03620000
036300           EXEC SQL                                               03630001
036400               INSERT INTO XST_DIST_REGN                          03640001
036500                        (DIST_NBR                                 03650001
036600                       , REGN_NBR                                 03660001
036700                       , BEG_DTE)                                 03670001
036800               VALUES (: XST00004-DIST-NBR                        03680001
036900                     , : XST00004-REGN-NBR                        03690001
037000                     , : XST00004-BEG-DTE)                        03700005
037100           END-EXEC                                               03710001
037200                                                                  03720000
037300         EVALUATE TRUE                                            03730000
037400             WHEN SQLCODE = -911                                  03740000
037500             WHEN SQLCODE = -913                                  03750000
037600             WHEN SQLCODE = 0                                     03760000
037700                 CONTINUE                                         03770000
037800             WHEN SQLWARN0 NOT = SPACE                            03780000
037900             WHEN SQLCODE NOT =  ZERO                             03790000
038000                 SET PS-PROCESS-COMPLETE TO TRUE                  03800000
038100         END-EVALUATE                                             03810000
038200     END-PERFORM.                                                 03820000
038300                                                                  03830000
038400     SET PS-PROCESS-COMPLETE TO TRUE.                             03840000
038500                                                                  03850000
038600******************************************************************03860000
038700**SELECT CURRENT DIST_REGN ROW                                    03870001
038800******************************************************************03880000
038900 3200-SELECT-DIST-REGN-ROW.                                       03890001
039000                                                                  03900000
039100     PERFORM                                                      03910000
039200         WITH TEST AFTER                                          03920000
039300         VARYING PV-RETRY-COUNTER                                 03930000
039400         FROM 1 BY 1                                              03940000
039500         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    03950000
039600            OR SQLCODE = 0                                        03960000
039700            OR SQLCODE = +100                                     03970000
039800            OR PS-PROCESS-COMPLETE                                03980000
039900                                                                  03990000
040000         EXEC SQL                                                 04000001
040100           SELECT REGN_NBR                                        04010001
040200                 ,BEG_DTE                                         04020005
040300             INTO :PV-4-COMP-3                                    04030001
040400                 ,:PV-BEG-DTE                                     04040005
040500             FROM XST_DIST_REGN                                   04050001
040600            WHERE  DIST_NBR = :XST00004-DIST-NBR                  04060001
040700              AND  END_DTE IS NULL                                04070005
040800         END-EXEC                                                 04080001
040900                                                                  04090000
041000         EVALUATE TRUE                                            04100000
041100             WHEN SQLCODE = -911                                  04110000
041200             WHEN SQLCODE = -913                                  04120000
041300             WHEN SQLCODE = 0                                     04130000
041400             WHEN SQLCODE = +100                                  04140000
041500                 CONTINUE                                         04150000
041600             WHEN SQLWARN0 NOT = SPACE                            04160000
041700             WHEN SQLCODE NOT =  ZERO                             04170000
041800                 SET PS-PROCESS-COMPLETE TO TRUE                  04180000
041900         END-EVALUATE                                             04190000
042000     END-PERFORM.                                                 04200000
042100                                                                  04210000
042200     EVALUATE TRUE                                                04220000
042300        WHEN SQLCODE = 0                                          04230000
042400        WHEN SQLCODE = +100                                       04240000
042500            CONTINUE                                              04250000
042600        WHEN OTHER                                                04260000
042700             SET PS-PROCESS-COMPLETE     TO TRUE                  04270000
042800     END-EVALUATE.                                                04280000
042900                                                                  04290000
043000******************************************************************04300000
043100**UPDATE DIST_REGN                                                04310001
043200******************************************************************04320000
043300 3300-UPDATE-DIST-REGN-ROW.                                       04330001
043400                                                                  04340000
043500     PERFORM                                                      04350000
043600         WITH TEST AFTER                                          04360000
043700         VARYING PV-RETRY-COUNTER                                 04370000
043800         FROM 1 BY 1                                              04380000
043900         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    04390000
044000            OR SQLCODE = 0                                        04400000
044100            OR SQLCODE = +100                                     04410000
044200            OR PS-PROCESS-COMPLETE                                04420000
044300                                                                  04430000
044400         EXEC SQL                                                 04440001
044500           UPDATE XST_DIST_REGN                                   04450001
044600              SET END_DTE = :XST00004-END-DTE                     04460010
044700            WHERE  DIST_NBR = :XST00004-DIST-NBR                  04470001
044800              AND  REGN_NBR = :PV-4-COMP-3                        04480005
044900              AND  BEG_DTE  = :PV-BEG-DTE                         04490005
045000              AND END_DTE IS NULL                                 04500001
045100         END-EXEC                                                 04510001
045200                                                                  04520000
045300         EVALUATE TRUE                                            04530000
045400             WHEN SQLCODE = -911                                  04540000
045500             WHEN SQLCODE = -913                                  04550000
045600             WHEN SQLCODE = 0                                     04560000
045700             WHEN SQLCODE = +100                                  04570000
045800                  CONTINUE                                        04580000
045900             WHEN SQLWARN0 NOT = SPACE                            04590000
046000             WHEN SQLCODE NOT = ZERO                              04600000
046100                 SET PS-PROCESS-COMPLETE TO TRUE                  04610000
046200         END-EVALUATE                                             04620000
046300     END-PERFORM.                                                 04630000
046400                                                                  04640000
046500                                                                  04650000
046600     EVALUATE TRUE                                                04660000
046700        WHEN SQLCODE = 0                                          04670000
046800        WHEN SQLCODE = +100                                       04680000
046900            CONTINUE                                              04690000
047000        WHEN OTHER                                                04700000
047100             SET PS-PROCESS-COMPLETE     TO TRUE                  04710000
047200     END-EVALUATE.                                                04720000
047300                                                                  04730000
047400******************************************************************04740005
047500**DELETE DIST_REGN                                                04750005
047600******************************************************************04760005
047700 3400-DELETE-DIST-REGN-ROW.                                       04770005
047800                                                                  04780005
047900     PERFORM                                                      04790005
048000         WITH TEST AFTER                                          04800005
048100         VARYING PV-RETRY-COUNTER                                 04810005
048200         FROM 1 BY 1                                              04820005
048300         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    04830005
048400            OR SQLCODE = 0                                        04840005
048500            OR SQLCODE = +100                                     04850005
048600            OR PS-PROCESS-COMPLETE                                04860005
048700                                                                  04870005
048800         EXEC SQL                                                 04880005
048900           DELETE FROM XST_DIST_REGN                              04890005
049000            WHERE  DIST_NBR = :XST00004-DIST-NBR                  04900005
049100              AND  REGN_NBR = :PV-4-COMP-3                        04910005
049200              AND  BEG_DTE  = :PV-BEG-DTE                         04920005
049300              AND END_DTE IS NULL                                 04930005
049400         END-EXEC                                                 04940005
049500                                                                  04950005
049600         EVALUATE TRUE                                            04960005
049700             WHEN SQLCODE = -911                                  04970005
049800             WHEN SQLCODE = -913                                  04980005
049900             WHEN SQLCODE = 0                                     04990005
050000             WHEN SQLCODE = +100                                  05000005
050100                  CONTINUE                                        05010005
050200             WHEN SQLWARN0 NOT = SPACE                            05020005
050300             WHEN SQLCODE NOT = ZERO                              05030005
050400                 SET PS-PROCESS-COMPLETE TO TRUE                  05040005
050500         END-EVALUATE                                             05050005
050600     END-PERFORM.                                                 05060005
050700                                                                  05070005
050800                                                                  05080005
050900     EVALUATE TRUE                                                05090005
051000        WHEN SQLCODE = 0                                          05100005
051100        WHEN SQLCODE = +100                                       05110005
051200            CONTINUE                                              05120005
051300        WHEN OTHER                                                05130005
051400             SET PS-PROCESS-COMPLETE     TO TRUE                  05140005
051500     END-EVALUATE.                                                05150005
051600******************************************************************05160000
051700**PASS SQLCODE TO CALLING AND EXIT PROGRAM                        05170000
051800******************************************************************05180000
051900 9999-WRAPUP.                                                     05190000
052000                                                                  05200000
052100     IF LV-RETURN-CODE = 0                                        05210010
052200         MOVE SQLCODE       TO LV-RETURN-CODE                     05220010
052300     END-IF.                                                      05230010
052400                                                                  05240000
052500     EXIT PROGRAM.                                                05250000
