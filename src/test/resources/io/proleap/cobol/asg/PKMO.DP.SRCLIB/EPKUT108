000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      EPKUT108.                                       00020000
000300 AUTHOR.          NANCY MARTIN.                                   00030000
000400 DATE-WRITTEN.    APRIL 07, 2003.                                 00040000
000500                                                                  00050000
000600*-----------------------------------------------------------      00060000
000700* EPKUT108 ---  EXTRACT PLU CHANGES - RCP OVERRIDES               00070004
000800*-----------------------------------------------------------      00080000
000900*  THIS PROGRAM WORKS WITH CHANGED ITEMS IDENTIFIED AS            00090009
001000*  BEING RCP RELATED. WHEN THERE HAS BEEN EITHER A GLOBAL         00100000
001100*  CHANGE OR AN ITEM WAS EITHER ACTIVATED OR REACTIVATED,         00110000
001200*  THEN ALL ASSOCIATED STORE RECORDS SHOULD BE REVIEWED AND       00120000
001300*  STORE RECORDS SENT AS APPROPRIATE.                             00130000
001400*                                                                 00140000
001500*  THIS PROGRAM USES FOUR CONTROL CARDS.                          00150000
001600*  EPCC045 - NUMBER OF DAYS IN ADVANCE OF STORE OPEN THAT         00160000
001700*            NEW STORES WILL BE CONSIDERED VALID                  00170000
001800*  EPCC105 - LAST BATCH CYCLE TIMESTAMP                           00180000
001900*  EPCC112 - BATCH PROCESSING DATE (TYPICALLY NEXT DAY)           00190000
002000*  EPCC140 - TODAYS DATE (BASED UPON RUN CYCLE DATE)              00200000
002100*                                                                 00210000
002200*  THIS PROGRAM READS A FILE CONTAINING ITEMS EITHER WITH         00220000
002300*  A) GLOBAL "PROMPT FOR PRICE" CHANGE AND/OR OTHER PRICING       00230000
002400*     RELATED INFORMATION HAS CHANGED                             00240000
002500*  B) THE ITEM HAS EITHER BEEN ADDED OR REACTIVATED.              00250000
002600*                                                                 00260000
002700*  THIS PROGRAM WILL USE TWO CURSORS TO FETCH ALL STORES          00270000
002800*  ASSOCIATED WITH THE ITEMS (ONE CURSOR FOR XST_SKU_LOC          00280000
002900*  CHANGES, THE OTHER FOR XST_SKU_LOC_ATTR CHANGES). THE          00290000
003000*  PROGRAM WRITES OUT STORE CHANGES (FOR VALID STORES).           00300000
003100*                                                                 00310000
003200*  IT ALSO CREATES A GLOBAL SKU PRICING RECORD FOR SQL SERVER.    00320004
003300*-----------------------------------------------------------      00330000
003400*    THE FILES AND THEIR ASSOCIATED COPYBOOK/PURPOSE.             00340000
003500*    INP00- RCP-DRIVER-FILE                 EPRD122               00350000
003600*    INP01- CC NUMBER OF DAYS PRE OPENING   EPRD045               00360000
003700*    INP02- CC EFFECTIVE DATE (NEXT DAY)    EPWS105               00370000
003800*    INP03- CC PREVIOUS TIMESTAMP           EPWS112               00380000
003900*    INP04- CC TODAYS RUN CYCLE DATE        EPRD140               00390000
004000*    OUT01- CHG-SKU-PRICG-STORE-FILE        EPRD220               00400011
004100*-----------------------------------------------------------      00410000
004200* HISTORY LOG:                                                    00420000
004300*-----------------------------------------------------------      00430000
004400* DATE:        04/07/03                                           00440000
004500* WR/IR#:      21428                                              00450000
004600* PROGRAMMER:  NANCY MARTIN                                       00460000
004700* DESCRIPTION: STORE PLU CHANGES FOR RCP ITEM CHANGES             00470000
004800*              INITIAL PROGRAM FOR NEW PROMO PROJECT.             00480000
004900*              PROGRAM USED EPKUT107 AS CLONE BASIS.              00490000
005000*                                                                 00500001
005100* DATE: 01/27/2006                                                00510001
005200* WR/IR#: PM00844146                                              00520001
005300* PROGRAMMER: SCOTT BARTELT                                       00530001
005400* DESCRIPTION: THE CHECK FOR PUTTING THE EVENT CODE IN THE        00540001
005500*              "PATH 1" FIELD WAS CHECKING THE WRONG FIELD IN     00550001
005600*              THE "IF" STATEMENT SO IT WAS COMPARING A ' '       00560001
005700*              TO STATUS CODE OF '30'.                            00570001
005800*                                                                 00580000
005900*----------------------------------------------------------       00590000
006000 ENVIRONMENT DIVISION.                                            00600000
006100*----------------------------------------------------------       00610000
006200 CONFIGURATION SECTION.                                           00620000
006300 SOURCE-COMPUTER.        IBM-3090.                                00630000
006400 OBJECT-COMPUTER.        IBM-3090.                                00640000
006500                                                                  00650000
006600 INPUT-OUTPUT SECTION.                                            00660000
006700                                                                  00670000
006800 FILE-CONTROL.                                                    00680000
006900                                                                  00690000
007000     SELECT RCP-DRIVER-FILE                                       00700000
007100            ASSIGN TO INP00.                                      00710000
007200     SELECT CC-DAYS                                               00720000
007300            ASSIGN TO INP01.                                      00730000
007400     SELECT CC-TIMESTAMP                                          00740000
007500            ASSIGN TO INP02.                                      00750000
007600     SELECT CC-TOMORROW                                           00760000
007700            ASSIGN TO INP03.                                      00770000
007800     SELECT CC-TODAY                                              00780000
007900            ASSIGN TO INP04.                                      00790000
008000     SELECT CHG-SKU-PRICG-STORE-FILE                              00800003
008100            ASSIGN TO OUT01.                                      00810009
008200                                                                  00820000
008300 DATA DIVISION.                                                   00830000
008400 FILE SECTION.                                                    00840000
008500                                                                  00850000
008600 FD  CC-DAYS                                                      00860000
008700     RECORDING MODE F                                             00870000
008800     BLOCK CONTAINS 0 RECORDS                                     00880000
008900     LABEL RECORDS ARE OMITTED                                    00890000
009000     DATA RECORD IS CC-DAYS-RECORD.                               00900000
009100 01  CC-DAYS-RECORD                  PIC X(80).                   00910000
009200                                                                  00920000
009300 FD  CC-TIMESTAMP                                                 00930000
009400     RECORDING MODE F                                             00940000
009500     BLOCK CONTAINS 0 RECORDS                                     00950000
009600     LABEL RECORDS ARE OMITTED                                    00960000
009700     DATA RECORD IS CC-TIMESTAMP-RECORD.                          00970000
009800 01  CC-TIMESTAMP-RECORD             PIC X(80).                   00980000
009900                                                                  00990000
010000 FD  CC-TOMORROW                                                  01000000
010100     RECORDING MODE F                                             01010000
010200     BLOCK CONTAINS 0 RECORDS                                     01020000
010300     LABEL RECORDS ARE OMITTED                                    01030000
010400     DATA RECORD IS CC-TOMORROW-RECORD.                           01040000
010500 01  CC-TOMORROW-RECORD              PIC X(80).                   01050000
010600                                                                  01060000
010700 FD  CC-TODAY                                                     01070000
010800     RECORDING MODE F                                             01080000
010900     BLOCK CONTAINS 0 RECORDS                                     01090000
011000     LABEL RECORDS ARE OMITTED                                    01100000
011100     DATA RECORD IS CC-TODAY-RECORD.                              01110000
011200 01  CC-TODAY-RECORD                 PIC X(80).                   01120000
011300                                                                  01130000
011400 FD  RCP-DRIVER-FILE                                              01140000
011500     RECORDING MODE F                                             01150000
011600     BLOCK CONTAINS 0 RECORDS                                     01160000
011700     LABEL RECORDS ARE OMITTED                                    01170000
011800     DATA RECORD IS RCP-DRIVER-RECORD.                            01180000
011900 01  RCP-DRIVER-RECORD               PIC X(50).                   01190000
012000                                                                  01200000
012100 FD  CHG-SKU-PRICG-STORE-FILE                                     01210003
012200     RECORDING MODE F                                             01220003
012300     BLOCK CONTAINS 0 RECORDS                                     01230003
012400     LABEL RECORDS ARE OMITTED                                    01240003
012500     DATA RECORD IS CHG-SKU-PRICG-STORE-RCD.                      01250003
012600 01  CHG-SKU-PRICG-STORE-RECORD      PIC X(260).                  01260006
012700                                                                  01270003
012800 WORKING-STORAGE SECTION.                                         01280000
012900*-----------------------------------------------------------      01290000
013000* PS- PROGRAM SWITCHES                                            01300000
013100*-----------------------------------------------------------      01310000
013200 01  PS-PROGRAM-SWITCHES.                                         01320000
013300     05  PS-END-OF-INPUT-FILE-SW        PIC X(01) VALUE 'Y'.      01330000
013400         88  PS-END-OF-INPUT-FILE                 VALUE 'N'.      01340000
013500         88  PS-NOT-END-OF-INPUT-FILE             VALUE 'Y'.      01350000
013600     05  PS-END-OF-RCP-FILE-SW          PIC X(01) VALUE 'N'.      01360000
013700         88  PS-END-OF-RCP-FILE                   VALUE 'Y'.      01370000
013800         88  PS-NOT-END-OF-RCP-FILE               VALUE 'N'.      01380000
013900     05  PS-END-OF-LOC-CSR-SW           PIC X(01) VALUE 'N'.      01390000
014000         88  PS-END-OF-LOC-CSR                    VALUE 'Y'.      01400000
014100         88  PS-NOT-END-OF-LOC-CSR                VALUE 'N'.      01410000
014200     05  PS-END-OF-ATTR-CSR-SW          PIC X(01) VALUE 'N'.      01420000
014300         88  PS-END-OF-ATTR-CSR                   VALUE 'Y'.      01430000
014400         88  PS-NOT-END-OF-ATTR-CSR               VALUE 'N'.      01440000
014500                                                                  01450000
014600*-----------------------------------------------------------      01460000
014700* PC- PROGRAM CONSTANTS                                           01470000
014800*-----------------------------------------------------------      01480000
014900 01  PC-PROGRAM-CONSTANTS.                                        01490000
015000     05  PC-CURRENT-PROGRAM-NAME   PIC X(08) VALUE 'EPKUT108'.    01500000
015100     05  PC-MAX-RETRIES            PIC S9(04) VALUE +5 COMP.      01510000
015200                                                                  01520003
015300     05  PC-STR-GRP-TYP-CDE-STORE  PIC 9(05)  VALUE 5000.         01530008
015400     05  PC-SQLS-START-TIME        PIC X(08)  VALUE '03:00:00'.   01540003
015500     05  PC-PRIC-EFF-TIME-STD      PIC X(08)  VALUE '03:00:00'.   01550003
015600     05  PC-MDSE-HIER-SKU          PIC X(03)  VALUE 'SKU'.        01560003
015700     05  PC-NULL-CHAR              PIC X(01)  VALUE '~'.          01570003
015800                                                                  01580003
015900*-----------------------------------------------------------      01590000
016000* PV- PROGRAM VARIABLES                                           01600000
016100*-----------------------------------------------------------      01610000
016200 01  PV-PROGRAM-VARAIBLES.                                        01620000
016300     05  PV-SQL-SUB                PIC S9(4) VALUE +0 COMP.       01630000
016400     05  PV-INTR-UPC-ID            PIC S9(11) VALUE +0 COMP.      01640000
016500     05  PV-START-DTE              PIC X(10) VALUE SPACES.        01650000
016600     05  PV-NEW-DATE               PIC X(10) VALUE SPACES.        01660000
016700     05  PV-GP-PRIC-ID             PIC 9(11) VALUE 0.             01670000
016800     05  PV-GP-PRIC-ID-IND         PIC S9(4) VALUE +0 COMP.       01680000
016900         88  PV-GP-PRIC-ID-NULL              VALUE -1.            01690000
017000     05  PV-GP-RTL-QTY-IND         PIC S9(4) VALUE +0 COMP.       01700000
017100         88  PV-GP-RTL-QTY-NULL              VALUE -1.            01710000
017200     05  PV-GP-RTL-AMT-IND         PIC S9(4) VALUE +0 COMP.       01720000
017300         88  PV-GP-RTL-AMT-NULL              VALUE -1.            01730000
017400     05  PV-PROMO-PRICE            PIC S9(07)V9(02) VALUE +0.     01740000
017500                                                                  01750000
017600     05  PV-DB2-FIELDS.                                           01760000
017700         10  PV-DB2-INTR-UPC-ID    PIC S9(9) VALUE +0 COMP.       01770000
017800         10  PV-DB2-UNT-RTL-AMT    PIC S9(7)V9(2) VALUE +0 COMP-3.01780000
017900         10  PV-DB2-SKU-STAT-CDE   PIC X(02) VALUE SPACES.        01790000
018000         10  PV-DB2-GP-PRIC-ID     PIC S9(9) VALUE +0 COMP.       01800000
018100         10  PV-DB2-UNT-RTL-DTE    PIC X(10) VALUE SPACES.        01810000
018200         10  PV-DB2-GP-RTL-QTY     PIC S9(4) VALUE +0 COMP.       01820000
018300         10  PV-DB2-GP-RTL-AMT     PIC S9(7)V9(2) VALUE +0 COMP-3.01830000
018400                                                                  01840000
018500     05  PV-CPU-TIME.                                             01850004
018600         10  PV-CPU-HR             PIC 9(2)       VALUE ZEROS.    01860004
018700         10  PV-CPU-MIN            PIC 9(2)       VALUE ZEROS.    01870004
018800         10  PV-CPU-SEC            PIC 9(2)       VALUE ZEROS.    01880004
018900         10  PV-CPU-HSEC           PIC 9(2)       VALUE ZEROS.    01890004
019000                                                                  01900000
019100     05  PV-PRIC-EFF-TMST.                                        01910004
019200         10  PV-PRIC-EFF-DTE       PIC X(10).                     01920004
019300         10  FILLER                PIC X(01) VALUE SPACE.         01930004
019400         10  PV-PRIC-EFF-TIME      PIC X(08).                     01940004
019500                                                                  01950004
019600     05  PV-LAST-PRCHG-TMST.                                      01960004
019700         10  PV-LAST-PRCHG-DTE     PIC X(10).                     01970004
019800         10  FILLER                PIC X(01) VALUE SPACE.         01980004
019900         10  PV-LAST-PRCHG-TIME    PIC X(08).                     01990004
020000                                                                  02000004
020100*----------------------------------------------------------       02010003
020200* SKU PRICING STORE FILE LAYOUT - OUTPUT                          02020003
020300*----------------------------------------------------------       02030003
020400     COPY EPRD220.                                                02040003
020500                                                                  02050003
020600*----------------------------------------------------------       02060000
020700*    RCP DRIVER FILE LAYOUT - OUTPUT                              02070000
020800*----------------------------------------------------------       02080000
020900     COPY EPRD122.                                                02090000
021000                                                                  02100000
021100*----------------------------------------------------------       02110000
021200* CONTROL CARD LAYOUT FOR ADVANCE DAY PRE OPENING                 02120000
021300*----------------------------------------------------------       02130000
021400     COPY EPRD045.                                                02140000
021500                                                                  02150000
021600*----------------------------------------------------------       02160000
021700* CONTROL CARD LAYOUT FOR TIMESTAMP                               02170000
021800*----------------------------------------------------------       02180000
021900     COPY EPWS105.                                                02190000
022000                                                                  02200000
022100*----------------------------------------------------------       02210000
022200* CONTROL CARD LAYOUT FOR TOMORROW'S DATE                         02220000
022300*----------------------------------------------------------       02230000
022400     COPY EPWS112.                                                02240000
022500                                                                  02250000
022600*----------------------------------------------------------       02260000
022700* CONTROL CARD LAYOUT FOR TODAY'S RUN DATE                        02270000
022800*----------------------------------------------------------       02280000
022900     COPY EPWS140.                                                02290000
023000                                                                  02300000
023100                                                                  02310000
023200*-----------------------------------------------------------      02320000
023300* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02330000
023400*-----------------------------------------------------------      02340000
023500     COPY DPWS004.                                                02350000
023600                                                                  02360000
023700*-----------------------------------------------------------      02370000
023800* PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)              02380000
023900*-----------------------------------------------------------      02390000
024000     COPY DPWS500.                                                02400000
024100                                                                  02410000
024200*-----------------------------------------------------------      02420000
024300* DB2 ABEND COPYBOOK                                              02430000
024400*-----------------------------------------------------------      02440000
024500     COPY DPWS900.                                                02450000
024600                                                                  02460000
024700*-----------------------------------------------------------      02470000
024800* DB2 MESSAGE AREA                                                02480000
024900*-----------------------------------------------------------      02490000
025000     COPY SQLCA2.                                                 02500000
025100                                                                  02510000
025200*-----------------------------------------------------------      02520000
025300* PC- PROGRAM COUNTERS                                            02530000
025400*-----------------------------------------------------------      02540000
025500 01  PC-PROGRAM-COUNTERS.                                         02550000
025600     05  PC-CNT-CHG-LOCS                PIC 9(09) VALUE 0.        02560004
025700     05  PC-CNT-CHG-ATTR                PIC 9(09) VALUE 0.        02570004
025800     05  PC-CNT-LOC-CSR                 PIC 9(09) VALUE 0.        02580004
025900     05  PC-CNT-ATTR-CSR                PIC 9(09) VALUE 0.        02590004
026000     05  PC-CNT-RCP-RECS                PIC 9(09) VALUE 0.        02600004
026100     05  PC-CNT-PLU-ATTR-RECS           PIC 9(09) VALUE 0.        02610004
026200     05  PC-CNT-PLU-LOC-RECS            PIC 9(09) VALUE 0.        02620004
026300     05  PC-CNT-ALL-RECS                PIC 9(09) VALUE 0.        02630004
026400     05  PC-CNT-SKU-PRICG-STR-LOC-RECS  PIC 9(09) VALUE 0.        02640004
026500     05  PC-CNT-SKU-PRICG-STR-ATTR-RECS PIC 9(09) VALUE 0.        02650004
026600     05  PC-CNT-SKU-PRICG-STR-RECS      PIC 9(09) VALUE 0.        02660004
026700                                                                  02670000
026800*-----------------------------------------------------------      02680000
026900* ERROR HANDLING                                                  02690000
027000*-----------------------------------------------------------      02700000
027100 01  PV-MISC-ABEND-FIELDS.                                        02710000
027200     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACE.      02720000
027300     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACE.      02730000
027400     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACE.      02740000
027500     05  PV-DB2-OPERATION             PIC X(30) VALUE SPACE.      02750000
027600 01  ABEND-CODE                  PIC S9(4) VALUE ZEROS COMP SYNC. 02760000
027700     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           02770000
027800     88  ABEND-4013-DB2-ERROR              VALUE +4013.           02780000
027900     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           02790000
028000     88  ABEND-4020-MQ-ERROR               VALUE +4020.           02800000
028100     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           02810000
028200                                                                  02820000
028300*-----------------------------------------------------------      02830000
028400* DB2 COMMUNICATIONS AREA                                         02840000
028500*-----------------------------------------------------------      02850000
028600     EXEC SQL                                                     02860000
028700          INCLUDE SQLCA                                           02870000
028800     END-EXEC.                                                    02880000
028900                                                                  02890000
029000*-----------------------------------------------------------      02900000
029100* DB2 TABLE XST00001(XST_LOC) - LOCATION (STORE) TABLE            02910000
029200*-----------------------------------------------------------      02920000
029300     EXEC SQL                                                     02930000
029400          INCLUDE XST00001                                        02940000
029500     END-EXEC.                                                    02950000
029600                                                                  02960000
029700*-----------------------------------------------------------      02970000
029800* DB2 TABLE XST00008(XST_SKU_LOC) - SKU LOCATION TABLE            02980000
029900*-----------------------------------------------------------      02990000
030000     EXEC SQL                                                     03000000
030100          INCLUDE XST00008                                        03010000
030200     END-EXEC.                                                    03020000
030300                                                                  03030000
030400*-----------------------------------------------------------      03040004
030500*  DB2 TABLE DB2PDBA.XST_SKU - SKU TABLE                          03050004
030600*-----------------------------------------------------------      03060004
030700     EXEC SQL                                                     03070004
030800          INCLUDE XST00010                                        03080004
030900     END-EXEC.                                                    03090004
031000                                                                  03100004
031100*-----------------------------------------------------------      03110000
031200* DB2 TABLE XST00025(XST_LOC_ATTR) - LOCATION ATTRIBUTE TABLE     03120000
031300*-----------------------------------------------------------      03130000
031400     EXEC SQL                                                     03140000
031500          INCLUDE XST00025                                        03150000
031600     END-EXEC.                                                    03160000
031700                                                                  03170000
031800*-----------------------------------------------------------      03180000
031900* DB2 TABLE XST00041(XST_SKU_LOC_ATTR) - SKU LOCATION ATTRIBUTE   03190000
032000*                                               TABLE             03200000
032100*-----------------------------------------------------------      03210000
032200     EXEC SQL                                                     03220000
032300          INCLUDE XST00041                                        03230000
032400     END-EXEC.                                                    03240000
032500                                                                  03250000
032600*-----------------------------------------------------------      03260000
032700*  LOC-CURSOR WILL FIND ALL STORE RECORDS FOR A GIVEN ITEM        03270000
032800*       THAT CORRESPOND TO VALID/CURRENT STORES                   03280000
032900*-----------------------------------------------------------      03290000
033000     EXEC SQL                                                     03300000
033100       DECLARE LOC-CURSOR CURSOR FOR                              03310000
033200            SELECT                                                03320000
033300                    S.INTR_UPC_ID                                 03330000
033400                   ,S.LOC_NBR                                     03340000
033500                   ,S.UNT_RTL_AMT                                 03350000
033600                   ,S.LOC_SKU_STAT_CDE                            03360000
033700                   ,S.GP_PRIC_ID                                  03370000
033800                   ,S.UNT_RTL_CHG_DTE                             03380000
033900                   ,S.GP_RTL_QTY                                  03390000
034000                   ,S.GP_RTL_AMT                                  03400000
034100                   ,S.LAST_UPD_TMST                               03410000
034200                   ,SKU.SKU_NBR                                   03420004
034300              FROM  XST_SKU_LOC  S                                03430000
034400                   ,XST_LOC      L                                03440000
034500                   ,XST_LOC_ATTR C                                03450000
034600                   ,XST_SKU      SKU                              03460004
034700             WHERE  S.INTR_UPC_ID  = :PV-DB2-INTR-UPC-ID          03470000
034800               AND  SKU.INTR_UPC_ID = S.INTR_UPC_ID               03480004
034900               AND  S.LOC_NBR         > 0                         03490000
035000               AND  S.END_TMST        IS NULL                     03500000
035100               AND  S.LOC_NBR         = L.LOC_NBR                 03510000
035200               AND  L.LOC_TYP_CDE     = 'DS'                      03520000
035300              AND ((L.OPN_DTE        <= :PV-START-DTE             03530000
035400                AND L.CLO_DTE        >= :PV-START-DTE)            03540000
035500                OR (L.OPN_DTE         > :PV-START-DTE             03550000
035600                AND L.OPN_DTE        <= :PV-NEW-DATE              03560000
035700                AND L.CLO_DTE        >= :PV-NEW-DATE))            03570000
035800               AND  S.LOC_NBR         = C.LOC_NBR                 03580000
035900               AND (C.POS_CAP_LVL_ID  = 5                         03590000
036000                 OR C.POS_CAP_LVL_ID  > 11)                       03600000
036100           WITH UR                                                03610000
036200     END-EXEC.                                                    03620000
036300                                                                  03630000
036400*-----------------------------------------------------------      03640000
036500*  ATTR-CURSOR WILL FIND ALL STORE RECORDS FOR A GIVEN ITEM       03650000
036600*       THAT CORRESPOND TO VALID/CURRENT STORES                   03660000
036700*-----------------------------------------------------------      03670000
036800     EXEC SQL                                                     03680000
036900       DECLARE ATTR-CURSOR CURSOR FOR                             03690000
037000            SELECT                                                03700000
037100                    A.INTR_UPC_ID                                 03710000
037200                   ,A.LOC_NBR                                     03720000
037300                   ,A.LAST_UPD_TMST                               03730000
037400                   ,A.PRMPT_FOR_PRIC_IND                          03740000
037500                   ,S.SKU_NBR                                     03750004
037600              FROM  XST_SKU_LOC_ATTR A                            03760000
037700                   ,XST_LOC      L                                03770000
037800                   ,XST_LOC_ATTR C                                03780000
037900                   ,XST_SKU      S                                03790004
038000             WHERE  A.INTR_UPC_ID  = :PV-DB2-INTR-UPC-ID          03800000
038100               AND  S.INTR_UPC_ID  = A.INTR_UPC_ID                03810004
038200               AND  A.LOC_NBR         > 0                         03820000
038300               AND  A.LOC_NBR         = L.LOC_NBR                 03830000
038400               AND  L.LOC_TYP_CDE     = 'DS'                      03840000
038500              AND ((L.OPN_DTE        <= :PV-START-DTE             03850000
038600                AND L.CLO_DTE        >= :PV-START-DTE)            03860000
038700                OR (L.OPN_DTE         > :PV-START-DTE             03870000
038800                AND L.OPN_DTE        <= :PV-NEW-DATE              03880000
038900                AND L.CLO_DTE        >= :PV-NEW-DATE))            03890000
039000               AND  A.LOC_NBR         = C.LOC_NBR                 03900000
039100               AND (C.POS_CAP_LVL_ID  = 5                         03910000
039200                 OR C.POS_CAP_LVL_ID  > 11)                       03920000
039300           WITH UR                                                03930000
039400     END-EXEC.                                                    03940000
039500                                                                  03950000
039600 LINKAGE SECTION.                                                 03960000
039700                                                                  03970000
039800*----------------------------------------------------------       03980000
039900 PROCEDURE DIVISION.                                              03990000
040000*----------------------------------------------------------       04000000
040100 0000-MAINLINE.                                                   04010000
040200                                                                  04020000
040300     ACCEPT PV-CPU-TIME FROM TIME                                 04030000
040400     DISPLAY '*** STARTING EPKUT108 AT -'                         04040000
040500             ' TIME: ' PV-CPU-TIME, '***'                         04050000
040600                                                                  04060000
040700     PERFORM 1000-INITIALIZATION.                                 04070000
040800                                                                  04080000
040900     PERFORM 2000-PROCESS-RCP                                     04090000
041000       UNTIL PS-END-OF-RCP-FILE.                                  04100000
041100                                                                  04110000
041200     PERFORM 9999-WRAPUP.                                         04120000
041300                                                                  04130000
041400     GOBACK.                                                      04140000
041500                                                                  04150000
041600*0000-EXIT.                                                       04160000
041700 EJECT.                                                           04170000
041800                                                                  04180000
041900*----------------------------------------------------------       04190000
042000* 1000-INITIALIZATION.                                            04200000
042100*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      04210000
042200*     FILES & READS CONTROL RECORDS PLUS PRIMING READ OF RCP      04220000
042300*        DOES CALCUATION BASED UPON CONTROL CARDS FOR NEW         04230000
042400*        STORE ADVANCE SEND DATE.                                 04240000
042500*----------------------------------------------------------       04250000
042600 1000-INITIALIZATION.                                             04260000
042700                                                                  04270000
042800     INITIALIZE EP122-RCP-DRIVE-RECORD,                           04280009
042900                EP045-ADVDAYS-TO-SND-RECORD,                      04290009
043000                CC-EPCC105-CONTROL-CARD,                          04300009
043100                CC-EPCC112-CONTROL-CARD,                          04310009
043200                CC-EPCC140-CONTROL-CARD.                          04320009
043300                                                                  04330000
043400     OPEN INPUT  CC-DAYS                                          04340000
043500                 CC-TIMESTAMP                                     04350000
043600                 CC-TOMORROW                                      04360000
043700                 CC-TODAY                                         04370000
043800                 RCP-DRIVER-FILE                                  04380000
043900          OUTPUT CHG-SKU-PRICG-STORE-FILE.                        04390009
044000                                                                  04400000
044100     PERFORM 1100-READ-DAYS.                                      04410000
044200                                                                  04420000
044300     IF  PS-END-OF-INPUT-FILE                                     04430000
044400        DISPLAY 'MISSING CONTROL CARD 045 - DAYS'                 04440000
044500        MOVE '1000-INITIALIZATION (DAYS)'                         04450000
044600                          TO PV-PARAGRAPH-NAME                    04460000
044700        MOVE 'CONTROL CARD IS MISSING' TO PV-OPERATION-MSG-1      04470000
044800        SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    04480000
044900        PERFORM 9800-ABEND                                        04490000
045000     END-IF.                                                      04500000
045100                                                                  04510000
045200     IF EP045-DAYS-TILL-STORE-OPN NOT NUMERIC                     04520000
045300        DISPLAY 'INVALID CONTROL CARD 045 - DAYS'                 04530000
045400        DISPLAY '   DAYS UNTIL OPEN: ',                           04540000
045500                         EP045-DAYS-TILL-STORE-OPN                04550000
045600        MOVE '1000-INITIALIZATION (DAYS)'                         04560000
045700                          TO PV-PARAGRAPH-NAME                    04570000
045800        MOVE 'CONTROL CARD IS INVALID' TO PV-OPERATION-MSG-1      04580000
045900        SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    04590000
046000        PERFORM 9800-ABEND                                        04600000
046100     END-IF.                                                      04610000
046200                                                                  04620000
046300     PERFORM 1200-READ-TIMESTAMP.                                 04630000
046400                                                                  04640000
046500     IF  PS-END-OF-INPUT-FILE                                     04650000
046600        DISPLAY 'MISSING CONTROL CARD 105 - TIMESTAMP'            04660000
046700        MOVE '1000-INITIALIZATION (TS)'                           04670000
046800                          TO PV-PARAGRAPH-NAME                    04680000
046900        MOVE 'CONTROL CARD IS MISSING' TO PV-OPERATION-MSG-1      04690000
047000        SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    04700000
047100        PERFORM 9800-ABEND                                        04710000
047200     END-IF.                                                      04720000
047300                                                                  04730000
047400     IF CC-EPCC105-PREV-TIMESTAMP = SPACES                        04740000
047500        DISPLAY 'INVALID CONTROL CARD'                            04750000
047600        DISPLAY '  PREV TIMESTAMP: ' CC-EPCC105-PREV-TIMESTAMP    04760000
047700        MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH-NAME           04770000
047800        MOVE 'CONTROL CARD IS INVALID' TO PV-OPERATION-MSG-1      04780000
047900        SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    04790000
048000        PERFORM 9800-ABEND                                        04800000
048100     END-IF.                                                      04810000
048200                                                                  04820000
048300     PERFORM 1300-READ-TOMORROW.                                  04830000
048400                                                                  04840000
048500     IF  PS-END-OF-INPUT-FILE                                     04850000
048600        DISPLAY 'MISSING CONTROL CARD 112 - TOMORROW'             04860000
048700        MOVE '1000-INITIALIZATION (TOMORROW)'                     04870000
048800                          TO PV-PARAGRAPH-NAME                    04880000
048900        MOVE 'CONTROL CARD IS MISSING' TO PV-OPERATION-MSG-1      04890000
049000        SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    04900000
049100        PERFORM 9800-ABEND                                        04910000
049200     END-IF.                                                      04920000
049300                                                                  04930000
049400     IF CC-EPCC112-TOMORROW-DATE =  SPACES                        04940000
049500        DISPLAY 'INVALID CONTROL CARD'                            04950000
049600        DISPLAY '   TOMORROW DATE: ' CC-EPCC112-TOMORROW-DATE     04960000
049700        MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH-NAME           04970000
049800        MOVE 'CONTROL CARD IS INVALID' TO PV-OPERATION-MSG-1      04980000
049900        SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    04990000
050000        PERFORM 9800-ABEND                                        05000000
050100     END-IF.                                                      05010000
050200                                                                  05020000
050300     MOVE CC-EPCC112-TOMORROW-DATE  TO PV-PRIC-EFF-DTE.           05030007
050400     MOVE PC-PRIC-EFF-TIME-STD      TO PV-PRIC-EFF-TIME.          05040007
050500     DISPLAY 'PRIC EFF TMST TO SQLS: ' PV-PRIC-EFF-TMST.          05050007
050600                                                                  05060007
050700     PERFORM 1400-READ-TODAY.                                     05070000
050800                                                                  05080000
050900     IF  PS-END-OF-INPUT-FILE                                     05090000
051000        DISPLAY 'MISSING CONTROL CARD 140 - TODAY'                05100000
051100        MOVE '1000-INITIALIZATION (TODAY)'                        05110000
051200                          TO PV-PARAGRAPH-NAME                    05120000
051300        MOVE 'CONTROL CARD IS MISSING' TO PV-OPERATION-MSG-1      05130000
051400        SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    05140000
051500        PERFORM 9800-ABEND                                        05150000
051600     END-IF.                                                      05160000
051700                                                                  05170000
051800     IF CC-EPCC140-TODAY-DATE =  SPACES                           05180000
051900        DISPLAY 'INVALID CONTROL CARD'                            05190000
052000        DISPLAY '   TODAY RUN DATE: ' CC-EPCC140-TODAY-DATE       05200000
052100        MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH-NAME           05210000
052200        MOVE 'CONTROL CARD IS INVALID' TO PV-OPERATION-MSG-1      05220000
052300        SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    05230000
052400        PERFORM 9800-ABEND                                        05240000
052500     END-IF.                                                      05250000
052600                                                                  05260000
052700     MOVE CC-EPCC112-TOMORROW-DATE  TO PV-START-DTE.              05270000
052800                                                                  05280000
052900********** ADD "DAYS" (BEFORE OPENING TO SEND DATA)               05290000
053000**********  TO "TODAY" (RUN DATE)                                 05300000
053100**********  TO GET DATE FOR NEW STORES DATE CHECKING              05310000
053200     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         05320000
053300     SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     05330000
053400     SET  DPG52-LK-DTE-ISO-FMT       TO TRUE.                     05340000
053500     SET  DPG51-INCREMENT-DATE       TO TRUE.                     05350000
053600     MOVE CC-EPCC140-TODAY-DATE      TO DPG52-LK-DATE-INPUT.      05360000
053700     MOVE EP045-DAYS-TILL-STORE-OPN  TO DPG51-INCR-DECR-DAYS-9.   05370000
053800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05380000
053900                                             DPG54 DPG55 DPG56.   05390000
054000     EVALUATE TRUE                                                05400000
054100         WHEN DPG54-NO-ERROR                                      05410000
054200             DISPLAY 'CALCULATED DATE FOR FUTURE STORES',         05420000
054300                     ' (USING DPKUT500):',                        05430000
054400                DPG55-DB2-ISO-DATE-FMT                            05440000
054500             DISPLAY '      TODAY + DAYS = FUTURE DATE'           05450000
054600             MOVE DPG55-DB2-ISO-DATE-FMT TO PV-NEW-DATE           05460000
054700         WHEN DPG54-SEVERE-ERROR                                  05470000
054800             DISPLAY ' '                                          05480000
054900             DISPLAY '** ABEND ** IN EPKUT108'                    05490000
055000             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    05500000
055100             DISPLAY '** CALLED BY 1000-INITIALIZATION'           05510000
055200             DISPLAY '** ERROR MESSAGE = '                        05520000
055300                               DPG54-ERROR-MESSAGE                05530000
055400             DISPLAY '** DPG51 = ' DPG51                          05540000
055500             DISPLAY '** DPG52 = ' DPG52                          05550000
055600             DISPLAY '** DPG53 = ' DPG53                          05560000
055700             DISPLAY '** DPG54 = ' DPG54                          05570000
055800             DISPLAY '** DPG55 = ' DPG55                          05580000
055900             DISPLAY '** DPG56 = ' DPG56                          05590000
056000             MOVE '1000-INITIALIZATION'                           05600000
056100                                  TO PV-PARAGRAPH-NAME            05610000
056200             MOVE 'ERROR CALCULATING NEW STORE DATE'              05620000
056300                                  TO PV-OPERATION-MSG-1           05630000
056400             MOVE DPG54-ERROR-MESSAGE  TO PV-OPERATION-MSG-2      05640000
056500             SET ABEND-4019-CAL-SUB-ERROR TO TRUE                 05650000
056600             PERFORM 9800-ABEND                                   05660000
056700     END-EVALUATE.                                                05670000
056800                                                                  05680000
056900     DISPLAY '***EPKUT108 * 1000-INITIALIZATION'.                 05690000
057000     DISPLAY 'EPCC045 DAYS      **'                               05700000
057100                      EP045-ADVDAYS-TO-SND-RECORD                 05710000
057200     DISPLAY 'EPCC105 TIMESTAMP **' CC-EPCC105-CONTROL-CARD.      05720000
057300     DISPLAY 'EPCC112 TOMORROW  **' CC-EPCC112-CONTROL-CARD.      05730000
057400     DISPLAY 'EPCC140 TODAY     **' CC-EPCC140-CONTROL-CARD.      05740000
057500                                                                  05750000
057600     PERFORM 8000-READ-RCP.                                       05760004
057700     DISPLAY 'PRIMING READ RCP  **' EP122-RCP-DRIVE-RECORD.       05770000
057800                                                                  05780000
057900*1000-EXIT.                                                       05790000
058000 EJECT.                                                           05800000
058100                                                                  05810000
058200*----------------------------------------------------------       05820000
058300* 1100-READ-DAYS.                                                 05830000
058400*     READ DAYS CONTROL CARD. GETS NUMBERS OF DAYS BEFORE         05840000
058500*     STORE OPENING TO CONSIDER STORES VALID.                     05850000
058600*----------------------------------------------------------       05860000
058700 1100-READ-DAYS.                                                  05870000
058800                                                                  05880000
058900     SET PS-NOT-END-OF-INPUT-FILE TO TRUE.                        05890000
059000     READ CC-DAYS INTO EP045-ADVDAYS-TO-SND-RECORD                05900000
059100       AT END                                                     05910000
059200          SET PS-END-OF-INPUT-FILE TO TRUE.                       05920000
059300                                                                  05930000
059400*1100-EXIT.                                                       05940000
059500 EJECT.                                                           05950000
059600                                                                  05960000
059700*----------------------------------------------------------       05970000
059800* 1200-READ-TIMESTAMP.                                            05980000
059900*     READ EPCC105 CARD. GETS PREVIOUS CYCLE TIMESTAMP.           05990000
060000*----------------------------------------------------------       06000000
060100 1200-READ-TIMESTAMP.                                             06010000
060200                                                                  06020000
060300     SET PS-NOT-END-OF-INPUT-FILE TO TRUE.                        06030000
060400     READ CC-TIMESTAMP INTO CC-EPCC105-CONTROL-CARD               06040000
060500       AT END                                                     06050000
060600          SET PS-END-OF-INPUT-FILE TO TRUE.                       06060000
060700                                                                  06070000
060800*1200-EXIT.                                                       06080000
060900 EJECT.                                                           06090000
061000                                                                  06100000
061100*----------------------------------------------------------       06110000
061200* 1300-READ-TOMORROW.                                             06120000
061300*     READ EPCC112 TOMORROW. GETS THE EFFECTIVE DATE THAT         06130000
061400*     NEEDS TO BE PROCESSED.                                      06140000
061500*----------------------------------------------------------       06150000
061600 1300-READ-TOMORROW.                                              06160000
061700                                                                  06170000
061800     SET PS-NOT-END-OF-INPUT-FILE TO TRUE.                        06180000
061900     READ CC-TOMORROW INTO CC-EPCC112-CONTROL-CARD                06190000
062000       AT END                                                     06200000
062100          SET PS-END-OF-INPUT-FILE TO TRUE                        06210000
062200     END-READ.                                                    06220000
062300                                                                  06230000
062400*1300-EXIT.                                                       06240000
062500                                                                  06250000
062600*----------------------------------------------------------       06260000
062700* 1400-READ-TODAY.                                                06270000
062800*     READ EPCC140 TODAY.  TODAYS RUN DATE                        06280000
062900*----------------------------------------------------------       06290000
063000 1400-READ-TODAY.                                                 06300000
063100                                                                  06310000
063200     SET PS-NOT-END-OF-INPUT-FILE TO TRUE.                        06320000
063300     READ CC-TODAY INTO CC-EPCC140-CONTROL-CARD                   06330000
063400       AT END                                                     06340000
063500          SET PS-END-OF-INPUT-FILE TO TRUE                        06350000
063600     END-READ.                                                    06360000
063700                                                                  06370000
063800*1400-EXIT.                                                       06380000
063900 EJECT.                                                           06390000
064000                                                                  06400000
064100*----------------------------------------------------------       06410000
064200* 2000-PROCESS-RCP.                                               06420000
064300*     FOR EACH RCP RECORD READS ALL STORES FOR APROPRIATE         06430000
064400*     CURSOR(S) AND THEN WRITES APPROPRIATE RECORD(S)             06440000
064500*----------------------------------------------------------       06450000
064600 2000-PROCESS-RCP.                                                06460000
064700                                                                  06470000
064800     MOVE EP122-INTERNAL-UPC-ID TO PV-INTR-UPC-ID.                06480000
064900     MOVE PV-INTR-UPC-ID        TO PV-DB2-INTR-UPC-ID.            06490000
065000     IF EP122-SKU-LOC-OVERRIDE                                    06500000
065100      OR EP122-BOTH-OVERRIDE                                      06510000
065200         ADD 1 TO PC-CNT-CHG-LOCS                                 06520000
065300         PERFORM 2100-OPEN-LOC-CURSOR                             06530000
065400         PERFORM 2350-FETCH-LOC-CURSOR                            06540000
065500         PERFORM 2300-PROCESS-LOC-CSR                             06550000
065600           UNTIL PS-END-OF-LOC-CSR                                06560000
065700         PERFORM 2200-CLOSE-LOC-CURSOR                            06570000
065800     END-IF.                                                      06580000
065900                                                                  06590000
066000     IF EP122-ATTR-OVERRIDE                                       06600000
066100      OR EP122-BOTH-OVERRIDE                                      06610000
066200         ADD 1 TO PC-CNT-CHG-ATTR                                 06620000
066300         PERFORM 2500-OPEN-ATTR-CURSOR                            06630000
066400         PERFORM 2750-FETCH-ATTR-CURSOR                           06640000
066500         PERFORM 2700-PROCESS-ATTR-CSR                            06650000
066600           UNTIL PS-END-OF-ATTR-CSR                               06660000
066700         PERFORM 2600-CLOSE-ATTR-CURSOR                           06670000
066800     END-IF.                                                      06680000
066900                                                                  06690000
067000     PERFORM 8000-READ-RCP.                                       06700004
067100                                                                  06710000
067200*2000-EXIT.                                                       06720000
067300 EJECT.                                                           06730000
067400                                                                  06740000
067500*----------------------------------------------------------       06750000
067600* 2100-OPEN-LOC-CURSOR.                                           06760000
067700*     OPEN SKU LOCATION CURSOR.                                   06770000
067800*----------------------------------------------------------       06780000
067900 2100-OPEN-LOC-CURSOR.                                            06790000
068000                                                                  06800000
068100     PERFORM                                                      06810000
068200         WITH TEST AFTER                                          06820000
068300         VARYING PV-SQL-SUB                                       06830000
068400         FROM 1 BY 1                                              06840000
068500         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 06850000
068600                   OR  SQLCODE = 0)                               06860000
068700                                                                  06870000
068800           EXEC SQL                                               06880000
068900              OPEN LOC-CURSOR                                     06890000
069000           END-EXEC                                               06900000
069100                                                                  06910000
069200         EVALUATE TRUE                                            06920000
069300             WHEN SQLCODE = -904                                  06930000
069400             WHEN SQLCODE = -911                                  06940000
069500             WHEN SQLCODE = -913                                  06950000
069600                  CONTINUE                                        06960000
069700             WHEN SQLCODE = 0                                     06970000
069800                  SET PS-NOT-END-OF-LOC-CSR TO TRUE               06980000
069900             WHEN SQLWARN0 NOT EQUAL SPACE                        06990000
070000             WHEN SQLCODE NOT EQUAL ZERO                          07000000
070100                  MOVE '2100-OPEN-LOC-CURSOR'                     07010000
070200                                     TO PV-PARAGRAPH-NAME         07020000
070300                  MOVE 'ERROR ON OPEN OF LOC CURSOR'              07030000
070400                                     TO PV-DB2-OPERATION          07040000
070500                  PERFORM 9900-SQL-ABEND-ROUTINE                  07050000
070600         END-EVALUATE                                             07060000
070700     END-PERFORM.                                                 07070000
070800                                                                  07080000
070900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07090000
071000        MOVE '2100-OPEN-LOC-CURSOR'                               07100000
071100                             TO  PV-PARAGRAPH-NAME                07110000
071200        MOVE 'OPEN RETRIES EXCEEDED'                              07120000
071300                              TO  PV-DB2-OPERATION                07130000
071400        PERFORM 9900-SQL-ABEND-ROUTINE                            07140000
071500     END-IF.                                                      07150000
071600                                                                  07160000
071700*2100-EXIT.                                                       07170000
071800 EJECT.                                                           07180000
071900                                                                  07190000
072000*-----------------------------------------------------------      07200000
072100* 2200-CLOSE-LOC-CURSOR.                                          07210000
072200*     CLOSE THE SKU LOCATION CURSOR.                              07220000
072300*-----------------------------------------------------------      07230000
072400 2200-CLOSE-LOC-CURSOR.                                           07240000
072500                                                                  07250000
072600     PERFORM                                                      07260000
072700         WITH TEST AFTER                                          07270000
072800         VARYING PV-SQL-SUB                                       07280000
072900         FROM 1 BY 1                                              07290000
073000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07300000
073100                   OR  SQLCODE = 0)                               07310000
073200                                                                  07320000
073300           EXEC SQL                                               07330000
073400              CLOSE LOC-CURSOR                                    07340000
073500           END-EXEC                                               07350000
073600                                                                  07360000
073700          EVALUATE TRUE                                           07370000
073800             WHEN SQLCODE = -904                                  07380000
073900             WHEN SQLCODE = -911                                  07390000
074000             WHEN SQLCODE = -913                                  07400000
074100             WHEN SQLCODE = 0                                     07410000
074200                  CONTINUE                                        07420000
074300             WHEN SQLWARN0 NOT EQUAL SPACE                        07430000
074400             WHEN SQLCODE NOT EQUAL ZERO                          07440000
074500                  MOVE '2200-CLOSE-LOC-CURSOR'                    07450000
074600                                      TO PV-PARAGRAPH-NAME        07460000
074700                  MOVE 'ERROR ON CLOSE OF SKU CURSOR'             07470000
074800                                      TO PV-DB2-OPERATION         07480000
074900                  PERFORM 9900-SQL-ABEND-ROUTINE                  07490000
075000          END-EVALUATE                                            07500000
075100     END-PERFORM.                                                 07510000
075200                                                                  07520000
075300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07530000
075400        MOVE '2200-CLOSE-LOC-CURSOR'                              07540000
075500                               TO  PV-PARAGRAPH-NAME              07550000
075600        MOVE 'CLOSE RETRIES EXCEEDED'                             07560000
075700                               TO  PV-DB2-OPERATION               07570000
075800        PERFORM 9900-SQL-ABEND-ROUTINE                            07580000
075900     END-IF.                                                      07590000
076000                                                                  07600000
076100*2200-EXIT.                                                       07610000
076200 EJECT.                                                           07620000
076300                                                                  07630000
076400*----------------------------------------------------------       07640000
076500* 2300-PROCESS-LOC-CSR.                                           07650000
076600*     FETCHES ANY LOCATIONS FOR THIS INTERNAL UPC THAT            07660000
076700*     HAS HAD A GLOBAL CHANGE (ALL CURRENT STORE RECORDS          07670000
076800*     NEED TO BE RESENT)                                          07680000
076900*----------------------------------------------------------       07690000
077000 2300-PROCESS-LOC-CSR.                                            07700000
077100                                                                  07710000
077200     IF XST00008-LAST-UPD-TMST <= CC-EPCC105-PREV-TIMESTAMP       07720000
077300        PERFORM 4000-BUILD-SQLS-SKU-PRICG-LOC                     07730004
077400        ADD 1 TO PC-CNT-PLU-LOC-RECS                              07740000
077500     END-IF.                                                      07750000
077600                                                                  07760000
077700     PERFORM 2350-FETCH-LOC-CURSOR.                               07770000
077800                                                                  07780000
077900*2300-EXIT.                                                       07790000
078000 EJECT.                                                           07800000
078100                                                                  07810000
078200*----------------------------------------------------------       07820000
078300* 2350-FETCH-LOC-CURSOR.                                          07830000
078400*     FETCH THE SKU LOCATION CURSOR                               07840000
078500*----------------------------------------------------------       07850000
078600 2350-FETCH-LOC-CURSOR.                                           07860000
078700                                                                  07870000
078800     PERFORM                                                      07880000
078900         WITH TEST AFTER                                          07890000
079000         VARYING PV-SQL-SUB                                       07900000
079100         FROM 1 BY 1                                              07910000
079200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07920000
079300                   OR  SQLCODE = 0                                07930000
079400                   OR  SQLCODE = +100)                            07940000
079500                                                                  07950000
079600           EXEC SQL                                               07960000
079700              FETCH LOC-CURSOR                                    07970000
079800              INTO                                                07980000
079900                    :PV-DB2-INTR-UPC-ID                           07990000
080000                   ,:XST00008-LOC-NBR                             08000000
080100                   ,:PV-DB2-UNT-RTL-AMT                           08010000
080200                   ,:PV-DB2-SKU-STAT-CDE                          08020000
080300                   ,:PV-DB2-GP-PRIC-ID    :PV-GP-PRIC-ID-IND      08030000
080400                   ,:PV-DB2-UNT-RTL-DTE                           08040000
080500                   ,:PV-DB2-GP-RTL-QTY    :PV-GP-RTL-QTY-IND      08050000
080600                   ,:PV-DB2-GP-RTL-AMT    :PV-GP-RTL-AMT-IND      08060000
080700                   ,:XST00008-LAST-UPD-TMST                       08070000
080800                   ,:XST00010-SKU-NBR                             08080004
080900           END-EXEC                                               08090000
081000                                                                  08100000
081100          EVALUATE TRUE                                           08110000
081200             WHEN SQLCODE = -904                                  08120000
081300             WHEN SQLCODE = -911                                  08130000
081400             WHEN SQLCODE = -913                                  08140000
081500                  CONTINUE                                        08150000
081600             WHEN SQLCODE = ZERO                                  08160000
081700                  ADD 1 TO PC-CNT-LOC-CSR                         08170000
081800             WHEN SQLCODE = +100                                  08180000
081900                  SET PS-END-OF-LOC-CSR     TO TRUE               08190000
082000             WHEN SQLWARN0 NOT EQUAL SPACE                        08200000
082100             WHEN SQLCODE NOT EQUAL ZERO                          08210000
082200                  MOVE '2350-FETCH-LOC-CURSOR'                    08220000
082300                                     TO PV-PARAGRAPH-NAME         08230000
082400                  MOVE 'ERROR ON FETCHING LOC CURSOR'             08240000
082500                                     TO PV-DB2-OPERATION          08250000
082600                  DISPLAY 'SQLCODE= ' SQLCODE                     08260000
082700                  PERFORM 9900-SQL-ABEND-ROUTINE                  08270000
082800          END-EVALUATE                                            08280000
082900     END-PERFORM.                                                 08290000
083000                                                                  08300000
083100     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        08310000
083200         MOVE '2350-FETCH-LOC-CURSOR'                             08320000
083300                               TO  PV-PARAGRAPH-NAME              08330000
083400         MOVE 'FETCH RETRIES EXCEEDED'                            08340000
083500                               TO  PV-DB2-OPERATION               08350000
083600         PERFORM 9900-SQL-ABEND-ROUTINE                           08360000
083700     END-IF.                                                      08370000
083800                                                                  08380000
083900*2350-EXIT.                                                       08390000
084000 EJECT.                                                           08400000
084100                                                                  08410000
084200*----------------------------------------------------------       08420000
084300* 2500-OPEN-ATTR-CURSOR.                                          08430000
084400*     OPEN SKU ATTRIBUTE CURSOR.                                  08440000
084500*----------------------------------------------------------       08450000
084600 2500-OPEN-ATTR-CURSOR.                                           08460000
084700                                                                  08470000
084800     PERFORM                                                      08480000
084900         WITH TEST AFTER                                          08490000
085000         VARYING PV-SQL-SUB                                       08500000
085100         FROM 1 BY 1                                              08510000
085200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08520000
085300                   OR  SQLCODE = 0)                               08530000
085400                                                                  08540000
085500           EXEC SQL                                               08550000
085600              OPEN ATTR-CURSOR                                    08560000
085700           END-EXEC                                               08570000
085800                                                                  08580000
085900         EVALUATE TRUE                                            08590000
086000             WHEN SQLCODE = -904                                  08600000
086100             WHEN SQLCODE = -911                                  08610000
086200             WHEN SQLCODE = -913                                  08620000
086300                  CONTINUE                                        08630000
086400             WHEN SQLCODE = 0                                     08640000
086500                  SET PS-NOT-END-OF-ATTR-CSR TO TRUE              08650000
086600             WHEN SQLWARN0 NOT EQUAL SPACE                        08660000
086700             WHEN SQLCODE NOT EQUAL ZERO                          08670000
086800                  MOVE '2500-OPEN-ATTR-CURSOR'                    08680000
086900                                     TO PV-PARAGRAPH-NAME         08690000
087000                  MOVE 'ERROR ON OPEN OF ATTR CURSOR'             08700000
087100                                     TO PV-DB2-OPERATION          08710000
087200                  PERFORM 9900-SQL-ABEND-ROUTINE                  08720000
087300         END-EVALUATE                                             08730000
087400     END-PERFORM.                                                 08740000
087500                                                                  08750000
087600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08760000
087700        MOVE '2500-OPEN-ATTR-CURSOR'                              08770000
087800                             TO  PV-PARAGRAPH-NAME                08780000
087900        MOVE 'OPEN RETRIES EXCEEDED'                              08790000
088000                              TO  PV-DB2-OPERATION                08800000
088100        PERFORM 9900-SQL-ABEND-ROUTINE                            08810000
088200     END-IF.                                                      08820000
088300                                                                  08830000
088400*2500-EXIT.                                                       08840000
088500 EJECT.                                                           08850000
088600                                                                  08860000
088700*-----------------------------------------------------------      08870000
088800* 2600-CLOSE-ATTR-CURSOR.                                         08880000
088900*     CLOSE THE SKU ATTRIBUTE CURSOR.                             08890000
089000*-----------------------------------------------------------      08900000
089100 2600-CLOSE-ATTR-CURSOR.                                          08910000
089200                                                                  08920000
089300     PERFORM                                                      08930000
089400         WITH TEST AFTER                                          08940000
089500         VARYING PV-SQL-SUB                                       08950000
089600         FROM 1 BY 1                                              08960000
089700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08970000
089800                   OR  SQLCODE = 0)                               08980000
089900                                                                  08990000
090000           EXEC SQL                                               09000000
090100              CLOSE ATTR-CURSOR                                   09010000
090200           END-EXEC                                               09020000
090300                                                                  09030000
090400          EVALUATE TRUE                                           09040000
090500             WHEN SQLCODE = -904                                  09050000
090600             WHEN SQLCODE = -911                                  09060000
090700             WHEN SQLCODE = -913                                  09070000
090800             WHEN SQLCODE = 0                                     09080000
090900                  CONTINUE                                        09090000
091000             WHEN SQLWARN0 NOT EQUAL SPACE                        09100000
091100             WHEN SQLCODE NOT EQUAL ZERO                          09110000
091200                  MOVE '2600-CLOSE-ATTR-CURSOR'                   09120000
091300                                      TO PV-PARAGRAPH-NAME        09130000
091400                  MOVE 'ERROR ON CLOSE OF ATTR CURSOR'            09140000
091500                                      TO PV-DB2-OPERATION         09150000
091600                  PERFORM 9900-SQL-ABEND-ROUTINE                  09160000
091700          END-EVALUATE                                            09170000
091800     END-PERFORM.                                                 09180000
091900                                                                  09190000
092000     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09200000
092100        MOVE '2600-CLOSE-ATTR-CURSOR'                             09210000
092200                               TO  PV-PARAGRAPH-NAME              09220000
092300        MOVE 'CLOSE RETRIES EXCEEDED'                             09230000
092400                               TO  PV-DB2-OPERATION               09240000
092500        PERFORM 9900-SQL-ABEND-ROUTINE                            09250000
092600     END-IF.                                                      09260000
092700                                                                  09270000
092800*2600-EXIT.                                                       09280000
092900 EJECT.                                                           09290000
093000                                                                  09300000
093100*----------------------------------------------------------       09310000
093200* 2700-PROCESS-ATTR-CSR.                                          09320000
093300*     FETCHES ANY ATTRIBUTES FOR THIS INTERNAL UPC THAT           09330000
093400*     HAS HAD A GLOBAL CHANGE (ALL CURRENT STORE RECORDS          09340000
093500*     NEED TO BE RESENT)                                          09350000
093600*----------------------------------------------------------       09360000
093700 2700-PROCESS-ATTR-CSR.                                           09370000
093800                                                                  09380000
093900     IF XST00041-LAST-UPD-TMST <= CC-EPCC105-PREV-TIMESTAMP       09390000
094000        PERFORM 4100-BUILD-SQLS-SKU-PRICG-ATTR                    09400004
094100        ADD 1 TO PC-CNT-PLU-ATTR-RECS                             09410000
094200     END-IF.                                                      09420000
094300                                                                  09430000
094400     PERFORM 2750-FETCH-ATTR-CURSOR.                              09440000
094500                                                                  09450000
094600*2700-EXIT.                                                       09460000
094700 EJECT.                                                           09470000
094800                                                                  09480000
094900*----------------------------------------------------------       09490000
095000* 2750-FETCH-ATTR-CURSOR.                                         09500000
095100*     FETCH THE ATTRIBUTE CURSOR.                                 09510000
095200*----------------------------------------------------------       09520000
095300 2750-FETCH-ATTR-CURSOR.                                          09530000
095400                                                                  09540000
095500     PERFORM                                                      09550000
095600         WITH TEST AFTER                                          09560000
095700         VARYING PV-SQL-SUB                                       09570000
095800         FROM 1 BY 1                                              09580000
095900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09590000
096000                   OR  SQLCODE = 0                                09600000
096100                   OR  SQLCODE = +100)                            09610000
096200                                                                  09620000
096300           EXEC SQL                                               09630000
096400              FETCH ATTR-CURSOR                                   09640000
096500              INTO                                                09650000
096600                    :PV-DB2-INTR-UPC-ID                           09660000
096700                   ,:XST00008-LOC-NBR                             09670000
096800                   ,:XST00041-LAST-UPD-TMST                       09680000
096900                   ,:XST00041-PRMPT-FOR-PRIC-IND                  09690000
097000                   ,:XST00010-SKU-NBR                             09700004
097100           END-EXEC                                               09710000
097200                                                                  09720000
097300          EVALUATE TRUE                                           09730000
097400             WHEN SQLCODE = -904                                  09740000
097500             WHEN SQLCODE = -911                                  09750000
097600             WHEN SQLCODE = -913                                  09760000
097700                  CONTINUE                                        09770000
097800             WHEN SQLCODE = ZERO                                  09780000
097900                  ADD 1 TO PC-CNT-ATTR-CSR                        09790000
098000             WHEN SQLCODE = +100                                  09800000
098100                  SET PS-END-OF-ATTR-CSR    TO TRUE               09810000
098200             WHEN SQLWARN0 NOT EQUAL SPACE                        09820000
098300             WHEN SQLCODE NOT EQUAL ZERO                          09830000
098400                  MOVE '2750-FETCH-ATTR-CURSOR'                   09840000
098500                                     TO PV-PARAGRAPH-NAME         09850000
098600                  MOVE 'ERROR ON FETCHING ATTR CURSOR'            09860000
098700                                     TO PV-DB2-OPERATION          09870000
098800                  DISPLAY 'SQLCODE= ' SQLCODE                     09880000
098900                  PERFORM 9900-SQL-ABEND-ROUTINE                  09890000
099000          END-EVALUATE                                            09900000
099100     END-PERFORM.                                                 09910000
099200                                                                  09920000
099300     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        09930000
099400         MOVE '2750-FETCH-ATTR-CURSOR'                            09940000
099500                               TO  PV-PARAGRAPH-NAME              09950000
099600         MOVE 'FETCH RETRIES EXCEEDED'                            09960000
099700                               TO  PV-DB2-OPERATION               09970000
099800         PERFORM 9900-SQL-ABEND-ROUTINE                           09980000
099900     END-IF.                                                      09990000
100000                                                                  10000000
100100*2750-EXIT.                                                       10010000
100200 EJECT.                                                           10020000
100300                                                                  10030000
100400*----------------------------------------------------------       10040004
100500* 4000-BUILD-SQLS-SKU-PRICG-LOC.                                  10050004
100600*     BUILDS THE SKU PRICG STORE RECORD - FOR SKU-LOC CURSOR      10060004
100700*----------------------------------------------------------       10070004
100800 4000-BUILD-SQLS-SKU-PRICG-LOC.                                   10080004
100900                                                                  10090004
101000     INITIALIZE EP220-XST-SKU-PRICG-RECORD.                       10100004
101100                                                                  10110004
101200     PERFORM 5000-FORMAT-SKU-PRICG-COMMON.                        10120004
101300     PERFORM 5100-POP-SKU-PRICG-STR-PRIC.                         10130004
101400                                                                  10140004
101500     PERFORM 8200-WRITE-SKU-PRICG-STR-REC.                        10150004
101600     ADD +1 TO PC-CNT-SKU-PRICG-STR-LOC-RECS.                     10160004
101700                                                                  10170004
101800*4000-EXIT.                                                       10180004
101900*----------------------------------------------------------       10190004
102000* 4100-BUILD-SQLS-SKU-PRICG-ATTR.                                 10200004
102100*     BUILDS THE SKU PRICG STORE RECORD - FOR ATTRIBUTES CURSOR   10210004
102200*----------------------------------------------------------       10220004
102300 4100-BUILD-SQLS-SKU-PRICG-ATTR.                                  10230004
102400                                                                  10240004
102500     INITIALIZE EP220-XST-SKU-PRICG-RECORD.                       10250004
102600                                                                  10260004
102700     PERFORM 5000-FORMAT-SKU-PRICG-COMMON.                        10270004
102800     PERFORM 5200-POP-SKU-PRICG-STR-ATTR.                         10280004
102900                                                                  10290004
103000     PERFORM 8200-WRITE-SKU-PRICG-STR-REC.                        10300004
103100                                                                  10310004
103200     ADD +1 TO PC-CNT-SKU-PRICG-STR-ATTR-RECS.                    10320004
103300                                                                  10330004
103400*4100-EXIT.                                                       10340004
103500*----------------------------------------------------------       10350004
103600* 5000-FORMAT-SKU-PRICG-COMMON.                                   10360004
103700*    POPULATES SKU PRICG STORE RECORD COMMON FIELDS               10370004
103800*----------------------------------------------------------       10380004
103900 5000-FORMAT-SKU-PRICG-COMMON.                                    10390004
104000                                                                  10400004
104100     MOVE CC-EPCC112-TOMORROW-DATE TO EP220-PRICG-EFFECT-DTE.     10410004
104200     MOVE PC-STR-GRP-TYP-CDE-STORE TO EP220-STR-GRP-TYP-CDE.      10420008
104300     MOVE XST00008-LOC-NBR         TO EP220-STR-GRP-ID.           10430004
104400                                                                  10440004
104500     SET EP220-FILE-CHANGE             TO TRUE.                   10450005
104600     SET EP220-APPLY-NIGHTLY           TO TRUE.                   10460005
104700     SET EP220-RECORD-UPDATE           TO TRUE.                   10470005
104800                                                                  10480004
104900*    SET DATA ITEM INCLUSION FLAGS AND POPULATE COMMON:           10490005
105000*    SKU-PRICG-ID IS NEVER SENT - POPULATED AT STORE SERVER       10500004
105100*    SET MDSE-HIER-CDE TO 'SKU' FOR ALL CURRENT PRICING RECORDS   10510004
105200*    SEND SKU FOR ALL RECORDS                                     10520004
105300     SET EP220-SKU-PRICG-ID-NO         TO TRUE.                   10530005
105400                                                                  10540004
105500     SET EP220-PRIC-EFF-TMST-YES       TO TRUE.                   10550005
105600     MOVE PV-PRIC-EFF-TMST         TO EP220-PRIC-EFF-TMST.        10560004
105700                                                                  10570004
105800     SET EP220-MDSE-HIER-CDE-YES       TO TRUE.                   10580005
105900     MOVE PC-MDSE-HIER-SKU         TO EP220-MDSE-HIER-CDE.        10590004
106000                                                                  10600004
106100     SET EP220-SKU-NBR-YES             TO TRUE.                   10610005
106200     MOVE XST00010-SKU-NBR         TO EP220-SKU-NBR.              10620004
106300                                                                  10630004
106400*   SET REST OF DATA ITEM INCLUSION FLAGS TO "NO":                10640004
106500     SET EP220-DEPT-NBR-NO             TO TRUE.                   10650004
106600     SET EP220-MAJ-CL-NBR-NO           TO TRUE.                   10660004
106700     SET EP220-SUB-CL-NBR-NO           TO TRUE.                   10670004
106800     SET EP220-STYL-ID-NO              TO TRUE.                   10680004
106900     SET EP220-EXCL-MDSE-IND-NO        TO TRUE.                   10690004
107000     SET EP220-UNT-RTL-AMT-NO          TO TRUE.                   10700004
107100     SET EP220-LAST-NCLR-RTL-AMT-NO    TO TRUE.                   10710004
107200     SET EP220-N-RCPT-RT-RTL-AMT-N     TO TRUE.                   10720004
107300     SET EP220-GP-RTL-AMT-NO           TO TRUE.                   10730004
107400     SET EP220-LO-UNT-RTL-AMT-NO       TO TRUE.                   10740004
107500     SET EP220-HGH-UNT-RTL-AMT-NO      TO TRUE.                   10750004
107600     SET EP220-GP-RTL-QTY-NO           TO TRUE.                   10760004
107700     SET EP220-GP-PRIC-ID-NO           TO TRUE.                   10770004
107800     SET EP220-LOC-SKU-STAT-CDE-NO     TO TRUE.                   10780004
107900     SET EP220-TKT-CLOR-CDE-NO         TO TRUE.                   10790004
108000     SET EP220-LAST-PRCHG-TMST-NO      TO TRUE.                   10800004
108100     SET EP220-PRMPT-FOR-PRIC-IND-NO   TO TRUE.                   10810004
108200     SET EP220-PERM-PRCHG-DIRN-CDE-NO  TO TRUE.                   10820004
108300     SET EP220-MLT-PRPT-IND-NO         TO TRUE.                   10830004
108400     SET EP220-PRCHG-APL-TKT-CLR-CD-N  TO TRUE.                   10840004
108500                                                                  10850004
108600*5000-EXIT.                                                       10860004
108700*----------------------------------------------------------       10870004
108800* 5100-POP-SKU-PRICG-STR-PRIC.                                    10880004
108900*    POPULATES SKU PRICG STORE RECORD - FOR SKU-LOC CURSOR        10890004
109000*----------------------------------------------------------       10900004
109100 5100-POP-SKU-PRICG-STR-PRIC.                                     10910004
109200                                                                  10920005
109300     SET EP220-UNT-RTL-AMT-YES         TO TRUE.                   10930005
109400     MOVE PV-DB2-UNT-RTL-AMT       TO PV-PROMO-PRICE.             10940005
109500     MOVE PV-PROMO-PRICE           TO EP220-UNT-RTL-AMT.          10950005
109600                                                                  10960005
109700     SET EP220-LOC-SKU-STAT-CDE-YES    TO TRUE.                   10970005
109800     MOVE PV-DB2-SKU-STAT-CDE      TO EP220-LOC-SKU-STAT-CDE.     10980005
109900                                                                  10990005
110000     SET EP220-GP-RTL-AMT-YES          TO TRUE.                   11000005
110100     SET EP220-GP-RTL-QTY-YES          TO TRUE.                   11010005
110200     SET EP220-GP-PRIC-ID-YES          TO TRUE.                   11020005
110300     IF PV-GP-PRIC-ID-NULL                                        11030005
110400        MOVE PC-NULL-CHAR          TO EP220-GP-RTL-AMT-NUL        11040005
110500                                      EP220-GP-RTL-QTY-NUL        11050005
110600                                      EP220-GP-PRIC-ID-NUL        11060005
110700     ELSE                                                         11070005
110800        MOVE PV-DB2-GP-PRIC-ID     TO PV-GP-PRIC-ID               11080005
110900        MOVE PV-GP-PRIC-ID         TO EP220-GP-PRIC-ID            11090005
111000        MOVE PV-DB2-GP-RTL-AMT     TO PV-PROMO-PRICE              11100005
111100        MOVE PV-PROMO-PRICE        TO EP220-GP-RTL-AMT            11110005
111200        MOVE PV-DB2-GP-RTL-QTY     TO EP220-GP-RTL-QTY            11120005
111300     END-IF.                                                      11130005
111400                                                                  11140005
111500     SET EP220-TKT-CLOR-CDE-YES        TO TRUE.                   11150005
111600     IF PV-DB2-SKU-STAT-CDE = '30'                                11160005
111700        MOVE 'Y'                   TO EP220-TKT-CLOR-CDE          11170005
111800     ELSE                                                         11180005
111900        MOVE 'W'                   TO EP220-TKT-CLOR-CDE          11190005
112000     END-IF.                                                      11200005
112100                                                                  11210005
112200     SET  EP220-LAST-PRCHG-TMST-YES    TO TRUE.                   11220005
112300     MOVE PV-DB2-UNT-RTL-DTE       TO PV-LAST-PRCHG-DTE.          11230005
112400     MOVE PC-SQLS-START-TIME       TO PV-LAST-PRCHG-TIME.         11240005
112500     MOVE PV-LAST-PRCHG-TMST       TO EP220-LAST-PRCHG-TMST.      11250005
112600                                                                  11260004
112700*5100-EXIT.                                                       11270004
112800*----------------------------------------------------------       11280004
112900* 5200-POP-SKU-PRICG-STR-ATTR.                                    11290004
113000*    POPULATES SKU PRICG STORE RECORD - FOR ATTRIBUTE CURSOR      11300004
113100*----------------------------------------------------------       11310004
113200 5200-POP-SKU-PRICG-STR-ATTR.                                     11320004
113300                                                                  11330004
113400     SET EP220-PRMPT-FOR-PRIC-IND-YES  TO TRUE.                   11340006
113500     MOVE XST00041-PRMPT-FOR-PRIC-IND                             11350005
113600                                   TO EP220-PRMPT-FOR-PRIC-IND.   11360006
113700                                                                  11370004
113800*5200-EXIT.                                                       11380004
113900*----------------------------------------------------------       11390004
114000* 8000-READ-RCP.                                                  11400004
114100*     READ RCP CHANGE RECORD.                                     11410000
114200*----------------------------------------------------------       11420000
114300 8000-READ-RCP.                                                   11430004
114400                                                                  11440000
114500     READ RCP-DRIVER-FILE INTO EP122-RCP-DRIVE-RECORD             11450000
114600       AT END                                                     11460000
114700          SET PS-END-OF-RCP-FILE TO TRUE                          11470000
114800     END-READ.                                                    11480000
114900                                                                  11490000
115000     IF PS-NOT-END-OF-RCP-FILE                                    11500000
115100        ADD 1 TO PC-CNT-RCP-RECS                                  11510000
115200     END-IF.                                                      11520000
115300                                                                  11530000
115400*8000-EXIT.                                                       11540004
115500                                                                  11550000
115600*----------------------------------------------------------       11560004
115700* 8200-WRITE-SKU-PRICG-STR-REC.                                   11570004
115800*     WRITES THE SKU PRICING STORE RECORD OUT                     11580004
115900*----------------------------------------------------------       11590004
116000 8200-WRITE-SKU-PRICG-STR-REC.                                    11600004
116100                                                                  11610004
116200     WRITE CHG-SKU-PRICG-STORE-RECORD                             11620004
116300         FROM EP220-XST-SKU-PRICG-RECORD.                         11630004
116400                                                                  11640004
116500     ADD 1 TO PC-CNT-SKU-PRICG-STR-RECS.                          11650004
116600     ADD 1 TO PC-CNT-ALL-RECS.                                    11660004
116700                                                                  11670004
116800*8200-EXIT.                                                       11680004
116900                                                                  11690004
117000*----------------------------------------------------------       11700000
117100* 9800-ABEND.                                                     11710000
117200*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  11720000
117300*----------------------------------------------------------       11730000
117400 9800-ABEND.                                                      11740000
117500                                                                  11750000
117600     DISPLAY '** ABEND           **'.                             11760000
117700     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  11770000
117800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        11780000
117900     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       11790000
118000     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       11800000
118100     CALL 'ILBOABN0' USING ABEND-CODE.                            11810000
118200                                                                  11820000
118300*9800-EXIT.                                                       11830000
118400 EJECT.                                                           11840000
118500                                                                  11850000
118600*----------------------------------------------------------       11860000
118700* 9900-SQL-ABEND-ROUTINE.                                         11870000
118800*     SQL ABEND ROUTINE.                                          11880000
118900*----------------------------------------------------------       11890000
119000 9900-SQL-ABEND-ROUTINE.                                          11900000
119100                                                                  11910000
119200     SET ABEND-4013-DB2-ERROR TO TRUE.                            11920000
119300     DISPLAY '** ABEND     **'.                                   11930000
119400     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        11940000
119500     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              11950000
119600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               11960000
119700                                                                  11970000
119800     COPY DPPD004.                                                11980000
119900     CALL 'ILBOABN0' USING ABEND-CODE.                            11990000
120000                                                                  12000000
120100*9900-EXIT.                                                       12010000
120200 EJECT.                                                           12020000
120300                                                                  12030000
120400*----------------------------------------------------------       12040000
120500* 9999-WRAPUP.                                                    12050000
120600*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      12060000
120700*     ANY DATA FROM THE PROGRAM.                                  12070000
120800*----------------------------------------------------------       12080000
120900 9999-WRAPUP.                                                     12090000
121000                                                                  12100000
121100     CLOSE CC-DAYS                                                12110000
121200           CC-TIMESTAMP                                           12120000
121300           CC-TOMORROW                                            12130000
121400           CC-TODAY                                               12140000
121500           RCP-DRIVER-FILE                                        12150000
121600           CHG-SKU-PRICG-STORE-FILE.                              12160004
121700                                                                  12170000
121800     DISPLAY ' '.                                                 12180000
121900     DISPLAY '*********************************************'.     12190000
122000     DISPLAY '*** PROGRAM COUNTS FOR ' PC-CURRENT-PROGRAM-NAME.   12200000
122100     DISPLAY '*********************************************'.     12210000
122200     ACCEPT PV-CPU-TIME FROM TIME                                 12220000
122300     DISPLAY ' TIME: ' PV-CPU-TIME, '***'                         12230000
122400                                                                  12240000
122500     DISPLAY 'NUMBER OF RCP DRIVER RECS READ : '                  12250000
122600             PC-CNT-RCP-RECS.                                     12260000
122700     DISPLAY 'CHG RCP LOCATION RECS READ     : ' PC-CNT-CHG-LOCS. 12270000
122800     DISPLAY 'CHG RCP ATTRIBUTE RECS READ    : ' PC-CNT-CHG-ATTR  12280000
122900     DISPLAY '** CHANGE BOTH ARE IN CHG LOC AND ATTR COUNTS **'   12290000
123000     DISPLAY 'NUMBER OF LOC RECS FETCHED     : ' PC-CNT-LOC-CSR.  12300000
123100     DISPLAY 'NUMBER OF ATTRIBUTE FETCHS     : ' PC-CNT-ATTR-CSR. 12310000
123200     DISPLAY 'NUMBER OF STORE LOC RECS  WRITTEN: '                12320000
123300             PC-CNT-PLU-LOC-RECS.                                 12330000
123400     DISPLAY 'NUMBER OF STORE ATTR RECS WRITTEN: '                12340000
123500             PC-CNT-PLU-ATTR-RECS.                                12350000
123600     DISPLAY ' NBR OF SKU PRICG STR LOC RECS WRITTEN: '           12360004
123700             PC-CNT-SKU-PRICG-STR-LOC-RECS.                       12370004
123800     DISPLAY 'NBR OF SKU PRICG STR ATTR RECS WRITTEN: '           12380004
123900             PC-CNT-SKU-PRICG-STR-ATTR-RECS.                      12390004
124000     DISPLAY 'NUMBER OF SKU PRICG RECS WRITTEN: '                 12400004
124100             PC-CNT-SKU-PRICG-STR-RECS.                           12410004
124200     DISPLAY 'ALL RECS WRITTEN                 : '                12420000
124300             PC-CNT-ALL-RECS.                                     12430000
124400     DISPLAY '*********************************************'.     12440000
124500                                                                  12450000
124600*9999-EXIT.                                                       12460000
124700 EJECT.                                                           12470000
124800                                                                  12480000
