       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    INKRP187.                                                 
       AUTHOR.        V LEE YANG.                                               
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  02-01-2001.                                               
       DATE-COMPILED.                                                           
      ******************************************************************        
      * INKRP187 - THIS PROGRAM PRODUCES THE SHORTAGE REPORT SIMILAR   *        
      *            TO INKRP146 BUT CUTS OUT THE STORE AND BUYER DETAIL *        
      *                                                                *        
      *            TOTALS ARE ACCUMULATED FOR DIVISION AND COMPANY     *        
      *                LEVELS, BUT REPORTED FOR ONLY COMPANY LEVEL.    *        
      *            THE REPORT BREAKS ON                                *        
      *                CHANGES OF DEPARTMENT                           *        
      *                                                                *        
      ******************** HISTORY OF CHANGES **************************        
      *                                                                *        
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *        
      * -------  ----------  ----------------------------------------  *        
      * 21015    02-14-2001  CHANGE THE REPORT TITLE TO BE DIFFERENT   *        
      *                      BETWEEN ESTIMATED AND PHYSICAL STORE.     *        
      *                                                                *        
      ******************************************************************        
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES     -S.JACKSON     *        
      * -------  ----------  ----------------------------------------  *        
      *  22842   10/23/2001  FOLLOWING CHGS MADE TO SHORT PERCENT CALC *        
      *                      - IF SHORT_RETAIL = 0,THEN SHORT % = 0    *        
      *          ID:SJ1001   - IF TOTAL_RETAIL = 0,THEN SHORT % = 999.9*        
      *                      - FORCE SHORT % PERCENT SIGN (+/-) TO BE  *        
      *                        THE SAME SIGN AS SHORT_RETAIL FIELD.    *        
W26600* W26600  04-05-2004 ROD JANSSEN INV LEDGER STORE EXPANSION               
W20445* W20445  09-01-2004 ROD JANSSEN DETAILED INVNENTORY ADJUSTMENT           
W28545* W28545  08-10-2006  ADD LOGIC FOR DEPARTMENT LEVEL                      
W28545*                      INVENTORY PROCESS.                                 
W28545*                      -B. GRAHAM - STRATAGEM                             
S28545* P926751 09-17-2006 S.JACKSON - SQL -180 IN C050-GET-LAST-INV-DAT        
S28545* P926751            CHANGE HOW NULL INDICATOR IS HANDLED                 
RONNAM*         01-14-2006 R. MCDONALD - INCREASE PC-TABLE-MAX FROM             
RONNAM*                    999 TO 9999.                                         
W33304* W33304  11-20-2008 NIJESH/INFOSYS                                       
W33304*                      HOLDING INVENTORY LEDGER OPEN (HILO).              
      ******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER.        IBM-3090.                                        
       OBJECT-COMPUTER.        IBM-3090.                                        
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT EXTRACT-FILE                                                  
               ASSIGN TO  INP01.                                                
                                                                                
           SELECT CONTROL-FILE                                                  
               ASSIGN TO  INP02.                                                
                                                                                
           SELECT SHORTAGE-REPORT                                               
               ASSIGN TO  RPT01.                                                
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  EXTRACT-FILE                                                         
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 CHARACTERS.                                         
                                                                                
W33304 01  EXTRACT-RECORD                   PIC X(170).                         
                                                                                
       FD  CONTROL-FILE                                                         
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 CHARACTERS.                                         
                                                                                
       01  CONTROL-RECORD                   PIC X(80).                          
                                                                                
       FD  SHORTAGE-REPORT                                                      
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 CHARACTERS.                                         
                                                                                
       01  SHORTAGE-LINE                    PIC X(150).                         
      ******************************************************************        
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-DB2-OPER-ATTEMPTED      PIC X(30).                            
           05  PV-SQL-SUB                 PIC S9(4)      VALUE ZERO             
                                                         COMP SYNC.             
           05  PV-NULL                    PIC S9(4)      VALUE ZERO             
                                                         COMP SYNC.             
           05  PV-PARAGRAPH-NAME          PIC X(30)   VALUE SPACE.              
W33304     05  PV-CYCLE-TOTAL.                                                  
W33304         10  FILLER                 PIC X(06)    VALUE 'CYCLE '.          
W33304         10  PV-CYCLE-NBR           PIC 9(05)    VALUE ZEROS.             
W33304         10  FILLER                 PIC X(06)    VALUE                    
W33304              ' TOTAL'.                                                   
W33304         10  FILLER                 PIC X(07)    VALUE SPACE.             
W33304     05  PV-MONTH-TOTAL.                                                  
W33304         10  FILLER                 PIC X(06)    VALUE 'MONTH '.          
W33304         10  PV-MONTH-NAME          PIC X(03)    VALUE SPACES.            
W33304         10  FILLER                 PIC X(03)    VALUE SPACES.            
W33304         10  FILLER                 PIC X(06)    VALUE                    
W33304              'TOTAL'.                                                    
W33304         10  FILLER                 PIC X(06)    VALUE SPACE.             
W33304     05  PV-GRAND-TOTAL.                                                  
W33304         10  FILLER                 PIC X(06)    VALUE SPACES.            
W33304         10  FILLER                 PIC X(12)    VALUE                    
W33304              'GRAND TOTAL'.                                              
W33304         10  FILLER                 PIC X(06)    VALUE SPACE.             
           05  PV-DEPT-NBR-NAME.                                                
               10  PV-DEPT-NBR            PIC  X(03)     VALUE SPACES.          
               10  FILLER                 PIC  X         VALUE '-'.             
               10  PV-DEPT-NAME           PIC  X(20)     VALUE SPACES.          
           05  PV-ACTL-INV-DTE.                                                 
               10  PV-ACTL-INV-DTE-CCYY   PIC  9(04).                           
               10  FILLER                 PIC  X.                               
               10  PV-ACTL-INV-DTE-MM     PIC  9(02).                           
               10  FILLER                 PIC  X.                               
               10  PV-ACTL-INV-DTE-DD     PIC  9(02).                           
S28545     05  PV-CURRENT-DATE.                                                 
S28545         10  PV-CURRENT-CC          PIC  9(02) VALUE 20.                  
S28545         10  PV-CURRENT-YY          PIC  9(02).                           
S28545         10  FILLER                 PIC  X     VALUE '-'.                 
S28545         10  PV-CURRENT-MM          PIC  9(02).                           
S28545         10  FILLER                 PIC  X     VALUE '-'.                 
S28545         10  PV-CURRENT-DD          PIC  9(02).                           
           05  PV-RPT-LVL                 PIC X(3)        VALUE SPACES.         
               88  PV-MAJ-CLASS                           VALUE 'MCL'.          
               88  PV-SCL-CLASS                           VALUE 'SCL'.          
               88  PV-DPT-CLASS                           VALUE 'DPT'.          
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-MAX-RETRIES              PIC S9(3)    VALUE +3.               
W33304     05  PC-CONSTANT-2               PIC S9(3)    VALUE +2.               
W33304     05  PC-CONSTANT-3               PIC S9(3)    VALUE +3.               
W33304     05  PC-CONSTANT-4               PIC S9(3)    VALUE +4.               
           05  PC-FUTURE-DATE              PIC  X(10)   VALUE                   
                                                           '9999-09-09'.        
RONNAM     05  PC-TABLE-MAX                PIC 9(04)    VALUE 9999.             
           05  PC-TOTAL-WORD               PIC X(10)    VALUE                   
               '  TOTAL  '.                                                     
           05  PC-DEPT                     PIC X(06)    VALUE                   
               'DEPT  '.                                                        
           05  PC-COMPANY-TOTAL            PIC X(17)    VALUE                   
               '  COMPANY TOTAL  '.                                             
           05  PC-DASH                     PIC X(01)    VALUE '-'.              
           05  PC-FINAL                    PIC X(08)    VALUE                   
               '   FINAL'.                                                      
21015      05  PC-CUM-PHYS-INV-SHORTAGE    PIC X(39)    VALUE                   
21015          'CUMULATIVE PHYSICAL INVENTORY SHORTAGE '.                       
21015      05  PC-CUM-EST-INV-SHORTAGE     PIC X(40)    VALUE                   
21015          'CUMULATIVE ESTIMATED INVENTORY SHORTAGE '.                      
           05  PC-MAX-DCS                  PIC 9(02)    VALUE 1.                
           05  PC-DEPARTMENT-LEVEL         PIC S9(04)   VALUE +1                
                                                        COMP SYNC.              
           05  PC-COMPANY-LEVEL-STORE-INDEX                                     
                                           PIC S9(04)   VALUE +2                
                                                        COMP SYNC.              
           05  PC-DC-LEVEL                 PIC S9(04)   VALUE +1                
                                                        COMP SYNC.              
           05  PC-COMPANY-LEVEL-TOTAL-INDEX                                     
                                           PIC S9(04)   VALUE +2                
                                                        COMP SYNC.              
      *                                                                         
      ******************************************************************        
      * SHORTAGE EXTRACT RECORD LAYOUT                                          
      ******************************************************************        
W20445     COPY INRD014.                                                        
      *                                                                         
      ******************************************************************        
      * STANDARD 150 COL HEADER                                                 
      ******************************************************************        
           COPY DPWS150O.                                                       
                                                                                
                                                                                
      ****************************************************************          
      *  ERROR MESSAGE AREA FOR DB2                                             
      ****************************************************************          
                                                                                
           COPY DPWS004.                                                        
                                                                                
                                                                                
      *                                                                         
      *  DCLGEN FOR THE DB2 DATE ATTRIBUTE TABLE                                
      *                                                                         
           EXEC SQL                                                             
               INCLUDE TDTATTR                                                  
           END-EXEC.                                                            
                                                                                
      *  DCLGEN FOR THE DB2 STORE TABLE                                         
      *                                                                         
           EXEC SQL                                                             
W26600         INCLUDE XMT00001                                                 
           END-EXEC.                                                            
28545                                                                           
28545 *****************************************************************         
28545 * TINCNTL DCLGEN                                                          
28545 *****************************************************************         
28545      EXEC SQL                                                             
28545          INCLUDE TINCNTL                                                  
28545      END-EXEC.                                                            
                                                                                
      *                                                                         
      *  DCLGEN FOR THE DB2 INVENTORY PARAMETERS TABLE                          
      *                                                                         
           EXEC SQL                                                             
               INCLUDE TINVPAR                                                  
           END-EXEC.                                                            
                                                                                
      *                                                                         
      *  COMMUNICATION AREAS FOR DB2                                            
      *                                                                         
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
      *                                                                         
      *  DB2 COMMUNICATION AREA 2                                               
      *                                                                         
           COPY SQLCA2.                                                         
                                                                                
      *                                                                         
      *  SQL DB2 STORE TABLE CURSOR DECLARATION                                 
      *                                                                         
           EXEC SQL                                                             
               DECLARE STORE_CURSOR CURSOR FOR                                  
W26600             SELECT LOC_NBR,                                              
W26600                    LOC_TYP_CDE,                                          
W26600                    LOC_10_ABBR_NM                                        
W26600             FROM XMT_LOC                                                 
W26600             WHERE (LOC_TYP_CDE = 'DS'  OR                                
W26600                    LOC_TYP_CDE= 'WH'  OR                                 
W26600                    LOC_TYP_CDE= 'DC'  OR                                 
W26600                    LOC_TYP_CDE= 'RV'  OR                                 
W26600                    LOC_TYP_CDE= 'CS'  OR                                 
W26600                    LOC_TYP_CDE= 'DA') AND                                
W26600                   (DATE (CURRENT TIMESTAMP) < FINCL_CLO_DTE              
W26600                      OR FINCL_CLO_DTE IS NULL)                           
W26600             ORDER BY LOC_NBR                                             
           END-EXEC.                                                            
                                                                                
       01  ABEND-CODE                      PIC S9(04)   VALUE ZERO              
                                                        COMP SYNC.              
                                                                                
       01  PA-PROGRAM-ACCUMULATORS                      COMP-3.                 
           05  PA-PAGE-NUMBER              PIC S9(05)   VALUE ZEROS.            
           05  PA-PERCENT                  PIC S9(03)V99 VALUE ZEROS.           
                                                                                
       01  CP-CONTROL-PRINT.                                                    
           05  CP-LINE-MAX                 PIC S9(02)   VALUE +60.              
           05  CP-LINE-COUNT               PIC S9(02)   VALUE ZEROS.            
           05  CP-ADVANCE-LINE-COUNT       PIC S9(02)   VALUE ZEROS.            
                                                                                
       01  CC-CONTROL-HEADER.                                                   
           05  CC-CONTROL-LITERAL          PIC X(09).                           
               88  CC-PHYSICAL-INV              VALUE 'PHYSICAL'.               
               88  CC-ESTIMATED-INV             VALUE 'ESTIMATED'.              
           05  FILLER                      PIC X(01).                           
           05  CC-MCL-SCLS-SW              PIC X(04).                           
               88  CC-DPT-INV                   VALUE 'DPT '.                   
      *                                                                         
      ******************************************************************        
      * HEADING LINES                                                           
      ******************************************************************        
       01  H4-HEADING4.                                                         
21015      05  H4-REPORT-DESC-AREA.                                             
21015          10  FILLER                  PIC X(40)    VALUE SPACES.           
21015          10  H4-REPORT-DESC-1        PIC X(39)    VALUE SPACES.           
21015      05  FILLER REDEFINES H4-REPORT-DESC-AREA.                            
21015          10  FILLER                  PIC X(39).                           
21015          10  H4-REPORT-DESC-2        PIC X(40).                           
           05  FILLER                      PIC X(15)    VALUE                   
               'REPORT THROUGH '.                                               
           05  H4-MONTH-NAME               PIC X(09)    VALUE SPACE.            
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  H4-DD                       PIC 9(02).                           
           05  FILLER                      PIC X        VALUE SPACE.            
           05  H4-CCYY                     PIC 9(4).                            
           05  FILLER                      PIC X(5)     VALUE SPACE.            
      *                                                                         
      ******************************************************************        
      ** HEADING LINES - FOR INVENTORY TYPE - 'PHYSICAL' OR 'ESTIMATED'         
      ******************************************************************        
W33304 01  H4-HEADING-TYPE1.                                                    
W33304     05  FILLER                      PIC X(06)    VALUE 'CYCLE '.         
W33304     05  H4-CYCLE-NO                 PIC 9(05)    VALUE ZEROES.           
W33304     05  FILLER                      PIC X(27)    VALUE SPACE.            
W33304     05  FILLER                      PIC X(17)    VALUE                   
W33304     'FOR STORES DOING '.                                                 
W33304     05  H4-INV-TYPE                 PIC X(09)    VALUE SPACE.            
W33304     05  FILLER                      PIC X(13)    VALUE                   
W33304     ' INVENTORY , '.                                                     
W33304     05  H4-CYCLE-NAME               PIC X(20)    VALUE SPACE.            
W33304     05  FILLER                      PIC X(48)    VALUE SPACE.            
W33304                                                                          
W33304 01  H4-HEADING-TYPE2.                                                    
W33304     05  FILLER                      PIC X(06)    VALUE 'MONTH '.         
W33304     05  H4-MONTH-NAM                PIC X(03)    VALUE SPACE.            
W33304     05  FILLER                      PIC X(29)    VALUE SPACE.            
W33304     05  FILLER                      PIC X(17)    VALUE                   
W33304     'FOR STORES DOING '.                                                 
W33304     05  H4-INV-TYPE1                PIC X(09)    VALUE SPACE.            
W33304     05  FILLER                      PIC X(13)    VALUE                   
W33304     ' INVENTORY , '.                                                     
W33304     05  H4-MONTH-NUM                PIC 9(02)    VALUE ZEROES.           
W33304     05  FILLER                      PIC X(01)    VALUE '-'.              
W33304     05  H4-MONTH-NAME2              PIC X(09)    VALUE SPACE.            
W33304     05  FILLER                      PIC X(57)    VALUE SPACE.            
W33304                                                                          
W33304 01  H4-HEADING-TYPE3.                                                    
W33304     05  FILLER                      PIC X(06)    VALUE 'CYCLE '.         
W33304     05  FILLER                      PIC X(05)    VALUE '99999'.          
W33304     05  FILLER                      PIC X(27)    VALUE SPACE.            
W33304     05  FILLER                      PIC X(17)    VALUE                   
W33304     'FOR STORES DOING '.                                                 
W33304     05  H4-INV-TYPE2                PIC X(09)    VALUE SPACE.            
W33304     05  FILLER                      PIC X(13)    VALUE                   
W33304     ' INVENTORY , '.                                                     
W33304     05  FILLER                      PIC X(20)    VALUE                   
W33304     'GRAND TOTAL         '.                                              
W33304     05  FILLER                      PIC X(48)    VALUE SPACE.            
W33304                                                                          
W33304 01  H4-HEADING-TYPE.                                                     
W33304     05  FILLER                      PIC X(151)   VALUE SPACE.            
W33304                                                                          
       01  H5-HEADING5.                                                         
           05  FILLER                      PIC X(09)    VALUE                   
           'DIVISION'.                                                          
           05  H5-DIV-NO                   PIC X(02)    VALUE SPACE.            
           05  FILLER                      PIC X(44)    VALUE SPACE.            
           05  FILLER                      PIC X(21)    VALUE SPACE.            
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  FILLER                      PIC X(02)    VALUE SPACE.            
           05  FILLER                      PIC X(54)    VALUE SPACE.            
      *                                                                         
       01  H6-HEADING6.                                                         
           05  H6-BUYER-NO                 PIC X(03)    VALUE SPACE.            
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  H6-BUYER-NAME               PIC X(30)    VALUE SPACE.            
                                                                                
       01  H7-HEADING7.                                                         
           05  FILLER                      PIC X(31)    VALUE SPACE.            
           05  FILLER                      PIC X(04)    VALUE 'BOOK'.           
           05  FILLER                      PIC X(11)    VALUE SPACE.            
           05  FILLER                      PIC X(04)    VALUE 'BASE'.           
           05  FILLER                      PIC X(10)    VALUE SPACE.            
           05  FILLER                      PIC X(09)    VALUE                   
           'SHRINKAGE'.                                                         
           05  FILLER                      PIC X(07)    VALUE SPACE.            
           05  FILLER                      PIC X(09)    VALUE                   
           'ESTIMATED'.                                                         
           05  FILLER                      PIC X(11)    VALUE SPACE.            
           05  FILLER                      PIC X(05)    VALUE                   
           'TOTAL'.                                                             
           05  FILLER                      PIC X(08)    VALUE SPACE.            
           05  FILLER                      PIC X(09)    VALUE                   
           'PHY. INV.'.                                                         
           05  FILLER                      PIC X(08)    VALUE SPACE.            
           05  FILLER                      PIC X(08)    VALUE                   
           'SHORTAGE'.                                                          
                                                                                
       01  H8-HEADING8.                                                         
           05  FILLER                      PIC X(28)    VALUE SPACE.            
           05  FILLER                      PIC X(11)    VALUE                   
           'INVENTORY'.                                                         
           05  FILLER                      PIC X(07)    VALUE SPACE.            
           05  FILLER                      PIC X(07)    VALUE                   
           'SALES'.                                                             
           05  FILLER                      PIC X(07)    VALUE SPACE.            
           05  FILLER                      PIC X(09)    VALUE                   
           'ALLOWANCE'.                                                         
           05  FILLER                      PIC X(08)    VALUE SPACE.            
           05  FILLER                      PIC X(07)    VALUE                   
           'INV ADJ'.                                                           
           05  FILLER                      PIC X(11)    VALUE SPACE.            
           05  FILLER                      PIC X(06)    VALUE                   
           'RETAIL'.                                                            
           05  FILLER                      PIC X(09)    VALUE SPACE.            
           05  FILLER                      PIC X(06)    VALUE                   
           'RETAIL'.                                                            
           05  FILLER                      PIC X(10)    VALUE SPACE.            
           05  FILLER                      PIC X(07)    VALUE                   
           'RETAIL'.                                                            
           05  FILLER                      PIC X(06)    VALUE SPACE.            
           05  FILLER                      PIC X(01)    VALUE '%'.              
                                                                                
       01  DL-DESCRIPTION-LINE.                                                 
           05  DL-TYPE-HOLD                PIC X(6)     VALUE SPACE.            
           05  DL-TYPE-VALUE.                                                   
               10  DL-DEPT-VALUE           PIC X(3)     VALUE ZEROS.            
               10  DL-DASH-HOLD            PIC X(01)    VALUE SPACE.            
               10  DL-CLASS-VALUE          PIC X(2)     VALUE ZEROS.            
           05  FILLER                      PIC X(04)    VALUE SPACE.            
           05  DL-TYPE-NAME                PIC X(20)    VALUE SPACE.            
           05  FILLER                      PIC X(96)    VALUE SPACE.            
                                                                                
       01  DL-DETAIL-LINE.                                                      
           05  DL-STORE.                                                        
               10  FILLER                  PIC X(01)    VALUE SPACE.            
W26600         10  DL-STORE-NBR            PIC 9(05)    VALUE ZEROS.            
               10  FILLER                  PIC X(01)    VALUE SPACE.            
               10  DL-STORE-NAME           PIC X(10)    VALUE SPACE.            
W26600         10  FILLER                  PIC X(07)    VALUE SPACE.            
           05  FILLER REDEFINES DL-STORE.                                       
               10 DL-TOTAL-DESCRIPTION     PIC X(24).                           
           05  DL-BOOK-RETAIL              PIC ZZ,ZZZ,ZZZ,ZZZ-                  
                                                        VALUE ZEROS.            
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  DL-BASE-SALES               PIC ZZ,ZZZ,ZZZ,ZZZ-                  
                                                        VALUE ZEROS.            
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  DL-SHRINK                   PIC ZZ,ZZZ,ZZZ,ZZZ-                  
                                                        VALUE ZEROS.            
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  DL-EST-INV-ADJ              PIC ZZ,ZZZ,ZZZ,ZZZ-                  
                                                        VALUE ZEROS.            
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  DL-TOTAL-BOOK               PIC ZZ,ZZZ,ZZZ,ZZZ-                  
                                                        VALUE ZEROS.            
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  DL-PHY-RETAIL               PIC ZZ,ZZZ,ZZZ,ZZZ-                  
                                                        VALUE ZEROS.            
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  DL-SHORT-RET                PIC ZZ,ZZZ,ZZZ,ZZZ-                  
                                                        VALUE ZEROS.            
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  DL-SHORT-PER                PIC ZZ9.99-  VALUE ZEROS.            
                                                                                
       01  TOTAL-CONSTANT-LINE.                                                 
           05  FILLER                      PIC X(05)    VALUE SPACE.            
           05  FILLER                      PIC X(19)    VALUE SPACE.            
           05  FILLER                      PIC X(15)    VALUE ALL '-'.          
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  FILLER                      PIC X(15)    VALUE ALL '-'.          
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  FILLER                      PIC X(15)    VALUE ALL '-'.          
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  FILLER                      PIC X(15)    VALUE ALL '-'.          
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  FILLER                      PIC X(15)    VALUE ALL '-'.          
           05  FILLER                      PIC X        VALUE SPACE.            
           05  FILLER                      PIC X(15)    VALUE ALL '-'.          
           05  FILLER                      PIC X        VALUE SPACE.            
           05  FILLER                      PIC X(15)    VALUE ALL '-'.          
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  FILLER                      PIC X(05)    VALUE ALL '-'.          
                                                                                
       01  TOTAL-LABEL-LINE.                                                    
           05  TL-TOTAL-HOLD               PIC X(08)    VALUE SPACE.            
           05  FILLER                      PIC X(01)    VALUE SPACE.            
           05  TL-TYPE-VALUE               PIC X(3)     VALUE ZEROS.            
           05  FILLER                      PIC X(07)    VALUE                   
           '  TOTAL'.                                                           
           05  FILLER                      PIC X(118)   VALUE SPACE.            
                                                                                
       01  IW-INTERMEDIATE-WORKAREAS.                                           
           05  IW-DATE.                                                         
               10  IW-YEAR                 PIC X(02)    VALUE SPACE.            
               10  IW-MONTH                PIC X(02)    VALUE SPACE.            
               10  IW-DAY                  PIC X(02)    VALUE SPACE.            
           05  IW-TIME.                                                         
               10  IW-HOUR                 PIC X(02)    VALUE SPACE.            
               10  IW-MINUTE               PIC X(02)    VALUE SPACE.            
               10  FILLER                  PIC X(02)    VALUE SPACE.            
               10  FILLER                  PIC X(02)    VALUE SPACE.            
                                                                                
       01  SA-SAVE-AREAS.                                                       
W33304     05  SA-INV-ID                   PIC S9(9) COMP VALUE ZERO.           
W33304     05  SA-FSCL-MN-DATE             PIC X(10)    VALUE SPACES.           
           05  SA-GMA-NUMBER               PIC X(02)    VALUE SPACE.            
           05  SA-DIVISION-NUMBER          PIC X(02)    VALUE SPACE.            
           05  SA-DEPT-CLASS-NUMBER        PIC X(05)    VALUE SPACE.            
           05  FILLER REDEFINES SA-DEPT-CLASS-NUMBER.                           
               10  SA-DEPT-NUMBER          PIC X(03).                           
               10  SA-CLASS-NUMBER         PIC X(02).                           
           05  SA-PRINT-DEPT-DESC          PIC X(20)    VALUE SPACE.            
           05  SA-PERCENT                  PIC 9(03)V99 VALUE ZEROS.            
           05  SA-PRINT-LINE               PIC X(150)   VALUE SPACE.            
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-FIND-MONTH               PIC X(01)    VALUE 'N'.              
               88  PS-MONTH-FOUND                       VALUE 'Y'.              
           05  PS-STORE-MATCH              PIC X(01)    VALUE 'N'.              
               88  PS-STORE-MATCHED                     VALUE 'Y'.              
           05  PS-PRINT-DEPT-HEADER        PIC X(01)    VALUE 'Y'.              
               88  PS-NEED-DEPT-HEADER                  VALUE 'Y'.              
           05  PS-PRINT-LABEL              PIC X(01)    VALUE 'N'.              
               88  PS-NO-LABEL-PRINTED                  VALUE 'N'.              
               88  PS-NEED-LABEL-PRINT                  VALUE 'Y'.              
           05  PS-NEW-PAGE                 PIC X(01)    VALUE 'N'.              
               88  PS-PAGE-BREAK                        VALUE 'Y'.              
           05  PS-END-OF-EXTRACT-FILE      PIC X(01)    VALUE 'N'.              
               88  PS-END-OF-EXTRACT                    VALUE 'Y'.              
               88  PS-NOT-END-OF-EXTRACT                VALUE 'N'.              
W33304     05  PS-PAGE-BREAK-SWITCH        PIC X(01)    VALUE 'N'.              
W33304         88  PS-PAGE-BREAK-YES                    VALUE 'Y'.              
W33304         88  PS-PAGE-BREAK-NO                     VALUE 'N'.              
                                                                                
       01  DS-DC-SUB                       PIC S9(04)   VALUE +0                
                                                        COMP SYNC.              
                                                                        05900606
       01  SV-STORE-NBR.                                                02730000
W26600     05  SV-STORE-NBR-NUM             PIC 9(05).                  02730000
                                                                        02730000
       01  SV-STORE-NBR-XXX.                                            02730000
W26600     05  SV-STORE-NBR-2-4             PIC  9(5).                  02730000
                                                                                
W33304* THE FOURTH INDEX IS THE GRAND TOTAL.                                    
W33304* THE THIRD INDEX IS THE MONTHLY TOTAL.                                   
       01  TT-TOTAL-TABLE.                                                      
W33304     05  TT-TOTAL-ENTRY              OCCURS 4 TIMES                       
                                           INDEXED BY TT-TOTAL-INDEX.           
W26600         10  TT-BOOK-INVENTORY       PIC S9(13)V99                        
                                           COMP-3.                              
W26600         10  TT-SHRINK-ALLOWANCE     PIC S9(13)V99                        
                                           COMP-3.                              
W26600         10  TT-TOTAL-RETAIL         PIC S9(13)V99                        
                                           COMP-3.                              
W26600         10  TT-PHY-INV-RETAIL       PIC S9(13)V99                        
                                           COMP-3.                              
W26600         10  TT-SHORT-RETAIL         PIC S9(13)V99                        
                                           COMP-3.                              
W26600         10  TT-TOTAL-SALES          PIC S9(13)V99                        
                                           COMP-3.                              
W26600         10  TT-EST-INV-ADJ          PIC S9(13)V99                        
                                           COMP-3.                              
                                                                                
       01  ST-STORE-TOTAL-TABLE.                                                
W26600     05  ST-STORE-ENTRY              OCCURS 9999 TIMES                    
                                           INDEXED BY ST-STORE-INDEX.           
               10  ST-STORE-NUMBER         PIC S9(04) COMP.                     
               10  ST-PRINT-STORE-IND      PIC X.                               
                   88  ST-PRINT-STORE                         VALUE 'Y'.        
                   88  ST-DONT-PRINT-STORE                    VALUE 'N'.        
               10  ST-STORE-NAME           PIC X(10).                           
               10  ST-LEVEL-ENTRY          OCCURS 5 TIMES                       
                                           INDEXED BY ST-LEVEL-INDEX.           
W26600             15  ST-BOOK-INVENTORY   PIC S9(13)V99                        
                                           COMP-3.                              
W26600             15  ST-SHRINK-ALLOWANCE PIC S9(13)V99                        
                                           COMP-3.                              
W26600             15  ST-TOTAL-RETAIL     PIC S9(13)V99                        
                                           COMP-3.                              
W26600             15  ST-PHY-INV-RETAIL   PIC S9(13)V99                        
                                           COMP-3.                              
W26600             15  ST-SHORT-RETAIL     PIC S9(13)V99                        
                                           COMP-3.                              
W26600             15  ST-TOTAL-SALES      PIC S9(13)V99                        
                                           COMP-3.                              
W26600             15  ST-EST-INV-ADJ      PIC S9(13)V99                        
                                           COMP-3.                              
      *                                                                         
      ******************************************************************        
       PROCEDURE DIVISION.                                                      
      *                                                                         
      ******************************************************************        
      * A100-MAIN-MODULE - HIGHEST LEVEL CONTROL MODULE                *        
      ******************************************************************        
       A100-MAIN-MODULE.                                                        
           ACCEPT IW-DATE FROM DATE.                                            
           ACCEPT IW-TIME FROM TIME.                                            
           PERFORM B100-OPEN-FILES.                                             
           PERFORM B200-INITIALIZE-DUTIES.                                      
           INITIALIZE ST-STORE-TOTAL-TABLE                                      
                      TT-TOTAL-TABLE.                                           
           SET ST-STORE-INDEX TO 1.                                             
           PERFORM B300-LOAD-STORE-ENTRIES.                                     
           PERFORM Z100-READ-EXTRACT-FILE.                                      
           IF PS-END-OF-EXTRACT                                                 
               CONTINUE                                                         
           ELSE                                                                 
W33304         PERFORM C100-FIND-HEADING-MONTH                                  
W33304         PERFORM C150-FIND-HEADING-CYCLE                                  
               MOVE IN014-GMA-NBR            TO SA-DIVISION-NUMBER              
               MOVE IN014-GMA-NBR            TO SA-GMA-NUMBER                   
               MOVE IN014-RPT-CL-NBR         TO SA-CLASS-NUMBER                 
               MOVE IN014-DEPT-NBR           TO SA-DEPT-NUMBER                  
               MOVE IN014-DEPT-MDSEAR-DESC   TO SA-PRINT-DEPT-DESC              
W33304         MOVE IN014-INV-ID             TO SA-INV-ID                       
W33304         MOVE IN014-OPN-FSCL-MN-DTE    TO SA-FSCL-MN-DATE                 
           END-IF.                                                              
                                                                                
           PERFORM B400-CREATE-SHORTAGE-REPORT                                  
               UNTIL PS-END-OF-EXTRACT.                                         
                                                                                
W33304         SET ST-LEVEL-INDEX TO PC-DEPARTMENT-LEVEL.                       
W33304         SET TT-TOTAL-INDEX TO PC-DEPARTMENT-LEVEL.                       
W33304         PERFORM C300-ACCUM-AND-PRODUCE-REPORT.                           
W33304         SET TT-TOTAL-INDEX TO PC-CONSTANT-2.                             
W33304         PERFORM D250-REPORT-TOTAL-LINE.                                  
W33304         PERFORM D300-INIT-TOTALS.                                        
W33304         SET TT-TOTAL-INDEX TO PC-CONSTANT-3.                             
W33304         PERFORM D250-REPORT-TOTAL-LINE.                                  
W33304         PERFORM D300-INIT-TOTALS.                                        
W33304         IF CC-PHYSICAL-INV                                               
W33304            SET TT-TOTAL-INDEX TO PC-CONSTANT-4                           
W33304            PERFORM D250-REPORT-TOTAL-LINE                                
W33304         END-IF.                                                          
W33304                                                                          
           PERFORM B600-CLOSE-FILES.                                            
           STOP RUN.                                                            
      *                                                                         
      ******************************************************************        
      * B100-OPEN-FILES - OPENS FILES                                           
      ******************************************************************        
       B100-OPEN-FILES.                                                         
           OPEN  INPUT EXTRACT-FILE                                             
                       CONTROL-FILE                                             
                OUTPUT SHORTAGE-REPORT.                                         
      *                                                                         
      ******************************************************************        
      * B200-INITIALIZE-DUTIES - PERFORM ONE TIME HEADING FUNCTIONS.            
      ******************************************************************        
       B200-INITIALIZE-DUTIES.                                                  
           MOVE IW-MONTH    TO DP150O-RUN-MONTH.                                
           MOVE IW-DAY      TO DP150O-RUN-DAY.                                  
           MOVE IW-YEAR     TO DP150O-RUN-YEAR.                                 
           MOVE IW-HOUR     TO DP150O-RUN-HOUR.                                 
           MOVE IW-MINUTE   TO DP150O-RUN-MINUTE.                               
           MOVE 'INKRP187'  TO DP150O-PROGRAM-NAME.                             
                                                                                
           PERFORM C050-GET-LAST-INV-DATE.                                      
           IF PV-NULL = -1                                                      
S28545         MOVE IW-YEAR  TO PV-CURRENT-YY                                   
S28545         MOVE IW-MONTH TO PV-CURRENT-MM                                   
S28545         MOVE IW-DAY   TO PV-CURRENT-DD                                   
S28545         MOVE PV-CURRENT-DATE TO PV-ACTL-INV-DTE                          
S28545                                 INVPAR-ACTL-INV-DTE                      
S28545*        MOVE ZERO TO PV-ACTL-INV-DTE-CCYY                                
S28545*                     PV-ACTL-INV-DTE-MM                                  
S28545*                     PV-ACTL-INV-DTE-DD                                  
           ELSE                                                                 
               MOVE INVPAR-ACTL-INV-DTE TO PV-ACTL-INV-DTE                      
           END-IF.                                                              
                                                                                
W33304     MOVE INVPAR-ACTL-INV-DTE  TO IN014-OPN-FSCL-MN-DTE.                  
           PERFORM C100-FIND-HEADING-MONTH                                      
           MOVE PV-ACTL-INV-DTE-DD   TO H4-DD.                                  
           MOVE PV-ACTL-INV-DTE-CCYY TO H4-CCYY.                                
                                                                                
           PERFORM C200-FIX-TYPE-HEADING.                                       
                                                                                
21015      MOVE SPACES TO H4-REPORT-DESC-AREA.                                  
           IF CC-PHYSICAL-INV                                                   
               MOVE 1      TO DP150O-REPORT-NUMBER                              
21015          MOVE PC-CUM-PHYS-INV-SHORTAGE                                    
21015              TO H4-REPORT-DESC-1                                          
           ELSE                                                                 
               MOVE 2      TO DP150O-REPORT-NUMBER                              
21015          MOVE PC-CUM-EST-INV-SHORTAGE                                     
21015              TO H4-REPORT-DESC-2                                          
           END-IF.                                                              
                                                                                
           IF CC-DPT-INV                                                        
               CONTINUE                                                         
           ELSE                                                                 
               DISPLAY '** ABEND - INKRP187 **'                                 
               DISPLAY '** CONTROL CARD OPTION ERROR'                           
               MOVE 'B200-INITIALIZE-DUTIES' TO PV-PARAGRAPH-NAME               
               MOVE +0999 TO ABEND-CODE                                         
               CALL 'ILBOABN0' USING ABEND-CODE                                 
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * B300-LOAD-STORE-ENTRIES - CONTROL FOR LOADING STORES           *        
      ******************************************************************        
       B300-LOAD-STORE-ENTRIES.                                                 
W26600     INITIALIZE DCLXMT00001.                                              
                                                                                
           EXEC SQL                                                             
               OPEN STORE_CURSOR                                                
           END-EXEC.                                                            
                                                                                
           IF SQLCODE < ZERO                                                    
               DISPLAY '** ABEND - INKRP187 **'                                 
               DISPLAY '** OPEN ERROR ON STORE TABLE'                           
               MOVE 'B300-LOAD-STORE-ENTRIES' TO PV-PARAGRAPH-NAME              
               GO TO Z900-SQL-ERROR                                             
           ELSE                                                                 
               IF ((SQLCODE > 0 ) AND (SQLCODE NOT = 100)) OR                   
                         (SQLWARN0 = 'W')                                       
                     DISPLAY '** ABEND - INKRP187 **'                           
                     DISPLAY '** OPEN WARNING ON STORE TABLE'                   
                    MOVE 'B300-LOAD-STORE-ENTRIES' TO PV-PARAGRAPH-NAME         
                     GO TO Z900-SQL-ERROR                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
           PERFORM B325-FETCH-STORE-TABLE.                                      
           PERFORM                                                              
               UNTIL SQLCODE = +100                                             
               IF ST-STORE-INDEX IS LESS THAN PC-TABLE-MAX                      
                   PERFORM B350-LOAD-STORES                                     
                   SET ST-STORE-INDEX UP BY 1                                   
               ELSE                                                             
                   DISPLAY '** ABEND **'                                        
                   DISPLAY '** PGM = INKRP187 **'                               
                   DISPLAY '** STORE TABLE IS TOO SMALL'                        
                   DISPLAY '** INCREASE STORE TABLE SIZE'                       
                   MOVE +4004 TO ABEND-CODE                                     
                   CALL 'ILBOABN0' USING ABEND-CODE                             
               END-IF                                                           
           END-PERFORM.                                                         
                                                                                
           EXEC SQL                                                             
               CLOSE STORE_CURSOR                                               
           END-EXEC.                                                            
                                                                                
           IF SQLCODE < ZERO                                                    
               DISPLAY '** ABEND - INKRP187 **'                                 
               DISPLAY '** CLOSE ERROR ON STORE TABLE'                          
               MOVE 'B300-LOAD-STORE-ENTRIES' TO PV-PARAGRAPH-NAME              
               GO TO Z900-SQL-ERROR                                             
           ELSE                                                                 
               IF ((SQLCODE > 0 ) AND (SQLCODE NOT = 100)) OR                   
                         (SQLWARN0 = 'W')                                       
                     DISPLAY '** ABEND - INKRP187 **'                           
                     DISPLAY '** CLOSE WARNING ON STORE TABLE'                  
                    MOVE 'B300-LOAD-STORE-ENTRIES' TO PV-PARAGRAPH-NAME         
                     GO TO Z900-SQL-ERROR                                       
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
      *****************************************************************         
      * B325-FETCH-STORE-TABLE - FETCH THE DB2 STORE TABEL INTO THE   *         
      * DCLGEN                                                        *         
      *****************************************************************         
       B325-FETCH-STORE-TABLE.                                                  
           EXEC SQL                                                             
               FETCH STORE_CURSOR                                               
W26600         INTO   :XMT00001-LOC-NBR,                                        
W26600                :XMT00001-LOC-TYP-CDE,                                    
W26600                :XMT00001-LOC-10-ABBR-NM                                  
           END-EXEC.                                                            
                                                                                
           IF SQLCODE < ZERO                                                    
               DISPLAY '** ABEND - INKRP187 **'                                 
               DISPLAY '** FETCH ERROR ON STORE TABLE'                          
               MOVE 'B325-FETCH-STORE-TABLE' TO PV-PARAGRAPH-NAME               
               GO TO Z900-SQL-ERROR                                             
           ELSE                                                                 
               IF ((SQLCODE > 0 ) AND (SQLCODE NOT = 100)) OR                   
                         (SQLWARN0 = 'W')                                       
                     DISPLAY '** ABEND - INKRP187 **'                           
                     DISPLAY '** FETCH WARNING ON STORE TABLE'                  
                     MOVE 'B325-FETCH-STORE-TABLE' TO PV-PARAGRAPH-NAME         
                     GO TO Z900-SQL-ERROR                                       
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
      *****************************************************************         
      * B350-LOAD-STORES - MOVES DB2 STORE INFORMATION INTO A WORKING *         
      * STORAGE TABLE                                                 *         
      *****************************************************************         
       B350-LOAD-STORES.                                                        
W26600     MOVE XMT00001-LOC-NBR                                                
               TO ST-STORE-NUMBER (ST-STORE-INDEX)                              
W26600     MOVE XMT00001-LOC-10-ABBR-NM                                         
               TO ST-STORE-NAME (ST-STORE-INDEX)                                
           SET ST-DONT-PRINT-STORE (ST-STORE-INDEX) TO TRUE.                    
           PERFORM B325-FETCH-STORE-TABLE.                                      
      *                                                                         
      ******************************************************************        
      * B400-CREATE-SHORTAGE-REPORT    - THIS MODULE CHECKS FOR A      *        
      *  CHANGE IN CLASS, DEPARTMENT, BUYER OR DIVISION.  IT THEN PRO- *        
      *  CESSES THE PREVIOUS CHANGE AND ACCUMULATES THE RECORD THAT    *        
      *  CAUSED THE BREAK                                              *        
      ******************************************************************        
       B400-CREATE-SHORTAGE-REPORT.                                             
W33304     IF  ((IN014-DEPT-NBR NOT = SA-DEPT-NUMBER)                           
W33304         OR (IN014-OPN-FSCL-MN-DTE NOT = SA-FSCL-MN-DATE)                 
W33304         OR (IN014-INV-ID NOT = SA-INV-ID))                               
               SET ST-LEVEL-INDEX TO PC-DEPARTMENT-LEVEL                        
W33304         SET TT-TOTAL-INDEX TO PC-DEPARTMENT-LEVEL                        
               PERFORM C300-ACCUM-AND-PRODUCE-REPORT                            
           END-IF.                                                              
                                                                                
W33304     IF  ((IN014-INV-ID NOT = SA-INV-ID)                                  
W33304         OR (IN014-OPN-FSCL-MN-DTE NOT = SA-FSCL-MN-DATE))                
W33304         SET TT-TOTAL-INDEX TO PC-CONSTANT-2                              
W33304         PERFORM D250-REPORT-TOTAL-LINE                                   
W33304         PERFORM D300-INIT-TOTALS                                         
W33304         IF  IN014-OPN-FSCL-MN-DTE NOT = SA-FSCL-MN-DATE                  
W33304            SET TT-TOTAL-INDEX TO PC-CONSTANT-3                           
W33304            PERFORM D250-REPORT-TOTAL-LINE                                
W33304            PERFORM D300-INIT-TOTALS                                      
W33304            PERFORM C100-FIND-HEADING-MONTH                               
W33304         END-IF                                                           
W33304         PERFORM C150-FIND-HEADING-CYCLE                                  
W33304     END-IF.                                                              
W33304                                                                          
           MOVE 'N' TO PS-STORE-MATCH.                                          
           PERFORM C400-ACCUM-STORE-TOTALS                                      
               VARYING ST-STORE-INDEX                                           
               FROM 1 BY 1                                                      
               UNTIL (PS-STORE-MATCHED OR                                       
                      ST-STORE-INDEX > PC-TABLE-MAX).                           
                                                                                
           MOVE IN014-GMA-NBR            TO SA-DIVISION-NUMBER.                 
           MOVE IN014-GMA-NBR            TO SA-GMA-NUMBER.                      
           MOVE IN014-RPT-CL-NBR         TO SA-CLASS-NUMBER.                    
           MOVE IN014-DEPT-NBR           TO SA-DEPT-NUMBER.                     
           MOVE IN014-DEPT-MDSEAR-DESC   TO SA-PRINT-DEPT-DESC.                 
W33304     MOVE IN014-INV-ID             TO SA-INV-ID.                          
W33304     MOVE IN014-OPN-FSCL-MN-DTE    TO SA-FSCL-MN-DATE.                    
                                                                                
           PERFORM Z100-READ-EXTRACT-FILE.                                      
      *                                                                         
      ******************************************************************        
      * B600-CLOSE-FILES - CLOSES FILES AND DOES STATUS CHECK                   
      ******************************************************************        
       B600-CLOSE-FILES.                                                        
           CLOSE EXTRACT-FILE                                                   
                 SHORTAGE-REPORT.                                               
      *                                                                         
      ******************************************************************        
      * C050-GET-LAST-INV-DATE. RETRIEVE THE MOST RECENT ACTUAL                 
      * INVENTORY DATE FROM THE INVENTORY PARAMETERS TABLE. IT WILL             
      * BE USED IN THE REPORT HEADING.                                          
      ******************************************************************        
       C050-GET-LAST-INV-DATE.                                                  
           INITIALIZE DCLTINVPAR.                                               
           PERFORM WITH TEST AFTER                                              
              VARYING PV-SQL-SUB FROM 1 BY 1                                    
              UNTIL PV-SQL-SUB > PC-MAX-RETRIES                                 
              OR    SQLCODE = 0                                                 
                                                                                
                   EXEC SQL                                                     
                       SELECT MAX (ACTL_INV_DTE)                                
                       INTO  :INVPAR-ACTL-INV-DTE :PV-NULL                      
28545                  FROM TINVPAR A                                           
28545                      ,TINCNTL B                                           
                       WHERE NOT ACTL_INV_DTE = :PC-FUTURE-DATE                 
28545                    AND A.INV_ID = B.INV_ID                                
28545                    AND B.ACTV_IND = 'Y'                                   
                   END-EXEC                                                     
                                                                                
                   EVALUATE TRUE                                                
                       WHEN SQLCODE = 0                                         
                       WHEN SQLCODE = +100                                      
                       WHEN SQLCODE = -911                                      
                       WHEN SQLCODE = -913                                      
                           CONTINUE                                             
                       WHEN SQLCODE < ZERO                                      
                           DISPLAY '** ABEND - INKRP187 **'                     
                           DISPLAY '** READ FOR TINVPAR'                        
                           MOVE 'C050-GET-LAST-INV-DATE'                        
                                TO PV-PARAGRAPH-NAME                            
                           MOVE 'SELECT ROW FROM TINVPAR'                       
                                       TO PV-DB2-OPER-ATTEMPTED                 
                           GO TO Z900-SQL-ERROR                                 
                       WHEN ((SQLCODE > 0 ) AND (SQLCODE NOT = 100)) OR         
                             (SQLWARN0 = 'W')                                   
                           DISPLAY '** ABEND - INKRP187 **'                     
                           DISPLAY '** READ FOR TINVPAR'                        
                           MOVE 'SELECT ROW FROM TINVPAR'                       
                                       TO PV-DB2-OPER-ATTEMPTED                 
                           MOVE 'C050-GET-LAST-INV-DATE'                        
                                TO PV-PARAGRAPH-NAME                            
                           GO TO Z900-SQL-ERROR                                 
                   END-EVALUATE                                                 
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               DISPLAY '** ABEND - INKRP187 **'                                 
               DISPLAY '** READ FOR TINVPAR'                                    
               DISPLAY '** READ RETRIES EXCEEDED'                               
               MOVE 'C050-GET-LAST-INV-DATE'                                    
                    TO PV-PARAGRAPH-NAME                                        
               MOVE 'SELECT ROW FROM TINVPAR'                                   
                    TO PV-DB2-OPER-ATTEMPTED                                    
               GO TO Z900-SQL-ERROR                                             
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * C100-FIND-HEADING-MONTH - FIND MONTH NAME IN TABLE             *        
      ******************************************************************        
                                                                                
       C100-FIND-HEADING-MONTH.                                                 
           EXEC SQL                                                             
                SELECT  FSCL_MN_NM                                              
W33304                 ,FSCL_MN_NBR                                             
                INTO   :DTATTR-FSCL-MN-NM                                       
W33304                ,:DTATTR-FSCL-MN-NBR                                      
                FROM    TDTATTR                                                 
W33304          WHERE KY_DTE = :IN014-OPN-FSCL-MN-DTE                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE        = +000                                       
W33304             MOVE DTATTR-FSCL-MN-NM TO H4-MONTH-NAME                      
W33304                                       H4-MONTH-NAME2                     
W33304                                       H4-MONTH-NAM                       
W33304             MOVE DTATTR-FSCL-MN-NBR TO H4-MONTH-NUM                      
               WHEN OTHER                                                       
W33304             DISPLAY 'IN014-OPN-FSCL-MN-DTE:  '                           
W33304                      IN014-OPN-FSCL-MN-DTE                               
                   MOVE    'C100-FIND-HEADING-MONTH'                            
                                            TO PV-PARAGRAPH-NAME                
                   MOVE    'SELECT ROW FROM TDTATTR'                            
                                       TO PV-DB2-OPER-ATTEMPTED                 
                   PERFORM Z900-SQL-ERROR                                       
           END-EVALUATE.                                                        
                                                                                
      *                                                                         
W33304******************************************************************        
W33304* C150-FIND-HEADING-CYCLE - FIND CYCLE NAME FOR THE INV ID       *        
W33304******************************************************************        
W33304                                                                          
W33304 C150-FIND-HEADING-CYCLE.                                                 
W33304     MOVE IN014-INV-ID TO H4-CYCLE-NO.                                    
W33304     INITIALIZE INCNTL-INV-NM-TEXT                                        
W33304                                                                          
W33304     EXEC SQL                                                             
W33304          SELECT  INV_NM                                                  
W33304          INTO   :INCNTL-INV-NM                                           
W33304          FROM    TINCNTL                                                 
W33304          WHERE INV_ID = :IN014-INV-ID                                    
W33304     END-EXEC.                                                            
W33304                                                                          
W33304     EVALUATE TRUE                                                        
W33304         WHEN SQLCODE        = +000                                       
W33304             MOVE INCNTL-INV-NM-TEXT TO H4-CYCLE-NAME                     
W33304         WHEN OTHER                                                       
W33304             DISPLAY 'INV-ID:  ' H4-CYCLE-NO                              
W33304             MOVE    'C150-FIND-HEADING-CYCLE'                            
W33304                                      TO PV-PARAGRAPH-NAME                
W33304             MOVE    'SELECT ROW FROM TINCNTL'                            
W33304                                 TO PV-DB2-OPER-ATTEMPTED                 
W33304             PERFORM Z900-SQL-ERROR                                       
W33304     END-EVALUATE.                                                        
W33304*                                                                         
      ******************************************************************        
      * C200-FIX-TYPE-HEADING  -                                       *        
      *    READ INP02 TO DETERMINE WHAT TYPE OF HEADING TO PRINT       *        
      ******************************************************************        
       C200-FIX-TYPE-HEADING.                                                   
      *                                                                         
           READ CONTROL-FILE INTO CC-CONTROL-HEADER.                            
      *                                                                         
W33304     MOVE CC-CONTROL-LITERAL TO H4-INV-TYPE                               
W33304                                H4-INV-TYPE1                              
W33304                                H4-INV-TYPE2.                             
      *                                                                         
      ******************************************************************        
      * C300-ACCUM-AND-PRODUCE-REPORT ACCUMULATE AND PRODUCE THE       *        
      * REPORT AT THE REQUESTED LEVEL AS SET BY ST-LEVEL-INDEX AND     *        
      * TT-TOTAL-INDEX.                                                *        
      ******************************************************************        
       C300-ACCUM-AND-PRODUCE-REPORT.                                           
W33304     IF  ((CP-LINE-COUNT = 0) OR (CP-LINE-COUNT >= CP-LINE-MAX)           
W33304         OR PS-PAGE-BREAK-YES)                                            
W33304         MOVE H4-HEADING-TYPE1   TO H4-HEADING-TYPE                       
               PERFORM Z200-PRODUCE-HEADINGS                                    
           END-IF.                                                              
                                                                                
           PERFORM D100-UNLOAD-STORE-TABLE                                      
               VARYING ST-STORE-INDEX                                           
               FROM 1 BY 1                                                      
               UNTIL (ST-STORE-NAME (ST-STORE-INDEX) = SPACES OR                
                      ST-STORE-INDEX > PC-TABLE-MAX).                           
                                                                                
           PERFORM D200-PRODUCE-TOTAL-LINE.                                     
           PERFORM D300-INIT-TOTALS.                                            
      *                                                                         
      ******************************************************************        
      * C400-ACCUM-STORE-TOTALS - ACCUMULATES STORE TOTALS AT THE      *        
      * MAJOR CLASS LEVEL                                              *        
      ******************************************************************        
       C400-ACCUM-STORE-TOTALS.                                                 
           SET ST-LEVEL-INDEX TO PC-DEPARTMENT-LEVEL.                           
                                                                                
           IF IN014-STR-NBR = ST-STORE-NUMBER (ST-STORE-INDEX)                  
               SET ST-PRINT-STORE (ST-STORE-INDEX) TO TRUE                      
               ADD IN014-BOOK-INV-RTL-AMT TO                                    
                   ST-BOOK-INVENTORY (ST-STORE-INDEX, ST-LEVEL-INDEX)           
               ADD IN014-SHNK-RTL-AMT TO                                        
                   ST-SHRINK-ALLOWANCE (ST-STORE-INDEX, ST-LEVEL-INDEX)         
               ADD IN014-TOTAL-BOOK-RTL-AMT TO                                  
                   ST-TOTAL-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)             
               ADD IN014-PHY-INV-RTL-AMT TO                                     
                   ST-PHY-INV-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)           
               ADD IN014-SHORTAGE-RTL-AMT TO                                    
                   ST-SHORT-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)             
               ADD IN014-SLS-BSE-RTL-AMT TO                                     
                   ST-TOTAL-SALES (ST-STORE-INDEX, ST-LEVEL-INDEX)              
               ADD IN014-ESTIMATED-INV-ADJ-AMT TO                               
                   ST-EST-INV-ADJ (ST-STORE-INDEX, ST-LEVEL-INDEX)              
               SET PS-STORE-MATCHED TO TRUE                                     
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * D100-UNLOAD-STORE-TABLE - UNLOADS AN OCCURANCE OF THE STORE    *        
      * TABLE IF THE FINANCE CORPORATION NUMBER IS EQUAL TO THE DC     *        
      * SUBSCRIPT.  THIS IS VIABLE BECAUSE THE FINANCE CORPORATION     *        
      * NUMBERS ARE 01 FOR KOHLS AND 02 FOR COLUMBUS.  A DETAIL LINE   *        
      * IS WRITTEN FOR EACH STORE                                      *        
      ******************************************************************        
       D100-UNLOAD-STORE-TABLE.                                                 
           IF  ST-PRINT-STORE (ST-STORE-INDEX)                                  
               MOVE ST-STORE-NUMBER (ST-STORE-INDEX)                            
                   TO SV-STORE-NBR-NUM                                          
               MOVE SV-STORE-NBR-NUM                                            
                   TO SV-STORE-NBR-2-4                                          
               MOVE SV-STORE-NBR-2-4                                            
                   TO DL-STORE-NBR                                              
               MOVE ST-STORE-NAME (ST-STORE-INDEX)                              
                   TO DL-STORE-NAME                                             
               MOVE ST-BOOK-INVENTORY (ST-STORE-INDEX, ST-LEVEL-INDEX)          
                   TO DL-BOOK-RETAIL                                            
               MOVE ST-TOTAL-SALES (ST-STORE-INDEX, ST-LEVEL-INDEX)             
                   TO DL-BASE-SALES                                             
               MOVE ST-SHRINK-ALLOWANCE (ST-STORE-INDEX, ST-LEVEL-INDEX)        
                   TO DL-SHRINK                                                 
               MOVE ST-EST-INV-ADJ (ST-STORE-INDEX, ST-LEVEL-INDEX)             
                   TO DL-EST-INV-ADJ                                            
               MOVE ST-TOTAL-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)            
                   TO DL-TOTAL-BOOK                                             
               MOVE ST-PHY-INV-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)          
                   TO DL-PHY-RETAIL                                             
               MOVE ST-SHORT-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)            
                   TO DL-SHORT-RET                                              
               COMPUTE PA-PERCENT ROUNDED =                                     
               (ST-SHORT-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX) * 100)         
                   / ST-TOTAL-SALES (ST-STORE-INDEX, ST-LEVEL-INDEX)            
                  ON SIZE ERROR MOVE 999.99 TO PA-PERCENT                       
               END-COMPUTE                                                      
SJ1001*                                                                         
SJ1001*        SHRINK PERCENT MUST BE SAME SIGN (+/-) AS SHORT-RETAIL           
SJ1001         IF ST-SHORT-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX) > 0          
SJ1001             IF PA-PERCENT < 0                                            
SJ1001                 COMPUTE PA-PERCENT = (PA-PERCENT * -1)                   
SJ1001             END-IF                                                       
SJ1001         ELSE                                                             
SJ1001            IF ST-SHORT-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)< 0        
SJ1001                IF PA-PERCENT > 0                                         
SJ1001                    COMPUTE PA-PERCENT = (PA-PERCENT * -1)                
SJ1001                END-IF                                                    
SJ1001            ELSE                                                          
SJ1001                MOVE ZERO TO PA-PERCENT                                   
SJ1001            END-IF                                                        
SJ1001         END-IF                                                           
SJ1001*                                                                         
               MOVE PA-PERCENT TO DL-SHORT-PER                                  
               PERFORM E200-ACCUM-TOTALS                                        
               PERFORM E300-INIT-STORE-ENTRIES                                  
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * D200-PRODUCE-TOTAL-LINE - PRODUCE A TOTAL LINE AT DC OR        *        
      * COMPANY LEVEL, DEPENDING UPON THE LEVEL AT WHICH THE TOTAL IN- *        
      * DEX HAS BEEN SET                                               *        
      ******************************************************************        
       D200-PRODUCE-TOTAL-LINE.                                                 
                                                                                
                                                                                
W33304     MOVE SA-DEPT-NUMBER     TO PV-DEPT-NBR.                              
W33304     MOVE SA-PRINT-DEPT-DESC TO PV-DEPT-NAME.                             
W33304     MOVE PV-DEPT-NBR-NAME   TO DL-TOTAL-DESCRIPTION.                     
W33304     MOVE H4-HEADING-TYPE1   TO H4-HEADING-TYPE.                          
                                                                                
           MOVE TT-BOOK-INVENTORY (TT-TOTAL-INDEX)                              
               TO DL-BOOK-RETAIL.                                               
           MOVE TT-TOTAL-SALES (TT-TOTAL-INDEX)                                 
               TO DL-BASE-SALES.                                                
           MOVE TT-SHRINK-ALLOWANCE (TT-TOTAL-INDEX)                            
               TO DL-SHRINK.                                                    
           MOVE TT-EST-INV-ADJ (TT-TOTAL-INDEX)                                 
               TO DL-EST-INV-ADJ                                                
           MOVE TT-TOTAL-RETAIL (TT-TOTAL-INDEX)                                
               TO DL-TOTAL-BOOK.                                                
           MOVE TT-PHY-INV-RETAIL (TT-TOTAL-INDEX)                              
               TO DL-PHY-RETAIL.                                                
           MOVE TT-SHORT-RETAIL (TT-TOTAL-INDEX)                                
               TO DL-SHORT-RET.                                                 
           COMPUTE PA-PERCENT ROUNDED =                                         
               (TT-SHORT-RETAIL (TT-TOTAL-INDEX) * 100)                         
                   / TT-TOTAL-SALES (TT-TOTAL-INDEX)                            
               ON SIZE ERROR MOVE 999.99 TO PA-PERCENT                          
           END-COMPUTE.                                                         
SJ1001*                                                                         
SJ1001*    SHRINK PERCENT MUST BE SAME SIGN (+/-) AS SHORT-RETAIL               
SJ1001     IF TT-SHORT-RETAIL (TT-TOTAL-INDEX) > 0                              
SJ1001         IF PA-PERCENT < 0                                                
SJ1001             COMPUTE PA-PERCENT = (PA-PERCENT * -1)                       
SJ1001         END-IF                                                           
SJ1001     ELSE                                                                 
SJ1001         IF TT-SHORT-RETAIL (TT-TOTAL-INDEX) < 0                          
SJ1001            IF PA-PERCENT > 0                                             
SJ1001                COMPUTE PA-PERCENT = (PA-PERCENT * -1)                    
SJ1001            END-IF                                                        
SJ1001         ELSE                                                             
SJ1001            MOVE ZERO TO PA-PERCENT                                       
SJ1001         END-IF                                                           
SJ1001     END-IF                                                               
SJ1001*                                                                         
           MOVE PA-PERCENT TO DL-SHORT-PER.                                     
           COMPUTE CP-ADVANCE-LINE-COUNT =                                      
               CP-LINE-COUNT + 3.                                               
W33304     IF ((CP-ADVANCE-LINE-COUNT > CP-LINE-MAX)                            
W33304          OR PS-PAGE-BREAK-YES)                                           
               PERFORM Z200-PRODUCE-HEADINGS                                    
           END-IF.                                                              
                                                                                
W33304     WRITE SHORTAGE-LINE                                                  
W33304        FROM DL-DETAIL-LINE                                               
W33304           AFTER ADVANCING 1 LINES.                                       
W33304     ADD 1 TO CP-LINE-COUNT.                                              
                                                                                
           MOVE SPACES TO DL-TOTAL-DESCRIPTION.                                 
      *                                                                         
W33304******************************************************************        
W33304* D250-REPORT-TOTAL-LINE - PRODUCE A TOTAL LINE AT CYCLE OR     *         
W33304* MONTH LEVEL, DEPENDING UPON THE LEVEL AT WHICH THE TOTAL INDEX *        
W33304* HAS BEEN SET                                                   *        
W33304******************************************************************        
W33304 D250-REPORT-TOTAL-LINE.                                                  
W33304                                                                          
W33304     EVALUATE TT-TOTAL-INDEX                                              
W33304         WHEN PC-CONSTANT-2                                               
W33304             MOVE H4-HEADING-TYPE1   TO H4-HEADING-TYPE                   
W33304             MOVE SA-INV-ID          TO PV-CYCLE-NBR                      
W33304             MOVE PV-CYCLE-TOTAL     TO DL-TOTAL-DESCRIPTION              
W33304         WHEN PC-CONSTANT-3                                               
W33304             MOVE H4-HEADING-TYPE2   TO H4-HEADING-TYPE                   
W33304             MOVE H4-MONTH-NAME2     TO PV-MONTH-NAME                     
W33304             MOVE PV-MONTH-TOTAL     TO DL-TOTAL-DESCRIPTION              
W33304         WHEN PC-CONSTANT-4                                               
W33304             MOVE H4-HEADING-TYPE3   TO H4-HEADING-TYPE                   
W33304             MOVE PV-GRAND-TOTAL     TO DL-TOTAL-DESCRIPTION              
W33304     END-EVALUATE.                                                        
W33304                                                                          
W33304     MOVE TT-BOOK-INVENTORY (TT-TOTAL-INDEX)                              
W33304         TO DL-BOOK-RETAIL.                                               
W33304     MOVE TT-TOTAL-SALES (TT-TOTAL-INDEX)                                 
W33304         TO DL-BASE-SALES.                                                
W33304     MOVE TT-SHRINK-ALLOWANCE (TT-TOTAL-INDEX)                            
W33304         TO DL-SHRINK.                                                    
W33304     MOVE TT-EST-INV-ADJ (TT-TOTAL-INDEX)                                 
W33304         TO DL-EST-INV-ADJ                                                
W33304     MOVE TT-TOTAL-RETAIL (TT-TOTAL-INDEX)                                
W33304         TO DL-TOTAL-BOOK.                                                
W33304     MOVE TT-PHY-INV-RETAIL (TT-TOTAL-INDEX)                              
W33304         TO DL-PHY-RETAIL.                                                
W33304     MOVE TT-SHORT-RETAIL (TT-TOTAL-INDEX)                                
W33304         TO DL-SHORT-RET.                                                 
W33304     COMPUTE PA-PERCENT ROUNDED =                                         
W33304         (TT-SHORT-RETAIL (TT-TOTAL-INDEX) * 100)                         
W33304             / TT-TOTAL-SALES (TT-TOTAL-INDEX)                            
W33304         ON SIZE ERROR MOVE 999.99 TO PA-PERCENT                          
W33304     END-COMPUTE.                                                         
W33304*                                                                         
W33304*    SHRINK PERCENT MUST BE SAME SIGN (+/-) AS SHORT-RETAIL               
W33304     IF TT-SHORT-RETAIL (TT-TOTAL-INDEX) > 0                              
W33304         IF PA-PERCENT < 0                                                
W33304             COMPUTE PA-PERCENT = (PA-PERCENT * -1)                       
W33304         END-IF                                                           
W33304     ELSE                                                                 
W33304         IF TT-SHORT-RETAIL (TT-TOTAL-INDEX) < 0                          
W33304            IF PA-PERCENT > 0                                             
W33304                COMPUTE PA-PERCENT = (PA-PERCENT * -1)                    
W33304            END-IF                                                        
W33304         ELSE                                                             
W33304            MOVE ZERO TO PA-PERCENT                                       
W33304         END-IF                                                           
W33304     END-IF                                                               
W33304*                                                                         
W33304     MOVE PA-PERCENT TO DL-SHORT-PER.                                     
W33304     COMPUTE CP-ADVANCE-LINE-COUNT =                                      
W33304         CP-LINE-COUNT + 3.                                               
W33304     IF  ((CP-ADVANCE-LINE-COUNT > CP-LINE-MAX)                           
W33304         OR (TT-TOTAL-INDEX = PC-CONSTANT-4)                              
W33304         OR (TT-TOTAL-INDEX = PC-CONSTANT-3) OR PS-PAGE-BREAK-YES)        
W33304         PERFORM Z200-PRODUCE-HEADINGS                                    
W33304     END-IF.                                                              
W33304                                                                          
W33304     IF TT-TOTAL-INDEX  < PC-CONSTANT-3                                   
W33304         WRITE SHORTAGE-LINE                                              
W33304             FROM TOTAL-CONSTANT-LINE                                     
W33304                AFTER ADVANCING 1 LINES                                   
W33304         WRITE SHORTAGE-LINE                                              
W33304             FROM DL-DETAIL-LINE                                          
W33304                AFTER ADVANCING 1 LINES                                   
W33304         SET PS-PAGE-BREAK-YES  TO TRUE                                   
W33304     ELSE                                                                 
W33304         WRITE SHORTAGE-LINE                                              
W33304             FROM TOTAL-CONSTANT-LINE                                     
W33304                AFTER ADVANCING 1 LINES                                   
W33304         WRITE SHORTAGE-LINE                                              
W33304             FROM DL-DETAIL-LINE                                          
W33304                AFTER ADVANCING 3 LINES                                   
W33304         SET PS-PAGE-BREAK-YES  TO TRUE                                   
W33304     END-IF.                                                              
W33304                                                                          
W33304     MOVE SPACES TO DL-TOTAL-DESCRIPTION.                                 
                                                                                
      ******************************************************************        
      * D300-INIT-TOTALS - INITIALIZE TOTALS BASED UPON THE OCCURANCE  *        
      * OF THE INDEX.                                                  *        
      ******************************************************************        
       D300-INIT-TOTALS.                                                        
           MOVE ZEROS                                                           
               TO TT-BOOK-INVENTORY (TT-TOTAL-INDEX)                            
                  TT-SHRINK-ALLOWANCE (TT-TOTAL-INDEX)                          
                  TT-EST-INV-ADJ (TT-TOTAL-INDEX)                               
                  TT-TOTAL-RETAIL (TT-TOTAL-INDEX)                              
                  TT-PHY-INV-RETAIL (TT-TOTAL-INDEX)                            
                  TT-SHORT-RETAIL (TT-TOTAL-INDEX)                              
                  TT-TOTAL-SALES (TT-TOTAL-INDEX).                              
      *                                                                         
      ******************************************************************        
      * E200-ACCUM-TOTALS - ADDS CURRENT BREAK LEVEL TO TOTAL          *        
      * ACCUMULATORS FOR DC AND COMPANY                                *        
      ******************************************************************        
       E200-ACCUM-TOTALS.                                                       
           ADD ST-BOOK-INVENTORY (ST-STORE-INDEX, ST-LEVEL-INDEX)               
               TO TT-BOOK-INVENTORY (1)                                         
W33304            TT-BOOK-INVENTORY (3)                                         
                  TT-BOOK-INVENTORY (2)                                         
W33304            TT-BOOK-INVENTORY (4).                                        
           ADD ST-TOTAL-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)                 
               TO TT-TOTAL-RETAIL (1)                                           
W33304            TT-TOTAL-RETAIL (3)                                           
                  TT-TOTAL-RETAIL (2)                                           
W33304            TT-TOTAL-RETAIL (4).                                          
           ADD ST-SHRINK-ALLOWANCE (ST-STORE-INDEX, ST-LEVEL-INDEX)             
               TO TT-SHRINK-ALLOWANCE(1)                                        
W33304            TT-SHRINK-ALLOWANCE (3)                                       
                  TT-SHRINK-ALLOWANCE(2)                                        
W33304            TT-SHRINK-ALLOWANCE (4).                                      
           ADD ST-EST-INV-ADJ (ST-STORE-INDEX, ST-LEVEL-INDEX)                  
               TO TT-EST-INV-ADJ (1)                                            
W33304            TT-EST-INV-ADJ (3)                                            
                  TT-EST-INV-ADJ (2)                                            
W33304            TT-EST-INV-ADJ (4).                                           
           ADD ST-TOTAL-SALES (ST-STORE-INDEX, ST-LEVEL-INDEX)                  
               TO TT-TOTAL-SALES (1)                                            
W33304            TT-TOTAL-SALES (3)                                            
                  TT-TOTAL-SALES(2)                                             
W33304            TT-TOTAL-SALES (4).                                           
           ADD ST-PHY-INV-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)               
               TO TT-PHY-INV-RETAIL (1)                                         
W33304            TT-PHY-INV-RETAIL (3)                                         
                  TT-PHY-INV-RETAIL(2)                                          
W33304            TT-PHY-INV-RETAIL (4).                                        
           ADD ST-SHORT-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)                 
               TO TT-SHORT-RETAIL (1)                                           
W33304            TT-SHORT-RETAIL (3)                                           
                  TT-SHORT-RETAIL (2)                                           
W33304            TT-SHORT-RETAIL (4).                                          
      *                                                                         
      ******************************************************************        
      * E300-INIT-STORE-ENTRIES -  INITIALIZES STORE ENTRIES BASED     *        
      * UPON THE CURRENT BREAK LEVEL                                   *        
      ******************************************************************        
       E300-INIT-STORE-ENTRIES.                                                 
           MOVE ZEROS                                                           
               TO ST-BOOK-INVENTORY (ST-STORE-INDEX, ST-LEVEL-INDEX)            
                  ST-SHRINK-ALLOWANCE (ST-STORE-INDEX, ST-LEVEL-INDEX)          
                  ST-EST-INV-ADJ (ST-STORE-INDEX, ST-LEVEL-INDEX)               
                  ST-TOTAL-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)              
                  ST-PHY-INV-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)            
                  ST-SHORT-RETAIL (ST-STORE-INDEX, ST-LEVEL-INDEX)              
                  ST-TOTAL-SALES (ST-STORE-INDEX, ST-LEVEL-INDEX).              
      *                                                                         
      ******************************************************************        
      * Z100-READ-EXTRACT-FILE - READS INPUT FILE                      *        
      ******************************************************************        
       Z100-READ-EXTRACT-FILE.                                                  
           READ EXTRACT-FILE                                                    
               INTO IN014-SHORTAGE-EXTR-REC                                     
                   AT END                                                       
                       SET PS-END-OF-EXTRACT TO TRUE                            
           END-READ.                                                            
                                                                                
      *                                                                         
      ******************************************************************        
      * Z200-PRODUCE-HEADINGS - PRODUCES REPORT HEADERS                *        
      ******************************************************************        
       Z200-PRODUCE-HEADINGS.                                                   
           INITIALIZE CP-LINE-COUNT.                                            
W33304     SET PS-PAGE-BREAK-NO TO TRUE.                                        
           ADD 1 TO PA-PAGE-NUMBER.                                             
           MOVE PA-PAGE-NUMBER TO DP150O-PAGE-NUMBER.                           
           WRITE SHORTAGE-LINE                                                  
               FROM DP150O-STANDRD-HEADER-150-COLS                              
                   AFTER ADVANCING PAGE.                                        
           MOVE SPACES TO DP150O-LASER-NEW-PAGE-INDICATR.                       
           WRITE SHORTAGE-LINE                                                  
               FROM H4-HEADING4                                                 
                   AFTER ADVANCING 2.                                           
                                                                                
           WRITE SHORTAGE-LINE                                                  
               FROM H4-HEADING-TYPE                                             
                   AFTER ADVANCING 1.                                           
                                                                                
           MOVE SPACES TO SHORTAGE-LINE.                                        
           WRITE SHORTAGE-LINE                                                  
               AFTER ADVANCING 1.                                               
                                                                                
           WRITE SHORTAGE-LINE                                                  
               FROM H7-HEADING7                                                 
                   AFTER ADVANCING 1.                                           
           WRITE SHORTAGE-LINE                                                  
               FROM H8-HEADING8                                                 
                   AFTER ADVANCING 1.                                           
           ADD  7 TO CP-LINE-COUNT.                                             
      *                                                                         
      ******************************************************************        
      * Z900-SQL-ERROR - PERFORMS THE ABEND FOR THE PROGRAM IN THE     *        
      *  EVENT THAT AN SQL ERROR CODE OCCURS.                          *        
      ******************************************************************        
       Z900-SQL-ERROR.                                                          
           MOVE +4013 TO ABEND-CODE.                                            
           DISPLAY '** ABEND **         ** = SQLERROR'.                         
           DISPLAY '** PROGRAM          ** = INKRP187'.                         
           DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.               
           DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.           
                                                                                
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE                 
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.                
           COPY DPPD004.                                                        
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
           EXEC SQL                                                             
               COMMIT                                                           
           END-EXEC.                                                            
                                                                                
