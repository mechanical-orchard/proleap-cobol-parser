000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400 PROGRAM-ID.    XLKUP988.                                         00040001
000500 AUTHOR.        DAN HINTZ.                                        00050001
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN   MAY 2005.                                         00070001
000800 DATE-COMPILED.                                                   00080001
000900***************************************************************** 00090001
001000*  THIS BATCH DB2 PROGRAM UPDATES XLT_VND_STYL FROM THE VSM       00100001
001000*  VENDOR STYLE NIGHTLY EXTRACT FILE.  THE EXTRACT FILE WILL BE   00101001
001000*  READ AND FOR EACH VENDOR STYLE RECORD FOUND ON THE FILE, THE   00102001
001000*  ASSOCIATED VENDOR STYLE ROW ON XLT_VND_STYL WILL HAVE THE      00103001
001000*  VS_DESC COLUMN UPDATED WITH THE VS_DESC VALUE FOUND ON THE     00104001
001000*  EXTRACT FILE.                                                  00104101
001400***************************************************************** 00105001
001500 ENVIRONMENT DIVISION.                                            00106001
001600 INPUT-OUTPUT SECTION.                                            00107001
001700                                                                  00108001
001800 FILE-CONTROL.                                                    00109001
001900                                                                  00110001
002000     SELECT XLT-VND-STYL-EXTRACT                                  00120001
002010         ASSIGN TO INP01.                                         00130001
002100                                                                  00140001
002200***************************************************************** 00150001
002300 DATA DIVISION.                                                   00160001
002400***************************************************************** 00170001
002500 FILE SECTION.                                                    00180001
002600                                                                  00190001
002700 FD  XLT-VND-STYL-EXTRACT                                         00200001
002800     RECORDING MODE IS F                                          00210001
002810     BLOCK CONTAINS 0 RECORDS                                     00220001
002900     LABEL RECORDS ARE STANDARD.                                  00230001
003000                                                                  00240001
003300 01  XLT-VND-STYL-EXTRACT-RECORD      PIC X(510).                 00250001
003700                                                                  00260001
003800                                                                  00270001
003900***************************************************************** 00280001
004000 WORKING-STORAGE SECTION.                                         00290001
004100                                                                  00300001
       01  PA-DB2-COMMIT-COUNT              PIC S9(09) VALUE +0         00310001
                                                          COMP-3.       00320001
004200 01  PS-PROGRAM-SWITCHES.                                         00330001
004300     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00340001
004400         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00350001
004500         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00360001
004600                                                                  00370001
004700 01  PC-PROGRAM-CONSTANTS.                                        00380001
004800     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'XLKUP988'.00390001
005000                                                                  00400001
005100 01  PV-PROGRAM-VARIABLES.                                        00410001
005900     05  PV-RECORDS-READ              PIC  9(09) VALUE  0.        00420001
006000     05  PV-RECORDS-UPDATED           PIC  9(09) VALUE  0.        00430001
006400     05  PV-DISP-STYL-ID              PIC  9(09) VALUE  0.        00450003
006700     05  PV-SQLCODE                   PIC  S9(9) VALUE +0.        00470001
006800     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00480001
006900                                                                  00490001
007000                                                                  00500001
007100 01  PV-ABEND-FIELDS.                                             00510001
007200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         00520001
007300                                                 COMP SYNC.       00530001
007400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'XLKUP988'.00540001
007500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00550001
007600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00560001
007700     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00570001
007900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00580001
008000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00590001
008100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00600001
008200                                                                  00610001
008300                                                                  00620001
008400***********************************************************       00630001
008500*  COPYBOOK USED FOR THE VENDOR STYLE EXTRACT FILE        *       00640001
008600***********************************************************       00650001
008700     COPY IMRD058.                                                00660001
008800                                                                  00670001
008900***********************************************************       00680001
009000*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00690001
009100***********************************************************       00700001
009200     COPY DPWS004.                                                00710001
009300                                                                  00720001
009400***********************************************************       00730001
009500*  DB2 SQL COMMUNICATION AREA                             *       00740001
009600***********************************************************       00750001
009700     EXEC SQL                                                     00760001
009800          INCLUDE SQLCA                                           00770001
009900     END-EXEC.                                                    00780001
010000                                                                  00790001
010100***********************************************************       00800001
010200*  LOGISTICS DOMAIN VENDOR STYLE TABLE (XLT_VND_STYL)    *        00810001
010300***********************************************************       00820001
010400     EXEC SQL                                                     00830001
010500          INCLUDE XLT00004                                        00840001
010600     END-EXEC.                                                    00850001
010700                                                                  00860001
010800***************************************************************** 00870001
010900 PROCEDURE DIVISION.                                              00880001
011000***************************************************************** 00890001
011100     DISPLAY '**** BEGINNING XLKUP988 ****'.                      00900001
011200     DISPLAY ' '.                                                 00910001
011300                                                                  00920001
011400     OPEN INPUT XLT-VND-STYL-EXTRACT.                             00930001
011500                                                                  00940001
011600     PERFORM 1000-READ-INPUT-FILE.                                00950001
011700                                                                  00960001
012100     PERFORM 2000-PROCESS-INPUT-FILE                              00970001
012200       UNTIL PS-EOF-INPUT-YES.                                    00980001
012300                                                                  00990001
012400     CLOSE XLT-VND-STYL-EXTRACT.                                  01000002
012500                                                                  01010001
012510     PERFORM 3000-TABLE-COMMIT.                                   01020001
012520                                                                  01030001
012600     DISPLAY '**  INPUT VENDOR STYLE RECS READ = '                01040001
                    PV-RECORDS-READ.                                    01041001
012700     DISPLAY '**  XLT_VND_STYL ROWS UPDATED... = '                01050001
                    PV-RECORDS-UPDATED.                                 01060001
012800     DISPLAY ' '.                                                 01070001
012900     DISPLAY '****  END OF  XLKUP988  ****'.                      01080001
013000                                                                  01090001
013100     STOP RUN.                                                    01100001
013200                                                                  01110001
013300                                                                  01120001
013400***************************************************************** 01130001
013500*  READ A VSM VENDOR STYLE EXTRACT RECORD THAT WILL BE USED TO  * 01140001
013510*  UPDATE THE VS_DESC COLUMN ON THE XLT_VND_STYL TABLE.         * 01150001
013600***************************************************************** 01160001
013700 1000-READ-INPUT-FILE.                                            01170001
013800                                                                  01180001
013900     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       01190001
014000                                                                  01200001
           INITIALIZE PA-DB2-COMMIT-COUNT.                              01210001
014020                                                                  01220001
014100     READ XLT-VND-STYL-EXTRACT                                    01230001
014200          INTO IM058-ITEM-STYLE-DOMAIN-REC                        01240001
014300            AT END                                                01250001
014400               SET PS-EOF-INPUT-YES TO TRUE                       01260001
014500                                                                  01270001
014600            NOT AT END                                            01280001
014700               SET PS-EOF-INPUT-NO  TO TRUE                       01290001
014800               ADD +1 TO PV-RECORDS-READ                          01300001
014900     END-READ.                                                    01310001
015000                                                                  01320001
015100                                                                  01330001
015200***************************************************************** 01340001
015300*  LOAD THE INFORMATION FROM THE VSM VENDOR STYLE EXTRACT FILE  * 01350004
015310*  INTO THE HOST VARIABLE AND PERFORM A PARAGRAPH TO UPDATE     * 01360005
015320*  THE ASSOCIATED ROW IN THE XLT_VND_STYL TABLE.                * 01370005
015400***************************************************************** 01380001
015500 2000-PROCESS-INPUT-FILE.                                         01390001
015600                                                                  01400001
015700     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       01410001
015800                                                                  01420001
016361     MOVE IM058-VS-DESC              TO XLT00004-VS-DESC.         01430001
016380                                                                  01490001
016400     PERFORM 2100-UPDATE-XLT-VND-STYL.                            01510001
017700                                                                  01530001
017800     PERFORM 1000-READ-INPUT-FILE.                                01540001
018500                                                                  01550001
018600                                                                  01560001
021600***************************************************************** 01570001
021700*  UPDATE VS_DESC ON THE XLT_VND_STYL TABLE.                    * 01580001
021800***************************************************************** 01590001
021900 2100-UPDATE-XLT-VND-STYL.                                        01600001
022000                                                                  01610001
022100     EXEC SQL                                                     01620001
022200          UPDATE XLT_VND_STYL                                     01630001
022300             SET VS_DESC = :XLT00004-VS-DESC                      01640001
023093           WHERE STYL_ID = :IM058-RMS-STYL-ID                     01650001
024010     END-EXEC.                                                    01710001
024100                                                                  01720001
024200     EVALUATE TRUE                                                01730001
024300         WHEN SQLCODE = ZERO                                      01740001
024400              ADD +1                 TO PV-RECORDS-UPDATED        01750001
                    ADD +1                 TO PA-DB2-COMMIT-COUNT       01760001
                    IF PA-DB2-COMMIT-COUNT > 4500                       01770001
                        PERFORM 3000-TABLE-COMMIT                       01780001
                        MOVE 0 TO PA-DB2-COMMIT-COUNT                   01790001
                    END-IF                                              01800001
024300         WHEN SQLCODE = +100                                      01801002
024300              CONTINUE                                            01802002
024500         WHEN SQLCODE NOT = +0                                    01840001
024600              MOVE '2100-UPDATE-XLT-VND-STYL'                     01850001
024700                                     TO PV-ABEND-PARAGRAPH        01860001
024800              MOVE 'UPDATE VS_DESC COLUMN'                        01870001
024810                                     TO PV-ABEND-OPERATION        01880001
024810              MOVE IM058-RMS-STYL-ID TO PV-DISP-STYL-ID           01882003
025500              STRING 'RMS STYLE ID: '      DELIMITED BY SIZE      01890002
025600                     PV-DISP-STYL-ID       DELIMITED BY SIZE      01900003
026700                                   INTO PV-DB2-OPERATION-MESSAGE-101910001
026900              MOVE 'XLT_VND_STYL'    TO PV-ABEND-TABLE            01930001
027000              PERFORM Z999-SQL-ABEND                              01940001
027100     END-EVALUATE.                                                01950001
027200                                                                  01960001
027300                                                                  01970001
027400***************************************************************** 01980001
027500* COMMIT THE PENDING TABLE CHANGES.                             * 01990001
027600***************************************************************** 02000001
027700 3000-TABLE-COMMIT.                                               02010001
027800                                                                  02020001
027900     EXEC SQL                                                     02030001
028000          COMMIT                                                  02040001
028100     END-EXEC.                                                    02050001
028200                                                                  02060001
028300                                                                  02070001
028400***************************************************************** 02080001
028500*  DISPLAY DB2 ERROR INFORMATION, ROLLBACK ANY PENDING CHANGES, * 02090001
028510*  AND ABEND THE PROGRAM.                                       * 02100001
028600***************************************************************** 02110001
028700 Z999-SQL-ABEND.                                                  02120001
028800                                                                  02130001
028900     MOVE SQLCODE            TO PV-SQLCODE.                       02140001
029000     MOVE PV-SQLCODE         TO PV-DISP-SQLCODE.                  02150001
029100     DISPLAY '*** DB2 ERROR '.                                    02160001
029200     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  02170001
029300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02180001
029400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02190001
029500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02200001
029600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02210001
029700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02220001
029800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02230001
029900     DISPLAY '*** TABLE 1   = ' PV-ABEND-TABLE.                   02240001
030000                                                                  02250001
030100     COPY DPPD004.                                                02260001
030200                                                                  02270001
030300     MOVE +4013         TO PV-ABEND-CODE.                         02280001
030400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02290001
