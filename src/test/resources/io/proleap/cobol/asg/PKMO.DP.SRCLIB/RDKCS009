000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    RDKCS009.                                         00050000
000600 AUTHOR.        CHUCK ALBERTY -- EXACTA.                          00060000
000700 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00070000
000800 DATE-WRITTEN.  10-06-91.                                         00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*               CICS PROGRAM - RDKCS009 - U009                   *00120000
001300*                                                                *00130000
001400*   CASH REFUND SYSTEM - AUTHORIZATION CONTROL MAINTENANCE       *00140000
001500*                                                                *00150000
001600*   THIS PROGRAM WILL ALLOW THE ADDITION, MAINTENANCE AND        *00160000
001700*   DELETION OF THE CASH REFUND SYSTEM AUTHORIZATION CONTROLS.   *00170000
001800*                                                                *00180000
001900*   CHANGES TO EXISTING STORE GROUPS AND ADDING A NEW STORE      *00190000
002000*   GROUP DO NOT REQUIRE A CONFIRMATION.  DELETING A STORE       *00200000
002100*   GROUP WILL REQUIRE A CONFIRMATION BEFORE THE FUNCTION IS     *00210000
002200*   COMPLETED.                                                   *00220000
002300*                                                                *00230000
002400*   THIS PROGRAM WILL ALSO UPDATE THE TEMPORARY STORAGE          *00240000
002500*   'REFAUTHQ' AND THE XST_LOC_ATTR TABLES TO                    *00250000
002600*   REFLECT ANY MAINTENANCE DONE TO THE AUTHORIZATION CONTROLS   *00260000
002700*   TABLE.                                                       *00270000
002800*                                                                *00280000
002900*   THIS PROGRAM WILL XCTL TO RDKCS005 WHEN AN INQUIRY           *00290000
003000*   FUNCTION IS REQUESTED (FUNCTION = 'I').                      *00300000
003100*                                                                *00310000
003200*   PF2 - WILL CONFIRM THE DELETE                                *00320000
003300*   PF3 - WILL EXIT THIS PROGRAM AND RETURN TO THE CASH REFUND   *00330000
003400*         SYSTEM MENU                                            *00340000
003500*   PF4 - WILL EXIT THIS PROGRAM AND RETURN TO THE MAIN MENU     *00350000
003600*                                                                *00360000
003700******************************************************************00370000
003710* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00371001
003720*            - CHANGE CALL OF DPKUT100 TO                       * 00372001
003730*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00373001
003740*              MAKING THE CALL DYNAMIC VS STATIC                * 00374001
003750*                                                               * 00375001
003760*---------------------------------------------------------------* 00376001
003800 ENVIRONMENT DIVISION.                                            00380000
003900******************************************************************00390000
004000 DATA DIVISION.                                                   00400000
004100******************************************************************00410000
004200 WORKING-STORAGE SECTION.                                         00420000
004300******************************************************************00430000
004400*   SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100)00440000
004500******************************************************************00450000
004600     COPY DPWS010I.                                               00460000
004700******************************************************************00470000
004800*   STANDARD ATTENTION IDENTIFIER LIST                            00480000
004900******************************************************************00490000
005000     COPY DFHAID.                                                 00500000
005100******************************************************************00510000
005200*   KOHLS STANDARD ATTRIBUTE LIST                                 00520000
005300******************************************************************00530000
005400     COPY DPWS015.                                                00540000
005500******************************************************************00550000
005600*   BECAUSE OF THE DIFFERENCE IN NAMING BETWEEN THE MAP FIELDS,   00560000
005700*   THE DB2 TABLE COLUMNS AND THE SCREEN DESCRIPTIONS, THE        00570000
005800*   FOLLOWING CROSS REFERENCE SHOULD BE MOST HELPFUL.  A CASE IN  00580000
005900*   POINT IS THE FOLLOWING:                                       00590000
006000*                                                                 00600000
006100*       SCREEN -- MAXIMUM REFUNDS PER ACTIVITY PERIOD             00610000
006200*                 ---             ---          -                  00620000
006300*                                                                 00630000
006400*   THE LETTERS MAX PER P ARE UNDERLINED, SO THE MAP FIELD IS     00640000
006500*   SET UP AS   MAXPERP   WITH THE APPROPRIATE ONE LETTER SUFFIX. 00650000
006600*                                                                 00660000
006700*   THE DB2 COLUMN USED FOR THAT MAP FIELD IS MAX_RET_PER_NBR.    00670000
006800*   AS BEST I CAN FIGURE IS THAT MEANS THE MAXIMUM NUMBER OF      00680000
006900*   REFUNDS FOR THE ACTIVITY PERIOD.  THE 'PER' IN THE COLUMN     00690000
007000*   DEFINITION MEANS 'PERIOD' INSTEAD OF 'PER'.                   00700000
007100*                                                                 00710000
007200*                                                                 00720000
007300*   MAP FIELD     DB2 TABLE                                       00730000
007400*   DEFINITION    DEFINITION            SCREEN DESCRIPTION        00740000
007500*   ----------    ----------            ------------------        00750000
007600*   STRGRP        AUTH_GP_NBR           STORE GROUP NUMBER        00760000
007700*                                                                 00770000
007800*   GRPDESC       AUTH_GP_DESC          DESCRIPTION               00780000
007900*                                                                 00790000
008000*   ACTPRD        ACTVY_PER_DAY_NBR     REFUND ACTIVITY PERIOD    00800000
008100*                                                                 00810000
008200*   MAXPERP       MAX_RET_PER_NBR       MAX REFUNDS PER           00820000
008300*                                       ACTIVITY PERIOD           00830000
008400*                                                                 00840000
008500*   MAXAMTP       MAX_DOL_RT_PER_AMT    MAX REFUND AMOUNT PER     00850000
008600*                                       ACTIVITY PERIOD           00860000
008700*                                                                 00870000
008800*   MAXPERD       MAX_RET_DAY_NBR       MAX REFUNDS PER DAY       00880000
008900*                                                                 00890000
009000*   MAXAMTD       MAX_DOL_RT_DAY_AMT    MAX REFUND AMOUNT PER DAY 00900000
009100*                                                                 00910000
009200*   MAXSTRD       MAX_STR_DAY_NBR       MAX NUMBER OF STORES      00920000
009300*                                       PER DAY                   00930000
009400*                                                                 00940000
009500*   LOWRFND       LO_RFND_AUTH_AMT      LOWEST AUTHORIZED REFUND  00950000
009600*                                       AMOUNT (ANY AMOUNT <=     00960000
009700*                                       TO THIS AMOUNT WILL BE    00970000
009800*                                       GIVEN A CASH REFUND)      00980000
009900*                                                                 00990000
010000*   HGHRFND       HGH_RFND_AUTH_AMT     HIGHEST AUTHORIZED REFUND 01000000
010100*                                       AMOUNT (ANY AMOUNT >=     01010000
010200*                                       TO THIS AMOUNT WILL BE    01020000
010300*                                       MAILED A CHECK)           01030000
010400*                                                                 01040000
010500*   CSHBACK       MAX_CSH_BCK_AMT       MAXIMUM KMRC CASH BACK    01050000
010600*                                                                 01060000
010700******************************************************************01070000
010800*  DSECT FOR THE RDKM009 MAPSET.  THIS IS HARD-CODED TO MAKE      01080000
010900*  USE OF ARRAYS FOR THE ASSOCIATED STORES.  ANY CHANGES TO       01090000
011000*  THE MAP SHOULD BE REFLECTED HERE ACCORDINGLY.                  01100000
011100******************************************************************01110000
011200 01  RD009AI.                                                     01120000
011300     05  FILLER                      PIC  X(12).                  01130000
011400*                                                                 01140000
011500     05  ADATEL                      PIC S9(04)      COMP.        01150000
011600     05  ADATEA                      PIC  X(01).                  01160000
011700     05  FILLER                      PIC  X(02).                  01170000
011800     05  ADATEI                      PIC  X(08).                  01180000
011900*                                                                 01190000
012000     05  ATIMEL                      PIC S9(04)      COMP.        01200000
012100     05  ATIMEA                      PIC  X(01).                  01210000
012200     05  FILLER                      PIC  X(02).                  01220000
012300     05  ATIMEI                      PIC  X(05).                  01230000
012400*                                                                 01240000
012500     05  ATERML                      PIC S9(04)      COMP.        01250000
012600     05  ATERMA                      PIC  X(01).                  01260000
012700     05  FILLER                      PIC  X(02).                  01270000
012800     05  ATERMI                      PIC  X(04).                  01280000
012900*                                                                 01290000
013000     05  FUNCTL                      PIC S9(04)      COMP.        01300000
013100     05  FUNCTA                      PIC  X(01).                  01310000
013200     05  FILLER                      PIC  X(02).                  01320000
013300     05  FUNCTI                      PIC  X(01).                  01330000
013400*                                                                 01340000
013500     05  STRGRPL                     PIC S9(04)      COMP.        01350000
013600     05  STRGRPA                     PIC  X(01).                  01360000
013700     05  FILLER                      PIC  X(02).                  01370000
013800     05  STRGRPI                     PIC  X(02).                  01380000
013900*                                                                 01390000
014000     05  GRPDESCL                    PIC S9(04)      COMP.        01400000
014100     05  GRPDESCA                    PIC  X(01).                  01410000
014200     05  FILLER                      PIC  X(02).                  01420000
014300     05  GRPDESCI                    PIC  X(20).                  01430000
014400*                                                                 01440000
014500     05  ACTPRDL                     PIC S9(04)      COMP.        01450000
014600     05  ACTPRDA                     PIC  X(01).                  01460000
014700     05  FILLER                      PIC  X(02).                  01470000
014800     05  ACTPRDI                     PIC  X(02).                  01480000
014900*                                                                 01490000
015000     05  MAXPERPL                    PIC S9(04)      COMP.        01500000
015100     05  MAXPERPA                    PIC  X(01).                  01510000
015200     05  FILLER                      PIC  X(02).                  01520000
015300     05  MAXPERPI                    PIC  X(01).                  01530000
015400*                                                                 01540000
015500     05  MAXAMTPL                    PIC S9(04)      COMP.        01550000
015600     05  MAXAMTPA                    PIC  X(01).                  01560000
015700     05  FILLER                      PIC  X(02).                  01570000
015800     05  MAXAMTPI                    PIC  X(05).                  01580000
015900*                                                                 01590000
016000     05  MAXPERDL                    PIC S9(04)      COMP.        01600000
016100     05  MAXPERDA                    PIC  X(01).                  01610000
016200     05  FILLER                      PIC  X(02).                  01620000
016300     05  MAXPERDI                    PIC  X(01).                  01630000
016400*                                                                 01640000
016500     05  MAXAMTDL                    PIC S9(04)      COMP.        01650000
016600     05  MAXAMTDA                    PIC  X(01).                  01660000
016700     05  FILLER                      PIC  X(02).                  01670000
016800     05  MAXAMTDI                    PIC  X(05).                  01680000
016900*                                                                 01690000
017000     05  MAXSTRDL                    PIC S9(04)      COMP.        01700000
017100     05  MAXSTRDA                    PIC  X(01).                  01710000
017200     05  FILLER                      PIC  X(02).                  01720000
017300     05  MAXSTRDI                    PIC  X(01).                  01730000
017400*                                                                 01740000
017500     05  LOWRFNDL                    PIC S9(04)      COMP.        01750000
017600     05  LOWRFNDA                    PIC  X(01).                  01760000
017700     05  FILLER                      PIC  X(02).                  01770000
017800     05  LOWRFNDI                    PIC  X(08).                  01780000
017900*                                                                 01790000
018000     05  HGHRFNDL                    PIC S9(04)      COMP.        01800000
018100     05  HGHRFNDA                    PIC  X(01).                  01810000
018200     05  FILLER                      PIC  X(02).                  01820000
018300     05  HGHRFNDI                    PIC  X(08).                  01830000
018400*                                                                 01840000
018500     05  CSHBACKL                    PIC S9(04)      COMP.        01850000
018600     05  CSHBACKA                    PIC  X(01).                  01860000
018700     05  FILLER                      PIC  X(02).                  01870000
018800     05  CSHBACKI                    PIC  X(08).                  01880000
018900*                                                                 01890000
019000     05  STORERI          OCCURS  6.                              01900000
019100         10  STORECI      OCCURS 13.                              01910000
019200             15  STRNBRL             PIC S9(04)      COMP.        01920000
019300             15  STRNBRA             PIC  X(01).                  01930000
019400             15  FILLER              PIC  X(02).                  01940000
019500             15  STRNBRI             PIC  9(05).                  01950000
019600*                                                                 01960000
019700     05  PFKEYSL                     PIC S9(04)      COMP.        01970000
019800     05  PFKEYSA                     PIC  X(01).                  01980000
019900     05  FILLER                      PIC  X(02).                  01990000
020000     05  PFKEYSI                     PIC  X(40).                  02000000
020100*                                                                 02010000
020200     05  AMSGL                       PIC S9(04)      COMP.        02020000
020300     05  AMSGA                       PIC  X(01).                  02030000
020400     05  FILLER                      PIC  X(02).                  02040000
020500     05  AMSGI                       PIC  X(75).                  02050000
020600*                                                                 02060000
020700*                                                                 02070000
020800 01  RD009AO REDEFINES RD009AI.                                   02080000
020900     05  FILLER                      PIC  X(12).                  02090000
021000*                                                                 02100000
021100     05  FILLER                      PIC  X(03).                  02110000
021200     05  ADATEC                      PIC  X(01).                  02120000
021300     05  ADATEH                      PIC  X(01).                  02130000
021400     05  ADATEO                      PIC  X(08).                  02140000
021500*                                                                 02150000
021600     05  FILLER                      PIC  X(03).                  02160000
021700     05  ATIMEC                      PIC  X(01).                  02170000
021800     05  ATIMEH                      PIC  X(01).                  02180000
021900     05  ATIMEO                      PIC  X(05).                  02190000
022000*                                                                 02200000
022100     05  FILLER                      PIC  X(03).                  02210000
022200     05  ATERMC                      PIC  X(01).                  02220000
022300     05  ATERMH                      PIC  X(01).                  02230000
022400     05  ATERMO                      PIC  X(04).                  02240000
022500*                                                                 02250000
022600     05  FILLER                      PIC  X(03).                  02260000
022700     05  FUNCTC                      PIC  X(01).                  02270000
022800     05  FUNCTH                      PIC  X(01).                  02280000
022900     05  FUNCTO                      PIC  X(01).                  02290000
023000*                                                                 02300000
023100     05  FILLER                      PIC  X(03).                  02310000
023200     05  STRGRPC                     PIC  X(01).                  02320000
023300     05  STRGRPH                     PIC  X(01).                  02330000
023400     05  STRGRPO                     PIC  X(02).                  02340000
023500*                                                                 02350000
023600     05  FILLER                      PIC  X(03).                  02360000
023700     05  GRPDESCC                    PIC  X(01).                  02370000
023800     05  GRPDESCH                    PIC  X(01).                  02380000
023900     05  GRPDESCO                    PIC  X(20).                  02390000
024000*                                                                 02400000
024100     05  FILLER                      PIC  X(03).                  02410000
024200     05  ACTPRDC                     PIC  X(01).                  02420000
024300     05  ACTPRDH                     PIC  X(01).                  02430000
024400     05  ACTPRDO                     PIC  X(02).                  02440000
024500*                                                                 02450000
024600     05  FILLER                      PIC  X(03).                  02460000
024700     05  MAXPERPC                    PIC  X(01).                  02470000
024800     05  MAXPERPH                    PIC  X(01).                  02480000
024900     05  MAXPERPO                    PIC  X(01).                  02490000
025000*                                                                 02500000
025100     05  FILLER                      PIC  X(03).                  02510000
025200     05  MAXAMTPC                    PIC  X(01).                  02520000
025300     05  MAXAMTPH                    PIC  X(01).                  02530000
025400     05  MAXAMTPO                    PIC  X(05).                  02540000
025500*                                                                 02550000
025600     05  FILLER                      PIC  X(03).                  02560000
025700     05  MAXPERDC                    PIC  X(01).                  02570000
025800     05  MAXPERDH                    PIC  X(01).                  02580000
025900     05  MAXPERDO                    PIC  X(01).                  02590000
026000*                                                                 02600000
026100     05  FILLER                      PIC  X(03).                  02610000
026200     05  MAXAMTDC                    PIC  X(01).                  02620000
026300     05  MAXAMTDH                    PIC  X(01).                  02630000
026400     05  MAXAMTDO                    PIC  X(05).                  02640000
026500*                                                                 02650000
026600     05  FILLER                      PIC  X(03).                  02660000
026700     05  MAXSTRDC                    PIC  X(01).                  02670000
026800     05  MAXSTRDH                    PIC  X(01).                  02680000
026900     05  MAXSTRDO                    PIC  X(01).                  02690000
027000*                                                                 02700000
027100     05  FILLER                      PIC  X(03).                  02710000
027200     05  LOWRFNDC                    PIC  X(01).                  02720000
027300     05  LOWRFNDH                    PIC  X(01).                  02730000
027400     05  LOWRFNDO                    PIC  X(08).                  02740000
027500*                                                                 02750000
027600     05  FILLER                      PIC  X(03).                  02760000
027700     05  HGHRFNDC                    PIC  X(01).                  02770000
027800     05  HGHRFNDH                    PIC  X(01).                  02780000
027900     05  HGHRFNDO                    PIC  X(08).                  02790000
028000*                                                                 02800000
028100     05  FILLER                      PIC  X(03).                  02810000
028200     05  CSHBACKC                    PIC  X(01).                  02820000
028300     05  CSHBACKH                    PIC  X(01).                  02830000
028400     05  CSHBACKO                    PIC  X(08).                  02840000
028500*                                                                 02850000
028600     05  STORERO          OCCURS  6.                              02860000
028700         10  STORECO      OCCURS 13.                              02870000
028800             15  FILLER              PIC  X(03).                  02880000
028900             15  STRNBRC             PIC  X(01).                  02890000
029000             15  STRNBRH             PIC  X(01).                  02900000
029100             15  STRNBRO             PIC  9(05).                  02910000
029200*                                                                 02920000
029300     05  FILLER                      PIC  X(03).                  02930000
029400     05  PFKEYSC                     PIC  X(01).                  02940000
029500     05  PFKEYSH                     PIC  X(01).                  02950000
029600     05  PFKEYSO                     PIC  X(40).                  02960000
029700*                                                                 02970000
029800     05  FILLER                      PIC  X(03).                  02980000
029900     05  AMSGC                       PIC  X(01).                  02990000
030000     05  AMSGH                       PIC  X(01).                  03000000
030100     05  AMSGO                       PIC  X(75).                  03010000
030200*                                                                 03020000
030300******************************************************************03030000
030400*   COMMUNICATION AREA                                            03040000
030500*     THE CA- FIELDS ARE ADDED FOR THIS PROGRAM'S USE.            03050000
030600******************************************************************03060000
030700     COPY RDRD000I.                                               03070000
030800     05  CA-COMM-FOR-RDKCS009.                                    03080000
030900         10  CA-LAST-STORE-GROUP     PIC S9(02)      COMP-3.      03090000
031000         10  CA-LAST-STORE-GROUP-X REDEFINES                      03100000
031100             CA-LAST-STORE-GROUP     PIC  X(02).                  03110000
031200         10  CA-FUNCTION             PIC  X(01).                  03120000
031300         10  CA-STORE-GROUP-NMBR     PIC S9(02)      COMP-3.      03130000
031400             88  CA-STORE-GROUP-NMBR-VALID           VALUE  1     03140000
031500                                                      THRU 99.    03150000
031600         10  CA-STORE-GROUP-NMBR-X REDEFINES CA-STORE-GROUP-NMBR  03160000
031700                                 PIC  X(02).                      03170000
031800*                                                                 03180000
031900         10  CA-RECORD.                                           03190000
032000             15  CA-DESCRIPTION      PIC  X(20).                  03200000
032100*                                                                 03210000
032200             15  CA-REFUND-ACTIVITY-PRD                           03220000
032300                                     PIC S9(02)      COMP-3.      03230000
032400                 88  CA-REFUND-ACTIVITY-PRD-VALID    VALUE  1     03240000
032500                                                      THRU 99.    03250000
032600             15  CA-REFUND-ACTIVITY-PRD-X REDEFINES               03260000
032700                 CA-REFUND-ACTIVITY-PRD                           03270000
032800                                     PIC  X(02).                  03280000
032900*                                                                 03290000
033000             15  CA-MAX-REFUND-PER-DAY                            03300000
033100                                     PIC S9(01)      COMP-3.      03310000
033200                 88  CA-MAX-REFUND-PER-DAY-VALID     VALUE  1     03320000
033300                                                      THRU  7.    03330000
033400             15  CA-MAX-REFUND-PER-DAY-X REDEFINES                03340000
033500                 CA-MAX-REFUND-PER-DAY                            03350000
033600                                     PIC  X(01).                  03360000
033700*                                                                 03370000
033800             15  CA-MAX-REFUND-PER-PRD                            03380000
033900                                     PIC S9(01)      COMP-3.      03390000
034000                 88  CA-MAX-REFUND-PER-PRD-VALID     VALUE  1     03400000
034100                                                      THRU  7.    03410000
034200             15  CA-MAX-REFUND-PER-PRD-X REDEFINES                03420000
034300                 CA-MAX-REFUND-PER-PRD                            03430000
034400                                     PIC  X(01).                  03440000
034500*                                                                 03450000
034600             15  CA-MAX-REFUND-AMT-PER-DAY                        03460000
034700                                     PIC S9(05).                  03470000
034800             15  CA-MAX-REFUND-AMT-PER-DAY-X REDEFINES            03480000
034900                 CA-MAX-REFUND-AMT-PER-DAY                        03490000
035000                                     PIC  X(05).                  03500000
035100*                                                                 03510000
035200             15  CA-MAX-REFUND-AMT-PER-PRD                        03520000
035300                                     PIC S9(05).                  03530000
035400             15  CA-MAX-REFUND-AMT-PER-PRD-X REDEFINES            03540000
035500                 CA-MAX-REFUND-AMT-PER-PRD                        03550000
035600                                     PIC  X(05).                  03560000
035700*                                                                 03570000
035800             15  CA-MAX-NMBR-OF-STORES                            03580000
035900                                     PIC S9(01)      COMP-3.      03590000
036000                 88  CA-MAX-NMBR-OF-STORES-VALID     VALUE  1     03600000
036100                                                      THRU  7.    03610000
036200             15  CA-MAX-NMBR-OF-STORES-X REDEFINES                03620000
036300                 CA-MAX-NMBR-OF-STORES                            03630000
036400                                     PIC  X(01).                  03640000
036500*                                                                 03650000
036600             15  CA-LO-RFND-AUTH-AMT PIC S9(05)V9(02).            03660000
036700             15  CA-LO-RFND-AUTH-AMT-X REDEFINES                  03670000
036800                 CA-LO-RFND-AUTH-AMT PIC X(07).                   03680000
036900*                                                                 03690000
037000             15  CA-HGH-RFND-AUTH-AMT PIC S9(05)V9(02).           03700000
037100             15  CA-HGH-RFND-AUTH-AMT-X REDEFINES                 03710000
037200                 CA-HGH-RFND-AUTH-AMT PIC X(07).                  03720000
037300*                                                                 03730000
037400             15  CA-MAX-CSH-BCK-AMT   PIC S9(05)V9(02).           03740000
037500             15  CA-MAX-CSH-BCK-AMT-X REDEFINES                   03750000
037600                 CA-MAX-CSH-BCK-AMT   PIC X(07).                  03760000
037700*                                                                 03770000
037800             15  CA-STORES.                                       03780000
037900                 20  CA-LIST-STORES  OCCURS 78.                   03790000
038000                     25  CA-ASSOCIATED-STORES                     03800000
038100                                     PIC 9(05).                   03810000
038200                     25  CA-UPDATE-STORE-SW                       03820000
038300                                     PIC  X(01).                  03830000
038400                         88  CA-UPDATE-STORE-NO      VALUE 'N'.   03840000
038500                         88  CA-UPDATE-STORE-YES     VALUE '0'    03850000
038600                                                           'Y'.   03860000
038700                         88  CA-UPDATE-STORE-TO-0    VALUE '0'.   03870000
038800                         88  CA-UPDATE-STORE-TO-NEW  VALUE 'Y'.   03880000
038900         10  CA-UPDATE-SW            PIC  X(01).                  03890000
039000             88  CA-CAN-UPDATE                       VALUE 'Y'.   03900000
039100             88  CA-CANNOT-UPDATE                    VALUE 'N'.   03910000
039200         10  CA-CHANGE-IND           PIC  X(01).                  03920000
039300             88  CA-CHANGE                           VALUE 'Y'.   03930000
039400             88  CA-NO-CHANGE                        VALUE 'N'.   03940000
039500         10  CA-RECORD-FOUND-IND     PIC  X(01).                  03950000
039600             88  CA-RECORD-FOUND                     VALUE 'Y'.   03960000
039700             88  CA-RECORD-NOT-FOUND                 VALUE 'N'.   03970000
039800*                                                                 03980000
039900******************************************************************03990000
040000*   UNFORMATTED MESSAGES FOR DB2 ERRORS/WARNINGS                  04000000
040100******************************************************************04010000
040200 01  DB2-MESSAGES.                                                04020000
040300     05  DM-RESOURCE-UNAVAIL-MSG.                                 04030000
040400         10  FILLER                  PIC  X(48)      VALUE        04040000
040500             'A RESOURCE WAS NOT AVAILABLE.  PLEASE TRY AGAIN.'.  04050000
040600         10  FILLER                  PIC  X(36)      VALUE        04060000
040700             'IF THE PROBLEM PERSISTS, CONTACT DP '.              04070000
040800     05  DM-DEADLOCK-TIMEOUT-MSG.                                 04080000
040900         10  FILLER                  PIC  X(48)      VALUE        04090000
041000             'DEADLOCK OR TIMEOUT.  PLEASE TRY AGAIN.         '.  04100000
041100         10  FILLER                  PIC  X(36)      VALUE        04110000
041200             'IF THE PROBLEM PERSISTS, CONTACT DP '.              04120000
041300     05  DM-NOT-AUTHORIZED-MSG.                                   04130000
041400         10  FILLER                  PIC  X(48)      VALUE        04140000
041500             'CONNECTION AUTHORIZATION FAILURE.  CONTACT DP.  '.  04150000
041600     05  DM-NOT-CONNECTED-MSG.                                    04160000
041700         10  FILLER                  PIC  X(48)      VALUE        04170000
041800             'CONNECTION NOT ESTABLISHED.  TRY AGAIN.         '.  04180000
041900         10  FILLER                  PIC  X(36)      VALUE        04190000
042000             'IF PROBLEM PERSISTS, CONTACT DP.    '.              04200000
042100     05  DM-OTHER-DB2-ERROR-MSG.                                  04210000
042200         10  FILLER                  PIC  X(48)      VALUE        04220000
042300             'A DB2 ERROR HAS OCCURRED - CONTACT DP - '.          04230000
042400     05  DM-DB2-ERROR-MSG.                                        04240000
042500         10  DM-ERROR-MSG            PIC  X(84).                  04250000
042600         10  FILLER                  PIC  X(45)      VALUE        04260000
042700             'PROGRAM RDKCS009'.                                  04270000
042800         10  FILLER                  PIC  X(11)      VALUE        04280000
042900             'SQLCODE = ('.                                       04290000
043000         10  DM-SQLCODE              PIC  Z(8)9-     VALUE ZERO.  04300000
043100         10  FILLER                  PIC  X(22)      VALUE        04310000
043200             ')   ROWS PROCESSED = ('.                            04320000
043300         10  DM-ROWS-ERR-PROCESSED   PIC  Z(8)9-     VALUE ZERO.  04330000
043400         10  FILLER                  PIC  X(02)      VALUE ')'.   04340000
043500         10  FILLER                  PIC  X(11)      VALUE        04350000
043600             'SQLERRML= ('.                                       04360000
043700         10  DM-SQLERRML             PIC  Z(8)9-     VALUE ZERO.  04370000
043800         10  FILLER                  PIC  X(15)      VALUE        04380000
043900             ')   SQLERRMC = '.                                   04390000
044000         10  DM-SQLERRMC             PIC  X(70)      VALUE ZERO.  04400000
044100     05  DM-DB2-WARNING-MSG.                                      04410000
044200         10  FILLER                  PIC  X(42)      VALUE        04420000
044300             'A DB2 WARNING HAS OCCURRED - CONTACT DP - '.        04430000
044400         10  FILLER                  PIC  X(43)      VALUE        04440000
044500             'PROGRAM RDKCS009'.                                  04450000
044600         10  FILLER                  PIC  X(11)      VALUE        04460000
044700             'SQLWARN = ('.                                       04470000
044800         10  DM-SQLWARN              PIC  X(08)      VALUE SPACES.04480000
044900         10  FILLER                  PIC  X(14)      VALUE        04490000
045000             ')  SQLCODE = ('.                                    04500000
045100         10  DM-SQLCODE1             PIC  Z(8)9-     VALUE ZERO.  04510000
045200         10  FILLER                  PIC  X(22)      VALUE        04520000
045300             ')   ROWS PROCESSED = ('.                            04530000
045400         10  DM-ROWS-WRN-PROCESSED   PIC  Z(8)9-     VALUE ZERO.  04540000
045500         10  FILLER                  PIC  X(04)      VALUE ')'.   04550000
045600                                                                  04560000
045700*                                                                 04570000
045800 01  PA-PROGRAM-ACCUMULATORS.                                     04580000
045900     05  PA-SUB1                     PIC S9(04)      COMP         04590000
046000                                                     VALUE ZERO.  04600000
046100     05  PA-SUB2                     PIC S9(04)      COMP         04610000
046200                                                     VALUE ZERO.  04620000
046300     05  PA-SUB3                     PIC S9(04)      COMP         04630000
046400                                                     VALUE ZERO.  04640000
046500     05  PA-RETRY-COUNT              PIC S9(04)      COMP         04650000
046600                                                     VALUE ZERO.  04660000
046700                                                                  04670000
046800 01  PC-PROGRAM-CONSTANTS.                                        04680000
046900     05  PC-THIS-PROGRAM             PIC  X(08)      VALUE        04690000
047000         'RDKCS009'.                                              04700000
047100     05  PC-U009                     PIC  X(04)      VALUE 'U009'.04710000
047200     05  PC-OPERATING-COMPANY        PIC  X(02)      VALUE '03'.  04720000
047300     05  PC-DEPARTMENT-STORE         PIC  X(02)      VALUE 'DS'.  04730000
047400     05  PC-STORE-COLUMNS            PIC S9(04)      VALUE +13    04740000
047500                                                     COMP SYNC.   04750000
047600     05  PC-STORE-GROUP-00           PIC S9(2)       VALUE ZERO   04760000
047700                                                     COMP-3.      04770000
047800     05  PC-MAX-RETRY                PIC S9(04)      VALUE +3     04780000
047900                                                     COMP SYNC.   04790000
048000     05  PC-MAX-STORES               PIC S9(04)      VALUE +78    04800000
048100                                                     COMP SYNC.   04810000
048200     05  PC-MORE-THAN-MAX-RETRY      PIC S9(04)      VALUE +4     04820000
048300                                                     COMP SYNC.   04830000
048400     05  PC-COMMAREA-LENGTH          PIC S9(04)      VALUE +637   04840000
048500                                                     COMP SYNC.   04850000
048600     05  PC-MSG-LENGTH               PIC S9(04)      VALUE +54    04860000
048700                                                     COMP SYNC.   04870000
048800     05  PC-DB2-ERROR-LENGTH         PIC S9(04)      VALUE +290   04880000
048900                                                     COMP SYNC.   04890000
049000     05  PC-DB2-WARNING-LENGTH       PIC S9(04)      VALUE +162   04900000
049100                                                     COMP SYNC.   04910000
049200     05  PC-PFKEYS-WITH-PF2          PIC  X(40)      VALUE        04920000
049300         'PF2-CONFIRM   PF3-SYS MENU   PF4-EXIT   '.              04930000
049400     05  PC-PFKEYS-WITHOUT-PF2       PIC  X(40)      VALUE        04940000
049500         'PF3-SYS MENU   PF4-EXIT                 '.              04950000
049600     05  PC-HEX-80                   PIC  X(01)      VALUE 'ø'.   04960000
049700     05  PC-ADD                      PIC  X(01)      VALUE 'A'.   04970000
049800     05  PC-CHANGE                   PIC  X(01)      VALUE 'C'.   04980000
049900     05  PC-DELETE                   PIC  X(01)      VALUE 'D'.   04990000
050000     05  PC-INQUIRE                  PIC  X(01)      VALUE 'I'.   05000000
050100     05  PC-EOF-KEYED-COMP           PIC S9(04)      VALUE +128   05010000
050200                                                     COMP SYNC.   05020000
050300     05  FILLER REDEFINES PC-EOF-KEYED-COMP.                      05030000
050400         10  FILLER                  PIC  X(01).                  05040000
050500         10  PC-EOF-KEYED            PIC  X(01).                  05050000
050600                                                                  05060000
050700                                                                  05070000
050800 01  PE-PROGRAM-EDIT-MASKS.                                       05080000
050900     05  PE-CASH-MASK                PIC  Z,ZZZ.                  05090000
051000     05  PE-AUTH-AMT-MASK            PIC  ZZZZZ.99.               05100000
051100                                                                  05110000
051200                                                                  05120000
051300 01  PM-PGM-MSG-DATA.                                             05130000
051400** 01                                                             05140000
051500     05  FILLER                      PIC  X(54)      VALUE        05150000
051600         '                                                      '.05160000
051700** 02                                                             05170000
051800     05  FILLER                      PIC  X(54)      VALUE        05180000
051900         'ERROR--FUNCTION CODE SHOULD BE A, C, D OR I           '.05190000
052000** 03                                                             05200000
052100     05  FILLER                      PIC  X(54)      VALUE        05210000
052200         'ERROR--INVALID PF REQUEST                             '.05220000
052300** 04                                                             05230000
052400     05  FILLER                      PIC  X(54)      VALUE        05240000
052500         'ERROR--STORE GROUP NUMBER IS INVALID                  '.05250000
052600** 05                                                             05260000
052700     05  FILLER                      PIC  X(54)      VALUE        05270000
052800         'ERROR--STORE GROUP DESCRIPTION REQUIRED               '.05280000
052900** 06                                                             05290000
053000     05  FILLER                      PIC  X(54)      VALUE        05300000
053100         'ERROR--REFUND ACTIVITY PERIOD SHOULD BE 1 THRU 30     '.05310000
053200** 07                                                             05320000
053300     05  FILLER                      PIC  X(54)      VALUE        05330000
053400         'ERROR--MAX REFUNDS PER DAY SHOULD BE 1 THRU 7         '.05340000
053500** 08                                                             05350000
053600     05  FILLER                      PIC  X(54)      VALUE        05360000
053700         'ERROR--MAX REFUNDS PER PERIOD SHOULD BE 1 THRU 7      '.05370000
053800** 09                                                             05380000
053900     05  FILLER                      PIC  X(54)      VALUE        05390000
054000         'ERROR--MAX REFUND AMOUNT PER DAY SHOULD BE NUMERIC    '.05400000
054100** 10                                                             05410000
054200     05  FILLER                      PIC  X(54)      VALUE        05420000
054300         'SYSTEM ERROR - CONTACT PROGRAMMING                    '.05430000
054400** 11                                                             05440000
054500     05  FILLER                      PIC  X(54)      VALUE        05450000
054600         'ERROR--MAX NUMBER OF STORES PER DAY SHOULD BE 1 THRU 7'.05460000
054700** 12                                                             05470000
054800     05  FILLER                      PIC  X(54)      VALUE        05480000
054900         'ERROR--STORE NUMBER INVALID                           '.05490000
055000** 13                                                             05500000
055100     05  FILLER                      PIC  X(54)      VALUE        05510000
055200         'ERROR--DUPLICATE RECORD EXISTS                        '.05520000
055300** 14                                                             05530000
055400     05  FILLER                      PIC  X(54)      VALUE        05540000
055500         'ERROR--STORE BELONGS TO ANOTHER STORE GROUPING        '.05550000
055600** 15                                                             05560000
055700     05  FILLER                      PIC  X(54)      VALUE        05570000
055800         'ERROR--MAX REFUND AMOUNT PER DAY EXCEEDS MAXIMUM      '.05580000
055900** 16                                                             05590000
056000     05  FILLER                      PIC  X(54)      VALUE        05600000
056100         'MUST USE DELETE FUNCTION BEFORE CONFIRMING DELETE     '.05610000
056200** 17                                                             05620000
056300     05  FILLER                      PIC  X(54)      VALUE        05630000
056400         'ERROR--MAX REFUND AMOUNT PER PERIOD SHOULD BE NUMERIC '.05640000
056500** 18                                                             05650000
056600     05  FILLER                      PIC  X(54)      VALUE        05660000
056700         'RECORD SUCCESSFULLY UPDATED                           '.05670000
056800** 19                                                             05680000
056900     05  FILLER                      PIC  X(54)      VALUE        05690000
057000         'RECORD SUCCESSFULLY CREATED                           '.05700000
057100** 20                                                             05710000
057200     05  FILLER                      PIC  X(54)      VALUE        05720000
057300         'ERROR--STORE GROUP NUMBER DOES NOT EXIST              '.05730000
057400** 21                                                             05740000
057500     05  FILLER                      PIC  X(54)      VALUE        05750000
057600         'NO UPDATES MADE                                       '.05760000
057700** 22                                                             05770000
057800     05  FILLER                      PIC  X(54)      VALUE        05780000
057900         'STOP!! TS UPDATE ERROR!!     CONTACT SYSTEMS!!        '.05790000
058000** 23                                                             05800000
058100     05  FILLER                      PIC  X(54)      VALUE        05810000
058200         'ERROR--MAX REFUND AMOUNT PER PERIOD EXCEEDS MAXIMUM   '.05820000
058300** 24                                                             05830000
058400     05  FILLER                      PIC  X(54)      VALUE        05840000
058500         'ERROR--STORE GROUP USED.  CANNOT DELETE               '.05850000
058600** 25                                                             05860000
058700     05  FILLER                      PIC  X(54)      VALUE        05870000
058800         'PRESS PF2 TO CONFIRM DELETION                         '.05880000
058900** 26                                                             05890000
059000     05  FILLER                      PIC  X(54)      VALUE        05900000
059100         'ERROR--STORE GROUP NMBR REQD IN DELETE FUNCTION       '.05910000
059200** 27                                                             05920000
059300     05  FILLER                      PIC  X(54)      VALUE        05930000
059400         'RECORD SUCCESSFULLY DELETED                           '.05940000
059500** 28                                                             05950000
059600     05  FILLER                      PIC  X(54)      VALUE        05960000
059700         'ERROR--STORE IS CLOSED.  CANNOT CHANGE STORE GRP      '.05970000
059800** 29                                                             05980000
059900     05  FILLER                      PIC  X(54)      VALUE        05990000
060000         'ERROR--STORE NUMBER IS NOT A DEPARTMENT STORE!!       '.06000000
060100** 30                                                             06010000
060200     05  FILLER                      PIC  X(54)      VALUE        06020000
060300         '                                                      '.06030000
060400** 31                                                             06040000
060500     05  FILLER                      PIC  X(54)      VALUE        06050000
060600         'ERROR--MAXIMUM CASH REFUND AMOUNT SHOULD BE NUMERIC   '.06060000
060700** 32                                                             06070000
060800     05  FILLER                      PIC  X(54)      VALUE        06080000
060900         'ERROR--MAX CASH REFUND AMT EXCEEDS MAX LIMIT 99999.99 '.06090000
061000** 33                                                             06100000
061100     05  FILLER                      PIC  X(54)      VALUE        06110000
061200         'ERROR--MAX CASH REFUND AMT MAY ONLY HAVE TWO DECIMALS '.06120000
061300** 34                                                             06130000
061400     05  FILLER                      PIC  X(54)      VALUE        06140000
061500         'ERROR--MINIMUM MAIL CHECK AMOUNT SHOULD BE NUMERIC    '.06150000
061600** 35                                                             06160000
061700     05  FILLER                      PIC  X(54)      VALUE        06170000
061800         'ERROR--MIN MAIL CHECK AMT EXCEEDS MAX LIMIT 99999.99  '.06180000
061900** 36                                                             06190000
062000     05  FILLER                      PIC  X(54)      VALUE        06200000
062100         'ERROR--MIN MAIL CHECK AMT MAY ONLY HAVE TWO DECIMALS  '.06210000
062200** 37                                                             06220000
062300     05  FILLER                      PIC  X(54)      VALUE        06230000
062400         'ERROR--MAIL CHECK AMT MUST BE > ZERO AND CASH RFND AMT'.06240000
062500** 38                                                             06250000
062600     05  FILLER                      PIC  X(54)      VALUE        06260000
062700         'ERROR--KMRC CASH BACK AMOUNT SHOULD BE NUMERIC        '.06270000
062800** 39                                                             06280000
062900     05  FILLER                      PIC  X(54)      VALUE        06290000
063000         'ERROR--KMRC CASH BACK AMT EXCEEDS MAX LIMIT 99999.99  '.06300000
063100** 40                                                             06310000
063200     05  FILLER                      PIC  X(54)      VALUE        06320000
063300         'ERROR--KMRC CASH BACK AMT MAY ONLY HAVE TWO DECIMALS  '.06330000
063400                                                                  06340000
063500 01  PM-PGM-MSG-TABLE  REDEFINES  PM-PGM-MSG-DATA.                06350000
063600     05  PM-PGM-MSG OCCURS 40 TIMES                               06360000
063700                    INDEXED BY PMT-INDX                           06370000
063800                                     PIC  X(54).                  06380000
063900                                                                  06390000
064000                                                                  06400000
064100 01  PS-PROGRAM-SWITCHES.                                         06410000
064200     05  PS-EDIT-ERROR-IND           PIC  X(01)      VALUE 'N'.   06420000
064300         88  PS-NO-EDIT-ERROR                        VALUE 'N'.   06430000
064400         88  PS-EDIT-ERROR                           VALUE 'Y'.   06440000
064500     05  PS-UPDATE-ERROR-IND         PIC  X(01)      VALUE 'N'.   06450000
064600         88  PS-NO-UPDATE-ERROR                      VALUE 'N'.   06460000
064700         88  PS-UPDATE-ERROR                         VALUE 'Y'.   06470000
064800     05  PS-UPDATE-MADE-IND          PIC  X(01)      VALUE 'N'.   06480000
064900         88  PS-NO-UPDATE-MADE                       VALUE 'N'.   06490000
065000         88  PS-UPDATE-MADE                          VALUE 'Y'.   06500000
065100     05  PS-STORE-UPDATE-IND         PIC  X(01)      VALUE 'N'.   06510000
065200         88  PS-STORE-UPDATE                         VALUE 'Y'.   06520000
065300         88  PS-NO-STORE-UPDATE                      VALUE 'N'.   06530000
065400                                                                  06540000
065500 01  PV-PROGRAM-VARIABLES.                                        06550000
065600     05  PV-CURRENT-DATE             PIC  9(06)      VALUE ZERO.  06560000
065700     05  PV-CURRENT-TIME             PIC  9(06)      VALUE ZERO.  06570000
065800     05  PV-USER-ID                  PIC  X(08)      VALUE SPACES.06580000
065900     05  PV-RESP                     PIC S9(04)      COMP         06590000
066000                                                     VALUE ZERO.  06600000
066100     05  PV-STORE                    PIC S9(04)      COMP         06610000
066200                                                     VALUE ZERO.  06620000
066300     05  PV-STORE-GROUP-NMBR         PIC S9(02)      COMP-3       06630000
066400                                                     VALUE ZERO.  06640000
066500     05  PV-MAX-REFUND-AMT-PER-DAY   PIC S9(05)      COMP-3       06650000
066600                                                     VALUE ZERO.  06660000
066700     05  PV-MAX-REFUND-AMT-PER-PRD   PIC S9(05)      COMP-3       06670000
066800                                                     VALUE ZERO.  06680000
066900     05  PV-LO-RFND-AUTH-AMT         PIC S9(05)V9(02) COMP-3      06690000
067000                                                      VALUE ZERO. 06700000
067100     05  PV-HGH-RFND-AUTH-AMT        PIC S9(05)V9(02) COMP-3      06710000
067200                                                      VALUE ZERO. 06720000
067300     05  PV-MAX-CSH-BCK-AMT          PIC S9(05)V9(02) COMP-3      06730000
067400                                                      VALUE ZERO. 06740000
067500     05  PV-DATE                     PIC X(10)                    06750000
067600                                           VALUE SPACES.          06760000
067700                                                                  06770000
067800 01  TEMPORARY-STORAGE-FIELDS.                                    06780000
067900     05  TS-FOR-REFAUTH-CONTROLS.                                 06790000
068000         10  TS-Q-QUEUE-NAME         PIC  X(08)      VALUE        06800000
068100             'REFAUTHQ'.                                          06810000
068200         10  TS-Q-ITEM-NMBR          PIC S9(04)      COMP         06820000
068300                                                     VALUE ZERO.  06830000
068400         10  TS-Q-RECORD.                                         06840000
068500             15  TS-Q-STORE-NMBR     PIC  9(05)      VALUE ZERO.  06850000
068600             15  TS-Q-STORE-GP-NBR   PIC  9(02)      VALUE ZERO.  06860000
068700             15  TS-Q-ACTIVITY-PERIOD                             06870000
068800                                     PIC  9(02)      VALUE ZERO.  06880000
068900             15  TS-Q-MAX-REFUNDS-PER-PRD                         06890000
069000                                     PIC  9(01)      VALUE ZERO.  06900000
069100             15  TS-Q-MAX-REFUND-AMT-PER-PRD                      06910000
069200                                     PIC S9(05)      COMP-3       06920000
069300                                                     VALUE ZERO.  06930000
069400             15  TS-Q-MAX-STORES     PIC  9(01)      VALUE ZERO.  06940000
069500             15  TS-Q-MAX-REFUNDS-PER-DAY                         06950000
069600                                     PIC  9(01)      VALUE ZERO.  06960000
069700             15  TS-Q-MAX-REFUND-AMT-PER-DAY                      06970000
069800                                     PIC S9(05)      COMP-3       06980000
069900                                                     VALUE ZERO.  06990000
070000             15  TS-Q-LO-RFND-AUTH-AMT                            07000000
070100                                     PIC S9(05)V9(02)             07010000
070200                                                     COMP-3       07020000
070300                                                     VALUE ZERO.  07030000
070400             15  TS-Q-HGH-RFND-AUTH-AMT                           07040000
070500                                     PIC S9(05)V9(02)             07050000
070600                                                     COMP-3       07060000
070700                                                     VALUE ZERO.  07070000
070800             15  TS-Q-MAX-CSH-BCK-AMT                             07080000
070900                                     PIC S9(05)V9(02)             07090000
071000                                                     COMP-3       07100000
071100                                                     VALUE ZERO.  07110000
071200         10  TS-Q-RECORD-LENGTH      PIC S9(04)      COMP         07120000
071300                                                     VALUE +30.   07130000
071400                                                                  07140000
071500 01  ST-SYSTEM-TIME-AREA.                                         07150000
071600     05  ST-ABSTIME                  PIC S9(18)      VALUE ZERO   07160000
071700                                                     COMP SYNC.   07170000
071800     05  ST-TIME-EDIT.                                            07180000
071900         10  ST-TIME-HHMM            PIC  X(05)      VALUE SPACES.07190000
072000         10  FILLER                  PIC  X(03)      VALUE SPACES.07200000
072100                                                                  07210000
072200******************************************************************07220000
072300*  SQL AND COBOL DECLARATIONS FOR XST_LOC TABLE                   07230000
072400******************************************************************07240000
072500     EXEC SQL                                                     07250000
072600          INCLUDE XST00001                                        07260000
072700     END-EXEC.                                                    07270000
072800                                                                  07280000
072900******************************************************************07290000
073000*  SQL AND COBOL DECLARATIONS FOR THE CASH REFUND AUTHORIZATION   07300000
073100*  CONTROL TABLE (TRDCNTL)                                        07310000
073200******************************************************************07320000
073300     EXEC SQL                                                     07330000
073400          INCLUDE TRDCNTL                                         07340000
073500     END-EXEC.                                                    07350000
073600                                                                  07360000
073700******************************************************************07370000
073800*  SQL AND COBOL DECLARATIONS FOR THE XS DOMAIN LOCATION          07380000
073900*  ATTRIBUTE TABLE (XST_LOC_ATTR)                                 07390000
074000******************************************************************07400000
074100     EXEC SQL                                                     07410000
074200          INCLUDE XST00025                                        07420000
074300     END-EXEC.                                                    07430000
074400                                                                  07440000
074500******************************************************************07450000
074600*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                07460000
074700******************************************************************07470000
074800     EXEC SQL                                                     07480000
074900          INCLUDE SQLCA                                           07490000
075000     END-EXEC.                                                    07500000
075100                                                                  07510000
075200******************************************************************07520000
075300*  DECLARE CURSOR FOR XST_LOC TO GET LOC_NBR                      07530000
075400******************************************************************07540000
075500     EXEC SQL                                                     07550000
075600          DECLARE STORE_CSR CURSOR FOR                            07560000
075700           SELECT A.LOC_NBR                                       07570000
075800             FROM XST_LOC A,                                      07580000
075900                  XST_LOC_ATTR B                                  07590000
076000            WHERE B.LOC_NBR         = A.LOC_NBR                   07600000
076100              AND B.CSH_RFND_GP_NBR = :RDCNTL-AUTH-GP-NBR         07610000
076200              AND A.LOC_TYP_CDE     = :PC-DEPARTMENT-STORE        07620000
076300            ORDER BY A.LOC_NBR                                    07630000
076400     END-EXEC.                                                    07640000
076500******************************************************************07650000
076600 LINKAGE SECTION.                                                 07660000
076700******************************************************************07670000
076800 01  DFHCOMMAREA                     PIC  X(637).                 07680000
076900                                                                  07690000
077000******************************************************************07700000
077100 PROCEDURE DIVISION.                                              07710000
077200******************************************************************07720000
077300*   DETERMINES WHAT PF KEY WAS HIT TO DO THE APPROPRIATE ACTION.  07730000
077400*   DISPLAYS MAP AND RETURNS TO ITS OWN TRANS-ID.                 07740000
077500******************************************************************07750000
077600 0000-MAINLINE.                                                   07760000
077700                                                                  07770000
077800     SET PMT-INDX                    TO 1.                        07780000
077900                                                                  07790000
078000     MOVE LOW-VALUES                 TO RD009AO.                  07800000
078100     MOVE DFHCOMMAREA                TO RD000I-COMMUNICATION-AREA.07810000
078200                                                                  07820000
078300     EVALUATE TRUE                                                07830000
078400         WHEN EIBCALEN = ZERO                                     07840000
078500              PERFORM 9700-XCTL-INQUIRY-PROGRAM                   07850000
078600         WHEN EIBAID = DFHPF2                                     07860000
078700              IF  CA-CAN-UPDATE                                   07870000
078800                  PERFORM 2310-DELETE-RECORD                      07880000
078900              ELSE                                                07890000
079000                  SET PMT-INDX       TO 16                        07900000
079100                  SET PS-EDIT-ERROR  TO TRUE                      07910000
079200                  MOVE DP015-RED     TO AMSGC                     07920000
079300                  MOVE -1            TO FUNCTL                    07930000
079400              END-IF                                              07940000
079500         WHEN EIBAID = DFHPF3                                     07950000
079600              PERFORM 9600-RETURN-TO-SYSTEM-MENU                  07960000
079700         WHEN EIBAID = DFHPF4                                     07970000
079800              PERFORM 9500-RETURN-TO-MAIN-MENU                    07980000
079900         WHEN RD000I-INITIALIZE-SCREEN                            07990000
080000              PERFORM 1000-SEND-INITIAL-MAP                       08000000
080100         WHEN EIBAID = DFHCLEAR                                   08010000
080200              INITIALIZE CA-RECORD                                08020000
080300                         CA-STORE-GROUP-NMBR                      08030000
080400              PERFORM 1000-SEND-INITIAL-MAP                       08040000
080500         WHEN EIBAID = DFHENTER                                   08050000
080600              PERFORM 2000-PROCESS-FUNCTION                       08060000
080700         WHEN OTHER                                               08070000
080800              SET PMT-INDX           TO 3                         08080000
080900              SET PS-EDIT-ERROR      TO TRUE                      08090000
081000              MOVE DP015-RED         TO AMSGC                     08100000
081100              MOVE -1                TO FUNCTL                    08110000
081200     END-EVALUATE.                                                08120000
081300                                                                  08130000
081400     IF  CA-FUNCTION = PC-DELETE                                  08140000
081500     AND CA-CAN-UPDATE                                            08150000
081600         MOVE PC-PFKEYS-WITH-PF2     TO PFKEYSO                   08160000
081700     ELSE                                                         08170000
081800         MOVE PC-PFKEYS-WITHOUT-PF2  TO PFKEYSO                   08180000
081900     END-IF.                                                      08190000
082000                                                                  08200000
082100     EVALUATE TRUE                                                08210000
082200         WHEN RD000I-INITIALIZE-SCREEN                            08220000
082300              PERFORM 9100-SEND-MAP                               08230000
082400         WHEN PS-EDIT-ERROR                                       08240000
082500         WHEN CA-CANNOT-UPDATE                                    08250000
082600              PERFORM 9200-SEND-NO-ERASE                          08260000
082700         WHEN ANY                                                 08270000
082800              PERFORM 9100-SEND-MAP                               08280000
082900     END-EVALUATE.                                                08290000
083000                                                                  08300000
083100     GOBACK.                                                      08310000
083200                                                                  08320000
083300******************************************************************08330000
083400*   INITIALIZE SCREEN FIELDS AND SEND THE INITIAL MAP.           *08340000
083500******************************************************************08350000
083600 1000-SEND-INITIAL-MAP.                                           08360000
083700                                                                  08370000
083800     MOVE LOW-VALUES                 TO RD009AI.                  08380000
083900     MOVE DP015-RED                  TO AMSGC.                    08390000
084000     SET PMT-INDX                    TO 1.                        08400000
084100                                                                  08410000
084200     MOVE -1                         TO FUNCTL.                   08420000
084300     MOVE CA-FUNCTION                TO FUNCTO.                   08430000
084400     MOVE CA-STORE-GROUP-NMBR        TO STRGRPO.                  08440000
084500                                                                  08450000
084600     EVALUATE TRUE                                                08460000
084700         WHEN CA-FUNCTION = PC-ADD                                08470000
084800              INITIALIZE CA-RECORD                                08480000
084900              MOVE -1                TO STRGRPL                   08490000
085000         WHEN CA-LAST-STORE-GROUP NOT NUMERIC                     08500000
085100         WHEN CA-STORE-GROUP-NMBR NOT NUMERIC                     08510000
085200         WHEN CA-STORE-GROUP-NMBR = ZERO                          08520000
085300         WHEN CA-STORE-GROUP-NMBR-X NOT = CA-LAST-STORE-GROUP-X   08530000
085400              PERFORM 5100-DISPLAY-RECORD                         08540000
085500         WHEN CA-STORE-GROUP-NMBR-X = CA-LAST-STORE-GROUP-X       08550000
085600              PERFORM 5000-PAINT-SCREEN                           08560000
085700     END-EVALUATE.                                                08570000
085800                                                                  08580000
085900     IF  CA-FUNCTION = PC-DELETE                                  08590000
086000     AND PS-NO-EDIT-ERROR                                         08600000
086100         PERFORM 2300-PROCESS-DELETE                              08610000
086200     ELSE                                                         08620000
086300         MOVE PC-PFKEYS-WITHOUT-PF2  TO PFKEYSO                   08630000
086400     END-IF.                                                      08640000
086500                                                                  08650000
086600******************************************************************08660000
086700*  PROCESS THE FUNCTION REQUESTED.                               *08670000
086800******************************************************************08680000
086900 2000-PROCESS-FUNCTION.                                           08690000
087000                                                                  08700000
087100     PERFORM 9000-RECEIVE-MAP.                                    08710000
087200     SET CA-CANNOT-UPDATE            TO TRUE.                     08720000
087300     MOVE CA-FUNCTION                TO FUNCTO.                   08730000
087400                                                                  08740000
087500     PERFORM 6000-EDIT-STORE-GROUP.                               08750000
087600                                                                  08760000
087700     EVALUATE TRUE                                                08770000
087800         WHEN CA-FUNCTION = PC-ADD                                08780000
087900              IF  PS-NO-EDIT-ERROR                                08790000
088000                  PERFORM 2100-PROCESS-ADD                        08800000
088100              END-IF                                              08810000
088200         WHEN CA-FUNCTION = PC-CHANGE                             08820000
088300              IF  PS-NO-EDIT-ERROR                                08830000
088400                  PERFORM 2200-PROCESS-UPDATE                     08840000
088500              END-IF                                              08850000
088600         WHEN CA-FUNCTION = PC-DELETE                             08860000
088700              IF  PS-NO-EDIT-ERROR                                08870000
088800                  PERFORM 2300-PROCESS-DELETE                     08880000
088900              END-IF                                              08890000
089000         WHEN CA-FUNCTION = PC-INQUIRE                            08900000
089100              PERFORM 9700-XCTL-INQUIRY-PROGRAM                   08910000
089200         WHEN OTHER                                               08920000
089300              SET PMT-INDX           TO 2                         08930000
089400              SET PS-EDIT-ERROR      TO TRUE                      08940000
089500              MOVE DP015-RED         TO AMSGC                     08950000
089600                                        FUNCTC                    08960000
089700              MOVE DP015-REVERSE     TO FUNCTH                    08970000
089800              MOVE -1                TO FUNCTL                    08980000
089900     END-EVALUATE.                                                08990000
090000******************************************************************09000000
090100*  PROCESS THE ADDITION OF STORE GROUP NUMBER                    *09010000
090200******************************************************************09020000
090300 2100-PROCESS-ADD.                                                09030000
090400                                                                  09040000
090500     INITIALIZE CA-STORES.                                        09050000
090600     PERFORM 8800-READ-REFUND-AUTH.                               09060000
090700                                                                  09070000
090800     IF  CA-RECORD-FOUND                                          09080000
090900         SET PMT-INDX                TO 13                        09090000
091000         SET PS-EDIT-ERROR           TO TRUE                      09100000
091100         SET CA-CANNOT-UPDATE        TO TRUE                      09110000
091200         MOVE DP015-RED              TO STRGRPC                   09120000
091300         MOVE DP015-REVERSE          TO STRGRPH                   09130000
091400         MOVE -1                     TO STRGRPL                   09140000
091500     END-IF.                                                      09150000
091600                                                                  09160000
091700     PERFORM 6100-EDIT-OTHER-FIELDS.                              09170000
091800                                                                  09180000
091900     SET PS-NO-UPDATE-ERROR          TO TRUE.                     09190000
092000                                                                  09200000
092100     IF  PS-NO-EDIT-ERROR                                         09210000
092200         PERFORM 8100-INSERT-REFUND-AUTH                          09220000
092300         IF  SQLCODE = -803                                       09230000
092400             SET PMT-INDX            TO 13                        09240000
092500             SET PS-EDIT-ERROR       TO TRUE                      09250000
092600             SET CA-CANNOT-UPDATE    TO TRUE                      09260000
092700             MOVE DP015-RED          TO STRGRPC                   09270000
092800             MOVE DP015-REVERSE      TO STRGRPH                   09280000
092900             MOVE -1                 TO STRGRPL                   09290000
093000         ELSE                                                     09300000
093100             PERFORM 2110-CONTINUE-INSERT                         09310000
093200             SET CA-RECORD-FOUND     TO TRUE                      09320000
093300             MOVE -1                 TO FUNCTL                    09330000
093400         END-IF                                                   09340000
093500     ELSE                                                         09350000
093600         SET CA-CANNOT-UPDATE        TO TRUE                      09360000
093700     END-IF.                                                      09370000
093800******************************************************************09380000
093900*  ADD A STORE GROUP NUMBER                                      *09390000
094000******************************************************************09400000
094100 2110-CONTINUE-INSERT.                                            09410000
094200                                                                  09420000
094300     PERFORM                                                      09430000
094400       VARYING PA-SUB3 FROM 1 BY 1                                09440000
094500         UNTIL CA-ASSOCIATED-STORES (PA-SUB3) = ZERO              09450000
094600            OR PA-SUB3 > PC-MAX-STORES                            09460000
094700            OR PS-UPDATE-ERROR                                    09470000
094800                                                                  09480000
094900         PERFORM 4000-PREPARE-UPDATE                              09490000
095000     END-PERFORM.                                                 09500000
095100                                                                  09510000
095200     IF  PS-NO-UPDATE-ERROR                                       09520000
095300         PERFORM 2120-ADD-POST-PROCESS                            09530000
095400     END-IF.                                                      09540000
095500******************************************************************09550000
095600*                          UPDATE THE TEMP STORAGE 'REFAUTHQ'    *09560000
095700******************************************************************09570000
095800 2120-ADD-POST-PROCESS.                                           09580000
095900                                                                  09590000
096000     SET PMT-INDX                    TO 19.                       09600000
096100     MOVE DP015-WHITE                TO AMSGC.                    09610000
096200                                                                  09620000
096300     EXEC CICS SYNCPOINT                                          09630000
096400     END-EXEC.                                                    09640000
096500***                                                               09650000
096600***  UPDATE TEMP STORAGE                                          09660000
096700***                                                               09670000
096800     PERFORM                                                      09680000
096900       VARYING PA-SUB3 FROM 1 BY 1                                09690000
097000         UNTIL CA-ASSOCIATED-STORES (PA-SUB3) = ZERO              09700000
097100            OR PA-SUB3 > PC-MAX-STORES                            09710000
097200                                                                  09720000
097300         PERFORM 9920-UPDATE-TEMP-STORAGE                         09730000
097400     END-PERFORM.                                                 09740000
097500                                                                  09750000
097600     IF  PS-STORE-UPDATE                                          09760000
097700         MOVE PC-CHANGE              TO CA-FUNCTION               09770000
097800     END-IF.                                                      09780000
097900******************************************************************09790000
098000*  PROCESS THE UPDATE OF A STORE GROUP NUMBER                    *09800000
098100******************************************************************09810000
098200 2200-PROCESS-UPDATE.                                             09820000
098300                                                                  09830000
098400     EVALUATE TRUE                                                09840000
098500         WHEN CA-STORE-GROUP-NMBR NOT = CA-LAST-STORE-GROUP       09850000
098600              SET RD000I-INITIALIZE-SCREEN                        09860000
098700                                     TO TRUE                      09870000
098800              PERFORM 5100-DISPLAY-RECORD                         09880000
098900              IF  CA-RECORD-NOT-FOUND                             09890000
099000                  INITIALIZE CA-RECORD                            09900000
099100                  SET PMT-INDX       TO 20                        09910000
099200                  SET PS-EDIT-ERROR  TO TRUE                      09920000
099300                  SET CA-CANNOT-UPDATE                            09930000
099400                                     TO TRUE                      09940000
099500                  MOVE DP015-RED     TO STRGRPC                   09950000
099600                  MOVE DP015-REVERSE TO STRGRPH                   09960000
099700                  MOVE -1            TO STRGRPL                   09970000
099800              END-IF                                              09980000
099900         WHEN ANY                                                 09990000
100000              PERFORM 6100-EDIT-OTHER-FIELDS                      10000000
100100              IF  PS-NO-EDIT-ERROR                                10010000
100200                  IF  CA-CHANGE                                   10020000
100300                      PERFORM 2210-UPDATE-RECORD                  10030000
100400                      PERFORM 5100-DISPLAY-RECORD                 10040000
100500                  ELSE                                            10050000
100600                      SET PMT-INDX   TO 21                        10060000
100700                  END-IF                                          10070000
100800              ELSE                                                10080000
100900                  SET CA-CANNOT-UPDATE                            10090000
101000                                     TO TRUE                      10100000
101100              END-IF                                              10110000
101200     END-EVALUATE.                                                10120000
101300******************************************************************10130000
101400*  PROCESS THE UPDATE OF A STORE GROUP NUMBER                    *10140000
101500*     1.  UPDATE THE CASH REFUND AUTHORIZATION CONTROL TABLE     *10150000
101600*         (TRDCNTL)                                              *10160000
101700*     2.  UPDATE THE XS DOMAIN LOCATION ATTRIBUTE TABLE          *10170000
101800*         (XST_LOC_ATTR)                                         *10180000
101900*     3.  DO POST-UPDATE PROCESSING                              *10190000
102000******************************************************************10200000
102100 2210-UPDATE-RECORD.                                              10210000
102200                                                                  10220000
102300     SET PS-NO-UPDATE-ERROR          TO TRUE.                     10230000
102400     SET PS-NO-UPDATE-MADE           TO TRUE.                     10240000
102500     SET PS-NO-STORE-UPDATE          TO TRUE.                     10250000
102600                                                                  10260000
102700     PERFORM 8200-UPDATE-REFUND-AUTH.                             10270000
102800                                                                  10280000
102900     PERFORM                                                      10290000
103000       VARYING PA-SUB3 FROM 1 BY 1                                10300000
103100         UNTIL PA-SUB3 > PC-MAX-STORES                            10310000
103200            OR PS-UPDATE-ERROR                                    10320000
103300                                                                  10330000
103400         PERFORM 4000-PREPARE-UPDATE                              10340000
103500     END-PERFORM.                                                 10350000
103600                                                                  10360000
103700     IF  PS-NO-UPDATE-ERROR                                       10370000
103800         PERFORM 2220-UPDATE-POST-PROCESS                         10380000
103900     END-IF.                                                      10390000
104000                                                                  10400000
104100     SET CA-CAN-UPDATE               TO TRUE.                     10410000
104200******************************************************************10420000
104300*                          UPDATE THE TEMP STORAGE 'REFAUTHQ'    *10430000
104400******************************************************************10440000
104500 2220-UPDATE-POST-PROCESS.                                        10450000
104600                                                                  10460000
104700     SET PMT-INDX                    TO 18.                       10470000
104800     MOVE DP015-WHITE                TO AMSGC.                    10480000
104900                                                                  10490000
105000     EXEC CICS SYNCPOINT                                          10500000
105100     END-EXEC.                                                    10510000
105200***                                                               10520000
105300***  UPDATE TEMP STORAGE                                          10530000
105400***                                                               10540000
105500                                                                  10550000
105600     PERFORM                                                      10560000
105700       VARYING PA-SUB3 FROM 1 BY 1                                10570000
105800         UNTIL CA-ASSOCIATED-STORES (PA-SUB3) = ZERO              10580000
105900            OR PA-SUB3 > PC-MAX-STORES                            10590000
106000                                                                  10600000
106100         PERFORM 9920-UPDATE-TEMP-STORAGE                         10610000
106200     END-PERFORM.                                                 10620000
106300                                                                  10630000
106400******************************************************************10640000
106500*  PROCESS THE DELETE OF A STORE GROUP NUMBER                    *10650000
106600******************************************************************10660000
106700 2300-PROCESS-DELETE.                                             10670000
106800                                                                  10680000
106900     EVALUATE TRUE                                                10690000
107000         WHEN CA-STORE-GROUP-NMBR = ZERO                          10700000
107100              SET PMT-INDX           TO 26                        10710000
107200              SET PS-EDIT-ERROR      TO TRUE                      10720000
107300              SET CA-CANNOT-UPDATE   TO TRUE                      10730000
107400              MOVE DP015-RED         TO STRGRPC                   10740000
107500              MOVE DP015-REVERSE     TO STRGRPH                   10750000
107600              MOVE -1                TO STRGRPL                   10760000
107700         WHEN CA-RECORD-NOT-FOUND                                 10770000
107800              INITIALIZE CA-RECORD                                10780000
107900              SET PMT-INDX           TO 20                        10790000
108000              SET PS-EDIT-ERROR      TO TRUE                      10800000
108100              SET CA-CANNOT-UPDATE   TO TRUE                      10810000
108200              MOVE DP015-RED         TO STRGRPC                   10820000
108300              MOVE DP015-REVERSE     TO STRGRPH                   10830000
108400              MOVE -1                TO STRGRPL                   10840000
108500         WHEN ANY                                                 10850000
108600              PERFORM 8300-READ-STORE-TABLE                       10860000
108700              IF  CA-STORE-GROUP-NMBR = CA-LAST-STORE-GROUP       10870000
108800                  PERFORM 5000-PAINT-SCREEN                       10880000
108900              ELSE                                                10890000
109000                  PERFORM 5100-DISPLAY-RECORD                     10900000
109100              END-IF                                              10910000
109200     END-EVALUATE.                                                10920000
109300******************************************************************10930000
109400*  PROCESS THE DELETE OF A STORE GROUP NUMBER                    *10940000
109500*     1.  DELETE FROM THE CASH REFUND AUTHORIZATION CONTROL      *10950000
109600*         TABLE (TRDCNTL)                                        *10960000
109700*     2.  DO POST-DELETE PROCESSING                              *10970000
109800******************************************************************10980000
109900 2310-DELETE-RECORD.                                              10990000
110000                                                                  11000000
110100     PERFORM 8500-DELETE-REFUND-AUTH.                             11010000
110200                                                                  11020000
110300     IF  PS-NO-EDIT-ERROR                                         11030000
110400         SET PMT-INDX                TO 27                        11040000
110500         SET CA-CANNOT-UPDATE        TO TRUE                      11050000
110600         MOVE DP015-WHITE            TO AMSGC                     11060000
110700         MOVE -1                     TO FUNCTL                    11070000
110800         MOVE CA-FUNCTION            TO FUNCTO                    11080000
110900                                                                  11090000
111000         EXEC CICS SYNCPOINT                                      11100000
111100         END-EXEC                                                 11110000
111200                                                                  11120000
111300         INITIALIZE                                               11130000
111400                    CA-STORE-GROUP-NMBR                           11140000
111500                    CA-RECORD                                     11150000
111600     END-IF.                                                      11160000
111700******************************************************************11170000
111800*  UPDATE THE STORE TABLE                                        *11180000
111900******************************************************************11190000
112000 4000-PREPARE-UPDATE.                                             11200000
112100                                                                  11210000
112200     EVALUATE TRUE                                                11220000
112300         WHEN CA-FUNCTION = PC-ADD                                11230000
112400              MOVE CA-STORE-GROUP-NMBR                            11240000
112500                                     TO PV-STORE-GROUP-NMBR       11250000
112600         WHEN CA-UPDATE-STORE-TO-0 (PA-SUB3)                      11260000
112700              MOVE PC-STORE-GROUP-00 TO PV-STORE-GROUP-NMBR       11270000
112800         WHEN CA-UPDATE-STORE-TO-NEW (PA-SUB3)                    11280000
112900              MOVE CA-STORE-GROUP-NMBR                            11290000
113000                                     TO PV-STORE-GROUP-NMBR       11300000
113100     END-EVALUATE.                                                11310000
113200                                                                  11320000
113300     MOVE CA-ASSOCIATED-STORES (PA-SUB3)                          11330000
113400                                     TO PV-STORE.                 11340000
113500                                                                  11350000
113600     IF  CA-UPDATE-STORE-YES (PA-SUB3)                            11360000
113700         SET PS-STORE-UPDATE         TO TRUE                      11370000
113800         SET PS-UPDATE-MADE          TO TRUE                      11380000
113900         PERFORM 8400-UPDATE-STORE-TABLE                          11390000
114000     END-IF.                                                      11400000
114100******************************************************************11410000
114200*  BUILD MAP WHEN THE STORE-GROUP NUMBER DID NOT CHANGE          *11420000
114300******************************************************************11430000
114400 5000-PAINT-SCREEN.                                               11440000
114500                                                                  11450000
114600     MOVE CA-FUNCTION                TO FUNCTO.                   11460000
114700     MOVE CA-STORE-GROUP-NMBR        TO STRGRPO.                  11470000
114800     MOVE CA-DESCRIPTION             TO GRPDESCO.                 11480000
114900     MOVE CA-REFUND-ACTIVITY-PRD     TO ACTPRDO.                  11490000
115000     MOVE CA-MAX-REFUND-PER-PRD      TO MAXPERPO.                 11500000
115100     MOVE CA-MAX-REFUND-AMT-PER-PRD  TO PE-CASH-MASK.             11510000
115200     MOVE PE-CASH-MASK               TO MAXAMTPO.                 11520000
115300     MOVE CA-MAX-REFUND-PER-DAY      TO MAXPERDO.                 11530000
115400     MOVE CA-MAX-REFUND-AMT-PER-DAY  TO PE-CASH-MASK.             11540000
115500     MOVE PE-CASH-MASK               TO MAXAMTDO.                 11550000
115600     MOVE CA-MAX-NMBR-OF-STORES      TO MAXSTRDO.                 11560000
115700                                                                  11570000
115800     IF  CA-LO-RFND-AUTH-AMT > ZERO                               11580000
115900         MOVE CA-LO-RFND-AUTH-AMT    TO PE-AUTH-AMT-MASK          11590000
116000         MOVE PE-AUTH-AMT-MASK       TO LOWRFNDO                  11600000
116100     ELSE                                                         11610000
116200         MOVE SPACES                 TO LOWRFNDO                  11620000
116300     END-IF.                                                      11630000
116400                                                                  11640000
116500     IF  CA-HGH-RFND-AUTH-AMT > ZERO                              11650000
116600         MOVE CA-HGH-RFND-AUTH-AMT   TO PE-AUTH-AMT-MASK          11660000
116700         MOVE PE-AUTH-AMT-MASK       TO HGHRFNDO                  11670000
116800     ELSE                                                         11680000
116900         MOVE SPACES                 TO HGHRFNDO                  11690000
117000     END-IF.                                                      11700000
117100                                                                  11710000
117200     IF  CA-MAX-CSH-BCK-AMT > ZERO                                11720000
117300         MOVE CA-MAX-CSH-BCK-AMT     TO PE-AUTH-AMT-MASK          11730000
117400         MOVE PE-AUTH-AMT-MASK       TO CSHBACKO                  11740000
117500     ELSE                                                         11750000
117600         MOVE SPACES                 TO CSHBACKO                  11760000
117700     END-IF.                                                      11770000
117800                                                                  11780000
117900     MOVE 1                          TO PA-SUB1                   11790000
118000                                        PA-SUB2                   11800000
118100                                        PA-SUB3.                  11810000
118200                                                                  11820000
118300     IF  CA-STORE-GROUP-NMBR =  PC-STORE-GROUP-00                 11830000
118400         PERFORM                                                  11840000
118500           VARYING PA-SUB3 FROM 1 BY 1                            11850000
118600             UNTIL PA-SUB3 > PC-MAX-STORES                        11860000
118700                                                                  11870000
118800             MOVE DP015-PRO-DRK-OFF                               11880000
118900               TO STRNBRA (PA-SUB1, PA-SUB2)                      11890000
119000             ADD 1                   TO PA-SUB2                   11900000
119100             IF  PA-SUB2 > PC-STORE-COLUMNS                       11910000
119200                 MOVE 1              TO PA-SUB2                   11920000
119300                 ADD 1               TO PA-SUB1                   11930000
119400             END-IF                                               11940000
119500         END-PERFORM                                              11950000
119600     ELSE                                                         11960000
119700         PERFORM                                                  11970000
119800           VARYING PA-SUB3 FROM 1 BY 1                            11980000
119900             UNTIL CA-ASSOCIATED-STORES (PA-SUB3) = ZERO          11990000
120000                OR PA-SUB3 > PC-MAX-STORES                        12000000
120100                                                                  12010000
120200             IF  CA-UPDATE-STORE-TO-0 (PA-SUB3)                   12020000
120300                 CONTINUE                                         12030000
120400             ELSE                                                 12040000
120500                 MOVE CA-ASSOCIATED-STORES (PA-SUB3)              12050000
120600                   TO STRNBRO (PA-SUB1, PA-SUB2)                  12060000
120700                 ADD 1               TO PA-SUB2                   12070000
120800             END-IF                                               12080000
120900             IF  PA-SUB2 > PC-STORE-COLUMNS                       12090000
121000                 MOVE 1              TO PA-SUB2                   12100000
121100                 ADD 1               TO PA-SUB1                   12110000
121200             END-IF                                               12120000
121300         END-PERFORM                                              12130000
121400     END-IF.                                                      12140000
121500                                                                  12150000
121600     IF  CA-DESCRIPTION = SPACES                                  12160000
121700         INITIALIZE CA-RECORD                                     12170000
121800         SET PMT-INDX                TO 20                        12180000
121900         SET PS-EDIT-ERROR           TO TRUE                      12190000
122000         SET CA-CANNOT-UPDATE        TO TRUE                      12200000
122100         SET CA-RECORD-NOT-FOUND     TO TRUE                      12210000
122200         MOVE DP015-RED              TO STRGRPC                   12220000
122300         MOVE DP015-REVERSE          TO STRGRPH                   12230000
122400         MOVE -1                     TO STRGRPL                   12240000
122500     END-IF.                                                      12250000
122600******************************************************************12260000
122700*  BUILD MAP WHEN THE STORE-GROUP NUMBER CHANGED                 *12270000
122800******************************************************************12280000
122900 5100-DISPLAY-RECORD.                                             12290000
123000                                                                  12300000
123100     MOVE LOW-VALUES                 TO RD009AI.                  12310000
123200     MOVE CA-FUNCTION                TO FUNCTO.                   12320000
123300     INITIALIZE CA-STORES.                                        12330000
123400                                                                  12340000
123500     PERFORM 8800-READ-REFUND-AUTH.                               12350000
123600                                                                  12360000
123700     IF  SQLCODE = ZERO                                           12370000
123800         MOVE -1                     TO FUNCTL                    12380000
123900         PERFORM 5110-PROCEED-WITH-DISPLAY                        12390000
124000     ELSE                                                         12400000
124100         INITIALIZE CA-RECORD                                     12410000
124200         SET PMT-INDX                TO 20                        12420000
124300         SET PS-EDIT-ERROR           TO TRUE                      12430000
124400         SET CA-CANNOT-UPDATE        TO TRUE                      12440000
124500         MOVE DP015-RED              TO STRGRPC                   12450000
124600         MOVE DP015-REVERSE          TO STRGRPH                   12460000
124700         MOVE -1                     TO STRGRPL                   12470000
124800     END-IF.                                                      12480000
124900******************************************************************12490000
125000*  BUILD MAP WHEN THE STORE-GROUP NUMBER CHANGED                 *12500000
125100******************************************************************12510000
125200 5110-PROCEED-WITH-DISPLAY.                                       12520000
125300                                                                  12530000
125400     MOVE RDCNTL-AUTH-GP-NBR         TO STRGRPO                   12540000
125500                                        CA-STORE-GROUP-NMBR.      12550000
125600     MOVE RDCNTL-AUTH-GP-DESC        TO GRPDESCO                  12560000
125700                                        CA-DESCRIPTION.           12570000
125800     MOVE RDCNTL-ACTVY-PER-DAY-NBR   TO ACTPRDO                   12580000
125900                                        CA-REFUND-ACTIVITY-PRD.   12590000
126000     MOVE RDCNTL-MAX-RET-PER-NBR     TO MAXPERPO                  12600000
126100                                        CA-MAX-REFUND-PER-PRD.    12610000
126200     MOVE RDCNTL-MAX-DOL-RT-PER-AMT  TO PE-CASH-MASK              12620000
126300                                        CA-MAX-REFUND-AMT-PER-PRD.12630000
126400     MOVE PE-CASH-MASK               TO MAXAMTPO.                 12640000
126500     MOVE RDCNTL-MAX-RET-DAY-NBR     TO MAXPERDO                  12650000
126600                                        CA-MAX-REFUND-PER-DAY.    12660000
126700     MOVE RDCNTL-MAX-DOL-RT-DAY-AMT  TO PE-CASH-MASK              12670000
126800                                        CA-MAX-REFUND-AMT-PER-DAY.12680000
126900     MOVE PE-CASH-MASK               TO MAXAMTDO.                 12690000
127000     MOVE RDCNTL-MAX-STR-DAY-NBR     TO MAXSTRDO                  12700000
127100                                        CA-MAX-NMBR-OF-STORES.    12710000
127200     IF  RDCNTL-LO-RFND-AUTH-AMT > ZERO                           12720000
127300         MOVE RDCNTL-LO-RFND-AUTH-AMT                             12730000
127400                                     TO PE-AUTH-AMT-MASK          12740000
127500                                        CA-LO-RFND-AUTH-AMT       12750000
127600         MOVE PE-AUTH-AMT-MASK       TO LOWRFNDO                  12760000
127700     ELSE                                                         12770000
127800         MOVE RDCNTL-LO-RFND-AUTH-AMT                             12780000
127900                                     TO CA-LO-RFND-AUTH-AMT       12790000
128000         MOVE SPACES                 TO LOWRFNDO                  12800000
128100     END-IF.                                                      12810000
128200                                                                  12820000
128300     IF  RDCNTL-HGH-RFND-AUTH-AMT > ZERO                          12830000
128400         MOVE RDCNTL-HGH-RFND-AUTH-AMT                            12840000
128500                                     TO PE-AUTH-AMT-MASK          12850000
128600                                        CA-HGH-RFND-AUTH-AMT      12860000
128700         MOVE PE-AUTH-AMT-MASK       TO HGHRFNDO                  12870000
128800     ELSE                                                         12880000
128900         MOVE RDCNTL-HGH-RFND-AUTH-AMT                            12890000
129000                                     TO CA-HGH-RFND-AUTH-AMT      12900000
129100         MOVE SPACES                 TO HGHRFNDO                  12910000
129200     END-IF.                                                      12920000
129300                                                                  12930000
129400     IF  RDCNTL-MAX-CSH-BCK-AMT > ZERO                            12940000
129500         MOVE RDCNTL-MAX-CSH-BCK-AMT                              12950000
129600                                     TO PE-AUTH-AMT-MASK          12960000
129700                                        CA-MAX-CSH-BCK-AMT        12970000
129800         MOVE PE-AUTH-AMT-MASK       TO CSHBACKO                  12980000
129900     ELSE                                                         12990000
130000         MOVE RDCNTL-MAX-CSH-BCK-AMT                              13000000
130100                                     TO CA-MAX-CSH-BCK-AMT        13010000
130200         MOVE SPACES                 TO CSHBACKO                  13020000
130300     END-IF.                                                      13030000
130400                                                                  13040000
130500     MOVE 1                          TO PA-SUB1                   13050000
130600                                        PA-SUB2                   13060000
130700                                        PA-SUB3.                  13070000
130800                                                                  13080000
130900     IF  CA-STORE-GROUP-NMBR =  PC-STORE-GROUP-00                 13090000
131000         PERFORM                                                  13100000
131100           VARYING PA-SUB3 FROM 1 BY 1                            13110000
131200             UNTIL PA-SUB3 > PC-MAX-STORES                        13120000
131300                                                                  13130000
131400             MOVE DP015-PRO-DRK-OFF                               13140000
131500               TO STRNBRA (PA-SUB1, PA-SUB2)                      13150000
131600             ADD 1                   TO PA-SUB2                   13160000
131700             IF  PA-SUB2 > PC-STORE-COLUMNS                       13170000
131800                 MOVE 1              TO PA-SUB2                   13180000
131900                 ADD 1               TO PA-SUB1                   13190000
132000             END-IF                                               13200000
132100         END-PERFORM                                              13210000
132200     ELSE                                                         13220000
132300         MOVE 1                          TO PA-SUB1               13230000
132400                                            PA-SUB2               13240000
132500                                            PA-SUB3               13250000
132600                                                                  13260000
132700         PERFORM 8900-OPEN-STORE-CURSOR                           13270000
132800         PERFORM 5120-FETCH-STORE                                 13280000
132900             UNTIL SQLCODE = +100                                 13290000
133000                OR PA-SUB3 > PC-MAX-STORES                        13300000
133100         PERFORM 8910-CLOSE-STORE-CURSOR                          13310000
133200     END-IF.                                                      13320000
133300                                                                  13330000
133400******************************************************************13340000
133500*  FETCH NEXT STORE NUMBER BELONGING TO THE STORE-GROUP NUMBER   *13350000
133600******************************************************************13360000
133700 5120-FETCH-STORE.                                                13370000
133800                                                                  13380000
133900     PERFORM 8700-FETCH-STORE.                                    13390000
134000                                                                  13400000
134100     IF  SQLCODE  = ZERO                                          13410000
134200         MOVE XST00001-LOC-NBR                                    13420000
134300           TO STRNBRI (PA-SUB1, PA-SUB2)                          13430000
134400         MOVE XST00001-LOC-NBR                                    13440000
134500           TO CA-ASSOCIATED-STORES (PA-SUB3)                      13450000
134600         ADD 1                       TO PA-SUB2                   13460000
134700                                        PA-SUB3                   13470000
134800         IF PA-SUB2 > PC-STORE-COLUMNS                            13480000
134900            MOVE 1                   TO PA-SUB2                   13490000
135000            ADD 1                    TO PA-SUB1                   13500000
135100         END-IF                                                   13510000
135200     END-IF.                                                      13520000
135300******************************************************************13530000
135400*   EDIT STORE GROUP NUMBER                                       13540000
135500******************************************************************13550000
135600 6000-EDIT-STORE-GROUP.                                           13560000
135700                                                                  13570000
135800     IF  STRGRPA = PC-HEX-80                                      13580000
135900         MOVE ZERO                   TO CA-STORE-GROUP-NMBR       13590000
136000     END-IF.                                                      13600000
136100                                                                  13610000
136200     IF  STRGRPL = ZERO                                           13620000
136300         IF  CA-STORE-GROUP-NMBR NUMERIC                          13630000
136400             MOVE CA-STORE-GROUP-NMBR                             13640000
136500                                     TO STRGRPO                   13650000
136600          ELSE                                                    13660000
136700             MOVE CA-STORE-GROUP-NMBR-X                           13670000
136800                                     TO STRGRPO                   13680000
136900         END-IF                                                   13690000
137000     ELSE                                                         13700000
137100          MOVE STRGRPI               TO CA-STORE-GROUP-NMBR-X     13710000
137200     END-IF.                                                      13720000
137300                                                                  13730000
137400     MOVE STRGRPO                    TO DP010I-UNEDITED-FIELD.    13740000
137500     MOVE 2                          TO DP010I-MAXIMUM-DIGITS.    13750000
137600     MOVE ZERO                       TO DP010I-MAXIMUM-DECIMALS.  13760000
137700     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     13770000
137810     CALL DP010I-NUMERIC-EDIT-ROUTINE                             13781000
137820                         USING DP010I-NUMERIC-EDIT-AREA           13782000
137900                                                                  13790000
138000     IF  DP010I-ERROR-DETECTED                                    13800000
138100         MOVE ZERO                   TO CA-LAST-STORE-GROUP       13810000
138200         MOVE DP015-REVERSE          TO STRGRPH                   13820000
138300         MOVE DP015-RED              TO STRGRPC                   13830000
138400         IF  PS-NO-EDIT-ERROR                                     13840000
138500             SET PMT-INDX            TO 4                         13850000
138600             SET PS-EDIT-ERROR       TO TRUE                      13860000
138700             MOVE -1                 TO STRGRPL                   13870000
138800         END-IF                                                   13880000
138900     ELSE                                                         13890000
139000         MOVE DP010I-NUMERIC-FIELD   TO CA-STORE-GROUP-NMBR       13900000
139100     END-IF.                                                      13910000
139200******************************************************************13920000
139300*   EDIT THE OTHER FIELDS                                         13930000
139400******************************************************************13940000
139500 6100-EDIT-OTHER-FIELDS.                                          13950000
139600                                                                  13960000
139700***                                                               13970000
139800***  EDIT STORE GROUP DESCRIPTION                                 13980000
139900***                                                               13990000
140000     IF  GRPDESCA = PC-HEX-80                                     14000000
140100         MOVE SPACES                 TO CA-DESCRIPTION            14010000
140200     END-IF.                                                      14020000
140300                                                                  14030000
140400     IF  GRPDESCL = ZERO                                          14040000
140500         MOVE CA-DESCRIPTION         TO GRPDESCO                  14050000
140600     ELSE                                                         14060000
140700         SET CA-CHANGE               TO TRUE                      14070000
140800     END-IF.                                                      14080000
140900                                                                  14090000
141000     IF  GRPDESCO > SPACES                                        14100000
141100         MOVE GRPDESCO               TO CA-DESCRIPTION            14110000
141200     ELSE                                                         14120000
141300         MOVE DP015-REVERSE          TO GRPDESCH                  14130000
141400         MOVE DP015-RED              TO GRPDESCC                  14140000
141500         MOVE GRPDESCO               TO CA-DESCRIPTION            14150000
141600         IF  PS-NO-EDIT-ERROR                                     14160000
141700             SET PS-EDIT-ERROR       TO TRUE                      14170000
141800             SET PMT-INDX            TO 5                         14180000
141900             MOVE -1                 TO GRPDESCL                  14190000
142000         END-IF                                                   14200000
142100                                                                  14210000
142200     END-IF.                                                      14220000
142300                                                                  14230000
142400***                                                               14240000
142500***  EDIT ACTIVITY PERIOD  ***                                    14250000
142600***                                                               14260000
142700     IF  ACTPRDA = PC-HEX-80                                      14270000
142800         MOVE ZERO                   TO CA-REFUND-ACTIVITY-PRD    14280000
142900     END-IF.                                                      14290000
143000                                                                  14300000
143100     IF  ACTPRDL = ZERO                                           14310000
143200         IF  CA-REFUND-ACTIVITY-PRD NUMERIC                       14320000
143300             MOVE CA-REFUND-ACTIVITY-PRD                          14330000
143400                                     TO ACTPRDO                   14340000
143500          ELSE                                                    14350000
143600             MOVE CA-REFUND-ACTIVITY-PRD-X                        14360000
143700                                     TO ACTPRDO                   14370000
143800         END-IF                                                   14380000
143900     ELSE                                                         14390000
144000         MOVE ACTPRDI                TO CA-REFUND-ACTIVITY-PRD-X  14400000
144100         SET CA-CHANGE               TO TRUE                      14410000
144200     END-IF.                                                      14420000
144300                                                                  14430000
144400     MOVE ACTPRDO                    TO DP010I-UNEDITED-FIELD.    14440000
144500     MOVE 2                          TO DP010I-MAXIMUM-DIGITS.    14450000
144600     MOVE ZERO                       TO DP010I-MAXIMUM-DECIMALS.  14460000
144700     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     14470000
144810     CALL DP010I-NUMERIC-EDIT-ROUTINE                             14481000
144820                         USING DP010I-NUMERIC-EDIT-AREA           14482000
144900                                                                  14490000
145000     IF  DP010I-ERROR-DETECTED                                    14500000
145100         MOVE DP015-REVERSE          TO ACTPRDH                   14510000
145200         MOVE DP015-RED              TO ACTPRDC                   14520000
145300         IF  PS-NO-EDIT-ERROR                                     14530000
145400             SET PS-EDIT-ERROR       TO TRUE                      14540000
145500             SET PMT-INDX            TO 6                         14550000
145600             MOVE -1                 TO ACTPRDL                   14560000
145700         END-IF                                                   14570000
145800     ELSE                                                         14580000
145900         MOVE DP010I-NUMERIC-FIELD   TO CA-REFUND-ACTIVITY-PRD    14590000
146000         IF  CA-REFUND-ACTIVITY-PRD-VALID                         14600000
146100             CONTINUE                                             14610000
146200         ELSE                                                     14620000
146300             MOVE DP015-REVERSE      TO ACTPRDH                   14630000
146400             MOVE DP015-RED          TO ACTPRDC                   14640000
146500             IF  PS-NO-EDIT-ERROR                                 14650000
146600                 SET PS-EDIT-ERROR   TO TRUE                      14660000
146700                 SET PMT-INDX        TO 6                         14670000
146800                 MOVE -1             TO ACTPRDL                   14680000
146900             END-IF                                               14690000
147000         END-IF                                                   14700000
147100     END-IF.                                                      14710000
147200                                                                  14720000
147300***                                                               14730000
147400***  EDIT MAX REFUNDS PER PERIOD                                  14740000
147500***                                                               14750000
147600     IF  MAXPERPA = PC-HEX-80                                     14760000
147700         MOVE ZERO                   TO CA-MAX-REFUND-PER-PRD     14770000
147800     END-IF.                                                      14780000
147900                                                                  14790000
148000     IF  MAXPERPL = ZERO                                          14800000
148100         IF  CA-MAX-REFUND-PER-PRD NUMERIC                        14810000
148200             MOVE CA-MAX-REFUND-PER-PRD                           14820000
148300                                     TO MAXPERPO                  14830000
148400         ELSE                                                     14840000
148500             MOVE CA-MAX-REFUND-PER-PRD-X                         14850000
148600                                     TO MAXPERPO                  14860000
148700         END-IF                                                   14870000
148800     ELSE                                                         14880000
148900         MOVE MAXPERPI               TO CA-MAX-REFUND-PER-PRD-X   14890000
149000         SET CA-CHANGE               TO TRUE                      14900000
149100     END-IF.                                                      14910000
149200                                                                  14920000
149300     MOVE MAXPERPO                   TO DP010I-UNEDITED-FIELD.    14930000
149400     MOVE 1                          TO DP010I-MAXIMUM-DIGITS.    14940000
149500     MOVE ZERO                       TO DP010I-MAXIMUM-DECIMALS.  14950000
149600     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     14960000
149710     CALL DP010I-NUMERIC-EDIT-ROUTINE                             14971000
149720                         USING DP010I-NUMERIC-EDIT-AREA           14972000
149800                                                                  14980000
149900     IF  DP010I-ERROR-DETECTED                                    14990000
150000         MOVE DP015-REVERSE          TO MAXPERPH                  15000000
150100         MOVE DP015-RED              TO MAXPERPC                  15010000
150200         IF  PS-NO-EDIT-ERROR                                     15020000
150300             SET PS-EDIT-ERROR       TO TRUE                      15030000
150400             SET PMT-INDX            TO 8                         15040000
150500             MOVE -1                 TO MAXPERPL                  15050000
150600         END-IF                                                   15060000
150700     ELSE                                                         15070000
150800         MOVE DP010I-NUMERIC-FIELD   TO CA-MAX-REFUND-PER-PRD     15080000
150900         IF  CA-MAX-REFUND-PER-PRD-VALID                          15090000
151000             CONTINUE                                             15100000
151100         ELSE                                                     15110000
151200             MOVE DP015-REVERSE      TO MAXPERPH                  15120000
151300             MOVE DP015-RED          TO MAXPERPC                  15130000
151400             IF  PS-NO-EDIT-ERROR                                 15140000
151500                 SET PS-EDIT-ERROR   TO TRUE                      15150000
151600                 SET PMT-INDX        TO 8                         15160000
151700                 MOVE -1             TO MAXPERPL                  15170000
151800             END-IF                                               15180000
151900         END-IF                                                   15190000
152000     END-IF.                                                      15200000
152100                                                                  15210000
152200***                                                               15220000
152300***  EDIT REFUND AMT PER PERIOD                                   15230000
152400***                                                               15240000
152500     IF  MAXAMTPA = PC-HEX-80                                     15250000
152600         MOVE ZERO                   TO CA-MAX-REFUND-AMT-PER-PRD 15260000
152700     END-IF.                                                      15270000
152800                                                                  15280000
152900     IF  MAXAMTPL = ZERO                                          15290000
153000         IF  CA-MAX-REFUND-AMT-PER-PRD NUMERIC                    15300000
153100             MOVE CA-MAX-REFUND-AMT-PER-PRD                       15310000
153200                                     TO PE-CASH-MASK              15320000
153300             MOVE PE-CASH-MASK       TO MAXAMTPO                  15330000
153400         ELSE                                                     15340000
153500             MOVE CA-MAX-REFUND-AMT-PER-PRD-X                     15350000
153600                                     TO MAXAMTPO                  15360000
153700         END-IF                                                   15370000
153800     ELSE                                                         15380000
153900         MOVE MAXAMTPI                                            15390000
154000           TO CA-MAX-REFUND-AMT-PER-PRD-X                         15400000
154100         SET CA-CHANGE               TO TRUE                      15410000
154200     END-IF.                                                      15420000
154300                                                                  15430000
154400     MOVE MAXAMTPO                   TO DP010I-UNEDITED-FIELD.    15440000
154500     MOVE 5                          TO DP010I-MAXIMUM-DIGITS.    15450000
154600     MOVE ZERO                       TO DP010I-MAXIMUM-DECIMALS.  15460000
154700     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     15470000
154810     CALL DP010I-NUMERIC-EDIT-ROUTINE                             15481000
154820                         USING DP010I-NUMERIC-EDIT-AREA           15482000
154900                                                                  15490000
155000     IF  DP010I-ERROR-DETECTED                                    15500000
155100      OR DP010I-NUMERIC-FIELD = ZERO                              15510000
155200         MOVE DP015-REVERSE          TO MAXAMTPH                  15520000
155300         MOVE DP015-RED              TO MAXAMTPC                  15530000
155400         IF  PS-NO-EDIT-ERROR                                     15540000
155500             SET PMT-INDX            TO 17                        15550000
155600             SET PS-EDIT-ERROR       TO TRUE                      15560000
155700             MOVE -1                 TO MAXAMTPL                  15570000
155800         END-IF                                                   15580000
155900     ELSE                                                         15590000
156000         IF  DP010I-NUMERIC-FIELD > 9999                          15600000
156100             MOVE DP015-REVERSE      TO MAXAMTPH                  15610000
156200             MOVE DP015-RED          TO MAXAMTPC                  15620000
156300             IF  PS-NO-EDIT-ERROR                                 15630000
156400                 SET PMT-INDX        TO 23                        15640000
156500                 SET PS-EDIT-ERROR   TO TRUE                      15650000
156600                 MOVE -1             TO MAXAMTPL                  15660000
156700             END-IF                                               15670000
156800         ELSE                                                     15680000
156900             MOVE DP010I-NUMERIC-FIELD                            15690000
157000                                     TO CA-MAX-REFUND-AMT-PER-PRD 15700000
157100         END-IF                                                   15710000
157200     END-IF.                                                      15720000
157300                                                                  15730000
157400***                                                               15740000
157500***  EDIT MAX REFUNDS PER DAY                                     15750000
157600***                                                               15760000
157700     IF  MAXPERDA = PC-HEX-80                                     15770000
157800         MOVE ZERO                   TO CA-MAX-REFUND-PER-DAY     15780000
157900     END-IF.                                                      15790000
158000                                                                  15800000
158100     IF  MAXPERDL = ZERO                                          15810000
158200         IF  CA-MAX-REFUND-PER-DAY NUMERIC                        15820000
158300             MOVE CA-MAX-REFUND-PER-DAY                           15830000
158400                                     TO MAXPERDO                  15840000
158500         ELSE                                                     15850000
158600             MOVE CA-MAX-REFUND-PER-DAY-X                         15860000
158700                                     TO MAXPERDO                  15870000
158800         END-IF                                                   15880000
158900     ELSE                                                         15890000
159000         MOVE MAXPERDI               TO CA-MAX-REFUND-PER-DAY-X   15900000
159100         SET CA-CHANGE               TO TRUE                      15910000
159200     END-IF.                                                      15920000
159300                                                                  15930000
159400     MOVE MAXPERDO                   TO DP010I-UNEDITED-FIELD.    15940000
159500     MOVE 1                          TO DP010I-MAXIMUM-DIGITS.    15950000
159600     MOVE ZERO                       TO DP010I-MAXIMUM-DECIMALS.  15960000
159700     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     15970000
159810     CALL DP010I-NUMERIC-EDIT-ROUTINE                             15981000
159820                         USING DP010I-NUMERIC-EDIT-AREA           15982000
159900                                                                  15990000
160000     IF  DP010I-ERROR-DETECTED                                    16000000
160100         MOVE DP015-REVERSE          TO MAXPERDH                  16010000
160200         MOVE DP015-RED              TO MAXPERDC                  16020000
160300         IF  PS-NO-EDIT-ERROR                                     16030000
160400             SET PS-EDIT-ERROR       TO TRUE                      16040000
160500             SET PMT-INDX            TO 7                         16050000
160600             MOVE -1                 TO MAXPERDL                  16060000
160700         END-IF                                                   16070000
160800     ELSE                                                         16080000
160900         MOVE DP010I-NUMERIC-FIELD   TO CA-MAX-REFUND-PER-DAY     16090000
161000         IF  CA-MAX-REFUND-PER-DAY-VALID                          16100000
161100             CONTINUE                                             16110000
161200         ELSE                                                     16120000
161300             MOVE DP015-REVERSE      TO MAXPERDH                  16130000
161400             MOVE DP015-RED          TO MAXPERDC                  16140000
161500             IF  PS-NO-EDIT-ERROR                                 16150000
161600                 SET PS-EDIT-ERROR   TO TRUE                      16160000
161700                 SET PMT-INDX        TO 7                         16170000
161800                 MOVE -1             TO MAXPERDL                  16180000
161900             END-IF                                               16190000
162000         END-IF                                                   16200000
162100     END-IF.                                                      16210000
162200                                                                  16220000
162300***                                                               16230000
162400***  EDIT MAX REFUND AMT PER DAY                                  16240000
162500***                                                               16250000
162600     IF  MAXAMTDA = PC-HEX-80                                     16260000
162700         MOVE ZERO                   TO CA-MAX-REFUND-AMT-PER-DAY 16270000
162800     END-IF.                                                      16280000
162900                                                                  16290000
163000     IF  MAXAMTDL = ZERO                                          16300000
163100         IF  CA-MAX-REFUND-AMT-PER-DAY NUMERIC                    16310000
163200             MOVE CA-MAX-REFUND-AMT-PER-DAY                       16320000
163300                                     TO PE-CASH-MASK              16330000
163400             MOVE PE-CASH-MASK       TO MAXAMTDO                  16340000
163500         ELSE                                                     16350000
163600             MOVE CA-MAX-REFUND-AMT-PER-DAY-X                     16360000
163700                                     TO MAXAMTDO                  16370000
163800         END-IF                                                   16380000
163900     ELSE                                                         16390000
164000         SET CA-CHANGE               TO TRUE                      16400000
164100         MOVE MAXAMTDI                                            16410000
164200           TO CA-MAX-REFUND-AMT-PER-DAY-X                         16420000
164300     END-IF.                                                      16430000
164400                                                                  16440000
164500     MOVE MAXAMTDO                   TO DP010I-UNEDITED-FIELD.    16450000
164600     MOVE 5                          TO DP010I-MAXIMUM-DIGITS.    16460000
164700     MOVE ZERO                       TO DP010I-MAXIMUM-DECIMALS.  16470000
164800     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     16480000
164910     CALL DP010I-NUMERIC-EDIT-ROUTINE                             16491000
164920                         USING DP010I-NUMERIC-EDIT-AREA           16492000
165000                                                                  16500000
165100     IF  DP010I-ERROR-DETECTED                                    16510000
165200      OR DP010I-NUMERIC-FIELD = ZERO                              16520000
165300         MOVE DP015-REVERSE          TO MAXAMTDH                  16530000
165400         MOVE DP015-RED              TO MAXAMTDC                  16540000
165500         IF  PS-NO-EDIT-ERROR                                     16550000
165600             SET PMT-INDX            TO 9                         16560000
165700             SET PS-EDIT-ERROR       TO TRUE                      16570000
165800             MOVE -1                 TO MAXAMTDL                  16580000
165900         END-IF                                                   16590000
166000     ELSE                                                         16600000
166100         IF  DP010I-NUMERIC-FIELD > 9999                          16610000
166200             MOVE DP015-REVERSE      TO MAXAMTDH                  16620000
166300             MOVE DP015-RED          TO MAXAMTDC                  16630000
166400             IF  PS-NO-EDIT-ERROR                                 16640000
166500                 SET PMT-INDX        TO 15                        16650000
166600                 SET PS-EDIT-ERROR   TO TRUE                      16660000
166700                 MOVE -1             TO MAXAMTDL                  16670000
166800             END-IF                                               16680000
166900         ELSE                                                     16690000
167000             MOVE DP010I-NUMERIC-FIELD                            16700000
167100                                     TO CA-MAX-REFUND-AMT-PER-DAY 16710000
167200         END-IF                                                   16720000
167300     END-IF.                                                      16730000
167400                                                                  16740000
167500***                                                               16750000
167600***  EDIT MAX STORES PER DAY                                      16760000
167700***                                                               16770000
167800     IF  MAXSTRDA = PC-HEX-80                                     16780000
167900         MOVE ZERO                   TO CA-MAX-NMBR-OF-STORES     16790000
168000     END-IF.                                                      16800000
168100                                                                  16810000
168200     IF  MAXSTRDL = ZERO                                          16820000
168300         IF  CA-MAX-NMBR-OF-STORES NUMERIC                        16830000
168400             MOVE CA-MAX-NMBR-OF-STORES                           16840000
168500                                     TO MAXSTRDO                  16850000
168600         ELSE                                                     16860000
168700             MOVE CA-MAX-NMBR-OF-STORES-X                         16870000
168800                                     TO MAXSTRDO                  16880000
168900         END-IF                                                   16890000
169000     ELSE                                                         16900000
169100         MOVE MAXSTRDI               TO CA-MAX-NMBR-OF-STORES-X   16910000
169200         SET CA-CHANGE               TO TRUE                      16920000
169300     END-IF.                                                      16930000
169400                                                                  16940000
169500     MOVE MAXSTRDO                   TO DP010I-UNEDITED-FIELD.    16950000
169600     MOVE 1                          TO DP010I-MAXIMUM-DIGITS.    16960000
169700     MOVE ZERO                       TO DP010I-MAXIMUM-DECIMALS.  16970000
169800     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     16980000
169910     CALL DP010I-NUMERIC-EDIT-ROUTINE                             16991000
169920                         USING DP010I-NUMERIC-EDIT-AREA           16992000
170000                                                                  17000000
170100     IF  DP010I-ERROR-DETECTED                                    17010000
170200         MOVE DP015-REVERSE          TO MAXSTRDH                  17020000
170300         MOVE DP015-RED              TO MAXSTRDC                  17030000
170400         IF  PS-NO-EDIT-ERROR                                     17040000
170500             SET PS-EDIT-ERROR       TO TRUE                      17050000
170600             SET PMT-INDX            TO 11                        17060000
170700             MOVE -1                 TO MAXSTRDL                  17070000
170800         END-IF                                                   17080000
170900     ELSE                                                         17090000
171000         MOVE DP010I-NUMERIC-FIELD   TO CA-MAX-NMBR-OF-STORES     17100000
171100         IF  CA-MAX-NMBR-OF-STORES-VALID                          17110000
171200             CONTINUE                                             17120000
171300         ELSE                                                     17130000
171400             MOVE DP015-REVERSE      TO MAXSTRDH                  17140000
171500             MOVE DP015-RED          TO MAXSTRDC                  17150000
171600             IF  PS-NO-EDIT-ERROR                                 17160000
171700                 SET PS-EDIT-ERROR   TO TRUE                      17170000
171800                 SET PMT-INDX        TO 11                        17180000
171900                 MOVE -1             TO MAXSTRDL                  17190000
172000             END-IF                                               17200000
172100         END-IF                                                   17210000
172200     END-IF.                                                      17220000
172300                                                                  17230000
172400***                                                               17240000
172500***  EDIT LOW REFUND AUTHORIZED AMOUNT (CASH REFUND)              17250000
172600***       THIS FIELD MUST BE POSITIVE AND NUMERIC, BUT IT         17260000
172700***       CAN BE ZEROS.                                           17270000
172800***                                                               17280000
172900     IF  LOWRFNDA = PC-HEX-80                                     17290000
173000         MOVE ZERO                   TO CA-LO-RFND-AUTH-AMT       17300000
173100     END-IF.                                                      17310000
173200                                                                  17320000
173300     IF  LOWRFNDL = ZERO                                          17330000
173400         IF  CA-LO-RFND-AUTH-AMT NUMERIC                          17340000
173500             MOVE CA-LO-RFND-AUTH-AMT                             17350000
173600                                     TO PE-AUTH-AMT-MASK          17360000
173700             MOVE PE-AUTH-AMT-MASK   TO LOWRFNDO                  17370000
173800         ELSE                                                     17380000
173900             MOVE CA-LO-RFND-AUTH-AMT-X                           17390000
174000                                     TO LOWRFNDO                  17400000
174100         END-IF                                                   17410000
174200     ELSE                                                         17420000
174300         SET CA-CHANGE               TO TRUE                      17430000
174400         MOVE LOWRFNDI                                            17440000
174500           TO CA-LO-RFND-AUTH-AMT-X                               17450000
174600     END-IF.                                                      17460000
174700                                                                  17470000
174800     MOVE LOWRFNDO                   TO DP010I-UNEDITED-FIELD.    17480000
174900     MOVE 5                          TO DP010I-MAXIMUM-DIGITS.    17490000
175000     MOVE 2                          TO DP010I-MAXIMUM-DECIMALS.  17500000
175100     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     17510000
175210     CALL DP010I-NUMERIC-EDIT-ROUTINE                             17521000
175220                         USING DP010I-NUMERIC-EDIT-AREA           17522000
175300                                                                  17530000
175400     IF  DP010I-ERROR-DETECTED                                    17540000
175500         MOVE DP015-REVERSE          TO LOWRFNDH                  17550000
175600         MOVE DP015-RED              TO LOWRFNDC                  17560000
175700         IF  PS-NO-EDIT-ERROR                                     17570000
175800             IF DP010I-MAX-DIGITS-EXCEEDED                        17580000
175900                 SET PMT-INDX        TO 32                        17590000
176000             ELSE                                                 17600000
176100                 IF DP010I-MAX-DECIMALS-EXCEEDED                  17610000
176200                     SET PMT-INDX    TO 33                        17620000
176300                 ELSE                                             17630000
176400                     SET PMT-INDX    TO 31                        17640000
176500                 END-IF                                           17650000
176600             END-IF                                               17660000
176700             SET PS-EDIT-ERROR       TO TRUE                      17670000
176800             MOVE -1                 TO LOWRFNDL                  17680000
176900         END-IF                                                   17690000
177000     ELSE                                                         17700000
177100         MOVE DP010I-NUMERIC-FIELD   TO CA-LO-RFND-AUTH-AMT       17710000
177200     END-IF.                                                      17720000
177300                                                                  17730000
177400***                                                               17740000
177500***  EDIT HIGH REFUND  AUTHORIZED AMOUNT (MAIL CHECK)             17750000
177600***       THIS FIELD MUST BE POSITIVE AND NUMERIC.  IT MUST       17760000
177700***       BE GREATER THAN ZERO AND GREATER THAN THE CASH          17770000
177800***       REFUND AMOUNT (LO-RFND-AUTH-AMT).                       17780000
177900***                                                               17790000
178000     IF  HGHRFNDA = PC-HEX-80                                     17800000
178100         MOVE ZERO                   TO CA-HGH-RFND-AUTH-AMT      17810000
178200     END-IF.                                                      17820000
178300                                                                  17830000
178400     IF  HGHRFNDL = ZERO                                          17840000
178500         IF  CA-HGH-RFND-AUTH-AMT NUMERIC                         17850000
178600             MOVE CA-HGH-RFND-AUTH-AMT                            17860000
178700                                     TO PE-AUTH-AMT-MASK          17870000
178800             MOVE PE-AUTH-AMT-MASK   TO HGHRFNDO                  17880000
178900         ELSE                                                     17890000
179000             MOVE CA-HGH-RFND-AUTH-AMT-X                          17900000
179100                                     TO HGHRFNDO                  17910000
179200         END-IF                                                   17920000
179300     ELSE                                                         17930000
179400         SET CA-CHANGE               TO TRUE                      17940000
179500         MOVE HGHRFNDI                                            17950000
179600           TO CA-HGH-RFND-AUTH-AMT-X                              17960000
179700     END-IF.                                                      17970000
179800                                                                  17980000
179900     MOVE HGHRFNDO                   TO DP010I-UNEDITED-FIELD.    17990000
180000     MOVE 5                          TO DP010I-MAXIMUM-DIGITS.    18000000
180100     MOVE 2                          TO DP010I-MAXIMUM-DECIMALS.  18010000
180200     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     18020000
180310     CALL DP010I-NUMERIC-EDIT-ROUTINE                             18031000
180320                         USING DP010I-NUMERIC-EDIT-AREA           18032000
180400                                                                  18040000
180500     IF  DP010I-ERROR-DETECTED                                    18050000
180600         MOVE DP015-REVERSE          TO HGHRFNDH                  18060000
180700         MOVE DP015-RED              TO HGHRFNDC                  18070000
180800         IF  PS-NO-EDIT-ERROR                                     18080000
180900             IF DP010I-MAX-DIGITS-EXCEEDED                        18090000
181000                 SET PMT-INDX        TO 35                        18100000
181100             ELSE                                                 18110000
181200                 IF DP010I-MAX-DECIMALS-EXCEEDED                  18120000
181300                     SET PMT-INDX    TO 36                        18130000
181400                 ELSE                                             18140000
181500                     SET PMT-INDX    TO 34                        18150000
181600                 END-IF                                           18160000
181700             END-IF                                               18170000
181800             SET PS-EDIT-ERROR       TO TRUE                      18180000
181900             MOVE -1                 TO HGHRFNDL                  18190000
182000         END-IF                                                   18200000
182100     ELSE                                                         18210000
182200         IF  PS-NO-EDIT-ERROR AND                                 18220000
182300             ((DP010I-NUMERIC-FIELD = ZERO) OR                    18230000
182400             (DP010I-NUMERIC-FIELD = CA-LO-RFND-AUTH-AMT) OR      18240000
182500             (DP010I-NUMERIC-FIELD < CA-LO-RFND-AUTH-AMT))        18250000
182600             MOVE DP015-REVERSE  TO HGHRFNDH                      18260000
182700             MOVE DP015-RED      TO HGHRFNDC                      18270000
182800             IF  PS-NO-EDIT-ERROR                                 18280000
182900                 SET PMT-INDX    TO 37                            18290000
183000                 SET PS-EDIT-ERROR TO TRUE                        18300000
183100                 MOVE -1         TO HGHRFNDL                      18310000
183200             END-IF                                               18320000
183300         ELSE                                                     18330000
183400             MOVE DP010I-NUMERIC-FIELD                            18340000
183500                                 TO CA-HGH-RFND-AUTH-AMT          18350000
183600         END-IF                                                   18360000
183700     END-IF.                                                      18370000
183800                                                                  18380000
183900***                                                               18390000
184000***  EDIT MAXIMUM KMRC CASH BACK AMOUNT                           18400000
184100***       THIS AMOUNT MUST BE POSITIVE AND NUMERIC, BUT           18410000
184200***       IT CAN BE ZEROS.                                        18420000
184300                                                                  18430000
184400     IF  CSHBACKA = PC-HEX-80                                     18440000
184500          MOVE ZERO                  TO CA-MAX-CSH-BCK-AMT        18450000
184600     END-IF.                                                      18460000
184700                                                                  18470000
184800     IF  CSHBACKL = ZERO                                          18480000
184900         IF  CA-MAX-CSH-BCK-AMT NUMERIC                           18490000
185000             MOVE CA-MAX-CSH-BCK-AMT                              18500000
185100                                     TO PE-AUTH-AMT-MASK          18510000
185200             MOVE PE-AUTH-AMT-MASK   TO CSHBACKO                  18520000
185300         ELSE                                                     18530000
185400             MOVE CA-MAX-CSH-BCK-AMT-X                            18540000
185500                                     TO CSHBACKO                  18550000
185600         END-IF                                                   18560000
185700     ELSE                                                         18570000
185800         SET CA-CHANGE               TO TRUE                      18580000
185900         MOVE CSHBACKI                                            18590000
186000           TO CA-MAX-CSH-BCK-AMT-X                                18600000
186100     END-IF.                                                      18610000
186200                                                                  18620000
186300     MOVE CSHBACKO                   TO DP010I-UNEDITED-FIELD.    18630000
186400     MOVE 5                          TO DP010I-MAXIMUM-DIGITS.    18640000
186500     MOVE 2                          TO DP010I-MAXIMUM-DECIMALS.  18650000
186600     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     18660000
186710     CALL DP010I-NUMERIC-EDIT-ROUTINE                             18671000
186720                         USING DP010I-NUMERIC-EDIT-AREA           18672000
186800                                                                  18680000
186900     IF  DP010I-ERROR-DETECTED                                    18690000
187000         MOVE DP015-REVERSE          TO CSHBACKH                  18700000
187100         MOVE DP015-RED              TO CSHBACKC                  18710000
187200         IF  PS-NO-EDIT-ERROR                                     18720000
187300             IF DP010I-MAX-DIGITS-EXCEEDED                        18730000
187400                 SET PMT-INDX        TO 39                        18740000
187500             ELSE                                                 18750000
187600                 IF DP010I-MAX-DECIMALS-EXCEEDED                  18760000
187700                     SET PMT-INDX    TO 40                        18770000
187800                 ELSE                                             18780000
187900                     SET PMT-INDX    TO 38                        18790000
188000                 END-IF                                           18800000
188100             END-IF                                               18810000
188200             SET PS-EDIT-ERROR       TO TRUE                      18820000
188300             MOVE -1                 TO CSHBACKL                  18830000
188400         END-IF                                                   18840000
188500     ELSE                                                         18850000
188600         MOVE DP010I-NUMERIC-FIELD   TO CA-MAX-CSH-BCK-AMT        18860000
188700     END-IF.                                                      18870000
188800                                                                  18880000
188900***                                                               18890000
189000***  EDIT ASSOCIATED STORES                                       18900000
189100***                                                               18910000
189200     MOVE 1                          TO PA-SUB1                   18920000
189300                                        PA-SUB2                   18930000
189400                                        PA-SUB3.                  18940000
189500                                                                  18950000
189600     IF  CA-STORE-GROUP-NMBR =  PC-STORE-GROUP-00                 18960000
189700         PERFORM                                                  18970000
189800           VARYING PA-SUB3 FROM 1 BY 1                            18980000
189900             UNTIL PA-SUB3 > PC-MAX-STORES                        18990000
190000                                                                  19000000
190100             MOVE DP015-PRO-DRK-OFF                               19010000
190200               TO STRNBRA (PA-SUB1, PA-SUB2)                      19020000
190300             ADD 1                   TO PA-SUB2                   19030000
190400             IF  PA-SUB2 > PC-STORE-COLUMNS                       19040000
190500                 MOVE 1              TO PA-SUB2                   19050000
190600                 ADD 1               TO PA-SUB1                   19060000
190700             END-IF                                               19070000
190800         END-PERFORM                                              19080000
190900     ELSE                                                         19090000
191000        PERFORM 6110-EDIT-ASSOCIATED-STORES                       19100000
191100          UNTIL PA-SUB3 > PC-MAX-STORES                           19110000
191200     END-IF.                                                      19120000
191300******************************************************************19130000
191400*        EDIT THE STORES ASSIGNED TO THE STORE-GROUP NUMBER       19140000
191500******************************************************************19150000
191600 6110-EDIT-ASSOCIATED-STORES.                                     19160000
191700                                                                  19170000
191800     EVALUATE TRUE                                                19180000
191900         WHEN STRNBRA (PA-SUB1, PA-SUB2) = PC-HEX-80              19190000
192000              IF  CA-ASSOCIATED-STORES (PA-SUB3) > ZERO           19200000
192100                  SET CA-UPDATE-STORE-TO-0 (PA-SUB3)              19210000
192200                                     TO TRUE                      19220000
192300                  SET CA-CHANGE      TO TRUE                      19230000
192400              ELSE                                                19240000
192500                  SET CA-UPDATE-STORE-NO (PA-SUB3)                19250000
192600                                     TO TRUE                      19260000
192700              END-IF                                              19270000
192800         WHEN STRNBRL (PA-SUB1, PA-SUB2) = ZERO                   19280000
192900              IF  CA-ASSOCIATED-STORES (PA-SUB3) NUMERIC          19290000
193000                  IF  CA-ASSOCIATED-STORES (PA-SUB3) > ZERO       19300000
193100                  AND NOT CA-UPDATE-STORE-TO-0 (PA-SUB3)          19310000
193200                      MOVE CA-ASSOCIATED-STORES (PA-SUB3)         19320000
193300                        TO STRNBRO (PA-SUB1, PA-SUB2)             19330000
193400                  END-IF                                          19340000
193500              ELSE                                                19350000
193600                  MOVE CA-ASSOCIATED-STORES (PA-SUB3)             19360000
193700                    TO STRNBRO (PA-SUB1, PA-SUB2)                 19370000
193800              END-IF                                              19380000
193900         WHEN STRNBRI(PA-SUB1, PA-SUB2) > SPACES                  19390000
194000              MOVE STRNBRI (PA-SUB1, PA-SUB2)                     19400000
194100                TO CA-ASSOCIATED-STORES (PA-SUB3)                 19410000
194200              SET CA-UPDATE-STORE-TO-NEW (PA-SUB3)                19420000
194300                                     TO TRUE                      19430000
194400              SET CA-CHANGE          TO TRUE                      19440000
194500         WHEN STRNBRI(PA-SUB1, PA-SUB2) = SPACES                  19450000
194600              IF  CA-ASSOCIATED-STORES (PA-SUB3) > ZERO           19460000
194700                  SET CA-UPDATE-STORE-TO-0 (PA-SUB3)              19470000
194800                                     TO TRUE                      19480000
194900                  SET CA-CHANGE      TO TRUE                      19490000
195000              ELSE                                                19500000
195100                  SET CA-UPDATE-STORE-NO (PA-SUB3)                19510000
195200                                     TO TRUE                      19520000
195300              END-IF                                              19530000
195400     END-EVALUATE.                                                19540000
195500                                                                  19550000
195600     IF  STRNBRO (PA-SUB1, PA-SUB2) > SPACES                      19560000
195700         MOVE STRNBRO (PA-SUB1, PA-SUB2)                          19570000
195800                                     TO DP010I-UNEDITED-FIELD     19580000
195900         MOVE 5                      TO DP010I-MAXIMUM-DIGITS     19590000
196000         MOVE ZERO                   TO DP010I-MAXIMUM-DECIMALS   19600000
196100         SET DP010I-NEGATIVE-NOT-ALLOWED                          19610000
196200                                     TO TRUE                      19620000
196310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         19631000
196320                         USING DP010I-NUMERIC-EDIT-AREA           19632000
196400                                                                  19640000
196500         IF  DP010I-ERROR-DETECTED                                19650000
196600          OR DP010I-NUMERIC-FIELD = ZERO                          19660000
196700             MOVE DP015-RED                                       19670000
196800               TO STRNBRC (PA-SUB1, PA-SUB2)                      19680000
196900             MOVE DP015-REVERSE                                   19690000
197000               TO STRNBRH (PA-SUB1, PA-SUB2)                      19700000
197100             IF  PS-NO-EDIT-ERROR                                 19710000
197200                 SET PMT-INDX        TO 12                        19720000
197300                 SET PS-EDIT-ERROR   TO TRUE                      19730000
197400                 MOVE -1                                          19740000
197500                   TO STRNBRL (PA-SUB1, PA-SUB2)                  19750000
197600             END-IF                                               19760000
197700         ELSE                                                     19770000
197800             MOVE DP010I-NUMERIC-FIELD                            19780000
197900               TO CA-ASSOCIATED-STORES (PA-SUB3)                  19790000
198000             PERFORM 6111-REFUND-STORE-TABLE                      19800000
198100         END-IF                                                   19810000
198200     END-IF.                                                      19820000
198300                                                                  19830000
198400     ADD 1                           TO PA-SUB2                   19840000
198500                                        PA-SUB3.                  19850000
198600     IF  PA-SUB2 > PC-STORE-COLUMNS                               19860000
198700         MOVE 1                      TO PA-SUB2                   19870000
198800         ADD 1                       TO PA-SUB1                   19880000
198900     END-IF.                                                      19890000
199000******************************************************************19900000
199100*   REFUND STORE NUMBER AT THE STORE TABLE                        19910000
199200******************************************************************19920000
199300 6111-REFUND-STORE-TABLE.                                         19930000
199400                                                                  19940000
199500     MOVE CA-ASSOCIATED-STORES (PA-SUB3)                          19950000
199600                                     TO PV-STORE.                 19960000
199700                                                                  19970000
199800     PERFORM 8600-READ-STORE-TABLE.                               19980000
199900                                                                  19990000
200000     EVALUATE TRUE                                                20000000
200100         WHEN SQLCODE = ZERO                                      20010000
200200              PERFORM 6112-REFUND-WHEN-FOUND                      20020000
200300         WHEN SQLCODE = +100                                      20030000
200400              IF  PS-NO-EDIT-ERROR                                20040000
200500                  SET PMT-INDX       TO 12                        20050000
200600                  SET PS-EDIT-ERROR  TO TRUE                      20060000
200700                  MOVE DP015-RED                                  20070000
200800                    TO STRNBRC (PA-SUB1, PA-SUB2)                 20080000
200900                  MOVE DP015-REVERSE                              20090000
201000                    TO STRNBRH (PA-SUB1, PA-SUB2)                 20100000
201100                  MOVE -1                                         20110000
201200                    TO STRNBRL (PA-SUB1, PA-SUB2)                 20120000
201300              END-IF                                              20130000
201400     END-EVALUATE.                                                20140000
201500******************************************************************20150000
201600*   FURTHER VALIDATION OF THE STORE # BY REFUNDING CLOSED-DATE    20160000
201700******************************************************************20170000
201800 6112-REFUND-WHEN-FOUND.                                          20180000
201900                                                                  20190000
202000     PERFORM 9800-UPDATE-SCREEN-HEADER.                           20200000
202100                                                                  20210000
202200     EVALUATE TRUE                                                20220000
202300         WHEN XST00001-LOC-TYP-CDE NOT = PC-DEPARTMENT-STORE      20230000
202400              IF  PS-NO-EDIT-ERROR                                20240000
202500                  SET PMT-INDX       TO 29                        20250000
202600                  SET PS-EDIT-ERROR  TO TRUE                      20260000
202700                  SET CA-UPDATE-STORE-NO (PA-SUB3)                20270000
202800                                     TO TRUE                      20280000
202900                  MOVE DP015-RED                                  20290000
203000                    TO STRNBRC (PA-SUB1, PA-SUB2)                 20300000
203100                  MOVE DP015-REVERSE                              20310000
203200                    TO STRNBRH (PA-SUB1, PA-SUB2)                 20320000
203300                  MOVE -1                                         20330000
203400                    TO STRNBRL (PA-SUB1, PA-SUB2)                 20340000
203500              END-IF                                              20350000
203600         WHEN PV-DATE > XST00001-CLO-DTE                          20360000
203700          AND XST00025-CSH-RFND-GP-NBR NOT = CA-STORE-GROUP-NMBR  20370000
203800              IF  PS-NO-EDIT-ERROR                                20380000
203900                  SET PMT-INDX       TO 28                        20390000
204000                  SET PS-EDIT-ERROR  TO TRUE                      20400000
204100                  SET CA-UPDATE-STORE-NO (PA-SUB3)                20410000
204200                                     TO TRUE                      20420000
204300                  MOVE DP015-RED                                  20430000
204400                    TO STRNBRC (PA-SUB1, PA-SUB2)                 20440000
204500                  MOVE DP015-REVERSE                              20450000
204600                    TO STRNBRH (PA-SUB1, PA-SUB2)                 20460000
204700                  MOVE -1                                         20470000
204800                    TO STRNBRL (PA-SUB1, PA-SUB2)                 20480000
204900              END-IF                                              20490000
205000         WHEN XST00025-CSH-RFND-GP-NBR NOT = CA-STORE-GROUP-NMBR  20500000
205100          AND XST00025-CSH-RFND-GP-NBR     > ZERO                 20510000
205200          AND STRNBRL (PA-SUB1, PA-SUB2)   > ZERO                 20520000
205300              IF  PS-NO-EDIT-ERROR                                20530000
205400                  SET PMT-INDX       TO 14                        20540000
205500                  SET PS-EDIT-ERROR  TO TRUE                      20550000
205600                  SET CA-UPDATE-STORE-NO (PA-SUB3)                20560000
205700                                     TO TRUE                      20570000
205800                  MOVE DP015-RED                                  20580000
205900                    TO STRNBRC (PA-SUB1, PA-SUB2)                 20590000
206000                  MOVE DP015-REVERSE                              20600000
206100                    TO STRNBRH (PA-SUB1, PA-SUB2)                 20610000
206200                  MOVE -1                                         20620000
206300                    TO STRNBRL (PA-SUB1, PA-SUB2)                 20630000
206400              END-IF                                              20640000
206500     END-EVALUATE.                                                20650000
206600******************************************************************20660000
206700*    INSERT ROW INTO CASH REFUND AUTHORIZATION CONTROL TABLE      20670000
206800*    (TRDCNTL)                                                    20680000
206900******************************************************************20690000
207000 8100-INSERT-REFUND-AUTH.                                         20700000
207100                                                                  20710000
207200     MOVE CA-MAX-REFUND-AMT-PER-PRD  TO PV-MAX-REFUND-AMT-PER-PRD.20720000
207300     MOVE CA-MAX-REFUND-AMT-PER-DAY  TO PV-MAX-REFUND-AMT-PER-DAY.20730000
207400     MOVE CA-LO-RFND-AUTH-AMT        TO PV-LO-RFND-AUTH-AMT.      20740000
207500     MOVE CA-HGH-RFND-AUTH-AMT       TO PV-HGH-RFND-AUTH-AMT.     20750000
207600     MOVE CA-MAX-CSH-BCK-AMT         TO PV-MAX-CSH-BCK-AMT.       20760000
207700                                                                  20770000
207800     PERFORM                                                      20780000
207900       VARYING PA-RETRY-COUNT FROM 1 BY 1                         20790000
208000         UNTIL PA-RETRY-COUNT > PC-MAX-RETRY                      20800000
208100                                                                  20810000
208200         EXEC SQL                                                 20820000
208300              INSERT                                              20830000
208400                INTO TRDCNTL                                      20840000
208500                     (AUTH_GP_NBR,                                20850000
208600                      AUTH_GP_DESC,                               20860000
208700                      ACTVY_PER_DAY_NBR,                          20870000
208800                      MAX_RET_PER_NBR,                            20880000
208900                      MAX_DOL_RT_PER_AMT,                         20890000
209000                      MAX_STR_DAY_NBR,                            20900000
209100                      MAX_RET_DAY_NBR,                            20910000
209200                      MAX_DOL_RT_DAY_AMT,                         20920000
209300                      LO_RFND_AUTH_AMT,                           20930000
209400                      HGH_RFND_AUTH_AMT,                          20940000
209500                      MAX_CSH_BCK_AMT)                            20950000
209600              VALUES (:CA-STORE-GROUP-NMBR,                       20960000
209700                      :CA-DESCRIPTION,                            20970000
209800                      :CA-REFUND-ACTIVITY-PRD,                    20980000
209900                      :CA-MAX-REFUND-PER-PRD,                     20990000
210000                      :PV-MAX-REFUND-AMT-PER-PRD,                 21000000
210100                      :CA-MAX-NMBR-OF-STORES,                     21010000
210200                      :CA-MAX-REFUND-PER-DAY,                     21020000
210300                      :PV-MAX-REFUND-AMT-PER-DAY,                 21030000
210400                      :PV-LO-RFND-AUTH-AMT,                       21040000
210500                      :PV-HGH-RFND-AUTH-AMT,                      21050000
210600                      :PV-MAX-CSH-BCK-AMT)                        21060000
210700         END-EXEC                                                 21070000
210800                                                                  21080000
210900         EVALUATE TRUE                                            21090000
211000             WHEN SQLCODE = ZERO                                  21100000
211100             WHEN SQLCODE = -803                                  21110000
211200                  MOVE PC-MORE-THAN-MAX-RETRY                     21120000
211300                                     TO PA-RETRY-COUNT            21130000
211400             WHEN SQLCODE = -904                                  21140000
211500             WHEN SQLCODE = -913                                  21150000
211600                  CONTINUE                                        21160000
211700             WHEN SQLCODE < ZERO                                  21170000
211800                  PERFORM 9300-SQL-ERROR                          21180000
211900             WHEN SQLCODE > ZERO                                  21190000
212000             WHEN SQLWARN0 = 'W'                                  21200000
212100                  PERFORM 9400-SQL-WARNING                        21210000
212200         END-EVALUATE                                             21220000
212300                                                                  21230000
212400     END-PERFORM.                                                 21240000
212500                                                                  21250000
212600     IF  SQLCODE  = ZERO                                          21260000
212700      OR SQLCODE = -803                                           21270000
212800         CONTINUE                                                 21280000
212900     ELSE                                                         21290000
213000         PERFORM 9300-SQL-ERROR                                   21300000
213100     END-IF.                                                      21310000
213200******************************************************************21320000
213300*    UPDATE ROW IN CASH REFUND AUTHORIZATION CONTROL TABLE        21330000
213400*    (TRDCNTL).                                                   21340000
213500******************************************************************21350000
213600 8200-UPDATE-REFUND-AUTH.                                         21360000
213700                                                                  21370000
213800     MOVE CA-MAX-REFUND-AMT-PER-PRD  TO PV-MAX-REFUND-AMT-PER-PRD.21380000
213900     MOVE CA-MAX-REFUND-AMT-PER-DAY  TO PV-MAX-REFUND-AMT-PER-DAY.21390000
214000     MOVE CA-LO-RFND-AUTH-AMT        TO PV-LO-RFND-AUTH-AMT.      21400000
214100     MOVE CA-HGH-RFND-AUTH-AMT       TO PV-HGH-RFND-AUTH-AMT.     21410000
214200     MOVE CA-MAX-CSH-BCK-AMT         TO PV-MAX-CSH-BCK-AMT.       21420000
214300                                                                  21430000
214400     PERFORM                                                      21440000
214500       VARYING PA-RETRY-COUNT FROM 1 BY 1                         21450000
214600         UNTIL PA-RETRY-COUNT > PC-MAX-RETRY                      21460000
214700                                                                  21470000
214800     EXEC SQL                                                     21480000
214900          UPDATE TRDCNTL                                          21490000
215000             SET AUTH_GP_DESC       = :CA-DESCRIPTION,            21500000
215100                 ACTVY_PER_DAY_NBR  = :CA-REFUND-ACTIVITY-PRD,    21510000
215200                 MAX_RET_PER_NBR    = :CA-MAX-REFUND-PER-PRD,     21520000
215300                 MAX_DOL_RT_PER_AMT = :PV-MAX-REFUND-AMT-PER-PRD, 21530000
215400                 MAX_RET_DAY_NBR    = :CA-MAX-REFUND-PER-DAY,     21540000
215500                 MAX_DOL_RT_DAY_AMT = :PV-MAX-REFUND-AMT-PER-DAY, 21550000
215600                 MAX_STR_DAY_NBR    = :CA-MAX-NMBR-OF-STORES,     21560000
215700                 LO_RFND_AUTH_AMT   = :PV-LO-RFND-AUTH-AMT,       21570000
215800                 HGH_RFND_AUTH_AMT  = :PV-HGH-RFND-AUTH-AMT,      21580000
215900                 MAX_CSH_BCK_AMT    = :PV-MAX-CSH-BCK-AMT         21590000
216000           WHERE AUTH_GP_NBR        = :CA-STORE-GROUP-NMBR        21600000
216100         END-EXEC                                                 21610000
216200                                                                  21620000
216300         EVALUATE TRUE                                            21630000
216400             WHEN SQLCODE = ZERO                                  21640000
216500                  MOVE PC-MORE-THAN-MAX-RETRY                     21650000
216600                                     TO PA-RETRY-COUNT            21660000
216700             WHEN SQLCODE = -904                                  21670000
216800             WHEN SQLCODE = -913                                  21680000
216900                  CONTINUE                                        21690000
217000             WHEN SQLCODE < ZERO                                  21700000
217100                  PERFORM 9300-SQL-ERROR                          21710000
217200             WHEN SQLCODE > ZERO                                  21720000
217300             WHEN SQLWARN0 = 'W'                                  21730000
217400                  PERFORM 9400-SQL-WARNING                        21740000
217500         END-EVALUATE                                             21750000
217600                                                                  21760000
217700     END-PERFORM.                                                 21770000
217800                                                                  21780000
217900     IF  SQLCODE = ZERO                                           21790000
218000         MOVE -1                     TO FUNCTL                    21800000
218100         SET PMT-INDX                TO 18                        21810000
218200         MOVE DP015-WHITE            TO AMSGC                     21820000
218300         EXEC CICS SYNCPOINT                                      21830000
218400         END-EXEC                                                 21840000
218500     ELSE                                                         21850000
218600          PERFORM 9300-SQL-ERROR                                  21860000
218700     END-IF.                                                      21870000
218800******************************************************************21880000
218900*    READ THE STORE TABLE TO GET THE STORE NUMBER                 21890000
219000******************************************************************21900000
219100 8300-READ-STORE-TABLE.                                           21910000
219200                                                                  21920000
219300     PERFORM                                                      21930000
219400       VARYING PA-RETRY-COUNT FROM 1 BY 1                         21940000
219500         UNTIL PA-RETRY-COUNT > PC-MAX-RETRY                      21950000
219600                                                                  21960000
219700         EXEC SQL                                                 21970000
219800              SELECT A.LOC_NBR                                    21980000
219900                INTO :XST00001-LOC-NBR                            21990000
220000                FROM XST_LOC A,                                   22000000
220100                     XST_LOC_ATTR B                               22010000
220200               WHERE B.LOC_NBR         = A.LOC_NBR                22020000
220300                 AND B.CSH_RFND_GP_NBR = :CA-STORE-GROUP-NMBR     22030000
220400         END-EXEC                                                 22040000
220500                                                                  22050000
220600         EVALUATE TRUE                                            22060000
220700             WHEN SQLCODE = ZERO                                  22070000
220800             WHEN SQLCODE = -811                                  22080000
220900                  SET PMT-INDX       TO 24                        22090000
221000                  SET CA-CANNOT-UPDATE                            22100000
221100                                     TO TRUE                      22110000
221200                  MOVE -1            TO FUNCTL                    22120000
221300                  MOVE PC-MORE-THAN-MAX-RETRY                     22130000
221400                                     TO PA-RETRY-COUNT            22140000
221500             WHEN SQLCODE = +100                                  22150000
221600                  SET PMT-INDX       TO 25                        22160000
221700                  SET CA-CAN-UPDATE  TO TRUE                      22170000
221800                  MOVE DP015-WHITE   TO AMSGC                     22180000
221900                  MOVE PC-MORE-THAN-MAX-RETRY                     22190000
222000                                     TO PA-RETRY-COUNT            22200000
222100             WHEN SQLCODE = -904                                  22210000
222200             WHEN SQLCODE = -913                                  22220000
222300                  CONTINUE                                        22230000
222400             WHEN SQLCODE < ZERO                                  22240000
222500                  PERFORM 9300-SQL-ERROR                          22250000
222600             WHEN SQLWARN0 = 'W'                                  22260000
222700             WHEN SQLCODE > ZERO                                  22270000
222800                  PERFORM 9400-SQL-WARNING                        22280000
222900         END-EVALUATE                                             22290000
223000     END-PERFORM.                                                 22300000
223100                                                                  22310000
223200     IF  SQLCODE = ZERO                                           22320000
223300      OR SQLCODE = +100                                           22330000
223400      OR SQLCODE = -811                                           22340000
223500         CONTINUE                                                 22350000
223600     ELSE                                                         22360000
223700          PERFORM 9300-SQL-ERROR                                  22370000
223800     END-IF.                                                      22380000
223900******************************************************************22390000
224000*    UPDATE THE LOCATION ATTRIBUTE TABLE WITH A                   22400000
224100*    NEW STORE-GROUP NUMBER                                       22410000
224200******************************************************************22420000
224300 8400-UPDATE-STORE-TABLE.                                         22430000
224400                                                                  22440000
224500****                                                              22450000
224600**** UPDATE THE LOCATION ATTRIBUTE TABLE                          22460000
224700****                                                              22470000
224800     PERFORM                                                      22480000
224900       VARYING PA-RETRY-COUNT FROM 1 BY 1                         22490000
225000         UNTIL PA-RETRY-COUNT > PC-MAX-RETRY                      22500000
225100                                                                  22510000
225200         EXEC SQL                                                 22520000
225300             UPDATE XST_LOC_ATTR                                  22530000
225400                SET CSH_RFND_GP_NBR = :PV-STORE-GROUP-NMBR        22540000
225500              WHERE LOC_NBR = :PV-STORE                           22550000
225600         END-EXEC                                                 22560000
225700                                                                  22570000
225800         EVALUATE TRUE                                            22580000
225900             WHEN SQLCODE = ZERO                                  22590000
226000                 MOVE PC-MORE-THAN-MAX-RETRY                      22600000
226100                                     TO PA-RETRY-COUNT            22610000
226200             WHEN SQLCODE = -913                                  22620000
226300             WHEN SQLCODE = -904                                  22630000
226400                 CONTINUE                                         22640000
226500             WHEN SQLCODE < ZERO                                  22650000
226600                 PERFORM 9300-SQL-ERROR                           22660000
226700             WHEN SQLWARN0 = 'W'                                  22670000
226800             WHEN SQLCODE > ZERO                                  22680000
226900                 PERFORM 9400-SQL-WARNING                         22690000
227000         END-EVALUATE                                             22700000
227100     END-PERFORM.                                                 22710000
227200                                                                  22720000
227300     IF  SQLCODE = ZERO                                           22730000
227400         CONTINUE                                                 22740000
227500     ELSE                                                         22750000
227600         PERFORM 9300-SQL-ERROR                                   22760000
227700     END-IF.                                                      22770000
227800******************************************************************22780000
227900*   DELETE ROW FROM THE CASH REFUND AUTHORIZATION CONTROL TABLE   22790000
228000*   (TRDCNTL)                                                     22800000
228100******************************************************************22810000
228200 8500-DELETE-REFUND-AUTH.                                         22820000
228300                                                                  22830000
228400     PERFORM                                                      22840000
228500       VARYING PA-RETRY-COUNT FROM 1 BY 1                         22850000
228600         UNTIL PA-RETRY-COUNT > PC-MAX-RETRY                      22860000
228700                                                                  22870000
228800         EXEC SQL                                                 22880000
228900             DELETE FROM TRDCNTL                                  22890000
229000                WHERE AUTH_GP_NBR = :CA-STORE-GROUP-NMBR          22900000
229100         END-EXEC                                                 22910000
229200                                                                  22920000
229300         EVALUATE TRUE                                            22930000
229400             WHEN SQLCODE = ZERO                                  22940000
229500                  MOVE PC-MORE-THAN-MAX-RETRY                     22950000
229600                                     TO PA-RETRY-COUNT            22960000
229700             WHEN SQLCODE = +100                                  22970000
229800                  IF  PS-NO-EDIT-ERROR                            22980000
229900                      INITIALIZE CA-RECORD                        22990000
230000                      SET PMT-INDX   TO 20                        23000000
230100                      SET PS-EDIT-ERROR                           23010000
230200                                     TO TRUE                      23020000
230300                      SET CA-CANNOT-UPDATE                        23030000
230400                                     TO TRUE                      23040000
230500                      MOVE DP015-RED  TO STRGRPC                  23050000
230600                      MOVE DP015-REVERSE                          23060000
230700                                     TO STRGRPH                   23070000
230800                      MOVE -1        TO STRGRPL                   23080000
230900                  END-IF                                          23090000
231000                  MOVE PC-MORE-THAN-MAX-RETRY                     23100000
231100                                     TO PA-RETRY-COUNT            23110000
231200             WHEN SQLCODE = -904                                  23120000
231300             WHEN SQLCODE = -913                                  23130000
231400                  CONTINUE                                        23140000
231500             WHEN SQLCODE < ZERO                                  23150000
231600                  PERFORM 9300-SQL-ERROR                          23160000
231700             WHEN SQLWARN0 = 'W'                                  23170000
231800             WHEN SQLCODE > ZERO                                  23180000
231900                  PERFORM 9400-SQL-WARNING                        23190000
232000         END-EVALUATE                                             23200000
232100     END-PERFORM.                                                 23210000
232200                                                                  23220000
232300     IF  SQLCODE = ZERO                                           23230000
232400      OR SQLCODE = +100                                           23240000
232500         CONTINUE                                                 23250000
232600     ELSE                                                         23260000
232700         PERFORM 9300-SQL-ERROR                                   23270000
232800     END-IF.                                                      23280000
232900******************************************************************23290000
233000*    READ THE STORE TABLE TO GET OTHER INFO                       23300000
233100******************************************************************23310000
233200 8600-READ-STORE-TABLE.                                           23320000
233300                                                                  23330000
233400      PERFORM                                                     23340000
233500        VARYING PA-RETRY-COUNT FROM 1 BY 1                        23350000
233600          UNTIL PA-RETRY-COUNT > PC-MAX-RETRY                     23360000
233700                                                                  23370000
233800         EXEC SQL                                                 23380000
233900              SELECT A.LOC_NBR,                                   23390000
234000                     B.CSH_RFND_GP_NBR,                           23400000
234100                     A.LOC_TYP_CDE,                               23410000
234200                     A.CLO_DTE                                    23420000
234300                INTO :XST00001-LOC-NBR,                           23430000
234400                     :XST00025-CSH-RFND-GP-NBR,                   23440000
234500                     :XST00001-LOC-TYP-CDE,                       23450000
234600                     :XST00001-CLO-DTE                            23460000
234700                FROM XST_LOC A,                                   23470000
234800                     XST_LOC_ATTR B                               23480000
234900               WHERE A.LOC_NBR = B.LOC_NBR                        23490000
235000                 AND A.LOC_NBR = :PV-STORE                        23500000
235100         END-EXEC                                                 23510000
235200                                                                  23520000
235300         EVALUATE TRUE                                            23530000
235400             WHEN SQLCODE = ZERO                                  23540000
235500             WHEN SQLCODE = +100                                  23550000
235600                  MOVE PC-MORE-THAN-MAX-RETRY                     23560000
235700                                     TO PA-RETRY-COUNT            23570000
235800             WHEN SQLCODE = -904                                  23580000
235900             WHEN SQLCODE = -913                                  23590000
236000                  CONTINUE                                        23600000
236100             WHEN SQLCODE < ZERO                                  23610000
236200                  PERFORM 9300-SQL-ERROR                          23620000
236300             WHEN SQLWARN0 = 'W'                                  23630000
236400             WHEN SQLCODE > ZERO                                  23640000
236500                  PERFORM 9400-SQL-WARNING                        23650000
236600         END-EVALUATE                                             23660000
236700     END-PERFORM.                                                 23670000
236800                                                                  23680000
236900     IF  SQLCODE = ZERO                                           23690000
237000      OR SQLCODE = +100                                           23700000
237100         CONTINUE                                                 23710000
237200     ELSE                                                         23720000
237300         PERFORM 9300-SQL-ERROR                                   23730000
237400     END-IF.                                                      23740000
237500******************************************************************23750000
237600*    FETCH THE STORE NUMBER BELONGING TO THE STORE-GROUP # GIVEN  23760000
237700******************************************************************23770000
237800 8700-FETCH-STORE.                                                23780000
237900                                                                  23790000
238000     PERFORM                                                      23800000
238100       VARYING PA-RETRY-COUNT FROM 1 BY 1                         23810000
238200         UNTIL PA-RETRY-COUNT > PC-MAX-RETRY                      23820000
238300                                                                  23830000
238400         EXEC SQL                                                 23840000
238500              FETCH STORE_CSR                                     23850000
238600               INTO :XST00001-LOC-NBR                             23860000
238700         END-EXEC                                                 23870000
238800                                                                  23880000
238900         EVALUATE TRUE                                            23890000
239000             WHEN SQLCODE = ZERO                                  23900000
239100             WHEN SQLCODE = +100                                  23910000
239200                  MOVE PC-MORE-THAN-MAX-RETRY                     23920000
239300                                     TO PA-RETRY-COUNT            23930000
239400             WHEN SQLCODE = -913                                  23940000
239500             WHEN SQLCODE = -904                                  23950000
239600                  CONTINUE                                        23960000
239700             WHEN SQLCODE < ZERO                                  23970000
239800                  PERFORM 9300-SQL-ERROR                          23980000
239900             WHEN SQLWARN0 = 'W'                                  23990000
240000             WHEN SQLCODE > ZERO                                  24000000
240100                  PERFORM 9400-SQL-WARNING                        24010000
240200         END-EVALUATE                                             24020000
240300     END-PERFORM.                                                 24030000
240400                                                                  24040000
240500     IF  SQLCODE = ZERO                                           24050000
240600      OR SQLCODE = +100                                           24060000
240700         CONTINUE                                                 24070000
240800      ELSE                                                        24080000
240900         PERFORM 9300-SQL-ERROR                                   24090000
241000     END-IF.                                                      24100000
241100******************************************************************24110000
241200*    READ THE REFUND AUTH TABLE                                   24120000
241300******************************************************************24130000
241400 8800-READ-REFUND-AUTH.                                           24140000
241500                                                                  24150000
241600     PERFORM                                                      24160000
241700       VARYING PA-RETRY-COUNT FROM 1 BY 1                         24170000
241800         UNTIL PA-RETRY-COUNT > PC-MAX-RETRY                      24180000
241900                                                                  24190000
242000         EXEC SQL                                                 24200000
242100              SELECT AUTH_GP_NBR,                                 24210000
242200                     AUTH_GP_DESC,                                24220000
242300                     ACTVY_PER_DAY_NBR,                           24230000
242400                     MAX_RET_PER_NBR,                             24240000
242500                     MAX_DOL_RT_PER_AMT,                          24250000
242600                     MAX_RET_DAY_NBR,                             24260000
242700                     MAX_DOL_RT_DAY_AMT,                          24270000
242800                     MAX_STR_DAY_NBR,                             24280000
242900                     LO_RFND_AUTH_AMT,                            24290000
243000                     HGH_RFND_AUTH_AMT,                           24300000
243100                     MAX_CSH_BCK_AMT                              24310000
243200                INTO :RDCNTL-AUTH-GP-NBR,                         24320000
243300                     :RDCNTL-AUTH-GP-DESC,                        24330000
243400                     :RDCNTL-ACTVY-PER-DAY-NBR,                   24340000
243500                     :RDCNTL-MAX-RET-PER-NBR,                     24350000
243600                     :RDCNTL-MAX-DOL-RT-PER-AMT,                  24360000
243700                     :RDCNTL-MAX-RET-DAY-NBR,                     24370000
243800                     :RDCNTL-MAX-DOL-RT-DAY-AMT,                  24380000
243900                     :RDCNTL-MAX-STR-DAY-NBR,                     24390000
244000                     :RDCNTL-LO-RFND-AUTH-AMT,                    24400000
244100                     :RDCNTL-HGH-RFND-AUTH-AMT,                   24410000
244200                     :RDCNTL-MAX-CSH-BCK-AMT                      24420000
244300                FROM TRDCNTL                                      24430000
244400               WHERE AUTH_GP_NBR = :CA-STORE-GROUP-NMBR           24440000
244500         END-EXEC                                                 24450000
244600                                                                  24460000
244700         EVALUATE TRUE                                            24470000
244800             WHEN SQLCODE = ZERO                                  24480000
244900                  MOVE PC-MORE-THAN-MAX-RETRY                     24490000
245000                                     TO PA-RETRY-COUNT            24500000
245100                  SET CA-RECORD-FOUND TO TRUE                     24510000
245200             WHEN SQLCODE = -913                                  24520000
245300             WHEN SQLCODE = -904                                  24530000
245400                  CONTINUE                                        24540000
245500             WHEN SQLCODE < ZERO                                  24550000
245600                  PERFORM 9300-SQL-ERROR                          24560000
245700             WHEN SQLCODE = +100                                  24570000
245800                  MOVE PC-MORE-THAN-MAX-RETRY                     24580000
245900                                     TO PA-RETRY-COUNT            24590000
246000                  SET CA-RECORD-NOT-FOUND                         24600000
246100                                     TO TRUE                      24610000
246200             WHEN SQLWARN0 = 'W'                                  24620000
246300             WHEN SQLCODE > ZERO                                  24630000
246400                  PERFORM 9400-SQL-WARNING                        24640000
246500         END-EVALUATE                                             24650000
246600     END-PERFORM.                                                 24660000
246700                                                                  24670000
246800     IF  SQLCODE = ZERO                                           24680000
246900      OR SQLCODE = +100                                           24690000
247000         CONTINUE                                                 24700000
247100     ELSE                                                         24710000
247200         PERFORM 9300-SQL-ERROR                                   24720000
247300     END-IF.                                                      24730000
247400******************************************************************24740000
247500*    OPEN THE STORE TABLE CURSOR                                  24750000
247600******************************************************************24760000
247700 8900-OPEN-STORE-CURSOR.                                          24770000
247800                                                                  24780000
247900     PERFORM                                                      24790000
248000       VARYING PA-RETRY-COUNT FROM 1 BY 1                         24800000
248100         UNTIL PA-RETRY-COUNT > PC-MAX-RETRY                      24810000
248200                                                                  24820000
248300         EXEC SQL                                                 24830000
248400              OPEN STORE_CSR                                      24840000
248500         END-EXEC                                                 24850000
248600                                                                  24860000
248700         EVALUATE TRUE                                            24870000
248800             WHEN SQLCODE = ZERO                                  24880000
248900                  MOVE PC-MORE-THAN-MAX-RETRY                     24890000
249000                                     TO PA-RETRY-COUNT            24900000
249100             WHEN SQLCODE = -904                                  24910000
249200             WHEN SQLCODE = -913                                  24920000
249300                  CONTINUE                                        24930000
249400             WHEN SQLCODE < ZERO                                  24940000
249500                  PERFORM 9300-SQL-ERROR                          24950000
249600             WHEN SQLWARN0 = 'W'                                  24960000
249700             WHEN SQLCODE > ZERO                                  24970000
249800                  PERFORM 9400-SQL-WARNING                        24980000
249900         END-EVALUATE                                             24990000
250000     END-PERFORM.                                                 25000000
250100                                                                  25010000
250200     IF  SQLCODE = ZERO                                           25020000
250300         CONTINUE                                                 25030000
250400     ELSE                                                         25040000
250500         PERFORM 9300-SQL-ERROR                                   25050000
250600     END-IF.                                                      25060000
250700******************************************************************25070000
250800*    CLOSE THE STORE TABLE CURSOR                                 25080000
250900******************************************************************25090000
251000 8910-CLOSE-STORE-CURSOR.                                         25100000
251100                                                                  25110000
251200     PERFORM                                                      25120000
251300       VARYING PA-RETRY-COUNT FROM 1 BY 1                         25130000
251400         UNTIL PA-RETRY-COUNT > PC-MAX-RETRY                      25140000
251500                                                                  25150000
251600         EXEC SQL                                                 25160000
251700              CLOSE STORE_CSR                                     25170000
251800         END-EXEC                                                 25180000
251900                                                                  25190000
252000         EVALUATE TRUE                                            25200000
252100             WHEN SQLCODE = ZERO                                  25210000
252200                  MOVE PC-MORE-THAN-MAX-RETRY                     25220000
252300                                     TO PA-RETRY-COUNT            25230000
252400             WHEN SQLCODE = -904                                  25240000
252500             WHEN SQLCODE = -913                                  25250000
252600                  CONTINUE                                        25260000
252700             WHEN SQLCODE < ZERO                                  25270000
252800                  PERFORM 9300-SQL-ERROR                          25280000
252900             WHEN SQLWARN0 = 'W'                                  25290000
253000             WHEN SQLCODE > ZERO                                  25300000
253100                 PERFORM 9400-SQL-WARNING                         25310000
253200         END-EVALUATE                                             25320000
253300     END-PERFORM.                                                 25330000
253400                                                                  25340000
253500     IF  SQLCODE = ZERO                                           25350000
253600         CONTINUE                                                 25360000
253700     ELSE                                                         25370000
253800         PERFORM 9300-SQL-ERROR                                   25380000
253900     END-IF.                                                      25390000
254000******************************************************************25400000
254100*    RECEIVE MAP AND EDIT THE STORE-GROUP NUMBER                  25410000
254200******************************************************************25420000
254300 9000-RECEIVE-MAP.                                                25430000
254400                                                                  25440000
254500     EXEC CICS RECEIVE                                            25450000
254600               MAP('RD009A')                                      25460000
254700               MAPSET('RDKM009')                                  25470000
254800               RESP(PV-RESP)                                      25480000
254900     END-EXEC.                                                    25490000
255000                                                                  25500000
255100     EVALUATE TRUE                                                25510000
255200         WHEN PV-RESP NOT = DFHRESP(NORMAL)                       25520000
255300              SET PMT-INDX           TO 10                        25530000
255400              SET PS-EDIT-ERROR      TO TRUE                      25540000
255500         WHEN FUNCTL > ZERO                                       25550000
255600              MOVE FUNCTI            TO CA-FUNCTION               25560000
255700         WHEN FUNCTA = PC-EOF-KEYED                               25570000
255800              SET PMT-INDX           TO 2                         25580000
255900              SET PS-EDIT-ERROR      TO TRUE                      25590000
256000              MOVE DP015-RED         TO FUNCTC                    25600000
256100              MOVE DP015-REVERSE     TO FUNCTH                    25610000
256200              MOVE -1                TO FUNCTL                    25620000
256300              MOVE SPACES            TO CA-FUNCTION               25630000
256400     END-EVALUATE.                                                25640000
256500                                                                  25650000
256600***                                                               25660000
256700***  EDIT STORE GROUP NUMBER                                      25670000
256800***                                                               25680000
256900     IF  STRGRPA = PC-HEX-80                                      25690000
257000         MOVE ZERO                   TO CA-STORE-GROUP-NMBR       25700000
257100     END-IF.                                                      25710000
257200                                                                  25720000
257300     IF  STRGRPL = ZERO                                           25730000
257400         IF  CA-STORE-GROUP-NMBR NUMERIC                          25740000
257500             MOVE CA-STORE-GROUP-NMBR                             25750000
257600                                     TO STRGRPO                   25760000
257700         ELSE                                                     25770000
257800             MOVE CA-STORE-GROUP-NMBR-X                           25780000
257900                                     TO STRGRPO                   25790000
258000         END-IF                                                   25800000
258100     ELSE                                                         25810000
258200         MOVE STRGRPI                TO CA-STORE-GROUP-NMBR-X     25820000
258300     END-IF.                                                      25830000
258400                                                                  25840000
258500     MOVE STRGRPO                    TO DP010I-UNEDITED-FIELD.    25850000
258600     MOVE 2                          TO DP010I-MAXIMUM-DIGITS.    25860000
258700     MOVE ZERO                       TO DP010I-MAXIMUM-DECIMALS.  25870000
258800     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     25880000
258910     CALL DP010I-NUMERIC-EDIT-ROUTINE                             25891000
258920                         USING DP010I-NUMERIC-EDIT-AREA           25892000
259000                                                                  25900000
259100     IF  DP010I-ERROR-DETECTED                                    25910000
259200         MOVE ZERO                   TO CA-LAST-STORE-GROUP       25920000
259300         MOVE DP015-RED              TO STRGRPC                   25930000
259400         MOVE DP015-REVERSE          TO STRGRPH                   25940000
259500         IF  PS-NO-EDIT-ERROR                                     25950000
259600             SET PMT-INDX            TO 4                         25960000
259700             SET PS-EDIT-ERROR       TO TRUE                      25970000
259800             MOVE -1                 TO STRGRPL                   25980000
259900         END-IF                                                   25990000
260000     ELSE                                                         26000000
260100         MOVE DP010I-NUMERIC-FIELD   TO CA-STORE-GROUP-NMBR       26010000
260200     END-IF.                                                      26020000
260300******************************************************************26030000
260400*    DISPLAY MAP                                                  26040000
260500******************************************************************26050000
260600 9100-SEND-MAP.                                                   26060000
260700                                                                  26070000
260800     IF  PMT-INDX = 18                                            26080000
260900      OR PMT-INDX = 19                                            26090000
261000      OR PMT-INDX = 21                                            26100000
261100      OR PMT-INDX = 25                                            26110000
261200      OR PMT-INDX = 27                                            26120000
261300         MOVE DP015-YELLOW           TO AMSGC                     26130000
261400     END-IF.                                                      26140000
261500                                                                  26150000
261600     MOVE -1                         TO FUNCTL.                   26160000
261700     SET RD000I-PROCESS-SCREEN       TO TRUE.                     26170000
261800     MOVE CA-STORE-GROUP-NMBR        TO CA-LAST-STORE-GROUP.      26180000
261900     MOVE PM-PGM-MSG (PMT-INDX)      TO AMSGO.                    26190000
262000     PERFORM 9800-UPDATE-SCREEN-HEADER.                           26200000
262100                                                                  26210000
262200     EXEC CICS SEND                                               26220000
262300               MAP('RD009A')                                      26230000
262400               MAPSET('RDKM009')                                  26240000
262500               ERASE                                              26250000
262600               CURSOR                                             26260000
262700     END-EXEC.                                                    26270000
262800                                                                  26280000
262900     EXEC CICS RETURN                                             26290000
263000               TRANSID('U009')                                    26300000
263100               COMMAREA(RD000I-COMMUNICATION-AREA)                26310000
263200               LENGTH(PC-COMMAREA-LENGTH)                         26320000
263300     END-EXEC.                                                    26330000
263400******************************************************************26340000
263500*    DISPLAY MAP WITHOUT ERASING PREVIOUS MAP.                    26350000
263600*     (THIS IS USED WHEN THERE ARE ERRORS)                        26360000
263700******************************************************************26370000
263800 9200-SEND-NO-ERASE.                                              26380000
263900                                                                  26390000
264000     IF  PMT-INDX = 18                                            26400000
264100      OR PMT-INDX = 19                                            26410000
264200      OR PMT-INDX = 21                                            26420000
264300      OR PMT-INDX = 25                                            26430000
264400      OR PMT-INDX = 27                                            26440000
264500         MOVE DP015-YELLOW           TO AMSGC                     26450000
264600         MOVE -1                     TO FUNCTL                    26460000
264700     ELSE                                                         26470000
264800          MOVE DP015-RED             TO AMSGC                     26480000
264900     END-IF.                                                      26490000
265000                                                                  26500000
265100     IF  PS-NO-EDIT-ERROR                                         26510000
265200         MOVE CA-STORE-GROUP-NMBR    TO CA-LAST-STORE-GROUP       26520000
265300     END-IF.                                                      26530000
265400                                                                  26540000
265500     MOVE PM-PGM-MSG (PMT-INDX)      TO AMSGO.                    26550000
265600     PERFORM 9800-UPDATE-SCREEN-HEADER.                           26560000
265700                                                                  26570000
265800     EXEC CICS SEND                                               26580000
265900               MAP('RD009A')                                      26590000
266000               MAPSET('RDKM009')                                  26600000
266100               CURSOR                                             26610000
266200     END-EXEC.                                                    26620000
266300                                                                  26630000
266400     EXEC CICS RETURN                                             26640000
266500               TRANSID('U009')                                    26650000
266600               COMMAREA(RD000I-COMMUNICATION-AREA)                26660000
266700               LENGTH(PC-COMMAREA-LENGTH)                         26670000
266800     END-EXEC.                                                    26680000
266900******************************************************************26690000
267000*    DB2 SQL WARNING AND SQL ERROR PARAGRAPHS                     26700000
267100*                                                                 26710000
267200*    -911 IS NOT EVALUATED BECAUSE IT IS NOT POSSIBLE.  IT IS     26720000
267300*    EITHER A -911 OR -913 DEPENDING ON HOW DB2 WAS INITIALLY     26730000
267400*    INSTALLED.  AT KOHLS -911 DOES NOT APPLY TO CICS PROGRAMS.   26740000
267500******************************************************************26750000
267600 9300-SQL-ERROR.                                                  26760000
267700                                                                  26770000
267800     EVALUATE SQLCODE                                             26780000
267900         WHEN -904                                                26790000
268000              MOVE DM-RESOURCE-UNAVAIL-MSG                        26800000
268100                                     TO DM-ERROR-MSG              26810000
268200         WHEN -913                                                26820000
268300              MOVE DM-DEADLOCK-TIMEOUT-MSG                        26830000
268400                                     TO DM-ERROR-MSG              26840000
268500         WHEN -922                                                26850000
268600              MOVE DM-NOT-AUTHORIZED-MSG                          26860000
268700                                     TO DM-ERROR-MSG              26870000
268800         WHEN -923                                                26880000
268900              MOVE DM-NOT-CONNECTED-MSG                           26890000
269000                                     TO DM-ERROR-MSG              26900000
269100         WHEN ANY                                                 26910000
269200              MOVE DM-OTHER-DB2-ERROR-MSG                         26920000
269300                                     TO DM-ERROR-MSG              26930000
269400     END-EVALUATE.                                                26940000
269500                                                                  26950000
269600     MOVE SQLCODE                    TO DM-SQLCODE.               26960000
269700     MOVE SQLERRD(3)                 TO DM-ROWS-ERR-PROCESSED.    26970000
269800     MOVE SQLERRML                   TO DM-SQLERRML.              26980000
269900     MOVE SQLERRMC                   TO DM-SQLERRMC.              26990000
270000                                                                  27000000
270100     EXEC CICS SYNCPOINT                                          27010000
270200               ROLLBACK                                           27020000
270300     END-EXEC                                                     27030000
270400                                                                  27040000
270500     EXEC CICS SEND                                               27050000
270600               FROM(DM-DB2-ERROR-MSG)                             27060000
270700               LENGTH(PC-DB2-ERROR-LENGTH)                        27070000
270800               ERASE                                              27080000
270900     END-EXEC.                                                    27090000
271000                                                                  27100000
271100     EXEC CICS RETURN                                             27110000
271200     END-EXEC.                                                    27120000
271300******************************************************************27130000
271400*  EXIT THE REFUND AUTH SYSTEM, DISPLAYING A FORMATTED DB2       *27140000
271500*  WARNING MESSAGE.                                              *27150000
271600******************************************************************27160000
271700 9400-SQL-WARNING.                                                27170000
271800                                                                  27180000
271900     MOVE SQLCODE                    TO DM-SQLCODE1.              27190000
272000     MOVE SQLWARN                    TO DM-SQLWARN.               27200000
272100     MOVE SQLERRD(3)                 TO DM-ROWS-WRN-PROCESSED.    27210000
272200                                                                  27220000
272300     EXEC CICS SYNCPOINT                                          27230000
272400               ROLLBACK                                           27240000
272500     END-EXEC.                                                    27250000
272600                                                                  27260000
272700     EXEC CICS SEND                                               27270000
272800               FROM(DM-DB2-WARNING-MSG)                           27280000
272900               LENGTH(PC-DB2-WARNING-LENGTH)                      27290000
273000               ERASE                                              27300000
273100     END-EXEC.                                                    27310000
273200                                                                  27320000
273300     EXEC CICS RETURN                                             27330000
273400     END-EXEC.                                                    27340000
273500******************************************************************27350000
273600*  SEND A FORMATTED MESSAGE AND RETURN TO MAIN MENU              *27360000
273700******************************************************************27370000
273800 9500-RETURN-TO-MAIN-MENU.                                        27380000
273900                                                                  27390000
274000     EXEC CICS SYNCPOINT                                          27400000
274100     END-EXEC.                                                    27410000
274200                                                                  27420000
274300     EXEC CICS START                                              27430000
274400               TRANSID ('MENU')                                   27440000
274500               TERMID  (EIBTRMID)                                 27450000
274600     END-EXEC.                                                    27460000
274700                                                                  27470000
274800     EXEC CICS RETURN                                             27480000
274900     END-EXEC.                                                    27490000
275000******************************************************************27500000
275100*  TRANSFER TO THE CASH REFUND MENU PROGRAM                      *27510000
275200******************************************************************27520000
275300 9600-RETURN-TO-SYSTEM-MENU.                                      27530000
275400                                                                  27540000
275500     EXEC CICS SYNCPOINT                                          27550000
275600     END-EXEC.                                                    27560000
275700                                                                  27570000
275800     EXEC CICS XCTL                                               27580000
275900               PROGRAM('RDKCS000')                                27590000
276000     END-EXEC.                                                    27600000
276100******************************************************************27610000
276200*  TRANSFER TO THE INQUIRY PROGRAM                               *27620000
276300******************************************************************27630000
276400 9700-XCTL-INQUIRY-PROGRAM.                                       27640000
276500                                                                  27650000
276600     EXEC CICS SYNCPOINT                                          27660000
276700     END-EXEC.                                                    27670000
276800                                                                  27680000
276900     MOVE PC-THIS-PROGRAM            TO RD000I-LAST-PROGRAM.      27690000
277000     SET RD000I-INITIALIZE-SCREEN    TO TRUE.                     27700000
277100                                                                  27710000
277200     EXEC CICS XCTL                                               27720000
277300               PROGRAM('RDKCS005')                                27730000
277400               COMMAREA(RD000I-COMMUNICATION-AREA)                27740000
277500               LENGTH(PC-COMMAREA-LENGTH)                         27750000
277600               RESP(PV-RESP)                                      27760000
277700     END-EXEC.                                                    27770000
277800                                                                  27780000
277900     IF  PV-RESP NOT = DFHRESP(NORMAL)                            27790000
278000         SET PMT-INDX                TO 9                         27800000
278100         EXEC CICS SEND                                           27810000
278200                   FROM(PM-PGM-MSG(PMT-INDX))                     27820000
278300                   LENGTH(PC-MSG-LENGTH)                          27830000
278400                   ERASE                                          27840000
278500         END-EXEC                                                 27850000
278600                                                                  27860000
278700         EXEC CICS RETURN                                         27870000
278800         END-EXEC                                                 27880000
278900     END-IF.                                                      27890000
279000******************************************************************27900000
279100*  FILL IN THE SCREEN HEADER WITH THE DATE, TIME, AND TERMINAL   *27910000
279200*  NUMBER.                                                       *27920000
279300******************************************************************27930000
279400 9800-UPDATE-SCREEN-HEADER.                                       27940000
279500                                                                  27950000
279600     EXEC CICS ASKTIME                                            27960000
279700               ABSTIME(ST-ABSTIME)                                27970000
279800     END-EXEC.                                                    27980000
279900                                                                  27990000
280000     EXEC CICS FORMATTIME                                         28000000
280100               ABSTIME(ST-ABSTIME)                                28010000
280200               MMDDYY(ADATEO)                                     28020000
280300               DATESEP                                            28030000
280400               TIME(ST-TIME-EDIT)                                 28040000
280500               TIMESEP                                            28050000
280600     END-EXEC.                                                    28060000
280700                                                                  28070000
280800     EXEC CICS FORMATTIME                                         28080000
280900               ABSTIME(ST-ABSTIME)                                28090000
281000               YYYYMMDD(PV-DATE)                                  28100000
281100               DATESEP('-')                                       28110000
281200     END-EXEC.                                                    28120000
281300                                                                  28130000
281400     EXEC CICS FORMATTIME                                         28140000
281500               ABSTIME(ST-ABSTIME)                                28150000
281600               YYMMDD(PV-CURRENT-DATE)                            28160000
281700               TIME(PV-CURRENT-TIME)                              28170000
281800     END-EXEC.                                                    28180000
281900                                                                  28190000
282000     EXEC CICS ASSIGN                                             28200000
282100               USERID(PV-USER-ID)                                 28210000
282200     END-EXEC.                                                    28220000
282300                                                                  28230000
282400     MOVE ST-TIME-HHMM               TO ATIMEO.                   28240000
282500     MOVE 'Z'                        TO ATIMEA.                   28250000
282600     MOVE 'Z'                        TO ADATEA.                   28260000
282700     MOVE EIBTRMID TO ATERMO.                                     28270000
282800******************************************************************28280000
282900*  UPDATE  REFUND AUTH TEMP STORAGE                              *28290000
283000******************************************************************28300000
283100 9920-UPDATE-TEMP-STORAGE.                                        28310000
283200                                                                  28320000
283300     MOVE CA-ASSOCIATED-STORES (PA-SUB3)                          28330000
283400                                    TO TS-Q-STORE-NMBR.           28340000
283500     MOVE PV-STORE-GROUP-NMBR       TO TS-Q-STORE-GP-NBR.         28350000
283600     MOVE CA-REFUND-ACTIVITY-PRD    TO TS-Q-ACTIVITY-PERIOD.      28360000
283700     MOVE CA-MAX-REFUND-PER-PRD     TO TS-Q-MAX-REFUNDS-PER-PRD.  28370000
283800     MOVE CA-MAX-REFUND-AMT-PER-PRD                               28380000
283900       TO TS-Q-MAX-REFUND-AMT-PER-PRD.                            28390000
284000     MOVE CA-MAX-NMBR-OF-STORES     TO TS-Q-MAX-STORES.           28400000
284100     MOVE CA-MAX-REFUND-PER-DAY     TO TS-Q-MAX-REFUNDS-PER-DAY.  28410000
284200     MOVE CA-MAX-REFUND-AMT-PER-DAY                               28420000
284300       TO TS-Q-MAX-REFUND-AMT-PER-DAY.                            28430000
284400     MOVE TS-Q-STORE-NMBR           TO TS-Q-ITEM-NMBR.            28440000
284500     MOVE CA-LO-RFND-AUTH-AMT       TO TS-Q-LO-RFND-AUTH-AMT.     28450000
284600     MOVE CA-HGH-RFND-AUTH-AMT      TO TS-Q-HGH-RFND-AUTH-AMT.    28460000
284700     MOVE CA-MAX-CSH-BCK-AMT        TO TS-Q-MAX-CSH-BCK-AMT.      28470000
284800                                                                  28480000
284900     PERFORM                                                      28490000
285000       VARYING PA-RETRY-COUNT FROM 1 BY 1                         28500000
285100         UNTIL PA-RETRY-COUNT > PC-MAX-RETRY                      28510000
285200                                                                  28520000
285300         EXEC CICS WRITEQ TS                                      28530000
285400                   QUEUE('REFAUTHQ')                              28540000
285500                   FROM(TS-Q-RECORD)                              28550000
285600                   LENGTH(TS-Q-RECORD-LENGTH)                     28560000
285700                   ITEM(TS-Q-ITEM-NMBR)                           28570000
285800                   REWRITE                                        28580000
285900                   RESP(PV-RESP)                                  28590000
286000         END-EXEC                                                 28600000
286100                                                                  28610000
286200         IF  PV-RESP NOT = DFHRESP(NORMAL)                        28620000
286300             EXEC CICS LINK                                       28630000
286400                       PROGRAM('RDKCS010')                        28640000
286500             END-EXEC                                             28650000
286600         ELSE                                                     28660000
286700             MOVE PC-MORE-THAN-MAX-RETRY                          28670000
286800                                    TO PA-RETRY-COUNT             28680000
286900         END-IF                                                   28690000
287000                                                                  28700000
287100     END-PERFORM.                                                 28710000
287200                                                                  28720000
287300     IF  PV-RESP NOT = DFHRESP(NORMAL)                            28730000
287400         IF  PS-NO-EDIT-ERROR                                     28740000
287500             MOVE DP015-RED         TO AMSGC                      28750000
287600             SET PMT-INDX           TO 22                         28760000
287700             SET PS-EDIT-ERROR      TO TRUE                       28770000
287800             MOVE -1                TO STRGRPL                    28780000
287900         END-IF                                                   28790000
288000     END-IF.                                                      28800000
