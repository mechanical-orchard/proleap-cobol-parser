000100*-----------------------*                                         00010090
000200 IDENTIFICATION DIVISION.                                         00020090
000300*-----------------------*                                         00030090
000400 PROGRAM-ID.    CEKCS616.                                         00040090
000500 AUTHOR.        JOE LAROSA.                                       00050090
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060090
000700 DATE-WRITTEN.  JULY, 2000.                                       00070090
000800 DATE-COMPILED.                                                   00080090
000900***************************************************************** 00090090
001000*                S616 - CE-CENTRAL STORE ADJUST                 * 00100090
001100*                                                               * 00110090
001200*    THIS ONLINE PROGRAM ALLOWS ADJUSTMENTS TO THE DISTRIBUTED  * 00120090
001300*    UNITS QUANTITY FOR A GIVEN STORE.                          * 00130090
001400***************************************************************** 00140090
263455* CHANGED 10/29/2021    BY JIM HUNTER      WR: CHG0263455         00141099
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00142099
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00143099
263455***************************************************************** 00145099
CICS  * CHANGED 10/20/2022    BY JIM HUNTER      WR: CHG0276924         00146099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00147099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00148099
CICS  ***************************************************************** 00149099
001500 ENVIRONMENT DIVISION.                                            00150090
001600 DATA DIVISION.                                                   00160090
001700                                                                  00170090
001800 WORKING-STORAGE SECTION.                                         00180090
001900 01  PS-PROGRAM-SWITCHES.                                         00190090
002000     05  PS-ERROR-SW                PIC X(01) VALUE 'Y'.          00200090
002100         88  PS-NO-ERROR                      VALUE 'Y'.          00210090
002200         88  PS-ERROR                         VALUE 'N'.          00220090
002300     05  PS-COMMAREA-SW             PIC X(01) VALUE 'N'.          00230090
002400         88  PS-COMMAREA-VALID                VALUE 'Y'.          00240090
002500         88  PS-COMMAREA-NOT-VALID            VALUE 'N'.          00250090
002600     05  PS-LNAME-DONE-SW           PIC X(01) VALUE 'N'.          00260094
002700         88  PS-LNAME-DONE                    VALUE 'Y'.          00270094
002800         88  PS-LNAME-NOT-DONE                VALUE 'N'.          00280094
002900     05  PS-FNAME-DONE-SW           PIC X(01) VALUE 'N'.          00290094
003000         88  PS-FNAME-DONE                    VALUE 'Y'.          00300094
003100         88  PS-FNAME-NOT-DONE                VALUE 'N'.          00310094
003200                                                                  00320090
003300 01  PC-PROGRAM-CONSTANTS.                                        00330090
003400     05  PC-CURRENT-MAP-NAME        PIC X(08) VALUE 'CE616A  '.   00340090
003500     05  PC-CURRENT-MAPSET-NAME     PIC X(08) VALUE 'CEKM616 '.   00350090
003600     05  PC-CURRENT-PROGRAM-NAME    PIC X(08) VALUE 'CEKCS616'.   00360090
003700                                                                  00370090
003800     05  PC-LIST-QUEUE-SEQ          PIC 9(01) VALUE 1.            00380090
003900     05  PC-SEL-QUEUE-SEQ           PIC 9(01) VALUE 2.            00390090
004000                                                                  00400090
004100     05  PC-ITEMS-PER-PANEL         PIC S9(4) VALUE +12           00410090
004200                                                       COMP SYNC. 00420090
004300     05  PC-MAX-BLOCKS-IN-ARRAY     PIC S9(4) VALUE +2 COMP SYNC. 00430090
004400     05  PC-MSG-NUMBER-LENGTH       PIC S9(4) VALUE +7 COMP SYNC. 00440090
004500     05  PC-MAX-ITEMS               PIC S9(9) VALUE +1000000      00450090
004600                                                       COMP-3.    00460090
004700     05  PC-MAX-RETRIES             PIC S9(3) VALUE +3 COMP-3.    00470090
004800                                                                  00480090
004900*----------------------------------------------------------------*00490090
005000*  SYSTEM MESSAGES                                               *00500090
005100*----------------------------------------------------------------*00510090
005200*   00005 = INVALID VALUE                                        *00520090
005300*   00007 = REQUIRED ENTRY                                       *00530098
005400*   00008 = MUST BE NUMERIC                                      *00540098
005500*   00057 - MUST SELECT AT LEAST ONE ITEM                        *00550090
005600*   00059 - UPDATE(S) SUCCESSFUL                                 *00560092
005700*   00069 - TOP OF LIST                                          *00570090
005800*   00070 - BOTTOM OF LIST                                       *00580090
005900*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00590090
006000*   00279 - MORE ITEMS TO DISPLAY                                *00600090
006100*   00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL*00610090
006200*   02355 = CANNOT ADJUST STORE DISTRIBUTION - LINE STATUS IS NEW 00620090
006300*   99901 = INVALID COMMAND WAS ENTERED                          *00630090
006400*----------------------------------------------------------------*00640090
006500     05  PC-TSYMSG-NUMBERS.                                       00650090
006600         10  PC-TSYMSG-00005        PIC 9(05) VALUE 00005.        00660090
006700         10  PC-TSYMSG-00007        PIC 9(05) VALUE 00007.        00670098
006800         10  PC-TSYMSG-00008        PIC 9(05) VALUE 00008.        00680098
006900         10  PC-TSYMSG-00057        PIC 9(05) VALUE 00057.        00690090
007000         10  PC-TSYMSG-00059        PIC 9(05) VALUE 00059.        00700092
007100         10  PC-TSYMSG-00069        PIC 9(05) VALUE 00069.        00710090
007200         10  PC-TSYMSG-00070        PIC 9(05) VALUE 00070.        00720090
007300         10  PC-TSYMSG-00101        PIC 9(05) VALUE 00101.        00730090
007400         10  PC-TSYMSG-00279        PIC 9(05) VALUE 00279.        00740090
007500         10  PC-TSYMSG-00551        PIC 9(05) VALUE 00551.        00750090
007600         10  PC-TSYMSG-02355        PIC 9(05) VALUE 02355.        00760090
007700         10  PC-TSYMSG-99901        PIC 9(05) VALUE 99901.        00770090
007800                                                                  00780090
007900 01  DK-DB2-KEYS.                                                 00790090
008000     05  DK-PULL-NBR                PIC S9(9) COMP VALUE +0.      00800091
008100     05  DK-PL-LNE-NBR              PIC S9(4) COMP VALUE +0.      00810091
008200     05  DK-STR-NBR                 PIC S9(4) COMP VALUE +0.      00820091
008300     05  DK-ITM-NBR                 PIC S9(15)V COMP-3 VALUE +0.  00830091
008400                                                                  00840090
008500 01  PV-PROGRAM-VARIABLES.                                        00850090
008600     05  PV-SUB                     PIC S9(4) VALUE +0 COMP SYNC. 00860090
008700     05  PV-REMAINDER               PIC S9(4) VALUE +0 COMP SYNC. 00870090
008800     05  PV-BLOCK-NUMBER            PIC S9(4) VALUE +0 COMP SYNC. 00880090
008900     05  PV-CICS-RESP               PIC S9(4) VALUE +0 COMP SYNC. 00890090
009000     05  PV-ITEM                    PIC S9(4) VALUE +0 COMP SYNC. 00900090
009100     05  PV-SEL-QUEUE-ITEM          PIC S9(4) VALUE +0 COMP SYNC. 00910090
009200     05  PV-SAVE-ITEM               PIC S9(4) VALUE +0 COMP SYNC. 00920090
009300     05  PV-HIGHEST-BLOCK-WRITTEN   PIC S9(4) VALUE +0 COMP SYNC. 00930090
009400     05  PV-LIST-ITEM-NUMBER        PIC S9(4) VALUE +0 COMP SYNC. 00940090
009500     05  PV-FIRST-BLOCK-IN-ARRAY    PIC S9(4) VALUE +0 COMP SYNC. 00950090
009600     05  PV-NEXT-BLOCK-IN-ARRAY     PIC S9(4) VALUE +0 COMP SYNC. 00960090
009700     05  PV-PREV-BLOCK-IN-ARRAY     PIC S9(4) VALUE +0 COMP SYNC. 00970090
009800     05  PV-FIRST-BLOCK-IN-RANGE    PIC S9(4) VALUE +0 COMP SYNC. 00980090
009900     05  PV-LAST-BLOCK-IN-RANGE     PIC S9(4) VALUE +0 COMP SYNC. 00990090
010000     05  PV-START-OF-SELECTED-RANGE PIC S9(4) VALUE +0 COMP SYNC. 01000090
010100     05  PV-END-OF-SELECTED-RANGE   PIC S9(4) VALUE +0 COMP SYNC. 01010090
010200     05  PV-RETRY-COUNTER           PIC S9(4) VALUE +0 COMP SYNC. 01020090
010300     05  PV-NULL-IND                PIC S9(4) VALUE +0 COMP SYNC. 01030090
010400     05  PV-NULL-IND-1              PIC S9(4) VALUE +0 COMP SYNC. 01040099
010500     05  PV-NULL-IND-2              PIC S9(4) VALUE +0 COMP SYNC. 01050099
010600     05  PV-READ-COUNT              PIC S9(9) VALUE +0 COMP-3.    01060090
010700     05  PV-ITEMS-PROCESSED         PIC S9(9) VALUE +0 COMP-3.    01070090
010800     05  PV-HOLD-SELECTED-ITEMS     PIC S9(9) VALUE +0 COMP-3.    01080090
010900     05  PV-ITEM-IN-USE             PIC S9(9) VALUE +0 COMP-3.    01090090
011000     05  PV-TOP-ITEM                PIC S9(9) VALUE +0 COMP-3.    01100090
011100     05  PV-BOTTOM-ITEM             PIC S9(9) VALUE +0 COMP-3.    01110090
011200     05  PV-TEMP-BLOCK-NUMBER       PIC S9(9) VALUE +0 COMP-3.    01120090
011300     05  PV-DB2-COUNT               PIC S9(9) VALUE +0 COMP-3.    01130090
011400     05  PV-CHG-DIFF                PIC S9(5).                    01140095
011500     05  PV-CHG-DIFF-DISP           PIC ZZZZ9.                    01150095
011600     05  PV-DISP-5                  PIC ZZZZ9.                    01160097
012300     05  PV-SKU-8                   PIC 9(8).                     01221099
012800 01  WS-WORKING-STORAGE-FIELDS.                                   01280094
012900     05  WS-LNAME-SUB               PIC S9(4) VALUE +0 COMP SYNC. 01290094
013000     05  WS-LNAME-SUB-2             PIC S9(4) VALUE +0 COMP SYNC. 01300094
013100     05  WS-FNAME-SUB               PIC S9(4) VALUE +0 COMP SYNC. 01310094
013200     05  WS-FNAME-SUB-2             PIC S9(4) VALUE +0 COMP SYNC. 01320094
013300     05  WS-ONAME-SUB               PIC S9(4) VALUE +0 COMP SYNC. 01330094
013400     05  WS-OUTPUT-NAME             PIC X(30).                    01340094
013500     05  FILLER REDEFINES WS-OUTPUT-NAME.                         01350094
013600         10  WS-ONAME-BYTE          PIC X(01) OCCURS 30 TIMES.    01360094
013700     05  WS-LAST-NAME               PIC X(18).                    01370094
013800     05  FILLER REDEFINES WS-LAST-NAME.                           01380094
013900         10  WS-LNAME-BYTE          PIC X(01) OCCURS 18 TIMES.    01390094
014000     05  WS-FIRST-NAME              PIC X(12).                    01400094
014100     05  FILLER REDEFINES WS-FIRST-NAME.                          01410094
014200         10  WS-FNAME-BYTE          PIC X(01) OCCURS 12 TIMES.    01420094
014300                                                                  01430094
014400*---------------------------------------------------------------* 01440090
014500*  RECORD LAYOUT(S) FOR THE LIST SELECTION TEMP STORAGE QUEUE.  * 01450090
014600*---------------------------------------------------------------* 01460090
014700     COPY CEWS003.                                                01470090
014800                                                                  01480090
014900*---------------------------------------------------------------* 01490090
015000*    MAP LAYOUT                                                 * 01500090
015100*---------------------------------------------------------------* 01510090
015200     COPY CEKM616.                                                01520090
015300                                                                  01530090
015400*---------------------------------------------------------------* 01540090
015500*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01550090
015600*---------------------------------------------------------------* 01560090
015700     COPY DPWS015.                                                01570090
015800                                                                  01580090
015900*---------------------------------------------------------------* 01590090
016000*    FUNCTION KEYS COPYBOOK.                                    * 01600090
016100*---------------------------------------------------------------* 01610090
016200     COPY DPWS016.                                                01620090
016300                                                                  01630090
016400*---------------------------------------------------------------* 01640090
016500*    NUMERIC EDIT LAYOUT.                                       * 01650090
016600*---------------------------------------------------------------* 01660090
016700     COPY DPWS010I.                                               01670090
016800                                                                  01680090
016900*---------------------------------------------------------------* 01690090
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01701099
017100*---------------------------------------------------------------* 01710090
017200     COPY DPWS030.                                                01720090
CICS       COPY DPWS930.                                                01721099
017300                                                                  01730090
017400*---------------------------------------------------------------* 01740090
017500*    STANDARD COMMAREA.                                         * 01750090
017600*---------------------------------------------------------------* 01760090
017700     COPY DPWS020.                                                01770090
017800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01780090
017900                                                                  01790090
018000*---------------------------------------------------------------* 01800090
018100* INTER-APPLICATION COMMAREA.                                   * 01810090
018200*---------------------------------------------------------------* 01820090
018300         10  INTER-APPL-COMM-AREA     PIC X(200).                 01830090
018400     COPY CEWS002.                                                01840090
018500                                                                  01850090
018600*---------------------------------------------------------------* 01860090
018700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 01870090
018800*---------------------------------------------------------------* 01880090
018900         10  ASC-SPECIFIC-COMMAREA.                               01890090
019000             15  ASC-INT-APPL-FORMAT-IND     PIC X(01).           01900090
019100             15  ASC-USE-SELECTION-QUEUE-IND PIC X(01).           01910090
019200                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 01920090
019300             15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(5) COMP-3.    01930090
019400             15  ASC-LIST-QUEUE-NAME.                             01940090
019500                 20  ASC-LIST-TERM-ID        PIC X(04).           01950090
019600                 20  ASC-LIST-TASK-NUMBER    PIC S9(5) COMP-3.    01960090
019700                 20  ASC-LIST-SEQ            PIC 9(01).           01970090
019800             15  ASC-SEL-QUEUE-NAME-IN       PIC X(08).           01980090
019900             15  ASC-SEL-QUEUE-NAME.                              01990090
020000                 20  ASC-SEL-TERM-ID         PIC X(04).           02000090
020100                 20  ASC-SEL-TASK-NUMBER     PIC S9(5) COMP-3.    02010090
020200                 20  ASC-SEL-SEQ             PIC 9(01).           02020090
020300             15  ASC-SEL-SUB                 PIC S9(4) COMP.      02030090
020400             15  ASC-SEL-ITEM                PIC S9(4) COMP.      02040090
020500             15  ASC-LIST-KEYS.                                   02050090
020600                 20  ASC-KEY-PULL-NBR        PIC S9(9) COMP.      02060091
020700                 20  ASC-KEY-LINE-NBR        PIC S9(4) COMP.      02070091
020800                 20  ASC-KEY-STR-NBR         PIC S9(4) COMP.      02080091
020900                 20  ASC-KEY-ITM-NBR         PIC S9(15)V COMP-3.  02090091
021000             15  ASC-HEADER-FIELDS.                               02100090
021100                 20  ASC-LOC                 PIC 9(04).           02110090
021200                 20  ASC-SKU                 PIC X(08).           02120090
021300                 20  ASC-MF-QTY-TOT          PIC S9(7).           02130090
021400                 20  ASC-STR                 PIC 9(04).           02140090
021500                 20  ASC-AMT                 PIC 9(5)V99.         02150090
021600                 20  ASC-AU-QTY-TOT          PIC S9(7).           02160090
021700                 20  ASC-PULL-NBR            PIC 9(09).           02170090
021800                 20  ASC-PULL-LNE-NBR        PIC 9(04).           02180090
021900                 20  ASC-DS-QTY-CURR         PIC 9(05).           02190091
022000                 20  ASC-DS-AMT-CURR         PIC 9(7)V99.         02200090
022100                 20  ASC-DS-QTY-PREV         PIC 9(05).           02210090
022200                 20  ASC-DS-AMT-PREV         PIC 9(7)V99.         02220090
022300                 20  ASC-ADJ-QTY-TO          PIC X(05).           02230091
022400                 20  ASC-ADJ-QTY-TO-R REDEFINES ASC-ADJ-QTY-TO.   02240091
022500                     25  ASC-ADJ-QTY-TO-N    PIC 9(05).           02250091
022600                 20  ASC-TK-NBR              PIC X(08).           02260090
022700                 20  ASC-TK-NAME             PIC X(35).           02270099
022800                 20  ASC-REASON.                                  02280092
022900                     25  ASC-REASON-L1       PIC X(50).           02290092
023000                     25  ASC-REASON-L2       PIC X(50).           02300092
023100                     25  ASC-REASON-L3       PIC X(50).           02310092
023200                     25  ASC-REASON-L4       PIC X(50).           02320092
023300                     25  ASC-REASON-L5       PIC X(50).           02330092
023400                                                                  02340090
023500*---------------------------------------------------------------* 02350090
023600*    ABEND PROCESSING COPYBOOK.                                 * 02360090
023700*---------------------------------------------------------------* 02370090
023800     COPY DPWS013.                                                02380090
023900                                                                  02390090
024000*---------------------------------------------------------------* 02400090
024100*    TCEPLRQ - CENTRAL STOCK PULL REQUESTS                      * 02410090
024200*---------------------------------------------------------------* 02420090
024300     EXEC SQL                                                     02430090
024400          INCLUDE TCEPLRQ                                         02440090
024500     END-EXEC.                                                    02450090
024600                                                                  02460090
024700*---------------------------------------------------------------* 02470090
024800*    TCEPLDS - CENTRAL STOCK PULL DISTRIBUTION                  * 02480090
024900*---------------------------------------------------------------* 02490090
025000     EXEC SQL                                                     02500090
025100          INCLUDE TCEPLDS                                         02510090
025200     END-EXEC.                                                    02520090
025300                                                                  02530090
025400*---------------------------------------------------------------* 02540090
025500*    TCEPLIT - CENTRAL STOCK PULL ITEMS                         * 02550090
025600*---------------------------------------------------------------* 02560090
025700     EXEC SQL                                                     02570090
025800          INCLUDE TCEPLIT                                         02580090
025900     END-EXEC.                                                    02590090
026000                                                                  02600090
026100*---------------------------------------------------------------* 02610090
026200*    TCEPLST - CENTRAL STOCK PULL STATUS                        * 02620090
026300*---------------------------------------------------------------* 02630090
026400     EXEC SQL                                                     02640090
026500          INCLUDE TCEPLST                                         02650090
026600     END-EXEC.                                                    02660090
026700                                                                  02670090
026800*---------------------------------------------------------------* 02680090
026900*    TCEPLMF - CENTRAL STOCK MANIFEST                           * 02690090
027000*---------------------------------------------------------------* 02700090
027100     EXEC SQL                                                     02710090
027200          INCLUDE TCEPLMF                                         02720090
027300     END-EXEC.                                                    02730090
027400                                                                  02740090
027500*---------------------------------------------------------------* 02750090
027600*    TCEPLAU - CENTRAL STOCK ADJUST AUDIT                       * 02760090
027700*---------------------------------------------------------------* 02770090
027800     EXEC SQL                                                     02780090
027900          INCLUDE TCEPLAU                                         02790090
028000     END-EXEC.                                                    02800090
028100                                                                  02810090
028200*---------------------------------------------------------------* 02820090
028300*    TWORKER - MB-WORKER TABLE                                  * 02830094
028400*---------------------------------------------------------------* 02840090
028500     EXEC SQL                                                     02850090
028600          INCLUDE TWORKER                                         02860094
028700     END-EXEC.                                                    02870090
028800                                                                  02880090
028900*---------------------------------------------------------------* 02890090
029000*    DB2 AREA FOR COMMUNICATIONS                                * 02900090
029100*---------------------------------------------------------------* 02910090
029200     EXEC SQL                                                     02920090
029300          INCLUDE SQLCA                                           02930090
029400     END-EXEC.                                                    02940090
029500                                                                  02950090
029600*---------------------------------------------------------------* 02960090
029700*---------------------------------------------------------------* 02970090
029800 LINKAGE SECTION.                                                 02980090
029900                                                                  02990090
030000 01  DFHCOMMAREA.                                                 03000090
030100     05  FILLER                         OCCURS  1 TO 4072 TIMES   03010090
030200                                        DEPENDING ON EIBCALEN.    03020090
030300         10  FILLER                     PIC X.                    03030090
030400                                                                  03040090
030500/**************************************************************** 03050090
030600***************************************************************** 03060090
030700 PROCEDURE DIVISION.                                              03070090
030800*---------------------------------------------------------------* 03080090
030900*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 03090090
031000*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 03100090
031100*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 03110090
031200*---------------------------------------------------------------* 03120090
031300 0000-MAIN-MODULE.                                                03130090
031400                                                                  03140090
031500     INITIALIZE DP030-CICS-API-FIELDS.                            03150090
031600                                                                  03160090
031700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03170090
031800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03180090
031900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03190090
032000                                                                  03200090
032100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03210090
032200                                                                  03220090
032300     MOVE LENGTH OF CE616AI        TO DP030-MAP-LENGTH (1).       03230093
032400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03240090
032500     SET DP030-OVERRIDE-APPL-ERROR TO TRUE.                       03250090
032600                                                                  03260090
032700     PERFORM 0001-CALL-CICS-ARCH-API.                             03270090
032800     PERFORM 1000-CONTROL-PROCESSING                              03280090
032900                                                                  03290090
033000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03300090
033100     PERFORM 0001-CALL-CICS-ARCH-API.                             03310090
033200                                                                  03320090
033300*---------------------------------------------------------------* 03330090
033400*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 03340090
033500*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 03350090
033600*---------------------------------------------------------------* 03360090
033700 0001-CALL-CICS-ARCH-API.                                         03370090
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03381099
033900                                    DFHCOMMAREA                   03390099
034000                                    DP030-CICS-API-FIELDS         03400099
034100                                    DP020-STANDARD-COMMAREA       03410099
034200                                    CE616AI.                      03420099
034300                                                                  03430090
034400     IF DP030-RC-CALL-SUCCESSFUL                                  03440090
034500         CONTINUE                                                 03450090
034600     ELSE                                                         03460090
034700         SET DP013-NO-ROLLBACK                                    03470090
034800             DP013-XCTL-DISPLAY-RESTART                           03480090
034900             DP013-CICS-ABEND      TO TRUE                        03490090
035000         MOVE '0001-CALL-CICS-ARCH-API'                           03500090
035100                                   TO DP013-PARAGRAPH             03510090
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03511099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03512099
035400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03540090
035500         PERFORM DP013-0000-PROCESS-ABEND                         03550090
035600     END-IF.                                                      03560090
035700                                                                  03570090
035800*----------------------------------------------------------------*03580090
035900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *03590090
036000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *03600090
036100*                                                                *03610090
036200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *03620090
036300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *03630090
036400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *03640090
036500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *03650090
036600*----------------------------------------------------------------*03660090
036700 1000-CONTROL-PROCESSING.                                         03670090
036800                                                                  03680090
036900     EVALUATE TRUE                                                03690090
037000         WHEN DP020-NEXT-ACT-INITIAL                              03700090
037100             INITIALIZE ASC-SPECIFIC-COMMAREA                     03710090
037200             MOVE EIBTRMID          TO ASC-LIST-TERM-ID           03720090
037300                                       ASC-SEL-TERM-ID            03730090
037400             MOVE DP020-SRC-TASK-NUMBER                           03740090
037500                                    TO ASC-LIST-TASK-NUMBER       03750090
037600                                       ASC-SEL-TASK-NUMBER        03760090
037700             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               03770090
037800             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                03780090
037900             MOVE DP020-USERID      TO ASC-TK-NBR                 03790092
038000             PERFORM 7000-GET-USR-NAME                            03800092
038100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 03810090
038200             IF PS-COMMAREA-NOT-VALID                             03820090
038300                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            03830090
038400             ELSE                                                 03840090
038500                 PERFORM 4000-BUILD-INITIAL-PANEL                 03850090
038600                 PERFORM 3200-RESET-ATTRIBUTES                    03860091
038700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              03870091
038800                 MOVE -1                     TO AADJTOL           03880091
038900             END-IF                                               03890090
039000                                                                  03900090
039100         WHEN DP020-NEXT-ACT-READ-MAP                             03910090
039200             PERFORM 2000-PROCESS-PANEL                           03920090
039300                                                                  03930091
039400         WHEN DP020-NEXT-ACT-RETURN                               03940090
039500             PERFORM 4000-BUILD-INITIAL-PANEL                     03950090
039600             PERFORM 3200-RESET-ATTRIBUTES                        03960091
039700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  03970091
039800             MOVE -1                     TO AADJTOL               03980091
039900                                                                  03990090
040000         WHEN OTHER                                               04000090
040100             SET DP013-LOGIC-ABEND TO TRUE                        04010090
040200             SET DP013-NO-ROLLBACK TO TRUE                        04020090
040300             MOVE '1000-CONTROL-PROCESSING'                       04030090
040400                                   TO DP013-PARAGRAPH             04040090
040500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04050090
040600                                   TO DP013-MESSAGE-TEXT(1)       04060090
040700             PERFORM DP013-0000-PROCESS-ABEND                     04070090
040800     END-EVALUATE.                                                04080090
040900                                                                  04090090
041000*----------------------------------------------------------------*04100090
041100* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *04110090
041200*----------------------------------------------------------------*04120090
041300 1100-PROCESS-INTER-APPL-COMM.                                    04130090
041400                                                                  04140090
041500     SET PS-COMMAREA-VALID         TO TRUE.                       04150090
041600                                                                  04160090
041700     IF CE002-NUMBER-OF-SELECTED-ITEMS = ZERO                     04170090
041800         SET DP020-MSG-FATAL                                      04180090
041900             DP020-NEXT-ACT-APPL-ERROR                            04190090
042000             PS-ERROR              TO TRUE                        04200090
042100         MOVE PC-TSYMSG-00057      TO DP020-MSG-NUMBER            04210090
042200     ELSE                                                         04220090
042300         SET ASC-USE-SELECTION-QUEUE TO TRUE                      04230090
042400         MOVE CE002-NUMBER-OF-TS-ITEMS                            04240090
042500                                   TO ASC-NUMBER-OF-TS-ITEMS      04250090
042600         MOVE CE002-SEL-QUEUE-NAME TO ASC-SEL-QUEUE-NAME-IN       04260090
042700         MOVE CE003-MAX-ITEMS      TO ASC-SEL-SUB                 04270090
042800         MOVE ZEROES               TO ASC-SEL-ITEM                04280090
042900         MOVE CE002-CS-LOCATION    TO ASC-LOC                     04290097
043000         MOVE CE002-PULL-NBR       TO ASC-PULL-NBR                04300097
043100                                      ASC-KEY-PULL-NBR            04310097
043200         MOVE CE002-LNE-NBR        TO ASC-PULL-LNE-NBR            04320097
043300                                      ASC-KEY-LINE-NBR            04330097
043400         MOVE CE002-SKU-NBR        TO PV-SKU-8                    04341099
043800         MOVE PV-SKU-8             TO ASC-SKU                     04380097
043900         MOVE CE002-SKU-RETAIL     TO ASC-AMT                     04390097
044000         PERFORM 2160-GET-NEXT-RECORD                             04400090
044100     END-IF.                                                      04410090
044300*----------------------------------------------------------------*04430090
044400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04440090
044500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04450090
044600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04460090
044700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04470090
044800* FUNCTION KEYS CAN GET THIS FAR.                                *04480090
044900*----------------------------------------------------------------*04490090
045000 2000-PROCESS-PANEL.                                              04500090
045100                                                                  04510090
045200     EVALUATE TRUE                                                04520090
045300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04530090
045400             MOVE SPACES TO ASC-ADJ-QTY-TO                        04540098
045500                            ASC-REASON-L1                         04550098
045600                            ASC-REASON-L2                         04560098
045700                            ASC-REASON-L3                         04570098
045800                            ASC-REASON-L4                         04580098
045900                            ASC-REASON-L5                         04590098
046000             PERFORM 4000-BUILD-INITIAL-PANEL                     04600090
046100             PERFORM 3200-RESET-ATTRIBUTES                        04610091
046200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04620091
046300             MOVE -1                     TO AADJTOL               04630091
046400                                                                  04640090
046500         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             04650090
046600             IF ASC-USE-SELECTION-QUEUE                           04660090
046700                 PERFORM 2160-GET-NEXT-RECORD                     04670090
046800                 PERFORM 4000-BUILD-INITIAL-PANEL                 04680090
046900             ELSE                                                 04690090
047000*--- BOTTOM OF LIST ---                                           04700090
047100                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         04710090
047200                 SET DP020-MSG-INFORMATIONAL TO TRUE              04720090
047300             END-IF                                               04730090
047400                                                                  04740090
047500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             04750090
047600             IF ASC-USE-SELECTION-QUEUE                           04760090
047700                 PERFORM 2170-GET-PREV-RECORD                     04770090
047800                 PERFORM 4000-BUILD-INITIAL-PANEL                 04780090
047900             ELSE                                                 04790090
048000*--- TOP OF LIST ---                                              04800090
048100                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         04810090
048200                 SET DP020-MSG-INFORMATIONAL TO TRUE              04820090
048300             END-IF                                               04830090
048400                                                                  04840090
048500         WHEN OTHER                                               04850090
048600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04860090
048700***          PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04870092
048800             IF PS-NO-ERROR                                       04880090
048900                 SET DP030-CONTINUE-GO TO TRUE                    04890090
049000                 PERFORM 2100-CHECK-FUNCTION-KEY                  04900090
049100             ELSE                                                 04910090
049200                 SET DP030-OVERRIDE-GO TO TRUE                    04920090
049300             END-IF                                               04930090
049400     END-EVALUATE.                                                04940090
049500                                                                  04950090
049600*----------------------------------------------------------------*04960090
049700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*04970090
049800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *04980090
049900* CICS ARCHITECTURE API.                                         *04990090
050000*----------------------------------------------------------------*05000092
050100 2100-CHECK-FUNCTION-KEY.                                         05010090
050200                                                                  05020090
050300     EVALUATE TRUE                                                05030090
050400*ENTER                                                            05040092
050500         WHEN DP020-SRC-AID = DP016-ENTER                         05050092
050600             PERFORM 3200-RESET-ATTRIBUTES                        05060097
050700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05070092
050800             PERFORM 2300-SET-ADJUST-MESSAGE                      05080092
050900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05090092
051000             MOVE -1                     TO AADJTOL               05100092
051100                                                                  05110092
051200*F15=UPDATE                                                       05120092
051300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              05130092
051400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05140092
051500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05150092
051600             IF PS-NO-ERROR                                       05160092
051700                 PERFORM 4100-PREPARE-KEYS                        05170097
051800                 PERFORM 8000-UPDATE-ADJ-QTY                      05180092
051900                 PERFORM 8100-INSERT-ADJ-AUD                      05190092
052000                 MOVE ASC-DS-QTY-CURR        TO ASC-DS-QTY-PREV   05200092
052100                                                ADSUNTPO          05210092
052200                 MOVE ASC-DS-AMT-CURR        TO ASC-DS-AMT-PREV   05220092
052300                                                ADSRTLPO          05230092
052400                 MOVE ASC-ADJ-QTY-TO-N       TO ASC-DS-QTY-CURR   05240092
052500                                                ADSUNTO           05250092
052600                 MOVE SPACES                 TO ASC-ADJ-QTY-TO    05260099
052700                                                AADJTOO           05270099
052800                 COMPUTE ASC-DS-AMT-CURR ROUNDED                  05280092
052900                       = ASC-DS-QTY-CURR * ASC-AMT                05290092
053000                 MOVE ASC-DS-AMT-CURR        TO ADSRTLO           05300092
053100                 MOVE SPACES                 TO AADJMSGO          05310092
053200                 PERFORM 4120-GET-CEPLAU-QTY                      05320099
053300                 MOVE ASC-AU-QTY-TOT         TO AADJUNTO          05330099
053400                 MOVE DP015-UNP-ALP-NOR-OFF  TO AADJTOA           05340092
053500                 MOVE DP015-GREEN            TO AADJTOC           05350092
053600                 MOVE DP015-UNDERLINE        TO AADJTOH           05360092
053700                 MOVE PC-TSYMSG-00059        TO DP020-MSG-NUMBER  05370092
053800                 SET DP020-MSG-INFORMATIONAL TO TRUE              05380092
053900             END-IF                                               05390092
054000                                                                  05400092
054100*F22=ADJ LIST (CEKCS614 - 'CELSTADJ')                             05410095
054200         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              05420092
054300             PERFORM 5000-PREPARE-SEL-QUEUE                       05430092
054400                                                                  05440092
054500         WHEN OTHER                                               05450090
054600             SET DP013-NO-ROLLBACK                                05460090
054700                 DP013-XCTL-DISPLAY-RESTART                       05470090
054800                 DP013-CICS-ABEND  TO TRUE                        05480090
054900             MOVE '2100-CHECK-FUNCTION-KEY'                       05490090
055000                                   TO DP013-PARAGRAPH             05500090
055100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05510090
055200                                   TO DP013-MESSAGE-TEXT (1)      05520090
055300             PERFORM DP013-0000-PROCESS-ABEND                     05530090
055400     END-EVALUATE.                                                05540090
055500                                                                  05550090
055600******************************************************************05560090
055700* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *05570090
055800* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *05580090
055900******************************************************************05590090
056000 2160-GET-NEXT-RECORD.                                            05600090
056100                                                                  05610090
056200     ADD  +1 TO ASC-SEL-SUB.                                      05620090
056300                                                                  05630090
056400     IF ASC-SEL-SUB > CE003-MAX-ITEMS                             05640091
056500         ADD  +1 TO ASC-SEL-ITEM                                  05650090
056600         MOVE +1 TO ASC-SEL-SUB                                   05660090
056700     END-IF.                                                      05670090
056800                                                                  05680090
056900     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 05690090
057000         PERFORM 9100-READ-SEL-QUEUE                              05700090
057100         IF CE003-ITEM (ASC-SEL-SUB) > ZERO                       05710090
057200             MOVE ZEROES TO ASC-DS-QTY-PREV                       05720098
057300                            ASC-DS-AMT-PREV                       05730098
057400             MOVE SPACES TO ASC-ADJ-QTY-TO                        05740098
057500                            AADJTOO                               05750098
057600             MOVE CE003-MFST-UNT-QTY (ASC-SEL-SUB)                05760090
057700               TO ASC-MF-QTY-TOT                                  05770090
057800             MOVE CE003-STR-NBR (ASC-SEL-SUB)                     05780090
057900               TO ASC-STR                                         05790090
058000                  ASC-KEY-STR-NBR                                 05800091
058100             MOVE CE003-ADJ-UNT-QTY (ASC-SEL-SUB)                 05810090
058200               TO ASC-AU-QTY-TOT                                  05820090
058300             SET CE003-INQ (ASC-SEL-SUB) TO TRUE                  05830090
058400             PERFORM 9200-REWRITE-LIST-QUEUE                      05840090
058500         ELSE                                                     05850090
058600             SUBTRACT +1 FROM ASC-SEL-SUB                         05860090
058700*--- BOTTOM OF LIST ---                                           05870090
058800             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             05880090
058900             SET DP020-MSG-INFORMATIONAL TO TRUE                  05890090
059000         END-IF                                                   05900090
059100     ELSE                                                         05910090
059200         SUBTRACT +1 FROM ASC-SEL-ITEM                            05920090
059300         MOVE CE003-MAX-ITEMS TO ASC-SEL-SUB                      05930090
059400         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                 05940090
059500         SET DP020-MSG-INFORMATIONAL TO TRUE                      05950090
059600     END-IF.                                                      05960090
059700                                                                  05970090
059800******************************************************************05980090
059900* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *05990090
060000* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *06000090
060100******************************************************************06010090
060200 2170-GET-PREV-RECORD.                                            06020090
060300                                                                  06030090
060400     SUBTRACT +1 FROM ASC-SEL-SUB.                                06040090
060500                                                                  06050090
060600     IF ASC-SEL-SUB < +1                                          06060090
060700         SUBTRACT +1 FROM ASC-SEL-ITEM                            06070090
060800         MOVE CE003-MAX-ITEMS TO ASC-SEL-SUB                      06080090
060900     END-IF.                                                      06090090
061000                                                                  06100090
061100     IF ASC-SEL-ITEM > ZERO                                       06110090
061200         PERFORM 9100-READ-SEL-QUEUE                              06120090
061300         MOVE ZEROES TO ASC-DS-QTY-PREV                           06130098
061400                        ASC-DS-AMT-PREV                           06140098
061500         MOVE SPACES TO ASC-ADJ-QTY-TO                            06150098
061600                        AADJTOO                                   06160098
061700         MOVE CE003-MFST-UNT-QTY (ASC-SEL-SUB)                    06170090
061800               TO ASC-MF-QTY-TOT                                  06180090
061900         MOVE CE003-STR-NBR (ASC-SEL-SUB)                         06190090
062000               TO ASC-STR                                         06200090
062100                  ASC-KEY-STR-NBR                                 06210091
062200         MOVE CE003-ADJ-UNT-QTY (ASC-SEL-SUB)                     06220090
062300               TO ASC-AU-QTY-TOT                                  06230090
062400     ELSE                                                         06240090
062500         MOVE +1 TO ASC-SEL-ITEM                                  06250090
062600                    ASC-SEL-SUB                                   06260090
062700*--- TOP OF LIST ---                                              06270090
062800         MOVE PC-TSYMSG-00069        TO DP020-MSG-NUMBER          06280090
062900         SET DP020-MSG-INFORMATIONAL TO TRUE                      06290090
063000     END-IF.                                                      06300090
063100                                                                  06310090
063200*----------------------------------------------------------------*06320090
063300*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *06330090
063400*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *06340090
063500*----------------------------------------------------------------*06350092
063600 2200-MOVE-SCREEN-TO-COMMAREA.                                    06360090
063700                                                                  06370090
063800*STORE DISTRIBUTION ADJUSTMENT QUANTITY.                          06380091
063900     IF AADJTOL > ZERO                                            06390091
064000         MOVE AADJTOI         TO ASC-ADJ-QTY-TO                   06400091
064100***  ELSE                                                         06410098
064200***      MOVE SPACES          TO ASC-ADJ-QTY-TO                   06420098
064300     END-IF.                                                      06430090
064400                                                                  06440090
064500*STORE DISTRIBUTION ADJUSTMENT REASON LINES.                      06450092
064600     IF ARSN01L > ZERO                                            06460092
064700         MOVE ARSN01I         TO ASC-REASON-L1                    06470092
064800     END-IF.                                                      06480092
064900     IF ARSN02L > ZERO                                            06490092
065000         MOVE ARSN02I         TO ASC-REASON-L2                    06500092
065100     END-IF.                                                      06510092
065200     IF ARSN03L > ZERO                                            06520092
065300         MOVE ARSN03I         TO ASC-REASON-L3                    06530092
065400     END-IF.                                                      06540092
065500     IF ARSN04L > ZERO                                            06550092
065600         MOVE ARSN04I         TO ASC-REASON-L4                    06560092
065700     END-IF.                                                      06570092
065800     IF ARSN05L > ZERO                                            06580092
065900         MOVE ARSN05I         TO ASC-REASON-L5                    06590092
066000     END-IF.                                                      06600092
066100                                                                  06610090
066200*----------------------------------------------------------------*06620092
066300*  CREATE AN ADJUSTMENT MESSAGE WHEN USER CHANGES THE ADJ QTY.   *06630092
066400*----------------------------------------------------------------*06640095
066500 2300-SET-ADJUST-MESSAGE.                                         06650092
066600                                                                  06660092
066700     IF ASC-ADJ-QTY-TO NOT > SPACES                               06670099
066800         MOVE SPACES TO AADJMSGO                                  06680099
066900     ELSE                                                         06690099
067000         MOVE ASC-ADJ-QTY-TO             TO DP010I-UNEDITED-FIELD 06700099
067100         MOVE LENGTH OF ASC-ADJ-QTY-TO   TO DP010I-MAXIMUM-DIGITS 06710099
067200         MOVE ZERO                     TO DP010I-MAXIMUM-DECIMALS 06720099
067300         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06730099
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06741099
263455              USING DP010I-NUMERIC-EDIT-AREA                      06742099
067500         IF DP010I-ERROR-DETECTED                                 06750099
067600             MOVE SPACES TO AADJMSGO                              06760099
067700         ELSE                                                     06770099
067800             MOVE DP010I-NUMERIC-FIELD   TO ASC-ADJ-QTY-TO-N      06780099
067900             MOVE ASC-ADJ-QTY-TO-N       TO PV-DISP-5             06790099
068000             MOVE PV-DISP-5              TO AADJTOO               06800099
068100             IF ASC-ADJ-QTY-TO-N = ASC-DS-QTY-CURR                06810099
068200                 MOVE SPACES TO AADJMSGO                          06820099
068300             ELSE                                                 06830099
068400                 COMPUTE PV-CHG-DIFF = ASC-DS-QTY-CURR            06840099
068500                                     - ASC-ADJ-QTY-TO-N           06850099
068600                 MOVE PV-CHG-DIFF   TO PV-CHG-DIFF-DISP           06860099
068700                 IF PV-CHG-DIFF > +0                              06870099
068800                     STRING '(DISTRIBUTED UNITS '                 06880099
068900                            'WILL BE DECREASED BY '               06890099
069000                             PV-CHG-DIFF-DISP ')'                 06900099
069100                         DELIMITED BY SIZE INTO AADJMSGO          06910099
069200                 ELSE                                             06920099
069300                     STRING '(DISTRIBUTED UNITS '                 06930099
069400                            'WILL BE INCREASED BY '               06940099
069500                             PV-CHG-DIFF-DISP ')'                 06950099
069600                         DELIMITED BY SIZE INTO AADJMSGO          06960099
069700             END-IF                                               06970099
069800         END-IF                                                   06980099
069900     END-IF.                                                      06990099
070000                                                                  07000099
070100*----------------------------------------------------------------*07010090
070200*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *07020090
070300*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *07030090
070400*----------------------------------------------------------------*07040090
070500 3000-EDIT-DATA-IN-COMMAREA.                                      07050090
070600                                                                  07060091
070700     PERFORM 3200-RESET-ATTRIBUTES.                               07070091
070800     SET PS-NO-ERROR TO TRUE.                                     07080091
070900                                                                  07090091
071000*VALIDATE ADJUSTMENT QUANTITY.                                    07100092
071100     IF ASC-ADJ-QTY-TO > SPACES                                   07110097
071200         MOVE ASC-ADJ-QTY-TO             TO DP010I-UNEDITED-FIELD 07120091
071300         MOVE LENGTH OF ASC-ADJ-QTY-TO   TO DP010I-MAXIMUM-DIGITS 07130091
071400         MOVE ZERO                     TO DP010I-MAXIMUM-DECIMALS 07140091
071500         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07150091
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07161099
263455              USING DP010I-NUMERIC-EDIT-AREA                      07162099
071700         IF DP010I-ERROR-DETECTED                                 07170092
071800             SET PS-ERROR                                         07180091
071900                 DP020-MSG-FATAL         TO TRUE                  07190091
072000             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      07200098
072100             MOVE DP015-UNP-ALP-BRT-OFF  TO AADJTOA               07210091
072200             MOVE -1                     TO AADJTOL               07220098
072300             MOVE DP015-RED              TO AADJTOC               07230091
072400             MOVE DP015-REVERSE          TO AADJTOH               07240091
072500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07250091
072600         ELSE                                                     07260091
072700             MOVE DP010I-NUMERIC-FIELD   TO ASC-ADJ-QTY-TO-N      07270092
072800             MOVE ASC-ADJ-QTY-TO-N       TO PV-DISP-5             07280097
072900             MOVE PV-DISP-5              TO AADJTOO               07290097
073000             IF ASC-ADJ-QTY-TO-N = ASC-DS-QTY-CURR                07300098
073100                 SET PS-ERROR                                     07310098
073200                     DP020-MSG-FATAL         TO TRUE              07320098
073300                 MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER  07330098
073400                 MOVE DP015-UNP-ALP-BRT-OFF  TO AADJTOA           07340098
073500                 MOVE -1                     TO AADJTOL           07350098
073600                 MOVE DP015-RED              TO AADJTOC           07360098
073700                 MOVE DP015-REVERSE          TO AADJTOH           07370098
073800                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07380098
073900             END-IF                                               07390098
074000         END-IF                                                   07400098
074100     ELSE                                                         07410092
074200         SET PS-ERROR                                             07420092
074300             DP020-MSG-FATAL             TO TRUE                  07430092
074400         MOVE PC-TSYMSG-00007            TO DP020-MSG-NUMBER      07440098
074500         MOVE DP015-UNP-ALP-BRT-OFF      TO AADJTOA               07450092
074600         MOVE DP015-RED                  TO AADJTOC               07460092
074700         MOVE DP015-REVERSE              TO AADJTOH               07470092
074800         MOVE -1                         TO AADJTOL               07480092
074900         SET DP030-SET-CURSOR-APPL-1     TO TRUE                  07490092
075000     END-IF.                                                      07500092
075100                                                                  07510090
075200*REMOVE UNDERSCORES FROM ADJUSTMENT REASON.                       07520092
075300***  INSPECT ASC-REASON-L1 CONVERTING '_' TO ' '.                 07530099
075400***  INSPECT ASC-REASON-L2 CONVERTING '_' TO ' '.                 07540099
075500***  INSPECT ASC-REASON-L3 CONVERTING '_' TO ' '.                 07550099
075600***  INSPECT ASC-REASON-L4 CONVERTING '_' TO ' '.                 07560099
075700***  INSPECT ASC-REASON-L5 CONVERTING '_' TO ' '.                 07570099
075800                                                                  07580092
075900*VALIDATE ADJUSTMENT REASON.                                      07590092
076000     IF ASC-REASON-L1 NOT > SPACES                                07600092
076100       AND ASC-REASON-L2 NOT > SPACES                             07610092
076200       AND ASC-REASON-L3 NOT > SPACES                             07620092
076300       AND ASC-REASON-L4 NOT > SPACES                             07630092
076400       AND ASC-REASON-L5 NOT > SPACES                             07640092
076500         SET PS-ERROR                                             07650092
076600             DP020-MSG-FATAL             TO TRUE                  07660092
076700         MOVE PC-TSYMSG-00007            TO DP020-MSG-NUMBER      07670098
076800         MOVE DP015-UNP-ALP-BRT-OFF      TO ARSN01A               07680092
076900                                            ARSN02A               07690092
077000                                            ARSN03A               07700092
077100                                            ARSN04A               07710092
077200                                            ARSN05A               07720092
077300         MOVE DP015-RED                  TO ARSN01C               07730092
077400                                            ARSN02C               07740092
077500                                            ARSN03C               07750092
077600                                            ARSN04C               07760092
077700                                            ARSN05C               07770092
077800         MOVE DP015-REVERSE              TO ARSN01H               07780092
077900                                            ARSN02H               07790092
078000                                            ARSN03H               07800092
078100                                            ARSN04H               07810092
078200                                            ARSN05H               07820092
078300         MOVE -1                         TO ARSN01L               07830092
078400         SET DP030-SET-CURSOR-APPL-1     TO TRUE                  07840092
078500     END-IF.                                                      07850092
078600                                                                  07860092
078700*----------------------------------------------------------------*07870090
078800*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *07880090
078900*----------------------------------------------------------------*07890091
079000 3200-RESET-ATTRIBUTES.                                           07900090
079100                                                                  07910090
079200     MOVE DP015-UNP-ALP-NOR-OFF     TO AADJTOA.                   07920091
079300     MOVE DP015-GREEN               TO AADJTOC.                   07930091
079400     MOVE DP015-UNDERLINE           TO AADJTOH.                   07940091
079500                                                                  07950090
079600     MOVE DP015-UNP-ALP-NOR-OFF     TO ARSN01A.                   07960091
079700     MOVE DP015-GREEN               TO ARSN01C.                   07970091
079800     MOVE DP015-UNDERLINE           TO ARSN01H.                   07980091
079900                                                                  07990091
080000     MOVE DP015-UNP-ALP-NOR-OFF     TO ARSN02A.                   08000091
080100     MOVE DP015-GREEN               TO ARSN02C.                   08010091
080200     MOVE DP015-UNDERLINE           TO ARSN02H.                   08020091
080300                                                                  08030091
080400     MOVE DP015-UNP-ALP-NOR-OFF     TO ARSN03A.                   08040091
080500     MOVE DP015-GREEN               TO ARSN03C.                   08050091
080600     MOVE DP015-UNDERLINE           TO ARSN03H.                   08060091
080700                                                                  08070091
080800     MOVE DP015-UNP-ALP-NOR-OFF     TO ARSN04A.                   08080091
080900     MOVE DP015-GREEN               TO ARSN04C.                   08090091
081000     MOVE DP015-UNDERLINE           TO ARSN04H.                   08100091
081100                                                                  08110091
081200     MOVE DP015-UNP-ALP-NOR-OFF     TO ARSN05A.                   08120091
081300     MOVE DP015-GREEN               TO ARSN05C.                   08130091
081400     MOVE DP015-UNDERLINE           TO ARSN05H.                   08140091
081500                                                                  08150091
081600*----------------------------------------------------------------*08160090
081700*    DISPLAY THE PANEL TO USER.                                  *08170090
081800*----------------------------------------------------------------*08180090
081900 4000-BUILD-INITIAL-PANEL.                                        08190090
082000                                                                  08200090
082100     PERFORM 4100-PREPARE-KEYS.                                   08210090
082200                                                                  08220090
082300     PERFORM 4110-GET-CEPLMF-QTY.                                 08230099
082400     PERFORM 4120-GET-CEPLAU-QTY.                                 08240099
082500                                                                  08250099
082600     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         08260090
082700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08270090
082800                                                                  08280090
082900*----------------------------------------------------------------*08290090
083000*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *08300090
083100*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *08310090
083200*----------------------------------------------------------------*08320090
083300 4100-PREPARE-KEYS.                                               08330090
083400                                                                  08340090
083500     MOVE ASC-KEY-PULL-NBR         TO DK-PULL-NBR.                08350091
083600     MOVE ASC-KEY-LINE-NBR         TO DK-PL-LNE-NBR.              08360091
083700     MOVE ASC-KEY-STR-NBR          TO DK-STR-NBR.                 08370091
083800                                                                  08380090
083900*----------------------------------------------------------------*08390099
084000* GET STORE MANIFEST QUANTITY                                    *08400099
084100*----------------------------------------------------------------*08410099
084200 4110-GET-CEPLMF-QTY.                                             08420099
084300                                                                  08430099
084400     INITIALIZE PV-NULL-IND.                                      08440099
084500                                                                  08450099
084600     EXEC SQL                                                     08460099
084700        SELECT SUM(MFST_UNT_QTY)                                  08470099
084800          INTO  :CEPLMF-MFST-UNT-QTY :PV-NULL-IND                 08480099
084900          FROM  TCEPLMF                                           08490099
085000         WHERE  CNSTK_REQ_PL_NBR   = :DK-PULL-NBR                 08500099
085100           AND  PL_LNE_NBR         = :DK-PL-LNE-NBR               08510099
085200           AND  STR_NBR            = :DK-STR-NBR                  08520099
085300     END-EXEC.                                                    08530099
085400                                                                  08540099
085500     EVALUATE TRUE                                                08550099
085600         WHEN SQLCODE = ZERO                                      08560099
085700             IF PV-NULL-IND < +0                                  08570099
085800                 MOVE ZEROES TO ASC-MF-QTY-TOT                    08580099
085900             ELSE                                                 08590099
086000                 MOVE CEPLMF-MFST-UNT-QTY TO ASC-MF-QTY-TOT       08600099
086100             END-IF                                               08610099
086200                                                                  08620099
086300         WHEN SQLCODE = -904                                      08630099
086400         WHEN SQLCODE = -911                                      08640099
086500         WHEN SQLCODE = -913                                      08650099
086600             PERFORM 9900-SOFT-ABORT                              08660099
086700                                                                  08670099
086800         WHEN OTHER                                               08680099
086900             MOVE '4110-GET-CEPLMF-QTY' TO DP013-PARAGRAPH        08690099
087000             MOVE 'GET MANIFEST UNITS'  TO DP013-MESSAGE-TEXT (1) 08700099
087100             MOVE SQLCA                 TO DP013-SQLCA            08710099
087200             MOVE 'TCEPLMF ' TO DP013-DB2-TABLE-NAME (1)          08720099
087300             SET DP013-DB2-ABEND                                  08730099
087400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               08740099
087500             PERFORM DP013-0000-PROCESS-ABEND                     08750099
087600     END-EVALUATE.                                                08760099
087700                                                                  08770099
087800*----------------------------------------------------------------*08780099
087900* GET STORE ADJUSTMENT QUANTITY                                  *08790099
088000*----------------------------------------------------------------*08800099
088100 4120-GET-CEPLAU-QTY.                                             08810099
088200                                                                  08820099
088300     INITIALIZE PV-NULL-IND-1                                     08830099
088400                PV-NULL-IND-2                                     08840099
088500                CEPLAU-BEF-ADJ-UNT-QTY                            08850099
088600                CEPLAU-AFT-ADJ-UNT-QTY.                           08860099
088700                                                                  08870099
088800     EXEC SQL                                                     08880099
088900        SELECT  SUM(BEF_ADJ_UNT_QTY)                              08890099
089000             ,  SUM(AFT_ADJ_UNT_QTY)                              08900099
089100          INTO :CEPLAU-BEF-ADJ-UNT-QTY :PV-NULL-IND-1             08910099
089200             , :CEPLAU-AFT-ADJ-UNT-QTY :PV-NULL-IND-2             08920099
089300          FROM  TCEPLAU                                           08930099
089400         WHERE  CNSTK_REQ_PL_NBR   = :DK-PULL-NBR                 08940099
089500           AND  PL_LNE_NBR         = :DK-PL-LNE-NBR               08950099
089600           AND  STR_NBR            = :DK-STR-NBR                  08960099
089700     END-EXEC.                                                    08970099
089800                                                                  08980099
089900     EVALUATE TRUE                                                08990099
090000         WHEN SQLCODE = ZERO                                      09000099
090100             COMPUTE ASC-AU-QTY-TOT = CEPLAU-AFT-ADJ-UNT-QTY      09010099
090200                                    - CEPLAU-BEF-ADJ-UNT-QTY      09020099
090300                                                                  09030099
090400         WHEN SQLCODE = -904                                      09040099
090500         WHEN SQLCODE = -911                                      09050099
090600         WHEN SQLCODE = -913                                      09060099
090700             PERFORM 9900-SOFT-ABORT                              09070099
090800                                                                  09080099
090900         WHEN OTHER                                               09090099
091000             MOVE '4120-GET-CEPLAU-QTY'  TO DP013-PARAGRAPH       09100099
091100             MOVE 'GET ADJUSTMENT UNITS' TO DP013-MESSAGE-TEXT (1)09110099
091200             MOVE SQLCA                  TO DP013-SQLCA           09120099
091300             MOVE 'TCEPLAU ' TO DP013-DB2-TABLE-NAME (1)          09130099
091400             SET DP013-DB2-ABEND                                  09140099
091500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09150099
091600             PERFORM DP013-0000-PROCESS-ABEND                     09160099
091700     END-EVALUATE.                                                09170099
091800                                                                  09180099
091900*----------------------------------------------------------------*09190090
092000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *09200090
092100*----------------------------------------------------------------*09210090
092200 4400-MOVE-COMMAREA-TO-SCREEN.                                    09220090
092300                                                                  09230090
092400     MOVE ASC-LOC                  TO ALOCIDO.                    09240091
092500     MOVE ASC-SKU                  TO ASKUO.                      09250091
092600     MOVE ASC-MF-QTY-TOT           TO AMFUNTO.                    09260091
092700     MOVE ASC-STR                  TO ASTRNOO.                    09270091
092800     MOVE ASC-AMT                  TO ASKRETO.                    09280091
092900     MOVE ASC-AU-QTY-TOT           TO AADJUNTO.                   09290091
093000     MOVE ASC-PULL-NBR             TO APULNOO.                    09300091
093100     MOVE ASC-PULL-LNE-NBR         TO ALNENOO.                    09310091
093200                                                                  09320091
093300     PERFORM 7100-GET-STR-DS.                                     09330092
093400     MOVE ASC-DS-QTY-CURR          TO ADSUNTO.                    09340091
093500     MOVE ASC-DS-AMT-CURR          TO ADSRTLO.                    09350091
093600                                                                  09360092
093700     MOVE ASC-DS-QTY-PREV          TO ADSUNTPO.                   09370092
093800     MOVE ASC-DS-AMT-PREV          TO ADSRTLPO.                   09380091
093900                                                                  09390092
094000*JPL MOVE ASC-ADJ-QTY-TO           TO AADJTOO.                    09400098
094100     IF ASC-ADJ-QTY-TO-N NUMERIC                                  09410098
094200         MOVE ASC-ADJ-QTY-TO-N     TO PV-DISP-5                   09420098
094300         MOVE PV-DISP-5            TO AADJTOO                     09430098
094400     END-IF.                                                      09440098
094500     MOVE SPACES                   TO AADJMSGO.                   09450092
094600                                                                  09460091
094700     MOVE ASC-TK-NBR               TO AADJTKO.                    09470091
094800     MOVE ASC-TK-NAME              TO AADJNMO.                    09480092
094900                                                                  09490091
095000     MOVE ASC-REASON-L1            TO ARSN01O.                    09500091
095100     MOVE ASC-REASON-L2            TO ARSN02O.                    09510091
095200     MOVE ASC-REASON-L3            TO ARSN03O.                    09520091
095300     MOVE ASC-REASON-L4            TO ARSN04O.                    09530091
095400     MOVE ASC-REASON-L5            TO ARSN05O.                    09540091
095500                                                                  09550090
095600*----------------------------------------------------------------*09560090
095700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *09570090
095800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *09580090
095900* FOR THE SELECTED ITEMS QUEUE.                                  *09590090
096000*                                                                *09600090
096100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *09610090
096200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *09620090
096300* THE ARRAY IS FULL.                                             *09630090
096400*----------------------------------------------------------------*09640098
096500 5000-PREPARE-SEL-QUEUE.                                          09650090
096600                                                                  09660090
096700     MOVE ASC-SEL-QUEUE-NAME TO CE002-SEL-QUEUE-NAME.             09670092
096800     PERFORM 5100-DELETE-SEL-QUEUE.                               09680092
096900                                                                  09690090
097000     MOVE ASC-LOC            TO CE002-CS-LOCATION.                09700099
097100     MOVE ASC-PULL-NBR       TO CE002-PULL-NBR.                   09710099
097200     MOVE ASC-PULL-LNE-NBR   TO CE002-LNE-NBR.                    09720099
097300     MOVE ASC-SKU            TO CE002-SKU-NBR.                    09730099
097400     MOVE ASC-AMT            TO CE002-SKU-RETAIL.                 09740099
097500     MOVE +1                 TO CE002-NUMBER-OF-SELECTED-ITEMS.   09750099
097600     MOVE +1                 TO CE002-NUMBER-OF-TS-ITEMS.         09760099
097700                                                                  09770099
097800     INITIALIZE CE003-SELECTED-ITEM-ARRAY.                        09780099
097900     MOVE 1                  TO CE003-ITEM (1).                   09790099
098000     MOVE ASC-STR            TO CE003-STR-NBR (1).                09800099
098100     MOVE ASC-MF-QTY-TOT     TO CE003-MFST-UNT-QTY (1).           09810095
098200     MOVE ASC-AU-QTY-TOT     TO CE003-ADJ-UNT-QTY (1).            09820095
098300     MOVE ASC-DS-QTY-CURR    TO CE003-DISTRB-UNITS (1).           09830095
098400                                                                  09840095
098500     PERFORM 5205-WRITE-SEL-QUEUE.                                09850092
098600                                                                  09860090
098700*----------------------------------------------------------------*09870092
098800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *09880092
098900*----------------------------------------------------------------*09890092
099000 5100-DELETE-SEL-QUEUE.                                           09900092
099100                                                                  09910092
099200     EXEC CICS                                                    09920092
099300         DELETEQ TS                                               09930092
099400             QUEUE (ASC-SEL-QUEUE-NAME)                           09940092
099500             RESP  (PV-CICS-RESP)                                 09950092
099600     END-EXEC.                                                    09960092
099700                                                                  09970092
099800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      09980092
099900         (PV-CICS-RESP = DFHRESP(QIDERR)))                        09990092
100000         CONTINUE                                                 10000092
100100     ELSE                                                         10010092
100200         SET DP013-CICS-ABEND         TO TRUE                     10020092
100300         SET DP013-NO-ROLLBACK        TO TRUE                     10030092
100400         MOVE '5100-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          10040092
100500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         10050092
100600                                      TO DP013-MESSAGE-TEXT (1)   10060092
100700         PERFORM DP013-0000-PROCESS-ABEND                         10070092
100800     END-IF.                                                      10080092
100900                                                                  10090092
101000*----------------------------------------------------------------*10100092
101100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *10110092
101200*----------------------------------------------------------------*10120092
101300 5205-WRITE-SEL-QUEUE.                                            10130092
101400                                                                  10140092
101500     EXEC CICS                                                    10150092
101600         WRITEQ TS                                                10160092
101700             QUEUE (ASC-SEL-QUEUE-NAME)                           10170092
101800              FROM (CE003-SELECT-RECORD)                          10180092
101900              ITEM (PV-SEL-QUEUE-ITEM)                            10190092
102000              RESP (PV-CICS-RESP)                                 10200092
102100     END-EXEC.                                                    10210092
102200                                                                  10220092
102300     IF PV-CICS-RESP = DFHRESP (NORMAL)                           10230092
102400         CONTINUE                                                 10240092
102500     ELSE                                                         10250092
102600         SET DP013-CICS-ABEND        TO TRUE                      10260092
102700         SET DP013-NO-ROLLBACK       TO TRUE                      10270092
102800         MOVE '5205-WRITE-SEL-QUEUE' TO DP013-PARAGRAPH           10280092
102900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          10290092
103000                                     TO DP013-MESSAGE-TEXT(1)     10300092
103100         PERFORM DP013-0000-PROCESS-ABEND                         10310092
103200     END-IF.                                                      10320092
103300                                                                  10330092
103400*----------------------------------------------------------------*10340090
103500*    GET USER NAME BASED ON ID (TWORKER)                         *10350092
103600*----------------------------------------------------------------*10360094
103700 7000-GET-USR-NAME.                                               10370092
103800                                                                  10380090
103900     EXEC SQL                                                     10390094
104000         SELECT LAST_NAME                                         10400094
104100              , FIR_NAME                                          10410094
104200              , MID_INIT_NAME                                     10420094
104300           INTO :WORKER-LAST-NAME                                 10430094
104400              , :WORKER-FIR-NAME                                  10440094
104500              , :WORKER-MID-INIT-NAME                             10450094
104600           FROM TWORKER                                           10460094
104700          WHERE UID_NBR  = :ASC-TK-NBR                            10470094
104800     END-EXEC.                                                    10480094
104900                                                                  10490094
105000     EVALUATE TRUE                                                10500094
105100         WHEN SQLCODE = ZERO                                      10510094
105200             IF (WORKER-LAST-NAME NOT > SPACES)                   10520094
105300               AND (WORKER-FIR-NAME NOT > SPACES)                 10530094
105400                 MOVE SPACES         TO ASC-TK-NAME               10540094
105500             ELSE                                                 10550094
105600                 PERFORM 7010-STRING-TK-NAME                      10560094
105700                 MOVE WS-OUTPUT-NAME TO ASC-TK-NAME               10570094
105800             END-IF                                               10580094
105900                                                                  10590094
106000         WHEN SQLCODE = +100                                      10600094
106100             MOVE 'UNKNOWN                          '             10610099
106200                                     TO ASC-TK-NAME               10620094
106300                                                                  10630094
106400         WHEN SQLCODE = -904                                      10640094
106500         WHEN SQLCODE = -911                                      10650094
106600         WHEN SQLCODE = -913                                      10660094
106700             PERFORM 9900-SOFT-ABORT                              10670094
106800                                                                  10680094
106900         WHEN OTHER                                               10690094
107000             MOVE SQLCA               TO DP013-SQLCA              10700094
107100             MOVE '7000-GET-USR-NAME' TO DP013-PARAGRAPH          10710094
107200             MOVE 'TWORKER'           TO DP013-DB2-TABLE-NAME (1) 10720094
107300             MOVE 'SELECT NAME FROM WORKER TABLE'                 10730094
107400                                      TO DP013-MESSAGE-TEXT (1)   10740094
107500             SET DP013-DB2-ABEND      TO TRUE                     10750094
107600             PERFORM DP013-0000-PROCESS-ABEND                     10760094
107700     END-EVALUATE.                                                10770094
107800                                                                  10780094
107900*----------------------------------------------------------------*10790094
108000*    CONCATENATE USER LAST/FIRST NAME FOR SCREEN DISPLAY         *10800094
108100*----------------------------------------------------------------*10810094
108200 7010-STRING-TK-NAME.                                             10820094
108300                                                                  10830094
108400     MOVE SPACES TO WS-OUTPUT-NAME.                               10840094
108500     MOVE +1     TO WS-ONAME-SUB.                                 10850094
108600                                                                  10860094
108700     MOVE WORKER-LAST-NAME  TO WS-LAST-NAME.                      10870094
108800     IF WS-LAST-NAME > SPACES                                     10880094
108900         SET PS-LNAME-NOT-DONE TO TRUE                            10890094
109000         MOVE +0 TO WS-LNAME-SUB                                  10900094
109100         MOVE +1 TO WS-LNAME-SUB-2                                10910094
109200         PERFORM 7011-MOVE-LAST-NAME                              10920094
109300           UNTIL PS-LNAME-DONE                                    10930094
109400     END-IF.                                                      10940094
109500                                                                  10950094
109600     MOVE WORKER-FIR-NAME   TO WS-FIRST-NAME.                     10960094
109700     IF WS-FIRST-NAME > SPACES                                    10970094
109800         SET PS-FNAME-NOT-DONE TO TRUE                            10980094
109900         MOVE +0 TO WS-FNAME-SUB                                  10990094
110000         MOVE +1 TO WS-FNAME-SUB-2                                11000094
110100         PERFORM 7012-MOVE-FIRST-NAME                             11010094
110200           UNTIL PS-FNAME-DONE                                    11020094
110300     END-IF.                                                      11030094
110400                                                                  11040094
110500*----------------------------------------------------------------*11050094
110600 7011-MOVE-LAST-NAME.                                             11060094
110700                                                                  11070094
110800     ADD +1 TO WS-LNAME-SUB                                       11080094
110900               WS-LNAME-SUB-2.                                    11090094
111000                                                                  11100094
111100*CHECK LNAME FIELD LENGTH.                                        11110094
111200     IF WS-LNAME-SUB > 18                                         11120094
111300         SET PS-LNAME-DONE TO TRUE                                11130094
111400     ELSE                                                         11140094
111500*MOVE LNAME FIELD CHARACTER.                                      11150094
111600     IF WS-LNAME-BYTE (WS-LNAME-SUB) > SPACES                     11160094
111700         MOVE WS-LNAME-BYTE (WS-LNAME-SUB)                        11170094
111800           TO WS-ONAME-BYTE (WS-ONAME-SUB)                        11180094
111900         ADD +1 TO WS-ONAME-SUB                                   11190094
112000     ELSE                                                         11200094
112100*IF TWO CONTIGUOUS SPACES FOUND, ASSUME DONE WITH LAST NAME.      11210094
112200*(PLACE ', ' IN OUTPUT FIELD TO MARK BEGINNING OF FIRST NAME)     11220094
112300         IF WS-LNAME-BYTE (WS-LNAME-SUB) = SPACES                 11230098
112400             IF WS-LNAME-BYTE (WS-LNAME-SUB-2) = SPACES           11240098
112500                 MOVE ',' TO WS-ONAME-BYTE (WS-ONAME-SUB)         11250098
112600                 ADD +1   TO WS-ONAME-SUB                         11260098
112700                 MOVE ' ' TO WS-ONAME-BYTE (WS-ONAME-SUB)         11270098
112800                 ADD +1   TO WS-ONAME-SUB                         11280098
112900                 SET PS-LNAME-DONE TO TRUE                        11290098
113000             ELSE                                                 11300098
113100                 MOVE ' ' TO WS-ONAME-BYTE (WS-ONAME-SUB)         11310098
113200                 ADD +1   TO WS-ONAME-SUB                         11320098
113300             END-IF                                               11330098
113400         END-IF                                                   11340098
113500     END-IF.                                                      11350094
113600                                                                  11360094
113700*----------------------------------------------------------------*11370094
113800 7012-MOVE-FIRST-NAME.                                            11380094
113900                                                                  11390094
114000     ADD +1 TO WS-FNAME-SUB                                       11400094
114100               WS-FNAME-SUB-2.                                    11410094
114200                                                                  11420094
114300*CHECK FNAME FIELD LENGTH.                                        11430094
114400     IF WS-FNAME-SUB > 12                                         11440094
114500         SET PS-FNAME-DONE TO TRUE                                11450094
114600     ELSE                                                         11460094
114700*MOVE FNAME FIELD CHARACTER.                                      11470094
114800     IF WS-FNAME-BYTE (WS-FNAME-SUB) > SPACES                     11480094
114900         MOVE WS-FNAME-BYTE (WS-FNAME-SUB)                        11490094
115000           TO WS-ONAME-BYTE (WS-ONAME-SUB)                        11500094
115100         ADD +1 TO WS-ONAME-SUB                                   11510094
115200     ELSE                                                         11520094
115300*IF TWO CONTIGUOUS SPACES FOUND, ASSUME DONE WITH FIRST NAME.     11530094
115400     IF WS-FNAME-BYTE (WS-FNAME-SUB) = SPACES                     11540094
115500       AND WS-FNAME-BYTE (WS-FNAME-SUB-2) = SPACES                11550094
115600         MOVE ' ' TO WS-ONAME-BYTE (WS-ONAME-SUB)                 11560094
115700         ADD +1   TO WS-ONAME-SUB                                 11570094
115800*DISPLACE MIDDLE INITIAL, IF PRESENT.                             11580094
115900         MOVE WORKER-MID-INIT-NAME                                11590094
116000                  TO WS-ONAME-BYTE (WS-ONAME-SUB)                 11600094
116100         SET PS-FNAME-DONE TO TRUE                                11610094
116200     END-IF                                                       11620094
116300     END-IF                                                       11630094
116400     END-IF.                                                      11640094
116500                                                                  11650094
116600*----------------------------------------------------------------*11660094
116700*    GET STORE DISTRIBUTION (TCEPLDS)                            *11670092
116800*----------------------------------------------------------------*11680092
116900 7100-GET-STR-DS.                                                 11690092
117000                                                                  11700092
117100     EXEC SQL                                                     11710090
117200         SELECT ACTL_DISTRB_QTY                                   11720091
117300           INTO :CEPLDS-ACTL-DISTRB-QTY :PV-NULL-IND              11730097
117400           FROM TCEPLDS                                           11740091
117500          WHERE CNSTK_REQ_PL_NBR  = :DK-PULL-NBR                  11750091
117600            AND PL_LNE_NBR        = :DK-PL-LNE-NBR                11760091
117700            AND STR_NBR           = :DK-STR-NBR                   11770091
117800     END-EXEC.                                                    11780090
117900                                                                  11790090
118000     EVALUATE TRUE                                                11800090
118100         WHEN SQLCODE = ZERO                                      11810090
118200             IF  PV-NULL-IND < +0                                 11820097
118300                  MOVE ZEROES  TO ASC-DS-QTY-CURR                 11830097
118400                                  ASC-DS-AMT-CURR                 11840097
118500             ELSE                                                 11850097
118600                 MOVE CEPLDS-ACTL-DISTRB-QTY TO ASC-DS-QTY-CURR   11860097
118700                 COMPUTE ASC-DS-AMT-CURR ROUNDED                  11870097
118800                       = ASC-DS-QTY-CURR * ASC-AMT                11880097
118900             END-IF                                               11890098
119000                                                                  11900098
119100         WHEN SQLCODE = +100                                      11910090
119200             CONTINUE                                             11920092
119300                                                                  11930090
119400         WHEN SQLCODE = -904                                      11940090
119500         WHEN SQLCODE = -911                                      11950090
119600         WHEN SQLCODE = -913                                      11960090
119700             PERFORM 9900-SOFT-ABORT                              11970090
119800                                                                  11980090
119900         WHEN SQLWARN0 NOT = SPACE                                11990090
120000         WHEN SQLCODE < ZERO                                      12000090
120100         WHEN SQLCODE > ZERO                                      12010090
120200             MOVE SQLCA             TO DP013-SQLCA                12020091
120300             MOVE '7100-GET-STR-DS' TO DP013-PARAGRAPH            12030092
120400             MOVE 'TCEPLDS'         TO DP013-DB2-TABLE-NAME (1)   12040091
120500             MOVE 'SELECT STORE DISTRIBUTION'                     12050091
120600                                    TO DP013-MESSAGE-TEXT (1)     12060091
120700             SET DP013-DB2-ABEND    TO TRUE                       12070091
120800             PERFORM DP013-0000-PROCESS-ABEND                     12080091
120900     END-EVALUATE.                                                12090090
121000                                                                  12100090
121100*----------------------------------------------------------------*12110092
121200*    UPDATE CENTRAL STOCK DISTRIBUTION QTY (TCEPLDS)             *12120092
121300*----------------------------------------------------------------*12130092
121400 8000-UPDATE-ADJ-QTY.                                             12140092
121500                                                                  12150092
121600     MOVE ASC-ADJ-QTY-TO-N TO CEPLDS-ACTL-DISTRB-QTY.             12160092
121700                                                                  12170092
121800     EXEC SQL                                                     12180092
121900         UPDATE TCEPLDS                                           12190092
122000            SET ACTL_DISTRB_QTY   = :CEPLDS-ACTL-DISTRB-QTY       12200092
122100          WHERE CNSTK_REQ_PL_NBR  = :DK-PULL-NBR                  12210092
122200            AND PL_LNE_NBR        = :DK-PL-LNE-NBR                12220092
122300            AND STR_NBR           = :DK-STR-NBR                   12230092
122400     END-EXEC.                                                    12240092
122500                                                                  12250092
122600     EVALUATE TRUE                                                12260092
122700         WHEN SQLCODE = ZERO                                      12270092
122800             CONTINUE                                             12280092
122900                                                                  12290092
123000         WHEN SQLCODE = -904                                      12300092
123100         WHEN SQLCODE = -911                                      12310092
123200         WHEN SQLCODE = -913                                      12320092
123300             PERFORM 9900-SOFT-ABORT                              12330092
123400                                                                  12340092
123500         WHEN OTHER                                               12350092
123600             MOVE '8000-UPDATE-ADJ-QTY'                           12360092
123700                                    TO DP013-PARAGRAPH            12370092
123800             MOVE 'UNSUCCESSFUL UPDATE OF STORE QTY'              12380092
123900                                    TO DP013-MESSAGE-TEXT (1)     12390092
124000             MOVE SQLCA             TO DP013-SQLCA                12400092
124100             MOVE 'TCEPLDS '        TO DP013-DB2-TABLE-NAME (1)   12410092
124200             SET DP013-DB2-ABEND                                  12420092
124300                 DP013-NO-ROLLBACK  TO TRUE                       12430092
124400             PERFORM DP013-0000-PROCESS-ABEND                     12440092
124500     END-EVALUATE.                                                12450092
124600                                                                  12460092
124700*----------------------------------------------------------------*12470092
124800*    INSERT CENTRAL STOCK ADJUSTMENT AUDIT (TCEPLAU)             *12480092
124900*----------------------------------------------------------------*12490092
125000 8100-INSERT-ADJ-AUD.                                             12500092
125100                                                                  12510092
125200     MOVE ASC-PULL-NBR       TO CEPLAU-CNSTK-REQ-PL-NBR.          12520092
125300     MOVE ASC-PULL-LNE-NBR   TO CEPLAU-PL-LNE-NBR.                12530092
125400     MOVE ASC-STR            TO CEPLAU-STR-NBR.                   12540092
125500     MOVE ASC-DS-QTY-CURR    TO CEPLAU-BEF-ADJ-UNT-QTY.           12550092
125600     MOVE ASC-ADJ-QTY-TO-N   TO CEPLAU-AFT-ADJ-UNT-QTY.           12560092
125700     MOVE ASC-TK-NBR         TO CEPLAU-ADJ-BY-USR-ID.             12570092
125800     MOVE SPACES             TO CEPLAU-EXPRT-PRC-BTCH-ID.         12580092
125900     MOVE 250                TO CEPLAU-ADJ-RSN-DESC-LEN.          12590092
126000     MOVE ASC-REASON         TO CEPLAU-ADJ-RSN-DESC-TEXT.         12600092
126100                                                                  12610092
126200     EXEC SQL                                                     12620092
126300         INSERT INTO TCEPLAU                                      12630092
126400             (CNSTK_REQ_PL_NBR                                    12640092
126500           ,  PL_LNE_NBR                                          12650092
126600           ,  STR_NBR                                             12660092
126700           ,  ADJ_TMST                                            12670092
126800           ,  BEF_ADJ_UNT_QTY                                     12680092
126900           ,  AFT_ADJ_UNT_QTY                                     12690092
127000           ,  ADJ_BY_USR_ID                                       12700092
127100           ,  EXPRT_PRC_BTCH_ID                                   12710092
127200           ,  ADJ_RSN_DESC)                                       12720092
127300      VALUES (:CEPLAU-CNSTK-REQ-PL-NBR                            12730092
127400           ,  :CEPLAU-PL-LNE-NBR                                  12740092
127500           ,  :CEPLAU-STR-NBR                                     12750092
127600           ,  CURRENT TIMESTAMP                                   12760092
127700           ,  :CEPLAU-BEF-ADJ-UNT-QTY                             12770092
127800           ,  :CEPLAU-AFT-ADJ-UNT-QTY                             12780092
127900           ,  :CEPLAU-ADJ-BY-USR-ID                               12790092
128000           ,  :CEPLAU-EXPRT-PRC-BTCH-ID                           12800092
128100           ,  :CEPLAU-ADJ-RSN-DESC)                               12810092
128200     END-EXEC.                                                    12820092
128300                                                                  12830092
128400     EVALUATE TRUE                                                12840092
128500         WHEN SQLCODE = ZERO                                      12850092
128600             CONTINUE                                             12860092
128700                                                                  12870092
128800         WHEN SQLCODE = -904                                      12880092
128900         WHEN SQLCODE = -911                                      12890092
129000         WHEN SQLCODE = -913                                      12900092
129100             PERFORM 9900-SOFT-ABORT                              12910092
129200                                                                  12920092
129300         WHEN OTHER                                               12930092
129400             MOVE '8100-INSERT-ADJ-AUD'                           12940092
129500                                    TO DP013-PARAGRAPH            12950092
129600             MOVE 'UNSUCCESSFUL INSERT OF ADJUSTMENT AUDIT'       12960092
129700                                    TO DP013-MESSAGE-TEXT (1)     12970092
129800             MOVE SQLCA             TO DP013-SQLCA                12980092
129900             MOVE 'TCEPLAU '        TO DP013-DB2-TABLE-NAME (1)   12990092
130000             SET DP013-DB2-ABEND                                  13000092
130100                 DP013-NO-ROLLBACK  TO TRUE                       13010092
130200             PERFORM DP013-0000-PROCESS-ABEND                     13020092
130300     END-EVALUATE.                                                13030092
130400                                                                  13040092
130500*----------------------------------------------------------------*13050090
130600*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *13060090
130700*----------------------------------------------------------------*13070090
130800 9100-READ-SEL-QUEUE.                                             13080090
130900                                                                  13090090
131000     EXEC CICS                                                    13100090
131100         READQ TS                                                 13110090
131200         QUEUE (ASC-SEL-QUEUE-NAME-IN)                            13120090
131300          INTO (CE003-SELECT-RECORD)                              13130090
131400          ITEM (ASC-SEL-ITEM)                                     13140090
131500          RESP (PV-CICS-RESP)                                     13150090
131600     END-EXEC.                                                    13160090
131700                                                                  13170090
131800     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        13180090
131900         CONTINUE                                                 13190090
132000     ELSE                                                         13200090
132100         SET DP013-LOGIC-ABEND                                    13210090
132200             DP013-NO-ROLLBACK      TO TRUE                       13220090
132300         MOVE '9100-READ-SEL-QUEUE' TO DP013-PARAGRAPH            13230090
132400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   13240090
132500                                    TO DP013-MESSAGE-TEXT (1)     13250090
132600         PERFORM DP013-0000-PROCESS-ABEND                         13260090
132700     END-IF.                                                      13270090
132800                                                                  13280090
132900*----------------------------------------------------------------*13290090
133000*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *13300090
133100*----------------------------------------------------------------*13310090
133200 9200-REWRITE-LIST-QUEUE.                                         13320090
133300                                                                  13330090
133400     EXEC CICS                                                    13340090
133500         WRITEQ TS                                                13350090
133600          QUEUE (ASC-SEL-QUEUE-NAME-IN)                           13360090
133700           FROM (CE003-SELECT-RECORD)                             13370090
133800           ITEM (ASC-SEL-ITEM)                                    13380090
133900           RESP (PV-CICS-RESP)                                    13390090
134000        REWRITE                                                   13400090
134100     END-EXEC.                                                    13410090
134200                                                                  13420090
134300     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    13430090
134400         SET DP013-CICS-ABEND                                     13440090
134500             DP013-NO-ROLLBACK          TO TRUE                   13450090
134600         MOVE '9200-REWRITE-LIST-QUEUE' TO DP013-PARAGRAPH        13460090
134700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   13470090
134800                                        TO DP013-MESSAGE-TEXT (1) 13480090
134900         PERFORM DP013-0000-PROCESS-ABEND                         13490090
135000     END-IF.                                                      13500090
135100                                                                  13510090
135200******************************************************************13520090
135300*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *13530090
135400*    AND THE ERROR SWITCHES.                                     *13540090
135500******************************************************************13550090
135600 9900-SOFT-ABORT.                                                 13560090
135700                                                                  13570090
135800     SET PS-ERROR             TO TRUE.                            13580090
135900     SET DP020-MSG-FATAL      TO TRUE.                            13590090
136000     MOVE PC-TSYMSG-00551     TO DP020-MSG-NUMBER.                13600090
136100     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                        13610090
136200     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          13620090
136300     PERFORM 0001-CALL-CICS-ARCH-API.                             13630090
136400                                                                  13640090
136500*----------------------------------------------------------------*13650090
136600*    ABEND PROCESSOR MODULE                                      *13660090
136700*----------------------------------------------------------------*13670090
136800     COPY DPPD013.                                                13680090
