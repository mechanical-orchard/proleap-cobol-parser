000100 IDENTIFICATION DIVISION.                                         00010028
000200                                                                  00020029
000300 PROGRAM-ID.             RVKRP027.                                00030029
000400 AUTHOR.                 CHRIS STRODTHOFF.                        00040029
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050029
000600 DATE-WRITTEN.           JUNE 2011.                               00060029
000700 DATE-COMPILED.                                                   00070029
000800                                                                  00080029
000900******************************************************************00090029
001000*  PROGRAM NARRATIVE:                                             00100029
001100*                                                                 00110029
001200*  INPUT LISTING STATUS UPDATE FILE.                              00120029
001300*  CREATE A LISTING STATUS UPDATE REPORT FOR MULTIPLE RTV LOCS.   00130029
001400*                                                                 00140029
001500******************************************************************00150029
001600*  CHANGE LOG.                                                    00160029
001700*  DATE         CHANGED BY      DESC                              00170029
001800*  -----------  --------------  ----------------------------------00180029
001900*  10/30/2011   C. STRODTHOFF - GENCO / RTV UPGRADE. NEW PROGRAM  00190029
002000*                               TO SHOW MULTIPLE RTV LOCATIONS.   00200029
002100*                               PRJ ID 3219 - WR40134.            00210029
002200******************************************************************00220029
002300*                                                                 00230029
002400 ENVIRONMENT DIVISION.                                            00240029
002500                                                                  00250029
002600 CONFIGURATION SECTION.                                           00260029
002700                                                                  00270029
002800 SOURCE-COMPUTER.                        IBM-3090.                00280029
002900 OBJECT-COMPUTER.                        IBM-3090.                00290029
003000                                                                  00300029
003100 INPUT-OUTPUT SECTION.                                            00310029
003200                                                                  00320029
003300 FILE-CONTROL.                                                    00330029
003400                                                                  00340029
003500     SELECT LISTING-REPORT-FILE                                   00350029
003600         ASSIGN TO INP01.                                         00360029
003700                                                                  00370029
003800     SELECT LA-LISTING-APPROVAL-RPT-FILE                          00380029
003900         ASSIGN TO RPT01.                                         00390029
004000******************************************************************00400029
004100 DATA DIVISION.                                                   00410029
004200******************************************************************00420029
004300                                                                  00430029
004400 FILE SECTION.                                                    00440029
004500*                                                                 00450029
004600 FD  LISTING-REPORT-FILE                                          00460029
004700     RECORDING MODE IS F                                          00470029
004800     LABEL RECORDS ARE STANDARD                                   00480029
004900     BLOCK CONTAINS 0 RECORDS.                                    00490029
005000                                                                  00500029
005100 01  LISTING-REPORT-RECORD            PIC  X(125).                00510029
005200*                                                                 00520029
005300 FD  LA-LISTING-APPROVAL-RPT-FILE                                 00530029
005400     RECORDING MODE F                                             00540029
005500     BLOCK CONTAINS 0 RECORDS                                     00550029
005600     LABEL RECORDS ARE STANDARD                                   00560029
005700     DATA RECORD IS LA-LISTING-APPROVAL-RPT-LINE.                 00570029
005800                                                                  00580029
005900 01  LA-LISTING-APPROVAL-RPT-LINE     PIC X(132).                 00590029
006000*                                                                 00600029
006100 WORKING-STORAGE SECTION.                                         00610029
006200***************************************************************** 00620029
006300*    PROGRAM HOLDS                                                00630029
006400***************************************************************** 00640029
006500** LOC NUMBER                                                     00650029
006600 01  PH-LOC-NBR                       PIC  9(04)    VALUE ZEROS.  00660029
006700***************************************************************** 00670029
006800*    PROGRAM CONSTANTS                                            00680029
006900***************************************************************** 00690029
007000 01  PC-CONSTANTS.                                                00700029
007100     05  PC-CURRENT-PGM-RVKRP027      PIC  X(08) VALUE 'RVKRP027'.00710029
007200     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00720029
007300                                                 COMP SYNC.       00730029
007400     05  PC-MAX-PAGE-SIZE             PIC S9(04) VALUE +080       00740029
007500                                                 COMP SYNC.       00750029
007600     05  PC-HEADING-SIZE              PIC S9(04) VALUE +006       00760029
007700                                                 COMP SYNC.       00770029
007800******************************************************************00780029
007900**PROGRAM COUNTERS                                                00790029
008000******************************************************************00800029
008100 01  PC-PROGRAM-COUNTER.                                          00810029
008200     05  PC-REPORT-LINE-COUNTER          PIC 9(03) VALUE ZEROS.   00820029
008300     05  PC-PAGE-COUNTER                 PIC 9(03) VALUE ZEROS.   00830029
008400***************************************************************** 00840029
008500*    PROGRAM SWITCHES                                             00850029
008600***************************************************************** 00860029
008700 01  PS-SWITCHES.                                                 00870029
008800     05  PS-END-RPT-FILE-SWITCH       PIC  X(01) VALUE 'N'.       00880029
008900         88  PS-END-RPT-FILE                     VALUE 'Y'.       00890029
009000         88  PS-NOT-END-RPT-FILE                 VALUE 'N'.       00900029
009100     05  PS-XLT00010-SWITCH           PIC  X(01) VALUE 'N'.       00910029
009200         88  PS-XLT00010-FOUND                   VALUE 'Y'.       00920029
009300         88  PS-XLT00010-NOTFND                  VALUE 'N'.       00930029
009400                                                                  00940029
009500***************************************************************** 00950029
009600*    PROGRAM VARIABLES                                            00960029
009700***************************************************************** 00970029
009800 01  PV-VARIABLES.                                                00980029
009900     05  PV-LINES-USED                PIC S9(04) VALUE ZERO       00990029
010000                                                 COMP SYNC.       01000029
010100     05  PV-RPT-RECS-WRITTEN          PIC  9(09) VALUE ZERO.      01010029
010200     05  PV-PAGE-COUNT                PIC  9(02) VALUE ZERO.      01020029
010300     05  PV-KEY-LOC-NBR               PIC S9(04) VALUE +0         01030029
010400                                                 COMP SYNC.       01040029
010500     05  PV-LOC-NBR                   PIC S9(04) VALUE ZERO       01050029
010600                                                 COMP.            01060029
010700     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         01070029
010800                                                 COMP SYNC.       01080029
010900     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       01090029
011000                                                 COMP SYNC.       01100029
011100     05  PV-REPORT-NUMBER             PIC  9(01) VALUE 1.         01110029
011200     05  PV-PARAGRAPH                 PIC  X(30) VALUE SPACES.    01120029
011300     05  PV-DB2-FUNCTION              PIC  X(30) VALUE SPACES.    01130029
011400     05  PV-ABEND-TABLE-1             PIC  X(20) VALUE SPACES.    01140029
011500     05  PV-ABEND-TABLE-2             PIC  X(20) VALUE SPACES.    01150029
011600     05  PV-ABEND-TABLE-3             PIC  X(20) VALUE SPACES.    01160029
011700     05  PV-ABEND-TABLE-4             PIC  X(20) VALUE SPACES.    01170029
011800     05  PV-ABEND-TABLE-5             PIC  X(20) VALUE SPACES.    01180029
011900     05  PV-ERROR-MSG-1               PIC  X(60) VALUE SPACES.    01190029
012000     05  PV-ERROR-MSG-2               PIC  X(60) VALUE SPACES.    01200029
012100     05  PV-ERROR-MSG-3               PIC  X(60) VALUE SPACES.    01210029
012200     05  PV-ASTERISK-LINE             PIC  X(80) VALUE ALL '*'.   01220029
012300     05  PV-RPT-RECS-READ             PIC  9(09) VALUE ZERO.      01230029
012400                                                                  01240029
012500     05  PV-RUN-DATE-CN               PIC  X(08)  VALUE SPACES.   01250029
012600     05  PV-RUN-TIME-CN               PIC  X(06)  VALUE SPACES.   01260029
012700                                                                  01270029
012800     05  PV-SYSTEM-DATE.                                          01280029
012900         10  PV-SYSTEM-DATE-CCYY      PIC  9(04) VALUE ZERO.      01290029
013000         10  PV-SYSTEM-DATE-MM        PIC  9(02) VALUE ZERO.      01300029
013100         10  PV-SYSTEM-DATE-DD        PIC  9(02) VALUE ZERO.      01310029
013200         10  PV-SYSTEM-HH             PIC  9(02) VALUE ZERO.      01320029
013300         10  PV-SYSTEM-MIN            PIC  9(02) VALUE ZERO.      01330029
013400                                                                  01340029
013500     05  PV-CURRENT-DATE.                                         01350029
013600         10  PV-CURRENT-DATE-MM       PIC  X(02) VALUE SPACES.    01360029
013700         10  FILLER                   PIC  X(01) VALUE '/'.       01370029
013800         10  PV-CURRENT-DATE-DD       PIC  X(02) VALUE SPACES.    01380029
013900         10  FILLER                   PIC  X(01) VALUE '/'.       01390029
014000         10  PV-CURRENT-DATE-CCYY     PIC  X(04) VALUE SPACES.    01400029
014100                                                                  01410029
014200     05  PV-TOT-UNT-CST-AMT     PIC S9(11)V99 COMP-3 VALUE +0.    01420029
014300     05  PV-TOT-TDFCTOR-UPDATE-COUNT                              01430029
014400                                PIC S9(07) COMP-3 VALUE +0.       01440029
014500     05  PV-TOT-RTL-CST-AMT     PIC S9(11)V99 COMP-3 VALUE +0.    01450029
014600     05  PV-RETRY-CNT           PIC S9(01)  VALUE +0.             01460029
014700     05  PV-BLANK-LINE          PIC X(100)  VALUE SPACES.         01470029
014800                                                                  01480029
014900***  LISTING STATUS UPDATE FILE LAYOUT                            01490029
015000     COPY RVRD062.                                                01500029
015100                                                                  01510029
015200******************************************************************01520029
015300***  STANDARD REPORT HEADER FOR 100 COLUMN REPORT                 01530029
015400******************************************************************01540029
015500     COPY DPWS100.                                                01550029
015600*                                                                 01560029
015700 01  HL1-HEADING-LINE-1.                                          01570029
015800     05  FILLER                       PIC  X(37) VALUE SPACE.     01580029
015900    05  FILLER                       PIC  X(28) VALUE             01590029
016000         'LISTING STATUS UPDATE REPORT'.                          01600029
016100     05  FILLER                       PIC  X(35) VALUE SPACE.     01610029
016200                                                                  01620029
016300 01  DH1-DETAIL-HEADING-LINE-1A.                                  01630029
016400     05  FILLER                          PIC X(17)                01640029
016500         VALUE 'RTV LOCATION  :  '.                               01650029
016600     05  DH1A-RTV-LOC-NBR                PIC 9999  VALUE ZEROES.  01660029
016700     05  FILLER                          PIC X(02) VALUE SPACES.  01670029
016800     05  DH1A-RTV-LOC-NM                 PIC X(10) VALUE SPACES.  01680029
016900                                                                  01690029
017000 01  DH1-DETAIL-HEADING-LINE-1.                                   01700029
017010     05  FILLER                       PIC  X(05) VALUE SPACES.    01701032
017100     05  FILLER                       PIC  X(07) VALUE            01710032
017200                                                 'LISTING'.       01720029
017300     05  FILLER                       PIC  X(02) VALUE SPACES.    01730032
017400     05  FILLER                       PIC  X(11) VALUE            01740029
017500                                                 'VENDOR NAME'.   01750029
017600     05  FILLER                       PIC  X(16) VALUE SPACES.    01760029
017700     05  FILLER                       PIC  X(07) VALUE            01770029
017800                                                 'LISTING'.       01780029
017900     05  FILLER                       PIC  X(01) VALUE SPACES.    01790029
018000     05  FILLER                       PIC  X(07) VALUE            01800029
018100                                                 'CURRENT'.       01810029
018200     05  FILLER                       PIC  X(02) VALUE SPACES.    01820029
018300     05  FILLER                       PIC  X(06) VALUE            01830029
018400                                                 'STATUS'.        01840029
018500     05  FILLER                       PIC  X(13) VALUE SPACES.    01850029
018600     05  FILLER                       PIC  X(11) VALUE            01860029
018700                                                 'RETAIL COST'.   01870029
018800     05  FILLER                       PIC  X(09) VALUE SPACES.    01880034
018900     05  FILLER                       PIC  X(09) VALUE            01890029
019000                                                 'UNIT COST'.     01900029
019100     05  FILLER                       PIC  X(01) VALUE SPACES.    01910034
019200                                                                  01920029
019300 01  DH2-DETAIL-HEADING-LINE-2.                                   01930029
019310     05  FILLER                       PIC  X(05) VALUE SPACES.    01931032
019400     05  FILLER                       PIC  X(11) VALUE            01940032
019500                                                 'NUMBER'.        01950029
019600     05  FILLER                       PIC  X(25) VALUE SPACES.    01960033
019700     05  FILLER                       PIC  X(04) VALUE            01970029
019800                                                 'TYPE'.          01980029
019900     05  FILLER                       PIC  X(04) VALUE SPACES.    01990029
020000     05  FILLER                       PIC  X(06) VALUE            02000029
020100                                                 'STATUS'.        02010029
020200     05  FILLER                       PIC  X(03) VALUE SPACES.    02020029
020300     05  FILLER                       PIC  X(04) VALUE            02030029
020400                                                 'DATE'.          02040029
020500     05  FILLER                       PIC  X(48) VALUE SPACES.    02050033
020600                                                                  02060029
020700 01  DL-DETAIL-LINE.                                              02070029
020800                                                                  02080029
020900     05  DL-LISTING-NBR               PIC  Z(12) VALUE SPACES.    02090030
021000     05  FILLER                       PIC  X(01) VALUE SPACES.    02100029
021100     05  DL-VENDOR-NAME               PIC  X(27) VALUE SPACES.    02110029
021200     05  FILLER                       PIC  X(01) VALUE SPACES.    02120029
021300     05  DL-LISTING-TYPE              PIC  X(07) VALUE SPACES.    02130029
021400     05  FILLER                       PIC  X(01) VALUE SPACE.     02140029
021500     05  DL-CURRENT-STATUS            PIC  X(08) VALUE SPACES.    02150029
021600     05  FILLER                       PIC  X(01) VALUE SPACE.     02160029
021700     05  DL-STATUS-CHG-DATE           PIC  X(12) VALUE SPACES.    02170029
021800     05  FILLER                       PIC  X(01) VALUE SPACE.     02180029
021900     05  DL-TOT-RTL-CST-AMT           PIC  ZZ,ZZZ,ZZZ,ZZ9.99.     02190029
022000     05  FILLER                       PIC  X(01) VALUE SPACE.     02200029
022100     05  DL-TOT-UNT-CST-AMT           PIC  ZZ,ZZZ,ZZZ,ZZ9.99.     02210029
022200                                                                  02220029
022300 01  TL-TOTAL-LISTINGS-UPDATED-LINE.                              02230029
022400     05  FILLER                       PIC  X(24) VALUE            02240029
022500         'TOTAL LISTINGS UPDATED: '.                              02250029
022600     05  TL-LISTINGS-UPDATED          PIC  ZZZ9.                  02260029
022700     05  FILLER                       PIC  X(43) VALUE SPACE.     02270030
022800     05  TL-TOT-RTL-CST-AMT           PIC  ZZ,ZZZ,ZZZ,ZZ9.99.     02280029
022900     05  FILLER                       PIC  X(01) VALUE SPACE.     02290029
023000     05  TL-TOT-UNT-CST-AMT           PIC  ZZ,ZZZ,ZZZ,ZZ9.99.     02300029
023100                                                                  02310029
023200 01  ER-END-OF-REPORT-LINE.                                       02320029
023300     05  FILLER                       PIC  X(38) VALUE SPACE.     02330029
023400     05  FILLER                       PIC  X(25) VALUE            02340031
023500         '***** END OF REPORT *****'.                             02350029
023600     05  FILLER                       PIC  X(37) VALUE SPACE.     02360029
023700                                                                  02370029
023800***  DB2 ABEND COPYBOOK                                           02380029
023900     COPY DPWS004.                                                02390029
024000                                                                  02400029
024100     EXEC SQL                                                     02410029
024200         INCLUDE SQLCA                                            02420029
024300     END-EXEC.                                                    02430029
024400                                                                  02440029
024500     COPY SQLCA2.                                                 02450029
024600                                                                  02460029
024700*---------------------------------------------------------------* 02470029
024800*    DCLGEN FOR THE LOGISTICS LOCATION TABLE                    * 02480029
024900*---------------------------------------------------------------* 02490029
025000     EXEC SQL                                                     02500029
025100         INCLUDE XLT00010                                         02510029
025200     END-EXEC.                                                    02520029
025300                                                                  02530029
025400 LINKAGE SECTION.                                                 02540029
025500                                                                  02550029
025600 PROCEDURE DIVISION.                                              02560029
025700***************************************************************** 02570029
025800*  MAINLINE LOGIC FOR PROGRAM                                     02580029
025900***************************************************************** 02590029
026000 0000-MAINLINE.                                                   02600029
026100     PERFORM 1000-INITIALIZE.                                     02610029
026200                                                                  02620029
026300     PERFORM 2000-PROCESS-RPT-FILE                                02630029
026400         UNTIL PS-END-RPT-FILE.                                   02640029
026500                                                                  02650029
026600     PERFORM 9000-EOJ.                                            02660029
026700                                                                  02670029
026800     GOBACK.                                                      02680029
026900                                                                  02690029
027000***************************************************************** 02700029
027100*  INITIALIZATION PARAGRAPH                                       02710029
027200***************************************************************** 02720029
027300 1000-INITIALIZE.                                                 02730029
027400     OPEN INPUT  LISTING-REPORT-FILE                              02740029
027500          OUTPUT LA-LISTING-APPROVAL-RPT-FILE.                    02750029
027600                                                                  02760029
027700     SET PS-NOT-END-RPT-FILE     TO TRUE.                         02770029
027800     PERFORM 1100-INITIALIZE-SUM-FIELDS.                          02780029
027900                                                                  02790029
028000     MOVE FUNCTION CURRENT-DATE  TO PV-SYSTEM-DATE.               02800029
028100     MOVE PV-SYSTEM-DATE-CCYY    TO DP100-RUN-YEAR                02810029
028200                                    PV-CURRENT-DATE-CCYY.         02820029
028300     MOVE PV-SYSTEM-DATE-MM      TO DP100-RUN-MONTH               02830029
028400                                    PV-CURRENT-DATE-MM.           02840029
028500     MOVE PV-SYSTEM-DATE-DD      TO DP100-RUN-DAY                 02850029
028600                                    PV-CURRENT-DATE-DD.           02860029
028700     MOVE PV-SYSTEM-HH           TO DP100-RUN-HOUR.               02870029
028800     MOVE PV-SYSTEM-MIN          TO DP100-RUN-MINUTE.             02880029
028900     MOVE PC-CURRENT-PGM-RVKRP027                                 02890029
029000                                 TO DP100-PROGRAM-NAME.           02900029
029100     MOVE 1                      TO DP100-REPORT-NUMBER.          02910029
029200                                                                  02920029
029300     PERFORM 7000-READ-LISTING-REP-INPUT.                         02930029
029400                                                                  02940029
029500     IF PS-NOT-END-RPT-FILE                                       02950029
029600         PERFORM 7200-READ-XLT00010                               02960029
029700         MOVE RV062-RTV-LOCATION TO PH-LOC-NBR                    02970029
029800     END-IF.                                                      02980029
029900                                                                  02990029
030000     PERFORM 8000-WRITE-PAGE-HEADINGS.                            03000029
030100                                                                  03010029
030200 1100-INITIALIZE-SUM-FIELDS.                                      03020029
030300     MOVE ZERO                   TO PV-TOT-UNT-CST-AMT            03030029
030400                                    PV-TOT-RTL-CST-AMT            03040029
030500                                    PV-TOT-TDFCTOR-UPDATE-COUNT.  03050029
030600                                                                  03060029
030700***************************************************************** 03070029
030800* PROCESS DATA FROM LISTING STATUS UPDATE FILE. CREATE REPORT.    03080029
030900***************************************************************** 03090029
031000 2000-PROCESS-RPT-FILE.                                           03100029
031100                                                                  03110029
031200     PERFORM 6500-FILL-WRITE-UPDT-SUMM-DTL.                       03120029
031300     PERFORM 6600-SUM-COST-AMT-AND-COUNTER.                       03130029
031400     PERFORM 7000-READ-LISTING-REP-INPUT.                         03140029
031500     IF RV062-RTV-LOCATION IS NOT EQUAL TO PH-LOC-NBR AND         03150029
031600        PS-NOT-END-RPT-FILE                                       03160029
031700         PERFORM 8200-WRITE-TOTALS-FOR-RTV                        03170029
031800         MOVE RV062-RTV-LOCATION        TO PH-LOC-NBR             03180029
031900         PERFORM 7200-READ-XLT00010                               03190029
032000         PERFORM 8000-WRITE-PAGE-HEADINGS                         03200029
032100         PERFORM 1100-INITIALIZE-SUM-FIELDS                       03210029
032200     ELSE                                                         03220029
032300         MOVE RV062-RTV-LOCATION        TO PH-LOC-NBR             03230029
032400     END-IF.                                                      03240029
032500                                                                  03250029
032600***************************************************************** 03260029
032700* POPULATE REPORT FIELDS AND WRITE REPORT.                        03270029
032800***************************************************************** 03280029
032900 6500-FILL-WRITE-UPDT-SUMM-DTL.                                   03290029
033000                                                                  03300029
033100     MOVE RV062-LISTING-NBR         TO DL-LISTING-NBR.            03310029
033200     MOVE RV062-VENDOR-NAME         TO DL-VENDOR-NAME.            03320029
033300     MOVE RV062-LISTING-TYPE        TO DL-LISTING-TYPE.           03330029
033400     MOVE RV062-CURRENT-STATUS      TO DL-CURRENT-STATUS.         03340029
033500     MOVE RV062-STATUS-CHG-DATE     TO DL-STATUS-CHG-DATE.        03350029
033600     MOVE RV062-TOT-RTL-CST-AMT     TO DL-TOT-RTL-CST-AMT.        03360029
033700     MOVE RV062-TOT-UNT-CST-AMT     TO DL-TOT-UNT-CST-AMT.        03370029
033800     PERFORM 8100-WRITE-UPDATE-SUMMARY-DTL.                       03380029
033900                                                                  03390029
034000 6600-SUM-COST-AMT-AND-COUNTER.                                   03400029
034100                                                                  03410029
034200     COMPUTE PV-TOT-UNT-CST-AMT =                                 03420029
034300             RV062-TOT-UNT-CST-AMT + PV-TOT-UNT-CST-AMT.          03430029
034400     COMPUTE PV-TOT-RTL-CST-AMT =                                 03440029
034500             RV062-TOT-RTL-CST-AMT + PV-TOT-RTL-CST-AMT.          03450029
034600     COMPUTE PV-TOT-TDFCTOR-UPDATE-COUNT =                        03460029
034700             RV062-TDFCTOR-UPDATE-COUNT                           03470029
034800                                   + PV-TOT-TDFCTOR-UPDATE-COUNT. 03480029
034900                                                                  03490029
035000***************************************************************** 03500029
035100*  READ THE LISTING STATUS UPDATE REPORT FILE                     03510029
035200***************************************************************** 03520029
035300 7000-READ-LISTING-REP-INPUT.                                     03530029
035400     READ LISTING-REPORT-FILE                                     03540029
035500         INTO RV062-LISTING-REPORT-RECORD                         03550029
035600            AT END                                                03560029
035700               SET PS-END-RPT-FILE                                03570029
035800                          TO TRUE.                                03580029
035900     IF PS-NOT-END-RPT-FILE                                       03590029
036000         ADD 1    TO PV-RPT-RECS-READ                             03600029
036100     END-IF.                                                      03610029
036200                                                                  03620029
036300******************************************************************03630029
036400*  READ XLT00010 - XLT_LOC TABLE.                                 03640029
036500******************************************************************03650029
036600 7200-READ-XLT00010.                                              03660029
036700     INITIALIZE DCLXLT00010.                                      03670029
036800     SET PS-XLT00010-NOTFND        TO TRUE.                       03680029
036900     IF PH-LOC-NBR = +0                                           03690029
037000         MOVE RV062-RTV-LOCATION   TO PV-KEY-LOC-NBR              03700029
037100     ELSE                                                         03710029
037200         MOVE PH-LOC-NBR           TO PV-KEY-LOC-NBR              03720029
037300     END-IF.                                                      03730029
037400                                                                  03740029
037500     PERFORM                                                      03750029
037600         WITH TEST AFTER                                          03760029
037700         VARYING PV-RETRY-COUNTER                                 03770029
037800         FROM 1 BY 1                                              03780029
037900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03790029
038000                   OR (SQLCODE = ZERO)                            03800029
038100                   OR (SQLCODE = +100))                           03810029
038200         EXEC SQL                                                 03820029
038300              SELECT  LOC_10_ABBR_NM                              03830029
038400              INTO  :XLT00010-LOC-10-ABBR-NM                      03840029
038500              FROM XLT_LOC                                        03850029
038600              WHERE LOC_NBR = :PV-KEY-LOC-NBR                     03860029
038700         END-EXEC                                                 03870029
038800                                                                  03880029
038900         EVALUATE TRUE                                            03890029
039000             WHEN SQLCODE = ZERO                                  03900029
039100             WHEN SQLCODE = -904                                  03910029
039200             WHEN SQLCODE = -911                                  03920029
039300             WHEN SQLCODE = -913                                  03930029
039400                 SET PS-XLT00010-FOUND TO TRUE                    03940029
039500             WHEN SQLCODE = +100                                  03950029
039600                 SET PS-XLT00010-NOTFND TO TRUE                   03960029
039700             WHEN SQLWARN0 NOT EQUAL SPACE                        03970029
039800             WHEN SQLCODE NOT EQUAL ZERO                          03980029
039900                 DISPLAY '** ABEND **'                            03990029
040000                 DISPLAY '** PROGRAM = RVKRP027 **'               04000029
040100                 DISPLAY '** PARAGRAPH = '                        04010029
040200                         '7200-READ-XLT00010 **'                  04020029
040300                 MOVE 'SELECT XLT_LOC'  TO PV-ERROR-MSG-1         04030029
040400                 MOVE RV062-RTV-LOCATION        TO PV-LOC-NBR     04040029
040500                 MOVE 'XLT_LOC'       TO PV-ABEND-TABLE-1         04050029
040600                 PERFORM 9200-SQL-ERROR                           04060029
040700         END-EVALUATE                                             04070029
040800     END-PERFORM.                                                 04080029
040900                                                                  04090029
041000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        04100029
041100         DISPLAY '** ABEND **'                                    04110029
041200         DISPLAY '** PROGRAM = RVKRP027 **'                       04120029
041300         DISPLAY '** PARAGRAPH = 7200-READ-XLT00010 **'           04130029
041400         MOVE 'SELECT MAX RETRIES'                                04140029
041500                                        TO PV-ERROR-MSG-1         04150029
041600         MOVE RV062-RTV-LOCATION        TO PV-LOC-NBR             04160029
041700         MOVE 'XLT_LOC'                 TO PV-ABEND-TABLE-1       04170029
041800         PERFORM 9200-SQL-ERROR                                   04180029
041900     END-IF.                                                      04190029
042000                                                                  04200029
042100 8000-WRITE-PAGE-HEADINGS.                                        04210029
042200***************************************************************** 04220029
042300*  PRINT THE HEADINGS ON EACH PAGE.                             * 04230029
042400***************************************************************** 04240029
042500     ADD 1                         TO PV-PAGE-COUNT.              04250029
042600     MOVE PV-PAGE-COUNT            TO DP100-PAGE-NUMBER.          04260029
042700                                                                  04270029
042800     WRITE LA-LISTING-APPROVAL-RPT-LINE                           04280029
042900       FROM DP100-STANDRD-HEADER-100-COLS                         04290029
043000         AFTER ADVANCING PAGE.                                    04300029
043100                                                                  04310029
043200     INITIALIZE DP100-LASER-NEW-PAGE-INDICATR.                    04320029
043300     WRITE LA-LISTING-APPROVAL-RPT-LINE                           04330029
043400       FROM HL1-HEADING-LINE-1                                    04340029
043500         AFTER ADVANCING 1 LINE.                                  04350029
043600                                                                  04360029
043700     MOVE PH-LOC-NBR       TO DH1A-RTV-LOC-NBR.                   04370029
043800     IF XLT00010-LOC-10-ABBR-NM IS GREATER THAN SPACES            04380029
043900         MOVE XLT00010-LOC-10-ABBR-NM                             04390029
044000                           TO DH1A-RTV-LOC-NM                     04400029
044100     ELSE                                                         04410029
044200         MOVE SPACES       TO DH1A-RTV-LOC-NM                     04420029
044300     END-IF.                                                      04430029
044400     WRITE LA-LISTING-APPROVAL-RPT-LINE                           04440029
044500       FROM DH1-DETAIL-HEADING-LINE-1A                            04450029
044600         AFTER ADVANCING 1 LINES.                                 04460029
044700                                                                  04470029
044800     WRITE LA-LISTING-APPROVAL-RPT-LINE                           04480029
044900       FROM DH1-DETAIL-HEADING-LINE-1                             04490029
045000         AFTER ADVANCING 2 LINES.                                 04500029
045100                                                                  04510029
045200     WRITE LA-LISTING-APPROVAL-RPT-LINE                           04520029
045300       FROM DH2-DETAIL-HEADING-LINE-2                             04530029
045400         AFTER ADVANCING 1 LINE.                                  04540029
045500                                                                  04550029
045600     WRITE LA-LISTING-APPROVAL-RPT-LINE                           04560029
045700       FROM PV-BLANK-LINE                                         04570029
045800         AFTER ADVANCING 1 LINES.                                 04580029
045900                                                                  04590029
046000     MOVE PC-HEADING-SIZE          TO PV-LINES-USED.              04600029
046100                                                                  04610029
046200 8100-WRITE-UPDATE-SUMMARY-DTL.                                   04620029
046300******************************************************************04630029
046400*  WRITE THE STYLE SUMMARY DETAIL RECORD.                         04640029
046500******************************************************************04650029
046600     ADD 1                    TO PV-LINES-USED.                   04660029
046700                                                                  04670029
046800     IF PV-LINES-USED > PC-MAX-PAGE-SIZE                          04680029
046900        PERFORM 8000-WRITE-PAGE-HEADINGS                          04690029
047000     END-IF.                                                      04700029
047100                                                                  04710029
047200     ADD 1                    TO PV-RPT-RECS-WRITTEN.             04720029
047300     WRITE LA-LISTING-APPROVAL-RPT-LINE                           04730029
047400         FROM DL-DETAIL-LINE                                      04740029
047500             AFTER ADVANCING 1 LINE.                              04750029
047600                                                                  04760029
047700 8200-WRITE-TOTALS-FOR-RTV.                                       04770029
047800                                                                  04780029
047900     ADD 2 TO PV-LINES-USED.                                      04790029
048000                                                                  04800029
048100     IF PV-LINES-USED > PC-MAX-PAGE-SIZE                          04810029
048200        PERFORM 8000-WRITE-PAGE-HEADINGS                          04820029
048300     END-IF.                                                      04830029
048400                                                                  04840029
048500     MOVE PV-TOT-TDFCTOR-UPDATE-COUNT                             04850029
048600                                  TO TL-LISTINGS-UPDATED          04860029
048700     MOVE PV-TOT-UNT-CST-AMT      TO TL-TOT-UNT-CST-AMT           04870029
048800     MOVE PV-TOT-RTL-CST-AMT      TO TL-TOT-RTL-CST-AMT           04880029
048900                                                                  04890029
049000     WRITE LA-LISTING-APPROVAL-RPT-LINE                           04900029
049100         FROM TL-TOTAL-LISTINGS-UPDATED-LINE                      04910029
049200              AFTER ADVANCING 2 LINES.                            04920029
049300                                                                  04930029
049400***************************************************************** 04940029
049500*  END OF JOB PROCESSING                                          04950029
049600***************************************************************** 04960029
049700 9000-EOJ.                                                        04970029
049800                                                                  04980029
049900     PERFORM 8200-WRITE-TOTALS-FOR-RTV.                           04990029
050000                                                                  05000029
050100     ADD 2 TO PV-LINES-USED                                       05010029
050200                                                                  05020029
050300     IF PV-LINES-USED > PC-MAX-PAGE-SIZE                          05030029
050400        PERFORM 8000-WRITE-PAGE-HEADINGS                          05040029
050500     END-IF.                                                      05050029
050600                                                                  05060029
050700     WRITE LA-LISTING-APPROVAL-RPT-LINE                           05070029
050800         FROM ER-END-OF-REPORT-LINE                               05080029
050900             AFTER ADVANCING 2 LINES.                             05090029
051000                                                                  05100029
051100     DISPLAY PV-ASTERISK-LINE                                     05110029
051200     DISPLAY 'LISTING REPORT FILE READ   ===>  '                  05120029
051300              PV-RPT-RECS-READ.                                   05130029
051400                                                                  05140029
051500     CLOSE LISTING-REPORT-FILE                                    05150029
051600           LA-LISTING-APPROVAL-RPT-FILE.                          05160029
051700                                                                  05170029
051800***************************************************************** 05180029
051900*  PARAGRAPH EXECUTED WHEN SERIOUS DB2 ERROR OCCURRED             05190029
052000***************************************************************** 05200029
052100 9200-SQL-ERROR.                                                  05210029
052200     CLOSE LISTING-REPORT-FILE                                    05220029
052300           LA-LISTING-APPROVAL-RPT-FILE.                          05230029
052400                                                                  05240029
052500     MOVE SQLCODE                     TO SQLCODE2.                05250029
052600     MOVE SQLERRD(3)                  TO SQLERRD3.                05260029
052700                                                                  05270029
052800     DISPLAY '** ABEND **         ** = SQLERROR'.                 05280029
052900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PGM-RVKRP027.        05290029
053000     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   05300029
053100     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                05310029
053200     DISPLAY '** LOC NBR   ** = ' PV-LOC-NBR.                     05320029
053300     DISPLAY '**           ** = ' PV-ABEND-TABLE-1.               05330029
053400     DISPLAY '**           ** = ' PV-ABEND-TABLE-2.               05340029
053500     DISPLAY '**           ** = ' PV-ABEND-TABLE-3.               05350029
053600     DISPLAY '**           ** = ' PV-ABEND-TABLE-4.               05360029
053700     DISPLAY '**           ** = ' PV-ABEND-TABLE-5.               05370029
053800     DISPLAY '**           ** = ' PV-ERROR-MSG-1                  05380029
053900     DISPLAY '**           ** = ' PV-ERROR-MSG-2                  05390029
054000     DISPLAY '**           ** = ' PV-ERROR-MSG-3                  05400029
054100                                                                  05410029
054200     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                05420029
054300     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                05430029
054400     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 05440029
054500     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                05450029
054600                                                                  05460029
054700     COPY DPPD004.                                                05470029
054800                                                                  05480029
054900     MOVE +4013                       TO PV-ABEND-CODE.           05490029
055000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05500029
055100                                                                  05510029
055200*************  END OF RVKRP027  ********************************  05520029
