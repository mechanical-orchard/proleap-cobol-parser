000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.              TRKUP087.                               00020000
000300 AUTHOR.                  DENISE HAHN.                            00030000
000400 DATE-WRITTEN.            APRIL 2013.                             00040001
000500 DATE-COMPILED.                                                   00050000
000600                                                                  00060000
000700******************************************************************00070000
000800* THIS PROGRAM READ A FLAT FILE CREATED BY TRKUT087 OF RECEIVERS *00080001
000900* THAT ARE SUSPENDED DUE TO NOPRO (FREIGHT BILL) AND THE TRAILER *00090001
000910* IS IN AN UNLOADED STATUS.                                      *00091000
000920* THE SHIPMENTS FOR THESE RECEIVERS WILL BE UPDATE WITH A PRO    *00092000
000930* THIS WILL ALLOW THE RECEIVER TO VERIFY.                        *00093000
001000******************************************************************00100000
001100 ENVIRONMENT DIVISION.                                            00110000
001200 CONFIGURATION SECTION.                                           00120000
001300                                                                  00130000
001400 INPUT-OUTPUT SECTION.                                            00140000
001500 FILE-CONTROL.                                                    00150000
001600                                                                  00160000
001700     SELECT INPUT-FILE                                            00170000
001800        ASSIGN TO INP01.                                          00180000
001900                                                                  00190000
002000 DATA DIVISION.                                                   00200000
002100 FILE SECTION.                                                    00210000
002200                                                                  00220000
002300 FD  INPUT-FILE                                                   00230000
002400     RECORDING MODE IS F                                          00240000
002500     LABEL RECORDS ARE STANDARD                                   00250000
002600     RECORD CONTAINS 200 CHARACTERS                               00260000
002700     DATA RECORD IS INPUT-RECORD.                                 00270000
002800                                                                  00280000
002900 01  INPUT-RECORD                PIC X(200).                      00290000
003000                                                                  00300000
003100                                                                  00310000
003200 WORKING-STORAGE SECTION.                                         00320000
003300                                                                  00330000
004000                                                                  00400000
004100 01  PROGRAM-VARIABLES.                                           00410000
004200                                                                  00420000
005200     05  PV-INPUT-COUNT              PIC  9(09)      VALUE ZERO.  00520001
005210     05  PV-UPDATE-COUNT             PIC  9(09)      VALUE ZERO.  00521001
005211     05  PV-PREV-SHIPT-ID            PIC  S9(9) COMP VALUE ZERO.  00521101
005220                                                                  00522001
005300     05  PV-DISP-COUNT               PIC  Z(09)      VALUE ZERO.  00530001
005400     05  PV-DISP-SHIPT-ID            PIC  Z(11)      VALUE ZERO.  00540000
005500     05  PV-DISP-TRIP-ID             PIC  Z(09)      VALUE ZERO.  00550000
005510     05  PV-DISP-PO-NBR              PIC  Z(09)      VALUE ZERO.  00551002
005520     05  PV-DISP-RCVR-SEQ            PIC  9999       VALUE ZERO.  00552002
005530     05  PV-DISP-OPER                PIC  Z(04)      VALUE ZERO.  00553006
005600                                                                  00560000
005800     05  PV-PARAGRAPH                PIC X(30).                   00580002
005900     05  PV-DB2-FUNCTION             PIC X(30).                   00590002
007100                                                                  00710001
007200 01  PROGRAM-SWITCHES.                                            00720004
007300     05  PS-END-OF-INPUT-SW          PIC X(01)       VALUE 'N'.   00730004
007301         88  PS-END-OF-INPUT                         VALUE 'Y'.   00730104
007302         88  PS-NOT-END-OF-INPUT                     VALUE 'N'.   00730204
007310     05  PS-ERROR-SW                 PIC X(01)       VALUE 'N'.   00731004
007320         88  PS-ERROR                                VALUE 'Y'.   00732004
007321         88  PS-ERROR-NO                             VALUE 'N'.   00732104
007330                                                                  00733004
007400                                                                  00740004
007622 01  ABEND-CODE                PIC S9(04)  VALUE +0 COMP SYNC.    00762200
007623     88 ABEND-4013                         VALUE +4013.           00762300
007624***************************************************************** 00762400
007625*    OUTPUT FILE LAYOUT.                                        * 00762500
007626***************************************************************** 00762600
007627     COPY TRRD068.                                                00762701
007628                                                                  00762800
007670***************************************************************** 00767000
007680*    SQL ABEND ROUTINE WORKING STORAGE                          * 00768000
007690***************************************************************** 00769000
007700     COPY DPWS004.                                                00770000
007800                                                                  00780000
009400                                                                  00940000
009500     EXEC SQL                                                     00950000
009600        INCLUDE TSHIPMT                                           00960000
009700     END-EXEC.                                                    00970000
009800                                                                  00980000
010300     EXEC SQL                                                     01030000
010400        INCLUDE SQLCA                                             01040000
010500     END-EXEC.                                                    01050000
010600                                                                  01060000
010700                                                                  01070000
010800***********************************************************       01080000
010900 PROCEDURE DIVISION.                                              01090000
011000***********************************************************       01100000
011100                                                                  01110000
011110     DISPLAY '************************************************'   01111001
011120     DISPLAY '** TRKUP087                                   **'   01112003
011130     DISPLAY '************************************************'   01113001
011140                                                                  01114001
011150     SET  PS-NOT-END-OF-INPUT                                     01115004
011180          PS-ERROR-NO            TO  TRUE.                        01118004
011190                                                                  01119004
011200     OPEN INPUT INPUT-FILE.                                       01120000
011300                                                                  01130000
011310     PERFORM 3000-READ-RECORD.                                    01131002
011320                                                                  01132002
011400     PERFORM 2000-PROCESS-INPUT                                   01140001
011500       UNTIL PS-END-OF-INPUT                                      01150001
011510          OR PS-ERROR.                                            01151001
011520                                                                  01152001
011801     DISPLAY '************************************************'   01180101
011802     DISPLAY '*                                              *'   01180201
011803     MOVE PV-INPUT-COUNT  TO PV-DISP-COUNT                        01180302
011900     DISPLAY '**   --INPUT COUNT:  ' PV-DISP-COUNT                01190002
011901                                                                  01190102
011910     MOVE PV-UPDATE-COUNT TO PV-DISP-COUNT                        01191002
012000     DISPLAY '**   --UPDATE COUNT: ' PV-DISP-COUNT                01200002
012010                                                                  01201002
012020     DISPLAY '*                                              *'   01202002
012500     DISPLAY '************************************************'   01250000
012600                                                                  01260000
012700     CLOSE INPUT-FILE.                                            01270000
012800                                                                  01280000
012900     STOP RUN.                                                    01290000
013000                                                                  01300000
013100 2000-PROCESS-INPUT.                                              01310002
013200                                                                  01320000
013201     IF  TR068-SHIPT-ID  =  PV-PREV-SHIPT-ID                      01320105
013202         CONTINUE                                                 01320205
013203     ELSE                                                         01320305
013204         PERFORM 3100-UPDATE-PRO-NBR                              01320405
013205         MOVE TR068-SHIPT-ID  TO  PV-PREV-SHIPT-ID                01320505
013206     END-IF.                                                      01320605
013260                                                                  01326002
013300     PERFORM 3000-READ-RECORD.                                    01330002
013600                                                                  01360000
013900                                                                  01390000
014000 3000-READ-RECORD.                                                01400000
014010                                                                  01401002
014100     READ INPUT-FILE                                              01410000
014200       INTO TR068-DATA-RECORD                                     01420002
014300         AT END SET   PS-END-OF-INPUT  TO  TRUE.                  01430002
014400                                                                  01440002
014410     IF  PS-END-OF-INPUT                                          01441007
014420         CONTINUE                                                 01442007
014430     ELSE                                                         01443007
014502         MOVE TR068-SHIPT-ID         TO  PV-DISP-SHIPT-ID         01450207
014503         MOVE TR068-TRIP-ID          TO  PV-DISP-TRIP-ID          01450307
014504         MOVE TR068-ORD-NBR          TO  PV-DISP-PO-NBR           01450407
014505         MOVE TR068-RCVR-SEQ-NBR     TO  PV-DISP-RCVR-SEQ         01450507
014506         MOVE TR068-OPER-UNT-ID      TO  PV-DISP-OPER             01450607
014507                                                                  01450707
014519         DISPLAY 'SHPMT:'     PV-DISP-SHIPT-ID                    01451907
014520                 ' TRIP:'     PV-DISP-TRIP-ID                     01452007
014521                 '   '        PV-DISP-OPER                        01452107
014522                 '-'          PV-DISP-PO-NBR                      01452207
014523                 '-'          PV-DISP-RCVR-SEQ                    01452307
014524                 '  '         TR068-PRCG-STAT-CDE                 01452407
014525                 '  '         TR068-TRIP-STATUS-CDE               01452507
014526                 ' '          TR068-STATUS-DTE                    01452607
014527                 ' '          TR068-STATUS-TME                    01452707
014530                                                                  01453007
014600         ADD +1 TO PV-INPUT-COUNT                                 01460007
014700     END-IF.                                                      01470007
019400                                                                  01940000
021300                                                                  02130000
021400 3100-UPDATE-PRO-NBR.                                             02140002
021410                                                                  02141002
021420     MOVE TR068-SHIPT-ID         TO  SHIPMT-SHIPT-ID.             02142002
021430                                                                  02143002
021500     EXEC SQL                                                     02150000
021600         UPDATE TSHIPMT                                           02160000
021700         SET PRO_NBR    = 'NOPRO - TRLR UNLOADED'                 02170002
021800         WHERE SHIPT_ID = :SHIPMT-SHIPT-ID                        02180000
021900     END-EXEC.                                                    02190000
021910                                                                  02191002
021920     EVALUATE TRUE                                                02192002
021930         WHEN SQLCODE = +0                                        02193002
021940             ADD +1 TO PV-UPDATE-COUNT                            02194002
021950         WHEN SQLCODE = +100                                      02195002
021951             MOVE TR068-SHIPT-ID  TO  PV-DISP-SHIPT-ID            02195102
021952             DISPLAY 'PRO NOT UPDATED FOR SHIPMT:'                02195202
021960                      PV-DISP-SHIPT-ID                            02196002
021970         WHEN OTHER                                               02197002
021980             MOVE '3100-UPDATE-PRO-NBR'                           02198002
021990                                    TO PV-PARAGRAPH               02199002
022000             MOVE 'UPDATE          '                              02200002
022100                                    TO PV-DB2-FUNCTION            02210002
022200             PERFORM 9900-DB2-ABEND                               02220002
022300     END-EVALUATE.                                                02230002
022800                                                                  02280000
022900******************************************************************02290002
023000 9900-DB2-ABEND.                                                  02300002
023100                                                                  02310002
023200     DISPLAY '** ABEND **'.                                       02320002
023300     DISPLAY '** PROGRAM   ** = TRKUP087'                         02330002
023400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   02340002
023500     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                02350002
023600                                                                  02360002
023700* ROUTINE TO DISPLAY ABEND IN READABLE FORMAT                     02370002
023800     COPY DPPD004.                                                02380002
023900                                                                  02390002
024000     EXEC SQL                                                     02400002
024100         ROLLBACK                                                 02410002
024200     END-EXEC.                                                    02420002
024300                                                                  02430002
024400     SET ABEND-4013           TO TRUE.                            02440002
024500     CALL 'ILBOABN0' USING ABEND-CODE.                            02450002
024600                                                                  02460002
024700                                                                  02470002
