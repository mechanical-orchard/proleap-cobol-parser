000100 IDENTIFICATION DIVISION.                                                 
000200                                                                          
000300 PROGRAM-ID.    MLKUT400                                                  
000400 AUTHOR.        SCOTT JACKSON                                             
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  04-27-98.                                                 
000700 DATE-COMPILED.                                                           
000800                                                                          
000900******************************************************************        
001000*           MLKUT400 - FORMAT FOR LEDGER UPDATE                           
001100*                                                                         
001200* THIS PROGRAM READS FOUR TRANSACTION EXTRACT FILES LISTED BELOW..        
001300*                                                                         
001400****    PURCHASES (INCLUDING TRANSFER FROM / TRANSFER TO)                 
001500****    SALES                                                             
001600****    PRICE CHANGES (INCLUDING MARKDOWNS / MARKUPS)                     
001700****    ADJUSTMENTS (INV ADJUSTMENT)                                      
001800*                                                                         
001900* AN EXTRACT FILE WILL BE OPENED SEPARATELY, AND READ UNTIL ALL           
002000* RECORDS ON THE FILE HAVE BEEN PROCESSED. FILE WILL BE CLOSED    00200000
002100* AFTER ALL TRANSACTIONS HAVE BEEN REFORMATTED TO THE MLRD100 FMT 00210000
002200* AND WRITTEN TO THE OUTPUT FILE.                                 00220000
002300*                                                                 00230000
002400* EACH EXTRACT FILE WILL PROCESSED IN THE SAME FASHION, FORMATTING00240000
002500* THE DATA FIELDS AS EACH TRAN CODE TYPE/EXTRACT FILE IS PROCESSED00250000
002600*                                                                 00260000
002700* ALL RECORD TYPES (EXCEPT SALES) WILL UTILIZE THE PROCESSING DATE00270000
002800* TO APPEND FISCAL CALENDAR INFO TO OUTPUT. SO THE SALES FILE WILL00280000
002900* BE PROCESSED LAST SINCE CALENDAR ROUTINE VARIABLES WILL CHANGE  00290000
003000* DEPENDANT ON THE FINANCIAL LIABILITY DATE READ ON THE INPUT FILE00300000
003100******************************************************************00310000
003800* CHANGED BY:  B. MCASEY          12-04-1998         WR#5701      00320000
003900* FOR SALES. LOAD THE WEEK END DATE AND WEEK NUMBER BASED ON THE  00330000
004000* FINANCIAL LIABILITY DATE.                                       00340000
004100******************************************************************00350000
003200* CHANGED BY:  D. HOPPA           12-17-98           WR#5701      00360000
003300* FOR PURCHASES, IF THE SYSTEM ORIGIN IS RECEIVING, MOVE THE      00370000
003400* DOLLAR FIELDS TO THE RECEIPT FIELDS. IF THE SYSTEM ORIGIN IS    00380000
003500* NOT RECEIVING, MOVE THE DOLLAR FIELDS TO THE PURCHASE ADJUSTMENT00390000
003600* FIELDS.                                                         00400000
004100******************************************************************00410000
003200* CHANGED BY:  R. BUTZ            10-29-99           WR#20418     00420000
      * ADD AN OUTPUT FILE TO CAPTURE BACK POSTED SALES TRANSACTIONS.   00430000
      *                                                                 00440000
003700******************************************************************00450000
1299RM******************************************************************00450100
1299RM* CHANGED BY:  B. MCASEY          12-28-1999         WR#20698     00450200
1299RM* ADDED CODE TO MOVE THE PO-TYPE-CODE FROM THE PURCHASE FILE      00450400
1299RM* TO THE CONDENSED FILE.                                          00450500
      ******************************************************************00452005
      * CHANGED BY:  TESS BESTE         01-17-2000         WR#20418     00453005
      * CHANGED SALES BACKPOSTING LOGIC AS FOLLOWS:                     00454005
      * READ A CONTROL CARD CONTAINING A BACKPOST INDICATOR.  IF THE    00455005
      * INDICATOR IS SET TO 'Y', BACKPOST ANY SALES THAT DID NOT OCCUR  00455105
      * DURING THE POSTING WEEK TO THE PREVIOUS WEEK.  IF THE INDICATOR 00455205
      * IS 'N', DO NOT BACKPOST ANY SALES (I.E. POST ALL SALES TO THE   00455305
      * POSTING WEEK).                                                  00455405
      ******************************************************************00456005
0300RM* CHANGED BY:  B. MCASEY          03-07-2000         WR#20698     00458013
0300RM* ADDED CODE TO INITIALIZE THE PO-TYPE-CODE ON RECORDS OTHER      00459013
0300RM* THAN PURCHASES.                                                 00459113
      *                                                                *00459214
      ******************** HISTORY OF CHANGES **************************00459314
      *                                                                *00459414
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *00459514
      * -------  ----------  ----------------------------------------  *00459614
      * 21591    03-01-2002  MANIFEST PROJECT CHANGE FOR IN-TRANSIT    *00460514
      *                      REVERSAL FROM INVENTORY LEDGER            *00460614
      *                                                                *00460714
W26603* 26603    03-17-2004  STORE EXPANSION.  SOME PROGRAM VARIABLES  *00460514
W26603*                      WERE INCREASED & SOME WERE COMMENTED OUT. *        
W26603*                      ADDED 'WITH UR' TO DB2 SELECTS.           *        
W26603*                      COPYBOOKS MLRD021,MLRD022, MLRD023, AND   *        
W26603*                      MLRD024 WERE CHANGED WHERE THE STORE      *        
W26603*                      NUMBER WAS 3 CHARS, IT WAS CHANGED TO 5   *        
W26603*                      CHARS.                                    *        
W26603*                      THE TWO BYTE DIFFERENCE WAS TAKEN FROM    *        
W26603*                      FILLER.                                   *        
W26603*                      - RONNA MCDONALD                          *00460714
W26606* 26606    01-24-2006  TO PREVENT TRUNCATION, ASSIGN PRICE CHANGE*00460514
W26606*                      AMOUNT FROM EXTD-RTL-AMT INSTEAD OF       *        
W26606*                      RE-CALCULATING.                           *        
W26606*                      - JOHN SELWITSCHKA                        *00460714
W26606* 28582    02-24-2006  PRICE CHANGE COPYBOOKS EXPANSION.         *00460514
W26606*                      MODIFIED PRICE-CHANGE-EXTRACT-FILE LRECL. *        
W26606*                      - JOHN SELWITSCHKA                        *00460714
      ******************************************************************00460814
004200                                                                  00461000
004300                                                                  00470000
004400 ENVIRONMENT DIVISION.                                            00480000
004500                                                                  00490000
004600 CONFIGURATION SECTION.                                           00500000
004700 SOURCE-COMPUTER.        IBM-3090.                                00510000
004800 OBJECT-COMPUTER.        IBM-3090.                                00520000
004900 INPUT-OUTPUT SECTION.                                            00530000
005000 FILE-CONTROL.                                                    00540000
005100     SELECT PURCHASE-FILE                                         00550000
005200         ASSIGN TO INP01.                                         00560000
005300     SELECT PRICE-CHANGE-FILE                                     00570000
005400         ASSIGN TO INP02.                                         00580000
005500     SELECT ADJUSTMENT-FILE                                       00590000
005600         ASSIGN TO INP03.                                         00600000
005700     SELECT SALES-FILE                                            00610000
005800         ASSIGN TO INP04.                                         00620000
005700     SELECT CONTROL-CARD-FILE                                     00621005
005800         ASSIGN TO INP05.                                         00622000
005900     SELECT OUTPUT-FILE                                           00630000
006000         ASSIGN TO OUT01.                                         00640000
005900     SELECT BACK-POSTING-FILE                                     00650000
006000         ASSIGN TO OUT02.                                         00660000
006100                                                                  00670000
006200                                                                  00680000
006300 DATA DIVISION.                                                   00690000
006400 FILE SECTION.                                                    00700000
006500                                                                  00710000
006600*                                                                 00720000
006700 FD  PURCHASE-FILE                                                00730000
006800     LABEL RECORDS ARE STANDARD                                   00740000
006900     RECORDING MODE IS F                                          00750000
007000     BLOCK CONTAINS 0 RECORDS.                                    00760000
007100 01  PURCHASE-RECORD              PIC X(150).                     00770000
007200*                                                                 00780000
007300*                                                                 00790000
007400 FD  PRICE-CHANGE-FILE                                            00800000
007500     LABEL RECORDS ARE STANDARD                                   00810000
007600     RECORDING MODE IS F                                          00820000
007700     BLOCK CONTAINS 0 RECORDS.                                    00830000
W26606 01  PRICE-CHANGE-RECORD          PIC X(130).                     00840000
007900*                                                                 00850000
008000*                                                                 00860000
008100 FD  ADJUSTMENT-FILE                                              00870000
008200     LABEL RECORDS ARE STANDARD                                   00880000
008300     RECORDING MODE IS F                                          00890000
008400     BLOCK CONTAINS 0 RECORDS.                                    00900000
008500 01  ADJUSTMENT-RECORD            PIC X(90).                      00910000
008600*                                                                 00920000
008700*                                                                 00930000
008800 FD  SALES-FILE                                                   00940000
008900     LABEL RECORDS ARE STANDARD                                   00950000
009000     RECORDING MODE IS F                                          00960000
009100     BLOCK CONTAINS 0 RECORDS.                                    00970000
009200 01  SALES-RECORD                 PIC X(80).                      00980000
009300                                                                  00990011
009300                                                                  00990111
005700 FD  CONTROL-CARD-FILE                                            00991011
009600     LABEL RECORDS ARE STANDARD                                   00992011
009700     RECORDING MODE IS F                                          00993011
009800     BLOCK CONTAINS 0 RECORDS.                                    00994011
009900 01  CONTROL-CARD-RECORD          PIC X(80).                      00995011
                                                                        00996011
009400*                                                                 01000000
009500 FD  OUTPUT-FILE                                                  01010000
009600     LABEL RECORDS ARE STANDARD                                   01020000
009700     RECORDING MODE IS F                                          01030000
009800     BLOCK CONTAINS 0 RECORDS.                                    01040000
009900 01  OUTPUT-RECORD                PIC X(150).                     01050000
009300*                                                                 01060000
009400*                                                                 01070000
009500 FD  BACK-POSTING-FILE                                            01080000
009600     LABEL RECORDS ARE STANDARD                                   01090000
009700     RECORDING MODE IS F                                          01100000
009800     BLOCK CONTAINS 0 RECORDS.                                    01110000
009900 01  BACK-POSTING-RECORD          PIC X(80).                      01120000
010000                                                                  01130000
010100                                                                  01140000
                                                                        01147000
010200 WORKING-STORAGE SECTION.                                         01150000
010300                                                                  01160000
010400 01  ABEND-CODE                  PIC S9(04)  VALUE ZERO COMP SYNC.01170000
010500                                                                  01180000
077000 01  CC-CONTROL-CARD-REC.                                         01181005
           05  CC-BACKPOST-SALES-IND   PIC  X.                          01182005
               88  CC-BACKPOST-SALES                 VALUE 'Y'.         01183005
               88  CC-DO-NOT-BACKPOST-SALES          VALUE 'N'.         01184005
           05  FILLER                  PIC  X(79).                      01184105
                                                                        01185005
010600 01  PC-PROGRAM-CONSTANTS.                                        01190000
010700     05  PC-PROGRAM-NAME         PIC  X(08)    VALUE 'MLKUT400'.  01200000
010900                                                                  01220000
011000 01  PE-PROGRAM-ERROR-MESSAGES.                                   01230000
011600     05  PE-MSG-02                       PIC X(40) VALUE          01290000
011700          'SALES FINANCIAL LIABILITY DATE INVALID'.               01300000
012000*                                                                 01330000
012100 01  PS-PROGRAM-SWITCHES.                                         01340000
077100     05  PS-CONTROL-CARD-EOF-SW       PIC  X        VALUE 'N'.    01341005
               88  PS-END-OF-CONTROL-CARD-FILE            VALUE 'Y'.    01342005
012200     05  PS-PURCHASE-EOF-SW           PIC  X        VALUE 'N'.    01350000
012300         88  PS-NO-MORE-PURCHASES                   VALUE 'Y'.    01360000
012400     05  PS-PCHNG-EOF-SW              PIC  X        VALUE 'N'.    01370000
012500         88  PS-NO-MORE-PRICE-CHANGES               VALUE 'Y'.    01380000
012600     05  PS-ADJ-EOF-SW                PIC  X        VALUE 'N'.    01390000
012700         88  PS-NO-MORE-ADJUSTMENTS                 VALUE 'Y'.    01400000
012800     05  PS-SALE-EOF-SW               PIC  X        VALUE 'N'.    01410000
012900         88  PS-NO-MORE-SALES                       VALUE 'Y'.    01420000
013000     05  PS-SALE-FIRST-TIME-SW        PIC  X        VALUE 'N'.    01430000
013100         88  PS-FIRST-SALES-REC                     VALUE 'Y'.    01440000
013200                                                                  01450000
014500 01  PV-PROGRAM-VARIABLES.                                        01580000
014600     05  PV-PARAGRAPH-NAME               PIC  X(30) VALUE SPACES. 01590000
014700     05  PV-ABEND-MESSAGE                PIC  X(75) VALUE SPACES. 01600000
014800     05  PV-OPERATION-ATTEMPTED          PIC  X(40) VALUE SPACES. 01610000
081600     05  PV-PFW-WK-NBR                   PIC  X(02).              01611000
015500     05  PV-PURCH-CALC-FIELDS.                                    01680000
W26603         10  PV-PURCH-EXT-RTL-AMT            PIC S9(11)V99        01690000
015700                                      COMP-3    VALUE ZEROES.     01700000
W26603*        10  PV-PURCH-EXT-COST-AMT           PIC S9(11)V99        01710000
W26603*                                     COMP-3    VALUE ZEROES.     01720000
W26603         10  PV-PURCH-FRGT-COST-AMT          PIC S9(11)V99        01730000
016100                                      COMP-3    VALUE ZEROES.     01740000
W26603*        10  PV-PURCH-DISC-COST-AMT          PIC S9(11)V99        01750000
W26603*                                     COMP-3    VALUE ZEROES.     01760000
W26603         10  PV-PURCH-NET-COST-AMT           PIC S9(11)V99        01770000
016500                                      COMP-3    VALUE ZEROES.     01780000
016600         10  PV-TRX-OUT-RTL-AMT              PIC S9(11)V99        01790000
016700                                      COMP-3    VALUE ZEROES.     01800000
016800         10  PV-TRX-IN-RTL-AMT               PIC S9(11)V99        01810000
016900                                      COMP-3    VALUE ZEROES.     01820000
017000         10  PV-MKDN-RTL-AMT                 PIC S9(11)V99        01830000
017100                                      COMP-3    VALUE ZEROES.     01840000
017200         10  PV-MKUP-RTL-AMT                 PIC S9(11)V99        01850000
017300                                      COMP-3    VALUE ZEROES.     01860000
017400*                                                                 01870000
017500 01  PA-PROGRAM-ACCUMULATORS.                                     01880000
017600     05  PA-INPUT-COUNTS.                                         01890000
017700         10  PA-INPUT-COUNT-IN      PIC  9(8)  VALUE ZEROES.      01900000
017800         10  PA-PURCHASE-COUNT-IN   PIC  9(8)  VALUE ZEROES.      01910000
017900         10  PA-PURCH-EXTR-CNT-IN   PIC  9(8)  VALUE ZEROES.      01920000
018000         10  PA-PRICE-CHG-COUNT-IN  PIC  9(8)  VALUE ZEROES.      01930000
018100         10  PA-ADJUST-COUNT-IN     PIC  9(8)  VALUE ZEROES.      01940000
018200         10  PA-SALES-COUNT-IN      PIC  9(8)  VALUE ZEROES.      01950000
018300     05  PA-OUTPUT-COUNTS.                                        01960000
018400         10  PA-OUTPUT-COUNT-OUT    PIC  9(8)  VALUE ZEROES.      01970000
018500         10  PA-PURCHASE-COUNT-OUT  PIC  9(8)  VALUE ZEROES.      01980000
018600         10  PA-PURCH-EXTR-CNT-OUT  PIC  9(8)  VALUE ZEROES.      01990000
018700         10  PA-TRX-FROM-COUNT-OUT  PIC  9(8)  VALUE ZEROES.      02000000
018800         10  PA-TRX-TO-COUNT-OUT    PIC  9(8)  VALUE ZEROES.      02010000
018900         10  PA-PCHANGE-COUNT-OUT   PIC  9(8)  VALUE ZEROES.      02020000
019000         10  PA-MARKDOWN-COUNT-OUT  PIC  9(8)  VALUE ZEROES.      02030000
019100         10  PA-MARKON-COUNT-OUT    PIC  9(8)  VALUE ZEROES.      02040000
019200         10  PA-ADJUST-COUNT-OUT    PIC  9(8)  VALUE ZEROES.      02050000
019300         10  PA-SALES-COUNT-OUT     PIC  9(8)  VALUE ZEROES.      02060000
019300         10  PA-BACK-POST-COUNT-OUT PIC  9(8)  VALUE ZEROES.      02070000
019400*                                                                 02080000
019500 01  SAVE-AREA.                                                   02090000
019600     05  SV-SALE-FIN-LIAB-DTE           PIC X(10).                02100000
019900                                                                  02130000
020000****************************************************              02140000
020100*  COMMUNICATION AREAS FOR DB2                     *              02150000
020200****************************************************              02160000
020300     EXEC SQL                                                     02170000
020400         INCLUDE SQLCA                                            02180000
020500     END-EXEC.                                                    02190000
020600                                                                  02200012
020700****************************************************              02210000
020800*  ERROR MESSAGE AREA FOR DB2                      *              02220000
020900****************************************************              02230000
021000     COPY DPWS004.                                                02240000
021100                                                                  02250012
021200                                                                  02260012
021300****************************************************              02270000
021400* M/L OPEN FISCAL DATE INFORMATION TABLE           *              02280000
021500****************************************************              02290000
021600                                                                  02300012
021700     EXEC SQL                                                     02310012
021800         INCLUDE TMLCNTL                                          02320012
021900     END-EXEC.                                                    02330012
022000                                                                  02340012
022100****************************************************              02353000
022200*  M/L DATE TABLE                                  *              02360000
022300****************************************************              02370000
022400     EXEC SQL                                                     02380000
022500         INCLUDE TDTATTR                                          02390000
022600     END-EXEC.                                                    02400000
022700                                                                  02410000
022800******************************************************************02420000
022900* MLRD021 - PURCHASE AND TRANSFER EXTRACT RECORD LAYOUT           02430000
023000* MLRD022 - SALES EXTRACT RECORD LAYOUT                           02440000
023100* MLRD023 - PRICE CHANGE EXTRACT RECORD LAYOUT (MARKDOWN/MARKUPS) 02450000
023200* MLRD024 - INVENTORY ADJ TRANSFER EXTRACT RECORD LAYOUT          02460000
023300* MLRD100 - M/L DATABASE UPDATE TRANSACTIONS OUTPUT FORMAT        02470000
023400******************************************************************02480000
21591      COPY MLRD021.                                                02490000
023600     COPY MLRD022.                                                02500000
W26606     COPY MLRD023.                                                02510000
023800     COPY MLRD024.                                                02520000
21591      COPY MLRD100.                                                02530000
024000                                                                  02540000
024100*------------------*                                              02550000
024200 PROCEDURE DIVISION.                                              02560000
024300*------------------*                                              02570000
024400                                                                  02580000
024500 0000-MAIN-MODULE.                                                02590000
024600                                                                  02600000
024700     PERFORM 1000-INITIALIZATION.                                 02610000
024800     PERFORM 2100-PROCESS-PURCHASE-EXTRACT.                       02620000
024900     PERFORM 2200-PROCESS-PRICE-CHG-EXTRACT.                      02630000
025000     PERFORM 2300-PROCESS-INV-ADJ-EXTRACT.                        02640000
025100     PERFORM 2400-PROCESS-SALES-EXTRACT.                          02650000
025200                                                                  02660000
025300     PERFORM 8000-EOJ-ROUTINE.                                    02670000
025400                                                                  02680000
025500     STOP RUN.                                                    02690000
025600*                                                                 02700000
025700*                                                                 02710000
025800*                                                                 02720000
025900******************************************************************02730000
026000* PROCESS CONTROL CARD, INITIALIZE VARIABLES                      02740000
026100******************************************************************02750000
026200*                                                                 02760000
026300 1000-INITIALIZATION.                                             02770000
026400                                                                  02780000
026800     PERFORM 4000-READ-CONTROL-TABLE.                             02781009
026900                                                                  02782009
026500     OPEN INPUT  CONTROL-CARD-FILE                                02790005
026600          OUTPUT OUTPUT-FILE.                                     02800005
026700                                                                  02810000
076900     PERFORM 4050-READ-CONTROL-CARD-FILE.                         02811005
           DISPLAY 'CONTROL CARD: ' CC-CONTROL-CARD-REC.                02812005
                                                                        02813005
           IF PS-END-OF-CONTROL-CARD-FILE                               02813105
               DISPLAY '** ABEND IN PROGRAM ' PC-PROGRAM-NAME           02813206
               DISPLAY '** PARAGRAPH 1000-INITIALIATION'                02813306
039100         DISPLAY '** CONTROL CARD FILE IS EMPTY.'                 02813406
039300         MOVE +4003 TO ABEND-CODE                                 02813506
039600         PERFORM 9999-ABEND-ROUTINE                               02813806
           END-IF.                                                      02813906
                                                                        02814006
           IF CC-BACKPOST-SALES                                         02814208
               PERFORM 7100-GET-PREV-FSCL-WK-DTE                        02814308
               PERFORM 7200-GET-PREV-FSCL-WK-NBR                        02814408
           ELSE                                                         02814508
               IF CC-DO-NOT-BACKPOST-SALES                              02814608
                   CONTINUE                                             02814708
               ELSE                                                     02814808
                   DISPLAY '** ABEND IN PROGRAM ' PC-PROGRAM-NAME       02814908
                   DISPLAY '** PARAGRAPH 1000-INITIALIATION'            02815008
039100             DISPLAY '** INVALID SALES BACKPOSTING INDICATOR '    02815108
039100             DISPLAY '** ON CONTROL CARD.                    '    02815208
039100             DISPLAY '** VALID VALUES ARE "Y" AND "N".       '    02815308
039300             MOVE +4003 TO ABEND-CODE                             02815408
039600             PERFORM 9999-ABEND-ROUTINE                           02815508
               END-IF                                                   02815608
           END-IF.                                                      02815708
                                                                        02816005
027000     MOVE 'N'     TO PS-PURCHASE-EOF-SW                           02840000
027100                     PS-PCHNG-EOF-SW                              02850000
027200                     PS-ADJ-EOF-SW                                02860000
027300                     PS-SALE-EOF-SW.                              02870000
027400                                                                  02880000
027500     MOVE SPACES  TO OUTPUT-RECORD.                               02890000
027600     MOVE ZEROES  TO PA-PROGRAM-ACCUMULATORS.                     02900000
027700*                                                                 02910000
027800*                                                                 02920000
027900******************************************************************02930000
028000* PROCESS PURCHASE FILE (INC. PURCHASE AND TRANSFER TRAN CODES)   02940000
028100******************************************************************02950000
028200 2100-PROCESS-PURCHASE-EXTRACT.                                   02960000
028300*                                                                 02970000
028400     OPEN INPUT PURCHASE-FILE.                                    02980000
028500     PERFORM 4100-READ-PURCHASE-FILE.                             02990000
028600*                                                                 03000000
028700     PERFORM 3100-PROCESS-PURCHASE-FILE                           03010000
028800         UNTIL PS-NO-MORE-PURCHASES.                              03020000
028900*                                                                 03030000
029000     COMPUTE PA-PURCH-EXTR-CNT-OUT = (  PA-PURCHASE-COUNT-OUT     03040000
029100                                      + PA-TRX-FROM-COUNT-OUT     03050000
029200                                      + PA-TRX-TO-COUNT-OUT  ).   03060000
029300*                                                                 03070000
029400     DISPLAY '                                              '.    03080000
029500     DISPLAY '**** PURCHASE STATS ************'.                  03090000
029600     DISPLAY 'EXTRACT  RECORDS READ = ', PA-PURCH-EXTR-CNT-IN.    03100000
029700     DISPLAY '                                              '.    03110000
029800     DISPLAY 'PURCHASE OUTPUT COUNT = ', PA-PURCHASE-COUNT-OUT.   03120000
029900     DISPLAY 'TRX FROM OUTPUT COUNT = ', PA-TRX-FROM-COUNT-OUT.   03130000
030000     DISPLAY 'TRX  TO  OUTPUT COUNT = ', PA-TRX-TO-COUNT-OUT.     03140000
030100     DISPLAY '                       ----------'                  03150000
030200     DISPLAY 'EXTRACT RECS WRITTEN  = ', PA-PURCH-EXTR-CNT-OUT.   03160000
030300*                                                                 03170000
030400     CLOSE PURCHASE-FILE.                                         03180000
030500*                                                                 03190000
030600*                                                                 03200000
030700******************************************************************03210000
030800* PROCESS PURCHASE FILE (INC. PURCHASE AND TRANSFER TRAN CODES)   03220000
030900******************************************************************03230000
031000 2200-PROCESS-PRICE-CHG-EXTRACT.                                  03240000
031100*                                                                 03250000
031200     OPEN INPUT PRICE-CHANGE-FILE.                                03260000
031300     PERFORM 4200-READ-PRICE-CHANGE-FILE.                         03270000
031400*                                                                 03280000
031500     PERFORM 3200-PROCESS-PRICE-CHANGE-FILE                       03290000
031600         UNTIL PS-NO-MORE-PRICE-CHANGES.                          03300000
031700*                                                                 03310000
031800     COMPUTE PA-PCHANGE-COUNT-OUT  = (  PA-MARKDOWN-COUNT-OUT     03320000
031900                                      + PA-MARKON-COUNT-OUT  ).   03330000
032000*                                                                 03340000
032100     DISPLAY '                                              '.    03350000
032200     DISPLAY '**** PRICE CHG STATS ***********'.                  03360000
032300     DISPLAY 'EXTRACT  RECORDS READ = ', PA-PRICE-CHG-COUNT-IN.   03370000
032400     DISPLAY '                                              '.    03380000
032500     DISPLAY 'MARKDOWN OUTPUT COUNT = ', PA-MARKDOWN-COUNT-OUT.   03390000
032600     DISPLAY 'MARKUPS  OUTPUT COUNT = ', PA-MARKON-COUNT-OUT.     03400000
032700     DISPLAY '                       ----------'                  03410000
032800     DISPLAY 'EXTRACT RECS WRITTEN  = ', PA-PCHANGE-COUNT-OUT.    03420000
032900*                                                                 03430000
033000     CLOSE PRICE-CHANGE-FILE.                                     03440000
033100*                                                                 03450000
033200*                                                                 03460000
033300*                                                                 03470000
033400******************************************************************03480000
033500* PROCESS INVENTORY ADJUSTMENT FILE                               03490000
033600******************************************************************03500000
033700 2300-PROCESS-INV-ADJ-EXTRACT.                                    03510000
033800*                                                                 03520000
033900     OPEN INPUT ADJUSTMENT-FILE.                                  03530000
034000     PERFORM 4300-READ-ADJUSTMENT-FILE.                           03540000
034100*                                                                 03550000
034200     PERFORM 3300-PROCESS-ADJUSTMENT-FILE                         03560000
034300         UNTIL PS-NO-MORE-ADJUSTMENTS.                            03570000
034400*                                                                 03580000
034500     DISPLAY '                                '.                  03590000
034600     DISPLAY '**** INV ADJ STATS *************'.                  03600000
034700     DISPLAY 'ADJUSTMENT INPUT CNT  = ', PA-ADJUST-COUNT-IN.      03610000
034800     DISPLAY 'ADJUSTMENT OUTPUT CNT = ', PA-ADJUST-COUNT-OUT.     03620000
034900*                                                                 03630000
035000     CLOSE ADJUSTMENT-FILE.                                       03640000
035100*                                                                 03650000
035200*                                                                 03660000
035300*                                                                 03670000
035400******************************************************************03680000
035500* PROCESS SALES FILE                                              03690000
035600******************************************************************03700000
035700 2400-PROCESS-SALES-EXTRACT.                                      03710000
035800*                                                                 03720000
035900     OPEN INPUT SALES-FILE                                        03730000
                OUTPUT BACK-POSTING-FILE.                               03740000
036000     PERFORM 4400-READ-SALES-FILE.                                03750000
036100*                                                                 03760000
036200     MOVE 'Y' TO PS-SALE-FIRST-TIME-SW.                           03770000
036300*                                                                 03780000
036400     PERFORM 3400-PROCESS-SALES-FILE                              03790000
036500         UNTIL PS-NO-MORE-SALES.                                  03800000
036600*                                                                 03810000
036700     DISPLAY SPACES.                                              03820000
036800     DISPLAY '**** SALES FILE STATS **********'.                  03830000
036900     DISPLAY 'SALES INPUT  COUNT    = ', PA-SALES-COUNT-IN.       03840000
037000     DISPLAY 'SALES OUTPUT COUNT    = ', PA-SALES-COUNT-OUT.      03850000
037000     DISPLAY 'BACK POSTING COUNT    = ', PA-BACK-POST-COUNT-OUT.  03860000
037100*                                                                 03870000
037200     CLOSE SALES-FILE                                             03880000
037300           BACK-POSTING-FILE.                                     03890000
037400*                                                                 03900000
037400*                                                                 03910000
037500******************************************************************03920000
037600* DETERMINE WHAT RECORD TYPE TO PROCESS (PURCHASES OR TRANSFERS)  03930000
037700******************************************************************03940000
037800 3100-PROCESS-PURCHASE-FILE.                                      03950000
037900*                                                                 03960000
038000     ADD 1 TO PA-INPUT-COUNT-IN                                   03970000
038100              PA-PURCH-EXTR-CNT-IN.                               03980000
038200*                                                                 03990000
038300     EVALUATE TRUE                                                04000000
038400         WHEN ML021-PURCH-PURCHASE                                04010000
038500              PERFORM 3125-FORMAT-PURCHASE-RECORDS                04020000
038600         WHEN ML021-PURCH-TRANSFER-FRM-STORE                      04030000
038700              PERFORM 3150-FORMAT-TRX-FROM-RECORDS                04040000
038800         WHEN ML021-PURCH-TRANSFER-TO-STORE                       04050000
038900              PERFORM 3175-FORMAT-TRX-TO-RECORDS                  04060000
039000         WHEN OTHER                                               04070000
                    DISPLAY '** ABEND IN PROGRAM ' PC-PROGRAM-NAME      04071006
039100              DISPLAY '** ERROR PROCESSING PURCHASE EXTRACT FILE.'04080006
011900              DISPLAY '** TRAN CODE NOT VALID WITH FILE TYPE.'    04081006
039200              DISPLAY  ML021-PURCH-RECORD                         04090000
039300              MOVE +4008 TO ABEND-CODE                            04100000
039500              DISPLAY 'TRANS CODE : ', ML021-PURCH-TRANS-CDE      04120000
039600              PERFORM 9999-ABEND-ROUTINE                          04130000
039700     END-EVALUATE.                                                04140000
039800*                                                                 04150000
039900     PERFORM 4100-READ-PURCHASE-FILE.                             04160000
040000*                                                                 04170000
040100*                                                                 04180000
040200******************************************************************04190000
040300* FORMAT PURCHASE RECORDS (CODE '10') TO OUTPUT FORMAT            04200000
040400******************************************************************04210000
040500*                                                                 04220000
040600 3125-FORMAT-PURCHASE-RECORDS.                                    04230000
040700*                                                                 04240000
040900     MOVE MLCNTL-PSTG-FSCL-MN-NBR    TO ML100-FSCL-MN-NBR.        04260000
041000     MOVE MLCNTL-PSTG-FSCL-WK-NBR    TO ML100-FSCL-WK-NBR.        04270000
041100     MOVE MLCNTL-PSTG-FSCL-MN-DTE    TO ML100-FSCL-MN-END-DTE.    04280000
041200     MOVE MLCNTL-PSTG-FSCL-WK-DTE    TO ML100-FSCL-WK-END-DTE.    04290000
041300*STRAIGHT MOVES FROM INPUT FORMAT TO OUTPUT FIELDS                04300000
041400     MOVE ML021-PURCH-STORE-NBR      TO ML100-STR-NBR.            04310000
041500     MOVE ML021-PURCH-DEPT-NBR       TO ML100-DEPT-NBR.           04320000
041600     MOVE ML021-PURCH-CLASS-NBR      TO ML100-SUB-CL-NBR.         04330000
041700     MOVE ML021-PURCH-FIN-LIAB-DTE   TO ML100-FIN-LIAB-DTE.       04340000
041800     MOVE ML021-PURCH-TRANS-CDE      TO ML100-TRN-TYP-CDE.        04350000
0100RM* WR 20698 - PO TYPE CODE                                         04350100
0100RM     MOVE ML021-PURCH-PO-TYP-CDE     TO ML100-RCPT-PO-TYP-CDE.    04351000
041900*                                                                 04360000
042000     MOVE ML021-PURCH-EXTD-RTL-AMT   TO PV-PURCH-EXT-RTL-AMT.     04370000
042100     MOVE ML021-PURCH-FRGT-AMT       TO PV-PURCH-FRGT-COST-AMT.   04380000
042200     MOVE ML021-PURCH-EXTD-NET-COST-AMT                           04390000
042300                                     TO PV-PURCH-NET-COST-AMT.    04400000
042400                                                                  04410000
042500*FOLLOWING FIELDS REQUIRE CALCULATION PRIOR TO MOVING VALUES      04420000
042600     IF (ML021-PURCH-DR-CR-CDE = '02' OR '08')                    04430000
042700         COMPUTE PV-PURCH-EXT-RTL-AMT =                           04440000
042800                           (PV-PURCH-EXT-RTL-AMT * -1)            04450000
042900         COMPUTE PV-PURCH-FRGT-COST-AMT =                         04460000
043000                           (PV-PURCH-FRGT-COST-AMT * -1)          04470000
043100         COMPUTE PV-PURCH-NET-COST-AMT =                          04480000
043200                           (PV-PURCH-NET-COST-AMT * -1)           04490000
043300     END-IF.                                                      04500000
043400                                                                  04510000
21591      MOVE ZEROES      TO ML100-RCPT-RTL-AMT                               
21591                          ML100-RCPT-FRGT-COST-AMT                         
21591                          ML100-RCPT-NET-COST-AMT                          
21591                          ML100-PADJ-RTL-AMT                               
21591                          ML100-PADJ-FRGT-COST-AMT                         
21591                          ML100-PADJ-NET-COST-AMT                          
21591                          ML100-IN-TRNST-RTL-AMT.                          
21591 *IF THE SOURCE SYSTEM IS RECEIVING, MOVE THE DOLLARS TO RECEIPTS  04520000
21591 *IF THE SOURCE SYSTEM IS PHYS INV, MOVE THE DOLLARS TO IN-TRANSIT 04530000
21591 *OTHERWISE, MOVE THE DOLLARS TO PURCHASE ADJ                      04540000
21591      EVALUATE TRUE                                                        
21591          WHEN ML021-PURCH-RECEIPT                                         
21591              MOVE PV-PURCH-EXT-RTL-AMT                                    
21591                  TO ML100-RCPT-RTL-AMT                                    
21591              MOVE PV-PURCH-FRGT-COST-AMT                                  
21591                  TO ML100-RCPT-FRGT-COST-AMT                              
21591              MOVE PV-PURCH-NET-COST-AMT                                   
21591                  TO ML100-RCPT-NET-COST-AMT                               
21591          WHEN ML021-PHYSICAL-INVENTORY                                    
21591              MOVE PV-PURCH-EXT-RTL-AMT                                    
21591                  TO ML100-IN-TRNST-RTL-AMT                                
21591          WHEN OTHER                                                       
21591              MOVE PV-PURCH-EXT-RTL-AMT                                    
21591                  TO ML100-PADJ-RTL-AMT                                    
21591              MOVE PV-PURCH-FRGT-COST-AMT                                  
21591                  TO ML100-PADJ-FRGT-COST-AMT                              
21591              MOVE PV-PURCH-NET-COST-AMT                                   
21591                  TO ML100-PADJ-NET-COST-AMT                               
045200     END-EVALUATE.                                                        
045300*                                                                 04700000
045400     MOVE ZEROES                       TO ML100-SLS-RTL-AMT       04710000
045500                                          ML100-MKDN-RTL-AMT      04720000
045600                                          ML100-MKUP-RTL-AMT      04730000
045700                                          ML100-XFER-IN-RTL-AMT   04740000
045800                                          ML100-XFER-OUT-RTL-AMT  04750000
045900                                          ML100-INV-ADJ-RTL-AMT.  04760000
046000*                                                                 04770000
046100     PERFORM 5000-WRITE-OUTPUT-RECORD.                            04780000
046200*                                                                 04790000
046300     ADD +1 TO PA-PURCHASE-COUNT-OUT                              04800000
046400               PA-OUTPUT-COUNT-OUT.                               04810000
046500*                                                                 04820000
046600*                                                                 04830000
046700******************************************************************04840000
046800* FORMAT TRANSFER FROM RECORDS (CODE '30') TO OUTPUT FORMAT       04850000
046900******************************************************************04860000
047000 3150-FORMAT-TRX-FROM-RECORDS.                                    04870000
047100*                                                                 04880000
047300     MOVE MLCNTL-PSTG-FSCL-MN-NBR    TO ML100-FSCL-MN-NBR.        04900000
047400     MOVE MLCNTL-PSTG-FSCL-WK-NBR    TO ML100-FSCL-WK-NBR.        04910000
047500     MOVE MLCNTL-PSTG-FSCL-MN-DTE    TO ML100-FSCL-MN-END-DTE.    04920000
047600     MOVE MLCNTL-PSTG-FSCL-WK-DTE    TO ML100-FSCL-WK-END-DTE.    04930000
047700*STRAIGHT MOVES FROM INPUT FORMAT TO OUTPUT FIELDS                04940000
047800     MOVE ML021-PURCH-STORE-NBR        TO ML100-STR-NBR.          04950000
047900     MOVE ML021-PURCH-DEPT-NBR         TO ML100-DEPT-NBR.         04960000
048000     MOVE ML021-PURCH-CLASS-NBR        TO ML100-SUB-CL-NBR.       04970000
048100     MOVE ML021-PURCH-FIN-LIAB-DTE     TO ML100-FIN-LIAB-DTE.     04980000
048200     MOVE ML021-PURCH-TRANS-CDE        TO ML100-TRN-TYP-CDE.      04990000
048300* RETAIL TRANSFER 'OUT' AMOUNTS                                   05000000
048400     COMPUTE PV-TRX-OUT-RTL-AMT =                                 05010000
048500                   (ML021-PURCH-QTY * ML021-PURCH-PER-UNT-RTL-AMT)05020000
048600     MOVE PV-TRX-OUT-RTL-AMT           TO ML100-XFER-OUT-RTL-AMT. 05030000
048700*                                                                 05040000
048800     MOVE ZEROES                       TO ML100-SLS-RTL-AMT       05050000
048900                                          ML100-MKDN-RTL-AMT      05060000
049000                                          ML100-MKUP-RTL-AMT      05070000
049100                                          ML100-PADJ-RTL-AMT      05080000
049200                                          ML100-PADJ-FRGT-COST-AMT05090000
049300                                          ML100-PADJ-NET-COST-AMT 05100000
049400                                          ML100-XFER-IN-RTL-AMT   05110000
049500                                          ML100-INV-ADJ-RTL-AMT   05120000
049600                                          ML100-RCPT-RTL-AMT      05130000
049700                                          ML100-RCPT-FRGT-COST-AMT05140000
049800                                          ML100-RCPT-NET-COST-AMT.05150000
0100RM* WR 20698 - PO TYPE CODE                                         05151013
0100RM     MOVE SPACES                     TO ML100-RCPT-PO-TYP-CDE.    05152013
049900*                                                                 05160000
050000     PERFORM 5000-WRITE-OUTPUT-RECORD.                            05170000
050100*                                                                 05180000
050200     ADD +1 TO PA-TRX-FROM-COUNT-OUT                              05190000
050300               PA-OUTPUT-COUNT-OUT.                               05200000
050400*                                                                 05210000
050500*                                                                 05220000
050600******************************************************************05230000
050700* FORMAT TRANSFER 'TO' RECORDS (CODE '31') TO OUTPUT FORMAT.      05240000
050800******************************************************************05250000
050900 3175-FORMAT-TRX-TO-RECORDS.                                      05260000
051000*                                                                 05270000
051200     MOVE MLCNTL-PSTG-FSCL-MN-NBR    TO ML100-FSCL-MN-NBR.        05290000
051300     MOVE MLCNTL-PSTG-FSCL-WK-NBR    TO ML100-FSCL-WK-NBR.        05300000
051400     MOVE MLCNTL-PSTG-FSCL-MN-DTE    TO ML100-FSCL-MN-END-DTE.    05310000
051500     MOVE MLCNTL-PSTG-FSCL-WK-DTE    TO ML100-FSCL-WK-END-DTE.    05320000
051600*STRAIGHT MOVES FROM INPUT FORMAT TO OUTPUT FIELDS                05330000
051700     MOVE ML021-PURCH-STORE-NBR      TO ML100-STR-NBR.            05340000
051800     MOVE ML021-PURCH-DEPT-NBR       TO ML100-DEPT-NBR.           05350000
051900     MOVE ML021-PURCH-CLASS-NBR      TO ML100-SUB-CL-NBR.         05360000
052000     MOVE ML021-PURCH-FIN-LIAB-DTE   TO ML100-FIN-LIAB-DTE.       05370000
052100     MOVE ML021-PURCH-TRANS-CDE      TO ML100-TRN-TYP-CDE.        05380000
052200* RETAIL TRANSFER 'IN' AMOUNTS                                    05390000
052300     COMPUTE PV-TRX-OUT-RTL-AMT =                                 05400000
052400                   (ML021-PURCH-QTY * ML021-PURCH-PER-UNT-RTL-AMT)05410000
052500     MOVE PV-TRX-OUT-RTL-AMT         TO ML100-XFER-IN-RTL-AMT.    05420000
052600*                                                                 05430000
052700     MOVE ZEROES                     TO ML100-SLS-RTL-AMT         05440000
052800                                        ML100-MKDN-RTL-AMT        05450000
052900                                        ML100-MKUP-RTL-AMT        05460000
053000                                        ML100-PADJ-RTL-AMT        05470000
053100                                        ML100-PADJ-FRGT-COST-AMT  05480000
053200                                        ML100-PADJ-NET-COST-AMT   05490000
053300                                        ML100-XFER-OUT-RTL-AMT    05500000
053400                                        ML100-INV-ADJ-RTL-AMT     05510000
053500                                        ML100-RCPT-RTL-AMT        05520000
053600                                        ML100-RCPT-FRGT-COST-AMT  05530000
053700                                        ML100-RCPT-NET-COST-AMT.  05540000
053800*                                                                 05550000
0100RM* WR 20698 - PO TYPE CODE                                         05551013
0100RM     MOVE SPACES                     TO ML100-RCPT-PO-TYP-CDE.    05552013
053800*                                                                 05553013
053900     PERFORM 5000-WRITE-OUTPUT-RECORD.                            05560000
054000*                                                                 05570000
054100     ADD +1 TO PA-TRX-TO-COUNT-OUT                                05580000
054200               PA-OUTPUT-COUNT-OUT.                               05590000
054300*                                                                 05600000
054400*                                                                 05610000
054500******************************************************************05620000
054600* PROCESS ALL RECORDS ON THE PRICE CHANGE FILE                    05630000
054700******************************************************************05640000
054800 3200-PROCESS-PRICE-CHANGE-FILE.                                  05650000
054900*                                                                 05660000
055000     ADD 1 TO PA-INPUT-COUNT-IN                                   05670000
055100              PA-PRICE-CHG-COUNT-IN.                              05680000
055200*                                                                 05690000
055300*MOVE ML CONTROL VALUES TO OUTPUT FIELDS                          05700000
055400     MOVE MLCNTL-PSTG-FSCL-MN-NBR    TO ML100-FSCL-MN-NBR.        05710000
055500     MOVE MLCNTL-PSTG-FSCL-WK-NBR    TO ML100-FSCL-WK-NBR.        05720000
055600     MOVE MLCNTL-PSTG-FSCL-MN-DTE    TO ML100-FSCL-MN-END-DTE.    05730000
055700     MOVE MLCNTL-PSTG-FSCL-WK-DTE    TO ML100-FSCL-WK-END-DTE.    05740000
055800*STRAIGHT MOVES FROM INPUT FORMAT TO OUTPUT FIELDS                05750000
055900     MOVE ML023-PC-STORE-NBR           TO ML100-STR-NBR.          05760000
056000     MOVE ML023-PC-DEPT-NBR            TO ML100-DEPT-NBR.         05770000
056100     MOVE ML023-PC-CLASS-NBR           TO ML100-SUB-CL-NBR.       05780000
056200     MOVE ML023-PC-FIN-LIAB-DTE        TO ML100-FIN-LIAB-DTE.     05790000
056300     MOVE ML023-PC-TRANS-CDE           TO ML100-TRN-TYP-CDE.      05800000
056400*CALCULATE THE MARKDOWN/MARKUP EXTENDED RETAIL AMOUNTS            05810000
056500     IF  ML023-PC-MARKDOWN                                        05820000
W26606*        COMPUTE PV-MKDN-RTL-AMT = (ML023-PC-QTY *                05830000
W26606*                  (ML023-PC-OLD-PR-AMT - ML023-PC-NEW-PR-AMT))   05840000
W26606*        MOVE PV-MKDN-RTL-AMT          TO ML100-MKDN-RTL-AMT      05850000
W26606         MOVE ML023-PC-EXTD-RTL-AMT    TO ML100-MKDN-RTL-AMT              
056900         MOVE ZEROES                   TO ML100-MKUP-RTL-AMT      05860000
057000     ELSE                                                         05870000
057100         IF ML023-PC-MARKUP                                       05880000
W26606*            COMPUTE PV-MKUP-RTL-AMT = (ML023-PC-QTY *            05890000
W26606*               (ML023-PC-NEW-PR-AMT - ML023-PC-OLD-PR-AMT))      05900000
W26606*            MOVE PV-MKUP-RTL-AMT          TO ML100-MKUP-RTL-AMT  05910000
W26606             MOVE ML023-PC-EXTD-RTL-AMT    TO ML100-MKUP-RTL-AMT  05910000
057500             MOVE ZEROES                   TO ML100-MKDN-RTL-AMT  05920000
057600         ELSE                                                     05930000
                   DISPLAY '** ABEND IN PROGRAM ' PC-PROGRAM-NAME       05931006
057700             DISPLAY                                              05940006
057700                  '** ERROR PROCESSING PRICE CHANGE EXTRACT FILE.'05940106
011900             DISPLAY '** TRAN CODE NOT VALID WITH FILE TYPE.'     05941006
057800             DISPLAY  ML023-PC-RECORD                             05950000
057900             MOVE +4008 TO ABEND-CODE                             05960000
058100             DISPLAY 'TRANS CODE : ', ML023-PC-TRANS-CDE          05980000
058200             PERFORM 9999-ABEND-ROUTINE                           05990000
058300         END-IF                                                   06000000
058400     END-IF.                                                      06010000
058500*                                                                 06020000
058600     MOVE ZEROES                       TO ML100-SLS-RTL-AMT       06030000
058700                                          ML100-XFER-IN-RTL-AMT   06040000
058800                                          ML100-XFER-OUT-RTL-AMT  06050000
058900                                          ML100-RCPT-RTL-AMT      06060000
059000                                          ML100-RCPT-FRGT-COST-AMT06070000
059100                                          ML100-RCPT-NET-COST-AMT 06080000
059200                                          ML100-PADJ-RTL-AMT      06090000
059300                                          ML100-PADJ-FRGT-COST-AMT06100000
059400                                          ML100-PADJ-NET-COST-AMT 06110000
059500                                          ML100-INV-ADJ-RTL-AMT.  06120000
059600*                                                                 06130000
0100RM* WR 20698 - PO TYPE CODE                                         06131013
0100RM     MOVE SPACES                     TO ML100-RCPT-PO-TYP-CDE.    06132013
053800*                                                                 06133013
059700     PERFORM 5000-WRITE-OUTPUT-RECORD.                            06140000
059800*                                                                 06150000
059900*                                                                 06160000
060000     IF  ML023-PC-MARKDOWN                                        06170000
060100         ADD +1 TO PA-MARKDOWN-COUNT-OUT                          06180000
060200                   PA-OUTPUT-COUNT-OUT                            06190000
060300     ELSE                                                         06200000
060400         ADD +1 TO PA-MARKON-COUNT-OUT                            06210000
060500                   PA-OUTPUT-COUNT-OUT                            06220000
060600     END-IF.                                                      06230000
060700*                                                                 06240000
060800     PERFORM 4200-READ-PRICE-CHANGE-FILE.                         06250000
060900*                                                                 06260000
061000*                                                                 06270000
061100******************************************************************06280000
061200* PROCESS THE INVENTORY ADJUSTMENT FILE                           06290000
061300******************************************************************06300000
061400 3300-PROCESS-ADJUSTMENT-FILE.                                    06310000
061500*                                                                 06320000
061600     ADD 1 TO PA-INPUT-COUNT-IN                                   06330000
061700              PA-ADJUST-COUNT-IN.                                 06340000
061800*                                                                 06350000
061900     IF ML024-ADJ-ADJUSTMENT                                      06360000
062000         CONTINUE                                                 06370000
062100     ELSE                                                         06380000
               DISPLAY '** ABEND IN PROGRAM ' PC-PROGRAM-NAME           06381006
062200         DISPLAY '** ERROR PROCESSING ADJUSTMENT EXTRACT FILE.'   06390006
011900         DISPLAY '** TRAN CODE NOT VALID WITH FILE TYPE.'         06391006
062300         DISPLAY  ML024-ADJ-RECORD                                06400000
062400         MOVE +4008 TO ABEND-CODE                                 06410000
062600         DISPLAY 'TRANS CODE : ', ML024-ADJ-TRANS-CDE             06430000
062700         PERFORM 9999-ABEND-ROUTINE                               06440000
062800     END-IF.                                                      06450000
062900*                                                                 06460000
063000*ML CONTROL VALUES                                                06470000
063100     MOVE MLCNTL-PSTG-FSCL-MN-NBR    TO ML100-FSCL-MN-NBR.        06480000
063200     MOVE MLCNTL-PSTG-FSCL-WK-NBR    TO ML100-FSCL-WK-NBR.        06490000
063300     MOVE MLCNTL-PSTG-FSCL-MN-DTE    TO ML100-FSCL-MN-END-DTE.    06500000
063400     MOVE MLCNTL-PSTG-FSCL-WK-DTE    TO ML100-FSCL-WK-END-DTE.    06510000
063500*                                                                 06520000
063600     MOVE ML024-ADJ-STORE-NBR          TO ML100-STR-NBR.          06530000
063700     MOVE ML024-ADJ-DEPT-NBR            TO ML100-DEPT-NBR.        06540000
063800     MOVE ML024-ADJ-CLASS-NBR           TO ML100-SUB-CL-NBR.      06550000
063900     MOVE ML024-ADJ-FIN-LIAB-DTE        TO ML100-FIN-LIAB-DTE.    06560000
064000     MOVE ML024-ADJ-TRANS-CDE           TO ML100-TRN-TYP-CDE.     06570000
064100     MOVE ML024-ADJ-AT-RTL-AMT          TO ML100-INV-ADJ-RTL-AMT. 06580000
064200*                                                                 06590000
064300     MOVE ZEROES                       TO ML100-SLS-RTL-AMT       06600000
064400                                          ML100-XFER-IN-RTL-AMT   06610000
064500                                          ML100-XFER-OUT-RTL-AMT  06620000
064600                                          ML100-RCPT-RTL-AMT      06630000
064700                                          ML100-RCPT-FRGT-COST-AMT06640000
064800                                          ML100-RCPT-NET-COST-AMT 06650000
064900                                          ML100-PADJ-RTL-AMT      06660000
065000                                          ML100-PADJ-FRGT-COST-AMT06670000
065100                                          ML100-PADJ-NET-COST-AMT 06680000
065200                                          ML100-MKDN-RTL-AMT      06690000
065300                                          ML100-MKUP-RTL-AMT.     06700000
065400*                                                                 06710000
0100RM* WR 20698 - PO TYPE CODE                                         06711013
0100RM     MOVE SPACES                     TO ML100-RCPT-PO-TYP-CDE.    06712013
053800*                                                                 06713013
065500     PERFORM 5000-WRITE-OUTPUT-RECORD.                            06720000
065600*                                                                 06730000
065700     ADD +1 TO PA-ADJUST-COUNT-OUT                                06740000
065800               PA-OUTPUT-COUNT-OUT.                               06750000
065900*                                                                 06760000
066000     PERFORM 4300-READ-ADJUSTMENT-FILE.                           06770000
066100*                                                                 06780000
066200*                                                                 06790000
066300******************************************************************06800000
066400* PROCESS THE SALES FILE                                          06810000
066500******************************************************************06820000
066600 3400-PROCESS-SALES-FILE.                                         06830000
066700*                                                                 06840000
066800     ADD 1 TO PA-INPUT-COUNT-IN                                   06850000
066900              PA-SALES-COUNT-IN.                                  06860000
067000*                                                                 06870000
067100     IF ML022-SALE                                                06880000
067200         CONTINUE                                                 06890000
067300     ELSE                                                         06900000
               DISPLAY '** ABEND IN PROGRAM ' PC-PROGRAM-NAME           06901006
067400         DISPLAY '** ERROR PROCESSING SALES EXTRACT FILE.'        06910006
011900         DISPLAY '** TRAN CODE NOT VALID WITH FILE TYPE.'         06911006
067500         DISPLAY  ML022-SALE-RECORD                               06920000
067600         MOVE +4008 TO ABEND-CODE                                 06930000
067800         DISPLAY 'TRANS CODE : ', ML022-SALE-TRANS-CDE            06950000
067900         PERFORM 9999-ABEND-ROUTINE                               06960000
068000     END-IF.                                                      06970000
068100*                                                                 06980000
068200     IF PS-FIRST-SALES-REC                                        06990000
068300         MOVE 'N' TO PS-SALE-FIRST-TIME-SW                        07000000
068400         MOVE ML022-SALE-FIN-LIAB-DTE TO SV-SALE-FIN-LIAB-DTE     07010000
068500         PERFORM 7000-GET-SALE-FSCL-WK-END-DTE                    07020000
068600     ELSE                                                         07030000
068700         IF ML022-SALE-FIN-LIAB-DTE NOT = SV-SALE-FIN-LIAB-DTE    07040000
068800             MOVE ML022-SALE-FIN-LIAB-DTE TO SV-SALE-FIN-LIAB-DTE 07050000
068900             PERFORM 7000-GET-SALE-FSCL-WK-END-DTE                07060000
069000         END-IF                                                   07070000
069100     END-IF.                                                      07080000
069200                                                                  07090000
069900     MOVE MLCNTL-PSTG-FSCL-MN-NBR    TO ML100-FSCL-MN-NBR.        07100300
070100     MOVE MLCNTL-PSTG-FSCL-MN-DTE    TO ML100-FSCL-MN-END-DTE.    07100400
                                                                        07100500
069300*    DETERMINE THE POSTING DATE FOR THE SALE.                     07100607
           IF CC-BACKPOST-SALES                                         07101007
069300*        THE CONTROL CARD INDICATES THAT SALES SHOULD BE BACK-    07102007
069300*        POSTED.  IF THE SALE OCCURRED DURING THE POSTING WEEK,   07102107
069300*        POST IT TO THE POSTING WEEK.  IF NOT, BACKPOST IT TO THE 07102207
069300*        PREVIOUS WEEK.                                           07103007
               IF DTATTR-FSCL-WK-END-DTE = MLCNTL-PSTG-FSCL-WK-DTE      07111007
                   MOVE MLCNTL-PSTG-FSCL-WK-NBR TO ML100-FSCL-WK-NBR    07113007
                   MOVE MLCNTL-PSTG-FSCL-WK-DTE TO ML100-FSCL-WK-END-DTE07115007
               ELSE                                                     07116007
                   MOVE PV-PFW-WK-NBR           TO ML100-FSCL-WK-NBR    07130007
                   MOVE DTATTR-PFW-END-DTE      TO ML100-FSCL-WK-END-DTE07150007
               END-IF                                                   07191007
           ELSE                                                         07192007
069300*        THE CONTROL CARD INDICATES THAT SALES SHOULD NOT BE      07192107
069300*        BACKPOSTED.  POST ALL SALES TO THE POSTING WEEK.         07192207
               MOVE MLCNTL-PSTG-FSCL-WK-NBR  TO ML100-FSCL-WK-NBR       07192507
               MOVE MLCNTL-PSTG-FSCL-WK-DTE  TO ML100-FSCL-WK-END-DTE   07192607
           END-IF.                                                      07193007
070300                                                                  07200000
070400     MOVE ML022-SALE-STORE-NBR         TO ML100-STR-NBR.          07210000
070500     MOVE ML022-SALE-DEPT-NBR          TO ML100-DEPT-NBR.         07220000
070600     MOVE ML022-SALE-CLASS-NBR         TO ML100-SUB-CL-NBR.       07230000
070700     MOVE ML022-SALE-FIN-LIAB-DTE      TO ML100-FIN-LIAB-DTE.     07240000
070800     MOVE ML022-SALE-TRANS-CDE         TO ML100-TRN-TYP-CDE.      07250000
070900     MOVE ML022-SALE-EXTD-RTL-AMT      TO ML100-SLS-RTL-AMT.      07260000
071000*                                                                 07270000
071100     MOVE ZEROES                       TO ML100-XFER-IN-RTL-AMT   07280000
071200                                          ML100-XFER-OUT-RTL-AMT  07290000
071300                                          ML100-RCPT-RTL-AMT      07300000
071400                                          ML100-RCPT-FRGT-COST-AMT07310000
071500                                          ML100-RCPT-NET-COST-AMT 07320000
071600                                          ML100-PADJ-RTL-AMT      07330000
071700                                          ML100-PADJ-FRGT-COST-AMT07340000
071800                                          ML100-PADJ-NET-COST-AMT 07350000
071900                                          ML100-INV-ADJ-RTL-AMT   07360000
072000                                          ML100-MKDN-RTL-AMT      07370000
072100                                          ML100-MKUP-RTL-AMT.     07380000
072200*                                                                 07390000
0100RM* WR 20698 - PO TYPE CODE                                         07391013
0100RM     MOVE SPACES                     TO ML100-RCPT-PO-TYP-CDE.    07392013
053800*                                                                 07393013
072300     PERFORM 5000-WRITE-OUTPUT-RECORD.                            07400000
                                                                        07410000
           IF DTATTR-FSCL-WK-END-DTE NOT = MLCNTL-PSTG-FSCL-WK-DTE      07420000
              PERFORM 5100-WRITE-BACK-POSTING-RECORD                    07430000
072600        ADD +1 TO PA-BACK-POST-COUNT-OUT.                         07440000
072400*                                                                 07450000
072500     ADD +1 TO PA-SALES-COUNT-OUT                                 07460000
072600               PA-OUTPUT-COUNT-OUT.                               07470000
072700*                                                                 07480000
072800     PERFORM 4400-READ-SALES-FILE.                                07490000
072900*                                                                 07500000
073000*                                                                 07510000
073100******************************************************************07520000
073200* READ THE DB2 CONTROL TABLE CONTAINING OPEN FISCAL DATE INFO     07530000
073300******************************************************************07540000
073400 4000-READ-CONTROL-TABLE.                                         07550000
073500*                                                                 07560000
073600      EXEC SQL                                                    07570000
073700          SELECT PSTG_FSCL_MN_DTE                                 07580000
073800                ,PSTG_FSCL_MN_NBR                                 07590000
073900                ,PSTG_FSCL_WK_DTE                                 07600000
074000                ,PSTG_FSCL_WK_NBR                                 07610000
074100           INTO  :MLCNTL-PSTG-FSCL-MN-DTE                         07620000
074200                ,:MLCNTL-PSTG-FSCL-MN-NBR                         07630000
074300                ,:MLCNTL-PSTG-FSCL-WK-DTE                         07640000
074400                ,:MLCNTL-PSTG-FSCL-WK-NBR                         07650000
074500           FROM  TMLCNTL                                          07660012
W26603          WITH UR                                                         
074600      END-EXEC.                                                   07670000
074700*                                                                 07680000
074800     EVALUATE SQLCODE                                             07690000
074900         WHEN 0                                                   07700000
075000             DISPLAY 'CTRL TABLE POSTING MONTH END DATE : ',      07710000
075100                                        MLCNTL-PSTG-FSCL-MN-DTE   07720000
075200             DISPLAY 'CTRL TABLE POSTING MONTH NUMBER   : ',      07730000
075300                                        MLCNTL-PSTG-FSCL-MN-NBR   07740000
075400             DISPLAY 'CTRL TABLE POSTING WEEK DATE      : '       07750000
075500                                        MLCNTL-PSTG-FSCL-WK-DTE   07760000
075600             DISPLAY 'CTRL TABLE POSTING WEEK NUMBER    : '       07770000
075700                                        MLCNTL-PSTG-FSCL-WK-NBR   07780000
075800         WHEN OTHER                                               07790000
075900            MOVE '4000-READ-CONTROL-TABLE' TO PV-PARAGRAPH-NAME   07800000
076000            MOVE 'SELECT FROM TMLCNTL'   TO PV-OPERATION-ATTEMPTED07810006
076100            PERFORM 9999-SQL-ABEND                                07820000
076200     END-EVALUATE.                                                07830000
                                                                        07840005
                                                                        07850005
076900 4050-READ-CONTROL-CARD-FILE.                                     07900005
                                                                        07901005
077000      READ CONTROL-CARD-FILE  INTO CC-CONTROL-CARD-REC            07910005
                AT END SET PS-END-OF-CONTROL-CARD-FILE TO TRUE.         07911005
                                                                        07920105
                                                                        07920205
076600******************************************************************07921005
076700* READ FILE CONTAINING PURCHASE AND TRANSFER TRANSACTIONS         07922005
076800******************************************************************07923005
076900 4100-READ-PURCHASE-FILE.                                         07924005
077000      READ PURCHASE-FILE  INTO ML021-PURCH-RECORD                 07925005
077100          AT END SET PS-NO-MORE-PURCHASES TO TRUE.                07926005
029600                                                                  03100000
077200*                                                                 07930000
077300*                                                                 07940000
077400******************************************************************07950000
077500* READ FILE CONTAINING MARKDOWN AND MARKUP TRANSACTIONS           07960000
077600******************************************************************07970000
077700 4200-READ-PRICE-CHANGE-FILE.                                     07980000
077800      READ PRICE-CHANGE-FILE  INTO ML023-PC-RECORD                07990000
077900          AT END SET PS-NO-MORE-PRICE-CHANGES TO TRUE.            08000000
078000*                                                                 08010000
078100*                                                                 08020000
078200******************************************************************08030000
078300* READ FILE CONTAINING INVENTORY ADJUSTMENT TRANSACTIONS          08040000
078400******************************************************************08050000
078500 4300-READ-ADJUSTMENT-FILE.                                       08060000
078600      READ ADJUSTMENT-FILE INTO ML024-ADJ-RECORD                  08070000
078700          AT END SET PS-NO-MORE-ADJUSTMENTS TO TRUE.              08080000
078800*                                                                 08090000
078900*                                                                 08100000
079000******************************************************************08110000
079100* READ SALES TRANSACTION FILE                                     08120000
079200******************************************************************08130000
079300 4400-READ-SALES-FILE.                                            08140000
079400      READ SALES-FILE INTO ML022-SALE-RECORD                      08150000
079500          AT END SET PS-NO-MORE-SALES TO TRUE.                    08160000
079600*                                                                 08170000
079700*                                                                 08180000
079800******************************************************************08190000
079900* CONTROL WRITING OF ALL RECORDS TO THE OUTPUT FILE               08200000
080000******************************************************************08210000
080100 5000-WRITE-OUTPUT-RECORD.                                        08220000
080200*                                                                 08230000
080300     WRITE OUTPUT-RECORD FROM ML100-UPDATE-REC.                   08240000
080400*                                                                 08250000
079800******************************************************************08260000
079900* CONTROL WRITING OF ALL RECORDS TO THE OUTPUT FILE               08270000
080000******************************************************************08280000
080100 5100-WRITE-BACK-POSTING-RECORD.                                  08290000
080200*                                                                 08300000
080300     WRITE BACK-POSTING-RECORD FROM ML022-SALE-RECORD.            08310000
080400*                                                                 08320000
080500******************************************************************08330000
080600* 7000-GET-SALE-FSCL-WK-END-DTE                                   08340000
080700*      GET THE FISCAL WEEK IN WHICH THE SALE OCCURRED.            08350000
080800******************************************************************08360000
080900 7000-GET-SALE-FSCL-WK-END-DTE.                                   08370000
081000                                                                  08380000
081100     EXEC SQL                                                     08390000
081500         SELECT  FSCL_WK_END_DTE                                  08430000
081900          INTO  :DTATTR-FSCL-WK-END-DTE                           08470000
082000          FROM TDTATTR                                            08480000
082100          WHERE KY_DTE = :SV-SALE-FIN-LIAB-DTE                    08490000
W26603          WITH UR                                                         
082200     END-EXEC.                                                    08500000
082300                                                                  08510000
082400     EVALUATE SQLCODE                                             08520000
082500         WHEN ZERO                                                08530000
082600             CONTINUE                                             08540000
082700         WHEN OTHER                                               08550000
082800            MOVE '7000-GET-SALE-FSCL-WK-END-DTE'                  08560000
082800                                         TO PV-PARAGRAPH-NAME     08561000
082900            MOVE PE-MSG-02               TO PV-OPERATION-ATTEMPTED08570000
083000            PERFORM 9999-SQL-ABEND                                08580000
083100     END-EVALUATE.                                                08590000
083200                                                                  08600000
083300                                                                  08610000
       7100-GET-PREV-FSCL-WK-DTE.                                       08611000
                                                                        08611100
081100     EXEC SQL                                                     08612000
081200         SELECT  PFW_END_DTE                                      08613000
081600          INTO  :DTATTR-PFW-END-DTE                               08617000
082000          FROM TDTATTR                                            08619200
082100          WHERE KY_DTE = :MLCNTL-PSTG-FSCL-WK-DTE                 08619300
W26603          WITH UR                                                         
082200     END-EXEC.                                                    08619500
082300                                                                  08619600
082400     EVALUATE SQLCODE                                             08619700
082500         WHEN ZERO                                                08619800
082600             CONTINUE                                             08619900
082700         WHEN OTHER                                               08620000
082800            MOVE '7100-GET-PREV-FSCL-WK-DTE'                      08620100
082800                                         TO PV-PARAGRAPH-NAME     08620300
082900            MOVE 'SELECT FROM TDTATTR'   TO PV-OPERATION-ATTEMPTED08620400
083000            PERFORM 9999-SQL-ABEND                                08620600
083100     END-EVALUATE.                                                08620700
                                                                        08620800
                                                                        08620900
       7200-GET-PREV-FSCL-WK-NBR.                                       08621000
                                                                        08621100
081100     EXEC SQL                                                     08621200
081200         SELECT  FSCL_WK_NBR                                      08621300
081600          INTO  :PV-PFW-WK-NBR                                    08621400
082000          FROM TDTATTR                                            08621500
082100          WHERE KY_DTE = :DTATTR-PFW-END-DTE                      08621600
W26603          WITH UR                                                         
082200     END-EXEC.                                                    08621700
082300                                                                  08621800
082400     EVALUATE SQLCODE                                             08621900
082500         WHEN ZERO                                                08622000
082600             CONTINUE                                             08622100
082700         WHEN OTHER                                               08622200
082800            MOVE '7200-GET-PREV-FSCL-WK-NBR'                      08622300
082800                                         TO PV-PARAGRAPH-NAME     08622400
082900            MOVE 'SELECT FROM TDTATTR'   TO PV-OPERATION-ATTEMPTED08622500
083000            PERFORM 9999-SQL-ABEND                                08622600
083100     END-EVALUATE.                                                08622700
                                                                        08622800
                                                                        08622900
083400******************************************************************08623000
083500* PROCESS FINAL COUNTS FOR INPUT AND OUTPUT COUNTS                08630000
083600******************************************************************08640000
083700*                                                                 08650000
083800 8000-EOJ-ROUTINE.                                                08660000
083900*                                                                 08670000
           CLOSE CONTROL-CARD-FILE.                                     08671005
                                                                        08672005
084000     DISPLAY '                                           '.       08680000
084100     DISPLAY 'TOTAL INPUT  RECORDS  = ', PA-INPUT-COUNT-IN.       08690000
084200     DISPLAY 'TOTAL OUTPUT RECORDS  = ', PA-OUTPUT-COUNT-OUT.     08700000
084300     DISPLAY '                                           '.       08710000
084400     DISPLAY '***** GOOD EOJ *****'.                              08720000
084500*                                                                 08730000
084600*                                                                 08740000
084700*                                                                 08750000
084800******************************************************************08760000
084900* COMMON ABEND MODULE                                             08770000
085000******************************************************************08780000
085100 9999-ABEND-ROUTINE.                                              08790000
085400         CALL 'ILBOABN0' USING ABEND-CODE.                        08820000
085500                                                                  08830000
085600******************************************************************08840000
085700*  STANDARD DB2 ERROR ABEND ROUTINE                               08850000
085800*  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             08860000
085900******************************************************************08870000
086000 9999-SQL-ABEND.                                                  08880000
086100                                                                  08890000
086200     MOVE +4013                 TO ABEND-CODE.                    08900000
086300     DISPLAY '**  ABEND     **'.                                  08910000
086400     DISPLAY '**  PROGRAM   ** => ' PC-PROGRAM-NAME.              08920000
086500     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            08930000
086600     DISPLAY '**  OPERATION **  = ' PV-OPERATION-ATTEMPTED.       08940000
086700                                                                  08950000
086800*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         08960000
086900*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        08970000
087000                                                                  08980000
087100     COPY DPPD004.                                                08990000
087200     CALL 'ILBOABN0'  USING ABEND-CODE.                           09000000
087300*                                                                 09010000
