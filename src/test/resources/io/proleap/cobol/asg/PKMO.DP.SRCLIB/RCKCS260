000100******************************************************************00010003
000200 IDENTIFICATION DIVISION.                                         00020003
000300******************************************************************00030003
000400                                                                  00040003
000500 PROGRAM-ID.                RCKCS260.                             00050003
000600 AUTHOR.                    WILLIAM B. BURT                       00060003
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070003
000800 DATE-WRITTEN.              08-29-94.                             00080003
000900 DATE-COMPILED.                                                   00090003
001000                                                                  00100003
001100******************************************************************00110003
001200*  CICS PROGRAM - RCKCS260 - E260                                *00120003
001300*                                                                *00130003
001400*       TICKET FORMAT SELECTION                                  *00140003
001500*                                                                *00150003
001600*       THIS PROGRAM ALLOWS THE ENTRY OF TICKET FORMAT           *00160003
001700*  INFORMATION.                                                  *00170003
001800*                                                                *00180003
001900*                                                                *00190003
002000*       DIRECT ENTRY INTO THIS TRANSACTION IS PROHIBITED.        *00200003
002100*  ATTEMPTING TO DO THIS RESULTS IN AN XCTL TO THE COMMON LOGON  *00210003
002200*  TRANSACTION FOR THIS SYSTEM, TO ACQUIRE THE SECURITY          *00220003
002300*  INFORMATION, AND POSITION THE USER INTO THE CORRECT MENU      *00230003
002400*  STRUCTURE FOR HIS/HER SECURITY LEVEL.                         *00240003
002500******************************************************************00250003
002600*  CHANGED 10/16/2014    BY COGNIZANT       WR: CHG0094517        00260003
002700*                                                                 00270003
002800* EXTENDED PO# FROM 7 TO 8 DIGITS WHERE NEEDED.                   00280003
002900*-----------------------------------------------------------------00290003
003000* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00300003
003100* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00310003
003200* MAKING THE CALL DYNAMIC VS STATIC.                              00320003
003300*---------------------------------------------------------------* 00330003
003400                                                                  00340003
003500******************************************************************00350003
003600 ENVIRONMENT DIVISION.                                            00360003
003700******************************************************************00370003
003800                                                                  00380003
003900******************************************************************00390003
004000 DATA DIVISION.                                                   00400003
004100******************************************************************00410003
004200                                                                  00420003
004300 WORKING-STORAGE SECTION.                                         00430003
004400                                                                  00440003
004500*                                                                 00450003
004600*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 00460003
004700*                                                                 00470003
004800                                                                  00480003
004900     COPY DPWS010I.                                               00490003
005000                                                                  00500003
005100******************************************************************00510003
005200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00520003
005300     COPY DPWS013.                                                00530003
005400*                                                                 00540003
005500******************************************************************00550003
005600*  CICS ATTRIBUTES COPYBOOK                                       00560003
005700     COPY DPWS015.                                                00570003
005800*                                                                 00580003
005900******************************************************************00590003
006000*  FUNCTION KEYS COPYBOOK                                         00600003
006100     COPY DPWS016.                                                00610003
006200*                                                                 00620003
006300******************************************************************00630003
006400*  STANDARD ATTENTION IDENTIFIER LIST                             00640003
006500*                                                                 00650003
006600                                                                  00660003
006700     COPY DFHAID.                                                 00670003
006800                                                                  00680003
006900*                                                                 00690003
007000*  STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST          00700003
007100*                                                                 00710003
007200     COPY DFHBMSCA.                                               00720003
007300                                                                  00730003
007400*                                                                 00740003
007500*  DSECT FOR THE RCKM260 MAPSET                                   00750003
007600*                                                                 00760003
007700     COPY RCKM260.                                                00770003
007800                                                                  00780003
007900 01  DK-DB2-KEYS.                                                 00790003
008000     05  DK-PO-NBR                      PIC S9(09)  COMP VALUE +0.00800003
008100                                                                  00810003
008200 01  PS-PROGRAM-SWITCHES.                                         00820003
008300     05  PS-EDIT-ERROR-IND       PIC X(1)     VALUE 'N'.          00830003
008400         88  PS-NO-EDIT-ERROR                 VALUE 'N'.          00840003
008500         88  PS-EDIT-ERROR                    VALUE 'Y'.          00850003
008600                                                                  00860003
008700 01  PC-PROGRAM-CONSTANTS.                                        00870003
008800     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'RCKCS260'.   00880003
008900     05  PC-CURRENT-MAPSET-NAME  PIC X(08)    VALUE 'RCKM260'.    00890003
009000     05  PC-CURRENT-MAP-NAME     PIC X(08)    VALUE 'RC260A'.     00900003
009200     05  PC-EOF-KEYED-COMP       PIC S9(4)    VALUE +128          00920003
009300                                 COMP SYNC.                       00930003
009400     05  FILLER                  REDEFINES PC-EOF-KEYED-COMP.     00940003
009500         10  FILLER              PIC X(1).                        00950003
009600         10  PC-EOF-KEYED        PIC X(1).                        00960003
009700     05  PC-CLEAR                PIC X(03)    VALUE 'CLR'.        00970003
009800     05  PC-MAX-RETRIES          PIC S9(4)    VALUE +3            00980003
009900                                                COMP SYNC.        00990003
010000     05  PC-ACTIVE                    PIC X(01) VALUE 'A'.        01000003
010100     05  PC-A                         PIC X(01) VALUE 'A'.        01010003
010200     05  PC-ACT                       PIC X(03) VALUE 'ACT'.      01020003
010300     05  PC-P                         PIC X(01) VALUE 'P'.        01030003
010400     05  PC-1                         PIC S9(03) VALUE 1          01040003
010500                                                     COMP-3.      01050003
010600     05  PC-INTER-APPL-CODES.                                     01060003
010700         10  PC-INTER-APPL-CRIT-SPEC    PIC  X(04)  VALUE '1'.    01070003
010800         10  PC-INTER-APPL-WO-REC-LIST  PIC  X(04)  VALUE '2'.    01080003
010900                                                                  01090003
011000 01  PC-TSYMSG-AREA.                                              01100003
011100*  INVALID ENTRY 00005                                            01110003
011200     05  PC-TSYMSG-00005      PIC 9(5) VALUE 00005.               01120003
011300*  REQUIRED ENTRY 00007                                           01130003
011400     05  PC-TSYMSG-00007      PIC 9(5) VALUE 00007.               01140003
011500*  MUST BE NUMBERIC                                               01150003
011600     05  PC-TSYMSG-00008      PIC 9(5) VALUE 00008.               01160003
011700*  PURCHASE ORDER DOES NOT EXIST 00083                            01170003
011800     05  PC-TSYMSG-00083      PIC 9(5) VALUE 00083.               01180003
011900                                                                  01190003
012000 01  PV-PROGRAM-VARIABLES.                                        01200003
012100     05  PV-SQL-SUB              PIC S9(04)   COMP VALUE +0.      01210003
012200     05  PV-TRANSFER-PROGRAM     PIC X(8)     VALUE SPACES.       01220003
012300     05  PV-LEAVE-SYSTEM-MESSAGE PIC X(400)   VALUE SPACES.       01230003
012400     05  PV-CICS-RESPONSE        PIC S9(9)    VALUE ZERO          01240003
012500                                 COMP SYNC.                       01250003
012600     05  PV-RETRY-COUNT          PIC S9(4)    VALUE ZERO          01260003
012700                                 COMP SYNC.                       01270003
012800     05  PV-CURRENT-YEAR         PIC S9(9)    VALUE ZERO          01280003
012900                                 COMP SYNC.                       01290003
013000     05  PV-KEY-FEEDBACK-AREA    PIC X(11)    VALUE SPACES.       01300003
013100     05  PV-MESSAGE-NBR          PIC 9(05)    VALUE ZEROES.       01310003
013200     05  PV-DEPT-NMBR            PIC X(03)    VALUE SPACES.       01320003
013300     05  PV-DP020-NAV-KEY-DATA   PIC X(25)    VALUE SPACES.       01330003
013400     05  PV-DP020-INT-APPL-FORMAT-IND                             01340003
013500                                 PIC X(1)     VALUE SPACES.       01350003
013600     05  PV-RETRY-COUNTER        PIC S9(4)    VALUE ZERO          01360003
013700                                                COMP SYNC.        01370003
013800     05  PV-SELECT-COUNTER            PIC S9(04)  VALUE ZERO      01380003
013900                                                COMP SYNC.        01390003
014000     05  PV-DISPLAY-KEYS.                                         01400003
014100         10  PV-DISPLAY-ORD-NBR          PIC  9(09)  VALUE ZEROS  01410003
014200                                                BLANK WHEN ZEROS. 01420003
014300         10  FILLER                      PIC  X(02)  VALUE SPACE. 01430003
014400         10  PV-DISPLAY-RCVR-SEQ-NBR     PIC  9(09)  VALUE ZEROS  01440003
014500                                                BLANK WHEN ZEROS. 01450003
014600         10  FILLER                      PIC  X(02)  VALUE SPACE. 01460003
014700         10  PV-DISPLAY-ORD-LNE-NBR      PIC  9(04)  VALUE ZEROS  01470003
014800                                                BLANK WHEN ZEROS. 01480003
014900         10  FILLER                      PIC  X(02)  VALUE SPACE. 01490003
015000         10  PV-DISPLAY-WORK-ORD-SEQ-NBR PIC  9(04)  VALUE ZEROS  01500003
015100                                                BLANK WHEN ZEROS. 01510003
015200         10  FILLER                      PIC  X(02)  VALUE SPACE. 01520003
015300         10  PV-DISPLAY-OPER-UNT-ID      PIC  9(04)  VALUE ZEROS  01530003
015400                                                BLANK WHEN ZEROS. 01540003
015500         10  FILLER                      PIC  X(02)  VALUE SPACE. 01550003
015600         10  PV-DISPLAY-FCLTY-ID         PIC  9(04)  VALUE ZEROS  01560003
015700                                                BLANK WHEN ZEROS. 01570003
015800                                                                  01580003
015900 01  RF-ROLLBACK-FAILURE-MESSAGE.                                 01590003
016000     05  FILLER                  PIC X(5)     VALUE SPACES.       01600003
016100     05  FILLER                  PIC X(61)    VALUE               01610003
016200     '**  THE ATTEMPTED ROLLBACK FAILED  **'.                     01620003
016300     05  FILLER                  PIC X(10)    VALUE 'EIBRESP = '. 01630003
016400     05  RF-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.         01640003
016500                                                                  01650003
016600 01  IC-ISO-CURRENT-DATE-AREA.                                    01660003
016700     05  IC-ISO-CURRENT-DATE-X.                                   01670003
016800         10  IC-CURRENT-YEAR     PIC 9(4)     VALUE ZERO.         01680003
016900         10  FILLER              PIC X(6)     VALUE SPACES.       01690003
017000     05  FILLER                  REDEFINES IC-ISO-CURRENT-DATE-X. 01700003
017100         10  FILLER              PIC X(2).                        01710003
017200         10  IC-CURRENT-YY-MM-DD PIC X(8).                        01720003
017300     05  IC-ISO-CURRENT-DATE     REDEFINES IC-ISO-CURRENT-DATE-X  01730003
017400                                 PIC X(10).                       01740003
017500                                                                  01750003
017600 01  SE-SYSTEM-ERROR-MESSAGE.                                     01760003
017700     05  FILLER                  PIC X(51)    VALUE               01770003
017800         'A SYSTEM ERROR HAS OCCURRED - CONTACT DP - PROGRAM '.   01780003
017900     05  SE-CURRENT-PROGRAM-NAME PIC X(8)     VALUE SPACES.       01790003
018000     05  FILLER                  PIC X(7)     VALUE SPACES.       01800003
018100     05  FILLER                  PIC X(10)    VALUE 'EIBRESP = '. 01810003
018200     05  SE-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.         01820003
018300     05  FILLER                  PIC X(5)     VALUE SPACES.       01830003
018400     05  FILLER                  PIC X(14)    VALUE               01840003
018500         'ATTEMPTING TO '.                                        01850003
018600     05  SE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       01860003
018700                                                                  01870003
018800 01  DRU-DB2-RESOURCE-UNAVAIL-MSG.                                01880003
018900     05  FILLER                  PIC X(85)    VALUE               01890003
019000         'A RESOURCE WAS NOT AVAILABLE.  PLEASE TRY AGAIN.'.      01900003
019100     05  FILLER                  PIC X(45)    VALUE               01910003
019200         'IF THE PROBLEM PERSISTS, CONTACT DP (PROGRAM '.         01920003
019300     05  DRU-CURRENT-PROGRAM-NAME                                 01930003
019400                                 PIC X(8)     VALUE SPACES.       01940003
019500     05  FILLER                  PIC X(22)    VALUE ').'.         01950003
019600                                                                  01960003
019700 01  DE-DB2-ERROR-MESSAGE.                                        01970003
019800     05  FILLER                  PIC X(48)    VALUE               01980003
019900         'A DB2 ERROR HAS OCCURRED - CONTACT DP - PROGRAM '.      01990003
020000     05  DE-CURRENT-PROGRAM-NAME PIC X(8)     VALUE SPACES.       02000003
020100     05  FILLER                  PIC X(29)    VALUE SPACES.       02010003
020200     05  FILLER                  PIC X(11)    VALUE               02020003
020300         'SQLCODE = ('.                                           02030003
020400     05  DE-SQLCODE              PIC Z(8)9-   VALUE ZERO.         02040003
020500     05  FILLER                  PIC X(21)    VALUE               02050003
020600         ')  ROWS PROCESSED = ('.                                 02060003
020700     05  DE-ROWS-PROCESSED       PIC Z(8)9-   VALUE ZERO.         02070003
020800     05  FILLER                  PIC X(23)    VALUE ')'.          02080003
020900     05  FILLER                  PIC X(5)     VALUE SPACES.       02090003
021000     05  FILLER                  PIC X(14)    VALUE               02100003
021100         'ATTEMPTING TO '.                                        02110003
021200     05  DE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       02120003
021300                                                                  02130003
021400 01  DW-DB2-WARNING-MESSAGE.                                      02140003
021500     05  FILLER                  PIC X(50)    VALUE               02150003
021600         'A DB2 WARNING HAS OCCURRED - CONTACT DP - PROGRAM '.    02160003
021700     05  DW-CURRENT-PROGRAM-NAME PIC X(8)     VALUE SPACES.       02170003
021800     05  FILLER                  PIC X(27)    VALUE SPACES.       02180003
021900     05  FILLER                  PIC X(11)    VALUE               02190003
022000         'SQLCODE = ('.                                           02200003
022100     05  DW-SQLCODE              PIC Z(8)9-   VALUE ZERO.         02210003
022200     05  FILLER                  PIC X(21)    VALUE               02220003
022300         ')  ROWS PROCESSED = ('.                                 02230003
022400     05  DW-ROWS-PROCESSED       PIC Z(8)9-   VALUE ZERO.         02240003
022500     05  FILLER                  PIC X(14)    VALUE               02250003
022600         ')  SQLWARN = ('.                                        02260003
022700     05  DW-SQLWARN              PIC X(8)     VALUE SPACES.       02270003
022800     05  FILLER                  PIC X(1)     VALUE ')'.          02280003
022900     05  FILLER                  PIC X(5)     VALUE SPACES.       02290003
023000     05  FILLER                  PIC X(14)    VALUE               02300003
023100         'ATTEMPTING TO '.                                        02310003
023200     05  DW-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       02320003
023300                                                                  02330003
023400 01  ST-SYSTEM-TIME-AREA.                                         02340003
023500     05  ST-ABSTIME              PIC S9(18)   VALUE ZERO          02350003
023600                                 COMP SYNC.                       02360003
023700     05  ST-TIME-EDIT.                                            02370003
023800         10  ST-TIME-HHMM        PIC X(5)     VALUE SPACES.       02380003
023900         10  FILLER              PIC X(3)     VALUE SPACES.       02390003
024000                                                                  02400003
024100******************************************************************02410003
024200*    STANDARD COMMAREA DEFINITION                                 02420003
024300******************************************************************02430003
024310                                                                  02431004
024320******************************************************************02432004
024330** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **02433004
024340** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **02434004
024350******************************************************************02435004
024400     COPY DPWS030.                                                02440003
024401     COPY DPWS930.                                                02440104
024410                                                                  02441004
024500     COPY DPWS020.                                                02450003
024600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02460003
024700                                                                  02470003
024800*----------------------------------------------------------------*02480003
024900* INTER-APPLICATION COMMAREA.                                    *02490003
025000*----------------------------------------------------------------*02500003
025100                                                                  02510003
025200         10  INTER-APPL-COMM-AREA       PIC X(200).               02520003
025300     COPY PCWS000.                                                02530003
025400*-------------------------------------------------------------*   02540003
025500*    INTER-APPLICATION COMMAREA                               *   02550003
025600*-------------------------------------------------------------*   02560003
025700         10  ASC-PGM-SPECIFIC-COMMAREA.                           02570003
025800             15  ASC-OPER-UNT-ID           PIC X(04).             02580003
025900             15  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID      02590003
026000                                           PIC 9(04).             02600003
026100             15  ASC-FCLTY-ID              PIC X(04).             02610003
026200             15  ASC-FCLTY-ID-N    REDEFINES ASC-FCLTY-ID         02620003
026300                                           PIC 9(04).             02630003
026400             15  ASC-FCLTY-NME             PIC X(24).             02640003
026500             15  ASC-PO-NBR                PIC X(08).             02650003
026600             15  ASC-PO-NBR-N  REDEFINES  ASC-PO-NBR              02660003
026700                                           PIC 9(08).             02670003
026800             15  ASC-SEQ-NBR               PIC X(03).             02680003
026900             15  ASC-SEQ-NBR-N  REDEFINES  ASC-SEQ-NBR            02690003
027000                                           PIC 9(03).             02700003
027100             15  ASC-LINE-NBR-X            PIC X(04).             02710003
027200             15  ASC-LINE-NBR-N  REDEFINES  ASC-LINE-NBR-X        02720003
027300                                           PIC 9(04).             02730003
027400             15  ASC-TKT-FORMAT            PIC X(06).             02740003
027500             15  ASC-SAVE-TKT-FORMAT       PIC X(06).             02750003
027600             15  ASC-INTER-APPL-FORMAT-IND PIC X(01).             02760003
027700             15  ASC-HOLD-INTER-APPL       PIC X(200).            02770003
027800                                                                  02780003
027900******************************************************************02790003
028000                                                                  02800003
028100*                                                                 02810003
028200*    DB2 DCLGEN FOR PURCHASE ORDER TABLE                          02820003
028300*                                                                 02830003
028400     EXEC SQL                                                     02840003
028500          INCLUDE TPURCHS                                         02850003
028600     END-EXEC.                                                    02860003
028700                                                                  02870003
028800*                                                                 02880003
028900*    DB2 DCLGEN FOR STATUS CODE TABLE                             02890003
029000*                                                                 02900003
029100     EXEC SQL                                                     02910003
029200          INCLUDE TSTATCD                                         02920003
029300     END-EXEC.                                                    02930003
029400                                                                  02940003
029500*                                                                 02950003
029600*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                02960003
029700*                                                                 02970003
029800     EXEC SQL                                                     02980003
029900         INCLUDE SQLCA                                            02990003
030000     END-EXEC.                                                    03000003
030100                                                                  03010003
030200******************************************************************03020003
030300 LINKAGE SECTION.                                                 03030003
030400******************************************************************03040003
030500 01  DFHCOMMAREA.                                                 03050003
030600     05  FILLER                       OCCURS 1 TO 4072 TIMES      03060003
030700                                      DEPENDING ON EIBCALEN.      03070003
030800         10  FILLER                   PIC X.                      03080003
030900******************************************************************03090003
031000 PROCEDURE DIVISION.                                              03100003
031100******************************************************************03110003
031200                                                                  03120003
031300 0000-MAIN-MODULE.                                                03130003
031400     INITIALIZE DP030-CICS-API-FIELDS.                            03140003
031500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03150003
031600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03160003
031700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03170003
031800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03180003
031900     MOVE LENGTH OF RC260AI        TO DP030-MAP-LENGTH (1).       03190003
032000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03200003
032100     PERFORM 0001-CALL-CICS-ARCH-API.                             03210003
032200*                                                                 03220003
032300     PERFORM 1000-CONTROL-PROCESSING                              03230003
032400*                                                                 03240003
032500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03250003
032600     PERFORM 0001-CALL-CICS-ARCH-API.                             03260003
032700                                                                  03270003
032800 0001-CALL-CICS-ARCH-API.                                         03280003
032910     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03291004
033000                                    DFHCOMMAREA                   03300004
033100                                    DP030-CICS-API-FIELDS         03310004
033200                                    DP020-STANDARD-COMMAREA       03320004
033300                                    RC260AI.                      03330004
033400*                                                                 03340003
033500     IF  DP030-RC-CALL-SUCCESSFUL                                 03350003
033600         CONTINUE                                                 03360003
033700     ELSE                                                         03370003
033800         SET DP013-NO-ROLLBACK                                    03380003
033900             DP013-XCTL-DISPLAY-RESTART                           03390003
034000             DP013-CICS-ABEND      TO TRUE                        03400003
034100         MOVE 'BEFORE 0000-MAIN-MODULE'                           03410003
034200                                   TO DP013-PARAGRAPH             03420003
034220         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O03422004
034230-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03423004
034500         MOVE DP030-RETURN-CODE                                   03450003
034600                                   TO DP013-MESSAGE-TEXT (3)      03460003
034700         PERFORM DP013-0000-PROCESS-ABEND                         03470003
034800     END-IF.                                                      03480003
034900/                                                                 03490003
035000*----------------------------------------------------------------*03500003
035100*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03510003
035200*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03520003
035300*----------------------------------------------------------------*03530003
035400                                                                  03540003
035500 1000-CONTROL-PROCESSING.                                         03550003
035600                                                                  03560003
035700     EVALUATE TRUE                                                03570003
035800         WHEN DP020-NEXT-ACT-INITIAL                              03580003
035900             INITIALIZE ASC-PGM-SPECIFIC-COMMAREA                 03590003
036000             MOVE INTER-APPL-COMM-AREA  TO ASC-HOLD-INTER-APPL    03600003
036100         WHEN OTHER                                               03610003
036200             MOVE ASC-HOLD-INTER-APPL   TO INTER-APPL-COMM-AREA   03620003
036300     END-EVALUATE.                                                03630003
036400                                                                  03640003
036500     EVALUATE TRUE                                                03650003
036600         WHEN DP020-NEXT-ACT-INITIAL                              03660003
036700             MOVE DP020-INT-APPL-FORMAT-IND                       03670003
036800                                 TO ASC-INTER-APPL-FORMAT-IND     03680003
036900             PERFORM 3200-RESET-ATTRIBUTES                        03690003
037000             PERFORM 4000-BUILD-INITIAL-PANEL                     03700003
037100                                                                  03710003
037200         WHEN DP020-NEXT-ACT-READ-MAP                             03720003
037300             PERFORM 2000-FKEY-PROCESSING                         03730003
037400                                                                  03740003
037500         WHEN DP020-NEXT-ACT-RETURN                               03750003
037600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03760003
037700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03770003
037800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  03780003
037900             MOVE -1      TO APONBRL                              03790003
038000                                                                  03800003
038100         WHEN OTHER                                               03810003
038200             SET DP013-LOGIC-ABEND                                03820003
038300                 DP013-NO-ROLLBACK TO TRUE                        03830003
038400             MOVE '1000-CONTROL-PROCESSING'                       03840003
038500                                   TO  DP013-PARAGRAPH            03850003
038600             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03860003
038700                                   TO  DP013-MESSAGE-TEXT(1)      03870003
038800             MOVE DP020-NEXT-APPL-ACTIVITY                        03880003
038900                                   TO DP013-MESSAGE-TEXT(2)       03890003
039000             PERFORM DP013-0000-PROCESS-ABEND                     03900003
039100     END-EVALUATE.                                                03910003
039200                                                                  03920003
039300*----------------------------------------------------------------*03930003
039400* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*03940003
039500* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*03950003
039600* EDITS.                                                         *03960003
039700*----------------------------------------------------------------*03970003
039800                                                                  03980003
039900 2000-FKEY-PROCESSING.                                            03990003
040000                                                                  04000003
040100     EVALUATE TRUE                                                04010003
040200                                                                  04020003
040300         WHEN DP020-SRC-AID = DP016-CLEAR                         04030003
040400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04040003
040500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04050003
040600                                                                  04060003
040700         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04070003
040800             PERFORM 4000-BUILD-INITIAL-PANEL                     04080003
040900             PERFORM 3200-RESET-ATTRIBUTES                        04090003
041000                                                                  04100003
041100         WHEN OTHER                                               04110003
041200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04120003
041300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04130003
041400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04140003
041500             IF  PS-NO-EDIT-ERROR                                 04150003
041600                 SET DP030-CONTINUE-GO TO TRUE                    04160003
041700                 MOVE '3' TO DP020-INT-APPL-FORMAT-IND            04170003
041800                 MOVE -1      TO APONBRL                          04180003
041900*                PERFORM 2100-CHECK-FUNCTION-KEY                  04190003
042000             ELSE                                                 04200003
042100                 SET DP030-OVERRIDE-GO TO TRUE                    04210003
042200             END-IF                                               04220003
042300     END-EVALUATE.                                                04230003
042400******************************************************************04240003
042500* BAB - PERFORM THIS PARAGRAPH AFTER ALL THE EDITS HAVE           04250003
042600*       BEEN MADE AND THEN CHECK THE INT-APPL-FORMAT-IND          04260003
042700*       TO SEE WHAT PF KEY HAS BEEN SELECTED.                     04270003
042800*                                                                 04280003
042900*                                                                 04290003
043000** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **04300003
043100** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **04310003
043200** FROM THE CICS ARCHITECTURE API.                              **04320003
043300******************************************************************04330003
043400 2100-CHECK-FUNCTION-KEY.                                         04340003
043500     EVALUATE TRUE                                                04350003
043600         WHEN DP020-SRC-AID = DP016-ENTER                         04360003
043700         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 04370003
043800             MOVE -1  TO  APONBRL                                 04380003
043900         WHEN OTHER                                               04390003
044000             SET DP013-NO-ROLLBACK                                04400003
044100                 DP013-XCTL-DISPLAY-RESTART                       04410003
044200                 DP013-CICS-ABEND  TO TRUE                        04420003
044300             MOVE '2100-CHECK-FUNCTION-KEY'                       04430003
044400                                   TO DP013-PARAGRAPH             04440003
044500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04450003
044600                                   TO DP013-MESSAGE-TEXT (1)      04460003
044700             PERFORM DP013-0000-PROCESS-ABEND                     04470003
044800     END-EVALUATE.                                                04480003
044900/                                                                 04490003
045000*----------------------------------------------------------------*04500003
045100* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*04510003
045200* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *04520003
045300* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *04530003
045400*----------------------------------------------------------------*04540003
045500                                                                  04550003
045600 2200-MOVE-SCREEN-TO-COMMAREA.                                    04560003
045700     IF  APONBRL > ZERO                                           04570003
045800         MOVE APONBRI              TO ASC-PO-NBR                  04580003
045900     ELSE                                                         04590003
046000         IF  APONBRF = DP015-ERASE-EOF                            04600003
046100             MOVE SPACE            TO ASC-PO-NBR                  04610003
046200         END-IF                                                   04620003
046300     END-IF.                                                      04630003
046400/                                                                 04640003
046500*----------------------------------------------------------------*04650003
046600* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *04660003
046700* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *04670003
046800* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*04680003
046900* IN THE DESTINATION PROGRAM, NOT HERE.                          *04690003
047000*----------------------------------------------------------------*04700003
047100                                                                  04710003
047200 3000-EDIT-DATA-IN-COMMAREA.                                      04720003
047300                                                                  04730003
047400     PERFORM 3200-RESET-ATTRIBUTES.                               04740003
047500                                                                  04750003
047600     IF  ASC-PO-NBR       > SPACE                                 04760003
047700         MOVE ASC-PO-NBR           TO DP010I-UNEDITED-FIELD       04770003
047800         MOVE LENGTH OF ASC-PO-NBR TO DP010I-MAXIMUM-DIGITS       04780003
047900         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     04790003
048000         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  04800003
048100         CALL DP010I-NUMERIC-EDIT-ROUTINE                         04810003
048200              USING DP010I-NUMERIC-EDIT-AREA                      04820003
048300         IF  DP010I-ERROR-DETECTED                                04830003
048400             SET PS-EDIT-ERROR                                    04840003
048500                 DP020-MSG-FATAL   TO TRUE                        04850003
048600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            04860003
048700             MOVE DP015-UNP-ALP-BRT-OFF                           04870003
048800                                   TO APONBRA                     04880003
048900             MOVE DP015-RED        TO APONBRC                     04890003
049000             MOVE DP015-REVERSE    TO APONBRH                     04900003
049100             MOVE -1               TO APONBRL                     04910003
049200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04920003
049300         ELSE                                                     04930003
049400             MOVE DP010I-NUMERIC-FIELD                            04940003
049500                                   TO ASC-PO-NBR-N                04950003
049600                                      DK-PO-NBR                   04960003
049700             PERFORM 3300-VALIDATE-PO                             04970003
049800             IF  PS-EDIT-ERROR                                    04980003
049900                 SET DP020-MSG-FATAL   TO TRUE                    04990003
050000                 MOVE PC-TSYMSG-00083  TO DP020-MSG-NUMBER        05000003
050100                 MOVE DP015-UNP-ALP-BRT-OFF                       05010003
050200                                       TO APONBRA                 05020003
050300                 MOVE DP015-RED        TO APONBRC                 05030003
050400                 MOVE DP015-REVERSE    TO APONBRH                 05040003
050500                 MOVE -1               TO APONBRL                 05050003
050600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              05060003
050700             END-IF                                               05070003
050800         END-IF                                                   05080003
050900     ELSE                                                         05090003
051000         SET PS-EDIT-ERROR                                        05100003
051100             DP020-MSG-FATAL   TO TRUE                            05110003
051200         MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER                05120003
051300         MOVE DP015-UNP-ALP-BRT-OFF                               05130003
051400                               TO APONBRA                         05140003
051500         MOVE DP015-RED        TO APONBRC                         05150003
051600         MOVE DP015-REVERSE    TO APONBRH                         05160003
051700         MOVE -1               TO APONBRL                         05170003
051800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      05180003
051900     END-IF.                                                      05190003
052000                                                                  05200003
052100     IF  PS-NO-EDIT-ERROR                                         05210003
052200         MOVE -1                     TO APONBRL                   05220003
052300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      05230003
052400     END-IF.                                                      05240003
052500/                                                                 05250003
052600******************************************************************05260003
052700** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **05270003
052800** MAP.                                                         **05280003
052900******************************************************************05290003
053000 3200-RESET-ATTRIBUTES.                                           05300003
053100     MOVE DP015-UNP-ALP-NOR-OFF  TO  APONBRA.                     05310003
053200     MOVE DP015-GREEN            TO  APONBRC.                     05320003
053300     MOVE DP015-UNDERLINE        TO  APONBRH.                     05330003
053400*                                                                 05340003
053500 3300-VALIDATE-PO.                                                05350003
053600                                                                  05360003
053700     PERFORM                                                      05370003
053800         WITH TEST AFTER                                          05380003
053900         VARYING PV-SQL-SUB                                       05390003
054000         FROM 1 BY 1                                              05400003
054100         UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                      05410003
054200            OR   SQLCODE = +0                                     05420003
054300            OR   SQLCODE = +100)                                  05430003
054400                                                                  05440003
054500         EXEC SQL                                                 05450003
054600            SELECT  PO_NBR                                        05460003
054700              INTO :PURCHS-PO-NBR                                 05470003
054800              FROM  TPURCHS                                       05480003
054900             WHERE  (PO_NBR          = :DK-PO-NBR                 05490003
055000               AND   VER_STATUS_CDE  =  'A')                      05500003
055100         END-EXEC                                                 05510003
055200                                                                  05520003
055300         EVALUATE TRUE                                            05530003
055400             WHEN SQLCODE = -904                                  05540003
055500             WHEN SQLCODE = -913                                  05550003
055600                 CONTINUE                                         05560003
055700             WHEN SQLCODE = +100                                  05570003
055800                 SET PS-EDIT-ERROR TO TRUE                        05580003
055900             WHEN SQLCODE = +0                                    05590003
056000                 CONTINUE                                         05600003
056100             WHEN SQLCODE < +0                                    05610003
056200             WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))     05620003
056300             WHEN SQLWARN0 NOT = SPACES                           05630003
056400                  MOVE '3300-VALIDATE-PO'                         05640003
056500                                   TO DP013-PARAGRAPH             05650003
056600                  MOVE 'SELECT PO'                                05660003
056700                                   TO DP013-MESSAGE-TEXT (1)      05670003
056800                  MOVE SQLCA       TO DP013-SQLCA                 05680003
056900                  SET DP013-DB2-ABEND                             05690003
057000                                   TO TRUE                        05700003
057100                  PERFORM DP013-0000-PROCESS-ABEND                05710003
057200         END-EVALUATE                                             05720003
057300     END-PERFORM.                                                 05730003
057400                                                                  05740003
057500     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   05750003
057600         MOVE '3300-VALIDATE-PO'                                  05760003
057700                               TO  DP013-PARAGRAPH                05770003
057800         MOVE 'SELECT PO '     TO  DP013-MESSAGE-TEXT (1)         05780003
057900         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   05790003
058000                               TO  DP013-MESSAGE-TEXT (2)         05800003
058100         MOVE SQLCA            TO  DP013-SQLCA                    05810003
058200         SET DP013-DB2-ABEND   TO  TRUE                           05820003
058300         PERFORM DP013-0000-PROCESS-ABEND                         05830003
058400     END-IF.                                                      05840003
058500/                                                                 05850003
058600*----------------------------------------------------------------*05860003
058700*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *05870003
058800*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *05880003
058900*  IT HERE.                                                      *05890003
059000*----------------------------------------------------------------*05900003
059100 4000-BUILD-INITIAL-PANEL.                                        05910003
059200                                                                  05920003
059300     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        05930003
059400     MOVE -1                       TO APONBRL.                    05940003
059500                                                                  05950003
059600     MOVE ASC-PO-NBR-N             TO APONBRO                     05960003
059700                                      DK-PO-NBR.                  05970003
059800/                                                                 05980003
059900*----------------------------------------------------------------*05990003
060000*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *06000003
060100*----------------------------------------------------------------*06010003
060200 4400-MOVE-COMMAREA-TO-SCREEN.                                    06020003
060300     MOVE ASC-PO-NBR-N           TO APONBRO                       06030003
060400                                    PC000-PO-NBR-N.               06040003
060500     MOVE ASC-INTER-APPL-FORMAT-IND                               06050003
060600                                 TO PC000-INTER-APPL-FORMAT-CODE. 06060003
060700                                                                  06070003
060800 9999-WRITE-CICS-LOG-MSG.                                         06080003
060900     MOVE PC-CURRENT-PROGRAM-NAME  TO DP013-PROGRAM.              06090003
061000     MOVE DFHEIBLK                 TO DP013-DFHEIBLK.             06100003
061100     INITIALIZE DP013-SRC-TASK-NUMBER                             06110003
061200                DP013-STACK.                                      06120003
061300     SET DP013-LINK-RETURN         TO TRUE.                       06130003
061400                                                                  06140003
061500     EXEC CICS                                                    06150003
061600         XCTL                                                     06160003
061700             PROGRAM   (DP013-NAME)                               06170003
061800             COMMAREA  (DP013-PARAMETERS)                         06180003
061900             LENGTH    (DP013-LENGTH)                             06190003
062000     END-EXEC.                                                    06200003
062100                                                                  06210003
062200/                                                                 06220003
062300*----------------------------------------------------------------*06230003
062400*    ABEND PROCESSOR MODULE                                      *06240003
062500*----------------------------------------------------------------*06250003
062600                                                                  06260003
062700     COPY DPPD013.                                                06270003
