000010******************************************************************00010000
000020 IDENTIFICATION DIVISION.                                         00020000
000030******************************************************************00030000
000040                                                                  00040000
000050 PROGRAM-ID.             TXKRP012.                                00050000
000060 AUTHOR.                 BARB SCHULTZ.                            00060000
000070 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000080 DATE-WRITTEN.           SEPTEMBER 2020.                          00080000
000090 DATE-COMPILED.                                                   00090000
000091                                                                  00100000
000092***************************************************************** 00110000
000093* THIS PROGRAM CREATES A REPORT THAT SHOWS THE TOTAL TAX FOR      00120000
000094* SHIPPING CHARGES PER STATE FOR MARKETPLACE.                     00130000
000096***************************************************************** 00140000
000097* DATE: 09-25-2020                       WR#: CHG0249229          00150014
000098* WHO: BARB SCHULTZ                                               00160004
000099* WHY: ADDED THE CALENDAR ROUTINE TO THE PROGRAM TO GET THE       00170004
000099*      1ST DAY OF THE FISCAL MONTH.                               00171004
000100******************************************************************00180000
000097* DATE: 10-07-2020                       WR#: CHG0249836          00181017
000098* WHO: BARB SCHULTZ                                               00182014
000099* WHY: FIXED THE PROGRAM TO HANDLE AN EMPTY FILE AND MOVED THE    00183015
000099* PROGRAM FROM TXK508 TO TXK512.                                  00184015
250775******************************************************************00184117
250775* DATE: 11-01-2020                       WR#: CHG0250775          00184217
250775* WHO: BARB SCHULTZ                                               00184317
250775* WHY: DELETED THE PV-HOLD-TRN-TYP-CDE AND REPLACED IT WITH       00184417
250775*      TX020-TRN-TYP-CDE.                                         00184517
000100******************************************************************00185014
000101***************************************************************** 00190000
000102 ENVIRONMENT DIVISION.                                            00200000
000103***************************************************************** 00210000
000104                                                                  00220000
000105 CONFIGURATION SECTION.                                           00230000
000106                                                                  00240000
000107 SOURCE-COMPUTER.        IBM-3090.                                00250000
000108                                                                  00260000
000109 OBJECT-COMPUTER.        IBM-3090.                                00270000
000110                                                                  00280000
000111 INPUT-OUTPUT SECTION.                                            00290000
000112                                                                  00300000
000113 FILE-CONTROL.                                                    00310000
000114                                                                  00320000
000115     SELECT POS-DATE-CARD-FILE                                    00330000
000116         ASSIGN TO INP01.                                         00340000
000117                                                                  00350000
000115     SELECT TAX-IN-FILE                                           00360000
000116         ASSIGN TO INP02.                                         00361000
000117                                                                  00362000
000118     SELECT TAX-REPORT-FILE                                       00363000
000119         ASSIGN TO RPT01.                                         00364000
000120                                                                  00365000
000121******************************************************************00366000
000122 DATA DIVISION.                                                   00367000
000123******************************************************************00368000
000124                                                                  00369000
000125 FILE SECTION.                                                    00370000
000126                                                                  00380000
000127 FD  POS-DATE-CARD-FILE                                           00390000
000128     RECORDING MODE IS F                                          00400000
000129     BLOCK CONTAINS 0 RECORDS                                     00410000
000130     LABEL RECORDS ARE STANDARD.                                  00420000
000131                                                                  00430000
000132 01  POS-DATE-CARD-RECORD            PIC X(80).                   00440000
000133                                                                  00450000
000127 FD  TAX-IN-FILE                                                  00460000
000128     RECORDING MODE IS F                                          00470000
000129     BLOCK CONTAINS 0 RECORDS                                     00480000
000130     LABEL RECORDS ARE STANDARD.                                  00490000
000131                                                                  00500000
000132 01  TAX-IN-RECORD                   PIC X(155).                  00510000
000133                                                                  00520000
000134 FD  TAX-REPORT-FILE                                              00530000
000135     RECORDING MODE IS F                                          00540000
000136     BLOCK CONTAINS 0  RECORDS.                                   00550000
000137                                                                  00560000
000138 01  TAX-REPORT-RECORD               PIC X(132).                  00570002
000139                                                                  00580000
000140******************************************************************00590000
000141 WORKING-STORAGE SECTION.                                         00600000
000142******************************************************************00610000
000143 01  FILLER                            PIC X(50)  VALUE           00620000
000144     ' *** WORKING STORAGE STARTS HERE FOR TXKRP012 *** '.        00630000
000145                                                                  00640000
000146******************************************************************00650000
000147* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    00660000
000148******************************************************************00670000
000149 01  CC-CONTROL-CARD.                                             00680000
000150     05  CC-CONTROL-CARD-DISPLAY.                                 00690000
000151         10  CC-BEGIN-DATE       PIC X(10)    VALUE SPACES.       00700000
000152         10  FILLER              PIC X        VALUE SPACE.        00710000
000153         10  CC-END-DATE         PIC X(10)    VALUE ZERO.         00720000
000154     05  FILLER                  PIC X(59)    VALUE SPACE.        00730000
000155 01  DATE-CONTROL-CARD.                                           00740009
000155     05  CC-MTH-ENDING-DATE-ISO.                                  00741009
000155         10  CC-MTH-ENDING-CC    PIC X(02).                       00742009
000155         10  CC-MTH-ENDING-YY    PIC X(02).                       00743009
000155         10  FILLER              PIC X(01).                       00744009
000155         10  CC-MTH-ENDING-MM    PIC X(02).                       00745009
000155         10  FILLER              PIC X(01).                       00746009
000155         10  CC-MTH-ENDING-DD    PIC X(02).                       00747009
000155     05  FILLER                  PIC X(70).                       00748009
000155                                                                  00749009
000155                                                                  00749109
000161 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      00750000
000162                                                  COMP SYNC.      00760000
000163     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    00770000
000164     88  AC-DB2-ERROR                             VALUE +4013.    00780000
000165     88  AC-TABLE-OVERFLOW                        VALUE +4004.    00790000
000165     88  AC-CONVERSION-ERROR                      VALUE +4008.    00800000
000165     88  AC-DB2-ERROR                             VALUE +4013.    00810000
000165     88  AC-TXKRP012-ERROR                        VALUE +4014.    00820000
000166                                                                  00830000
000167 01  PS-PROGRAM-SWITCHES.                                         00840000
000168     05  PS-END-OF-ITEM                PIC X(01)  VALUE 'N'.      00850000
000169         88  PS-END-OF-ITEM-YES                   VALUE 'Y'.      00860000
000170         88  PS-END-OF-ITEM-NO                    VALUE 'N'.      00870000
000174     05  PS-FIRST-TIME-SW              PIC X(01)  VALUE 'Y'.      00880000
000175         88  PS-FIRST-TIME                        VALUE 'Y'.      00890000
000176         88  PS-FIRST-TIME-NO                     VALUE 'N'.      00900000
000177     05  PS-END-OF-CARD-FILE           PIC X(01)  VALUE 'N'.      00910000
000178         88  PS-END-OF-CARD-FILE-YES              VALUE 'Y'.      00920000
000179                                                                  00930000
000180 01  PC-CONSTANTS.                                                00940000
000181     05  PC-NOT-FOUND                PIC S9(04)    VALUE +100.    00950000
000182     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00960000
000183                                     'TXKRP012'.                  00970000
000184     05  PC-REPORT-NBR-1             PIC 9(1)      VALUE 1.       00980000
000185                                                                  00990000
000186 01  PV-MISC-FIELDS.                                              01000000
000187     05  PV-LINE-SPACING             PIC  9        VALUE 1.       01010000
000188     05  PV-LINE-CNT                 PIC  9(03)    VALUE ZERO.    01020000
000189     05  PV-PAGE-CNT                 PIC  9(04)    VALUE ZERO.    01030000
000190     05  PV-PRINT-RECORD             PIC  X(132)   VALUE SPACE.   01040000
000191     05  PV-LINE-SEQ-NBR             PIC  9(03)    VALUE ZERO.    01050000
000192     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   01060000
000193     05  PV-DB2-OPERATION            PIC  X(30)    VALUE SPACE.   01070000
000194     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   01080000
000195     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   01090000
000196     05  PV-SUBTOTAL                 PIC  9(7).99- VALUE ZERO.    01100000
000197     05  PV-ST-SALES-AMT             PIC S9(7)V99  VALUE ZERO.    01110000
000199     05  PV-ST-SALES-TX-AMT          PIC S9(7)V99  VALUE ZERO.    01120000
000197     05  PV-ST-SALES-SHP-AMT         PIC S9(7)V99  VALUE ZERO.    01130000
000199     05  PV-ST-SALES-SHP-TX-AMT      PIC S9(7)V99  VALUE ZERO.    01140000
000198     05  PV-ST-RTN-AMT               PIC S9(7)V99  VALUE ZERO.    01150000
000200     05  PV-ST-RTN-TX-AMT            PIC S9(7)V99  VALUE ZERO.    01160000
000197     05  PV-ST-RTN-SHP-AMT           PIC S9(7)V99  VALUE ZERO.    01170000
000199     05  PV-ST-RTN-SHP-TX-AMT        PIC S9(7)V99  VALUE ZERO.    01180000
000197     05  PV-TOT-SALES-AMT            PIC S9(7)V99  VALUE ZERO.    01190000
000199     05  PV-TOT-SALES-TX-AMT         PIC S9(7)V99  VALUE ZERO.    01191000
000197     05  PV-TOT-SALES-SHP-AMT        PIC S9(7)V99  VALUE ZERO.    01192000
000199     05  PV-TOT-SALES-SHP-TX-AMT     PIC S9(7)V99  VALUE ZERO.    01193000
000198     05  PV-TOT-RTN-AMT              PIC S9(7)V99  VALUE ZERO.    01194000
000200     05  PV-TOT-RTN-TX-AMT           PIC S9(7)V99  VALUE ZERO.    01195000
000197     05  PV-TOT-RTN-SHP-AMT          PIC S9(7)V99  VALUE ZERO.    01196000
000199     05  PV-TOT-RTN-SHP-TX-AMT       PIC S9(7)V99  VALUE ZERO.    01197000
000219     05  PV-HOLD-STATE-CDE           PIC  X(02)    VALUE SPACES.  01198000
000219     05  PV-HOLD-PARTN-NBR           PIC  9(04)    VALUE ZERO.    01199000
000220     05  PV-HOLD-TRN-TYP-CDE         PIC  X(02)    VALUE SPACES.  01200000
000221                                                                  01210000
000222     05  PV-BEG-CCYY-MM-DD           PIC  X(10)    VALUE SPACE.   01220000
000223     05  FILLER REDEFINES PV-BEG-CCYY-MM-DD.                      01230000
000224         10  PV-BEG-CCYY             PIC  X(04).                  01240000
000225         10  FILLER                  PIC  X(01).                  01250000
000226         10  PV-BEG-MM               PIC  X(02).                  01260000
000227         10  FILLER                  PIC  X(01).                  01270000
000228         10  PV-BEG-DD               PIC  X(02).                  01280000
000229     05  PV-END-CCYY-MM-DD           PIC  X(10)    VALUE SPACE.   01290000
000230     05  FILLER REDEFINES PV-END-CCYY-MM-DD.                      01300000
000231         10  PV-END-CCYY             PIC  X(04).                  01310000
000232         10  FILLER                  PIC  X(01).                  01320000
000233         10  PV-END-MM               PIC  X(02).                  01330000
000234         10  FILLER                  PIC  X(01).                  01340000
000235         10  PV-END-DD               PIC  X(02).                  01350000
000236     05  PV-SALES-DATE.                                           01360000
000237         10  PV-SALES-MM             PIC  X(02)   VALUE SPACE.    01370000
000238         10  FILLER                  PIC  X(01)    VALUE '/'.     01380000
000239         10  PV-SALES-DD             PIC  X(02)    VALUE SPACE.   01390000
000240         10  FILLER                  PIC  X(01)    VALUE '/'.     01400000
000241         10  PV-SALES-CCYY           PIC  X(04)    VALUE SPACE.   01410000
000242     05  PV-CURR-DATE-CCYYMMDD.                                   01420000
000243         10  PV-CURR-DATE-CCYY       PIC  9(04).                  01430000
000244         10  PV-CURR-DATE-MM         PIC  9(02).                  01440000
000245         10  PV-CURR-DATE-DD         PIC  9(02).                  01450000
000246     05  PV-CURR-TIME.                                            01460000
000247         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    01470000
000248         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    01480000
000249         10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    01490000
000250                                                                  01500000
000251******************************************************************01510000
000252*  TOP OF PAGE HEADING LINE FOR PRINTING A 132 CHARACTER REPORT.  01520000
000253******************************************************************01530000
000254     COPY DPWS132.                                                01540000
000255                                                                  01550000
000255******************************************************************01560000
000255* RECORD LAYOUT FOR TAX ADJUSTMENT RECORD                         01570000
000255******************************************************************01580000
000255     COPY TXRD020.                                                01590000
000255                                                                  01591000
000256******************************************************************01592000
000257*  HEADING LINES FOR THE MARKETPLACE REPORT.                      01593000
000258******************************************************************01594000
000259 01  H1-HEADING-LINE-1.                                           01595000
000260     05  FILLER                      PIC  X(42)    VALUE SPACE.   01596000
000261     05  FILLER                      PIC  X(12)    VALUE          01597000
000262                                          'MARKETPLACE '.         01598000
000263     05  FILLER                      PIC  X(11)    VALUE          01599000
000264                                          'TAX REPORT'.           01600000
000268     05  H1-BEGIN-DATE.                                           01610000
000269         10  H1-BEG-MM               PIC  X(02)    VALUE SPACE.   01620000
000270         10  FILLER                  PIC  X(01)    VALUE '/'.     01630000
000271         10  H1-BEG-DD               PIC  X(02)    VALUE SPACE.   01640000
000272         10  FILLER                  PIC  X(01)    VALUE '/'.     01650000
000273         10  H1-BEG-CCYY             PIC  X(04)    VALUE SPACE.   01660000
000274     05  FILLER                      PIC  X(06)    VALUE ' THRU '.01670000
000275     05  H1-END-DATE.                                             01680000
000276         10  H1-END-MM               PIC  X(02)    VALUE SPACE.   01690000
000277         10  FILLER                  PIC  X(01)    VALUE '/'.     01700000
000278         10  H1-END-DD               PIC  X(02)    VALUE SPACE.   01710000
000279         10  FILLER                  PIC  X(01)    VALUE '/'.     01720000
000280         10  H1-END-CCYY             PIC  X(04)    VALUE SPACE.   01730000
000281     05  FILLER                      PIC  X(12)    VALUE SPACE.   01740000
000282                                                                  01750000
000283 01  H2-HEADING-LINE-2.                                           01760000
000284     05  FILLER                      PIC  X(2)     VALUE SPACES.  01770000
000284     05  FILLER                      PIC  X(5)     VALUE 'STATE'. 01780000
000284     05  FILLER                      PIC  X(6)     VALUE SPACES.  01790000
000288     05  FILLER                      PIC  X(6)                    01800000
000288                                  VALUE 'SALES '.                 01810000
000289     05  FILLER                      PIC  X(8)     VALUE SPACES.  01820000
000288     05  FILLER                      PIC  X(6)                    01830000
000288                                  VALUE 'SALES '.                 01840000
000289     05  FILLER                      PIC  X(8)     VALUE SPACES.  01850000
000288     05  FILLER                      PIC  X(6)                    01860000
000288                                  VALUE 'SALES '.                 01870000
000289     05  FILLER                      PIC  X(8)     VALUE SPACES.  01880000
000288     05  FILLER                      PIC  X(6)                    01890000
000288                                  VALUE 'SALES '.                 01900000
000289     05  FILLER                      PIC  X(6)     VALUE SPACES.  01910000
000288     05  FILLER                      PIC  X(7)                    01920000
000288                                  VALUE 'RETURN '.                01930000
000289     05  FILLER                      PIC  X(7)     VALUE SPACES.  01931000
000288     05  FILLER                      PIC  X(7)                    01932000
000288                                  VALUE 'RETURN '.                01933000
000289     05  FILLER                      PIC  X(7)     VALUE SPACES.  01934000
000288     05  FILLER                      PIC  X(7)                    01935000
000288                                  VALUE 'RETURN '.                01936000
000289     05  FILLER                      PIC  X(7)     VALUE SPACES.  01937000
000288     05  FILLER                      PIC  X(7)                    01938000
000288                                  VALUE 'RETURN '.                01939000
000289     05  FILLER                      PIC  X(3)     VALUE SPACES.  01940000
000314                                                                  01950000
000283 01  H3-HEADING-LINE-3.                                           01960000
000284     05  FILLER                      PIC  X(12)    VALUE SPACES.  01970000
000288     05  FILLER                      PIC  X(6)                    01980000
000288                                  VALUE 'AMOUNT'.                 01990000
000289     05  FILLER                      PIC  X(7)     VALUE SPACES.  02000000
000290     05  FILLER                      PIC  X(7)                    02010000
000290                                  VALUE 'TAX AMT'.                02020000
000291     05  FILLER                      PIC  X(7)     VALUE SPACES.  02030000
000288     05  FILLER                      PIC  X(9)                    02040000
000288                                  VALUE 'SHP AMT'.                02050000
000289     05  FILLER                      PIC  X(4)     VALUE SPACES.  02060000
000290     05  FILLER                      PIC  X(11)                   02070000
000290                                  VALUE 'SHP TAX AMT'.            02080000
000289     05  FILLER                      PIC  X(4)     VALUE SPACES.  02090000
000289     05  FILLER                      PIC  X(6)                    02100000
000288                                  VALUE 'AMOUNT'.                 02110000
000289     05  FILLER                      PIC  X(7)     VALUE SPACES.  02120000
000290     05  FILLER                      PIC  X(7)                    02130000
000290                                  VALUE 'TAX AMT'.                02140000
000291     05  FILLER                      PIC  X(7)     VALUE SPACES.  02150000
000288     05  FILLER                      PIC  X(7)                    02160000
000288                                  VALUE 'SHP AMT'.                02170000
000289     05  FILLER                      PIC  X(6)     VALUE SPACES.  02180000
000290     05  FILLER                      PIC  X(11)                   02181000
000290                                  VALUE 'SHP TAX AMT'.            02182000
000289     05  FILLER                      PIC  X(3)     VALUE SPACES.  02183000
330314                                                                  02184000
000315******************************************************************02185000
000316*  STATE DETAIL LINE.                                             02186000
000317******************************************************************02187000
000318 01  D1-DETAIL-LINE-1.                                            02188000
000319     05  FILLER                      PIC  XX       VALUE SPACES.  02189000
000320     05  D1-STATE-CDE                PIC  X(2)     VALUE SPACES.  02190000
000321     05  FILLER                      PIC  XXXX     VALUE SPACES.  02200000
000322     05  D1-SALES-AMT                PIC  Z(7).99- VALUE ZERO.    02210000
000323     05  FILLER                      PIC  XXX      VALUE SPACES.  02220000
000324     05  D1-SALES-TAX-AMT            PIC  Z(7).99- VALUE ZERO.    02230000
000325     05  FILLER                      PIC  XXX      VALUE SPACES.  02240000
000326     05  D1-SALES-SHP-CHRG-AMT       PIC  Z(7).99- VALUE ZERO.    02250000
000327     05  FILLER                      PIC  XXX      VALUE SPACES.  02260000
000328     05  D1-SALES-SHP-TAX-AMT        PIC  Z(7).99- VALUE ZERO.    02270000
000329     05  FILLER                      PIC  XX       VALUE SPACES.  02280000
000322     05  D1-RTN-AMT                  PIC  Z(7).99- VALUE ZERO.    02290000
000323     05  FILLER                      PIC  XXX      VALUE SPACES.  02300000
000324     05  D1-RTN-TAX-AMT              PIC  Z(7).99- VALUE ZERO.    02310000
000325     05  FILLER                      PIC  XXX      VALUE SPACES.  02320000
000326     05  D1-RTN-SHP-CHRG-AMT         PIC  Z(7).99- VALUE ZERO.    02330000
000327     05  FILLER                      PIC  XXX      VALUE SPACES.  02340000
000328     05  D1-RTN-SHP-TX-AMT           PIC  Z(7).99- VALUE ZERO.    02350000
000377     05  FILLER                      PIC  X(6)     VALUE SPACES.  02360000
000379                                                                  02370000
000380******************************************************************02380000
000381*  TOTAL LINE                                                     02390000
000382******************************************************************02400000
000318 01  D2-TOTAL-LINE-2.                                             02410000
000320     05  FILLER                      PIC  X(2)     VALUE SPACES.  02420000
000320     05  FILLER                      PIC  X(5)     VALUE 'TOTAL'. 02430000
000320     05  FILLER                      PIC  X(1)     VALUE SPACES.  02440000
000322     05  D2-SALES-AMT                PIC  Z(7).99- VALUE ZERO.    02450000
000323     05  FILLER                      PIC  XXX      VALUE SPACES.  02460000
000324     05  D2-SALES-TAX-AMT            PIC  Z(7).99- VALUE ZERO.    02470000
000325     05  FILLER                      PIC  XXX      VALUE SPACES.  02480000
000326     05  D2-SALES-SHP-CHRG-AMT       PIC  Z(7).99- VALUE ZERO.    02490000
000327     05  FILLER                      PIC  XXX      VALUE SPACES.  02500000
000328     05  D2-SALES-SHP-TAX-AMT        PIC  Z(7).99- VALUE ZERO.    02510000
000329     05  FILLER                      PIC  XX       VALUE SPACES.  02520000
000322     05  D2-RTN-AMT                  PIC  Z(7).99- VALUE ZERO.    02530000
000323     05  FILLER                      PIC  XXX      VALUE SPACES.  02540000
000324     05  D2-RTN-TAX-AMT              PIC  Z(7).99- VALUE ZERO.    02550000
000325     05  FILLER                      PIC  XXX      VALUE SPACES.  02560000
000326     05  D2-RTN-SHP-CHRG-AMT         PIC  Z(7).99- VALUE ZERO.    02570000
000327     05  FILLER                      PIC  XXX      VALUE SPACES.  02580000
000328     05  D2-RTN-SHP-TAX-AMT          PIC  Z(7).99- VALUE ZERO.    02590000
000377     05  FILLER                      PIC  X(6)     VALUE SPACES.  02600000
000379                                                                  02610000
000413                                                                  02620000
000414******************************************************************02630000
000415*  BLANK LINE.                                                    02640000
000416******************************************************************02650000
000417 01  D4-BLANK-LINE.                                               02660000
000418     05  FILLER                      PIC  X(132)   VALUE SPACES.  02670000
000419                                                                  02680000
000416******************************************************************02681103
000419* WORKING STORAGE SECTION FOR CALENDAR ROUTINE                    02681203
000416******************************************************************02681303
000419     COPY DPWS500.                                                02681503
000419                                                                  02681603
000560***************************************************************** 02690000
000570 PROCEDURE DIVISION.                                              02700000
000580******************************************************************02710000
000590 0000-MAINLINE-PARAGRAPH.                                         02720000
000592                                                                  02730000
000593     PERFORM 1000-PROCESS-CONTROL-CARD.                           02740000
000594                                                                  02750000
000742     PERFORM 3300-PROCESS-ITEM                                    02840000
000598         UNTIL PS-END-OF-ITEM-YES.                                02850000
000598                                                                  02860000
000799     PERFORM 3600-WRITE-ITEM-REPORT                               02870000
000602     PERFORM 3700-TOTAL-LINE.                                     02880000
000604                                                                  02890000
000607     CLOSE POS-DATE-CARD-FILE                                     02900000
000115           TAX-IN-FILE                                            02910000
000608           TAX-REPORT-FILE.                                       02920000
000609                                                                  02930000
000610     STOP RUN.                                                    02940000
000611                                                                  02950000
000612******************************************************************02960000
000614*     OPEN FILES. READ CONTROL CARD TO GET POS DATE IN MMDDYY     02970000
000615*     FORMAT. CALL DATE ROUTINE TO CONVERT DATE TO A CCYY-MM-DD   02980000
000616*     PROCESS DATE.                                               02990000
000578*                                                                 02993003
000579*     CALLS THE DATE ROUTINE WITH FISCAL END DATE AND RETRIVES    02994003
000580*     FISCAL MONTH START DATE AND FISCAL MONTH END DATE.          02995003
000581*                                                                 03000003
000612******************************************************************03001003
000618                                                                  03010000
000619 1000-PROCESS-CONTROL-CARD.                                       03020000
000620                                                                  03030000
000621     OPEN INPUT  POS-DATE-CARD-FILE                               03040000
000115                 TAX-IN-FILE                                      03050000
000622          OUTPUT TAX-REPORT-FILE.                                 03060000
000623                                                                  03070000
000624     READ POS-DATE-CARD-FILE INTO DATE-CONTROL-CARD               03080009
000625        AT END                                                    03090000
000626           SET PS-END-OF-CARD-FILE-YES TO TRUE.                   03100000
000627                                                                  03110000
000628     IF PS-END-OF-CARD-FILE-YES                                   03120000
000629         MOVE '1000-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   03130000
000630         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  03140000
000631         SET AC-TXKRP012-ERROR             TO TRUE                03150000
000632         PERFORM 9999-ABEND                                       03160000
000633     END-IF.                                                      03170000
000634                                                                  03180000
000634     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         03181003
000634     SET DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                    03182004
000634     SET DPG51-FISCAL-454-CALENDAR    TO TRUE.                    03184303
000634     SET DPG52-LK-DTE-ISO-FMT         TO TRUE.                    03184404
000634                                                                  03184503
000151     MOVE CC-MTH-ENDING-DATE-ISO      TO DPG52-LK-DATE-INPUT.     03184609
000634                                                                  03184803
000634     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03184903
000634                                             DPG54 DPG55 DPG56.   03185003
000634     IF  DPG54-SEVERE-ERROR                                       03185104
000634        DISPLAY '*********************************'               03185204
000634        DISPLAY '** ABEND FROM CALL SUB         **'               03185304
000634        DISPLAY '** PROGRAM = TXKRP012          **'               03185406
000634        DISPLAY '** DATE = ' CC-CONTROL-CARD  ' **'               03185508
000634        DISPLAY '*********************************'               03185604
000634        DISPLAY DPG54-ERROR-MESSAGE                               03185704
000634        SET AC-CONTROL-CARD-ERROR TO TRUE                         03185806
000634        PERFORM 9999-ABEND                                        03185906
000634     ELSE                                                         03186004
000634        IF  DPG54-DATE-INVALID                                    03186104
000634           DISPLAY '****************************'                 03186204
000634           DISPLAY '** ABEND INVALID END DATE **'                 03186304
000634           DISPLAY '** PROGRAM = TXKRP012     **'                 03186406
000634           DISPLAY '** DATE = ' CC-CONTROL-CARD '**'              03186508
000634           DISPLAY '****************************'                 03186604
000634           DISPLAY DPG54-ERROR-MESSAGE                            03186704
000634           SET AC-CONTROL-CARD-ERROR TO TRUE                      03186804
000634           PERFORM 9999-ABEND                                     03186906
000634        END-IF                                                    03187004
000634     END-IF.                                                      03187103
                                                                        03187212
300634     IF DPG55-ALPHA-WEEK-DAY-SATURDAY                             03189012
000634        CONTINUE                                                  03189109
000634     ELSE                                                         03189209
000634        DISPLAY '** ABEND **'                                     03189309
000634        DISPLAY '** PROGRAM   ** = SAKRP100'                      03189409
000634        DISPLAY '** PARAGRAPH ** = 1000-PROCESS-CONTROL-CARD'     03189509
000634        DISPLAY 'BAD INPUT DATE: '                                03189609
000634                        CC-MTH-ENDING-DATE-ISO                    03189709
000634        DISPLAY 'INPUT DATE IS NOT A WEEK ENDING DATE'            03189809
000634        SET AC-CONTROL-CARD-ERROR TO TRUE                         03189909
000634        CALL 'ILBOABN0' USING AC-ABEND-CODE                       03190009
000634     END-IF.                                                      03190109
000634                                                                  03190409
000634     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO CC-BEGIN-DATE.            03190510
000634     MOVE DPG56-LAST-FP-DB2-ISO-FMT  TO CC-END-DATE.              03190610
000634                                                                  03190709
000635     DISPLAY '**********************************************'     03191012
000635     DISPLAY PC-CURRENT-PROGRAM-NAME                              03192012
000636             ' - CALENDAR = (' CC-CONTROL-CARD-DISPLAY  ')'.      03200011
000637                                                                  03210000
000635     DISPLAY PC-CURRENT-PROGRAM-NAME                              03211011
000636             ' - DATE CONTROL CARD = ' DATE-CONTROL-CARD ')'.     03212013
000635     DISPLAY '**********************************************'     03214012
000637                                                                  03215012
000638     PERFORM 1200-FORMAT-HEADINGS.                                03220000
000639                                                                  03230000
000640     PERFORM 8000-PRINT-HEADINGS.                                 03240000
000641                                                                  03250000
000597     PERFORM 3200-READ-ITEM.                                      03251014
000628     IF PS-END-OF-ITEM-YES                                        03252014
000630       DISPLAY 'NO INPUT RECORDS TO PROCESS'                      03254014
000633     END-IF.                                                      03257014
000598                                                                  03258014
000642******************************************************************03260000
000644*     GET CURRENT DATE AND TIME FROM SYSTEM.                      03270000
000645*     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          03280000
000646*     FORMAT HEADING LINE 2 WITH CONVERTED POS DATE.              03290000
000647******************************************************************03300000
000648                                                                  03310000
000649 1200-FORMAT-HEADINGS.                                            03320000
000650                                                                  03330000
000651     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   03340000
000652     ACCEPT PV-CURR-TIME FROM TIME.                               03350000
000653                                                                  03360000
000654     MOVE PV-CURR-DATE-MM             TO DP132-RUN-MONTH.         03370000
000655     MOVE PV-CURR-DATE-DD             TO DP132-RUN-DAY.           03380000
000656     MOVE PV-CURR-DATE-CCYY           TO DP132-RUN-YEAR.          03390000
000657                                                                  03400000
000658     MOVE PV-CURR-TIME-HH             TO DP132-RUN-HOUR.          03410000
000659     MOVE PV-CURR-TIME-MM             TO DP132-RUN-MINUTE.        03420000
000660     MOVE PC-CURRENT-PROGRAM-NAME     TO DP132-PROGRAM-NAME.      03430000
000661     MOVE PC-REPORT-NBR-1             TO DP132-REPORT-NUMBER.     03440000
000662                                                                  03450000
000663     MOVE CC-BEGIN-DATE               TO PV-BEG-CCYY-MM-DD.       03460000
000664     MOVE CC-END-DATE                 TO PV-END-CCYY-MM-DD.       03470000
000665     MOVE PV-BEG-CCYY                 TO H1-BEG-CCYY.             03480000
000666     MOVE PV-BEG-MM                   TO H1-BEG-MM.               03490000
000667     MOVE PV-BEG-DD                   TO H1-BEG-DD.               03500000
000668     MOVE PV-END-CCYY                 TO H1-END-CCYY.             03510000
000669     MOVE PV-END-MM                   TO H1-END-MM.               03520000
000670     MOVE PV-END-DD                   TO H1-END-DD.               03530000
000671                                                                  03540000
000687******************************************************************03550000
000688* READ ITEM INPUT FILE                                            03560000
000689******************************************************************03570000
000690                                                                  03580000
000691 3200-READ-ITEM.                                                  03590000
000692                                                                  03600000
000624     READ TAX-IN-FILE INTO TX020-MARKETPLACE-RECORD               03610000
000625        AT END                                                    03620000
000626           SET PS-END-OF-ITEM-YES TO TRUE.                        03630000
000710                                                                  03640000
000724     IF PS-FIRST-TIME AND PS-END-OF-ITEM-NO                       03660014
000726         MOVE TX020-ST-CDE        TO PV-HOLD-STATE-CDE            03670000
000219                                     D1-STATE-CDE                 03680000
250775*        MOVE TX020-TRN-TYP-CDE   TO PV-HOLD-TRN-TYP-CDE          03690017
000728         MOVE 'N' TO PS-FIRST-TIME-SW                             03700000
000732     END-IF.                                                      03710000
000733                                                                  03720000
000734     IF PV-LINE-CNT > 55                                          03730000
000735         PERFORM 8000-PRINT-HEADINGS                              03740000
000736     END-IF.                                                      03750000
000737                                                                  03760000
000738******************************************************************03770000
000739* PROCESS ITEM DETAIL LINE                                        03780000
000740******************************************************************03790000
000741                                                                  03800000
000742 3300-PROCESS-ITEM.                                               03810000
000743                                                                  03820000
000219     IF  PV-HOLD-STATE-CDE = TX020-ST-CDE                         03830000
               CONTINUE                                                 03840000
           ELSE                                                         03850000
000799         PERFORM 3600-WRITE-ITEM-REPORT                           03860000
000219         MOVE TX020-ST-CDE          TO PV-HOLD-STATE-CDE          03870000
000219                                       D1-STATE-CDE               03880000
           END-IF.                                                      03890000
                                                                        03900000
                                                                        03910000
250775     IF  TX020-TRN-TYP-CDE = '01' OR '02'                         03920017
000753         ADD TX020-TAXABLE-AMT  TO PV-ST-SALES-AMT                03930000
000197                                   PV-TOT-SALES-AMT               03940000
000753         ADD TX020-TX-AMT       TO PV-ST-SALES-TX-AMT             03950000
000199                                   PV-TOT-SALES-TX-AMT            03960000
               IF TX020-SHP-TX-AMT = 0                                  03970000
                  CONTINUE                                              03980000
               ELSE                                                     03990000
000753            ADD TX020-SHP-CHRG-AMT TO PV-ST-SALES-SHP-AMT         04000000
000197                                      PV-TOT-SALES-SHP-AMT        04010000
               END-IF                                                   04020000
000753         ADD TX020-SHP-TX-AMT   TO PV-ST-SALES-SHP-TX-AMT         04030000
000199                                   PV-TOT-SALES-SHP-TX-AMT        04040000
000197     ELSE                                                         04050000
000219         IF  TX020-TRN-TYP-CDE = '11' OR '12'                     04060016
000198            ADD TX020-TAXABLE-AMT  TO PV-ST-RTN-AMT               04070000
000198                                      PV-TOT-RTN-AMT              04080000
000200            ADD TX020-TX-AMT       TO PV-ST-RTN-TX-AMT            04090000
000200                                      PV-TOT-RTN-TX-AMT           04100000
                  IF TX020-SHP-TX-AMT = 0                               04110000
                     CONTINUE                                           04120000
                  ELSE                                                  04130000
000197               ADD TX020-SHP-CHRG-AMT TO PV-ST-RTN-SHP-AMT        04140000
000197                                         PV-TOT-RTN-SHP-AMT       04150000
                  END-IF                                                04160000
000199            ADD TX020-SHP-TX-AMT   TO PV-ST-RTN-SHP-TX-AMT        04170000
000199                                      PV-TOT-RTN-SHP-TX-AMT       04180000
000753         ELSE                                                     04190000
000753            DISPLAY 'TRN TYP CDE ' TX020-TRN-TYP-CDE              04200000
000198            DISPLAY 'TX020-TAXABLE-AMT ' TX020-TAXABLE-AMT        04210000
000200            DISPLAY 'TX020-TX-AMT ' TX020-TX-AMT                  04220000
000197            DISPLAY 'TX020-SHP-CHRG-AMT ' TX020-SHP-CHRG-AMT      04230000
000199            DISPLAY 'TX020-SHP-TX-AMT ' TX020-SHP-TX-AMT          04240000
000790        END-IF                                                    04250000
000791     END-IF.                                                      04260000
000798                                                                  04270000
000801     PERFORM 3200-READ-ITEM.                                      04280000
000802                                                                  04290000
000965******************************************************************04300000
000966 3600-WRITE-ITEM-REPORT.                                          04310000
000967******************************************************************04320000
000968                                                                  04330000
000753     MOVE PV-ST-SALES-AMT         TO D1-SALES-AMT.                04340000
000753     MOVE PV-ST-SALES-TX-AMT      TO D1-SALES-TAX-AMT.            04350000
000753     MOVE PV-ST-SALES-SHP-AMT     TO D1-SALES-SHP-CHRG-AMT.       04360000
000753     MOVE PV-ST-SALES-SHP-TX-AMT  TO D1-SALES-SHP-TAX-AMT.        04370000
           MOVE PV-ST-RTN-AMT           TO D1-RTN-AMT.                  04380000
000200     MOVE PV-ST-RTN-TX-AMT        TO D1-RTN-TAX-AMT.              04390000
000197     MOVE PV-ST-RTN-SHP-AMT       TO D1-RTN-SHP-CHRG-AMT.         04400000
000199     MOVE PV-ST-RTN-SHP-TX-AMT    TO D1-RTN-SHP-TX-AMT.           04410000
000968                                                                  04420000
000969     WRITE TAX-REPORT-RECORD FROM D1-DETAIL-LINE-1 AFTER          04430000
000970                   ADVANCING 1 LINE.                              04440000
000971                                                                  04450000
000833     MOVE ZEROES TO PV-ST-SALES-AMT                               04460000
000753                    PV-ST-SALES-TX-AMT                            04470000
000753                    PV-ST-SALES-SHP-AMT                           04480000
000753                    PV-ST-SALES-SHP-TX-AMT                        04490000
                          PV-ST-RTN-AMT                                 04500000
000200                    PV-ST-RTN-TX-AMT                              04510000
000197                    PV-ST-RTN-SHP-AMT                             04520000
000199                    PV-ST-RTN-SHP-TX-AMT.                         04530000
001060                                                                  04540000
000808******************************************************************04550000
000809* WRITE DETAIL TOTAL LINE                                         04560000
000810******************************************************************04570000
000811                                                                  04580000
000812 3700-TOTAL-LINE.                                                 04590000
000813                                                                  04600000
000814     WRITE TAX-REPORT-RECORD FROM D4-BLANK-LINE AFTER             04610000
000815               ADVANCING 2 LINE.                                  04620000
000816                                                                  04630000
000197     MOVE PV-TOT-SALES-AMT        TO D2-SALES-AMT.                04640000
000199     MOVE PV-TOT-SALES-TX-AMT     TO D2-SALES-TAX-AMT.            04650000
000199     MOVE PV-TOT-SALES-SHP-AMT    TO D2-SALES-SHP-CHRG-AMT.       04660000
000199     MOVE PV-TOT-SALES-SHP-TX-AMT TO D2-SALES-SHP-TAX-AMT.        04670000
000198     MOVE PV-TOT-RTN-AMT          TO D2-RTN-AMT.                  04680000
000200     MOVE PV-TOT-RTN-TX-AMT       TO D2-RTN-TAX-AMT.              04690000
000197     MOVE PV-TOT-RTN-SHP-AMT      TO D2-RTN-SHP-CHRG-AMT.         04700000
000199     MOVE PV-TOT-RTN-SHP-TX-AMT   TO D2-RTN-SHP-TAX-AMT.          04710000
00032                                                                   04720000
000829     WRITE TAX-REPORT-RECORD FROM D2-TOTAL-LINE-2 AFTER           04730000
000830               ADVANCING 2 LINE.                                  04740000
000837                                                                  04770000
001070******************************************************************04800000
001071* 8000-PRINT-HEADINGS                                             04810000
001072*     PRINT THE HEADINGS FOR THE REPORT.                          04820000
001073******************************************************************04830000
001074 8000-PRINT-HEADINGS.                                             04840000
001075                                                                  04850000
001076     ADD +1                      TO PV-PAGE-CNT.                  04860000
001077     MOVE PV-PAGE-CNT TO DP132-PAGE-NUMBER.                       04870000
001078     MOVE DP132-STANDRD-HEADER-132-COLS                           04880000
001079                                 TO PV-PRINT-RECORD.              04890000
001080     PERFORM 8100-WRITE-RPT-TOP-OF-PAGE.                          04900000
001081                                                                  04910000
001082     MOVE H1-HEADING-LINE-1      TO PV-PRINT-RECORD.              04920000
001083     MOVE +2                     TO PV-LINE-SPACING.              04930000
001084     PERFORM 8200-WRITE-REPORT-LINE.                              04940000
001085     ADD  PV-LINE-SPACING        TO PV-LINE-CNT.                  04950000
000816                                                                  04960000
000814     WRITE TAX-REPORT-RECORD FROM D4-BLANK-LINE AFTER             04970000
000815               ADVANCING 2 LINE.                                  04980000
000816                                                                  04990000
001082     MOVE H2-HEADING-LINE-2      TO PV-PRINT-RECORD.              05000000
001083     MOVE +2                     TO PV-LINE-SPACING.              05010000
001084     PERFORM 8200-WRITE-REPORT-LINE.                              05020000
001085     ADD  PV-LINE-SPACING        TO PV-LINE-CNT.                  05030000
001085     ADD  PV-LINE-SPACING        TO PV-LINE-CNT.                  05040000
001082     MOVE H3-HEADING-LINE-3      TO PV-PRINT-RECORD.              05050000
001083     MOVE +2                     TO PV-LINE-SPACING.              05060000
001084     PERFORM 8200-WRITE-REPORT-LINE.                              05070000
001085     ADD  PV-LINE-SPACING        TO PV-LINE-CNT.                  05080000
001086                                                                  05090000
001087     WRITE TAX-REPORT-RECORD FROM D4-BLANK-LINE AFTER             05100000
001088               ADVANCING 2 LINE.                                  05110000
001089                                                                  05120000
001096                                                                  05230000
001097******************************************************************05240000
001098* 8100-WRITE-RPT-TOP-OF-PAGE                                      05250000
001099*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   05260000
001100******************************************************************05270000
001101 8100-WRITE-RPT-TOP-OF-PAGE.                                      05280000
001102                                                                  05290000
001103     WRITE TAX-REPORT-RECORD                                      05300000
001104       FROM PV-PRINT-RECORD                                       05310000
001105         AFTER ADVANCING PAGE.                                    05320000
001106                                                                  05330000
001107     MOVE +3                     TO PV-LINE-CNT.                  05340000
001108                                                                  05350000
001109******************************************************************05360000
001110* 8200-WRITE-REPORT-LINE                                          05370000
001111*     WRITE REPORT LINE AFTER ADVANCING LINE SPACING.             05380000
001112******************************************************************05390000
001113 8200-WRITE-REPORT-LINE.                                          05400000
001114                                                                  05410000
001115     WRITE TAX-REPORT-RECORD                                      05420000
001116       FROM PV-PRINT-RECORD                                       05430000
001117         AFTER ADVANCING PV-LINE-SPACING.                         05440000
001118                                                                  05450000
001119     ADD PV-LINE-SPACING TO PV-LINE-CNT.                          05460000
001120                                                                  05470000
001144******************************************************************05480000
001145*9999-ABEND.                                                      05490000
001146*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  05500000
001147******************************************************************05510000
001148 9999-ABEND.                                                      05520000
001149     DISPLAY '** ABEND           **'.                             05530000
001150     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  05540000
001151     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        05550000
001152     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       05560000
001153     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       05570000
001154     DISPLAY '** PARTITION       ** = ' TX020-PARTN-NBR           05580000
001155     DISPLAY '** STORE           ** = ' TX020-STR-NBR             05590000
001156     DISPLAY '** REGISTER        ** = ' TX020-RGST-ID             05600000
001157     DISPLAY '** TRANSACTION     ** = ' TX020-TRN-NBR             05610000
001158     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         05620000
001159                                                                  05630000
