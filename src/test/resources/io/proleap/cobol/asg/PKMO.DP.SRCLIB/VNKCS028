000100*-----------------------*                                         00010032
000200 IDENTIFICATION DIVISION.                                         00020032
000300*-----------------------*                                         00030032
000400 PROGRAM-ID.    VNKCS028.                                         00040032
000500 AUTHOR.        JACK KRAMER.                                      00050032
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060032
000700 DATE-WRITTEN.  JANUARY 2005.                                     00070032
000800*---------------------------------------------------------------* 00080032
000900*    V028 - VENDOR CAPABILITIES LIST PROGRAM.                   * 00090032
001000*                                                               * 00100032
001100*    THIS PROGRAM GENERATES A LIST OF VENDOR CAPABILITIES. ONE  * 00110032
001200*    OR MORE CAPABILITIES CAN BE SELECTED FOR INQUIRY, OR TO    * 00120032
001300*    BE ADDED TO, OR EXPIRED FROM THE VENDOR BEING PROCESSED.   * 00130032
001400*                                                               * 00140032
001401* CHANGE LOG:                                                   * 00140135
001410*  DATE  09/07/2021                                              *00141035
001420*            - CHANGE CALL OF DPKUT100 TO                       * 00142035
001430*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00143035
001440*              MAKING THE CALL DYNAMIC VS STATIC                * 00144035
001450*      MADE BY: GERMAN BANDA            WR/IR #: CHG0261091      *00145037
001460*                                                               * 00146035
001410*  DATE  01/05/2023                                              *00147038
001420*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00148038
001450*      MADE BY: JEAN KURK               WR/IR #: CHG0277999      *00149238
001460*                                                               * 00149338
001500*---------------------------------------------------------------* 00150032
001600 ENVIRONMENT DIVISION.                                            00160032
001700 DATA DIVISION.                                                   00170032
001800                                                                  00180032
001900 WORKING-STORAGE SECTION.                                         00190032
002000                                                                  00200032
002100 01  DK-DB2-KEYS.                                                 00210032
002200     15  DK-ENT-ID                      PIC S9(09)  COMP.         00220032
002300                                                                  00230032
002400 01  PC-PROGRAM-CONSTANTS.                                        00240032
002500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00250032
002600                                                    'VN028A  '.   00260032
002700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00270032
002800                                                    'VNKM028 '.   00280032
002900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00290032
003000                                                    'VNKCS028'.   00300032
003100     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00310032
003200     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00320032
003300     05  PC-INTER-APPL-CODES.                                     00330032
003400         10 PC-INTER-APPL-VEND-DTL      PIC  X(01)  VALUE '1'.    00340032
003500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00350032
003600                                                    COMP SYNC.    00360032
003700     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00370032
003800                                                    COMP SYNC.    00380032
003900     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00390032
004000                                                    +1000000      00400032
004100                                                    COMP-3.       00410032
004200     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00420032
004300                                                    COMP SYNC.    00430032
004400     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00440032
004500                                                    COMP-3.       00450032
004600     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  00460032
004700     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00470032
004800     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00480032
004900     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00490032
005000     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00500032
005100     05  PC-MAX-DATE                    PIC  X(10)  VALUE         00510032
005200                                                    '12/31/9999'. 00520032
005300     05  PC-DUMMY-DATE                  PIC  X(10)  VALUE         00530032
005400                                                    '0001-01-01'. 00540032
005500                                                                  00550032
005600     05  PC-TSYMSG-NUMBERS.                                       00560032
005700         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00570032
005800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00580032
005900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00590032
006000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00600032
006100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00610032
006200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00620032
006300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00630032
006400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00640032
006500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00650032
006600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00660032
006700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00670032
006800         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00680032
006900         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00690032
007000         10  PC-TSYMSG-00398            PIC  9(05)  VALUE 00398.  00700032
007100         10  PC-TSYMSG-03367            PIC  9(05)  VALUE 03367.  00710032
007200         10  PC-TSYMSG-03368            PIC  9(05)  VALUE 03368.  00720032
007300         10  PC-TSYMSG-03369            PIC  9(05)  VALUE 03369.  00730032
007400         10  PC-TSYMSG-03631            PIC  9(05)  VALUE 03631.  00740034
007500         10  PC-TSYMSG-03633            PIC  9(05)  VALUE 03633.  00750034
007600         10  PC-TSYMSG-03636            PIC  9(05)  VALUE 03636.  00760034
007700         10  PC-TSYMSG-03637            PIC  9(05)  VALUE 03637.  00770034
007800         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00780032
007900                                                                  00790032
008000 01  PS-PROGRAM-SWITCHES.                                         00800032
008100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00810032
008200         88  PS-NO-ERROR                            VALUE 'Y'.    00820032
008300         88  PS-ERROR                               VALUE 'N'.    00830032
008400     05  PS-EDIT-ERROR-SW               PIC  X(01)  VALUE 'N'.    00840032
008500         88  PS-NO-EDIT-ERRORS                      VALUE 'N'.    00850032
008600         88  PS-EDIT-ERRORS                         VALUE 'Y'.    00860032
008700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00870032
008800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00880032
008900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00890032
009000                                                                  00900032
009100 01  PV-PROGRAM-VARIABLES.                                        00910032
009200     05  PV-ONE                         PIC X       VALUE SPACE.  00920034
009300     05  PV-SUB                         PIC S9(04)  VALUE +0      00930032
009400                                                    COMP SYNC.    00940032
009500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00950032
009600                                                    COMP SYNC.    00960032
009700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00970032
009800                                                    COMP-3.       00980032
009900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00990032
010000                                                    COMP-3.       01000032
010100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01010032
010200                                                    COMP-3.       01020032
010300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01030032
010400                                                    COMP-3.       01040032
010500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01050032
010600                                                    COMP-3.       01060032
010700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01070032
010800                                                    COMP-3.       01080032
010900     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01090032
011000                                                    COMP-3.       01100032
011100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01110032
011200                                                    COMP SYNC.    01120032
011300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01130032
011400                                                    COMP SYNC.    01140032
011500     05  PV-ITEM                        PIC S9(04)  VALUE +0      01150032
011600                                                    COMP SYNC.    01160032
011700     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01170032
011800                                                    COMP SYNC.    01180032
011900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01190032
012000                                                    COMP SYNC.    01200032
012100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01210032
012200                                                    COMP SYNC.    01220032
012300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01230032
012400                                                    COMP SYNC.    01240032
012500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01250032
012600                                                    COMP SYNC.    01260032
012700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01270032
012800                                                    COMP SYNC.    01280032
012900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01290032
013000                                                    COMP SYNC.    01300032
013100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01310032
013200                                                    COMP SYNC.    01320032
013300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01330032
013400                                                    COMP SYNC.    01340032
013500     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01350032
013600                                                    COMP SYNC.    01360032
013700     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01370032
013800                                                    COMP SYNC.    01380032
013900     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01390032
014000                                                    COMP SYNC.    01400032
014100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01410032
014200                                                    COMP SYNC.    01420032
014300     05  PV-WORK-DATE.                                            01430032
014400         10  PV-WORK-MM                 PIC XX      VALUE SPACES. 01440032
014500         10  PV-SLASH1                  PIC X       VALUE '/'.    01450032
014600         10  PV-WORK-DD                 PIC XX      VALUE SPACES. 01460032
014700         10  PV-SLASH2                  PIC X       VALUE '/'.    01470032
014800         10  PV-WORK-YYYY               PIC XXXX    VALUE SPACES. 01480032
014900***************************************************************** 01490032
015000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01500032
015100**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01510032
015200**  APPLICATION-SPECIFIC COMMAREA.                              * 01520032
015300***************************************************************** 01530032
015400 01  LQW-LIST-QUEUE-WORK-AREA.                                    01540032
015500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01550032
015600     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01560032
015700                                        INDEXED BY LQW-IDX.       01570032
015800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01580032
015900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01590032
016000         10  LQW-SELECTED-SW            PIC  X(01).               01600032
016100             88  LQW-SELECT                         VALUE 'S'.    01610032
016200             88  LQW-DESELECT                       VALUE ' '.    01620032
016300         10  LQW-ACTION                 PIC  X(03).               01630032
016400         10  LQW-CAPBLTY-CDE            PIC  X(03).               01640032
016500         10  LQW-CAPBLTY-NAME           PIC  X(30).               01650032
016600         10  LQW-EFF-DATE               PIC  X(10).               01660032
016700         10  LQW-EXP-DATE               PIC  X(10).               01670032
016800                                                                  01680032
016900*---------------------------------------------------------------* 01690032
017000*  RECORD LAYOUT FOR THE VENDOR CAPABILITIES TEMP STORAGE QUEUE * 01700032
017100*---------------------------------------------------------------* 01710032
017200     COPY VNWS019.                                                01720032
017300                                                                  01730032
017400*---------------------------------------------------------------* 01740032
017500*    MAP LAYOUT                                                 * 01750032
017600*---------------------------------------------------------------* 01760032
017700     COPY VNKM028.                                                01770032
017800                                                                  01780032
017900 01  MR-OCCURS-LAYOUT                   REDEFINES  VN028AO.       01790032
018000     05  FILLER                         PIC X(74).                01800032
018100     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01810032
018200         10  MR-SELECTL                 PIC S9(04) COMP.          01820032
018300         10  MR-SELECTA                 PIC  X(01).               01830032
018400         10  MR-SELECTC                 PIC  X(01).               01840032
018500         10  MR-SELECTH                 PIC  X(01).               01850032
018600         10  MR-SELECTI                 PIC  X(01).               01860032
018700                                                                  01870032
018800         10  MR-ACTIONL                 PIC S9(04) COMP.          01880032
018900         10  MR-ACTIONA                 PIC  X(01).               01890032
019000         10  MR-ACTIONC                 PIC  X(01).               01900032
019100         10  MR-ACTIONH                 PIC  X(01).               01910032
019200         10  MR-ACTION                  PIC  X(03).               01920032
019300                                                                  01930032
019400         10  MR-CAPBLTY-NAMEL           PIC S9(04) COMP.          01940032
019500         10  MR-CAPBLTY-NAMEA           PIC  X(01).               01950032
019600         10  MR-CAPBLTY-NAMEC           PIC  X(01).               01960032
019700         10  MR-CAPBLTY-NAMEH           PIC  X(01).               01970032
019800         10  MR-CAPBLTY-NAME            PIC  X(30).               01980032
019900                                                                  01990032
020000         10  MR-EFF-DATEL               PIC S9(04) COMP.          02000032
020100         10  MR-EFF-DATEA               PIC  X(01).               02010032
020200         10  MR-EFF-DATEC               PIC  X(01).               02020032
020300         10  MR-EFF-DATEH               PIC  X(01).               02030032
020400         10  MR-EFF-DATE                PIC  X(10).               02040032
020500                                                                  02050032
020600         10  MR-EXP-DATEL               PIC S9(04) COMP.          02060032
020700         10  MR-EXP-DATEA               PIC  X(01).               02070032
020800         10  MR-EXP-DATEC               PIC  X(01).               02080032
020900         10  MR-EXP-DATEH               PIC  X(01).               02090032
021000         10  MR-EXP-DATE                PIC  X(10).               02100032
021100                                                                  02110032
021200*---------------------------------------------------------------* 02120032
021300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02130032
021400*---------------------------------------------------------------* 02140032
021500     COPY DPWS015.                                                02150032
021600                                                                  02160032
021700*---------------------------------------------------------------* 02170032
021800*    FUNCTION KEYS COPYBOOK.                                    * 02180032
021900*---------------------------------------------------------------* 02190032
022000     COPY DPWS016.                                                02200032
022100                                                                  02210032
022200*---------------------------------------------------------------* 02220032
022300*    NUMERIC EDIT LAYOUT.                                       * 02230032
022400*---------------------------------------------------------------* 02240032
022500     COPY DPWS010I.                                               02250032
022600                                                                  02260032
022700*---------------------------------------------------------------* 02270032
022800*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 02280038
022900*---------------------------------------------------------------* 02290032
023000     COPY DPWS030.                                                02300032
023000     COPY DPWS930.                                                02301038
023100                                                                  02310032
023200*---------------------------------------------------------------* 02320032
023300*    STANDARD COMMAREA.                                         * 02330032
023400*---------------------------------------------------------------* 02340032
023500     COPY DPWS020.                                                02350032
023600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02360032
023700*---------------------------------------------------------------* 02370032
023800* INTER-APPLICATION COMMAREA.                                   * 02380032
023900*   VNWS004 - IS THE INPUT LAYOUT WHEN COMING FROM THE VENDOR   * 02390032
024000*             HEADER SCREENS.                                   * 02400032
024100*   VNWS018 - IS THE INPUT LAYOUT FOR THE LIST PROGRAM AND THE  * 02410032
024200*             OUTPUT LAYOUT FOR A LOCAL-GO FUNCTION.            * 02420032
024300*---------------------------------------------------------------* 02430032
024400         10  INTER-APPL-COMM-AREA       PIC X(200).               02440032
024500     COPY VNWS004.                                                02450032
024600     COPY VNWS018.                                                02460032
024700         10  ASC-SPECIFIC-COMMAREA.                               02470032
024800             15  ASC-LIST-KEYS.                                   02480032
024900                 20  ASC-KEY-ENT-ID                  PIC S9(09)   02490032
025000                                                     COMP.        02500032
025100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02510032
025200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02520032
025300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02530032
025400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02540032
025500                                                                  02550032
025600                 20  ASC-ITEM-ARRAY.                              02560032
025700                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02570032
025800                         30  ASC-LIST-ITEM-NUMBER                 02580032
025900                                                     PIC S9(09)   02590032
026000                                                     COMP-3.      02600032
026100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02610032
026200                             88  ASC-VALID-SELECT    VALUE ' '    02620032
026300                                                           'S'    02630032
026400                                                           'B'    02640032
026500                                                           'E'.   02650032
026600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02660032
026700                             88  ASC-TEMP-SELECT     VALUE 'S'.   02670032
026800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02680032
026900                             88  ASC-TEMP-END        VALUE 'E'.   02690032
027000                         30  ASC-SELECTED-SW         PIC  X(01).  02700032
027100                             88  ASC-NO-SELECT       VALUE ' '.   02710032
027200                             88  ASC-SELECT          VALUE 'S'.   02720032
027300                             88  ASC-BEGIN           VALUE 'B'.   02730032
027400                             88  ASC-END             VALUE 'E'.   02740032
027500                         30  ASC-ACTION              PIC  X(03).  02750032
027600                         30  ASC-CAPBLTY-CDE         PIC  X(03).  02760032
027700                         30  ASC-CAPBLTY-NAME        PIC  X(30).  02770032
027800                         30  ASC-EFF-DATE            PIC  X(10).  02780032
027900                         30  ASC-EXP-DATE            PIC  X(10).  02790032
028000                                                                  02800032
028100             15  ASC-BLK-SUB                         PIC S9(04)   02810032
028200                                                          COMP    02820032
028300                                                          SYNC.   02830032
028400             15  ASC-ITEM-SUB                        PIC S9(04)   02840032
028500                                                          COMP    02850032
028600                                                          SYNC.   02860032
028700             15  ASC-SEL-SUB                         PIC S9(04)   02870032
028800                                                          COMP.   02880032
028900             15  ASC-SEL-ITEM                        PIC S9(04)   02890032
029000                                                          COMP.   02900032
029100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02910032
029200                                                          COMP-3. 02920032
029300             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02930032
029400                                                          COMP-3. 02940032
029500             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   02950032
029600                                                          COMP-3. 02960032
029700             15  ASC-FIRST-ITEM-IN-ERROR             PIC S9(09)   02970032
029800                                                          COMP-3. 02980032
029900             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02990032
030000                                                          COMP-3. 03000032
030100             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03010032
030200                                                          COMP-3. 03020032
030300             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03030032
030400                                                          COMP-3. 03040032
030500             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03050032
030600                                                          COMP    03060032
030700                                                          SYNC.   03070032
030800             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03080032
030900                                                          COMP-3. 03090032
031000             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03100032
031100                                                          COMP-3. 03110032
031200             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03120032
031300                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03130032
031400                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03140032
031500             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03150032
031600                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03160032
031700                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03170032
031800             15  ASC-LONGNAME-FOUND-SW               PIC  X(01).  03180034
031900                 88  ASC-LONGNAME-FOUND              VALUE 'Y'.   03190034
032000                 88  ASC-LONGNAME-NOT-FOUND          VALUE 'N'.   03200034
032100             15  ASC-LIST-QUEUE-NAME.                             03210032
032200                 20  ASC-LIST-TERM-ID                PIC  X(04).  03220032
032300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03230032
032400                                                          COMP-3. 03240032
032500                 20  ASC-LIST-SEQ                    PIC  9(01).  03250032
032600             15  ASC-SEL-QUEUE-NAME-IN               PIC  X(08).  03260032
032700             15  ASC-SEL-QUEUE-NAME-OUT.                          03270032
032800                 20  ASC-SEL-TERM-ID-OUT             PIC  X(04).  03280032
032900                 20  ASC-SEL-TASK-NUMBER-OUT         PIC S9(05)   03290032
033000                                                          COMP-3. 03300032
033100                 20  ASC-SEL-SEQ-OUT                 PIC  9(01).  03310032
033200                                                                  03320032
033300             15  ASC-START-ITEM-REQUEST.                          03330032
033400                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  03340032
033500             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  03350032
033600                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   03360032
033700             15  ASC-VENDOR-NAME                     PIC  X(30).  03370032
033800             15  ASC-VENDOR-ID                       PIC  X(09).  03380032
033900                                                                  03390032
034000*---------------------------------------------------------------* 03400032
034100*    ABEND PROCESSING COPYBOOK.                                 * 03410032
034200*---------------------------------------------------------------* 03420032
034300     COPY DPWS013.                                                03430032
034400                                                                  03440032
034500*---------------------------------------------------------------* 03450032
034600*    DB2 AREA FOR TENTNME                                       * 03460032
034700*---------------------------------------------------------------* 03470032
034800     EXEC SQL                                                     03480032
034900          INCLUDE TENTNME                                         03490032
035000     END-EXEC.                                                    03500032
035100                                                                  03510032
035200*---------------------------------------------------------------* 03520032
035300*    DB2 AREA FOR TEXTENT                                       * 03530032
035400*---------------------------------------------------------------* 03540032
035500     EXEC SQL                                                     03550032
035600          INCLUDE TEXTENT                                         03560032
035700     END-EXEC.                                                    03570032
035800                                                                  03580032
035900*---------------------------------------------------------------* 03590032
036000*    DB2 AREA FOR VNT_VND_CPBL                                  * 03600032
036100*---------------------------------------------------------------* 03610032
036200     EXEC SQL                                                     03620032
036300          INCLUDE VNT00001                                        03630032
036400     END-EXEC.                                                    03640032
036500                                                                  03650032
036600*---------------------------------------------------------------* 03660032
036700*    DB2 AREA FOR VNT_VND_CPBL_CDE                              * 03670032
036800*---------------------------------------------------------------* 03680032
036900     EXEC SQL                                                     03690032
037000          INCLUDE VNT00003                                        03700032
037100     END-EXEC.                                                    03710032
037200                                                                  03720032
037300*--------------------------------------------------------------*  03730034
037400* TABLE USED FOR EXISTENCE CHECKING                            *  03740034
037500*--------------------------------------------------------------*  03750034
037600     EXEC SQL                                                     03760034
037700          INCLUDE SYSDUMMY                                        03770034
037800     END-EXEC.                                                    03780034
037900                                                                  03790034
038000*---------------------------------------------------------------* 03800032
038100*    DB2 AREA FOR COMMUNICATIONS                                * 03810032
038200*---------------------------------------------------------------* 03820032
038300     EXEC SQL                                                     03830032
038400          INCLUDE SQLCA                                           03840032
038500     END-EXEC.                                                    03850032
038600                                                                  03860032
038700*---------------------------------------------------------------* 03870032
038800*   CURSOR TO SELECT VENDOR CAPABILITIES                        * 03880032
038900*---------------------------------------------------------------* 03890032
039000                                                                  03900032
039100     EXEC SQL                                                     03910032
039200             DECLARE CAPABILITY-CSR CURSOR FOR                    03920032
039300                SELECT VC.VND_CPBL_CDE                            03930032
039400                      ,VC.VND_CPBL_DESC                           03940032
039500                      ,COALESCE(VT1.EFF_BEG_DTE,'0001-01-01')     03950032
039600                      ,COALESCE(VT1.EFF_END_DTE,'0001-01-01')     03960032
039700                FROM VNT_VND_CPBL_CDE VC                          03970032
039800                 LEFT OUTER JOIN                                  03980032
039900               (SELECT A.VND_CPBL_CDE                             03990032
040000                      ,A.EFF_BEG_DTE                              04000032
040100                      ,A.EFF_END_DTE                              04010032
040200                 FROM VNT_VND_CPBL A                              04020032
040300                 WHERE A.ENT_ID = :DK-ENT-ID                      04030032
040400                   AND A.EFF_END_DTE =                            04040032
040500                      (SELECT MAX(B.EFF_END_DTE)                  04050032
040600                         FROM VNT_VND_CPBL B                      04060032
040700                        WHERE A.ENT_ID = B.ENT_ID                 04070032
040800                     AND A.VND_CPBL_CDE = B.VND_CPBL_CDE)) AS VT1 04080032
040900                   ON VT1.VND_CPBL_CDE = VC.VND_CPBL_CDE          04090032
041000                   WHERE VC.ACTV_IND = 'Y'                        04100032
041100                   ORDER BY VND_CPBL_DESC                         04110032
041200                                                                  04120032
041300     END-EXEC.                                                    04130032
041400                                                                  04140032
041500 LINKAGE SECTION.                                                 04150032
041600                                                                  04160032
041700 01  DFHCOMMAREA.                                                 04170032
041800     05  FILLER  OCCURS 1 TO 4072 TIMES                           04180032
041900                 DEPENDING ON EIBCALEN.                           04190032
042000         10  FILLER  PIC X.                                       04200032
042100                                                                  04210032
042200 PROCEDURE DIVISION.                                              04220032
042300***************************************************************** 04230032
042400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 04240032
042500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 04250032
042600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 04260032
042700***************************************************************** 04270032
042800 0000-MAIN-MODULE.                                                04280032
042900                                                                  04290032
043000     INITIALIZE DP030-CICS-API-FIELDS.                            04300032
043100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04310032
043200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04320032
043300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04330032
043400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04340032
043500     MOVE LENGTH OF VN028AI        TO DP030-MAP-LENGTH (1).       04350032
043600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04360032
043700     PERFORM 0001-CALL-CICS-ARCH-API.                             04370032
043800                                                                  04380032
043900     PERFORM 1000-CONTROL-PROCESSING                              04390032
044000                                                                  04400032
044100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04410032
044200     PERFORM 0001-CALL-CICS-ARCH-API.                             04420032
044300                                                                  04430032
044400***************************************************************** 04440032
044500**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 04450032
044600**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 04460032
044700***************************************************************** 04470032
044800 0001-CALL-CICS-ARCH-API.                                         04480032
044900                                                                  04490032
045000*    CALL 'DPKCS030' USING DFHEIBLK                               04500038
045000     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04501038
045100                           DFHCOMMAREA                            04510032
045200                           DP030-CICS-API-FIELDS                  04520032
045300                           DP020-STANDARD-COMMAREA                04530032
045400                           VN028AI.                               04540032
045500                                                                  04550032
045600     IF  DP030-RC-CALL-SUCCESSFUL                                 04560032
045700         CONTINUE                                                 04570032
045800     ELSE                                                         04580032
045900         SET DP013-NO-ROLLBACK                                    04590032
046000             DP013-XCTL-DISPLAY-RESTART                           04600032
046100             DP013-CICS-ABEND      TO TRUE                        04610032
046200         MOVE '0001-CALL-CICS-ARCH-API'                           04620032
046300                                   TO DP013-PARAGRAPH             04630032
046400*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX04640038
046500*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      04650038
046400         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04651038
046500-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04652038
046600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04660032
046700         PERFORM DP013-0000-PROCESS-ABEND                         04670032
046800     END-IF.                                                      04680032
046900                                                                  04690032
047000*----------------------------------------------------------------*04700032
047100* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04710032
047200* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04720032
047300*                                                                *04730032
047400* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04740032
047500*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04750032
047600*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04760032
047700*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04770032
047800*----------------------------------------------------------------*04780032
047900 1000-CONTROL-PROCESSING.                                         04790032
048000                                                                  04800032
048100     EVALUATE TRUE                                                04810032
048200         WHEN DP020-NEXT-ACT-INITIAL                              04820032
048300             INITIALIZE ASC-SPECIFIC-COMMAREA                     04830032
048400             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04840032
048500                                      ASC-SEL-TERM-ID-OUT         04850032
048600             MOVE DP020-SRC-TASK-NUMBER                           04860032
048700                                   TO ASC-LIST-TASK-NUMBER        04870032
048800                                      ASC-SEL-TASK-NUMBER-OUT     04880032
048900             MOVE PC-LIST-QUEUE-SEQ                               04890032
049000                                   TO ASC-LIST-SEQ                04900032
049100             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             04910032
049200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04920032
049300             IF  PS-COMMAREA-NOT-VALID                            04930032
049400                 SET DP020-MSG-FATAL                              04940032
049500                     DP020-NEXT-ACT-APPL-ERROR                    04950032
049600                                   TO TRUE                        04960032
049700             ELSE                                                 04970032
049800                 PERFORM 4000-BUILD-INITIAL-PANEL                 04980032
049900                 IF ASC-NUMBER-OF-ITEMS-READ = ZERO               04990032
050000                     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE        05000032
050100                     MOVE PC-TSYMSG-00148                         05010032
050200                                   TO DP020-MSG-NUMBER            05020032
050300                     SET DP020-MSG-WARNING TO TRUE                05030032
050400                 END-IF                                           05040032
050500             END-IF                                               05050032
050600                                                                  05060032
050700         WHEN DP020-NEXT-ACT-READ-MAP                             05070032
050800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05080032
050900                                   TO PV-TOP-ITEM                 05090032
051000             PERFORM 2000-PROCESS-PANEL                           05100032
051100                                                                  05110032
051200         WHEN DP020-NEXT-ACT-RETURN                               05120032
051300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05130032
051400                                   TO PV-TOP-ITEM                 05140032
051500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05150032
051600             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05160032
051700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05170032
051800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05180032
051900                                                                  05190032
052000         WHEN OTHER                                               05200032
052100             SET DP013-LOGIC-ABEND TO TRUE                        05210032
052200             SET DP013-NO-ROLLBACK TO TRUE                        05220032
052300             MOVE '1000-CONTROL-PROCESSING'                       05230032
052400                                   TO DP013-PARAGRAPH             05240032
052500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05250032
052600                                   TO DP013-MESSAGE-TEXT(1)       05260032
052700             PERFORM DP013-0000-PROCESS-ABEND                     05270032
052800     END-EVALUATE.                                                05280032
052900                                                                  05290032
053000*----------------------------------------------------------------*05300032
053100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05310032
053200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05320032
053300*----------------------------------------------------------------*05330032
053400 1100-PROCESS-INTER-APPL-COMM.                                    05340032
053500                                                                  05350032
053600     MOVE SPACE TO ASC-START-ITEM-REQUEST.                        05360032
053700     EVALUATE DP020-INT-APPL-FORMAT-IND                           05370032
053800         WHEN PC-INTER-APPL-VEND-DTL                              05380032
053900             MOVE VN004-ENT-ID TO ASC-KEY-ENT-ID                  05390032
054000                                  DK-ENT-ID                       05400032
054100             PERFORM 1110-SELECT-ENTERPRISE-NAME                  05410032
054200                                                                  05420032
054300         WHEN OTHER                                               05430032
054400             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER            05440032
054500             SET PS-COMMAREA-NOT-VALID                            05450032
054600                                   TO TRUE                        05460032
054700     END-EVALUATE.                                                05470032
054800                                                                  05480032
054900 1110-SELECT-ENTERPRISE-NAME.                                     05490032
055000                                                                  05500032
055100     PERFORM                                                      05510032
055200         WITH TEST AFTER                                          05520032
055300         VARYING PV-RETRY-COUNTER                                 05530032
055400         FROM 1 BY 1                                              05540032
055500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05550032
055600            OR (SQLCODE = +0))                                    05560032
055700                                                                  05570032
055800         EXEC SQL                                                 05580032
055900             SELECT A.ENT_NAME_DESC                               05590032
056000                  , B.DUN_NBR                                     05600032
056100              INTO  :ENTNME-ENT-NAME-DESC                         05610032
056200                  , :EXTENT-DUN-NBR                               05620032
056300              FROM  TENTNME A                                     05630032
056400                 ,  TEXTENT B                                     05640032
056500              WHERE A.ENT_ID   = :DK-ENT-ID                       05650032
056600                AND A.ENT_ID   = B.ENT_ID                         05660032
056700                AND A.TYPE_CDE = '01'                             05670032
056800         END-EXEC                                                 05680032
056900                                                                  05690032
057000         EVALUATE TRUE                                            05700032
057100             WHEN SQLCODE = ZERO                                  05710032
057200             WHEN SQLCODE = +100                                  05720032
057300             WHEN SQLCODE = -904                                  05730032
057400             WHEN SQLCODE = -913                                  05740032
057500                 CONTINUE                                         05750032
057600             WHEN SQLWARN0 NOT = SPACES                           05760032
057700             WHEN SQLCODE < ZERO                                  05770032
057800             WHEN SQLCODE > ZERO                                  05780032
057900                 MOVE '1110-SELECT-ENTERPRISE-NAME'               05790032
058000                                   TO DP013-PARAGRAPH             05800032
058100                 MOVE 'SELECT ENTERPRISE NAME'                    05810032
058200                                   TO DP013-MESSAGE-TEXT (1)      05820032
058300                 MOVE SQLCA        TO DP013-SQLCA                 05830032
058400                 MOVE 'TENTNME'    TO DP013-SQLCA                 05840032
058500                 SET DP013-DB2-ABEND                              05850032
058600                     DP013-XCTL-DISPLAY-RESTART                   05860032
058700                                   TO TRUE                        05870032
058800                 PERFORM DP013-0000-PROCESS-ABEND                 05880032
058900         END-EVALUATE                                             05890032
059000     END-PERFORM.                                                 05900032
059100                                                                  05910032
059200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         05920032
059300         MOVE '1110-SELECT-ENTERPRISE-NAME'                       05930032
059400                                   TO DP013-PARAGRAPH             05940032
059500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     05950032
059600                                   TO DP013-MESSAGE-TEXT (1)      05960032
059700         MOVE 'ENTERPRISE NAME'    TO DP013-MESSAGE-TEXT (2)      05970032
059800         MOVE SQLCA                TO DP013-SQLCA                 05980032
059900         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    05990032
060000         SET DP013-DB2-ABEND                                      06000032
060100             DP013-XCTL-DISPLAY-RESTART                           06010032
060200                                   TO TRUE                        06020032
060300         PERFORM DP013-0000-PROCESS-ABEND                         06030032
060400     END-IF.                                                      06040032
060500                                                                  06050032
060600     IF SQLCODE = ZERO                                            06060032
060700          SET PS-COMMAREA-VALID    TO TRUE                        06070032
060800          MOVE ENTNME-ENT-NAME-DESC                               06080032
060900                                   TO ASC-VENDOR-NAME             06090032
061000          MOVE EXTENT-DUN-NBR      TO ASC-VENDOR-ID               06100032
061100     ELSE                                                         06110032
061200          MOVE PC-TSYMSG-00398     TO DP020-MSG-NUMBER            06120032
061300          SET PS-COMMAREA-NOT-VALID                               06130032
061400                                   TO TRUE                        06140032
061500     END-IF.                                                      06150032
061600                                                                  06160032
061700*----------------------------------------------------------------*06170032
061800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06180032
061900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06190032
062000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06200032
062100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06210032
062200* FUNCTION KEYS CAN GET THIS FAR.                                *06220032
062300*----------------------------------------------------------------*06230032
062400 2000-PROCESS-PANEL.                                              06240032
062500                                                                  06250032
062600     EVALUATE TRUE                                                06260032
062700         WHEN DP020-SRC-AID = DP016-CLEAR                         06270032
062800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06280032
062900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06290032
063000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06300032
063100                                                                  06310032
063200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06320032
063300             MOVE ASC-KEY-ENT-ID   TO DK-ENT-ID                   06330032
063400             PERFORM 2050-DELETE-LIST-QUEUE                       06340032
063500             PERFORM 4000-BUILD-INITIAL-PANEL                     06350032
063600                                                                  06360032
063700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06370032
063800             PERFORM 2140-DESELECT-ALL-ITEMS                      06380032
063900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06390032
064000                                                                  06400032
064100         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06410032
064200             PERFORM 2150-SELECT-ALL-ITEMS                        06420032
064300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06430032
064400                                                                  06440032
064500         WHEN OTHER                                               06450032
064600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06460032
064700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06470032
064800             IF  PS-NO-ERROR                                      06480032
064900                 SET DP030-CONTINUE-GO                            06490032
065000                                   TO TRUE                        06500032
065100                 PERFORM 2100-CHECK-FUNCTION-KEY                  06510032
065200             ELSE                                                 06520032
065300                 SET DP030-OVERRIDE-GO                            06530032
065400                                 TO TRUE                          06540032
065500             END-IF                                               06550032
065600     END-EVALUATE.                                                06560032
065700                                                                  06570032
065800*----------------------------------------------------------------*06580032
065900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06590032
066000*----------------------------------------------------------------*06600032
066100 2050-DELETE-LIST-QUEUE.                                          06610032
066200                                                                  06620032
066300     EXEC CICS                                                    06630032
066400         DELETEQ TS                                               06640032
066500             QUEUE (ASC-LIST-QUEUE-NAME)                          06650032
066600             RESP  (PV-CICS-RESP)                                 06660032
066700     END-EXEC.                                                    06670032
066800                                                                  06680032
066900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06690032
067000        (PV-CICS-RESP = DFHRESP(QIDERR))                          06700032
067100         CONTINUE                                                 06710032
067200     ELSE                                                         06720032
067300         SET DP013-CICS-ABEND      TO TRUE                        06730032
067400         SET DP013-NO-ROLLBACK     TO TRUE                        06740032
067500                                                                  06750032
067600         MOVE '2050-DELETE-LIST-QUEUE'                            06760032
067700                                   TO DP013-PARAGRAPH             06770032
067800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06780032
067900                                   TO DP013-MESSAGE-TEXT (1)      06790032
068000         PERFORM DP013-0000-PROCESS-ABEND                         06800032
068100     END-IF.                                                      06810032
068200                                                                  06820032
068300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06830032
068400                                                                  06840032
068500*----------------------------------------------------------------*06850032
068600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06860032
068700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06870032
068800* CICS ARCHITECTURE API.                                         *06880032
068900*----------------------------------------------------------------*06890032
069000 2100-CHECK-FUNCTION-KEY.                                         06900032
069100                                                                  06910032
069200     EVALUATE TRUE                                                06920032
069300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06930032
069400             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              06940032
069500                 SET PS-NO-EDIT-ERRORS   TO TRUE                  06950032
069600                 PERFORM 2300-ADD-EDITS                           06960032
069700                 IF PS-NO-EDIT-ERRORS                             06970032
069800                     PERFORM 2900-PREPARE-COMMAREA                06980032
069900                     PERFORM 2600-CHECK-PARTNER-STATS             06990034
070000                 ELSE                                             07000032
070100                     SET DP030-OVERRIDE-GO                        07010032
070200                         DP030-SET-CURSOR-APPL-1                  07020032
070300                         DP020-MSG-FATAL  TO TRUE                 07030032
070400                     MOVE -1  TO MR-SELECTL (1)                   07040032
070500                     MOVE PC-TSYMSG-03367 TO DP020-MSG-NUMBER     07050032
070600                 END-IF                                           07060032
070700             ELSE                                                 07070032
070800                 SET DP030-SET-CURSOR-APPL-1                      07080032
070900                     DP030-OVERRIDE-GO   TO TRUE                  07090032
071000*      ---- A LIST ITEM MUST BE SELECTED   -----------            07100032
071100                 MOVE PC-TSYMSG-00057                             07110032
071200                                   TO DP020-MSG-NUMBER            07120032
071300                 SET DP020-MSG-FATAL                              07130032
071400                                   TO TRUE                        07140032
071500                 MOVE -1  TO MR-SELECTL (1)                       07150032
071600             END-IF                                               07160032
071700                                                                  07170032
071800         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              07180032
071900             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07190032
072000                 SET PS-NO-EDIT-ERRORS   TO TRUE                  07200032
072100                 PERFORM 2400-INQUIRE-EDITS                       07210032
072200                 IF PS-NO-EDIT-ERRORS                             07220032
072300                     PERFORM 2900-PREPARE-COMMAREA                07230032
072400                 ELSE                                             07240032
072500                     SET DP030-OVERRIDE-GO                        07250032
072600                         DP030-SET-CURSOR-APPL-1                  07260032
072700                         DP020-MSG-FATAL  TO TRUE                 07270032
072800                     MOVE -1  TO MR-SELECTL (1)                   07280032
072900                     MOVE PC-TSYMSG-03369 TO DP020-MSG-NUMBER     07290032
073000                 END-IF                                           07300032
073100             ELSE                                                 07310032
073200                 SET DP030-SET-CURSOR-APPL-1                      07320032
073300                     DP030-OVERRIDE-GO   TO TRUE                  07330032
073400*      ---- A LIST ITEM MUST BE SELECTED   -----------            07340032
073500                 MOVE PC-TSYMSG-00057                             07350032
073600                                   TO DP020-MSG-NUMBER            07360032
073700                 SET DP020-MSG-FATAL                              07370032
073800                                   TO TRUE                        07380032
073900                 MOVE -1  TO MR-SELECTL (1)                       07390032
074000             END-IF                                               07400032
074100                                                                  07410032
074200         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              07420032
074300             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07430032
074400                 SET PS-NO-EDIT-ERRORS   TO TRUE                  07440032
074500                 PERFORM 2500-UPDATE-EDITS                        07450032
074600                 IF PS-NO-EDIT-ERRORS                             07460032
074700                     PERFORM 2900-PREPARE-COMMAREA                07470032
074800                     PERFORM 2600-CHECK-PARTNER-STATS             07480034
074900                 ELSE                                             07490032
075000                     SET DP030-OVERRIDE-GO                        07500032
075100                         DP030-SET-CURSOR-APPL-1                  07510032
075200                         DP020-MSG-FATAL  TO TRUE                 07520032
075300                     MOVE -1  TO MR-SELECTL (1)                   07530032
075400                     MOVE PC-TSYMSG-03368 TO DP020-MSG-NUMBER     07540032
075500                 END-IF                                           07550032
075600             ELSE                                                 07560032
075700                 SET DP030-SET-CURSOR-APPL-1                      07570032
075800                     DP030-OVERRIDE-GO   TO TRUE                  07580032
075900*      ---- A LIST ITEM MUST BE SELECTED   -----------            07590032
076000                 MOVE PC-TSYMSG-00057                             07600032
076100                                   TO DP020-MSG-NUMBER            07610032
076200                 SET DP020-MSG-FATAL                              07620032
076300                                   TO TRUE                        07630032
076400                 MOVE -1  TO MR-SELECTL (1)                       07640032
076500             END-IF                                               07650032
076600                                                                  07660032
076700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07670032
076800             MOVE +1               TO PV-TOP-ITEM                 07680032
076900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07690032
077000             PERFORM 3200-RESET-ATTRIBUTES                        07700032
077100                                                                  07710032
077200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07720032
077300             PERFORM 2110-BROWSE-BACKWARD                         07730032
077400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07740032
077500             PERFORM 3200-RESET-ATTRIBUTES                        07750032
077600                                                                  07760032
077700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07770032
077800             PERFORM 2120-BROWSE-FORWARD                          07780032
077900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07790032
078000             PERFORM 3200-RESET-ATTRIBUTES                        07800032
078100                                                                  07810032
078200         WHEN DP020-SRC-AID = DP016-ENTER                         07820032
078300             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07830032
078400             IF  PS-ERROR                                         07840032
078500                 CONTINUE                                         07850032
078600             ELSE                                                 07860032
078700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07870032
078800             END-IF                                               07880032
078900                                                                  07890032
079000         WHEN OTHER                                               07900032
079100             SET DP013-NO-ROLLBACK                                07910032
079200                 DP013-XCTL-DISPLAY-RESTART                       07920032
079300                 DP013-CICS-ABEND  TO TRUE                        07930032
079400             MOVE '2100-CHECK-FUNCTION-KEY'                       07940032
079500                                   TO DP013-PARAGRAPH             07950032
079600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07960032
079700                                   TO DP013-MESSAGE-TEXT (1)      07970032
079800             PERFORM DP013-0000-PROCESS-ABEND                     07980032
079900     END-EVALUATE.                                                07990032
080000                                                                  08000032
080100*----------------------------------------------------------------*08010032
080200*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08020032
080300*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08030032
080400*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08040032
080500*    MESSAGE.                                                    *08050032
080600*----------------------------------------------------------------*08060032
080700 2110-BROWSE-BACKWARD.                                            08070032
080800                                                                  08080032
080900     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08090032
081000         GIVING PV-TOP-ITEM.                                      08100032
081100                                                                  08110032
081200     IF  ((PV-TOP-ITEM < +1)                                      08120032
081300       OR (PV-TOP-ITEM = +1))                                     08130032
081400         MOVE +1                   TO PV-TOP-ITEM                 08140032
081500*        -- TOP OF LIST --                                        08150032
081600         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08160032
081700         SET DP020-MSG-INFORMATIONAL TO TRUE                      08170032
081800     END-IF.                                                      08180032
081900                                                                  08190032
082000*----------------------------------------------------------------*08200032
082100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08210032
082200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08220032
082300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08230032
082400*----------------------------------------------------------------*08240032
082500 2120-BROWSE-FORWARD.                                             08250032
082600                                                                  08260032
082700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08270032
082800         GIVING PV-TOP-ITEM.                                      08280032
082900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08290032
083000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08300032
083100                                   TO PV-TOP-ITEM                 08310032
083200*        -- BOTTOM OF LIST --                                     08320032
083300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08330032
083400         SET DP020-MSG-INFORMATIONAL                              08340032
083500                                   TO TRUE                        08350032
083600     ELSE                                                         08360032
083700         COMPUTE PV-BOTTOM-ITEM =                                 08370032
083800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08380032
083900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08390032
084000*            -- BOTTOM OF LIST --                                 08400032
084100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08410032
084200             SET DP020-MSG-INFORMATIONAL                          08420032
084300                                   TO TRUE                        08430032
084400         END-IF                                                   08440032
084500     END-IF.                                                      08450032
084600                                                                  08460032
084700*----------------------------------------------------------------*08470032
084800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08480032
084900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08490032
085000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08500032
085100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08510032
085200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08520032
085300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08530032
085400*----------------------------------------------------------------*08540032
085500 2130-CHECK-FOR-JUMP-BROWSE.                                      08550032
085600                                                                  08560032
085700     SET PS-NO-ERROR               TO TRUE.                       08570032
085800     IF (ASC-START-ITEM-REQUEST = SPACE)                          08580032
085900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08590032
086000                                   TO PV-TOP-ITEM                 08600032
086100     ELSE                                                         08610032
086200         MOVE ASC-START-ITEM-REQUEST                              08620032
086300                                   TO DP010I-UNEDITED-FIELD       08630032
086400         MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08640032
086500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08650032
086600         SET DP010I-NEGATIVE-NOT-ALLOWED                          08660032
086700                                   TO TRUE                        08670032
086810         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08681035
086820                         USING DP010I-NUMERIC-EDIT-AREA           08682035
086900                                                                  08690032
087000         IF  NOT DP010I-ERROR-DETECTED                            08700032
087100             MOVE DP010I-NUMERIC-FIELD                            08710032
087200                                   TO  ASC-START-ITEM-REQUEST-N   08720032
087300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08730032
087400                 IF  ASC-START-ITEM-REQUEST-N >                   08740032
087500                                          ASC-NUMBER-OF-ITEMS-READ08750032
087600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08760032
087700                     COMPUTE PV-TOP-ITEM =                        08770032
087800                             ASC-NUMBER-OF-ITEMS-READ             08780032
087900                             - PC-ITEMS-PER-PANEL + 1             08790032
088000                     IF  PV-TOP-ITEM < +1                         08800032
088100                         MOVE +1   TO PV-TOP-ITEM                 08810032
088200                         MOVE PC-TSYMSG-00070                     08820032
088300                                   TO DP020-MSG-NUMBER            08830032
088400                         SET DP020-MSG-INFORMATIONAL              08840032
088500                                   TO TRUE                        08850032
088600                     END-IF                                       08860032
088700                 ELSE                                             08870032
088800                     MOVE ASC-START-ITEM-REQUEST-N                08880032
088900                                   TO PV-TOP-ITEM                 08890032
089000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08900032
089100                     COMPUTE PV-BOTTOM-ITEM =                     08910032
089200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08920032
089300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08930032
089400*                        -- BOTTOM OF LIST --                     08940032
089500                         MOVE PC-TSYMSG-00070                     08950032
089600                                   TO DP020-MSG-NUMBER            08960032
089700                         SET DP020-MSG-INFORMATIONAL              08970032
089800                                   TO TRUE                        08980032
089900                     END-IF                                       08990032
090000                 END-IF                                           09000032
090100             ELSE                                                 09010032
090200*                --- VALUE OUT OF RANGE ----                      09020032
090300                 MOVE PC-TSYMSG-00101                             09030032
090400                                   TO DP020-MSG-NUMBER            09040032
090500                 MOVE -1           TO ASTRTITL                    09050032
090600                 SET DP030-SET-CURSOR-APPL-1                      09060032
090700                                   TO TRUE                        09070032
090800                 MOVE DP015-REVERSE                               09080032
090900                                   TO ASTRTITH                    09090032
091000                 MOVE DP015-RED    TO ASTRTITC                    09100032
091100                 MOVE DP015-UNP-NUM-BRT-MDT                       09110032
091200                                   TO ASTRTITA                    09120032
091300                 SET DP020-MSG-FATAL                              09130032
091400                                   TO TRUE                        09140032
091500                 SET PS-ERROR      TO TRUE                        09150032
091600             END-IF                                               09160032
091700                                                                  09170032
091800         ELSE                                                     09180032
091900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09190032
092000             MOVE -1               TO ASTRTITL                    09200032
092100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09210032
092200             MOVE DP015-REVERSE    TO ASTRTITH                    09220032
092300             MOVE DP015-RED        TO ASTRTITC                    09230032
092400             MOVE DP015-UNP-NUM-BRT-MDT                           09240032
092500                                   TO ASTRTITA                    09250032
092600             SET DP020-MSG-FATAL   TO TRUE                        09260032
092700             SET PS-ERROR          TO TRUE                        09270032
092800         END-IF                                                   09280032
092900     END-IF.                                                      09290032
093000                                                                  09300032
093100*----------------------------------------------------------------*09310032
093200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09320032
093300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09330032
093400*----------------------------------------------------------------*09340032
093500 2140-DESELECT-ALL-ITEMS.                                         09350032
093600                                                                  09360032
093700     MOVE +1                       TO ASC-BLK-SUB.                09370032
093800                                                                  09380032
093900     PERFORM 2141-CLEAR-SELECTED-INDS                             09390032
094000         VARYING ASC-ITEM-SUB                                     09400032
094100         FROM 1 BY 1                                              09410032
094200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09420032
094300                                                                  09430032
094400     ADD +1                        TO ASC-BLK-SUB.                09440032
094500                                                                  09450032
094600     PERFORM 2141-CLEAR-SELECTED-INDS                             09460032
094700         VARYING ASC-ITEM-SUB                                     09470032
094800         FROM 1 BY 1                                              09480032
094900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09490032
095000                                                                  09500032
095100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09510032
095200                                   TO PV-LIST-ITEM-NUMBER.        09520032
095300                                                                  09530032
095400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09540032
095500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09550032
095600                                                                  09560032
095700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09570032
095800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09580032
095900         MOVE +1                   TO ASC-BLK-SUB                 09590032
096000                                                                  09600032
096100         PERFORM 5100-WRITE-TEMP-STORAGE                          09610032
096200                                                                  09620032
096300         MOVE +1                   TO PV-BLOCK-NUMBER             09630032
096400                                                                  09640032
096500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09650032
096600             PV-FIRST-BLOCK-IN-ARRAY - 1                          09660032
096700                                                                  09670032
096800         PERFORM                                                  09680032
096900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09690032
097000                                                                  09700032
097100             PERFORM 4410-READ-TEMP-STORAGE                       09710032
097200                                                                  09720032
097300             PERFORM 2141-CLEAR-SELECTED-INDS                     09730032
097400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09740032
097500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09750032
097600                                                                  09760032
097700             PERFORM 5100-WRITE-TEMP-STORAGE                      09770032
097800                                                                  09780032
097900             ADD +1                TO PV-BLOCK-NUMBER             09790032
098000                                                                  09800032
098100         END-PERFORM                                              09810032
098200                                                                  09820032
098300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09830032
098400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09840032
098500                                                                  09850032
098600         PERFORM                                                  09860032
098700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09870032
098800                   ASC-HIGHEST-BLOCK-WRITTEN                      09880032
098900                                                                  09890032
099000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09900032
099100                                   TO PV-BLOCK-NUMBER             09910032
099200                                                                  09920032
099300             PERFORM 4410-READ-TEMP-STORAGE                       09930032
099400                                                                  09940032
099500             PERFORM 2141-CLEAR-SELECTED-INDS                     09950032
099600                 VARYING ASC-ITEM-SUB                             09960032
099700                 FROM 1 BY 1                                      09970032
099800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09980032
099900                                                                  09990032
100000             PERFORM 5100-WRITE-TEMP-STORAGE                      10000032
100100                                                                  10010032
100200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10020032
100300                                                                  10030032
100400         END-PERFORM                                              10040032
100500                                                                  10050032
100600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10060032
100700                                   TO PV-BLOCK-NUMBER             10070032
100800                                                                  10080032
100900         PERFORM 4410-READ-TEMP-STORAGE                           10090032
101000     END-IF.                                                      10100032
101100                                                                  10110032
101200     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS10120032
101300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 10130032
101400     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  10140032
101500                                                                  10150032
101600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10160032
101700                                                                  10170032
101800*----------------------------------------------------------------*10180032
101900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10190032
102000*----------------------------------------------------------------*10200032
102100 2141-CLEAR-SELECTED-INDS.                                        10210032
102200                                                                  10220032
102300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10230032
102400             NOT EQUAL ZERO                                       10240032
102500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10250032
102600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10260032
102700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10270032
102800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10280032
102900                                   TO TRUE                        10290032
103000         END-IF                                                   10300032
103100     END-IF.                                                      10310032
103200                                                                  10320032
103300*----------------------------------------------------------------*10330032
103400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *10340032
103500*  FOR ALL ITEMS.                                                *10350032
103600*----------------------------------------------------------------*10360032
103700 2150-SELECT-ALL-ITEMS.                                           10370032
103800                                                                  10380032
103900     MOVE +1                       TO ASC-BLK-SUB.                10390032
104000                                                                  10400032
104100     PERFORM 2151-SET-SELECTED-INDS                               10410032
104200         VARYING ASC-ITEM-SUB                                     10420032
104300         FROM 1 BY 1                                              10430032
104400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10440032
104500                                                                  10450032
104600     ADD +1                        TO ASC-BLK-SUB.                10460032
104700                                                                  10470032
104800     PERFORM 2151-SET-SELECTED-INDS                               10480032
104900         VARYING ASC-ITEM-SUB                                     10490032
105000         FROM 1 BY 1                                              10500032
105100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10510032
105200                                                                  10520032
105300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10530032
105400                                   TO PV-LIST-ITEM-NUMBER.        10540032
105500                                                                  10550032
105600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10560032
105700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10570032
105800                                                                  10580032
105900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10590032
106000        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10600032
106100         MOVE +1                   TO ASC-BLK-SUB                 10610032
106200                                                                  10620032
106300         PERFORM 5100-WRITE-TEMP-STORAGE                          10630032
106400                                                                  10640032
106500         MOVE +1                   TO PV-BLOCK-NUMBER             10650032
106600                                                                  10660032
106700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10670032
106800             PV-FIRST-BLOCK-IN-ARRAY - 1                          10680032
106900                                                                  10690032
107000         PERFORM                                                  10700032
107100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10710032
107200                                                                  10720032
107300             PERFORM 4410-READ-TEMP-STORAGE                       10730032
107400                                                                  10740032
107500             PERFORM 2151-SET-SELECTED-INDS                       10750032
107600                 VARYING ASC-ITEM-SUB                             10760032
107700                 FROM 1 BY 1                                      10770032
107800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10780032
107900                                                                  10790032
108000             PERFORM 5100-WRITE-TEMP-STORAGE                      10800032
108100                                                                  10810032
108200             ADD +1                TO PV-BLOCK-NUMBER             10820032
108300                                                                  10830032
108400         END-PERFORM                                              10840032
108500                                                                  10850032
108600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10860032
108700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10870032
108800                                                                  10880032
108900         PERFORM                                                  10890032
109000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10900032
109100                   ASC-HIGHEST-BLOCK-WRITTEN                      10910032
109200                                                                  10920032
109300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10930032
109400                                   TO PV-BLOCK-NUMBER             10940032
109500                                                                  10950032
109600             PERFORM 4410-READ-TEMP-STORAGE                       10960032
109700                                                                  10970032
109800             PERFORM 2151-SET-SELECTED-INDS                       10980032
109900                 VARYING ASC-ITEM-SUB                             10990032
110000                 FROM 1 BY 1                                      11000032
110100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11010032
110200                                                                  11020032
110300             PERFORM 5100-WRITE-TEMP-STORAGE                      11030032
110400                                                                  11040032
110500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11050032
110600                                                                  11060032
110700         END-PERFORM                                              11070032
110800                                                                  11080032
110900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11090032
111000                                   TO PV-BLOCK-NUMBER             11100032
111100                                                                  11110032
111200         PERFORM 4410-READ-TEMP-STORAGE                           11120032
111300     END-IF.                                                      11130032
111400                                                                  11140032
111500                                                                  11150032
111600     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11160032
111700                       ASC-NUMBER-OF-SELECTED-ITEMS.              11170032
111800                                                                  11180032
111900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11190032
112000                                                                  11200032
112100*----------------------------------------------------------------*11210032
112200*    MARK EACH ITEM AS BEING SELECTED.                           *11220032
112300*----------------------------------------------------------------*11230032
112400 2151-SET-SELECTED-INDS.                                          11240032
112500                                                                  11250032
112600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11260032
112700             NOT EQUAL ZERO                                       11270032
112800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11280032
112900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11290032
113000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11300032
113100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11310032
113200                               TO  TRUE                           11320032
113300         END-IF                                                   11330032
113400     END-IF.                                                      11340032
113500                                                                  11350032
113600***************************************************************** 11360032
113700** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    * 11370032
113800** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. * 11380032
113900***************************************************************** 11390032
114000 2200-MOVE-SCREEN-TO-COMMAREA.                                    11400032
114100                                                                  11410032
114200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11420032
114300     MOVE +1                       TO PV-SUB.                     11430032
114400                                                                  11440032
114500     PERFORM 3100-SET-SUBSCRIPTS.                                 11450032
114600     IF  ASTRTITL > ZERO                                          11460032
114700         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          11470032
114800     ELSE                                                         11480032
114900         IF  ASTRTITF = DP015-ERASE-EOF                           11490032
115000             INITIALIZE ASC-START-ITEM-REQUEST                    11500032
115100         END-IF                                                   11510032
115200     END-IF.                                                      11520032
115300     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11530032
115400         VARYING PV-SUB                                           11540032
115500         FROM 1 BY 1                                              11550032
115600         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11560032
115700                                                                  11570032
115800***************************************************************** 11580032
115900** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA* 11590032
116000***************************************************************** 11600032
116100 2210-MOVE-LINES-TO-COMMAREA.                                     11610032
116200                                                                  11620032
116300     IF  MR-SELECTL (PV-SUB) > ZERO                               11630032
116400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             11640032
116500         MOVE MR-SELECTI (PV-SUB)                                 11650032
116600                                   TO ASC-TEMP-SELECTED-SW        11660032
116700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11670032
116800     ELSE                                                         11680032
116900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11690032
117000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     11700032
117100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        11710032
117200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11720032
117300         END-IF                                                   11730032
117400     END-IF.                                                      11740032
117500     ADD +1                        TO ASC-ITEM-SUB.               11750032
117600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11760032
117700         ADD +1                    TO ASC-BLK-SUB                 11770032
117800         MOVE +1                   TO ASC-ITEM-SUB                11780032
117900     END-IF.                                                      11790032
118000                                                                  11800032
118100*----------------------------------------------------------------*11810032
118200* DRIVE THE EDIT CHECK PROCESS FOR ITEMS SELECTED FOR 'ADD'      *11820032
118300*----------------------------------------------------------------*11830032
118400 2300-ADD-EDITS.                                                  11840032
118500     MOVE +1                   TO  ASC-BLK-SUB.                   11850032
118600     PERFORM 5100-WRITE-TEMP-STORAGE.                             11860032
118700     ADD +1                    TO  ASC-BLK-SUB.                   11870032
118800     PERFORM 5100-WRITE-TEMP-STORAGE.                             11880032
118900     PERFORM 2310-CHECK-SELECTS                                   11890032
119000         VARYING PV-ITEM                                          11900032
119100         FROM 1 BY 1                                              11910032
119200         UNTIL PS-EDIT-ERRORS                                     11920032
119300           OR  PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.         11930032
119400                                                                  11940032
119500*----------------------------------------------------------------*11950032
119600* READ A LIST QUEUE RECORD AND CHECK THAT THE CAPABILITY DOES    *11960032
119700* NOT ALREADY HAVE A CURRENTLY EFFECTIVE ROW FOR THIS VENDOR.    *11970032
119800*----------------------------------------------------------------*11980032
119900 2310-CHECK-SELECTS.                                              11990032
120000     PERFORM 6112-READ-LIST-QUEUE.                                12000032
120100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       12010032
120200         PERFORM                                                  12020032
120300         VARYING LQW-IDX                                          12030032
120400         FROM 1 BY 1                                              12040032
120500         UNTIL PS-EDIT-ERRORS                                     12050032
120600           OR  LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            12060032
120700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          12070032
120800             IF  LQW-SELECT (LQW-IDX)                             12080032
120900                 IF LQW-EXP-DATE (LQW-IDX) = PC-MAX-DATE          12090032
121000                     MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)          12100032
121100                                      TO ASC-FIRST-ITEM-IN-ERROR  12110032
121200                     SET PS-EDIT-ERRORS TO TRUE                   12120032
121300                 END-IF                                           12130032
121400             END-IF                                               12140032
121500         END-PERFORM                                              12150032
121600     END-IF.                                                      12160032
121700                                                                  12170032
121800*----------------------------------------------------------------*12180032
121900* DRIVE THE EDIT CHECK PROCESS FOR ITEMS SELECTED FOR 'INQUIRE'  *12190032
122000*----------------------------------------------------------------*12200032
122100 2400-INQUIRE-EDITS.                                              12210032
122200     MOVE +1                   TO  ASC-BLK-SUB.                   12220032
122300     PERFORM 5100-WRITE-TEMP-STORAGE.                             12230032
122400     ADD +1                    TO  ASC-BLK-SUB.                   12240032
122500     PERFORM 5100-WRITE-TEMP-STORAGE.                             12250032
122600     PERFORM 2410-CHECK-SELECTS                                   12260032
122700         VARYING PV-ITEM                                          12270032
122800         FROM 1 BY 1                                              12280032
122900         UNTIL PS-EDIT-ERRORS                                     12290032
123000           OR  PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.         12300032
123100                                                                  12310032
123200*----------------------------------------------------------------*12320032
123300* READ A LIST QUEUE RECORD AND CHECK THAT THE CAPABILITY HAS     *12330032
123400* A CURRENTLY EFFECTIVE OR AN EXPIRED ROW FOR THIS VENDOR        *12340032
123500*----------------------------------------------------------------*12350032
123600 2410-CHECK-SELECTS.                                              12360032
123700     PERFORM 6112-READ-LIST-QUEUE.                                12370032
123800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       12380032
123900         PERFORM                                                  12390032
124000         VARYING LQW-IDX                                          12400032
124100         FROM 1 BY 1                                              12410032
124200         UNTIL PS-EDIT-ERRORS                                     12420032
124300           OR  LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            12430032
124400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          12440032
124500             IF  LQW-SELECT (LQW-IDX)                             12450032
124600                 IF LQW-EXP-DATE (LQW-IDX) = SPACES               12460032
124700                     MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)          12470032
124800                                      TO ASC-FIRST-ITEM-IN-ERROR  12480032
124900                     SET PS-EDIT-ERRORS TO TRUE                   12490032
125000                 END-IF                                           12500032
125100             END-IF                                               12510032
125200         END-PERFORM                                              12520032
125300     END-IF.                                                      12530032
125400                                                                  12540032
125500*----------------------------------------------------------------*12550032
125600* DRIVE THE EDIT CHECK PROCESS FOR ITEMS SELECTED FOR 'UPDATE'   *12560032
125700*----------------------------------------------------------------*12570032
125800 2500-UPDATE-EDITS.                                               12580032
125900     MOVE +1                   TO  ASC-BLK-SUB.                   12590032
126000     PERFORM 5100-WRITE-TEMP-STORAGE.                             12600032
126100     ADD +1                    TO  ASC-BLK-SUB.                   12610032
126200     PERFORM 5100-WRITE-TEMP-STORAGE.                             12620032
126300     SET PS-NO-EDIT-ERRORS               TO TRUE.                 12630032
126400     PERFORM 2510-CHECK-SELECTS                                   12640032
126500         VARYING PV-ITEM                                          12650032
126600         FROM 1 BY 1                                              12660032
126700         UNTIL PS-EDIT-ERRORS                                     12670032
126800           OR  PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.         12680032
126900                                                                  12690032
127000*----------------------------------------------------------------*12700032
127100* READ A LIST QUEUE RECORD AND CHECK THAT THE CAPABILITY HAS A   *12710032
127200* CURRENTLY EFFECTIVE ROW FOR THIS VENDOR.                       *12720032
127300*----------------------------------------------------------------*12730032
127400 2510-CHECK-SELECTS.                                              12740032
127500     PERFORM 6112-READ-LIST-QUEUE.                                12750032
127600     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       12760032
127700         PERFORM                                                  12770032
127800         VARYING LQW-IDX                                          12780032
127900         FROM 1 BY 1                                              12790032
128000         UNTIL PS-EDIT-ERRORS                                     12800032
128100           OR  LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            12810032
128200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          12820032
128300             IF  LQW-SELECT (LQW-IDX)                             12830032
128400                 IF LQW-EXP-DATE (LQW-IDX) NOT = PC-MAX-DATE      12840032
128500                     MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)          12850032
128600                                      TO ASC-FIRST-ITEM-IN-ERROR  12860032
128700                     SET PS-EDIT-ERRORS TO TRUE                   12870032
128800                 END-IF                                           12880032
128900             END-IF                                               12890032
129000         END-PERFORM                                              12900032
129100     END-IF.                                                      12910032
129200                                                                  12920032
129300*----------------------------------------------------------------*12930034
129400* CHECK IF ENT-ID BEING PROCESSED IS A PARTNER TYPE OF IMPORT    *12940034
129500* PARENT (S2) OR FACTORY (FA) THAT IS IN RMS PO AND HAS A LONG   *12950034
129600* NAME.  THE ADD OR UPDATE OF A CAPABILITY WILL BE BLOCKED       *12960034
129700* UNTIL THE PARTNER (S2, FA) HAS A LONGNAME AND IS IN RMS PO.    *12970034
129800*----------------------------------------------------------------*12980034
129900 2600-CHECK-PARTNER-STATS.                                        12990034
130000     MOVE SPACE TO ASC-LONGNAME-FOUND-SW.                         13000034
130100                                                                  13010034
130200     PERFORM 3320-GET-VENDOR-INFO.                                13020034
130300                                                                  13030034
130400     IF EXTENT-PRTNR-IND = 'Y'                                    13040034
130500        IF EXTENT-PRTNR-TYP-CDE = 'S2' OR 'FA'                    13050034
130600           IF EXTENT-VND-IN-RMS-IND = 'Y'                         13060034
130700              PERFORM 3330-CHECK-LONGNAME-EXISTENCE               13070034
130800              IF ASC-LONGNAME-NOT-FOUND                           13080034
130900                 SET PS-ERROR          TO TRUE                    13090034
131000                 SET DP030-OVERRIDE-GO                            13100034
131100                     DP030-SET-CURSOR-APPL-1                      13110034
131200                     DP020-MSG-FATAL  TO TRUE                     13120034
131300                 MOVE -1  TO MR-SELECTL (1)                       13130034
131400                 IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)        13140034
131500***      --- CANNOT ADD A CAPABILITY UNTIL A LONG NAME            13150034
131600***      --- HAS BEEN ADDED                                       13160034
131700                    MOVE PC-TSYMSG-03631  TO DP020-MSG-NUMBER     13170034
131800                 END-IF                                           13180034
131900                 IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)        13190034
132000***      --- CANNOT UPDATE A CAPABILITY UNTIL A LONG NAME         13200034
132100***      --- HAS BEEN ADDED                                       13210034
132200                    MOVE PC-TSYMSG-03636  TO DP020-MSG-NUMBER     13220034
132300                 END-IF                                           13230034
132400              END-IF                                              13240034
132500           ELSE                                                   13250034
132600              SET PS-ERROR          TO TRUE                       13260034
132700              SET DP030-OVERRIDE-GO                               13270034
132800                  DP030-SET-CURSOR-APPL-1                         13280034
132900                  DP020-MSG-FATAL  TO TRUE                        13290034
133000              MOVE -1  TO MR-SELECTL (1)                          13300034
133100              IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)           13310034
133200***      --- CANNOT ADD A CAPABILITY BECAUSE PARTNER (S2, FA)     13320034
133300***      --- IS NOT IN RMS PO                                     13330034
133400                 MOVE PC-TSYMSG-03633  TO DP020-MSG-NUMBER        13340034
133500              END-IF                                              13350034
133600              IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)           13360034
133700***      --- CANNOT UPDATE A CAPABILITY BECAUSE PARTNER           13370034
133800***      --- (S2, FA) IS NOT IN RMS PO                            13380034
133900                 MOVE PC-TSYMSG-03637  TO DP020-MSG-NUMBER        13390034
134000              END-IF                                              13400034
134100           END-IF                                                 13410034
134200        END-IF                                                    13420034
134300     END-IF.                                                      13430034
134400                                                                  13440034
134500***************************************************************** 13450032
134600** PREPARE THE INTER-APPL-COMMAREA FOR THE NEXT SCREEN          * 13460032
134700***************************************************************** 13470032
134800 2900-PREPARE-COMMAREA.                                           13480032
134900     INITIALIZE VN018-INTER-APPL-COMMAREA.                        13490032
135000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            13500032
135100                            TO VN018-NUMBER-OF-SELECTED-ITEMS.    13510032
135200     MOVE ASC-KEY-ENT-ID    TO VN018-ENT-ID.                      13520032
135300     MOVE ASC-VENDOR-NAME   TO VN018-VENDOR-NAME.                 13530032
135400     MOVE ASC-VENDOR-ID     TO VN018-VENDOR-ID.                   13540032
135500     PERFORM 5000-PREPARE-SEL-QUEUE.                              13550032
135600                                                                  13560032
135700***************************************************************** 13570032
135800** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      * 13580032
135900** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). * 13590032
136000***************************************************************** 13600032
136100 3000-EDIT-DATA-IN-COMMAREA.                                      13610032
136200                                                                  13620032
136300     SET PS-NO-ERROR               TO TRUE.                       13630032
136400     PERFORM 3200-RESET-ATTRIBUTES.                               13640032
136500     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13650032
136600**                                                                13660032
136700* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13670032
136800* EDITTING IS DONE FROM THE BOTTOM UP.                            13680032
136900**                                                                13690032
137000     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13700032
137100         ASC-ITEMS-DISPLAYED - 1.                                 13710032
137200     PERFORM 3100-SET-SUBSCRIPTS.                                 13720032
137300     PERFORM 3300-EDIT-SELECTIONS                                 13730032
137400         VARYING PV-SUB                                           13740032
137500         FROM PV-SUB BY -1                                        13750032
137600         UNTIL PV-SUB < +1                                        13760032
137700                                                                  13770032
137800     IF  PS-NO-ERROR                                              13780032
137900         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13790032
138000     END-IF.                                                      13800032
138100                                                                  13810032
138200     IF  ((PS-NO-ERROR)                                           13820032
138300       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13830032
138400       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13840032
138500             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13850032
138600     END-IF.                                                      13860032
138700                                                                  13870032
138800*----------------------------------------------------------------*13880032
138900*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13890032
139000*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13900032
139100*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13910032
139200*                                                                *13920032
139300*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13930032
139400*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13940032
139500*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13950032
139600*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13960032
139700*----------------------------------------------------------------*13970032
139800 3100-SET-SUBSCRIPTS.                                             13980032
139900                                                                  13990032
140000     COMPUTE ASC-ITEM-SUB =                                       14000032
140100         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14010032
140200                                                                  14020032
140300     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14030032
140400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14040032
140500                                                                  14050032
140600         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               14060032
140700     ELSE                                                         14070032
140800         MOVE +1                     TO ASC-BLK-SUB               14080032
140900     END-IF.                                                      14090032
141000                                                                  14100032
141100***************************************************************** 14110032
141200** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     * 14120032
141300***************************************************************** 14130032
141400 3200-RESET-ATTRIBUTES.                                           14140032
141500                                                                  14150032
141600     MOVE DP015-UNP-NUM-NOR-OFF TO ASTRTITA.                      14160032
141700     MOVE DP015-GREEN           TO ASTRTITC.                      14170032
141800     MOVE DP015-UNDERLINE       TO ASTRTITH.                      14180032
141900                                                                  14190032
142000     IF DP020-NEXT-ACT-RETURN OR                                  14200032
142100        DP020-NEXT-ACT-READ-MAP                                   14210032
142200         PERFORM VARYING PV-SUB  FROM 1 BY 1                      14220032
142300                 UNTIL   PV-SUB > ASC-ITEMS-DISPLAYED             14230032
142400                  MOVE DP015-UNP-ALP-NOR-OFF                      14240032
142500                                       TO MR-SELECTA (PV-SUB)     14250032
142600                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     14260032
142700                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     14270032
142800         END-PERFORM                                              14280032
142900     ELSE                                                         14290032
143000         PERFORM VARYING PV-SUB  FROM 1 BY 1                      14300032
143100                 UNTIL   PV-SUB > PC-ITEMS-PER-PANEL              14310032
143200                  MOVE DP015-UNP-ALP-NOR-OFF                      14320032
143300                                       TO MR-SELECTA (PV-SUB)     14330032
143400                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     14340032
143500                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     14350032
143600         END-PERFORM.                                             14360032
143700                                                                  14370032
143800***************************************************************** 14380032
143900** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    * 14390032
144000** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   * 14400032
144100** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    * 14410032
144200** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             * 14420032
144300***************************************************************** 14430032
144400 3300-EDIT-SELECTIONS.                                            14440032
144500                                                                  14450032
144600     EVALUATE TRUE                                                14460032
144700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14470032
144800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14480032
144900                 CONTINUE                                         14490032
145000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14500032
145100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14510032
145200                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   14520032
145300                 MOVE ASC-TEMP-SELECTED-SW                        14530032
145400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14540032
145500                                TO ASC-SELECTED-SW                14550032
145600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14560032
145700             END-IF                                               14570032
145800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14580032
145900                 = SPACE                                          14590032
146000             EVALUATE TRUE                                        14600032
146100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14610032
146200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14620032
146300                     MOVE SPACE TO ASC-SELECTED-SW                14630032
146400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14640032
146500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14650032
146600                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    14660032
146700                     MOVE SPACE TO ASC-SELECTED-SW                14670032
146800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14680032
146900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14690032
147000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      14700032
147100                     MOVE SPACE TO ASC-SELECTED-SW                14710032
147200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14720032
147300             END-EVALUATE                                         14730032
147400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14740032
147500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14750032
147600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14760032
147700             END-IF                                               14770032
147800             PERFORM 3310-EDIT-RANGE                              14780032
147900         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14790032
148000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14800032
148100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14810032
148200             END-IF                                               14820032
148300             PERFORM 3310-EDIT-RANGE                              14830032
148400         WHEN OTHER                                               14840032
148500             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           14850032
148600             SET DP020-MSG-FATAL    TO TRUE                       14860032
148700             MOVE -1                TO MR-SELECTL (PV-SUB)        14870032
148800             SET DP030-SET-CURSOR-APPL-1                          14880032
148900                                    TO TRUE                       14890032
149000             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        14900032
149100             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14910032
149200             SET PS-ERROR TO TRUE                                 14920032
149300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14930032
149400                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14940032
149500                 MOVE SPACE         TO ASC-SELECTED-SW            14950032
149600                                        (ASC-BLK-SUB ASC-ITEM-SUB)14960032
149700             END-IF                                               14970032
149800     END-EVALUATE.                                                14980032
149900                                                                  14990032
150000     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 15000032
150100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15010032
150200     IF  ASC-ITEM-SUB < 1                                         15020032
150300         SUBTRACT +1 FROM ASC-BLK-SUB                             15030032
150400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15040032
150500     END-IF.                                                      15050032
150600                                                                  15060032
150700***************************************************************** 15070032
150800** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      * 15080032
150900** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    * 15090032
151000** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)* 15100032
151100** THE ENDING.                                                  * 15110032
151200***************************************************************** 15120032
151300 3310-EDIT-RANGE.                                                 15130032
151400                                                                  15140032
151500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15150032
151600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15160032
151700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15170032
151800                                   TO ASC-SELECTED-SW             15180032
151900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15190032
152000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15200032
152100         ELSE                                                     15210032
152200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15220032
152300                 CONTINUE                                         15230032
152400             ELSE                                                 15240032
152500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15250032
152600                 MOVE PC-TSYMSG-00054                             15260032
152700                                   TO DP020-MSG-NUMBER            15270032
152800                 SET DP020-MSG-FATAL                              15280032
152900                                   TO TRUE                        15290032
153000                 MOVE -1           TO MR-SELECTL (PV-SUB)         15300032
153100                 SET DP030-SET-CURSOR-APPL-1                      15310032
153200                                   TO TRUE                        15320032
153300                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15330032
153400                 MOVE DP015-UNDERLINE                             15340032
153500                                   TO MR-SELECTH (PV-SUB)         15350032
153600                 SET PS-ERROR      TO TRUE                        15360032
153700             END-IF                                               15370032
153800         END-IF                                                   15380032
153900     ELSE                                                         15390032
154000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15400032
154100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15410032
154200                                   TO ASC-SELECTED-SW             15420032
154300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15430032
154400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15440032
154500         ELSE                                                     15450032
154600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15460032
154700                 CONTINUE                                         15470032
154800             ELSE                                                 15480032
154900*                -- ONLY ONE END-OF-RANGE ALLOWED --              15490032
155000                 MOVE PC-TSYMSG-00055                             15500032
155100                                   TO DP020-MSG-NUMBER            15510032
155200                 SET DP020-MSG-FATAL                              15520032
155300                                   TO TRUE                        15530032
155400                 MOVE -1           TO MR-SELECTL (PV-SUB)         15540032
155500                 SET DP030-SET-CURSOR-APPL-1                      15550032
155600                                   TO TRUE                        15560032
155700                 SET PS-ERROR      TO TRUE                        15570032
155800             END-IF                                               15580032
155900         END-IF                                                   15590032
156000     END-IF.                                                      15600032
156100                                                                  15610032
156200*----------------------------------------------------------------*15620034
156300* SELECT THE VENDOR INFO FOR THE ENTID BEING PROCESSED.          *15630034
156400*----------------------------------------------------------------*15640034
156500 3320-GET-VENDOR-INFO.                                            15650034
156600     PERFORM                                                      15660034
156700         WITH TEST AFTER                                          15670034
156800         VARYING PV-RETRY-COUNTER                                 15680034
156900         FROM 1 BY 1                                              15690034
157000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15700034
157100                   OR (SQLCODE = ZERO))                           15710034
157200                                                                  15720034
157300         EXEC SQL                                                 15730034
157400             SELECT PRTNR_IND                                     15740034
157500                   ,VND_IN_RMS_IND                                15750034
157600                   ,PRTNR_TYP_CDE                                 15760034
157700              INTO  :EXTENT-PRTNR-IND                             15770034
157800                   ,:EXTENT-VND-IN-RMS-IND                        15780034
157900                   ,:EXTENT-PRTNR-TYP-CDE                         15790034
158000              FROM  TEXTENT                                       15800034
158100             WHERE  ENT_ID   = :ASC-KEY-ENT-ID                    15810034
158200         END-EXEC                                                 15820034
158300                                                                  15830034
158400         EVALUATE TRUE                                            15840034
158500             WHEN SQLCODE = ZERO                                  15850034
158600             WHEN SQLCODE = -904                                  15860034
158700             WHEN SQLCODE = -913                                  15870034
158800                 CONTINUE                                         15880034
158900             WHEN SQLWARN0 NOT = SPACES                           15890034
159000             WHEN SQLCODE < ZERO                                  15900034
159100             WHEN SQLCODE > ZERO                                  15910034
159200                 MOVE '3320-GET-VENDOR-INFO     '                 15920034
159300                                   TO DP013-PARAGRAPH             15930034
159400                 MOVE 'SELECT VENDOR NUMBER'                      15940034
159500                                   TO DP013-MESSAGE-TEXT (1)      15950034
159600                 MOVE SQLCA        TO DP013-SQLCA                 15960034
159700                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    15970034
159800                 SET DP013-DB2-ABEND                              15980034
159900                     DP013-XCTL-DISPLAY-RESTART                   15990034
160000                                   TO TRUE                        16000034
160100                 PERFORM DP013-0000-PROCESS-ABEND                 16010034
160200         END-EVALUATE                                             16020034
160300     END-PERFORM.                                                 16030034
160400*                                                                 16040034
160500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16050034
160600         MOVE '3320-GET-VENDOR-INFO     '                         16060034
160700                                   TO DP013-PARAGRAPH             16070034
160800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     16080034
160900                                   TO DP013-MESSAGE-TEXT (1)      16090034
161000         MOVE 'VENDOR NUMBER'      TO DP013-MESSAGE-TEXT (2)      16100034
161100         MOVE SQLCA                TO DP013-SQLCA                 16110034
161200         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    16120034
161300         SET DP013-DB2-ABEND                                      16130034
161400             DP013-XCTL-DISPLAY-RESTART                           16140034
161500                                   TO TRUE                        16150034
161600         PERFORM DP013-0000-PROCESS-ABEND                         16160034
161700     END-IF.                                                      16170034
161800                                                                  16180034
161900*----------------------------------------------------------------*16190034
162000*  CHECK FOR IF TYPE CODE FOR LONG NAME EXISTS ON TENTNME FOR THE 16200034
162100*  VENDOR BEING PROCESSED.                                        16210034
162200*----------------------------------------------------------------*16220034
162300 3330-CHECK-LONGNAME-EXISTENCE.                                   16230034
162400     PERFORM                                                      16240034
162500         WITH TEST AFTER                                          16250034
162600         VARYING PV-RETRY-COUNTER                                 16260034
162700         FROM 1 BY 1                                              16270034
162800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16280034
162900                   OR (SQLCODE = ZERO)                            16290034
163000                   OR (SQLCODE = +100)                            16300034
163100                   OR (SQLCODE = -811))                           16310034
163200                                                                  16320034
163300         EXEC SQL                                                 16330034
163400           SELECT '1'                                             16340034
163500            INTO  :PV-ONE                                         16350034
163600             FROM SYSIBM.SYSDUMMY1 X                              16360034
163700            WHERE EXISTS (SELECT 1                                16370034
163800                            FROM TENTNME                          16380034
163900                           WHERE ENT_ID = :ASC-KEY-ENT-ID         16390034
164000                             AND TYPE_CDE = '05'                  16400034
164100                             AND X.IBMREQD = X.IBMREQD)           16410034
164200         END-EXEC                                                 16420034
164300                                                                  16430034
164400         EVALUATE TRUE                                            16440034
164500             WHEN SQLCODE = ZERO                                  16450034
164600             WHEN SQLCODE = -811                                  16460034
164700                 SET ASC-LONGNAME-FOUND TO TRUE                   16470034
164800             WHEN SQLCODE = +100                                  16480034
164900                 SET ASC-LONGNAME-NOT-FOUND TO TRUE               16490034
165000             WHEN SQLCODE = -904                                  16500034
165100             WHEN SQLCODE = -913                                  16510034
165200                 CONTINUE                                         16520034
165300             WHEN SQLWARN0 NOT = SPACES                           16530034
165400             WHEN SQLCODE < ZERO                                  16540034
165500             WHEN SQLCODE > ZERO                                  16550034
165600                 MOVE '3330-CHECK-LONGNAME-EXISTENCE'             16560034
165700                                   TO DP013-PARAGRAPH             16570034
165800                 MOVE 'CHECK IF LONG NAME ALREADY EXISTS'         16580034
165900                                   TO DP013-MESSAGE-TEXT (1)      16590034
166000                 MOVE SPACE        TO DP013-MESSAGE-TEXT (2)      16600034
166100                 MOVE SQLCA        TO DP013-SQLCA                 16610034
166200                 MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)    16620034
166300                 SET DP013-DB2-ABEND                              16630034
166400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16640034
166500                 PERFORM DP013-0000-PROCESS-ABEND                 16650034
166600         END-EVALUATE                                             16660034
166700     END-PERFORM.                                                 16670034
166800                                                                  16680034
166900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16690034
167000         MOVE '3330-CHECK-LONGNAME-EXISTENCE'                     16700034
167100                                   TO DP013-PARAGRAPH             16710034
167200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO CHECK '     16720034
167300                                   TO DP013-MESSAGE-TEXT (1)      16730034
167400         MOVE 'FOR LONG NAME EXISTENCE '                          16740034
167500                                   TO DP013-MESSAGE-TEXT (2)      16750034
167600         MOVE SPACE                TO DP013-MESSAGE-TEXT (3)      16760034
167700         MOVE SQLCA                TO DP013-SQLCA                 16770034
167800         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    16780034
167900         SET DP013-DB2-ABEND                                      16790034
168000             DP013-XCTL-DISPLAY-RESTART                           16800034
168100                                   TO TRUE                        16810034
168200         PERFORM DP013-0000-PROCESS-ABEND                         16820034
168300     END-IF.                                                      16830034
168400                                                                  16840034
168500***************************************************************** 16850032
168600** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    * 16860032
168700** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  * 16870032
168800***************************************************************** 16880032
168900 3400-CHECK-RANGE-SEQUENCE.                                       16890032
169000                                                                  16900032
169100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16910032
169200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16920032
169300       AND  ASC-START-OF-SELECTED-RANGE >                         16930032
169400                                         ASC-END-OF-SELECTED-RANGE16940032
169500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                16950032
169600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 16960032
169700         SET DP020-MSG-FATAL TO TRUE                              16970032
169800         SET PS-ERROR TO TRUE                                     16980032
169900         PERFORM 3410-POSITION-AT-ERROR                           16990032
170000     END-IF.                                                      17000032
170100                                                                  17010032
170200***************************************************************** 17020032
170300** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    * 17030032
170400** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR * 17040032
170500** SHOULD BE POSITIONED ON A RANGE ERROR.                       * 17050032
170600***************************************************************** 17060032
170700 3410-POSITION-AT-ERROR.                                          17070032
170800                                                                  17080032
170900     SET DP030-SET-CURSOR-APPL-1                                  17090032
171000                                   TO TRUE.                       17100032
171100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 17110032
171200                    - PV-TOP-ITEM + 1.                            17120032
171300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17130032
171400         CONTINUE                                                 17140032
171500     ELSE                                                         17150032
171600         MOVE -1                   TO MR-SELECTL (PV-SUB)         17160032
171700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17170032
171800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17180032
171900     END-IF.                                                      17190032
172000                                                                  17200032
172100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   17210032
172200                    - PV-TOP-ITEM + 1.                            17220032
172300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17230032
172400         CONTINUE                                                 17240032
172500     ELSE                                                         17250032
172600         MOVE -1                   TO MR-SELECTL (PV-SUB)         17260032
172700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17270032
172800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17280032
172900     END-IF.                                                      17290032
173000                                                                  17300032
173100*----------------------------------------------------------------*17310032
173200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *17320032
173300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *17330032
173400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *17340032
173500*----------------------------------------------------------------*17350032
173600 3500-MARK-RANGE-AS-SELECTED.                                     17360032
173700                                                                  17370032
173800     MOVE +1                       TO  ASC-BLK-SUB.               17380032
173900     PERFORM 3510-MARK-SELECTED-INDS                              17390032
174000         VARYING ASC-ITEM-SUB                                     17400032
174100         FROM 1 BY 1                                              17410032
174200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17420032
174300                                                                  17430032
174400     ADD +1                        TO ASC-BLK-SUB.                17440032
174500     PERFORM 3510-MARK-SELECTED-INDS                              17450032
174600         VARYING ASC-ITEM-SUB                                     17460032
174700         FROM 1 BY 1                                              17470032
174800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17480032
174900                                                                  17490032
175000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17500032
175100                                   TO  PV-LIST-ITEM-NUMBER.       17510032
175200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17520032
175300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17530032
175400               PC-ITEMS-PER-PANEL).                               17540032
175500                                                                  17550032
175600     MOVE ASC-START-OF-SELECTED-RANGE                             17560032
175700                                   TO PV-START-OF-SELECTED-RANGE. 17570032
175800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17580032
175900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17590032
176000               PC-ITEMS-PER-PANEL).                               17600032
176100                                                                  17610032
176200     MOVE ASC-END-OF-SELECTED-RANGE                               17620032
176300                                   TO  PV-END-OF-SELECTED-RANGE.  17630032
176400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17640032
176500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17650032
176600               PC-ITEMS-PER-PANEL).                               17660032
176700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             17670032
176800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             17680032
176900                                                                  17690032
177000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    17700032
177100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        17710032
177200         MOVE +1                   TO ASC-BLK-SUB                 17720032
177300         PERFORM 5100-WRITE-TEMP-STORAGE                          17730032
177400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17740032
177500             PV-FIRST-BLOCK-IN-ARRAY - 1                          17750032
177600                                                                  17760032
177700         PERFORM                                                  17770032
177800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      17780032
177900                   PV-PREV-BLOCK-IN-ARRAY                         17790032
178000             MOVE PV-FIRST-BLOCK-IN-RANGE                         17800032
178100                                   TO PV-BLOCK-NUMBER             17810032
178200             PERFORM 4410-READ-TEMP-STORAGE                       17820032
178300             PERFORM 3510-MARK-SELECTED-INDS                      17830032
178400                 VARYING ASC-ITEM-SUB                             17840032
178500                 FROM 1 BY 1                                      17850032
178600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17860032
178700             PERFORM 5100-WRITE-TEMP-STORAGE                      17870032
178800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     17880032
178900         END-PERFORM                                              17890032
179000                                                                  17900032
179100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17910032
179200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17920032
179300         PERFORM                                                  17930032
179400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17940032
179500                   PV-LAST-BLOCK-IN-RANGE                         17950032
179600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17960032
179700                                   TO PV-BLOCK-NUMBER             17970032
179800             PERFORM 4410-READ-TEMP-STORAGE                       17980032
179900             PERFORM 3510-MARK-SELECTED-INDS                      17990032
180000                 VARYING ASC-ITEM-SUB                             18000032
180100                 FROM 1 BY 1                                      18010032
180200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18020032
180300             PERFORM 5100-WRITE-TEMP-STORAGE                      18030032
180400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18040032
180500         END-PERFORM                                              18050032
180600                                                                  18060032
180700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             18070032
180800                                   TO PV-BLOCK-NUMBER             18080032
180900         PERFORM 4410-READ-TEMP-STORAGE                           18090032
181000     END-IF.                                                      18100032
181100                                                                  18110032
181200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 18120032
181300                                      ASC-END-OF-SELECTED-RANGE.  18130032
181400                                                                  18140032
181500*----------------------------------------------------------------*18150032
181600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *18160032
181700*----------------------------------------------------------------*18170032
181800 3510-MARK-SELECTED-INDS.                                         18180032
181900                                                                  18190032
182000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18200032
182100                                ASC-ITEM-SUB) >                   18210032
182200         ASC-START-OF-SELECTED-RANGE)                             18220032
182300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18230032
182400                                ASC-ITEM-SUB) =                   18240032
182500         ASC-START-OF-SELECTED-RANGE)                             18250032
182600                                                                  18260032
182700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18270032
182800                                    ASC-ITEM-SUB) <               18280032
182900             ASC-END-OF-SELECTED-RANGE)                           18290032
183000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18300032
183100                                    ASC-ITEM-SUB) =               18310032
183200             ASC-END-OF-SELECTED-RANGE)                           18320032
183300                                                                  18330032
183400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18340032
183500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   18350032
183600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   18360032
183700                               TO TRUE                            18370032
183800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              18380032
183900                               TO TRUE                            18390032
184000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    18400032
184100             END-IF                                               18410032
184200         END-IF                                                   18420032
184300     END-IF.                                                      18430032
184400                                                                  18440032
184500*----------------------------------------------------------------*18450032
184600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *18460032
184700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *18470032
184800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *18480032
184900*    DISPLAY THE PANEL TO USER.                                  *18490032
185000*----------------------------------------------------------------*18500032
185100 4000-BUILD-INITIAL-PANEL.                                        18510032
185200                                                                  18520032
185300     INITIALIZE ASC-BLOCK-ENTRIES (1)                             18530032
185400                ASC-BLOCK-ENTRIES (2).                            18540032
185500     MOVE +1 TO ASC-BLK-SUB.                                      18550032
185600     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            18560032
185700     MOVE ZERO TO ASC-ITEM-SUB                                    18570032
185800                  ASC-NUMBER-OF-ITEMS-READ                        18580032
185900                  ASC-NUMBER-OF-SELECTED-ITEMS                    18590032
186000                  ASC-HIGHEST-BLOCK-WRITTEN                       18600032
186100                  ASC-START-OF-SELECTED-RANGE                     18610032
186200                  ASC-END-OF-SELECTED-RANGE                       18620032
186300                  ASC-ITEM-AT-TOP-OF-PANEL.                       18630032
186400     MOVE ASC-KEY-ENT-ID TO DK-ENT-ID.                            18640032
186500                                                                  18650032
186600     PERFORM 4010-OPEN-CURSOR.                                    18660032
186700                                                                  18670032
186800     PERFORM 4300-READ-ITEMS-FROM-DB.                             18680032
186900                                                                  18690032
187000     PERFORM 4020-CLOSE-CURSOR.                                   18700032
187100                                                                  18710032
187200     MOVE +1 TO PV-TOP-ITEM.                                      18720032
187300                                                                  18730032
187400     IF ASC-NUMBER-OF-ITEMS-READ = ZERO                           18740032
187500         SET DP030-SET-CURSOR-TRAILER TO TRUE                     18750032
187600     ELSE                                                         18760032
187700         MOVE -1 TO MR-SELECTL (1)                                18770032
187800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      18780032
187900     END-IF.                                                      18790032
188000                                                                  18800032
188100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        18810032
188200                                                                  18820032
188300 4010-OPEN-CURSOR.                                                18830032
188400                                                                  18840032
188500     PERFORM                                                      18850032
188600         WITH TEST AFTER                                          18860032
188700         VARYING PV-RETRY-COUNTER                                 18870032
188800         FROM 1 BY 1                                              18880032
188900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18890032
189000                   OR (SQLCODE = ZERO))                           18900032
189100                                                                  18910032
189200         EXEC SQL                                                 18920032
189300             OPEN CAPABILITY-CSR                                  18930032
189400         END-EXEC                                                 18940032
189500                                                                  18950032
189600         EVALUATE TRUE                                            18960032
189700             WHEN SQLCODE = ZERO                                  18970032
189800             WHEN SQLCODE = -904                                  18980032
189900             WHEN SQLCODE = -913                                  18990032
190000                 CONTINUE                                         19000032
190100                                                                  19010032
190200             WHEN SQLWARN0 NOT = SPACES                           19020032
190300             WHEN SQLCODE < ZERO                                  19030032
190400             WHEN SQLCODE > ZERO                                  19040032
190500                 MOVE '4010-OPEN-CURSOR'                          19050032
190600                                   TO DP013-PARAGRAPH             19060032
190700                 MOVE 'OPEN VENDOR CAPABILITY CURSOR - '          19070032
190800                                   TO DP013-MESSAGE-TEXT (1)      19080032
190900                 MOVE SQLCA        TO DP013-SQLCA                 19090032
191000                 MOVE 'VNT_VND_CPBL_CDE'                          19100032
191100                                   TO DP013-DB2-TABLE-NAME (1)    19110032
191200                 SET DP013-DB2-ABEND                              19120032
191300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19130032
191400                 PERFORM DP013-0000-PROCESS-ABEND                 19140032
191500         END-EVALUATE                                             19150032
191600     END-PERFORM.                                                 19160032
191700                                                                  19170032
191800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19180032
191900         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             19190032
192000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   19200032
192100                                   TO DP013-MESSAGE-TEXT (1)      19210032
192200         MOVE SQLCA                TO DP013-SQLCA                 19220032
192300         MOVE 'VNT_VND_CPBL_CDE'   TO DP013-DB2-TABLE-NAME (1)    19230032
192400         SET DP013-DB2-ABEND                                      19240032
192500             DP013-XCTL-DISPLAY-RESTART                           19250032
192600                                   TO TRUE                        19260032
192700         PERFORM DP013-0000-PROCESS-ABEND                         19270032
192800     END-IF.                                                      19280032
192900                                                                  19290032
193000 4020-CLOSE-CURSOR.                                               19300032
193100                                                                  19310032
193200     EXEC SQL                                                     19320032
193300         CLOSE CAPABILITY-CSR                                     19330032
193400     END-EXEC                                                     19340032
193500                                                                  19350032
193600     EVALUATE TRUE                                                19360032
193700         WHEN SQLCODE = ZERO                                      19370032
193800             CONTINUE                                             19380032
193900                                                                  19390032
194000         WHEN SQLWARN0 NOT = SPACES                               19400032
194100         WHEN SQLCODE < ZERO                                      19410032
194200         WHEN SQLCODE > ZERO                                      19420032
194300             MOVE '4020-CLOSE-CURSOR'                             19430032
194400                               TO DP013-PARAGRAPH                 19440032
194500             MOVE 'CLOSE VENDOR DEPARTMENT CURSOR '               19450032
194600                               TO DP013-MESSAGE-TEXT (1)          19460032
194700             MOVE SQLCA        TO DP013-SQLCA                     19470032
194800             MOVE 'VNT_VND_CPBL_CDE'   TO DP013-DB2-TABLE-NAME (1)19480032
194900             SET DP013-DB2-ABEND                                  19490032
195000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19500032
195100             PERFORM DP013-0000-PROCESS-ABEND                     19510032
195200     END-EVALUATE.                                                19520032
195300                                                                  19530032
195400*---------------------------------------------------------------* 19540032
195500*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE   * 19550032
195600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,    * 19560032
195700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND * 19570032
195800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE    * 19580032
195900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                  * 19590032
196000*---------------------------------------------------------------* 19600032
196100                                                                  19610032
196200 4300-READ-ITEMS-FROM-DB.                                         19620032
196300                                                                  19630032
196400     PERFORM                                                      19640032
196500         VARYING PV-READ-COUNT                                    19650032
196600         FROM 1 BY 1                                              19660032
196700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19670032
196800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19680032
196900                                                                  19690032
197000         PERFORM 4310-FETCH                                       19700032
197100                                                                  19710032
197200         IF  ASC-ITEMS-LEFT-ON-DB                                 19720032
197300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19730032
197400                 ADD +1            TO ASC-ITEM-SUB                19740032
197500             ELSE                                                 19750032
197600                 ADD +1            TO ASC-BLK-SUB                 19760032
197700                 MOVE +1           TO ASC-ITEM-SUB                19770032
197800                                                                  19780032
197900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19790032
198000                     MOVE +1       TO ASC-BLK-SUB                 19800032
198100                     SET ASC-BLOCK-MODIFIED (1)                   19810032
198200                                   TO TRUE                        19820032
198300                     PERFORM 5100-WRITE-TEMP-STORAGE              19830032
198400                     MOVE ASC-BLOCK-ENTRIES                       19840032
198500                               (PC-MAX-BLOCKS-IN-ARRAY)           19850032
198600                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19860032
198700                     ADD +1        TO ASC-BLK-SUB                 19870032
198800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19880032
198900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19890032
199000                                   TO TRUE                        19900032
199100                 END-IF                                           19910032
199200             END-IF                                               19920032
199300             ADD +1                   TO ASC-NUMBER-OF-ITEMS-READ 19930032
199400             MOVE ASC-NUMBER-OF-ITEMS-READ                        19940032
199500                                      TO ASC-LIST-ITEM-NUMBER     19950032
199600                                        (ASC-BLK-SUB ASC-ITEM-SUB)19960032
199700             MOVE VNT00001-VND-CPBL-CDE  TO ASC-CAPBLTY-CDE       19970032
199800                                        (ASC-BLK-SUB ASC-ITEM-SUB)19980032
199900             MOVE VNT00003-VND-CPBL-DESC TO ASC-CAPBLTY-NAME      19990032
200000                                        (ASC-BLK-SUB ASC-ITEM-SUB)20000032
200100             IF VNT00001-EFF-BEG-DTE = PC-DUMMY-DATE              20010032
200200                 MOVE SPACES             TO ASC-EFF-DATE          20020032
200300                                        (ASC-BLK-SUB ASC-ITEM-SUB)20030032
200400                 MOVE SPACES             TO ASC-EXP-DATE          20040032
200500                                        (ASC-BLK-SUB ASC-ITEM-SUB)20050032
200600             ELSE                                                 20060032
200700                MOVE VNT00001-EFF-BEG-DTE(6:2)                    20070032
200800                                         TO PV-WORK-MM            20080032
200900                MOVE VNT00001-EFF-BEG-DTE(9:2)                    20090032
201000                                         TO PV-WORK-DD            20100032
201100                MOVE VNT00001-EFF-BEG-DTE(1:4)                    20110032
201200                                         TO PV-WORK-YYYY          20120032
201300                MOVE PV-WORK-DATE        TO ASC-EFF-DATE          20130032
201400                                        (ASC-BLK-SUB ASC-ITEM-SUB)20140032
201500                MOVE VNT00001-EFF-END-DTE(6:2)                    20150032
201600                                         TO PV-WORK-MM            20160032
201700                MOVE VNT00001-EFF-END-DTE(9:2)                    20170032
201800                                         TO PV-WORK-DD            20180032
201900                MOVE VNT00001-EFF-END-DTE(1:4)                    20190032
202000                                         TO PV-WORK-YYYY          20200032
202100                MOVE PV-WORK-DATE        TO ASC-EXP-DATE          20210032
202200                                        (ASC-BLK-SUB ASC-ITEM-SUB)20220032
202300             END-IF                                               20230032
202400         END-IF                                                   20240032
202500     END-PERFORM.                                                 20250032
202600                                                                  20260032
202700     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           20270032
202800         MOVE +1 TO ASC-BLK-SUB                                   20280032
202900                                                                  20290032
203000         PERFORM 5100-WRITE-TEMP-STORAGE                          20300032
203100                                                                  20310032
203200         ADD  +1 TO ASC-BLK-SUB                                   20320032
203300                                                                  20330032
203400         PERFORM 5100-WRITE-TEMP-STORAGE                          20340032
203500                                                                  20350032
203600         MOVE 1 TO ASC-BLK-SUB                                    20360032
203700                   PV-BLOCK-NUMBER                                20370032
203800                                                                  20380032
203900         PERFORM 4410-READ-TEMP-STORAGE                           20390032
204000                                                                  20400032
204100         IF ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1              20410032
204200             MOVE 2 TO ASC-BLK-SUB                                20420032
204300                       PV-BLOCK-NUMBER                            20430032
204400                                                                  20440032
204500             PERFORM 4410-READ-TEMP-STORAGE                       20450032
204600         END-IF                                                   20460032
204700     END-IF.                                                      20470032
204800*----------------------------------------------------------------*20480032
204900*----------------------------------------------------------------*20490032
205000                                                                  20500032
205100 4310-FETCH.                                                      20510032
205200                                                                  20520032
205300     EXEC SQL                                                     20530032
205400             FETCH CAPABILITY-CSR                                 20540032
205500              INTO :VNT00001-VND-CPBL-CDE                         20550032
205600                  ,:VNT00003-VND-CPBL-DESC                        20560032
205700                  ,:VNT00001-EFF-BEG-DTE                          20570032
205800                  ,:VNT00001-EFF-END-DTE                          20580032
205900     END-EXEC                                                     20590032
206000                                                                  20600032
206100     EVALUATE TRUE                                                20610032
206200         WHEN SQLCODE = ZERO                                      20620032
206300         WHEN SQLCODE = +100                                      20630032
206400              CONTINUE                                            20640032
206500                                                                  20650032
206600         WHEN SQLWARN0 NOT = SPACE                                20660032
206700         WHEN SQLCODE NOT = ZERO                                  20670032
206800              MOVE '4310-FETCH-CURSOR'                            20680032
206900                               TO DP013-PARAGRAPH                 20690032
207000              MOVE 'FETCH VENDOR RELATIONSHIP CURSOR'             20700032
207100                               TO DP013-MESSAGE-TEXT (1)          20710032
207200              MOVE SQLCA       TO DP013-SQLCA                     20720032
207300              SET DP013-DB2-ABEND                                 20730032
207400                               TO TRUE                            20740032
207500              PERFORM DP013-0000-PROCESS-ABEND                    20750032
207600     END-EVALUATE.                                                20760032
207700                                                                  20770032
207800     IF SQLCODE = +100                                            20780032
207900         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE.                     20790032
208000                                                                  20800032
208100*----------------------------------------------------------------*20810032
208200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *20820032
208300*----------------------------------------------------------------*20830032
208400 4400-MOVE-COMMAREA-TO-SCREEN.                                    20840032
208500                                                                  20850032
208600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             20860032
208700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          20870032
208800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          20880032
208900             MOVE +1    TO ASC-BLK-SUB                            20890032
209000             PERFORM 5100-WRITE-TEMP-STORAGE                      20900032
209100             ADD +1     TO ASC-BLK-SUB                            20910032
209200             PERFORM 5100-WRITE-TEMP-STORAGE                      20920032
209300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             20930032
209400                 GIVING PV-BLOCK-NUMBER                           20940032
209500                 REMAINDER PV-REMAINDER                           20950032
209600             IF  PV-REMAINDER > ZERO                              20960032
209700                 ADD +1 TO PV-BLOCK-NUMBER                        20970032
209800             END-IF                                               20980032
209900             MOVE +1    TO ASC-BLK-SUB                            20990032
210000             PERFORM 4410-READ-TEMP-STORAGE                       21000032
210100             ADD +1     TO ASC-BLK-SUB                            21010032
210200                           PV-BLOCK-NUMBER                        21020032
210300             PERFORM 4410-READ-TEMP-STORAGE                       21030032
210400     END-IF.                                                      21040032
210500     MOVE +1            TO ASC-BLK-SUB.                           21050032
210600     COMPUTE ASC-ITEM-SUB =                                       21060032
210700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              21070032
210800         + PC-ITEMS-PER-PANEL).                                   21080032
210900                                                                  21090032
211000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21100032
211100         ADD +1         TO ASC-BLK-SUB                            21110032
211200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            21120032
211300     END-IF.                                                      21130032
211400                                                                  21140032
211500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           21150032
211600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                21160032
211700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        21170032
211800     PERFORM 4420-FORMAT-LIST-LINES                               21180032
211900         VARYING PV-SUB                                           21190032
212000         FROM PC-ITEMS-PER-PANEL BY -1                            21200032
212100         UNTIL PV-SUB < +1.                                       21210032
212200                                                                  21220032
212300     COMPUTE ASC-ITEMS-DISPLAYED =                                21230032
212400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          21240032
212500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    21250032
212600                                      ASTRTITO.                   21260032
212700     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    21270032
212800     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    21280032
212900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21290032
213000                                   TO ASELITO.                    21300032
213100     MOVE ASC-VENDOR-NAME          TO AVENDO.                     21310032
213200                                                                  21320032
213300     IF  DP020-MSG-NUMBER-X = SPACE                               21330032
213400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  21340032
213500*            --- MORE ITEMS TO DISPLAY ----                       21350032
213600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            21360032
213700             SET DP020-MSG-INFORMATIONAL TO TRUE                  21370032
213800         END-IF                                                   21380032
213900     END-IF.                                                      21390032
214000                                                                  21400032
214100*----------------------------------------------------------------*21410032
214200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *21420032
214300*----------------------------------------------------------------*21430032
214400 4410-READ-TEMP-STORAGE.                                          21440032
214500                                                                  21450032
214600     EXEC CICS                                                    21460032
214700         READQ TS                                                 21470032
214800             QUEUE (ASC-LIST-QUEUE-NAME)                          21480032
214900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21490032
215000             ITEM  (PV-BLOCK-NUMBER)                              21500032
215100             RESP  (PV-CICS-RESP)                                 21510032
215200     END-EXEC.                                                    21520032
215300                                                                  21530032
215400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       21540032
215500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     21550032
215600         CONTINUE                                                 21560032
215700     ELSE                                                         21570032
215800         SET DP013-CICS-ABEND     TO TRUE                         21580032
215900         SET DP013-NO-ROLLBACK    TO TRUE                         21590032
216000         MOVE '4410-READ-TEMP-STORAGE'                            21600032
216100                                  TO DP013-PARAGRAPH              21610032
216200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      21620032
216300                                  TO DP013-MESSAGE-TEXT(1)        21630032
216400         PERFORM DP013-0000-PROCESS-ABEND                         21640032
216500     END-IF.                                                      21650032
216600                                                                  21660032
216700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             21670032
216800                                                                  21680032
216900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         21690032
217000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               21700032
217100     END-IF.                                                      21710032
217200                                                                  21720032
217300*----------------------------------------------------------------*21730032
217400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *21740032
217500*----------------------------------------------------------------*21750032
217600 4420-FORMAT-LIST-LINES.                                          21760032
217700                                                                  21770032
217800     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       21780032
217900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                21790032
218000         MOVE DP015-ASK-DRK-OFF TO MR-SELECTA        (PV-SUB)     21800032
218100         MOVE SPACES            TO MR-SELECTI        (PV-SUB)     21810032
218200                                   MR-ACTION         (PV-SUB)     21820032
218300                                   MR-CAPBLTY-NAME   (PV-SUB)     21830032
218400                                   MR-EFF-DATE       (PV-SUB)     21840032
218500                                   MR-EXP-DATE       (PV-SUB)     21850032
218600     ELSE                                                         21860032
218700         IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)       21870032
218800                                                           > SPACE21880032
218900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21890032
219000                                            TO MR-SELECTI (PV-SUB)21900032
219100         ELSE                                                     21910032
219200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21920032
219300                                            TO MR-SELECTI (PV-SUB)21930032
219400         END-IF                                                   21940032
219500                                                                  21950032
219600         IF  DP030-SET-CURSOR-TRAILER                             21960032
219700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)21970032
219800                 > SPACE)                                         21980032
219900               OR (PV-SUB = 1))                                   21990032
220000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               22000032
220100                MOVE -1          TO MR-SELECTL (PV-SUB)           22010032
220200             END-IF                                               22020032
220300         END-IF                                                   22030032
220400                                                                  22040032
220500         IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL            22050032
220600             MOVE ASC-ACTION         (ASC-BLK-SUB ASC-ITEM-SUB) TO22060032
220700                                     MR-ACTION         (PV-SUB)   22070032
220800             MOVE ASC-CAPBLTY-NAME   (ASC-BLK-SUB ASC-ITEM-SUB) TO22080032
220900                                     MR-CAPBLTY-NAME   (PV-SUB)   22090032
221000             MOVE ASC-EFF-DATE       (ASC-BLK-SUB ASC-ITEM-SUB) TO22100032
221100                                     MR-EFF-DATE       (PV-SUB)   22110032
221200             MOVE ASC-EXP-DATE       (ASC-BLK-SUB ASC-ITEM-SUB) TO22120032
221300                                     MR-EXP-DATE       (PV-SUB)   22130032
221400         END-IF                                                   22140032
221500     END-IF.                                                      22150032
221600                                                                  22160032
221700     SUBTRACT +1 FROM ASC-ITEM-SUB                                22170032
221800                                                                  22180032
221900     IF ASC-ITEM-SUB < + 1                                        22190032
222000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  22200032
222100         MOVE +1                 TO ASC-BLK-SUB                   22210032
222200     END-IF.                                                      22220032
222300                                                                  22230032
222400***************************************************************** 22240032
222500** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   * 22250032
222600** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      * 22260032
222700** ISSUE A WARNING.                                             * 22270032
222800***************************************************************** 22280032
222900 4430-CHECK-FOR-BEGIN-AND-END.                                    22290032
223000                                                                  22300032
223100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       22310032
223200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     22320032
223300*            -- NO END-OF-RANGE SPECFIED ---                      22330032
223400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            22340032
223500             SET DP020-MSG-WARNING TO TRUE                        22350032
223600             PERFORM 4431-POSITION-AT-WARNING                     22360032
223700         END-IF                                                   22370032
223800     ELSE                                                         22380032
223900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     22390032
224000*            -- NO BEGINNING-OF-RANGE SPECFIED ---                22400032
224100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            22410032
224200             SET DP020-MSG-WARNING TO TRUE                        22420032
224300             PERFORM 4431-POSITION-AT-WARNING                     22430032
224400         END-IF                                                   22440032
224500     END-IF.                                                      22450032
224600                                                                  22460032
224700***************************************************************** 22470032
224800** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  * 22480032
224900** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   * 22490032
225000** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        * 22500032
225100** POSITION THE CURSOR THERE.                                   * 22510032
225200***************************************************************** 22520032
225300 4431-POSITION-AT-WARNING.                                        22530032
225400                                                                  22540032
225500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 22550032
225600                    - PV-TOP-ITEM + 1.                            22560032
225700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      22570032
225800         CONTINUE                                                 22580032
225900     ELSE                                                         22590032
226000         SET DP030-SET-CURSOR-APPL-1                              22600032
226100                                   TO TRUE                        22610032
226200         MOVE -1                   TO MR-SELECTL (PV-SUB)         22620032
226300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22630032
226400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22640032
226500     END-IF.                                                      22650032
226600                                                                  22660032
226700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   22670032
226800                    - PV-TOP-ITEM + 1.                            22680032
226900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      22690032
227000         CONTINUE                                                 22700032
227100     ELSE                                                         22710032
227200         SET DP030-SET-CURSOR-APPL-1                              22720032
227300                                   TO TRUE                        22730032
227400         MOVE -1                   TO MR-SELECTL (PV-SUB)         22740032
227500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22750032
227600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22760032
227700     END-IF.                                                      22770032
227800                                                                  22780032
227900*----------------------------------------------------------------*22790032
228000* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *22800032
228100* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *22810032
228200* FOR THE SELECTED ITEMS QUEUE.                                  *22820032
228300*                                                                *22830032
228400* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *22840032
228500* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *22850032
228600* THE ARRAY IS FULL.                                             *22860032
228700*----------------------------------------------------------------*22870032
228800 5000-PREPARE-SEL-QUEUE.                                          22880032
228900                                                                  22890032
229000     MOVE +1                   TO  ASC-BLK-SUB.                   22900032
229100     PERFORM 5100-WRITE-TEMP-STORAGE.                             22910032
229200     ADD +1                    TO  ASC-BLK-SUB.                   22920032
229300     PERFORM 5100-WRITE-TEMP-STORAGE.                             22930032
229400                                                                  22940032
229500     MOVE ASC-SEL-QUEUE-NAME-OUT                                  22950032
229600                               TO  VN018-SEL-QUEUE-NAME.          22960032
229700     PERFORM 6010-DELETE-SEL-QUEUE.                               22970032
229800                                                                  22980032
229900                                                                  22990032
230000     SET VN019-IDX             TO  1.                             23000032
230100     MOVE ZERO                 TO VN018-NUMBER-OF-TS-ITEMS.       23010032
230200     INITIALIZE VN019-SELECTED-ITEM-ARRAY.                        23020032
230300                                                                  23030032
230400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           23040032
230500             VARYING PV-ITEM                                      23050032
230600             FROM 1 BY 1                                          23060032
230700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     23070032
230800                                                                  23080032
230900     IF  VN019-IDX > 1                                            23090032
231000         PERFORM 5205-WRITE-SEL-QUEUE                             23100032
231100         ADD +1                TO VN018-NUMBER-OF-TS-ITEMS        23110032
231200     END-IF.                                                      23120032
231300                                                                  23130032
231400*----------------------------------------------------------------*23140032
231500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *23150032
231600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *23160032
231700*----------------------------------------------------------------*23170032
231800 5100-WRITE-TEMP-STORAGE.                                         23180032
231900                                                                  23190032
232000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23200032
232100                                   TO PV-LIST-ITEM-NUMBER.        23210032
232200     COMPUTE PV-BLOCK-NUMBER =                                    23220032
232300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    23230032
232400                                                                  23240032
232500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             23250032
232600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             23260032
232700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      23270032
232800             PERFORM 5105-REWRITE-ASC-LISTQ                       23280032
232900         END-IF                                                   23290032
233000     ELSE                                                         23300032
233100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23310032
233200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            23320032
233300         PERFORM 5110-WRITE-ASC-LISTQ                             23330032
233400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   23340032
233500     END-IF.                                                      23350032
233600                                                                  23360032
233700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23370032
233800                                                                  23380032
233900***************************************************************** 23390032
234000** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    * 23400032
234100** SPECIFIC COMMAREA.                                           * 23410032
234200***************************************************************** 23420032
234300 5105-REWRITE-ASC-LISTQ.                                          23430032
234400                                                                  23440032
234500     EXEC CICS                                                    23450032
234600         WRITEQ TS                                                23460032
234700             QUEUE (ASC-LIST-QUEUE-NAME)                          23470032
234800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23480032
234900             ITEM  (PV-BLOCK-NUMBER)                              23490032
235000             REWRITE                                              23500032
235100             RESP  (PV-CICS-RESP)                                 23510032
235200     END-EXEC.                                                    23520032
235300                                                                  23530032
235400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           23540032
235500         CONTINUE                                                 23550032
235600     ELSE                                                         23560032
235700         SET DP013-CICS-ABEND            TO TRUE                  23570032
235800         SET DP013-NO-ROLLBACK           TO TRUE                  23580032
235900         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       23590032
236000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     23600032
236100                                         TO DP013-MESSAGE-TEXT(1) 23610032
236200         PERFORM DP013-0000-PROCESS-ABEND                         23620032
236300     END-IF.                                                      23630032
236400                                                                  23640032
236500***************************************************************** 23650032
236600** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      * 23660032
236700** SPECIFIC COMMAREA.                                           * 23670032
236800***************************************************************** 23680032
236900 5110-WRITE-ASC-LISTQ.                                            23690032
237000                                                                  23700032
237100     EXEC CICS                                                    23710032
237200         WRITEQ TS                                                23720032
237300             QUEUE (ASC-LIST-QUEUE-NAME)                          23730032
237400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23740032
237500             ITEM  (PV-BLOCK-NUMBER)                              23750032
237600             RESP  (PV-CICS-RESP)                                 23760032
237700     END-EXEC.                                                    23770032
237800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      23780032
237900         SET DP013-CICS-ABEND      TO TRUE                        23790032
238000         SET DP013-NO-ROLLBACK     TO TRUE                        23800032
238100         MOVE '5110-WRITE-ASC-LISTQ'                              23810032
238200                                   TO DP013-PARAGRAPH             23820032
238300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           23830032
238400                                   TO DP013-MESSAGE-TEXT(1)       23840032
238500         PERFORM DP013-0000-PROCESS-ABEND                         23850032
238600     END-IF.                                                      23860032
238700                                                                  23870032
238800*----------------------------------------------------------------*23880032
238900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *23890032
239000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *23900032
239100*----------------------------------------------------------------*23910032
239200 5200-FILL-SEL-QUEUE-RECORD.                                      23920032
239300                                                                  23930032
239400     PERFORM 6112-READ-LIST-QUEUE.                                23940032
239500                                                                  23950032
239600     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       23960032
239700         PERFORM                                                  23970032
239800         VARYING LQW-IDX                                          23980032
239900         FROM 1 BY 1                                              23990032
240000         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            24000032
240100           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          24010032
240200                                                                  24020032
240300             IF  LQW-SELECT (LQW-IDX)                             24030032
240400                 SET ASC-UPDATE-TSQ                               24040032
240500                                   TO TRUE                        24050032
240600                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              24060032
240700                                   TO VN019-ITEM (VN019-IDX)      24070032
240800                 MOVE LQW-CAPBLTY-CDE (LQW-IDX)                   24080032
240900                                   TO VN019-CAPBLTY-CDE           24090032
241000                                        (VN019-IDX)               24100032
241100                 MOVE LQW-CAPBLTY-NAME (LQW-IDX)                  24110032
241200                                   TO VN019-CAPBLTY-NAME          24120032
241300                                        (VN019-IDX)               24130032
241400                 MOVE SPACE        TO VN019-ACTION-SW (VN019-IDX) 24140032
241500                 SET VN019-IDX UP BY 1                            24150032
241600                 IF  VN019-IDX > VN019-MAX-ITEMS                  24160032
241700                     PERFORM 5205-WRITE-SEL-QUEUE                 24170032
241800                     ADD +1        TO VN018-NUMBER-OF-TS-ITEMS    24180032
241900                     INITIALIZE VN019-SELECTED-ITEM-ARRAY         24190032
242000                     SET VN019-IDX TO  1                          24200032
242100                 END-IF                                           24210032
242200             END-IF                                               24220032
242300         END-PERFORM                                              24230032
242400     END-IF.                                                      24240032
242500                                                                  24250032
242600*----------------------------------------------------------------*24260032
242700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *24270032
242800*----------------------------------------------------------------*24280032
242900 5205-WRITE-SEL-QUEUE.                                            24290032
243000                                                                  24300032
243100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            24310032
243200                                   TO VN019-SELECTED-ITEMS.       24320032
243300                                                                  24330032
243400     EXEC CICS                                                    24340032
243500          WRITEQ TS                                               24350032
243600              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      24360032
243700              FROM  (VN019-CAPABILITY-REC)                        24370032
243800              ITEM  (PV-SEL-QUEUE-ITEM)                           24380032
243900              RESP  (PV-CICS-RESP)                                24390032
244000     END-EXEC.                                                    24400032
244100                                                                  24410032
244200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24420032
244300         CONTINUE                                                 24430032
244400     ELSE                                                         24440032
244500         SET DP013-CICS-ABEND      TO TRUE                        24450032
244600         SET DP013-NO-ROLLBACK     TO TRUE                        24460032
244700         MOVE '5205-WRITE-SEL-QUEUE'                              24470032
244800                                   TO DP013-PARAGRAPH             24480032
244900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          24490032
245000                                   TO DP013-MESSAGE-TEXT(1)       24500032
245100         PERFORM DP013-0000-PROCESS-ABEND                         24510032
245200     END-IF.                                                      24520032
245300 EJECT                                                            24530032
245400***************************************************************** 24540032
245500** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, * 24550032
245600** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT * 24560032
245700** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    * 24570032
245800** THE USER.                                                    * 24580032
245900***************************************************************** 24590032
246000 6000-REFRESH-PANEL-FROM-TEMP.                                    24600032
246100                                                                  24610032
246200     IF  ASC-UPDATE-TSQ                                           24620032
246300         SET ASC-NO-TSQ-UPDATE TO TRUE                            24630032
246400         MOVE ZERO                 TO PV-SAVE-ITEM                24640032
246500                                      PV-SEL-QUEUE-ITEM           24650032
246600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        24660032
246700                                   TO PV-HOLD-SELECTED-ITEMS      24670032
246800         PERFORM 6100-UPDATE-TSQ                                  24680032
246900             UNTIL PV-ITEMS-PROCESSED >                           24690032
247000                                     ASC-NUMBER-OF-SELECTED-ITEMS 24700032
247100         PERFORM 6010-DELETE-SEL-QUEUE                            24710032
247200         INITIALIZE ASC-BLOCK-ENTRIES (1)                         24720032
247300                    ASC-BLOCK-ENTRIES (2)                         24730032
247400     END-IF.                                                      24740032
247500                                                                  24750032
247600*---------------------------------------------------------------* 24760032
247700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.              * 24770032
247800*---------------------------------------------------------------* 24780032
247900 6010-DELETE-SEL-QUEUE.                                           24790032
248000                                                                  24800032
248100     EXEC CICS                                                    24810032
248200         DELETEQ TS                                               24820032
248300             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       24830032
248400             RESP  (PV-CICS-RESP)                                 24840032
248500     END-EXEC.                                                    24850032
248600                                                                  24860032
248700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      24870032
248800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         24880032
248900         CONTINUE                                                 24890032
249000     ELSE                                                         24900032
249100         SET DP013-CICS-ABEND TO TRUE                             24910032
249200         SET DP013-NO-ROLLBACK TO TRUE                            24920032
249300         MOVE '6010-DELETE-SEL-QUEUE'                             24930032
249400                        TO DP013-PARAGRAPH                        24940032
249500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         24950032
249600                        TO DP013-MESSAGE-TEXT (1)                 24960032
249700         PERFORM DP013-0000-PROCESS-ABEND                         24970032
249800     END-IF.                                                      24980032
249900                                                                  24990032
250000*----------------------------------------------------------------*25000032
250100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *25010032
250200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *25020032
250300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *25030032
250400*    THE TEMP QUEUE.                                             *25040032
250500*----------------------------------------------------------------*25050032
250600 6100-UPDATE-TSQ.                                                 25060032
250700                                                                  25070032
250800     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             25080032
250900     PERFORM 6105-READ-SEL-QUEUE.                                 25090032
251000     PERFORM                                                      25100032
251100         VARYING VN019-IDX                                        25110032
251200         FROM 1 BY 1                                              25120032
251300         UNTIL ((PV-ITEMS-PROCESSED >                             25130032
251400                              PV-HOLD-SELECTED-ITEMS)             25140032
251500         OR (VN019-IDX GREATER THAN VN019-MAX-ITEMS))             25150032
251600         IF  VN019-ACTION-SW (VN019-IDX) > SPACE                  25160032
251700             PERFORM 6110-PROCESS-ITEMS                           25170032
251800         END-IF                                                   25180032
251900         ADD +1                TO PV-ITEMS-PROCESSED              25190032
252000     END-PERFORM.                                                 25200032
252100                                                                  25210032
252200     PERFORM 6111-WRITE-LIST-QUEUE.                               25220032
252300                                                                  25230032
252400*----------------------------------------------------------------*25240032
252500*    READ THE LIST QUEUE RECORD.                                 *25250032
252600*----------------------------------------------------------------*25260032
252700 6105-READ-SEL-QUEUE.                                             25270032
252800                                                                  25280032
252900     EXEC CICS                                                    25290032
253000          READQ TS                                                25300032
253100              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      25310032
253200              INTO  (VN019-CAPABILITY-REC)                        25320032
253300              ITEM  (PV-SEL-QUEUE-ITEM)                           25330032
253400              RESP  (PV-CICS-RESP)                                25340032
253500     END-EXEC.                                                    25350032
253600                                                                  25360032
253700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25370032
253800         CONTINUE                                                 25380032
253900     ELSE                                                         25390032
254000         SET DP013-CICS-ABEND      TO  TRUE                       25400032
254100         SET DP013-NO-ROLLBACK     TO  TRUE                       25410032
254200         MOVE '6105-READ-SEL-QUEUE'                               25420032
254300                                   TO  DP013-PARAGRAPH            25430032
254400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           25440032
254500                                   TO  DP013-MESSAGE-TEXT(1)      25450032
254600         PERFORM DP013-0000-PROCESS-ABEND                         25460032
254700     END-IF.                                                      25470032
254800                                                                  25480032
254900*----------------------------------------------------------------*25490032
255000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*25500032
255100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY. CALCULATE *25510032
255200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *25520032
255300*----------------------------------------------------------------*25530032
255400 6110-PROCESS-ITEMS.                                              25540032
255500                                                                  25550032
255600     COMPUTE PV-ITEM = 1 + ((VN019-ITEM (VN019-IDX) - 1)          25560032
255700                     / PC-ITEMS-PER-PANEL).                       25570032
255800                                                                  25580032
255900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           25590032
256000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          25600032
256100             PERFORM 6111-WRITE-LIST-QUEUE                        25610032
256200         END-IF                                                   25620032
256300         MOVE PV-ITEM          TO PV-SAVE-ITEM                    25630032
256400                                                                  25640032
256500         PERFORM 6112-READ-LIST-QUEUE                             25650032
256600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               25660032
256700             CONTINUE                                             25670032
256800         END-IF                                                   25680032
256900     END-IF.                                                      25690032
257000                                                                  25700032
257100     COMPUTE PV-SUB = (VN019-ITEM (VN019-IDX)                     25710032
257200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              25720032
257300     SET LQW-DESELECT (PV-SUB) TO    TRUE                         25730032
257400     MOVE LQW-SELECTED-SW (PV-SUB)                                25740032
257500                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  25750032
257600     EVALUATE TRUE                                                25760032
257700         WHEN VN019-ADD (VN019-IDX)                               25770032
257800              MOVE PC-ADD      TO LQW-ACTION (PV-SUB)             25780032
257900                                                                  25790032
258000         WHEN VN019-INQ (VN019-IDX)                               25800032
258100              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             25810032
258200                                                                  25820032
258300         WHEN VN019-UPD (VN019-IDX)                               25830032
258400              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             25840032
258500                                                                  25850032
258600         WHEN VN019-DEL (VN019-IDX)                               25860032
258700              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             25870032
258800                                                                  25880032
258900         WHEN VN019-ERR (VN019-IDX)                               25890032
259000              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             25900032
259100     END-EVALUATE.                                                25910032
259200                                                                  25920032
259300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                25930032
259400                                                                  25940032
259500*----------------------------------------------------------------*25950032
259600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *25960032
259700*----------------------------------------------------------------*25970032
259800 6111-WRITE-LIST-QUEUE.                                           25980032
259900                                                                  25990032
260000     EXEC CICS                                                    26000032
260100         WRITEQ TS                                                26010032
260200             QUEUE (ASC-LIST-QUEUE-NAME)                          26020032
260300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     26030032
260400             ITEM  (PV-SAVE-ITEM)                                 26040032
260500             REWRITE                                              26050032
260600             RESP  (PV-CICS-RESP)                                 26060032
260700     END-EXEC.                                                    26070032
260800                                                                  26080032
260900     IF  PV-CICS-RESP = DFHRESP (NORMAL) OR                       26090032
261000         PV-CICS-RESP = DFHRESP (ITEMERR)                         26100032
261100         CONTINUE                                                 26110032
261200     ELSE                                                         26120032
261300         SET DP013-CICS-ABEND  TO  TRUE                           26130032
261400         SET DP013-NO-ROLLBACK TO  TRUE                           26140032
261500         MOVE '6111-WRITE-LIST-QUEUE'                             26150032
261600                               TO  DP013-PARAGRAPH                26160032
261700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  26170032
261800                               TO  DP013-MESSAGE-TEXT(1)          26180032
261900         PERFORM DP013-0000-PROCESS-ABEND                         26190032
262000     END-IF.                                                      26200032
262100                                                                  26210032
262200*----------------------------------------------------------------*26220032
262300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*26230032
262400*----------------------------------------------------------------*26240032
262500 6112-READ-LIST-QUEUE.                                            26250032
262600                                                                  26260032
262700     EXEC CICS                                                    26270032
262800         READQ TS                                                 26280032
262900             QUEUE (ASC-LIST-QUEUE-NAME)                          26290032
263000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     26300032
263100             ITEM  (PV-ITEM)                                      26310032
263200             RESP  (PV-CICS-RESP)                                 26320032
263300     END-EXEC.                                                    26330032
263400                                                                  26340032
263500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26350032
263600         CONTINUE                                                 26360032
263700     ELSE                                                         26370032
263800         SET DP013-CICS-ABEND        TO TRUE                      26380032
263900         SET DP013-NO-ROLLBACK       TO TRUE                      26390032
264000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           26400032
264100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    26410032
264200                                     TO DP013-MESSAGE-TEXT(1)     26420032
264300         PERFORM DP013-0000-PROCESS-ABEND                         26430032
264400     END-IF.                                                      26440032
264500                                                                  26450032
264600******************************************************************26460032
264700* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *26470032
264800******************************************************************26480032
264900 6200-DEL-LIST-QUEUE.                                             26490032
265000                                                                  26500032
265100     EXEC CICS                                                    26510032
265200         DELETEQ TS                                               26520032
265300             QUEUE (ASC-LIST-QUEUE-NAME)                          26530032
265400             RESP  (PV-CICS-RESP)                                 26540032
265500     END-EXEC.                                                    26550032
265600                                                                  26560032
265700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      26570032
265800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         26580032
265900         CONTINUE                                                 26590032
266000     ELSE                                                         26600032
266100        SET DP013-CICS-ABEND       TO TRUE                        26610032
266200        SET DP013-NO-ROLLBACK      TO TRUE                        26620032
266300        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             26630032
266400        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               26640032
266500                                   TO DP013-MESSAGE-TEXT (1)      26650032
266600        PERFORM DP013-0000-PROCESS-ABEND                          26660032
266700     END-IF.                                                      26670032
266800                                                                  26680032
266900******************************************************************26690032
267000* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *26700032
267100******************************************************************26710032
267200 9100-READ-SEL-QUEUE.                                             26720032
267300                                                                  26730032
267400     EXEC CICS                                                    26740032
267500         READQ TS                                                 26750032
267600             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        26760032
267700             INTO  (VN019-CAPABILITY-REC)                         26770032
267800             ITEM  (ASC-SEL-ITEM)                                 26780032
267900             RESP  (PV-CICS-RESP)                                 26790032
268000     END-EXEC.                                                    26800032
268100                                                                  26810032
268200     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        26820032
268300         CONTINUE                                                 26830032
268400     ELSE                                                         26840032
268500         SET DP013-LOGIC-ABEND                                    26850032
268600             DP013-NO-ROLLBACK     TO TRUE                        26860032
268700         MOVE '9100-READ-SEL-QUEUE'                               26870032
268800                                   TO DP013-PARAGRAPH             26880032
268900         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    26890032
269000                                   TO DP013-MESSAGE-TEXT (1)      26900032
269100         PERFORM DP013-0000-PROCESS-ABEND                         26910032
269200     END-IF.                                                      26920032
269300                                                                  26930032
269400******************************************************************26940032
269500* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *26950032
269600******************************************************************26960032
269700 9200-REWRITE-LIST-QUEUE.                                         26970032
269800                                                                  26980032
269900     EXEC CICS                                                    26990032
270000          WRITEQ TS                                               27000032
270100              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     27010032
270200              FROM    (VN019-CAPABILITY-REC)                      27020032
270300              ITEM    (ASC-SEL-ITEM)                              27030032
270400              RESP    (PV-CICS-RESP)                              27040032
270500              REWRITE                                             27050032
270600     END-EXEC.                                                    27060032
270700                                                                  27070032
270800     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    27080032
270900         SET DP013-CICS-ABEND                                     27090032
271000             DP013-NO-ROLLBACK     TO TRUE                        27100032
271100         MOVE '9200-REWRITE-LIST-QUEUE'                           27110032
271200                                   TO DP013-PARAGRAPH             27120032
271300         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   27130032
271400                                   TO DP013-MESSAGE-TEXT (1)      27140032
271500         PERFORM DP013-0000-PROCESS-ABEND                         27150032
271600     END-IF.                                                      27160032
271700                                                                  27170032
271800*---------------------------------------------------------------- 27180032
271900*    ABEND PROCESSOR MODULE                                       27190032
272000*---------------------------------------------------------------- 27200032
272100     COPY DPPD013.                                                27210032
272200*---------------------------------------------------------------- 27220032
