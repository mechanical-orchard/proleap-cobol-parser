000110******************************************************************00011001
000120 IDENTIFICATION DIVISION.                                         00012001
000130******************************************************************00013001
000140                                                                  00014001
000150 PROGRAM-ID.    SUKUT122.                                         00015099
000160 AUTHOR.        PAUL JORGENSEN.                                   00016068
000170 INSTALLATION.  KOHLS.                                            00017001
000180 DATE-WRITTEN   AUGUST, 2008.                                     00018052
000190 DATE-COMPILED.                                                   00019001
000191                                                                  00019101
000192******************************************************************00019201
000193*  THIS PROGRAM WILL ARCHIVE LABEL MESSAGE DATA AND DELETE        00019399
000194*  ROWS FROM THE TLBVRMG MESSAGE LABEL TABLE.                     00019499
000196******************************************************************00019602
000197******************************************************************00019702
000198 ENVIRONMENT DIVISION.                                            00019802
000199******************************************************************00019902
000200 CONFIGURATION SECTION.                                           00020015
000201                                                                  00020115
000203 SOURCE-COMPUTER.        IBM-3090.                                00020315
000204 OBJECT-COMPUTER.        IBM-3090.                                00020415
000205                                                                  00020515
000206 INPUT-OUTPUT SECTION.                                            00020615
000207                                                                  00020715
000208 FILE-CONTROL.                                                    00020815
000209*                                                                 00020915
000210     SELECT EXTRACT-FILE                                          00021099
000211         ASSIGN TO INP01.                                         00021115
000212                                                                  00021299
000213     SELECT TIMESTAMP-FILE                                        00021399
000214         ASSIGN TO INP02.                                         00021499
000215                                                                  00021515
000216     SELECT ARCHIVE-FILE                                          00021699
000217         ASSIGN TO OUT01.                                         00021715
000218                                                                  00021815
000219*                                                                 00021915
000220******************************************************************00022002
000221 DATA DIVISION.                                                   00022102
000222******************************************************************00022202
000223*                                                                 00022302
000224 FILE SECTION.                                                    00022415
000225*                                                                 00022515
000231 FD  EXTRACT-FILE                                                 00023156
000232     RECORDING MODE IS F                                          00023215
000233     RECORD CONTAINS 34 CHARACTERS                                00023399
000234     LABEL RECORDS ARE OMITTED                                    00023415
000235     DATA RECORD IS EXTRACT-RECORD.                               00023558
000236 01  EXTRACT-RECORD                 PIC X(34).                    00023699
000237*                                                                 00023715
000238 FD  TIMESTAMP-FILE                                               00023899
000239     RECORDING MODE IS F                                          00023999
000240     LABEL RECORDS ARE STANDARD                                   00024099
000241     BLOCK CONTAINS 0 RECORDS.                                    00024199
000242                                                                  00024299
000243 01  TIMESTAMP-RECORD.                                            00024399
000244     05  TR-CONTROL-TMST            PIC X(26).                    00024499
000245     05  FILLER                     PIC X(01).                    00024599
000246     05  TR-CONTROL-TMST2           PIC X(26).                    00024699
000247     05  FILLER                     PIC X(07).                    00024799
000248                                                                  00024899
000249 FD  ARCHIVE-FILE                                                 00024999
000250     RECORDING MODE IS F                                          00025099
000251     RECORD CONTAINS 84 CHARACTERS                                00025199
000252     LABEL RECORDS ARE STANDARD                                   00025299
000253     DATA RECORD IS ARCHIVE-RECORD.                               00025399
000254 01  ARCHIVE-RECORD                 PIC X(84).                    00025499
000255                                                                  00025599
000256******************************************************************00025602
000257 WORKING-STORAGE SECTION.                                         00025702
000258******************************************************************00025802
000259*                                                                 00025902
000260******************************************************************00026002
000261*  DB2 FORMATTED MESSAGE AREA                                     00026102
000262******************************************************************00026202
000263     COPY DPWS004.                                                00026302
000264                                                                  00026402
000265******************************************************************00026502
000266*    COMMUNICATIONS AREA FOR DB2                                  00026602
000267******************************************************************00026702
000268                                                                  00026802
000269     EXEC SQL                                                     00026902
000270          INCLUDE SQLCA                                           00027002
000271     END-EXEC.                                                    00027102
000272                                                                  00027202
000273******************************************************************00027302
000274*                                                                 00027402
000275 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00027502
000276                                                   COMP SYNC.     00027602
000277                                                                  00027702
000278 01  PS-PROGRAM-SWITCHES.                                         00027802
000279     05  PS-END-OF-CURSOR-SW         PIC X(03)     VALUE 'N'.     00027999
000280         88  PS-END-OF-CURSOR-YES                  VALUE 'Y'.     00028099
000281         88  PS-END-OF-CURSOR-NO                   VALUE 'N'.     00028199
000282     05  PS-FIRST-TIME-SW            PIC X(01)     VALUE 'N'.     00028299
000283         88  PS-FIRST-TIME-YES                     VALUE 'Y'.     00028399
000284         88  PS-FIRST-TIME-NO                      VALUE 'N'.     00028499
000285     05  PS-EOF-PROCESS-SW           PIC  X(01)    VALUE 'N'.     00028599
000286         88  PS-EOF-PROCESS-YES                    VALUE 'Y'.     00028699
000287         88  PS-EOF-PROCESS-NO                     VALUE 'N'.     00028799
000288                                                                  00028820
000289                                                                  00028920
000290 01  PC-PROGRAM-CONSTANTS.                                        00029020
000291     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     00029120
000292                                                   COMP SYNC.     00029220
000293     05  PC-PROGRAM-NAME             PIC  X(08)    VALUE          00029323
000294         'SUKUT122'.                                              00029499
000295     05  PC-CURRENT-OPERATING-COMPANY                             00029520
000296                                     PIC  X(02)    VALUE '03'.    00029620
000297     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       00029720
000298                                                   COMP SYNC.     00029820
000299                                                                  00029920
000300 01  PV-PROGRAM-VARIABLES.                                        00030020
000301     05  PV-DELETE-TMST              PIC  X(26)    VALUE SPACES.  00030199
000302     05  PV-SQL-RETURN-CD            PIC 999-.                    00030220
000303     05  PV-CICS-MSG-AREA            PIC  X(80)    VALUE SPACES.  00030320
000304     05  PV-COMMAREA-LENGTH          PIC S9(04)    VALUE +0       00030420
000305                                                   COMP SYNC.     00030520
000306     05  PV-CICS-RESPONSE            PIC S9(9)     VALUE ZERO     00030620
000307                                                   COMP SYNC.     00030720
000308                                                                  00030820
000309     05  PV-PO-NBR-MSG.                                           00030999
000310         10  FILLER                  PIC  X(09)    VALUE          00031099
000311         'PO NBR = '.                                             00031199
000312         10  PV-PO-NBR               PIC  9(09).                  00031299
000313     05  PV-REC-SEQ-NBR-MSG.                                      00031399
000314         10  FILLER                  PIC  X(15)    VALUE          00031499
000315         'RECEIVER NBR = '.                                       00031599
000316         10  PV-REC-SEQ-NBR          PIC  9(04).                  00031699
000317     05  PV-DONE-PROCESSING-SW       PIC  X(01)    VALUE 'N'.     00031720
000318         88  PV-DONE-PROCESSING                    VALUE 'Y'.     00031820
000319     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACE.   00031920
000320     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00032020
000321     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00032120
000322                                                                  00032220
000323     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     00032320
000324                                                   COMP SYNC.     00032420
000325     05  PV-ABEND-PARA-NAME          PIC X(30)     VALUE SPACES.  00032520
000326     05  PV-DB2-OPERATION-MSG-1      PIC X(40)     VALUE SPACES.  00032620
000327     05  PV-DB2-OPERATION-MSG-2      PIC X(40)     VALUE SPACES.  00032720
000328     05  PV-DB2-OPERATION-MSG-3      PIC X(40)     VALUE SPACES.  00032899
000329     05  PV-DB2-TABLE-NAME           PIC X(12)     VALUE SPACES.  00032999
000330     05  PV-SQLCODE                  PIC Z(8)9-.                  00033099
000331     05  PV-RETRY-COUNTER            PIC S9(04)    VALUE ZERO     00033199
000332                                                   COMP SYNC.     00033299
000333                                                                  00033320
000334     05  PV-DAYS-TO-DELETE           PIC S9(04)    COMP.          00033429
000340     05  PV-DAYS-TO-DELETE-DSPLY     PIC  9(04).                  00034047
000345     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00034547
000346                                                                  00034647
000349     05  PV-RECORDS-READ             PIC S9(07)    COMP-3         00034991
000350                                                   VALUE ZEROS.   00035047
000351     05  PV-RECORDS-WRITTEN          PIC S9(07)    COMP-3         00035199
000352                                                   VALUE ZEROS.   00035247
000353     05  PV-ROWS-DELETED             PIC S9(07)    COMP-3         00035399
000354                                                   VALUE ZEROS.   00035499
000362 01  SD-SYSTEM-DATE.                                              00036247
000363     05  SD-SYSTEM-DATE-YY           PIC  9(02)      VALUE ZERO.  00036347
000364     05  SD-SYSTEM-DATE-MM           PIC  9(02)      VALUE ZERO.  00036447
000365     05  SD-SYSTEM-DATE-DD           PIC  9(02)      VALUE ZERO.  00036547
000366                                                                  00036647
000367 01  ST-SYSTEM-TIME.                                              00036747
000368     05  ST-SYSTEM-HOUR             PIC  9(02)      VALUE ZERO.   00036847
000369     05  ST-SYSTEM-MINUTE           PIC  9(02)      VALUE ZERO.   00036947
000370     05  FILLER                     PIC  9(04)      VALUE ZERO.   00037047
000371                                                                  00037147
000372******************************************************************00037247
000373*    ABEND PROCESSING COPYBOOK.                                   00037347
000374******************************************************************00037447
000375                                                                  00037547
000376     COPY DPWS013.                                                00037647
000377                                                                  00037747
000379******************************************************************00037947
000380*    INPUT RECORD LAYOUT.                                         00038099
000381******************************************************************00038147
000383     COPY SURD078.                                                00038358
000384                                                                  00038447
000385******************************************************************00038599
000386*    OUTPUT TLBVRMG ARCHIVE RECORD                                00038699
000387******************************************************************00038799
000388     COPY SURD079.                                                00038899
000389                                                                  00038999
000390*----------------------------------------------------------------*00039099
000391*  DCLGEN LAYOUT AND COBOL DECLARATION FOR MESSAGE TABLE         *00039199
000392*----------------------------------------------------------------*00039299
000393     EXEC SQL                                                     00039399
000394         INCLUDE TLBVRMG                                          00039499
000400     END-EXEC.                                                    00040099
000420                                                                  00042059
000421     EXEC SQL                                                     00042199
000422          DECLARE LBL-MSG-CSR CURSOR WITH HOLD                    00042299
000423          FOR                                                     00042399
000430          SELECT PO_NBR                                           00043099
000440               , RCVR_SEQ_NBR                                     00044099
000450               , PO_LNE_NBR                                       00045099
000451               , PREPK_ID                                         00045199
000452               , WRKR_USR_ID                                      00045299
000453               , TRIP_ID                                          00045399
000454               , CICS_SESS_ID                                     00045499
000455               , CRE_TMST                                         00045599
000456               , ERR_MSG_CDE                                      00045699
000457               , VS_NBR                                           00045799
000458               , NRF_CLOR_CDE                                     00045899
000460           FROM  TLBVRMG                                          00046099
000472          WHERE PO_NBR        =  :SU078-PO-NBR                    00047299
000473            AND RCVR_SEQ_NBR  =  :SU078-RCVR                      00047399
000474            AND CRE_TMST     <=  :PV-DELETE-TMST                  00047499
000475     END-EXEC.                                                    00047599
000476                                                                  00047699
000477******************************************************************00047727
000478 PROCEDURE DIVISION.                                              00047827
000479******************************************************************00047927
000480*                                                                 00048027
000481******************************************************************00048127
000482* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     00048227
000483*      PROGRAM.                                                   00048327
000484******************************************************************00048427
000485 0000-PROGRAM-MAINLINE.                                           00048527
000486*                                                                 00048627
000487     DISPLAY '**** START OF SUKUT122 ****'.                       00048799
000488     DISPLAY ' '.                                                 00048827
000489                                                                  00048927
000490      PERFORM 1000-INITIALIZE                                     00049027
000491      PERFORM 2000-MAIN-PROCESS                                   00049127
000492              UNTIL PS-EOF-PROCESS-YES                            00049299
000493      PERFORM 9000-END-PROCESS.                                   00049327
000494*                                                                 00049427
000495     STOP RUN.                                                    00049527
000496*                                                                 00049627
000497******************************************************************00049727
000498*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    00049827
000499*    -- OPEN FILES                                                00049927
000500******************************************************************00050027
000501 1000-INITIALIZE.                                                 00050127
000502                                                                  00050227
000504     OPEN INPUT  EXTRACT-FILE                                     00050499
000505                 TIMESTAMP-FILE                                   00050599
000506          OUTPUT ARCHIVE-FILE.                                    00050699
000507                                                                  00050799
000508*READ TIMESTAMP FILE TO GET PURGE DATE                            00050899
000509     PERFORM 7010-READ-TIMESTAMP-FILE.                            00050999
000510                                                                  00051099
000511*READ FIRST INPUT RECORD.                                         00051199
000512     PERFORM 7000-READ-EXTRACT-FILE.                              00051299
000513*                                                                 00051399
000514 2000-MAIN-PROCESS.                                               00051499
000622     SET PS-END-OF-CURSOR-NO  TO TRUE                             00062299
000623     PERFORM 4000-OPEN-CURSOR                                     00062399
000624     PERFORM 4100-FETCH-CURSOR                                    00062499
000625     IF PS-END-OF-CURSOR-NO                                       00062599
000626         PERFORM 3000-WRITE-ARCHIVE-OUT                           00062699
000627             UNTIL PS-END-OF-CURSOR-YES                           00062799
000629         PERFORM 5000-DELETE-TLBVRMG                              00062999
000631         PERFORM 5100-COMMIT                                      00063199
000632     END-IF.                                                      00063299
000633     PERFORM 4200-CLOSE-CURSOR.                                   00063399
000640                                                                  00064099
000650     PERFORM 7000-READ-EXTRACT-FILE.                              00065099
000651                                                                  00065199
000652 3000-WRITE-ARCHIVE-OUT.                                          00065299
000653                                                                  00065399
000654     WRITE ARCHIVE-RECORD                                         00065499
000655         FROM SU079-TLBVRMG-RECORD.                               00065599
000656     ADD  +1                      TO PV-RECORDS-WRITTEN.          00065699
000657     PERFORM 4100-FETCH-CURSOR.                                   00065799
000658                                                                  00065899
000660 4000-OPEN-CURSOR.                                                00066099
000691                                                                  00069199
000692     PERFORM WITH TEST AFTER                                      00069299
000693       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       00069399
000694         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 00069499
000695                OR                                                00069599
000696                SQLCODE = +0)                                     00069699
000697                                                                  00069799
000698         EXEC SQL                                                 00069899
000699              OPEN LBL-MSG-CSR                                    00069999
000700         END-EXEC                                                 00070099
000701                                                                  00070199
000702         EVALUATE TRUE                                            00070299
000703             WHEN SQLCODE = +0                                    00070399
000704             WHEN SQLCODE = -904                                  00070499
000705             WHEN SQLCODE = -911                                  00070599
000706                 CONTINUE                                         00070699
000707             WHEN SQLWARN0 NOT = SPACES                           00070799
000708             WHEN SQLCODE < +0                                    00070899
000709             WHEN SQLCODE > +0                                    00070999
000710                 MOVE '4000-OPEN-CURSOR          '                00071099
000711                                    TO PV-ABEND-PARA-NAME         00071199
000712                 MOVE 'OPEN LBL-MSG-CSR CURSOR'                   00071299
000713                                    TO PV-DB2-OPERATION-MSG-1     00071399
000714                 MOVE 'TLBVRMG'     TO PV-DB2-TABLE-NAME          00071499
000715                 PERFORM 9998-SQL-ABEND                           00071599
000722         END-EVALUATE                                             00072299
000723     END-PERFORM.                                                 00072399
000724                                                                  00072499
000725     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         00072599
000726          MOVE '4000-OPEN-CURSOR          '                       00072699
000727                                    TO PV-ABEND-PARA-NAME         00072799
000728          MOVE 'OPEN LBL-MSG-CSR CURSOR'                          00072899
000729                                    TO PV-DB2-OPERATION-MSG-1     00072999
000730          MOVE 'MAX RETRIES EXCEEDED'                             00073099
000731                                    TO PV-DB2-OPERATION-MSG-2     00073199
000732          MOVE 'TLBVRMG'            TO PV-DB2-TABLE-NAME          00073299
000733          PERFORM 9998-SQL-ABEND                                  00073399
000738     END-IF.                                                      00073899
000739                                                                  00073999
000740 4100-FETCH-CURSOR.                                               00074099
000743                                                                  00074399
000744     PERFORM WITH TEST AFTER                                      00074499
000745       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       00074599
000746         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 00074699
000748                OR SQLCODE = +0                                   00074899
000749                OR PS-END-OF-CURSOR-YES)                          00074999
000750                                                                  00075099
000751         EXEC SQL                                                 00075199
000752             FETCH LBL-MSG-CSR                                    00075299
000753              INTO :SU079-PO-NBR                                  00075399
000754                  ,:SU079-RCVR-SEQ-NBR                            00075499
000755                  ,:SU079-PO-LNE-NBR                              00075599
000756                  ,:SU079-PREPK-ID                                00075699
000757                  ,:SU079-WRKR-USR-ID                             00075799
000758                  ,:SU079-TRIP-ID                                 00075899
000759                  ,:SU079-CICS-SESS-ID                            00075999
000760                  ,:SU079-CRE-TMST                                00076099
000761                  ,:SU079-ERR-MSG-CDE                             00076199
000762                  ,:SU079-VS-NBR                                  00076299
000763                  ,:SU079-NRF-CLOR-CDE                            00076399
000764         END-EXEC                                                 00076499
000765         EVALUATE TRUE                                            00076599
000766             WHEN SQLCODE = +0                                    00076699
000767             WHEN SQLCODE = -904                                  00076799
000768             WHEN SQLCODE = -911                                  00076899
000769                 CONTINUE                                         00076999
000770             WHEN SQLCODE = +100                                  00077099
000771                 SET PS-END-OF-CURSOR-YES                         00077199
000772                                    TO TRUE                       00077299
000773             WHEN SQLWARN0 NOT = SPACES                           00077399
000774             WHEN SQLCODE < +0                                    00077499
000775             WHEN SQLCODE > +0                                    00077599
000776                 MOVE '4100-FETCH-CURSOR          '               00077699
000777                                    TO PV-ABEND-PARA-NAME         00077799
000778                 MOVE 'FETCH LBL-MSG-CSR CURSOR'                  00077899
000779                                    TO PV-DB2-OPERATION-MSG-1     00077999
000780                 MOVE 'TLBVRMG'     TO PV-DB2-TABLE-NAME          00078099
000781                 PERFORM 9998-SQL-ABEND                           00078199
000782         END-EVALUATE                                             00078299
000783     END-PERFORM.                                                 00078399
000784                                                                  00078499
000785     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         00078599
000786          MOVE '4100-FETCH-CURSOR          '                      00078699
000787                                    TO PV-ABEND-PARA-NAME         00078799
000788          MOVE 'FETCH LBL-MSG-CSR CURSOR'                         00078899
000789                                    TO PV-DB2-OPERATION-MSG-1     00078999
000790          MOVE 'MAX RETRIES EXCEEDED'                             00079099
000791                                    TO PV-DB2-OPERATION-MSG-2     00079199
000792          MOVE 'TLBVRMG'            TO PV-DB2-TABLE-NAME          00079299
000793          PERFORM 9998-SQL-ABEND                                  00079399
000794     END-IF.                                                      00079499
000795                                                                  00079599
000796 4200-CLOSE-CURSOR.                                               00079699
000797                                                                  00079799
000798     PERFORM WITH TEST AFTER                                      00079899
000799       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       00079999
000800         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 00080099
000801                OR                                                00080199
000802                SQLCODE = +0)                                     00080299
000803                                                                  00080399
000804         EXEC SQL                                                 00080499
000805              CLOSE LBL-MSG-CSR                                   00080599
000806         END-EXEC                                                 00080699
000807                                                                  00080799
000808         EVALUATE TRUE                                            00080899
000809             WHEN SQLCODE = +0                                    00080999
000810             WHEN SQLCODE = -904                                  00081099
000811             WHEN SQLCODE = -911                                  00081199
000812                 CONTINUE                                         00081299
000813             WHEN SQLWARN0 NOT = SPACES                           00081399
000814             WHEN SQLCODE < +0                                    00081499
000815             WHEN SQLCODE > +0                                    00081599
000816                 MOVE '4200-CLOSE-CURSOR          '               00081699
000817                                         TO PV-ABEND-PARA-NAME    00081799
000820                 MOVE SU078-PO-NBR       TO PV-PO-NBR             00082099
000821                 MOVE SU078-RCVR         TO PV-REC-SEQ-NBR        00082199
000822                 MOVE PV-PO-NBR-MSG      TO PV-DB2-OPERATION-MSG-100082299
000823                 MOVE PV-REC-SEQ-NBR-MSG TO PV-DB2-OPERATION-MSG-200082399
000824                 MOVE 'TLBVRMG'          TO PV-DB2-TABLE-NAME     00082499
000825                 PERFORM 9998-SQL-ABEND                           00082599
000826         END-EVALUATE                                             00082699
000827     END-PERFORM.                                                 00082799
000828                                                                  00082899
000829     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         00082999
000830          MOVE '4200-CLOSE-CURSOR          '                      00083099
000831                                  TO PV-ABEND-PARA-NAME           00083199
000834          MOVE 'MAX RETRIES EXCEEDED'                             00083499
000835                                  TO PV-DB2-OPERATION-MSG-1       00083599
000836          MOVE SU078-PO-NBR       TO PV-PO-NBR                    00083699
000837          MOVE SU078-RCVR         TO PV-REC-SEQ-NBR               00083799
000838          MOVE PV-PO-NBR-MSG      TO PV-DB2-OPERATION-MSG-2       00083899
000839          MOVE PV-REC-SEQ-NBR-MSG TO PV-DB2-OPERATION-MSG-3       00083999
000840          MOVE 'TLBVRMG'            TO PV-DB2-TABLE-NAME          00084099
000841          PERFORM 9998-SQL-ABEND                                  00084199
000842     END-IF.                                                      00084299
000843                                                                  00084399
000844 5000-DELETE-TLBVRMG.                                             00084499
000845                                                                  00084599
000846     EXEC SQL                                                     00084699
000847     DELETE                                                       00084799
000851       FROM TLBVRMG                                               00085199
000852      WHERE PO_NBR        =  :SU078-PO-NBR                        00085299
000853        AND RCVR_SEQ_NBR  =  :SU078-RCVR                          00085399
000854        AND CRE_TMST     <=  :PV-DELETE-TMST                      00085499
000855     END-EXEC                                                     00085599
000856                                                                  00085699
000857     IF SQLCODE = +0                                              00085799
000858         ADD SQLERRD(3)          TO PV-ROWS-DELETED               00085899
000859     ELSE                                                         00085999
000860         MOVE '5000-DELETE-TLBVRMG'                               00086099
000861                                 TO PV-ABEND-PARA-NAME            00086199
000862         MOVE SU078-PO-NBR       TO PV-PO-NBR                     00086299
000863         MOVE SU078-RCVR         TO PV-REC-SEQ-NBR                00086399
000864         MOVE PV-PO-NBR-MSG      TO PV-DB2-OPERATION-MSG-1        00086499
000865         MOVE PV-REC-SEQ-NBR-MSG TO PV-DB2-OPERATION-MSG-2        00086599
000866         MOVE 'TLBVRMG'          TO PV-DB2-TABLE-NAME             00086699
000867         PERFORM 9998-SQL-ABEND                                   00086799
000868     END-IF.                                                      00086899
000869                                                                  00086999
000870 5100-COMMIT.                                                     00087099
000871                                                                  00087199
000872     EXEC SQL                                                     00087299
000873          COMMIT                                                  00087399
000874     END-EXEC                                                     00087499
000875                                                                  00087599
000876     IF SQLCODE = ZERO                                            00087699
000877         CONTINUE                                                 00087799
000878     ELSE                                                         00087899
000879         MOVE '5100-COMMIT'      TO PV-ABEND-PARA-NAME            00087999
000880         MOVE SU078-PO-NBR       TO PV-PO-NBR                     00088099
000881         MOVE SU078-RCVR         TO PV-REC-SEQ-NBR                00088199
000882         MOVE PV-PO-NBR-MSG      TO PV-DB2-OPERATION-MSG-1        00088299
000883         MOVE PV-REC-SEQ-NBR-MSG TO PV-DB2-OPERATION-MSG-2        00088399
000884         MOVE 'TLBVRMG'          TO PV-DB2-TABLE-NAME             00088499
000885         PERFORM 9998-SQL-ABEND                                   00088599
000886     END-IF.                                                      00088699
000887*                                                                 00088799
000888 7000-READ-EXTRACT-FILE.                                          00088899
000889******************************************************************00088999
000890     READ EXTRACT-FILE INTO SU078-EXTRACT-RECORD                  00089099
000891        AT END                                                    00089199
000892           SET PS-EOF-PROCESS-YES TO TRUE                         00089299
000893        NOT AT END                                                00089399
000894            ADD  +1               TO PV-RECORDS-READ              00089499
000895     END-READ.                                                    00089599
000896*                                                                 00089699
000897                                                                  00089799
000898 7010-READ-TIMESTAMP-FILE.                                        00089899
000899     READ TIMESTAMP-FILE.                                         00089999
000900                                                                  00090099
000901     DISPLAY 'SUKUT122 - PURGE TIMESTAMP: '                       00090199
000902             TR-CONTROL-TMST.                                     00090299
000903                                                                  00090399
000904     MOVE  TR-CONTROL-TMST  TO  PV-DELETE-TMST.                   00090499
000905                                                                  00090599
000906                                                                  00090699
000907******************************************************************00090799
000908*     CLOSE FILES.                                              **00090899
000909******************************************************************00090999
000910 9000-END-PROCESS.                                                00091099
000911*                                                                 00091199
000912     CLOSE ARCHIVE-FILE                                           00091299
000913           TIMESTAMP-FILE                                         00091399
000914           EXTRACT-FILE.                                          00091499
000915*                                                                 00091599
000916     PERFORM 9999-FINAL-DISPLAYS.                                 00091699
000917*                                                                 00091799
000918******************************************************************00091899
000919*     SQL ERROR PROCESSING                                      **00091999
000920******************************************************************00092099
000921 9998-SQL-ABEND.                                                  00092199
000922     PERFORM 9999-FINAL-DISPLAYS.                                 00092299
000923     MOVE SQLCODE     TO PV-SQLCODE.                              00092399
000924     DISPLAY '** ABEND           ** = SQLABEND'.                  00092499
000925     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          00092599
000926     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARA-NAME        00092699
000927     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        00092799
000928     DISPLAY '** OPERATIONAL MSG ** = ' PV-DB2-OPERATION-MSG-1.   00092899
000929     DISPLAY '** OPERATIONAL MSG ** = ' PV-DB2-OPERATION-MSG-2.   00092999
000930     DISPLAY '** OPERATIONAL MSG ** = ' PV-DB2-OPERATION-MSG-3.   00093099
000931     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               00093199
000932     COPY DPPD004.                                                00093299
000933                                                                  00093399
000934     MOVE +4013                  TO PV-ABEND-CODE.                00093499
000935     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       00093599
000940*                                                                 00094015
000950 9999-FINAL-DISPLAYS.                                             00095099
000970     DISPLAY '**********************************'.                00097099
000980     DISPLAY '** SUKUT122 SUMMARY **'.                            00098099
000990     MOVE PV-RECORDS-READ       TO PV-DISPLAY-COUNT               00099099
000991     DISPLAY 'TOTAL INPUT RECORDS         = ' PV-DISPLAY-COUNT   .00099199
000992     MOVE PV-RECORDS-WRITTEN    TO PV-DISPLAY-COUNT               00099299
000993     DISPLAY 'TOTAL ARCHIVE RECORDS       = ' PV-DISPLAY-COUNT   .00099399
000994     MOVE PV-ROWS-DELETED       TO PV-DISPLAY-COUNT               00099499
000995     DISPLAY 'TLBVRMG ROWS DELETED        = ' PV-DISPLAY-COUNT   .00099599
000996     DISPLAY '**********************************'.                00099699
001000                                                                  00100013
