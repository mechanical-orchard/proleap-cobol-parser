000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.     BPKUT574.                                        00050000
000600 AUTHOR.         COGNIZANT.                                       00060000
000700 INSTALLATION.   KOHLS DEPARTMENT STORES.                         00070000
000800 DATE-WRITTEN.   05/12/2010.                                      00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*                AIM WEEKLY SEASONAL FEED PROGRAM                *00120000
001300******************************************************************00130000
001400                                                                  00140000
001500******************************************************************00150000
001600*  CHANGES:                                                      *00160000
001700*                                                                *00170000
001800*  05/12/2010    COGNIZANT  WR# 2344                             *00180000
001900*     -  NEW PROGRAM FOR EP UPGRADE.                             *00190000
002000*     -  FORMAT THE DATA FOR LOADING INTO STAGING TABLE .        *00200000
P41820*                                                                 00210000
P41820*  07/26/2013    COGNIZANT  WR# CHG0058433                        00220000
P41820*     -  ADDED LOGIC TO ADD THE RECEIPTS DOLLAR AND COST TO THE   00230000
P41820*     -  REPLENISHMENT BUCKET IF THE PO_TYP_CDE IS 'EC' AND       00240000
P41820*     -  THE CRE-BY-UID IS 'INFOREM'.                             00250000
C98147*                                                                 00260000
C98147*  11/11/2014  L. FRIESS    WR# CHG0098147                        00270000
C98147*     - RECOMPILED TO BRING IN POWS054 COPYBOOK WITH EXPANDED     00280000
C98147*       PO NUMBER.                                                00290000
C98147*                                                                 00291000
11752A*  02/27/2017  J. JAKSE                                           00292000
11752A*     - REMOVE UNNECESSARY FIELDS FOR EP UPGRADE                  00293000
11752A*                                                                 00294000
11752A*  06/14/2017  J. SELWITSCHKA                                     00295000
11752A*     - FOR EP UPGRADE. DO NOT WRITE ZERO VALUES. DO NOT WRITE    00296000
11752A*       RECORDS TO FILE IF ALL VALUES ARE ZERO.                   00296100
11752A*                                                                 00297000
11752A*  06/22/2017  J. SELWITSCHKA                                     00298000
11752A*     - NEW VERSION BPKUT574 IS A COPY OF BPKUT573 WITH EP        00299000
11752A*       UPGRADE CHANGES. CREATED BECAUSE EP UPGRADE VERSION       00299100
11752A*       WILL BE RUNNING IN PARALLEL WITH OLD VERSION.             00299200
11752A*  09/07/201 COGNIZANT                                            00299300
11752A*     - NEW FILTER "RE" (REPLEN ECOMM) ADDED.                     00299400
002100******************************************************************00300000
002200 ENVIRONMENT DIVISION.                                            00310000
002300******************************************************************00320000
002400                                                                  00330000
002500******************************************************************00340000
002600 CONFIGURATION SECTION.                                           00350000
002700******************************************************************00360000
002800                                                                  00370000
002900 SOURCE-COMPUTER.        IBM-3090.                                00380000
003000 OBJECT-COMPUTER.        IBM-3090.                                00390000
003100                                                                  00400000
003200******************************************************************00410000
003300 INPUT-OUTPUT SECTION.                                            00420000
003400******************************************************************00430000
003500                                                                  00440000
003600 FILE-CONTROL.                                                    00450000
003700                                                                  00460000
003800     SELECT WKLY-RECEIPTS-FILE                                    00470000
003900         ASSIGN TO INP01.                                         00480000
004000                                                                  00490000
004100     SELECT SEASONAL-FILE                                         00500000
004200         ASSIGN TO OUT01.                                         00510000
004300                                                                  00520000
004400     SELECT TRANS-IN-FILE                                         00530000
004500         ASSIGN TO INP02.                                         00540000
004600                                                                  00550000
004700     SELECT TRANS-OUT-FILE                                        00560000
004800         ASSIGN TO OUT02.                                         00570000
004900                                                                  00580000
005000******************************************************************00590000
005100 DATA DIVISION.                                                   00600000
005200******************************************************************00610000
005300                                                                  00620000
005400******************************************************************00630000
005500 FILE SECTION.                                                    00640000
005600******************************************************************00650000
005700 FD  WKLY-RECEIPTS-FILE                                           00660000
005800     RECORDING MODE IS F                                          00670000
005900     LABEL RECORDS ARE OMITTED                                    00680000
006000     BLOCK CONTAINS 0 RECORDS.                                    00690000
006100                                                                  00700000
P41820 01  WKLY-RECEIPTS-REC                   PIC X(108).              00710000
006300                                                                  00720000
006400 FD  SEASONAL-FILE                                                00730000
006500     RECORDING MODE IS F                                          00740000
006600     LABEL RECORDS ARE STANDARD                                   00750000
006700     BLOCK CONTAINS 0 RECORDS.                                    00760000
006800                                                                  00770000
006900 01  SEASONAL-REC                        PIC X(200).              00780000
007000                                                                  00790000
007100 FD  TRANS-IN-FILE                                                00800000
007200     RECORDING MODE IS F                                          00810000
007300     LABEL RECORDS ARE STANDARD                                   00820000
007400     BLOCK CONTAINS 0 RECORDS.                                    00830000
007500                                                                  00840000
007600 01  TRANS-IN-RECORD                     PIC X(80).               00850000
007700                                                                  00860000
007800 FD  TRANS-OUT-FILE                                               00870000
007900     RECORDING MODE IS F                                          00880000
008000     LABEL RECORDS ARE STANDARD                                   00890000
008100     BLOCK CONTAINS 0 RECORDS.                                    00900000
008200                                                                  00910000
008300 01  TRANS-OUT-RECORD                    PIC X(80).               00920000
008400                                                                  00930000
008500******************************************************************00940000
008600 WORKING-STORAGE SECTION.                                         00950000
008700******************************************************************00960000
008800                                                                  00970000
008900 01  PC-PROGRAM-CONSTANTS.                                        00980000
009000     05  PC-VIRTUAL-STORE      PIC X(07)  VALUE 'VIRTSTR'.        00990000
009100     05  PC-PHYSICAL-STORE     PIC X(07)  VALUE 'PHYSSTR'.        01000000
009200     05  PC-1                  PIC 9(01)  VALUE 1.                01010000
009300                                                                  01020000
009400 01  PS-PROGRAM-SWITCHES.                                         01030000
009500     05  PS-END-OF-WKLY-RECEIPTS-SW   PIC X(01)     VALUE 'N'.    01040000
009600         88  PS-END-OF-WKLY-RECEIPTS                VALUE 'Y'.    01050000
11752A     05  PS-HEADER-WRITTEN-SW         PIC X(01)     VALUE 'N'.    01051000
11752A         88  PS-HEADER-WRITTEN                      VALUE 'Y'.    01052000
11752A         88  PS-HEADER-NOT-WRITTEN                  VALUE 'N'.    01053000
009700                                                                  01060000
009800 01  PV-PROGRAM-VARIABLES.                                        01070000
009900     05  PV-RTL-VALUE              PIC S9(06)V9(05) VALUE ZEROS.  01080000
010000     05  PV-CST-VALUE              PIC S9(06)V9(05) VALUE ZEROS.  01090000
010100     05  PV-YEAR-NBR               PIC X(6).                      01100000
010200     05  WS-SPACE-CNT              PIC 9(1)   VALUE ZEROES.       01110000
010300     05  WS-START-POS              PIC 9(1)   VALUE ZEROES.       01120000
010400     05  WS-END-POS                PIC 9(1)   VALUE ZEROES.       01130000
010500     05  WS-STRT-TRN-POS           PIC 9(1)   VALUE ZEROES.       01140000
010600     05  WS-END-TRN-POS            PIC 9(1)   VALUE ZEROES.       01150000
010700     05  WS-SEQ-NO                 PIC 9(9)   VALUE ZEROES.       01160000
010800     05  WS-SEQ-NO-TMP             PIC Z(9)   VALUE ZEROES.       01170000
010900     05  WS-TRANS-ID-TMP           PIC Z(9)   VALUE ZEROES.       01180000
011000     05  WS-TRANS-REC.                                            01190000
011100         10  WS-TRANS-ID           PIC 9(9)   VALUE ZEROES.       01200000
011200         10  WS-SEQ-ID             PIC 9(9)   VALUE ZEROES.       01210000
011300         10  FILLER                PIC X(62)  VALUE SPACES.       01220000
11752A     05  WS-CURRENT-DATE           PIC X(21)  VALUE SPACES.       01230000
11752A     05  WS-GREC-RPLN-DLR          PIC S9(06)V9(05) VALUE ZEROS.  01231000
11752A     05  WS-GREC-RPLN-CST          PIC S9(06)V9(05) VALUE ZEROS.  01232000
11752A     05  PV-POS1                   PIC 9(4)   VALUE ZEROES.       01233000
11752A     05  PV-POS2                   PIC 9(4)   VALUE ZEROES.       01234000
011500                                                                  01240000
011600 01  HOLD-FIELDS.                                                 01250000
011700     05  H-DEPT-NBR                PIC X(03)        VALUE SPACE.  01260000
011800     05  H-MAJOR-CLASS-NBR         PIC X(02)        VALUE SPACE.  01270000
011900     05  H-E-BUS-IND               PIC X(01)        VALUE SPACE.  01280000
012000     05  H-VS-REPL-RTL             PIC S9(06)V9(05) VALUE ZEROS.  01290000
012100     05  H-VS-REPL-CST             PIC S9(06)V9(05) VALUE ZEROS.  01300000
012200     05  H-VS-FT-RTL               PIC S9(06)V9(05) VALUE ZEROS.  01310000
012300     05  H-VS-FT-CST               PIC S9(06)V9(05) VALUE ZEROS.  01320000
012400     05  H-PS-REPL-RTL             PIC S9(06)V9(05) VALUE ZEROS.  01330000
012500     05  H-PS-REPL-CST             PIC S9(06)V9(05) VALUE ZEROS.  01340000
012600     05  H-PS-FT-RTL               PIC S9(06)V9(05) VALUE ZEROS.  01350000
012600     05  H-PS-FT-CST               PIC S9(06)V9(05) VALUE ZEROS.  01351000
012800                                                                  01370000
012900 01  TOTAL-COUNTS.                                                01380000
013000     05  TC-VS-REPL-RTL            PIC 9(09)        VALUE ZEROS.  01390000
013100     05  TC-VS-REPL-CST            PIC 9(09)        VALUE ZEROS.  01400000
013200     05  TC-VS-FT-RTL              PIC 9(09)        VALUE ZEROS.  01410000
013300     05  TC-VS-FT-CST              PIC 9(09)        VALUE ZEROS.  01420000
013400     05  TC-PS-REPL-RTL            PIC 9(09)        VALUE ZEROS.  01430000
013500     05  TC-PS-REPL-CST            PIC 9(09)        VALUE ZEROS.  01440000
013600     05  TC-PS-FT-RTL              PIC 9(09)        VALUE ZEROS.  01450000
013700     05  TC-PS-FT-CST              PIC 9(09)        VALUE ZEROS.  01451000
013800                                                                  01470000
013900 01  TOTAL-COUNTS.                                                01480000
014000     05  TC-INPUT-REC-CNT          PIC 9(09)        VALUE ZEROS.  01490000
014100     05  TC-OUTPUT-REC-CNT         PIC 9(09)        VALUE ZEROS.  01500000
014200                                                                  01510000
014300 01  FISCAL-PERIOD.                                               01520000
014400     05  FP-SEA-DESC               PIC X(01).                     01530000
014500     05  FP-YEAR-PERIOD.                                          01540000
014600         10  FILLER                PIC X(02)        VALUE '20'.   01550000
014700         10  FP-YEAR               PIC X(02)        VALUE SPACES. 01560000
014800     05  FILLER                    PIC X(01)        VALUE 'W'.    01570000
014900     05  FP-WEEK-NBR               PIC X(02)        VALUE SPACES. 01580000
015000                                                                  01590000
015100******************************************************************01600000
015200* INPUT WEEKLY RECEIPTS RECORD LAYOUT.                           *01610000
015300******************************************************************01620000
P41820     COPY POWS054.                                                01630000
015500******************************************************************01640000
015600*  COMMUNICATIONS AREA2 FOR DB2                                   01650000
015700******************************************************************01660000
015800     COPY DPWS004.                                                01670000
015900     COPY SQLCA2.                                                 01680000
016000                                                                  01690000
016100                                                                  01700000
016200     EXEC SQL                                                     01710000
016300          INCLUDE SQLCA                                           01720000
016400     END-EXEC.                                                    01730000
016500******************************************************************01740000
016600*    TDTATTR DCLGEN                                              *01750000
016700******************************************************************01760000
016800     EXEC SQL                                                     01770000
016900         INCLUDE TDTATTR                                          01780000
017000     END-EXEC.                                                    01790000
017100******************************************************************01800000
017200* OUTPUT SEASONAL RECORD LAYOUT                                  *01810000
017300******************************************************************01820000
017400 01  WS-SEASONAL-REC                    PIC X(200) VALUE SPACES.  01830000
11752A 01  WS-OUT-RECORD                      PIC X(200) VALUE SPACES.  01831000
017500 01  OUT-SEASONAL-REC.                                            01840000
017600     05 OUT-TRANS-ID                    PIC 9(09) VALUE ZEROES.   01850000
017700     05 OUT-SEQ                         PIC 9(09) VALUE ZEROES.   01860000
017800     05 OUT-PRODUCT-NAME                PIC X(30) VALUE SPACES.   01870000
017900     05 OUT-ORGANIZATION-NAME           PIC X(30) VALUE SPACES.   01880000
018000     05 OUT-CALENDAR-NAME               PIC X(30) VALUE SPACES.   01890000
018100     05 OUT-GREC-FT-DLR                 PIC +9(6).99999.          01900000
018200     05 OUT-GREC-FT-CST                 PIC +9(6).99999.          01910000
018300     05 OUT-GREC-RPLN-DLR               PIC +9(6).99999.          01920000
018400     05 OUT-GREC-RPLN-CST               PIC +9(6).99999.          01930000
018500     05 FILLER                          PIC X(25) VALUE SPACES.   01940000
018600 01  WS-TEMP-VAR.                                                 01950000
018700     05  WS-DEPT-NBR                    PIC X(03).                01960000
018800     05  WS-MAJOR-CLASS-NBR             PIC X(02).                01970000
018900     05  WS-TRANS-FILE-SW               PIC X  VALUE 'N'.         01980000
019000         88  WS-TRANS-FILE-DONE                VALUE 'Y'.         01990000
019100         88  WS-TRANS-FILE-NOT-DONE            VALUE 'N'.         02000000
019200                                                                  02010000
019300*---------------------------------------------------------------- 02020000
019400*  ABEND DATA AREAS                                               02030000
019500*---------------------------------------------------------------- 02040000
019600 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          02050000
019700                                             COMP SYNC.           02060000
019800     88  AC-DB2-ERROR                        VALUE +4013.         02070000
019900                                                                  02080000
020000                                                                  02090000
020100 01  ABEND-AREAS.                                                 02100000
020200     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02110000
020300             '*****       ABEND'.                                 02120000
020400     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02130000
020500             '*****   PROGRAM: BPKUT574'.                         02140000
020600     05  AA-PARAGRAPH-LIT.                                        02150000
020700         10  FILLER              PIC  X(17)  VALUE                02160000
020800             '***** PARAGRAPH: '.                                 02170000
020900         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02180000
021000     05  AA-MESSAGE-LINE-1.                                       02190000
021100         10  FILLER              PIC  X(06)  VALUE '*****'.       02200000
021200         10  AA-MESSAGE-1.                                        02210000
021300             15 AA-MESS-1.                                        02220000
021400               25 AA-MESS-1-A        PIC  X(5)  VALUE SPACES.     02230000
021500               25 AA-MESS-1-B       PIC  X(24) VALUE SPACES.      02240000
021600     05  AA-MESSAGE-LINE-2.                                       02250000
021700         10  FILLER              PIC  X(06)  VALUE '*****'.       02260000
021800         10  AA-MESSAGE-2.                                        02270000
021900             15 AA-MESS-2.                                        02280000
022000               25 AA-MESS-2-A        PIC  X(5)  VALUE SPACES.     02290000
022100               25 AA-MESS-2-B        PIC  X(92) VALUE SPACES.     02300000
022200     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02310000
022300             '*****    DB2 ERROR'.                                02320000
022400     05  AA-DB2-OPERATION-LIT.                                    02330000
022500         10  FILLER              PIC  X(17)  VALUE                02340000
022600             '***** OPERATION: '.                                 02350000
022700         10  AA-DB2-OPERATION.                                    02360000
022800             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        02370000
022900             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02380000
023000     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        02390000
023100     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        02400000
023200     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        02410000
023300     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        02420000
023400******************************************************************02430000
023500 PROCEDURE DIVISION.                                              02440000
023600******************************************************************02450000
023700 0000-MAINLINE.                                                   02460000
023800                                                                  02470000
023900     PERFORM 1000-INITIALIZE.                                     02480000
024000                                                                  02490000
024100     PERFORM 2000-PROCESS-WKLY-RECEIPTS                           02500000
024200             UNTIL PS-END-OF-WKLY-RECEIPTS.                       02510000
024300                                                                  02520000
024400     PERFORM 2200-FORMAT-OUTPUT-RECORD.                           02530000
024500                                                                  02540000
024600     MOVE WS-SEQ-NO          TO WS-SEQ-ID                         02550000
024700     WRITE TRANS-OUT-RECORD  FROM WS-TRANS-REC                    02560000
024800                                                                  02570000
024900     PERFORM 4000-END-OF-JOB.                                     02580000
025000                                                                  02590000
025100     STOP RUN.                                                    02600000
025200                                                                  02610000
025300******************************************************************02620000
025400*  OPEN INPUT AND OUTPUT FILES AND PERFORM THE INITIAL READ      *02630000
025500******************************************************************02640000
025600 1000-INITIALIZE.                                                 02650000
025700                                                                  02660000
025800     OPEN INPUT  WKLY-RECEIPTS-FILE                               02670000
025900                 TRANS-IN-FILE                                    02680000
026000          OUTPUT SEASONAL-FILE                                    02690000
026100                 TRANS-OUT-FILE.                                  02700000
026200                                                                  02710000
026300     INITIALIZE DCLTDTATTR.                                       02720000
026400                                                                  02730000
026500     PERFORM 1020-READ-TRANS-IN                                   02740000
026600        THRU 1020-EXIT.                                           02750000
026700                                                                  02760000
026800     PERFORM 3000-READ-WKLY-RECEIPTS-RECORD.                      02770000
026900                                                                  02780000
027000     PERFORM 1100-PROCESS-FIRST-RECORD.                           02790000
027100                                                                  02800000
11752A     MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-DATE.               02801000
11752A                                                                  02802000
027200******************************************************************02810000
027300*  PROCESS FIRST RECORD                                          *02820000
027400******************************************************************02830000
027500 1100-PROCESS-FIRST-RECORD.                                       02840000
027600                                                                  02850000
P41820     MOVE PO054-MM TO FP-WEEK-NBR.                                02860000
P41820     MOVE PO054-YY TO FP-YEAR.                                    02870000
027900                                                                  02880000
028000     PERFORM 3500-GET-SEA-DESC.                                   02890000
028100                                                                  02900000
028200     MOVE DTATTR-SEA-DESC(1:1) TO FP-SEA-DESC.                    02910000
028300     DISPLAY ' '.                                                 02920000
028400     DISPLAY '**************************************'.            02930000
028500     DISPLAY ' '.                                                 02940000
028600     DISPLAY 'PROCESSING FISCAL YEAR ' FP-YEAR-PERIOD.            02950000
028700     DISPLAY '           FISCAL WEEK ' FP-WEEK-NBR.               02960000
028800                                                                  02970000
P41820     MOVE PO054-CLASS            TO H-MAJOR-CLASS-NBR.            02980000
P41820     MOVE PO054-DEPT             TO H-DEPT-NBR.                   02990000
P41820     MOVE PO054-E-BUS-IND        TO H-E-BUS-IND.                  03000000
029200                                                                  03010000
029300******************************************************************03020000
029400*   1.READ TRANSACTION ID FILE                                    03030000
029500*   2.GENERATE THE CURRENT RUN TRANSACTION ID AND WRITE INTO      03040000
029600*     THE TRANSACTION FILE.                                       03050000
029700******************************************************************03060000
029800 1020-READ-TRANS-IN.                                              03070000
029900                                                                  03080000
030000     INITIALIZE WS-TRANS-ID                                       03090000
030100     READ TRANS-IN-FILE INTO WS-TRANS-REC                         03100000
030200        AT END                                                    03110000
030300           SET WS-TRANS-FILE-DONE  TO TRUE                        03120000
030400        NOT AT END                                                03130000
030500           ADD 01                  TO WS-TRANS-ID                 03140000
030600           MOVE WS-TRANS-ID        TO WS-TRANS-ID-TMP             03150000
030700*          MOVE WS-SEQ-ID          TO WS-SEQ-NO                   03160000
030800           INSPECT WS-TRANS-ID-TMP  TALLYING                      03170000
030900                   WS-SPACE-CNT    FOR LEADING SPACES             03180000
031000                                                                  03190000
031100           COMPUTE WS-STRT-TRN-POS = WS-SPACE-CNT  + 1            03200000
031200           COMPUTE WS-END-TRN-POS  = 9 - WS-SPACE-CNT.            03210000
031300                                                                  03220000
031400 1020-EXIT.                                                       03230000
031500     EXIT.                                                        03240000
031600******************************************************************03250000
031700*  PROCESS WKLY RECEIPTS DATA                                    *03260000
031800******************************************************************03270000
031900 2000-PROCESS-WKLY-RECEIPTS.                                      03280000
032000                                                                  03290000
P41820     IF PO054-CLASS = H-MAJOR-CLASS-NBR                           03300000
032200        AND                                                       03310000
P41820        PO054-DEPT  = H-DEPT-NBR                                  03320000
032400        AND                                                       03330000
P41820        PO054-E-BUS-IND = H-E-BUS-IND                             03340000
032600           PERFORM 2100-ADD-TO-TOTALS                             03350000
032700           PERFORM 3000-READ-WKLY-RECEIPTS-RECORD                 03360000
032800     ELSE                                                         03370000
032900                                                                  03380000
033000        PERFORM 2200-FORMAT-OUTPUT-RECORD                         03390000
P41820        MOVE PO054-CLASS        TO H-MAJOR-CLASS-NBR              03400000
P41820        MOVE PO054-DEPT         TO H-DEPT-NBR                     03410000
P41820        MOVE PO054-E-BUS-IND    TO H-E-BUS-IND                    03420000
033400        PERFORM 2100-ADD-TO-TOTALS                                03430000
033500        PERFORM 3000-READ-WKLY-RECEIPTS-RECORD                    03440000
033600     END-IF.                                                      03450000
033700                                                                  03460000
033800******************************************************************03470000
033900*  ADD TO TOTALS                                                 *03480000
034000******************************************************************03490000
034100 2100-ADD-TO-TOTALS.                                              03500000
034200                                                                  03510000
P41820     DIVIDE PO054-RETAIL    BY 1000 GIVING PV-RTL-VALUE.          03520000
34500      DIVIDE PO054-COST      BY 1000 GIVING PV-CST-VALUE.          03530000
034600******************************************************************03550000
034700*  VIRTUAL STORE                                                 *03560000
034800******************************************************************03570000
P41820     IF PO054-E-BUS-IND     = 'Y'                                 03580000
035000******************************************************************03590000
035100*  VIRTUAL STORE REPLENISHMENT                                   *03600000
035200******************************************************************03610000
P41820        IF (PO054-PO-TYP-CDE = 'IN') OR                           03620000
P41820         (PO054-PO-TYP-CDE = 'RE') OR                             03621000
P41820           (PO054-PO-TYP-CDE = 'EC' AND                           03630000
P41820            PO054-CRE-BY-UID = 'INFOREM')                         03640000
035400           ADD PV-RTL-VALUE       TO H-VS-REPL-RTL                03650000
035500           ADD PV-CST-VALUE       TO H-VS-REPL-CST                03660000
035600        ELSE                                                      03670000
035700******************************************************************03680000
035800*  VIRTUAL STORE FAST TRACK                                      *03690000
035900******************************************************************03700000
P41820        IF PO054-PO-SHRT-CYC-IND = 'Y'                            03710000
036100           ADD PV-RTL-VALUE       TO H-VS-FT-RTL                  03720000
036200           ADD PV-CST-VALUE       TO H-VS-FT-CST                  03730000
036300        ELSE                                                      03740000
036400           NEXT SENTENCE                                          03750000
036500        END-IF                                                    03760000
036600     END-IF.                                                      03770000
036700                                                                  03780000
036800******************************************************************03790000
036900*  PHYSICAL STORE                                                *03800000
037000******************************************************************03810000
P41820     IF PO054-E-BUS-IND     = 'N'                                 03820000
037200******************************************************************03830000
037300*  PHYSICAL STORE REPLENISHMENT                                  *03840000
037400******************************************************************03850000
P41820        IF PO054-PO-TYP-CDE = 'IN' OR                             03860000
P41820           PO054-PO-TYP-CDE = 'RE' OR                             03861000
P41820           (PO054-PO-TYP-CDE = 'EC' AND                           03870000
P41820            PO054-CRE-BY-UID = 'INFOREM')                         03880000
037600           ADD PV-RTL-VALUE       TO H-PS-REPL-RTL                03890000
037700           ADD PV-CST-VALUE       TO H-PS-REPL-CST                03900000
037800        ELSE                                                      03910000
037900******************************************************************03920000
038000*  PHYSICAL STORE FAST TRACK                                     *03930000
038100******************************************************************03940000
P41820        IF PO054-PO-SHRT-CYC-IND = 'Y'                            03950000
038300           ADD PV-RTL-VALUE       TO H-PS-FT-RTL                  03960000
038400           ADD PV-CST-VALUE       TO H-PS-FT-CST                  03970000
038500        ELSE                                                      03980000
038600           NEXT SENTENCE                                          03990000
038700        END-IF                                                    04000000
038800     END-IF.                                                      04010000
038900                                                                  04020000
039000******************************************************************04030000
039100*  FORMAT OUTPUT RECORD                                          *04040000
039200******************************************************************04050000
039300 2200-FORMAT-OUTPUT-RECORD.                                       04060000
039400     INITIALIZE OUT-SEASONAL-REC                                  04070000
039500                                                                  04080000
039600     MOVE H-DEPT-NBR              TO WS-DEPT-NBR.                 04090000
039700     MOVE H-MAJOR-CLASS-NBR       TO WS-MAJOR-CLASS-NBR.          04100000
039800     MOVE FISCAL-PERIOD           TO OUT-CALENDAR-NAME.           04110000
039900                                                                  04120000
040000     STRING 'C'  WS-DEPT-NBR  '_'                                 04130000
040100                 WS-MAJOR-CLASS-NBR                               04140000
040200            DELIMITED BY SPACES INTO OUT-PRODUCT-NAME.            04150000
040300                                                                  04160000
040400     IF H-E-BUS-IND  = 'Y'                                        04170000
040500        MOVE PC-VIRTUAL-STORE     TO OUT-ORGANIZATION-NAME        04180000
040600     ELSE                                                         04190000
040700        MOVE PC-PHYSICAL-STORE    TO OUT-ORGANIZATION-NAME        04200000
040800     END-IF                                                       04210000
040900                                                                  04220000
041000     IF H-VS-REPL-RTL NOT = ZEROS                                 04230000
041100        MOVE H-VS-REPL-RTL        TO OUT-GREC-RPLN-DLR            04240000
11752A                                     WS-GREC-RPLN-DLR             04241000
041200        ADD PC-1                  TO TC-VS-REPL-RTL               04250000
041300        MOVE ZEROS                TO H-VS-REPL-RTL                04260000
11752A     ELSE                                                         04261000
11752A        MOVE H-VS-REPL-RTL        TO WS-GREC-RPLN-DLR             04262000
041400     END-IF.                                                      04270000
041500                                                                  04280000
041600     IF H-VS-REPL-CST NOT = ZEROS                                 04290000
041700        MOVE H-VS-REPL-CST        TO OUT-GREC-RPLN-CST            04300000
11752A                                     WS-GREC-RPLN-CST             04301000
041800        ADD PC-1                  TO TC-VS-REPL-CST               04310000
041900        MOVE ZEROS                TO H-VS-REPL-CST                04320000
11752A     ELSE                                                         04321000
11752A        MOVE H-VS-REPL-CST        TO WS-GREC-RPLN-CST             04322000
042000     END-IF.                                                      04330000
042100                                                                  04340000
042200     IF H-VS-FT-RTL NOT = ZEROS                                   04350000
042300        MOVE H-VS-FT-RTL          TO OUT-GREC-FT-DLR              04360000
042400        ADD PC-1                  TO TC-VS-FT-RTL                 04370000
042500        MOVE ZEROS                TO H-VS-FT-RTL                  04380000
042600     END-IF.                                                      04390000
042700                                                                  04400000
042800     IF H-VS-FT-CST NOT = ZEROS                                   04410000
042900        MOVE H-VS-FT-CST          TO OUT-GREC-FT-CST              04420000
043000        ADD PC-1                  TO TC-VS-FT-CST                 04430000
043100        MOVE ZEROS                TO H-VS-FT-CST                  04440000
043200     END-IF.                                                      04450000
043300                                                                  04460000
043400     IF H-PS-REPL-RTL NOT = ZEROS                                 04470000
043500        MOVE H-PS-REPL-RTL        TO OUT-GREC-RPLN-DLR            04480000
11752A                                     WS-GREC-RPLN-DLR             04481000
043600        ADD PC-1                  TO TC-PS-REPL-RTL               04490000
043700        MOVE ZEROS                TO H-PS-REPL-RTL                04500000
11752A     ELSE                                                         04501000
11752A        IF H-E-BUS-IND NOT = 'Y'                                  04501100
11752A           MOVE  H-PS-REPL-RTL    TO WS-GREC-RPLN-DLR             04502000
11752A        END-IF                                                    04503000
043800     END-IF.                                                      04510000
043900                                                                  04520000
044000     IF H-PS-REPL-CST NOT = ZEROS                                 04530000
044100        MOVE H-PS-REPL-CST        TO OUT-GREC-RPLN-CST            04540000
11752A                                     WS-GREC-RPLN-CST             04541000
044200        ADD PC-1                  TO TC-PS-REPL-CST               04550000
044300        MOVE ZEROS                TO H-PS-REPL-CST                04560000
11752A     ELSE                                                         04561000
11752A        IF H-E-BUS-IND NOT = 'Y'                                  04561100
11752A           MOVE H-PS-REPL-CST     TO WS-GREC-RPLN-CST             04562000
11752A        END-IF                                                    04563000
044400     END-IF.                                                      04570000
044500                                                                  04580000
044600     IF H-PS-FT-RTL NOT = ZEROS                                   04590000
044700        MOVE H-PS-FT-RTL          TO OUT-GREC-FT-DLR              04600000
044800        ADD PC-1                  TO TC-PS-FT-RTL                 04610000
044900        MOVE ZEROS                TO H-PS-FT-RTL                  04620000
045000     END-IF.                                                      04630000
045100                                                                  04640000
045200     IF H-PS-FT-CST NOT = ZEROS                                   04650000
045300        MOVE H-PS-FT-CST          TO OUT-GREC-FT-CST              04660000
045400        ADD PC-1                  TO TC-PS-FT-CST                 04670000
045500        MOVE ZEROS                TO H-PS-FT-CST                  04680000
045600     END-IF.                                                      04690000
045700                                                                  04700000
045700                                                                  04707000
11752A*       IF  ( OUT-GREC-FT-DLR   =  0 ) AND                        04710000
11752A*           ( OUT-GREC-FT-CST   =  0 ) AND                        04720000
11752A*           ( OUT-GREC-RPLN-DLR =  0 ) AND                        04720100
11752A*           ( OUT-GREC-RPLN-CST =  0 )                            04721000
11752A        IF  ( WS-GREC-RPLN-DLR =  ZERO ) AND                      04741000
11752A            ( WS-GREC-RPLN-CST =  ZERO )                          04742000
046200              CONTINUE                                            04750000
046300        ELSE                                                      04760000
046400              PERFORM 3100-WRITE-SEASONAL                         04770000
046500        END-IF.                                                   04780000
046600******************************************************************04790000
046700*  READ RECORD FROM WKLY RECEIPTS FILE                           *04800000
046800******************************************************************04810000
046900 3000-READ-WKLY-RECEIPTS-RECORD.                                  04820000
047000                                                                  04830000
047100     IF PS-END-OF-WKLY-RECEIPTS-SW = 'Y'                          04840000
047200        CONTINUE                                                  04850000
047300     ELSE                                                         04860000
P41820        READ WKLY-RECEIPTS-FILE INTO PO054-RECORD                 04870000
047500          AT END SET PS-END-OF-WKLY-RECEIPTS TO TRUE              04880000
047600     END-IF.                                                      04890000
047700                                                                  04900000
047800     IF PS-END-OF-WKLY-RECEIPTS-SW = 'N'                          04910000
047900        ADD PC-1 TO TC-INPUT-REC-CNT                              04920000
048000     END-IF.                                                      04930000
048100                                                                  04940000
048200******************************************************************04950000
048300*  WRITE WKLY SEASONAL OUTPUT RECORD                             *04960000
048400******************************************************************04970000
048500 3100-WRITE-SEASONAL.                                             04980000
048600                                                                  04990000
048700     INITIALIZE                                                   05000000
048800                 WS-SPACE-CNT                                     05010000
048900                 WS-START-POS                                     05020000
049000                 WS-END-POS                                       05030000
049100                                                                  05040000
049200     ADD 01                 TO WS-SEQ-NO                          05050000
049300     MOVE WS-SEQ-NO         TO WS-SEQ-NO-TMP                      05060000
049400     MOVE WS-SEQ-NO-TMP     TO OUT-SEQ                            05070000
049500     MOVE WS-TRANS-ID-TMP   TO OUT-TRANS-ID                       05080000
049600                                                                  05090000
049700     INSPECT WS-SEQ-NO-TMP    TALLYING                            05100000
049800             WS-SPACE-CNT    FOR LEADING SPACES                   05110000
049900                                                                  05120000
050000     COMPUTE WS-START-POS = WS-SPACE-CNT  + 1                     05130000
050100     COMPUTE WS-END-POS   = 9 - WS-SPACE-CNT                      05140000
050200                                                                  05150000
11752A*WRITE HEADER RECORD                                              05151000
11752A     IF PS-HEADER-NOT-WRITTEN                                     05152000
11752A         STRING 'TRANS_ID'           DELIMITED BY SIZE '|'        05153000
11752A                'PRODUCT_NAME'       DELIMITED BY SIZE '|'        05154000
11752A                'ORGANIZATION_NAME'  DELIMITED BY SIZE '|'        05155000
11752A                'CALENDAR_NAME'      DELIMITED BY SIZE '|'        05155100
11752A                'RPLN_RTL'           DELIMITED BY SIZE '|'        05156000
11752A                'RPLN_CST'           DELIMITED BY SIZE            05157000
11752A                          INTO WS-SEASONAL-REC                    05159000
11752A        WRITE  SEASONAL-REC FROM WS-SEASONAL-REC                  05159100
11752A        SET PS-HEADER-WRITTEN TO TRUE                             05159200
050200        INITIALIZE WS-SEASONAL-REC                                05159300
050200     END-IF                                                       05159400
050200                                                                  05159500
11752A*    STRING  OUT-TRANS-ID(WS-STRT-TRN-POS:WS-END-TRN-POS) '|'     05160000
11752A*            OUT-SEQ(WS-START-POS:WS-END-POS) '|'                 05170000
11752A     STRING  WS-CURRENT-DATE (1:14)  '|'                          05171000
050500             OUT-PRODUCT-NAME        '|'                          05180000
050600             OUT-ORGANIZATION-NAME   '|'                          05190000
050700             OUT-CALENDAR-NAME       '|'                          05200000
11752A*            OUT-GREC-FT-DLR         '|'                          05210000
11752A*            OUT-GREC-FT-CST         '|'                          05220000
051000             OUT-GREC-RPLN-DLR       '|'                          05230000
051100             OUT-GREC-RPLN-CST                                    05240000
051200             DELIMITED BY SPACES INTO WS-SEASONAL-REC.            05250000
051300                                                                  05260000
11752A*    WRITE SEASONAL-REC FROM WS-SEASONAL-REC.                     05260100
11752A     INSPECT WS-SEASONAL-REC REPLACING ALL                        05261000
11752A             '+000000.00000' BY '             '.                  05262000
11752A     INITIALIZE WS-OUT-RECORD                                     05263000
11752A                PV-POS2.                                          05264000
11752A     PERFORM VARYING PV-POS1 FROM 1 BY 1                          05265000
11752A        UNTIL PV-POS1 > 200                                       05266000
11752A        IF WS-SEASONAL-REC (PV-POS1:1) NOT = SPACE                05267000
11752A           ADD     1 TO PV-POS2                                   05268000
11752A           MOVE WS-SEASONAL-REC (PV-POS1:1)                       05269000
11752A             TO WS-OUT-RECORD (PV-POS2:1)                         05269100
11752A        END-IF                                                    05269200
11752A     END-PERFORM.                                                 05269300
11752A     WRITE SEASONAL-REC FROM WS-OUT-RECORD.                       05270000
051500     ADD PC-1 TO TC-OUTPUT-REC-CNT.                               05280000
051600******************************************************************05290000
051700* GET THE SEASON THAT WE ARE IN                                   05300000
051800******************************************************************05310000
051900 3500-GET-SEA-DESC.                                               05320000
052000                                                                  05330000
052100     MOVE FP-YEAR-PERIOD TO PV-YEAR-NBR.                          05340000
052200     EXEC SQL                                                     05350000
052300       SELECT DISTINCT SEA_DESC                                   05360000
052400         INTO :DTATTR-SEA-DESC                                    05370000
052500         FROM TDTATTR                                             05380000
052600        WHERE FSCL_YR_NBR = :PV-YEAR-NBR    AND                   05390000
052700        FSCL_WK_NBR = :FP-WEEK-NBR                                05400000
052800                                                                  05410000
052900     END-EXEC.                                                    05420000
053000                                                                  05430000
053100     EVALUATE TRUE                                                05440000
053200         WHEN SQLCODE      = ZERO                                 05450000
053300            CONTINUE                                              05460000
053400         WHEN SQLWARN0 NOT = SPACES                               05470000
053500         WHEN SQLCODE  NOT = ZERO                                 05480000
053600            MOVE '3500-GET-SEA-DESC      ' TO AA-PARAGRAPH-NAME   05490000
053700            MOVE 'YEAR '     TO AA-MESS-1-A                       05500000
053800            MOVE PV-YEAR-NBR TO AA-MESS-1-B                       05510000
053900            MOVE 'WEEK '     TO AA-MESS-2-A                       05520000
054000            MOVE FP-WEEK-NBR TO AA-MESS-2-B                       05530000
054100            MOVE 'UNSUCCESSFUL SELECT '    TO AA-DB2-OPERATION    05540000
054200            MOVE 'TDTATRR'                 TO AA-DB2-TABLE-1      05550000
054300            PERFORM Z999-DB2-ABEND                                05560000
054400     END-EVALUATE.                                                05570000
054500                                                                  05580000
054600******************************************************************05590000
054700*  CLOSE ALL OPEN FILES                                          *05600000
054800******************************************************************05610000
054900 4000-END-OF-JOB.                                                 05620000
055000                                                                  05630000
055100     DISPLAY ' '.                                                 05640000
055200     DISPLAY '**************************************'.            05650000
055300     DISPLAY ' '.                                                 05660000
055400     DISPLAY 'TOTAL RECORD COUNTS:'.                              05670000
055500     DISPLAY 'TOTAL INPUT  RECORDS READ    = ' TC-INPUT-REC-CNT.  05680000
055600     DISPLAY 'TOTAL OUTPUT RECORDS WRITTEN = ' TC-OUTPUT-REC-CNT. 05690000
055700     DISPLAY ' '.                                                 05700000
055800     DISPLAY 'TOTALS FOR OUTPUT RECORDS WRITTEN:'.                05710000
055900     DISPLAY 'TOTAL VIRTUAL STORE REPLENISHMENT DLR  = '          05720000
056000              TC-VS-REPL-RTL.                                     05730000
056100     DISPLAY 'TOTAL VIRTUAL STORE REPLENISHMENT CST  = '          05740000
056200              TC-VS-REPL-CST.                                     05750000
056300     DISPLAY 'TOTAL VIRTUAL STORE FAST TRACK DLR     = '          05760000
056400              TC-VS-FT-RTL.                                       05770000
056500     DISPLAY 'TOTAL VIRTUAL STORE FAST TRACK CST     = '          05780000
056600              TC-VS-FT-CST.                                       05790000
056700     DISPLAY 'TOTAL PHYSICAL STORE REPLENISHMENT DLR = '          05800000
056800              TC-PS-REPL-RTL.                                     05810000
056900     DISPLAY 'TOTAL PHYSICAL STORE REPLENISHMENT CST = '          05820000
057000              TC-PS-REPL-CST.                                     05830000
057100     DISPLAY 'TOTAL PHYSICAL STORE FAST TRACK DLR    = '          05840000
057200              TC-PS-FT-RTL.                                       05850000
057300     DISPLAY 'TOTAL PHYSICAL STORE FAST TRACK CST    = '          05860000
057400              TC-PS-FT-CST.                                       05870000
057500     DISPLAY ' '.                                                 05880000
057600     DISPLAY '**************************************'.            05890000
057700     DISPLAY ' '.                                                 05900000
057800                                                                  05910000
057900     CLOSE WKLY-RECEIPTS-FILE                                     05920000
058000           SEASONAL-FILE.                                         05930000
058100                                                                  05940000
058200*---------------------------------------------------------------- 05950000
058300*    ABEND ROUTINE FOR DB2 ERRORS                                 05960000
058400*---------------------------------------------------------------- 05970000
058500 Z999-DB2-ABEND.                                                  05980000
058600                                                                  05990000
058700     CLOSE WKLY-RECEIPTS-FILE                                     06000000
058800           SEASONAL-FILE.                                         06010000
058900     DISPLAY AA-ABEND-LIT.                                        06020000
059000     DISPLAY AA-MESSAGE-LINE-1.                                   06030000
059100     DISPLAY AA-MESSAGE-LINE-2.                                   06040000
059200     DISPLAY AA-DB2-ERROR-LIT.                                    06050000
059300     DISPLAY AA-PROGRAM-LIT.                                      06060000
059400     DISPLAY AA-PARAGRAPH-LIT.                                    06070000
059500     DISPLAY AA-DB2-OPERATION-LIT.                                06080000
059600     DISPLAY AA-DB2-TABLE-1.                                      06090000
059700     DISPLAY AA-DB2-TABLE-2.                                      06100000
059800     DISPLAY AA-DB2-TABLE-3.                                      06110000
059900     SET AC-DB2-ERROR TO TRUE.                                    06120000
060000                                                                  06130000
060100     COPY DPPD004.                                                06140000
060200                                                                  06150000
060300     CALL 'ILBOABN0' USING ABEND-CODE.                            06160000
