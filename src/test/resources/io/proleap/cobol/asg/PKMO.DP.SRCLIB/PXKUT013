000100 IDENTIFICATION DIVISION.                                         00010021
000200 PROGRAM-ID.    PXKUT013.                                         00020048
000300 AUTHOR.        KOHLS DEPARTMENT STORES.                          00030021
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040021
000500 DATE-WRITTEN.  03/31/2005.                                       00050048
000600 DATE-COMPILED.                                                   00060021
000700******************************************************************00070021
000800**THIS PROGRAM WILL READ IN A FILE SUMMARIZED BY DEPT/STORE       00080048
000900**     AND LOOKUP THE DMA NAME/NUMBER.                            00090048
001000******************************************************************00100021
001100**DATE:03/31/2005 MADE BY:JULIE TEWES INITIAL PROGRAM WRITE       00110048
001200******************************************************************00120021
041205**DATE:04/12/2005 MADE BY:JULIE TEWES CHANGE INPUT FILE LENGTH    00130052
041206******************************************************************00140052
091305**DATE:09/13/2005 MADE BY:JULIE TEWES PRICE OPTIMIZATION          00150053
091306******************************************************************00160053
112805**DATE:11/28/2005 MADE BY:JULIE TEWES ADD PERCENT OFF TOTALS TO   00170054
112806**                HEADER PAGE                                     00180054
112807******************************************************************00190054
112808******************************************************************00160053
112809**DATE:09/03/2008 MADE BY:MARGARET MORRISON  ADD INTRANSIT QTY TO 00170054
112810**                OUTPUT FILE                                     00180054
112811******************************************************************00190054
112812 ENVIRONMENT DIVISION.                                            00200021
112813 CONFIGURATION SECTION.                                           00210021
112814 SOURCE-COMPUTER.    IBM-3090.                                    00220021
112820 OBJECT-COMPUTER.    IBM-3090.                                    00230021
112830 INPUT-OUTPUT SECTION.                                            00240021
112840 FILE-CONTROL.                                                    00250021
112850                                                                  00260021
112860     SELECT INPUT-FILE                                            00270021
112870            ASSIGN TO INP01.                                      00280021
112880     SELECT OUTPUT-FILE                                           00290048
112881            ASSIGN TO OUT01.                                      00300021
112882     SELECT PERCENT-OFF-FILE                                      00310054
112883            ASSIGN TO OUT02.                                      00320054
112884                                                                  00330021
112885 DATA DIVISION.                                                   00340021
112886 FILE SECTION.                                                    00350021
112887                                                                  00360021
112888 FD  INPUT-FILE                                                   00370021
112889     RECORDING MODE IS F                                          00380021
112890     LABEL RECORDS OMITTED                                        00390021
112900     BLOCK CONTAINS 0 RECORDS                                     00400021
112901     DATA RECORD IS INPUT-RECORD.                                 00410021
112902 01  INPUT-RECORD                        PIC X(193).              00420053
112903                                                                  00430021
112904 FD  OUTPUT-FILE                                                  00440048
112905     RECORDING MODE IS F                                          00450045
112906     LABEL RECORDS OMITTED                                        00460045
112907     BLOCK CONTAINS 0 RECORDS                                     00470045
112908     DATA RECORD IS OUTPUT-RECORD.                                00480048
112909 01  OUTPUT-RECORD                       PIC X(075).              00490048
112910                                                                  00500045
112911 FD  PERCENT-OFF-FILE                                             00510054
112912     RECORDING MODE IS F                                          00520054
112913     LABEL RECORDS OMITTED                                        00530054
112914     BLOCK CONTAINS 0 RECORDS                                     00540054
112915     DATA RECORD IS PERCENT-OFF-RECORD.                           00550054
112916 01  PERCENT-OFF-RECORD                  PIC X(075).              00560054
112917                                                                  00570054
112918 WORKING-STORAGE SECTION.                                         00580021
112919******************************************************************00590021
112920**PROGRAM SWITCHES                                                00600021
112930******************************************************************00610021
112940 01  PS-SWITCH-AREAS.                                             00620021
112950     05  PS-END-OF-INPUT-FILE-SW         PIC X(01)  VALUE 'N'.    00630021
112960         88  PS-END-OF-INPUT-FILE                   VALUE 'Y'.    00640021
112961         88  PS-NOT-END-OF-INPUT-FILE               VALUE 'N'.    00650021
112962******************************************************************00660058
112963**PROGRAM CALCULATIONS VARIABLES                                  00670058
112964******************************************************************00680058
112965 01  PC-PROGRAM-CALCULATIONS.                                     00690058
112966     05  PC-PERCENT-OFF              PIC S9(04)V999 VALUE ZEROS.  00700058
112967******************************************************************00710045
112968**PROGRAM HOLDS                                                   00720045
112969******************************************************************00730045
112970 01  PH-PROGRAM-HOLDS.                                            00740045
112980     05  PH-DEPT-NBR                     PIC S9(04)V COMP-3       00750048
112990                                                   VALUE ZEROS.   00760045
113000******************************************************************00770024
113100**DATE TIME FIELDS                                                00780024
113200******************************************************************00790024
113300 01 DF-DATE-TIME-FIELDS.                                          00800024
113400    05 DF-ACCEPT-DATE                    PIC X(06) VALUE SPACES.  00810024
113500    05 DF-ACCEPT-TIME                    PIC X(08) VALUE SPACES.  00820024
113600******************************************************************00830023
113700**PROGRAM COUNTERS                                                00840023
113800******************************************************************00850023
113900 01  PC-PROGRAM-COUNTERS.                                         00860023
114000     05  PC-INPUT-RECORDS-READ           PIC 9(06) VALUE ZEROS.   00870043
114100     05  PC-OUTPUT-RECORDS-WRITTEN       PIC 9(06) VALUE ZEROS.   00880048
122805     05  PC-PERCENT-OFF-RECORDS-WRITTEN  PIC 9(06) VALUE ZEROS.   00890054
122806****************************************************************  00900021
122807**ABEND INFORMATION                                               00910021
122808****************************************************************  00920021
122809 01  AC-ABEND-FIELDS.                                             00930021
122810     05  AC-ABEND-CODE                   PIC S9(04) VALUE ZERO    00940021
122820                                                     COMP SYNC.   00950021
122830         88  AC-TABLE-ERROR                        VALUE +4004.   00960021
122840         88  AC-DB2-ERROR                          VALUE +4013.   00970021
122850 01  PV-MISC-ABEND-FIELDS.                                        00980021
122860     05  PV-PARAGRAPH-NAME               PIC X(30) VALUE SPACE.   00990021
122870     05  PV-OPERATION-MSG-1              PIC X(40) VALUE SPACE.   01000021
122880     05  PV-OPERATION-MSG-2              PIC X(40) VALUE SPACE.   01010021
122890     05  PV-DB2-OPERATION                PIC X(30) VALUE SPACE.   01020021
122900******************************************************************01030021
123000**COPYBOOKS                                                       01040021
123100******************************************************************01050021
123200****INPUT RECORD LAYOUT                                           01060021
123300     COPY PXRD004.                                                01070048
123400****OUTPUT RECORD LAYOUT                                          01080021
123401     COPY PXRD020.                                                01090048
123402****PERCENT OFF RECORD LAYOUT                                     01100054
123403     COPY PXRD023.                                                01110054
123404****ABEND ROUTINE INFORMATION                                     01120021
123405     COPY SQLCA2.                                                 01130021
123406****ABEND ROUTINE INFORMATION                                     01140021
123407     COPY DPWS004.                                                01150021
123408******************************************************************01160021
123409**TABLE INCLUSIONS                                                01170021
123410******************************************************************01180021
123420***XS DOMAIN DEPT TABLE                                           01190048
123430     EXEC SQL                                                     01200021
123440          INCLUDE XST00015                                        01210048
123450     END-EXEC.                                                    01220021
123460***XS DOMAIN DMA TABLE                                            01230048
123470     EXEC SQL                                                     01240048
123480          INCLUDE XST00067                                        01250048
123490     END-EXEC.                                                    01260048
123500*****DB2 TABLE INCLUSION                                          01270021
123600     EXEC SQL                                                     01280021
123700          INCLUDE SQLCA                                           01290021
123800     END-EXEC.                                                    01300021
123900                                                                  01310029
124000 PROCEDURE DIVISION.                                              01320021
124100******************************************************************01330021
124200 000-MAINLINE-PROCESSING.                                         01340021
124300                                                                  01350021
124400     PERFORM 1000-INITIALIZATION.                                 01360021
124500     PERFORM 2000-PROCESS-RECORDS                                 01370021
124600             UNTIL PS-END-OF-INPUT-FILE.                          01380021
124700     PERFORM 9999-WRAPUP.                                         01390021
124800     GOBACK.                                                      01400021
124900                                                                  01410021
125000 EJECT.                                                           01420021
125100******************************************************************01430021
125200**INITIALIZATION ROUTINE                                          01440021
125300******************************************************************01450021
125400 1000-INITIALIZATION.                                             01460021
125500                                                                  01470021
125600     MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH-NAME.             01480021
125700                                                                  01490021
125800     OPEN INPUT  INPUT-FILE                                       01500024
125801          OUTPUT OUTPUT-FILE                                      01510055
125802                 PERCENT-OFF-FILE.                                01520055
125803                                                                  01530021
125804     ACCEPT DF-ACCEPT-TIME FROM TIME.                             01540021
125805     ACCEPT DF-ACCEPT-DATE FROM DATE.                             01550021
125806                                                                  01560021
125807     PERFORM 9999-READ-INPUT-RECORD.                              01570021
125808                                                                  01580021
125809 EJECT.                                                           01590021
125810******************************************************************01600021
125820**PROCESS INPUT RECORD TO CHECK ROWS                              01610021
125830******************************************************************01620021
125840 2000-PROCESS-RECORDS.                                            01630021
125850                                                                  01640021
125860     MOVE '2000-PROCESS-RECORDS'  TO PV-PARAGRAPH-NAME.           01650021
125870                                                                  01660021
125871     INITIALIZE PXRD020-YELLOW-TICKET-SUM-FILE.                   01670048
125872     INITIALIZE PXRD023-YELLOW-TICKET-FILE.                       01680054
125873                                                                  01690043
125874     IF  PXRD004-DEPT-NBR NOT EQUAL PH-DEPT-NBR                   01700048
125875         PERFORM 2100-DMA-LOOKUP                                  01710048
125876         MOVE PXRD004-DEPT-NBR     TO PH-DEPT-NBR                 01720048
125877     END-IF.                                                      01730045
125878                                                                  01740043
125879     MOVE PXRD004-STR-NBR          TO PXRD020-STR-NBR.            01750048
125880     MOVE PXRD004-LOC-NM           TO PXRD020-LOC-NM.             01760048
125890     MOVE PXRD004-STR-EXPTED-QTY   TO PXRD020-STR-EXPTED-QTY.     01770048
125892     MOVE PXRD004-IN-TRNST-QTY     TO PXRD020-IN-TRNST-QTY.       01770048
125900     MOVE XST00067-DMA-NBR         TO PXRD020-DMA-NBR.            01780048
126000     MOVE XST00067-DMA-NM          TO PXRD020-DMA-NM.             01790048
126001                                                                  01800054
126002     MOVE PXRD004-STR-NBR          TO PXRD023-STR-NBR.            01810054
126003     MOVE PXRD004-LOC-NM           TO PXRD023-LOC-NM.             01820054
126004     MOVE PXRD004-STR-EXPTED-QTY   TO PXRD023-STR-EXPTED-QTY.     01830054
126005     MOVE XST00067-DMA-NBR         TO PXRD023-DMA-NBR.            01840054
126006     MOVE XST00067-DMA-NM          TO PXRD023-DMA-NM.             01850054
060210     IF PXRD004-LAST-NCLR-RTL-AMT > 0                                     
126007        COMPUTE PC-PERCENT-OFF =                                  01860058
126008                100 * (1 - (PXRD004-UNT-RTL-AMT /                 01870058
126009                                     PXRD004-LAST-NCLR-RTL-AMT))  01880058
060210     ELSE                                                                 
060210        MOVE 0 TO PC-PERCENT-OFF                                          
060210     END-IF.                                                              
126010     MOVE PC-PERCENT-OFF           TO PXRD023-PERCENT-OFF.        01890058
126020                                                                  01900043
126021     PERFORM 9999-WRITE-OUTPUT-RECORD.                            01910048
126022     PERFORM 9999-WRITE-PERCENT-OFF-RECORD.                       01920054
126023     PERFORM 9999-READ-INPUT-RECORD.                              01930021
126024                                                                  01940021
126025 EJECT.                                                           01950021
126026******************************************************************01960023
126027**UPDATE STATUS CONTROL TO PROCESS                                01970043
126028******************************************************************01980023
126029 2100-DMA-LOOKUP.                                                 01990048
126030                                                                  02000023
126040     MOVE '2100-DMA-LOOKUP'     TO PV-PARAGRAPH-NAME.             02010048
126050                                                                  02020043
126060     MOVE PXRD004-DEPT-NBR      TO XST00015-DEPT-NBR.             02030048
126070                                                                  02040048
126080     EXEC SQL                                                     02050043
126090          SELECT B.DMA_NBR                                        02060048
126100                ,B.DMA_NM                                         02070048
126200          INTO   :XST00067-DMA-NBR                                02080048
126300                ,:XST00067-DMA-NM                                 02090048
126400          FROM   XST_DEPT A                                       02100048
126500                ,XST_DMA  B                                       02110048
126600          WHERE A.DMA_NBR   = B.DMA_NBR                           02120048
126700            AND A.DEPT_NBR  = :XST00015-DEPT-NBR                  02130048
126800          WITH UR                                                 02140048
126900     END-EXEC.                                                    02150043
127000                                                                  02160043
127100     EVALUATE TRUE                                                02170043
127200        WHEN SQLCODE = +0                                         02180043
127300             CONTINUE                                             02190048
127400        WHEN SQLCODE = +100                                       02200049
127500             MOVE 9999          TO XST00067-DMA-NBR               02210049
127600             MOVE 'NO DMA ASSIGNED'                               02220050
127700                                TO XST00067-DMA-NM                02230049
127800        WHEN OTHER                                                02240043
127900             DISPLAY 'LOOKUP DMA NBR AND NAME....'                02250048
128000             DISPLAY 'DEPT_NBR ' XST00015-DEPT-NBR                02260048
128100             PERFORM 9999-DISPLAY-STATISTICS                      02270043
128200             PERFORM 9999-SQL-ERROR                               02280043
128300     END-EVALUATE.                                                02290043
128400                                                                  02300043
128500 EJECT.                                                           02310043
128600******************************************************************02320043
128700**READ INPUT RECORD                                               02330043
128800******************************************************************02340043
128900 9999-READ-INPUT-RECORD.                                          02350043
129000                                                                  02360043
129100     READ INPUT-FILE INTO PXRD004-YELLOW-TICKET-UNLOAD            02370048
129200          AT END                                                  02380021
129300          SET PS-END-OF-INPUT-FILE TO TRUE                        02390021
129400     END-READ.                                                    02400021
129500                                                                  02410021
129600     IF  PS-NOT-END-OF-INPUT-FILE                                 02420021
129700         ADD +1                      TO PC-INPUT-RECORDS-READ     02430021
129800     END-IF.                                                      02440021
129900                                                                  02450021
130000 EJECT.                                                           02460021
130100****************************************************************  02470045
130200**WRITE OUTPUT RECORD                                             02480048
130300****************************************************************  02490045
130400 9999-WRITE-OUTPUT-RECORD.                                        02500048
130500                                                                  02510045
130600     WRITE OUTPUT-RECORD FROM PXRD020-YELLOW-TICKET-SUM-FILE.     02520048
130700                                                                  02530045
130800     ADD +1              TO PC-OUTPUT-RECORDS-WRITTEN.            02540048
130900                                                                  02550045
131000 EJECT.                                                           02560045
131100****************************************************************  02570054
131200**WRITE PERCENT-OFF RECORD                                        02580054
131201****************************************************************  02590054
131202 9999-WRITE-PERCENT-OFF-RECORD.                                   02600054
131203                                                                  02610054
131204     WRITE PERCENT-OFF-RECORD FROM PXRD023-YELLOW-TICKET-FILE.    02620054
131205                                                                  02630054
131206     ADD +1              TO PC-PERCENT-OFF-RECORDS-WRITTEN.       02640054
131207                                                                  02650054
131208 EJECT.                                                           02660054
131209******************************************************************02670021
131210**CLOSE INPUT FILES.                                              02680021
131220******************************************************************02690021
131230 9999-WRAPUP.                                                     02700021
131240                                                                  02710021
131250     CLOSE INPUT-FILE                                             02720024
131251           OUTPUT-FILE                                            02730055
131252           PERCENT-OFF-FILE.                                      02740055
131253                                                                  02750021
131254     PERFORM 9999-DISPLAY-STATISTICS.                             02760021
131255                                                                  02770021
131256 EJECT.                                                           02780021
131257******************************************************************02790021
131258**DISPLAY PROGRAM STATS                                           02800021
131259******************************************************************02810021
131260 9999-DISPLAY-STATISTICS.                                         02820021
131270                                                                  02830021
131280     DISPLAY '*************************************************'. 02840021
131290     DISPLAY '* PROGRAM...........: PXKUT013'.                    02850048
131300     DISPLAY '* DATE..............: ' DF-ACCEPT-DATE.             02860021
131400     DISPLAY '* TIME..............: ' DF-ACCEPT-TIME.             02870021
131500     DISPLAY '* RECORDS READ......: ' PC-INPUT-RECORDS-READ.      02880021
131600     DISPLAY '* OUTPUT RECORDS WRITTEN...: '                      02890048
131601                                        PC-OUTPUT-RECORDS-WRITTEN.02900048
131602     DISPLAY '* % OFF RECORDS WRITTEN....: '                      02910054
131603                               PC-PERCENT-OFF-RECORDS-WRITTEN.    02920054
131604     DISPLAY '*************************************************'. 02930021
131605                                                                  02940021
131606 EJECT.                                                           02950021
131607******************************************************************02960021
131608* ABEND ROUTINE FOR BAD SQL CALLS                                *02970021
131609******************************************************************02980021
131610 9999-SQL-ERROR.                                                  02990021
131620                                                                  03000021
131630     DISPLAY '** ABEND     **'.                                   03010021
131640     DISPLAY '** PROGRAM   ** = PXKUT013'.                        03020048
131650     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              03030021
131660     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               03040021
131670***************************************************************** 03050021
131680*    COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED  03060021
131690*    TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.   03070021
131700***************************************************************** 03080021
131800     COPY DPPD004.                                                03090021
131900     SET AC-DB2-ERROR TO TRUE.                                    03100021
132000     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         03110021
132100                                                                  03120021
132200 EJECT.                                                           03130021
