000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.      TFKUT004.                                       00030000
000400 AUTHOR.          STEVEN NOWAK.                                   00040000
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050000
000600 DATE-WRITTEN.    04/01/06.                                       00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*  MODULE TYPE:   COBOL2 DB2 BATCH                                00100000
001100*                                                                 00110000
001200*  DESCRIPTION:   WEEKLY CALLBACK ITEMS EXTRACT                   00120000
001300*                                                                 00130000
001400*========================== CHANGE LOG ===========================00140009
001500*  AUTH     BY         DATE                 DESCRIPTION           00150009
001600*=================================================================00160009
001700* WR30039  S.NOWAK   04-01-06   CREATE PROGRAM                    00170009
001800*                                                                 00180009
001900* P901928  S.NOWAK   07-20-06   ENSURE DATE IS ON REPORT EVEN IF  00190009
002000*                               NO DATA TO REPORT                 00200009
002100*                                                                 00210009
002200******************************************************************00220000
002300                                                                  00230000
002400 ENVIRONMENT DIVISION.                                            00240000
002500 CONFIGURATION SECTION.                                           00250000
002600                                                                  00260000
002700 SOURCE-COMPUTER.        IBM-3090.                                00270000
002800 OBJECT-COMPUTER.        IBM-3090.                                00280000
002900                                                                  00290000
003000 INPUT-OUTPUT SECTION.                                            00300000
003100 FILE-CONTROL.                                                    00310000
003200                                                                  00320000
003300     SELECT DATE-FILE ASSIGN TO INP01.                            00330003
003400     SELECT EXTR-FILE ASSIGN TO OUT01.                            00340003
003500                                                                  00350000
003600 DATA DIVISION.                                                   00360000
003700 FILE SECTION.                                                    00370000
003800                                                                  00380000
003900 FD  DATE-FILE                                                    00390003
004000     LABEL RECORDS STANDARD                                       00400000
004100     RECORDING MODE IS F                                          00410000
004200     BLOCK CONTAINS 0 RECORDS.                                    00420000
004300                                                                  00430000
004400 01  DATE-REC                       PIC X(80).                    00440003
004500                                                                  00450000
004600 FD  EXTR-FILE                                                    00460003
004700     LABEL RECORDS STANDARD                                       00470003
004800     RECORDING MODE IS F                                          00480003
004900     BLOCK CONTAINS 0 RECORDS.                                    00490003
005000                                                                  00500003
005100 01  EXTR-REC                       PIC X(150).                   00510003
005200                                                                  00520003
005300******************************************************************00530000
005400*                       WORKING STORAGE                           00540000
005500******************************************************************00550000
005600 WORKING-STORAGE SECTION.                                         00560000
005700                                                                  00570000
005800 01  W-START                        PIC X(40)                     00580000
005900     VALUE 'TFKUT004 - WORKING STORAGE BEGINS HERE'.              00590000
006000                                                                  00600000
006100                                                                  00610000
006200******************************************************************00620000
006300*                         SWITCHES                                00630000
006400******************************************************************00640000
006500 01  PS-PROGRAM-SWITCHES.                                         00650000
006600     05  PS-CALL-BCK-EOF-SW         PIC X(01)   VALUE 'N'.        00660000
006700         88  PS-CALL-BCK-END-OF-FILE            VALUE 'Y'.        00670003
006800     05  PS-ITM-EOF-SW              PIC X(01)   VALUE 'N'.        00680000
006900         88  PS-ITM-END-OF-FILE                 VALUE 'Y'.        00690003
007000     05  PS-DATE-EOF-SW             PIC X(01)   VALUE 'N'.        00700003
007100         88  PS-DATE-EOF                        VALUE 'Y'.        00710003
007200                                                                  00720000
007300******************************************************************00730000
007400*                        ACCUMULATORS                             00740000
007500******************************************************************00750000
007600 01  PA-ACCUMS.                                                   00760000
007700     05  PA-CALL-BCK-READ           PIC 9(11)   VALUE ZEROS.      00770000
007800                                                                  00780000
007900     05  PA-SALE                    PIC 9(11)   VALUE ZEROS.      00790000
008000     05  PA-SALE-DUMMY              PIC 9(11)   VALUE ZEROS.      00800000
008100     05  PA-RETURN                  PIC 9(11)   VALUE ZEROS.      00810000
008200     05  PA-RETURN-VALID            PIC 9(11)   VALUE ZEROS.      00820000
008300     05  PA-RETURN-DUMMY            PIC 9(11)   VALUE ZEROS.      00830000
008400                                                                  00840000
008500     05  PA-WRITTEN                 PIC 9(11)   VALUE ZEROS.      00850000
008600                                                                  00860000
008700******************************************************************00870000
008800*                          WORK AREA                              00880000
008900******************************************************************00890000
009000 01  WS-WORK-AREA.                                                00900000
009100     05  WS-CCYY-MM-DD              PIC  X(10)  VALUE SPACES.     00910000
009200                                                                  00920000
009300     05  WS-BEG-DATE                PIC  X(10).                   00930004
009400                                                                  00940000
009500     05  WS-END-DATE                PIC  X(10).                   00950004
009600                                                                  00960000
009700     05  WS-SKU-NBR.                                              00970006
009800         10  WS-SKU-FIRST-5         PIC  9(05).                   00980006
009900         10  WS-SKU-LAST-3          PIC  9(03).                   00990006
010000                                                                  01000000
010100******************************************************************01010000
010200*                          CONSTANTS                              01020000
010300******************************************************************01030000
010400 01  PC-CONSTANTS.                                                01040000
010500     05  PC-PROGRAM-NAME            PIC  X(08)  VALUE 'TFKUT004'. 01050000
010600                                                                  01060000
010700     05  PC-ROW-NOT-FOUND           PIC S9(03)  VALUE +100.       01070000
010800                                                                  01080000
010900******************************************************************01090000
011000*                        VARIABLES                                01100000
011100******************************************************************01110000
011200 01  PC-PROGRAM-VARIABLES.                                        01120000
011300     05  PV-SQLCODE                 PIC +9(04)  VALUE ZEROS.      01130000
011400     05  PV-PARAGRAPH-NAME          PIC  X(30)  VALUE SPACES.     01140000
011500     05  PV-TABLE-NAME              PIC  X(12)  VALUE SPACES.     01150000
011600     05  PV-OPERATION-MSG           PIC  X(60)  VALUE SPACES.     01160000
011700                                                                  01170000
011800******************************************************************01180000
011900*                        CONTROL CARD                             01190000
012000******************************************************************01200000
012100 01  CC-CONTROL-CARD.                                             01210010
012200     05  CC-CNTL-CARD.                                            01220010
012300         10  CC-RPT-TYPE            PIC  X(01)  VALUE SPACE.      01230010
012400             88  CC-RPT-TYPE-WEEKLY             VALUE 'W'.        01240010
012500             88  CC-RPT-TYPE-MONTHLY            VALUE 'M'.        01250010
012600         10  CC-DATE                PIC  X(10)  VALUE SPACES.     01260010
012700         10  FILLER                 PIC  X(69)  VALUE SPACES.     01270010
012800                                                                  01280000
012900******************************************************************01290000
013000*               SYTEM TIME AND DATE VARIABLES                     01300000
013100******************************************************************01310000
013200 01  SYS-DATE-TIME.                                               01320000
013300     05  SYS-DATE                   PIC  X(08)  VALUE SPACES.     01330000
013400     05  SYS-TIME                   PIC  X(08)  VALUE SPACES.     01340000
013500                                                                  01350000
013600 01  ST-BEG-TIME.                                                 01360000
013700     05  ST-BEG-HR                  PIC  9(02)  VALUE ZEROS.      01370000
013800     05  FILLER                     PIC  X(01)  VALUE ':'.        01380000
013900     05  ST-BEG-MN                  PIC  9(02)  VALUE ZEROS.      01390000
014000                                                                  01400000
014100 01  ST-END-TIME.                                                 01410000
014200     05  ST-END-HR                  PIC  9(02)  VALUE ZEROS.      01420000
014300     05  FILLER                     PIC  X(01)  VALUE ':'.        01430000
014400     05  ST-END-MN                  PIC  9(02)  VALUE ZEROS.      01440000
014500                                                                  01450000
014600 01  SD-EDIT-DATE.                                                01460000
014700     05  SD-MONTH                   PIC  9(02)  VALUE ZEROS.      01470000
014800     05  FILLER                     PIC  X(01)  VALUE '-'.        01480000
014900     05  SD-DAY                     PIC  9(02)  VALUE ZEROS.      01490000
015000     05  FILLER                     PIC  X(01)  VALUE '-'.        01500000
015100     05  SD-YEAR.                                                 01510000
015200         10  SD-CC                  PIC  9(02)  VALUE ZEROS.      01520000
015300         10  SD-YY                  PIC  9(02)  VALUE ZEROS.      01530000
015400                                                                  01540000
015500******************************************************************01550000
015600*                        ERROR HANDLING                           01560000
015700******************************************************************01570000
015800 01  ABEND-CODE                  PIC S9(4) VALUE ZEROS COMP SYNC. 01580000
015900     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           01590000
016000     88  ABEND-4013-DB2-ERROR              VALUE +4013.           01600000
016100     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           01610000
016200                                                                  01620000
016300******************************************************************01630000
016400*                       COPY BOOKS                                01640000
016500******************************************************************01650000
016600     COPY TFRD058.                                                01660000
016700                                                                  01670000
016800******************************************************************01680000
016900* PARAMETER LIST FOR THE CALENDAR ROUTINE                         01690000
017000******************************************************************01700000
017100     COPY DPWS500.                                                01710000
017200                                                                  01720000
017300******************************************************************01730000
017400* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01740000
017500******************************************************************01750000
017600     COPY DPWS004.                                                01760000
017700                                                                  01770000
017800******************************************************************01780000
017900* DB2 MESSAGE AREA                                                01790000
018000******************************************************************01800000
018100     COPY SQLCA2.                                                 01810000
018200                                                                  01820000
018300******************************************************************01830000
018400* DB2 COMMUNICATION AREA                                          01840000
018500******************************************************************01850000
018600     EXEC SQL                                                     01860000
018700          INCLUDE SQLCA                                           01870000
018800     END-EXEC.                                                    01880000
018900                                                                  01890000
019000******************************************************************01900000
019100* TRANSACTION TABLE                                               01910000
019200******************************************************************01920000
019300     EXEC SQL                                                     01930000
019400          INCLUDE TEPTRN                                          01940000
019500     END-EXEC.                                                    01950000
019600                                                                  01960000
019700******************************************************************01970000
019800* ITEM TABLE                                                      01980000
019900******************************************************************01990000
020000     EXEC SQL                                                     02000000
020100          INCLUDE TEPITM                                          02010000
020200     END-EXEC.                                                    02020000
020300                                                                  02030000
020400******************************************************************02040000
020500* ITEM CALLBACK TABLE (EPT_ITM_CLBK)                              02050000
020600******************************************************************02060000
020700     EXEC SQL                                                     02070000
020800          INCLUDE EPT00026                                        02080000
020900     END-EXEC.                                                    02090000
021000                                                                  02100000
021100******************************************************************02110000
021200* SKU TABLE (XST_SKU)                                             02120000
021300******************************************************************02130000
021400     EXEC SQL                                                     02140000
021500          INCLUDE XST00010                                        02150000
021600     END-EXEC.                                                    02160000
021700                                                                  02170000
021800******************************************************************02180000
021900* PARTITION TABLE                                                 02190000
022000******************************************************************02200000
022100     EXEC SQL                                                     02210000
022200          INCLUDE TEPPART                                         02220000
022300     END-EXEC.                                                    02230000
022400                                                                  02240000
022500******************************************************************02250000
022600* CALLBACK TABLE (TFT_CLBK)                                       02260000
022700******************************************************************02270000
022800     EXEC SQL                                                     02280000
022900          INCLUDE TFT00002                                        02290000
023000     END-EXEC.                                                    02300000
023100                                                                  02310000
023200******************************************************************02320000
023300* CALLBACK MDSE TABLE (TFT_CLBK_MDSE)                             02330000
023400******************************************************************02340000
023500     EXEC SQL                                                     02350000
023600          INCLUDE TFT00003                                        02360000
023700     END-EXEC.                                                    02370000
023800                                                                  02380000
023900******************************************************************02390007
024000* XS DOMAIN LOCATION/DISTRICT RELATIONSHIP (XST_LOC_DIST)         02400007
024100******************************************************************02410007
024200     EXEC SQL                                                     02420007
024300          INCLUDE XST00002                                        02430007
024400     END-EXEC.                                                    02440007
024500                                                                  02450007
024600******************************************************************02460007
024700* XS DOMAIN DISTRICT/REGION RELATIONSHIP (XST_DIST_REGN)          02470007
024800******************************************************************02480007
024900     EXEC SQL                                                     02490007
025000          INCLUDE XST00004                                        02500007
025100     END-EXEC.                                                    02510007
025200                                                                  02520007
025300******************************************************************02530007
025400* XS DOMAIN REGION/TERRITORY RELATIONSHIP (XST_REGN_TERR)         02540007
025500******************************************************************02550007
025600     EXEC SQL                                                     02560007
025700          INCLUDE XST00006                                        02570007
025800     END-EXEC.                                                    02580007
025900                                                                  02590007
026000******************************************************************02600007
026100* CALLBACK CURSOR                                                 02610000
026200******************************************************************02620000
026300     EXEC SQL                                                     02630000
026400        DECLARE CALL-BCK-CSR CURSOR FOR                           02640000
026500         SELECT  TRN.PARTN_NBR                                    02650000
026600                ,TRN.STR_NBR                                      02660000
026700                ,TRN.RGST_ID                                      02670000
026800                ,TRN.TRN_NBR                                      02680000
026900                ,TRN.STRT_TM                                      02690000
027000                ,TRN.SLS_CORR_SEQ_NBR                             02700000
027100                ,TRN.TRN_TYP_CDE                                  02710000
027200                ,TRN.ASSOC_ID                                     02720000
027300                ,TRN.VOID_ABRT_CDE                                02730000
027400                ,ITM.SKU_SEQ_NBR                                  02740000
027500                ,ITM.SAL_RET_CDE                                  02750000
027600                ,ITM.UPC_NBR                                      02760000
027700                ,ITM.SKU_NBR                                      02770000
027800                ,ITM.SLD_QTY                                      02780000
027900                ,ITM.NET_CHRGD_AMT                                02790000
028000                ,SKU.SKU_DESC                                     02800000
028100                ,PRT.SLS_DTE                                      02810006
028200                ,TER.TERR_NBR                                     02820007
028300                ,REG.REGN_NBR                                     02830007
028400                ,DIS.DIST_NBR                                     02840007
028500                                                                  02850000
028600           FROM TEPTRN        TRN                                 02860007
028700               ,TEPITM        ITM                                 02870007
028800               ,EPT_ITM_CLBK  CLB                                 02880007
028900               ,XST_SKU       SKU                                 02890007
029000               ,TEPPART       PRT                                 02900007
029100               ,XST_LOC_DIST  DIS                                 02910007
029200               ,XST_DIST_REGN REG                                 02920007
029300               ,XST_REGN_TERR TER                                 02930007
029400                                                                  02940000
029500           WHERE PRT.PARTN_NBR = TRN.PARTN_NBR                    02950003
029600             AND TRN.PARTN_NBR = ITM.PARTN_NBR                    02960000
029700             AND TRN.PARTN_NBR = CLB.PARTN_NBR                    02970000
029800             AND TRN.STR_NBR = ITM.STR_NBR                        02980000
029900             AND TRN.STR_NBR = CLB.STR_NBR                        02990000
030000             AND TRN.RGST_ID = ITM.RGST_ID                        03000000
030100             AND TRN.RGST_ID = CLB.RGST_ID                        03010000
030200             AND TRN.TRN_NBR = ITM.TRN_NBR                        03020000
030300             AND TRN.TRN_NBR = CLB.TRN_NBR                        03030000
030400             AND TRN.STRT_TM = ITM.STRT_TM                        03040000
030500             AND TRN.STRT_TM = CLB.STRT_TM                        03050000
030600             AND TRN.SLS_CORR_SEQ_NBR = ITM.SLS_CORR_SEQ_NBR      03060000
030700             AND TRN.SLS_CORR_SEQ_NBR = CLB.SLS_CORR_SEQ_NBR      03070000
030800             AND ITM.LNE_ITM_SEQ_NBR  = CLB.LNE_ITM_SEQ_NBR       03080000
030900             AND ITM.SKU_NBR = SKU.SKU_NBR                        03090000
031000             AND TRN.STR_NBR = DIS.LOC_NBR                        03100007
031100             AND DIS.DIST_NBR = REG.DIST_NBR                      03110007
031200             AND REG.REGN_NBR = TER.REGN_NBR                      03120007
031300             AND PRT.SLS_DTE BETWEEN :WS-BEG-DATE                 03130003
031400                                 AND :WS-END-DATE                 03140003
031500             AND TRN.VOID_ABRT_CDE IN ('N', 'V', 'A')             03150000
031600             AND TRN.TRN_TYP_CDE   IN ('01', '02',                03160003
031700                                       '21', '24', '25', '46')    03170000
031800                                                                  03180000
031900             AND ITM.LIV_RSLU_CDE IN ('+', '-', 'R')              03190000
032000             AND ITM.SAL_RET_CDE  = 'S'                           03200003
032100             AND DIS.END_DTE IS NULL                              03210007
032200             AND REG.END_DTE IS NULL                              03220007
032300             AND TER.END_DTE IS NULL                              03230007
032400                                                                  03240000
032500       WITH UR                                                    03250000
032600     END-EXEC.                                                    03260000
032700                                                                  03270000
032800******************************************************************03280000
032900* ITEM CURSOR                                                     03290000
033000******************************************************************03300000
033100     EXEC SQL                                                     03310000
033200        DECLARE ITM-CSR CURSOR FOR                                03320000
033300         SELECT  UPC_NBR                                          03330000
033400                ,SKU_NBR                                          03340000
033500                ,SLD_QTY                                          03350000
033600                ,NET_CHRGD_AMT                                    03360000
033700                                                                  03370000
033800           FROM TEPITM                                            03380000
033900                                                                  03390000
034000           WHERE PARTN_NBR = :EPTRN-PARTN-NBR                     03400000
034100             AND STR_NBR   = :EPTRN-STR-NBR                       03410000
034200             AND RGST_ID   = :EPTRN-RGST-ID                       03420000
034300             AND TRN_NBR   = :EPTRN-TRN-NBR                       03430000
034400             AND STRT_TM   = :EPTRN-STRT-TM                       03440000
034500             AND SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR       03450000
034600             AND SAL_RET_CDE  = 'S'                               03460003
034700             AND DEPT_NBR <> '983'                                03470003
034800                                                                  03480000
034900       WITH UR                                                    03490000
035000     END-EXEC.                                                    03500000
035100                                                                  03510000
035200 PROCEDURE DIVISION.                                              03520000
035300******************************************************************03530000
035400* MAIN DRIVER                                                     03540000
035500******************************************************************03550000
035600 0000-MAIN-DRIVER.                                                03560000
035700                                                                  03570000
035800     PERFORM A1000-INITIALIZE.                                    03580000
035900                                                                  03590000
036000     PERFORM B1000-PROCESS.                                       03600000
036100                                                                  03610000
036200     PERFORM Z9000-END-PROC.                                      03620000
036300                                                                  03630000
036400     GOBACK.                                                      03640000
036500                                                                  03650000
036600******************************************************************03660000
036700* PREFORMS TASK INITIATION PROCESSING                             03670000
036800******************************************************************03680000
036900 A1000-INITIALIZE.                                                03690000
037000                                                                  03700000
037100     OPEN INPUT  DATE-FILE                                        03710003
037200          OUTPUT EXTR-FILE.                                       03720003
037300                                                                  03730000
037400     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 03740000
037500                                                                  03750000
037600     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            03760000
037700     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            03770000
037800                                                                  03780000
037900     MOVE SYS-DATE (1:2) TO SD-CC.                                03790000
038000     MOVE SYS-DATE (3:2) TO SD-YY.                                03800000
038100     MOVE SYS-DATE (5:2) TO SD-MONTH.                             03810000
038200     MOVE SYS-DATE (7:2) TO SD-DAY.                               03820000
038300                                                                  03830000
038400     PERFORM A1500-READ-CONTROL-CARD.                             03840003
038500     CLOSE DATE-FILE.                                             03850003
038600     IF PS-DATE-EOF                                               03860003
038700         MOVE 'A1000-INITIALIZE'  TO PV-PARAGRAPH-NAME            03870003
038800         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG    03880005
038900         SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   03890003
039000         PERFORM Z2000-ABEND                                      03900003
039100     END-IF.                                                      03910003
039200                                                                  03920003
039300     IF CC-RPT-TYPE = 'W'                                         03930010
039400         CONTINUE                                                 03940011
039500     ELSE                                                         03950010
039600         IF CC-RPT-TYPE = 'M'                                     03960010
039700             CONTINUE                                             03970011
039800         ELSE                                                     03980010
039900             MOVE 'A1000-INITIALIZE'  TO PV-PARAGRAPH-NAME        03990010
040000             MOVE 'CONTROL CARD RPT TYPE INVALID'                 04000010
040100                                      TO PV-OPERATION-MSG         04010010
040200             SET ABEND-4003-CTRL-CARD-ERROR TO TRUE               04020010
040300             PERFORM Z2000-ABEND                                  04030010
040400         END-IF                                                   04040010
040500     END-IF.                                                      04050010
040600                                                                  04060010
040700     PERFORM A2000-PROCESS-DATE.                                  04070000
040800                                                                  04080000
040900***************************************************************** 04090003
041000*      READ CONTROL CARD                                          04100003
041100***************************************************************** 04110003
041200                                                                  04120003
041300 A1500-READ-CONTROL-CARD.                                         04130003
041400     READ DATE-FILE INTO CC-CNTL-CARD                             04140005
041500         AT END                                                   04150003
041600            SET PS-DATE-EOF TO TRUE                               04160005
041700     END-READ.                                                    04170003
041800                                                                  04180003
041900******************************************************************04190000
042000* GET THE BEGINNING AND ENDING DATES FOR THE REPORTING WEEK       04200000
042100******************************************************************04210000
042200 A2000-PROCESS-DATE.                                              04220000
042300                                                                  04230000
042400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04240000
042500                                                                  04250000
042600     SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            04260010
042700                                                                  04270010
042800     IF CC-RPT-TYPE = 'W'                                         04280010
042900         SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                   04290010
043000     ELSE                                                         04300010
043100         SET DPG51-FISCAL-454-CALENDAR TO TRUE                    04310010
043200     END-IF.                                                      04320010
043300                                                                  04330010
043400     MOVE CC-DATE TO DPG52-LK-DATE-INPUT.                         04340000
043500                                                                  04350000
043600     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                04360000
043700                                             DPG52                04370000
043800                                             DPG53                04380000
043900                                             DPG54                04390000
044000                                             DPG55                04400000
044100                                             DPG56.               04410000
044200                                                                  04420000
044300     EVALUATE TRUE                                                04430000
044400        WHEN DPG54-NO-ERROR                                       04440000
044500            IF CC-RPT-TYPE-WEEKLY                                 04450010
044600                MOVE DPG55-1ST-WKDY-DB2ISO-FMT  TO WS-BEG-DATE    04460010
044700                MOVE DPG55-LAST-WKDY-DB2ISO-FMT TO WS-END-DATE    04470010
044800            ELSE                                                  04480010
044900                MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO WS-BEG-DATE    04490010
045000                MOVE DPG56-LAST-FP-DB2-ISO-FMT  TO WS-END-DATE    04500010
045100            END-IF                                                04510010
045200                                                                  04520000
045300        WHEN DPG54-WARNING-ERROR                                  04530000
045400        WHEN DPG54-SEVERE-ERROR                                   04540000
045500            DISPLAY '          '                                  04550000
045600            DISPLAY 'CC-DATE = ' CC-DATE                          04560000
045700                                                                  04570000
045800            MOVE 'A2000-PROCESS-DATE' TO PV-PARAGRAPH-NAME        04580000
045900            SET ABEND-4019-CAL-SUB-ERROR TO TRUE                  04590003
046000                                                                  04600000
046100            PERFORM Z2000-ABEND                                   04610003
046200                                                                  04620000
046300     END-EVALUATE.                                                04630000
046400                                                                  04640000
046500******************************************************************04650000
046600* MAIN PROCESS                                                    04660000
046700*   - IF NO RECORDS PROCESSED, WRITE OUT REC FOR DATE TO BE       04670002
046800*     USED IN THE HEADER OF THE REPORT PROGRAM (TFKRP006)         04680002
046900******************************************************************04690000
047000 B1000-PROCESS.                                                   04700000
047100                                                                  04710000
047200     PERFORM B2000-OPEN-CALL-BCK-CSR.                             04720000
047300                                                                  04730000
047400     PERFORM B3000-FETCH-CALL-BCK-CSR.                            04740003
047500                                                                  04750003
047600     PERFORM B2500-PROCESS-ITEMS                                  04760003
047700        UNTIL PS-CALL-BCK-END-OF-FILE.                            04770003
047800                                                                  04780000
047900     PERFORM B4000-CLOSE-CALL-BCK-CSR.                            04790000
048000                                                                  04800000
048100******************************************************************04810000
048200* OPEN CALL-BACK CURSOR                                           04820000
048300******************************************************************04830000
048400 B2000-OPEN-CALL-BCK-CSR.                                         04840000
048500                                                                  04850000
048600     EXEC SQL                                                     04860000
048700          OPEN CALL-BCK-CSR                                       04870000
048800     END-EXEC.                                                    04880000
048900                                                                  04890000
049000     IF SQLCODE NOT EQUAL ZERO                                    04900000
049100        MOVE SQLCODE                   TO PV-SQLCODE              04910000
049200        MOVE 'TEPTRN'                  TO PV-TABLE-NAME           04920000
049300        MOVE 'B2000-OPEN-CALL-BCK-CSR' TO PV-PARAGRAPH-NAME       04930000
049400                                                                  04940000
049500        STRING 'ERROR ON OPEN OF CALL-BCK CURSOR - SQLCODE= '     04950000
049600                PV-SQLCODE DELIMITED BY SIZE INTO                 04960000
049700                PV-OPERATION-MSG                                  04970000
049800        END-STRING                                                04980000
049900                                                                  04990000
050000        PERFORM Z1000-ABEND                                       05000000
050100     END-IF.                                                      05010000
050200                                                                  05020000
050300******************************************************************05030003
050400* PROCESS THE RECORDS                                             05040003
050500*   - PROCESS DUMMY RECORDS FOR SALE ITEMS ONLY                   05050003
050600*   - DO NOT PROCESS VOIDS FOR RETURNS                            05060003
050700******************************************************************05070003
050800 B2500-PROCESS-ITEMS.                                             05080003
050900                                                                  05090003
051000     IF  EPITM-SAL-RET-CDE = 'S'                                  05100003
051100         ADD 1 TO PA-SALE                                         05110003
051200                                                                  05120003
051300         PERFORM C2000-SETUP-CLBK-REC                             05130003
051400         PERFORM D1000-CHECK-FOR-DUMMYS                           05140003
051500                                                                  05150003
051600     END-IF.                                                      05160003
051700                                                                  05170003
051800     PERFORM B3000-FETCH-CALL-BCK-CSR.                            05180003
051900                                                                  05190000
052000******************************************************************05200000
052100* FETCH CALL-BACK CURSOR                                          05210000
052200******************************************************************05220000
052300 B3000-FETCH-CALL-BCK-CSR.                                        05230000
052400                                                                  05240000
052500     EXEC SQL                                                     05250000
052600         FETCH CALL-BCK-CSR                                       05260000
052700          INTO :EPTRN-PARTN-NBR                                   05270000
052800              ,:EPTRN-STR-NBR                                     05280000
052900              ,:EPTRN-RGST-ID                                     05290000
053000              ,:EPTRN-TRN-NBR                                     05300000
053100              ,:EPTRN-STRT-TM                                     05310000
053200              ,:EPTRN-SLS-CORR-SEQ-NBR                            05320000
053300              ,:EPTRN-TRN-TYP-CDE                                 05330000
053400              ,:EPTRN-ASSOC-ID                                    05340000
053500              ,:EPTRN-VOID-ABRT-CDE                               05350000
053600              ,:EPITM-SKU-SEQ-NBR                                 05360000
053700              ,:EPITM-SAL-RET-CDE                                 05370000
053800              ,:EPITM-UPC-NBR                                     05380000
053900              ,:EPITM-SKU-NBR                                     05390000
054000              ,:EPITM-SLD-QTY                                     05400000
054100              ,:EPITM-NET-CHRGD-AMT                               05410000
054200              ,:XST00010-SKU-DESC                                 05420000
054300              ,:EPPART-SLS-DTE                                    05430006
054400              ,:XST00006-TERR-NBR                                 05440007
054500              ,:XST00004-REGN-NBR                                 05450007
054600              ,:XST00002-DIST-NBR                                 05460007
054700     END-EXEC.                                                    05470000
054800                                                                  05480000
054900     EVALUATE TRUE                                                05490000
055000        WHEN SQLCODE = ZERO                                       05500000
055100           ADD 1 TO PA-CALL-BCK-READ                              05510000
055200                                                                  05520000
055300        WHEN SQLCODE = PC-ROW-NOT-FOUND                           05530000
055400           SET PS-CALL-BCK-END-OF-FILE TO TRUE                    05540003
055500                                                                  05550000
055600        WHEN OTHER                                                05560000
055700           MOVE SQLCODE                    TO PV-SQLCODE          05570000
055800           MOVE 'TEPTRN'                   TO PV-TABLE-NAME       05580000
055900           MOVE 'B3000-FETCH-CALL-BCK-CSR' TO PV-PARAGRAPH-NAME   05590000
056000                                                                  05600000
056100           STRING 'ERROR ON FETCH OF CALL-BCK CURSOR - SQLCODE= ' 05610000
056200                   PV-SQLCODE DELIMITED BY SIZE INTO              05620000
056300                   PV-OPERATION-MSG                               05630000
056400           END-STRING                                             05640000
056500                                                                  05650000
056600           PERFORM Z1000-ABEND                                    05660000
056700     END-EVALUATE.                                                05670000
056800                                                                  05680000
056900******************************************************************05690000
057000* CLOSE CALL-BACK CURSOR                                          05700000
057100******************************************************************05710000
057200 B4000-CLOSE-CALL-BCK-CSR.                                        05720000
057300                                                                  05730000
057400     EXEC SQL                                                     05740000
057500          CLOSE CALL-BCK-CSR                                      05750000
057600     END-EXEC.                                                    05760000
057700                                                                  05770000
057800     IF SQLCODE NOT EQUAL ZERO                                    05780000
057900        MOVE SQLCODE                    TO PV-SQLCODE             05790000
058000        MOVE 'TEPTRN'                   TO PV-TABLE-NAME          05800000
058100        MOVE 'B4000-CLOSE-CALL-BCK-CSR' TO PV-PARAGRAPH-NAME      05810000
058200                                                                  05820000
058300        STRING 'ERROR ON CLOSE OF CALL-BCK CURSOR - SQLCODE= '    05830000
058400                PV-SQLCODE DELIMITED BY SIZE INTO                 05840000
058500                PV-OPERATION-MSG                                  05850000
058600        END-STRING                                                05860000
058700                                                                  05870000
058800        PERFORM Z1000-ABEND                                       05880000
058900     END-IF.                                                      05890000
059000                                                                  05900000
059100******************************************************************05910000
059200* PROCESS THE RECORDS                                             05920000
059300******************************************************************05930000
059400 C2000-SETUP-CLBK-REC.                                            05940000
059500                                                                  05950000
059600     IF  EPITM-UPC-NBR = ZEROS                                    05960000
059700         MOVE EPITM-SKU-NBR   TO TF058-UPC-NBR                    05970003
059800     ELSE                                                         05980000
059900         MOVE EPITM-UPC-NBR   TO TF058-UPC-NBR                    05990003
060000     END-IF.                                                      06000000
060100                                                                  06010000
060200     MOVE 'Y'                 TO TF058-CALL-BCK-IND.              06020003
060300     MOVE XST00010-SKU-DESC   TO TF058-SKU-DESC.                  06030003
060400     MOVE EPITM-SLD-QTY       TO TF058-QTY.                       06040003
060500     MOVE EPITM-NET-CHRGD-AMT TO TF058-AMT.                       06050003
060600     MOVE EPTRN-RGST-ID       TO TF058-REG-NBR.                   06060003
060700     MOVE EPTRN-TRN-NBR       TO TF058-TRAN-NBR.                  06070003
060800     MOVE EPTRN-ASSOC-ID      TO TF058-ASSOC-ID.                  06080003
060900     MOVE EPPART-SLS-DTE      TO TF058-TRAN-DATE.                 06090008
061000     MOVE EPTRN-STR-NBR       TO TF058-STR-NBR.                   06100007
061100     MOVE EPTRN-RGST-ID       TO TF058-RGST-ID.                   06110012
061200     MOVE EPTRN-TRN-NBR       TO TF058-TRN-NBR.                   06120012
061300     MOVE EPITM-SKU-NBR       TO TF058-SKU-NBR.                   06130012
061400     MOVE XST00002-DIST-NBR   TO TF058-DIST-NBR.                  06140007
061500     MOVE XST00004-REGN-NBR   TO TF058-REGN-NBR.                  06150007
061600     MOVE XST00006-TERR-NBR   TO TF058-TERR-NBR.                  06160007
061700                                                                  06170000
061800     PERFORM C3000-DET-TRAN-TYPE.                                 06180000
061900     PERFORM C4000-GET-CALLBK-ID.                                 06190000
062000                                                                  06200000
062100     PERFORM W1000-WRITE.                                         06210000
062200                                                                  06220000
062300                                                                  06230000
062400******************************************************************06240000
062500* DETERMINE THE TRAN TYPE                                         06250000
062600******************************************************************06260000
062700 C3000-DET-TRAN-TYPE.                                             06270000
062800                                                                  06280000
062900     MOVE SPACES TO TF058-TRAN-TYPE.                              06290003
063000                                                                  06300000
063100     IF  EPTRN-TRN-TYP-CDE = '01'                                 06310000
063200     OR  EPTRN-TRN-TYP-CDE = '02'                                 06320000
063300         MOVE 'ATTEMPTED SALE' TO TF058-TRAN-TYPE                 06330003
063400     END-IF.                                                      06340000
063500                                                                  06350000
063600     IF  EPTRN-TRN-TYP-CDE = '21'                                 06360000
063700     AND EPITM-SAL-RET-CDE = 'S'                                  06370000
063800         MOVE 'ATTEMPTED SALE' TO TF058-TRAN-TYPE                 06380003
063900     END-IF.                                                      06390000
064000                                                                  06400000
064100     IF  EPTRN-TRN-TYP-CDE = '24'                                 06410000
064200     OR  EPTRN-TRN-TYP-CDE = '25'                                 06420000
064300         MOVE 'PRICE ADJUSTMENT' TO TF058-TRAN-TYPE               06430003
064400     END-IF.                                                      06440000
064500                                                                  06450000
064600     IF  EPTRN-TRN-TYP-CDE = '46'                                 06460000
064700         MOVE 'ITEM INQUIRIES' TO TF058-TRAN-TYPE                 06470003
064800     END-IF.                                                      06480000
064900                                                                  06490000
065000******************************************************************06500000
065100* GET THE CALLBACK ID                                             06510000
065200******************************************************************06520000
065300 C4000-GET-CALLBK-ID.                                             06530000
065400                                                                  06540000
065500     EXEC SQL                                                     06550000
065600        SELECT B.USR_CLBK_ID                                      06560000
065700              ,B.CLBK_NM                                          06570000
065800        INTO :TFT00002-USR-CLBK-ID                                06580000
065900            ,:TFT00002-CLBK-NM                                    06590000
066000        FROM TFT_CLBK_MDSE A                                      06600000
066100            ,TFT_CLBK      B                                      06610000
066200        WHERE A.SKU_NBR      = :EPITM-SKU-NBR                     06620000
066300          AND A.EFF_BEG_DTE <= :EPPART-SLS-DTE                    06630006
066400          AND A.EFF_END_DTE >= :EPPART-SLS-DTE                    06640006
066500          AND A.CLBK_ID      = B.CLBK_ID                          06650000
066600          AND A.EFF_BEG_DTE = (SELECT MAX(C.EFF_BEG_DTE)          06660013
066700                               FROM TFT_CLBK_MDSE C               06670013
066800                               WHERE A.SKU_NBR = C.SKU_NBR        06680013
066900                             AND C.EFF_BEG_DTE <= :EPPART-SLS-DTE 06690013
067000                             AND C.EFF_END_DTE >= :EPPART-SLS-DTE)06700013
067100        WITH UR                                                   06710000
067200     END-EXEC.                                                    06720000
067300                                                                  06730000
067400     EVALUATE TRUE                                                06740000
067500        WHEN SQLCODE = ZERO                                       06750000
067600           MOVE TFT00002-USR-CLBK-ID TO TF058-CLBK-ID             06760003
067700                                                                  06770000
067800        WHEN SQLCODE = PC-ROW-NOT-FOUND                           06780000
067900           MOVE ZEROS                TO TF058-CLBK-ID             06790003
068000                                                                  06800000
068100        WHEN OTHER                                                06810000
068200           DISPLAY '          '                                   06820000
068300           DISPLAY 'SKU NBR = ' EPITM-SKU-NBR                     06830000
068400           DISPLAY 'SLS DTE = ' EPPART-SLS-DTE                    06840006
068500                                                                  06850000
068600           MOVE SQLCODE               TO PV-SQLCODE               06860000
068700           MOVE 'TFT_CLBK'            TO PV-TABLE-NAME            06870000
068800           MOVE 'C4000-GET-CALLBK-ID' TO PV-PARAGRAPH-NAME        06880000
068900                                                                  06890000
069000           STRING 'ERROR ON READ OF CALL-BCK TABLE - SQLCODE= '   06900000
069100                   PV-SQLCODE DELIMITED BY SIZE INTO              06910000
069200                   PV-OPERATION-MSG                               06920000
069300           END-STRING                                             06930000
069400                                                                  06940000
069500           PERFORM Z1000-ABEND                                    06950000
069600     END-EVALUATE.                                                06960000
069700                                                                  06970000
069800******************************************************************06980000
069900* CHECK FOR DUMMY RECORDS                                         06990000
070000******************************************************************07000000
070100 D1000-CHECK-FOR-DUMMYS.                                          07010000
070200                                                                  07020000
070300     MOVE 'N' TO PS-ITM-EOF-SW.                                   07030000
070400                                                                  07040000
070500     PERFORM D2000-OPEN-ITM-CSR.                                  07050000
070600                                                                  07060000
070700     PERFORM D3000-FETCH-ITM-CSR.                                 07070003
070800                                                                  07080003
070900     PERFORM D2500-SETUP-DUMMY                                    07090003
071000        UNTIL PS-ITM-END-OF-FILE.                                 07100003
071100                                                                  07110000
071200     PERFORM D4000-CLOSE-ITM-CSR.                                 07120000
071300                                                                  07130000
071400******************************************************************07140000
071500* OPEN ITEM CURSOR                                                07150000
071600******************************************************************07160000
071700 D2000-OPEN-ITM-CSR.                                              07170000
071800                                                                  07180000
071900     EXEC SQL                                                     07190000
072000          OPEN ITM-CSR                                            07200000
072100     END-EXEC.                                                    07210000
072200                                                                  07220000
072300     IF SQLCODE NOT EQUAL ZERO                                    07230000
072400        MOVE SQLCODE              TO PV-SQLCODE                   07240000
072500        MOVE 'TEPITM'             TO PV-TABLE-NAME                07250000
072600        MOVE 'D2000-OPEN-ITM-CSR' TO PV-PARAGRAPH-NAME            07260000
072700                                                                  07270000
072800        STRING 'ERROR ON OPEN OF ITM CURSOR - SQLCODE= '          07280000
072900                PV-SQLCODE DELIMITED BY SIZE INTO                 07290000
073000                PV-OPERATION-MSG                                  07300000
073100        END-STRING                                                07310000
073200                                                                  07320000
073300        PERFORM Z1000-ABEND                                       07330000
073400     END-IF.                                                      07340000
073500                                                                  07350000
073600******************************************************************07360003
073700* SETUP THE DUMMY RECORD                                          07370003
073800*   - IF LAST 3 BYTES OF SKU EQUAL ZEROS, THEN ITS A DUMMY REC    07380003
073900******************************************************************07390003
074000 D2500-SETUP-DUMMY.                                               07400003
074100                                                                  07410003
074200     MOVE EPITM-SKU-NBR TO WS-SKU-NBR.                            07420003
074300                                                                  07430003
074400     IF  WS-SKU-LAST-3    = ZEROS                                 07440006
074500         ADD 1 TO PA-SALE-DUMMY                                   07450003
074600                                                                  07460003
074700         IF  EPITM-UPC-NBR = ZEROS                                07470003
074800             MOVE EPITM-SKU-NBR   TO TF058-UPC-NBR                07480003
074900         ELSE                                                     07490003
075000             MOVE EPITM-UPC-NBR   TO TF058-UPC-NBR                07500003
075100         END-IF                                                   07510003
075200                                                                  07520003
075300         MOVE SPACE               TO TF058-CALL-BCK-IND           07530003
075400         MOVE 'DUMMY SKU'         TO TF058-SKU-DESC               07540003
075500         MOVE 'SALE'              TO TF058-TRAN-TYPE              07550003
075600         MOVE EPITM-SLD-QTY       TO TF058-QTY                    07560003
075700         MOVE EPITM-NET-CHRGD-AMT TO TF058-AMT                    07570003
075800         MOVE EPTRN-RGST-ID       TO TF058-REG-NBR                07580003
075900         MOVE EPTRN-TRN-NBR       TO TF058-TRAN-NBR               07590003
076000         MOVE EPTRN-ASSOC-ID      TO TF058-ASSOC-ID               07600003
076100         MOVE EPPART-SLS-DTE      TO TF058-TRAN-DATE              07610008
076200         MOVE ZEROS               TO TF058-CLBK-ID                07620003
076300         MOVE EPTRN-STR-NBR       TO TF058-STR-NBR                07630007
076400         MOVE XST00002-DIST-NBR   TO TF058-DIST-NBR               07640007
076500         MOVE XST00004-REGN-NBR   TO TF058-REGN-NBR               07650007
076600         MOVE XST00006-TERR-NBR   TO TF058-TERR-NBR               07660007
076700                                                                  07670003
076800         PERFORM W1000-WRITE                                      07680003
076900     END-IF.                                                      07690003
077000                                                                  07700003
077100     PERFORM D3000-FETCH-ITM-CSR.                                 07710003
077200                                                                  07720000
077300******************************************************************07730000
077400* FETCH ITEM CURSOR                                               07740000
077500******************************************************************07750000
077600 D3000-FETCH-ITM-CSR.                                             07760000
077700                                                                  07770000
077800     EXEC SQL                                                     07780000
077900         FETCH ITM-CSR                                            07790000
078000          INTO :EPITM-UPC-NBR                                     07800000
078100              ,:EPITM-SKU-NBR                                     07810000
078200              ,:EPITM-SLD-QTY                                     07820000
078300              ,:EPITM-NET-CHRGD-AMT                               07830000
078400     END-EXEC.                                                    07840000
078500                                                                  07850000
078600     EVALUATE TRUE                                                07860000
078700        WHEN SQLCODE = ZERO                                       07870000
078800           CONTINUE                                               07880003
078900                                                                  07890000
079000        WHEN SQLCODE = PC-ROW-NOT-FOUND                           07900000
079100           SET PS-ITM-END-OF-FILE TO TRUE                         07910003
079200                                                                  07920000
079300        WHEN OTHER                                                07930000
079400           MOVE SQLCODE                    TO PV-SQLCODE          07940000
079500           MOVE 'TEPTRN'                   TO PV-TABLE-NAME       07950000
079600           MOVE 'D3000-FETCH-ITM-CSR' TO PV-PARAGRAPH-NAME        07960000
079700                                                                  07970000
079800           STRING 'ERROR ON FETCH OF ITM CURSOR - SQLCODE= '      07980000
079900                   PV-SQLCODE DELIMITED BY SIZE INTO              07990000
080000                   PV-OPERATION-MSG                               08000000
080100           END-STRING                                             08010000
080200                                                                  08020000
080300           PERFORM Z1000-ABEND                                    08030000
080400     END-EVALUATE.                                                08040000
080500                                                                  08050000
080600******************************************************************08060000
080700* CLOSE ITEM CURSOR                                               08070000
080800******************************************************************08080000
080900 D4000-CLOSE-ITM-CSR.                                             08090000
081000                                                                  08100000
081100     EXEC SQL                                                     08110000
081200          CLOSE ITM-CSR                                           08120000
081300     END-EXEC.                                                    08130000
081400                                                                  08140000
081500     IF SQLCODE NOT EQUAL ZERO                                    08150000
081600        MOVE SQLCODE                    TO PV-SQLCODE             08160000
081700        MOVE 'TEPTRN'                   TO PV-TABLE-NAME          08170000
081800        MOVE 'D4000-CLOSE-ITM-CSR' TO PV-PARAGRAPH-NAME           08180000
081900                                                                  08190000
082000        STRING 'ERROR ON CLOSE OF ITM CURSOR - SQLCODE= '         08200000
082100                PV-SQLCODE DELIMITED BY SIZE INTO                 08210000
082200                PV-OPERATION-MSG                                  08220000
082300        END-STRING                                                08230000
082400                                                                  08240000
082500        PERFORM Z1000-ABEND                                       08250000
082600     END-IF.                                                      08260000
082700                                                                  08270000
082800******************************************************************08280000
082900* WRITE OUTPUT RECORD                                             08290000
083000******************************************************************08300000
083100 W1000-WRITE.                                                     08310000
083200                                                                  08320000
083300     WRITE EXTR-REC FROM TF058-EXTRACT-REC.                       08330003
083400                                                                  08340000
083500     ADD 1 TO PA-WRITTEN.                                         08350000
083600                                                                  08360000
083700******************************************************************08370000
083800* ABEND ROUTINE                                                   08380000
083900******************************************************************08390000
084000 Z1000-ABEND.                                                     08400000
084100                                                                  08410000
084200     PERFORM Z9000-END-PROC.                                      08420000
084300                                                                  08430000
084400     MOVE SQLCODE TO SQLCODE2.                                    08440000
084500     MOVE SQLERRD(3) TO SQLERRD3.                                 08450000
084600                                                                  08460000
084700     DISPLAY 'Z1000-ABEND'.                                       08470000
084800     DISPLAY '** ABEND           ** = SQLABEND'.                  08480000
084900     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          08490000
085000     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        08500000
085100     DISPLAY '** TABLES AFFECTED ** = ' PV-TABLE-NAME.            08510000
085200     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         08520000
085300     DISPLAY '** SQLCODE         ** = ' SQLCODE2.                 08530000
085400     DISPLAY '** ROWS PROCESSED  ** = ' SQLERRD3.                 08540000
085500     DISPLAY '** SQLERRM         ** = ' SQLERRM.                  08550000
085600     DISPLAY '** SQLERRMC        ** = ' SQLERRMC.                 08560000
085700                                                                  08570000
085800******************************************************************08580000
085900*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   08590000
086000*  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        08600000
086100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     08610000
086200*  FORMAT.                                                        08620000
086300******************************************************************08630000
086400     COPY DPPD004.                                                08640000
086500                                                                  08650000
086600     SET ABEND-4013-DB2-ERROR TO TRUE.                            08660000
086700                                                                  08670000
086800     CALL 'ILBOABN0' USING ABEND-CODE.                            08680000
086900                                                                  08690000
087000******************************************************************08700003
087100* Z2000-ABEND - PERFORMS A NON-SQL-ABEND                          08710003
087200******************************************************************08720003
087300 Z2000-ABEND.                                                     08730003
087400     DISPLAY '** ABEND           **'.                             08740003
087500     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          08750005
087600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        08760003
087700     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         08770005
087800     CALL 'ILBOABN0' USING ABEND-CODE.                            08780005
087900                                                                  08790003
088000******************************************************************08800000
088100* PREFORMS TASK TERMINATION PROCESSING                            08810000
088200******************************************************************08820000
088300 Z9000-END-PROC.                                                  08830000
088400                                                                  08840000
088500     CLOSE EXTR-FILE.                                             08850000
088600                                                                  08860000
088700     PERFORM Z9100-CONTROLS.                                      08870000
088800                                                                  08880000
088900******************************************************************08890000
089000* PROGRAM CONTROLS                                                08900000
089100******************************************************************08910000
089200 Z9100-CONTROLS.                                                  08920000
089300                                                                  08930000
089400     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 08940000
089500                                                                  08950000
089600     MOVE SYS-TIME (1:2) TO ST-END-HR.                            08960000
089700     MOVE SYS-TIME (3:2) TO ST-END-MN.                            08970000
089800                                                                  08980000
089900     DISPLAY '                    '.                              08990000
090000     DISPLAY '**********************'.                            09000000
090100     DISPLAY '   TFKUT004 CONTROLS  '.                            09010000
090200     DISPLAY '**********************'.                            09020000
090300     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         09030000
090400     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          09040000
090500     DISPLAY 'END TIME  = ' ST-END-TIME.                          09050000
090600     DISPLAY '======================'.                            09060000
090700     DISPLAY 'CNTL CARD: ' CC-DATE.                               09070000
090800     DISPLAY '  BEG DTE: ' WS-BEG-DATE.                           09080000
090900     DISPLAY '  END DTE: ' WS-END-DATE.                           09090000
091000     DISPLAY '            '.                                      09100000
091100     DISPLAY 'CALL BACK = ' PA-CALL-BCK-READ.                     09110000
091200     DISPLAY '                    '.                              09120000
091300     DISPLAY 'SALE      = ' PA-SALE.                              09130000
091400     DISPLAY '  DUMMY   = ' PA-SALE-DUMMY.                        09140000
091500     DISPLAY '            '.                                      09150000
091600     DISPLAY 'RETURN    = ' PA-RETURN.                            09160000
091700     DISPLAY '  VALID   = ' PA-RETURN-VALID.                      09170000
091800     DISPLAY '  DUMMY   = ' PA-RETURN-DUMMY.                      09180000
091900     DISPLAY '                    '.                              09190000
092000     DISPLAY 'WRITTEN   = ' PA-WRITTEN.                           09200000
092100     DISPLAY '                    '.                              09210000
092200                                                                  09220000
