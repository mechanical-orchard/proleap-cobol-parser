000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    PCKCS746.                                         00040000
000500 AUTHOR.        DEANNA BRANTNER.                                  00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  JUNE, 2001.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900*---------------------------------------------------------------* 00090000
001000*    S746 - IN-TRANSIT PROJECT  - SKU STORE LIST SCREEN           00100000
001100*---------------------------------------------------------------* 00110000
001110* DATE  11/04/2021                                                00111072
001120*            - CHANGE CALL OF 'DPKUT100' TO                     * 00112072
001130*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00113072
001140*              MAKING THE CALL DYNAMIC VS STATIC                * 00114072
001150*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00115073
001160*-----------------------------------------------------------------00116072
1122RM* DATE  11/07/2022                                              * 00117074
1122RM*            - ADD COPYBOOK DPWS930                             * 00118074
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00119074
1122RM*              DYNAMIC.                                         * 00119174
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00119274
1122RM*-----------------------------------------------------------------00119374
001200 ENVIRONMENT DIVISION.                                            00120000
001300 DATA DIVISION.                                                   00130000
001400                                                                  00140000
001500 WORKING-STORAGE SECTION.                                         00150000
001600 01  DK-DB2-KEYS.                                                 00160000
001700     05  DK-OPER-UNT-ID                 PIC S9(04)  VALUE ZERO    00170000
001800                                                    COMP.         00180000
001900     05  DK-SKU                         PIC S9(08)V VALUE ZERO    00190000
002000                                                    COMP-3.       00200000
002100     05  DK-UPC-ID                      PIC S9(09)  VALUE ZERO    00210000
002200                                                    COMP.         00220000
002210     05  DK-ITM-NBR                     PIC S9(15)V VALUE ZERO    00221000
002220                                                    COMP-3.       00222000
002230     05  DK-STORE-NBR                   PIC S9(04)  VALUE ZERO    00223000
002240                                                    COMP.         00224000
002294                                                                  00229413
002300 01  PC-PROGRAM-CONSTANTS.                                        00230000
002400     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'PC746A  '.  00240000
002500     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'PCKM746'.   00250000
002600     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'PCKCS746'.  00260000
002700     05  PC-XL001-VSM-PGM          PIC  X(08)  VALUE 'XLKUT001'.  00270000
002701     05  PC-LOCATION-MODULE        PIC  X(08)  VALUE 'XLKUT071'.  00270170
002710     05  PC-XMKCS001               PIC  X(08)  VALUE 'XMKCS001'.  00271037
002800     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00280000
002900     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00290000
003000     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00300000
003100     05  PC-LIST-FORMAT            PIC  X(01)  VALUE '2'.         00310000
003200     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +10          00320000
003300                                               COMP SYNC.         00330000
003400     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00340000
003500                                               COMP SYNC.         00350000
003600     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00360000
003700                                               COMP-3.            00370000
003800     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00380000
003900                                               COMP SYNC.         00390000
004000     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00400000
004100                                               COMP-3.            00410000
004200     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00420000
004300     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00430000
004400     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00440000
004410     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00441000
004420     05  PC-SLASH                  PIC  X(01)  VALUE '/'.         00442000
004430     05  PC-ZERO                   PIC S9(04)  VALUE ZEROES       00443000
004440                                               COMP.              00444000
004450     05  PC-01                     PIC  X(02)  VALUE '01'.        00445000
004460     05  PC-A                      PIC  X(01)  VALUE 'A'.         00446000
004470     05  PC-UN                     PIC  X(02)  VALUE 'UN'.        00447000
004480     05  PC-SH                     PIC  X(02)  VALUE 'SH'.        00448000
004490     05  PC-RA                     PIC  X(02)  VALUE 'RA'.        00449000
004500     05  PC-AR                     PIC  X(02)  VALUE 'AR'.        00450000
004600     05  PC-VA                     PIC  X(02)  VALUE 'VA'.        00460000
004700     05  PC-OA                     PIC  X(02)  VALUE 'OA'.        00470000
004800     05  PC-ST                     PIC  X(02)  VALUE 'ST'.        00480000
004900     05  PC-IT                     PIC  X(02)  VALUE 'IT'.        00490000
004910     05  PC-UNLOAD                 PIC  X(10)  VALUE 'UNLOAD STR'.00491000
004920     05  PC-SHIPPD                 PIC  X(10)  VALUE 'SHIPPD STR'.00492000
004930     05  PC-RECEIPT                PIC  X(10)  VALUE 'RECEPT ADJ'.00493000
004940     05  PC-ACTUAL                 PIC  X(10)  VALUE 'ACTL RECPT'.00494000
004950     05  PC-VERIFN                 PIC  X(10)  VALUE 'VERIFN ADJ'.00495000
004960     05  PC-ONHAND                 PIC  X(10)  VALUE 'ONHAND ADJ'.00496000
004970     05  PC-SKUTRN                 PIC  X(10)  VALUE 'SKU TRN AD'.00497000
004980     05  PC-INTRNS                 PIC  X(10)  VALUE 'IN-TRANSIT'.00498000
004990*                                                                 00499000
005000*----------------------------------------------------------------*00500000
005100*  SYSTEM MESSAGES                                               *00510000
005200*----------------------------------------------------------------*00520000
005300*   00005 = INVALID VALUE                                        *00530000
005400*   00007 = REQUIRED ENTRY                                        00540000
005500*   00008 = MUST BE NUMERIC                                      *00550000
005600*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00560000
005700*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00570000
005800*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00580000
005900*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00590000
006000*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00600000
006100*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00610000
006200*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00620000
006300*   00069 - TOP OF LIST                                          *00630000
006400*   00070 - BOTTOM OF LIST                                       *00640000
006500*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00650000
006600*   00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL*00660000
006700*   00279 - MORE ITEMS TO DISPLAY                                *00670000
006800*   00840 - YOU ARE NOT AUTHORIZED TO VIEW THIS INFORMATION      *00680000
006900*   00984 - DATABASE IS BUSY, TRY AGAIN IN A FEW MINUTES         *00690000
007000*   02227 = APPLICATION UNAVAILABLE AT THIS TIME                 *00700000
007100*   99901 = INVALID COMMAND WAS ENTERED                          *00710000
007200*----------------------------------------------------------------*00720000
007300     05  PC-TSYMSG-NUMBERS.                                       00730000
007400         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00740000
007500         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00750000
007600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00760000
007700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00770000
007800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00780000
007900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00790000
008000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00800000
008100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00810000
008200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00820000
008300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00830000
008400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00840000
008500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00850000
008600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00860000
008700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00870000
008800         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00880000
008900         10  PC-TSYMSG-00746            PIC  9(05)  VALUE 00746.  00890000
009000         10  PC-TSYMSG-00840            PIC  9(05)  VALUE 00840.  00900000
009100         10  PC-TSYMSG-01563            PIC  9(05)  VALUE 01563.  00910000
009200         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  00920000
009300         10  PC-TSYMSG-02227            PIC  9(05)  VALUE 02227.  00930000
009400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00940000
009500*                                                                 00950000
009600 01  PS-PROGRAM-SWITCHES.                                         00960000
009700     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    00970000
009800         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    00980000
009900         88  PS-BLOCK-ERROR                         VALUE 'N'.    00990000
010000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01000000
010100         88  PS-NO-ERROR                            VALUE 'Y'.    01010000
010200         88  PS-ERROR                               VALUE 'N'.    01020000
010300     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE  'N'.   01030000
010400         88  PS-SOFT-ABORT-ERROR                    VALUE  'Y'.   01040000
010500         88  PS-NO-SOFT-ABORT-ERROR                 VALUE  'N'.   01050000
010600     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01060000
010700         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01070000
010800         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01080000
010900     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01090000
011000         88  PS-DONE                                VALUE 'Y'.    01100000
011100         88  PS-NOT-DONE                            VALUE 'N'.    01110000
011200     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   01120000
011300         88  PS-LIST-END                            VALUE  'Y'.   01130000
011400         88  PS-NO-LIST-END                         VALUE  'N'.   01140000
011500     05  PS-ACCESS-SW                   PIC  X(01)  VALUE  'N'.   01150000
011600         88  PS-ACCESS-ALLOWED                      VALUE  'Y'.   01160000
011700         88  PS-ACCESS-NOT-ALLOWED                  VALUE  'N'.   01170000
012100*                                                                 01210000
012200 01  PV-PROGRAM-VARIABLES.                                        01220000
012300     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01230000
012400                                                     COMP SYNC.   01240000
012500     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01250000
012600     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01260000
012700     05  PV-RACF-ERROR-CODE             PIC  9(04)  VALUE ZEROES. 01270000
012800     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01280000
012900                                        COMP SYNC.                01290000
013000     05  PV-SUB                         PIC S9(04)  VALUE +0      01300000
013100                                                    COMP SYNC.    01310000
013200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01320000
013300                                                    COMP SYNC.    01330000
013400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01340000
013500                                                    COMP-3.       01350000
013600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01360000
013700                                                    COMP-3.       01370000
013800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01380000
013900                                                    COMP-3.       01390000
014000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01400000
014100                                                    COMP-3.       01410000
014200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01420000
014300                                                    COMP-3.       01430000
014400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01440000
014500                                                    COMP-3.       01450000
014600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01460000
014700                                                    COMP-3.       01470000
014800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01480000
014900                                                    COMP SYNC.    01490000
015000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01500000
015100                                                    COMP SYNC.    01510000
015200     05  PV-ITEM                        PIC S9(04)  VALUE +0      01520000
015300                                                    COMP SYNC.    01530000
015400     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01540000
015500                                                    COMP SYNC.    01550000
015600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01560000
015700                                                    COMP SYNC.    01570000
015800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01580000
015900                                                    COMP SYNC.    01590000
016000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01600000
016100                                                    COMP SYNC.    01610000
016200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01620000
016300                                                    COMP SYNC.    01630000
016400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01640000
016500                                                    COMP SYNC.    01650000
016600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01660000
016700                                                    COMP SYNC.    01670000
016800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01680000
016900                                                    COMP SYNC.    01690000
017000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01700000
017100                                                    COMP SYNC.    01710000
017200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01720000
017300                                                    COMP SYNC.    01730000
017400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01740000
017500                                                    COMP SYNC.    01750000
017600     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01760000
017700                                                    COMP SYNC.    01770000
017800     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01780000
017900                                                    COMP SYNC.    01790000
018000     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      01800000
018100                                                    COMP.         01810000
018200     05  PV-NULL-IND-2                  PIC S9(04)  VALUE +0      01820000
018300                                                    COMP.         01830000
018400     05  PV-NULL-IND-3                  PIC S9(04)  VALUE +0      01840000
018500                                                    COMP.         01850000
018600     05  PV-SOFT-ABORT-MSG.                                       01860000
018700         10  FILLER            PIC X(12) VALUE ' PCKCS746 - '.    01870000
018800         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01880000
018900         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01890000
019000         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01900000
019100         10  PV-SOFT-PARAGRAPH PIC X(30).                         01910000
019200     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01920000
019300                                                     COMP SYNC.   01930000
019400     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 01940000
019500     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 01950000
019600     05  PV-CICS-MSG-HOLD.                                        01960000
019700         10  FILLER                      PIC  X(01)  VALUE SPACE. 01970000
019800         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 01980000
019900     05  PV-CICS-MSG-HOLD2.                                       01990000
020000         10  FILLER                      PIC  X(01)  VALUE SPACE. 02000000
020100         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 02010000
020200                                                                  02020000
020300     05  PV-TMST                 PIC X(26)   VALUE SPACES.        02030000
020400     05  PV-TMST-R REDEFINES  PV-TMST.                            02040000
020500         10   PV-TMST-CC                PIC X(02).                02050042
020600         10   PV-TMST-YY                PIC X(02).                02060071
020620         10   FILLER                    PIC X(01).                02062042
020700         10   PV-TMST-MM                PIC X(02).                02070000
020800         10   FILLER                    PIC X(01).                02080000
020900         10   PV-TMST-DD                PIC X(02).                02090000
021000         10   FILLER                    PIC X(01).                02100000
021100         10   PV-TMST-HRS               PIC X(02).                02110000
021200         10   FILLER                    PIC X(01).                02120000
021300         10   PV-TMST-MIN               PIC X(02).                02130000
021400         10   FILLER                    PIC X(01).                02140000
021500         10   PV-TMST-SEC               PIC X(02).                02150000
021600         10   FILLER                    PIC X(07).                02160000
021700     05  PV-DATE-DISPLAY.                                         02170000
021800         10   PV-DISPLAY-MM             PIC X(02)   VALUE SPACES. 02180000
021900         10   PV-SLASH-1                PIC X(01)   VALUE '/'.    02190000
022000         10   PV-DISPLAY-DD             PIC X(02)   VALUE SPACES. 02200000
022100         10   PV-SLASH-2                PIC X(01)   VALUE '/'.    02210000
022200         10   PV-DISPLAY-YY             PIC X(02)   VALUE SPACES. 02220042
022300     05  PV-SELECT-LIST-SEQ              PIC  X(01) VALUE SPACES. 02230000
022400     05  PV-NBR-ITEMS                    PIC  9(05) VALUE ZEROES. 02240000
022500     05  PV-SEL-TERM-ID                  PIC  X(04).              02250000
022600     05  PV-SEL-TASK-NUMBER              PIC  9(05).              02260000
022700     05  PV-SEL-SEQ                      PIC  9(01).              02270000
022800     05  PV-ONHAND-QTY                   PIC S9(07)V COMP-3.      02280000
022810     05  PV-DISPLAY-SKU                  PIC  9(08).              02281021
022811     05  PV-DISPLAY-UPC-ID               PIC  9(09).              02281121
022820     05  PV-DISPLAY-STORE                PIC  9(04).              02282021
022830     05  PV-STORE-EXPECTED               PIC S9(9) COMP.          02283021
022840     05  PV-INTRANSIT-QTY                PIC S9(9) COMP.          02284021
022850     05  PV-STORE-ON-HAND                PIC S9(9) COMP.          02285021
022900                                                                  02290000
023000******************************************************************02300000
023100**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02310000
023200**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02320000
023300**  APPLICATION-SPECIFIC COMMAREA.                              **02330000
023400******************************************************************02340000
023500 01  LQW-LIST-QUEUE-WORK-AREA.                                    02350000
023600     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02360000
023700     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           02370000
023800                                        INDEXED BY LQW-IDX.       02380000
023900         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02390000
024000         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02400000
024100         10  LQW-SELECTED-SW            PIC  X(01).               02410000
024200             88  LQW-SELECT                         VALUE 'S'.    02420000
024300             88  LQW-DESELECT                       VALUE ' '.    02430000
024400         10  LQW-ACTION                 PIC  X(03).               02440000
024500             88  LQW-DEL                            VALUE 'DEL'.  02450000
024600             88  LQW-INQ                            VALUE 'INQ'.  02460000
024700             88  LQW-UPD                            VALUE 'UPD'.  02470000
024800             88  LQW-ERR                            VALUE 'ERR'.  02480000
024900         10  LQW-STORE-NBR              PIC  9(04).               02490000
024910         10  LQW-DC-NBR                 PIC  9(04).               02491039
025000         10  LQW-STORE-NAME             PIC  X(10).               02500000
025100         10  LQW-FASH-ON-HAND           PIC S9(08).               02510039
025200         10  LQW-INTR-QTY               PIC S9(07).               02520039
025210         10  LQW-STORE-EXPECT           PIC S9(08).               02521039
025220         10  LQW-STORE-ON-HAND          PIC S9(08).               02522039
025300         10  LQW-LAST-UPDATE            PIC  X(08).               02530039
025500                                                                  02550000
025600*---------------------------------------------------------------* 02560000
025700* SELECTON QUEUE LAYOUT                                         * 02570000
025800*---------------------------------------------------------------* 02580000
025900     COPY PCWS212.                                                02590000
026050                                                                  02605005
026100*---------------------------------------------------------------* 02610005
026200*    MAP LAYOUT                                                 * 02620005
026300*---------------------------------------------------------------* 02630005
026400     COPY PCKM746.                                                02640005
026500*                                                                 02650005
026600 01  MR-OCCURS-LAYOUT                   REDEFINES  PC746AO.       02660005
026700     05  FILLER                         PIC X(165).               02670060
026800     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          02680018
026900         10  MR-SELECTL                 PIC S9(04) COMP.          02690005
027000         10  MR-SELECTA                 PIC  X(01).               02700005
027100         10  MR-SELECTC                 PIC  X(01).               02710005
027200         10  MR-SELECTH                 PIC  X(01).               02720005
027300         10  MR-SELECTI                 PIC  X(01).               02730005
027400                                                                  02740005
027500         10  MR-ACTIONL                 PIC S9(04) COMP.          02750005
027600         10  MR-ACTIONA                 PIC  X(01).               02760005
027700         10  MR-ACTIONC                 PIC  X(01).               02770005
027800         10  MR-ACTIONH                 PIC  X(01).               02780005
027900         10  MR-ACTION                  PIC  X(03).               02790005
028000                                                                  02800005
028100         10  MR-STORE-NBRL              PIC S9(04) COMP.          02810005
028200         10  MR-STORE-NBRA              PIC  X(01).               02820005
028300         10  MR-STORE-NBRC              PIC  X(01).               02830005
028400         10  MR-STORE-NBRH              PIC  X(01).               02840005
028500         10  MR-STORE-NBR               PIC  X(04).               02850005
028600                                                                  02860005
028610         10  MR-DC-NBRL                 PIC S9(04) COMP.          02861039
028620         10  MR-DC-NBRA                 PIC  X(01).               02862039
028630         10  MR-DC-NBRC                 PIC  X(01).               02863039
028640         10  MR-DC-NBRH                 PIC  X(01).               02864039
028650         10  MR-DC-NBR                  PIC  X(04).               02865039
028660                                                                  02866039
028700         10  MR-STORE-NAMEL             PIC S9(04) COMP.          02870005
028800         10  MR-STORE-NAMEA             PIC  X(01).               02880005
028900         10  MR-STORE-NAMEC             PIC  X(01).               02890005
029000         10  MR-STORE-NAMEH             PIC  X(01).               02900005
029100         10  MR-STORE-NAME              PIC  X(10).               02910005
029200                                                                  02920005
029300         10  MR-FASH-ON-HANDL           PIC S9(04) COMP.          02930018
029400         10  MR-FASH-ON-HANDA           PIC  X(01).               02940018
029500         10  MR-FASH-ON-HANDC           PIC  X(01).               02950018
029600         10  MR-FASH-ON-HANDH           PIC  X(01).               02960018
029700         10  MR-FASH-ON-HAND            PIC  X(08).               02970039
029710         10  MR-FASH-ON-HAND-X REDEFINES MR-FASH-ON-HAND.         02971018
029720             15  MR-FASH-ON-HAND-N   PIC  ZZZZZZ9-.               02972039
029730                                                                  02973005
029740         10  MR-INTR-QTYL               PIC S9(04) COMP.          02974005
029750         10  MR-INTR-QTYA               PIC  X(01).               02975005
029760         10  MR-INTR-QTYC               PIC  X(01).               02976005
029770         10  MR-INTR-QTYH               PIC  X(01).               02977005
029780         10  MR-INTR-QTY                PIC  X(07).               02978018
029790         10  MR-INTR-QTY-X REDEFINES MR-INTR-QTY.                 02979005
029800             15  MR-INTR-QTY-N       PIC  ZZZZZ9-.                02980018
029900                                                                  02990005
029910         10  MR-STR-EXPECTEDL           PIC S9(04) COMP.          02991018
029920         10  MR-STR-EXPECTEDA           PIC  X(01).               02992018
029930         10  MR-STR-EXPECTEDC           PIC  X(01).               02993018
029940         10  MR-STR-EXPECTEDH           PIC  X(01).               02994018
029950         10  MR-STR-EXPECTED            PIC  X(08).               02995039
029960         10  MR-STR-EXPECTED-X REDEFINES MR-STR-EXPECTED.         02996018
029970             15  MR-STR-EXPECTED-N      PIC  ZZZZZZ9-.            02997039
029971                                                                  02997118
029972         10  MR-STR-ON-HANDL            PIC S9(04) COMP.          02997218
029973         10  MR-STR-ON-HANDA            PIC  X(01).               02997318
029974         10  MR-STR-ON-HANDC            PIC  X(01).               02997418
029975         10  MR-STR-ON-HANDH            PIC  X(01).               02997518
029976         10  MR-STR-ON-HAND             PIC  X(08).               02997639
029977         10  MR-STR-ON-HAND-X REDEFINES MR-STR-ON-HAND.           02997718
029978             15  MR-STR-ON-HAND-N       PIC  ZZZZZZ9-.            02997839
030000                                                                  03000005
030100         10  MR-LAST-UPDATEL            PIC S9(04) COMP.          03010005
030200         10  MR-LAST-UPDATEA            PIC  X(01).               03020005
030300         10  MR-LAST-UPDATEC            PIC  X(01).               03030005
030400         10  MR-LAST-UPDATEH            PIC  X(01).               03040005
030500         10  MR-LAST-UPDATE             PIC  X(08).               03050039
030510     05  FILLER                         PIC  X(02).               03051039
030600                                                                  03060005
031400*----------------------------------------------------------------*03140005
031500*    XLKUT001 COPYBOOK                                           *03150005
031600*----------------------------------------------------------------*03160005
031700     COPY XLWS001.                                                03170005
031710                                                                  03171005
031711*----------------------------------------------------------------*03171139
031712*    XLKUT071 COPYBOOK                                           *03171239
031713*----------------------------------------------------------------*03171339
031714     COPY XLWS071.                                                03171439
031715                                                                  03171539
031716*----------------------------------------------------------------*03171639
031717*    XMKCS001 COPYBOOK                                           *03171739
031718*----------------------------------------------------------------*03171839
031719     COPY XMWS003.                                                03171939
031720                                                                  03172039
031721*---------------------------------------------------------------* 03172139
031730*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03173005
031740*---------------------------------------------------------------* 03174005
031750     COPY DPWS015.                                                03175005
031760                                                                  03176005
031770*---------------------------------------------------------------* 03177005
031780*    FUNCTION KEYS COPYBOOK.                                    * 03178005
031790*---------------------------------------------------------------* 03179005
031800     COPY DPWS016.                                                03180005
031900                                                                  03190005
032000*---------------------------------------------------------------* 03200005
032100*    NUMERIC EDIT LAYOUT.                                       * 03210005
032200*---------------------------------------------------------------* 03220005
032300     COPY DPWS010I.                                               03230005
032400                                                                  03240005
032500*---------------------------------------------------------------* 03250005
032600*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 03260005
032700*---------------------------------------------------------------* 03270005
032800     COPY DPWS030.                                                03280005
1122RM     COPY DPWS930.                                                03281074
032900                                                                  03290005
033000*---------------------------------------------------------------* 03300005
033100*    STANDARD COMMAREA.                                         * 03310005
033200*---------------------------------------------------------------* 03320005
033300     COPY DPWS020.                                                03330005
033400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03340005
033500                                                                  03350005
033600*---------------------------------------------------------------* 03360005
033700* INTER-APPLICATION COMMAREA.                                   * 03370005
033800*   PCWS210 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03380005
033900*             SPEC SCREEN.                                      * 03390005
034000*   PCWS211 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03400005
034100*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03410005
034200*---------------------------------------------------------------* 03420005
034300                                                                  03430005
034400         10  INTER-APPL-COMM-AREA       PIC X(200).               03440005
034500     COPY PCWS210.                                                03450005
034600     COPY PCWS211.                                                03460005
034700*---------------------------------------------------------------* 03470005
034800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03480005
034900*---------------------------------------------------------------* 03490005
035000         10  ASC-SPECIFIC-COMMAREA.                               03500005
035100             15  ASC-SKU                     PIC S9(08)V COMP-3.  03510005
035200             15  ASC-SKU-DESC                PIC  X(25).          03520005
035300             15  ASC-STR-NBR-X               PIC  X(04).          03530005
035400             15  ASC-STR-NBR-N REDEFINES ASC-STR-NBR-X.           03540005
035500                 20  ASC-STR-NBR             PIC  9(04).          03550005
035600             15  ASC-STR-NAME                PIC  X(20).          03560005
035700             15  ASC-UPC-ID                  PIC S9(09) COMP.     03570005
035800             15  ASC-ONHAND                  PIC S9(09).          03580005
035900             15  ASC-INTRQTY                 PIC S9(09).          03590005
036000             15  ASC-LASTUPDT                PIC  X(10).          03600005
036100             15  ASC-TYPEDESC                PIC  X(10).          03610005
036200             15  ASC-TTL-ONHAND              PIC S9(09).          03620005
036300             15  ASC-TTL-INTRNST             PIC S9(09).          03630005
036301             15  ASC-TTL-STORE-EXPECT        PIC S9(09).          03630121
036302             15  ASC-TTL-STORE-ON-HAND       PIC S9(09).          03630221
036303             15  ASC-SCREEN-DISPLAY          PIC  X(01).          03630350
036304                 88  ASC-SKU-CSR                  VALUE  'A'.     03630450
036305                 88  ASC-SKU-STR-CSR              VALUE  'B'.     03630550
036306                 88  ASC-DC-SKU-CSR               VALUE  'C'.     03630650
036307                 88  ASC-DC-SKU-STR-CSR           VALUE  'D'.     03630750
036400             15  FILLER                      PIC  X(125).         03640005
036500*-----------------------------------------------------------------03650005
036600             15  ASC-BLK-SUB                  PIC S9(04) COMP     03660005
036700                                                         SYNC.    03670005
036800             15  ASC-ITEM-SUB                 PIC S9(04) COMP     03680005
036900                                                         SYNC.    03690005
037000             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  03700005
037100             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  03710005
037200             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  03720005
037300             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  03730005
037400             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  03740005
037500             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     03750005
037600                                                         SYNC.    03760005
037700             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  03770005
037800             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  03780005
037900             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         03790005
038000                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03800005
038100                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03810005
038200             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03820005
038300                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03830005
038400                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03840005
038500             15  ASC-LIST-QUEUE-NAME.                             03850005
038600                 20  ASC-LIST-TERM-ID         PIC  X(04).         03860005
038700                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03870005
038800                 20  ASC-LIST-SEQ             PIC  9(01).         03880005
038900                                                                  03890005
039000             15  ASC-START-ITEM-REQUEST.                          03900005
039100                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         03910005
039200                                                                  03920005
039300             15  ASC-SEL-SUB                  PIC S9(4) COMP.     03930005
039400             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     03940005
039500             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          03950005
039600                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03960005
039700             15  ASC-SEL-QUEUE-NAME.                              03970005
039800                 20  ASC-SEL-TERM-ID          PIC  X(04).         03980005
039900                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03990005
040000                 20  ASC-SEL-SEQ              PIC  9(01).         04000005
040100             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  04010005
040200                                                                  04020005
040300*-----------------------------------------------------------------04030005
040400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04040005
040500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04050005
040600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04060005
040700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04070005
040800                                                                  04080005
040900                 20  ASC-ITEM-ARRAY.                              04090005
041000                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        04100005
041100                         30  ASC-LIST-ITEM-NUMBER                 04110005
041200                                                     PIC S9(09)   04120005
041300                                                     COMP-3.      04130005
041400                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04140005
041500                             88  ASC-VALID-SELECT    VALUE ' '    04150005
041600                                                           'S'    04160005
041700                                                           'B'    04170005
041800                                                           'E'.   04180005
041900                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04190005
042000                             88  ASC-TEMP-SELECT     VALUE 'S'.   04200005
042100                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04210005
042200                             88  ASC-TEMP-END        VALUE 'E'.   04220005
042300                         30  ASC-SELECTED-SW         PIC  X(01).  04230005
042400                             88  ASC-NO-SELECT       VALUE ' '.   04240005
042500                             88  ASC-SELECT          VALUE 'S'.   04250005
042600                             88  ASC-BEGIN           VALUE 'B'.   04260005
042700                             88  ASC-END             VALUE 'E'.   04270005
042800                         30  ASC-ACTION              PIC  X(03).  04280005
042900                         30  ASC-STORE-NBR           PIC  9(04).  04290005
042910                         30  ASC-DC-NBR              PIC  9(04).  04291039
043000                         30  ASC-STORE-NAME          PIC  X(10).  04300005
043100                         30  ASC-FASH-ON-HAND        PIC S9(08).  04310039
043200                         30  ASC-INTR-QTY            PIC S9(07).  04320039
043210                         30  ASC-STORE-EXPECT        PIC S9(08).  04321039
043220                         30  ASC-STORE-ON-HAND       PIC S9(08).  04322039
043300                         30  ASC-LAST-UPDT           PIC  X(08).  04330039
043500                                                                  04350005
043600*---------------------------------------------------------------* 04360005
043700*    ABEND PROCESSING COPYBOOK.                                 * 04370005
043800*---------------------------------------------------------------* 04380005
043900     COPY DPWS013.                                                04390005
044000                                                                  04400005
044100*---------------------------------------------------------------* 04410005
044200*    PCT_TRN_CLSN_BAL                                             04420005
044300*---------------------------------------------------------------* 04430005
044400     EXEC SQL                                                     04440005
044500          INCLUDE PCT00014                                        04450005
044600     END-EXEC.                                                    04460005
044700                                                                  04470005
044800*---------------------------------------------------------------* 04480005
044900*    PCT_TRN_CLSN_DTL -                                         * 04490005
045000*---------------------------------------------------------------* 04500005
045100     EXEC SQL                                                     04510005
045200          INCLUDE PCT00015                                        04520005
045300     END-EXEC.                                                    04530005
045400                                                                  04540005
045410*---------------------------------------------------------------* 04541044
045420*    XLT_DC_LOC_ASGMT -                                         * 04542044
045430*---------------------------------------------------------------* 04543044
045440     EXEC SQL                                                     04544044
045450          INCLUDE XLT00014                                        04545044
045460     END-EXEC.                                                    04546044
045470                                                                  04547044
045500*---------------------------------------------------------------* 04550005
045510* THIS TABLE WILL BE REPLACED WITH A DOMAIN VERSION BY FASHION   *04551036
045520* SALES IN THE FUTURE.  THIS PROGRAM WILL USE CALL MODULE       * 04552036
045530* XMKCS001 TO GET THE TOTAL ON HAND QUANTITY FOR THE HEADER     * 04553036
045540* PART OF THE SCREEN.  9/2004                                     04554036
045600*    TSKST TABLE                                                  04560005
045700*---------------------------------------------------------------* 04570005
045800     EXEC SQL                                                     04580036
045900          INCLUDE TSKST                                           04590036
046000     END-EXEC.                                                    04600036
046010                                                                  04601008
046900*---------------------------------------------------------------* 04690005
047000*    DB2 AREA FOR COMMUNICATIONS                                * 04700005
047100*---------------------------------------------------------------* 04710005
047200     EXEC SQL                                                     04720005
047300          INCLUDE SQLCA                                           04730005
047400     END-EXEC.                                                    04740005
047500                                                                  04750005
047600*---------------------------------------------------------------* 04760005
047700*    SKU WITH NO STORE CURSOR IN LOC NBR ORDER                    04770049
047800*---------------------------------------------------------------* 04780005
047900     EXEC SQL                                                     04790005
048000          DECLARE SKU-CSR CURSOR FOR                              04800005
048010              SELECT                                              04801021
048020                      DISTINCT(A.LOC_NBR)                         04802031
048030                     ,A.LAST_UPD_DTE                              04803031
048040                     ,C.DC_NBR                                    04804044
048050                FROM  PCT_TRN_CLSN_BAL A                          04805021
048060                    , XLT_DC_LOC_ASGMT C                          04806044
048070               WHERE  A.INTR_UPC_ID       =  :DK-UPC-ID           04807021
048080                 AND  A.LOC_NBR           =  C.LOC_NBR            04808044
048081                 AND  A.LAST_UPD_DTE  IN                          04808131
048082                      (SELECT MAX(B.LAST_UPD_DTE)                 04808231
048083                         FROM PCT_TRN_CLSN_BAL B                  04808332
048084                        WHERE A.INTR_UPC_ID  =  B.INTR_UPC_ID     04808431
048085                          AND A.LOC_NBR      =  B.LOC_NBR)        04808531
048086                 AND  C.EFF_BEG_DTE  IN                           04808644
048087                      (SELECT MAX(D.EFF_BEG_DTE)                  04808744
048088                         FROM XLT_DC_LOC_ASGMT D                  04808844
048090                        WHERE C.LOC_NBR = D.LOC_NBR               04809070
048091                          AND EFF_BEG_DTE <= CURRENT DATE)        04809170
048092               GROUP BY A.LOC_NBR                                 04809221
048093                       ,A.LAST_UPD_DTE                            04809331
048094                       ,C.DC_NBR                                  04809446
048095               ORDER BY A.LOC_NBR                                 04809521
048096     END-EXEC.                                                    04809632
048097                                                                  04809731
050100                                                                  05010005
050110*---------------------------------------------------------------* 05011021
050120*    SKU WITH WITH STORE CURSOR  IN LOC NBR ORDER                 05012049
050130*---------------------------------------------------------------* 05013021
050140     EXEC SQL                                                     05014021
050150          DECLARE SKU-STR-CSR CURSOR FOR                          05015021
050160              SELECT                                              05016021
050170                      A.LOC_NBR                                   05017021
050180                     ,A.LAST_UPD_DTE                              05018031
050190                     ,C.DC_NBR                                    05019048
050191                FROM  PCT_TRN_CLSN_BAL A                          05019121
050192                    , XLT_DC_LOC_ASGMT C                          05019248
050193               WHERE  A.INTR_UPC_ID       =  :DK-UPC-ID           05019321
050194                 AND  A.LOC_NBR           =  :DK-STORE-NBR        05019421
050195                 AND  A.LOC_NBR           =  C.LOC_NBR            05019548
050196                 AND  A.LAST_UPD_DTE  IN                          05019631
050197                      (SELECT MAX(B.LAST_UPD_DTE)                 05019731
050198                         FROM PCT_TRN_CLSN_BAL B                  05019832
050199                        WHERE A.INTR_UPC_ID  =  B.INTR_UPC_ID     05019931
050200                          AND A.LOC_NBR      =  B.LOC_NBR)        05020031
050201                 AND  C.EFF_BEG_DTE  IN                           05020148
050202                      (SELECT MAX(D.EFF_BEG_DTE)                  05020248
050203                         FROM XLT_DC_LOC_ASGMT D                  05020348
050205                        WHERE C.LOC_NBR = D.LOC_NBR               05020570
050206                          AND EFF_BEG_DTE <= CURRENT DATE)        05020670
050207               GROUP BY A.LOC_NBR                                 05020721
050208                       ,A.LAST_UPD_DTE                            05020831
050209                       ,C.DC_NBR                                  05020948
050210               ORDER BY A.LOC_NBR                                 05021021
050211     END-EXEC.                                                    05021121
050212                                                                  05021221
050213*---------------------------------------------------------------* 05021349
050214*    SKU WITH NO STORE CURSOR IN DC NBR ORDER                     05021449
050215*---------------------------------------------------------------* 05021549
050216     EXEC SQL                                                     05021649
050217          DECLARE DC-SKU-CSR CURSOR FOR                           05021749
050218              SELECT                                              05021849
050219                      DISTINCT(A.LOC_NBR)                         05021949
050220                     ,A.LAST_UPD_DTE                              05022049
050221                     ,C.DC_NBR                                    05022149
050222                FROM  PCT_TRN_CLSN_BAL A                          05022249
050223                    , XLT_DC_LOC_ASGMT C                          05022349
050224               WHERE  A.INTR_UPC_ID       =  :DK-UPC-ID           05022449
050225                 AND  A.LOC_NBR           =  C.LOC_NBR            05022549
050226                 AND  A.LAST_UPD_DTE  IN                          05022649
050227                      (SELECT MAX(B.LAST_UPD_DTE)                 05022749
050228                         FROM PCT_TRN_CLSN_BAL B                  05022849
050229                        WHERE A.INTR_UPC_ID  =  B.INTR_UPC_ID     05022949
050230                          AND A.LOC_NBR      =  B.LOC_NBR)        05023049
050231                 AND  C.EFF_BEG_DTE  IN                           05023149
050232                      (SELECT MAX(D.EFF_BEG_DTE)                  05023249
050233                         FROM XLT_DC_LOC_ASGMT D                  05023349
050235                        WHERE C.LOC_NBR    = D.LOC_NBR            05023570
050236                          AND EFF_BEG_DTE <= CURRENT DATE)        05023670
050237               GROUP BY C.DC_NBR                                  05023749
050238                       ,A.LOC_NBR                                 05023849
050239                       ,A.LAST_UPD_DTE                            05023949
050240               ORDER BY C.DC_NBR                                  05024049
050241                      , A.LOC_NBR                                 05024149
050242     END-EXEC.                                                    05024249
050243                                                                  05024349
050244                                                                  05024449
050245*---------------------------------------------------------------* 05024549
050246*    SKU WITH WITH STORE CURSOR IN DC NBR ORDER                   05024649
050247*---------------------------------------------------------------* 05024749
050248     EXEC SQL                                                     05024849
050249          DECLARE DC-SKU-STR-CSR CURSOR FOR                       05024949
050250              SELECT                                              05025049
050251                      A.LOC_NBR                                   05025149
050252                     ,A.LAST_UPD_DTE                              05025249
050253                     ,C.DC_NBR                                    05025349
050254                FROM  PCT_TRN_CLSN_BAL A                          05025449
050255                    , XLT_DC_LOC_ASGMT C                          05025549
050256               WHERE  A.INTR_UPC_ID       =  :DK-UPC-ID           05025649
050257                 AND  A.LOC_NBR           =  :DK-STORE-NBR        05025749
050258                 AND  A.LOC_NBR           =  C.LOC_NBR            05025849
050259                 AND  A.LAST_UPD_DTE  IN                          05025949
050260                      (SELECT MAX(B.LAST_UPD_DTE)                 05026049
050261                         FROM PCT_TRN_CLSN_BAL B                  05026149
050262                        WHERE A.INTR_UPC_ID  =  B.INTR_UPC_ID     05026249
050263                          AND A.LOC_NBR      =  B.LOC_NBR)        05026349
050264                 AND  C.EFF_BEG_DTE  IN                           05026449
050265                      (SELECT MAX(D.EFF_BEG_DTE)                  05026549
050266                         FROM XLT_DC_LOC_ASGMT D                  05026649
050268                        WHERE C.LOC_NBR    = D.LOC_NBR            05026870
050269                          AND EFF_BEG_DTE <= CURRENT DATE)        05026970
050270               GROUP BY C.DC_NBR                                  05027049
050271                       ,A.LOC_NBR                                 05027149
050272                       ,A.LAST_UPD_DTE                            05027249
050273               ORDER BY C.DC_NBR                                  05027349
050274                       ,A.LOC_NBR                                 05027449
050275     END-EXEC.                                                    05027549
050276                                                                  05027649
050280*-----------------------------------------------------------------05028049
050300 LINKAGE SECTION.                                                 05030005
050400                                                                  05040005
050500 01  DFHCOMMAREA.                                                 05050005
050600     05  FILLER                         OCCURS  1 TO 4072 TIMES   05060005
050700                                        DEPENDING ON EIBCALEN.    05070005
050800         10  FILLER                     PIC X.                    05080005
050900                                                                  05090005
051000                                                                  05100005
051100 PROCEDURE DIVISION.                                              05110005
051200******************************************************************05120005
051300**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05130005
051400**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05140005
051500**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05150005
051600******************************************************************05160005
051700 0000-MAIN-MODULE.                                                05170005
051800     INITIALIZE DP030-CICS-API-FIELDS.                            05180005
051900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05190005
052000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05200005
052100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05210005
052200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05220005
052300     MOVE LENGTH OF PC746AI        TO DP030-MAP-LENGTH (1).       05230005
052400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05240005
052500     PERFORM 0001-CALL-CICS-ARCH-API.                             05250005
052600*                                                                 05260005
052700     PERFORM 1000-CONTROL-PROCESSING                              05270005
052800*                                                                 05280005
052900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05290005
053000     PERFORM 0001-CALL-CICS-ARCH-API.                             05300005
053100                                                                  05310005
053200******************************************************************05320005
053300**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05330005
053400**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05340005
053500******************************************************************05350005
053600 0001-CALL-CICS-ARCH-API.                                         05360005
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               05370074
1122RM     CALL DP930-CICS-ARCH-API                                     05371074
1122RM                     USING DFHEIBLK                               05372074
053800                           DFHCOMMAREA                            05380005
053900                           DP030-CICS-API-FIELDS                  05390005
054000                           DP020-STANDARD-COMMAREA                05400005
054100                           PC746AI.                               05410005
054200*                                                                 05420005
054300     IF  DP030-RC-CALL-SUCCESSFUL                                 05430005
054400         CONTINUE                                                 05440005
054500     ELSE                                                         05450005
054600         SET DP013-NO-ROLLBACK                                    05460005
054700             DP013-XCTL-DISPLAY-RESTART                           05470005
054800             DP013-CICS-ABEND      TO TRUE                        05480005
054900         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        05490005
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX05500074
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      05510074
1122rm         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05511074
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05512074
055200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05520005
055300         PERFORM DP013-0000-PROCESS-ABEND                         05530005
055400     END-IF.                                                      05540005
055500                                                                  05550005
055600*----------------------------------------------------------------*05560005
055700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05570005
055800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05580005
055900*                                                                *05590005
056000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05600005
056100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05610005
056200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05620005
056300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05630005
056400*----------------------------------------------------------------*05640005
056500 1000-CONTROL-PROCESSING.                                         05650005
056600                                                                  05660005
056700     EVALUATE TRUE                                                05670005
056800         WHEN DP020-NEXT-ACT-INITIAL                              05680005
056900             INITIALIZE ASC-SPECIFIC-COMMAREA                     05690005
057000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05700005
057100                                      ASC-SEL-TERM-ID             05710005
057200             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   05720005
057300                                           ASC-SEL-TASK-NUMBER    05730005
057400             MOVE PC-LIST-QUEUE-SEQ  TO ASC-LIST-SEQ              05740005
057500             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05750005
057600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05760005
057700***-----$TEMPLATE NOTE$-------------------------------------------05770005
057800*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05780005
057900*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05790005
058000*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05800005
058100***---------------------------------------------------------------05810005
058200             IF  PS-COMMAREA-NOT-VALID                            05820005
058300                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            05830005
058400             ELSE                                                 05840005
058410                 MOVE SPACE TO ASC-SCREEN-DISPLAY                 05841052
058420                 IF ASC-SKU     > ZERO                            05842052
058430                    IF ASC-STR-NBR = ZERO                         05843052
058440                        SET ASC-SKU-CSR  TO TRUE                  05844052
058450                    ELSE                                          05845052
058460                        SET ASC-SKU-STR-CSR  TO TRUE              05846052
058461                        MOVE ASC-STR-NBR TO DK-STORE-NBR          05846161
058470                    END-IF                                        05847052
058480                 END-IF                                           05848052
058500                 PERFORM 4000-BUILD-INITIAL-PANEL                 05850005
058600             END-IF                                               05860005
058700                                                                  05870005
058800         WHEN DP020-NEXT-ACT-READ-MAP                             05880005
058900             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05890005
059000             PERFORM 2000-PROCESS-PANEL                           05900005
059100                                                                  05910005
059200         WHEN DP020-NEXT-ACT-RETURN                               05920005
059300             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05930005
059400             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               05940005
059500             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05950005
059600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05960005
059700                                                                  05970005
059800         WHEN OTHER                                               05980005
059900             SET DP013-LOGIC-ABEND TO TRUE                        05990005
060000             SET DP013-NO-ROLLBACK TO TRUE                        06000005
060100             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    06010005
060200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06020005
060300                                   TO DP013-MESSAGE-TEXT(1)       06030005
060400             PERFORM DP013-0000-PROCESS-ABEND                     06040005
060500     END-EVALUATE.                                                06050005
060600                                                                  06060005
060700*----------------------------------------------------------------*06070005
060800* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06080005
060900* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06090005
061000*----------------------------------------------------------------*06100005
061100 1100-PROCESS-INTER-APPL-COMM.                                    06110005
061200                                                                  06120005
061300     SET PS-COMMAREA-VALID         TO TRUE.                       06130005
061400     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06140005
061500                                                                  06150005
061600     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          06160005
061700         MOVE PC210-SKU               TO ASC-SKU                  06170005
061800                                         DK-SKU                   06180005
061900         MOVE PC210-STORE-NBR         TO ASC-STR-NBR              06190005
062000                                         DK-STORE-NBR             06200005
062200         MOVE PC210-UPC-ID            TO ASC-UPC-ID               06220005
062300                                         DK-UPC-ID                06230005
062400     ELSE                                                         06240005
062500         MOVE PC211-STORE-NBR         TO ASC-STR-NBR              06250005
062600                                         DK-STORE-NBR             06260005
062800         MOVE PC211-SKU               TO ASC-SKU                  06280005
062900                                         DK-SKU                   06290005
063200     END-IF.                                                      06320005
063300                                                                  06330005
063400*-----------------------------------------------------------------06340005
063500 1120-PREPARE-LIST-ENTRY.                                         06350005
063600                                                                  06360005
063700     MOVE PC212-MAX-ITEMS          TO ASC-SEL-SUB.                06370005
063800     MOVE ZERO                     TO ASC-SEL-ITEM.               06380005
063900     PERFORM 1130-GET-NEXT-RECORD.                                06390005
064000                                                                  06400005
064100*-----------------------------------------------------------------06410005
064200*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*06420005
064300*-----------------------------------------------------------------06430005
064400 1130-GET-NEXT-RECORD.                                            06440005
064500                                                                  06450005
064600     ADD +1                       TO ASC-SEL-SUB.                 06460005
064700                                                                  06470005
064800     IF  ASC-SEL-SUB > PC212-MAX-ITEMS                            06480005
064900         ADD +1                   TO ASC-SEL-ITEM                 06490005
065000         MOVE +1                  TO ASC-SEL-SUB                  06500005
065100     END-IF.                                                      06510005
065200                                                                  06520005
065300     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                06530005
065400         PERFORM 9100-READ-SEL-QUEUE                              06540005
065500         IF  PC212-ITEM (ASC-SEL-SUB) > ZERO                      06550005
065600             MOVE PC212-STORE-NBR (ASC-SEL-SUB) TO ASC-STR-NBR    06560005
065700             MOVE PC212-STORE-NAME (ASC-SEL-SUB)                  06570005
065800                                               TO ASC-STR-NAME    06580005
065900             MOVE PC212-FASH-ON-HAND (ASC-SEL-SUB)                06590021
065910                                              TO ASC-ONHAND       06591021
066000             MOVE PC212-INTR-QTY (ASC-SEL-SUB) TO ASC-INTRQTY     06600005
066100             MOVE PC212-LAST-UPDT (ASC-SEL-SUB)  TO ASC-LASTUPDT  06610005
066300             SET PC212-INQ (ASC-SEL-SUB) TO TRUE                  06630005
066400             PERFORM 9200-REWRITE-SEL-QUEUE                       06640005
066500         ELSE                                                     06650005
066600             SUBTRACT +1 FROM ASC-SEL-SUB                         06660005
066700             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             06670005
066800             SET DP020-MSG-INFORMATIONAL                          06680005
066900                 PS-LIST-END             TO TRUE                  06690005
067000         END-IF                                                   06700005
067100     ELSE                                                         06710005
067200         SUBTRACT +1 FROM ASC-SEL-ITEM                            06720005
067300         MOVE PC212-MAX-ITEMS     TO ASC-SEL-SUB                  06730005
067400         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             06740005
067500         SET DP020-MSG-INFORMATIONAL                              06750005
067600             PS-LIST-END             TO TRUE                      06760005
067700     END-IF.                                                      06770005
067800                                                                  06780005
067900*-----------------------------------------------------------------06790005
068000*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *06800005
068100*    PROCESSED.                                                  *06810005
068200*-----------------------------------------------------------------06820005
068300 1140-GET-PREV-RECORD.                                            06830005
068400                                                                  06840005
068500     SUBTRACT +1 FROM ASC-SEL-SUB.                                06850005
068600                                                                  06860005
068700     IF  ASC-SEL-SUB < +1                                         06870005
068800         SUBTRACT +1 FROM ASC-SEL-ITEM                            06880005
068900         MOVE PC212-MAX-ITEMS     TO ASC-SEL-SUB                  06890005
069000     END-IF.                                                      06900005
069100                                                                  06910005
069200     IF  ASC-SEL-ITEM > ZERO                                      06920005
069300         PERFORM 9100-READ-SEL-QUEUE                              06930005
069400         MOVE PC212-STORE-NBR (ASC-SEL-SUB) TO ASC-STR-NBR        06940005
069500         MOVE PC212-STORE-NAME (ASC-SEL-SUB)  TO ASC-STR-NAME     06950005
069600         MOVE PC212-FASH-ON-HAND (ASC-SEL-SUB) TO ASC-ONHAND      06960021
069700         MOVE PC212-INTR-QTY (ASC-SEL-SUB) TO ASC-INTRQTY         06970005
069800         MOVE PC212-LAST-UPDT (ASC-SEL-SUB)  TO ASC-LASTUPDT      06980005
070000         SET PC212-INQ (ASC-SEL-SUB) TO TRUE                      07000005
070100         PERFORM 9200-REWRITE-SEL-QUEUE                           07010005
070200     ELSE                                                         07020005
070300         MOVE +1                  TO ASC-SEL-ITEM                 07030005
070400                                     ASC-SEL-SUB                  07040005
070500         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             07050005
070600         SET DP020-MSG-INFORMATIONAL                              07060005
070700             PS-LIST-END             TO TRUE                      07070005
070800     END-IF.                                                      07080005
070900                                                                  07090005
071000*----------------------------------------------------------------*07100005
071100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07110005
071200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07120005
071300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07130005
071400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07140005
071500* FUNCTION KEYS CAN GET THIS FAR.                                *07150005
071600*----------------------------------------------------------------*07160005
071700 2000-PROCESS-PANEL.                                              07170005
071800     EVALUATE TRUE                                                07180005
071900         WHEN DP020-SRC-AID = DP016-CLEAR                         07190005
072000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07200005
072100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07210005
072200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07220005
072300                                                                  07230005
072400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07240005
072500             PERFORM 2050-DELETE-LIST-QUEUE                       07250005
072600             PERFORM 4000-BUILD-INITIAL-PANEL                     07260005
072700                                                                  07270005
072800         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07280005
072900             PERFORM 2140-DESELECT-ALL-ITEMS                      07290005
073000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07300005
073100                                                                  07310005
073200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07320005
073300             PERFORM 2150-SELECT-ALL-ITEMS                        07330005
073400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07340005
073500                                                                  07350005
073600         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07360005
073700             IF  ASC-USE-SELECTION-QUEUE                          07370005
073800                 PERFORM 1130-GET-NEXT-RECORD                     07380005
073900                 IF PS-LIST-END                                   07390005
074000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07400005
074100                     SET PS-NO-LIST-END TO TRUE                   07410005
074200                 ELSE                                             07420005
074300                     PERFORM 2050-DELETE-LIST-QUEUE               07430005
074400                     PERFORM 3200-RESET-ATTRIBUTES                07440005
074500                     PERFORM 4000-BUILD-INITIAL-PANEL             07450005
074600                 END-IF                                           07460005
074700              ELSE                                                07470005
074800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07480005
074900*                --- BOTTOM OF LIST ---                           07490005
075000                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         07500005
075100                 SET DP020-MSG-INFORMATIONAL TO TRUE              07510005
075200             END-IF                                               07520005
075300                                                                  07530005
075400         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07540005
075500             IF  ASC-USE-SELECTION-QUEUE                          07550005
075600                 PERFORM 1140-GET-PREV-RECORD                     07560005
075700                 IF PS-LIST-END                                   07570005
075800                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07580005
075900                     SET PS-NO-LIST-END TO TRUE                   07590005
076000                 ELSE                                             07600005
076100                     PERFORM 2050-DELETE-LIST-QUEUE               07610005
076200                     PERFORM 3200-RESET-ATTRIBUTES                07620005
076300                     PERFORM 4000-BUILD-INITIAL-PANEL             07630005
076400                 END-IF                                           07640005
076500             ELSE                                                 07650005
076600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07660005
076700                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         07670005
076800                 SET DP020-MSG-INFORMATIONAL TO TRUE              07680005
076900             END-IF                                               07690005
077000                                                                  07700005
077010* F17- CHANGE SORT ORDER                                          07701049
077020         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               07702049
077030                                                                  07703049
077040              EVALUATE TRUE                                       07704049
077050                  WHEN  ASC-SKU-CSR                               07705050
077060                       SET  ASC-DC-SKU-CSR      TO  TRUE          07706050
077070                  WHEN ASC-SKU-STR-CSR                            07707050
077080                       SET  ASC-DC-SKU-STR-CSR  TO  TRUE          07708050
077090                  WHEN  ASC-DC-SKU-CSR                            07709050
077091                       SET  ASC-SKU-CSR         TO  TRUE          07709150
077092                  WHEN ASC-DC-SKU-STR-CSR                         07709250
077093                       SET  ASC-SKU-STR-CSR     TO  TRUE          07709350
077094              END-EVALUATE                                        07709449
077095                                                                  07709549
077096              PERFORM 2050-DELETE-LIST-QUEUE                      07709649
077097              PERFORM 3200-RESET-ATTRIBUTES                       07709749
077098              PERFORM 4000-BUILD-INITIAL-PANEL                    07709849
077099                                                                  07709949
077100         WHEN OTHER                                               07710005
077200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07720005
077300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07730005
077400                                                                  07740005
077500             IF  PS-NO-ERROR                                      07750005
077600                 SET DP030-CONTINUE-GO TO TRUE                    07760005
077700                 PERFORM 2100-CHECK-FUNCTION-KEY                  07770005
077800             ELSE                                                 07780005
077900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07790005
078000                 SET DP030-OVERRIDE-GO TO TRUE                    07800005
078100             END-IF                                               07810005
078200     END-EVALUATE.                                                07820005
078300                                                                  07830005
078400*----------------------------------------------------------------*07840005
078500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07850005
078600*----------------------------------------------------------------*07860005
078700 2050-DELETE-LIST-QUEUE.                                          07870005
078800                                                                  07880005
078900     EXEC CICS                                                    07890005
079000         DELETEQ TS                                               07900005
079100             QUEUE (ASC-LIST-QUEUE-NAME)                          07910005
079200             RESP  (PV-CICS-RESP)                                 07920005
079300     END-EXEC.                                                    07930005
079400                                                                  07940005
079500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07950005
079600        (PV-CICS-RESP = DFHRESP(QIDERR))                          07960005
079700         CONTINUE                                                 07970005
079800     ELSE                                                         07980005
079900         SET DP013-CICS-ABEND      TO TRUE                        07990005
080000         SET DP013-NO-ROLLBACK     TO TRUE                        08000005
080100                                                                  08010005
080200         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         08020005
080300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08030005
080400                                   TO DP013-MESSAGE-TEXT (1)      08040005
080500         PERFORM DP013-0000-PROCESS-ABEND                         08050005
080600     END-IF.                                                      08060005
080700                                                                  08070005
080800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08080005
080900                                                                  08090005
081000*----------------------------------------------------------------*08100005
081100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08110005
081200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08120005
081300* CICS ARCHITECTURE API.                                         *08130005
081400*----------------------------------------------------------------*08140005
081500 2100-CHECK-FUNCTION-KEY.                                         08150005
081600                                                                  08160005
081700     EVALUATE TRUE                                                08170005
081900*                                                                 08190005
082000* F18 - STORE INTRANSIT DETAIL                                    08200023
082100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08210005
082200             IF PS-NO-ERROR                                       08220005
082300                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          08230005
082400                     SET ASC-USE-SELECTION-QUEUE TO TRUE          08240005
082500                     INITIALIZE PC211-INTER-APPL-COMMAREA         08250005
082600                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            08260005
082700                                TO PC211-NUMBER-OF-SELECTED-ITEMS 08270005
082800                     MOVE ASC-NUMBER-OF-TS-ITEMS                  08280005
082900                                      TO PC211-NUMBER-OF-TS-ITEMS 08290005
083000                     MOVE ASC-SEL-QUEUE-NAME                      08300005
083100                                           TO PC211-SEL-QUEUE-NAME08310005
083200                     MOVE ASC-SKU         TO PC211-SKU            08320005
083300                     MOVE ASC-STR-NBR     TO PC211-STORE-NBR      08330005
083550                     SET  PC211-DISPLAY-INTR  TO  TRUE            08355026
083600                     PERFORM 5000-PREPARE-SEL-QUEUE               08360005
083700                 ELSE                                             08370005
083800                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08380005
083900                     SET DP030-OVERRIDE-GO TO TRUE                08390005
084000                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     08400005
084100                     SET DP020-MSG-WARNING TO TRUE                08410005
084200                 END-IF                                           08420005
084300             END-IF                                               08430005
084400                                                                  08440005
084410*                                                                 08441026
084420* F24 - STORE EXPECTED DTEAIL                                     08442026
084430         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              08443026
084440             IF PS-NO-ERROR                                       08444026
084450                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          08445026
084460                     SET ASC-USE-SELECTION-QUEUE TO TRUE          08446026
084470                     INITIALIZE PC211-INTER-APPL-COMMAREA         08447026
084480                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            08448026
084490                                TO PC211-NUMBER-OF-SELECTED-ITEMS 08449026
084491                     MOVE ASC-NUMBER-OF-TS-ITEMS                  08449126
084492                                      TO PC211-NUMBER-OF-TS-ITEMS 08449226
084493                     MOVE ASC-SEL-QUEUE-NAME                      08449326
084494                                           TO PC211-SEL-QUEUE-NAME08449426
084495                     MOVE ASC-SKU         TO PC211-SKU            08449526
084496                     MOVE ASC-STR-NBR     TO PC211-STORE-NBR      08449626
084503                     SET  PC211-DISPLAY-STR-EXPT  TO  TRUE        08450326
084504                     PERFORM 5000-PREPARE-SEL-QUEUE               08450426
084505                 ELSE                                             08450526
084506                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08450626
084507                     SET DP030-OVERRIDE-GO TO TRUE                08450726
084508                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     08450826
084509                     SET DP020-MSG-WARNING TO TRUE                08450926
084510                 END-IF                                           08451026
084511             END-IF                                               08451126
084512                                                                  08451226
084520*                                                                 08452005
084600* F6 - FIRST PAGE                                                 08460005
084700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08470005
084800             MOVE +1               TO PV-TOP-ITEM                 08480005
084900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08490005
085000*                                                                 08500005
085100* F7 - PREVIOUS PAGE                                              08510005
085200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08520005
085300             PERFORM 2110-BROWSE-BACKWARD                         08530005
085400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08540005
085500*                                                                 08550005
085600* F8 - NEXT PAGE                                                  08560005
085700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08570005
085800             PERFORM 2120-BROWSE-FORWARD                          08580005
085900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08590005
086000*                                                                 08600005
086100* ENTER KEY                                                       08610005
086200         WHEN DP020-SRC-AID = DP016-ENTER                         08620005
086300             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08630005
086400             IF  PS-ERROR                                         08640005
086500                 CONTINUE                                         08650005
086600             ELSE                                                 08660005
086700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08670005
086800             END-IF                                               08680005
086900                                                                  08690005
087000         WHEN OTHER                                               08700005
087100             SET DP013-NO-ROLLBACK                                08710005
087200                 DP013-XCTL-DISPLAY-RESTART                       08720005
087300                 DP013-CICS-ABEND  TO TRUE                        08730005
087400             MOVE '2100-CHECK-FUNCTION-KEY'                       08740005
087500                                   TO DP013-PARAGRAPH             08750005
087600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08760005
087700                                   TO DP013-MESSAGE-TEXT (1)      08770005
087800             PERFORM DP013-0000-PROCESS-ABEND                     08780005
087900     END-EVALUATE.                                                08790005
088000*                                                                 08800005
088100*----------------------------------------------------------------*08810005
088200*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08820005
088300*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08830005
088400*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08840005
088500*    MESSAGE.                                                    *08850005
088600*----------------------------------------------------------------*08860005
088700 2110-BROWSE-BACKWARD.                                            08870005
088800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08880005
088900         GIVING PV-TOP-ITEM.                                      08890005
089000*                                                                 08900005
089100     IF  ((PV-TOP-ITEM < +1)                                      08910005
089200       OR (PV-TOP-ITEM = +1))                                     08920005
089300         MOVE +1                   TO PV-TOP-ITEM                 08930005
089400*        -- TOP OF LIST --                                        08940005
089500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08950005
089600         SET DP020-MSG-INFORMATIONAL TO TRUE                      08960005
089700     END-IF.                                                      08970005
089800                                                                  08980005
089900*----------------------------------------------------------------*08990005
090000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09000005
090100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09010005
090200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09020005
090300*----------------------------------------------------------------*09030005
090400 2120-BROWSE-FORWARD.                                             09040005
090500                                                                  09050005
090600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09060005
090700         GIVING PV-TOP-ITEM.                                      09070005
090800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09080005
090900         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             09090005
091000*        -- BOTTOM OF LIST --                                     09100005
091100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09110005
091200         SET DP020-MSG-INFORMATIONAL  TO TRUE                     09120005
091300     ELSE                                                         09130005
091400         COMPUTE PV-BOTTOM-ITEM =                                 09140005
091500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09150005
091600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09160005
091700*            -- BOTTOM OF LIST --                                 09170005
091800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09180005
091900             SET DP020-MSG-INFORMATIONAL TO TRUE                  09190005
092000         END-IF                                                   09200005
092100     END-IF.                                                      09210005
092200                                                                  09220005
092300*----------------------------------------------------------------*09230005
092400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09240005
092500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09250005
092600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09260005
092700*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09270005
092800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09280005
092900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09290005
093000*----------------------------------------------------------------*09300005
093100 2130-CHECK-FOR-JUMP-BROWSE.                                      09310005
093200     SET PS-NO-ERROR               TO TRUE.                       09320063
093300     IF (ASC-START-ITEM-REQUEST = SPACE)                          09330063
093400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09340063
093500                                   TO PV-TOP-ITEM                 09350063
093600     ELSE                                                         09360063
093700         MOVE ASC-START-ITEM-REQUEST                              09370063
093800                                   TO DP010I-UNEDITED-FIELD       09380063
093900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09390063
094000         MOVE LENGTH OF ASC-START-ITEM-REQUEST                    09400063
094100                                 TO DP010I-MAXIMUM-DIGITS         09410063
094200         SET DP010I-NEGATIVE-NOT-ALLOWED                          09420063
094300                                   TO TRUE                        09430063
094410         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09441071
094420                         USING DP010I-NUMERIC-EDIT-AREA           09442071
094500                                                                  09450063
094600         IF  NOT DP010I-ERROR-DETECTED                            09460063
094700             MOVE DP010I-NUMERIC-FIELD                            09470063
094800                                   TO  ASC-START-ITEM-REQUEST-N   09480063
094900             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09490063
095000                 IF  ASC-START-ITEM-REQUEST-N >                   09500063
095100                                          ASC-NUMBER-OF-ITEMS-READ09510063
095200                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09520063
095300                     COMPUTE PV-TOP-ITEM =                        09530063
095400                             ASC-NUMBER-OF-ITEMS-READ             09540063
095500                             - PC-ITEMS-PER-PANEL + 1             09550063
095600                     IF  PV-TOP-ITEM < +1                         09560063
095700                         MOVE +1   TO PV-TOP-ITEM                 09570063
095800                         MOVE PC-TSYMSG-00070                     09580063
095900                                   TO DP020-MSG-NUMBER            09590063
096000                         SET DP020-MSG-INFORMATIONAL              09600063
096100                                   TO TRUE                        09610063
096200                     ELSE                                         09620063
096300                         MOVE  PV-TOP-ITEM                        09630063
096400                           TO  ASC-START-ITEM-REQUEST-N           09640063
096500                     END-IF                                       09650063
096600                 ELSE                                             09660063
096700                     MOVE ASC-START-ITEM-REQUEST-N                09670063
096800                                   TO PV-TOP-ITEM                 09680063
096900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09690063
097000                     COMPUTE PV-BOTTOM-ITEM =                     09700063
097100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09710063
097200                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09720063
097300                         SUBTRACT  PV-TOP-ITEM                    09730063
097400                             FROM  ASC-NUMBER-OF-ITEMS-READ       09740063
097500                           GIVING  ASC-ITEMS-DISPLAYED            09750063
097600                         MOVE  ASC-NUMBER-OF-ITEMS-READ           09760063
097700                           TO  PV-BOTTOM-ITEM                     09770063
097800*                        -- BOTTOM OF LIST --                     09780063
097900                         MOVE PC-TSYMSG-00070                     09790063
098000                                   TO DP020-MSG-NUMBER            09800063
098100                         SET DP020-MSG-INFORMATIONAL              09810063
098200                                   TO TRUE                        09820063
098300                     END-IF                                       09830063
098400                 END-IF                                           09840063
098500             ELSE                                                 09850063
098600*                --- VALUE OUT OF RANGE ----                      09860063
098700                 MOVE PC-TSYMSG-00101                             09870063
098800                                   TO DP020-MSG-NUMBER            09880063
098900                 MOVE -1           TO ASTRTITL                    09890063
099000                 SET DP030-SET-CURSOR-APPL-1                      09900063
099010                                   TO TRUE                        09901063
099020                 MOVE DP015-REVERSE                               09902063
099030                                   TO ASTRTITH                    09903063
099040                 MOVE DP015-RED    TO ASTRTITC                    09904063
099050                 MOVE DP015-UNP-NUM-BRT-MDT                       09905063
099060                                   TO ASTRTITA                    09906063
099070                 SET DP020-MSG-FATAL                              09907063
099080                                   TO TRUE                        09908063
099090                 SET PS-ERROR      TO TRUE                        09909063
099091             END-IF                                               09909163
099093         ELSE                                                     09909363
099094             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09909463
099095             MOVE -1               TO ASTRTITL                    09909563
099096             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09909663
099097             MOVE DP015-REVERSE    TO ASTRTITH                    09909763
099098             MOVE DP015-RED        TO ASTRTITC                    09909863
099099             MOVE DP015-UNP-NUM-BRT-MDT                           09909963
099100                                   TO ASTRTITA                    09910063
099101             SET DP020-MSG-FATAL   TO TRUE                        09910163
099102             SET PS-ERROR          TO TRUE                        09910263
099103         END-IF                                                   09910363
099104     END-IF.                                                      09910463
099105                                                                  09910563
099110*----------------------------------------------------------------*09911005
099200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09920005
099300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09930005
099400*----------------------------------------------------------------*09940005
099500 2140-DESELECT-ALL-ITEMS.                                         09950005
099600     MOVE +1                       TO ASC-BLK-SUB.                09960005
099700                                                                  09970005
099800     PERFORM 2141-CLEAR-SELECTED-INDS                             09980005
099900         VARYING ASC-ITEM-SUB                                     09990005
100000         FROM 1 BY 1                                              10000005
100100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10010005
100200                                                                  10020005
100300     ADD +1                        TO ASC-BLK-SUB.                10030005
100400                                                                  10040005
100500     PERFORM 2141-CLEAR-SELECTED-INDS                             10050005
100600         VARYING ASC-ITEM-SUB                                     10060005
100700         FROM 1 BY 1                                              10070005
100800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10080005
100900                                                                  10090005
101000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10100005
101100                                   TO PV-LIST-ITEM-NUMBER.        10110005
101200                                                                  10120005
101300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10130005
101400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10140005
101500                                                                  10150005
101600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10160005
101700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10170005
101800         MOVE +1                   TO ASC-BLK-SUB                 10180005
101900                                                                  10190005
102000         PERFORM 5100-WRITE-TEMP-STORAGE                          10200005
102100         MOVE +2                   TO ASC-BLK-SUB                 10210005
102200         PERFORM 5100-WRITE-TEMP-STORAGE                          10220005
102300         MOVE +1                   TO ASC-BLK-SUB                 10230005
102400                                                                  10240005
102500         MOVE +1                   TO PV-BLOCK-NUMBER             10250005
102600                                                                  10260005
102700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10270005
102800             PV-FIRST-BLOCK-IN-ARRAY - 1                          10280005
102900                                                                  10290005
103000         PERFORM                                                  10300005
103100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10310005
103200                                                                  10320005
103300             PERFORM 4410-READ-TEMP-STORAGE                       10330005
103400                                                                  10340005
103500             PERFORM 2141-CLEAR-SELECTED-INDS                     10350005
103600                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10360005
103700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10370005
103800                                                                  10380005
103900             PERFORM 5100-WRITE-TEMP-STORAGE                      10390005
104000                                                                  10400005
104100             ADD +1                TO PV-BLOCK-NUMBER             10410005
104200                                                                  10420005
104300         END-PERFORM                                              10430005
104400                                                                  10440005
104500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10450005
104600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10460005
104700                                                                  10470005
104800         PERFORM                                                  10480005
104900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10490005
105000                   ASC-HIGHEST-BLOCK-WRITTEN                      10500005
105100                                                                  10510005
105200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10520005
105300                                   TO PV-BLOCK-NUMBER             10530005
105400                                                                  10540005
105500             PERFORM 4410-READ-TEMP-STORAGE                       10550005
105600                                                                  10560005
105700             PERFORM 2141-CLEAR-SELECTED-INDS                     10570005
105800                 VARYING ASC-ITEM-SUB                             10580005
105900                 FROM 1 BY 1                                      10590005
106000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10600005
106100                                                                  10610005
106200             PERFORM 5100-WRITE-TEMP-STORAGE                      10620005
106300                                                                  10630005
106400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10640005
106500         END-PERFORM                                              10650005
106600                                                                  10660005
106700         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          10670005
106800         PERFORM 4410-READ-TEMP-STORAGE                           10680005
106900     END-IF.                                                      10690005
107000                                                                  10700005
107100                                                                  10710005
107200     MOVE +0                      TO ASC-NUMBER-OF-SELECTED-ITEMS.10720005
107300     MOVE +0                      TO ASC-START-OF-SELECTED-RANGE. 10730005
107400     MOVE +0                      TO ASC-END-OF-SELECTED-RANGE.   10740005
107500                                                                  10750005
107600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10760005
107700                                                                  10770005
107800*----------------------------------------------------------------*10780005
107900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10790005
108000*----------------------------------------------------------------*10800005
108100 2141-CLEAR-SELECTED-INDS.                                        10810005
108200                                                                  10820005
108300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10830005
108400             NOT EQUAL ZERO                                       10840005
108500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10850005
108600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10860005
108700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10870005
108800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10880005
108900                                   TO TRUE                        10890005
109000         END-IF                                                   10900005
109100     END-IF.                                                      10910005
109200                                                                  10920005
109300*----------------------------------------------------------------*10930005
109400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *10940005
109500*  FOR ALL ITEMS.                                                *10950005
109600*----------------------------------------------------------------*10960005
109700 2150-SELECT-ALL-ITEMS.                                           10970005
109800                                                                  10980005
109900     MOVE +1                       TO ASC-BLK-SUB.                10990005
110000                                                                  11000005
110100     PERFORM 2151-SET-SELECTED-INDS                               11010005
110200         VARYING ASC-ITEM-SUB                                     11020005
110300         FROM 1 BY 1                                              11030005
110400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11040005
110500                                                                  11050005
110600     ADD +1                        TO ASC-BLK-SUB.                11060005
110700                                                                  11070005
110800     PERFORM 2151-SET-SELECTED-INDS                               11080005
110900         VARYING ASC-ITEM-SUB                                     11090005
111000         FROM 1 BY 1                                              11100005
111100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11110005
111200                                                                  11120005
111300     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       11130005
111400                                                                  11140005
111500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11150005
111600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11160005
111700                                                                  11170005
111800     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            11180005
111900         MOVE +1                   TO ASC-BLK-SUB                 11190005
112000                                                                  11200005
112100         PERFORM 5100-WRITE-TEMP-STORAGE                          11210005
112200         MOVE +2                   TO ASC-BLK-SUB                 11220005
112300         PERFORM 5100-WRITE-TEMP-STORAGE                          11230005
112400         MOVE +1                   TO ASC-BLK-SUB                 11240005
112500         MOVE +1                   TO PV-BLOCK-NUMBER             11250005
112600     END-IF.                                                      11260005
112700*                                                                 11270005
112800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11280005
112900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11290005
113000         MOVE +1                   TO ASC-BLK-SUB                 11300005
113100                                                                  11310005
113200         PERFORM 5100-WRITE-TEMP-STORAGE                          11320005
113300         MOVE +2                   TO ASC-BLK-SUB                 11330005
113400         PERFORM 5100-WRITE-TEMP-STORAGE                          11340005
113500         MOVE +1                   TO ASC-BLK-SUB                 11350005
113600         MOVE +1                   TO PV-BLOCK-NUMBER             11360005
113700                                                                  11370005
113800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11380005
113900             PV-FIRST-BLOCK-IN-ARRAY - 1                          11390005
114000                                                                  11400005
114100         PERFORM                                                  11410005
114200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11420005
114300                                                                  11430005
114400             PERFORM 4410-READ-TEMP-STORAGE                       11440005
114500                                                                  11450005
114600             PERFORM 2151-SET-SELECTED-INDS                       11460005
114700                 VARYING ASC-ITEM-SUB                             11470005
114800                 FROM 1 BY 1                                      11480005
114900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11490005
115000                                                                  11500005
115100             PERFORM 5100-WRITE-TEMP-STORAGE                      11510005
115200                                                                  11520005
115300             ADD +1                TO PV-BLOCK-NUMBER             11530005
115400                                                                  11540005
115500         END-PERFORM                                              11550005
115600                                                                  11560005
115700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11570005
115800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11580005
115900                                                                  11590005
116000         PERFORM                                                  11600005
116100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11610005
116200                   ASC-HIGHEST-BLOCK-WRITTEN                      11620005
116300                                                                  11630005
116400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11640005
116500                                   TO PV-BLOCK-NUMBER             11650005
116600                                                                  11660005
116700             PERFORM 4410-READ-TEMP-STORAGE                       11670005
116800                                                                  11680005
116900             PERFORM 2151-SET-SELECTED-INDS                       11690005
117000                 VARYING ASC-ITEM-SUB                             11700005
117100                 FROM 1 BY 1                                      11710005
117200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11720005
117300                                                                  11730005
117400             PERFORM 5100-WRITE-TEMP-STORAGE                      11740005
117500                                                                  11750005
117600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11760005
117700                                                                  11770005
117800         END-PERFORM                                              11780005
117900                                                                  11790005
118000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11800005
118100                                   TO PV-BLOCK-NUMBER             11810005
118200                                                                  11820005
118300         PERFORM 4410-READ-TEMP-STORAGE                           11830005
118400     END-IF.                                                      11840005
118500                                                                  11850005
118600                                                                  11860005
118700     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11870005
118800                       ASC-NUMBER-OF-SELECTED-ITEMS.              11880005
118900                                                                  11890005
119000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11900005
119100                                                                  11910005
119200*----------------------------------------------------------------*11920005
119300*    MARK EACH ITEM AS BEING SELECTED.                           *11930005
119400*----------------------------------------------------------------*11940005
119500 2151-SET-SELECTED-INDS.                                          11950005
119600                                                                  11960005
119700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11970005
119800             NOT EQUAL ZERO                                       11980005
119900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11990005
120000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12000005
120100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12010005
120200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12020005
120300                               TO  TRUE                           12030005
120400         END-IF                                                   12040005
120500     END-IF.                                                      12050005
120600                                                                  12060005
120700******************************************************************12070005
120800** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12080005
120900** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12090005
121000******************************************************************12100005
121100 2200-MOVE-SCREEN-TO-COMMAREA.                                    12110005
121200                                                                  12120005
121300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12130005
121400     MOVE +1                       TO PV-SUB.                     12140005
121500*                                                                 12150005
121600     PERFORM 3100-SET-SUBSCRIPTS.                                 12160005
121700     IF  ASTRTITL > ZERO                                          12170005
121800         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12180005
121900     ELSE                                                         12190005
122000         IF  ASTRTITF = DP015-ERASE-EOF                           12200005
122100             INITIALIZE ASC-START-ITEM-REQUEST                    12210005
122200         END-IF                                                   12220005
122300     END-IF.                                                      12230005
122400                                                                  12240005
122500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12250005
122600         VARYING PV-SUB                                           12260005
122700         FROM 1 BY 1                                              12270005
122800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12280005
122900******************************************************************12290005
123000** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12300005
123100******************************************************************12310005
123200 2210-MOVE-LINES-TO-COMMAREA.                                     12320005
123300     IF  MR-SELECTL (PV-SUB) > ZERO                               12330005
123400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12340005
123500         MOVE MR-SELECTI (PV-SUB)                                 12350005
123600                                   TO ASC-TEMP-SELECTED-SW        12360005
123700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12370005
123800     ELSE                                                         12380005
123900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12390005
124000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12400005
124100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12410005
124200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12420005
124300         END-IF                                                   12430005
124400     END-IF.                                                      12440005
124500     ADD +1                        TO ASC-ITEM-SUB.               12450005
124600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12460063
124700         IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     12470063
124800             COMPUTE PV-BLOCK-NUMBER  =                           12480063
124900                1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /         12490063
124910                    PC-ITEMS-PER-PANEL                            12491063
124920             PERFORM 5105-REWRITE-ASC-LISTQ                       12492063
124930         END-IF                                                   12493063
124940         ADD +1                    TO ASC-BLK-SUB                 12494063
124950         MOVE +1                   TO ASC-ITEM-SUB                12495063
124960     ELSE                                                         12496063
124970     IF  PV-SUB = ASC-ITEMS-DISPLAYED                             12497063
124980         IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     12498063
124990             COMPUTE PV-BLOCK-NUMBER  =                           12499063
124991                1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /         12499163
124992                    PC-ITEMS-PER-PANEL                            12499263
124993             PERFORM 5105-REWRITE-ASC-LISTQ                       12499363
124994         END-IF                                                   12499463
124995     END-IF.                                                      12499563
124996                                                                  12499663
125000******************************************************************12500005
125100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **12510005
125200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **12520005
125300******************************************************************12530005
125400 3000-EDIT-DATA-IN-COMMAREA.                                      12540005
125500     SET PS-NO-ERROR               TO TRUE.                       12550005
125600     PERFORM 3200-RESET-ATTRIBUTES.                               12560005
125700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12570005
125800                                                                  12580005
125900**                                                                12590005
126000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12600005
126100* EDITTING IS DONE FROM THE BOTTOM UP.                            12610005
126200**                                                                12620005
126300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12630005
126400         ASC-ITEMS-DISPLAYED - 1.                                 12640005
126500     PERFORM 3100-SET-SUBSCRIPTS.                                 12650005
126600                                                                  12660005
126700     IF  PS-NO-ERROR                                              12670005
126800         PERFORM 3005-EDIT-COMMAREA-BLOCKS                        12680005
126900     END-IF.                                                      12690005
127000*                                                                 12700005
127100     IF  PS-NO-ERROR                                              12710005
127200         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12720005
127300     END-IF.                                                      12730005
127400*                                                                 12740005
127500     IF  ((PS-NO-ERROR)                                           12750005
127600       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12760005
127700       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12770005
127800             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12780005
127900     END-IF.                                                      12790005
128000                                                                  12800005
128100*----------------------------------------------------------------*12810005
128200*   3005-EDIT-COMMAREA-BLOCKS                                    *12820005
128300*----------------------------------------------------------------*12830005
128400 3005-EDIT-COMMAREA-BLOCKS.                                       12840005
128500     MOVE +1                       TO PV-BLOCK-NUMBER.            12850005
128600     MOVE +1                       TO ASC-BLK-SUB.                12860005
128700     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               12870005
128800                                                                  12880005
128900     COMPUTE PV-BLOCK-NUMBER  =                                   12890005
129000        1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /                 12900005
129100            PC-ITEMS-PER-PANEL.                                   12910005
129200                                                                  12920005
129300     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          12930005
129400                                                                  12940005
129500     PERFORM                                                      12950005
129600       UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN          12960005
129700          OR PS-ERROR                                             12970005
129800          OR PS-BLOCK-ERROR                                       12980005
129900                                                                  12990005
130000             COMPUTE PV-ITEMS-HOLD  =                             13000005
130100                     ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +        13010005
130200                     PC-ITEMS-PER-PANEL - 1                       13020005
130300                                                                  13030005
130400             IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ       13040005
130500                 SUBTRACT  ASC-NUMBER-OF-ITEMS-READ               13050005
130600                     FROM  PV-ITEMS-HOLD                          13060005
130700                   GIVING  PV-ITEMS-DIFF                          13070005
130800                 SUBTRACT  PV-ITEMS-DIFF                          13080005
130900                     FROM  PC-ITEMS-PER-PANEL                     13090005
131000                   GIVING  PV-ITEMS-HOLD                          13100005
131100                     MOVE  PV-ITEMS-HOLD  TO  PV-SUB              13110005
131200                                              ASC-ITEM-SUB        13120005
131300                                              ASC-ITEMS-DISPLAYED 13130005
131400             ELSE                                                 13140005
131500                 MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB              13150005
131600                 MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB        13160005
131700             END-IF                                               13170005
131800                                                                  13180005
131900             PERFORM 3300-EDIT-SELECTIONS                         13190005
132000                     VARYING PV-SUB                               13200005
132100                        FROM PV-SUB BY -1                         13210005
132200                       UNTIL PV-SUB < +1                          13220005
132300                                                                  13230005
132400             MOVE +1               TO ASC-BLK-SUB                 13240005
132500                                                                  13250005
132600             PERFORM 5105-REWRITE-ASC-LISTQ                       13260005
132700                                                                  13270005
132800             MOVE +1                TO ASC-BLK-SUB                13280005
132900                                                                  13290005
133000             IF  PS-BLOCK-ERROR                                   13300005
133100                 SET  PS-ERROR     TO TRUE                        13310005
133200                 MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)        13320005
133300                                   TO PV-TOP-ITEM                 13330005
133400             ELSE                                                 13340005
133500                 ADD  +1           TO PV-BLOCK-NUMBER             13350005
133600                 IF  PV-BLOCK-NUMBER >                            13360005
133700                     ASC-HIGHEST-BLOCK-WRITTEN                    13370005
133800                     MOVE +2       TO ASC-BLK-SUB                 13380005
133900                     PERFORM 4410-READ-TEMP-STORAGE               13390005
134000                     MOVE +1       TO ASC-BLK-SUB                 13400005
134100                 ELSE                                             13410005
134200                     PERFORM 4410-READ-TEMP-STORAGE               13420005
134300                     ADD  +1        TO PV-BLOCK-NUMBER            13430005
134400                     MOVE +2        TO ASC-BLK-SUB                13440005
134500                     PERFORM 4410-READ-TEMP-STORAGE               13450005
134600                     SUBTRACT +1  FROM PV-BLOCK-NUMBER            13460005
134700                     MOVE +1        TO ASC-BLK-SUB                13470005
134800                 END-IF                                           13480005
134900             END-IF                                               13490005
135000     END-PERFORM.                                                 13500005
135100                                                                  13510005
135200     IF  PV-ORIGINAL-BLOCK  = +1    OR                            13520005
135300         PS-ERROR                   OR                            13530005
135400         PS-BLOCK-ERROR                                           13540005
135500         CONTINUE                                                 13550005
135600     ELSE                                                         13560005
135700         MOVE +1                 TO PV-BLOCK-NUMBER               13570005
135800         MOVE +1                 TO ASC-BLK-SUB                   13580005
135900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  13590005
136000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           13600005
136100         PERFORM 4410-READ-TEMP-STORAGE                           13610005
136200                                                                  13620005
136300         PERFORM                                                  13630005
136400           UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK              13640005
136500              OR PS-ERROR                                         13650005
136600              OR PS-BLOCK-ERROR                                   13660005
136700                                                                  13670005
136800                 COMPUTE PV-ITEMS-HOLD  =                         13680005
136900                         ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +    13690005
137000                         PC-ITEMS-PER-PANEL - 1                   13700005
137100                                                                  13710005
137200                 IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ     13720005
137300                     SUBTRACT  ASC-NUMBER-OF-ITEMS-READ           13730005
137400                         FROM  PV-ITEMS-HOLD                      13740005
137500                       GIVING  PV-ITEMS-DIFF                      13750005
137600                     SUBTRACT  PV-ITEMS-DIFF                      13760005
137700                         FROM  PC-ITEMS-PER-PANEL                 13770005
137800                       GIVING  PV-ITEMS-HOLD                      13780005
137900                         MOVE  PV-ITEMS-HOLD TO PV-SUB            13790005
138000                                                ASC-ITEM-SUB      13800005
138100                                               ASC-ITEMS-DISPLAYED13810005
138200                 ELSE                                             13820005
138300                     MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB          13830005
138400                     MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB    13840005
138500                 END-IF                                           13850005
138600                                                                  13860005
138700                 PERFORM 3300-EDIT-SELECTIONS                     13870005
138800                         VARYING PV-SUB                           13880005
138900                            FROM PV-SUB BY -1                     13890005
139000                           UNTIL PV-SUB < +1                      13900005
139100                                                                  13910005
139200                 MOVE +1               TO ASC-BLK-SUB             13920005
139300                                                                  13930005
139400                 PERFORM 5105-REWRITE-ASC-LISTQ                   13940005
139500                                                                  13950005
139600                 MOVE +1                TO ASC-BLK-SUB            13960005
139700                                                                  13970005
139800                 IF  PS-BLOCK-ERROR                               13980005
139900                     SET  PS-ERROR     TO TRUE                    13990005
140000                     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)    14000005
140100                                       TO PV-TOP-ITEM             14010005
140200                 ELSE                                             14020005
140300                     ADD  +1            TO PV-BLOCK-NUMBER        14030005
140400                     IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK      14040005
140500                         MOVE +2        TO ASC-BLK-SUB            14050005
140600                         PERFORM 4410-READ-TEMP-STORAGE           14060005
140700                         MOVE +1        TO ASC-BLK-SUB            14070005
140800                     ELSE                                         14080005
140900                         PERFORM 4410-READ-TEMP-STORAGE           14090005
141000                         ADD  +1        TO PV-BLOCK-NUMBER        14100005
141100                         MOVE +2        TO ASC-BLK-SUB            14110005
141200                         PERFORM 4410-READ-TEMP-STORAGE           14120005
141300                         SUBTRACT +1  FROM PV-BLOCK-NUMBER        14130005
141400                         MOVE +1        TO ASC-BLK-SUB            14140005
141500                     END-IF                                       14150005
141600                 END-IF                                           14160005
141700     END-PERFORM.                                                 14170005
141800                                                                  14180005
141900*----------------------------------------------------------------*14190005
142000*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14200005
142100*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*14210005
142200*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14220005
142300*                                                                *14230005
142400*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *14240005
142500*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14250005
142600*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14260005
142700*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14270005
142800*----------------------------------------------------------------*14280005
142900 3100-SET-SUBSCRIPTS.                                             14290005
143000                                                                  14300005
143100     COMPUTE ASC-ITEM-SUB =                                       14310005
143200         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14320005
143300                                                                  14330005
143400     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14340005
143500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14350005
143600         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               14360005
143700     ELSE                                                         14370005
143800         MOVE +1                     TO ASC-BLK-SUB               14380005
143900     END-IF.                                                      14390005
144000******************************************************************14400005
144100** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **14410005
144200******************************************************************14420005
144300 3200-RESET-ATTRIBUTES.                                           14430005
144400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   14440005
144500     MOVE DP015-GREEN              TO ASTRTITC.                   14450005
144600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   14460005
144700                                                                  14470005
144800     PERFORM                                                      14480005
144900         VARYING PV-SUB                                           14490005
145000         FROM 1 BY 1                                              14500005
145100         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        14510005
145200             MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA (PV-SUB)    14520005
145300             MOVE DP015-GREEN         TO MR-SELECTC (PV-SUB)      14530005
145400             MOVE DP015-UNDERLINE     TO MR-SELECTH (PV-SUB)      14540005
145500     END-PERFORM.                                                 14550005
145600                                                                  14560005
145700******************************************************************14570005
145800** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **14580005
145900** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **14590005
146000** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **14600005
146100** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **14610005
146200******************************************************************14620005
146300 3300-EDIT-SELECTIONS.                                            14630005
146400     EVALUATE TRUE                                                14640005
146500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14650005
146600             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14660005
146700                 CONTINUE                                         14670005
146800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14680005
146900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14690005
147000                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   14700005
147100                 MOVE ASC-TEMP-SELECTED-SW                        14710005
147200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14720005
147300                                TO ASC-SELECTED-SW                14730005
147400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14740005
147500             END-IF                                               14750005
147600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14760005
147700                 = SPACE                                          14770005
147800             EVALUATE TRUE                                        14780005
147900                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14790005
148000                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14800005
148100                     MOVE SPACE TO ASC-SELECTED-SW                14810005
148200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14820005
148300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14830005
148400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    14840005
148500                     MOVE SPACE TO ASC-SELECTED-SW                14850005
148600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14860005
148700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14870005
148800                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      14880005
148900                     MOVE SPACE TO ASC-SELECTED-SW                14890005
149000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14900005
149100             END-EVALUATE                                         14910005
149200         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14920005
149300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14930005
149400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14940005
149500             END-IF                                               14950005
149600             PERFORM 3310-EDIT-RANGE                              14960005
149700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14970005
149800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14980005
149900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14990005
150000             END-IF                                               15000005
150100             PERFORM 3310-EDIT-RANGE                              15010005
150200         WHEN OTHER                                               15020005
150300             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           15030005
150400             SET DP020-MSG-FATAL    TO TRUE                       15040005
150500             MOVE -1                TO MR-SELECTL (PV-SUB)        15050005
150600             SET DP030-SET-CURSOR-APPL-1                          15060005
150700                                    TO TRUE                       15070005
150800             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        15080005
150900             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        15090005
151000             SET PS-ERROR TO TRUE                                 15100005
151100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15110005
151200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15120005
151300                 MOVE SPACE         TO ASC-SELECTED-SW            15130005
151400                                        (ASC-BLK-SUB ASC-ITEM-SUB)15140005
151500             END-IF                                               15150005
151600     END-EVALUATE.                                                15160005
151700                                                                  15170005
151800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 15180005
151900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15190005
152000     IF  ASC-ITEM-SUB < 1                                         15200005
152100         SUBTRACT +1 FROM ASC-BLK-SUB                             15210005
152200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15220005
152300     END-IF.                                                      15230005
152400                                                                  15240005
152500******************************************************************15250005
152600** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **15260005
152700** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **15270005
152800** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**15280005
152900** THE ENDING.                                                  **15290005
153000******************************************************************15300005
153100 3310-EDIT-RANGE.                                                 15310005
153200     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15320005
153300         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15330005
153400             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15340005
153500                                   TO ASC-SELECTED-SW             15350005
153600                                        (ASC-BLK-SUB ASC-ITEM-SUB)15360005
153700             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15370005
153800         ELSE                                                     15380005
153900             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15390005
154000                 CONTINUE                                         15400005
154100             ELSE                                                 15410005
154200*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15420005
154300                 MOVE PC-TSYMSG-00054                             15430005
154400                                       TO DP020-MSG-NUMBER        15440005
154500                 MOVE -1               TO MR-SELECTL (PV-SUB)     15450005
154600                 MOVE DP015-RED        TO MR-SELECTC (PV-SUB)     15460005
154700                 MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)     15470005
154800                 SET DP020-MSG-FATAL                              15480005
154900                     DP030-SET-CURSOR-APPL-1                      15490005
155000                     PS-ERROR          TO TRUE                    15500005
155100             END-IF                                               15510005
155200         END-IF                                                   15520005
155300     ELSE                                                         15530005
155400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15540005
155500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15550005
155600                                   TO ASC-SELECTED-SW             15560005
155700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15570005
155800             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15580005
155900         ELSE                                                     15590005
156000             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15600005
156100                 CONTINUE                                         15610005
156200             ELSE                                                 15620005
156300*                -- ONLY ONE END-OF-RANGE ALLOWED --              15630005
156400                 MOVE PC-TSYMSG-00055                             15640005
156500                                        TO DP020-MSG-NUMBER       15650005
156600                 MOVE -1                TO MR-SELECTL (PV-SUB)    15660005
156700                 SET DP020-MSG-FATAL                              15670005
156800                     DP030-SET-CURSOR-APPL-1                      15680005
156900                     PS-ERROR           TO TRUE                   15690005
157000             END-IF                                               15700005
157100         END-IF                                                   15710005
157200     END-IF.                                                      15720005
157300*                                                                 15730005
157400******************************************************************15740005
157500** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **15750005
157600** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **15760005
157700******************************************************************15770005
157800 3400-CHECK-RANGE-SEQUENCE.                                       15780005
157900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15790005
158000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15800005
158100       AND  ASC-START-OF-SELECTED-RANGE >                         15810005
158200                                         ASC-END-OF-SELECTED-RANGE15820005
158300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15830005
158400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 15840005
158500         SET DP020-MSG-FATAL TO TRUE                              15850005
158600         SET PS-ERROR TO TRUE                                     15860005
158700         PERFORM 3410-POSITION-AT-ERROR                           15870005
158800     END-IF.                                                      15880005
158900******************************************************************15890005
159000** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **15900005
159100** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **15910005
159200** SHOULD BE POSITIONED ON A RANGE ERROR.                       **15920005
159300******************************************************************15930005
159400 3410-POSITION-AT-ERROR.                                          15940005
159500     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       15950005
159600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15960005
159700                    - PV-TOP-ITEM + 1.                            15970005
159800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15980005
159900         CONTINUE                                                 15990005
160000     ELSE                                                         16000005
160100         MOVE -1                   TO MR-SELECTL (PV-SUB)         16010005
160200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16020005
160300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16030005
160400     END-IF.                                                      16040005
160500*                                                                 16050005
160600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16060005
160700                    - PV-TOP-ITEM + 1.                            16070005
160800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16080005
160900         CONTINUE                                                 16090005
161000     ELSE                                                         16100005
161100         MOVE -1                   TO MR-SELECTL (PV-SUB)         16110005
161200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16120005
161300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16130005
161400     END-IF.                                                      16140005
161500                                                                  16150005
161600*----------------------------------------------------------------*16160005
161700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16170005
161800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16180005
161900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16190005
162000*----------------------------------------------------------------*16200005
162100 3500-MARK-RANGE-AS-SELECTED.                                     16210005
162200     MOVE +1                       TO  ASC-BLK-SUB.               16220005
162300     PERFORM 3510-MARK-SELECTED-INDS                              16230005
162400         VARYING ASC-ITEM-SUB                                     16240005
162500         FROM 1 BY 1                                              16250005
162600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16260005
162700                                                                  16270005
162800     ADD +1                        TO ASC-BLK-SUB.                16280005
162900     PERFORM 3510-MARK-SELECTED-INDS                              16290005
163000         VARYING ASC-ITEM-SUB                                     16300005
163100         FROM 1 BY 1                                              16310005
163200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16320005
163300                                                                  16330005
163400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16340005
163500                                   TO  PV-LIST-ITEM-NUMBER.       16350005
163600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16360005
163700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         16370005
163800               PC-ITEMS-PER-PANEL).                               16380005
163900                                                                  16390005
164000     MOVE ASC-START-OF-SELECTED-RANGE                             16400005
164100                                   TO PV-START-OF-SELECTED-RANGE. 16410005
164200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16420005
164300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16430005
164400               PC-ITEMS-PER-PANEL).                               16440005
164500                                                                  16450005
164600     MOVE ASC-END-OF-SELECTED-RANGE                               16460005
164700                                   TO  PV-END-OF-SELECTED-RANGE.  16470005
164800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16480005
164900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16490005
165000               PC-ITEMS-PER-PANEL).                               16500005
165100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16510005
165200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16520005
165300                                                                  16530005
165400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16540005
165500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16550005
165600         MOVE +1                   TO ASC-BLK-SUB                 16560005
165700         PERFORM 5100-WRITE-TEMP-STORAGE                          16570005
165800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16580005
165900             PV-FIRST-BLOCK-IN-ARRAY - 1                          16590005
166000                                                                  16600005
166100         PERFORM                                                  16610005
166200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16620005
166300                   PV-PREV-BLOCK-IN-ARRAY                         16630005
166400             MOVE PV-FIRST-BLOCK-IN-RANGE                         16640005
166500                                   TO PV-BLOCK-NUMBER             16650005
166600             PERFORM 4410-READ-TEMP-STORAGE                       16660005
166700             PERFORM 3510-MARK-SELECTED-INDS                      16670005
166800                 VARYING ASC-ITEM-SUB                             16680005
166900                 FROM 1 BY 1                                      16690005
167000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16700005
167100             PERFORM 5100-WRITE-TEMP-STORAGE                      16710005
167200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     16720005
167300         END-PERFORM                                              16730005
167400                                                                  16740005
167500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16750005
167600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16760005
167700         PERFORM                                                  16770005
167800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16780005
167900                   PV-LAST-BLOCK-IN-RANGE                         16790005
168000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16800005
168100                                   TO PV-BLOCK-NUMBER             16810005
168200             PERFORM 4410-READ-TEMP-STORAGE                       16820005
168300             PERFORM 3510-MARK-SELECTED-INDS                      16830005
168400                 VARYING ASC-ITEM-SUB                             16840005
168500                 FROM 1 BY 1                                      16850005
168600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16860005
168700             PERFORM 5100-WRITE-TEMP-STORAGE                      16870005
168800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16880005
168900         END-PERFORM                                              16890005
169000                                                                  16900005
169100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16910005
169200                                   TO PV-BLOCK-NUMBER             16920005
169300         PERFORM 4410-READ-TEMP-STORAGE                           16930005
169400     END-IF.                                                      16940005
169500                                                                  16950005
169600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16960005
169700                                      ASC-END-OF-SELECTED-RANGE.  16970005
169800                                                                  16980005
169900*----------------------------------------------------------------*16990005
170000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17000005
170100*----------------------------------------------------------------*17010005
170200 3510-MARK-SELECTED-INDS.                                         17020005
170300                                                                  17030005
170400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17040005
170500                                ASC-ITEM-SUB) >                   17050005
170600         ASC-START-OF-SELECTED-RANGE)                             17060005
170700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17070005
170800                                ASC-ITEM-SUB) =                   17080005
170900         ASC-START-OF-SELECTED-RANGE)                             17090005
171000                                                                  17100005
171100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17110005
171200                                    ASC-ITEM-SUB) <               17120005
171300             ASC-END-OF-SELECTED-RANGE)                           17130005
171400         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17140005
171500                                    ASC-ITEM-SUB) =               17150005
171600             ASC-END-OF-SELECTED-RANGE)                           17160005
171700                                                                  17170005
171800             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17180005
171900                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17190005
172000                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17200005
172100                               TO TRUE                            17210005
172200                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17220005
172300                               TO TRUE                            17230005
172400                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    17240005
172500             END-IF                                               17250005
172600         END-IF                                                   17260005
172700     END-IF.                                                      17270005
172800                                                                  17280005
172900*----------------------------------------------------------------*17290005
173000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17300005
173100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *17310005
173200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *17320005
173300*    DISPLAY THE PANEL TO USER.                                  *17330005
173400*----------------------------------------------------------------*17340005
173500 4000-BUILD-INITIAL-PANEL.                                        17350005
173600                                                                  17360005
173700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            17370005
173800                                 ASC-BLOCK-ENTRIES (2).           17380005
173900     MOVE +1                 TO ASC-BLK-SUB.                      17390005
174000     SET ASC-ITEMS-LEFT-ON-DB                                     17400005
174100                             TO TRUE.                             17410005
174200                                                                  17420005
174300     MOVE +0                 TO ASC-ITEM-SUB                      17430005
174400                                ASC-NUMBER-OF-ITEMS-READ          17440005
174500                                ASC-NUMBER-OF-SELECTED-ITEMS      17450005
174600                                ASC-HIGHEST-BLOCK-WRITTEN         17460005
174700                                ASC-START-OF-SELECTED-RANGE       17470005
174800                                ASC-END-OF-SELECTED-RANGE         17480005
174900                                ASC-ITEM-AT-TOP-OF-PANEL          17490005
175000                                ASC-TTL-ONHAND                    17500005
175100                                ASC-TTL-INTRNST                   17510064
175110                                ASC-TTL-STORE-EXPECT              17511064
175120                                ASC-TTL-STORE-ON-HAND.            17512064
175200                                                                  17520005
175300     MOVE ASC-SKU            TO DK-SKU.                           17530062
175400     MOVE ASC-UPC-ID         TO DK-UPC-ID.                        17540062
175410     IF ASC-STR-NBR > ZEROES                                      17541062
175420         MOVE ASC-STR-NBR        TO DK-STORE-NBR                  17542062
175430     END-IF.                                                      17543062
175500     INITIALIZE XL001-ITEM-COMMAREA.                              17550062
175600     SET XL001-BY-NUMERIC-SKU TO TRUE.                            17560062
175700     SET XL001-SELECT-SKU     TO TRUE.                            17570062
175800     MOVE ASC-SKU             TO XL001-KEY-SKU.                   17580062
175900                                                                  17590005
176000     CALL PC-XL001-VSM-PGM USING DFHEIBLK                         17600062
176100                                 XL001-COMMAREA                   17610062
176200                                 XL001-ITEM-COMMAREA.             17620062
176300                                                                  17630005
176400     IF XL001-SUCCESSFUL                                          17640062
176500         MOVE XL001-SKU-DESC    TO ASC-SKU-DESC                   17650062
176600         MOVE XL001-ITM-NBR     TO DK-ITM-NBR                     17660062
176700     END-IF.                                                      17670062
176800                                                                  17680005
177000     PERFORM 4010-OPEN-CURSOR.                                    17700005
177100     PERFORM 4300-READ-ITEMS-FROM-DB.                             17710005
177200     PERFORM 4020-CLOSE-CURSOR.                                   17720005
177300                                                                  17730005
177400     MOVE +1                   TO  PV-TOP-ITEM.                   17740005
177500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17750005
177600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    17760005
177700         SET DP020-MSG-FATAL   TO  TRUE                           17770005
177800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               17780005
177900     ELSE                                                         17790005
178000         MOVE -1               TO MR-SELECTL (1)                  17800005
178100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      17810005
178200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17820005
178300     END-IF.                                                      17830005
178400                                                                  17840005
178500*----------------------------------------------------------------*17850005
178600* OPEN THE CURSOR                                                 17860005
178700*----------------------------------------------------------------*17870005
178800 4010-OPEN-CURSOR.                                                17880005
178900     PERFORM                                                      17890005
179000         WITH TEST AFTER                                          17900005
179100         VARYING PV-RETRY-COUNTER                                 17910005
179200         FROM 1 BY 1                                              17920005
179300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17930005
179400                   OR (SQLCODE = ZERO))                           17940005
179500                                                                  17950005
179600         EVALUATE TRUE                                            17960005
179700             WHEN ASC-SKU-CSR                                     17970050
179800                 EXEC SQL                                         17980005
179900                      OPEN SKU-CSR                                17990005
180000                 END-EXEC                                         18000005
180010             WHEN ASC-SKU-STR-CSR                                 18001050
180020                 EXEC SQL                                         18002021
180030                      OPEN SKU-STR-CSR                            18003021
180040                 END-EXEC                                         18004021
180050             WHEN ASC-DC-SKU-CSR                                  18005050
180060                 EXEC SQL                                         18006049
180070                      OPEN DC-SKU-CSR                             18007049
180080                 END-EXEC                                         18008049
180090             WHEN ASC-DC-SKU-STR-CSR                              18009050
180091                 EXEC SQL                                         18009149
180092                      OPEN DC-SKU-STR-CSR                         18009249
180093                 END-EXEC                                         18009349
180100         END-EVALUATE                                             18010005
180200                                                                  18020005
180300         EVALUATE TRUE                                            18030005
180400             WHEN SQLCODE = ZERO                                  18040005
180500             WHEN SQLCODE = -904                                  18050005
180600             WHEN SQLCODE = -913                                  18060005
180700                 CONTINUE                                         18070005
180800             WHEN SQLWARN0 NOT = SPACES                           18080005
180900             WHEN SQLCODE < ZERO                                  18090005
181000             WHEN SQLCODE > ZERO                                  18100005
181100                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       18110005
181200                 MOVE 'OPEN CURSOR PROBLEM    - '                 18120005
181300                                   TO DP013-MESSAGE-TEXT (1)      18130005
181400                 MOVE SQLCA        TO DP013-SQLCA                 18140005
181500                 MOVE 'IN_TRNST'   TO DP013-DB2-TABLE-NAME (1)    18150005
181600                 SET DP013-DB2-ABEND                              18160005
181700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18170005
181800                 PERFORM DP013-0000-PROCESS-ABEND                 18180005
181900         END-EVALUATE                                             18190005
182000     END-PERFORM.                                                 18200005
182100*                                                                 18210005
182200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18220005
182300         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             18230005
182400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   18240005
182500                                   TO DP013-MESSAGE-TEXT (1)      18250005
182600         MOVE SQLCA                TO DP013-SQLCA                 18260005
182700         MOVE 'TSUOBTR '           TO DP013-DB2-TABLE-NAME (1)    18270005
182800         SET DP013-DB2-ABEND                                      18280005
182900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   18290005
183000         PERFORM DP013-0000-PROCESS-ABEND                         18300005
183100     END-IF.                                                      18310005
183200                                                                  18320005
183300*----------------------------------------------------------------*18330005
183400* CLOSE THE CURSOR.                                               18340005
183500*----------------------------------------------------------------*18350005
183600 4020-CLOSE-CURSOR.                                               18360005
183700                                                                  18370005
183800     EVALUATE TRUE                                                18380005
183900         WHEN ASC-SKU-CSR                                         18390050
184000             EXEC SQL                                             18400005
184100                  CLOSE SKU-CSR                                   18410005
184200             END-EXEC                                             18420005
184210         WHEN ASC-SKU-STR-CSR                                     18421050
184220             EXEC SQL                                             18422021
184230                  CLOSE SKU-STR-CSR                               18423021
184240             END-EXEC                                             18424021
184250         WHEN ASC-DC-SKU-CSR                                      18425050
184260             EXEC SQL                                             18426049
184270                  CLOSE DC-SKU-CSR                                18427049
184280             END-EXEC                                             18428049
184290         WHEN ASC-DC-SKU-STR-CSR                                  18429050
184291             EXEC SQL                                             18429149
184292                  CLOSE DC-SKU-STR-CSR                            18429249
184293             END-EXEC                                             18429349
184300     END-EVALUATE.                                                18430005
184400                                                                  18440005
184500     EVALUATE TRUE                                                18450005
184600         WHEN SQLCODE = ZERO                                      18460005
184700         WHEN SQLCODE = +100                                      18470005
184800             CONTINUE                                             18480005
184900         WHEN SQLWARN0 NOT = SPACES                               18490005
185000         WHEN SQLCODE < ZERO                                      18500005
185100         WHEN SQLCODE > ZERO                                      18510005
185200             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          18520005
185300             MOVE 'CLOSE CURSOR PROBLEM   '                       18530005
185400                               TO DP013-MESSAGE-TEXT (1)          18540005
185500             MOVE SQLCA        TO DP013-SQLCA                     18550005
185600             MOVE 'IN_TRNST'   TO DP013-DB2-TABLE-NAME (1)        18560005
185700             SET DP013-DB2-ABEND                                  18570005
185800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18580005
185900             PERFORM DP013-0000-PROCESS-ABEND                     18590005
186000     END-EVALUATE.                                                18600005
186100                                                                  18610005
187710*----------------------------------------------------------------*18771034
187720*    SELECT ONHAND QTY FROM XMKCS001                             *18772034
187730*----------------------------------------------------------------*18773034
187800 4200-SELECT-ONHAND-QTY.                                          18780005
187900     INITIALIZE XM003-ITEM-COMMAREA.                              18790034
188100     SET XM003-ONHAND-YES  TO TRUE.                               18810034
188200                                                                  18820034
188300     MOVE ASC-SKU          TO XM003-KEY-SKU.                      18830034
188310     MOVE PCT00014-LOC-NBR TO XM003-KEY-STR-NBR.                  18831034
188400     MOVE LENGTH OF XM003-ITEM-COMMAREA TO PV-COMMAREA-LENGTH.    18840034
188500                                                                  18850034
188600     EXEC CICS                                                    18860034
188610          LINK                                                    18861034
188620               PROGRAM (PC-XMKCS001)                              18862034
188630              COMMAREA (XM003-ITEM-COMMAREA)                      18863034
188640                LENGTH (PV-COMMAREA-LENGTH)                       18864034
188650                  RESP (PV-CICS-RESPONSE)                         18865034
188660     END-EXEC.                                                    18866034
188670                                                                  18867034
188680     EVALUATE TRUE                                                18868034
188690         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 18869034
188691              EVALUATE TRUE                                       18869134
188692                  WHEN XM003-SUCCESSFUL                           18869234
188693                       MOVE XM003-ONHAND    TO PV-ONHAND-QTY      18869334
188702                  WHEN OTHER                                      18870234
188703                       IF XM003-RETURN-SQLCODE = +100             18870334
188704                           MOVE 0 TO PV-ONHAND-QTY                18870434
188723                       END-IF                                     18872334
188725              END-EVALUATE                                        18872534
188726                                                                  18872634
188727         WHEN OTHER                                               18872734
189600              MOVE '4200-SELECT-ONHAND-QTY' TO DP013-PARAGRAPH    18960005
189700              MOVE 'SELECT FROM XMKCS001 '                        18970034
189800                               TO DP013-MESSAGE-TEXT (1)          18980005
189900              MOVE SQLCA       TO DP013-SQLCA                     18990005
190000              MOVE 'XMKCS001'   TO DP013-DB2-TABLE-NAME (1)       19000034
190100              SET DP013-DB2-ABEND TO TRUE                         19010005
190200              PERFORM DP013-0000-PROCESS-ABEND                    19020005
190300     END-EVALUATE.                                                19030005
190400                                                                  19040005
190520*----------------------------------------------------------------*19052034
190600*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *19060005
190700*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *19070005
190800*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *19080005
190900*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *19090005
191000*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *19100005
191100*                                                                *19110005
191200*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19120005
191300*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19130005
191400*    UPON INITIALIZATION.                                        *19140005
191500*----------------------------------------------------------------*19150005
191600 4300-READ-ITEMS-FROM-DB.                                         19160005
191700                                                                  19170005
191800     PERFORM                                                      19180005
191900         VARYING PV-READ-COUNT                                    19190005
192000         FROM 1 BY 1                                              19200005
192100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19210005
192200            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19220005
192300                                                                  19230005
192400         PERFORM 4310-FETCH                                       19240005
192500                                                                  19250005
192600         IF  ASC-ITEMS-LEFT-ON-DB                                 19260005
192700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19270005
192800                 ADD +1            TO ASC-ITEM-SUB                19280005
192900             ELSE                                                 19290005
193000                 ADD +1            TO ASC-BLK-SUB                 19300005
193100                 MOVE +1           TO ASC-ITEM-SUB                19310005
193200                                                                  19320005
193300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19330005
193400                     MOVE +1       TO ASC-BLK-SUB                 19340005
193500                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           19350005
193600                     PERFORM 5100-WRITE-TEMP-STORAGE              19360005
193700                     MOVE ASC-BLOCK-ENTRIES                       19370005
193800                                   (PC-MAX-BLOCKS-IN-ARRAY)       19380005
193900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19390005
194000                     ADD +1        TO ASC-BLK-SUB                 19400005
194100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19410005
194200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19420005
194300                                                          TO TRUE 19430005
194400                 END-IF                                           19440005
194500             END-IF                                               19450005
194600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    19460005
194700             SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          19470005
194800             MOVE ASC-NUMBER-OF-ITEMS-READ                        19480005
194900                                   TO ASC-LIST-ITEM-NUMBER        19490005
195000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19500005
195100             MOVE PCT00014-LOC-NBR                                19510005
195200                      TO ASC-STORE-NBR (ASC-BLK-SUB ASC-ITEM-SUB) 19520005
195201             MOVE XLT00014-DC-NBR                                 19520144
195202                         TO ASC-DC-NBR (ASC-BLK-SUB ASC-ITEM-SUB) 19520244
195210*                                                                 19521030
195220*** STORE NAME                                                    19522030
195230*                                                                 19523030
195240             PERFORM 4340-GET-STORE-NAME                          19524030
195300             MOVE XL071-LOC-10-ABBR-NM                            19530039
195400                     TO ASC-STORE-NAME (ASC-BLK-SUB ASC-ITEM-SUB) 19540005
195403*                                                                 19540339
195410*** FASHION ON HAND                                               19541021
195420*                                                                 19542021
195500             MOVE ZEROES TO PV-ONHAND-QTY                         19550005
195600             PERFORM 4200-SELECT-ONHAND-QTY                       19560021
195700             MOVE PV-ONHAND-QTY                                   19570005
195800                  TO ASC-FASH-ON-HAND  (ASC-BLK-SUB ASC-ITEM-SUB) 19580021
195901*                                                                 19590121
195902*** INTRANSIT QUANTITY                                            19590221
195903*                                                                 19590321
195905             MOVE PV-INTRANSIT-QTY                                19590521
195906                       TO ASC-INTR-QTY (ASC-BLK-SUB ASC-ITEM-SUB) 19590605
195907             ADD  PV-INTRANSIT-QTY      TO ASC-TTL-INTRNST        19590723
195908*                                                                 19590821
195909*** STORE EXPECTED                                                19590921
195910*                                                                 19591021
195911             MOVE PV-STORE-EXPECTED                               19591121
195912                       TO ASC-STORE-EXPECT                        19591221
195915                          (ASC-BLK-SUB ASC-ITEM-SUB)              19591521
195916             ADD  PV-STORE-EXPECTED    TO ASC-TTL-STORE-EXPECT    19591621
195917*                                                                 19591721
195918*** STORE ON-HAND                                                 19591821
195919*                                                                 19591921
195920***** THERE IS ONLY ONE WAY TO CALCULATE TOTAL STORE ON HAND **** 19592069
195921***** THAT IS TO SUBTRACT TOTAL STORE EXPECTED FROM TOTAL    **** 19592169
195922***** FASHION ON HAND GIVING TOTAL STORE ON HAND. 05/2006    **** 19592269
195923**           IF PV-STORE-EXPECTED > 0                             19592369
195924                 SUBTRACT  PV-STORE-EXPECTED                      19592467
195925                     FROM  PV-ONHAND-QTY                          19592567
195926                   GIVING  PV-STORE-ON-HAND                       19592667
195927**           ELSE                                                 19592769
195928**               COMPUTE  PV-STORE-ON-HAND =                      19592869
195929**                  PV-STORE-EXPECTED +  PV-ONHAND-QTY            19592969
195930**           END-IF                                               19593069
195931             MOVE PV-STORE-ON-HAND                                19593167
195932                       TO ASC-STORE-ON-HAND                       19593267
195933                          (ASC-BLK-SUB ASC-ITEM-SUB)              19593367
195934*                                                                 19593467
195935*** MOST RECENT UPDATE                                            19593567
195936*                                                                 19593667
195937             MOVE PCT00014-LAST-UPD-DTE TO PV-TMST                19593767
195938             MOVE PV-TMST-YY  TO  PV-DISPLAY-YY                   19593867
195939             MOVE PV-TMST-MM  TO  PV-DISPLAY-MM                   19593967
195940             MOVE PV-TMST-DD  TO  PV-DISPLAY-DD                   19594067
195941             MOVE PV-DATE-DISPLAY                                 19594167
195950                   TO ASC-LAST-UPDT (ASC-BLK-SUB ASC-ITEM-SUB)    19595021
196290         END-IF                                                   19629005
196300     END-PERFORM.                                                 19630005
196400                                                                  19640005
196500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19650005
196600         MOVE +1               TO ASC-BLK-SUB                     19660005
196700         PERFORM 5100-WRITE-TEMP-STORAGE                          19670005
196800         ADD +1                TO ASC-BLK-SUB                     19680005
196900         PERFORM 5100-WRITE-TEMP-STORAGE                          19690005
197000                                                                  19700005
197100         MOVE 1                TO ASC-BLK-SUB                     19710005
197200                                  PV-BLOCK-NUMBER                 19720005
197300         PERFORM 4410-READ-TEMP-STORAGE                           19730005
197400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19740005
197500             MOVE 2            TO ASC-BLK-SUB                     19750005
197600                                  PV-BLOCK-NUMBER                 19760005
197700             PERFORM 4410-READ-TEMP-STORAGE                       19770005
197800         END-IF                                                   19780005
197900     END-IF.                                                      19790005
198000                                                                  19800005
198100*----------------------------------------------------------------*19810005
198200*    FETCH THE CURSOR                                             19820005
198300*----------------------------------------------------------------*19830005
198400 4310-FETCH.                                                      19840005
198500     EVALUATE TRUE                                                19850005
198510                                                                  19851021
198600         WHEN ASC-SKU-CSR                                         19860050
198700             EXEC SQL                                             19870005
198800                  FETCH SKU-CSR                                   19880005
199000                   INTO  :PCT00014-LOC-NBR                        19900021
199100                        ,:PCT00014-LAST-UPD-DTE                   19910021
199200                        ,:XLT00014-DC-NBR                         19920047
199500             END-EXEC                                             19950005
199600                                                                  19960005
199700         WHEN ASC-SKU-STR-CSR                                     19970050
199710             EXEC SQL                                             19971021
199720                  FETCH SKU-STR-CSR                               19972021
199730                   INTO  :PCT00014-LOC-NBR                        19973021
199740                        ,:PCT00014-LAST-UPD-DTE                   19974021
199750                        ,:XLT00014-DC-NBR                         19975048
199760             END-EXEC                                             19976021
200996                                                                  20099621
200997         WHEN ASC-DC-SKU-CSR                                      20099750
200998             EXEC SQL                                             20099849
200999                  FETCH DC-SKU-CSR                                20099949
201000                   INTO  :PCT00014-LOC-NBR                        20100049
201001                        ,:PCT00014-LAST-UPD-DTE                   20100149
201002                        ,:XLT00014-DC-NBR                         20100249
201003             END-EXEC                                             20100349
201004                                                                  20100449
201005         WHEN ASC-DC-SKU-STR-CSR                                  20100550
201006             EXEC SQL                                             20100649
201007                  FETCH DC-SKU-STR-CSR                            20100749
201008                   INTO  :PCT00014-LOC-NBR                        20100849
201009                        ,:PCT00014-LAST-UPD-DTE                   20100949
201010                        ,:XLT00014-DC-NBR                         20101049
201011             END-EXEC                                             20101149
201012                                                                  20101249
201013     END-EVALUATE.                                                20101349
201014                                                                  20101449
201015     EVALUATE TRUE                                                20101549
201016         WHEN SQLCODE = ZERO                                      20101649
201017              PERFORM 4320-GET-INTRANSIT                          20101749
201020              PERFORM 4330-GET-STORE-EXPECTED                     20102021
201030                                                                  20103021
201100         WHEN SQLCODE = +100                                      20110005
201110              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 20111021
201200                                                                  20120021
201300         WHEN SQLWARN0 NOT = SPACE                                20130005
201400         WHEN SQLCODE NOT = ZERO                                  20140005
201500              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         20150005
201600              MOVE 'FETCH CURSOR PROBLEM '                        20160005
201700                               TO DP013-MESSAGE-TEXT (1)          20170005
201800              MOVE SQLCA       TO DP013-SQLCA                     20180005
201900              MOVE 'IN_TRNST'   TO DP013-DB2-TABLE-NAME (1)       20190005
202000              SET DP013-DB2-ABEND TO TRUE                         20200005
202100              PERFORM DP013-0000-PROCESS-ABEND                    20210005
202200     END-EVALUATE.                                                20220005
202300                                                                  20230005
202701                                                                  20270121
202702*----------------------------------------------------------------*20270221
202703* GET INTRANSIT QUANTITY                                         *20270321
202704*----------------------------------------------------------------*20270421
202710 4320-GET-INTRANSIT.                                              20271021
202711                                                                  20271121
202712     EXEC SQL                                                     20271221
202713          SELECT  TRN_CLSN_QTY                                    20271321
202714            INTO :PV-INTRANSIT-QTY                                20271421
202715            FROM  PCT_TRN_CLSN_BAL                                20271521
202717           WHERE  INTR_UPC_ID       =  :DK-UPC-ID                 20271721
202718             AND  LOC_NBR           =  :PCT00014-LOC-NBR          20271821
202719             AND  TRN_CLSN_CDE      =  'IT'                       20271921
202720     END-EXEC.                                                    20272021
202721                                                                  20272121
202722     EVALUATE TRUE                                                20272221
202723         WHEN SQLCODE = ZERO                                      20272321
202724              CONTINUE                                            20272421
202726                                                                  20272621
202727         WHEN SQLCODE = +100                                      20272721
202728              MOVE ZEROES  TO  PV-INTRANSIT-QTY                   20272821
202729                                                                  20272921
202730         WHEN OTHER                                               20273021
202733              MOVE ASC-SKU           TO  PV-DISPLAY-SKU           20273321
202734              MOVE DK-UPC-ID         TO  PV-DISPLAY-UPC-ID        20273421
202735              MOVE PCT00014-LOC-NBR  TO  PV-DISPLAY-STORE         20273521
202737              MOVE '4320-GET-INTRANSIT' TO DP013-PARAGRAPH        20273721
202738              MOVE 'GET INTRANSIT QTY    '                        20273821
202739                               TO DP013-MESSAGE-TEXT (1)          20273921
202740              STRING 'SKU='    PV-DISPLAY-SKU     '  '            20274021
202741                     'UPC-ID=' PV-DISPLAY-UPC-ID  '  '            20274121
202742                     'STORE='  PV-DISPLAY-STORE                   20274221
202743                                  DELIMITED BY SIZE               20274321
202744                             INTO DP013-MESSAGE-TEXT (2)          20274421
202745              MOVE SQLCA       TO DP013-SQLCA                     20274521
202746              MOVE 'IN_TRNST'   TO DP013-DB2-TABLE-NAME (1)       20274621
202747              SET DP013-DB2-ABEND TO TRUE                         20274721
202748              PERFORM DP013-0000-PROCESS-ABEND                    20274821
202749     END-EVALUATE.                                                20274921
202750                                                                  20275021
202751                                                                  20275121
202752*----------------------------------------------------------------*20275221
202753* GET STORE EXPECTED QUANTITY                                    *20275321
202754*----------------------------------------------------------------*20275421
202755 4330-GET-STORE-EXPECTED.                                         20275521
202756                                                                  20275621
202757     EXEC SQL                                                     20275721
202758          SELECT  TRN_CLSN_QTY                                    20275821
202760            INTO :PV-STORE-EXPECTED                               20276021
202761            FROM  PCT_TRN_CLSN_BAL                                20276121
202762           WHERE  INTR_UPC_ID       =  :DK-UPC-ID                 20276221
202763             AND  LOC_NBR           =  :PCT00014-LOC-NBR          20276321
202764             AND  TRN_CLSN_CDE      =  'SE'                       20276421
202765     END-EXEC.                                                    20276521
202766                                                                  20276621
202767     EVALUATE TRUE                                                20276721
202768         WHEN SQLCODE = ZERO                                      20276821
202769              CONTINUE                                            20276921
202770                                                                  20277021
202771         WHEN SQLCODE = +100                                      20277121
202772              MOVE ZEROES  TO  PV-STORE-EXPECTED                  20277221
202773                                                                  20277321
202774         WHEN OTHER                                               20277421
202775              MOVE ASC-SKU           TO  PV-DISPLAY-SKU           20277521
202776              MOVE DK-UPC-ID         TO  PV-DISPLAY-UPC-ID        20277621
202777              MOVE PCT00014-LOC-NBR  TO  PV-DISPLAY-STORE         20277721
202778              MOVE '4330-GET-STORE-EXPECTED' TO DP013-PARAGRAPH   20277821
202779              MOVE 'GET STORE EXPECTED QUANTITY '                 20277921
202780                               TO DP013-MESSAGE-TEXT (1)          20278021
202781              STRING 'SKU='    PV-DISPLAY-SKU     '  '            20278121
202782                     'UPC-ID=' PV-DISPLAY-UPC-ID  '  '            20278221
202783                     'STORE='  PV-DISPLAY-STORE                   20278321
202784                                  DELIMITED BY SIZE               20278421
202785                             INTO DP013-MESSAGE-TEXT (2)          20278521
202786              MOVE SQLCA       TO DP013-SQLCA                     20278621
202787              MOVE 'IN_TRNST'   TO DP013-DB2-TABLE-NAME (1)       20278721
202788              SET DP013-DB2-ABEND TO TRUE                         20278821
202789              PERFORM DP013-0000-PROCESS-ABEND                    20278921
202790     END-EVALUATE.                                                20279021
202791                                                                  20279121
202792*----------------------------------------------------------------*20279230
202793* GET STORE NAME                                                 *20279330
202794*----------------------------------------------------------------*20279430
202795 4340-GET-STORE-NAME.                                             20279530
202796                                                                  20279630
202797     INITIALIZE XL071-COMMAREA-REC.                               20279739
202798     MOVE PCT00014-LOC-NBR       TO XL071-LOCATION-NUMBER.        20279839
202800                                                                  20280039
202801     CALL PC-LOCATION-MODULE  USING DFHEIBLK                      20280141
202802                                    XL071-COMMAREA                20280239
202803                                    XL071-COMMAREA-REC.           20280339
202804     EVALUATE TRUE                                                20280439
202805         WHEN XL071-NO-ERRORS                                     20280539
202806              CONTINUE                                            20280639
202807         WHEN XL071-LOC-NOT-FOUND                                 20280739
202808              MOVE 'NO NAME'  TO  XL071-LOC-10-ABBR-NM            20280839
202809              MOVE ZEROES     TO  XL071-ASGMT-DC-NBR              20280939
202811         WHEN XL071-BAD-DB2-RETURN                                20281139
202812              MOVE ASC-SKU           TO  PV-DISPLAY-SKU           20281239
202813              MOVE DK-UPC-ID         TO  PV-DISPLAY-UPC-ID        20281339
202814              MOVE PCT00014-LOC-NBR  TO  PV-DISPLAY-STORE         20281439
202815              MOVE '4340-GET-STORE-NAME' TO DP013-PARAGRAPH       20281539
202816              MOVE 'GET STORE NAME USING LOCATION MODULE'         20281639
202817                               TO DP013-MESSAGE-TEXT (1)          20281739
202818              STRING 'SKU='    PV-DISPLAY-SKU     '  '            20281839
202819                     'UPC-ID=' PV-DISPLAY-UPC-ID  '  '            20281939
202820                     'STORE='  PV-DISPLAY-STORE                   20282039
202821                                  DELIMITED BY SIZE               20282139
202822                             INTO DP013-MESSAGE-TEXT (2)          20282239
202823              MOVE SQLCA       TO DP013-SQLCA                     20282339
202824              MOVE 'XLT_LOC'   TO DP013-DB2-TABLE-NAME (1)        20282439
202825              SET DP013-DB2-ABEND TO TRUE                         20282539
202826              PERFORM DP013-0000-PROCESS-ABEND                    20282639
202827     END-EVALUATE.                                                20282739
202829                                                                  20282930
202850*----------------------------------------------------------------*20285005
202900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *20290005
203000*----------------------------------------------------------------*20300005
203100 4400-MOVE-COMMAREA-TO-SCREEN.                                    20310005
203200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             20320005
203300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          20330005
203400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          20340005
203500             MOVE +1    TO ASC-BLK-SUB                            20350005
203600             PERFORM 5100-WRITE-TEMP-STORAGE                      20360005
203700             ADD +1     TO ASC-BLK-SUB                            20370005
203800             PERFORM 5100-WRITE-TEMP-STORAGE                      20380005
203900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             20390005
204000                 GIVING PV-BLOCK-NUMBER                           20400005
204100                 REMAINDER PV-REMAINDER                           20410005
204200             IF  PV-REMAINDER > ZERO                              20420005
204300                 ADD +1 TO PV-BLOCK-NUMBER                        20430005
204400             END-IF                                               20440005
204500             MOVE +1    TO ASC-BLK-SUB                            20450005
204600             PERFORM 4410-READ-TEMP-STORAGE                       20460005
204700             ADD +1     TO ASC-BLK-SUB                            20470005
204800                           PV-BLOCK-NUMBER                        20480005
204900             PERFORM 4410-READ-TEMP-STORAGE                       20490005
205000     END-IF.                                                      20500005
205100     MOVE +1            TO ASC-BLK-SUB.                           20510005
205200     COMPUTE ASC-ITEM-SUB =                                       20520005
205300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              20530005
205400         + PC-ITEMS-PER-PANEL).                                   20540005
205500*                                                                 20550005
205600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        20560005
205700         ADD +1         TO ASC-BLK-SUB                            20570005
205800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            20580005
205900     END-IF.                                                      20590005
206000*                                                                 20600005
206100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           20610005
206200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                20620005
206300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        20630005
206400     PERFORM 4420-FORMAT-LIST-LINES                               20640005
206500         VARYING PV-SUB                                           20650005
206600         FROM PC-ITEMS-PER-PANEL BY -1                            20660005
206700         UNTIL PV-SUB < +1.                                       20670005
206800*                                                                 20680005
206900     COMPUTE ASC-ITEMS-DISPLAYED =                                20690005
207000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          20700005
207100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    20710005
207200                                      ASTRTITO.                   20720005
207300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    20730005
207400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    20740005
207500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20750005
207600                                   TO ASELITO.                    20760005
207700                                                                  20770005
207800     MOVE ASC-SKU                    TO ASKUO.                    20780005
207900     MOVE ASC-SKU-DESC               TO ADESCO.                   20790005
207910     MOVE ZEROES TO PV-ONHAND-QTY.                                20791034
207911     MOVE 0  TO  PCT00014-LOC-NBR.                                20791134
207920     PERFORM 4200-SELECT-ONHAND-QTY.                              20792034
208000     MOVE PV-ONHAND-QTY              TO AFASHO.                   20800034
208001***** THERE IS ONLY ONE WAY TO CALCULATE TOTAL STORE ON HAND **** 20800169
208002***** THAT IS TO SUBTRACT TOTAL STORE EXPECTED FROM TOTAL    **** 20800269
208003***** FASHION ON HAND GIVING TOTAL STORE ON HAND. 05/2006    **** 20800369
208010**   IF ASC-TTL-STORE-EXPECT > 0                                  20801069
208011           SUBTRACT ASC-TTL-STORE-EXPECT                          20801168
208020               FROM  PV-ONHAND-QTY                                20802068
208030             GIVING  ASC-TTL-STORE-ON-HAND                        20803068
208040**   ELSE                                                         20804069
208041**       COMPUTE  ASC-TTL-STORE-ON-HAND  =                        20804169
208050**         ASC-TTL-STORE-EXPECT  + PV-ONHAND-QTY                  20805069
208080**   END-IF.                                                      20808069
208100     MOVE ASC-TTL-INTRNST            TO ATRANO.                   20810005
208101     MOVE ASC-TTL-STORE-EXPECT       TO AEXPTO.                   20810121
208102     MOVE ASC-TTL-STORE-ON-HAND      TO ASTORO.                   20810221
208200                                                                  20820005
208210     EVALUATE TRUE                                                20821053
208220         WHEN  ASC-SKU-CSR                                        20822053
208230             MOVE 'STORE ORDER         '      TO  ATITLEO         20823053
208240         WHEN ASC-SKU-STR-CSR                                     20824053
208241             MOVE 'STORE ORDER         '      TO  ATITLEO         20824153
208260         WHEN  ASC-DC-SKU-CSR                                     20826053
208261             MOVE 'DC STORE ORDER      '      TO  ATITLEO         20826153
208280         WHEN ASC-DC-SKU-STR-CSR                                  20828053
208281             MOVE 'DC STORE ORDER      '      TO  ATITLEO         20828153
208291     END-EVALUATE.                                                20829153
208292                                                                  20829253
208300     IF  DP020-MSG-NUMBER-X = SPACE                               20830005
208400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  20840005
208500*            --- MORE ITEMS TO DISPLAY ----                       20850005
208600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            20860005
208700             SET DP020-MSG-INFORMATIONAL TO TRUE                  20870005
208800         END-IF                                                   20880005
208900     END-IF.                                                      20890005
209000                                                                  20900005
209100*----------------------------------------------------------------*20910005
209200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *20920005
209300*----------------------------------------------------------------*20930005
209400 4410-READ-TEMP-STORAGE.                                          20940005
209500                                                                  20950005
209600     EXEC CICS                                                    20960005
209700         READQ TS                                                 20970005
209800             QUEUE (ASC-LIST-QUEUE-NAME)                          20980005
209900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20990005
210000             ITEM  (PV-BLOCK-NUMBER)                              21000005
210100             RESP  (PV-CICS-RESP)                                 21010005
210200     END-EXEC.                                                    21020005
210300                                                                  21030005
210400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       21040005
210500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     21050005
210600         CONTINUE                                                 21060005
210700     ELSE                                                         21070005
210800         SET DP013-CICS-ABEND     TO TRUE                         21080005
210900         SET DP013-NO-ROLLBACK    TO TRUE                         21090005
211000         MOVE '4410-READ-TEMP-STORAGE'                            21100005
211100                                  TO DP013-PARAGRAPH              21110005
211200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      21120005
211300                                  TO DP013-MESSAGE-TEXT(1)        21130005
211400         PERFORM DP013-0000-PROCESS-ABEND                         21140005
211500     END-IF.                                                      21150005
211600                                                                  21160005
211700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             21170005
211800*                                                                 21180005
211900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         21190005
212000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               21200005
212100     END-IF.                                                      21210005
212200                                                                  21220005
212300*----------------------------------------------------------------*21230005
212400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *21240005
212500*----------------------------------------------------------------*21250005
212600 4420-FORMAT-LIST-LINES.                                          21260005
212700     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      21270005
212800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                21280005
212900         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           21290005
213000         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           21300005
213100         MOVE SPACE              TO MR-SELECTI (PV-SUB)           21310005
213200                                    MR-ACTION (PV-SUB)            21320005
213400                                    MR-STORE-NBR  (PV-SUB)        21340005
213401                                    MR-DC-NBR  (PV-SUB)           21340142
213410                                    MR-STORE-NAME (PV-SUB)        21341042
213500                                    MR-FASH-ON-HAND (PV-SUB)      21350019
213600                                    MR-INTR-QTY   (PV-SUB)        21360005
213700                                    MR-LAST-UPDATE (PV-SUB)       21370005
213800                                    MR-STR-EXPECTED (PV-SUB)      21380033
213810                                    MR-STR-ON-HAND (PV-SUB)       21381033
213900     ELSE                                                         21390005
214000         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21400005
214100                                                   > SPACE        21410005
214200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21420005
214300                                 TO MR-SELECTI (PV-SUB)           21430005
214400         ELSE                                                     21440005
214500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21450005
214600                                 TO MR-SELECTI (PV-SUB)           21460005
214700         END-IF                                                   21470005
214800         IF  DP030-SET-CURSOR-TRAILER                             21480005
214900             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)21490005
215000                 > SPACE)                                         21500005
215100               OR (PV-SUB = 1))                                   21510005
215200                SET DP030-SET-CURSOR-APPL-1 TO TRUE               21520005
215300                MOVE -1          TO MR-SELECTL (PV-SUB)           21530019
215400             END-IF                                               21540005
215500         END-IF                                                   21550005
215600*                                                                 21560005
215700         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               21570005
215800                                 TO MR-ACTION (PV-SUB)            21580019
215900         MOVE ASC-STORE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)            21590005
216000                                 TO  MR-STORE-NBR  (PV-SUB)       21600019
216010         MOVE ASC-DC-NBR (ASC-BLK-SUB ASC-ITEM-SUB)               21601042
216020                                 TO  MR-DC-NBR  (PV-SUB)          21602042
216100         MOVE ASC-STORE-NAME  (ASC-BLK-SUB ASC-ITEM-SUB)          21610005
216200                                 TO MR-STORE-NAME (PV-SUB)        21620019
216300         MOVE ASC-FASH-ON-HAND  (ASC-BLK-SUB ASC-ITEM-SUB)        21630021
216400                                 TO MR-FASH-ON-HAND-N (PV-SUB)    21640019
216500         MOVE ASC-INTR-QTY (ASC-BLK-SUB ASC-ITEM-SUB)             21650005
216600                                 TO MR-INTR-QTY-N (PV-SUB)        21660019
216610         MOVE ASC-STORE-EXPECT (ASC-BLK-SUB ASC-ITEM-SUB)         21661021
216620                                 TO MR-STR-EXPECTED-N (PV-SUB)    21662021
216630         MOVE ASC-STORE-ON-HAND (ASC-BLK-SUB ASC-ITEM-SUB)        21663021
216640                                 TO MR-STR-ON-HAND-N (PV-SUB)     21664021
216700         MOVE ASC-LAST-UPDT (ASC-BLK-SUB ASC-ITEM-SUB)            21670005
216800                                 TO MR-LAST-UPDATE (PV-SUB)       21680019
217100     END-IF.                                                      21710005
217200     SUBTRACT +1 FROM ASC-ITEM-SUB                                21720005
217300     IF  ASC-ITEM-SUB < + 1                                       21730005
217400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  21740005
217500         MOVE +1                 TO ASC-BLK-SUB                   21750005
217600     END-IF.                                                      21760005
217700                                                                  21770005
217800******************************************************************21780005
217900** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **21790005
218000** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **21800005
218100** ISSUE A WARNING.                                             **21810005
218200******************************************************************21820005
218300 4430-CHECK-FOR-BEGIN-AND-END.                                    21830005
218400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       21840005
218500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     21850005
218600*            -- NO END-OF-RANGE SPECFIED ---                      21860005
218700             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            21870005
218800             SET DP020-MSG-WARNING TO TRUE                        21880005
218900             PERFORM 4431-POSITION-AT-WARNING                     21890005
219000         END-IF                                                   21900005
219100     ELSE                                                         21910005
219200         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     21920005
219300*            -- NO BEGINNING-OF-RANGE SPECFIED ---                21930005
219400             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            21940005
219500             SET DP020-MSG-WARNING TO TRUE                        21950005
219600             PERFORM 4431-POSITION-AT-WARNING                     21960005
219700         END-IF                                                   21970005
219800     END-IF.                                                      21980005
219900******************************************************************21990005
220000** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **22000005
220100** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **22010005
220200** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **22020005
220300** POSITION THE CURSOR THERE.                                   **22030005
220400******************************************************************22040005
220500 4431-POSITION-AT-WARNING.                                        22050005
220600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 22060005
220700                    - PV-TOP-ITEM + 1.                            22070005
220800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      22080005
220900         CONTINUE                                                 22090005
221000     ELSE                                                         22100005
221100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      22110005
221200         MOVE -1                   TO MR-SELECTL (PV-SUB)         22120005
221300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22130005
221400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22140005
221500     END-IF.                                                      22150005
221600*                                                                 22160005
221700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   22170005
221800                    - PV-TOP-ITEM + 1.                            22180005
221900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      22190005
222000         CONTINUE                                                 22200005
222100     ELSE                                                         22210005
222200         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      22220005
222300         MOVE -1                   TO MR-SELECTL (PV-SUB)         22230005
222400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22240005
222500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22250005
222600     END-IF.                                                      22260005
222700                                                                  22270005
222800*----------------------------------------------------------------*22280005
222900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *22290005
223000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *22300005
223100* FOR THE SELECTED ITEMS QUEUE.                                  *22310005
223200*                                                                *22320005
223300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *22330005
223400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *22340005
223500* THE ARRAY IS FULL.                                             *22350005
223600*----------------------------------------------------------------*22360005
223700 5000-PREPARE-SEL-QUEUE.                                          22370005
223800                                                                  22380005
223900     MOVE +1                   TO  ASC-BLK-SUB.                   22390005
224000     PERFORM 5100-WRITE-TEMP-STORAGE.                             22400005
224100     ADD +1                    TO  ASC-BLK-SUB.                   22410005
224200     PERFORM 5100-WRITE-TEMP-STORAGE.                             22420005
224300                                                                  22430005
224400     MOVE ASC-SEL-QUEUE-NAME   TO  PC211-SEL-QUEUE-NAME.          22440005
224500     PERFORM 6010-DELETE-SEL-QUEUE.                               22450005
224600                                                                  22460005
224700     SET ASC-UPDATE-TSQ        TO  TRUE.                          22470005
224800                                                                  22480005
224900     SET PC212-IDX             TO  1.                             22490005
225000     MOVE ZERO                 TO PC211-NUMBER-OF-TS-ITEMS.       22500005
225100     INITIALIZE PC212-SELECTED-ITEM-ARRAY.                        22510005
225200                                                                  22520005
225300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           22530005
225400             VARYING PV-ITEM                                      22540005
225500             FROM 1 BY 1                                          22550005
225600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     22560005
225700                                                                  22570005
225800     IF  PC212-IDX > 1                                            22580005
225900         PERFORM 5205-WRITE-SEL-QUEUE                             22590005
226000         ADD +1                TO PC211-NUMBER-OF-TS-ITEMS        22600005
226100     END-IF.                                                      22610005
226200*----------------------------------------------------------------*22620005
226300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *22630005
226400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *22640005
226500*----------------------------------------------------------------*22650005
226600 5100-WRITE-TEMP-STORAGE.                                         22660005
226700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     22670005
226800                                   TO PV-LIST-ITEM-NUMBER.        22680005
226900     COMPUTE PV-BLOCK-NUMBER =                                    22690005
227000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22700005
227100                                                                  22710005
227200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             22720005
227300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             22730005
227400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      22740005
227500             PERFORM 5105-REWRITE-ASC-LISTQ                       22750005
227600         END-IF                                                   22760005
227700     ELSE                                                         22770005
227800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22780005
227900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            22790005
228000         PERFORM 5110-WRITE-ASC-LISTQ                             22800005
228100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   22810005
228200     END-IF.                                                      22820005
228300                                                                  22830005
228400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22840005
228500                                                                  22850005
228600******************************************************************22860005
228700** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **22870005
228800** SPECIFIC COMMAREA.                                           **22880005
228900******************************************************************22890005
229000 5105-REWRITE-ASC-LISTQ.                                          22900005
229100     EXEC CICS                                                    22910005
229200         WRITEQ TS                                                22920005
229300             QUEUE (ASC-LIST-QUEUE-NAME)                          22930005
229400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22940005
229500             ITEM  (PV-BLOCK-NUMBER)                              22950005
229600             REWRITE                                              22960005
229700             RESP  (PV-CICS-RESP)                                 22970005
229800     END-EXEC.                                                    22980005
229900                                                                  22990005
230000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           23000005
230100         CONTINUE                                                 23010005
230200     ELSE                                                         23020005
230300         SET DP013-CICS-ABEND            TO TRUE                  23030005
230400         SET DP013-NO-ROLLBACK           TO TRUE                  23040005
230500         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       23050005
230600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     23060005
230700                                         TO DP013-MESSAGE-TEXT(1) 23070005
230800         PERFORM DP013-0000-PROCESS-ABEND                         23080005
230900     END-IF.                                                      23090005
231000                                                                  23100005
231100******************************************************************23110005
231200** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **23120005
231300** SPECIFIC COMMAREA.                                           **23130005
231400******************************************************************23140005
231500 5110-WRITE-ASC-LISTQ.                                            23150005
231600     EXEC CICS                                                    23160005
231700         WRITEQ TS                                                23170005
231800             QUEUE (ASC-LIST-QUEUE-NAME)                          23180005
231900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23190005
232000             ITEM  (PV-BLOCK-NUMBER)                              23200005
232100             RESP  (PV-CICS-RESP)                                 23210005
232200     END-EXEC.                                                    23220005
232300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      23230005
232400         SET DP013-CICS-ABEND      TO TRUE                        23240005
232500         SET DP013-NO-ROLLBACK     TO TRUE                        23250005
232600         MOVE '5110-WRITE-ASC-LISTQ'                              23260005
232700                                   TO DP013-PARAGRAPH             23270005
232800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           23280005
232900                                   TO DP013-MESSAGE-TEXT(1)       23290005
233000         PERFORM DP013-0000-PROCESS-ABEND                         23300005
233100     END-IF.                                                      23310005
233200                                                                  23320005
233300*----------------------------------------------------------------*23330005
233400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *23340005
233500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *23350005
233600*----------------------------------------------------------------*23360005
233700 5200-FILL-SEL-QUEUE-RECORD.                                      23370005
233800                                                                  23380005
233900     PERFORM 6112-READ-LIST-QUEUE.                                23390005
234000                                                                  23400005
234100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       23410005
234200         PERFORM                                                  23420005
234300         VARYING LQW-IDX                                          23430005
234400         FROM 1 BY 1                                              23440005
234500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            23450005
234600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          23460005
234700                                                                  23470005
234800             IF  LQW-SELECT (LQW-IDX)                             23480005
234900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              23490005
235000                             TO PC212-ITEM (PC212-IDX)            23500021
235100                 MOVE SPACE  TO PC212-ACTION-SW (PC212-IDX)       23510021
235200                                                                  23520028
235300                 MOVE LQW-STORE-NBR     (LQW-IDX)                 23530005
235400                             TO PC212-STORE-NBR (PC212-IDX)       23540021
235500                 MOVE LQW-STORE-NAME (LQW-IDX)                    23550005
235600                             TO PC212-STORE-NAME (PC212-IDX)      23560021
235700                 MOVE LQW-FASH-ON-HAND  (LQW-IDX)                 23570021
235800                             TO PC212-FASH-ON-HAND (PC212-IDX)    23580021
235900                 MOVE LQW-INTR-QTY  (LQW-IDX)                     23590005
236000                             TO PC212-INTR-QTY (PC212-IDX)        23600021
236010                 MOVE LQW-STORE-EXPECT (LQW-IDX)                  23601028
236020                             TO PC212-STORE-EXPECTED (PC212-IDX)  23602021
236030                 MOVE LQW-STORE-ON-HAND (LQW-IDX)                 23603028
236040                             TO PC212-STORE-ON-HAND (PC212-IDX)   23604021
236100                 MOVE LQW-LAST-UPDATE  (LQW-IDX)                  23610005
236200                             TO PC212-LAST-UPDT (PC212-IDX)       23620021
236500                                                                  23650005
236600                 SET PC212-IDX UP BY 1                            23660005
236700                 IF  PC212-IDX > PC212-MAX-ITEMS                  23670005
236800                     PERFORM 5205-WRITE-SEL-QUEUE                 23680005
236900                     ADD +1        TO PC211-NUMBER-OF-TS-ITEMS    23690005
237000                     INITIALIZE PC212-SELECTED-ITEM-ARRAY         23700005
237100                     SET PC212-IDX TO  1                          23710005
237200                 END-IF                                           23720005
237300             END-IF                                               23730005
237400         END-PERFORM                                              23740005
237500     END-IF.                                                      23750005
237600                                                                  23760005
237700*----------------------------------------------------------------*23770005
237800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *23780005
237900*----------------------------------------------------------------*23790005
238000 5205-WRITE-SEL-QUEUE.                                            23800005
238100                                                                  23810005
238200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23820005
238300                                   TO PC212-SELECTED-ITEMS.       23830005
238400                                                                  23840005
238500     EXEC CICS                                                    23850005
238600          WRITEQ TS                                               23860005
238700              QUEUE (ASC-SEL-QUEUE-NAME)                          23870005
238800              FROM  (PC212-SELECT-RECORD)                         23880005
238900              ITEM  (PV-SEL-QUEUE-ITEM)                           23890005
239000              RESP  (PV-CICS-RESP)                                23900005
239100     END-EXEC.                                                    23910005
239200                                                                  23920005
239300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23930005
239400         CONTINUE                                                 23940005
239500     ELSE                                                         23950005
239600         SET DP013-CICS-ABEND      TO TRUE                        23960005
239700         SET DP013-NO-ROLLBACK     TO TRUE                        23970005
239800         MOVE '5205-WRITE-SEL-QUEUE'                              23980005
239900                                   TO DP013-PARAGRAPH             23990005
240000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          24000005
240100                                   TO DP013-MESSAGE-TEXT(1)       24010005
240200         PERFORM DP013-0000-PROCESS-ABEND                         24020005
240300     END-IF.                                                      24030005
240400******************************************************************24040005
240500** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **24050005
240600** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **24060005
240700** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **24070005
240800** THE USER.                                                    **24080005
240900******************************************************************24090005
241000 6000-REFRESH-PANEL-FROM-TEMP.                                    24100005
241100     IF  ASC-UPDATE-TSQ                                           24110005
241200         SET ASC-NO-TSQ-UPDATE TO TRUE                            24120005
241300         MOVE ZERO                 TO PV-SAVE-ITEM                24130005
241400                                      PV-SEL-QUEUE-ITEM           24140005
241500         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        24150005
241600                                   TO PV-HOLD-SELECTED-ITEMS      24160005
241700         MOVE +1                   TO PV-ITEMS-PROCESSED          24170005
241800         PERFORM 6100-UPDATE-TSQ                                  24180005
241900             UNTIL PV-ITEMS-PROCESSED >                           24190005
242000                                     PV-HOLD-SELECTED-ITEMS       24200005
242100         INITIALIZE ASC-BLOCK-ENTRIES (1)                         24210005
242200                    ASC-BLOCK-ENTRIES (2)                         24220005
242300     END-IF.                                                      24230005
242400                                                                  24240005
242500*----------------------------------------------------------------*24250005
242600*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *24260005
242700*----------------------------------------------------------------*24270005
242800 6010-DELETE-SEL-QUEUE.                                           24280005
242900                                                                  24290005
243000     EXEC CICS                                                    24300005
243100         DELETEQ TS                                               24310005
243200             QUEUE (ASC-SEL-QUEUE-NAME)                           24320005
243300             RESP  (PV-CICS-RESP)                                 24330005
243400     END-EXEC.                                                    24340005
243500*                                                                 24350005
243600     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      24360005
243700        (PV-CICS-RESP = DFHRESP(QIDERR)))                         24370005
243800         CONTINUE                                                 24380005
243900     ELSE                                                         24390005
244000         SET DP013-CICS-ABEND TO TRUE                             24400005
244100         SET DP013-NO-ROLLBACK TO TRUE                            24410005
244200         MOVE '6010-DELETE-SEL-QUEUE'                             24420005
244300                        TO DP013-PARAGRAPH                        24430005
244400         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         24440005
244500                        TO DP013-MESSAGE-TEXT (1)                 24450005
244600         PERFORM DP013-0000-PROCESS-ABEND                         24460005
244700     END-IF.                                                      24470005
244800                                                                  24480005
244900*----------------------------------------------------------------*24490005
245000*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *24500005
245100*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *24510005
245200*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *24520005
245300*    THE TEMP QUEUE.                                             *24530005
245400*----------------------------------------------------------------*24540005
245500 6100-UPDATE-TSQ.                                                 24550005
245600                                                                  24560005
245700     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             24570005
245800     PERFORM 6150-READ-SEL-QUEUE.                                 24580005
245900     PERFORM                                                      24590005
246000         VARYING PC212-IDX                                        24600005
246100         FROM 1 BY 1                                              24610005
246200         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     24620005
246300         OR (PC212-IDX GREATER THAN PC212-MAX-ITEMS))             24630005
246400         IF  PC212-ACTION-SW (PC212-IDX) > SPACE                  24640005
246500             PERFORM 6110-PROCESS-ITEMS                           24650005
246600         END-IF                                                   24660005
246700         ADD +1                TO PV-ITEMS-PROCESSED              24670005
246800     END-PERFORM.                                                 24680005
246900     PERFORM 6111-WRITE-LIST-QUEUE.                               24690005
247000                                                                  24700005
247100*----------------------------------------------------------------*24710005
247200*    READ THE LIST QUEUE RECORD.                                 *24720005
247300*----------------------------------------------------------------*24730005
247400 6150-READ-SEL-QUEUE.                                             24740005
247500                                                                  24750005
247600     EXEC CICS                                                    24760005
247700          READQ TS                                                24770005
247800              QUEUE (ASC-SEL-QUEUE-NAME)                          24780005
247900              INTO  (PC212-SELECT-RECORD)                         24790005
248000              ITEM  (PV-SEL-QUEUE-ITEM)                           24800005
248100              RESP  (PV-CICS-RESP)                                24810005
248200     END-EXEC.                                                    24820005
248300*                                                                 24830005
248400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24840005
248500         CONTINUE                                                 24850005
248600     ELSE                                                         24860005
248700         SET DP013-CICS-ABEND      TO  TRUE                       24870005
248800         SET DP013-NO-ROLLBACK     TO  TRUE                       24880005
248900         MOVE '6150-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           24890005
249000         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           24900005
249100                                   TO  DP013-MESSAGE-TEXT(1)      24910005
249200         PERFORM DP013-0000-PROCESS-ABEND                         24920005
249300     END-IF.                                                      24930005
249400                                                                  24940005
249500*----------------------------------------------------------------*24950005
249600*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*24960005
249700*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*24970005
249800*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *24980005
249900*----------------------------------------------------------------*24990005
250000 6110-PROCESS-ITEMS.                                              25000005
250100                                                                  25010005
250200     COMPUTE PV-ITEM = 1 + ((PC212-ITEM (PC212-IDX) - 1)          25020005
250300                     / PC-ITEMS-PER-PANEL).                       25030005
250400                                                                  25040005
250500     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           25050005
250600         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          25060005
250700             PERFORM 6111-WRITE-LIST-QUEUE                        25070005
250800         END-IF                                                   25080005
250900         MOVE PV-ITEM          TO PV-SAVE-ITEM                    25090005
251000                                                                  25100005
251100         PERFORM 6112-READ-LIST-QUEUE                             25110005
251200         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               25120005
251300             CONTINUE                                             25130005
251400         END-IF                                                   25140005
251500     END-IF.                                                      25150005
251600                                                                  25160005
251700     COMPUTE PV-SUB = (PC212-ITEM (PC212-IDX)                     25170005
251800                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              25180005
251900     SET LQW-DESELECT (PV-SUB) TO    TRUE                         25190005
252000     MOVE LQW-SELECTED-SW (PV-SUB)                                25200005
252100                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  25210005
252200                                                                  25220005
252300     EVALUATE TRUE                                                25230005
252400         WHEN PC212-INQ (PC212-IDX)                               25240005
252500              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             25250005
252600                                                                  25260005
252700         WHEN PC212-UPD (PC212-IDX)                               25270005
252800              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             25280005
252900                                                                  25290005
253000         WHEN PC212-DEL (PC212-IDX)                               25300005
253100              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             25310005
253200                                                                  25320005
253300         WHEN PC212-ERR (PC212-IDX)                               25330005
253400              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             25340005
253500     END-EVALUATE.                                                25350005
253600                                                                  25360005
253700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                25370005
253800                                                                  25380005
253900*----------------------------------------------------------------*25390005
254000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *25400005
254100*----------------------------------------------------------------*25410005
254200 6111-WRITE-LIST-QUEUE.                                           25420005
254300                                                                  25430005
254400     EXEC CICS                                                    25440005
254500         WRITEQ TS                                                25450005
254600             QUEUE (ASC-LIST-QUEUE-NAME)                          25460005
254700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     25470005
254800             ITEM  (PV-SAVE-ITEM)                                 25480005
254900             REWRITE                                              25490005
255000             RESP  (PV-CICS-RESP)                                 25500005
255100     END-EXEC.                                                    25510005
255200*                                                                 25520005
255300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25530005
255400         CONTINUE                                                 25540005
255500     ELSE                                                         25550005
255600         SET DP013-CICS-ABEND  TO  TRUE                           25560005
255700         SET DP013-NO-ROLLBACK TO  TRUE                           25570005
255800         MOVE '6111-WRITE-LIST-QUEUE'                             25580005
255900                               TO  DP013-PARAGRAPH                25590005
256000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  25600005
256100                               TO  DP013-MESSAGE-TEXT(1)          25610005
256200         PERFORM DP013-0000-PROCESS-ABEND                         25620005
256300     END-IF.                                                      25630005
256400                                                                  25640005
256500*----------------------------------------------------------------*25650005
256600*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*25660005
256700*----------------------------------------------------------------*25670005
256800 6112-READ-LIST-QUEUE.                                            25680005
256900                                                                  25690005
257000     EXEC CICS                                                    25700005
257100         READQ TS                                                 25710005
257200             QUEUE (ASC-LIST-QUEUE-NAME)                          25720005
257300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     25730005
257400             ITEM  (PV-ITEM)                                      25740005
257500             RESP  (PV-CICS-RESP)                                 25750005
257600     END-EXEC.                                                    25760005
257700*                                                                 25770005
257800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25780005
257900         CONTINUE                                                 25790005
258000     ELSE                                                         25800005
258100         SET DP013-CICS-ABEND        TO TRUE                      25810005
258200         SET DP013-NO-ROLLBACK       TO TRUE                      25820005
258300         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           25830005
258400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    25840005
258500                                     TO DP013-MESSAGE-TEXT(1)     25850005
258600         PERFORM DP013-0000-PROCESS-ABEND                         25860005
258700     END-IF.                                                      25870005
258800                                                                  25880005
258900*-----------------------------------------------------------------25890005
259000*  READ THE LIST QUEUE RECORD                                     25900005
259100*-----------------------------------------------------------------25910005
259200 9100-READ-SEL-QUEUE.                                             25920005
259300                                                                  25930005
259400     EXEC CICS                                                    25940005
259500         READQ TS                                                 25950005
259600             QUEUE (ASC-SEL-QUEUE-NAME)                           25960005
259700             INTO  (PC212-SELECT-RECORD)                          25970005
259800             ITEM  (ASC-SEL-ITEM)                                 25980005
259900             RESP  (PV-CICS-RESP)                                 25990005
260000     END-EXEC.                                                    26000005
260100     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        26010005
260200         CONTINUE                                                 26020005
260300     ELSE                                                         26030005
260400         SET DP013-LOGIC-ABEND                                    26040005
260500             DP013-NO-ROLLBACK   TO   TRUE                        26050005
260600         MOVE '9100-READ-SEL-QUEUE' TO   DP013-PARAGRAPH          26060005
260700         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   26070005
260800                                 TO   DP013-MESSAGE-TEXT (1)      26080005
260900         PERFORM DP013-0000-PROCESS-ABEND                         26090005
261000     END-IF.                                                      26100005
261100                                                                  26110005
261200*-----------------------------------------------------------------26120005
261300* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *26130005
261400*-----------------------------------------------------------------26140005
261500 9200-REWRITE-SEL-QUEUE.                                          26150005
261600                                                                  26160005
261700     EXEC CICS                                                    26170005
261800          WRITEQ TS                                               26180005
261900              QUEUE  (ASC-SEL-QUEUE-NAME)                         26190005
262000              FROM   (PC212-SELECT-RECORD)                        26200005
262100              ITEM   (ASC-SEL-ITEM)                               26210005
262200              RESP   (PV-CICS-RESP)                               26220005
262300              REWRITE                                             26230005
262400     END-EXEC.                                                    26240005
262500                                                                  26250005
262600     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   26260005
262700         SET DP013-CICS-ABEND                                     26270005
262800             DP013-NO-ROLLBACK     TO TRUE                        26280005
262900         MOVE '9200-REWRITE-SEL-QUEUE'                            26290005
263000                                   TO DP013-PARAGRAPH             26300005
263100         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   26310005
263200                                   TO DP013-MESSAGE-TEXT (1)      26320005
263300         PERFORM DP013-0000-PROCESS-ABEND                         26330005
263400     END-IF.                                                      26340005
263500                                                                  26350005
263600*----------------------------------------------------------------*26360005
263700*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *26370005
263800*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *26380005
263900*----------------------------------------------------------------*26390005
264000 9900-SOFT-ABORT.                                                 26400005
264100                                                                  26410005
264200     EXEC CICS SYNCPOINT                                          26420005
264300          ROLLBACK                                                26430005
264400     END-EXEC.                                                    26440005
264500                                                                  26450005
264600     SET  PS-ERROR                                                26460005
264700          PS-SOFT-ABORT-ERROR                                     26470005
264800          DP020-MSG-FATAL       TO  TRUE.                         26480005
264900                                                                  26490005
265000*----------------------------------------------------------------*26500005
265100*    ABEND PROCESSOR MODULE                                      *26510005
265200*----------------------------------------------------------------*26520005
265300                                                                  26530005
265400     COPY DPPD013.                                                26540005
