000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    CNKCS246.                                         00040001
000500 AUTHOR.        DENISE HAHN.                                      00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  NOVEMBER, 2016.                                   00070001
000800 DATE-COMPILED.                                                   00080001
000900                                                                  00090001
001000*---------------------------------------------------------------* 00100001
001100*    Y246 - WST_INTGRTN_TYP  INTEGRATION TYPE PARM LIST         * 00110001
001200*---------------------------------------------------------------* 00120001
263455* CHANGED 11/03/2021    BY JIM HUNTER      WR: CHG0263455         00121031
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00122031
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00123031
263455*----------------------------------------------------------------*00124031
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00125032
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00126032
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00127032
CICS  *-----------------------------------------------------------------00128032
001300 ENVIRONMENT DIVISION.                                            00130001
001400 DATA DIVISION.                                                   00140001
001500                                                                  00150001
001600 WORKING-STORAGE SECTION.                                         00160001
001700*                                                                 00170001
001800 01  DK-DB2-KEYS.                                                 00180001
001900     05  DK-CODE-PARM              PIC X(10)      VALUE SPACES.   00190001
002000                                                                  00200001
002100 01  PC-PROGRAM-CONSTANTS.                                        00210001
002200     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'CNK246  '.  00220001
002300     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'CNKM246 '.  00230001
002400     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'CNKCS246'.  00240001
002410     05  PC-INTER-APPL-CODES.                                     00241017
002420         10  PC-INTER-APPL-CRIT-SPEC-ADD  PIC  X(01)  VALUE '1'.  00242017
002430         10  PC-INTER-APPL-CODE-LIST-ADD  PIC  X(01)  VALUE '2'.  00243017
002440         10  PC-INTER-APPL-CODE-LIST-UPD  PIC  X(01)  VALUE '3'.  00244017
002500     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00250001
002600     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00260001
002700     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00270020
002800     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +13          00280028
002900                                               COMP SYNC.         00290001
003000     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00300001
003100                                               COMP SYNC.         00310001
003200     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00320001
003300                                               COMP-3.            00330001
003400     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00340001
003500                                               COMP SYNC.         00350001
003600     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00360001
003700                                               COMP-3.            00370001
003800     05  PC-INQ                    PIC  X(01)  VALUE 'I'.         00380001
003900     05  PC-ADD                    PIC  X(01)  VALUE 'A'.         00390001
004000     05  PC-UPD                    PIC  X(01)  VALUE 'U'.         00400001
004100     05  PC-DEL                    PIC  X(01)  VALUE 'D'.         00410001
004200     05  PC-ERR                    PIC  X(01)  VALUE 'E'.         00420001
004300     05  PC-A                      PIC  X(01)  VALUE 'A'.         00430001
004400                                                                  00440001
004500*----------------------------------------------------------------*00450001
004600*  SYSTEM MESSAGES                                               *00460001
004700*----------------------------------------------------------------*00470001
004800*   00005 = INVALID VALUE                                        *00480001
004900*   00008 = MUST BE NUMERIC                                      *00490001
005000*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00500001
005100*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00510001
005200*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00520001
005300*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00530001
005400*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00540001
005500*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00550001
005600*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00560001
005700*   00069 - TOP OF LIST                                          *00570001
005800*   00070 - BOTTOM OF LIST                                       *00580001
005900*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00590001
006000*   00279 - MORE ITEMS TO DISPLAY                                *00600001
006100*----------------------------------------------------------------*00610001
006200     05  PC-TSYMSG-NUMBERS.                                       00620001
006300         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00630001
006400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00640001
006500         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00650001
006600         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00660001
006700         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00670001
006800         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00680001
006900         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00690001
007000         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00700001
007100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00710001
007200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00720001
007300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00730001
007400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00740001
007500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00750001
007600                                                                  00760001
007700 01  PS-PROGRAM-SWITCHES.                                         00770001
007800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00780001
007900         88  PS-NO-ERROR                            VALUE 'Y'.    00790001
008000         88  PS-ERROR                               VALUE 'N'.    00800001
008100     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    00810001
008200         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    00820001
008300         88  PS-BLOCK-ERROR                         VALUE 'N'.    00830001
008400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00840001
008500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00850001
008600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00860001
008700                                                                  00870001
008800 01  PV-PROGRAM-VARIABLES.                                        00880001
008900     15  PV-WST-INTGRTN-TYP-COUNT       PIC S9(09) COMP.          00890001
008910     15  PV-WST-ATTR-DEFN-COUNT         PIC S9(09) COMP.          00891001
008920     15  PV-WST-ATTR-ELEM-COUNT         PIC S9(09) COMP.          00892001
009000     15  PV-DISP-COUNT                  PIC  ZZZ9.                00900001
009100                                                                  00910001
009200     15  PV-WORK-YEAR-CHAR              PIC  X(04).               00920001
009300     15  PV-RECORD-TYPE                 PIC  X(01).               00930001
009400                                                                  00940001
009500     05  PV-SUB                         PIC S9(04)  VALUE +0      00950001
009600                                                    COMP SYNC.    00960001
009700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00970001
009800                                                    COMP SYNC.    00980001
009900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00990001
010000                                                    COMP-3.       01000001
010100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01010001
010200                                                    COMP-3.       01020001
010300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01030001
010400                                                    COMP-3.       01040001
010500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01050001
010600                                                    COMP-3.       01060001
010700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01070001
010800                                                    COMP-3.       01080001
010900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01090001
011000                                                    COMP-3.       01100001
011100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01110001
011200                                                    COMP-3.       01120001
011300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01130001
011400                                                    COMP SYNC.    01140001
011500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01150001
011600                                                    COMP SYNC.    01160001
011700     05  PV-ITEM                        PIC S9(04)  VALUE +0      01170001
011800                                                    COMP SYNC.    01180001
011900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01190001
012000                                                    COMP SYNC.    01200001
012100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01210001
012200                                                    COMP SYNC.    01220001
012300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01230001
012400                                                    COMP SYNC.    01240001
012500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01250001
012600                                                    COMP SYNC.    01260001
012700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01270001
012800                                                    COMP SYNC.    01280001
012900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01290001
013000                                                    COMP SYNC.    01300001
013100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01310001
013200                                                    COMP SYNC.    01320001
013300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01330001
013400                                                    COMP SYNC.    01340001
013500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01350001
013600                                                    COMP SYNC.    01360001
013700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01370001
013800                                                    COMP SYNC.    01380001
013900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01390001
014000                                                    COMP SYNC.    01400001
014100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01410001
014200                                                    COMP SYNC.    01420001
014300                                                                  01430001
014400     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01440001
014500                                                     COMP SYNC.   01450001
014600     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01460001
014700     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01470001
014800                                                                  01480001
014900******************************************************************01490001
015000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01500001
015100**  THIS MUST BE THE EXACT SAME FORMAT AS BLOCK IN THE          **01510001
015200**  APPLICATION-SPECIFIC COMMAREA.                              **01520001
015300******************************************************************01530001
015400 01  LQW-LIST-QUEUE-WORK-AREA.                                    01540001
015500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01550001
015600     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           01560028
015700                                        INDEXED BY LQW-IDX.       01570001
015800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01580001
015900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01590001
016000         10  LQW-SELECTED-SW            PIC  X(01).               01600001
016100             88  LQW-SELECT                         VALUE 'S'.    01610001
016200             88  LQW-DESELECT                       VALUE ' '.    01620001
016300         10  LQW-ACTION                 PIC  X(01).               01630002
016400             88  LQW-ADD                            VALUE 'A'.    01640002
016500             88  LQW-INQ                            VALUE 'I'.    01650002
016600             88  LQW-UPD                            VALUE 'U'.    01660002
016700             88  LQW-ERR                            VALUE 'E'.    01670002
016800         10  LQW-PARM-CODE              PIC  X(10).               01680002
016900         10  LQW-PARM-DESC              PIC  X(50).               01690002
017000         10  LQW-APPL-FUNC              PIC  X(10).               01700002
017100         10  LQW-DEFN-CNT               PIC  X(06).               01710002
017110         10  LQW-ELEM-CNT               PIC  X(06).               01711002
017300                                                                  01730001
017400*---------------------------------------------------------------* 01740001
017500* SELECTION QUEUE LAYOUT                                        * 01750001
017600*---------------------------------------------------------------* 01760001
017700     COPY CNWS024.                                                01770001
017800                                                                  01780001
017900*---------------------------------------------------------------* 01790001
018000*    MAP LAYOUT                                                 * 01800001
018100*---------------------------------------------------------------* 01810001
018200     COPY CNKM246.                                                01820001
018300*                                                                 01830001
018400 01  MR-OCCURS-LAYOUT                   REDEFINES  CNK246O.       01840001
018500     05  FILLER                         PIC X(42).                01850011
018600     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          01860028
018700         10  MR-SELECTL                 PIC S9(04) COMP.          01870001
018800         10  MR-SELECTA                 PIC  X(01).               01880001
018900         10  MR-SELECTC                 PIC  X(01).               01890001
019000         10  MR-SELECTH                 PIC  X(01).               01900001
019100         10  MR-SELECTI                 PIC  X(01).               01910001
019200                                                                  01920001
019300         10  MR-ACTIONL                 PIC S9(04) COMP.          01930001
019400         10  MR-ACTIONA                 PIC  X(01).               01940001
019500         10  MR-ACTIONC                 PIC  X(01).               01950001
019600         10  MR-ACTIONH                 PIC  X(01).               01960001
019700         10  MR-ACTION                  PIC  X(01).               01970003
019800                                                                  01980001
019900         10  MR-FUNCTL                 PIC S9(04) COMP.           01990001
020000         10  MR-FUNCTA                 PIC  X(01).                02000001
020100         10  MR-FUNCTC                 PIC  X(01).                02010001
020200         10  MR-FUNCTH                 PIC  X(01).                02020001
020300         10  MR-FUNCT                  PIC  X(10).                02030003
020400                                                                  02040001
020500         10  MR-DESCRL                 PIC S9(04) COMP.           02050001
020600         10  MR-DESCRA                 PIC  X(01).                02060001
020700         10  MR-DESCRC                 PIC  X(01).                02070001
020800         10  MR-DESCRH                 PIC  X(01).                02080001
020900         10  MR-DESCR                  PIC  X(50).                02090009
021000                                                                  02100001
021700         10  MR-DEFCNTL                PIC S9(04) COMP.           02170003
021800         10  MR-DEFCNTA                PIC  X(01).                02180003
021900         10  MR-DEFCNTC                PIC  X(01).                02190003
022000         10  MR-DEFCNTH                PIC  X(01).                02200003
022110         10  MR-DEFCNT                 PIC  X(04).                02211011
022200                                                                  02220001
022201         10  MR-ELMCNTL                PIC S9(04) COMP.           02220103
022202         10  MR-ELMCNTA                PIC  X(01).                02220203
022203         10  MR-ELMCNTC                PIC  X(01).                02220303
022204         10  MR-ELMCNTH                PIC  X(01).                02220403
022209         10  MR-ELMCNT                 PIC  X(04).                02220911
022260                                                                  02226003
022300     05  FILLER                         PIC  X(12).               02230001
022400                                                                  02240001
022500*----------------------------------------------------------------*02250001
022600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02260001
022700*---------------------------------------------------------------* 02270001
022800     COPY DPWS015.                                                02280001
022900                                                                  02290001
023000*---------------------------------------------------------------* 02300001
023100*    FUNCTION KEYS COPYBOOK.                                    * 02310001
023200*---------------------------------------------------------------* 02320001
023300     COPY DPWS016.                                                02330001
023400                                                                  02340001
023500*---------------------------------------------------------------* 02350001
023600*    NUMERIC EDIT LAYOUT.                                       * 02360001
023700*---------------------------------------------------------------* 02370001
023800     COPY DPWS010I.                                               02380001
023900                                                                  02390001
024000*---------------------------------------------------------------* 02400001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02410032
024200*---------------------------------------------------------------* 02420001
024300     COPY DPWS030.                                                02430001
CICS       COPY DPWS930.                                                02431032
024400                                                                  02440001
024500*---------------------------------------------------------------* 02450001
024600*    STANDARD COMMAREA.                                         * 02460001
024700*---------------------------------------------------------------* 02470001
024800     COPY DPWS020.                                                02480001
024900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02490001
025000                                                                  02500001
025100*---------------------------------------------------------------* 02510001
025200* INTER-APPLICATION COMMAREA.                                   * 02520001
025300*   CNWS022 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02530001
025400*             SPEC SCREEN.                                      * 02540001
025500*   CNWS023 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02550001
025600*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02560001
025700*---------------------------------------------------------------* 02570001
025800         10  INTER-APPL-COMM-AREA       PIC X(200).               02580001
025900     COPY CNWS022.                                                02590001
026000     COPY CNWS023.                                                02600001
026100                                                                  02610001
026200*---------------------------------------------------------------* 02620001
026300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02630001
026400*---------------------------------------------------------------* 02640001
026500                                                                  02650001
026600         10  ASC-SPECIFIC-COMMAREA.                               02660001
026610             15  ASC-INT-APPL-FORMAT-IND      PIC  X(01).         02661018
026700             15  ASC-FUNCTION                 PIC  X(02).         02670001
026800                 88  ASC-FUNCTION-NONE             VALUE ' '.     02680001
026900                 88  ASC-ADD-INTGRTN               VALUE 'AC'.    02690005
027000                 88  ASC-UPD-INTGRTN               VALUE 'UC'.    02700005
027500             15  ASC-PARM-NAME                PIC  X(10).         02750005
028600                                                                  02860001
028700             15  ASC-BLK-SUB                  PIC S9(04) COMP     02870001
028800                                                         SYNC.    02880001
028900             15  ASC-ITEM-SUB                 PIC S9(04) COMP     02890001
029000                                                         SYNC.    02900001
029100             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  02910001
029200             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  02920001
029300             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  02930001
029400             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  02940001
029500             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  02950001
029600             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     02960001
029700                                                         SYNC.    02970001
029800             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  02980001
029900             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  02990001
030000             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         03000001
030100                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03010001
030200                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03020001
030300             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03030001
030400                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03040001
030500                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03050001
030600             15  ASC-LIST-QUEUE-NAME.                             03060001
030700                 20  ASC-LIST-TERM-ID         PIC  X(04).         03070001
030800                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03080001
030900                 20  ASC-LIST-SEQ             PIC  9(01).         03090001
031000                                                                  03100001
031100             15  ASC-START-ITEM-REQUEST.                          03110001
031200                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         03120001
031300                                                                  03130001
031400             15  ASC-SEL-SUB                  PIC S9(4) COMP.     03140001
031500             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     03150001
031600             15  ASC-CURSOR-SW                PIC  X(02).         03160001
031700                 88  ASC-NO-CURSOR                   VALUE 'Z '.  03170001
031800                 88  ASC-CODE-PARM-NAME-CSR          VALUE 'A '.  03180001
031900                 88  ASC-CODE-PARM-ALL-CSR           VALUE 'B '.  03190001
032000                                                                  03200001
032100             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          03210001
032200                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03220001
032300             15  ASC-SEL-QUEUE-NAME.                              03230001
032400                 20  ASC-SEL-TERM-ID          PIC  X(04).         03240001
032500                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03250001
032600                 20  ASC-SEL-SEQ              PIC  9(01).         03260001
032700                                                                  03270001
032800             15  ASC-SEL-QUEUE-NAME-2.                            03280001
032900                 20  ASC-SEL-TERM-ID-2        PIC  X(04).         03290001
033000                 20  ASC-SEL-TASK-NUMBER-2    PIC S9(05) COMP-3.  03300001
033100                 20  ASC-SEL-SEQ-2            PIC  9(01).         03310001
033200                                                                  03320001
033300             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  03330001
033400                                                                  03340001
033500             15  FILLER                              PIC X(50).   03350027
033600                                                                  03360001
033700*-----------------------------------------------------------------03370001
033800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03380001
033900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03390001
034000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03400001
034100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03410001
034200                                                                  03420001
034300                 20  ASC-ITEM-ARRAY.                              03430001
034400                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        03440028
034500                         30  ASC-LIST-ITEM-NUMBER                 03450001
034600                                                     PIC S9(09)   03460001
034700                                                     COMP-3.      03470001
034800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03480001
034900                             88  ASC-VALID-SELECT    VALUE ' '    03490001
035000                                                           'S'    03500001
035100                                                           'B'    03510001
035200                                                           'E'.   03520001
035300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03530001
035400                             88  ASC-TEMP-SELECT     VALUE 'S'.   03540001
035500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03550001
035600                             88  ASC-TEMP-END        VALUE 'E'.   03560001
035700                         30  ASC-SELECTED-SW         PIC  X(01).  03570001
035800                             88  ASC-NO-SELECT       VALUE ' '.   03580001
035900                             88  ASC-SELECT          VALUE 'S'.   03590001
036000                             88  ASC-BEGIN           VALUE 'B'.   03600001
036100                             88  ASC-END             VALUE 'E'.   03610001
036200                         30  ASC-ACTION              PIC  X(01).  03620002
036300                         30  ASC-PARM-CODE           PIC  X(10).  03630002
036400                         30  ASC-PARM-DESC           PIC  X(50).  03640002
036500                         30  ASC-APPL-FUNC           PIC  X(10).  03650002
036600                         30  ASC-DEFN-CNT            PIC  9(06).  03660002
036610                         30  ASC-ELEM-CNT            PIC  9(06).  03661002
036620             15  FILLER                              PIC  X(50).  03662027
036800                                                                  03680001
036900                                                                  03690001
037000                                                                  03700001
037100*---------------------------------------------------------------* 03710001
037200*    ABEND PROCESSING COPYBOOK.                                 * 03720001
037300*---------------------------------------------------------------* 03730001
037400     COPY DPWS013.                                                03740001
037500                                                                  03750001
037600*----------------------------------------------------------------*03760001
037700*    WST_INTGRTN_TYP  -  INTEGRATION PARM TYPE                    03770001
037800*----------------------------------------------------------------*03780001
037900     EXEC SQL                                                     03790001
038000          INCLUDE WST00008                                        03800001
038100     END-EXEC.                                                    03810001
038200                                                                  03820001
038300                                                                  03830001
038400*----------------------------------------------------------------*03840001
038500*    DB2 TABLE FOR WST_ATTR_DEFN - COLUMN DEFINITION              03850001
038600*----------------------------------------------------------------*03860001
038700     EXEC SQL                                                     03870001
038800          INCLUDE WST00009                                        03880001
038900     END-EXEC.                                                    03890001
039000                                                                  03900001
039100                                                                  03910001
039110*----------------------------------------------------------------*03911001
039120*    DB2 TABLE FOR WST_ATTR_ELEM - PARAMETER ELEMENTS             03912001
039130*----------------------------------------------------------------*03913001
039140     EXEC SQL                                                     03914001
039150          INCLUDE WST00010                                        03915001
039160     END-EXEC.                                                    03916001
039170                                                                  03917001
039180                                                                  03918001
039200*---------------------------------------------------------------* 03920001
039300* WST_INTGRTN_TYP CURSOR WHEN THE CODE WAS ENTERED              * 03930001
039400*---------------------------------------------------------------* 03940001
039500     EXEC SQL                                                     03950001
039600        DECLARE CODE-PARM-NAME-CSR CURSOR FOR                     03960001
039700         SELECT                                                   03970001
039800                INTGRTN_TYP_CDE                                   03980003
039900              , INTGRTN_TYP_DESC                                  03990003
040000              , APPL_FUNC_DESC                                    04000003
040100          FROM WST_INTGRTN_TYP A                                  04010001
040200         WHERE INTGRTN_TYP_CDE  = :DK-CODE-PARM                   04020004
040300         ORDER BY INTGRTN_TYP_CDE                                 04030003
040400     END-EXEC.                                                    04040001
040500                                                                  04050001
040600*---------------------------------------------------------------* 04060001
040700*  WST_INTGRTN_TYP CURSOR WHEN THE CODE IS NOT ENTERED            04070001
040800*---------------------------------------------------------------* 04080001
040900     EXEC SQL                                                     04090001
041000        DECLARE CODE-PARM-ALL-CSR CURSOR FOR                      04100001
041100         SELECT                                                   04110001
041200                INTGRTN_TYP_CDE                                   04120003
041300              , INTGRTN_TYP_DESC                                  04130003
041400              , APPL_FUNC_DESC                                    04140003
041500          FROM WST_INTGRTN_TYP A                                  04150001
041600         ORDER BY INTGRTN_TYP_CDE                                 04160003
041700     END-EXEC.                                                    04170001
041800                                                                  04180001
041900                                                                  04190001
042000*---------------------------------------------------------------* 04200001
042100*    DB2 AREA FOR COMMUNICATIONS                                * 04210001
042200*---------------------------------------------------------------* 04220001
042300     EXEC SQL                                                     04230001
042400          INCLUDE SQLCA                                           04240001
042500     END-EXEC.                                                    04250001
042600                                                                  04260001
042700***************************************************************** 04270001
042800 LINKAGE SECTION.                                                 04280001
042900                                                                  04290001
043000 01  DFHCOMMAREA.                                                 04300001
043100     05  FILLER                         OCCURS  1 TO 4072 TIMES   04310001
043200                                        DEPENDING ON EIBCALEN.    04320001
043300         10  FILLER                     PIC X.                    04330001
043400                                                                  04340001
043500                                                                  04350001
043600 PROCEDURE DIVISION.                                              04360001
043700******************************************************************04370001
043800**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04380001
043900**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04390001
044000**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04400001
044100******************************************************************04410001
044200                                                                  04420001
044300 0000-MAIN-MODULE.                                                04430001
044400     INITIALIZE DP030-CICS-API-FIELDS.                            04440001
044500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04450001
044600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04460001
044700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04470001
044800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04480001
044900     MOVE LENGTH OF CNK246I        TO DP030-MAP-LENGTH (1).       04490001
045000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04500001
045100     PERFORM 0001-CALL-CICS-ARCH-API.                             04510001
045200                                                                  04520001
045300     PERFORM 1000-CONTROL-PROCESSING                              04530001
045400                                                                  04540001
045500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04550001
045600     PERFORM 0001-CALL-CICS-ARCH-API.                             04560001
045700                                                                  04570001
045800******************************************************************04580001
045900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04590001
046000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04600001
046100******************************************************************04610001
046200 0001-CALL-CICS-ARCH-API.                                         04620001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04630032
046400                                    DFHCOMMAREA                   04640032
046500                                    DP030-CICS-API-FIELDS         04650032
046600                                    DP020-STANDARD-COMMAREA       04660032
046700                                    CNK246I.                      04670032
046800                                                                  04680001
046900     IF  DP030-RC-CALL-SUCCESSFUL                                 04690001
047000         CONTINUE                                                 04700001
047100     ELSE                                                         04710001
047200         SET DP013-NO-ROLLBACK                                    04720001
047300             DP013-XCTL-DISPLAY-RESTART                           04730001
047400             DP013-CICS-ABEND      TO TRUE                        04740001
047500         MOVE '0001-CALL-CICS-ARCH-API'                           04750001
047600                                   TO DP013-PARAGRAPH             04760001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04761032
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04762032
047900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04790001
048000         PERFORM DP013-0000-PROCESS-ABEND                         04800001
048100     END-IF.                                                      04810001
048200                                                                  04820001
048300*----------------------------------------------------------------*04830001
048400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04840001
048500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04850001
048600*                                                                *04860001
048700* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04870001
048800*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04880001
048900*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04890001
049000*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04900001
049100*----------------------------------------------------------------*04910001
049200 1000-CONTROL-PROCESSING.                                         04920001
049210                                                                  04921020
049300     EVALUATE TRUE                                                04930001
049400         WHEN DP020-NEXT-ACT-INITIAL                              04940001
049500             INITIALIZE ASC-SPECIFIC-COMMAREA                     04950001
049600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04960020
049700                                      ASC-SEL-TERM-ID             04970020
049800                                      ASC-SEL-TERM-ID-2           04980020
049900             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   04990001
050000                                           ASC-SEL-TASK-NUMBER    05000001
050100                                           ASC-SEL-TASK-NUMBER-2  05010001
050200             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               05020001
050300             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                05030001
050400                                       ASC-SEL-SEQ-2              05040001
050500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05050001
050600             PERFORM 4000-BUILD-INITIAL-PANEL                     05060001
050700                                                                  05070001
050800         WHEN DP020-NEXT-ACT-READ-MAP                             05080001
050900             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05090001
051000             PERFORM 2000-PROCESS-PANEL                           05100001
051100                                                                  05110001
051200         WHEN DP020-NEXT-ACT-RETURN                               05120001
051300             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05130001
051400             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               05140001
051410                                                                  05141020
051500             EVALUATE TRUE                                        05150001
051600                 WHEN CN022-ADD-CODE                              05160001
051700                      EVALUATE TRUE                               05170001
051800                          WHEN ASC-CODE-PARM-ALL-CSR              05180001
051900                               MOVE SPACES        TO DK-CODE-PARM 05190001
052000                          WHEN ASC-CODE-PARM-NAME-CSR             05200001
052100                               MOVE CN022-PARM-NAME               05210001
052200                                                  TO DK-CODE-PARM 05220001
052300                      END-EVALUATE                                05230001
052400                      PERFORM 2050-DELETE-LIST-QUEUE              05240001
052500                      PERFORM 3200-RESET-ATTRIBUTES               05250001
052600                      PERFORM 4000-BUILD-INITIAL-PANEL            05260001
052700                                                                  05270001
052800                 WHEN CN023-ADD-INTGRTN                           05280004
052900                 WHEN CN023-UPD-INTGRTN                           05290004
053000                      PERFORM 2050-DELETE-LIST-QUEUE              05300001
053100                      PERFORM 3200-RESET-ATTRIBUTES               05310001
053200                      PERFORM 4000-BUILD-INITIAL-PANEL            05320001
053300                                                                  05330001
053400                 WHEN OTHER                                       05340001
053500                      PERFORM 6000-REFRESH-PANEL-FROM-TEMP        05350001
053600                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        05360001
053700             END-EVALUATE                                         05370001
053800                                                                  05380001
053900         WHEN OTHER                                               05390001
054000             SET DP013-LOGIC-ABEND TO TRUE                        05400001
054100             SET DP013-NO-ROLLBACK TO TRUE                        05410001
054200             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    05420001
054300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05430001
054400                                   TO DP013-MESSAGE-TEXT(1)       05440001
054500             PERFORM DP013-0000-PROCESS-ABEND                     05450001
054600     END-EVALUATE.                                                05460001
054700                                                                  05470001
054800*----------------------------------------------------------------*05480001
054900* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05490001
055000* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05500001
055100*----------------------------------------------------------------*05510001
055200 1100-PROCESS-INTER-APPL-COMM.                                    05520001
055201                                                                  05520117
055202     SET PS-COMMAREA-VALID         TO TRUE.                       05520220
055203     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05520320
055204                                                                  05520420
055220     MOVE DP020-INT-APPL-FORMAT-IND                               05522017
055230                                   TO ASC-INT-APPL-FORMAT-IND.    05523017
055300                                                                  05530001
055610*WHEN COMING FROM CRIT SPEC        (CNKCS243 - F13=ADD CODE=1)    05561017
055621*                                                                 05562117
055622     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          05562220
055800         MOVE CN022-FUNCTION      TO ASC-FUNCTION                 05580021
056400     END-IF.                                                      05640021
057200                                                                  05720001
057210                                                                  05721017
057300*----------------------------------------------------------------*05730001
057400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05740001
057500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05750001
057600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05760001
057700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05770001
057800* FUNCTION KEYS CAN GET THIS FAR.                                *05780001
057900*----------------------------------------------------------------*05790001
058000 2000-PROCESS-PANEL.                                              05800001
058100     EVALUATE TRUE                                                05810001
058200         WHEN DP020-SRC-AID = DP016-CLEAR                         05820001
058300             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                05830001
058400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05840001
058500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05850001
058600                                                                  05860001
058700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05870001
058800             PERFORM 2050-DELETE-LIST-QUEUE                       05880001
058900             SET CN022-FUNCTION-NONE  TO TRUE                     05890001
059000             EVALUATE TRUE                                        05900001
059100                WHEN ASC-CODE-PARM-ALL-CSR                        05910001
059200                     MOVE SPACES              TO  DK-CODE-PARM    05920001
059300                WHEN ASC-CODE-PARM-NAME-CSR                       05930001
059400                     MOVE ASC-PARM-NAME       TO  DK-CODE-PARM    05940001
059500             END-EVALUATE                                         05950001
059600             PERFORM 4000-BUILD-INITIAL-PANEL                     05960001
059700                                                                  05970001
059800         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   05980001
059900             PERFORM 2140-DESELECT-ALL-ITEMS                      05990001
060000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06000001
060100                                                                  06010001
060200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06020001
060300             PERFORM 2150-SELECT-ALL-ITEMS                        06030001
060400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06040001
060500         WHEN OTHER                                               06050001
060600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06060001
060700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06070001
060710                                                                  06071022
060800             IF  PS-NO-ERROR                                      06080001
060900                 SET DP030-CONTINUE-GO TO TRUE                    06090001
061000                 PERFORM 2100-CHECK-FUNCTION-KEY                  06100001
061100             ELSE                                                 06110001
061200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06120001
061300                 SET DP030-OVERRIDE-GO TO TRUE                    06130001
061400             END-IF                                               06140001
061500     END-EVALUATE.                                                06150001
061600                                                                  06160001
061700*----------------------------------------------------------------*06170001
061800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06180001
061900*----------------------------------------------------------------*06190001
062000 2050-DELETE-LIST-QUEUE.                                          06200001
062100                                                                  06210001
062200     EXEC CICS                                                    06220001
062300         DELETEQ TS                                               06230001
062400             QUEUE (ASC-LIST-QUEUE-NAME)                          06240001
062500             RESP  (PV-CICS-RESP)                                 06250001
062600     END-EXEC.                                                    06260001
062700                                                                  06270001
062800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06280001
062900        (PV-CICS-RESP = DFHRESP(QIDERR))                          06290001
063000         CONTINUE                                                 06300001
063100     ELSE                                                         06310001
063200         SET DP013-CICS-ABEND      TO TRUE                        06320001
063300         SET DP013-NO-ROLLBACK     TO TRUE                        06330001
063400                                                                  06340001
063500         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         06350001
063600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06360001
063700                                   TO DP013-MESSAGE-TEXT (1)      06370001
063800         PERFORM DP013-0000-PROCESS-ABEND                         06380001
063900     END-IF.                                                      06390001
064000                                                                  06400001
064100     MOVE +0  TO ASC-HIGHEST-BLOCK-WRITTEN.                       06410001
064200                                                                  06420001
064300*----------------------------------------------------------------*06430001
064400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06440001
064500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06450001
064600* CICS ARCHITECTURE API.                                         *06460001
064700*----------------------------------------------------------------*06470001
064800 2100-CHECK-FUNCTION-KEY.                                         06480001
064900                                                                  06490001
065000     EVALUATE TRUE                                                06500001
065100                                                                  06510001
065200* F13 - ADD CODE (WST_INTGRTN_TYP) (LOCAL-FUNC-01)                06520001
065300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06530001
065400                 SET  ASC-ADD-INTGRTN  TO  TRUE                   06540003
065500                 PERFORM 2110-PREPARE-INTER-APPL-COMM             06550001
065600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06560001
065700                                                                  06570001
065800* F15 - UPD CODE (WST_INTGRTN_TYP) (LOCAL-FUNC-02)                06580015
065900         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              06590001
066000                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 0              06600001
066100                     SET ASC-USE-SELECTION-QUEUE TO TRUE          06610001
066200                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            06620001
066300                                TO CN023-NUMBER-OF-SELECTED-ITEMS 06630001
066400                     MOVE ASC-NUMBER-OF-TS-ITEMS                  06640001
066500                                      TO CN023-NUMBER-OF-TS-ITEMS 06650001
066600                     MOVE ASC-SEL-QUEUE-NAME                      06660001
066700                                         TO  CN023-SEL-QUEUE-NAME 06670001
066800                     SET CN023-UPD-INTGRTN       TO TRUE          06680003
067100                     PERFORM 5000-PREPARE-SEL-QUEUE               06710001
067200                 ELSE                                             06720001
067300                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06730001
067400                     SET DP030-OVERRIDE-GO TO TRUE                06740001
067500                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    06750001
067600                     SET DP020-MSG-FATAL   TO TRUE                06760001
067700                 END-IF                                           06770001
067800                                                                  06780001
067900* F23 - DEFN LIST (WST_ATTR_DEFN) (LOCAL-FUNC-03)                 06790023
067910* F24 - ELEM LIST (WST_ATTR_ELEM) (LOCAL-FUNC-04)                 06791023
068000         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              06800023
068010         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              06801023
068020                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 0              06802024
068030                     SET ASC-USE-SELECTION-QUEUE TO TRUE          06803024
068040                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            06804024
068050                                TO CN023-NUMBER-OF-SELECTED-ITEMS 06805024
068060                     MOVE ASC-NUMBER-OF-TS-ITEMS                  06806024
068070                                      TO CN023-NUMBER-OF-TS-ITEMS 06807024
068080                     MOVE ASC-SEL-QUEUE-NAME                      06808024
068090                                         TO  CN023-SEL-QUEUE-NAME 06809024
068091                     SET CN023-UPD-INTGRTN       TO TRUE          06809124
068094                     SET  CN023-FUNCTION-NONE TO TRUE             06809425
068095                     MOVE SPACES            TO  CN023-PARM-CODE   06809525
068096                                                CN023-PARM-DESC   06809625
068097                                                CN023-APPL-FUNC   06809725
068098                     PERFORM 5000-PREPARE-SEL-QUEUE               06809824
068099                 ELSE                                             06809924
068100                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06810024
068101                     SET DP030-OVERRIDE-GO TO TRUE                06810124
068102                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    06810224
068110                     SET DP020-MSG-FATAL   TO TRUE                06811024
068200                 END-IF                                           06820024
069000                                                                  06900023
072200* F6 - FIRST PAGE                                                 07220001
072300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07230001
072400             PERFORM 3200-RESET-ATTRIBUTES                        07240001
072500             MOVE +1               TO PV-TOP-ITEM                 07250001
072600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07260001
072700                                                                  07270001
072800* F7 - PREVIOUS PAGE                                              07280001
072900         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07290001
073000             PERFORM 3200-RESET-ATTRIBUTES                        07300001
073100             PERFORM 2110-BROWSE-BACKWARD                         07310001
073200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07320001
073300                                                                  07330001
073400* F8 - NEXT PAGE                                                  07340001
073500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07350001
073600             PERFORM 3200-RESET-ATTRIBUTES                        07360001
073700             PERFORM 2120-BROWSE-FORWARD                          07370001
073800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07380001
073900                                                                  07390001
074000* ENTER KEY                                                       07400001
074100         WHEN DP020-SRC-AID = DP016-ENTER                         07410001
074200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07420001
074300             IF  PS-ERROR                                         07430001
074400                 CONTINUE                                         07440001
074500             ELSE                                                 07450001
074600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07460001
074700             END-IF                                               07470001
074800                                                                  07480001
074900         WHEN OTHER                                               07490001
075000             SET DP013-NO-ROLLBACK                                07500001
075100                 DP013-XCTL-DISPLAY-RESTART                       07510001
075200                 DP013-CICS-ABEND  TO TRUE                        07520001
075300             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    07530001
075400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07540001
075500                                   TO DP013-MESSAGE-TEXT (1)      07550001
075600             PERFORM DP013-0000-PROCESS-ABEND                     07560001
075700     END-EVALUATE.                                                07570001
075800                                                                  07580001
075900******************************************************************07590001
076000** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **07600001
076100** INTER-APPLICATION COMMAREA.                                  **07610001
076200******************************************************************07620001
076300 2110-PREPARE-INTER-APPL-COMM.                                    07630001
076400                                                                  07640001
076500     INITIALIZE CN022-INTER-APPL-COMMAREA.                        07650001
076600                                                                  07660001
076700     MOVE ASC-FUNCTION             TO CN022-FUNCTION.             07670001
076800                                                                  07680001
076900*----------------------------------------------------------------*07690001
077000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07700001
077100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07710001
077200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07720001
077300*    MESSAGE.                                                    *07730001
077400*----------------------------------------------------------------*07740001
077500 2110-BROWSE-BACKWARD.                                            07750001
077600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07760001
077700         GIVING PV-TOP-ITEM.                                      07770001
077800                                                                  07780001
077900     IF  ((PV-TOP-ITEM < +1)                                      07790001
078000       OR (PV-TOP-ITEM = +1))                                     07800001
078100         MOVE +1                   TO PV-TOP-ITEM                 07810001
078200*        -- TOP OF LIST --                                        07820001
078300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07830001
078400         SET DP020-MSG-INFORMATIONAL TO TRUE                      07840001
078500     END-IF.                                                      07850001
078600                                                                  07860001
078700*----------------------------------------------------------------*07870001
078800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07880001
078900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07890001
079000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07900001
079100*----------------------------------------------------------------*07910001
079200 2120-BROWSE-FORWARD.                                             07920001
079300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07930001
079400         GIVING PV-TOP-ITEM.                                      07940001
079500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07950001
079600         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             07960001
079700*        -- BOTTOM OF LIST --                                     07970001
079800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07980001
079900         SET DP020-MSG-INFORMATIONAL TO TRUE                      07990001
080000     ELSE                                                         08000001
080100         COMPUTE PV-BOTTOM-ITEM =                                 08010001
080200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08020001
080300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08030001
080400*            -- BOTTOM OF LIST --                                 08040001
080500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08050001
080600             SET DP020-MSG-INFORMATIONAL TO TRUE                  08060001
080700         END-IF                                                   08070001
080800     END-IF.                                                      08080001
080900                                                                  08090001
081000*----------------------------------------------------------------*08100001
081100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08110001
081200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08120001
081300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08130001
081400*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08140001
081500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08150001
081600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08160001
081700*----------------------------------------------------------------*08170001
081800 2130-CHECK-FOR-JUMP-BROWSE.                                      08180001
081900     SET PS-NO-ERROR               TO TRUE.                       08190001
082000     IF (ASC-START-ITEM-REQUEST = SPACE)                          08200001
082100         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             08210001
082200     ELSE                                                         08220001
082300         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     08230001
082400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08240001
082500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08250001
082600         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08260001
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08270131
263455              USING DP010I-NUMERIC-EDIT-AREA                      08270231
082800                                                                  08280001
082900         IF  NOT DP010I-ERROR-DETECTED                            08290001
083000             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N08300001
083100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08310001
083200                 IF  ASC-START-ITEM-REQUEST-N >                   08320001
083300                                          ASC-NUMBER-OF-ITEMS-READ08330001
083400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08340001
083500                     COMPUTE PV-TOP-ITEM =                        08350001
083600                             ASC-NUMBER-OF-ITEMS-READ             08360001
083700                             - PC-ITEMS-PER-PANEL + 1             08370001
083800                     IF  PV-TOP-ITEM < +1                         08380001
083900                         MOVE +1   TO PV-TOP-ITEM                 08390001
084000                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 08400001
084100                         SET DP020-MSG-INFORMATIONAL TO TRUE      08410001
084200                     END-IF                                       08420001
084300                 ELSE                                             08430001
084400                     MOVE ASC-START-ITEM-REQUEST-N                08440001
084500                                   TO PV-TOP-ITEM                 08450001
084600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08460001
084700                     COMPUTE PV-BOTTOM-ITEM =                     08470001
084800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08480001
084900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08490001
085000*                        -- BOTTOM OF LIST --                     08500001
085100                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 08510001
085200                         SET DP020-MSG-INFORMATIONAL TO TRUE      08520001
085300                     END-IF                                       08530001
085400                 END-IF                                           08540001
085500             ELSE                                                 08550001
085600*                --- VALUE OUT OF RANGE ----                      08560001
085700                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         08570001
085800                 MOVE -1              TO ASTRTITL                 08580001
085900                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08590001
086000                 MOVE DP015-REVERSE   TO ASTRTITH                 08600001
086100                 MOVE DP015-RED       TO ASTRTITC                 08610001
086200                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           08620001
086300                 SET DP020-MSG-FATAL  TO TRUE                     08630001
086400                 SET PS-ERROR         TO TRUE                     08640001
086500             END-IF                                               08650001
086600         ELSE                                                     08660001
086700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08670001
086800             MOVE -1               TO ASTRTITL                    08680001
086900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08690001
087000             MOVE DP015-REVERSE    TO ASTRTITH                    08700001
087100             MOVE DP015-RED        TO ASTRTITC                    08710001
087200             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               08720001
087300             SET DP020-MSG-FATAL   TO TRUE                        08730001
087400             SET PS-ERROR          TO TRUE                        08740001
087500         END-IF                                                   08750001
087600     END-IF.                                                      08760001
087700                                                                  08770001
087800*----------------------------------------------------------------*08780001
087900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08790001
088000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08800001
088100*----------------------------------------------------------------*08810001
088200 2140-DESELECT-ALL-ITEMS.                                         08820001
088300     MOVE +1                       TO ASC-BLK-SUB.                08830001
088400                                                                  08840001
088500     PERFORM 2141-CLEAR-SELECTED-INDS                             08850001
088600         VARYING ASC-ITEM-SUB                                     08860001
088700         FROM 1 BY 1                                              08870001
088800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08880001
088900                                                                  08890001
089000     ADD +1                        TO ASC-BLK-SUB.                08900001
089100                                                                  08910001
089200     PERFORM 2141-CLEAR-SELECTED-INDS                             08920001
089300         VARYING ASC-ITEM-SUB                                     08930001
089400         FROM 1 BY 1                                              08940001
089500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08950001
089600                                                                  08960001
089700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08970001
089800                                   TO PV-LIST-ITEM-NUMBER.        08980001
089900                                                                  08990001
090000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09000001
090100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09010001
090200                                                                  09020001
090300     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            09030001
090400         MOVE +1                   TO ASC-BLK-SUB                 09040001
090500                                                                  09050001
090600         PERFORM 5100-WRITE-TEMP-STORAGE                          09060001
090700         MOVE +2                   TO ASC-BLK-SUB                 09070001
090800         PERFORM 5100-WRITE-TEMP-STORAGE                          09080001
090900         MOVE +1                   TO ASC-BLK-SUB                 09090001
091000         MOVE +1                   TO PV-BLOCK-NUMBER             09100001
091100     END-IF.                                                      09110001
091200                                                                  09120001
091300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09130001
091400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09140001
091500         MOVE +1                   TO ASC-BLK-SUB                 09150001
091600                                                                  09160001
091700         PERFORM 5100-WRITE-TEMP-STORAGE                          09170001
091800         MOVE +2  TO ASC-BLK-SUB                                  09180001
091900         PERFORM 5100-WRITE-TEMP-STORAGE                          09190001
092000         MOVE +1  TO ASC-BLK-SUB                                  09200001
092100         MOVE +1  TO PV-BLOCK-NUMBER                              09210001
092200                                                                  09220001
092300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09230001
092400             PV-FIRST-BLOCK-IN-ARRAY - 1                          09240001
092500                                                                  09250001
092600         PERFORM                                                  09260001
092700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09270001
092800                                                                  09280001
092900             PERFORM 4410-READ-TEMP-STORAGE                       09290001
093000                                                                  09300001
093100             PERFORM 2141-CLEAR-SELECTED-INDS                     09310001
093200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09320001
093300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09330001
093400                                                                  09340001
093500             PERFORM 5100-WRITE-TEMP-STORAGE                      09350001
093600                                                                  09360001
093700             ADD +1                TO PV-BLOCK-NUMBER             09370001
093800                                                                  09380001
093900         END-PERFORM                                              09390001
094000                                                                  09400001
094100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09410001
094200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09420001
094300                                                                  09430001
094400         PERFORM                                                  09440001
094500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09450001
094600                   ASC-HIGHEST-BLOCK-WRITTEN                      09460001
094700                                                                  09470001
094800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09480001
094900                                   TO PV-BLOCK-NUMBER             09490001
095000                                                                  09500001
095100             PERFORM 4410-READ-TEMP-STORAGE                       09510001
095200                                                                  09520001
095300             PERFORM 2141-CLEAR-SELECTED-INDS                     09530001
095400                 VARYING ASC-ITEM-SUB                             09540001
095500                 FROM 1 BY 1                                      09550001
095600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09560001
095700                                                                  09570001
095800             PERFORM 5100-WRITE-TEMP-STORAGE                      09580001
095900                                                                  09590001
096000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09600001
096100                                                                  09610001
096200         END-PERFORM                                              09620001
096300                                                                  09630001
096400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09640001
096500                                   TO PV-BLOCK-NUMBER             09650001
096600                                                                  09660001
096700         PERFORM 4410-READ-TEMP-STORAGE                           09670001
096800     END-IF.                                                      09680001
096900                                                                  09690001
097000                                                                  09700001
097100     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 09710001
097200     MOVE +0                     TO ASC-START-OF-SELECTED-RANGE.  09720001
097300     MOVE +0                     TO ASC-END-OF-SELECTED-RANGE.    09730001
097400                                                                  09740001
097500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09750001
097600                                                                  09760001
097700*----------------------------------------------------------------*09770001
097800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09780001
097900*----------------------------------------------------------------*09790001
098000 2141-CLEAR-SELECTED-INDS.                                        09800001
098100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09810001
098200             NOT EQUAL ZERO                                       09820001
098300         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09830001
098400             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09840001
098500                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09850001
098600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          09860001
098700         END-IF                                                   09870001
098800     END-IF.                                                      09880001
098900                                                                  09890001
099000*----------------------------------------------------------------*09900001
099100*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *09910001
099200*  FOR ALL ITEMS.                                                *09920001
099300*----------------------------------------------------------------*09930001
099400 2150-SELECT-ALL-ITEMS.                                           09940001
099500     MOVE +1                       TO ASC-BLK-SUB.                09950001
099600                                                                  09960001
099700     PERFORM 2151-SET-SELECTED-INDS                               09970001
099800         VARYING ASC-ITEM-SUB                                     09980001
099900         FROM 1 BY 1                                              09990001
100000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10000001
100100                                                                  10010001
100200     ADD +1                        TO ASC-BLK-SUB.                10020001
100300                                                                  10030001
100400     PERFORM 2151-SET-SELECTED-INDS                               10040001
100500         VARYING ASC-ITEM-SUB                                     10050001
100600         FROM 1 BY 1                                              10060001
100700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10070001
100800                                                                  10080001
100900     MOVE ASC-LIST-ITEM-NUMBER(1 1)  TO PV-LIST-ITEM-NUMBER.      10090001
101000                                                                  10100001
101100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10110001
101200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10120001
101300                                                                  10130001
101400     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            10140001
101500         MOVE +1                   TO ASC-BLK-SUB                 10150001
101600                                                                  10160001
101700         PERFORM 5100-WRITE-TEMP-STORAGE                          10170001
101800         MOVE +2                   TO ASC-BLK-SUB                 10180001
101900         PERFORM 5100-WRITE-TEMP-STORAGE                          10190001
102000         MOVE +1                   TO ASC-BLK-SUB                 10200001
102100         MOVE +1                   TO PV-BLOCK-NUMBER             10210001
102200     END-IF.                                                      10220001
102300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10230001
102400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10240001
102500         MOVE +1                   TO ASC-BLK-SUB                 10250001
102600                                                                  10260001
102700         PERFORM 5100-WRITE-TEMP-STORAGE                          10270001
102800                                                                  10280001
102900         MOVE +1                   TO PV-BLOCK-NUMBER             10290001
103000                                                                  10300001
103100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10310001
103200             PV-FIRST-BLOCK-IN-ARRAY - 1                          10320001
103300                                                                  10330001
103400         PERFORM                                                  10340001
103500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10350001
103600                                                                  10360001
103700             PERFORM 4410-READ-TEMP-STORAGE                       10370001
103800                                                                  10380001
103900             PERFORM 2151-SET-SELECTED-INDS                       10390001
104000                 VARYING ASC-ITEM-SUB                             10400001
104100                 FROM 1 BY 1                                      10410001
104200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10420001
104300                                                                  10430001
104400             PERFORM 5100-WRITE-TEMP-STORAGE                      10440001
104500                                                                  10450001
104600             ADD +1                TO PV-BLOCK-NUMBER             10460001
104700                                                                  10470001
104800         END-PERFORM                                              10480001
104900                                                                  10490001
105000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10500001
105100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10510001
105200                                                                  10520001
105300         PERFORM                                                  10530001
105400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10540001
105500                   ASC-HIGHEST-BLOCK-WRITTEN                      10550001
105600                                                                  10560001
105700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10570001
105800                                   TO PV-BLOCK-NUMBER             10580001
105900                                                                  10590001
106000             PERFORM 4410-READ-TEMP-STORAGE                       10600001
106100                                                                  10610001
106200             PERFORM 2151-SET-SELECTED-INDS                       10620001
106300                 VARYING ASC-ITEM-SUB                             10630001
106400                 FROM 1 BY 1                                      10640001
106500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10650001
106600                                                                  10660001
106700             PERFORM 5100-WRITE-TEMP-STORAGE                      10670001
106800                                                                  10680001
106900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10690001
107000                                                                  10700001
107100         END-PERFORM                                              10710001
107200                                                                  10720001
107300         MOVE PV-FIRST-BLOCK-IN-ARRAY  TO PV-BLOCK-NUMBER         10730001
107400                                                                  10740001
107500         PERFORM 4410-READ-TEMP-STORAGE                           10750001
107600     END-IF.                                                      10760001
107700                                                                  10770001
107800     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10780001
107900                       ASC-NUMBER-OF-SELECTED-ITEMS.              10790001
108000                                                                  10800001
108100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10810001
108200                                                                  10820001
108300*----------------------------------------------------------------*10830001
108400*    MARK EACH ITEM AS BEING SELECTED.                           *10840001
108500*----------------------------------------------------------------*10850001
108600 2151-SET-SELECTED-INDS.                                          10860001
108700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10870001
108800             NOT EQUAL ZERO                                       10880001
108900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10890001
109000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10900001
109100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10910001
109200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10920001
109300                               TO  TRUE                           10930001
109400         END-IF                                                   10940001
109500     END-IF.                                                      10950001
109600                                                                  10960001
109700******************************************************************10970001
109800** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10980001
109900** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10990001
110000******************************************************************11000001
110100 2200-MOVE-SCREEN-TO-COMMAREA.                                    11010001
110200                                                                  11020001
110300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11030001
110400     MOVE +1                       TO PV-SUB.                     11040001
110500                                                                  11050001
110600     PERFORM 3100-SET-SUBSCRIPTS.                                 11060001
110700                                                                  11070001
110800     IF  ASTRTITL > ZERO                                          11080001
110900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          11090001
111000     ELSE                                                         11100001
111100         IF  ASTRTITF = DP015-ERASE-EOF                           11110001
111200             INITIALIZE ASC-START-ITEM-REQUEST                    11120001
111300         END-IF                                                   11130001
111400     END-IF.                                                      11140001
111500                                                                  11150001
111600     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11160001
111700         VARYING PV-SUB FROM 1 BY 1                               11170001
111800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11180001
111900                                                                  11190001
112000******************************************************************11200001
112100** MOVE THE ENTERABLE FIELDS OF EACH LIST LINE INTO THE COMMAREA**11210001
112200******************************************************************11220001
112300 2210-MOVE-LINES-TO-COMMAREA.                                     11230001
112400     IF  MR-SELECTL (PV-SUB) > ZERO                               11240001
112500         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             11250001
112600         MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        11260001
112700                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 11270001
112800     ELSE                                                         11280001
112900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11290001
113000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     11300001
113100                 MOVE SPACE  TO ASC-TEMP-SELECTED-SW              11310001
113200                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 11320001
113300         END-IF                                                   11330001
113400     END-IF.                                                      11340001
113500                                                                  11350001
113600     ADD +1                        TO ASC-ITEM-SUB.               11360001
113700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11370001
113800         ADD +1                    TO ASC-BLK-SUB                 11380001
113900         MOVE +1                   TO ASC-ITEM-SUB                11390001
114000     END-IF.                                                      11400001
114100                                                                  11410001
114200******************************************************************11420001
114300** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **11430001
114400** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **11440001
114500******************************************************************11450001
114600 3000-EDIT-DATA-IN-COMMAREA.                                      11460001
114700     PERFORM 3200-RESET-ATTRIBUTES.                               11470001
114800     SET PS-NO-ERROR               TO TRUE.                       11480001
114900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     11490001
115000                                                                  11500001
115100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11510001
115200* EDITTING IS DONE FROM THE BOTTOM UP.                            11520001
115300                                                                  11530001
115400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11540001
115500         ASC-ITEMS-DISPLAYED - 1.                                 11550001
115600     PERFORM 3100-SET-SUBSCRIPTS.                                 11560001
115700                                                                  11570001
115800      IF  PS-NO-ERROR                                             11580001
115900          PERFORM 3005-EDIT-COMMAREA-BLOCKS                       11590001
116000      END-IF.                                                     11600001
116100                                                                  11610001
116200     IF  PS-NO-ERROR                                              11620001
116300         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11630001
116400     END-IF.                                                      11640001
116500                                                                  11650001
116600     IF  ((PS-NO-ERROR)                                           11660001
116700       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11670001
116800       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11680001
116900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11690001
117000     END-IF.                                                      11700001
117100                                                                  11710001
117200*----------------------------------------------------------------*11720001
117300* 3005-EDIT-COMMAREA-BLOCKS                                      *11730001
117400*----------------------------------------------------------------*11740001
117500 3005-EDIT-COMMAREA-BLOCKS.                                       11750001
117600     MOVE +1                       TO PV-BLOCK-NUMBER.            11760001
117700     MOVE +1                       TO ASC-BLK-SUB.                11770001
117800     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               11780001
117900                                                                  11790001
118000     COMPUTE PV-BLOCK-NUMBER  =                                   11800001
118100             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            11810001
118200             PC-ITEMS-PER-PANEL.                                  11820001
118300                                                                  11830001
118400     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          11840001
118500                                                                  11850001
118600     PERFORM                                                      11860001
118700        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         11870001
118800           OR PS-ERROR                                            11880001
118900           OR PS-BLOCK-ERROR                                      11890001
119000                                                                  11900001
119100              COMPUTE PV-ITEMS-HOLD  =                            11910001
119200                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       11920001
119300                      PC-ITEMS-PER-PANEL - 1                      11930001
119400                                                                  11940001
119500               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     11950001
119600                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             11960001
119700                       FROM  PV-ITEMS-HOLD                        11970001
119800                     GIVING  PV-ITEMS-DIFF                        11980001
119900                   SUBTRACT  PV-ITEMS-DIFF                        11990001
120000                       FROM  PC-ITEMS-PER-PANEL                   12000001
120100                     GIVING  PV-ITEMS-HOLD                        12010001
120200                       MOVE  PV-ITEMS-HOLD TO PV-SUB              12020001
120300                                              ASC-ITEM-SUB        12030001
120400                                              ASC-ITEMS-DISPLAYED 12040001
120500               ELSE                                               12050001
120600                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            12060001
120700                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      12070001
120800               END-IF                                             12080001
120900                                                                  12090001
121000               PERFORM 3300-EDIT-SELECTIONS                       12100001
121100                       VARYING PV-SUB                             12110001
121200                          FROM PV-SUB BY -1                       12120001
121300                          UNTIL PV-SUB < +1                       12130001
121400                                                                  12140001
121500               MOVE +1               TO ASC-BLK-SUB               12150001
121600                                                                  12160001
121700               PERFORM 5105-REWRITE-ASC-LISTQ                     12170001
121800                                                                  12180001
121900               MOVE +1                TO ASC-BLK-SUB              12190001
122000                                                                  12200001
122100               IF  PS-BLOCK-ERROR                                 12210001
122200                   SET  PS-ERROR     TO TRUE                      12220001
122300                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      12230001
122400                                     TO PV-TOP-ITEM               12240001
122500               ELSE                                               12250001
122600                   ADD  +1           TO PV-BLOCK-NUMBER           12260001
122700                   IF  PV-BLOCK-NUMBER >                          12270001
122800                       ASC-HIGHEST-BLOCK-WRITTEN                  12280001
122900                       MOVE +2       TO ASC-BLK-SUB               12290001
123000                       PERFORM 4410-READ-TEMP-STORAGE             12300001
123100                       MOVE +1       TO ASC-BLK-SUB               12310001
123200                   ELSE                                           12320001
123300                       PERFORM 4410-READ-TEMP-STORAGE             12330001
123400                       ADD  +1        TO PV-BLOCK-NUMBER          12340001
123500                       MOVE +2        TO ASC-BLK-SUB              12350001
123600                       PERFORM 4410-READ-TEMP-STORAGE             12360001
123700                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          12370001
123800                       MOVE +1        TO ASC-BLK-SUB              12380001
123900               END-IF                                             12390001
124000           END-IF                                                 12400001
124100     END-PERFORM.                                                 12410001
124200                                                                  12420001
124300     IF  (PV-ORIGINAL-BLOCK  = +1   AND                           12430001
124400          ASC-LIST-ITEM-NUMBER (1 1) = 1)  OR                     12440001
124500         PS-ERROR                   OR                            12450001
124600         PS-BLOCK-ERROR                                           12460001
124700             CONTINUE                                             12470001
124800     ELSE                                                         12480001
124900         MOVE +1                 TO PV-BLOCK-NUMBER               12490001
125000         MOVE +1                 TO ASC-BLK-SUB                   12500001
125100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  12510001
125200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           12520001
125300         PERFORM 4410-READ-TEMP-STORAGE                           12530001
125400                                                                  12540001
125500         PERFORM                                                  12550001
125600            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             12560001
125700               OR PS-ERROR                                        12570001
125800               OR PS-BLOCK-ERROR                                  12580001
125900                                                                  12590001
126000                  COMPUTE PV-ITEMS-HOLD  =                        12600001
126100                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   12610001
126200                          PC-ITEMS-PER-PANEL - 1                  12620001
126300                                                                  12630001
126400                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    12640001
126500                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          12650001
126600                          FROM  PV-ITEMS-HOLD                     12660001
126700                        GIVING  PV-ITEMS-DIFF                     12670001
126800                      SUBTRACT  PV-ITEMS-DIFF                     12680001
126900                          FROM  PC-ITEMS-PER-PANEL                12690001
127000                        GIVING  PV-ITEMS-HOLD                     12700001
127100                          MOVE  PV-ITEMS-HOLD TO PV-SUB           12710001
127200                                                 ASC-ITEM-SUB     12720001
127300                                              ASC-ITEMS-DISPLAYED 12730001
127400                  ELSE                                            12740001
127500                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         12750001
127600                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   12760001
127700                  END-IF                                          12770001
127800                                                                  12780001
127900                  PERFORM 3300-EDIT-SELECTIONS                    12790001
128000                          VARYING PV-SUB                          12800001
128100                             FROM PV-SUB BY -1                    12810001
128200                            UNTIL PV-SUB < +1                     12820001
128300                                                                  12830001
128400                  MOVE +1               TO ASC-BLK-SUB            12840001
128500                                                                  12850001
128600                  PERFORM 5105-REWRITE-ASC-LISTQ                  12860001
128700                                                                  12870001
128800                  MOVE +1                TO ASC-BLK-SUB           12880001
128900                                                                  12890001
129000                  IF  PS-BLOCK-ERROR                              12900001
129100                      SET  PS-ERROR     TO TRUE                   12910001
129200                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   12920001
129300                                        TO PV-TOP-ITEM            12930001
129400                  ELSE                                            12940001
129500                      ADD  +1            TO PV-BLOCK-NUMBER       12950001
129600                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     12960001
129700                          MOVE +2        TO ASC-BLK-SUB           12970001
129800                          PERFORM 4410-READ-TEMP-STORAGE          12980001
129900                          MOVE +1        TO ASC-BLK-SUB           12990001
130000                      ELSE                                        13000001
130100                          PERFORM 4410-READ-TEMP-STORAGE          13010001
130200                          ADD  +1        TO PV-BLOCK-NUMBER       13020001
130300                          MOVE +2        TO ASC-BLK-SUB           13030001
130400                          PERFORM 4410-READ-TEMP-STORAGE          13040001
130500                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       13050001
130600                          MOVE +1        TO ASC-BLK-SUB           13060001
130700                      END-IF                                      13070001
130800                  END-IF                                          13080001
130900     END-PERFORM.                                                 13090001
131000     MOVE +0 TO PV-ITEMS-HOLD.                                    13100001
131100                                                                  13110001
131200*----------------------------------------------------------------*13120001
131300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13130001
131400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13140001
131500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13150001
131600*                                                                *13160001
131700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13170001
131800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13180001
131900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13190001
132000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13200001
132100*----------------------------------------------------------------*13210001
132200 3100-SET-SUBSCRIPTS.                                             13220001
132300     COMPUTE ASC-ITEM-SUB =                                       13230001
132400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13240001
132500                                                                  13250001
132600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13260001
132700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13270001
132800         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13280001
132900     ELSE                                                         13290001
133000         MOVE +1                     TO ASC-BLK-SUB               13300001
133100     END-IF.                                                      13310001
133200                                                                  13320001
133300******************************************************************13330001
133400** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13340001
133500******************************************************************13350001
133600 3200-RESET-ATTRIBUTES.                                           13360001
133700     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13370001
133800     MOVE DP015-GREEN              TO ASTRTITC.                   13380001
133900     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13390001
134000                                                                  13400001
134100     PERFORM                                                      13410001
134200         VARYING PV-SUB                                           13420001
134300         FROM 1 BY 1                                              13430001
134400         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13440001
134500         MOVE DP015-UNP-ALP-NOR-OFF                               13450001
134600                                   TO MR-SELECTA   (PV-SUB)       13460001
134700         MOVE DP015-GREEN          TO MR-SELECTC   (PV-SUB)       13470001
134800         MOVE DP015-UNDERLINE      TO MR-SELECTH   (PV-SUB)       13480001
134900     END-PERFORM.                                                 13490001
135000                                                                  13500001
135100******************************************************************13510001
135200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **13520001
135300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **13530001
135400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **13540001
135500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **13550001
135600******************************************************************13560001
135700 3300-EDIT-SELECTIONS.                                            13570001
135800     EVALUATE TRUE                                                13580001
135900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13590001
136000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13600001
136100                 CONTINUE                                         13610001
136200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13620001
136300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13630001
136400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13640001
136500                 MOVE ASC-TEMP-SELECTED-SW                        13650001
136600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13660001
136700                                TO ASC-SELECTED-SW                13670001
136800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13680001
136900             END-IF                                               13690001
137000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13700001
137100                 = SPACE                                          13710001
137200             EVALUATE TRUE                                        13720001
137300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13730001
137400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13740001
137500                     MOVE SPACE TO ASC-SELECTED-SW                13750001
137600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13760001
137700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13770001
137800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13780001
137900                     MOVE SPACE TO ASC-SELECTED-SW                13790001
138000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13800001
138100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13810001
138200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13820001
138300                     MOVE SPACE TO ASC-SELECTED-SW                13830001
138400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13840001
138500             END-EVALUATE                                         13850001
138600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13860001
138700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13870001
138800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13880001
138900             END-IF                                               13890001
139000             PERFORM 3310-EDIT-RANGE                              13900001
139100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13910001
139200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13920001
139300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13930001
139400             END-IF                                               13940001
139500             PERFORM 3310-EDIT-RANGE                              13950001
139600         WHEN OTHER                                               13960001
139700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13970001
139800             SET DP020-MSG-FATAL    TO TRUE                       13980001
139900             MOVE -1                TO ASTRTITL                   13990001
140000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  14000001
140100             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        14010001
140200             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14020001
140300             SET PS-ERROR TO TRUE                                 14030001
140400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14040001
140500                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14050001
140600                 MOVE SPACE         TO ASC-SELECTED-SW            14060001
140700                                        (ASC-BLK-SUB ASC-ITEM-SUB)14070001
140800             END-IF                                               14080001
140900     END-EVALUATE.                                                14090001
141000                                                                  14100001
141100     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14110001
141200     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14120001
141300     IF  ASC-ITEM-SUB < 1                                         14130001
141400         SUBTRACT +1 FROM ASC-BLK-SUB                             14140001
141500         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14150001
141600     END-IF.                                                      14160001
141700                                                                  14170001
141800******************************************************************14180001
141900** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **14190001
142000** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **14200001
142100** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**14210001
142200** THE ENDING.                                                  **14220001
142300******************************************************************14230001
142400 3310-EDIT-RANGE.                                                 14240001
142500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14250001
142600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14260001
142700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14270001
142800                                   TO ASC-SELECTED-SW             14280001
142900                                        (ASC-BLK-SUB ASC-ITEM-SUB)14290001
143000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14300001
143100         ELSE                                                     14310001
143200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14320001
143300                 CONTINUE                                         14330001
143400             ELSE                                                 14340001
143500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14350001
143600                 MOVE PC-TSYMSG-00054                             14360001
143700                                   TO DP020-MSG-NUMBER            14370001
143800                 SET DP020-MSG-FATAL                              14380001
143900                                   TO TRUE                        14390001
144000                 MOVE -1           TO ASTRTITL                    14400001
144100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              14410001
144200                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14420001
144300                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      14430001
144400                 SET PS-ERROR      TO TRUE                        14440001
144500             END-IF                                               14450001
144600         END-IF                                                   14460001
144700     ELSE                                                         14470001
144800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14480001
144900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14490001
145000                                   TO ASC-SELECTED-SW             14500001
145100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14510001
145200             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14520001
145300         ELSE                                                     14530001
145400             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14540001
145500                 CONTINUE                                         14550001
145600             ELSE                                                 14560001
145700*                -- ONLY ONE END-OF-RANGE ALLOWED --              14570001
145800                 MOVE PC-TSYMSG-00055                             14580001
145900                                   TO DP020-MSG-NUMBER            14590001
146000                 SET DP020-MSG-FATAL                              14600001
146100                                   TO TRUE                        14610001
146200                 MOVE -1           TO ASTRTITL                    14620001
146300                 SET DP030-SET-CURSOR-APPL-1                      14630001
146400                                   TO TRUE                        14640001
146500                 SET PS-ERROR      TO TRUE                        14650001
146600             END-IF                                               14660001
146700         END-IF                                                   14670001
146800     END-IF.                                                      14680001
146900                                                                  14690001
147000******************************************************************14700001
147100** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **14710001
147200** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **14720001
147300******************************************************************14730001
147400 3400-CHECK-RANGE-SEQUENCE.                                       14740001
147500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14750001
147600       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14760001
147700       AND  ASC-START-OF-SELECTED-RANGE >                         14770001
147800                                         ASC-END-OF-SELECTED-RANGE14780001
147900*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14790001
148000         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14800001
148100         SET DP020-MSG-FATAL TO TRUE                              14810001
148200         SET PS-ERROR TO TRUE                                     14820001
148300         PERFORM 3410-POSITION-AT-ERROR                           14830001
148400     END-IF.                                                      14840001
148500                                                                  14850001
148600******************************************************************14860001
148700** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **14870001
148800** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **14880001
148900** SHOULD BE POSITIONED ON A RANGE ERROR.                       **14890001
149000******************************************************************14900001
149100 3410-POSITION-AT-ERROR.                                          14910001
149200     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       14920001
149300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14930001
149400                    - PV-TOP-ITEM + 1.                            14940001
149500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14950001
149600         CONTINUE                                                 14960001
149700     ELSE                                                         14970001
149800         MOVE -1                   TO MR-SELECTL (PV-SUB)         14980001
149900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14990001
150000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15000001
150100     END-IF.                                                      15010001
150200                                                                  15020001
150300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15030001
150400                    - PV-TOP-ITEM + 1.                            15040001
150500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15050001
150600         CONTINUE                                                 15060001
150700     ELSE                                                         15070001
150800         MOVE -1                   TO MR-SELECTL (PV-SUB)         15080001
150900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15090001
151000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15100001
151100     END-IF.                                                      15110001
151200                                                                  15120001
151300*----------------------------------------------------------------*15130001
151400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15140001
151500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15150001
151600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15160001
151700*----------------------------------------------------------------*15170001
151800 3500-MARK-RANGE-AS-SELECTED.                                     15180001
151900     MOVE +1                       TO  ASC-BLK-SUB.               15190001
152000     PERFORM 3510-MARK-SELECTED-INDS                              15200001
152100         VARYING ASC-ITEM-SUB                                     15210001
152200         FROM 1 BY 1                                              15220001
152300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15230001
152400                                                                  15240001
152500     ADD +1                        TO ASC-BLK-SUB.                15250001
152600     PERFORM 3510-MARK-SELECTED-INDS                              15260001
152700         VARYING ASC-ITEM-SUB                                     15270001
152800         FROM 1 BY 1                                              15280001
152900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15290001
153000                                                                  15300001
153100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15310001
153200                                   TO  PV-LIST-ITEM-NUMBER.       15320001
153300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15330001
153400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15340001
153500               PC-ITEMS-PER-PANEL).                               15350001
153600                                                                  15360001
153700     MOVE ASC-START-OF-SELECTED-RANGE                             15370001
153800                                   TO PV-START-OF-SELECTED-RANGE. 15380001
153900     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15390001
154000         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15400001
154100               PC-ITEMS-PER-PANEL).                               15410001
154200                                                                  15420001
154300     MOVE ASC-END-OF-SELECTED-RANGE                               15430001
154400                                   TO  PV-END-OF-SELECTED-RANGE.  15440001
154500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15450001
154600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15460001
154700               PC-ITEMS-PER-PANEL).                               15470001
154800     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15480001
154900         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15490001
155000                                                                  15500001
155100     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15510001
155200        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15520001
155300         MOVE +1                   TO ASC-BLK-SUB                 15530001
155400         PERFORM 5100-WRITE-TEMP-STORAGE                          15540001
155500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15550001
155600             PV-FIRST-BLOCK-IN-ARRAY - 1                          15560001
155700                                                                  15570001
155800         PERFORM                                                  15580001
155900             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15590001
156000                   PV-PREV-BLOCK-IN-ARRAY                         15600001
156100             MOVE PV-FIRST-BLOCK-IN-RANGE                         15610001
156200                                   TO PV-BLOCK-NUMBER             15620001
156300             PERFORM 4410-READ-TEMP-STORAGE                       15630001
156400             PERFORM 3510-MARK-SELECTED-INDS                      15640001
156500                 VARYING ASC-ITEM-SUB                             15650001
156600                 FROM 1 BY 1                                      15660001
156700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15670001
156800             PERFORM 5100-WRITE-TEMP-STORAGE                      15680001
156900             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15690001
157000         END-PERFORM                                              15700001
157100                                                                  15710001
157200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15720001
157300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15730001
157400         PERFORM                                                  15740001
157500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15750001
157600                   PV-LAST-BLOCK-IN-RANGE                         15760001
157700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15770001
157800                                   TO PV-BLOCK-NUMBER             15780001
157900             PERFORM 4410-READ-TEMP-STORAGE                       15790001
158000             PERFORM 3510-MARK-SELECTED-INDS                      15800001
158100                 VARYING ASC-ITEM-SUB                             15810001
158200                 FROM 1 BY 1                                      15820001
158300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15830001
158400             PERFORM 5100-WRITE-TEMP-STORAGE                      15840001
158500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15850001
158600         END-PERFORM                                              15860001
158700                                                                  15870001
158800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15880001
158900                                   TO PV-BLOCK-NUMBER             15890001
159000         PERFORM 4410-READ-TEMP-STORAGE                           15900001
159100     END-IF.                                                      15910001
159200                                                                  15920001
159300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15930001
159400                                      ASC-END-OF-SELECTED-RANGE.  15940001
159500                                                                  15950001
159600*----------------------------------------------------------------*15960001
159700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15970001
159800*----------------------------------------------------------------*15980001
159900 3510-MARK-SELECTED-INDS.                                         15990001
160000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16000001
160100                                ASC-ITEM-SUB) >                   16010001
160200         ASC-START-OF-SELECTED-RANGE)                             16020001
160300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16030001
160400                                ASC-ITEM-SUB) =                   16040001
160500         ASC-START-OF-SELECTED-RANGE)                             16050001
160600                                                                  16060001
160700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16070001
160800                                    ASC-ITEM-SUB) <               16080001
160900             ASC-END-OF-SELECTED-RANGE)                           16090001
161000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16100001
161100                                    ASC-ITEM-SUB) =               16110001
161200             ASC-END-OF-SELECTED-RANGE)                           16120001
161300                                                                  16130001
161400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16140001
161500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16150001
161600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16160001
161700                               TO TRUE                            16170001
161800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16180001
161900                               TO TRUE                            16190001
162000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16200001
162100             END-IF                                               16210001
162200         END-IF                                                   16220001
162300     END-IF.                                                      16230001
162400                                                                  16240001
162500*----------------------------------------------------------------*16250001
162600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16260001
162700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16270001
162800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16280001
162900*    DISPLAY THE PANEL TO USER.                                  *16290001
163000*----------------------------------------------------------------*16300001
163100 4000-BUILD-INITIAL-PANEL.                                        16310001
163200     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            16320001
163300                                 ASC-BLOCK-ENTRIES (2).           16330001
163400     MOVE +1                   TO ASC-BLK-SUB.                    16340001
163500     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           16350001
163600                                                                  16360001
163700     MOVE +0                 TO ASC-ITEM-SUB                      16370001
163800                                ASC-NUMBER-OF-ITEMS-READ          16380001
163900                                ASC-NUMBER-OF-SELECTED-ITEMS      16390001
164000                                ASC-HIGHEST-BLOCK-WRITTEN         16400001
164100                                ASC-START-OF-SELECTED-RANGE       16410001
164200                                ASC-END-OF-SELECTED-RANGE         16420001
164300                                ASC-ITEM-AT-TOP-OF-PANEL.         16430001
164400                                                                  16440001
164500     PERFORM 4100-PREPARE-CURSOR.                                 16450001
164600     PERFORM 4010-OPEN-CURSOR.                                    16460001
164700     PERFORM 4300-READ-ITEMS-FROM-DB.                             16470001
164800     PERFORM 4020-CLOSE-CURSOR.                                   16480001
164900                                                                  16490001
165000     MOVE +1                   TO  PV-TOP-ITEM.                   16500001
165100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16510001
165200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    16520001
165300         SET DP020-MSG-FATAL   TO  TRUE                           16530001
165400         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               16540001
165500     ELSE                                                         16550001
165600         MOVE -1               TO MR-SELECTL (1)                  16560001
165700         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      16570001
165800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16580001
165900     END-IF.                                                      16590001
166000                                                                  16600001
166100                                                                  16610001
166200*----------------------------------------------------------------*16620001
166300* OPEN THE CURSOR.                                               *16630001
166400*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *16640001
166500*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *16650001
166600*   ASSOCIATE.                                                   *16660001
166700*----------------------------------------------------------------*16670001
166800 4010-OPEN-CURSOR.                                                16680001
166900     PERFORM                                                      16690001
167000         WITH TEST AFTER                                          16700001
167100         VARYING PV-RETRY-COUNTER                                 16710001
167200         FROM 1 BY 1                                              16720001
167300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16730001
167400                   OR (SQLCODE = ZERO))                           16740001
167500                                                                  16750001
167600         EVALUATE TRUE                                            16760001
167700             WHEN ASC-CODE-PARM-ALL-CSR                           16770001
167800                  MOVE 'CURSOR: CODE-PARM-ALL-CSR'                16780001
167900                                        TO DP013-MESSAGE-TEXT (2) 16790001
168000                  EXEC SQL                                        16800001
168100                      OPEN CODE-PARM-ALL-CSR                      16810001
168200                  END-EXEC                                        16820001
168300                                                                  16830001
168400             WHEN ASC-CODE-PARM-NAME-CSR                          16840001
168500                 MOVE 'CURSOR: CODE-PARM-NAME-CSR'                16850001
168600                                        TO DP013-MESSAGE-TEXT (2) 16860001
168700                   EXEC SQL                                       16870001
168800                      OPEN CODE-PARM-NAME-CSR                     16880001
168900                   END-EXEC                                       16890001
169000                                                                  16900001
169100                                                                  16910001
169200         END-EVALUATE                                             16920001
169300                                                                  16930001
169400         EVALUATE TRUE                                            16940001
169500             WHEN SQLCODE = ZERO                                  16950001
169600             WHEN SQLCODE = -904                                  16960001
169700             WHEN SQLCODE = -913                                  16970001
169800                 CONTINUE                                         16980001
169900             WHEN SQLWARN0 NOT = SPACES                           16990001
170000             WHEN SQLCODE < ZERO                                  17000001
170100             WHEN SQLCODE > ZERO                                  17010001
170200                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       17020001
170300                 MOVE 'UNABLE TO OPEN A CURSOR -'                 17030001
170400                                   TO DP013-MESSAGE-TEXT (1)      17040001
170500                 MOVE SQLCA        TO DP013-SQLCA                 17050001
170600                 MOVE 'WST_INTGRTN_TYP'                           17060001
170610                                   TO DP013-DB2-TABLE-NAME (1)    17061001
170700                 SET DP013-DB2-ABEND                              17070001
170800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17080001
170900                 PERFORM DP013-0000-PROCESS-ABEND                 17090001
171000         END-EVALUATE                                             17100001
171100     END-PERFORM.                                                 17110001
171200                                                                  17120001
171300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17130001
171400         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             17140001
171500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   17150001
171600                                   TO DP013-MESSAGE-TEXT (1)      17160001
171700         MOVE SQLCA                TO DP013-SQLCA                 17170001
171800         MOVE 'WST_INTGRTN_TYP '   TO DP013-DB2-TABLE-NAME (1)    17180001
171900         SET DP013-DB2-ABEND                                      17190001
172000             DP013-XCTL-DISPLAY-RESTART TO TRUE                   17200001
172100         PERFORM DP013-0000-PROCESS-ABEND                         17210001
172200     END-IF.                                                      17220001
172300                                                                  17230001
172400*----------------------------------------------------------------*17240001
172500* CLOSE THE CURSOR                                               *17250001
172600*----------------------------------------------------------------*17260001
172700 4020-CLOSE-CURSOR.                                               17270001
172800     EVALUATE TRUE                                                17280001
172900         WHEN ASC-CODE-PARM-ALL-CSR                               17290001
173000              EXEC SQL                                            17300001
173100                   CLOSE CODE-PARM-ALL-CSR                        17310001
173200              END-EXEC                                            17320001
173300                                                                  17330001
173400         WHEN ASC-CODE-PARM-NAME-CSR                              17340001
173500              EXEC SQL                                            17350001
173600                   CLOSE CODE-PARM-NAME-CSR                       17360001
173700              END-EXEC                                            17370001
173800                                                                  17380001
173900     END-EVALUATE.                                                17390001
174000                                                                  17400001
174100     EVALUATE TRUE                                                17410001
174200         WHEN SQLCODE = ZERO                                      17420001
174300             CONTINUE                                             17430001
174400         WHEN SQLWARN0 NOT = SPACES                               17440001
174500         WHEN SQLCODE < ZERO                                      17450001
174600         WHEN SQLCODE > ZERO                                      17460001
174700             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          17470001
174800             MOVE 'UNABLE TO CLOSE CURSOR '                       17480001
174900                               TO DP013-MESSAGE-TEXT (1)          17490001
175000             MOVE SQLCA        TO DP013-SQLCA                     17500001
175100             MOVE 'WST_INTGRTN_TYP ' TO DP013-DB2-TABLE-NAME (1)  17510001
175200             SET DP013-DB2-ABEND                                  17520001
175300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17530001
175400             PERFORM DP013-0000-PROCESS-ABEND                     17540001
175500     END-EVALUATE.                                                17550001
175600                                                                  17560001
175700*----------------------------------------------------------------*17570001
175800*    SET UP THE HOST VARIABLES.                                  *17580001
175900*----------------------------------------------------------------*17590001
176000 4100-PREPARE-CURSOR.                                             17600001
176100                                                                  17610001
176200     MOVE ASC-PARM-NAME        TO  DK-CODE-PARM.                  17620001
176300                                                                  17630001
176400     IF  DK-CODE-PARM   > SPACES                                  17640001
176500             SET ASC-CODE-PARM-NAME-CSR TO TRUE                   17650001
176600         ELSE                                                     17660001
176700             SET ASC-CODE-PARM-ALL-CSR  TO TRUE                   17670001
176800     END-IF.                                                      17680001
176900                                                                  17690001
177000*----------------------------------------------------------------*17700001
177100*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17710001
177200*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17720001
177300*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17730001
177400*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17740001
177500*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17750001
177600*                                                                *17760001
177700*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17770001
177800*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17780001
177900*    UPON INITIALIZATION.                                        *17790001
178000*----------------------------------------------------------------*17800001
178100 4300-READ-ITEMS-FROM-DB.                                         17810001
178200     PERFORM                                                      17820001
178300         VARYING PV-READ-COUNT                                    17830001
178400         FROM 1 BY 1                                              17840001
178500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17850001
178600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17860001
178700                                                                  17870001
178800        PERFORM 4310-FETCH                                        17880001
178900                                                                  17890001
179000         IF  ASC-ITEMS-LEFT-ON-DB                                 17900001
179100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                17910001
179200                 ADD +1            TO ASC-ITEM-SUB                17920001
179300             ELSE                                                 17930001
179400                 ADD +1            TO ASC-BLK-SUB                 17940001
179500                 MOVE +1           TO ASC-ITEM-SUB                17950001
179600                                                                  17960001
179700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         17970001
179800                     MOVE +1       TO ASC-BLK-SUB                 17980001
179900                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           17990001
180000                     PERFORM 5100-WRITE-TEMP-STORAGE              18000001
180100                     MOVE ASC-BLOCK-ENTRIES                       18010001
180200                               (PC-MAX-BLOCKS-IN-ARRAY)           18020001
180300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18030001
180400                     ADD +1        TO ASC-BLK-SUB                 18040001
180500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18050001
180600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18060001
180700                                   TO TRUE                        18070001
180800                 END-IF                                           18080001
180900             END-IF                                               18090001
181000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18100001
181100             MOVE ASC-NUMBER-OF-ITEMS-READ                        18110001
181200                                   TO ASC-LIST-ITEM-NUMBER        18120001
181300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18130001
181400             EVALUATE TRUE                                        18140001
181500                 WHEN CN022-FUNCTION-NONE                         18150001
181600                     MOVE SPACES TO ASC-ACTION                    18160001
181700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18170001
181800                 WHEN CN022-UPD-CODE                              18180001
181900                     MOVE PC-UPD TO ASC-ACTION                    18190001
182000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18200001
182100                 WHEN CN023-UPD-INTGRTN                           18210005
182200                     MOVE PC-UPD TO ASC-ACTION                    18220001
182300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18230001
182400             END-EVALUATE                                         18240001
182500             MOVE WST00008-INTGRTN-TYP-CDE  TO ASC-PARM-CODE      18250003
182600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18260001
182700             MOVE WST00008-INTGRTN-TYP-DESC TO ASC-PARM-DESC      18270003
182800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18280001
182900             MOVE WST00008-APPL-FUNC-DESC   TO ASC-APPL-FUNC      18290003
183000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18300001
183100             MOVE PV-WST-ATTR-DEFN-COUNT TO ASC-DEFN-CNT          18310003
183200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18320001
183210             MOVE PV-WST-ATTR-ELEM-COUNT TO ASC-ELEM-CNT          18321005
183220                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18322003
183300         END-IF                                                   18330001
183400     END-PERFORM.                                                 18340001
183500                                                                  18350001
183600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          18360001
183700         MOVE +1               TO ASC-BLK-SUB                     18370001
183800         PERFORM 5100-WRITE-TEMP-STORAGE                          18380001
183900         ADD +1                TO ASC-BLK-SUB                     18390001
184000         PERFORM 5100-WRITE-TEMP-STORAGE                          18400001
184100                                                                  18410001
184200         MOVE 1                TO ASC-BLK-SUB                     18420001
184300                                  PV-BLOCK-NUMBER                 18430001
184400         PERFORM 4410-READ-TEMP-STORAGE                           18440001
184500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             18450001
184600             MOVE 2            TO ASC-BLK-SUB                     18460001
184700                                  PV-BLOCK-NUMBER                 18470001
184800             PERFORM 4410-READ-TEMP-STORAGE                       18480001
184900         END-IF                                                   18490001
185000     END-IF.                                                      18500001
185100                                                                  18510001
185200*----------------------------------------------------------------*18520001
185300*    FETCH THE CURSOR                                             18530001
185400*----------------------------------------------------------------*18540001
185500 4310-FETCH.                                                      18550001
185600       EVALUATE TRUE                                              18560001
185700           WHEN ASC-CODE-PARM-ALL-CSR                             18570001
185800               EXEC SQL                                           18580001
185900                    FETCH CODE-PARM-ALL-CSR                       18590001
186000                    INTO                                          18600001
186100                          :WST00008-INTGRTN-TYP-CDE               18610003
186200                        , :WST00008-INTGRTN-TYP-DESC              18620003
186300                        , :WST00008-APPL-FUNC-DESC                18630003
186400               END-EXEC                                           18640001
186500                                                                  18650001
186600           WHEN ASC-CODE-PARM-NAME-CSR                            18660001
186700               EXEC SQL                                           18670001
186800                    FETCH CODE-PARM-NAME-CSR                      18680001
186900                    INTO                                          18690001
187000                          :WST00008-INTGRTN-TYP-CDE               18700003
187100                        , :WST00008-INTGRTN-TYP-DESC              18710003
187200                        , :WST00008-APPL-FUNC-DESC                18720003
187300               END-EXEC                                           18730001
187400                                                                  18740001
187500     END-EVALUATE.                                                18750001
187600                                                                  18760001
187700     EVALUATE TRUE                                                18770001
187800         WHEN SQLCODE = ZERO                                      18780001
187900              PERFORM 4315-COUNT-WST-ATTR-DEFN                    18790003
187910              PERFORM 4320-COUNT-WST-ATTR-ELEM                    18791003
188000                                                                  18800001
188100         WHEN SQLCODE = +100                                      18810001
188200              CONTINUE                                            18820001
188300         WHEN SQLWARN0 NOT = SPACE                                18830001
188400         WHEN SQLCODE NOT = ZERO                                  18840001
188500              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         18850001
188600              MOVE 'COULD NOT FETCH CURSOR'                       18860001
188700                               TO DP013-MESSAGE-TEXT (1)          18870001
188800              MOVE SQLCA       TO DP013-SQLCA                     18880001
188900              SET DP013-DB2-ABEND TO TRUE                         18890001
189000              PERFORM DP013-0000-PROCESS-ABEND                    18900001
189100     END-EVALUATE.                                                18910001
189200                                                                  18920001
189300     IF  SQLCODE EQUAL +100                                       18930001
189400         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      18940001
189500     END-IF.                                                      18950001
189600                                                                  18960001
189700*----------------------------------------------------------------*18970001
189800* COUNT THE NUMBER OF ROWS ON WST_ATTR_DEFN FOR THIS CODE        *18980001
189900*----------------------------------------------------------------*18990001
190000 4315-COUNT-WST-ATTR-DEFN.                                        19000003
190100                                                                  19010001
190200     EXEC SQL                                                     19020001
190300          SELECT COUNT(*)                                         19030001
190400            INTO :PV-WST-ATTR-DEFN-COUNT                          19040003
190500            FROM WST_ATTR_DEFN                                    19050001
190600           WHERE INTGRTN_TYP_CDE    =  :WST00008-INTGRTN-TYP-CDE  19060004
190700     END-EXEC.                                                    19070001
190800                                                                  19080001
190900     EVALUATE TRUE                                                19090001
191000         WHEN SQLCODE = ZERO                                      19100001
191100              CONTINUE                                            19110001
191200                                                                  19120001
191300         WHEN SQLCODE = +100                                      19130001
191400              CONTINUE                                            19140001
191500         WHEN SQLWARN0 NOT = SPACE                                19150001
191600         WHEN SQLCODE NOT = ZERO                                  19160001
191700              MOVE '4315-COUNT-WST-ATTR-DEFN' TO   DP013-PARAGRAPH19170003
191800              MOVE 'COULD NOT COUNT WST_ATTR_DEFN'                19180001
191900                               TO DP013-MESSAGE-TEXT (1)          19190001
192000              MOVE SQLCA       TO DP013-SQLCA                     19200001
192100              SET DP013-DB2-ABEND TO TRUE                         19210001
192200              PERFORM DP013-0000-PROCESS-ABEND                    19220001
192300     END-EVALUATE.                                                19230001
192400                                                                  19240001
192500                                                                  19250001
192501*----------------------------------------------------------------*19250103
192502* COUNT THE NUMBER OF ROWS ON WST_ATTR_ELEM FOR THIS CODE        *19250203
192503*----------------------------------------------------------------*19250303
192504 4320-COUNT-WST-ATTR-ELEM.                                        19250403
192510     EXEC SQL                                                     19251003
192520          SELECT COUNT(DISTINCT(ATTR_ELEM_SEQ_NBR))               19252012
192530            INTO :PV-WST-ATTR-ELEM-COUNT                          19253003
192540            FROM WST_ATTR_ELEM                                    19254003
192550           WHERE INTGRTN_TYP_CDE    =  :WST00008-INTGRTN-TYP-CDE  19255004
192560     END-EXEC.                                                    19256003
192570                                                                  19257003
192580     EVALUATE TRUE                                                19258003
192590         WHEN SQLCODE = ZERO                                      19259003
192591              CONTINUE                                            19259103
192592                                                                  19259203
192593         WHEN SQLCODE = +100                                      19259303
192594              CONTINUE                                            19259403
192595         WHEN SQLWARN0 NOT = SPACE                                19259503
192596         WHEN SQLCODE NOT = ZERO                                  19259603
192597              MOVE '4320-COUNT-WST-ATTR-ELEM' TO   DP013-PARAGRAPH19259704
192598              MOVE 'COULD NOT COUNT WST_ATTR_ELEM'                19259803
192599                               TO DP013-MESSAGE-TEXT (1)          19259903
192600              MOVE SQLCA       TO DP013-SQLCA                     19260003
192601              SET DP013-DB2-ABEND TO TRUE                         19260103
192602              PERFORM DP013-0000-PROCESS-ABEND                    19260203
192603     END-EVALUATE.                                                19260303
192604                                                                  19260403
192605                                                                  19260503
192610*----------------------------------------------------------------*19261001
192700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *19270001
192800*----------------------------------------------------------------*19280001
192900 4400-MOVE-COMMAREA-TO-SCREEN.                                    19290001
193000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             19300001
193100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          19310001
193200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          19320001
193300             MOVE +1    TO ASC-BLK-SUB                            19330001
193400             PERFORM 5100-WRITE-TEMP-STORAGE                      19340001
193500             ADD +1     TO ASC-BLK-SUB                            19350001
193600             PERFORM 5100-WRITE-TEMP-STORAGE                      19360001
193700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             19370001
193800                 GIVING PV-BLOCK-NUMBER                           19380001
193900                 REMAINDER PV-REMAINDER                           19390001
194000             IF  PV-REMAINDER > ZERO                              19400001
194100                 ADD +1 TO PV-BLOCK-NUMBER                        19410001
194200             END-IF                                               19420001
194300             MOVE +1    TO ASC-BLK-SUB                            19430001
194400             PERFORM 4410-READ-TEMP-STORAGE                       19440001
194500             ADD +1     TO ASC-BLK-SUB                            19450001
194600                           PV-BLOCK-NUMBER                        19460001
194700             PERFORM 4410-READ-TEMP-STORAGE                       19470001
194800     END-IF.                                                      19480001
194900     MOVE +1            TO ASC-BLK-SUB.                           19490001
195000     COMPUTE ASC-ITEM-SUB =                                       19500001
195100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              19510001
195200         + PC-ITEMS-PER-PANEL).                                   19520001
195300                                                                  19530001
195400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19540001
195500         ADD +1         TO ASC-BLK-SUB                            19550001
195600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            19560001
195700     END-IF.                                                      19570001
195800                                                                  19580001
195900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           19590001
196000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                19600001
196100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        19610001
196200     PERFORM 4420-FORMAT-LIST-LINES                               19620001
196300         VARYING PV-SUB                                           19630001
196400         FROM PC-ITEMS-PER-PANEL BY -1                            19640001
196500         UNTIL PV-SUB < +1.                                       19650001
196600                                                                  19660001
196700     COMPUTE ASC-ITEMS-DISPLAYED =                                19670001
196800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19680001
196900     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    19690001
197000                                      ASTRTITO.                   19700001
197100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19710001
197200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19720001
197300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19730001
197400                                   TO ASELITO.                    19740001
197500                                                                  19750001
197600     IF  DP020-MSG-NUMBER-X = SPACE                               19760001
197700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19770001
197800*            --- MORE ITEMS TO DISPLAY ----                       19780001
197900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19790001
198000             SET DP020-MSG-INFORMATIONAL TO TRUE                  19800001
198100         END-IF                                                   19810001
198200     END-IF.                                                      19820001
198300                                                                  19830001
198400*----------------------------------------------------------------*19840001
198500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *19850001
198600*----------------------------------------------------------------*19860001
198700 4410-READ-TEMP-STORAGE.                                          19870001
198800     EXEC CICS                                                    19880001
198900         READQ TS                                                 19890001
199000             QUEUE (ASC-LIST-QUEUE-NAME)                          19900001
199100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19910001
199200             ITEM  (PV-BLOCK-NUMBER)                              19920001
199300             RESP  (PV-CICS-RESP)                                 19930001
199400     END-EXEC.                                                    19940001
199500                                                                  19950001
199600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       19960001
199700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     19970001
199800         CONTINUE                                                 19980001
199900     ELSE                                                         19990001
200000         SET DP013-CICS-ABEND     TO TRUE                         20000001
200100         SET DP013-NO-ROLLBACK    TO TRUE                         20010001
200200         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         20020001
200300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20030001
200400                                  TO DP013-MESSAGE-TEXT(1)        20040001
200500         PERFORM DP013-0000-PROCESS-ABEND                         20050001
200600     END-IF.                                                      20060001
200700                                                                  20070001
200800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20080001
200900                                                                  20090001
201000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20100001
201100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               20110001
201200     END-IF.                                                      20120001
201300                                                                  20130001
201400*----------------------------------------------------------------*20140001
201500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *20150001
201600*----------------------------------------------------------------*20160001
201700 4420-FORMAT-LIST-LINES.                                          20170001
201800     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      20180001
201900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20190001
202000         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           20200001
202100         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           20210001
202200         MOVE SPACES             TO MR-SELECTI      (PV-SUB)      20220001
202300                                    MR-ACTION       (PV-SUB)      20230001
202400                                    MR-FUNCT        (PV-SUB)      20240001
202500                                    MR-DESCR        (PV-SUB)      20250001
202600                                    MR-DEFCNT       (PV-SUB)      20260005
202700                                    MR-ELMCNT       (PV-SUB)      20270005
202800     ELSE                                                         20280001
202900         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20290001
203000                                                   > SPACE        20300001
203100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 20310001
203200                                          TO MR-SELECTI (PV-SUB)  20320001
203300         ELSE                                                     20330001
203400             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20340001
203500                                           TO MR-SELECTI (PV-SUB) 20350001
203600         END-IF                                                   20360001
203700                                                                  20370001
203800         IF  DP030-SET-CURSOR-TRAILER                             20380001
203900             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)20390001
204000                 > SPACE)                                         20400001
204100               OR (PV-SUB = 1))                                   20410001
204200                SET DP030-SET-CURSOR-APPL-1 TO TRUE               20420001
204300                MOVE -1          TO MR-SELECTL (PV-SUB)           20430001
204400             END-IF                                               20440001
204500         END-IF                                                   20450001
204600*>>>>>>>>                                                         20460001
204700         MOVE ASC-ACTION    (ASC-BLK-SUB ASC-ITEM-SUB)            20470003
204800                                          TO MR-ACTION   (PV-SUB) 20480001
204900         MOVE ASC-PARM-CODE (ASC-BLK-SUB ASC-ITEM-SUB)            20490011
205000                                          TO MR-FUNCT    (PV-SUB) 20500001
205100         MOVE ASC-PARM-DESC (ASC-BLK-SUB ASC-ITEM-SUB)            20510011
205200                                          TO MR-DESCR    (PV-SUB) 20520001
205300         MOVE ASC-DEFN-CNT  (ASC-BLK-SUB ASC-ITEM-SUB)            20530003
205310                                          TO PV-DISP-COUNT        20531012
205400         MOVE PV-DISP-COUNT               TO MR-DEFCNT   (PV-SUB) 20540012
205500         MOVE ASC-ELEM-CNT  (ASC-BLK-SUB ASC-ITEM-SUB)            20550003
205600                                          TO PV-DISP-COUNT        20560001
205700         MOVE PV-DISP-COUNT               TO MR-ELMCNT   (PV-SUB) 20570005
205800                                                                  20580001
205900     END-IF.                                                      20590001
206000     SUBTRACT +1 FROM ASC-ITEM-SUB                                20600001
206100     IF  ASC-ITEM-SUB < + 1                                       20610001
206200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  20620001
206300         MOVE +1                 TO ASC-BLK-SUB                   20630001
206400     END-IF.                                                      20640001
206500                                                                  20650001
206600******************************************************************20660001
206700** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **20670001
206800** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **20680001
206900** ISSUE A WARNING.                                             **20690001
207000******************************************************************20700001
207100 4430-CHECK-FOR-BEGIN-AND-END.                                    20710001
207200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20720001
207300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     20730001
207400*            -- NO END-OF-RANGE SPECFIED ---                      20740001
207500             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            20750001
207600             SET DP020-MSG-WARNING TO TRUE                        20760001
207700             PERFORM 4431-POSITION-AT-WARNING                     20770001
207800         END-IF                                                   20780001
207900     ELSE                                                         20790001
208000         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     20800001
208100*            -- NO BEGINNING-OF-RANGE SPECFIED ---                20810001
208200             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            20820001
208300             SET DP020-MSG-WARNING TO TRUE                        20830001
208400             PERFORM 4431-POSITION-AT-WARNING                     20840001
208500         END-IF                                                   20850001
208600     END-IF.                                                      20860001
208700*                                                                 20870001
208800******************************************************************20880001
208900** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **20890001
209000** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **20900001
209100** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **20910001
209200** POSITION THE CURSOR THERE.                                   **20920001
209300******************************************************************20930001
209400 4431-POSITION-AT-WARNING.                                        20940001
209500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20950001
209600                    - PV-TOP-ITEM + 1.                            20960001
209700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20970001
209800         CONTINUE                                                 20980001
209900     ELSE                                                         20990001
210000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      21000001
210100         MOVE -1                     TO MR-SELECTL (PV-SUB)       21010001
210200         MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)       21020001
210300         MOVE DP015-YELLOW           TO MR-SELECTC (PV-SUB)       21030001
210400     END-IF.                                                      21040001
210500                                                                  21050001
210600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21060001
210700                    - PV-TOP-ITEM + 1.                            21070001
210800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21080001
210900         CONTINUE                                                 21090001
211000     ELSE                                                         21100001
211100         SET DP030-SET-CURSOR-APPL-1                              21110001
211200                                   TO TRUE                        21120001
211300         MOVE -1                   TO MR-SELECTL (PV-SUB)         21130001
211400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21140001
211500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21150001
211600     END-IF.                                                      21160001
211700                                                                  21170001
211800*----------------------------------------------------------------*21180001
211900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *21190001
212000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *21200001
212100* FOR THE SELECTED ITEMS QUEUE.                                  *21210001
212200*                                                                *21220001
212300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *21230001
212400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *21240001
212500* THE ARRAY IS FULL.                                             *21250001
212600*----------------------------------------------------------------*21260001
212700 5000-PREPARE-SEL-QUEUE.                                          21270001
212800     MOVE +1                   TO  ASC-BLK-SUB.                   21280001
212900     PERFORM 5100-WRITE-TEMP-STORAGE.                             21290001
213000     ADD +1                    TO  ASC-BLK-SUB.                   21300001
213100     PERFORM 5100-WRITE-TEMP-STORAGE.                             21310001
213200                                                                  21320001
213400     MOVE ASC-SEL-QUEUE-NAME   TO  CN023-SEL-QUEUE-NAME.          21340001
213500     PERFORM 6010-DELETE-SEL-QUEUE.                               21350001
213600                                                                  21360001
213700     SET ASC-UPDATE-TSQ        TO  TRUE.                          21370001
213800                                                                  21380001
213900     SET CN024-IDX             TO  1.                             21390001
214000     MOVE ZERO                 TO CN023-NUMBER-OF-TS-ITEMS.       21400001
214100     INITIALIZE CN024-SELECTED-ITEM-ARRAY.                        21410001
214200                                                                  21420001
214300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           21430001
214400             VARYING PV-ITEM                                      21440001
214500             FROM 1 BY 1                                          21450001
214600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     21460001
214700                                                                  21470001
214800     IF  CN024-IDX > 1                                            21480001
214900         PERFORM 5205-WRITE-SEL-QUEUE                             21490001
215000         ADD +1                TO CN023-NUMBER-OF-TS-ITEMS        21500001
215100     END-IF.                                                      21510001
215200                                                                  21520001
215300*----------------------------------------------------------------*21530001
215400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *21540001
215500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *21550001
215600*----------------------------------------------------------------*21560001
215700 5100-WRITE-TEMP-STORAGE.                                         21570001
215800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     21580001
215900                                   TO PV-LIST-ITEM-NUMBER.        21590001
216000     COMPUTE PV-BLOCK-NUMBER =                                    21600001
216100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    21610001
216200                                                                  21620001
216300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             21630001
216400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             21640001
216500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      21650001
216600             PERFORM 5105-REWRITE-ASC-LISTQ                       21660001
216700         END-IF                                                   21670001
216800     ELSE                                                         21680001
216900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       21690001
217000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            21700001
217100         PERFORM 5110-WRITE-ASC-LISTQ                             21710001
217200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   21720001
217300     END-IF.                                                      21730001
217400                                                                  21740001
217500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             21750001
217600                                                                  21760001
217700******************************************************************21770001
217800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **21780001
217900** SPECIFIC COMMAREA.                                           **21790001
218000******************************************************************21800001
218100 5105-REWRITE-ASC-LISTQ.                                          21810001
218200     EXEC CICS                                                    21820001
218300         WRITEQ TS                                                21830001
218400             QUEUE (ASC-LIST-QUEUE-NAME)                          21840001
218500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21850001
218600             ITEM  (PV-BLOCK-NUMBER)                              21860001
218700             REWRITE                                              21870001
218800             RESP  (PV-CICS-RESP)                                 21880001
218900     END-EXEC.                                                    21890001
219000                                                                  21900001
219100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           21910001
219200         CONTINUE                                                 21920001
219300     ELSE                                                         21930001
219400         SET DP013-CICS-ABEND            TO TRUE                  21940001
219500         SET DP013-NO-ROLLBACK           TO TRUE                  21950001
219600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       21960001
219700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     21970001
219800                                         TO DP013-MESSAGE-TEXT(1) 21980001
219900         PERFORM DP013-0000-PROCESS-ABEND                         21990001
220000     END-IF.                                                      22000001
220100                                                                  22010001
220200******************************************************************22020001
220300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **22030001
220400** SPECIFIC COMMAREA.                                           **22040001
220500******************************************************************22050001
220600 5110-WRITE-ASC-LISTQ.                                            22060001
220700     EXEC CICS                                                    22070001
220800         WRITEQ TS                                                22080001
220900             QUEUE (ASC-LIST-QUEUE-NAME)                          22090001
221000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22100001
221100             ITEM  (PV-BLOCK-NUMBER)                              22110001
221200             RESP  (PV-CICS-RESP)                                 22120001
221300     END-EXEC.                                                    22130001
221400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22140001
221500         SET DP013-CICS-ABEND      TO TRUE                        22150001
221600         SET DP013-NO-ROLLBACK     TO TRUE                        22160001
221700         MOVE '5110-WRITE-ASC-LISTQ'                              22170001
221800                                   TO DP013-PARAGRAPH             22180001
221900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           22190001
222000                                   TO DP013-MESSAGE-TEXT(1)       22200001
222100         PERFORM DP013-0000-PROCESS-ABEND                         22210001
222200     END-IF.                                                      22220001
222300                                                                  22230001
222400*----------------------------------------------------------------*22240001
222500* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *22250001
222600* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *22260001
222700*----------------------------------------------------------------*22270001
222800 5200-FILL-SEL-QUEUE-RECORD.                                      22280001
222810                                                                  22281025
222900     PERFORM 6112-READ-LIST-QUEUE.                                22290001
223000                                                                  22300001
223100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       22310001
223200         PERFORM                                                  22320025
223210         VARYING LQW-IDX                                          22321025
223300         FROM 1 BY 1                                              22330001
223400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            22340001
223500           OR  LQW-LIST-ITEM-NUMBER(LQW-IDX) = ZERO               22350001
223600                                                                  22360001
223700           IF LQW-SELECT (LQW-IDX)                                22370001
223800                 MOVE LQW-LIST-ITEM-NUMBER(LQW-IDX)               22380001
223900                            TO CN024-ITEM          (CN024-IDX)    22390001
224000                 MOVE LQW-ACTION (LQW-IDX)                        22400001
224100                            TO CN024-ACTION-SW     (CN024-IDX)    22410001
224200                 MOVE LQW-PARM-CODE (LQW-IDX)                     22420005
224300                            TO CN024-PARM-NAME     (CN024-IDX)    22430006
224400                 MOVE LQW-PARM-DESC (LQW-IDX)                     22440005
224500                            TO CN024-PARM-DESC     (CN024-IDX)    22450005
224600                 MOVE LQW-APPL-FUNC (LQW-IDX)                     22460005
224700                            TO CN024-PARM-FUNC     (CN024-IDX)    22470006
224800                 MOVE LQW-DEFN-CNT  (LQW-IDX)                     22480005
224900                            TO CN024-DEFN-CNT      (CN024-IDX)    22490005
224901                 MOVE LQW-ELEM-CNT  (LQW-IDX)                     22490105
224902                            TO CN024-DEFN-CNT      (CN024-IDX)    22490205
225000                                                                  22500001
225100                 SET CN024-IDX UP BY 1                            22510001
225200                 IF  CN024-IDX > CN024-MAX-ITEMS                  22520001
225300                     PERFORM 5205-WRITE-SEL-QUEUE                 22530001
225400                     ADD +1 TO CN023-NUMBER-OF-TS-ITEMS           22540029
225500                     INITIALIZE CN024-SELECTED-ITEM-ARRAY         22550001
225600                     SET CN024-IDX TO  1                          22560001
225700                 END-IF                                           22570001
225800           END-IF                                                 22580001
225900         END-PERFORM                                              22590001
226000     END-IF.                                                      22600001
226100                                                                  22610001
226200*----------------------------------------------------------------*22620001
226300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *22630001
226400*----------------------------------------------------------------*22640001
226500 5205-WRITE-SEL-QUEUE.                                            22650001
226600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO CN024-SELECTED-ITEMS.   22660001
226700                                                                  22670001
226800     EXEC CICS                                                    22680001
226900          WRITEQ TS                                               22690001
227000              QUEUE (ASC-SEL-QUEUE-NAME)                          22700001
227100              FROM  (CN024-SELECT-RECORD)                         22710001
227200              ITEM  (PV-SEL-QUEUE-ITEM)                           22720001
227300              RESP  (PV-CICS-RESP)                                22730001
227400     END-EXEC.                                                    22740001
227500                                                                  22750001
227600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22760001
227700         CONTINUE                                                 22770001
227800     ELSE                                                         22780001
227900         SET DP013-CICS-ABEND      TO TRUE                        22790001
228000         SET DP013-NO-ROLLBACK     TO TRUE                        22800001
228100         MOVE '5205-WRITE-SEL-QUEUE'                              22810001
228200                                   TO DP013-PARAGRAPH             22820001
228300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          22830001
228400                                   TO DP013-MESSAGE-TEXT(1)       22840001
228500         PERFORM DP013-0000-PROCESS-ABEND                         22850001
228600     END-IF.                                                      22860001
228700                                                                  22870001
228800******************************************************************22880001
228900** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **22890001
229000** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **22900001
229100** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **22910001
229200** THE USER.                                                    **22920001
229300******************************************************************22930001
229400 6000-REFRESH-PANEL-FROM-TEMP.                                    22940001
229500     IF  ASC-UPDATE-TSQ                                           22950001
229600         SET ASC-NO-TSQ-UPDATE TO TRUE                            22960001
229700         MOVE ZERO                 TO PV-SAVE-ITEM                22970001
229800                                      PV-SEL-QUEUE-ITEM           22980001
229900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        22990001
230000                                   TO PV-HOLD-SELECTED-ITEMS      23000001
230100         MOVE +1                   TO PV-ITEMS-PROCESSED          23010001
230200         PERFORM 6100-UPDATE-TSQ                                  23020001
230300             UNTIL PV-ITEMS-PROCESSED >                           23030001
230400                                     PV-HOLD-SELECTED-ITEMS       23040001
230500         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23050001
230600                    ASC-BLOCK-ENTRIES (2)                         23060001
230700     END-IF.                                                      23070001
230800                                                                  23080001
230900*----------------------------------------------------------------*23090001
231000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *23100001
231100*----------------------------------------------------------------*23110001
231200 6010-DELETE-SEL-QUEUE.                                           23120001
231300                                                                  23130001
231400     EXEC CICS                                                    23140001
231500         DELETEQ TS                                               23150001
231600             QUEUE (ASC-SEL-QUEUE-NAME)                           23160001
231700             RESP  (PV-CICS-RESP)                                 23170001
231800     END-EXEC.                                                    23180001
231900                                                                  23190001
232000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      23200001
232100        (PV-CICS-RESP = DFHRESP(QIDERR)))                         23210001
232200         CONTINUE                                                 23220001
232300     ELSE                                                         23230001
232400         SET DP013-CICS-ABEND TO TRUE                             23240001
232500         SET DP013-NO-ROLLBACK TO TRUE                            23250001
232600         MOVE '6010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          23260001
232700         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         23270001
232800                                        TO DP013-MESSAGE-TEXT (1) 23280001
232900         PERFORM DP013-0000-PROCESS-ABEND                         23290001
233000     END-IF.                                                      23300001
233100                                                                  23310001
233200*----------------------------------------------------------------*23320001
233300*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *23330001
233400*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *23340001
233500*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *23350001
233600*    THE TEMP QUEUE.                                             *23360001
233700*----------------------------------------------------------------*23370001
233800 6100-UPDATE-TSQ.                                                 23380001
233900                                                                  23390001
234000     ADD 1    TO  PV-SEL-QUEUE-ITEM.                              23400001
234100     PERFORM 6105-READ-SEL-QUEUE.                                 23410001
234200     PERFORM                                                      23420001
234300         VARYING CN024-IDX FROM 1 BY 1                            23430001
234400         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     23440001
234500         OR (CN024-IDX GREATER THAN CN024-MAX-ITEMS))             23450001
234600         IF  CN024-ACTION-SW (CN024-IDX) > SPACE                  23460001
234700             PERFORM 6110-PROCESS-ITEMS                           23470001
234800         END-IF                                                   23480001
234900         ADD +1                TO PV-ITEMS-PROCESSED              23490001
235000     END-PERFORM.                                                 23500001
235100     PERFORM 6111-WRITE-LIST-QUEUE.                               23510001
235200                                                                  23520001
235300*----------------------------------------------------------------*23530001
235400*    READ THE LIST QUEUE RECORD.                                 *23540001
235500*----------------------------------------------------------------*23550001
235600 6105-READ-SEL-QUEUE.                                             23560001
235700                                                                  23570001
235800     EXEC CICS                                                    23580001
235900          READQ TS                                                23590001
236000              QUEUE (ASC-SEL-QUEUE-NAME)                          23600001
236100              INTO  (CN024-SELECT-RECORD)                         23610001
236200              ITEM  (PV-SEL-QUEUE-ITEM)                           23620001
236300              RESP  (PV-CICS-RESP)                                23630001
236400     END-EXEC.                                                    23640001
236500                                                                  23650001
236600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23660001
236700         CONTINUE                                                 23670001
236800     ELSE                                                         23680001
236900         SET DP013-CICS-ABEND      TO  TRUE                       23690001
237000         SET DP013-NO-ROLLBACK     TO  TRUE                       23700001
237100         MOVE '6105-READ-SEL-QUEUE'                               23710001
237200                                   TO  DP013-PARAGRAPH            23720001
237300         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           23730001
237400                                   TO  DP013-MESSAGE-TEXT(1)      23740001
237500         PERFORM DP013-0000-PROCESS-ABEND                         23750001
237600     END-IF.                                                      23760001
237700                                                                  23770001
237800*----------------------------------------------------------------*23780001
237900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*23790001
238000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*23800001
238100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *23810001
238200*----------------------------------------------------------------*23820001
238300 6110-PROCESS-ITEMS.                                              23830001
238400                                                                  23840001
238500     COMPUTE PV-ITEM = 1 + ((CN024-ITEM (CN024-IDX) - 1)          23850001
238600                     / PC-ITEMS-PER-PANEL).                       23860001
238700                                                                  23870001
238800     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           23880001
238900         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          23890001
239000             PERFORM 6111-WRITE-LIST-QUEUE                        23900001
239100         END-IF                                                   23910001
239200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    23920001
239300                                                                  23930001
239400         PERFORM 6112-READ-LIST-QUEUE                             23940001
239500         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               23950001
239600             CONTINUE                                             23960001
239700         END-IF                                                   23970001
239800     END-IF.                                                      23980001
239900                                                                  23990001
240000     COMPUTE PV-SUB = (CN024-ITEM (CN024-IDX)                     24000001
240100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24010001
240200     SET LQW-DESELECT (PV-SUB) TO    TRUE                         24020001
240300     MOVE LQW-SELECTED-SW (PV-SUB)                                24030001
240400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  24040001
240500     EVALUATE TRUE                                                24050001
240600         WHEN CN024-INQ (CN024-IDX)                               24060001
240700              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             24070001
240800                                                                  24080001
240900         WHEN CN024-UPD (CN024-IDX)                               24090001
241000              MOVE PC-UPD      TO LQW-ACTION    (PV-SUB)          24100005
241100              MOVE CN024-PARM-NAME         (CN024-IDX)            24110006
241200                               TO LQW-PARM-CODE (PV-SUB)          24120005
241300              MOVE CN024-PARM-DESC         (CN024-IDX)            24130005
241400                               TO LQW-PARM-DESC (PV-SUB)          24140005
241500              MOVE CN024-PARM-FUNC         (CN024-IDX)            24150006
241600                               TO LQW-APPL-FUNC (PV-SUB)          24160005
241700              MOVE CN024-DEFN-CNT          (CN024-IDX)            24170005
241800                               TO LQW-DEFN-CNT (PV-SUB)           24180005
241810              MOVE CN024-ELEM-CNT          (CN024-IDX)            24181005
241820                               TO LQW-ELEM-CNT (PV-SUB)           24182005
241900                                                                  24190001
242000         WHEN CN024-DEL (CN024-IDX)                               24200001
242100              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             24210001
242200                                                                  24220001
242300         WHEN CN024-ERR (CN024-IDX)                               24230001
242400              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             24240001
242500                                                                  24250001
242600         WHEN OTHER                                               24260001
242700              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             24270001
242800                                                                  24280001
242900     END-EVALUATE.                                                24290001
243000                                                                  24300001
243100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                24310001
243200                                                                  24320001
243300*----------------------------------------------------------------*24330001
243400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *24340001
243500*----------------------------------------------------------------*24350001
243600 6111-WRITE-LIST-QUEUE.                                           24360001
243700                                                                  24370001
243800     EXEC CICS                                                    24380001
243900         WRITEQ TS                                                24390001
244000             QUEUE (ASC-LIST-QUEUE-NAME)                          24400001
244100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     24410001
244200             ITEM  (PV-SAVE-ITEM)                                 24420001
244300             REWRITE                                              24430001
244400             RESP  (PV-CICS-RESP)                                 24440001
244500     END-EXEC.                                                    24450001
244600                                                                  24460001
244700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24470001
244800         CONTINUE                                                 24480001
244900     ELSE                                                         24490001
245000         SET DP013-CICS-ABEND  TO  TRUE                           24500001
245100         SET DP013-NO-ROLLBACK TO  TRUE                           24510001
245200         MOVE '6111-WRITE-LIST-QUEUE' TO  DP013-PARAGRAPH         24520001
245300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  24530001
245400                               TO  DP013-MESSAGE-TEXT(1)          24540001
245500         PERFORM DP013-0000-PROCESS-ABEND                         24550001
245600     END-IF.                                                      24560001
245700                                                                  24570001
245800*----------------------------------------------------------------*24580001
245900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*24590001
246000*----------------------------------------------------------------*24600001
246100 6112-READ-LIST-QUEUE.                                            24610001
246200     EXEC CICS                                                    24620001
246300         READQ TS                                                 24630001
246400             QUEUE (ASC-LIST-QUEUE-NAME)                          24640001
246500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     24650001
246600             ITEM  (PV-ITEM)                                      24660001
246700             RESP  (PV-CICS-RESP)                                 24670001
246800     END-EXEC.                                                    24680001
246900                                                                  24690001
247000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24700001
247100         CONTINUE                                                 24710001
247200     ELSE                                                         24720001
247300         SET DP013-CICS-ABEND        TO TRUE                      24730001
247400         SET DP013-NO-ROLLBACK       TO TRUE                      24740001
247500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           24750001
247600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    24760001
247700                                     TO DP013-MESSAGE-TEXT(1)     24770001
247800         PERFORM DP013-0000-PROCESS-ABEND                         24780001
247900     END-IF.                                                      24790001
248000                                                                  24800001
248100*----------------------------------------------------------------*24810001
248200*    ABEND PROCESSOR MODULE                                      *24820001
248300*----------------------------------------------------------------*24830001
248400     COPY DPPD013.                                                24840001
