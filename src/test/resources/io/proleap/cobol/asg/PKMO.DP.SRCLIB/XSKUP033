000100*----------------------------------------------------------       00010003
000200 IDENTIFICATION DIVISION.                                         00020003
000300*----------------------------------------------------------       00030003
000400 PROGRAM-ID.    XSKUP033.                                         00040003
000500 AUTHOR.        ALEXIS KEIKER.                                    00050003
000600 DATE-WRITTEN.  OCTOBER 1, 2002.                                  00060003
000700                                                                  00070003
000800*----------------------------------------------------------       00080003
000900*            ADHOC STORE GROUP BUSINESS EVENT LOADER              00090003
001000*----------------------------------------------------------       00100003
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00101008
001020* LOAD FOR THE ADHOC STORE GROUP BUSINESS EVENT.  THIS PROGRAM    00102008
001030* IS A MODULE AND WILL BE CALLED BY ANOTHER PROGRAM(XSKUT034).    00103014
001040* THERE ARE 5 PARAMETERS PASSED IN THIS PROGRAM.  ONE WILL        00104008
001050* BE THE ACTUAL ADHOC STORE GROUP BUSINESS EVENT RECORD, MAXIMUM  00105008
001060* FUTURE OFFSET DATE IN CCYYMMDD, A LOAD SQL RETURN CODE FIELD,   00106008
001070* A PROGRAM STATUS CODE, AND A LOAD SEVERITY LEVEL.  THIS PROGRAM 00107008
001080* WILL EITHER UPDATE OR INSERT A RECORD TO THE XST_ADHC_STR_GP    00108008
001090* (ADHOC STORE GROUP TABLE).  THIS PROGRAM WILL ALWAYS SEND       00109008
001091* BACK A LOAD SQL RETURN CODE, A PROGRAM STATUS CODE, AND A       00109108
001092* LOAD SEVERITY CODE.  IF THE PROGRAM DOES NOT UPDATE OR          00109208
001093* INSERT THE RECORD CORRECTLY IT WILL SELECT THE CORRECT          00109308
001094* ERROR CODES, FIND THE LOAD SEVERITY LEVEL, AND EXIT OUT OF      00109408
001095* THE PROGRAM.                                                    00109508
001096*                                                                 00109608
001101*          SQL CODES - LOAD SQL RETURN CODE                       00110108
001102*             - THIS IS THE LAST SQL RETURN CODE RECEIVED         00110203
001103*               FROM A DATABASE ACTION.                           00110303
001104*                                                                 00110403
001105*          PROGRAM CODES - PROGRAM STATUS CODE                    00110508
001106*           - 00 - ALL DATABASE ACTION WAS SUCCESSFUL AND         00110603
001107*                  WORKED ACCORDING TO THE MESSAGE TYPE.          00110703
001108*           - 01 - AN 'ADD' RECORD WAS TURNED INTO AN             00110803
001109*                  UPDATE AND THE BUSINESS EVENT WAS FOUND        00110903
001110*                  TO BE THE ONE NEEDED ON THE DATABASE.          00111003
001111*           - 02 - AN 'ADD' RECORD WAS TURNED INTO AN UPDATE      00111103
001112*                  AND THE BUSINESS EVENT WAS FOUND TO BE         00111203
001113*                  THE ONE NOT NEEDED ON THE DATABASE.            00111303
001114*           - 03 - AN 'UPDATE' RECORD WAS TURNED INTO AN ADD.     00111403
001115*           - 04 - AN 'UPDATE' RECORD WAS BYPASSED BECAUSE THE    00111514
001116*                  RECORD CURRENTLY ON THE DATABASE WAS THE       00111614
001117*                  MOST RECENT DATA.                              00111714
001118*           - 05 - THE DATABASE ACTION WAS NOT SUCCESSFUL DUE     00111814
001119*                  TO THE RETURNED SQL CODE.                      00111903
001120*           - 06 - UNEXPECTED ACTION CODE RECEIVED.               00112014
001121*                                                                 00112103
001122*          ERROR CODES - LOAD SEVERITY LEVEL                      00112203
001123*          IF THE PROGRAM DOES NOT INSERT OR UPDATE THE RECORD,   00112308
001124*          THE ERROR CODE WILL ALWAYS BE CRITICAL.  THE LOAD      00112408
001125*          WILL NEVER BE NOT CRITICAL TO THIS SYSTEM FOR THE      00112508
001126*          ADHOC STORE GROUP BUSINESS EVENT.                      00112608
001127*           - 00 - THE LOAD OF THE DATA WAS SUCCESSFUL AND        00112708
001128*                  THEREFORE THE SEVERITY OF THE LOAD DID         00112808
001129*                  NOT NEED TO BE DETERMINED.                     00112908
001130*           - 01 - THE LOAD IS CRITICAL TO A SYSTEM AND           00113003
001131*                  THEREFORE MUST BE RESOLVED ASAP.               00113103
001132*           - 02 - THE LOAD IS NOT CRITICAL AND THEREFORE CAN     00113203
001133*                  WAIT UNTIL A LATER TIME TO BE RESOLVED.        00113303
001134*                                                                 00113403
001135*----------------------------------------------------------       00113503
001136* HISTORY LOG:                                                    00113603
001137*                                                                 00113703
001138*----------------------------------------------------------       00113803
001139* DATE:                                                           00113903
001140* WR/IR#:                                                         00114003
001141* PROGRAMMER:                                                     00114103
001142* DESCRIPTION:                                                    00114203
001143*                                                                 00114303
001144*----------------------------------------------------------       00114403
001145 ENVIRONMENT DIVISION.                                            00114503
001146*----------------------------------------------------------       00114603
001147 CONFIGURATION SECTION.                                           00114703
001148 SOURCE-COMPUTER. IBM-3090.                                       00114803
001149 OBJECT-COMPUTER. IBM-3090.                                       00114903
001150                                                                  00115003
001151 INPUT-OUTPUT SECTION.                                            00115103
001160                                                                  00116003
001170 FILE-CONTROL.                                                    00117003
001180                                                                  00118003
001190*----------------------------------------------------------       00119003
001200 DATA DIVISION.                                                   00120003
001300*----------------------------------------------------------       00130003
001400 FILE SECTION.                                                    00140003
001500                                                                  00150003
001600                                                                  00160003
001700*---------------------------------------------------------        00170003
001800                                                                  00180003
001900 WORKING-STORAGE SECTION.                                         00190003
002000*---------------------------------------------------------        00200003
002100* PC- PROGRAM CONSTANTS                                           00210003
002200*----------------------------------------------------------       00220003
002300 01  PC-PROGRAM-CONSTANTS.                                        00230003
002400     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKUP033'. 00240003
002500     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00250003
002600                                                                  00260003
002700*----------------------------------------------------------       00270003
002800* PS- PROGRAM SWITCHES                                            00280003
002900*----------------------------------------------------------       00290003
003000 01  PS-PROGRAM-SWITCHES.                                         00300003
003100     05  PS-PROCESS-CONTINUE-SW       PIC X(01)  VALUE 'Y'.       00310003
003200         88  PS-PROCESS-CONTINUE                 VALUE 'Y'.       00320003
003300         88  PS-PROCESS-COMPLETE                 VALUE 'N'.       00330003
003400                                                                  00340003
003500*----------------------------------------------------------       00350003
003600* PV- PROGRAM VARIABLES                                           00360003
003700*----------------------------------------------------------       00370003
003800 01 PV-PROGRAM-VARIABLES.                                         00380003
003900    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   00390003
003910    05  PV-SQL-CODE                   PIC S9(4)  VALUE +0.        00391020
004000    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         00400003
004100    05  PV-LAST-UPD-TMST              PIC X(26)  VALUE SPACES.    00410003
004220    05  PV-ACTION-CODE                PIC X(01).                  00422003
004230        88  PV-INSERT-DATA                       VALUE 'I'.       00423003
004240        88  PV-UPDATE-DATA                       VALUE 'U'.       00424003
004250    05  PV-LD-STATUS-CDE              PIC X(02).                  00425003
004260        88  PV-NO-ERROR                          VALUE '00'.      00426003
004270        88  PV-CRITICAL-ERROR                    VALUE '01'.      00427003
004280        88  PV-NOT-CRITICAL-ERROR                VALUE '02'.      00428003
004290    05  PV-PGM-STATUS-CDE             PIC X(02).                  00429003
004300        88  PV-SUCCESS-CDE                       VALUE '00'.      00430003
004400        88  PV-UPDATE-NEED                       VALUE '01'.      00440003
004500        88  PV-UPDATE-NOT-NEED                   VALUE '02'.      00450003
004600        88  PV-ADD-CDE                           VALUE '03'.      00460003
004610        88  PV-UPDATE-BYPASS                     VALUE '04'.      00461014
004700        88  PV-NO-SUCCESS-CDE                    VALUE '05'.      00470014
004800        88  PV-UNEXPECT-CDE                      VALUE '06'.      00480014
007200                                                                  00720003
007210    05  PV-NULLS-INDICATORS.                                      00721016
007220        10  PV-STRT-TMST-IND          PIC S9(4) COMP VALUE +0.    00722016
007230        10  PV-END-TMST-IND           PIC S9(4) COMP VALUE +0.    00723016
007240                                                                  00724016
007300*----------------------------------------------------------       00730003
007400* ADHOC STORE GROUP BUSINESS EVENT RECORD LAYOUT                  00740004
007500*----------------------------------------------------------       00750003
007600     COPY XSRD023.                                                00760004
007700                                                                  00770003
008300*----------------------------------------------------------       00830003
008400* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         00840003
008500*----------------------------------------------------------       00850003
008600     COPY DPWS004.                                                00860003
008700                                                                  00870003
008800*---------------------------------------------                    00880003
008900*  DB2 COMMUNICATION AREA.                                        00890003
009000*---------------------------------------------                    00900003
009100     EXEC SQL                                                     00910003
009200          INCLUDE SQLCA                                           00920003
009300     END-EXEC.                                                    00930003
009400                                                                  00940003
009500*---------------------------------------------                    00950003
009600*  DB2 TABLE XST00036(XST_ADHC_STR_GP) - ADHOC STORE GROUP TABLE  00960004
009700*---------------------------------------------                    00970003
009800     EXEC SQL                                                     00980003
009900          INCLUDE XST00036                                        00990004
010000     END-EXEC.                                                    01000003
010100                                                                  01010003
010200 LINKAGE SECTION.                                                 01020003
010300                                                                  01030003
010400*----------------------------------------------------------       01040003
010500* FILE INFORMATION BEING PASSED TO AND FROM THIS MODULE.          01050003
010600*----------------------------------------------------------       01060003
010700 01 LV-LINKAGE-VARIABLES.                                         01070003
010800    05  LV-ADHOC-STR-GRP-BUS-REC   PIC X(300).                    01080004
010900    05  LV-MAX-OFFSET-DTE          PIC X(08).                     01090003
011000    05  LV-LD-SQL-RETURN-CDE       PIC S9(4).                     01100003
011100    05  LV-PGM-STATUS-CDE          PIC X(02).                     01110003
011200    05  LV-LD-SEVERITY-LVL         PIC X(02).                     01120003
011300                                                                  01130003
011400                                                                  01140003
011500*----------------------------------------------------------       01150003
011600 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   01160003
011700*----------------------------------------------------------       01170003
011800 0000-MAINLINE.                                                   01180003
011900                                                                  01190003
012000     PERFORM 1000-INITIALIZATION.                                 01200003
012100                                                                  01210003
012200     PERFORM 2000-PROCESS-MESSAGE                                 01220003
012300             UNTIL PS-PROCESS-COMPLETE.                           01230003
012400                                                                  01240003
012500     PERFORM 9999-WRAPUP.                                         01250003
012600                                                                  01260003
012700     EXIT PROGRAM.                                                01270022
012800                                                                  01280003
012900*0000-EXIT.                                                       01290003
013000 EJECT.                                                           01300003
013100                                                                  01310003
013200*----------------------------------------------------------       01320003
013300* 1000-INITIALIZATION.                                            01330003
013400*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            01340003
013500*     UPDATE OR INSERT A RECORD.                                  01350003
013600*----------------------------------------------------------       01360003
013700 1000-INITIALIZATION.                                             01370003
013800                                                                  01380003
013900     INITIALIZE DCLXST00036.                                      01390006
013901     INITIALIZE PV-SQL-CODE                                       01390120
013910                PV-NULLS-INDICATORS.                              01391020
014000     MOVE LV-ADHOC-STR-GRP-BUS-REC TO XS023-ADHOC-STR-GP-RECORD.  01400019
014100     MOVE XS023-ACTION-CDE         TO PV-ACTION-CODE.             01410004
014600     SET PV-NO-ERROR               TO TRUE.                       01460004
014700     SET PV-SUCCESS-CDE            TO TRUE.                       01470004
014800     SET PS-PROCESS-CONTINUE       TO TRUE.                       01480004
014900                                                                  01490003
014980     PERFORM 1100-POPULATE-DCLGEN.                                01498003
014990                                                                  01499003
015000*1000-EXIT.                                                       01500003
015100 EJECT.                                                           01510003
015200                                                                  01520003
015300*----------------------------------------------------------       01530003
015400* 1100-POPULATE-DCLGEN.                                           01540003
015500*     POPULATES THE ADHOC STORE GROUP TABLE VARIABLES.            01550021
015700*----------------------------------------------------------       01570003
015800 1100-POPULATE-DCLGEN.                                            01580003
015900                                                                  01590003
016000     MOVE XS023-ADHC-STR-GP-ID  TO XST00036-ADHC-STR-GP-ID.       01600012
016100     MOVE XS023-ADHC-STR-GP-NM  TO XST00036-ADHC-STR-GP-NM.       01610014
016200     MOVE XS023-RUSBL-IND       TO XST00036-RUSBL-IND.            01620014
017000     MOVE XS023-STAT-CDE        TO XST00036-STAT-CDE.             01700004
017200     MOVE XS023-LAST-UPD-TMST   TO XST00036-SOR-LAST-UPD-TMST.    01720014
017300                                                                  01730003
017301     IF XS023-RUSBL-STRT-TMST = SPACES                            01730116
017302        MOVE -1                    TO PV-STRT-TMST-IND            01730216
017303     ELSE                                                         01730316
017310        MOVE XS023-RUSBL-STRT-TMST TO XST00036-RUSBL-STRT-TMST    01731016
017311     END-IF.                                                      01731116
017312                                                                  01731216
017313     IF XS023-RUSBL-END-TMST = SPACES                             01731316
017314        MOVE -1                    TO PV-END-TMST-IND             01731416
017315     ELSE                                                         01731516
017320        MOVE XS023-RUSBL-END-TMST  TO XST00036-RUSBL-END-TMST     01732016
017330     END-IF.                                                      01733016
017340                                                                  01734016
017400*1100-EXIT.                                                       01740003
017500 EJECT.                                                           01750003
017600                                                                  01760003
017700*----------------------------------------------------------       01770003
017800* 2000-PROCESS-MESSAGE.                                           01780003
017900*     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            01790003
018000*     SHOULD BE INSERTED INTO THE ADHOC STORE GROUP TABLE OR      01800007
018100*     UPDATED. IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL 01810007
018200*     PROCESS AN ERROR AND EXIT THE PROGRAM.                      01820003
018300*----------------------------------------------------------       01830003
018400 2000-PROCESS-MESSAGE.                                            01840003
018500                                                                  01850003
018600     EVALUATE TRUE                                                01860003
018700        WHEN PV-INSERT-DATA                                       01870003
018800             PERFORM 2100-INSERT-DATA                             01880003
018900        WHEN PV-UPDATE-DATA                                       01890003
019000             PERFORM 2200-UPDATE-DATA                             01900003
019100        WHEN OTHER                                                01910003
019200             SET PS-PROCESS-COMPLETE TO TRUE                      01920003
019300             SET PV-UNEXPECT-CDE     TO TRUE                      01930003
019400             SET PV-CRITICAL-ERROR   TO TRUE                      01940004
019500     END-EVALUATE.                                                01950003
019600                                                                  01960003
019700*2000-EXIT.                                                       01970003
019800 EJECT.                                                           01980003
019900                                                                  01990003
020000*------------------------------------------------------           02000003
020100* 2100-INSERT-DATA.                                               02010003
020200*     INSERT THE ADHOC STORE GROUP RECORD.                        02020004
020300*------------------------------------------------------           02030003
020400 2100-INSERT-DATA.                                                02040003
020500                                                                  02050003
020600     PERFORM                                                      02060003
020700         WITH TEST AFTER                                          02070003
020800         VARYING PV-SQL-SUB                                       02080003
020900         FROM 1 BY 1                                              02090003
021000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 02100003
021100                   OR  SQLCODE NOT = -904 AND -911 AND -913)      02110010
021400                                                                  02140003
021500         EXEC SQL                                                 02150003
021600             INSERT INTO XST_ADHC_STR_GP                          02160004
021610                                      (ADHC_STR_GP_ID             02161005
021620                                      ,ADHC_STR_GP_NM             02162014
021630                                      ,RUSBL_IND                  02163014
021640                                      ,RUSBL_STRT_TMST            02164014
021650                                      ,RUSBL_END_TMST             02165014
021700                                      ,STAT_CDE                   02170004
021800                                      ,LAST_UPD_TMST              02180014
021900                                      ,SOR_LAST_UPD_TMST)         02190014
022700             VALUES                                               02270003
022800                (:XST00036-ADHC-STR-GP-ID                         02280004
022810                ,:XST00036-ADHC-STR-GP-NM                         02281014
022820                ,:XST00036-RUSBL-IND                              02282014
022830                ,:XST00036-RUSBL-STRT-TMST :PV-STRT-TMST-IND      02283016
022840                ,:XST00036-RUSBL-END-TMST :PV-END-TMST-IND        02284016
022900                ,:XST00036-STAT-CDE                               02290004
023000                ,CURRENT TIMESTAMP                                02300014
023100                ,:XST00036-SOR-LAST-UPD-TMST)                     02310014
023450         END-EXEC                                                 02345003
023460                                                                  02346003
023461         MOVE SQLCODE TO PV-SQL-CODE                              02346120
023462                                                                  02346220
023470         EVALUATE TRUE                                            02347003
023480             WHEN SQLCODE = -904                                  02348003
023490             WHEN SQLCODE = -911                                  02349003
023500             WHEN SQLCODE = -913                                  02350003
023600                  CONTINUE                                        02360003
023700             WHEN SQLCODE = 0                                     02370003
023800                  SET PS-PROCESS-COMPLETE TO TRUE                 02380003
023900             WHEN SQLCODE = -803                                  02390003
024000                  PERFORM 2300-SELECT-DATA                        02400014
024010                  MOVE -803 TO SQLCODE                            02401020
024100             WHEN OTHER                                           02410003
024200                  SET PS-PROCESS-COMPLETE TO TRUE                 02420003
024300                  SET PV-NO-SUCCESS-CDE TO TRUE                   02430003
024400                  SET PV-CRITICAL-ERROR TO TRUE                   02440004
024410                  INITIALIZE PV-SQL-SUB                           02441011
024500         END-EVALUATE                                             02450003
024600     END-PERFORM.                                                 02460003
024700                                                                  02470003
024800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         02480003
024900        SET PS-PROCESS-COMPLETE TO TRUE                           02490003
025000        SET PV-NO-SUCCESS-CDE TO TRUE                             02500003
025100        SET PV-CRITICAL-ERROR TO TRUE                             02510004
025200     END-IF.                                                      02520003
025300                                                                  02530003
025400*2100-EXIT.                                                       02540003
025500 EJECT.                                                           02550003
025600                                                                  02560003
032100*------------------------------------------------------           03210003
032200* 2200-UPDATE-DATA.                                               03220003
032300*     UPDATE THE ADHOC STORE GROUP RECORD.                        03230004
032400*------------------------------------------------------           03240003
032500 2200-UPDATE-DATA.                                                03250003
032600                                                                  03260003
032700     PERFORM                                                      03270003
032800         WITH TEST AFTER                                          03280003
032900         VARYING PV-SQL-SUB                                       03290003
033000         FROM 1 BY 1                                              03300003
033100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03310003
033200                   OR  SQLCODE NOT = -904 AND -911 AND -913)      03320010
033500                                                                  03350003
033600         EXEC SQL                                                 03360003
033700             UPDATE XST_ADHC_STR_GP                               03370004
033800             SET  ADHC_STR_GP_ID    = :XST00036-ADHC-STR-GP-ID,   03380004
033810                  ADHC_STR_GP_NM    = :XST00036-ADHC-STR-GP-NM,   03381014
033820                  RUSBL_IND         = :XST00036-RUSBL-IND,        03382014
033830                  RUSBL_STRT_TMST   = :XST00036-RUSBL-STRT-TMST   03383016
033831                                        :PV-STRT-TMST-IND,        03383116
033840                  RUSBL_END_TMST    = :XST00036-RUSBL-END-TMST    03384016
033850                                        :PV-END-TMST-IND,         03385016
033900                  STAT_CDE          = :XST00036-STAT-CDE,         03390004
034000                  LAST_UPD_TMST     = CURRENT TIMESTAMP,          03400014
034100                  SOR_LAST_UPD_TMST = :XST00036-SOR-LAST-UPD-TMST 03410015
034810            WHERE ADHC_STR_GP_ID    = :XST00036-ADHC-STR-GP-ID    03481014
034820              AND SOR_LAST_UPD_TMST <= :XST00036-SOR-LAST-UPD-TMST03482017
034830         END-EXEC                                                 03483003
034840                                                                  03484003
034841         MOVE SQLCODE TO PV-SQL-CODE                              03484120
034842                                                                  03484220
034850         EVALUATE TRUE                                            03485003
034860             WHEN SQLCODE = -904                                  03486003
034870             WHEN SQLCODE = -911                                  03487003
034880             WHEN SQLCODE = -913                                  03488003
034890                  CONTINUE                                        03489003
034900             WHEN SQLCODE = 0                                     03490003
035000                  SET PS-PROCESS-COMPLETE TO TRUE                 03500003
035100             WHEN SQLCODE = +100                                  03510003
035200                  PERFORM 2300-SELECT-DATA                        03520014
035300                  MOVE +100 TO SQLCODE                            03530020
035400             WHEN OTHER                                           03540003
035500                  SET PS-PROCESS-COMPLETE TO TRUE                 03550003
035600                  SET PV-NO-SUCCESS-CDE TO TRUE                   03560003
035700                  SET PV-CRITICAL-ERROR TO TRUE                   03570004
035710                  INITIALIZE PV-SQL-SUB                           03571011
035800         END-EVALUATE                                             03580003
035900     END-PERFORM.                                                 03590003
036000                                                                  03600003
036100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03610003
036200        SET PS-PROCESS-COMPLETE TO TRUE                           03620003
036300        SET PV-NO-SUCCESS-CDE TO TRUE                             03630003
036400        SET PV-CRITICAL-ERROR TO TRUE                             03640004
036500     END-IF.                                                      03650003
036600                                                                  03660003
036700*2200-EXIT.                                                       03670003
036800 EJECT.                                                           03680003
036900                                                                  03690003
037000*------------------------------------------------------           03700014
037100* 2300-SELECT-DATA.                                               03710014
037200*     SELECT THE TIMESTAMP IN THE ADHOC STORE GROUP TABLE.        03720014
037300*------------------------------------------------------           03730014
037400 2300-SELECT-DATA.                                                03740014
037500                                                                  03750014
037600     PERFORM                                                      03760014
037700         WITH TEST AFTER                                          03770014
037800         VARYING PV-SQL-SUB                                       03780014
037900         FROM 1 BY 1                                              03790014
038000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03800014
038100                   OR  SQLCODE NOT = -904 AND -911 AND -913)      03810014
038200                                                                  03820014
038300         EXEC SQL                                                 03830014
038400             SELECT  SOR_LAST_UPD_TMST                            03840014
038500               INTO :PV-LAST-UPD-TMST                             03850014
038600               FROM  XST_ADHC_STR_GP                              03860014
038700              WHERE  ADHC_STR_GP_ID  = :XST00036-ADHC-STR-GP-ID   03870014
038800         END-EXEC                                                 03880014
038900                                                                  03890014
038910         MOVE SQLCODE TO PV-SQL-CODE                              03891020
038920                                                                  03892020
039000         EVALUATE TRUE                                            03900014
039100             WHEN SQLCODE = -904                                  03910014
039200             WHEN SQLCODE = -911                                  03920014
039300             WHEN SQLCODE = -913                                  03930014
039400                  CONTINUE                                        03940014
039500             WHEN SQLCODE = 0                                     03950014
039510                  IF PV-UPDATE-DATA                               03951014
039520                     SET PS-PROCESS-COMPLETE TO TRUE              03952014
039530                     SET PV-UPDATE-BYPASS TO TRUE                 03953014
039540                  ELSE                                            03954014
039550                     PERFORM 2350-TMST-COMPARE                    03955021
039560                  END-IF                                          03956014
039570             WHEN SQLCODE = +100                                  03957014
039580                  SET PV-INSERT-DATA TO TRUE                      03958014
039590                  SET PV-ADD-CDE TO TRUE                          03959014
039700             WHEN OTHER                                           03970014
039800                  SET PS-PROCESS-COMPLETE TO TRUE                 03980014
039900                  SET PV-NO-SUCCESS-CDE TO TRUE                   03990014
040000                  SET PV-CRITICAL-ERROR TO TRUE                   04000014
040100                  INITIALIZE PV-SQL-SUB                           04010014
040200         END-EVALUATE                                             04020014
040300     END-PERFORM.                                                 04030014
040400                                                                  04040014
040500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04050014
040600        SET PS-PROCESS-COMPLETE TO TRUE                           04060014
040700        SET PV-NO-SUCCESS-CDE TO TRUE                             04070014
040800        SET PV-CRITICAL-ERROR TO TRUE                             04080014
040900     END-IF.                                                      04090014
041000                                                                  04100014
041010*2300-EXIT.                                                       04101014
041020 EJECT.                                                           04102014
041030                                                                  04103014
041040*--------------------------------------------------------         04104014
041050* 2350-TMST-COMPARE.                                              04105021
041060*     COMPARE TIMESTAMP OF EXISTING ROW TO MESSAGE RECORD         04106021
041070*     AND UPDATE IF MESSAGE HAS A NEWER TIMESTAMP.                04107021
041080*--------------------------------------------------------         04108014
041090 2350-TMST-COMPARE.                                               04109021
041091                                                                  04109114
041092     IF XS023-LAST-UPD-TMST >= PV-LAST-UPD-TMST                   04109214
041093        SET PV-UPDATE-DATA      TO TRUE                           04109314
041094        SET PV-UPDATE-NEED      TO TRUE                           04109414
041095     ELSE                                                         04109514
041096        SET PS-PROCESS-COMPLETE TO TRUE                           04109614
041097        SET PV-UPDATE-NOT-NEED  TO TRUE                           04109714
041098     END-IF.                                                      04109814
041099                                                                  04109914
041100*2350-EXIT.                                                       04110014
041101 EJECT.                                                           04110114
041102                                                                  04110214
041110*----------------------------------------------------------       04111003
041200* 9999-WRAPUP.                                                    04120003
041300*     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           04130003
041400*     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           04140003
041500*     PROGRAM.                                                    04150003
041600*----------------------------------------------------------       04160003
041700 9999-WRAPUP.                                                     04170003
041800                                                                  04180003
041900     MOVE PV-PGM-STATUS-CDE TO LV-PGM-STATUS-CDE.                 04190003
042000     MOVE PV-SQL-CODE       TO LV-LD-SQL-RETURN-CDE.              04200020
042100     MOVE PV-LD-STATUS-CDE  TO LV-LD-SEVERITY-LVL.                04210003
042200                                                                  04220003
042300*9999-EXIT.                                                       04230003
042400 EJECT.                                                           04240003
042500                                                                  04250003
