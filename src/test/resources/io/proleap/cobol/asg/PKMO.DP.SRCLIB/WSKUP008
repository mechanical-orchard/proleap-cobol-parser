000100 IDENTIFICATION DIVISION.                                         00010068
000200 PROGRAM-ID.         WSKUP008.                                    00020068
000300 AUTHOR.             RENGIN SIRVANCI.                             00030068
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040068
000500 DATE-WRITTEN.       MARCH 2007.                                  00050068
000600                                                                  00060068
000700****************************************************************  00070068
000800* I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES 00080068
000900* SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.        00090068
001000* THIS PROGRAM USES MQSERIES.                                     00100068
001100****************************************************************  00110068
001200* THIS PROGRAM WILL PROCESS PIX TRANSACTIONS FROM THE CUBISCAN.   00120068
001300* IT WILL READ XML MQ MESSAGES FROM WMOS (PIX TRANSACTIONS        00130068
001400* FROM THE NEW CUBISCAN QUEUE) AND INSERT/UPDATE TWEBITM/         00140068
001500* IMT_ITM_DC_ASSN DATABASE.  IT WILL ALSO CALCULATE THE           00150068
001600* SURCHARGE.                                                      00160068
001700* THE MESSAGES FROM WMOS WILL BE ON A QUEUE IN XML FORMAT COMING  00170068
001800* IN AS 1 PIX(PERPETUAL INVENTORY TRANSACTION) 800-01 TRANSACTION.00180068
001900****************************************************************  00190068
002000* TRIGGERED TASK:                                                 00200068
002100* -------------                                                   00210068
002200* THIS PROGRAM RUNS AS A STARTED TASK.  THE TASK STARTS WHEN      00220068
002300* CICS IS BROUGHT UP IN THE MORNING.  IT WILL RUN CONTINUOUSLY    00230068
002400* UNTIL IT ENCOUNTERS THE "END RUN OF PROGRAM" MESSAGE THAT       00240068
002500* WILL BE SENT TO THE ITEM QUEUE FROM A SEPARATE PROGRAM USING    00250068
002600* AN MQPUT1 CALL.                                                 00260068
002700*                                                                 00270068
002800* A TRANSACTION-TYPE OF 999 WILL SHUT DOWN THE ITEM PROCESS.      00280068
002900*                                                                 00290068
003000* GENERAL PROCESSING:                                             00300068
003100* -------------------                                             00310068
003200* 1) INITIALIZE VARIABLES, SET SWITCHES, OPEN CUBISCAN QUEUE.     00320068
003300* 2) GET MQ MESSAGE COMING IN XML FORMAT ON AN 800-01 PIX         00330068
003400*    TRANSACTION.                                                 00340068
003500* 3) CHECK TO SEE IF UPDATE IS NEEDED BY COMPARING FIELDS.        00350068
003600* 4) CALCULATE THE SURCHARGE.                                     00360068
003700* 5) BREAK THE MESSAGE DOWN INTO ITS COMPONENTS, REFORMAT THE DATA00370068
003800*    TO INSERT/UPDATE THE TWEBITM/IMT_ITM_DC_ASSN DATABASE.       00380068
003900* 6) PROCESS INSERTS/UPDATES.                                     00390068
004000* 7) IF AN ERROR IS FOUND ON A MESSAGE COMING IN, THE ENTIRE      00400068
004100*    MESSAGE WILL BE PUT ON THE ERROR QUEUE, WSRD027 FORMAT.      00410068
004200*                                                                 00420068
004300* -----------------                                               00430068
004400* ERROR PROCESSING:                                               00440068
004500* -----------------                                               00450068
004600* THIS PROGRAM IS CODED TO TRAP 4 TYPES OF ERRORS WHICH ARE:      00460068
004700* 1) REC NOT FOUND                                                00470068
004800* 2) DUP INSERT                                                   00480068
004900* 3) SQL ERROR                                                    00490068
005000* 4) INVALID REC                                                  00500068
005100                                                                  00510068
005200* UNITS OF WORK AND COMMITS:                                      00520068
005300* --------------------------                                      00530068
005400* A UNIT OF WORK FOR A DB2 COMMIT WILL BE COMPLETE WHEN A         00540068
005500* MESSAGE FOR A CUBISCAN ENTRY RECORD HAS BEEN READ FROM THE      00550068
005600* QUEUE AND INSERTED TO THE TWEBITM/IMT_ITM_DC_ASSN DATABASE      00560068
005700* OR AN ERROR MESSAGE IS WRITTEN IF AN ERROR IS ENCOUNTERED.      00570068
005800* A DB2 COMMIT IS ALSO PERFORMED IF A CUBISCAN DATA BASE RECORD   00580068
005900* IS INSERTED TO THE TWEBITM DATABASE TABLE.                      00590068
006000* THEN AN MQ COMMIT WILL BE PERFORMED TO PERMANENTLY 'REMOVE' THE 00600068
006100* MESSAGES FROM THE ITEM QUEUE.                                   00610068
006200* MQ COMMITS ARE ALSO PERFORMED AFTER AN ERROR MESSAGE HAS BEEN   00620068
006300* WRITTEN TO THE ERROR QUEUE.                                     00630068
006400****************************************************************  00640075
006500* -------------------------------------------                     00650068
006600* MODIFICATION BY CRAIG KEHOE AND MARJ HOEFS (JANUARY 2008):      00660068
006700* -------------------------------------------                     00670068
006800* ADDED NEW PARAGRAPH 6506-NON-DIRECT-SHIP-PROCESS.               00680068
006900* CHANGED PARAGRAPH 6500-LOAD-TWEBITM TO PERFORM                  00690068
007000* 6506-NON-DIRECT-SHIP-PROCESS.                                   00700068
007100* CHANGES MADE SO THAT IF AN ITEM IN THE PIX RELATES TO A         00710068
007200* TWEBITM RECORD THAT HAS SHIP_GP_SEQ_NBR = 13 (INDICATING THAT   00720068
007300* THE ITEM IS A DIRECT-SHIP ITEM), THEN DO NOT UPDATE THE         00730068
007400* ITEM'S TWEBITM.SHIP_GP_SEQ_NBR, TWEBITM.SHIP_SRVC_SEQ_NBR,      00740068
007500* TWEBITM.SHIP_SRCHG_FEE_AMT, TWEBITM.SHIP_RSTRC_SEQ_NBR, OR      00750068
007600* TWEBITM.GFT_WRAP_AVL_IND FIELDS.  OTHERWISE, UPDATE THOSE FIVE  00760068
007700* FIELDS AS BEFORE.                                               00770068
007710*                                                                 00771071
007720* 2011-01-17 Christine Twiehaus WR38972                           00772071
007800*            Declare cursor, order by QUE_NM descending.          00780071
007810*            Select first row returned.                           00781071
007820*                                                                 00782069
007900****************************************************************  00790068
      *  3/31/2016 MARJ HOEFS - TURNED OFF ABILITY TO UPDATE GIFT WRAP  00790175
      *  AVAILABLE INDICATOR TO "Y".  THIS PROGRAM WILL ALWAYS SET IT   00790275
      *  TO "N".  SINCE THIS CHANGE MAY NOT BE PERMANENT THE RELEVANT   00790375
      *  LINES WERE JUST COMMENTED OUT.  TO MAKE GIFT WRAP UPDATABLE    00790475
      *  TO "Y" AGAIN, UNCOMMENT OUT THE LINES PREFIXED WITH "GFTWRP".  00790575
007900****************************************************************  00791075
008000 ENVIRONMENT DIVISION.                                            00800068
008100****************************************************************  00810068
008200 CONFIGURATION SECTION.                                           00820068
008300 SOURCE-COMPUTER.        IBM-3090.                                00830068
008400 OBJECT-COMPUTER.        IBM-3090.                                00840068
008500 INPUT-OUTPUT SECTION.                                            00850068
008600                                                                  00860068
008700 FILE-CONTROL.                                                    00870068
008800****************************************************************  00880068
008900 DATA DIVISION.                                                   00890068
009000****************************************************************  00900068
009100 FILE SECTION.                                                    00910068
009200                                                                  00920068
009300 WORKING-STORAGE SECTION.                                         00930068
009400******************************************************************00940068
009500  01  PV-ABEND-CODE                   PIC S9(04) VALUE ZERO       00950068
009600                                                 COMP SYNC.       00960068
009700******************************************************************00970068
009800**** PROGRAM CONSTANTS                                            00980068
009900******************************************************************00990068
010000 01  PC-PROGRAM-CONSTANTS.                                        01000068
010100     05  PC-PGM-NAME             PIC X(08) VALUE 'WSKUP008'.      01010068
010200     05  PC-READY                    PIC X(06) VALUE 'READY '.    01020068
010300     05  PC-ERROR                    PIC X(06) VALUE 'ERROR '.    01030068
010400     05  PC-WAIT-15-SECS             PIC S9(9) VALUE 1500.        01040068
010500     05  PC-MQPUT-RETRY-COUNTER      PIC 9(3)  VALUE ZERO.        01050068
010600     05  PC-DELAY-INTERVAL.                                       01060068
010700         10  FILLER                  PIC X(2)  VALUE SPACES.      01070068
010800         10  PC-DELAY-TIME           PIC 9(8)  VALUE 3000.        01080068
010900                                                                  01090068
011000******************************************************************01100068
011100**** PROGRAM VARIABLES                                            01110068
011200******************************************************************01120068
011300 01  PV-PROGRAM-VARIABLES.                                        01130068
011400     05  PV-START                 PIC 9(3)        VALUE ZERO.     01140068
011500     05  PV-NULL-IND-1            PIC S9(4) VALUE +0 COMP.        01150068
011600     05  PV-END                   PIC 9(3)        VALUE ZERO.     01160068
011700     05  PV-LEN                   PIC 9(3)        VALUE ZERO.     01170068
011800     05  PV-CURRENT-ELEMENT       PIC X(30)       VALUE SPACES.   01180068
011900     05  PV-CURRENT-ATTRIBUTE     PIC X(30)       VALUE SPACES.   01190068
012000     05  PV-PRC-CNTL-TMST         PIC  X(26)      VALUE SPACES.   01200068
012100     05  PV-TRANSACTION-TYPE      PIC X(3)        VALUE SPACES.   01210068
012200     05  PV-TRANSACTION-CODE      PIC X(3)        VALUE SPACES.   01220068
012300     05  PV-TRAN-CDE              PIC X(3)        VALUE SPACES.   01230068
012400     05  PV-USER-ID               PIC X(15)  JUST RIGHT.          01240068
012500     05  PV-USER-ID-A        REDEFINES PV-USER-ID.                01250068
012600         10  FILLER               PIC X(07).                      01260068
012700         10  PV-USER-ID-CONVRTD   PIC X(08).                      01270068
012800     05  PV-WEBITM-CRE-BY-USR-ID  PIC X(08)     VALUE SPACES.     01280068
012900     05  PV-ITEM-HEIGHT           PIC X(20)  JUST RIGHT.          01290068
013000     05  PV-ITEM-HEIGHT-A    REDEFINES PV-ITEM-HEIGHT.            01300068
013100         10  FILLER               PIC X(08).                      01310068
013200         10  PV-HEIGHT-NUMERIC    PIC 9(5).9(06).                 01320068
013300     05  PV-HEIGHT-CONVRTD        PIC 9(05)V9(06)  VALUE  0.      01330068
013400     05  PV-WEBITM-HEIGHT         PIC S9(04)V9(03) VALUE  0.      01340068
013500     05  PV-ITEM-DEPTH            PIC X(20)  JUST RIGHT.          01350068
013600     05  PV-ITEM-DEPTH-A     REDEFINES PV-ITEM-DEPTH.             01360068
013700         10  FILLER               PIC X(08).                      01370068
013800         10  PV-DEPTH-NUMERIC     PIC 9(5).9(06).                 01380068
013900     05  PV-DEPTH-CONVRTD         PIC 9(05)V9(06)  VALUE  0.      01390068
014000     05  PV-WEBITM-DEPTH          PIC S9(04)V9(03) VALUE  0.      01400068
014100     05  PV-ITEM-WIDTH            PIC X(20)  JUST RIGHT.          01410068
014200     05  PV-ITEM-WIDTH-A     REDEFINES PV-ITEM-WIDTH.             01420068
014300         10  FILLER               PIC X(08).                      01430068
014400         10  PV-WIDTH-NUMERIC     PIC 9(5).9(06).                 01440068
014500     05  PV-WIDTH-CONVRTD         PIC 9(05)V9(02)  VALUE  0.      01450068
014600     05  PV-WEBITM-WIDTH          PIC S9(04)V9(03) VALUE  0.      01460068
014700     05  PV-ITEM-WEIGHT           PIC X(20)  JUST RIGHT.          01470068
014800     05  PV-ITEM-WEIGHT-A    REDEFINES PV-ITEM-WEIGHT.            01480068
014900         10  FILLER               PIC X(04).                      01490068
015000         10  PV-WEIGHT-NUMERIC    PIC 9(09).9(06).                01500068
015100     05  PV-WEIGHT-CONVRTD        PIC 9(09)V9(06)  VALUE  0.      01510068
015200     05  PV-WEBITM-WEIGHT         PIC S9(08)V9(03) VALUE  0.      01520068
015300     05  PV-REF-6                 PIC X(20).                      01530068
015400     05  PV-REF-6-A          REDEFINES PV-REF-6.                  01540068
015500         10  PV-REF-6-BYTE1       PIC X(01).                      01550068
015600         10  PV-REF-6-BYTE2       PIC X(01).                      01560068
015700         10  PV-REF-6-BYTE3       PIC X(01).                      01570068
015800         10  PV-REF-6-BYTE4       PIC X(01).                      01580068
015900         10  PV-REF-6-BYTE5       PIC X(01).                      01590068
016000         10  PV-REF-6-BYTE6       PIC X(01).                      01600068
016100         10  PV-REF-6-BYTE7       PIC X(01).                      01610068
016200         10  PV-REF-6-BYTE8       PIC X(01).                      01620068
016300         10  PV-REF-6-BYTE9       PIC X(01).                      01630068
016400         10  PV-REF-6-FILLER      PIC X(11).                      01640068
016500     05  PV-WEBITM-SHIP-ALN-IND   PIC X(01).                      01650068
016600     05  PV-WEBITM-GFT-WRAP-AVL-IND PIC X(01).                    01660068
016700     05  PV-WEBITM-HAZDS-IND      PIC X(01).                      01670068
016800     05  PV-WEBITM-BRKBL-IND      PIC X(01).                      01680068
016900     05  PV-WEBITM-GC-IND         PIC X(01).                      01690068
017000     05  PV-WEBITM-SHIP-RSTRC-SEQ-NBR  PIC X(01).                 01700068
017100     05  PV-WEBITM-SHIP-SRCHG-FEE-AMT  PIC S9(3)V9(2).            01710068
017200     05  PV-IMT00024-BAGBL-IND    PIC X(01).                      01720068
017300     05  PV-IMT00024-CNVYB-IND    PIC X(01).                      01730068
017400     05  PV-IMT00024-AUTO-SORT-CDE     PIC X(01).                 01740068
017500     05  PV-IMT00024-PICK-LOC-TYP-CDE  PIC X(03).                 01750068
017600     05  PV-IMT00024-SORT-BOX-SZ-DESC  PIC X(10).                 01760068
017700     05  PV-REF-7                 PIC X(20)  JUST RIGHT.          01770068
017800     05  PV-REF-7-A          REDEFINES PV-REF-7.                  01780068
017900         10  REF-7-FILLER         PIC X(17).                      01790068
018000         10  REF-7-WRHSE          PIC X(03).                      01800068
018100     05  PV-REF-8                 PIC X(20)  JUST RIGHT.          01810068
018200     05  PV-REF-8-A          REDEFINES PV-REF-8.                  01820068
018300         10  FILLER               PIC X(07).                      01830068
018400         10  PV-REF-8-NUMERIC     PIC 9(6).9(06).                 01840068
018500     05  PV-REF-8-CONVRTD         PIC 9(06)V9(06)  VALUE  0.      01850068
018600     05  PV-IMT00024-SHIP-COST-AMT PIC S9(5)V9(2) COMP-3.         01860068
018700     05  PV-REF-9                 PIC X(20)  JUST RIGHT.          01870068
018800     05  PV-REF-9-A          REDEFINES PV-REF-9.                  01880068
018900         10  PV-REF-9-FILLER      PIC X(10).                      01890068
019000         10  PV-REF-9-TEXT        PIC X(10).                      01900068
019100     05  PV-SKU-CHAR              PIC X(08)   JUST RIGHT.         01910068
019200     05  PV-SKU                   PIC 9(08).                      01920068
019300     05  PV-DC-NUMBER             PIC X(04)   JUST RIGHT.         01930068
019400     05  PV-DC-NUMBER-NUMERIC  REDEFINES PV-DC-NUMBER             01940068
019500                                  PIC 9(04).                      01950068
019600     05  PV-HOLD-COMPLETION-CODE  PIC S9(9) BINARY.               01960068
019700     05  PV-HOLD-REASON           PIC S9(9) BINARY.               01970068
019800     05  PV-DEPT                  PIC S9(09)V COMP-3.             01980068
019900     05  PV-SC                    PIC 9(4)V99.                    01990068
020000                                                                  02000068
020100     05  PV-PARAGRAPH             PIC  X(30) VALUE SPACE.         02010068
020200     05  PV-DISP-SQLCODE          PIC  -999.                      02020068
020300     05  PV-DISPLAY-UPC-NBR       PIC  Z(15).                     02030068
020400     05  PV-DISP-NBR              PIC ZZZ,ZZZ,ZZ9.                02040068
020500     05  PC-MAX-RETRIES           PIC 9(03) VALUE 3.              02050068
020600     05  PV-RETRY-COUNTER         PIC 9(03) VALUE 3.              02060068
020700     05  PV-DISP-TMST             PIC X(26) VALUE SPACES.         02070068
020800                                                                  02080068
020900 01  PV-DESC                     PIC X(120)     VALUE SPACES.     02090068
021000 01  PV-DISPLAY                  PIC X(120)     VALUE SPACES.     02100068
021100                                                                  02110068
021200 01  DK-DATABASE-KEYS.                                            02120068
021300     05  DK-SKU                    PIC S9(8)V COMP-3.             02130068
021400     05  DK-INTR-UPC-ID            PIC S9(9) COMP.                02140068
021500     05  DK-VS-ID                  PIC S9(9) COMP.                02150068
021600     05  DK-ENT-ID                 PIC S9(9) COMP.                02160068
021700     05  DK-VS-NBR                 PIC X(20).                     02170068
021800                                                                  02180068
021900******************************************************************02190068
022000**** PROGRAM ACCUMULATORS                                         02200068
022100******************************************************************02210068
022200 01  PA-PROGRAM-ACCUMULATORS.                                     02220068
022300     05  PA-TOTAL-MQ-PIX-MSGS-READ PIC  S9(09)  VALUE +0 COMP-3.  02230068
022400     05  PA-999-STOP-PROC-MESSAGES PIC  S9(09)  VALUE +0 COMP-3.  02240068
022500     05  PA-TOTAL-MQ-ERROR-MSGS-SENT                              02250068
022600                                   PIC  S9(09)  VALUE +0 COMP-3.  02260068
022700     05  PA-TOTAL-ERRORS-PROCESSED PIC  S9(09)  VALUE +0 COMP-3.  02270068
022800     05  PA-TOTAL-INSERT-TVSRSVN   PIC  S9(09)  VALUE +0 COMP-3.  02280068
022900     05  PA-TOTAL-DELETE-TVSRSVN   PIC  S9(09)  VALUE +0 COMP-3.  02290068
023000     05  PA-TOTAL-UPDATE-TWEBITM   PIC  S9(09)  VALUE +0 COMP-3.  02300068
023100     05  PA-TOTAL-INSERT-TWEBITM   PIC  S9(09)  VALUE +0 COMP-3.  02310068
023110     05  PA-TOTAL-INSERT-WST-SRCHRG PIC  S9(09)  VALUE +0 COMP-3. 02311068
023120     05  PA-TOTAL-UPDATE-WST-SRCHRG PIC  S9(09)  VALUE +0 COMP-3. 02312068
023130     05  PA-TOTAL-TWEBITM-DB2-COMMITS                             02313068
023140                                   PIC  S9(09)  VALUE +0 COMP-3.  02314068
023150     05  PA-TOTAL-UPDATE-IMT00024  PIC  S9(09)  VALUE +0 COMP-3.  02315068
023160     05  PA-TOTAL-INSERT-IMT00024  PIC  S9(09)  VALUE +0 COMP-3.  02316068
023170     05  PA-TOTAL-DB2-COMMITS      PIC  S9(09)  VALUE +0 COMP-3.  02317068
023180     05  PA-TOTAL-DB2-ROLLBACKS     PIC  S9(09)  VALUE +0 COMP-3. 02318068
023190     05  PA-DEBUG-MESSAGES          PIC  S9(09)  VALUE +0 COMP-3. 02319068
023200******************************************************************02320068
023300**** PROGRAM VARIABLES FOR QUEUE MANAGER AND QUEUE NAMES.         02330068
023400******************************************************************02340068
023500 01  PV-Q-MANAGER-VARIABLES.                                      02350068
023600     05  PV-QMGR-NAME-PIX             PIC X(48).                  02360068
023700     05  PV-QUE-NAME-PIX              PIC X(48).                  02370068
023800     05  PV-HANDLE-PIX           PIC S9(9) BINARY VALUE 0.        02380068
023900     05  PV-QMGR-NAME-ERROR           PIC X(48).                  02390068
024000     05  PV-QUE-NAME-ERROR            PIC X(48).                  02400068
024100     05  PV-HANDLE-ERROR         PIC S9(9) BINARY VALUE 0.        02410068
024200******************************************************************02420068
024300**** PROGRAM VARIABLES FOR MQ SERIES                              02430068
024400******************************************************************02440068
024500 01  PV-MQ-PROGRAM-VARIABLES.                                     02450068
024600     05  PV-QM-NAME              PIC X(48).                       02460068
024700     05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        02470068
024800     05  PV-OPEN-OPTIONS         PIC S9(9) BINARY.                02480068
024900     05  PV-COMPLETION-CODE      PIC S9(9) BINARY.                02490068
025000     05  PV-REASON               PIC S9(9) BINARY.                02500068
025100     05  PV-ERROR-MESSAGE        PIC X(48) VALUE SPACES.          02510068
025200     05  PV-CON-REASON           PIC S9(9) BINARY.                02520068
025300     05  PV-MSGBUFFER            PIC X(32432) VALUE SPACES.       02530068
025400     05  PV-ERRMSGBUFFER         PIC X(1055) VALUE SPACES.        02540068
025500     05  PV-MSG-LENGTH           PIC S9(9) BINARY VALUE 1000.     02550068
025600     05  PV-DATA-LENGTH          PIC S9(9) BINARY.                02560068
025700     05  PV-ACTION               PIC X(60) VALUE SPACES.          02570068
025800     05  PV-MQCHECK              PIC X(8)  VALUE 'MQR2C'.         02580068
025900     05  PV-MQ-REASON-TEXT       PIC X(30) VALUE SPACES.          02590068
026000                                                                  02600068
026100*PV-MSG IS THE INPUT MESSAGE                                      02610068
026200 01  PV-MSG                         PIC X(32432).                 02620068
026300                                                                  02630068
026400 01  PC-MQCONN                   PIC X(8)  VALUE 'CSQBCONN'.      02640068
026500 01  PC-MQOPEN                   PIC X(8)  VALUE 'CSQBOPEN'.      02650068
026600 01  PC-MQINQ                    PIC X(8)  VALUE 'CSQBINQ'.       02660068
026700 01  PC-MQGET                    PIC X(8)  VALUE 'CSQBGET'.       02670068
026800 01  PC-MQPUT                    PIC X(8)  VALUE 'CSQBPUT'.       02680068
026900*01  PC-MQCMIT                   PIC X(8)  VALUE 'SRRCMIT '.      02690068
027000 01  PC-MQCMIT                   PIC X(8)  VALUE 'CSQBCOMM'.      02700068
027100 01  PC-MQCLOSE                  PIC X(8)  VALUE 'CSQBCLOS'.      02710068
027200 01  PC-MQDISC                   PIC X(8)  VALUE 'CSQBDISC'.      02720068
027300 01  PC-MQBACK                   PIC X(8)  VALUE 'CSQBBACK'.      02730068
027400                                                                  02740068
027500* API CONTROL BLOCKS                                              02750068
027600 01  MQM-OBJECT-DESCRIPTOR.                                       02760068
027700     COPY CMQODV.                                                 02770068
027800 01  MQM-MESSAGE-DESCRIPTOR.                                      02780068
027900     COPY CMQMDV.                                                 02790068
028000 01  MQM-PUT-MESSAGE-OPTIONS.                                     02800068
028100     COPY CMQPMOV.                                                02810068
028200 01  MQM-GET-MESSAGE-OPTIONS.                                     02820068
028300     COPY CMQGMOV.                                                02830068
028400                                                                  02840068
028500* MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)      02850068
028600* AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)             02860068
028700 01  MQM-CONSTANTS.                                               02870068
028800     COPY CMQV.                                                   02880068
028900                                                                  02890068
029000 01  PL-PROGRAM-LOG-VARIABLES.                                    02900068
029100     05  PL-LOG-SUB       PIC  9(02)  VALUE ZERO.                 02910068
029200     05  PL-LOG-LINES-TABLE.                                      02920068
029300         10  FILLER       PIC  X(11)  VALUE ' WSKUP008: '.        02930068
029400                                                                  02940068
029500 01  PS-PROGRAM-SWITCHES.                                         02950068
029600     05  PS-END-OF-PIX-SW               PIC X(01)  VALUE 'N'.     02960068
029700         88  PS-END-OF-PIX-YES                     VALUE 'Y'.     02970068
029800         88  PS-END-OF-PIX-NO                      VALUE 'N'.     02980068
029801* CLT 2011-01-18 WR38972 start                                    02980171
029810     05  PS-END-OF-MQCUR-SW              PIC X(01) VALUE 'N'.     02981071
029820         88  PS-END-OF-MQCUR-YES                   VALUE 'Y'.     02982071
029830         88  PS-END-OF-MQCUR-NO                    VALUE 'N'.     02983071
029840* CLT 2011-01-18 WR38972 END                                      02984071
029900     05  PS-ERROR-REC-WRITTEN-SW        PIC X(01)  VALUE 'N'.     02990068
030000         88  PS-ERROR-REC-WRITTEN-YES              VALUE 'Y'.     03000068
030100         88  PS-ERROR-REC-WRITTEN-NO               VALUE 'N'.     03010068
030200     05  PS-TIME-TO-END-PROGRAM-SW      PIC X(01)  VALUE 'N'.     03020068
030300         88  PS-TIME-TO-END-PROGRAM-YES            VALUE 'Y'.     03030068
030400         88  PS-TIME-TO-END-PROGRAM-NO             VALUE 'N'.     03040068
030500     05  PS-HAVE-TWEBITM-SW             PIC X(01)  VALUE 'N'.     03050068
030600         88  PS-HAVE-TWEBITM-YES                   VALUE 'Y'.     03060068
030700         88  PS-HAVE-TWEBITM-NO                    VALUE 'N'.     03070068
030800     05  PS-SKIP-TWEBITM-SW             PIC X(01)  VALUE 'N'.     03080068
030900         88  PS-SKIP-TWEBITM-YES                   VALUE 'Y'.     03090068
031000         88  PS-SKIP-TWEBITM-NO                    VALUE 'N'.     03100068
031100     05  PS-WRITE-TO-WST-SRCHRG-SW      PIC X(01)  VALUE 'N'.     03110068
031200         88  PS-WRITE-TO-WST-SRCHRG-YES            VALUE 'Y'.     03120068
031300         88  PS-WRITE-TO-WST-SRCHRG-NO             VALUE 'N'.     03130068
031400     05  PS-HAVE-IMT00024-SW            PIC X(01)  VALUE 'N'.     03140068
031500         88  PS-HAVE-IMT00024-YES                  VALUE 'Y'.     03150068
031600         88  PS-HAVE-IMT00024-NO                   VALUE 'N'.     03160068
031700     05  PS-SKIP-IMT00024-SW            PIC X(01)  VALUE 'N'.     03170068
031800         88  PS-SKIP-IMT00024-YES                  VALUE 'Y'.     03180068
031900         88  PS-SKIP-IMT00024-NO                   VALUE 'N'.     03190068
032000     05  PS-DEPT-SURCHRG-SW             PIC X(01)  VALUE 'N'.     03200068
032100         88  PS-DEPT-SURCHRG-YES                   VALUE 'Y'.     03210068
032200         88  PS-DEPT-SURCHRG-NO                    VALUE 'N'.     03220068
032300     05  PS-DISPLAY-SW                  PIC X(01)  VALUE 'N'.     03230078
032400         88  PS-DISPLAY-YES                        VALUE 'Y'.     03240068
032500         88  PS-DISPLAY-NO                         VALUE 'N'.     03250068
032600         88  PS-DISPLAY-PENDING                    VALUE 'P'.     03260068
032700     05  PS-ROLLBACK-DB2-SW             PIC X(01)  VALUE 'N'.     03270068
032800         88  PS-ROLLBACK-DB2-YES                   VALUE 'Y'.     03280068
032900         88  PS-ROLLBACK-DB2-NO                    VALUE 'N'.     03290068
033000     05  PS-SKIP-PROCESS-SW             PIC X(01)  VALUE 'N'.     03300068
033100         88  PS-SKIP-PROCESS-YES                   VALUE 'Y'.     03310068
033200         88  PS-SKIP-PROCESS-NO                    VALUE 'N'.     03320068
033300     05  PS-SEQNBR-SW                   PIC  X(01) VALUE 'N'.     03330068
033400         88  PS-SEQNBR-AT-END-YES                  VALUE 'Y'.     03340068
033500         88  PS-SEQNBR-AT-END-NO                   VALUE 'N'.     03350068
033600                                                                  03360068
033700 01  XML-LENGTH                  PIC 9(5).                        03370068
033800                                                                  03380068
033900***************************************************************** 03390068
034000* MQ SERIES COMPLETION CODES.                                     03400068
034100***************************************************************** 03410068
034200     COPY ISWS002.                                                03420068
034300                                                                  03430068
034400***************************************************************** 03440068
034500* XMAL CODE DESCRIPTIONS, AND DISPLAYING FORMATTED XML MESSAGES   03450068
034600***************************************************************** 03460068
034700     COPY ISWS007.                                                03470068
034800     COPY ISWS008.                                                03480068
034900     COPY ISWS009.                                                03490068
035000                                                                  03500068
035100***************************************************************** 03510068
035200* OUTPUT ERROR MESSAGE COPYBOOK - FOR ERROR QUEUE.                03520068
035300***************************************************************** 03530068
035400     COPY WSRD027.                                                03540068
035500                                                                  03550068
035600******************************************************************03560068
035700*WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'                        03570068
035800******************************************************************03580068
035900     COPY DPWS004.                                                03590068
036000                                                                  03600068
036100******************************************************************03610068
036200*  COMMUNICATIONS AREA FOR DB2                                    03620068
036300******************************************************************03630068
036400     EXEC SQL                                                     03640068
036500          INCLUDE SQLCA                                           03650068
036600     END-EXEC.                                                    03660068
036700                                                                  03670068
036800******************************************************************03680068
036900*  DB2 TABLE DECLARATION -  TWEBITM (SKU WEB ATTRIBUTES).         03690068
037000******************************************************************03700068
037100     EXEC SQL                                                     03710068
037200          INCLUDE TWEBITM                                         03720068
037300     END-EXEC.                                                    03730068
037400                                                                  03740068
037500******************************************************************03750068
037600*  DB2 TABLE DECLARATION -  TEGPNBR                               03760068
037700******************************************************************03770068
037800     EXEC SQL                                                     03780068
037900          INCLUDE TEGPNBR                                         03790068
038000     END-EXEC.                                                    03800068
038100                                                                  03810068
038200******************************************************************03820068
038300*  DB2 TABLE DECLARATION -  IMT_ITM_DC_ASSN TABLE                 03830068
038400*      (IMT00024) (DC SPECIFIC SKU ATTRIBUTES).                   03840068
038500******************************************************************03850068
038600     EXEC SQL                                                     03860068
038700          INCLUDE IMT00024                                        03870068
038800     END-EXEC.                                                    03880068
038900                                                                  03890068
039000******************************************************************03900068
039100*  DB2 AREA FOR VSM RESERVATIONS.                                 03910068
039200******************************************************************03920068
039300     EXEC SQL                                                     03930068
039400         INCLUDE TVSRSVN                                          03940068
039500     END-EXEC.                                                    03950068
039600                                                                  03960068
039700******************************************************************03970068
039800*  DB2 VIEW DECLARATION - PROVIDER QUEUE VIEW (PUT/WRITE)         03980068
039900*        (WSV_PRVDR_QUE) WSV00005                                 03990068
040000******************************************************************04000068
040100     EXEC SQL                                                     04010068
040200         INCLUDE WSV00005                                         04020068
040300     END-EXEC.                                                    04030068
040400                                                                  04040068
040500******************************************************************04050068
040600*  DB2 VIEW DECLARATION - CONSUMER QUEUE VIEW (GET/READ)          04060068
040700*        (WSV_CNSMR_QUE) WSV00006                                 04070068
040800******************************************************************04080068
040900     EXEC SQL                                                     04090068
041000         INCLUDE WSV00006                                         04100068
041100     END-EXEC.                                                    04110068
041200                                                                  04120068
041300******************************************************************04130068
041400*  DB2 VIEW DECLARATION - SHIP SURCHARGE DEPT VIEW                04140068
041500******************************************************************04150068
041600     EXEC SQL                                                     04160068
041700          INCLUDE WSV00007                                        04170068
041800     END-EXEC.                                                    04180068
041900                                                                  04190068
042000******************************************************************04200068
042100*  DB2 VIEW DECLARATION - SKU CROSS-REFERENCE.                    04210068
042200******************************************************************04220068
042300     EXEC SQL                                                     04230068
042400          INCLUDE TSKXREF                                         04240068
042500     END-EXEC.                                                    04250068
042600                                                                  04260068
042700******************************************************************04270068
042800*  DB2 VIEW DECLARATION - LOGISTICS VIEW OF SKU.                  04280068
042900******************************************************************04290068
043000     EXEC SQL                                                     04300068
043100          INCLUDE XLT00003                                        04310068
043200     END-EXEC.                                                    04320068
043300                                                                  04330068
043400******************************************************************04340068
043500*  DB2 VIEW DECLARATION - LOGISTICS VIEW OF VENDOR STYLE.         04350068
043600******************************************************************04360068
043700     EXEC SQL                                                     04370068
043800          INCLUDE XLT00004                                        04380068
043900     END-EXEC.                                                    04390068
044000                                                                  04400068
044100******************************************************************04410068
044200*  DB2 VIEW DECLARATION - wst_srchrg_recncl table.                04420068
044300******************************************************************04430068
044400     EXEC SQL                                                     04440068
044410          INCLUDE WST00013                                        04441068
044420     END-EXEC.                                                    04442068
044430                                                                  04443068
044440******************************************************************04444068
044450*  DB2 SEQNBR CURSOR                                              04445068
044460******************************************************************04446068
044470                                                                  04447068
044480     EXEC SQL                                                     04448068
044490          DECLARE SEQNBR CURSOR FOR                               04449068
044500           SELECT  NEXT_SEQ_NBR                                   04450068
044600             FROM  TEGPNBR                                        04460068
044700          FOR UPDATE OF NEXT_SEQ_NBR                              04470068
044800     END-EXEC.                                                    04480068
044900                                                                  04490068
044901* CLT 2011-01-18 WR38972 start                                    04490174
044910******************************************************************04491069
044920*  DB2  MQCUR CURSOR                                              04492070
044930******************************************************************04493069
044940                                                                  04494069
044950     EXEC SQL                                                     04495069
044960          DECLARE MQCUR  CURSOR FOR                               04496070
044970          SELECT QUE_MGR,                                         04497069
044980                 QUE_NM                                           04498069
044992            FROM WSV_CNSMR_QUE                                    04499270
044993           WHERE APPL_FUNC_DESC  = 'PIXQUEUE'                     04499370
044994             AND INTGRTN_TYP_CDE = 'PIXCUBISCN'                   04499470
044995          ORDER BY QUE_NM  DESC                                   04499570
044996          WITH UR                                                 04499669
044997     END-EXEC.                                                    04499769
044998                                                                  04499869
044999* CLT 2011-01-18 WR38972 end                                      04499974
045000***************************************************************** 04500068
045100 PROCEDURE DIVISION.                                              04510068
045200***************************************************************** 04520068
045300                                                                  04530068
045400 0000-MAIN-MODULE.                                                04540068
045500     IF PS-DISPLAY-YES                                            04550068
045600        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   04560068
045700        DISPLAY PV-DISP-TMST ' WSKUP008 - 0000-MAIN-MODULE'       04570068
045800     END-IF.                                                      04580068
045900******************************************************************04590068
046000**  MAIN PROCESSING.                                              04600068
046100******************************************************************04610068
046200     DISPLAY '**********************************'.                04620068
046300     DISPLAY '* START OF WSKUP008               '.                04630068
046400     DISPLAY '**********************************'.                04640068
046500                                                                  04650068
046600     PERFORM 1000-INITIALIZATION.                                 04660068
046700     PERFORM 1200-MQSERIES-CONNECT.                               04670068
046800     PERFORM 1300-MQSERIES-OPEN-PIX.                              04680068
046900     PERFORM 1340-MQSERIES-OPEN-ERROR.                            04690068
047000     PERFORM 1400-GET-MQ-MESSAGE.                                 04700068
047100     PERFORM 2000-PROCESS-XML                                     04710068
047200           UNTIL PV-REASON = MQRC-NO-MSG-AVAILABLE                04720068
047300              OR PS-TIME-TO-END-PROGRAM-YES.                      04730068
047400                                                                  04740068
047500     PERFORM 4000-MQ-CLEANUP.                                     04750068
047600     PERFORM 9300-WRAPUP.                                         04760068
047700                                                                  04770068
047800     GOBACK.                                                      04780068
047900                                                                  04790068
048000***************************************************************** 04800068
048100* INITIALIZATION                                                  04810068
048200*     OPENS FILES                                                 04820068
048300*     INITIALIZES VARIABLES                                       04830068
048400*     GETS MQ QUEUE & QUEUE MANAGER INFORMATION FOR THE 2 QUEUES. 04840068
048500***************************************************************** 04850068
048600 1000-INITIALIZATION.                                             04860068
048700     IF PS-DISPLAY-YES                                            04870068
048800        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   04880068
048900        DISPLAY PV-DISP-TMST ' WSKUP008 - 1000-INITIALIZATION'    04890068
049000     END-IF.                                                      04900068
049100                                                                  04910068
049200     INITIALIZE   PA-TOTAL-MQ-PIX-MSGS-READ                       04920068
049300                  PA-TOTAL-MQ-ERROR-MSGS-SENT                     04930068
049400                  PA-TOTAL-ERRORS-PROCESSED                       04940068
049500                  PA-TOTAL-INSERT-TVSRSVN                         04950068
049600                  PA-TOTAL-DELETE-TVSRSVN                         04960068
049700                  PA-TOTAL-UPDATE-TWEBITM                         04970068
049800                  PA-TOTAL-INSERT-TWEBITM                         04980068
049900                  PA-TOTAL-INSERT-WST-SRCHRG                      04990068
050000                  PA-TOTAL-update-WST-SRCHRG                      05000068
050100                  PA-TOTAL-UPDATE-IMT00024                        05010068
050200                  PA-TOTAL-INSERT-IMT00024                        05020068
050300                  WS027-RECEIPT-PIX-ERROR-REC                     05030068
050400                  PA-TOTAL-TWEBITM-DB2-COMMITS                    05040068
050500                  PA-TOTAL-DB2-ROLLBACKS                          05050068
050600                  DCLTWEBITM                                      05060068
050700                  DCLIMT00024                                     05070068
050800                  DCLWSV00005                                     05080068
050900                  DCLWSV00006.                                    05090068
051000                                                                  05100068
051100     SET PS-TIME-TO-END-PROGRAM-NO TO TRUE.                       05110068
051200                                                                  05120068
051300* CREATE A PROCESS CONTROL TMST                                   05130068
051400     PERFORM 1050-GEN-PRC-CNTL-TMST.                              05140068
051500                                                                  05150068
051600     PERFORM 1100-GET-MQ-INFO-PIX.                                05160068
051700     PERFORM 1160-GET-MQ-INFO-ERROR.                              05170068
051800                                                                  05180068
051900******************************************************************05190068
052000* CREATE THE PROCESS CONTROL TMST BY GETTING THE DB2 CURRENT TMST*05200068
052100******************************************************************05210068
052200 1050-GEN-PRC-CNTL-TMST.                                          05220068
052300     IF PS-DISPLAY-YES                                            05230068
052400        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   05240068
052500        DISPLAY PV-DISP-TMST ' WSKUP008 - 1050-GEN-PRC-CNTL-TMST' 05250068
052600     END-IF.                                                      05260068
052700                                                                  05270068
052800         EXEC SQL                                                 05280068
052900             SET :PV-PRC-CNTL-TMST = CURRENT TIMESTAMP            05290068
053000         END-EXEC                                                 05300068
053100                                                                  05310068
053200         EVALUATE TRUE                                            05320068
053300             WHEN SQLCODE = ZERO                                  05330068
053400                 CONTINUE                                         05340068
053500                                                                  05350068
053600             WHEN OTHER                                           05360068
053700                 MOVE SQLCODE         TO PV-DISP-SQLCODE          05370068
053800                 DISPLAY '**************************************' 05380068
053900                 DISPLAY '** ABEND                              ' 05390068
054000                 DISPLAY '** PROGRAM = WSKUP008                 ' 05400068
054100                 DISPLAY '** PARAGRAPH = 1050-GEN-PRC-CNTL-TMST ' 05410068
054200                 DISPLAY '** SQLCODE = ' PV-DISP-SQLCODE          05420068
054300                 DISPLAY '** SET CURRENT TIMESTAMP              ' 05430068
054400                 DISPLAY '** CURRENT TMST   = ' PV-PRC-CNTL-TMST  05440068
054500                 DISPLAY '**************************************' 05450068
054600                 MOVE +4018         TO PV-ABEND-CODE              05460068
054700                 MOVE '1050-GEN-PRC-CNTL-TMST' TO PV-PARAGRAPH    05470068
054800                 PERFORM 9500-ABEND                               05480068
054900         END-EVALUATE.                                            05490068
055000                                                                  05500068
055100******************************************************************05510068
055200* GETS MQ INFO FROM WSV_CNSMR_QUE (GET/READ) - PIX TRANSACTIONS.  05520068
055300******************************************************************05530068
055400 1100-GET-MQ-INFO-PIX.                                            05540068
055500     IF PS-DISPLAY-YES                                            05550068
055600        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   05560068
055700        DISPLAY PV-DISP-TMST ' WSKUP008 - 1100-GET-MQ-INFO-PIX'   05570068
055800     END-IF.                                                      05580068
055900                                                                  05590068
055901* CLT 2011-01-18 WR38972 start                                    05590171
055902                                                                  05590271
055910     PERFORM 1110-OPEN-MQCUR.                                     05591071
055920     PERFORM 1120-FETCH-MQCUR.                                    05592070
055930     PERFORM 1130-CLOSE-MQCUR.                                    05593070
055940                                                                  05594070
055950 1110-OPEN-MQCUR.                                                 05595070
055951     EXEC SQL                                                     05595171
055952         OPEN MQCUR                                               05595271
055953     END-EXEC.                                                    05595371
055954                                                                  05595471
055955     EVALUATE TRUE                                                05595571
055956         WHEN SQLCODE = ZERO                                      05595671
055957            CONTINUE                                              05595771
055958         WHEN OTHER                                               05595871
055959            MOVE '1110-OPEN-MQCUR' TO PV-PARAGRAPH                05595971
055960            DISPLAY SQLCODE                                       05596071
055970            PERFORM 9500-ABEND                                    05597071
055978     END-EVALUATE.                                                05597871
055979                                                                  05597971
055980 1120-FETCH-MQCUR.                                                05598070
055990     EXEC SQL                                                     05599071
056000         FETCH MQCUR                                              05600071
056100          INTO :WSV00006-QUE-MGR                                  05610073
056200              ,:WSV00006-QUE-NM                                   05620071
056400     END-EXEC.                                                    05640071
057000                                                                  05700068
057010* CLT 2011-01-18 WR38972 end                                      05701071
057020                                                                  05702071
057100     MOVE SQLCODE         TO PV-DISP-SQLCODE                      05710068
057200     IF PS-DISPLAY-YES                                            05720068
057300        DISPLAY ' PIX QMGR:' WSV00006-QUE-MGR                     05730068
057400        DISPLAY ' PIX QUE :' WSV00006-QUE-NM                      05740068
057500        DISPLAY ' SQL CDE :' PV-DISP-SQLCODE                      05750068
057600     END-IF                                                       05760068
057700                                                                  05770068
057800     EVALUATE TRUE                                                05780068
057900         WHEN SQLCODE = 0                                         05790068
058000             INITIALIZE PV-QMGR-NAME-PIX                          05800068
058100             MOVE WSV00006-QUE-MGR-TEXT TO                        05810068
058200                PV-QMGR-NAME-PIX                                  05820068
058300             INITIALIZE PV-QUE-NAME-PIX                           05830068
058400             MOVE WSV00006-QUE-NM-TEXT TO                         05840068
058500                PV-QUE-NAME-PIX                                   05850068
058600                                                                  05860068
058700         WHEN OTHER                                               05870068
058800             MOVE 'Q OR QMGR ERROR IN PIXQUEUE/PIXCUBISCN' TO     05880068
058900                PV-ERROR-MESSAGE                                  05890068
059000             ADD +1 TO PA-TOTAL-ERRORS-PROCESSED                  05900068
059100             PERFORM 9001-MQSERIES-ERROR                          05910068
059200     END-EVALUATE.                                                05920068
059201                                                                  05920171
059202* CLT 2011-01-18 WR38972 start                                    05920271
059210 1130-CLOSE-MQCUR.                                                05921070
059211                                                                  05921171
059212     EXEC SQL                                                     05921271
059213         CLOSE MQCUR                                              05921372
059214     END-EXEC.                                                    05921471
059215                                                                  05921571
059216     EVALUATE TRUE                                                05921671
059217         WHEN SQLCODE = ZERO                                      05921771
059218            CONTINUE                                              05921871
059219         WHEN OTHER                                               05921971
059220            MOVE '1130-CLOSE-MQCUR' TO PV-PARAGRAPH               05922071
059221            DISPLAY SQLCODE ' SQLCODE'                            05922172
059222            PERFORM 9500-ABEND                                    05922271
059223     END-EVALUATE.                                                05922371
059224                                                                  05922471
059225* CLT 2011-01-18 WR38972 end                                      05922571
059230                                                                  05923071
059300******************************************************************05930068
059400* GETS MQ INFO FROM WSV_PRVDR_QUE (PUT/WRITE) - ERROR QUEUE       05940068
059500******************************************************************05950068
059600 1160-GET-MQ-INFO-ERROR.                                          05960068
059700     IF PS-DISPLAY-YES                                            05970068
059800        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   05980068
059900        DISPLAY PV-DISP-TMST ' WSKUP008 - 1160-GET-MQ-INFO-ERROR' 05990068
060000     END-IF.                                                      06000068
060100                                                                  06010068
060200       EXEC SQL                                                   06020068
060300        SELECT LCL_QUE_MGR,                                       06030068
060400               QUE_NM                                             06040068
060500         INTO :WSV00005-LCL-QUE-MGR                               06050068
060600             ,:WSV00005-QUE-NM                                    06060068
060700         FROM WSV_PRVDR_QUE                                       06070068
060800        WHERE APPL_FUNC_DESC  = 'PIXLEGACYQ'                      06080068
060900          AND INTGRTN_TYP_CDE = 'PIXFRWDERR'                      06090068
061000       END-EXEC                                                   06100068
061100                                                                  06110068
061200     MOVE SQLCODE         TO PV-DISP-SQLCODE                      06120068
061300     IF PS-DISPLAY-YES                                            06130068
061400        DISPLAY ' ERROR QMGR:' WSV00005-LCL-QUE-MGR-TEXT          06140068
061500        DISPLAY ' ERROR QUE :' WSV00005-QUE-NM-TEXT               06150068
061600        DISPLAY ' SQL CDE :' PV-DISP-SQLCODE                      06160068
061700     END-IF                                                       06170068
061800                                                                  06180068
061900       EVALUATE TRUE                                              06190068
062000           WHEN SQLCODE = 0                                       06200068
062100              INITIALIZE PV-QMGR-NAME-ERROR                       06210068
062200              MOVE WSV00005-LCL-QUE-MGR-TEXT TO                   06220068
062300                 PV-QMGR-NAME-ERROR                               06230068
062400              INITIALIZE PV-QUE-NAME-ERROR                        06240068
062500              MOVE WSV00005-QUE-NM-TEXT TO                        06250068
062600                 PV-QUE-NAME-ERROR                                06260068
062700                                                                  06270068
062800           WHEN OTHER                                             06280068
062900             MOVE 'Q OR QMGR ERROR IN PIXLEGACYQ/PIXFRWDERR' TO   06290068
063000                PV-ERROR-MESSAGE                                  06300068
063100             ADD +1 TO PA-TOTAL-ERRORS-PROCESSED                  06310068
063200             PERFORM 9001-MQSERIES-ERROR                          06320068
063300       END-EVALUATE.                                              06330068
063400                                                                  06340068
063500******************************************************************06350068
063600* CONNECT TO PIX QUEUE MANAGER.                                   06360068
063700******************************************************************06370068
063800 1200-MQSERIES-CONNECT.                                           06380068
063900     IF PS-DISPLAY-YES                                            06390068
064000        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   06400068
064100        DISPLAY PV-DISP-TMST ' WSKUP008 - 1200-MQSERIES-CONNECT'  06410068
064200     END-IF.                                                      06420068
064300                                                                  06430068
064400     CALL PC-MQCONN USING PV-QMGR-NAME-PIX                        06440068
064500                          PV-HCONN                                06450068
064600                          PV-COMPLETION-CODE                      06460068
064700                          PV-REASON.                              06470068
064800                                                                  06480068
064900*    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              06490068
065000*    AND EXIT                                                     06500068
065100                                                                  06510068
065200     MOVE PV-REASON TO PV-CON-REASON.                             06520068
065300     IF PV-COMPLETION-CODE = MQCC-OK THEN                         06530068
065400         CONTINUE                                                 06540068
065500     ELSE                                                         06550068
065600         STRING 'CONNECT - ' PV-QMGR-NAME-PIX                     06560068
065700           DELIMITED BY SIZE INTO PV-ACTION                       06570068
065800         ADD +1 TO PA-TOTAL-ERRORS-PROCESSED                      06580068
065900         PERFORM 9001-MQSERIES-ERROR.                             06590068
066000                                                                  06600068
066100***************************************************************** 06610068
066200*** OPEN THE ITEM QUEUE FOR GETS (800-01 PIX TRANSACTIONS).       06620068
066300***************************************************************** 06630068
066400 1300-MQSERIES-OPEN-PIX.                                          06640068
066500     IF PS-DISPLAY-YES                                            06650068
066600        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   06660068
066700        DISPLAY PV-DISP-TMST ' WSKUP008 - 1300-MQSERIES-OPEN-PIX' 06670068
066800     END-IF.                                                      06680068
066900                                                                  06690068
067000     MOVE '1300-MQSERIES-OPEN-PIX'     TO PV-PARAGRAPH.           06700068
067100                                                                  06710068
067200     COMPUTE PV-OPEN-OPTIONS        = MQOO-INPUT-SHARED           06720068
067300                                    + MQOO-OUTPUT                 06730068
067400                                    + MQOO-SET-IDENTITY-CONTEXT   06740068
067500                                    + MQOO-FAIL-IF-QUIESCING.     06750068
067600     MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            06760068
067700     MOVE PV-QMGR-NAME-PIX         TO MQOD-OBJECTQMGRNAME.        06770068
067800     MOVE PV-QUE-NAME-PIX          TO MQOD-OBJECTNAME.            06780068
067900                                                                  06790068
068000     IF PS-DISPLAY-YES                                            06800068
068100        DISPLAY '  MQOD-OBJECTQMGRNAME = ' MQOD-OBJECTQMGRNAME    06810068
068200        DISPLAY '  MQOD-OBJECTNAME = ' MQOD-OBJECTNAME            06820068
068300     END-IF.                                                      06830068
068400                                                                  06840068
068500     CALL PC-MQOPEN USING PV-HCONN                                06850068
068600                          MQM-OBJECT-DESCRIPTOR                   06860068
068700                          PV-OPEN-OPTIONS                         06870068
068800                          PV-HANDLE-PIX                           06880068
068900                          PV-COMPLETION-CODE                      06890068
069000                          PV-REASON.                              06900068
069100                                                                  06910068
069200*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE AND EXIT.          06920068
069300                                                                  06930068
069400     IF PV-COMPLETION-CODE = MQCC-OK THEN                         06940068
069500         CONTINUE                                                 06950068
069600     ELSE                                                         06960068
069700         STRING 'OPEN - ' PV-QUE-NAME-PIX                         06970068
069800           DELIMITED BY SIZE INTO PV-ACTION                       06980068
069900         ADD +1 TO PA-TOTAL-ERRORS-PROCESSED                      06990068
070000         PERFORM 9001-MQSERIES-ERROR.                             07000068
070100                                                                  07010068
070200***************************************************************** 07020068
070300*** OPEN THE ITEM QUEUE FOR PUTS (ERROR TRANSACTIONS).            07030068
070400***************************************************************** 07040068
070500 1340-MQSERIES-OPEN-ERROR.                                        07050068
070600     IF PS-DISPLAY-YES                                            07060068
070700        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   07070068
070800        DISPLAY PV-DISP-TMST                                      07080068
070900                ' WSKUP008 - 1340-MQSERIES-OPEN-ERROR'            07090068
071000     END-IF.                                                      07100068
071100                                                                  07110068
071200     COMPUTE PV-OPEN-OPTIONS        = MQOO-OUTPUT                 07120068
071300                                    + MQOO-SET-IDENTITY-CONTEXT   07130068
071400                                    + MQOO-FAIL-IF-QUIESCING.     07140068
071500     MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            07150068
071600     MOVE PV-QMGR-NAME-ERROR       TO MQOD-OBJECTQMGRNAME.        07160068
071700     MOVE PV-QUE-NAME-ERROR        TO MQOD-OBJECTNAME.            07170068
071800                                                                  07180068
071900     IF PS-DISPLAY-YES                                            07190068
072000        DISPLAY '  MQOD-OBJECTQMGRNAME = ' MQOD-OBJECTQMGRNAME    07200068
072100        DISPLAY '  MQOD-OBJECTNAME = ' MQOD-OBJECTNAME            07210068
072200     END-IF.                                                      07220068
072300                                                                  07230068
072400     CALL PC-MQOPEN USING PV-HCONN                                07240068
072500                          MQM-OBJECT-DESCRIPTOR                   07250068
072600                          PV-OPEN-OPTIONS                         07260068
072700                          PV-HANDLE-ERROR                         07270068
072800                          PV-COMPLETION-CODE                      07280068
072900                          PV-REASON.                              07290068
073000                                                                  07300068
073100***  IF OPEN FAILED THEN DISPLAY ERROR MESSAGE AND EXIT.          07310068
073200                                                                  07320068
073300     IF PV-COMPLETION-CODE = MQCC-OK THEN                         07330068
073400         CONTINUE                                                 07340068
073500     ELSE                                                         07350068
073600         STRING 'OPEN - ' PV-QUE-NAME-ERROR                       07360068
073700           DELIMITED BY SIZE INTO PV-ACTION                       07370068
073800         ADD +1 TO PA-TOTAL-ERRORS-PROCESSED                      07380068
073900         PERFORM 9001-MQSERIES-ERROR                              07390068
074000     END-IF.                                                      07400068
074100                                                                  07410068
074200****************************************************************  07420068
074300** GET THE FIRST MESSAGE (PIX TRANSACTION) FROM THE QUEUE.        07430068
074400****************************************************************  07440068
074500 1400-GET-MQ-MESSAGE.                                             07450068
074600     IF PS-DISPLAY-YES                                            07460068
074700        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   07470068
074800        DISPLAY PV-DISP-TMST                                      07480068
074900                ' WSKUP008 - 1400-GET-MQ-MESSAGE'                 07490068
075000     END-IF.                                                      07500068
075100                                                                  07510068
075200     SET PS-SKIP-PROCESS-NO           TO TRUE                     07520068
075300     INITIALIZE PV-MSGBUFFER                                      07530068
075400                PV-MSG.                                           07540068
075500                                                                  07550068
075600*MSG ID IS NOT POPULATED IN THIS PGM.                             07560068
075700     MOVE MQMI-NONE TO MQMD-MSGID.                                07570068
075800                                                                  07580068
075900*MSGS ARE UNQUALIFIED IN THIS PGM.                                07590068
076000     MOVE MQCI-NONE         TO MQMD-CORRELID.                     07600068
076100                                                                  07610068
076200*FORMAT TRANSLATES THE DATA ACROSS PLATFORMS, 32432 IS THE        07620068
076300*MAX LENGTH FOR MSGS IN THE PGM.                                  07630068
076400     MOVE MQFMT-STRING         TO MQMD-FORMAT.                    07640068
076500     MOVE +32432               TO PV-MSG-LENGTH.                  07650068
076600                                                                  07660068
076700*** THE UNLIMITED WAIT INTERVAL MEANS THAT PROCESSING WILL        07670068
076800*** CONTINUE UNTIL A END-OF-RUN MESSAGE APPEARS ON THE Q.         07680068
076900     MOVE MQWI-UNLIMITED       TO MQGMO-WAITINTERVAL.             07690068
077000     COMPUTE MQGMO-OPTIONS  =  MQGMO-SYNCPOINT +                  07700068
077100                               MQGMO-CONVERT   +                  07710068
077200                               MQGMO-ACCEPT-TRUNCATED-MSG +       07720068
077300                               MQGMO-WAIT.                        07730068
077400                                                                  07740068
077500     CALL PC-MQGET USING PV-HCONN                                 07750068
077600                         PV-HANDLE-PIX                            07760068
077700                         MQM-MESSAGE-DESCRIPTOR                   07770068
077800                         MQM-GET-MESSAGE-OPTIONS                  07780068
077900                         PV-MSG-LENGTH                            07790068
078000                         PV-MSGBUFFER(1:PV-MSG-LENGTH)            07800068
078100                         PV-DATA-LENGTH                           07810068
078200                         PV-COMPLETION-CODE                       07820068
078300                         PV-REASON.                               07830068
078400                                                                  07840068
078500* IF GET FAILED THEN DISPLAY ERROR MESSAGE  ********************  07850068
078600* AND BREAK OUT OF LOOP                                           07860068
078700     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        07870068
078800         IF ((PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)              07880068
078900          AND (PV-REASON NOT = MQRC-TRUNCATED-MSG-ACCEPTED))      07890068
079000            IF PS-DISPLAY-YES                                     07900068
079100               DISPLAY 'PV-MSGBUFF1:'                             07910068
079200                                 PV-MSGBUFFER(1:PV-DATA-LENGTH)   07920068
079300               DISPLAY 'PV-MSGLNGT1:' PV-MSG-LENGTH               07930068
079400               DISPLAY 'PV-DATLNGT1:' PV-DATA-LENGTH              07940068
079500               DISPLAY 'PV-COMPLCD1:' PV-COMPLETION-CODE          07950068
079600               DISPLAY 'PV-REASON1 :' PV-REASON                   07960068
079700            END-IF                                                07970068
079800            MOVE 'MQGET ERROR'          TO PV-ERROR-MESSAGE       07980068
079900            MOVE '1400-GET-MQ-MSG'      TO PV-PARAGRAPH           07990068
080000            MOVE PV-COMPLETION-CODE     TO IS-COMPLETION          08000068
080100            MOVE PV-REASON              TO IS-REASON-TEXT         08010068
080200            STRING 'GET - ' PV-QMGR-NAME-PIX                      08020068
080300            DELIMITED BY SIZE INTO PV-ACTION                      08030068
080400            ADD +1 TO PA-TOTAL-ERRORS-PROCESSED                   08040068
080500            PERFORM 9001-MQSERIES-ERROR                           08050068
080600         ELSE                                                     08060068
080700*THIS MEANS A MSG WAS TRUNCATED                                   08070068
080800            IF PV-COMPLETION-CODE = +1                            08080068
080900             AND PV-REASON = +2079                                08090068
081000               IF PS-DISPLAY-YES                                  08100068
081100                  DISPLAY 'PV-MSGBUFF2:' PV-MSGBUFFER             08110068
081200                                     (1:PV-DATA-LENGTH)           08120068
081300                  DISPLAY 'PV-MSGLNGT2:' PV-MSG-LENGTH            08130068
081400                  DISPLAY 'PV-DATLNGT2:' PV-DATA-LENGTH           08140068
081500                  DISPLAY 'PV-COMPLCD2:' PV-COMPLETION-CODE       08150068
081600                  DISPLAY 'PV-REASON2 :' PV-REASON                08160068
081700               END-IF                                             08170068
081800               MOVE PV-COMPLETION-CODE     TO IS-COMPLETION       08180068
081900               MOVE PV-REASON              TO IS-REASON-TEXT      08190068
082000               ADD +1          TO PA-TOTAL-MQ-PIX-MSGS-READ       08200068
082100               STRING 'GET - ' PV-QMGR-NAME-PIX 'MSG TRUNCATED'   08210068
082200               DELIMITED BY SIZE INTO PV-ACTION                   08220068
082300               ADD +1 TO PA-TOTAL-ERRORS-PROCESSED                08230068
082400               PERFORM 9001-MQSERIES-ERROR                        08240068
082500            ELSE                                                  08250068
082600               IF (PV-REASON = MQRC-NO-MSG-AVAILABLE)             08260068
082700                  SET PS-END-OF-PIX-YES TO TRUE                   08270068
082800                  IF PS-DISPLAY-YES                               08280068
082900                     DISPLAY 'END OF MES:' PS-END-OF-PIX-SW       08290068
083000                  END-IF                                          08300068
083100               END-IF                                             08310068
083200            END-IF                                                08320068
083300         END-IF                                                   08330068
083400     ELSE                                                         08340068
083500         MOVE PV-MSGBUFFER  TO PV-MSG                             08350068
083600         ADD +1             TO PA-TOTAL-MQ-PIX-MSGS-READ          08360068
083700*        PERFORM 1410-COMMIT-MESSAGE                              08370068
083800     END-IF.                                                      08380068
083900                                                                  08390068
084000****************************************************************  08400068
084100** COMMIT MESSAGE.                                                08410068
084200****************************************************************  08420068
084300 1410-COMMIT-MESSAGE.                                             08430068
084400     IF PS-DISPLAY-YES                                            08440068
084500        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   08450068
084600        DISPLAY PV-DISP-TMST                                      08460068
084700                ' WSKUP008 - 1410-COMMIT-MESSAGE'                 08470068
084800     END-IF.                                                      08480068
084900                                                                  08490068
085000     CALL PC-MQCMIT  USING PV-HCONN                               08500068
085100                           PV-COMPLETION-CODE                     08510068
085200                           PV-REASON.                             08520068
085300                                                                  08530068
085400     EVALUATE TRUE                                                08540068
085500        WHEN PV-COMPLETION-CODE = MQCC-OK                         08550068
085600             CONTINUE                                             08560068
085700        WHEN OTHER                                                08570068
085800            MOVE 'MQCMIT ERROR'         TO PV-ERROR-MESSAGE       08580068
085900            MOVE '1410-COMMIT-MESSAGE'  TO PV-PARAGRAPH           08590068
086000            MOVE PV-COMPLETION-CODE     TO IS-COMPLETION          08600068
086100            MOVE PV-REASON              TO IS-REASON-TEXT         08610068
086200            STRING 'COMMIT - ' PV-QMGR-NAME-PIX                   08620068
086300            DELIMITED BY SIZE INTO PV-ACTION                      08630068
086400            ADD +1 TO PA-TOTAL-ERRORS-PROCESSED                   08640068
086500            PERFORM 9001-MQSERIES-ERROR                           08650068
086600     END-EVALUATE.                                                08660068
086700                                                                  08670068
086800****************************************************************  08680068
086900* PROCESS XML.                                                    08690068
087000****************************************************************  08700068
087100 2000-PROCESS-XML.                                                08710068
087200     IF PS-DISPLAY-YES                                            08720068
087300        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   08730068
087400        DISPLAY PV-DISP-TMST                                      08740068
087500                ' WSKUP008 - 2000-PROCESS-XML'                    08750068
087600     END-IF.                                                      08760068
087700                                                                  08770068
087800     XML PARSE PV-MSG                                             08780068
087900         PROCESSING PROCEDURE                                     08790068
088000             2100-HANDLE-XML                                      08800068
088100         ON EXCEPTION                                             08810068
088200             PERFORM 3000-XML-ERROR                               08820068
088300         NOT ON EXCEPTION                                         08830068
088400             PERFORM 3100-XML-SUCCESS                             08840068
088500     END-XML.                                                     08850068
088600                                                                  08860068
088700     SET PS-ERROR-REC-WRITTEN-NO                                  08870068
088800         PS-HAVE-TWEBITM-NO                                       08880068
088900         PS-SKIP-TWEBITM-NO                                       08890068
089000         PS-HAVE-IMT00024-NO                                      08900068
089100         PS-SKIP-IMT00024-NO                                      08910068
089200         PS-DEPT-SURCHRG-NO       TO TRUE.                        08920068
089300     INITIALIZE   PV-ITEM-HEIGHT                                  08930068
089400                  PV-HEIGHT-CONVRTD                               08940068
089500                  PV-WEBITM-HEIGHT                                08950068
089600                  PV-ITEM-DEPTH                                   08960068
089700                  PV-DEPTH-CONVRTD                                08970068
089800                  PV-WEBITM-DEPTH                                 08980068
089900                  PV-ITEM-WIDTH                                   08990068
090000                  PV-WIDTH-CONVRTD                                09000068
090100                  PV-WEBITM-WIDTH                                 09010068
090200                  PV-ITEM-WEIGHT                                  09020068
090300                  PV-WEIGHT-CONVRTD                               09030068
090400                  PV-WEBITM-WEIGHT                                09040068
090500                  PV-REF-7                                        09050068
090600                  PV-REF-8                                        09060068
090700                  PV-REF-8-CONVRTD                                09070068
090800                  PV-IMT00024-SHIP-COST-AMT                       09080068
090900                  PV-REF-9                                        09090068
091000                  PV-SKU-CHAR                                     09100068
091100                  PV-SKU                                          09110068
091200                  PV-DC-NUMBER.                                   09120068
091300                                                                  09130068
091400     IF PS-ROLLBACK-DB2-YES                                       09140068
091500         PERFORM 7800-ROLLBACK-DB2                                09150068
091600     ELSE                                                         09160068
091700         PERFORM 7850-COMMIT                                      09170068
091800     END-IF                                                       09180068
091900                                                                  09190068
092000*    COMMIT MQ CHANGES                                            09200068
092100     PERFORM 1410-COMMIT-MESSAGE                                  09210068
092200                                                                  09220068
092300     SET PS-ROLLBACK-DB2-NO  TO TRUE                              09230068
092400     IF PS-TIME-TO-END-PROGRAM-YES                                09240068
092500         CONTINUE                                                 09250068
092600     ELSE                                                         09260068
092700         PERFORM 1400-GET-MQ-MESSAGE                              09270068
092800     END-IF.                                                      09280068
092900******************************************************************09290068
093000* PROCESS PIX MESSAGES TO MOVE FIELDS TO THE OUTPUT MESSAGE FILE. 09300068
093100* DC NUMBER IS USED TO POPULATE THE WAREHOUSE FIELD.              09310068
093200******************************************************************09320068
093300* A TRANSACTION TYPE OF "999" WILL END PROCESS                    09330068
093400* AND SHUT DOWN THIS STARTED TASK.                                09340068
093500******************************************************************09350068
093600 2100-HANDLE-XML.                                                 09360068
093700                                                                  09370068
093800     COMPUTE XML-LENGTH = FUNCTION LENGTH(XML-TEXT).              09380068
093900                                                                  09390068
094000     EVALUATE XML-EVENT                                           09400068
094100                                                                  09410068
094200       WHEN 'START-OF-ELEMENT'                                    09420068
094300         MOVE XML-TEXT(1:XML-LENGTH) TO PV-CURRENT-ELEMENT        09430068
094400                                                                  09440068
094500       WHEN 'END-OF-ELEMENT'                                      09450068
094600                                                                  09460068
094700         EVALUATE XML-TEXT(1:XML-LENGTH)                          09470068
094800           WHEN 'PIXBridge'                                       09480068
094900                 PERFORM 3200-WRITE-DB-REC-LOGIC                  09490068
095000           WHEN 'TransactionType'                                 09500068
095100              IF PS-TIME-TO-END-PROGRAM-YES                       09510068
095200                 PERFORM 4000-MQ-CLEANUP                          09520068
095300                 PERFORM 9300-WRAPUP                              09530068
095400              END-IF                                              09540068
095500           WHEN OTHER                                             09550068
095600                 CONTINUE                                         09560068
095700         END-EVALUATE                                             09570068
095800                                                                  09580068
095900       WHEN 'ATTRIBUTE-NAME'                                      09590068
096000         MOVE XML-TEXT(1:XML-LENGTH) TO PV-CURRENT-ATTRIBUTE      09600068
096100                                                                  09610068
096200       WHEN 'ATTRIBUTE-CHARACTERS'                                09620068
096300       WHEN 'ATTRIBUTE-CHARACTER'                                 09630068
096400       WHEN 'CONTENT-CHARACTERS'                                  09640068
096500       WHEN 'CONTENT-CHARACTER'                                   09650068
096600         EVALUATE PV-CURRENT-ELEMENT                              09660068
096700           WHEN 'TransactionType'                                 09670068
096800             MOVE XML-TEXT(1:XML-LENGTH) TO PV-TRANSACTION-TYPE   09680068
096900             IF PV-TRANSACTION-TYPE     = '999'                   09690068
097000                SET PS-DISPLAY-PENDING         TO TRUE            09700068
097100*               SET PS-TIME-TO-END-PROGRAM-YES TO TRUE            09710068
097200*               MOVE -1 TO XML-CODE                               09720068
097300*               ADD +1 TO PA-999-STOP-PROC-MESSAGES               09730068
097400*               SUBTRACT 1 FROM PA-TOTAL-MQ-PIX-MSGS-READ         09740068
097500             END-IF                                               09750068
097600                                                                  09760068
097700           WHEN 'TransactionCode'                                 09770068
097800             MOVE XML-TEXT(1:XML-LENGTH) TO PV-TRANSACTION-CODE   09780068
097900                                            PV-TRAN-CDE           09790068
098000                                                                  09800068
098100*     WHEN A DEBUG CONTROL MESSAGE IS READ WE DO NOT WANT         09810068
098200*     TO DO ANY OF THE NORMAL PROCESSING.  IT SHOULD JUST SET     09820068
098300*     THE DISPLAY SWITCH AND LEAVE TO GET THE NEXT MESSAGE.       09830068
098400                                                                  09840068
098500             IF PS-DISPLAY-PENDING                                09850068
098600                 MOVE -1 TO XML-CODE                              09860068
098700                 EVALUATE TRUE                                    09870068
098800                 WHEN PV-TRAN-CDE = 'Y'                           09880068
098900                     SET PS-DISPLAY-YES                           09890068
099000                         PS-SKIP-PROCESS-YES TO TRUE              09900068
099100                     DISPLAY '***  DEBUG DISPLAYS TURNED ON  ***' 09910068
099200                     ADD 1           TO PA-DEBUG-MESSAGES         09920068
099300                 WHEN PV-TRAN-CDE = 'N'                           09930068
099400                     DISPLAY '***  DEBUG DISPLAYS TURNED OFF  ***'09940068
099500                     SET PS-DISPLAY-NO                            09950068
099600                         PS-SKIP-PROCESS-YES TO TRUE              09960068
099700                     ADD 1           TO PA-DEBUG-MESSAGES         09970068
099800                 WHEN OTHER                                       09980068
099900                     DISPLAY                                      09990068
100000                          '***  END PROGRAM MSG DETECTED  ***'    10000068
100100                     SET PS-TIME-TO-END-PROGRAM-YES               10010068
100200                         PS-SKIP-PROCESS-YES TO TRUE              10020068
100300                     MOVE -1 TO XML-CODE                          10030068
100400                     ADD +1 TO PA-999-STOP-PROC-MESSAGES          10040068
100500                     SUBTRACT 1 FROM PA-TOTAL-MQ-PIX-MSGS-READ    10050068
100600                 END-EVALUATE                                     10060068
100700             END-IF                                               10070068
100800                                                                  10080068
100900           WHEN 'DCNumber'                                        10090068
101000             MOVE XML-TEXT(1:XML-LENGTH) TO PV-DC-NUMBER          10100068
101100           WHEN 'StyleSuffix'                                     10110068
101200             MOVE XML-TEXT(1:XML-LENGTH) TO PV-SKU-CHAR           10120068
101300             MOVE PV-SKU-CHAR TO PV-SKU                           10130068
101400             PERFORM 5000-GET-INTR-UPC-ID                         10140068
101500           WHEN 'As400UserID'                                     10150068
101600             MOVE XML-TEXT(1:XML-LENGTH) TO PV-USER-ID            10160068
101700             MOVE PV-USER-ID-CONVRTD TO PV-WEBITM-CRE-BY-USR-ID   10170068
101800           WHEN 'Reference1'                                      10180068
101900             MOVE XML-TEXT(1:XML-LENGTH) TO PV-ITEM-HEIGHT        10190068
102000             MOVE PV-HEIGHT-NUMERIC      TO PV-HEIGHT-CONVRTD     10200068
102100             MOVE PV-HEIGHT-CONVRTD       TO PV-WEBITM-HEIGHT     10210068
102200           WHEN 'Reference2'                                      10220068
102300             MOVE XML-TEXT(1:XML-LENGTH) TO PV-ITEM-DEPTH         10230068
102400             MOVE PV-DEPTH-NUMERIC       TO PV-DEPTH-CONVRTD      10240068
102500             MOVE PV-DEPTH-CONVRTD        TO PV-WEBITM-DEPTH      10250068
102600           WHEN 'Reference3'                                      10260068
102700             MOVE XML-TEXT(1:XML-LENGTH) TO PV-ITEM-WIDTH         10270068
102800             MOVE PV-WIDTH-NUMERIC       TO PV-WIDTH-CONVRTD      10280068
102900             MOVE PV-WIDTH-CONVRTD        TO PV-WEBITM-WIDTH      10290068
103000           WHEN 'Reference4'                                      10300068
103100             MOVE XML-TEXT(1:XML-LENGTH) TO PV-ITEM-WEIGHT        10310068
103200             MOVE PV-WEIGHT-NUMERIC      TO PV-WEIGHT-CONVRTD     10320068
103300             MOVE PV-WEIGHT-CONVRTD       TO PV-WEBITM-WEIGHT     10330068
103400           WHEN 'Reference6'                                      10340068
103500             MOVE XML-TEXT(1:XML-LENGTH) TO PV-REF-6              10350068
103600             IF PV-REF-6-BYTE1 = '9'                              10360068
103700                MOVE 'Y' TO PV-WEBITM-SHIP-ALN-IND                10370068
103800             ELSE                                                 10380068
103900                MOVE 'N' TO PV-WEBITM-SHIP-ALN-IND                10390068
104000             END-IF                                               10400068
GFTWRP*            IF PV-REF-6-BYTE2 = 'Y'                              10410075
GFTWRP*               MOVE 'Y' TO PV-WEBITM-GFT-WRAP-AVL-IND            10420075
GFTWRP*            ELSE                                                 10430075
104400                MOVE 'N' TO PV-WEBITM-GFT-WRAP-AVL-IND            10440068
GFTWRP*            END-IF                                               10450075
104600             IF PV-REF-6-BYTE3 = 'Y'                              10460068
104700                MOVE 'Y' TO PV-WEBITM-HAZDS-IND                   10470068
104800             ELSE                                                 10480068
104900                MOVE 'N' TO PV-WEBITM-HAZDS-IND                   10490068
105000             END-IF                                               10500068
105100             IF PV-REF-6-BYTE4 = 'Y'                              10510068
105200                MOVE 'Y' TO PV-WEBITM-GC-IND                      10520068
105300             ELSE                                                 10530068
105400                MOVE 'N' TO PV-WEBITM-GC-IND                      10540068
105500             END-IF                                               10550068
105600             IF PV-REF-6-BYTE5 = 'Y'                              10560068
105700                MOVE 'Y' TO PV-IMT00024-BAGBL-IND                 10570068
105800             ELSE                                                 10580068
105900                MOVE 'N' TO PV-IMT00024-BAGBL-IND                 10590068
106000             END-IF                                               10600068
106100             IF PV-REF-6-BYTE6 = 'Y'                              10610068
106200                MOVE 'Y' TO PV-WEBITM-BRKBL-IND                   10620068
106300             ELSE                                                 10630068
106400                MOVE 'N' TO PV-WEBITM-BRKBL-IND                   10640068
106500             END-IF                                               10650068
106600             IF PV-REF-6-BYTE7 = 'Y'                              10660068
106700                MOVE 'Y' TO PV-IMT00024-CNVYB-IND                 10670068
106800             ELSE                                                 10680068
106900                MOVE 'N' TO PV-IMT00024-CNVYB-IND                 10690068
107000             END-IF                                               10700068
107100             IF PV-REF-6-BYTE8 = '0' OR '2' OR '3'                10710068
107200                MOVE PV-REF-6-BYTE8 TO                            10720068
107300                              PV-WEBITM-SHIP-RSTRC-SEQ-NBR        10730068
107400             ELSE                                                 10740068
107500                INITIALIZE WS027-RECEIPT-PIX-ERROR-REC            10750068
107600                MOVE 'D'            TO WS027-ERROR-TYPE-CDE       10760068
107700                MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME          10770068
107800                MOVE '2100-'        TO WS027-ERROR-PARA-NBR       10780068
107900                MOVE 'SHP RSTRC SEQ NBR INVALID'                  10790068
108000                                    TO WS027-ERROR-DESC-TXT       10800068
108100                MOVE SQLCODE        TO WS027-SQLCODE              10810068
108200                MOVE 'PIX TRANS TYPE:'                            10820068
108300                               TO WS027-FORMAT-RECORD(1:15)       10830068
108400                MOVE PV-TRANSACTION-TYPE                          10840068
108500                               TO WS027-FORMAT-RECORD(16:03)      10850068
108600                MOVE 'PIX TRANS CODE:'                            10860068
108700                               TO WS027-FORMAT-RECORD(19:15)      10870068
108800                MOVE PV-TRANSACTION-CODE                          10880068
108900                               TO WS027-FORMAT-RECORD(34:03)      10890068
109000                MOVE 'PV-SKU: '                                   10900068
109100                               TO WS027-FORMAT-RECORD(38:08)      10910068
109200                MOVE PV-SKU    TO WS027-FORMAT-RECORD(47:08)      10920068
109300                MOVE 'PV-DC NBR: '                                10930068
109400                               TO WS027-FORMAT-RECORD(56:11)      10940068
109500                MOVE PV-DC-NUMBER-NUMERIC                         10950068
109600                               TO WS027-FORMAT-RECORD(67:04)      10960068
109700                MOVE DCLTWEBITM TO WS027-FORMAT-RECORD(71:186)    10970068
109800                PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT              10980068
109900             END-IF                                               10990068
110000             IF PV-REF-6-BYTE9 = '1'                              11000068
110100                MOVE 'S' TO PV-IMT00024-AUTO-SORT-CDE             11010068
110200             ELSE                                                 11020068
110300                IF PV-REF-6-BYTE9 = '2'                           11030068
110400                   MOVE 'N' TO PV-IMT00024-AUTO-SORT-CDE          11040068
110500                ELSE                                              11050068
110600                   IF PV-REF-6-BYTE9 = '3'                        11060068
110700                      MOVE 'C' TO PV-IMT00024-AUTO-SORT-CDE       11070068
110800                   ELSE                                           11080068
110900                      INITIALIZE WS027-RECEIPT-PIX-ERROR-REC      11090068
111000                      MOVE 'D'            TO WS027-ERROR-TYPE-CDE 11100068
111100                      MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME    11110068
111200                      MOVE '2100-'        TO WS027-ERROR-PARA-NBR 11120068
111300                      MOVE 'IMT24 AUTO SORT CDE INVLD'            11130068
111400                                          TO WS027-ERROR-DESC-TXT 11140068
111500                      MOVE SQLCODE        TO WS027-SQLCODE        11150068
111600                      MOVE 'PIX TRANS TYPE:'                      11160068
111700                               TO WS027-FORMAT-RECORD(1:15)       11170068
111800                      MOVE PV-TRANSACTION-TYPE                    11180068
111900                               TO WS027-FORMAT-RECORD(16:03)      11190068
112000                      MOVE 'PIX TRANS CODE:'                      11200068
112100                               TO WS027-FORMAT-RECORD(19:15)      11210068
112200                      MOVE PV-TRANSACTION-CODE                    11220068
112300                               TO WS027-FORMAT-RECORD(34:03)      11230068
112400                      MOVE 'PV-SKU: '                             11240068
112500                               TO WS027-FORMAT-RECORD(38:08)      11250068
112600                      MOVE PV-SKU    TO WS027-FORMAT-RECORD(47:08)11260068
112700                      MOVE DCLTWEBITM                             11270068
112800                               TO WS027-FORMAT-RECORD(56:201)     11280068
112900                      PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT        11290068
113000                   END-IF                                         11300068
113100                END-IF                                            11310068
113200             END-IF                                               11320068
113300           WHEN 'Reference7'                                      11330068
113400             MOVE XML-TEXT(1:XML-LENGTH) TO PV-REF-7              11340068
113500             MOVE REF-7-WRHSE TO PV-IMT00024-PICK-LOC-TYP-CDE     11350068
113600           WHEN 'Reference8'                                      11360068
113700             MOVE XML-TEXT(1:XML-LENGTH) TO PV-REF-8              11370068
113800             MOVE PV-REF-8-NUMERIC       TO PV-REF-8-CONVRTD      11380068
113900             MOVE PV-REF-8-CONVRTD TO PV-IMT00024-SHIP-COST-AMT   11390068
114000             PERFORM 6600-ASSIGN-SURCHARGE                        11400068
114100           WHEN 'Reference9'                                      11410068
114200             MOVE XML-TEXT(1:XML-LENGTH) TO PV-REF-9              11420068
114300             MOVE PV-REF-9-TEXT TO PV-IMT00024-SORT-BOX-SZ-DESC   11430068
114400           WHEN OTHER                                             11440068
114500             CONTINUE                                             11450068
114600         END-EVALUATE                                             11460068
114700                                                                  11470068
114800       WHEN 'EXCEPTION'                                           11480068
114900         DISPLAY 'Exception Caught at ' XML-TEXT(1:XML-LENGTH)    11490068
115000                                                                  11500068
115100     END-EVALUATE.                                                11510068
115200                                                                  11520068
115300******************************************************************11530068
115400* XML ERROR.                                                      11540068
115500******************************************************************11550068
115600 3000-XML-ERROR.                                                  11560068
115700     IF PS-DISPLAY-YES                                            11570068
115800        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   11580068
115900        DISPLAY PV-DISP-TMST                                      11590068
116000                ' WSKUP008 - 3000-XML-ERROR'                      11600068
116100     END-IF.                                                      11610068
116200                                                                  11620068
116300     IF XML-CODE NOT = -1                                         11630068
116400        PERFORM 9000-EXPLAIN-XML-RESPONSE                         11640068
116500        PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                 11650068
116600                UNTIL XML-LINE-IDX > XML-RESPONSE-LINES           11660068
116700            DISPLAY XML-MSG(XML-LINE-IDX)                         11670068
116800        END-PERFORM                                               11680068
116900        MOVE +4018         TO PV-ABEND-CODE                       11690068
117000        MOVE '3000-XML-ERROR' TO PV-PARAGRAPH                     11700068
117100        PERFORM 9500-ABEND                                        11710068
117200     END-IF.                                                      11720068
117300                                                                  11730068
117400******************************************************************11740068
117500* XML SUCCESS.                                                    11750068
117600******************************************************************11760068
117700 3100-XML-SUCCESS.                                                11770068
117800     IF PS-DISPLAY-YES                                            11780068
117900        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   11790068
118000        DISPLAY PV-DISP-TMST                                      11800068
118100                ' WSKUP008 - 3100-XML-SUCCESS'                    11810068
118200        DISPLAY " "                                               11820068
118300        DISPLAY "XML DOCUMENT SUCCESSFULLY PARSED"                11830068
118400     END-IF.                                                      11840068
118500                                                                  11850068
118600***************************************************************** 11860068
118700* IF AN ERROR RECORD IS WRITTEN FOR THIS CASE, SKIP INSERTING TO  11870068
118800* THE TWEBITM AND IMT00024 DATABASES.                             11880068
118900***************************************************************** 11890068
119000 3200-WRITE-DB-REC-LOGIC.                                         11900068
119100     IF PS-DISPLAY-YES                                            11910068
119200        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   11920068
119300        DISPLAY PV-DISP-TMST                                      11930068
119400                ' WSKUP008 - 3200-WRITE-DB-RECS-LOGIC'            11940068
119500     END-IF.                                                      11950068
119600                                                                  11960068
119700     IF PS-ERROR-REC-WRITTEN-YES                                  11970068
119800        CONTINUE                                                  11980068
119900     ELSE                                                         11990068
120000        PERFORM 6000-GET-TWEBITM                                  12000068
120100        IF PS-SKIP-TWEBITM-NO                                     12010068
120200           IF PS-HAVE-TWEBITM-YES                                 12020068
120300              PERFORM 6100-INSERT-TVSRSVN                         12030068
120400              PERFORM 6300-UPDATE-TWEBITM                         12040068
120500              PERFORM 6400-INSERT-TWEBITM                         12050068
120600              PERFORM 6200-DELETE-TVSRSVN                         12060068
120700           ELSE                                                   12070068
120800              PERFORM 6400-INSERT-TWEBITM                         12080068
120900           END-IF                                                 12090068
121000        END-IF                                                    12100068
121100        IF PS-SKIP-TWEBITM-NO                                     12110068
121200           IF PS-HAVE-TWEBITM-YES                                 12120068
121300               IF PS-WRITE-TO-WST-SRCHRG-YES                      12130068
121400                  PERFORM 6800-SELECT-WST-SRCHRG                  12140068
121410               END-IF                                             12141068
121420           END-IF                                                 12142068
121430        END-IF                                                    12143068
121440                                                                  12144068
121450        PERFORM 7000-GET-IMT00024                                 12145068
121460        IF PS-SKIP-IMT00024-YES                                   12146068
121470           NEXT SENTENCE                                          12147068
121480        ELSE                                                      12148068
121490           IF PS-HAVE-IMT00024-YES                                12149068
121500              PERFORM 7100-UPDATE-IMT00024                        12150068
121600              PERFORM 7500-INSERT-IMT00024                        12160068
121700           ELSE                                                   12170068
121800              PERFORM 7500-INSERT-IMT00024                        12180068
121900           END-IF                                                 12190068
122000        END-IF                                                    12200068
122100     END-IF.                                                      12210068
122200                                                                  12220068
122300***************************************************************** 12230068
122400* MQ SERIES WRAP-UP.                                              12240068
122500***************************************************************** 12250068
122600 4000-MQ-CLEANUP.                                                 12260068
122700     IF PS-DISPLAY-YES                                            12270068
122800        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   12280068
122900        DISPLAY PV-DISP-TMST                                      12290068
123000                ' WSKUP008 - 4000-MQ-CLEANUP'                     12300068
123100     END-IF.                                                      12310068
123200                                                                  12320068
123300     PERFORM 4100-MQ-CLOSE-PIX-QUEUE.                             12330068
123400     PERFORM 4300-MQ-CLOSE-ERROR-QUEUE.                           12340068
123500     PERFORM 4500-MQ-DISCONNECT.                                  12350068
123600                                                                  12360068
123700***************************************************************** 12370068
123800* MQ SERIES CLOSE QUEUE FOR THE PIX TRANSACTIONS.                 12380068
123900***************************************************************** 12390068
124000 4100-MQ-CLOSE-PIX-QUEUE.                                         12400068
124100     IF PS-DISPLAY-YES                                            12410068
124200        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   12420068
124300        DISPLAY PV-DISP-TMST                                      12430068
124400                ' WSKUP008 - 4100-MQ-CLOSE-PIX-QUEUE'             12440068
124500     END-IF.                                                      12450068
124600                                                                  12460068
124700     MOVE '4100-MQ-CLOSE-PIX-QUEUE' TO PV-PARAGRAPH.              12470068
124800                                                                  12480068
124900     MOVE PV-QUE-NAME-PIX           TO MQOD-OBJECTNAME.           12490068
125000     MOVE PV-QMGR-NAME-PIX          TO MQOD-OBJECTQMGRNAME.       12500068
125100                                                                  12510068
125200     CALL PC-MQCLOSE USING PV-HCONN                               12520068
125300                           PV-HANDLE-PIX                          12530068
125400                           MQCO-NONE                              12540068
125500                           PV-COMPLETION-CODE                     12550068
125600                           PV-REASON.                             12560068
125700                                                                  12570068
125800*    IF MQ CLOSE FAILED THEN DISPLAY ERROR MESSAGE                12580068
125900*    AND EXIT                                                     12590068
126000                                                                  12600068
126100     IF PV-COMPLETION-CODE = MQCC-OK THEN                         12610068
126200         CONTINUE                                                 12620068
126300     ELSE                                                         12630068
126400         STRING 'CLOSE - ' PV-QUE-NAME-ERROR                      12640068
126500           DELIMITED BY SIZE INTO PV-ACTION                       12650068
126600         ADD +1 TO PA-TOTAL-ERRORS-PROCESSED                      12660068
126700         PERFORM 9001-MQSERIES-ERROR                              12670068
126800     END-IF.                                                      12680068
126900                                                                  12690068
127000***************************************************************** 12700068
127100* MQ SERIES CLOSE QUEUE FOR THE ERROR MESSAGE FILE.               12710068
127200***************************************************************** 12720068
127300 4300-MQ-CLOSE-ERROR-QUEUE.                                       12730068
127400     IF PS-DISPLAY-YES                                            12740068
127500        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   12750068
127600        DISPLAY PV-DISP-TMST                                      12760068
127700                ' WSKUP008 - 4300-MQ-CLOSE-ERROR-QUEUE'           12770068
127800     END-IF.                                                      12780068
127900                                                                  12790068
128000     MOVE '4300-MQ-CLOSE-ERROR-QUEUE' TO PV-PARAGRAPH.            12800068
128100                                                                  12810068
128200     MOVE PV-QUE-NAME-ERROR         TO MQOD-OBJECTNAME.           12820068
128300     MOVE PV-QMGR-NAME-ERROR        TO MQOD-OBJECTQMGRNAME.       12830068
128400                                                                  12840068
128500     CALL PC-MQCLOSE USING PV-HCONN                               12850068
128600                           PV-HANDLE-ERROR                        12860068
128700                           MQCO-NONE                              12870068
128800                           PV-COMPLETION-CODE                     12880068
128900                           PV-REASON.                             12890068
129000                                                                  12900068
129100*    IF MQ CLOSE FAILED THEN DISPLAY ERROR MESSAGE                12910068
129200*    AND EXIT                                                     12920068
129300                                                                  12930068
129400     IF PV-COMPLETION-CODE = MQCC-OK THEN                         12940068
129500         CONTINUE                                                 12950068
129600     ELSE                                                         12960068
129700         STRING 'CLOSE - ' PV-QUE-NAME-ERROR                      12970068
129800           DELIMITED BY SIZE INTO PV-ACTION                       12980068
129900         ADD +1 TO PA-TOTAL-ERRORS-PROCESSED                      12990068
130000         PERFORM 9001-MQSERIES-ERROR                              13000068
130100     END-IF.                                                      13010068
130200                                                                  13020068
130300***************************************************************** 13030068
130400* DISCONNECT FROM QUEUE MANAGER.                                  13040068
130500***************************************************************** 13050068
130600 4500-MQ-DISCONNECT.                                              13060068
130700     IF PS-DISPLAY-YES                                            13070068
130800        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   13080068
130900        DISPLAY PV-DISP-TMST                                      13090068
131000                ' WSKUP008 - 4500-MQ-DISCONNECT'                  13100068
131100     END-IF.                                                      13110068
131200                                                                  13120068
131300     MOVE '4500-MQ-DISCONNECT'    TO PV-PARAGRAPH.                13130068
131400                                                                  13140068
131500     IF PV-CON-REASON NOT = MQRC-ALREADY-CONNECTED                13150068
131600         CALL PC-MQDISC USING PV-HCONN                            13160068
131700                              PV-COMPLETION-CODE                  13170068
131800                              PV-REASON                           13180068
131900                                                                  13190068
132000*    IF MQ DISCONNECT FAILED THEN DISPLAY ERROR MESSAGE           13200068
132100*    AND EXIT                                                     13210068
132200                                                                  13220068
132300     IF PV-COMPLETION-CODE = MQCC-OK THEN                         13230068
132400         CONTINUE                                                 13240068
132500     ELSE                                                         13250068
132600         STRING 'DISCONNECT - ' PV-QMGR-NAME-PIX                  13260068
132700           DELIMITED BY SIZE INTO PV-ACTION                       13270068
132800         ADD +1 TO PA-TOTAL-ERRORS-PROCESSED                      13280068
132900         PERFORM 9001-MQSERIES-ERROR                              13290068
133000     END-IF.                                                      13300068
133100                                                                  13310068
133200***************************************************************** 13320068
133300* TRANSLATE SKU NUMBER TO INTERNAL UPC ID.                        13330068
133400***************************************************************** 13340068
133500 5000-GET-INTR-UPC-ID.                                            13350068
133600     IF PS-DISPLAY-YES                                            13360068
133700        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   13370068
133800        DISPLAY PV-DISP-TMST                                      13380068
133900                ' WSKUP008 - 5000-GET-INTR-UPC-ID'                13390068
134000     END-IF.                                                      13400068
134100                                                                  13410068
134200     INITIALIZE DK-DATABASE-KEYS                                  13420068
134300                PV-DEPT.                                          13430068
134400                                                                  13440068
134500     MOVE PV-SKU TO DK-SKU.                                       13450068
134600                                                                  13460068
134700     EXEC SQL                                                     13470068
134800        SELECT A.DEPT_NBR                                         13480068
134900             , A.CL_NBR                                           13490068
135000             , A.SKU_SEQ_NBR                                      13500068
135100             , A.SKU_STAT_CDE                                     13510068
135200             , A.ITM_NBR                                          13520068
135300             , A.INTR_UPC_ID                                      13530068
135400             , A.DEPT                                             13540068
135500             , A.CLASS                                            13550068
135600             , A.SUBCLASS                                         13560068
135700             , A.SKU                                              13570068
135800             , B.STYL_ID                                          13580068
135900             , C.VS_ID                                            13590068
136000             , C.VS_NBR                                           13600068
136100             , C.ENT_ID                                           13610068
136200          INTO :SKXREF-DEPT-NBR                                   13620068
136300             , :SKXREF-CL-NBR                                     13630068
136400             , :SKXREF-SKU-SEQ-NBR                                13640068
136500             , :SKXREF-SKU-STAT-CDE                               13650068
136600             , :SKXREF-ITM-NBR                                    13660068
136700             , :SKXREF-INTR-UPC-ID                                13670068
136800             , :SKXREF-DEPT                                       13680068
136900             , :SKXREF-CLASS                                      13690068
137000             , :SKXREF-SUBCLASS                                   13700068
137100             , :SKXREF-SKU                                        13710068
137200             , :XLT00003-STYL-ID                                  13720068
137300             , :XLT00004-VS-ID                                    13730068
137400             , :XLT00004-VS-NBR                                   13740068
137500             , :XLT00004-ENT-ID                                   13750068
137600          FROM TSKXREF A                                          13760068
137700             , XLT_SKU B                                          13770068
137800             , XLT_VND_STYL C                                     13780068
137900         WHERE A.SKU         = :DK-SKU                            13790068
138000           AND B.INTR_UPC_ID = A.INTR_UPC_ID                      13800068
138100           AND C.STYL_ID     = B.STYL_ID                          13810068
138200     END-EXEC.                                                    13820068
138300                                                                  13830068
138400     EVALUATE TRUE                                                13840068
138500       WHEN SQLCODE = ZERO                                        13850068
138600           MOVE SKXREF-DEPT         TO PV-DEPT                    13860068
138700                                                                  13870068
138800           MOVE SKXREF-INTR-UPC-ID  TO DK-INTR-UPC-ID             13880068
138900                                       PV-DISPLAY-UPC-NBR         13890068
139000                                                                  13900068
139100           MOVE XLT00004-VS-ID      TO DK-VS-ID                   13910068
139200           MOVE XLT00004-VS-NBR     TO DK-VS-NBR                  13920068
139300           MOVE XLT00004-ENT-ID     TO DK-ENT-ID                  13930068
139400                                                                  13940068
139500       WHEN SQLCODE = +100                                        13950068
139600           INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 13960068
139700           SET WS027-REC-NOT-FOUND TO TRUE                        13970068
139800           MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME               13980068
139900           MOVE '5000-'        TO WS027-ERROR-PARA-NBR            13990068
140000           MOVE 'INTR-UPC-ID NOT FOUND'                           14000068
140100                               TO WS027-ERROR-DESC-TXT            14010068
140200           MOVE SQLCODE        TO WS027-SQLCODE                   14020068
140300           MOVE 'PIX TRANS TYPE:'                                 14030068
140400                               TO WS027-FORMAT-RECORD(1:15)       14040068
140500           MOVE PV-TRANSACTION-TYPE                               14050068
140600                               TO WS027-FORMAT-RECORD(16:03)      14060068
140700           MOVE 'PIX TRANS CODE:'                                 14070068
140800                               TO WS027-FORMAT-RECORD(19:15)      14080068
140900           MOVE PV-TRANSACTION-CODE                               14090068
141000                               TO WS027-FORMAT-RECORD(34:03)      14100068
141100           MOVE DCLTWEBITM     TO WS027-FORMAT-RECORD(37:220)     14110068
141200           PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   14120068
141300                                                                  14130068
141400       WHEN OTHER                                                 14140068
141500           INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 14150068
141600           SET WS027-SQL-ERROR        TO TRUE                     14160068
141700           MOVE PC-PGM-NAME    TO WS027-ERROR-PGM-NAME            14170068
141800           MOVE SPACES         TO WS027-ERROR-COPYBOOK            14180068
141900           MOVE '5000-'        TO WS027-ERROR-PARA-NBR            14190068
142000           MOVE 'INTR UPC ID ERROR' TO WS027-ERROR-DESC-TXT       14200068
142100           MOVE SQLCODE        TO WS027-SQLCODE                   14210068
142200           MOVE 'PIX TRANS TYPE:' TO WS027-FORMAT-RECORD(1:15)    14220068
142300           MOVE PV-TRANSACTION-TYPE                               14230068
142400                                  TO WS027-FORMAT-RECORD(16:03)   14240068
142500           MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(19:15)   14250068
142600           MOVE PV-TRANSACTION-CODE                               14260068
142700                                  TO WS027-FORMAT-RECORD(34:03)   14270068
142800           MOVE 'SKU NUMBER '   TO WS027-FORMAT-RECORD(37:11)     14280068
142900           MOVE PV-SKU          TO WS027-FORMAT-RECORD(48:08)     14290068
143000           MOVE DCLTWEBITM      TO WS027-FORMAT-RECORD(57:200)    14300068
143100           PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   14310068
143200           SET PS-ERROR-REC-WRITTEN-YES TO TRUE                   14320068
143300     END-EVALUATE.                                                14330068
143400                                                                  14340068
143500***************************************************************** 14350068
143600* GET TWEBITEM FIELDS FROM THE DATABASE.                          14360068
143700***************************************************************** 14370068
143800 6000-GET-TWEBITM.                                                14380068
143900     IF PS-DISPLAY-YES                                            14390068
144000        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   14400068
144100        DISPLAY PV-DISP-TMST                                      14410068
144200                ' WSKUP008 - 6000-GET-TWEBITM'                    14420068
144300     END-IF.                                                      14430068
144400                                                                  14440068
144500     EXEC SQL                                                     14450068
144600        SELECT INTR_UPC_ID                                        14460068
144700             , EFF_BEG_TMST                                       14470068
144800             , EFF_END_TMST                                       14480068
144900             , ASRT_BEG_DTE                                       14490068
145000             , ASRT_END_DTE                                       14500068
145100             , STRG_AREA_SEQ_NBR                                  14510068
145200             , SHIP_WD_QTY                                        14520068
145300             , SHIP_DPTH_QTY                                      14530068
145400             , SHIP_HT_QTY                                        14540068
145500             , SHIP_WT_QTY                                        14550068
145600             , SHIP_DIM_SRC_CDE                                   14560068
145700             , PKG_SEQ_NBR                                        14570068
145800             , SHIP_RSTRC_SEQ_NBR                                 14580068
145900             , GFT_WRAP_AVL_IND                                   14590068
146000             , PRD_GP_NBR                                         14600068
146100             , PRD_GP_IND                                         14610068
146200             , SHIP_SRCHG_FEE_AMT                                 14620068
146300             , SHIP_SRVC_SEQ_NBR                                  14630068
146400             , SHIP_GP_SEQ_NBR                                    14640068
146500             , CRE_BY_USR_ID                                      14650068
146600             , WEB_ITM_DLTD_IND                                   14660068
146700             , HAZDS_IND                                          14670068
146800             , BRKBL_IND                                          14680068
146900             , GC_IND                                             14690068
147000             , SHIP_ALN_IND                                       14700068
147100             , WEB_EXCLV_IND                                      14710068
147200          INTO :WEBITM-INTR-UPC-ID                                14720068
147300             , :WEBITM-EFF-BEG-TMST                               14730068
147400             , :WEBITM-EFF-END-TMST :PV-NULL-IND-1                14740068
147500             , :WEBITM-ASRT-BEG-DTE                               14750068
147600             , :WEBITM-ASRT-END-DTE                               14760068
147700             , :WEBITM-STRG-AREA-SEQ-NBR                          14770068
147800             , :WEBITM-SHIP-WD-QTY                                14780068
147900             , :WEBITM-SHIP-DPTH-QTY                              14790068
148000             , :WEBITM-SHIP-HT-QTY                                14800068
148100             , :WEBITM-SHIP-WT-QTY                                14810068
148200             , :WEBITM-SHIP-DIM-SRC-CDE                           14820068
148300             , :WEBITM-PKG-SEQ-NBR                                14830068
148400             , :WEBITM-SHIP-RSTRC-SEQ-NBR                         14840068
148500             , :WEBITM-GFT-WRAP-AVL-IND                           14850068
148600             , :WEBITM-PRD-GP-NBR                                 14860068
148700             , :WEBITM-PRD-GP-IND                                 14870068
148800             , :WEBITM-SHIP-SRCHG-FEE-AMT                         14880068
148900             , :WEBITM-SHIP-SRVC-SEQ-NBR                          14890068
149000             , :WEBITM-SHIP-GP-SEQ-NBR                            14900068
149100             , :WEBITM-CRE-BY-USR-ID                              14910068
149200             , :WEBITM-WEB-ITM-DLTD-IND                           14920068
149300             , :WEBITM-HAZDS-IND                                  14930068
149400             , :WEBITM-BRKBL-IND                                  14940068
149500             , :WEBITM-GC-IND                                     14950068
149600             , :WEBITM-SHIP-ALN-IND                               14960068
149700             , :WEBITM-WEB-EXCLV-IND                              14970068
149800          FROM TWEBITM                                            14980068
149900         WHERE INTR_UPC_ID  = :DK-INTR-UPC-ID                     14990068
150000           AND EFF_END_TMST IS NULL                               15000068
150100     END-EXEC.                                                    15010068
150200                                                                  15020068
150300     EVALUATE TRUE                                                15030068
150400       WHEN SQLCODE = ZERO                                        15040068
150500           PERFORM 6050-CHK-TO-UPD-TWEBITM-OR-NOT                 15050068
150600                                                                  15060068
150700       WHEN SQLCODE = +100                                        15070068
150800           INITIALIZE DCLTWEBITM                                  15080068
150900           SET PS-HAVE-TWEBITM-NO  TO TRUE                        15090068
151000           INITIALIZE DCLTEGPNBR                                  15100068
151100           PERFORM 6505-SET-ASRT-DTE                              15110068
151200           MOVE 'N'  TO WEBITM-PRD-GP-IND                         15120068
151300           SET PS-SEQNBR-AT-END-NO TO TRUE                        15130068
151400           PERFORM 6501-OPEN-SEQNBR                               15140068
151500           PERFORM 6502-FETCH-SEQNBR                              15150068
151600              UNTIL PS-SEQNBR-AT-END-YES                          15160068
151700           PERFORM 6503-CLOSE-SEQNBR                              15170068
151800                                                                  15180068
151900       WHEN OTHER                                                 15190068
152000           INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 15200068
152100           SET WS027-SQL-ERROR        TO TRUE                     15210068
152200           MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME               15220068
152300           MOVE '6000-'         TO WS027-ERROR-PARA-NBR           15230068
152400           MOVE 'GET WEBITM DB FIELDS ERR'                        15240068
152500                                TO WS027-ERROR-DESC-TXT           15250068
152600           MOVE SQLCODE         TO WS027-SQLCODE                  15260068
152700           MOVE 'PIX TRANS TYPE:' TO WS027-FORMAT-RECORD(1:15)    15270068
152800           MOVE PV-TRANSACTION-TYPE TO WS027-FORMAT-RECORD(16:03) 15280068
152900           MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(19:15)   15290068
153000           MOVE PV-TRANSACTION-CODE TO WS027-FORMAT-RECORD(34:03) 15300068
153100           MOVE DCLTWEBITM        TO WS027-FORMAT-RECORD(37:219)  15310068
153200           PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   15320068
153300                                                                  15330068
153400     END-EVALUATE.                                                15340068
153500                                                                  15350068
153600******************************************************************15360068
153700* THE ROW EXISTS ON TWEBITM.  COMPARE THE FIELDS TO SEE IF ANY OF 15370068
153800* THEM HAVE CHANGED AND IF WE NEED TO UPDATE TWEBITM.             15380068
153900******************************************************************15390068
154000 6050-CHK-TO-UPD-TWEBITM-OR-NOT.                                  15400068
154100     IF PS-DISPLAY-YES                                            15410068
154200        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   15420068
154300        DISPLAY PV-DISP-TMST                                      15430068
154400                ' WSKUP008 - 6050-CHK-TO-UPD-TWEBITM-OR-NOT'      15440068
154500     END-IF.                                                      15450068
154600                                                                  15460068
154700     IF WEBITM-SHIP-WD-QTY   = PV-WEBITM-WIDTH  AND               15470068
154800        WEBITM-SHIP-DPTH-QTY = PV-WEBITM-DEPTH  AND               15480068
154900        WEBITM-SHIP-HT-QTY   = PV-WEBITM-HEIGHT AND               15490068
155000        WEBITM-SHIP-WT-QTY   = PV-WEBITM-WEIGHT AND               15500068
155100        WEBITM-GFT-WRAP-AVL-IND   =                               15510068
155200                            PV-WEBITM-GFT-WRAP-AVL-IND   AND      15520068
155300***     WEBITM-SHIP-SRCHG-FEE-AMT =                               15530068
155400***                         PV-WEBITM-SHIP-SRCHG-FEE-AMT AND      15540068
155500        WEBITM-HAZDS-IND     = PV-WEBITM-HAZDS-IND AND            15550068
155600        WEBITM-BRKBL-IND     = PV-WEBITM-BRKBL-IND   AND          15560068
155700        WEBITM-GC-IND        = PV-WEBITM-GC-IND      AND          15570068
155800        WEBITM-SHIP-ALN-IND  = PV-WEBITM-SHIP-ALN-IND             15580068
155900           SET PS-SKIP-TWEBITM-YES TO TRUE                        15590068
156000     ELSE                                                         15600068
156100        SET PS-HAVE-TWEBITM-YES TO TRUE                           15610068
156200     END-IF.                                                      15620068
156300     IF WEBITM-SHIP-SRCHG-FEE-AMT =                               15630068
156400                            PV-WEBITM-SHIP-SRCHG-FEE-AMT          15640068
156500         SET PS-WRITE-TO-WST-SRCHRG-NO TO TRUE                    15650068
156600     ELSE                                                         15660068
156700         SET PS-WRITE-TO-WST-SRCHRG-YES TO TRUE                   15670068
156800     END-IF.                                                      15680068
156900******************************************************************15690068
157000*        P R O C E S S   V S M   R E S E R V A T I O N S          15700068
157100******************************************************************15710068
157200 6100-INSERT-TVSRSVN.                                             15720068
157300     IF PS-DISPLAY-YES                                            15730068
157400        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   15740068
157500        DISPLAY PV-DISP-TMST                                      15750068
157600                ' WSKUP008 - 6100-INSERT-TVSRSVN'                 15760068
157700     END-IF.                                                      15770068
157800                                                                  15780068
157900     PERFORM 6110-GET-TVSRSVN-KEYS.                               15790068
158000                                                                  15800068
158100         EXEC SQL                                                 15810068
158200             INSERT INTO TVSRSVN                                  15820068
158300                     (ENT_ID                                      15830068
158400                     ,VS_NBR                                      15840068
158500                     ,VS_ID                                       15850068
158600                     ,RSRV_TYP_CDE                                15860068
158700                     ,SKU_STRGY_CDE                               15870068
158800                     ,DEPT_MDSEAR_ID                              15880068
158900                     ,MAJ_CL_MDSEAR_ID                            15890068
159000                     ,SUB_CL_MDSEAR_ID                            15900068
159100                     ,RSRV_BY_USR_ID                              15910068
159200                     ,RSRV_TMST)                                  15920068
159300             VALUES (:VSRSVN-ENT-ID                               15930068
159400                  ,  :VSRSVN-VS-NBR                               15940068
159500                  ,  :VSRSVN-VS-ID                                15950068
159600                  ,  'M'                                          15960068
159700                  ,  ' '                                          15970068
159800                  ,  0.0                                          15980068
159900                  ,  0.0                                          15990068
160000                  ,  0.0                                          16000068
160100                  ,  :PC-PGM-NAME                                 16010068
160200                  ,  CURRENT TIMESTAMP)                           16020068
160300         END-EXEC                                                 16030068
160400                                                                  16040068
160500         EVALUATE TRUE                                            16050068
160600           WHEN SQLCODE = ZERO                                    16060068
160700               ADD +1 TO PA-TOTAL-INSERT-TVSRSVN                  16070068
160800                                                                  16080068
160900           WHEN OTHER                                             16090068
161000              SET PS-ROLLBACK-DB2-YES TO TRUE                     16100068
161100              INITIALIZE WS027-RECEIPT-PIX-ERROR-REC              16110068
161200              SET WS027-SQL-ERROR        TO TRUE                  16120068
161300              MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME            16130068
161400              MOVE '6100-'         TO WS027-ERROR-PARA-NBR        16140068
161500              MOVE 'INSERT TVSRSVN ERROR'                         16150068
161600                                   TO WS027-ERROR-DESC-TXT        16160068
161700              MOVE SQLCODE         TO WS027-SQLCODE               16170068
161800              MOVE 'PIX TRANS TYPE:'                              16180068
161900                                TO WS027-FORMAT-RECORD(1:15)      16190068
162000              MOVE PV-TRANSACTION-TYPE                            16200068
162100                                TO WS027-FORMAT-RECORD(16:03)     16210068
162200              MOVE 'PIX TRANS CODE:'                              16220068
162300                                TO WS027-FORMAT-RECORD(19:15)     16230068
162400              MOVE PV-TRANSACTION-CODE                            16240068
162500                                TO WS027-FORMAT-RECORD(34:03)     16250068
162600              MOVE DCLTWEBITM   TO WS027-FORMAT-RECORD(37:220)    16260068
162700              PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                16270068
162800         END-EVALUATE.                                            16280068
162900                                                                  16290068
163000******************************************************************16300068
163100* GET RESERVATION KEYS.                                           16310068
163200******************************************************************16320068
163300 6110-GET-TVSRSVN-KEYS.                                           16330068
163400     IF PS-DISPLAY-YES                                            16340068
163500        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   16350068
163600        DISPLAY PV-DISP-TMST                                      16360068
163700                ' WSKUP008 - 6110-GET-TVSRSVN-KEYS'               16370068
163800     END-IF.                                                      16380068
163900                                                                  16390068
164000     MOVE DK-ENT-ID  TO VSRSVN-ENT-ID.                            16400068
164100     MOVE DK-VS-ID   TO VSRSVN-VS-ID.                             16410068
164200     MOVE DK-VS-NBR  TO VSRSVN-VS-NBR.                            16420068
164300                                                                  16430068
164400******************************************************************16440068
164500* DELETE RESERVATION.                                             16450068
164600******************************************************************16460068
164700 6200-DELETE-TVSRSVN.                                             16470068
164800     IF PS-DISPLAY-YES                                            16480068
164900        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   16490068
165000        DISPLAY PV-DISP-TMST                                      16500068
165100                ' WSKUP008 - 6200-DELETE-TVSRSVNS'                16510068
165200     END-IF.                                                      16520068
165300                                                                  16530068
165400         EXEC SQL                                                 16540068
165500             DELETE FROM TVSRSVN                                  16550068
165600              WHERE (VS_ID  = :VSRSVN-VS-ID)                      16560068
165700                AND (VS_NBR = :VSRSVN-VS-NBR)                     16570068
165800                AND (ENT_ID = :VSRSVN-ENT-ID)                     16580068
165900         END-EXEC                                                 16590068
166000                                                                  16600068
166100         EVALUATE TRUE                                            16610068
166200           WHEN SQLCODE = ZERO                                    16620068
166300               ADD +1 TO PA-TOTAL-DELETE-TVSRSVN                  16630068
166400                                                                  16640068
166500           WHEN SQLCODE = +100                                    16650068
166600               CONTINUE                                           16660068
166700                                                                  16670068
166800           WHEN OTHER                                             16680068
166900              SET PS-ROLLBACK-DB2-YES TO TRUE                     16690068
167000              INITIALIZE WS027-RECEIPT-PIX-ERROR-REC              16700068
167100              SET WS027-SQL-ERROR        TO TRUE                  16710068
167200              MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME            16720068
167300              MOVE '6200-'         TO WS027-ERROR-PARA-NBR        16730068
167400              MOVE 'DELETE TVSRSVN ERROR'                         16740068
167500                                   TO WS027-ERROR-DESC-TXT        16750068
167600              MOVE SQLCODE         TO WS027-SQLCODE               16760068
167700              MOVE 'PIX TRANS TYPE:'                              16770068
167800                                TO WS027-FORMAT-RECORD(1:15)      16780068
167900              MOVE PV-TRANSACTION-TYPE                            16790068
168000                                TO WS027-FORMAT-RECORD(16:03)     16800068
168100              MOVE 'PIX TRANS CODE:'                              16810068
168200                                TO WS027-FORMAT-RECORD(19:15)     16820068
168300              MOVE PV-TRANSACTION-CODE                            16830068
168400                                TO WS027-FORMAT-RECORD(34:03)     16840068
168500              MOVE DCLTWEBITM   TO WS027-FORMAT-RECORD(37:220)    16850068
168600              PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                16860068
168700         END-EVALUATE.                                            16870068
168800                                                                  16880068
168900******************************************************************16890068
169000*         P R O C E S S   T W E B I T M   T A B L E               16900068
169100******************************************************************16910068
169200 6300-UPDATE-TWEBITM.                                             16920068
169300     IF PS-DISPLAY-YES                                            16930068
169400        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   16940068
169500        DISPLAY PV-DISP-TMST                                      16950068
169600                ' WSKUP008 - 6300-UPDATE-TWEBITM'                 16960068
169700     END-IF.                                                      16970068
169800                                                                  16980068
169900         EXEC SQL                                                 16990068
170000             UPDATE TWEBITM                                       17000068
170100                SET EFF_END_TMST   = CURRENT TIMESTAMP            17010068
170200              WHERE INTR_UPC_ID    = :DK-INTR-UPC-ID              17020068
170300                AND EFF_END_TMST     IS NULL                      17030068
170400         END-EXEC                                                 17040068
170500                                                                  17050068
170600         EVALUATE TRUE                                            17060068
170700           WHEN SQLCODE = ZERO                                    17070068
170800               ADD +1 TO PA-TOTAL-UPDATE-TWEBITM                  17080068
170900                                                                  17090068
171000           WHEN SQLCODE = -803                                    17100068
171100               CONTINUE                                           17110068
171200                                                                  17120068
171300           WHEN OTHER                                             17130068
171400              SET PS-ROLLBACK-DB2-YES TO TRUE                     17140068
171500              INITIALIZE WS027-RECEIPT-PIX-ERROR-REC              17150068
171600              SET WS027-SQL-ERROR        TO TRUE                  17160068
171700              MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME            17170068
171800              MOVE '6300-'         TO WS027-ERROR-PARA-NBR        17180068
171900              MOVE 'TWEBITM UPDATE ERROR'                         17190068
172000                                   TO WS027-ERROR-DESC-TXT        17200068
172100              MOVE SQLCODE         TO WS027-SQLCODE               17210068
172200              MOVE 'PIX TRANS TYPE:'                              17220068
172300                                TO WS027-FORMAT-RECORD(1:15)      17230068
172400              MOVE PV-TRANSACTION-TYPE                            17240068
172500                                TO WS027-FORMAT-RECORD(16:03)     17250068
172600              MOVE 'PIX TRANS CODE:'                              17260068
172700                                TO WS027-FORMAT-RECORD(19:15)     17270068
172800              MOVE PV-TRANSACTION-CODE                            17280068
172900                                TO WS027-FORMAT-RECORD(34:03)     17290068
173000              MOVE DCLTWEBITM   TO WS027-FORMAT-RECORD(37:220)    17300068
173100              PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                17310068
173200         END-EVALUATE.                                            17320068
173300                                                                  17330068
173400******************************************************************17340068
173500* INSERT TWEBITM.                                                 17350068
173600******************************************************************17360068
173700 6400-INSERT-TWEBITM.                                             17370068
173800     IF PS-DISPLAY-YES                                            17380068
173900        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   17390068
174000        DISPLAY PV-DISP-TMST                                      17400068
174100                ' WSKUP008 - 6400-INSERT-TWEBITM'                 17410068
174200     END-IF.                                                      17420068
174300                                                                  17430068
174400     PERFORM 6500-LOAD-TWEBITM.                                   17440068
174500                                                                  17450068
174600         EXEC SQL                                                 17460068
174700             INSERT INTO TWEBITM                                  17470068
174800                   (INTR_UPC_ID                                   17480068
174900                  , EFF_BEG_TMST                                  17490068
175000                  , EFF_END_TMST                                  17500068
175100                  , ASRT_BEG_DTE                                  17510068
175200                  , ASRT_END_DTE                                  17520068
175300                  , STRG_AREA_SEQ_NBR                             17530068
175400                  , SHIP_WD_QTY                                   17540068
175500                  , SHIP_DPTH_QTY                                 17550068
175600                  , SHIP_HT_QTY                                   17560068
175700                  , SHIP_WT_QTY                                   17570068
175800                  , SHIP_DIM_SRC_CDE                              17580068
175900                  , PKG_SEQ_NBR                                   17590068
176000                  , SHIP_RSTRC_SEQ_NBR                            17600068
176100                  , GFT_WRAP_AVL_IND                              17610068
176200                  , PRD_GP_NBR                                    17620068
176300                  , PRD_GP_IND                                    17630068
176400                  , SHIP_SRCHG_FEE_AMT                            17640068
176500                  , SHIP_SRVC_SEQ_NBR                             17650068
176600                  , SHIP_GP_SEQ_NBR                               17660068
176700                  , CRE_BY_USR_ID                                 17670068
176800                  , WEB_ITM_DLTD_IND                              17680068
176900                  , HAZDS_IND                                     17690068
177000                  , BRKBL_IND                                     17700068
177100                  , GC_IND                                        17710068
177200                  , SHIP_ALN_IND                                  17720068
177300                  , WEB_EXCLV_IND)                                17730068
177400             VALUES                                               17740068
177500                   (:WEBITM-INTR-UPC-ID                           17750068
177600                  , CURRENT TIMESTAMP                             17760068
177700                  , NULL                                          17770068
177800                  , :WEBITM-ASRT-BEG-DTE                          17780068
177900                  , :WEBITM-ASRT-END-DTE                          17790068
178000                  , :WEBITM-STRG-AREA-SEQ-NBR                     17800068
178100                  , :WEBITM-SHIP-WD-QTY                           17810068
178200                  , :WEBITM-SHIP-DPTH-QTY                         17820068
178300                  , :WEBITM-SHIP-HT-QTY                           17830068
178400                  , :WEBITM-SHIP-WT-QTY                           17840068
178500                  , :WEBITM-SHIP-DIM-SRC-CDE                      17850068
178600                  , :WEBITM-PKG-SEQ-NBR                           17860068
178700                  , :WEBITM-SHIP-RSTRC-SEQ-NBR                    17870068
178800                  , :WEBITM-GFT-WRAP-AVL-IND                      17880068
178900                  , :WEBITM-PRD-GP-NBR                            17890068
179000                  , :WEBITM-PRD-GP-IND                            17900068
179100                  , :WEBITM-SHIP-SRCHG-FEE-AMT                    17910068
179200                  , :WEBITM-SHIP-SRVC-SEQ-NBR                     17920068
179300                  , :WEBITM-SHIP-GP-SEQ-NBR                       17930068
179400                  , :PC-PGM-NAME                                  17940068
179500                  , :WEBITM-WEB-ITM-DLTD-IND                      17950068
179600                  , :WEBITM-HAZDS-IND                             17960068
179700                  , :WEBITM-BRKBL-IND                             17970068
179800                  , :WEBITM-GC-IND                                17980068
179900                  , :WEBITM-SHIP-ALN-IND                          17990068
180000                  , :WEBITM-WEB-EXCLV-IND)                        18000068
180100         END-EXEC                                                 18010068
180200                                                                  18020068
180300         EVALUATE TRUE                                            18030068
180400           WHEN SQLCODE = ZERO                                    18040068
180500               ADD +1 TO PA-TOTAL-INSERT-TWEBITM                  18050068
180600*              PERFORM 6450-COMMIT-TWEBITM                        18060068
180700                                                                  18070068
180800           WHEN SQLWARN0 NOT EQUAL SPACE                          18080068
180900           WHEN SQLCODE  NOT EQUAL ZERO                           18090068
181000              SET PS-ROLLBACK-DB2-YES TO TRUE                     18100068
181100              MOVE SQLCODE         TO PV-DISP-SQLCODE             18110068
181200              INITIALIZE WS027-RECEIPT-PIX-ERROR-REC              18120068
181300              SET WS027-SQL-ERROR        TO TRUE                  18130068
181400              MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME            18140068
181500              MOVE '6400-'         TO WS027-ERROR-PARA-NBR        18150068
181600              MOVE 'TWEBITM INSERT ERROR'                         18160068
181700                                   TO WS027-ERROR-DESC-TXT        18170068
181800              MOVE SQLCODE         TO WS027-SQLCODE               18180068
181900              MOVE 'PIX TRANS TYPE:'                              18190068
182000                                TO WS027-FORMAT-RECORD(1:15)      18200068
182100              MOVE PV-TRANSACTION-TYPE                            18210068
182200                                TO WS027-FORMAT-RECORD(16:03)     18220068
182300              MOVE 'PIX TRANS CODE:'                              18230068
182400                                TO WS027-FORMAT-RECORD(19:15)     18240068
182500              MOVE PV-TRANSACTION-CODE                            18250068
182600                                TO WS027-FORMAT-RECORD(34:03)     18260068
182700              MOVE DCLTWEBITM   TO WS027-FORMAT-RECORD(37:220)    18270068
182800              PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                18280068
182900         END-EVALUATE.                                            18290068
183000                                                                  18300068
183100******************************************************************18310068
183200** COMMITTED RECORDS WILL REMAIN IN DB2 TABLES AFTER AN ABEND.    18320068
183300******************************************************************18330068
183400*6450-COMMIT-TWEBITM.                                             18340068
183500*    IF PS-DISPLAY-YES                                            18350068
183600*       DISPLAY 'WSKUP008 - 6450-COMMIT-TWEBITM.'                 18360068
183700*    END-IF.                                                      18370068
183800*                                                                 18380068
183900*    EXEC SQL                                                     18390068
184000*        COMMIT                                                   18400068
184100*    END-EXEC.                                                    18410068
184200*                                                                 18420068
184300*    EVALUATE TRUE                                                18430068
184400*        WHEN SQLWARN0 NOT EQUAL SPACE                            18440068
184500*        WHEN SQLCODE NOT EQUAL ZERO                              18450068
184600*          INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 18460068
184700*          SET WS027-SQL-ERROR        TO TRUE                     18470068
184800*          MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME               18480068
184900*          MOVE 'TWEBITM' TO WS027-ERROR-COPYBOOK                 18490068
185000*          MOVE '6450-'         TO WS027-ERROR-PARA-NBR           18500068
185100*          MOVE 'WTWEBITM DB2 COMMIT FAILED'                      18510068
185200*                               TO WS027-ERROR-DESC-TXT           18520068
185300*          MOVE SQLCODE         TO WS027-SQLCODE                  18530068
185400*          MOVE 'PIX TRANS TYPE:' TO WS027-FORMAT-RECORD(1:15)    18540068
185500*          MOVE PV-TRANSACTION-TYPE                               18550068
185600*                               TO WS027-FORMAT-RECORD(16:03)     18560068
185700*          MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(19:15)   18570068
185800*          MOVE PV-TRANSACTION-CODE                               18580068
185900*                               TO WS027-FORMAT-RECORD(34:03)     18590068
186000*          MOVE DCLTWEBITM      TO WS027-FORMAT-RECORD(37:220)    18600068
186100*          PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   18610068
186200*                                                                 18620068
186300*        WHEN SQLCODE EQUAL ZERO                                  18630068
186400*          ADD +1 TO PA-TOTAL-TWEBITM-DB2-COMMITS                 18640068
186500*    END-EVALUATE.                                                18650068
186600                                                                  18660068
186700******************************************************************18670068
186800* LOAD TWEB ITEM FIELDS.                                          18680068
186900* SHIP SURCHARGE FEE AMOUNT IS ASSIGNED IN PARAGRAPH 6600.        18690068
187000******************************************************************18700068
187100 6500-LOAD-TWEBITM.                                               18710068
187200     IF PS-DISPLAY-YES                                            18720068
187300        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   18730068
187400        DISPLAY PV-DISP-TMST                                      18740068
187500                ' WSKUP008 - 6500-LOAD-TWEBITM'                   18750068
187600     END-IF.                                                      18760068
187700                                                                  18770068
187800     MOVE DK-INTR-UPC-ID      TO WEBITM-INTR-UPC-ID.              18780068
187900     MOVE PV-WEBITM-WIDTH     TO WEBITM-SHIP-WD-QTY.              18790068
188000     MOVE PV-WEBITM-DEPTH     TO WEBITM-SHIP-DPTH-QTY.            18800068
188100     MOVE PV-WEBITM-HEIGHT    TO WEBITM-SHIP-HT-QTY.              18810068
188200     MOVE PV-WEBITM-WEIGHT    TO WEBITM-SHIP-WT-QTY.              18820068
188300     MOVE PV-WEBITM-SHIP-ALN-IND TO WEBITM-SHIP-ALN-IND.          18830068
188400     MOVE PV-WEBITM-BRKBL-IND    TO WEBITM-BRKBL-IND.             18840068
188500     MOVE PV-WEBITM-GC-IND       TO WEBITM-GC-IND.                18850068
188600     MOVE PV-WEBITM-HAZDS-IND    TO WEBITM-HAZDS-IND.             18860068
188700*jpl - set dimensions source to 'S'(SYSTEM GENERATED).            18870068
188800     MOVE 'S'                    TO WEBITM-SHIP-DIM-SRC-CDE.      18880068
188900     MOVE PV-WEBITM-CRE-BY-USR-ID    TO WEBITM-CRE-BY-USR-ID.     18890068
189000     MOVE 'N'                      TO WEBITM-WEB-ITM-DLTD-IND.    18900068
189100                                                                  18910068
189200* BEGIN MODIFACTION BY CRAIG KEHOE AND MARJ HOEFS -- JANUARY 2008 18920068
189300*  For clarity, changed                                           18930068
189400*  IF WEBITM-WEB-EXCLV-IND = 'Y' or 'N' ...                       18940068
189500*  to                                                             18950068
189600*  IF WEBITM-WEB-EXCLV-IND = 'Y' ...                              18960068
189700     IF WEBITM-WEB-EXCLV-IND = 'Y'                                18970068
189800         CONTINUE                                                 18980068
189900     ELSE                                                         18990068
190000         MOVE 'N' TO WEBITM-WEB-EXCLV-IND                         19000068
190100     END-IF.                                                      19010068
190200* Whereas twebitm knows whether an item is a direct ship item     19020068
190300* via the ship_gp_seq_nbr field, wmos does not know whether an    19030068
190400* item is a direct ship item.                                     19040068
190500* Therefore, item updates coming from wmos via the cubiscan       19050068
190600* upload cannot directly update a twebitm's ship_gp_seq_nbr,      19060068
190700* ship_srvc_seq_nbr, ship_srchg_fee_amt, ship_rstrc_seq_nbr       19070068
190800* or gft_wrap_avl_ind attributes.                                 19080068
190900* Instead, what this modification does is to look at the          19090068
191000* twebitm's existing ship_gp_seq_nbr which is equal the           19100068
191100* current value of webitm-ship-gp-seq-nbr.                        19110068
191200* If webitm-ship-gp-seq-nbr is already set to 13 (meaning         19120068
191300* the item is already defined as a direct ship item), then        19130068
191400* do nothing.  Otherwise, call new paragraph to set the attribs.  19140068
191500     IF WEBITM-SHIP-GP-SEQ-NBR NOT = 13                           19150068
191600         PERFORM 6506-NON-DIRECT-SHIP-PROCESS                     19160068
191700     END-IF.                                                      19170068
191800* END MODIFACTION BY CRAIG KEHOE AND MARJ HOEFS -- JANUARY 2008   19180068
191900******************************************************************19190068
192000* OPEN SEQNBR                                                     19200068
192100****************************************************************  19210068
192200 6501-OPEN-SEQNBR.                                                19220068
192300                                                                  19230068
192400     EXEC SQL                                                     19240068
192500          OPEN SEQNBR                                             19250068
192600     END-EXEC.                                                    19260068
192700                                                                  19270068
192800     EVALUATE TRUE                                                19280068
192900         WHEN SQLCODE = ZERO                                      19290068
193000            CONTINUE                                              19300068
193100         WHEN OTHER                                               19310068
193200            SET PS-ROLLBACK-DB2-YES TO TRUE                       19320068
193300            MOVE SQLCODE         TO PV-DISP-SQLCODE               19330068
193400            INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                19340068
193500            SET WS027-SQL-ERROR        TO TRUE                    19350068
193600            MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME              19360068
193700            MOVE '6501'         TO WS027-ERROR-PARA-NBR           19370068
193800            MOVE 'SEQNBR OPEN CUSR ERROR'                         19380068
193900                                 TO WS027-ERROR-DESC-TXT          19390068
194000            MOVE SQLCODE         TO WS027-SQLCODE                 19400068
194100            MOVE 'PIX TRANS TYPE:'                                19410068
194200                              TO WS027-FORMAT-RECORD(1:15)        19420068
194300            MOVE PV-TRANSACTION-TYPE                              19430068
194400                              TO WS027-FORMAT-RECORD(16:03)       19440068
194500            MOVE 'PIX TRANS CODE:'                                19450068
194600                              TO WS027-FORMAT-RECORD(19:15)       19460068
194700            MOVE PV-TRANSACTION-CODE                              19470068
194800                              TO WS027-FORMAT-RECORD(34:03)       19480068
194900            MOVE DCLTEGPNBR   TO WS027-FORMAT-RECORD(37:220)      19490068
195000            PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                  19500068
195100     END-EVALUATE.                                                19510068
195200******************************************************************19520068
195300* FETCH SEQNBR                                                    19530068
195400******************************************************************19540068
195500 6502-FETCH-SEQNBR.                                               19550068
195600                                                                  19560068
195700     EXEC SQL                                                     19570068
195800          FETCH SEQNBR                                            19580068
195900          INTO                                                    19590068
196000             :EGPNBR-NEXT-SEQ-NBR                                 19600068
196100     END-EXEC.                                                    19610068
196200                                                                  19620068
196300     EVALUATE TRUE                                                19630068
196400         WHEN SQLCODE = 0                                         19640068
196500            MOVE EGPNBR-NEXT-SEQ-NBR TO WEBITM-PRD-GP-NBR         19650068
196600            ADD 1 TO EGPNBR-NEXT-SEQ-NBR                          19660068
196700            PERFORM 6504-SET-NEXT-SEQ-NBR                         19670068
196800         WHEN SQLCODE = 100                                       19680068
196900            SET PS-SEQNBR-AT-END-YES TO TRUE                      19690068
197000         WHEN OTHER                                               19700068
197100            SET PS-ROLLBACK-DB2-YES TO TRUE                       19710068
197200            MOVE SQLCODE         TO PV-DISP-SQLCODE               19720068
197300            INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                19730068
197400            SET WS027-SQL-ERROR        TO TRUE                    19740068
197500            MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME              19750068
197600            MOVE '6502'         TO WS027-ERROR-PARA-NBR           19760068
197700            MOVE 'FETCH SEQNBR CUSR ERROR'                        19770068
197800                                 TO WS027-ERROR-DESC-TXT          19780068
197900            MOVE SQLCODE         TO WS027-SQLCODE                 19790068
198000            MOVE 'PIX TRANS TYPE:'                                19800068
198100                              TO WS027-FORMAT-RECORD(1:15)        19810068
198200            MOVE PV-TRANSACTION-TYPE                              19820068
198300                              TO WS027-FORMAT-RECORD(16:03)       19830068
198400            MOVE 'PIX TRANS CODE:'                                19840068
198500                              TO WS027-FORMAT-RECORD(19:15)       19850068
198600            MOVE PV-TRANSACTION-CODE                              19860068
198700                              TO WS027-FORMAT-RECORD(34:03)       19870068
198800            MOVE DCLTEGPNBR   TO WS027-FORMAT-RECORD(37:220)      19880068
198900            PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                  19890068
199000     END-EVALUATE.                                                19900068
199100******************************************************************19910068
199200* CLOSE SEQNBR                                                    19920068
199300******************************************************************19930068
199400 6503-CLOSE-SEQNBR.                                               19940068
199500                                                                  19950068
199600     EXEC SQL                                                     19960068
199700          CLOSE SEQNBR                                            19970068
199800     END-EXEC.                                                    19980068
199900     EVALUATE TRUE                                                19990068
200000         WHEN SQLCODE = 0                                         20000068
200100            CONTINUE                                              20010068
200200         WHEN OTHER                                               20020068
200300            SET PS-ROLLBACK-DB2-YES TO TRUE                       20030068
200400            MOVE SQLCODE         TO PV-DISP-SQLCODE               20040068
200500            INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                20050068
200600            SET WS027-SQL-ERROR        TO TRUE                    20060068
200700            MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME              20070068
200800            MOVE '6502'         TO WS027-ERROR-PARA-NBR           20080068
200900            MOVE 'CLOSE SEQNBR CUSR ERROR'                        20090068
201000                                 TO WS027-ERROR-DESC-TXT          20100068
201100            MOVE SQLCODE         TO WS027-SQLCODE                 20110068
201200            MOVE 'PIX TRANS TYPE:'                                20120068
201300                              TO WS027-FORMAT-RECORD(1:15)        20130068
201400            MOVE PV-TRANSACTION-TYPE                              20140068
201500                              TO WS027-FORMAT-RECORD(16:03)       20150068
201600            MOVE 'PIX TRANS CODE:'                                20160068
201700                              TO WS027-FORMAT-RECORD(19:15)       20170068
201800            MOVE PV-TRANSACTION-CODE                              20180068
201900                              TO WS027-FORMAT-RECORD(34:03)       20190068
202000            MOVE DCLTEGPNBR   TO WS027-FORMAT-RECORD(37:220)      20200068
202100            PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                  20210068
202200     END-EVALUATE.                                                20220068
202300******************************************************************20230068
202400* SET-NEXT-SEQ-NBR                                                20240068
202500******************************************************************20250068
202600 6504-SET-NEXT-SEQ-NBR.                                           20260068
202700                                                                  20270068
202800     PERFORM WITH TEST AFTER                                      20280068
202900             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 20290068
203000             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         20300068
203100                     SQLCODE = ZERO                               20310068
203200       EXEC SQL                                                   20320068
203300        UPDATE TEGPNBR                                            20330068
203400         SET NEXT_SEQ_NBR = :EGPNBR-NEXT-SEQ-NBR                  20340068
203500         WHERE CURRENT OF SEQNBR                                  20350068
203600       END-EXEC                                                   20360068
203700                                                                  20370068
203800       EVALUATE TRUE                                              20380068
203900           WHEN SQLCODE = 0                                       20390068
204000              CONTINUE                                            20400068
204100           WHEN OTHER                                             20410068
204200              SET PS-ROLLBACK-DB2-YES TO TRUE                     20420068
204300              MOVE SQLCODE         TO PV-DISP-SQLCODE             20430068
204400              INITIALIZE WS027-RECEIPT-PIX-ERROR-REC              20440068
204500              SET WS027-SQL-ERROR        TO TRUE                  20450068
204600              MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME            20460068
204700              MOVE '6504'         TO WS027-ERROR-PARA-NBR         20470068
204800              MOVE 'TEGPNBR UPDATE ERROR'                         20480068
204900                                   TO WS027-ERROR-DESC-TXT        20490068
205000              MOVE SQLCODE         TO WS027-SQLCODE               20500068
205100              MOVE 'PIX TRANS TYPE:'                              20510068
205200                                TO WS027-FORMAT-RECORD(1:15)      20520068
205300              MOVE PV-TRANSACTION-TYPE                            20530068
205400                                TO WS027-FORMAT-RECORD(16:03)     20540068
205500              MOVE 'PIX TRANS CODE:'                              20550068
205600                                TO WS027-FORMAT-RECORD(19:15)     20560068
205700              MOVE PV-TRANSACTION-CODE                            20570068
205800                                TO WS027-FORMAT-RECORD(34:03)     20580068
205900              MOVE DCLTEGPNBR   TO WS027-FORMAT-RECORD(37:220)    20590068
206000              PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                20600068
206100       END-EVALUATE                                               20610068
206200     END-PERFORM.                                                 20620068
206300                                                                  20630068
206400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    20640068
206500         SQLCODE NOT = ZERO                                       20650068
206600        SET PS-ROLLBACK-DB2-YES TO TRUE                           20660068
206700        MOVE SQLCODE         TO PV-DISP-SQLCODE                   20670068
206800        INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                    20680068
206900        SET WS027-SQL-ERROR        TO TRUE                        20690068
207000        MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME                  20700068
207100        MOVE '6502'         TO WS027-ERROR-PARA-NBR               20710068
207200        MOVE 'TEGPNBR SELECT RETRY ERROR'                         20720068
207300                             TO WS027-ERROR-DESC-TXT              20730068
207400        MOVE SQLCODE         TO WS027-SQLCODE                     20740068
207500        MOVE 'PIX TRANS TYPE:'                                    20750068
207600                          TO WS027-FORMAT-RECORD(1:15)            20760068
207700        MOVE PV-TRANSACTION-TYPE                                  20770068
207800                          TO WS027-FORMAT-RECORD(16:03)           20780068
207900        MOVE 'PIX TRANS CODE:'                                    20790068
208000                          TO WS027-FORMAT-RECORD(19:15)           20800068
208100        MOVE PV-TRANSACTION-CODE                                  20810068
208200                          TO WS027-FORMAT-RECORD(34:03)           20820068
208300        MOVE DCLTEGPNBR   TO WS027-FORMAT-RECORD(37:220)          20830068
208400        PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                      20840068
208500     END-IF.                                                      20850068
208600******************************************************************20860068
208700* SET ASRT BEG AND END DTE                                        20870068
208800******************************************************************20880068
208900 6505-SET-ASRT-DTE.                                               20890068
209000     EXEC SQL                                                     20900068
209100        SET :WEBITM-ASRT-BEG-DTE = CURRENT DATE                   20910068
209200     END-EXEC                                                     20920068
209300     EVALUATE TRUE                                                20930068
209400         WHEN SQLCODE = 0                                         20940068
209500            CONTINUE                                              20950068
209600         WHEN OTHER                                               20960068
209700            SET PS-ROLLBACK-DB2-YES TO TRUE                       20970068
209800            MOVE SQLCODE         TO PV-DISP-SQLCODE               20980068
209900            INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                20990068
210000            SET WS027-SQL-ERROR        TO TRUE                    21000068
210100            MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME              21010068
210200            MOVE '6505'         TO WS027-ERROR-PARA-NBR           21020068
210300            MOVE 'DATE FOR WEBITM-ASRT-BEG-DTE'                   21030068
210400                                 TO WS027-ERROR-DESC-TXT          21040068
210500            MOVE SQLCODE         TO WS027-SQLCODE                 21050068
210600            MOVE 'PIX TRANS TYPE:'                                21060068
210700                              TO WS027-FORMAT-RECORD(1:15)        21070068
210800            MOVE PV-TRANSACTION-TYPE                              21080068
210900                              TO WS027-FORMAT-RECORD(16:03)       21090068
211000            MOVE 'PIX TRANS CODE:'                                21100068
211100                              TO WS027-FORMAT-RECORD(19:15)       21110068
211200            MOVE PV-TRANSACTION-CODE                              21120068
211300                              TO WS027-FORMAT-RECORD(34:03)       21130068
211400            MOVE SPACES       TO WS027-FORMAT-RECORD(37:220)      21140068
211500            PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                  21150068
211600     END-EVALUATE.                                                21160068
211700     EXEC SQL                                                     21170068
211800        SET :WEBITM-ASRT-END-DTE = CURRENT DATE + 6 MONTHS        21180068
211900     END-EXEC                                                     21190068
212000     EVALUATE TRUE                                                21200068
212100         WHEN SQLCODE = 0                                         21210068
212200            CONTINUE                                              21220068
212300         WHEN OTHER                                               21230068
212400            SET PS-ROLLBACK-DB2-YES TO TRUE                       21240068
212500            MOVE SQLCODE         TO PV-DISP-SQLCODE               21250068
212600            INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                21260068
212700            SET WS027-SQL-ERROR        TO TRUE                    21270068
212800            MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME              21280068
212900            MOVE '6505'         TO WS027-ERROR-PARA-NBR           21290068
213000            MOVE 'DATE FOR WEBITM-ASRT-END-DTE'                   21300068
213100                                 TO WS027-ERROR-DESC-TXT          21310068
213200            MOVE SQLCODE         TO WS027-SQLCODE                 21320068
213300            MOVE 'PIX TRANS TYPE:'                                21330068
213400                              TO WS027-FORMAT-RECORD(1:15)        21340068
213500            MOVE PV-TRANSACTION-TYPE                              21350068
213600                              TO WS027-FORMAT-RECORD(16:03)       21360068
213700            MOVE 'PIX TRANS CODE:'                                21370068
213800                              TO WS027-FORMAT-RECORD(19:15)       21380068
213900            MOVE PV-TRANSACTION-CODE                              21390068
214000                              TO WS027-FORMAT-RECORD(34:03)       21400068
214100            MOVE SPACES       TO WS027-FORMAT-RECORD(37:220)      21410068
214200            PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                  21420068
214300     END-EVALUATE.                                                21430068
214400******************************************************************21440068
214500* BEGIN MODIFACTION BY CRAIG KEHOE AND MARJ HOEFS -- JANUARY 2008 21450068
214600 6506-NON-DIRECT-SHIP-PROCESS.                                    21460068
214700     MOVE PV-WEBITM-GFT-WRAP-AVL-IND TO WEBITM-GFT-WRAP-AVL-IND.  21470068
214800***  MOVE PV-WEBITM-SHIP-SRCHG-FEE-AMT                            21480068
214900***                                 TO WEBITM-SHIP-SRCHG-FEE-AMT. 21490068
215000     IF PV-WEBITM-HAZDS-IND = 'Y'                                 21500068
HOEFS1* 4/30/2018 CHANGED RESTRICTION FOR HAZARDOUS ITEMS FROM "1"      21501081
HOEFS1* (HAZ) TO "2" (PO/APO RESTRICT) BECAUSE ATG DIDN'T RECOGNIZE 1.  21502080
HOEFS1         MOVE 2               TO WEBITM-SHIP-RSTRC-SEQ-NBR        21510079
215200     ELSE                                                         21520068
215300         MOVE PV-WEBITM-SHIP-RSTRC-SEQ-NBR                        21530068
215400                          TO WEBITM-SHIP-RSTRC-SEQ-NBR            21540068
215500     END-IF.                                                      21550068
215600* Derive a new value for webitm-ship-gp-nbr by                    21560068
215700* setting it to 6 if pv-webitm-gc-ind = y (meaning it is a        21570068
215800* gift-card item) else                                            21580068
215900* setting it to 4 ifpv-webitm-brkbl-ind = y (meaning it is a      21590068
216000* breakable item) else                                            21600068
216100* setting it to 2 if pv-webitm-ship-aln-ind = y (meaning it is    21610068
216200* a "ship-alone" item) else                                       21620068
216300* setting it to 1 (meaning it is an unrestricted item).           21630068
216400     EVALUATE TRUE                                                21640068
216500         WHEN PV-WEBITM-GC-IND  = 'Y'                             21650068
216600             MOVE 6                  TO WEBITM-SHIP-GP-SEQ-NBR    21660068
216700         WHEN PV-WEBITM-BRKBL-IND = 'Y'                           21670068
216800             MOVE 4                  TO WEBITM-SHIP-GP-SEQ-NBR    21680068
216900         WHEN PV-WEBITM-SHIP-ALN-IND = 'Y'                        21690068
217000             MOVE 2                  TO WEBITM-SHIP-GP-SEQ-NBR    21700068
217100         WHEN OTHER                                               21710068
217200             MOVE 1                  TO WEBITM-SHIP-GP-SEQ-NBR    21720068
217300     END-EVALUATE.                                                21730068
217400     PERFORM 6700-ASSIGN-SHIP-SERVICE.                            21740068
217500* END MODIFACTION BY CRAIG KEHOE AND MARJ HOEFS -- JANUARY 2008   21750068
217600******************************************************************21760068
217700******************************************************************21770068
217800* ASSIGN SURCHARGE DEPENDING ON THE DEPARTMENT BASED ON SHIPPING  21780068
217900* COST.                                                           21790068
218000******************************************************************21800068
218100 6600-ASSIGN-SURCHARGE.                                           21810068
218200     IF PS-DISPLAY-YES                                            21820068
218300        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   21830068
218400        DISPLAY PV-DISP-TMST                                      21840068
218500                ' WSKUP008 - 6600-ASSIGN-SURCHARGE'               21850068
218600     END-IF.                                                      21860068
218700                                                                  21870068
218800     PERFORM 6620-CHECK-SURCHRG-DEPT.                             21880068
218900                                                                  21890068
219000     IF PS-DEPT-SURCHRG-YES                                       21900068
219100        MOVE PV-IMT00024-SHIP-COST-AMT TO PV-SC                   21910068
219200        IF PV-SC > 25.00                                          21920068
219300           MOVE PV-IMT00024-SHIP-COST-AMT                         21930068
219400                              TO PV-WEBITM-SHIP-SRCHG-FEE-AMT     21940068
219500        ELSE                                                      21950068
219600           IF PV-SC > 21.99                                       21960068
219700              MOVE 25.00      TO PV-WEBITM-SHIP-SRCHG-FEE-AMT     21970068
219800           ELSE                                                   21980068
219900              IF PV-SC > 14.99                                    21990068
220000                 MOVE 15.00   TO PV-WEBITM-SHIP-SRCHG-FEE-AMT     22000068
220100              ELSE                                                22010068
220200                 IF PV-SC >  9.99                                 22020068
220300                    MOVE  7.50 TO PV-WEBITM-SHIP-SRCHG-FEE-AMT    22030068
220400                 ELSE                                             22040068
220500                    IF PV-SC >  6.99                              22050068
220600                       MOVE  3.25 TO PV-WEBITM-SHIP-SRCHG-FEE-AMT 22060068
220700                    ELSE                                          22070068
220800                       MOVE  0.00 TO PV-WEBITM-SHIP-SRCHG-FEE-AMT 22080068
220900                    END-IF                                        22090068
221000                 END-IF                                           22100068
221100              END-IF                                              22110068
221200           END-IF                                                 22120068
221300        END-IF                                                    22130068
221400     ELSE                                                         22140068
221500        MOVE  0.00 TO PV-WEBITM-SHIP-SRCHG-FEE-AMT                22150068
221600     END-IF.                                                      22160068
221700                                                                  22170068
221800******************************************************************22180068
221900* CHECK SURCHARGE DEPT.                                           22190068
222000******************************************************************22200068
222100 6620-CHECK-SURCHRG-DEPT.                                         22210068
222200     IF PS-DISPLAY-YES                                            22220068
222300        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   22230068
222400        DISPLAY PV-DISP-TMST                                      22240068
222500                ' WSKUP008 - 6620-CHECK-SURCHRG-DEPT'             22250068
222600     END-IF.                                                      22260068
222700                                                                  22270068
222800     EXEC SQL                                                     22280068
222900        SELECT KOHLS_DEPT_NBR                                     22290068
223000          INTO :WSV00007-KOHLS-DEPT-NBR                           22300068
223100          FROM WSV_SRCHG_DEPT                                     22310068
223200         WHERE INTGRTN_TYP_CDE   = 'BYPSSURCHG'                   22320068
223300           AND KOHLS_DEPT_NBR    = :PV-DEPT                       22330068
223400           AND KOHLS_EFF_DATE    < CURRENT TIMESTAMP              22340068
223500     END-EXEC.                                                    22350068
223600                                                                  22360068
223700     EVALUATE TRUE                                                22370068
223800       WHEN SQLCODE = ZERO                                        22380068
223900           SET PS-DEPT-SURCHRG-YES TO TRUE                        22390068
224000                                                                  22400068
224100       WHEN SQLCODE = +100                                        22410068
224200           SET PS-DEPT-SURCHRG-NO  TO TRUE                        22420068
224300                                                                  22430068
224400       WHEN OTHER                                                 22440068
224500           INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 22450068
224600           SET WS027-SQL-ERROR        TO TRUE                     22460068
224700           MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME               22470068
224800           MOVE '6620-'         TO WS027-ERROR-PARA-NBR           22480068
224900           MOVE 'SELECT WSV_SRCHG_DEPT'                           22490068
225000                                TO WS027-ERROR-DESC-TXT           22500068
225100           MOVE SQLCODE         TO WS027-SQLCODE                  22510068
225200           MOVE 'PIX TRANS TYPE:' TO WS027-FORMAT-RECORD(1:15)    22520068
225300           MOVE PV-TRANSACTION-TYPE TO WS027-FORMAT-RECORD(16:03) 22530068
225400           MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(19:15)   22540068
225500           MOVE PV-TRANSACTION-CODE TO WS027-FORMAT-RECORD(34:03) 22550068
225600           MOVE 'PV-DEPT: '       TO WS027-FORMAT-RECORD(37:09)   22560068
225700           MOVE PV-DEPT           TO WS027-FORMAT-RECORD(47:04)   22570068
225800           MOVE 'WEBITM-INTR-UPC-ID: '                            22580068
225900                                  TO WS027-FORMAT-RECORD(52:20)   22590068
226000           MOVE WEBITM-INTR-UPC-ID TO WS027-FORMAT-RECORD(72:09)  22600068
226100           PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   22610068
226200     END-EVALUATE.                                                22620068
226300                                                                  22630068
226400******************************************************************22640068
226500* ASSIGN SHIPPING SERVICE CODE.                                   22650068
226600* DEFAULT TO 'NEXT DAY', CODE = 1.                                22660068
226700* SET HAZARDOUS ITEMS TO 'GROUND ONLY', CODE = 4.                 22670068
226800* SET SURCHARGE ITEMS TO 'STANDARD', CODE = 3.                    22680068
226900******************************************************************22690068
227000 6700-ASSIGN-SHIP-SERVICE.                                        22700068
227100     IF PS-DISPLAY-YES                                            22710068
227200        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   22720068
227300        DISPLAY PV-DISP-TMST                                      22730068
227400                ' WSKUP008 - 6700-ASSIGN-SHIP-SERVICE'            22740068
227500     END-IF.                                                      22750068
227600                                                                  22760068
227700     MOVE 1     TO WEBITM-SHIP-SRVC-SEQ-NBR.                      22770068
227800     IF PV-WEBITM-HAZDS-IND = 'Y'                                 22780068
227900        MOVE 4 TO WEBITM-SHIP-SRVC-SEQ-NBR                        22790068
228200     ELSE                                                         22800079
228300        MOVE PV-IMT00024-SHIP-COST-AMT TO PV-SC                   22810079
HOEFS1* 4/30/18 - STOP RESTRICTING 'NEXT DAY' BASED ON SURCHARGE        22811081
HOEFS1* BECAUSE WMOS V2012 DOESN'T STORE SURCHARGE FOR NEW ITEMS.       22812079
HOEFS1*       IF PV-SC > 6.99                                           22820079
HOEFS1*          MOVE 3 TO WEBITM-SHIP-SRVC-SEQ-NBR                     22830079
HOEFS1*       END-IF                                                    22840079
228500     END-IF.                                                      22850068
228600                                                                  22860068
228610******************************************************************22861068
228620* SELECT WST-SRCHRG                                               22862068
228630******************************************************************22863068
228640 6800-SELECT-WST-SRCHRG.                                          22864068
228650     IF PS-DISPLAY-YES                                            22865068
228660        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   22866068
228670        DISPLAY PV-DISP-TMST                                      22867068
228680                ' WSKUP008 - 6800-SELECT-WST-SRCHRG'              22868068
228690     END-IF.                                                      22869068
228691                                                                  22869168
228692     EXEC SQL                                                     22869268
228693        SELECT INTR_UPC_ID                                        22869368
228694              ,EFF_BEG_TMST                                       22869468
228695              ,SHIP_SRCHG_FEE_AMT                                 22869568
228696              ,CUBE_SRCHG_FEE_AMT                                 22869668
228697              ,CRE_USRID                                          22869768
228698          INTO :WST00013-INTR-UPC-ID                              22869868
228699              ,:WST00013-EFF-BEG-TMST                             22869968
228700              ,:WST00013-SHIP-SRCHG-FEE-AMT                       22870068
228701              ,:WST00013-CUBE-SRCHG-FEE-AMT                       22870168
228702              ,:WST00013-CRE-USRID                                22870268
228703          FROM WST_SRCHRG_RECNCL                                  22870368
228704         WHERE INTR_UPC_ID  = :DK-INTR-UPC-ID                     22870468
228705           AND EFF_END_TMST IS NULL                               22870568
228706     END-EXEC.                                                    22870668
228707                                                                  22870768
228708     EVALUATE TRUE                                                22870868
228709         WHEN SQLCODE = ZERO                                      22870968
228710             IF PV-WEBITM-SHIP-SRCHG-FEE-AMT NOT EQUAL            22871068
228720                            WST00013-CUBE-SRCHG-FEE-AMT           22872068
228721                  PERFORM 6950-UPDATE-WST-SRCHRG                  22872168
228722                  MOVE PV-WEBITM-SHIP-SRCHG-FEE-AMT TO            22872268
228723                             WST00013-CUBE-SRCHG-FEE-AMT          22872368
228724                  PERFORM 6900-INSERT-WST-SRCHRG                  22872468
228725             END-IF                                               22872568
228726                                                                  22872668
228727         WHEN SQLCODE = +100                                      22872768
228728             MOVE PV-WEBITM-SHIP-SRCHG-FEE-AMT TO                 22872868
228729                             WST00013-CUBE-SRCHG-FEE-AMT          22872968
228730             PERFORM 6900-INSERT-WST-SRCHRG                       22873068
228731                                                                  22873168
228732          WHEN OTHER                                              22873268
228733             INITIALIZE WS027-RECEIPT-PIX-ERROR-REC               22873368
228734             SET WS027-SQL-ERROR        TO TRUE                   22873468
228735             MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME             22873568
228736             MOVE '6800-'  TO WS027-ERROR-PARA-NBR                22873668
228737             MOVE 'SELECT WST_SRCHRG_RECNCL'                      22873768
228738                                TO WS027-ERROR-DESC-TXT           22873868
228739             MOVE SQLCODE         TO WS027-SQLCODE                22873968
228740             MOVE 'PIX TRANS TYPE:'                               22874068
228750                                  TO WS027-FORMAT-RECORD(1:15)    22875068
228760             MOVE PV-TRANSACTION-TYPE                             22876068
228770                                    TO WS027-FORMAT-RECORD(16:03) 22877068
228771             MOVE 'PIX TRANS CODE:'                               22877168
228772                                  TO WS027-FORMAT-RECORD(19:15)   22877268
228773             MOVE PV-TRANSACTION-CODE                             22877368
228774                                    TO WS027-FORMAT-RECORD(34:03) 22877468
228775             MOVE 'WST00013-INTR-UPC-ID: '                        22877568
228776                                 TO WS027-FORMAT-RECORD(52:20)    22877668
228777             MOVE WST00013-INTR-UPC-ID                            22877768
228778                                     TO WS027-FORMAT-RECORD(72:09)22877868
228779             PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                 22877968
228780             SET PS-ROLLBACK-DB2-YES TO TRUE                      22878068
228781     END-EVALUATE.                                                22878168
228782                                                                  22878268
228783******************************************************************22878368
228784* INSERT WST-SRCHRG                                               22878468
228785******************************************************************22878568
228786 6900-INSERT-WST-SRCHRG.                                          22878668
228787     IF PS-DISPLAY-YES                                            22878768
228788        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   22878868
228789        DISPLAY PV-DISP-TMST                                      22878968
228790                ' WSKUP008 - 6900-INSERT-WST-SRCHRG'              22879068
228791     END-IF.                                                      22879168
228792                                                                  22879268
228793     EXEC SQL                                                     22879368
228794         INSERT INTO WST_SRCHRG_RECNCL                            22879468
228795           (INTR_UPC_ID                                           22879568
228796          , EFF_BEG_TMST                                          22879668
228797          , EFF_END_TMST                                          22879768
228798          , SHIP_SRCHG_FEE_AMT                                    22879868
228799          , CUBE_SRCHG_FEE_AMT                                    22879968
228800          , CRE_USRID)                                            22880068
228810         VALUES                                                   22881068
228811           (:WEBITM-INTR-UPC-ID                                   22881168
228812          , CURRENT TIMESTAMP                                     22881268
228813          , NULL                                                  22881368
228814          , :WEBITM-SHIP-SRCHG-FEE-AMT                            22881468
228815          , :WST00013-CUBE-SRCHG-FEE-AMT                          22881568
228816          , :PC-PGM-NAME)                                         22881668
228817     END-EXEC.                                                    22881768
228818                                                                  22881868
228819     EVALUATE TRUE                                                22881968
228820          WHEN SQLCODE = ZERO                                     22882068
228821             ADD +1 TO PA-TOTAL-INSERT-WST-SRCHRG                 22882168
228822                                                                  22882268
228823          WHEN OTHER                                              22882368
228824             INITIALIZE WS027-RECEIPT-PIX-ERROR-REC               22882468
228825             SET WS027-SQL-ERROR        TO TRUE                   22882568
228826             MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME             22882668
228827             MOVE '6900-'  TO WS027-ERROR-PARA-NBR                22882768
228828             MOVE 'INSERT WST_SRCHRG_RECNCL'                      22882868
228829                                TO WS027-ERROR-DESC-TXT           22882968
228830             MOVE SQLCODE         TO WS027-SQLCODE                22883068
228831             MOVE 'PIX TRANS TYPE:'                               22883168
228832                                  TO WS027-FORMAT-RECORD(1:15)    22883268
228833             MOVE PV-TRANSACTION-TYPE                             22883368
228834                                    TO WS027-FORMAT-RECORD(16:03) 22883468
228835             MOVE 'PIX TRANS CODE:'                               22883568
228836                                  TO WS027-FORMAT-RECORD(19:15)   22883668
228837             MOVE PV-TRANSACTION-CODE                             22883768
228838                                    TO WS027-FORMAT-RECORD(34:03) 22883868
228839             MOVE 'WST00013-INTR-UPC-ID: '                        22883968
228840                                 TO WS027-FORMAT-RECORD(52:20)    22884068
228841             MOVE WST00013-INTR-UPC-ID                            22884168
228842                                     TO WS027-FORMAT-RECORD(72:09)22884268
228843             PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                 22884368
228844             SET PS-ROLLBACK-DB2-YES TO TRUE                      22884468
228845     END-EVALUATE.                                                22884568
228846                                                                  22884668
228847******************************************************************22884768
228848*         UPDATE WST_SRCHRG_RECNCL WITH EFF_END_TMST              22884868
228849******************************************************************22884968
228850 6950-UPDATE-WST-SRCHRG.                                          22885068
228860     IF PS-DISPLAY-YES                                            22886068
228861        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   22886168
228862        DISPLAY PV-DISP-TMST                                      22886268
228863                ' WSKUP008 - 6950-UPDATE-WST-SRCHRG'              22886368
228864     END-IF.                                                      22886468
228865                                                                  22886568
228866         EXEC SQL                                                 22886668
228867             UPDATE WST_SRCHRG_RECNCL                             22886768
228868                SET EFF_END_TMST   = CURRENT TIMESTAMP            22886868
228869              WHERE INTR_UPC_ID    = :DK-INTR-UPC-ID              22886968
228870                AND EFF_END_TMST     IS NULL                      22887068
228880         END-EXEC                                                 22888068
228881                                                                  22888168
228882         EVALUATE TRUE                                            22888268
228883           WHEN SQLCODE = ZERO                                    22888368
228884               ADD +1 TO PA-TOTAL-UPDATE-WST-SRCHRG               22888468
228885                                                                  22888568
228886           WHEN SQLCODE = -803                                    22888668
228887               CONTINUE                                           22888768
228888                                                                  22888868
228889           WHEN OTHER                                             22888968
228890              SET PS-ROLLBACK-DB2-YES TO TRUE                     22889068
228891              INITIALIZE WS027-RECEIPT-PIX-ERROR-REC              22889168
228892              SET WS027-SQL-ERROR        TO TRUE                  22889268
228893              MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME            22889368
228894              MOVE '6950-'         TO WS027-ERROR-PARA-NBR        22889468
228895              MOVE 'WST-SRCHRG UPDATE ERROR'                      22889568
228896                                   TO WS027-ERROR-DESC-TXT        22889668
228897              MOVE SQLCODE         TO WS027-SQLCODE               22889768
228898              MOVE 'PIX TRANS TYPE:'                              22889868
228899                                TO WS027-FORMAT-RECORD(1:15)      22889968
228900              MOVE PV-TRANSACTION-TYPE                            22890068
228901                                TO WS027-FORMAT-RECORD(16:03)     22890168
228902              MOVE 'PIX TRANS CODE:'                              22890268
228903                                TO WS027-FORMAT-RECORD(19:15)     22890368
228904              MOVE PV-TRANSACTION-CODE                            22890468
228905                                TO WS027-FORMAT-RECORD(34:03)     22890568
228906              MOVE DCLWST00013  TO WS027-FORMAT-RECORD(37:220)    22890668
228907              PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                22890768
228908         END-EVALUATE.                                            22890868
228909                                                                  22890968
228910******************************************************************22891068
228911*        P R O C E S S   I M T 0 0 0 2 4   T A B L E              22891168
228912******************************************************************22891268
228913* GET IMT00024 FIELDS FROM THE DATABASE.                          22891368
228914***************************************************************** 22891468
228915 7000-GET-IMT00024.                                               22891568
228916     IF PS-DISPLAY-YES                                            22891668
228917        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   22891768
228918        DISPLAY PV-DISP-TMST                                      22891868
228919                ' WSKUP008 - 7000-GET-IMT00024'                   22891968
228920     END-IF.                                                      22892068
228930                                                                  22893068
228940     EXEC SQL                                                     22894068
228950        SELECT INTR_UPC_ID                                        22895068
228960             , DC_NBR                                             22896068
228970             , EFF_BEG_TMST                                       22897068
228980             , EFF_END_TMST                                       22898068
228990             , AUTO_SORT_CDE                                      22899068
229000             , SORT_BOX_SZ_DESC                                   22900068
229100             , PICK_LOC_TYP_CDE                                   22910068
229200             , CNVYB_IND                                          22920068
229300             , BAGBL_IND                                          22930068
229400             , SHIP_COST_AMT                                      22940068
229500          INTO :IMT00024-INTR-UPC-ID                              22950068
229600             , :IMT00024-DC-NBR                                   22960068
229700             , :IMT00024-EFF-BEG-TMST                             22970068
229800             , :IMT00024-EFF-END-TMST :PV-NULL-IND-1              22980068
229900             , :IMT00024-AUTO-SORT-CDE                            22990068
230000             , :IMT00024-SORT-BOX-SZ-DESC                         23000068
230100             , :IMT00024-PICK-LOC-TYP-CDE                         23010068
230200             , :IMT00024-CNVYB-IND                                23020068
230300             , :IMT00024-BAGBL-IND                                23030068
230400             , :IMT00024-SHIP-COST-AMT                            23040068
230500          FROM IMT_ITM_DC_ASSN                                    23050068
230600         WHERE INTR_UPC_ID  = :DK-INTR-UPC-ID                     23060068
230700           AND EFF_END_TMST IS NULL                               23070068
230800     END-EXEC.                                                    23080068
230900                                                                  23090068
231000     EVALUATE TRUE                                                23100068
231100       WHEN SQLCODE = ZERO                                        23110068
231200           PERFORM 7050-CHK-TO-UPD-IMT24-OR-NOT                   23120068
231300                                                                  23130068
231400       WHEN SQLCODE = +100                                        23140068
231500           INITIALIZE DCLIMT00024                                 23150068
231600           MOVE PV-PRC-CNTL-TMST(1:10) TO IMT00024-EFF-BEG-TMST   23160068
231700                                          IMT00024-EFF-END-TMST   23170068
231800           SET PS-HAVE-IMT00024-NO TO TRUE                        23180068
231900                                                                  23190068
232000       WHEN OTHER                                                 23200068
232100           INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 23210068
232200           SET WS027-SQL-ERROR        TO TRUE                     23220068
232300           MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME               23230068
232400           MOVE '7000-'         TO WS027-ERROR-PARA-NBR           23240068
232500           MOVE 'GET IMT024 DB FIELDS ERR'                        23250068
232600                                TO WS027-ERROR-DESC-TXT           23260068
232700           MOVE SQLCODE         TO WS027-SQLCODE                  23270068
232800           MOVE 'PIX TRANS TYPE:' TO WS027-FORMAT-RECORD(1:15)    23280068
232900           MOVE PV-TRANSACTION-TYPE TO WS027-FORMAT-RECORD(16:03) 23290068
233000           MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(19:15)   23300068
233100           MOVE PV-TRANSACTION-CODE TO WS027-FORMAT-RECORD(34:03) 23310068
233200           MOVE DCLIMT00024       TO WS027-FORMAT-RECORD(37:220)  23320068
233300           PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   23330068
233400                                                                  23340068
233500     END-EVALUATE.                                                23350068
233600                                                                  23360068
233700******************************************************************23370068
233800* THE ROW EXISTS ON IMT00024. COMPARE THE FIELDS TO SEE IF ANY OF 23380068
233900* THEM HAVE CHANGED AND IF WE NEED TO UPDATE IMT00024.            23390068
234000******************************************************************23400068
234100 7050-CHK-TO-UPD-IMT24-OR-NOT.                                    23410068
234200     IF PS-DISPLAY-YES                                            23420068
234300        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   23430068
234400        DISPLAY PV-DISP-TMST                                      23440068
234500                ' WSKUP008 - 7050-CHK-TO-UPD-IMT00024-OR-NOT'     23450068
234600     END-IF.                                                      23460068
234700                                                                  23470068
234800     IF IMT00024-AUTO-SORT-CDE = PV-IMT00024-AUTO-SORT-CDE AND    23480068
234900        IMT00024-SORT-BOX-SZ-DESC =                               23490068
235000                             PV-IMT00024-SORT-BOX-SZ-DESC  AND    23500068
235100        IMT00024-PICK-LOC-TYP-CDE =                               23510068
235200                             PV-IMT00024-PICK-LOC-TYP-CDE  AND    23520068
235300        IMT00024-CNVYB-IND     = PV-IMT00024-CNVYB-IND     AND    23530068
235400        IMT00024-BAGBL-IND     = PV-IMT00024-BAGBL-IND     AND    23540068
235500        IMT00024-SHIP-COST-AMT = PV-IMT00024-SHIP-COST-AMT        23550068
235600           SET PS-SKIP-IMT00024-YES TO TRUE                       23560068
235700     ELSE                                                         23570068
235800        SET PS-HAVE-IMT00024-YES TO TRUE                          23580068
235900     END-IF.                                                      23590068
236000******************************************************************23600068
236100* UPDATE EXISTING ROW WITH THE CURRENT TIMESTAMP BEFORE ADDING THE23610068
236200* NEW ROW WITH CHANGED FIELDS.                                    23620068
236300******************************************************************23630068
236400 7100-UPDATE-IMT00024.                                            23640068
236500     IF PS-DISPLAY-YES                                            23650068
236600        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   23660068
236700        DISPLAY PV-DISP-TMST                                      23670068
236800                ' WSKUP008 - 7100-UPDATE-IMT00024'                23680068
236900     END-IF.                                                      23690068
237000                                                                  23700068
237100     EXEC SQL                                                     23710068
237200         UPDATE IMT_ITM_DC_ASSN                                   23720068
237300            SET EFF_END_TMST   = CURRENT TIMESTAMP                23730068
237400          WHERE INTR_UPC_ID    = :DK-INTR-UPC-ID                  23740068
237500            AND EFF_END_TMST  IS NULL                             23750068
237600     END-EXEC.                                                    23760068
237700                                                                  23770068
237800     EVALUATE TRUE                                                23780068
237900       WHEN SQLCODE = ZERO                                        23790068
238000           ADD +1 TO PA-TOTAL-UPDATE-IMT00024                     23800068
238100                                                                  23810068
238200       WHEN SQLCODE = +100                                        23820068
238300           CONTINUE                                               23830068
238400                                                                  23840068
238500       WHEN OTHER                                                 23850068
238600           SET PS-ROLLBACK-DB2-YES TO TRUE                        23860068
238700           INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 23870068
238800           SET WS027-SQL-ERROR        TO TRUE                     23880068
238900           MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME               23890068
239000           MOVE '7100-'         TO WS027-ERROR-PARA-NBR           23900068
239100           MOVE 'UPDATE IMT00024 ERROR'                           23910068
239200                                TO WS027-ERROR-DESC-TXT           23920068
239300           MOVE SQLCODE         TO WS027-SQLCODE                  23930068
239400           MOVE 'PIX TRANS TYPE:' TO WS027-FORMAT-RECORD(1:15)    23940068
239500           MOVE PV-TRANSACTION-TYPE TO WS027-FORMAT-RECORD(16:03) 23950068
239600           MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(19:15)   23960068
239700           MOVE PV-TRANSACTION-CODE TO WS027-FORMAT-RECORD(34:03) 23970068
239800           MOVE DCLIMT00024       TO WS027-FORMAT-RECORD(37:220)  23980068
239900           PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   23990068
240000     END-EVALUATE.                                                24000068
240100                                                                  24010068
240200******************************************************************24020068
240300* INSERT A ROW TO THE IMT00024 DATABASE.                          24030068
240400******************************************************************24040068
240500 7500-INSERT-IMT00024.                                            24050068
240600     IF PS-DISPLAY-YES                                            24060068
240700        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   24070068
240800        DISPLAY PV-DISP-TMST                                      24080068
240900                ' WSKUP008 - 7500-INSERT-IMT00024'                24090068
241000     END-IF.                                                      24100068
241100                                                                  24110068
241200     PERFORM 7700-LOAD-IMT00024.                                  24120068
241300                                                                  24130068
241400         EXEC SQL                                                 24140068
241500             INSERT INTO IMT_ITM_DC_ASSN                          24150068
241600                   (INTR_UPC_ID                                   24160068
241700                  , DC_NBR                                        24170068
241800                  , EFF_BEG_TMST                                  24180068
241900                  , EFF_END_TMST                                  24190068
242000                  , AUTO_SORT_CDE                                 24200068
242100                  , SORT_BOX_SZ_DESC                              24210068
242200                  , PICK_LOC_TYP_CDE                              24220068
242300                  , CNVYB_IND                                     24230068
242400                  , BAGBL_IND                                     24240068
242500                  , SHIP_COST_AMT)                                24250068
242600             VALUES                                               24260068
242700                   (:IMT00024-INTR-UPC-ID                         24270068
242800                  , :IMT00024-DC-NBR                              24280068
242900                  , CURRENT TIMESTAMP                             24290068
243000                  , NULL                                          24300068
243100                  , :IMT00024-AUTO-SORT-CDE                       24310068
243200                  , :IMT00024-SORT-BOX-SZ-DESC                    24320068
243300                  , :IMT00024-PICK-LOC-TYP-CDE                    24330068
243400                  , :IMT00024-CNVYB-IND                           24340068
243500                  , :IMT00024-BAGBL-IND                           24350068
243600                  , :IMT00024-SHIP-COST-AMT)                      24360068
243700         END-EXEC                                                 24370068
243800                                                                  24380068
243900         EVALUATE TRUE                                            24390068
244000           WHEN SQLCODE = ZERO                                    24400068
244100               ADD +1 TO PA-TOTAL-INSERT-IMT00024                 24410068
244200*              PERFORM 7550-COMMIT-IMT00024                       24420068
244300                                                                  24430068
244400           WHEN SQLCODE = -803                                    24440068
244500               CONTINUE                                           24450068
244600                                                                  24460068
244700           WHEN OTHER                                             24470068
244800               SET PS-ROLLBACK-DB2-YES TO TRUE                    24480068
244900               INITIALIZE WS027-RECEIPT-PIX-ERROR-REC             24490068
245000               SET WS027-SQL-ERROR        TO TRUE                 24500068
245100               MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME           24510068
245200               MOVE '7500-'         TO WS027-ERROR-PARA-NBR       24520068
245300               MOVE 'INSERT IMT00024 ERROR'                       24530068
245400                                    TO WS027-ERROR-DESC-TXT       24540068
245500               MOVE SQLCODE         TO WS027-SQLCODE              24550068
245600               MOVE 'PIX TRANS TYPE:' TO WS027-FORMAT-RECORD(1:15)24560068
245700               MOVE PV-TRANSACTION-TYPE                           24570068
245800                                    TO WS027-FORMAT-RECORD(16:03) 24580068
245900               MOVE 'PIX TRANS CODE:'                             24590068
246000                                    TO WS027-FORMAT-RECORD(19:15) 24600068
246100               MOVE PV-TRANSACTION-CODE                           24610068
246200                                    TO WS027-FORMAT-RECORD(34:03) 24620068
246300               MOVE DCLIMT00024     TO WS027-FORMAT-RECORD(37:220)24630068
246400               PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT               24640068
246500         END-EVALUATE.                                            24650068
246600                                                                  24660068
246700******************************************************************24670068
246800* LOAD IMT00024 FIELDS.                                           24680068
246900* IMT00024-EFF-BEG-TMST IS CURRENT DATE                           24690068
247000* IMT00024-EFF-END-TMST IS NULLS                                  24700068
247100******************************************************************24710068
247200 7700-LOAD-IMT00024.                                              24720068
247300     IF PS-DISPLAY-YES                                            24730068
247400        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   24740068
247500        DISPLAY PV-DISP-TMST                                      24750068
247600                ' WSKUP008 - 7700-LOAD-IMT00024'                  24760068
247700     END-IF.                                                      24770068
247800                                                                  24780068
247900     MOVE DK-INTR-UPC-ID    TO IMT00024-INTR-UPC-ID.              24790068
248000     MOVE PV-DC-NUMBER-NUMERIC TO IMT00024-DC-NBR.                24800068
248100     MOVE PV-IMT00024-AUTO-SORT-CDE                               24810068
248200                            TO IMT00024-AUTO-SORT-CDE.            24820068
248300     MOVE PV-IMT00024-SORT-BOX-SZ-DESC                            24830068
248400                            TO IMT00024-SORT-BOX-SZ-DESC.         24840068
248500     MOVE PV-IMT00024-PICK-LOC-TYP-CDE                            24850068
248600                            TO IMT00024-PICK-LOC-TYP-CDE.         24860068
248700     MOVE PV-IMT00024-CNVYB-IND TO IMT00024-CNVYB-IND.            24870068
248800     MOVE PV-IMT00024-BAGBL-IND TO IMT00024-BAGBL-IND.            24880068
248900     MOVE PV-IMT00024-SHIP-COST-AMT TO IMT00024-SHIP-COST-AMT.    24890068
249000                                                                  24900068
249100******************************************************************24910068
249200** COMMITTED RECORDS WILL REMAIN IN DB2 TABLES AFTER AN ABEND.    24920068
249300******************************************************************24930068
249400*7550-COMMIT-IMT00024.                                            24940068
249500*    IMT_ITM_DC_ASSN                                              24950068
249600*    IF PS-DISPLAY-YES                                            24960068
249700*       DISPLAY 'WSKUP008 - 7550-COMMIT-IMT00024.'                24970068
249800*    END-IF.                                                      24980068
249900*                                                                 24990068
250000*    EXEC SQL                                                     25000068
250100*        COMMIT                                                   25010068
250200*    END-EXEC.                                                    25020068
250300*                                                                 25030068
250400*    EVALUATE TRUE                                                25040068
250500*        WHEN SQLCODE EQUAL ZERO                                  25050068
250600*          ADD +1 TO PA-TOTAL-IMT00024-DB2-COMMITS                25060068
250700*        WHEN SQLWARN0 NOT EQUAL SPACE                            25070068
250800*        WHEN SQLCODE NOT EQUAL ZERO                              25080068
250900*          INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 25090068
251000*          SET WS027-SQL-ERROR        TO TRUE                     25100068
251100*          MOVE PC-PGM-NAME     TO WS027-ERROR-PGM-NAME           25110068
251200*          MOVE SPACES          TO WS027-ERROR-COPYBOOK           25120068
251300*          MOVE '7550-'         TO WS027-ERROR-PARA-NBR           25130068
251400*          MOVE 'IMT00024 DB2 COMMIT FAILED'                      25140068
251500*                               TO WS027-ERROR-DESC-TXT           25150068
251600*          MOVE SQLCODE         TO WS027-SQLCODE                  25160068
251700*          MOVE 'PIX TRANS TYPE:' TO WS027-FORMAT-RECORD(1:15)    25170068
251800*          MOVE PV-TRANSACTION-TYPE                               25180068
251900*                                 TO WS027-FORMAT-RECORD(16:03)   25190068
252000*          MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(19:15)   25200068
252100*          MOVE PV-TRANSACTION-CODE                               25210068
252200*                                 TO WS027-FORMAT-RECORD(34:03)   25220068
252300*          MOVE DCLIMT00024     TO WS027-FORMAT-RECORD(37:220)    25230068
252400*          PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   25240068
252500*                                                                 25250068
252600*    END-EVALUATE.                                                25260068
252700                                                                  25270068
252800 7800-ROLLBACK-DB2.                                               25280068
252900                                                                  25290068
253000     IF PS-DISPLAY-YES                                            25300068
253100        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   25310068
253200        DISPLAY PV-DISP-TMST                                      25320068
253300                ' WSKUP008 - 7800-ROLLBACK-DB2'                   25330068
253400     END-IF.                                                      25340068
253500                                                                  25350068
253600     EXEC SQL                                                     25360068
253700         ROLLBACK                                                 25370068
253800     END-EXEC.                                                    25380068
253900                                                                  25390068
254000     EVALUATE TRUE                                                25400068
254100         WHEN SQLCODE EQUAL ZERO                                  25410068
254200           ADD +1 TO PA-TOTAL-DB2-ROLLBACKS                       25420068
254300         WHEN SQLWARN0 NOT EQUAL SPACE                            25430068
254400         WHEN SQLCODE NOT EQUAL ZERO                              25440068
254500           INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 25450068
254600           SET WS027-SQL-ERROR        TO TRUE                     25460068
254700           MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME               25470068
254800           MOVE '7800-'         TO WS027-ERROR-PARA-NBR           25480068
254900           MOVE 'ROLLBACK DB2 ERROR   '                           25490068
255000                                TO WS027-ERROR-DESC-TXT           25500068
255100           MOVE SQLCODE         TO WS027-SQLCODE                  25510068
255200           MOVE 'PIX TRANS TYPE:' TO WS027-FORMAT-RECORD(1:15)    25520068
255300           MOVE PV-TRANSACTION-TYPE TO WS027-FORMAT-RECORD(16:03) 25530068
255400           MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(19:15)   25540068
255500           MOVE PV-TRANSACTION-CODE TO WS027-FORMAT-RECORD(34:03) 25550068
255600           MOVE DCLIMT00024       TO WS027-FORMAT-RECORD(37:220)  25560068
255700           PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   25570068
255800     END-EVALUATE.                                                25580068
255900                                                                  25590068
256000 7850-COMMIT.                                                     25600068
256100                                                                  25610068
256200     IF PS-DISPLAY-YES                                            25620068
256300        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   25630068
256400        DISPLAY PV-DISP-TMST                                      25640068
256500                ' WSKUP008 - 7850-COMMIT'                         25650068
256600     END-IF.                                                      25660068
256700                                                                  25670068
256800     EXEC SQL                                                     25680068
256900         COMMIT                                                   25690068
257000     END-EXEC.                                                    25700068
257100                                                                  25710068
257200     EVALUATE TRUE                                                25720068
257300         WHEN SQLCODE EQUAL ZERO                                  25730068
257400           ADD +1 TO PA-TOTAL-DB2-COMMITS                         25740068
257500         WHEN SQLWARN0 NOT EQUAL SPACE                            25750068
257600         WHEN SQLCODE NOT EQUAL ZERO                              25760068
257700           INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 25770068
257800           SET WS027-SQL-ERROR        TO TRUE                     25780068
257900           MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME               25790068
258000           MOVE '7700-'         TO WS027-ERROR-PARA-NBR           25800068
258100           MOVE 'COMMIT DB2 ERROR   '                             25810068
258200                                TO WS027-ERROR-DESC-TXT           25820068
258300           MOVE SQLCODE         TO WS027-SQLCODE                  25830068
258400           MOVE 'PIX TRANS TYPE:' TO WS027-FORMAT-RECORD(1:15)    25840068
258500           MOVE PV-TRANSACTION-TYPE TO WS027-FORMAT-RECORD(16:03) 25850068
258600           MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(19:15)   25860068
258700           MOVE PV-TRANSACTION-CODE TO WS027-FORMAT-RECORD(34:03) 25870068
258800           MOVE DCLIMT00024       TO WS027-FORMAT-RECORD(37:220)  25880068
258900           PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   25890068
259000     END-EVALUATE.                                                25900068
259100                                                                  25910068
259200******************************************************************25920068
259300***************************************************************** 25930068
259400* WRITE OUTGOING ERROR MQ MESSAGE.                                25940068
259500***************************************************************** 25950068
259600 8000-WRITE-MQ-ERROR-MESG-OUT.                                    25960068
259700     IF PS-DISPLAY-YES                                            25970068
259800        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   25980068
259900        DISPLAY PV-DISP-TMST                                      25990068
260000                ' WSKUP008 - 8000-WRITE-MQ-ERROR-MESG-OUT'        26000068
260100     END-IF.                                                      26010068
260200                                                                  26020068
260300     PERFORM 8100-PUT-MQ-ERROR-MESG-ON-QUE.                       26030068
260400     SET PS-ERROR-REC-WRITTEN-YES TO TRUE                         26040068
260500                                                                  26050068
260600     INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                       26060068
260700                PV-SKU                                            26070068
260800                PV-SC                                             26080068
260900                DCLTWEBITM                                        26090068
261000                DCLIMT00024                                       26100068
261100                DCLWSV00005                                       26110068
261200                DCLWST00013                                       26120068
261300                DCLWSV00006.                                      26130068
261400                                                                  26140068
261500***************************************************************** 26150068
261600* PUT ERROR MQ MESSAGE ON QUEUE.                                  26160068
261700***************************************************************** 26170068
261800 8100-PUT-MQ-ERROR-MESG-ON-QUE.                                   26180068
261900     IF PS-DISPLAY-YES                                            26190068
262000        EXEC SQL SET :PV-DISP-TMST = CURRENT TIMESTAMP END-EXEC   26200068
262100        DISPLAY PV-DISP-TMST                                      26210068
262200                ' WSKUP008 - 8100-PUT-MQ-ERROR-MESG-ON-QUE'       26220068
262300     END-IF.                                                      26230068
262400                                                                  26240068
262500     MOVE MQFMT-STRING     TO MQMD-FORMAT.                        26250068
262600     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   26260068
262700     COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT +                  26270068
262800                               MQPMO-SET-IDENTITY-CONTEXT.        26280068
262900                                                                  26290068
263000     MOVE +1055 TO PV-MSG-LENGTH.                                 26300068
263100     MOVE WS027-RECEIPT-PIX-ERROR-REC TO PV-ERRMSGBUFFER.         26310068
263200                                                                  26320068
263300     CALL PC-MQPUT USING PV-HCONN                                 26330068
263400                         PV-HANDLE-ERROR                          26340068
263500                         MQM-MESSAGE-DESCRIPTOR                   26350068
263600                         MQM-PUT-MESSAGE-OPTIONS                  26360068
263700                         PV-MSG-LENGTH                            26370068
263800                         PV-ERRMSGBUFFER(1:PV-MSG-LENGTH)         26380068
263900                         PV-COMPLETION-CODE                       26390068
264000                         PV-REASON.                               26400068
264100                                                                  26410068
264200*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         26420068
264300*AND BREAK OUT OF LOOP                                            26430068
264400     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        26440068
264500         IF PS-DISPLAY-YES                                        26450068
264600            DISPLAY 'MQ MESSAGE = ', PV-ERRMSGBUFFER              26460068
264700         END-IF                                                   26470068
264800         MOVE '8100-PUT-MQ-MESG-ON-QUEUE' TO PV-PARAGRAPH         26480068
264900         MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE         26490068
265000         ADD +1 TO PA-TOTAL-ERRORS-PROCESSED                      26500068
265100         PERFORM 9001-MQSERIES-ERROR                              26510068
265200     ELSE                                                         26520068
265300         ADD 1 TO PA-TOTAL-MQ-ERROR-MSGS-SENT                     26530068
265400     END-IF.                                                      26540068
265500                                                                  26550068
265600***************************************************************** 26560068
265700* WRAP-UP AND DISPLAY SUMMARY TOTALS.                             26570068
265800***************************************************************** 26580068
265900 9300-WRAPUP.                                                     26590068
266000     DISPLAY 'WSKUP008 - 9300-WRAPUP. '                           26600068
266100     DISPLAY '************************************************'.  26610068
266200     DISPLAY '     * WSKUP008 SUMMARY STATISTICS *            '   26620068
266300     DISPLAY '     *    PROCESS CUBISCAN         *         '      26630068
266400                                                                  26640068
266500     MOVE PA-TOTAL-MQ-PIX-MSGS-READ TO PV-DISP-NBR                26650068
266600     DISPLAY ' TOTAL MQ PIX MESSAGES READ        :'               26660068
266700                        PV-DISP-NBR                               26670068
266800                                                                  26680068
266900     MOVE PA-999-STOP-PROC-MESSAGES TO PV-DISP-NBR                26690068
267000     DISPLAY ' 999 STOP PROCESSING MESSAGES READ :'               26700068
267100                        PV-DISP-NBR                               26710068
267200                                                                  26720068
267300     MOVE PA-TOTAL-MQ-ERROR-MSGS-SENT TO PV-DISP-NBR              26730068
267400     DISPLAY ' TOTAL MQ ERROR MESSAGES SENT      :'               26740068
267500                          PV-DISP-NBR                             26750068
267600                                                                  26760068
267700     MOVE PA-TOTAL-ERRORS-PROCESSED   TO PV-DISP-NBR              26770068
267800     DISPLAY ' TOTAL ERRORS PROCESSED            :'               26780068
267900                        PV-DISP-NBR                               26790068
268000                                                                  26800068
268100     MOVE PA-TOTAL-UPDATE-IMT00024    TO PV-DISP-NBR              26810068
268200     DISPLAY ' TOTAL IMT00024 RECORDS UPDATED    :'               26820068
268300                        PV-DISP-NBR                               26830068
268400                                                                  26840068
268500     MOVE PA-TOTAL-INSERT-IMT00024    TO PV-DISP-NBR              26850068
268600     DISPLAY ' TOTAL IMT00024 RECORDS INSERTED   :'               26860068
268700                        PV-DISP-NBR                               26870068
268800                                                                  26880068
268900     MOVE PA-TOTAL-DB2-COMMITS  TO PV-DISP-NBR                    26890068
269000     DISPLAY ' TOTAL DB2 COMMITS DONE            :'               26900068
269100                        PV-DISP-NBR                               26910068
269200                                                                  26920068
269300     MOVE PA-TOTAL-INSERT-TVSRSVN TO PV-DISP-NBR                  26930068
269400     DISPLAY ' TOTAL WEBITEM INSERT RESERVATION  :'               26940068
269500                        PV-DISP-NBR                               26950068
269600                                                                  26960068
269700     MOVE PA-TOTAL-DELETE-TVSRSVN TO PV-DISP-NBR                  26970068
269800     DISPLAY ' TOTAL WEBITEM DELETE RESERVATION  :'               26980068
269900                        PV-DISP-NBR                               26990068
270000                                                                  27000068
270100     MOVE PA-TOTAL-UPDATE-TWEBITM TO PV-DISP-NBR                  27010068
270200     DISPLAY ' TOTAL WEBITEM RECORDS UPDATED     :'               27020068
270300                        PV-DISP-NBR                               27030068
270400                                                                  27040068
270500     MOVE PA-TOTAL-INSERT-TWEBITM TO PV-DISP-NBR                  27050068
270600     DISPLAY ' TOTAL WEBITEM RECORDS INSERTED    :'               27060068
270700                        PV-DISP-NBR                               27070068
270800                                                                  27080068
270900     MOVE PA-TOTAL-UPDATE-WST-SRCHRG    TO PV-DISP-NBR            27090068
271000     DISPLAY ' TOTAL WST-SRCHRG RECORDS UPDATED  :'               27100068
271100                        PV-DISP-NBR                               27110068
271200                                                                  27120068
271300     MOVE PA-TOTAL-INSERT-WST-SRCHRG    TO PV-DISP-NBR            27130068
271400     DISPLAY ' TOTAL WST-SRCHRG RECORDS INSERTED :'               27140068
271500                        PV-DISP-NBR                               27150068
271600                                                                  27160068
271700                                                                  27170068
271800     DISPLAY ' '                                                  27180068
271900     DISPLAY '************************************************'.  27190068
272000                                                                  27200068
272100 9500-ABEND.                                                      27210068
272200     DISPLAY 'WSKUP008 - 9500-ABEND.                   '.         27220068
272300                                                                  27230068
272400     DISPLAY '** ABEND        **'.                                27240068
272500     DISPLAY '** PROGRAM      ** = ' PC-PGM-NAME.                 27250068
272600     DISPLAY '** PARAGRAPH    ** = ' PV-PARAGRAPH.                27260068
272700                                                                  27270068
272800     CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        27280068
272900                                                                  27290068
273000                                                                  27300068
273100     COPY ISPD002.                                                27310068
273200     COPY ISPD007.                                                27320068
273300     COPY ISPD008.                                                27330068
273400     COPY ISPD009.                                                27340068
