000100******************************************************************00010099
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SVKRP029.                                00050099
000600 AUTHOR.                 GREGORY B SHEFF.                         00060032
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            SEPTEMBER 2002.                          00080099
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*                                                                 00120000
001300*  CREATE WEEKLY VOID AND STATUS CHANGE REPORTS                   00130099
001400******************************************************************00140099
001500 ENVIRONMENT DIVISION.                                            00150099
001600******************************************************************00160099
001700                                                                  00170099
001800 CONFIGURATION SECTION.                                           00180099
001900                                                                  00190099
002000 SOURCE-COMPUTER.        IBM-3090.                                00200099
002100 OBJECT-COMPUTER.        IBM-3090.                                00210099
002200                                                                  00220099
002300 INPUT-OUTPUT SECTION.                                            00230099
002400                                                                  00240099
002500 FILE-CONTROL.                                                    00250099
002600     SELECT DATE-CARD-FILE                                        00260099
002700         ASSIGN TO INP01.                                         00270099
002800                                                                  00280099
002900     SELECT STATUS-REPORT                                         00290099
003000         ASSIGN TO RPT01.                                         00300099
003100                                                                  00310099
003200     SELECT INACTIVE-STATUS-REPORT                                00320099
003300         ASSIGN TO RPT02.                                         00330099
003400                                                                  00340099
003500******************************************************************00350099
003600 DATA DIVISION.                                                   00360099
003700******************************************************************00370099
003800                                                                  00380099
003900 FILE SECTION.                                                    00390099
004000                                                                  00400099
004100 FD  DATE-CARD-FILE                                               00410099
004200     RECORDING MODE IS F                                          00420099
004300     BLOCK CONTAINS 0 RECORDS                                     00430099
004400     LABEL RECORDS ARE STANDARD.                                  00440099
004500                                                                  00450099
004600 01  DATE-CARD-RECORD                       PIC X(80).            00460099
004700                                                                  00470099
004800 FD  STATUS-REPORT                                                00480099
004900     RECORDING MODE IS F                                          00490099
005000     LABEL RECORDS ARE STANDARD                                   00500099
005100     BLOCK CONTAINS 0 RECORDS.                                    00510099
005200                                                                  00520099
005300 01  STATUS-LINE                            PIC X(200).           00530099
005400                                                                  00540099
005500 FD  INACTIVE-STATUS-REPORT                                       00550099
005600     RECORDING MODE IS F                                          00560099
005700     LABEL RECORDS ARE STANDARD                                   00570099
005800     BLOCK CONTAINS 0 RECORDS.                                    00580099
005900                                                                  00590099
006000 01  INACTIVE-STATUS-LINE                   PIC X(200).           00600099
006100                                                                  00610099
006200******************************************************************00620099
006300 WORKING-STORAGE SECTION.                                         00630099
006400******************************************************************00640099
006500                                                                  00650099
006600******************************************************************00660099
006700* STORED VALUE CARD CONSTANTS                                     00670099
006800******************************************************************00680099
006900     COPY SVWS004.                                                00690099
007000                                                                  00700099
007100*  KOHL'S STANDARD REPORT HEADER FOR 132 COLUMN REPORT            00710099
007200                                                                  00720099
007300     COPY DPWS200O.                                               00730099
007400                                                                  00740099
007500 01  HL2-HEADING-LINE-2.                                          00750099
007600     05  FILLER                       PIC  X(36)  VALUE SPACES.   00760099
007700     05  FILLER                       PIC  X(55)  VALUE           00770099
007800         '    KOHLS STORED VALUE CARD VOIDS AND STATUS CHANGES'.  00780099
007900     05  FILLER                       PIC  X(41)  VALUE SPACES.   00790099
008000                                                                  00800099
008100 01  HL2-HEADING-LINE-2A.                                         00810099
008200     05  FILLER                       PIC  X(36)  VALUE SPACES.   00820099
008300     05  FILLER                       PIC  X(55)  VALUE           00830099
008400         '    KOHLS STORED VALUE CARD INACTIVE STATUS CHANGES'.   00840099
008500     05  FILLER                       PIC  X(41)  VALUE SPACES.   00850099
008600                                                                  00860099
008700 01  HL3-HEADING-LINE-3.                                          00870099
008800     05  FILLER                       PIC  X(36)  VALUE SPACES.   00880099
008900     05  FILLER                       PIC  X(29)  VALUE           00890099
009000         '             FOR WEEK ENDING '.                         00900099
009100     05  FILLER                       PIC  X(01)  VALUE SPACES.   00910099
009200     05  HL3-DATE                     PIC  X(10)  VALUE SPACES.   00920099
009300     05  FILLER                       PIC  X(29)  VALUE SPACES.   00930099
009400                                                                  00940099
009500 01  HL4-HEADING-LINE-4.                                          00950099
009600     05  FILLER                       PIC  X(01)  VALUE SPACE.    00960099
009700     05  FILLER                       PIC  X(08)  VALUE           00970099
009800         'USER ID '.                                              00980099
009900     05  FILLER                       PIC  X(02)  VALUE SPACE.    00990099
010000     05  FILLER                       PIC  X(12)  VALUE           01000099
010100         '  CARD ID   '.                                          01010099
010200     05  FILLER                       PIC  X(02)  VALUE SPACE.    01020099
010300     05  FILLER                       PIC  X(10)  VALUE           01030099
010400         '   DATE   '.                                            01040099
010500     05  FILLER                       PIC  X(02)  VALUE SPACE.    01050099
010600     05  FILLER                       PIC  X(10)  VALUE           01060099
010700         '  STATUS  '.                                            01070099
010800     05  FILLER                       PIC  X(02)  VALUE SPACE.    01080099
010900     05  FILLER                       PIC  X(05)  VALUE           01090099
011000         'STORE'.                                                 01100099
011100     05  FILLER                       PIC  X(02)  VALUE SPACE.    01110099
011200     05  FILLER                       PIC  X(04)  VALUE           01120099
011300         'TERM'.                                                  01130099
011400     05  FILLER                       PIC  X(02)  VALUE SPACE.    01140099
011500     05  FILLER                       PIC  X(04)  VALUE           01150099
011600         'TRAN'.                                                  01160099
011700     05  FILLER                       PIC  X(02)  VALUE SPACE.    01170099
011800     05  FILLER                       PIC  X(10)  VALUE           01180099
011900         '  AMOUNT  '.                                            01190099
012000     05  FILLER                       PIC  X(02)  VALUE SPACE.    01200099
012100     05  FILLER                       PIC  X(07)  VALUE           01210099
012200         'ACTVTY'.                                                01220099
012300     05  FILLER                       PIC  X(03)  VALUE SPACE.    01230099
012400     05  FILLER                       PIC  X(10)  VALUE           01240099
012500         '  BALANCE '.                                            01250099
012600     05  FILLER                       PIC  X(02)  VALUE SPACE.    01260099
012700     05  FILLER                       PIC  X(30)  VALUE           01270099
012800         '           COMMENTS           '.                        01280099
012900                                                                  01290099
013000 01  DL1-DETAIL-LINE.                                             01300099
013100     05  FILLER                       PIC  X(01)  VALUE SPACE.    01310099
013200     05  DL1-USR-ID                   PIC  X(08).                 01320099
013300     05  FILLER                       PIC  X(02)  VALUE SPACE.    01330099
013400     05  DL1-CRD-NBR                  PIC  ZZ9(10).               01340099
013500     05  FILLER                       PIC  X(02)  VALUE SPACE.    01350099
013600     05  DL1-CHG-DTE                  PIC  X(10).                 01360099
013700     05  FILLER                       PIC  X(02)  VALUE SPACE.    01370099
013800     05  DL1-CRD-STATUS               PIC  X(10)  VALUE SPACE.    01380099
013900     05  FILLER                       PIC  X(02)  VALUE SPACE.    01390099
014000     05  DL1-STR-NBR                  PIC  Z(04)9.                01400099
014100     05  FILLER                       PIC  X(02)  VALUE SPACE.    01410099
014200     05  DL1-TRMNL                    PIC  Z(03)9.                01420099
014300     05  FILLER                       PIC  X(02)  VALUE SPACE.    01430099
014400     05  DL1-TRN-NBR                  PIC  Z(03)9.                01440099
014500     05  FILLER                       PIC  X(02)  VALUE SPACE.    01450099
014600     05  DL1-APP-AUTH-AMT             PIC  ZZ,ZZZ.ZZ-.            01460099
014700     05  FILLER                       PIC  X(02)  VALUE SPACE.    01470099
014800     05  DL1-ACTIVITY                 PIC  X(07)  VALUE SPACE.    01480099
014900     05  FILLER                       PIC  X(03)  VALUE SPACE.    01490099
015000     05  DL1-BALANCE                  PIC  ZZ,ZZZ.ZZ-.            01500099
015100     05  FILLER                       PIC  X(02)  VALUE SPACE.    01510099
015200     05  DL1-COMMENT                  PIC  X(65).                 01520099
015300                                                                  01530099
015400 01  DL3-TOTAL-LINE.                                              01540099
015500     05  FILLER                       PIC  X(01)  VALUE SPACE.    01550099
015600     05  FILLER                       PIC  X(21)  VALUE           01560099
015700         'TOTALS      CARDS:   '.                                 01570099
015800     05  TL3-STATUS-CNT               PIC  ZZ,ZZ9.                01580099
015900     05  FILLER                       PIC  X(37)  VALUE SPACE.    01590099
016000     05  TL3-STATUS-AMT               PIC  Z,ZZZ,ZZZ.ZZ-.         01600099
016100     05  FILLER                       PIC  X(09)  VALUE SPACE.    01610099
016200     05  TL3-STATUS-BAL               PIC  Z,ZZZ,ZZZ.ZZ-.         01620099
016300     05  FILLER                       PIC  X(29)  VALUE SPACE.    01630099
016400                                                                  01640099
016500 01  DL4-NO-DATA-LINE.                                            01650099
016600     05  FILLER                       PIC  X(51)  VALUE SPACE.    01660099
016700     05  FILLER                       PIC  X(29)  VALUE           01670099
016800         '****   NO DATA SELECTED  ****'.                         01680099
016900     05  FILLER                       PIC  X(52)  VALUE SPACE.    01690099
017000                                                                  01700099
017100 01  END-OF-REPORT-LINE.                                          01710099
017200     05  FILLER                       PIC  X(51)  VALUE SPACE.    01720099
017300     05  FILLER                       PIC  X(29)  VALUE           01730099
017400         '*****   END OF REPORT   *****'.                         01740099
017500     05  FILLER                       PIC  X(52)  VALUE SPACE.    01750099
017600                                                                  01760099
017700 01  ABEND-CODE                       PIC S9(04) VALUE +0.        01770099
017800     88  ABEND-4003-CTRL-CARD-ERROR                 VALUE +4003.  01780099
017900     88  ABEND-4013-DB2-ERROR                       VALUE +4013.  01790099
018000     88  ABEND-4019-CALENDAR-ERROR                  VALUE +4019.  01800099
018100                                                                  01810099
018200******************************************************************01820099
018300*    CC-CONTROL RECORD                                           *01830099
018400******************************************************************01840099
018500 01  CC-CONTROL-RECORD.                                           01850099
018600     10  CC-CONTROL-DATE              PIC  X(08).                 01860099
018700     10  FILLER                       PIC  X(72).                 01870099
018800                                                                  01880099
018900 01  PA-PROGRAM-ACCUMULATORS.                                     01890099
019000     05  PA-SUBTOT-STAT-CNT           PIC S9(07)  COMP-3          01900099
019100                                                  VALUE ZERO.     01910099
019200     05  PA-SUBTOT-STAT-AMT           PIC S9(07)V99  COMP-3       01920099
019300                                                  VALUE ZERO.     01930099
019400     05  PA-SUBTOT-STAT-BAL           PIC S9(07)V99  COMP-3       01940099
019500                                                  VALUE ZERO.     01950099
019600     05  PA-READ-TXN-CNT              PIC S9(09)  COMP-3          01960099
019700                                                  VALUE ZERO.     01970099
019800     05  PA-READ-ACCT-CNT             PIC S9(09)  COMP-3          01980099
019900                                                      VALUE ZERO. 01990099
020000     05  PA-READ-CMNT-CNT             PIC S9(09)  COMP-3          02000099
020100                                                  VALUE ZERO.     02010099
020200     05  PA-SUM-CRD-BAL               PIC S9(7)V9(2) COMP-3       02020099
020300                                                  VALUE ZERO.     02030099
020400                                                                  02040099
020500 01  PC-PROGRAM-CONSTANTS.                                        02050034
020600     05  PC-LINES-PER-PAGE            PIC S9(04)  VALUE +60       02060099
020700                                                     COMP SYNC.   02070034
020800     05  PC-PROGRAM-NAME              PIC  X(08)  VALUE           02080099
020900                                                    'SVKRP029'.   02090099
021000 01  PS-PROGRAM-SWITCHES.                                         02100067
021100     05  PS-END-OF-CARD-FILE-SW       PIC X(01)   VALUE 'N'.      02110099
021200         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      02120075
021300     05  PS-END-OF-ACCT-CSR-SW        PIC X(01)   VALUE 'N'.      02130099
021400         88  PS-END-OF-ACCT-CSR                   VALUE 'Y'.      02140099
021500         88  PS-NOT-END-OF-ACCT-CSR               VALUE 'N'.      02150099
021600     05  PS-END-OF-CMNT-CSR-SW        PIC X(01)   VALUE 'N'.      02160099
021700         88  PS-END-OF-CMNT-CSR                   VALUE 'Y'.      02170099
021800         88  PS-NOT-END-OF-CMNT-CSR               VALUE 'N'.      02180099
021900     05  PS-END-OF-TXN-CSR-SW         PIC X(01)   VALUE 'N'.      02190099
022000         88  PS-END-OF-TXN-CSR                    VALUE 'Y'.      02200099
022100         88  PS-NOT-END-OF-TXN-CSR                VALUE 'N'.      02210099
022200     05  PS-END-OF-INACTIVE-CSR-SW    PIC X(01)   VALUE 'N'.      02220099
022300         88  PS-END-OF-INACTIVE-CSR               VALUE 'Y'.      02230099
022400         88  PS-NOT-END-OF-INACTIVE-CSR           VALUE 'N'.      02240099
022500*    ENSURES ONLY PRINT BALANCE ONE TIME W/MULTIPLE COMMENTS      02250099
022600     05  PS-PRT-CMNT-1ST-TIME-SW      PIC X(01)   VALUE 'N'.      02260099
022700         88  PS-NOT-PRT-CMNT-1ST-TIME             VALUE 'Y'.      02270099
022800         88  PS-PRT-CMNT-1ST-TIME                 VALUE 'N'.      02280099
022900*    ENSURES PRINT BALANCE ONE TIME W/MULTIPLE TRANS SAME CARD#   02290099
023000     05  PS-PRT-CRD-1ST-TIME-SW       PIC X(01)   VALUE 'N'.      02300099
023100         88  PS-NOT-PRT-CRD-1ST-TIME              VALUE 'Y'.      02310099
023200         88  PS-PRT-CRD-1ST-TIME                  VALUE 'N'.      02320099
023300*    ENSURES CHANGE GETS PRINTED EVEN IF NO COMMENTS              02330099
023400     05  PS-NOT-PRT-TRANS-SW          PIC X(01)   VALUE 'N'.      02340099
023500         88  PS-PRT-TRANS                         VALUE 'Y'.      02350099
023600         88  PS-NOT-PRT-TRANS                     VALUE 'N'.      02360099
023700*    IDICATES VOID PRINTED (THEREFORE OK TO PRINT VOID TOTALS)    02370099
023800     05  PS-PRT-NO-VOIDS-SW           PIC X(01)   VALUE 'N'.      02380099
023900         88  PS-PRT-VOIDS                         VALUE 'Y'.      02390099
024000         88  PS-PRT-NO-VOIDS                      VALUE 'N'.      02400099
024100*    IDICATES STAT CHNG PRINTED (NOW OK TO PRINT STAT CHNG TOTALS)02410099
024200     05  PS-PRT-NO-STATUS-SW          PIC X(01)   VALUE 'N'.      02420099
024300         88  PS-PRT-STATUS                        VALUE 'Y'.      02430099
024400         88  PS-PRT-NO-STATUS                     VALUE 'N'.      02440099
024500*    INDICATES INACTIVE STATUS CHANGES(OK TO PRINT TOTALS)        02450099
024600     05  PS-PRT-INACTIVE-SW           PIC X(01)   VALUE 'N'.      02460099
024700         88  PS-PRT-INACTIVE                      VALUE 'Y'.      02470099
024800         88  PS-PRT-NO-INACTIVE                   VALUE 'N'.      02480099
024900                                                                  02490067
025000 01  PV-PROGRAM-VARIABLES.                                        02500067
025100     05  PV-PAGE-COUNT                PIC S9(04)  VALUE +0        02510099
025200                                                  COMP.           02520099
025300     05  PV-LINE-COUNT                PIC S9(04)  VALUE +0        02530099
025400                                                  COMP.           02540099
025500     05  PV-PARAGRAPH-NAME            PIC  X(30)  VALUE SPACE.    02550099
025600     05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACE.    02560099
025700     05  PV-OPERATION-MSG-2           PIC  X(40)  VALUE SPACE.    02570099
025800     05  PV-CRD-NBR                   PIC  S9(12)V COMP-3.        02580099
025900     05  PV-DATE                      PIC  X(10)  VALUE SPACE.    02590099
026000                                                                  02600099
026100 01  PV-DATE-RETURNED-CALENDAR-RTN.                               02610099
026200     10  PV-1ST-DAY-OF-WK             PIC  X(10).                 02620099
026300     10  PV-LAST-DAY-OF-WK            PIC  X(10).                 02630099
026400                                                                  02640099
026500 01  SF-SAVE-FIELDS.                                              02650099
026600     05  SF-CRD-NBR                   PIC  S9(12)V COMP-3         02660099
026700                                                   VALUE ZEROES.  02670099
026800     05  SF-CRD-STAT-CDE              PIC  X(02)   VALUE 'XX'.    02680099
026900     05  SF-APP-AUTH-AMT              PIC S9(7)V9(2) COMP-3       02690099
027000                                                  VALUE ZERO.     02700099
027100                                                                  02710099
027200 01  SD-SYSTEM-DATE.                                              02720034
027300     05  SD-SYSTEM-YEAR               PIC  9(02)  VALUE ZEROS.    02730099
027400     05  SD-SYSTEM-MONTH              PIC  9(02)  VALUE ZEROS.    02740099
027500     05  SD-SYSTEM-DAY                PIC  9(02)  VALUE ZEROS.    02750099
027600                                                                  02760034
027700 01  ST-SYSTEM-TIME.                                              02770034
027800     05  ST-SYSTEM-HOUR               PIC  9(02)  VALUE ZEROS.    02780099
027900     05  ST-SYSTEM-MINUTE             PIC  9(02)  VALUE ZEROS.    02790099
028000     05  FILLER                       PIC  9(04)  VALUE ZEROS.    02800099
028100                                                                  02810099
028200******************************************************************02820034
028300* DATE ROUTINE COPY MEMBERS                                       02830034
028400******************************************************************02840034
028500     COPY DPWS500.                                                02850034
028600                                                                  02860034
028700******************************************************************02870099
028800*  DB2 ACCT TABLE                                                 02880099
028900******************************************************************02890099
029000     EXEC SQL                                                     02900099
029100        INCLUDE SVT00001                                          02910099
029200     END-EXEC.                                                    02920099
029300******************************************************************02930099
029400*  DB2 TXN  TABLE                                                 02940099
029500******************************************************************02950099
029600     EXEC SQL                                                     02960099
029700        INCLUDE SVT00002                                          02970099
029800     END-EXEC.                                                    02980099
029900******************************************************************02990099
030000*  DB2 CMNT TABLE                                                 03000099
030100******************************************************************03010099
030200     EXEC SQL                                                     03020099
030300        INCLUDE SVT00003                                          03030099
030400     END-EXEC.                                                    03040099
030500*********************************************************         03050099
030600*    SVT_KOHLS_CRD_ACCT CURSOR                                    03060099
030700*********************************************************         03070099
030800     EXEC SQL                                                     03080099
030900       DECLARE ACCT-CSR CURSOR FOR                                03090099
031000           SELECT A.CRD_NBR                                       03100099
031100                , A.CRD_STAT_CDE                                  03110099
031200                , A.CRD_STAT_CHG_DTE                              03120099
031300                , A.STAT_CHG_BY_USR_ID                            03130099
031400             FROM SVT_KOHLS_CRD_ACCT     A                        03140099
031500              WHERE   A.CRD_STAT_CHG_DTE                          03150099
031600                       BETWEEN :PV-1ST-DAY-OF-WK                  03160099
031700                           AND :PV-LAST-DAY-OF-WK                 03170099
031800             AND  (A.CRD_STAT_CDE = 'CA'                          03180099
031900              OR   A.CRD_STAT_CDE = 'EX'                          03190099
032000              OR   A.CRD_STAT_CDE = 'LS'                          03200099
032100              OR   A.CRD_STAT_CDE = 'ST')                         03210099
032200             ORDER BY A.CRD_STAT_CDE                              03220099
032300                    , A.STAT_CHG_BY_USR_ID                        03230099
032400     END-EXEC.                                                    03240099
032500*********************************************************         03250099
032600*    INACTIVE STATUS CURSOR                                       03260099
032700*********************************************************         03270099
032800     EXEC SQL                                                     03280099
032900       DECLARE INACTIVE-CSR CURSOR FOR                            03290099
033000           SELECT A.CRD_NBR                                       03300099
033100                , A.CRD_STAT_CDE                                  03310099
033200                , A.CRD_STAT_CHG_DTE                              03320099
033300                , A.STAT_CHG_BY_USR_ID                            03330099
033400             FROM SVT_KOHLS_CRD_ACCT     A                        03340099
033500              WHERE   A.CRD_STAT_CHG_DTE                          03350099
033600                       BETWEEN :PV-1ST-DAY-OF-WK                  03360099
033700                           AND :PV-LAST-DAY-OF-WK                 03370099
033800             AND  A.CRD_STAT_CDE = 'IN'                           03380099
033900             ORDER BY A.STAT_CHG_BY_USR_ID                        03390099
034000     END-EXEC.                                                    03400099
034100*********************************************************         03410099
034200*    SVT_KOHLS_CRD_TXN  CURSOR                                    03420099
034300*********************************************************         03430099
034400     EXEC SQL                                                     03440099
034500       DECLARE TXN-CSR CURSOR FOR                                 03450099
034600           SELECT T.CRD_NBR                                       03460099
034700                , T.ACTVY_TYP_CDE                                 03470099
034800                , DATE(T.TRN_AUTH_TMST)                           03480099
034900                , T.STR_NBR                                       03490099
035000                , T.POS_TRMNL_NBR                                 03500099
035100                , T.POS_TRN_NBR                                   03510099
035200                , T.APP_AUTH_AMT                                  03520099
035300                , T.APVL_USR_ID                                   03530099
035400              FROM SVT_KOHLS_CRD_TXN      T                       03540099
035500            WHERE DATE(T.TRN_AUTH_TMST)                           03550099
035600                       BETWEEN :PV-1ST-DAY-OF-WK                  03560099
035700                           AND :PV-LAST-DAY-OF-WK                 03570099
035800             AND (T.APVL_USR_ID    <> 'SYSTEM  '                  03580099
035900              AND T.APVL_USR_ID    <> 'OFFLINE '                  03590099
036000              AND T.APVL_USR_ID    <> 'VOIDAFTR'                  03600099
036100              AND T.APVL_USR_ID    <> 'SVKUP001'                  03610099
036200              AND T.APVL_USR_ID    <> '        '                  03620099
036300              AND T.APVL_USR_ID    <> 'PEPLSOFT'                  03630099
036400              AND T.TRN_RVRSL_CDE   =  1                          03640099
036500              AND T.TRN_VOID_IND    = 'Y')                        03650099
036600                 ORDER BY T.APVL_USR_ID                           03660099
036700                        , T.CRD_NBR                               03670099
036800     END-EXEC.                                                    03680099
036900*********************************************************         03690099
037000*    SVT_KOHLS_CRD_CMNT CURSOR                                    03700099
037100*********************************************************         03710099
037200     EXEC SQL                                                     03720099
037300       DECLARE CMNT-CSR CURSOR FOR                                03730099
037400           SELECT C.CMNT_TXT                                      03740099
037500              FROM SVT_CRD_ACCT_CMMT     C                        03750099
037600            WHERE DATE(C.CRE_TMST) = :PV-DATE                     03760099
037700              AND C.CRD_NBR = :PV-CRD-NBR                         03770099
037800            ORDER BY C.CRE_TMST                                   03780099
037900                   , C.CMNT_SEQ_NBR                               03790099
038000     END-EXEC.                                                    03800099
038100                                                                  03810099
038200******************************************************************03820099
038300*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            03830089
038400******************************************************************03840089
038500     COPY DPWS004.                                                03850099
038600 EJECT                                                            03860089
038700******************************************************************03870090
038800*  DB2 COMMUNICATION AREA.                                        03880090
038900******************************************************************03890090
039000     EXEC SQL                                                     03900091
039100           INCLUDE SQLCA                                          03910090
039200     END-EXEC.                                                    03920091
039300                                                                  03930089
039400******************************************************************03940034
039500 PROCEDURE DIVISION.                                              03950034
039600******************************************************************03960034
039700 0000-PROGRAM-MAINLINE.                                           03970034
039800                                                                  03980098
039900     PERFORM 1000-INITIALIZE.                                     03990066
040000                                                                  04000099
040100     PERFORM 2000-PROCESS-VOIDS.                                  04010099
040200                                                                  04020099
040300     PERFORM 2500-PROCESS-STATUS-CHNG.                            04030099
040400                                                                  04040098
040500     PERFORM 3000-PROCESS-INACTIVE-CHANGES.                       04050099
040600                                                                  04060099
040700     PERFORM 9000-EOJ-ROUTINE.                                    04070034
040800                                                                  04080034
040900     STOP RUN.                                                    04090034
041000                                                                  04100034
041100******************************************************************04110034
041200*  1000-INITIALIZE                                                04120084
041300******************************************************************04130034
041400 1000-INITIALIZE.                                                 04140034
041500                                                                  04150034
041600     OPEN INPUT  DATE-CARD-FILE                                   04160075
041700          OUTPUT STATUS-REPORT                                    04170099
041800                 INACTIVE-STATUS-REPORT.                          04180099
041900                                                                  04190034
042000     ACCEPT SD-SYSTEM-DATE  FROM DATE.                            04200034
042100     ACCEPT ST-SYSTEM-TIME  FROM TIME.                            04210034
042200                                                                  04220034
042300     MOVE SD-SYSTEM-MONTH          TO  DP200O-RUN-MONTH.          04230099
042400     MOVE SD-SYSTEM-DAY            TO  DP200O-RUN-DAY.            04240099
042500     MOVE SD-SYSTEM-YEAR           TO  DP200O-RUN-YEAR.           04250099
042600     MOVE ST-SYSTEM-HOUR           TO  DP200O-RUN-HOUR.           04260099
042700     MOVE ST-SYSTEM-MINUTE         TO  DP200O-RUN-MINUTE.         04270099
042800                                                                  04280099
042900     MOVE PC-PROGRAM-NAME          TO  DP200O-PROGRAM-NAME.       04290099
043000                                                                  04300034
043100     MOVE PC-LINES-PER-PAGE        TO  PV-LINE-COUNT.             04310034
043200                                                                  04320099
043300     PERFORM 1400-PROCESS-CONTROL-CARD.                           04330099
043400                                                                  04340098
043500***************************************************************** 04350099
043600* 1400-PROCESS-CONTROL-CARD                                       04360099
043700* READ DATE CONTROL CARD FOR FISCAL MONTH-END DATE.               04370099
043800* CALL DATE ROUTINE TO GET MAX FISCAL PERIOD.                     04380099
043900***************************************************************** 04390099
044000 1400-PROCESS-CONTROL-CARD.                                       04400099
044100                                                                  04410099
044200     PERFORM 1410-READ-CONTROL-FILE.                              04420099
044300                                                                  04430099
044400     IF PS-END-OF-CARD-FILE                                       04440099
044500         MOVE '1400-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   04450099
044600         MOVE 'CONTROL CARD MISSING    '   TO PV-OPERATION-MSG-1  04460099
044700         SET  ABEND-4003-CTRL-CARD-ERROR TO TRUE                  04470099
044800         PERFORM 9999-ABEND                                       04480099
044900     END-IF.                                                      04490099
045000                                                                  04500099
045100     DISPLAY PC-PROGRAM-NAME ' DATE FROM CONTROL FILE:  '         04510099
045200                                    CC-CONTROL-DATE.              04520099
045300     PERFORM 1420-VALIDATE-DATE.                                  04530099
045400                                                                  04540099
045500******************************************************************04550099
045600* 1410-READ-CONTROL-FILE                                          04560099
045700******************************************************************04570099
045800 1410-READ-CONTROL-FILE.                                          04580099
045900                                                                  04590099
046000     READ DATE-CARD-FILE INTO CC-CONTROL-RECORD                   04600099
046100       AT END                                                     04610099
046200           SET PS-END-OF-CARD-FILE TO TRUE.                       04620099
046300                                                                  04630099
046400******************************************************************04640099
046500*     1420-VALIDATE-DATE.                                        *04650099
046600*      VALIDATES THE DATE INPUT ON THE CONTROL FILE              *04660099
046700******************************************************************04670099
046800 1420-VALIDATE-DATE.                                              04680099
046900                                                                  04690099
047000     INITIALIZE DPG51 DPG52 DPG53                                 04700099
047100                DPG54 DPG55 DPG56.                                04710099
047200                                                                  04720099
047300     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     04730099
047400                                                                  04740099
047500*    FORMAT: MMDDCCYY                                             04750099
047600     MOVE CC-CONTROL-DATE           TO DPG52-LK-DATE-INPUT.       04760099
047700     SET DPG52-LK-DTE-GREG-CC       TO TRUE.                      04770099
047800                                                                  04780099
047900     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04790099
048000       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 04800099
048100                                                                  04810099
048200     EVALUATE TRUE                                                04820099
048300         WHEN DPG54-SEVERE-ERROR                                  04830099
048400         WHEN DPG54-DATE-INVALID                                  04840099
048500             DISPLAY ' '                                          04850099
048600             MOVE '1420-VALIDATE-DATE' TO PV-PARAGRAPH-NAME       04860099
048700             MOVE 'BAD CALENDAR CALL'  TO PV-OPERATION-MSG-1      04870099
048800             MOVE DPG54-ERROR-MESSAGE  TO PV-OPERATION-MSG-2      04880099
048900             SET  ABEND-4019-CALENDAR-ERROR TO TRUE               04890099
049000             PERFORM 9999-ABEND                                   04900099
049100     END-EVALUATE.                                                04910099
049200                                                                  04920099
049300*    FORMAT: CCYY-MM-DD                                           04930099
049400     MOVE DPG55-1ST-WKDY-DB2ISO-FMT  TO PV-1ST-DAY-OF-WK.         04940099
049500*    FORMAT: CCYY-MM-DD                                           04950099
049600     MOVE DPG55-LAST-WKDY-DB2ISO-FMT TO PV-LAST-DAY-OF-WK.        04960099
049700*    FORMAT: MM/DD/YY                                             04970099
049800     MOVE DPG55-LAST-WKDY-GREG-FMT   TO HL3-DATE.                 04980099
049900                                                                  04990099
050000     DISPLAY PC-PROGRAM-NAME ' WEEK BEGINNING DATE  '             05000099
050100                                    PV-1ST-DAY-OF-WK.             05010099
050200                                                                  05020099
050300******************************************************************05030099
050400* 2000-PROCESS-VOIDS                                              05040099
050500******************************************************************05050099
050600 2000-PROCESS-VOIDS.                                              05060099
050700                                                                  05070099
050800     PERFORM 3110-OPEN-TXN-CURSOR.                                05080099
050900                                                                  05090099
051000     PERFORM 4000-FETCH-TXN.                                      05100099
051100                                                                  05110099
051200     PERFORM 3800-PROCESS-VOIDS                                   05120099
051300        UNTIL PS-END-OF-TXN-CSR.                                  05130099
051400                                                                  05140099
051500     PERFORM 3210-CLOSE-TXN-CURSOR.                               05150099
051600                                                                  05160099
051700     IF PS-PRT-VOIDS                                              05170099
051800        MOVE PA-SUBTOT-STAT-AMT  TO TL3-STATUS-AMT                05180099
051900        PERFORM 6450-PRINT-STATUS-TOTALS                          05190099
052000     END-IF.                                                      05200099
052100                                                                  05210099
052200******************************************************************05220099
052300* 2500-PROCESS-STATUS-CHNG                                        05230099
052400******************************************************************05240034
052500 2500-PROCESS-STATUS-CHNG.                                        05250099
052600                                                                  05260099
052700     SET PS-NOT-END-OF-ACCT-CSR TO TRUE.                          05270099
052800     PERFORM 3140-OPEN-ACCT-CURSOR.                               05280099
052900                                                                  05290099
053000     MOVE ZEROES                TO TL3-STATUS-AMT.                05300099
053100     MOVE SPACES                TO DL1-DETAIL-LINE.               05310099
053200                                                                  05320099
053300     PERFORM 4500-FETCH-ACCT.                                     05330099
053400                                                                  05340099
053500     MOVE 999999999999          TO SF-CRD-NBR.                    05350099
053600     MOVE SVT00001-CRD-STAT-CDE TO SF-CRD-STAT-CDE.               05360099
053700                                                                  05370099
053800     SET PS-PRT-NO-STATUS TO TRUE.                                05380099
053900     PERFORM 3900-PROCESS-STATUS-CHNG                             05390099
054000        UNTIL PS-END-OF-ACCT-CSR.                                 05400099
054100                                                                  05410099
054200     PERFORM 3240-CLOSE-ACCT-CURSOR.                              05420099
054300                                                                  05430099
054400     IF PS-PRT-STATUS                                             05440099
054500        PERFORM 6450-PRINT-STATUS-TOTALS                          05450099
054600     ELSE                                                         05460099
054700*    IDICATES NEITHER STATUS CHANGE NOR VOIDS PRINTED.            05470099
054800*    THEREFORE PRINT HEADING AND 'NO DATA' MESSAGE.               05480099
054900        IF PS-PRT-NO-VOIDS                                        05490099
055000           PERFORM 7000-HEADINGS                                  05500099
055100           WRITE STATUS-LINE                                      05510099
055200              FROM DL4-NO-DATA-LINE                               05520099
055300                AFTER ADVANCING 2 LINES                           05530099
055400        END-IF                                                    05540099
055500     END-IF.                                                      05550099
055600                                                                  05560099
055700******************************************************************05570099
055800* 3000-PROCESS-INACTIVE-CHANGES                                   05580099
055900******************************************************************05590099
056000 3000-PROCESS-INACTIVE-CHANGES.                                   05600099
056100                                                                  05610099
056200     MOVE PC-LINES-PER-PAGE        TO  PV-LINE-COUNT.             05620099
056300     MOVE ZERO                     TO  PV-PAGE-COUNT.             05630099
056400                                                                  05640099
056500     PERFORM 8000-OPEN-INACTIVE-CURSOR                            05650099
056600                                                                  05660099
056700     MOVE ZEROES                TO TL3-STATUS-AMT.                05670099
056800     MOVE SPACES                TO DL1-DETAIL-LINE.               05680099
056900                                                                  05690099
057000     PERFORM 8100-FETCH-INACTIVE.                                 05700099
057100                                                                  05710099
057200     MOVE 999999999999          TO SF-CRD-NBR.                    05720099
057300                                                                  05730099
057400     SET PS-PRT-NO-INACTIVE TO TRUE.                              05740099
057500                                                                  05750099
057600     PERFORM 3100-PROCESS-INACTIVE                                05760099
057700        UNTIL PS-END-OF-INACTIVE-CSR.                             05770099
057800                                                                  05780099
057900     PERFORM 8200-CLOSE-INACTIVE-CURSOR.                          05790099
058000                                                                  05800099
058100     IF PS-PRT-INACTIVE                                           05810099
058200        PERFORM 6500-PRINT-INACTIVE-TOTALS                        05820099
058300     ELSE                                                         05830099
058400*    IDICATES NO INACTIVE STATUS CHANGES PRINTED                  05840099
058500*    THEREFORE PRINT HEADING AND 'NO DATA' MESSAGE.               05850099
058600           PERFORM 7100-INACTIVE-HEADINGS                         05860099
058700           WRITE INACTIVE-STATUS-LINE                             05870099
058800              FROM DL4-NO-DATA-LINE                               05880099
058900                AFTER ADVANCING 2 LINES                           05890099
059000     END-IF.                                                      05900099
059100                                                                  05910099
059200******************************************************************05920099
059300*  3100-PROCESS-INACTIVE                                          05930099
059400******************************************************************05940099
059500  3100-PROCESS-INACTIVE.                                          05950099
059600                                                                  05960099
059700     PERFORM 5500-SETUP-ACCT.                                     05970099
059800                                                                  05980099
059900     ADD 1                      TO PA-SUBTOT-STAT-CNT.            05990099
060000                                                                  06000099
060100     IF SF-CRD-NBR NOT = SVT00001-CRD-NBR                         06010099
060200        MOVE SVT00001-CRD-NBR      TO PV-CRD-NBR                  06020099
060300        PERFORM 6000-CALC-CARD-BAL                                06030099
060400        MOVE SVT00001-CRD-NBR      TO SF-CRD-NBR                  06040099
060500*    ENSURES PRINT BALANCE ONE TIME W/MULTIPLE TRANS SAME CARD#   06050099
060600        SET PS-PRT-CRD-1ST-TIME TO TRUE                           06060099
060700     END-IF.                                                      06070099
060800                                                                  06080099
060900                                                                  06090099
061000     SET PS-NOT-END-OF-CMNT-CSR TO TRUE.                          06100099
061100     PERFORM 3120-OPEN-CMNT-CURSOR.                               06110099
061200                                                                  06120099
061300     SET PS-NOT-PRT-TRANS TO TRUE.                                06130099
061400     PERFORM 4100-FETCH-CMNT.                                     06140099
061500                                                                  06150099
061600     SET PS-PRT-CMNT-1ST-TIME TO TRUE.                            06160099
061700     PERFORM 3150-INACTIVE-LOOP                                   06170099
061800        UNTIL PS-END-OF-CMNT-CSR.                                 06180099
061900                                                                  06190099
062000*    ENSURES STATUS CHANGE GETS PRINTED EVEN IF NO COMMENTS       06200099
062100     IF PS-NOT-PRT-TRANS                                          06210099
062200        MOVE SPACES TO DL1-COMMENT                                06220099
062300        PERFORM 6600-PRINT-DETAIL                                 06230099
062400     END-IF.                                                      06240099
062500                                                                  06250099
062600     PERFORM 3220-CLOSE-CMNT-CURSOR.                              06260099
062700     PERFORM 8100-FETCH-INACTIVE.                                 06270099
062800                                                                  06280099
062900******************************************************************06290099
063000 3110-OPEN-TXN-CURSOR.                                            06300099
063100                                                                  06310099
063200     EXEC SQL                                                     06320099
063300       OPEN TXN-CSR                                               06330099
063400     END-EXEC.                                                    06340099
063500     EVALUATE TRUE                                                06350099
063600       WHEN SQLCODE NOT = 0                                       06360099
063700           MOVE '3110-OPEN-TXN-CURSOR ' TO PV-PARAGRAPH-NAME      06370099
063800           MOVE 'OPEN                  '  TO PV-OPERATION-MSG-1   06380099
063900           PERFORM 9100-SQL-ABEND                                 06390099
064000     END-EVALUATE.                                                06400099
064100                                                                  06410099
064200******************************************************************06420099
064300 3120-OPEN-CMNT-CURSOR.                                           06430099
064400                                                                  06440099
064500     EXEC SQL                                                     06450099
064600       OPEN CMNT-CSR                                              06460099
064700     END-EXEC.                                                    06470099
064800                                                                  06480099
064900     EVALUATE TRUE                                                06490099
065000       WHEN SQLCODE NOT = 0                                       06500099
065100           MOVE '3120-OPEN-CMNT-CURSOR ' TO PV-PARAGRAPH-NAME     06510099
065200           MOVE 'OPEN                  '  TO PV-OPERATION-MSG-1   06520099
065300           PERFORM 9100-SQL-ABEND                                 06530099
065400     END-EVALUATE.                                                06540099
065500                                                                  06550099
065600                                                                  06560099
065700******************************************************************06570099
065800 3140-OPEN-ACCT-CURSOR.                                           06580099
065900                                                                  06590099
066000     EXEC SQL                                                     06600099
066100       OPEN ACCT-CSR                                              06610099
066200     END-EXEC.                                                    06620099
066300                                                                  06630099
066400     EVALUATE TRUE                                                06640099
066500       WHEN SQLCODE NOT = 0                                       06650099
066600           MOVE '3140-OPEN-ACCT-CURSOR ' TO PV-PARAGRAPH-NAME     06660099
066700           MOVE 'OPEN                  '  TO PV-OPERATION-MSG-1   06670099
066800           PERFORM 9100-SQL-ABEND                                 06680099
066900     END-EVALUATE.                                                06690099
067000                                                                  06700099
067100******************************************************************06710099
067200* 3150-INACTIVE-LOOP                                              06720099
067300******************************************************************06730099
067400 3150-INACTIVE-LOOP.                                              06740099
067500                                                                  06750099
067600     PERFORM 5200-SETUP-STATUS-CMNT.                              06760099
067700     PERFORM 6600-PRINT-DETAIL.                                   06770099
067800     PERFORM 4100-FETCH-CMNT.                                     06780099
067900                                                                  06790099
068000****************************************************************  06800099
068100 3210-CLOSE-TXN-CURSOR.                                           06810099
068200     EXEC SQL                                                     06820099
068300       CLOSE TXN-CSR                                              06830099
068400     END-EXEC.                                                    06840099
068500                                                                  06850099
068600     EVALUATE TRUE                                                06860099
068700       WHEN SQLCODE NOT = 0                                       06870099
068800           MOVE '3210-CLOSE-TXN-CURSOR' TO PV-PARAGRAPH-NAME      06880099
068900           MOVE 'CLOSE                 '  TO PV-OPERATION-MSG-1   06890099
069000           PERFORM 9100-SQL-ABEND                                 06900099
069100     END-EVALUATE.                                                06910099
069200                                                                  06920099
069300****************************************************************  06930099
069400 3220-CLOSE-CMNT-CURSOR.                                          06940099
069500                                                                  06950099
069600     EXEC SQL                                                     06960099
069700       CLOSE CMNT-CSR                                             06970099
069800     END-EXEC.                                                    06980099
069900                                                                  06990099
070000     EVALUATE TRUE                                                07000099
070100       WHEN SQLCODE NOT = 0                                       07010099
070200           MOVE '3220-CLOSE-CMNT-CURSOR' TO PV-PARAGRAPH-NAME     07020099
070300           MOVE 'CLOSE                 '  TO PV-OPERATION-MSG-1   07030099
070400           PERFORM 9100-SQL-ABEND                                 07040099
070500     END-EVALUATE.                                                07050099
070600                                                                  07060099
070700                                                                  07070099
070800****************************************************************  07080099
070900 3240-CLOSE-ACCT-CURSOR.                                          07090099
071000     EXEC SQL                                                     07100099
071100       CLOSE ACCT-CSR                                             07110099
071200     END-EXEC.                                                    07120099
071300                                                                  07130099
071400     EVALUATE TRUE                                                07140099
071500       WHEN SQLCODE NOT = 0                                       07150099
071600           MOVE '3240-CLOSE-ACCT-CURSOR' TO PV-PARAGRAPH-NAME     07160099
071700           MOVE 'CLOSE                 '  TO PV-OPERATION-MSG-1   07170099
071800           PERFORM 9100-SQL-ABEND                                 07180099
071900     END-EVALUATE.                                                07190099
072000                                                                  07200099
072100******************************************************************07210099
072200*  3800-PROCESS-VOIDS                                             07220099
072300******************************************************************07230099
072400  3800-PROCESS-VOIDS.                                             07240099
072500                                                                  07250099
072600     PERFORM 5000-SETUP-TXN.                                      07260099
072700                                                                  07270099
072800     IF SF-CRD-NBR NOT = SVT00002-CRD-NBR                         07280099
072900        PERFORM 6000-CALC-CARD-BAL                                07290099
073000        MOVE SVT00002-CRD-NBR TO SF-CRD-NBR                       07300099
073100*    ENSURES PRINT BALANCE ONE TIME W/MULTIPLE TRANS SAME CARD#   07310099
073200        SET PS-PRT-CRD-1ST-TIME TO TRUE                           07320099
073300     END-IF.                                                      07330099
073400                                                                  07340099
073500     SET PS-NOT-END-OF-CMNT-CSR TO TRUE.                          07350099
073600     PERFORM 3120-OPEN-CMNT-CURSOR.                               07360099
073700                                                                  07370099
073800     SET PS-NOT-PRT-TRANS TO TRUE.                                07380099
073900     PERFORM 4100-FETCH-CMNT.                                     07390099
074000                                                                  07400099
074100     SET PS-PRT-CMNT-1ST-TIME TO TRUE.                            07410099
074200     PERFORM 3850-CMNT-LOOP                                       07420099
074300        UNTIL PS-END-OF-CMNT-CSR.                                 07430099
074400                                                                  07440099
074500*    ENSURES VOID GETS PRINTED EVEN IF NO COMMENTS                07450099
074600     IF PS-NOT-PRT-TRANS                                          07460099
074700        MOVE SPACES TO DL1-COMMENT                                07470099
074800        PERFORM 6200-PRINT-VOIDS                                  07480099
074900     END-IF.                                                      07490099
075000                                                                  07500099
075100     PERFORM 3220-CLOSE-CMNT-CURSOR.                              07510099
075200     PERFORM 4000-FETCH-TXN.                                      07520099
075300                                                                  07530099
075400******************************************************************07540099
075500* 3850-CMNT-LOOP                                                  07550099
075600******************************************************************07560099
075700 3850-CMNT-LOOP.                                                  07570099
075800                                                                  07580099
075900     PERFORM 6200-PRINT-VOIDS.                                    07590099
076000     PERFORM 4100-FETCH-CMNT.                                     07600099
076100                                                                  07610099
076200******************************************************************07620099
076300*  3900-PROCESS-STATUS-CHNG                                       07630099
076400******************************************************************07640099
076500  3900-PROCESS-STATUS-CHNG.                                       07650099
076600                                                                  07660099
076700     PERFORM 5500-SETUP-ACCT.                                     07670099
076800                                                                  07680099
076900     IF SF-CRD-STAT-CDE NOT = SVT00001-CRD-STAT-CDE               07690099
077000        PERFORM 6450-PRINT-STATUS-TOTALS                          07700099
077100        ADD 1                      TO PA-SUBTOT-STAT-CNT          07710099
077200        MOVE SVT00001-CRD-STAT-CDE TO SF-CRD-STAT-CDE             07720099
077300     ELSE                                                         07730099
077400        ADD 1                      TO PA-SUBTOT-STAT-CNT          07740099
077500     END-IF.                                                      07750099
077600                                                                  07760099
077700     IF SF-CRD-NBR NOT = SVT00001-CRD-NBR                         07770099
077800        MOVE SVT00001-CRD-NBR      TO PV-CRD-NBR                  07780099
077900        PERFORM 6000-CALC-CARD-BAL                                07790099
078000        MOVE SVT00001-CRD-NBR      TO SF-CRD-NBR                  07800099
078100*    ENSURES PRINT BALANCE ONE TIME W/MULTIPLE TRANS SAME CARD#   07810099
078200        SET PS-PRT-CRD-1ST-TIME TO TRUE                           07820099
078300     END-IF.                                                      07830099
078400                                                                  07840099
078500                                                                  07850099
078600     SET PS-NOT-END-OF-CMNT-CSR TO TRUE.                          07860099
078700     PERFORM 3120-OPEN-CMNT-CURSOR.                               07870099
078800                                                                  07880099
078900     SET PS-NOT-PRT-TRANS TO TRUE.                                07890099
079000     PERFORM 4100-FETCH-CMNT.                                     07900099
079100                                                                  07910099
079200     SET PS-PRT-CMNT-1ST-TIME TO TRUE.                            07920099
079300     PERFORM 3950-STATUS-LOOP                                     07930099
079400        UNTIL PS-END-OF-CMNT-CSR.                                 07940099
079500                                                                  07950099
079600*    ENSURES STATUS CHANGE GETS PRINTED EVEN IF NO COMMENTS       07960099
079700     IF PS-NOT-PRT-TRANS                                          07970099
079800        MOVE SPACES TO DL1-COMMENT                                07980099
079900        PERFORM 6300-PRINT-DETAIL                                 07990099
080000     END-IF.                                                      08000099
080100                                                                  08010099
080200     PERFORM 3220-CLOSE-CMNT-CURSOR.                              08020099
080300     PERFORM 4500-FETCH-ACCT.                                     08030099
080400                                                                  08040099
080500******************************************************************08050099
080600* 3950-STATUS-LOOP                                                08060099
080700******************************************************************08070099
080800 3950-STATUS-LOOP.                                                08080099
080900                                                                  08090099
081000     PERFORM 5200-SETUP-STATUS-CMNT.                              08100099
081100     PERFORM 6300-PRINT-DETAIL.                                   08110099
081200     PERFORM 4100-FETCH-CMNT.                                     08120099
081300                                                                  08130099
081400******************************************************************08140099
081500* 4000-FETCH-TXN                                                  08150099
081600******************************************************************08160099
081700 4000-FETCH-TXN.                                                  08170099
081800                                                                  08180099
081900      EXEC SQL                                                    08190099
082000         FETCH TXN-CSR                                            08200099
082100           INTO   :SVT00002-CRD-NBR                               08210099
082200                , :SVT00002-ACTVY-TYP-CDE                         08220099
082300                , :PV-DATE                                        08230099
082400                , :SVT00002-STR-NBR                               08240099
082500                , :SVT00002-POS-TRMNL-NBR                         08250099
082600                , :SVT00002-POS-TRN-NBR                           08260099
082700                , :SVT00002-APP-AUTH-AMT                          08270099
082800                , :SVT00002-APVL-USR-ID                           08280099
082900      END-EXEC.                                                   08290099
083000                                                                  08300099
083100     EVALUATE TRUE                                                08310099
083200        WHEN SQLCODE = +0                                         08320099
083300             ADD 1 TO PA-READ-TXN-CNT                             08330099
083400        WHEN SQLCODE = +100                                       08340099
083500             SET PS-END-OF-TXN-CSR TO TRUE                        08350099
083600        WHEN OTHER                                                08360099
083700           MOVE '4000-FETCH-TXN       ' TO PV-PARAGRAPH-NAME      08370099
083800           MOVE 'FETCH                ' TO PV-OPERATION-MSG-1     08380099
083900           PERFORM 9100-SQL-ABEND                                 08390099
084000     END-EVALUATE.                                                08400099
084100                                                                  08410099
084200******************************************************************08420099
084300* 4100-FETCH-CMNT                                                 08430099
084400******************************************************************08440099
084500 4100-FETCH-CMNT.                                                 08450099
084600                                                                  08460099
084700      EXEC SQL                                                    08470099
084800         FETCH CMNT-CSR                                           08480099
084900           INTO   :SVT00003-CMNT-TXT                              08490099
085000      END-EXEC.                                                   08500099
085100                                                                  08510099
085200     EVALUATE TRUE                                                08520099
085300        WHEN SQLCODE = +0                                         08530099
085400             ADD 1                  TO PA-READ-CMNT-CNT           08540099
085500             MOVE SVT00003-CMNT-TXT TO DL1-COMMENT                08550099
085600        WHEN SQLCODE = +100                                       08560099
085700             SET PS-END-OF-CMNT-CSR TO TRUE                       08570099
085800        WHEN OTHER                                                08580099
085900           MOVE '4100-FETCH-CMNT       ' TO PV-PARAGRAPH-NAME     08590099
086000           MOVE 'FETCH                 ' TO PV-OPERATION-MSG-1    08600099
086100           PERFORM 9100-SQL-ABEND                                 08610099
086200     END-EVALUATE.                                                08620099
086300                                                                  08630099
086400                                                                  08640099
086500******************************************************************08650099
086600* 4500-FETCH-ACCT                                                 08660099
086700******************************************************************08670099
086800 4500-FETCH-ACCT.                                                 08680099
086900                                                                  08690099
087000      EXEC SQL                                                    08700099
087100         FETCH ACCT-CSR                                           08710099
087200           INTO   :SVT00001-CRD-NBR                               08720099
087300                , :SVT00001-CRD-STAT-CDE                          08730099
087400                , :SVT00001-CRD-STAT-CHG-DTE                      08740099
087500                , :SVT00001-STAT-CHG-BY-USR-ID                    08750099
087600      END-EXEC.                                                   08760099
087700                                                                  08770099
087800     EVALUATE TRUE                                                08780099
087900        WHEN SQLCODE = +0                                         08790099
088000             ADD 1                          TO PA-READ-ACCT-CNT   08800099
088100        WHEN SQLCODE = +100                                       08810099
088200             SET PS-END-OF-ACCT-CSR TO TRUE                       08820099
088300        WHEN OTHER                                                08830099
088400           MOVE '4500-FETCH-ACCT       ' TO PV-PARAGRAPH-NAME     08840099
088500           MOVE 'FETCH                 ' TO PV-OPERATION-MSG-1    08850099
088600           PERFORM 9100-SQL-ABEND                                 08860099
088700     END-EVALUATE.                                                08870099
088800                                                                  08880099
088900******************************************************************08890099
089000* 5000-SETUP-TXN                                                  08900099
089100******************************************************************08910099
089200 5000-SETUP-TXN.                                                  08920099
089300                                                                  08930099
089400     MOVE SVT00002-CRD-NBR        TO DL1-CRD-NBR.                 08940099
089500     MOVE PV-DATE                 TO DL1-CHG-DTE.                 08950099
089600     MOVE SVT00002-STR-NBR        TO DL1-STR-NBR.                 08960099
089700     MOVE SVT00002-POS-TRMNL-NBR  TO DL1-TRMNL.                   08970099
089800     MOVE SVT00002-POS-TRN-NBR    TO DL1-TRN-NBR.                 08980099
089900     MOVE SVT00002-APP-AUTH-AMT   TO DL1-APP-AUTH-AMT.            08990099
090000     MOVE SVT00002-APVL-USR-ID    TO DL1-USR-ID.                  09000099
090100                                                                  09010099
090200     EVALUATE SVT00002-ACTVY-TYP-CDE                              09020099
090300         WHEN SV004-ISSUE-KMRC-ACT-TYP-N                          09030099
090400              MOVE SV004-ISSUE-KMRC-SHRT-DESC     TO DL1-ACTIVITY 09040099
090500         WHEN SV004-ISSUE-GIFT-CRD-ACT-TYP-N                      09050099
090600              MOVE SV004-ISSUE-GIFT-CRD-SHRT-DESC TO DL1-ACTIVITY 09060099
090700         WHEN SV004-TENDER-ACT-TYP-N                              09070099
090800              MOVE SV004-TENDER-SHRT-DESC         TO DL1-ACTIVITY 09080099
090900         WHEN SV004-SRV-FEE-ACT-TYP-N                             09090099
091000              MOVE SV004-SRV-FEE-SHRT-DESC        TO DL1-ACTIVITY 09100099
091100     END-EVALUATE.                                                09110099
091200                                                                  09120099
091300     ADD 1 TO PA-SUBTOT-STAT-CNT.                                 09130099
091400     ADD SVT00002-APP-AUTH-AMT TO PA-SUBTOT-STAT-AMT.             09140099
091500                                                                  09150099
091600     MOVE SVT00002-CRD-NBR     TO PV-CRD-NBR.                     09160099
091700                                                                  09170099
091800******************************************************************09180099
091900* 5200-SETUP-STATUS-CMNT                                          09190099
092000******************************************************************09200099
092100 5200-SETUP-STATUS-CMNT.                                          09210099
092200                                                                  09220099
092300     MOVE SF-CRD-NBR           TO DL1-CRD-NBR.                    09230099
092400     MOVE SVT00003-CMNT-TXT    TO DL1-COMMENT.                    09240099
092500                                                                  09250099
092600******************************************************************09260099
092700* 5500-SETUP-ACCT                                                 09270099
092800******************************************************************09280099
092900 5500-SETUP-ACCT.                                                 09290099
093000                                                                  09300099
093100     MOVE SVT00001-CRD-NBR            TO DL1-CRD-NBR.             09310099
093200     MOVE SVT00001-CRD-STAT-CHG-DTE   TO DL1-CHG-DTE.             09320099
093300     MOVE SVT00001-STAT-CHG-BY-USR-ID TO DL1-USR-ID.              09330099
093400                                                                  09340099
093500     MOVE SVT00001-CRD-NBR            TO PV-CRD-NBR.              09350099
093600     MOVE SVT00001-CRD-STAT-CHG-DTE   TO PV-DATE.                 09360099
093700                                                                  09370099
093800******************************************************************09380099
093900* 6000-CALC-CARD-BAL                                              09390099
094000******************************************************************09400099
094100 6000-CALC-CARD-BAL.                                              09410099
094200                                                                  09420099
094300     EXEC SQL                                                     09430099
094400          SELECT SUM(APP_AUTH_AMT)                                09440099
094500            INTO :PA-SUM-CRD-BAL                                  09450099
094600              FROM SVT_KOHLS_CRD_TXN                              09460099
094700                   WHERE CRD_NBR  = :PV-CRD-NBR                   09470099
094800          WITH UR                                                 09480099
094900     END-EXEC.                                                    09490099
095000                                                                  09500099
095100     EVALUATE TRUE                                                09510099
095200        WHEN SQLCODE = +0                                         09520099
095300           MOVE PA-SUM-CRD-BAL TO SF-APP-AUTH-AMT                 09530099
095400           ADD  PA-SUM-CRD-BAL TO PA-SUBTOT-STAT-BAL              09540099
095500        WHEN SQLCODE = -305                                       09550099
095600*          NO ENTRY FOUND - NULL VALUE                            09560099
095700           MOVE ZEROES TO SF-APP-AUTH-AMT                         09570099
095800           MOVE ZEROES TO PA-SUM-CRD-BAL                          09580099
095900        WHEN OTHER                                                09590099
096000           MOVE '6000-CALC-CARD-BAL     ' TO PV-PARAGRAPH-NAME    09600099
096100           MOVE 'SUM                   ' TO PV-OPERATION-MSG-1    09610099
096200           PERFORM 9100-SQL-ABEND                                 09620099
096300     END-EVALUATE.                                                09630099
096400                                                                  09640099
096500******************************************************************09650041
096600* 6200-PRINT-VOIDS                                                09660099
096700******************************************************************09670041
096800 6200-PRINT-VOIDS.                                                09680099
096900                                                                  09690099
097000     MOVE SV004-VOID-LONG-DESC TO DL1-CRD-STATUS.                 09700099
097100                                                                  09710099
097200*    ONLY WANT TO PRINT BALANCE ONE TIME W/MULTIPLE COMMENTS      09720099
097300     IF PS-PRT-CMNT-1ST-TIME                                      09730099
097400        SET  PS-NOT-PRT-CMNT-1ST-TIME TO TRUE                     09740099
097500*    IDENTIFY VOID PRINTED (THEREFORE OK TO PRINT VOID TOTALS)    09750099
097600        SET  PS-PRT-VOIDS        TO TRUE                          09760099
097700*    ENSURES PRINT BALANCE ONE TIME W/MULTIPLE TRANS SAME CARD#   09770099
097800        IF PS-PRT-CRD-1ST-TIME                                    09780099
097900           MOVE SF-APP-AUTH-AMT        TO DL1-BALANCE             09790099
098000           SET PS-NOT-PRT-CRD-1ST-TIME TO TRUE                    09800099
098100        ELSE                                                      09810099
098200           MOVE ZEROES                 TO DL1-BALANCE             09820099
098300        END-IF                                                    09830099
098400     ELSE                                                         09840099
098500        MOVE ZEROES              TO DL1-APP-AUTH-AMT              09850099
098600        MOVE ZEROES              TO DL1-BALANCE                   09860099
098700     END-IF.                                                      09870099
098800                                                                  09880099
098900     ADD 2 TO PV-LINE-COUNT.                                      09890099
099000     IF PV-LINE-COUNT GREATER THAN PC-LINES-PER-PAGE              09900099
099100        PERFORM 7000-HEADINGS                                     09910099
099200     END-IF.                                                      09920099
099300                                                                  09930099
099400     WRITE STATUS-LINE                                            09940099
099500         FROM DL1-DETAIL-LINE                                     09950099
099600            AFTER ADVANCING 2 LINES.                              09960099
099700                                                                  09970099
099800     SET PS-PRT-TRANS TO TRUE.                                    09980099
099900                                                                  09990099
100000******************************************************************10000099
100100* 6300-PRINT-DETAIL                                               10010099
100200******************************************************************10020099
100300 6300-PRINT-DETAIL.                                               10030099
100400                                                                  10040099
100500     EVALUATE SVT00001-CRD-STAT-CDE                               10050099
100600         WHEN SV004-CRD-STAT-TYP-CANCELLED                        10060099
100700              MOVE SV004-CANCL-CRD-STAT-SHT-DESC TO DL1-CRD-STATUS10070099
100800         WHEN SV004-CRD-STAT-TYP-LOST                             10080099
100900              MOVE SV004-LOST-CRD-STAT-SHT-DESC  TO DL1-CRD-STATUS10090099
101000         WHEN SV004-CRD-STAT-TYP-STOLEN                           10100099
101100              MOVE SV004-STLN-CRD-STAT-SHT-DESC  TO DL1-CRD-STATUS10110099
101200         WHEN SV004-CRD-STAT-TYP-EXPIRED                          10120099
101300              MOVE SV004-EXPR-CRD-STAT-SHT-DESC  TO DL1-CRD-STATUS10130099
101400     END-EVALUATE.                                                10140099
101500                                                                  10150099
101600*    ONLY WANT TO PRINT BALANCE ONE TIME W/MULTIPLE COMMENTS      10160099
101700     IF PS-PRT-CMNT-1ST-TIME                                      10170099
101800        SET PS-NOT-PRT-CMNT-1ST-TIME TO TRUE                      10180099
101900*    IDENTIFY STAT CHNG PRINTED (NOW OK TO PRINT STAT CHNG TOTALS)10190099
102000        SET PS-PRT-STATUS       TO TRUE                           10200099
102100*    ENSURES PRINT BALANCE ONE TIME W/MULTIPLE TRANS SAME CARD#   10210099
102200        IF PS-PRT-CRD-1ST-TIME                                    10220099
102300           MOVE SF-APP-AUTH-AMT        TO DL1-BALANCE             10230099
102400           SET PS-NOT-PRT-CRD-1ST-TIME TO TRUE                    10240099
102500        ELSE                                                      10250099
102600           MOVE ZEROES                 TO DL1-BALANCE             10260099
102700        END-IF                                                    10270099
102800     ELSE                                                         10280099
102900        MOVE ZEROES TO DL1-BALANCE                                10290099
103000        MOVE ZEROES TO DL1-APP-AUTH-AMT                           10300099
103100     END-IF.                                                      10310099
103200                                                                  10320099
103300     ADD 2 TO PV-LINE-COUNT.                                      10330099
103400     IF PV-LINE-COUNT GREATER THAN PC-LINES-PER-PAGE              10340041
103500        PERFORM 7000-HEADINGS                                     10350041
103600     END-IF.                                                      10360099
103700                                                                  10370099
103800     WRITE STATUS-LINE                                            10380099
103900         FROM DL1-DETAIL-LINE                                     10390099
104000            AFTER ADVANCING 2 LINES.                              10400099
104100                                                                  10410041
104200     SET PS-PRT-TRANS TO TRUE.                                    10420099
104300                                                                  10430099
104400******************************************************************10440099
104500*  6450-PRINT-STATUS-TOTALS                                       10450099
104600******************************************************************10460099
104700 6450-PRINT-STATUS-TOTALS.                                        10470099
104800                                                                  10480099
104900     MOVE PA-SUBTOT-STAT-BAL  TO TL3-STATUS-BAL.                  10490099
105000     MOVE PA-SUBTOT-STAT-CNT  TO TL3-STATUS-CNT.                  10500099
105100                                                                  10510099
105200     ADD 3  TO PV-LINE-COUNT.                                     10520099
105300     IF PV-LINE-COUNT GREATER THAN PC-LINES-PER-PAGE              10530099
105400        PERFORM 7000-HEADINGS                                     10540099
105500     END-IF.                                                      10550099
105600                                                                  10560099
105700     WRITE STATUS-LINE                                            10570099
105800          FROM DL3-TOTAL-LINE                                     10580099
105900               AFTER ADVANCING 1 LINES.                           10590099
106000                                                                  10600099
106100     MOVE ZEROES TO PA-SUBTOT-STAT-CNT.                           10610099
106200     MOVE ZEROES TO PA-SUBTOT-STAT-AMT.                           10620099
106300     MOVE ZEROES TO PA-SUBTOT-STAT-BAL.                           10630099
106400                                                                  10640099
106500******************************************************************10650099
106600*  6500-PRINT-INACTIVE-TOTALS                                     10660099
106700******************************************************************10670099
106800 6500-PRINT-INACTIVE-TOTALS.                                      10680099
106900                                                                  10690099
107000     MOVE PA-SUBTOT-STAT-BAL  TO TL3-STATUS-BAL.                  10700099
107100     MOVE PA-SUBTOT-STAT-CNT  TO TL3-STATUS-CNT.                  10710099
107200                                                                  10720099
107300     ADD 3  TO PV-LINE-COUNT.                                     10730099
107400     IF PV-LINE-COUNT GREATER THAN PC-LINES-PER-PAGE              10740099
107500        PERFORM 7100-INACTIVE-HEADINGS                            10750099
107600     END-IF.                                                      10760099
107700                                                                  10770099
107800     WRITE INACTIVE-STATUS-LINE                                   10780099
107900          FROM DL3-TOTAL-LINE                                     10790099
108000               AFTER ADVANCING 1 LINES.                           10800099
108100                                                                  10810099
108200     MOVE ZEROES TO PA-SUBTOT-STAT-CNT.                           10820099
108300     MOVE ZEROES TO PA-SUBTOT-STAT-AMT.                           10830099
108400     MOVE ZEROES TO PA-SUBTOT-STAT-BAL.                           10840099
108500                                                                  10850099
108600******************************************************************10860099
108700* 6600-PRINT-DETAIL                                               10870099
108800******************************************************************10880099
108900 6600-PRINT-DETAIL.                                               10890099
109000                                                                  10900099
109100     MOVE SV004-INAC-CRD-STAT-SHT-DESC TO DL1-CRD-STATUS.         10910099
109200                                                                  10920099
109300*    ONLY WANT TO PRINT BALANCE ONE TIME W/MULTIPLE COMMENTS      10930099
109400     IF PS-PRT-CMNT-1ST-TIME                                      10940099
109500        SET PS-NOT-PRT-CMNT-1ST-TIME TO TRUE                      10950099
109600*    IDENTIFY INACTIVE PRINTED (NOW OK TO PRINT STAT CHNG TOTALS) 10960099
109700        SET PS-PRT-INACTIVE     TO TRUE                           10970099
109800*    ENSURES PRINT BALANCE ONE TIME W/MULTIPLE TRANS SAME CARD#   10980099
109900        IF PS-PRT-CRD-1ST-TIME                                    10990099
110000           MOVE SF-APP-AUTH-AMT        TO DL1-BALANCE             11000099
110100           SET PS-NOT-PRT-CRD-1ST-TIME TO TRUE                    11010099
110200        ELSE                                                      11020099
110300           MOVE ZEROES                 TO DL1-BALANCE             11030099
110400        END-IF                                                    11040099
110500     ELSE                                                         11050099
110600        MOVE ZEROES TO DL1-BALANCE                                11060099
110700        MOVE ZEROES TO DL1-APP-AUTH-AMT                           11070099
110800     END-IF.                                                      11080099
110900                                                                  11090099
111000     ADD 2 TO PV-LINE-COUNT.                                      11100099
111100     IF PV-LINE-COUNT GREATER THAN PC-LINES-PER-PAGE              11110099
111200        PERFORM 7100-INACTIVE-HEADINGS                            11120099
111300     END-IF.                                                      11130099
111400                                                                  11140099
111500     WRITE INACTIVE-STATUS-LINE                                   11150099
111600         FROM DL1-DETAIL-LINE                                     11160099
111700            AFTER ADVANCING 2 LINES.                              11170099
111800                                                                  11180099
111900     SET PS-PRT-TRANS TO TRUE.                                    11190099
112000                                                                  11200099
112100******************************************************************11210099
112200*  7000-HEADINGS                                                  11220084
112300******************************************************************11230034
112400 7000-HEADINGS.                                                   11240034
112500                                                                  11250034
112600     MOVE 6             TO PV-LINE-COUNT.                         11260099
112700     ADD  1             TO PV-PAGE-COUNT.                         11270099
112800     MOVE PV-PAGE-COUNT TO DP200O-PAGE-NUMBER.                    11280099
112900     MOVE 1             TO DP200O-REPORT-NUMBER.                  11290099
113000                                                                  11300034
113100     WRITE STATUS-LINE                                            11310099
113200       FROM DP200O-STANDRD-HEADER-200-COLS                        11320099
113300         AFTER ADVANCING PAGE.                                    11330034
113400                                                                  11340034
113500     WRITE STATUS-LINE                                            11350099
113600         FROM HL2-HEADING-LINE-2                                  11360034
113700         AFTER ADVANCING 1 LINES.                                 11370099
113800                                                                  11380099
113900     WRITE STATUS-LINE                                            11390099
114000         FROM HL3-HEADING-LINE-3                                  11400099
114100         AFTER ADVANCING 1 LINES.                                 11410099
114200                                                                  11420099
114300     WRITE STATUS-LINE                                            11430099
114400         FROM HL4-HEADING-LINE-4                                  11440099
114500         AFTER ADVANCING 2 LINES.                                 11450099
114600                                                                  11460099
114700     MOVE SPACES TO STATUS-LINE.                                  11470099
114800     WRITE STATUS-LINE                                            11480099
114900         AFTER ADVANCING 1 LINES.                                 11490099
115000                                                                  11500099
115100******************************************************************11510099
115200*  7100-INACTIVE-HEADINGS                                         11520099
115300******************************************************************11530099
115400 7100-INACTIVE-HEADINGS.                                          11540099
115500                                                                  11550099
115600     MOVE 6             TO PV-LINE-COUNT.                         11560099
115700     ADD  1             TO PV-PAGE-COUNT.                         11570099
115800     MOVE PV-PAGE-COUNT TO DP200O-PAGE-NUMBER.                    11580099
115900     MOVE 2             TO DP200O-REPORT-NUMBER.                  11590099
116000                                                                  11600099
116100     WRITE INACTIVE-STATUS-LINE                                   11610099
116200       FROM DP200O-STANDRD-HEADER-200-COLS                        11620099
116300         AFTER ADVANCING PAGE.                                    11630099
116400                                                                  11640099
116500     WRITE INACTIVE-STATUS-LINE                                   11650099
116600         FROM HL2-HEADING-LINE-2A                                 11660099
116700         AFTER ADVANCING 1 LINES.                                 11670099
116800                                                                  11680099
116900     WRITE INACTIVE-STATUS-LINE                                   11690099
117000         FROM HL3-HEADING-LINE-3                                  11700099
117100         AFTER ADVANCING 1 LINES.                                 11710099
117200                                                                  11720099
117300     WRITE INACTIVE-STATUS-LINE                                   11730099
117400         FROM HL4-HEADING-LINE-4                                  11740099
117500         AFTER ADVANCING 2 LINES.                                 11750099
117600                                                                  11760099
117700     MOVE SPACES TO INACTIVE-STATUS-LINE.                         11770099
117800     WRITE INACTIVE-STATUS-LINE                                   11780099
117900         AFTER ADVANCING 1 LINES.                                 11790099
118000                                                                  11800099
118100******************************************************************11810099
118200*  8000-OPEN-INACTIVE-CURSOR.                                     11820099
118300******************************************************************11830099
118400 8000-OPEN-INACTIVE-CURSOR.                                       11840099
118500                                                                  11850099
118600     EXEC SQL                                                     11860099
118700       OPEN INACTIVE-CSR                                          11870099
118800     END-EXEC.                                                    11880099
118900                                                                  11890099
119000     EVALUATE TRUE                                                11900099
119100       WHEN SQLCODE NOT = 0                                       11910099
119200           MOVE '8000-OPEN-INACTIVE-CURSOR ' TO PV-PARAGRAPH-NAME 11920099
119300           MOVE 'OPEN                  '  TO PV-OPERATION-MSG-1   11930099
119400           PERFORM 9100-SQL-ABEND                                 11940099
119500     END-EVALUATE.                                                11950099
119600                                                                  11960099
119700******************************************************************11970099
119800* 8100-FETCH-INACTIVE                                             11980099
119900******************************************************************11990099
120000 8100-FETCH-INACTIVE.                                             12000099
120100                                                                  12010099
120200      EXEC SQL                                                    12020099
120300         FETCH INACTIVE-CSR                                       12030099
120400           INTO   :SVT00001-CRD-NBR                               12040099
120500                , :SVT00001-CRD-STAT-CDE                          12050099
120600                , :SVT00001-CRD-STAT-CHG-DTE                      12060099
120700                , :SVT00001-STAT-CHG-BY-USR-ID                    12070099
120800      END-EXEC.                                                   12080099
120900                                                                  12090099
121000     EVALUATE TRUE                                                12100099
121100        WHEN SQLCODE = +0                                         12110099
121200             ADD 1                          TO PA-READ-ACCT-CNT   12120099
121300        WHEN SQLCODE = +100                                       12130099
121400             SET PS-END-OF-INACTIVE-CSR TO TRUE                   12140099
121500        WHEN OTHER                                                12150099
121600           MOVE '8100-FETCH-INACTIVE   ' TO PV-PARAGRAPH-NAME     12160099
121700           MOVE 'FETCH                 ' TO PV-OPERATION-MSG-1    12170099
121800           PERFORM 9100-SQL-ABEND                                 12180099
121900     END-EVALUATE.                                                12190099
122000                                                                  12200099
122100******************************************************************12210099
122200* 8200-CLOSE-INACTIVE CURSOR                                      12220099
122300******************************************************************12230099
122400 8200-CLOSE-INACTIVE-CURSOR.                                      12240099
122500     EXEC SQL                                                     12250099
122600       CLOSE INACTIVE-CSR                                         12260099
122700     END-EXEC.                                                    12270099
122800                                                                  12280099
122900     EVALUATE TRUE                                                12290099
123000       WHEN SQLCODE NOT = 0                                       12300099
123100           MOVE '8200-CLOSE-INACTIVE   ' TO PV-PARAGRAPH-NAME     12310099
123200           MOVE 'CLOSE                 '  TO PV-OPERATION-MSG-1   12320099
123300           PERFORM 9100-SQL-ABEND                                 12330099
123400     END-EVALUATE.                                                12340099
123500                                                                  12350099
123600******************************************************************12360034
123700* 9000-EOJ-ROUTINE  -  CLOSES ALL FILES                           12370034
123800******************************************************************12380034
123900 9000-EOJ-ROUTINE.                                                12390034
124000                                                                  12400099
124100     WRITE STATUS-LINE                                            12410099
124200        FROM END-OF-REPORT-LINE                                   12420099
124300          AFTER ADVANCING 2 LINES.                                12430099
124400                                                                  12440034
124500     WRITE INACTIVE-STATUS-LINE                                   12450099
124600        FROM END-OF-REPORT-LINE                                   12460099
124700          AFTER ADVANCING 2 LINES.                                12470099
124800                                                                  12480099
124900     CLOSE  DATE-CARD-FILE                                        12490075
125000            STATUS-REPORT                                         12500099
125100            INACTIVE-STATUS-REPORT.                               12510099
125200                                                                  12520099
125300     DISPLAY 'TXN  RECORDS READ     -  ' PA-READ-TXN-CNT.         12530099
125400     DISPLAY 'ACCT RECORDS READ     -  ' PA-READ-ACCT-CNT.        12540099
125500     DISPLAY 'CMNT RECORDS READ     -  ' PA-READ-CMNT-CNT.        12550099
125600                                                                  12560075
125700* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 12570099
125800* 9100-SQL-ERROR - PERFORMS THE ABEND FOR THE PROGRAM IN THE      12580099
125900* EVENT THAT AN SQL ERROR CODE OCCURS.                            12590099
126000* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 12600099
126100                                                                  12610099
126200 9100-SQL-ABEND.                                                  12620099
126300                                                                  12630099
126400     DISPLAY ' '.                                                 12640099
126500     DISPLAY '9100-SQL-ABEND'.                                    12650099
126600     DISPLAY '**  ABEND     **'.                                  12660099
126700     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               12670099
126800     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             12680099
126900     DISPLAY '**  OPERATION ** = ' PV-OPERATION-MSG-1.            12690099
127000                                                                  12700099
127100*                                                                 12710099
127200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    12720099
127300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         12730099
127400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     12740099
127500* FORMAT.                                                         12750099
127600*                                                                 12760099
127700     COPY DPPD004.                                                12770099
127800                                                                  12780099
127900     SET ABEND-4013-DB2-ERROR TO TRUE                             12790099
128000     CALL 'ILBOABN0' USING ABEND-CODE.                            12800099
128100                                                                  12810099
128200******************************************************************12820075
128300* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           12830075
128400******************************************************************12840075
128500 9999-ABEND.                                                      12850075
128600                                                                  12860099
128700     DISPLAY '** ABEND           **'.                             12870075
128800     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          12880084
128900     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        12890084
129000     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       12900084
129100     DISPLAY '** CAL ERROR       ** = ' PV-OPERATION-MSG-2.       12910099
129200     CALL 'ILBOABN0' USING ABEND-CODE.                            12920099
129300                                                                  12930099
