000100 IDENTIFICATION DIVISION.                                         00010095
000200 PROGRAM-ID.         SVKRP021.                                    00020095
000300 AUTHOR.             SCOTT BARTELT.                               00030095
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040095
000500 DATE-WRITTEN.       JUNE 1997.                                   00050095
000600 DATE-COMPILED.                                                   00060095
000700                                                                  00070095
000800******************************************************************00080095
000900* THIS PROGRAM WAS COPIED FROM RDKRP012                           00090095
001000******************************************************************00100095
001100* THIS PROGRAM PRODUCES EITHER A DAILY OR WEEKLY EXCEPTION RPT.  *00110095
001200* THE PURPOSE OF THIS REPORT IS TO LIST BY TENDER, OPERATOR ID,  *00120095
001300* ISSUE DATE, TERMINAL, AND TRANSACTION ALL THE GIFT CARDS WHICH *00130095
001400* WERE ISSUED AT THE STORE OR CORPORATE, FOR OVER A SPECIFIED    *00140095
001500* DOLLAR AMOUNT.                                                 *00150095
001600*                                                                *00160095
001700* THE CURSOR IS ONLY OPENED ONCE AT THE BEGINNING OF THE PROGRAM.*00170095
001800* IT SHOULD SELECT ALL GIFT CARD ID NUMBERS WHICH MEET THE GIVEN *00180095
001900* CRITERIA.                                                      *00190095
002000******************************************************************00200095
W3540C* MODIFICATION LOG:                                               00210099
W3540C* -----------------                                               00211099
W3540C*                                                                 00212099
W3540C* REQUIREMENT   : PAYMENT RELATED CHANGES FOR FSH PROJECT         00220095
W3540C* PROJECT ID    : W3540C                                          00230095
W3540C* AUTHOR        : COGNIZANT                                       00240095
W3540C* DATES CHANGED : 15-OCT-2012                                     00250095
W3540C* CHANGES MADE  : A NEW CONTROL CARD WITH LAYOUT BEGIN TIMESTAMP  00260099
W3540C* END TIMESTAMP AND RESTART INDICATOR IN FORMAT,                  00261099
W3540C* CCYY-MM-DD-HH.MM.SS.TTTTTT CCYY-MM-DD-HH.MM.SS.TTTTTT R,        00262099
W3540C* IS ADDED TO THE PROGRAM AND CORRESPONDINGLY, THE CODE           00263099
W3540C* AND THE CURSOR RELATED CHANGES ARE UPDATED.                     00290099
W3540C*                                                                 00300095
W3540C* THE CONTROL CARD SVCC102(SVK005) AND SVCC107(SVK145)            00301099
W3540C* HAS RESTART VARIABLE AT COL 55.                                 00302099
W3540C*                                                                 00303099
W3540C* NORMAL BATCH:                                                   00304099
W3540C* IF THE RESTART VARIABLE NOT 'R', THE PROGRAM WILL USE THE       00305099
W3540C* TIMESTAMP FROM CC. THE CONTROL CARD TIMESTAMP IS MOVED TO       00306099
W3540C* THE TODAY'S TIMESTAMP AND THE CURRENT SYSTEM TIMESTAMP IS MOVED 00307099
W3540C* TO TOMORROW'S TIMESTAMP AT END OF PROCESS.  DATES IN CONTROL    00308099
W3540C* CARD ARE UPDATED FOR NEXT BATCH RUN.                            00309099
W3540C*                                                                 00309199
W3540C* RERUN:                                                          00309299
W3540C* IF THE RESTART VARIABLE IS 'R', THEN THE END DATE FROM THE      00309399
W3540C* CONTROL CARD IS MOVED TO TOMORROW'S TIMESTAMP.                  00309499
W3540C* THIS TIMESTAMP IS USED IN ACTIVITY-CSR. DATES IN CONTROL CARD   00309599
W3540C* ARE NOT UPDATED.                                                00309699
W3540C******************************************************************00310095
P10237*  04/08/2015  CHANGES TO REMOVE THE TNDR_ID FIELD IN            *00311099
P10237*              ACTIVITY-CSR AS THIS FIELD IS NOT USED ANYWHERE   *00312099
P10237*              IN THE PROGRAM AS PART OF COSA DATA SECURITY      *00312199
P10237*              PROJECT.                                          *00312299
P10237*  MADE BY: COGNIZANT                   WR#: CHG0104429          *00313099
P10237******************************************************************00314099
P12431*  08/30/2018  MODIFIED THE PROGRAM TO DISPLAY THE NEWLY ADDED   *00315099
P12431*              ORD_NBR FIELD IN THE REPORT                       *00316099
P12431*  MADE BY: COGNIZANT                   WR#: CHG0208643          *00319099
P12431******************************************************************00319199
002100                                                                  00320095
002200 ENVIRONMENT DIVISION.                                            00330095
002300                                                                  00340095
002400 CONFIGURATION SECTION.                                           00350095
002500                                                                  00360095
002600 SOURCE-COMPUTER.    IBM-3090.                                    00370095
002700 OBJECT-COMPUTER.    IBM-3090.                                    00380095
002800                                                                  00390095
002900 INPUT-OUTPUT SECTION.                                            00400095
003000                                                                  00410095
003100 FILE-CONTROL.                                                    00420095
003200                                                                  00430095
003300     SELECT CONTROL-DATE-FILE         ASSIGN TO INP01.            00440095
W3540C     SELECT CONTROL-TIMESTAMP-FILE    ASSIGN TO INP02.            00450095
003400     SELECT REPORT-FILE               ASSIGN TO RPT01.            00460095
003500     SELECT DOLLAR-REPORT-FILE        ASSIGN TO RPT02.            00470095
003600                                                                  00480095
003700 DATA DIVISION.                                                   00490095
003800                                                                  00500095
003900 FILE SECTION.                                                    00510095
004000                                                                  00520095
004100 FD  CONTROL-DATE-FILE                                            00530095
004200     RECORDING MODE IS F                                          00540095
004300     BLOCK CONTAINS 0 RECORDS                                     00550095
004400     LABEL RECORDS ARE OMITTED.                                   00560095
004500                                                                  00570095
004600 01  CONTROL-DATE-RECORD              PIC X(80).                  00580095
004700                                                                  00590095
W3540C FD  CONTROL-TIMESTAMP-FILE                                       00600095
W3540C     RECORDING MODE IS F                                          00610095
W3540C     BLOCK CONTAINS 0 RECORDS                                     00620095
W3540C     LABEL RECORDS ARE OMITTED.                                   00630095
W3540C                                                                  00640095
W3540C 01  CONTROL-TIMESTAMP-RECORD         PIC X(80).                  00650095
W3540C                                                                  00660095
004800 FD  REPORT-FILE                                                  00670095
004900     RECORDING MODE IS F                                          00680095
005000     BLOCK CONTAINS 0 RECORDS                                     00690095
005100     LABEL RECORDS ARE OMITTED.                                   00700095
005200                                                                  00710095
P12431 01  REPORT-RECORD                    PIC X(200).                 00720099
005400                                                                  00730095
005500 FD  DOLLAR-REPORT-FILE                                           00740095
005600     RECORDING MODE IS F                                          00750095
005700     BLOCK CONTAINS 0 RECORDS                                     00760095
005800     LABEL RECORDS ARE OMITTED.                                   00770095
005900                                                                  00780095
P12431 01  DOLLAR-REPORT-RECORD             PIC X(200).                 00790099
006100                                                                  00800095
006200 WORKING-STORAGE SECTION.                                         00810095
006300                                                                  00820095
006400 01  ABEND-CODE                       PIC S9(04)    VALUE +0 COMP.00830095
006500                                                                  00840095
006600******************************************************************00850095
006700*    CR-CONTROL RECORD   DATE IN MMDDCCYY FORMAT                 *00860095
006800******************************************************************00870095
006900 01  CR-CONTROL-RECORD.                                           00880095
007000     05  CR-CONTROL-DATE.                                         00890095
007100         10  CR-MM                    PIC  X(02)    VALUE SPACES. 00900095
007200         10  CR-DD                    PIC  X(02)    VALUE SPACES. 00910095
007300         10  CR-CC                    PIC  X(02)    VALUE SPACES. 00920095
007400         10  CR-YY                    PIC  X(02)    VALUE SPACES. 00930095
007500     05  CR-RUN-TYPE                  PIC  X(01).                 00940095
007600         88  CR-DAILY-RUN-TYPE                      VALUE 'D'.    00950095
007700         88  CR-WEEKLY-RUN-TYPE                     VALUE 'W'.    00960095
007800         88  CR-VALID-RUN-TYPE                      VALUE 'D',    00970095
007900                                                          'W'.    00980095
008000     05  FILLER                       PIC  X(03)    VALUE SPACES. 00990095
008100     05  CR-DOLLAR-OVER-VALUE         PIC  9(04)V99 VALUE ZEROES. 01000095
008110     05  FILLER                       PIC  X(62)    VALUE SPACES. 01010095
008300                                                                  01020095
W3540C******************************************************************01030095
W3540C*               CR-CONTROL RECORD TIMESTAMP IN                   *01040095
W3540C* CCYY-MM-DD-HH.MM.SS.TTTTTT CCYY-MM-DD-HH.MM.SS.TTTTTT X        *01050095
W3540C******************************************************************01060095
W3540C 01  CR-CONTROL-RECORD1.                                          01070095
W3540C     05  CR-CONTROL-BEG-TIMESTAMP.                                01080095
W3540C         10  CR-BEG-DATE              PIC  X(10)     VALUE SPACES.01090095
W3540C         10  FILLER                   PIC  X(01)     VALUE '-'.   01100095
W3540C         10  CR-BEG-HH                PIC  X(02)     VALUE SPACES.01110095
W3540C         10  FILLER                   PIC  X(01)     VALUE '.'.   01120095
W3540C         10  CR-BEG-MN                PIC  X(02)     VALUE SPACES.01130095
W3540C         10  FILLER                   PIC  X(01)     VALUE '.'.   01140095
W3540C         10  CR-BEG-SS                PIC  X(02)     VALUE SPACES.01150095
W3540C         10  FILLER                   PIC  X(01)     VALUE '.'.   01160095
W3540C         10  CR-BEG-TTTTTT            PIC  X(06)     VALUE SPACES.01170095
W3540C     05  FILLER                       PIC  X(01)     VALUE SPACES.01180095
W3540C     05  CR-CONTROL-END-TIMESTAMP.                                01190095
W3540C         10  CR-END-DATE              PIC  X(10)     VALUE SPACES.01200095
W3540C         10  FILLER                   PIC  X(01)     VALUE '-'.   01210095
W3540C         10  CR-END-HH                PIC  X(02)     VALUE SPACES.01220095
W3540C         10  FILLER                   PIC  X(01)     VALUE '.'.   01230095
W3540C         10  CR-END-MN                PIC  X(02)     VALUE SPACES.01240095
W3540C         10  FILLER                   PIC  X(01)     VALUE '.'.   01250095
W3540C         10  CR-END-SS                PIC  X(02)     VALUE SPACES.01260095
W3540C         10  FILLER                   PIC  X(01)     VALUE '.'.   01270095
W3540C         10  CR-END-TTTTTT            PIC  X(06)     VALUE SPACES.01280095
W3540C     05  FILLER                       PIC  X(01)     VALUE SPACES.01290095
W3540C     05  CR-RESTART-IND               PIC  X(01)     VALUE SPACES.01300095
W3540C     05  FILLER                       PIC  X(25)     VALUE SPACES.01310095
W3540C                                                                  01320095
008400******************************************************************01330095
008500*    PC-PROGRAM CONSTANTS                                        *01340095
008600******************************************************************01350095
008700 01  PC-PROGRAM-CONSTANTS.                                        01360095
008800     05  PC-PROGRAM-NAME              PIC  X(08)     VALUE        01370095
008900                                                    'SVKRP021'.   01380095
009000     05  PC-HYPHEN                    PIC  X(03)     VALUE ' - '. 01390095
009100     05  PC-OPER-CO-NBR               PIC  X(02)     VALUE '03'.  01400095
009200     05  PC-ONE                       PIC  9(01)     VALUE 1.     01410095
009300     05  PC-THREE                     PIC  9(01)     VALUE 3.     01420095
009400     05  PC-FOUR                      PIC  9(01)     VALUE 4.     01430095
009500     05  PC-HEADER-LINE-COUNT         PIC S9(03)     VALUE +3     01440095
009600                                                     COMP.        01450095
009700     05  PC-MAX-LINES-PER-PAGE        PIC S9(03)     VALUE +60    01460095
009800                                                     COMP.        01470095
009900                                                                  01480095
010000******************************************************************01490095
010100*    RESPROGRAM VARIABLES                                        *01500095
010200******************************************************************01510095
010300 01  PV-PROGRAM-VARIABLES.                                        01520095
010400     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.01530095
010500     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30)     VALUE SPACES.01540095
010600                                                                  01550095
W3540C     05  PV-GREG-DATE.                                            01560095
W3540C         10  PV-GREG-MM               PIC  9(02)     VALUE ZERO.  01570095
W3540C         10  FILLER                   PIC  X(01)     VALUE '/'.   01580095
W3540C         10  PV-GREG-DD               PIC  9(02)     VALUE ZERO.  01590095
W3540C         10  FILLER                   PIC  X(01)     VALUE '/'.   01600095
W3540C         10  PV-GREG-CCYY             PIC  9(04)     VALUE ZERO.  01610095
010600                                                                  01620095
W3540C     05  PV-ISO-DATE.                                             01630095
W3540C         10  PV-ISO-CCYY              PIC  9(04)     VALUE ZERO.  01640095
W3540C         10  FILLER                   PIC  X(01)     VALUE '-'.   01650095
W3540C         10  PV-ISO-MM                PIC  9(02)     VALUE ZERO.  01660095
W3540C         10  FILLER                   PIC  X(01)     VALUE '-'.   01670095
W3540C         10  PV-ISO-DD                PIC  9(02)     VALUE ZERO.  01680095
010600                                                                  01690095
010700     05  PV-CURRENT-DATE.                                         01700095
010800         10  PV-CURRENT-YEAR          PIC  9(02)     VALUE ZERO.  01710095
010900         10  PV-CURRENT-MONTH         PIC  9(02)     VALUE ZERO.  01720095
011000         10  PV-CURRENT-DAY           PIC  9(02)     VALUE ZERO.  01730095
011100                                                                  01740095
011200     05  PV-CURRENT-TIME.                                         01750095
011300         10  PV-CURRENT-HOUR          PIC  9(02)     VALUE ZERO.  01760095
011400         10  PV-CURRENT-MINUTE        PIC  9(02)     VALUE ZERO.  01770095
011500         10  FILLER                   PIC  9(04)     VALUE ZERO.  01780095
011600                                                                  01790095
011700     05  PV-BEG-OF-WEEK-TIMESTAMP-DET.                            01800095
W3540C         10  PV-BEG-OF-WEEK-DATE      PIC  X(10)     VALUE SPACES.01810095
011900         10  FILLER                   PIC  X(01)     VALUE '-'.   01820095
W3540C         10  PV-BEG-OF-WEEK-HH        PIC  X(02)     VALUE SPACES.01830095
012100         10  FILLER                   PIC  X(01)     VALUE '.'.   01840095
W3540C         10  PV-BEG-OF-WEEK-MN        PIC  X(02)     VALUE SPACES.01850095
012300         10  FILLER                   PIC  X(01)     VALUE '.'.   01860095
W3540C         10  PV-BEG-OF-WEEK-SS        PIC  X(02)     VALUE SPACES.01870095
012500         10  FILLER                   PIC  X(01)     VALUE '.'.   01880095
W3540C         10  PV-BEG-OF-WEEK-TTTTTT    PIC  X(06)     VALUE SPACES.01890095
012800                                                                  01900095
012900     05  PV-BEG-OF-WEEK-TIMESTAMP REDEFINES                       01910095
013000           PV-BEG-OF-WEEK-TIMESTAMP-DET                           01920095
013100                                      PIC  X(26).                 01930095
013200                                                                  01940095
013300     05  PV-END-OF-WEEK-TIMESTAMP-DET.                            01950095
W3540C         10  PV-END-OF-WEEK-DATE      PIC  X(10)     VALUE SPACES.01960095
013500         10  FILLER                   PIC  X(01)     VALUE '-'.   01970095
W3540C         10  PV-END-OF-WEEK-HH        PIC  X(02)     VALUE SPACES.01980095
013700         10  FILLER                   PIC  X(01)     VALUE '.'.   01990095
W3540C         10  PV-END-OF-WEEK-MN        PIC  X(02)     VALUE SPACES.02000095
013900         10  FILLER                   PIC  X(01)     VALUE '.'.   02010095
W3540C         10  PV-END-OF-WEEK-SS        PIC  X(02)     VALUE SPACES.02020095
014100         10  FILLER                   PIC  X(01)     VALUE '.'.   02030095
W3540C         10  PV-END-OF-WEEK-TTTTTT    PIC  X(06)     VALUE SPACES.02040095
014400                                                                  02050095
014500     05  PV-END-OF-WEEK-TIMESTAMP REDEFINES                       02060095
014600           PV-END-OF-WEEK-TIMESTAMP-DET                           02070095
014700                                      PIC  X(26).                 02080095
014800                                                                  02090095
014900     05  PV-TIMESTAMP-WORK-AREA.                                  02100095
015000         10  PV-TIMESTAMP-WORK-CC     PIC  X(02)     VALUE SPACES.02110095
015100         10  PV-TIMESTAMP-WORK-YY     PIC  X(02)     VALUE SPACES.02120095
015200         10  FILLER                   PIC  X(01)     VALUE '-'.   02130095
015300         10  PV-TIMESTAMP-WORK-MM     PIC  X(02)     VALUE SPACES.02140095
015400         10  FILLER                   PIC  X(01)     VALUE '-'.   02150095
015500         10  PV-TIMESTAMP-WORK-DD     PIC  X(02)     VALUE SPACES.02160095
015600         10  FILLER                   PIC  X(01)     VALUE '-'.   02170095
015700         10  PV-TIMESTAMP-WORK-HH     PIC  X(02)     VALUE SPACES.02180095
015800         10  FILLER                   PIC  X(01)     VALUE '.'.   02190095
015900         10  PV-TIMESTAMP-WORK-MN     PIC  X(02)     VALUE SPACES.02200095
016000         10  FILLER                   PIC  X(01)     VALUE '.'.   02210095
016100         10  PV-TIMESTAMP-WORK-SS     PIC  X(02)     VALUE SPACES.02220095
016200         10  FILLER                   PIC  X(01)     VALUE '.'.   02230095
016300         10  PV-TIMESTAMP-WORK-TTTTTT PIC  X(06)     VALUE SPACES.02240095
016400                                                                  02250095
016500     05  PV-DOLLARS-OVER              PIC S9(07)V99 COMP-3        02260095
016600                                                    VALUE ZEROES. 02270095
016700     05  PV-DOLLARS-OVER-NEG          PIC S9(07)V99 COMP-3        02280095
016800                                                    VALUE ZEROES. 02290095
016900     05  PV-HOLD-TNDR-NME             PIC  X(30)    VALUE SPACES. 02300095
017000     05  PV-HOLD-GC-OPRT-ID           PIC S9(11)    VALUE ZEROES. 02310095
017100     05  PV-HOLD-GC-OPRT-ID-X REDEFINES  PV-HOLD-GC-OPRT-ID       02320095
017200                                      PIC  X(11).                 02330095
017300     05  PV-HOLD-GC-TNDR-NME          PIC X(30)     VALUE SPACES. 02340095
017400     05  PV-HOLD-DLR-OPRT-ID          PIC S9(11)    VALUE ZEROES. 02350095
017500     05  PV-HOLD-DLR-OPRT-ID-X REDEFINES  PV-HOLD-DLR-OPRT-ID     02360095
017600                                      PIC  X(11).                 02370095
017700     05  PV-HOLD-DLR-TNDR-NME         PIC  X(30)    VALUE SPACES. 02380095
017800     05  PV-FORMAT-CURRENCY           PIC  $ZZZ9.99 VALUE ZEROES. 02390095
017900     05  PV-DOLLARS-CENTS             PIC  9(07)V99.              02400095
018000     05  PV-DOLLARS-CENTS-RED  REDEFINES  PV-DOLLARS-CENTS.       02410095
018100         10  PV-DOLLARS               PIC 9(07).                  02420095
018200         10  PV-CENTS                 PIC 9(02).                  02430095
018210     05  PV-RECORDS-FETCHED           PIC 9(07)     VALUE ZEROES. 02440095
P12431     05  PV-ORD-NBR-NULL-IND          PIC S9(4) COMP              02441099
P12431                                                VALUE ZEROES.     02450099
018220                                                                  02451099
018230******************************************************************02460095
018240*    PS-PROGRAM SWITCHES                                         *02470095
018250******************************************************************02480095
018260 01  PS-PROGRAM-SWITCHES.                                         02490095
018270     05  PS-END-OF-CONTROL-FILE-SW    PIC  X(01)     VALUE 'N'.   02500095
018280         88  PS-END-OF-CONTROL-FILE                  VALUE 'Y'.   02510095
W3540C     05  PS-END-OF-CONTROL-FILE1-SW   PIC  X(01)     VALUE 'N'.   02520095
W3540C         88  PS-END-OF-CONTROL-FILE1                 VALUE 'Y'.   02530095
018290     05  PS-END-OF-ACTIVITY-CSR-SW    PIC  X(01)     VALUE 'N'.   02540095
018300         88  PS-END-OF-ACTIVITY-CSR                  VALUE 'Y'.   02550095
018400         88  PS-NOT-END-OF-ACTIVITY-CSR              VALUE 'N'.   02560095
018500     05  PS-EXCEPTION-FOUND-SW        PIC  X(01)     VALUE 'N'.   02570095
018600         88  PS-EXCEPTION-FOUND                      VALUE 'Y'.   02580095
018700         88  PS-EXCEPTION-NOT-FOUND                  VALUE 'N'.   02590095
018800     05  PS-GC-TNDR-NME-CHANGED-SW   PIC  X(01)     VALUE 'Y'.    02600095
018900         88  PS-GC-TNDR-NME-CHANGED                 VALUE 'Y'.    02610095
019000         88  PS-GC-TNDR-NME-NOT-CHANGED             VALUE 'N'.    02620095
019100     05  PS-DLR-TNDR-NME-CHANGED-SW   PIC  X(01)     VALUE 'Y'.   02630095
019200         88  PS-DLR-TNDR-NME-CHANGED                 VALUE 'Y'.   02640095
019300         88  PS-DLR-TNDR-NME-NOT-CHANGED             VALUE 'N'.   02650095
019400     05  PS-GC-OPRT-ID-CHANGED-SW     PIC  X(01)     VALUE 'Y'.   02660095
019500         88  PS-GC-OPRT-ID-CHANGED                   VALUE 'Y'.   02670095
019600         88  PS-GC-OPRT-ID-NOT-CHANGED               VALUE 'N'.   02680095
019700     05  PS-DLR-OPRT-ID-CHANGED-SW    PIC  X(01)     VALUE 'Y'.   02690095
019800         88  PS-DLR-OPRT-ID-CHANGED                  VALUE 'Y'.   02700095
019900         88  PS-DLR-OPRT-ID-NOT-CHANGED              VALUE 'N'.   02710095
020000                                                                  02720095
020100******************************************************************02730095
020200*    PA-PROGRAM ACCUMULATORS                                     *02740095
020300******************************************************************02750095
020400 01  PA-PROGRAM-ACCUMULATORS.                                     02760095
020500     05  PA-GC-LINE-COUNTER           PIC S9(11)     COMP-3       02770095
020600                                                     VALUE +65.   02780095
020700     05  PA-GC-PAGE-COUNTER           PIC S9(11)     COMP-3       02790095
020800                                                     VALUE ZEROES.02800095
020900     05  PA-DLR-LINE-COUNTER          PIC S9(11)     COMP-3       02810095
021000                                                     VALUE +65.   02820095
021100     05  PA-DLR-PAGE-COUNTER          PIC S9(11)     COMP-3       02830095
021200                                                     VALUE ZEROES.02840095
021300     05  PA-GFT-CRD-RECS-READ         PIC S9(11)     COMP-3       02850095
021400                                                     VALUE ZEROES.02860095
021500     05  PA-DLR-RECS-READ             PIC S9(11)     COMP-3       02870095
021600                                                     VALUE ZEROES.02880095
021700                                                                  02890095
021800******************************************************************02900095
021900*    HEADERS                                                     *02910095
022000******************************************************************02920095
022100 01  REPORT-TITLE-LINE.                                           02930095
022200     05  FILLER                         PIC  X(39)   VALUE SPACES.02940095
022300     05  FILLER                         PIC  X(45).               02950095
022400         88  RTL-GIFT-CARD-EXCEPTION                 VALUE        02960095
022500         '   KOHLS GIFT CARD EXCEPTION REPORT OVER     '.         02970095
022600         88  RTL-DOLLAR-EXCEPTION                    VALUE        02980095
022700         'KOHLS GIFT CARD DOLLAR EXCEPTION REPORT OVER '.         02990095
022800         88  RTL-NO-EXCEPTION                        VALUE SPACES.03000095
022900     05  RTL-DOLLAR-OVER-VALUE          PIC $ZZZ9.99.             03010095
P12431     05  FILLER                         PIC  X(108)  VALUE SPACES.03020099
023100                                                                  03030095
W3540C 01  REPORT-SUBTITLE-LINE.                                        03040095
W3540C     05  FILLER                         PIC  X(30)   VALUE SPACES.03050095
W3540C     05  FILLER                         PIC  X(18)   VALUE        03060095
W3540C         'REPORTING PERIOD: '.                                    03070095
W3540C     05  RSL-BEGIN-TIMESTAMP.                                     03080095
W3540C         10 RSL-BEGIN-DATE              PIC  X(10)   VALUE SPACES.03090095
W3540C         10 FILLER                      PIC  X       VALUE '-'.   03100095
W3540C         10 RSL-BEGIN-HH                PIC  9(02)   VALUE ZEROES.03110095
W3540C         10 FILLER                      PIC  X       VALUE '.'.   03120095
W3540C         10 RSL-BEGIN-MN                PIC  9(02)   VALUE ZEROES.03130095
W3540C         10 FILLER                      PIC  X       VALUE '.'.   03140095
W3540C         10 RSL-BEGIN-SS                PIC  9(02)   VALUE ZEROES.03150095
W3540C         10 FILLER                      PIC  X       VALUE '.'.   03160095
W3540C         10 RSL-BEGIN-TTTTTT            PIC  9(06)   VALUE ZEROES.03170095
W3540C     05  FILLER                         PIC  X(04)   VALUE        03180095
W3540C         ' TO '.                                                  03190095
W3540C     05  RSL-END-TIMESTAMP.                                       03200095
W3540C         10 RSL-END-DATE                PIC  X(10)   VALUE SPACES.03210095
W3540C         10 FILLER                      PIC  X       VALUE '-'.   03220095
W3540C         10 RSL-END-HH                  PIC  9(02)   VALUE ZEROES.03230095
W3540C         10 FILLER                      PIC  X       VALUE '.'.   03240095
W3540C         10 RSL-END-MN                  PIC  9(02)   VALUE ZEROES.03250095
W3540C         10 FILLER                      PIC  X       VALUE '.'.   03260095
W3540C         10 RSL-END-SS                  PIC  9(02)   VALUE ZEROES.03270095
W3540C         10 FILLER                      PIC  X       VALUE '.'.   03280095
W3540C         10 RSL-END-TTTTTT              PIC  9(06)   VALUE ZEROES.03290095
P12431     05  FILLER                         PIC  X(96)   VALUE SPACES.03300099
W3540C                                                                  03310095
024200 01  REPORT-DETAIL-HEADER.                                        03320095
024300     05  FILLER                         PIC  X(01)   VALUE SPACES.03330095
024400     05  FILLER                         PIC  X(06)   VALUE        03340095
024500         'TENDER'.                                                03350095
024600     05  FILLER                         PIC  X(27)   VALUE SPACES.03360095
024700     05  FILLER                         PIC  X(05)   VALUE        03370095
024800         'STORE'.                                                 03380095
024900     05  FILLER                         PIC  X(01)   VALUE SPACES.03390095
025000     05  FILLER                         PIC  X(11)   VALUE        03400095
025100         'OPERATOR ID'.                                           03410095
025200     05  FILLER                         PIC  X(02)   VALUE SPACES.03420095
025300     05  FILLER                         PIC  X(10)   VALUE        03430095
025400         'ISSUE DATE'.                                            03440095
025500     05  FILLER                         PIC  X(04)   VALUE SPACES.03450095
025600     05  FILLER                         PIC  X(04)   VALUE        03460095
025700         'TERM'.                                                  03470095
025800     05  FILLER                         PIC  X(04)   VALUE SPACES.03480095
025900     05  FILLER                         PIC  X(04)   VALUE        03490095
026000         'TRAN'.                                                  03500095
026100     05  FILLER                         PIC  X(05)   VALUE SPACES.03510095
026200     05  FILLER                         PIC  X(07)   VALUE        03520095
026300         'CARD ID'.                                               03530095
026400     05  FILLER                         PIC  X(05)   VALUE SPACES.03540095
026500     05  FILLER                         PIC  X(06)   VALUE        03550095
026600         'VOIDED'.                                                03560095
026700     05  FILLER                         PIC  X(04)   VALUE SPACES.03570095
026800     05  FILLER                         PIC  X(12)   VALUE        03580095
026900         'ISSUE AMOUNT'.                                          03590095
P12431     05  FILLER                         PIC  X(04)   VALUE SPACES.03600099
P12431     05  FILLER                         PIC  X(12)   VALUE        03601099
P12431         'ORDER NUMBER'.                                          03602099
P12431     05  FILLER                         PIC  X(66)   VALUE SPACES.03603099
027100                                                                  03610095
027200******************************************************************03620095
027300*    GIFT CARD ISSUANCE EXCEPTION DETAIL LINES                   *03630095
027400******************************************************************03640095
027500 01  REPORT-DETAIL-LINE.                                          03650095
027600     05  FILLER                         PIC  X(01)   VALUE SPACES.03660095
027700     05  RDL-TENDER-NAME                PIC  X(30)   VALUE SPACES.03670095
027800     05  FILLER                         PIC  X(03)   VALUE SPACES.03680095
027900     05  RDL-STORE-NBR                  PIC  9(04)   VALUE ZEROES.03690095
028000     05  RDL-STORE-NBR-X  REDEFINES                               03700095
028100         RDL-STORE-NBR                  PIC  X(04).               03710095
028200     05  FILLER                         PIC  X(02)   VALUE SPACES.03720095
028300     05  RDL-OPRT-ID                    PIC  9(11)                03730095
028400                                                     VALUE ZEROES.03740095
028500     05  RDL-OPRT-ID-X    REDEFINES                               03750095
028600         RDL-OPRT-ID                    PIC  X(11).               03760095
028700     05  FILLER                         PIC  X(04)   VALUE SPACES.03770095
028800     05  RDL-ISSUE-DTE.                                           03780095
028900         10 RDL-ISSUE-DTE-MM            PIC  X(02)   VALUE SPACES.03790095
029000         10 FILLER                      PIC  X(01)                03800095
029100            VALUE '/'.                                            03810095
029200         10 RDL-ISSUE-DTE-DD            PIC  X(02)   VALUE SPACES.03820095
029300         10 FILLER                      PIC  X(01)                03830095
029400            VALUE '/'.                                            03840095
029500         10 RDL-ISSUE-DTE-YY            PIC  X(02)   VALUE SPACES.03850095
029600     05  FILLER                         PIC  X(04)   VALUE SPACES.03860095
029700     05  RDL-TERM-NBR                   PIC  X(04)   VALUE SPACES.03870095
029800     05  FILLER                         PIC  X(04)   VALUE SPACES.03880095
029900     05  RDL-TRN-NBR                    PIC  X(04)   VALUE SPACES.03890095
030000     05  FILLER                         PIC  X(03)   VALUE SPACES.03900095
030100     05  RDL-CRD-NBR                    PIC  ZZ9(10) VALUE ZEROES.03910095
030200     05  FILLER                         PIC  X(05)   VALUE SPACES.03920095
030300     05  RDL-VOID-IND                   PIC  X(04)   VALUE SPACES.03930095
030400     05  FILLER                         PIC  X(05)   VALUE SPACES.03940095
030500     05  RDL-ISSUE-AMT                  PIC  ZZZ,ZZZ.99-          03950095
030600                                                     VALUE ZEROES.03960095
P12431     05  FILLER                         PIC  X(03)   VALUE SPACES.03970099
P12431     05  RDL-ORD-NBR                    PIC  X(40)   VALUE SPACES.03971099
P12431     05  FILLER                         PIC  X(38)   VALUE SPACES.03972099
030800                                                                  03980095
030900 01  REPORT-NO-DETAIL-LINE.                                       03990095
031000     05  FILLER                         PIC  X(02)   VALUE SPACES.04000095
031100     05  FILLER                         PIC  X(25)                04010095
031200         VALUE 'NO EXCEPTIONS FOUND OVER '.                       04020095
031300     05  RDL-NO-DET-OVER                PIC  $ZZZ9.99             04030095
031400                                                     VALUE ZEROES.04040095
P12431     05  FILLER                         PIC  X(165)  VALUE SPACES.04050099
031600 01  REPORT-NON-ZERO-CENTS-DTL-LINE.                              04060095
031700     05  FILLER                         PIC  X(02)   VALUE SPACES.04070095
031800     05  FILLER                         PIC  X(38)                04080095
031900         VALUE 'NO EXCEPTIONS FOUND FOR NON-ZERO CENTS'.          04090095
P12431     05  FILLER                         PIC  X(160)  VALUE SPACES.04100099
032100                                                                  04110095
032200 01  REPORT-END-OF-DETAIL-LINE.                                   04120095
032300     05  FILLER                         PIC  X(50)   VALUE SPACES.04130095
032400     05  FILLER                         PIC  X(31)                04140095
032500         VALUE '*** E N D  O F  R E P O R T ***'.                 04150095
P12431     05  FILLER                         PIC  X(119)  VALUE SPACES.04160099
032700                                                                  04170095
W3540C******************************************************************04180095
W3540C*    CONTROL CARD LAYOUT                                         *04190095
W3540C******************************************************************04200095
W3540C 01  WRITE-CONTROL-CARD.                                          04210095
W3540C     05  CONTROL-CARD-BEG-DATE          PIC  X(26)   VALUE SPACES.04220095
W3540C     05  FILLER                         PIC  X(01)   VALUE SPACES.04230095
W3540C     05  CONTROL-CARD-END-DATE          PIC  X(26)   VALUE SPACES.04240095
W3540C     05  FILLER                         PIC  X(01)   VALUE SPACES.04250095
W3540C     05  RESTART-INDICATOR              PIC  X(01)   VALUE SPACES.04260095
W3540C     05  FILLER                         PIC  X(25)   VALUE SPACES.04261099
W3540C                                                                  04270095
032800******************************************************************04280095
032900*    KMRC & GIFT CARD CONSTANTS                                  *04290095
033000******************************************************************04300095
033100     COPY SVWS004.                                                04310095
033200                                                                  04320095
033300******************************************************************04330095
033400*    STANDARD HEADER FOR 132 COLUMN REPORT                       *04340095
033500******************************************************************04350095
P12431     COPY DPWS200O.                                               04361099
033700                                                                  04370095
033800******************************************************************04380095
033900*    DATE ROUTINE COPY MEMBERS                                   *04390095
034000******************************************************************04400095
034100     COPY DPWS500.                                                04410095
034200                                                                  04420095
034300******************************************************************04430095
034400*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *04440095
034500******************************************************************04450095
034600     COPY DPWS004.                                                04460095
034700                                                                  04470095
034800******************************************************************04480095
034900*    XST_LOC                                                     *04490095
035000******************************************************************04500095
035100     EXEC SQL                                                     04510095
035200         INCLUDE XST00001                                         04520095
035300     END-EXEC.                                                    04530095
035400                                                                  04540095
035500******************************************************************04550095
035600*    XST_LOC_DIST                                                *04560095
035700******************************************************************04570095
035800     EXEC SQL                                                     04580095
035900         INCLUDE XST00002                                         04590095
036000     END-EXEC.                                                    04600095
036100                                                                  04610095
036200******************************************************************04620095
036300*    DB2 AREA FOR SVT_KOHLS_CRD_TXN                              *04630095
036400*    SV-KOHL'S MERCHANDISE CARD ACTIVITY TABLE                   *04640095
036500******************************************************************04650095
036600     EXEC SQL                                                     04660095
036700         INCLUDE SVT00002                                         04670095
036800     END-EXEC.                                                    04680095
036900                                                                  04690095
037000******************************************************************04700095
037100*  DB2 TABLE TEPCDE - CODE TABLE                                  04710095
037200******************************************************************04720095
037300     EXEC SQL                                                     04730095
037400          INCLUDE TEPCDE                                          04740095
037500     END-EXEC.                                                    04750095
037600******************************************************************04760095
037700*  DB2 TABLE TEPPART - PARTITION TABLE                            04770095
037800******************************************************************04780095
037900     EXEC SQL                                                     04790095
038000          INCLUDE TEPPART                                         04800095
038100     END-EXEC.                                                    04810095
038200******************************************************************04820095
038300*  DB2 TABLE TEPTND - TENDER TABLE                                04830095
038400******************************************************************04840095
038500     EXEC SQL                                                     04850095
038600          INCLUDE TEPTND                                          04860095
038700     END-EXEC.                                                    04870095
038800******************************************************************04880095
038900*    CURSOR TO ACCESS ISSUED GIFT CARDS OVER THE APPROVED AMOUNT *04890095
039000******************************************************************04900095
039100     EXEC SQL                                                     04910095
039200       DECLARE ACTIVITY-CSR CURSOR FOR                            04920095
039300           SELECT A.CRD_NBR                                       04930095
039400                 ,A.TRN_AUTH_TMST                                 04940095
039500                 ,A.TRN_VOID_IND                                  04950095
039600                 ,A.STR_NBR                                       04960095
039700                 ,A.POS_TRMNL_NBR                                 04970095
039800                 ,A.POS_TRN_NBR                                   04980095
039900                 ,A.POS_OPRT_ID                                   04990095
039901                 ,A.APVL_USR_ID                                   05000095
039902                 ,A.APP_AUTH_AMT                                  05010095
P12431                 ,A.ORD_NBR                                       05011099
039903                 ,B.LOC_NM                                        05020095
039904                 ,C.DIST_NBR                                      05030095
039905                 ,D.SLS_CORR_SEQ_NBR                              05040095
039906                 ,E.SLS_DTE                                       05050095
039907                 ,E.PARTN_NBR                                     05060095
039908                 ,D.TNDR_TYP_CDE                                  05070095
039910                 ,D.STR_NBR                                       05090095
039911                 ,D.RGST_ID                                       05100095
039912                 ,D.TRN_NBR                                       05110095
039913                 ,F.CDE_DESC                                      05120095
039914            FROM SVT_KOHLS_CRD_TXN       A                        05130095
039915                 ,XST_LOC                B                        05140095
039916                 ,XST_LOC_DIST           C                        05150095
039917                 ,TEPTND                 D                        05160095
039918                 ,TEPPART                E                        05170095
039919                 ,TEPCDE                 F                        05180095
039920           WHERE  A.STR_NBR = B.LOC_NBR                           05190095
039930             AND  A.STR_NBR = C.LOC_NBR                           05200095
039940             AND  ACTVY_TYP_CDE = :SV004-ISSUE-GIFT-CRD-ACT-TYP-N 05210095
039950             AND  TRN_VOID_IND  = :SV004-NOT-VOID-TRANS           05220095
W3540C             AND (TRN_AUTH_TMST > :PV-BEG-OF-WEEK-TIMESTAMP       05230095
W3540C             AND  TRN_AUTH_TMST <= :PV-END-OF-WEEK-TIMESTAMP)     05240095
039980             AND ((C.BEG_DTE < :PV-BEG-OF-WEEK-DATE OR            05250095
039990                   C.BEG_DTE = :PV-BEG-OF-WEEK-DATE) AND          05260095
040000                  (C.END_DTE > :PV-END-OF-WEEK-DATE OR            05270095
040100                   C.END_DTE = :PV-END-OF-WEEK-DATE OR            05280095
040200                   C.END_DTE IS NULL))                            05290095
040300             AND    D.PARTN_NBR          = E.PARTN_NBR            05300095
040400             AND    D.TNDR_TYP_CDE       = F.CDE_VAL_CDE          05310095
040500             AND    F.CDE_TYP_DESC       = 'TNDR_TYP_CDE'         05320095
040600             AND    TRN_VOID_IND         = D.TNDR_VOID_IND        05330095
040800             AND    A.STR_NBR            = D.STR_NBR              05340095
040900             AND    A.POS_TRMNL_NBR      = D.RGST_ID              05350095
041000             AND    A.POS_TRN_NBR        = D.TRN_NBR              05360095
041100             AND    A.POS_DTE            = E.SLS_DTE              05370095
041110     AND    D.SLS_CORR_SEQ_NBR =                                  05380095
041120     (SELECT MAX(D2.SLS_CORR_SEQ_NBR)                             05390095
041130      FROM                                                        05400095
041140           TEPTND                 D2                              05410095
041150      WHERE                                                       05420095
041160              D2.PARTN_NBR        = D.PARTN_NBR                   05430095
041170       AND    D2.STR_NBR          = D.STR_NBR                     05440095
041180       AND    D2.RGST_ID          = D.RGST_ID                     05450095
041190       AND    D2.TNDR_ID          = D.TNDR_ID                     05460095
041192       AND    D2.TNDR_TYP_CDE     =  D.TNDR_TYP_CDE               05470095
041193       AND    D2.TNDR_VOID_IND    = D.TNDR_VOID_IND               05480095
041194       AND    D2.TRN_NBR          = D.TRN_NBR)                    05490095
042401         ORDER BY F.CDE_DESC                                      05500095
042402                 ,C.DIST_NBR                                      05510095
042403                 ,A.STR_NBR                                       05520095
042404                 ,A.POS_OPRT_ID                                   05530095
042405                 ,A.TRN_AUTH_TMST                                 05540095
042406                 ,A.POS_TRMNL_NBR                                 05550095
042407                 ,A.POS_TRN_NBR                                   05560095
042408          WITH UR                                                 05570095
042409     END-EXEC.                                                    05580095
042410                                                                  05590095
042420                                                                  05600095
042430******************************************************************05610095
042440*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *05620095
042450******************************************************************05630095
042460     EXEC SQL                                                     05640095
042470         INCLUDE SQLCA                                            05650095
042480     END-EXEC.                                                    05660095
042490                                                                  05670095
042500     COPY SQLCA2.                                                 05680095
042600                                                                  05690095
042700                                                                  05700095
042800 PROCEDURE DIVISION.                                              05710095
042900                                                                  05720095
043000 A100-MAINLINE.                                                   05730095
043100                                                                  05740095
043200     PERFORM B100-INITIALIZE.                                     05750095
043300                                                                  05760095
043400     PERFORM B200-PROCESS-EXCEPTIONS                              05770095
043500       UNTIL PS-END-OF-ACTIVITY-CSR.                              05780095
043600                                                                  05790095
043700     PERFORM C100-EOJ-ROUTINE.                                    05800095
043800                                                                  05810095
043900     GOBACK.                                                      05820095
044000                                                                  05830095
044100******************************************************************05840095
044200*     B100-INITIALIZE                                            *05850095
044300* ==> PROCESSES:                                                 *05860095
044400*     - READS CONTROL DATE AND CONTROL AMOUNT FROM CONTROL RECORD*05870095
044500*     - VERIFY THE CONTROL DATE IS VALID                         *05880095
044600*     - ACCEPTS THE CURRENT DATE AND TIME FOR THE REPORT HEADING *05890095
044700*     - FIND THE DATE FOR THE 1ST DAY OF THE WEEK, WHICH         *05900095
044800*       CORRESPONDS TO THE WEEK ENDING DATE IN THE CONTROL RECORD*05910095
044900*     - OPENS ACTIVITY-CSR (CURSOR).                             *05920095
045000*     - READS FIRST GIFT CARD CONTROL NUMBER.  IF ONE IS NOT     *05930095
045100*       FOUND, ISSUE MESSAGE TO THE REPORT.                      *05940095
045200* ==> PERFORMED FROM:  A100-MAINLINE                             *05950095
045300******************************************************************05960095
045400 B100-INITIALIZE.                                                 05970095
045500                                                                  05980095
045600     OPEN INPUT CONTROL-DATE-FILE                                 05990095
W3540C                CONTROL-TIMESTAMP-FILE                            06000095
045700          OUTPUT REPORT-FILE                                      06010095
045800                 DOLLAR-REPORT-FILE.                              06020095
045900                                                                  06030095
046000     READ CONTROL-DATE-FILE INTO CR-CONTROL-RECORD                06040095
046100       AT END                                                     06050095
046200         SET PS-END-OF-CONTROL-FILE TO TRUE.                      06060095
046300                                                                  06070095
046400     IF PS-END-OF-CONTROL-FILE                                    06080095
046500       DISPLAY ' '                                                06090095
046600       DISPLAY '** ABEND     **'                                  06100095
046700       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              06110095
046800       DISPLAY '** PARAGRAPH **  = B100-INITIALIZE      '         06120095
046900       DISPLAY '** CONTROL DATE FILE IS EMPTY  '                  06130095
047000       MOVE +4002 TO ABEND-CODE                                   06140095
047100       CALL 'ILBOABN0' USING ABEND-CODE                           06150095
047200     ELSE                                                         06160095
047300       DISPLAY PC-PROGRAM-NAME                                    06170095
047400               'CR-CONTROL-RECORD: ' CR-CONTROL-RECORD            06180095
047500       DISPLAY ' '                                                06190095
047400       DISPLAY PC-PROGRAM-NAME ' CONTROL DATE:  '                 06200095
047500               CR-CONTROL-DATE                                    06210095
047800       DISPLAY ' '                                                06220095
047900       DISPLAY PC-PROGRAM-NAME ' RUN TYPE:  '                     06230095
048000               CR-RUN-TYPE                                        06240095
048100       DISPLAY ' '                                                06250095
048200       MOVE CR-DOLLAR-OVER-VALUE TO PV-FORMAT-CURRENCY            06260095
048300       DISPLAY PC-PROGRAM-NAME ' DOLLARS OVER:  '                 06270095
048400               PV-FORMAT-CURRENCY                                 06280095
W3540C       DISPLAY ' '                                                06290095
048500     END-IF.                                                      06300095
048600                                                                  06310095
W3540C     READ CONTROL-TIMESTAMP-FILE INTO CR-CONTROL-RECORD1          06320095
W3540C       AT END                                                     06330095
W3540C         SET PS-END-OF-CONTROL-FILE1 TO TRUE.                     06340095
W3540C                                                                  06350095
W3540C     IF PS-END-OF-CONTROL-FILE1                                   06360095
W3540C       DISPLAY ' '                                                06370095
W3540C       DISPLAY '** ABEND     **'                                  06380095
W3540C       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              06390095
W3540C       DISPLAY '** PARAGRAPH **  = B100-INITIALIZE      '         06400095
W3540C       DISPLAY '** CONTROL TIMESTAMP FILE IS EMPTY  '             06410095
W3540C       MOVE +4002 TO ABEND-CODE                                   06420095
W3540C       CALL 'ILBOABN0' USING ABEND-CODE                           06430095
W3540C     ELSE                                                         06440095
W3540C       DISPLAY PC-PROGRAM-NAME                                    06450095
W3540C               ' CR-CONTROL-RECORD1: ' CR-CONTROL-RECORD1         06460095
W3540C       DISPLAY ' '                                                06470095
W3540C       DISPLAY PC-PROGRAM-NAME ' CONTROL-BEG-TIMESTAMP '          06480095
W3540C                'CONTROL-END-TIMESTAMP RESTART-IND READ FROM '    06490095
W3540C                               'INPUT FILE: '                     06500098
W3540C               CR-CONTROL-RECORD1                                 06510095
W3540C       DISPLAY ' '                                                06520095
W3540C     END-IF.                                                      06530095
048600                                                                  06540095
W3540C     CLOSE CONTROL-TIMESTAMP-FILE.                                06550095
048600                                                                  06560095
048700     MOVE CR-DOLLAR-OVER-VALUE TO PV-DOLLARS-OVER                 06570095
048800                                  RTL-DOLLAR-OVER-VALUE.          06580095
048900     COMPUTE PV-DOLLARS-OVER-NEG =                                06590095
049000       PV-DOLLARS-OVER * -1.                                      06600095
049100                                                                  06610095
049200     MOVE ZEROES         TO PV-RECORDS-FETCHED.                   06620095
049210                                                                  06630095
049220******************************************************************06640095
049230*  VERIFY THE RUN TYPE IS VALID                                  *06650095
049240******************************************************************06660095
049250                                                                  06670095
049260     IF NOT CR-VALID-RUN-TYPE                                     06680095
049270       DISPLAY ' '                                                06690095
049280       DISPLAY '** ABEND     **'                                  06700095
049290       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              06710095
049300       DISPLAY '** PARAGRAPH **  = B100-INITIALIZE      '         06720095
049400       DISPLAY '** RUN TYPE SELECTED IS NOT VALID  '              06730095
049500       MOVE +4003 TO ABEND-CODE                                   06740095
049600       CALL 'ILBOABN0' USING ABEND-CODE                           06750095
049700     END-IF.                                                      06760095
049800******************************************************************06770095
049900*  VERIFY THE CONTROL DATE IS VALID.                             *06780095
050000******************************************************************06790095
050100                                                                  06800095
050200     INITIALIZE DPG51 DPG52 DPG53                                 06810095
050300                DPG54 DPG55 DPG56.                                06820095
050400     SET DPG51-ACTUAL-CALENDAR-ONLY                               06830095
050500                                 TO TRUE.                         06840095
050400     MOVE CR-CONTROL-DATE        TO DPG52-LK-DATE-INPUT.          06850095
050500     SET DPG52-LK-DTE-GREG-CC    TO TRUE.                         06860095
050800     CALL DP500-KOHLS-CALENDAR-ROUTINE                            06870095
050900       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 06880095
051000                                                                  06890095
051100     EVALUATE TRUE                                                06900095
051200       WHEN DPG54-SEVERE-ERROR                                    06910095
051300       WHEN DPG54-DATE-INVALID                                    06920095
051400         DISPLAY ' '                                              06930095
051500         DISPLAY '** ABEND     **'                                06940095
051600         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            06950095
051700         DISPLAY '** PARAGRAPH **  = B100-INITIALIZE'             06960095
051800         DISPLAY '** BAD CALL TO CALENDAR MODULE '                06970095
051900         DISPLAY '** DETERMINE VALID DATE **'                     06980095
052000         DISPLAY DPG54-ERROR-MESSAGE                              06990095
052100         MOVE +4019             TO ABEND-CODE                     07000095
052200         CALL 'ILBOABN0' USING ABEND-CODE                         07010095
052300     END-EVALUATE.                                                07020095
052400                                                                  07030095
W3540C     INITIALIZE DPG51 DPG52 DPG53                                 07040095
W3540C                DPG54 DPG55 DPG56.                                07050095
W3540C     SET DPG51-ACTUAL-CALENDAR-ONLY                               07060095
W3540C                                 TO TRUE.                         07070095
W3540C     MOVE CR-BEG-DATE            TO DPG52-LK-DATE-INPUT.          07080095
W3540C     SET DPG52-LK-DTE-ISO-FMT    TO TRUE.                         07090095
W3540C     CALL DP500-KOHLS-CALENDAR-ROUTINE                            07100095
W3540C       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 07110095
W3540C                                                                  07120095
W3540C     EVALUATE TRUE                                                07130095
W3540C       WHEN DPG54-SEVERE-ERROR                                    07140095
W3540C       WHEN DPG54-DATE-INVALID                                    07150095
W3540C         DISPLAY ' '                                              07160095
W3540C         DISPLAY '** ABEND     **'                                07170095
W3540C         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            07180095
W3540C         DISPLAY '** PARAGRAPH **  = B100-INITIALIZE'             07190095
W3540C         DISPLAY '** BAD CALL TO CALENDAR MODULE '                07200095
W3540C         DISPLAY '** DETERMINE VALID DATE (BEGIN TIMESTAMP)**'    07210099
W3540C         DISPLAY DPG54-ERROR-MESSAGE                              07220095
W3540C         MOVE +4019             TO ABEND-CODE                     07230095
W3540C         CALL 'ILBOABN0' USING ABEND-CODE                         07240095
W3540C     END-EVALUATE.                                                07250095
052400                                                                  07260095
W3540C     MOVE CR-CONTROL-BEG-TIMESTAMP                                07270095
W3540C                                 TO PV-BEG-OF-WEEK-TIMESTAMP-DET. 07280095
W3540C     INITIALIZE PV-GREG-DATE.                                     07290095
W3540C     MOVE CR-BEG-DATE(1:4)       TO PV-GREG-CCYY.                 07300095
W3540C     MOVE CR-BEG-DATE(6:2)       TO PV-GREG-MM.                   07310095
W3540C     MOVE CR-BEG-DATE(9:2)       TO PV-GREG-DD.                   07320095
W3540C     MOVE PV-GREG-DATE           TO RSL-BEGIN-DATE.               07330095
W3540C     MOVE CR-BEG-HH              TO RSL-BEGIN-HH.                 07340095
W3540C     MOVE CR-BEG-MN              TO RSL-BEGIN-MN.                 07350095
W3540C     MOVE CR-BEG-SS              TO RSL-BEGIN-SS.                 07360095
W3540C     MOVE CR-BEG-TTTTTT          TO RSL-BEGIN-TTTTTT.             07370095
052700                                                                  07380095
W3540C     IF CR-RESTART-IND = 'R'                                      07400095
W3540C                                                                  07410095
W3540C        INITIALIZE DPG51 DPG52 DPG53                              07420095
W3540C                   DPG54 DPG55 DPG56                              07430095
W3540C        SET DPG51-ACTUAL-CALENDAR-ONLY                            07440099
W3540C                                     TO TRUE                      07450099
W3540C        MOVE CR-END-DATE             TO DPG52-LK-DATE-INPUT       07460099
W3540C        SET DPG52-LK-DTE-ISO-FMT     TO TRUE                      07470099
W3540C        CALL DP500-KOHLS-CALENDAR-ROUTINE                         07480099
W3540C         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                07490099
W3540C                                                                  07500095
W3540C      EVALUATE TRUE                                               07510099
W3540C        WHEN DPG54-SEVERE-ERROR                                   07520099
W3540C        WHEN DPG54-DATE-INVALID                                   07530099
W3540C         DISPLAY ' '                                              07540095
W3540C         DISPLAY '** ABEND     **'                                07550095
W3540C         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            07560095
W3540C         DISPLAY '** PARAGRAPH **  = B100-INITIALIZE'             07570095
W3540C         DISPLAY '** BAD CALL TO CALENDAR MODULE '                07580095
W3540C         DISPLAY '** DETERMINE VALID DATE (END TIMESTAMP)**'      07590099
W3540C         DISPLAY DPG54-ERROR-MESSAGE                              07600095
W3540C         MOVE +4019             TO ABEND-CODE                     07610095
W3540C         CALL 'ILBOABN0' USING ABEND-CODE                         07620095
W3540C      END-EVALUATE                                                07630099
052400                                                                  07640095
W3540C         MOVE CR-CONTROL-END-TIMESTAMP                            07650099
W3540C                                 TO PV-END-OF-WEEK-TIMESTAMP-DET  07660095
W3540C         INITIALIZE PV-GREG-DATE                                  07670099
W3540C         MOVE CR-END-DATE(1:4)       TO PV-GREG-CCYY              07680099
W3540C         MOVE CR-END-DATE(6:2)       TO PV-GREG-MM                07690099
W3540C         MOVE CR-END-DATE(9:2)       TO PV-GREG-DD                07700099
W3540C         MOVE PV-GREG-DATE           TO RSL-END-DATE              07710099
W3540C         MOVE CR-END-HH              TO RSL-END-HH                07720099
W3540C         MOVE CR-END-MN              TO RSL-END-MN                07730099
W3540C         MOVE CR-END-SS              TO RSL-END-SS                07740099
W3540C         MOVE CR-END-TTTTTT          TO RSL-END-TTTTTT            07750099
W3540C                                                                  07760095
W3540C     ELSE                                                         07770095
W3540C                                                                  07780095
W3540C      EXEC SQL                                                    07790099
W3540C          SET :PV-END-OF-WEEK-TIMESTAMP = CURRENT TIMESTAMP       07800099
W3540C      END-EXEC                                                    07810099
W3540C                                                                  07840095
W3540C         MOVE PV-END-OF-WEEK-TIMESTAMP                            07850099
W3540C                                     TO CONTROL-CARD-BEG-DATE     07851099
W3540C                                                                  07860095
W3540C      EVALUATE TRUE                                               07870099
W3540C          WHEN SQLCODE NOT = 0                                    07880099
W3540C          WHEN SQLWARN0    = 'W'                                  07890099
W3540C             DISPLAY ' '                                          07900095
W3540C             DISPLAY '** ABEND     **'                            07910095
W3540C             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        07920095
W3540C             DISPLAY '** PARAGRAPH **  = B100-INITIALIZE'         07930095
W3540C             DISPLAY '** SET CURRENT TIMESTAMP'                   07940095
W3540C             PERFORM Z900-SQL-ABEND                               07950095
W3540C      END-EVALUATE                                                07960099
W3540C                                                                  07970095
W3540C         INITIALIZE PV-GREG-DATE                                  07980099
W3540C         MOVE PV-END-OF-WEEK-TIMESTAMP-DET(1:4)                   08000099
W3540C                                     TO PV-GREG-CCYY              08010099
W3540C         MOVE PV-END-OF-WEEK-TIMESTAMP-DET(6:2)                   08020099
W3540C                                     TO PV-GREG-MM                08030099
W3540C         MOVE PV-END-OF-WEEK-TIMESTAMP-DET(9:2)                   08040099
W3540C                                     TO PV-GREG-DD                08050099
W3540C         MOVE PV-GREG-DATE           TO RSL-END-DATE              08060099
W3540C         MOVE PV-END-OF-WEEK-HH      TO RSL-END-HH                08070099
W3540C         MOVE PV-END-OF-WEEK-MN      TO RSL-END-MN                08080099
W3540C         MOVE PV-END-OF-WEEK-SS      TO RSL-END-SS                08090099
W3540C         MOVE PV-END-OF-WEEK-TTTTTT  TO RSL-END-TTTTTT            08100099
W3540C                                                                  08101099
W3540C     END-IF.                                                      08110095
052700                                                                  08120095
052600     IF CR-WEEKLY-RUN-TYPE                                        08130095
W3540C         MOVE CR-BEG-DATE        TO                               08132099
W3540C                                    PV-BEG-OF-WEEK-DATE           08133099
W3540C         MOVE CR-BEG-DATE(1:4)   TO PV-GREG-CCYY                  08133399
W3540C         MOVE CR-BEG-DATE(6:2)   TO PV-GREG-MM                    08133499
W3540C         MOVE CR-BEG-DATE(9:2)   TO PV-GREG-DD                    08133599
W3540C         MOVE PV-GREG-DATE       TO RSL-BEGIN-DATE                08133699
W3540C                                                                  08133799
W3540C         MOVE '00'               TO PV-BEG-OF-WEEK-HH             08133999
W3540C                                    RSL-BEGIN-HH                  08134099
W3540C         MOVE '00'               TO PV-BEG-OF-WEEK-MN             08134199
W3540C                                    RSL-BEGIN-MN                  08134299
W3540C         MOVE '00'               TO PV-BEG-OF-WEEK-SS             08134399
W3540C                                    RSL-BEGIN-SS                  08134499
W3540C         MOVE '000000'           TO PV-BEG-OF-WEEK-TTTTTT         08134599
W3540C                                    RSL-BEGIN-TTTTTT              08134699
W3540C                                                                  08135099
W3540C         MOVE CR-MM              TO PV-ISO-MM                     08140095
W3540C                                    PV-GREG-MM                    08150095
W3540C         MOVE CR-DD              TO PV-ISO-DD                     08160095
W3540C                                    PV-GREG-DD                    08170095
W3540C         MOVE CR-CONTROL-DATE(5:4)                                08180095
W3540C                                 TO PV-ISO-CCYY                   08190095
W3540C                                    PV-GREG-CCYY                  08200095
W3540C         MOVE PV-ISO-DATE        TO PV-END-OF-WEEK-DATE           08210095
W3540C         MOVE PV-GREG-DATE       TO RSL-END-DATE                  08220095
W3540C         MOVE '23'               TO PV-END-OF-WEEK-HH             08230095
W3540C                                    RSL-END-HH                    08240095
W3540C         MOVE '59'               TO PV-END-OF-WEEK-MN             08250095
W3540C                                    RSL-END-MN                    08260095
W3540C         MOVE '59'               TO PV-END-OF-WEEK-SS             08270095
W3540C                                    RSL-END-SS                    08280095
W3540C         MOVE '999999'           TO PV-END-OF-WEEK-TTTTTT         08290095
W3540C                                    RSL-END-TTTTTT                08300095
W3540C                                                                  08300199
W3540C         MOVE PV-END-OF-WEEK-TIMESTAMP                            08301099
W3540C                                     TO CONTROL-CARD-BEG-DATE     08302099
053200     END-IF.                                                      08310095
053500******************************************************************08320095
053600*  OPEN THE ACTIVITY CURSOR                                      *08330095
053700******************************************************************08340095
053800                                                                  08350095
053900     EXEC SQL                                                     08360095
054000         OPEN ACTIVITY-CSR                                        08370095
054100     END-EXEC.                                                    08380095
054200                                                                  08390095
054300     EVALUATE TRUE                                                08400095
054400       WHEN SQLCODE NOT = 0                                       08410095
054500       WHEN SQLWARN0    = 'W'                                     08420095
054600         DISPLAY ' '                                              08430095
054700         DISPLAY '** ABEND     **'                                08440095
054800         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            08450095
054900         DISPLAY '** PARAGRAPH **  = B100-INITIALIZE      '       08460095
055000         DISPLAY '** ERROR IN OPENING THE CURSOR'                 08470095
055100         PERFORM Z900-SQL-ABEND                                   08480095
055200     END-EVALUATE.                                                08490095
055300                                                                  08500095
055400******************************************************************08510095
055500*  FILL IN THE VARIABLES FOR THE MAIN CORPORATE HEADING          *08520095
055600******************************************************************08530095
055700                                                                  08540095
055800     ACCEPT PV-CURRENT-DATE FROM DATE.                            08550095
P12431     MOVE PV-CURRENT-YEAR   TO DP200O-RUN-YEAR.                   08560099
P12431     MOVE PV-CURRENT-MONTH  TO DP200O-RUN-MONTH.                  08570099
P12431     MOVE PV-CURRENT-DAY    TO DP200O-RUN-DAY.                    08580099
056200                                                                  08590095
056300     ACCEPT PV-CURRENT-TIME FROM TIME.                            08600095
P12431     MOVE PV-CURRENT-HOUR   TO DP200O-RUN-HOUR.                   08610099
P12431     MOVE PV-CURRENT-MINUTE TO DP200O-RUN-MINUTE.                 08620099
056600                                                                  08630095
P12431     MOVE PC-PROGRAM-NAME   TO DP200O-PROGRAM-NAME.               08640099
056800                                                                  08650095
056900******************************************************************08660095
057000*  BEGIN THE REPORTING PROCESS BY FETCHING THE FIRST RECORD      *08670095
057100******************************************************************08680095
057200                                                                  08690095
057300     PERFORM D100-FETCH-ACTIVITY-CURSOR.                          08700095
057400                                                                  08710095
057500     IF PS-END-OF-ACTIVITY-CSR                                    08720095
057600       SET RTL-GIFT-CARD-EXCEPTION TO TRUE                        08730095
057700       PERFORM F100-PROCESS-PAGE-BREAK                            08740095
057800       PERFORM E200-PRINT-NO-DETAIL                               08750095
057900       PERFORM E300-PRINT-END-OF-RPT                              08760095
058000       SET RTL-DOLLAR-EXCEPTION TO TRUE                           08770095
058100       PERFORM F100-PROCESS-PAGE-BREAK                            08780095
058200       PERFORM E200-PRINT-NO-DETAIL                               08790095
058300       PERFORM E300-PRINT-END-OF-RPT                              08800095
058400     END-IF.                                                      08810095
058500                                                                  08820095
064400******************************************************************08830095
064500*     B200-PROCESS-EXCEPTIONS                                    *08840095
064600* ==> PROCESSES:                                                 *08850095
064700*     - PROCESSES GIFT CARDS OVER AN INPUTTED AMOUNT.            *08860095
064800*         OR WITH CENTS NOT EQUAL 00.                            *08870095
064900* ==> PERFORMED FROM:  A100-MAINLINE                             *08880095
065000******************************************************************08890095
065100 B200-PROCESS-EXCEPTIONS.                                         08900095
065200                                                                  08910095
065300     IF SVT00002-APP-AUTH-AMT > PV-DOLLARS-OVER OR                08920095
065400        SVT00002-APP-AUTH-AMT < PV-DOLLARS-OVER-NEG               08930095
065500         ADD +1                 TO PA-GFT-CRD-RECS-READ           08940095
065600         SET RTL-GIFT-CARD-EXCEPTION TO TRUE                      08950095
065700         SET PS-EXCEPTION-FOUND TO TRUE                           08960095
065800     END-IF.                                                      08970095
065900                                                                  08980095
066000     MOVE SVT00002-APP-AUTH-AMT TO PV-DOLLARS-CENTS.              08990095
066100                                                                  09000095
066200     IF PV-CENTS = 00                                             09010095
066300         CONTINUE                                                 09020095
066400     ELSE                                                         09030095
066500         IF SVT00002-APP-AUTH-AMT > PV-DOLLARS-OVER OR            09040095
066600            SVT00002-APP-AUTH-AMT < PV-DOLLARS-OVER-NEG           09050095
066700             SET RTL-DOLLAR-EXCEPTION TO TRUE                     09060095
066800             ADD +1 TO PA-DLR-RECS-READ                           09070095
066900             SET PS-EXCEPTION-FOUND TO TRUE                       09080095
067000         END-IF                                                   09090095
067100     END-IF.                                                      09100095
067200                                                                  09110095
067300     IF RTL-GIFT-CARD-EXCEPTION                                   09120095
067400         IF EPCDE-CDE-DESC   NOT = PV-HOLD-GC-TNDR-NME            09130095
067500             SET PS-GC-TNDR-NME-CHANGED TO TRUE                   09140095
067600             SET PS-GC-OPRT-ID-CHANGED   TO TRUE                  09150095
067700             PERFORM F100-PROCESS-PAGE-BREAK                      09160095
067800             MOVE EPCDE-CDE-DESC TO PV-HOLD-TNDR-NME              09170095
067900                                      PV-HOLD-GC-TNDR-NME         09180095
068000             PERFORM E100-PRINT-DETAIL                            09190095
068100         ELSE                                                     09200095
068200             IF SVT00002-POS-OPRT-ID = ZEROES                     09210095
068300                 IF SVT00002-APVL-USR-ID = PV-HOLD-GC-OPRT-ID-X   09220095
068400                     CONTINUE                                     09230095
068500                 ELSE                                             09240095
068600                     MOVE SVT00002-APVL-USR-ID                    09250095
068700                           TO PV-HOLD-GC-OPRT-ID-X                09260095
068800                     SET PS-GC-OPRT-ID-CHANGED TO TRUE            09270095
068900                 END-IF                                           09280095
069000             ELSE                                                 09290095
069100                 IF PV-HOLD-GC-OPRT-ID-X NUMERIC                  09300095
069200                     IF SVT00002-POS-OPRT-ID = PV-HOLD-GC-OPRT-ID 09310095
069300                         CONTINUE                                 09320095
069400                     ELSE                                         09330095
069500                         MOVE SVT00002-POS-OPRT-ID                09340095
069600                               TO PV-HOLD-GC-OPRT-ID              09350095
069700                         SET PS-GC-OPRT-ID-CHANGED TO TRUE        09360095
069800                     END-IF                                       09370095
069900                 ELSE                                             09380095
070000                     MOVE SVT00002-POS-OPRT-ID                    09390095
070100                           TO PV-HOLD-GC-OPRT-ID                  09400095
070200                     SET PS-GC-OPRT-ID-CHANGED TO TRUE            09410095
070300                 END-IF                                           09420095
070400             END-IF                                               09430095
070500             PERFORM E100-PRINT-DETAIL                            09440095
070600         END-IF                                                   09450095
070700     END-IF.                                                      09460095
070800                                                                  09470095
070900     IF RTL-DOLLAR-EXCEPTION                                      09480095
071000         IF EPCDE-CDE-DESC   NOT = PV-HOLD-DLR-TNDR-NME           09490095
071100             SET PS-DLR-TNDR-NME-CHANGED TO TRUE                  09500095
071200             SET PS-DLR-OPRT-ID-CHANGED   TO TRUE                 09510095
071300             PERFORM F100-PROCESS-PAGE-BREAK                      09520095
071400             MOVE EPCDE-CDE-DESC   TO PV-HOLD-TNDR-NME            09530095
071500                                      PV-HOLD-DLR-TNDR-NME        09540095
071600             PERFORM E100-PRINT-DETAIL                            09550095
071700         ELSE                                                     09560095
071800             IF SVT00002-POS-OPRT-ID = ZEROES                     09570095
071900                 IF SVT00002-APVL-USR-ID = PV-HOLD-DLR-OPRT-ID-X  09580095
072000                     CONTINUE                                     09590095
072100                 ELSE                                             09600095
072200                     MOVE SVT00002-APVL-USR-ID                    09610095
072300                           TO PV-HOLD-DLR-OPRT-ID-X               09620095
072400                     SET PS-DLR-OPRT-ID-CHANGED TO TRUE           09630095
072500                 END-IF                                           09640095
072600             ELSE                                                 09650095
072700                 IF PV-HOLD-DLR-OPRT-ID-X NUMERIC                 09660095
072800                     IF SVT00002-POS-OPRT-ID = PV-HOLD-DLR-OPRT-ID09670095
072900                         CONTINUE                                 09680095
073000                     ELSE                                         09690095
073100                         MOVE SVT00002-POS-OPRT-ID                09700095
073200                               TO PV-HOLD-DLR-OPRT-ID             09710095
073300                         SET PS-DLR-OPRT-ID-CHANGED TO TRUE       09720095
073400                     END-IF                                       09730095
073500                 ELSE                                             09740095
073600                     MOVE SVT00002-POS-OPRT-ID                    09750095
073700                           TO PV-HOLD-DLR-OPRT-ID                 09760095
073800                     SET PS-DLR-OPRT-ID-CHANGED TO TRUE           09770095
073900                 END-IF                                           09780095
074000             END-IF                                               09790095
074100             PERFORM E100-PRINT-DETAIL                            09800095
074200         END-IF                                                   09810095
074300     END-IF.                                                      09820095
074400                                                                  09830095
074500     SET PS-EXCEPTION-NOT-FOUND                                   09840095
074600         RTL-NO-EXCEPTION       TO TRUE.                          09850095
074700                                                                  09860095
074800     PERFORM D100-FETCH-ACTIVITY-CURSOR.                          09870095
074900                                                                  09880095
075000******************************************************************09890095
075100*     C100-EOJ-ROUTINE                                           *09900095
075200* ==> PROCESSES:                                                 *09910095
075300*     - CLOSES THE FILES                                         *09920095
075400*     - DISPLAYS THE NUMBER OF RECORDS READ AND WRITTEN          *09930095
075500* ==> PERFORMED FROM:  A100-MAINLINE                             *09940095
075600******************************************************************09950095
075700 C100-EOJ-ROUTINE.                                                09960095
075800                                                                  09970095
075900       SET RTL-GIFT-CARD-EXCEPTION TO TRUE                        09980095
076000       IF PA-GFT-CRD-RECS-READ = 0                                09990095
076100           PERFORM E200-PRINT-NO-DETAIL                           10000095
076200           PERFORM E300-PRINT-END-OF-RPT                          10010095
076300       ELSE                                                       10020095
076400           PERFORM E300-PRINT-END-OF-RPT                          10030095
076500       END-IF                                                     10040095
076600       SET RTL-DOLLAR-EXCEPTION TO TRUE                           10050095
076700       IF PA-DLR-RECS-READ = 0                                    10060095
076800           PERFORM E200-PRINT-NO-DETAIL                           10070095
076900           PERFORM E300-PRINT-END-OF-RPT                          10080095
077000       ELSE                                                       10090095
077100           PERFORM E300-PRINT-END-OF-RPT                          10100095
077200       END-IF                                                     10110095
077300     EXEC SQL                                                     10120095
077400        CLOSE ACTIVITY-CSR                                        10130095
077500     END-EXEC.                                                    10140095
077600                                                                  10150095
077700     EVALUATE TRUE                                                10160095
077800         WHEN SQLCODE NOT = 0                                     10170095
077900         WHEN SQLWARN0    = 'W'                                   10180095
078000             DISPLAY ' '                                          10190095
078100             DISPLAY '** ABEND     **'                            10200095
078200             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        10210095
078300             DISPLAY '** PARAGRAPH **  = C100-EOJ-ROUTINE'        10220095
078400             DISPLAY '** CLOSE ACTIVITY CURSOR'                   10230095
078500             PERFORM Z900-SQL-ABEND                               10240095
078600     END-EVALUATE.                                                10250095
078700                                                                  10260095
W3540C     IF CR-RESTART-IND NOT EQUAL 'R'                              10280095
W3540C                                                                  10290095
W3540C      OPEN OUTPUT CONTROL-TIMESTAMP-FILE                          10300099
W3540C                                                                  10310095
W3540C      MOVE CR-CONTROL-END-TIMESTAMP   TO CONTROL-CARD-END-DATE    10350099
W3540C      MOVE CR-RESTART-IND             TO RESTART-INDICATOR        10360099
W3540C                                                                  10370095
W3540C      WRITE CONTROL-TIMESTAMP-RECORD                              10430099
W3540C                                FROM WRITE-CONTROL-CARD           10440099
W3540C                                                                  10450097
W3540C     DISPLAY 'UPDATED BEG TIMESTAMP END TIMESTAMP RESTART-IND: '  10460099
W3540C              WRITE-CONTROL-CARD                                  10470099
W3540C                                                                  10480099
W3540C      CLOSE CONTROL-TIMESTAMP-FILE                                10490099
W3540C                                                                  10491099
W3540C     END-IF.                                                      10500095
W3540C                                                                  10510095
W3540C     CLOSE CONTROL-DATE-FILE                                      10520095
078900           REPORT-FILE                                            10530095
079000           DOLLAR-REPORT-FILE.                                    10540095
079100                                                                  10550095
079200     DISPLAY ' '.                                                 10560095
079300     DISPLAY PC-PROGRAM-NAME                                      10570095
079400         ' NUMBER OF GIFT CARD RECORDS READ:  '                   10580095
079500                                           PA-GFT-CRD-RECS-READ.  10590095
079600                                                                  10600095
079700     DISPLAY ' '.                                                 10610095
079800     DISPLAY PC-PROGRAM-NAME                                      10620095
079900         ' NUMBER OF DOLLAR GIFT CARD RECORDS READ: '             10630095
080000                                           PA-DLR-RECS-READ.      10640095
080100                                                                  10650095
080200     DISPLAY ' '.                                                 10660095
080300     DISPLAY PC-PROGRAM-NAME                                      10670095
080400         ' NUMBER OF RECORDS FETCHED: '                           10680095
080500                                         PV-RECORDS-FETCHED.      10690095
080600                                                                  10700095
080700******************************************************************10710095
080800*     D100-FETCH-ACTIVITY-CURSOR                                 *10720095
080900* ==> PROCESSES:                                                 *10730095
081000*     - READS ACTIVITY FROM THE SVT_KOHLS_CRD_TXN                *10740095
081100* ==> PERFORMED FROM:  B100-INITIALIZE                           *10750095
081200*                      B200-PROCESS-EXCEPTIONS                   *10760095
081300******************************************************************10770095
081400 D100-FETCH-ACTIVITY-CURSOR.                                      10780095
081500                                                                  10790095
P12431     MOVE 0 TO PV-ORD-NBR-NULL-IND.                               10791099
P12431     MOVE SPACES TO SVT00002-ORD-NBR-TEXT.                        10792099
081500                                                                  10793099
081600     EXEC SQL                                                     10800095
081700         FETCH ACTIVITY-CSR                                       10810095
081800           INTO  :SVT00002-CRD-NBR                                10820095
081900                ,:SVT00002-TRN-AUTH-TMST                          10830095
082000                ,:SVT00002-TRN-VOID-IND                           10840095
082100                ,:SVT00002-STR-NBR                                10850095
082200                ,:SVT00002-POS-TRMNL-NBR                          10860095
082300                ,:SVT00002-POS-TRN-NBR                            10870095
082400                ,:SVT00002-POS-OPRT-ID                            10880095
082500                ,:SVT00002-APVL-USR-ID                            10890095
082600                ,:SVT00002-APP-AUTH-AMT                           10900095
P12431                ,:SVT00002-ORD-NBR :PV-ORD-NBR-NULL-IND           10901099
082700                ,:XST00001-LOC-NM                                 10910095
082800                ,:XST00002-DIST-NBR                               10920095
082900                ,:EPTND-SLS-CORR-SEQ-NBR                          10930095
083000                ,:EPPART-SLS-DTE                                  10940095
083100                ,:EPPART-PARTN-NBR                                10950095
083200                ,:EPTND-TNDR-TYP-CDE                              10960095
083400                ,:EPTND-STR-NBR                                   10980095
083500                ,:EPTND-RGST-ID                                   10990095
083600                ,:EPTND-TRN-NBR                                   11000095
083700                ,:EPCDE-CDE-DESC                                  11010095
083800     END-EXEC.                                                    11020095
083900                                                                  11030095
084000     EVALUATE TRUE                                                11040095
084100         WHEN SQLCODE = +0                                        11050095
084200             COMPUTE PV-RECORDS-FETCHED =                         11060095
084201                          PV-RECORDS-FETCHED + 1                  11070095
084202             CONTINUE                                             11080095
084203         WHEN SQLCODE = +100                                      11090095
084204           SET PS-END-OF-ACTIVITY-CSR TO TRUE                     11100095
084205         WHEN OTHER                                               11110095
084206             MOVE 'D100-FETCH-ACTIVITY-CURSOR     '               11120095
084207                               TO PV-PARAGRAPH-NAME               11130095
084208             MOVE 'READ ROWS FROM SVT_KOHLS_CRD_TXN'              11140095
084209                               TO PV-DB2-OPERATION-ATTEMPTED      11150095
084210             PERFORM Z900-SQL-ABEND                               11160095
084220     END-EVALUATE.                                                11170095
084230                                                                  11180095
084240******************************************************************11190095
084250*     E100-PRINT-DETAIL.                                         *11200095
084260* ==> PROCESSES:                                                 *11210095
084270*     - WRITES THE SINGLE TRANSACTION DETAIL LINES.              *11220095
084280* ==> PERFORMED FROM:  B100-INITIALIZE                           *11230095
084290*                      B200-PROCESS-EXCEPTIONS                   *11240095
084300******************************************************************11250095
084400 E100-PRINT-DETAIL.                                               11260095
084500                                                                  11270095
084600     IF  RTL-GIFT-CARD-EXCEPTION                                  11280095
084700         IF PA-GC-LINE-COUNTER > PC-MAX-LINES-PER-PAGE            11290095
084800             PERFORM F100-PROCESS-PAGE-BREAK                      11300095
084900             SET PS-GC-OPRT-ID-CHANGED   TO TRUE                  11310095
085000             SET PS-GC-TNDR-NME-CHANGED TO TRUE                   11320095
085100         END-IF                                                   11330095
085200         IF PS-GC-OPRT-ID-CHANGED                                 11340095
085300           IF SVT00002-POS-OPRT-ID = ZEROES                       11350095
085400             MOVE SVT00002-APVL-USR-ID TO RDL-OPRT-ID-X           11360095
085500                                          PV-HOLD-GC-OPRT-ID-X    11370095
085600           ELSE                                                   11380095
085700             MOVE SVT00002-POS-OPRT-ID TO RDL-OPRT-ID             11390095
085800                                          PV-HOLD-GC-OPRT-ID      11400095
085900           END-IF                                                 11410095
086000           SET PS-GC-OPRT-ID-NOT-CHANGED TO TRUE                  11420095
086100         ELSE                                                     11430095
086200           MOVE SPACES TO RDL-OPRT-ID-X                           11440095
086300         END-IF                                                   11450095
086400                                                                  11460095
086500         IF PS-GC-TNDR-NME-CHANGED                                11470095
086600           MOVE EPCDE-CDE-DESC   TO RDL-TENDER-NAME               11480095
086700           SET PS-GC-TNDR-NME-NOT-CHANGED TO TRUE                 11490095
086800         ELSE                                                     11500095
086801           MOVE SPACES             TO RDL-TENDER-NAME             11510095
086802         END-IF                                                   11520095
086803     END-IF.                                                      11530095
086804                                                                  11540095
086805     IF RTL-DOLLAR-EXCEPTION                                      11550095
086806         IF PA-DLR-LINE-COUNTER > PC-MAX-LINES-PER-PAGE           11560095
086807             PERFORM F100-PROCESS-PAGE-BREAK                      11570095
086808             SET PS-DLR-OPRT-ID-CHANGED   TO TRUE                 11580095
086809             SET PS-DLR-TNDR-NME-CHANGED TO TRUE                  11590095
086810         END-IF                                                   11600095
086820         IF PS-DLR-OPRT-ID-CHANGED                                11610095
086830           IF SVT00002-POS-OPRT-ID = ZEROES                       11620095
086840             MOVE SVT00002-APVL-USR-ID TO RDL-OPRT-ID-X           11630095
086850                                          PV-HOLD-DLR-OPRT-ID-X   11640095
086860           ELSE                                                   11650095
086870             MOVE SVT00002-POS-OPRT-ID TO RDL-OPRT-ID             11660095
086880                                          PV-HOLD-DLR-OPRT-ID     11670095
086890           END-IF                                                 11680095
086900           SET PS-DLR-OPRT-ID-NOT-CHANGED TO TRUE                 11690095
087000         ELSE                                                     11700095
087100           MOVE SPACES TO RDL-OPRT-ID-X                           11710095
087200         END-IF                                                   11720095
087300                                                                  11730095
087400         IF PS-DLR-TNDR-NME-CHANGED                               11740095
087500           MOVE EPCDE-CDE-DESC     TO RDL-TENDER-NAME             11750095
087600           SET PS-DLR-TNDR-NME-NOT-CHANGED TO TRUE                11760095
087700         ELSE                                                     11770095
087701           MOVE SPACES             TO RDL-TENDER-NAME             11780095
087702         END-IF                                                   11790095
087703     END-IF.                                                      11800095
087704                                                                  11810095
087705     MOVE SVT00002-TRN-AUTH-TMST TO PV-TIMESTAMP-WORK-AREA.       11820095
087706     MOVE PV-TIMESTAMP-WORK-MM TO RDL-ISSUE-DTE-MM.               11830095
087707     MOVE PV-TIMESTAMP-WORK-DD TO RDL-ISSUE-DTE-DD.               11840095
087708     MOVE PV-TIMESTAMP-WORK-YY TO RDL-ISSUE-DTE-YY.               11850095
087709                                                                  11860095
087710     MOVE SVT00002-STR-NBR       TO RDL-STORE-NBR                 11870095
087720     MOVE SVT00002-POS-TRMNL-NBR TO RDL-TERM-NBR.                 11880095
087730     MOVE SVT00002-POS-TRN-NBR   TO RDL-TRN-NBR.                  11890095
087740     MOVE SVT00002-CRD-NBR       TO RDL-CRD-NBR.                  11900095
087750     MOVE SVT00002-TRN-VOID-IND  TO RDL-VOID-IND.                 11910095
087760     MOVE SVT00002-APP-AUTH-AMT  TO RDL-ISSUE-AMT.                11920095
P12431     IF PV-ORD-NBR-NULL-IND < +0                                  11930099
P12431        MOVE SPACES                TO RDL-ORD-NBR                 11931099
P12431     ELSE                                                         11932099
P12431        MOVE SVT00002-ORD-NBR-TEXT TO RDL-ORD-NBR                 11933099
P12431     END-IF.                                                      11934099
087770                                                                  11936099
087780     IF  RTL-GIFT-CARD-EXCEPTION                                  11940095
087790         WRITE REPORT-RECORD                                      11950095
087800           FROM REPORT-DETAIL-LINE                                11960095
087900           AFTER ADVANCING 1 LINE                                 11970095
088000         ADD PC-ONE TO PA-GC-LINE-COUNTER                         11980095
088100     END-IF.                                                      11990095
088200                                                                  12000095
088300     IF RTL-DOLLAR-EXCEPTION                                      12010095
088400         WRITE DOLLAR-REPORT-RECORD                               12020095
088500           FROM REPORT-DETAIL-LINE                                12030095
088600           AFTER ADVANCING 1 LINE                                 12040095
088700         ADD PC-ONE TO PA-DLR-LINE-COUNTER                        12050095
088800     END-IF.                                                      12060095
088900                                                                  12070095
089000                                                                  12080095
089100******************************************************************12090095
089200*     E200-PRINT-NO-DETAIL.                                      *12100095
089300* ==> PROCESSES:                                                 *12110095
089400*     - WRITES A LINE INDICATING THAT THERE WERE NO DETAIL       *12120095
089500*       RECORDS FOUND FOR THE GIVEN CRITERIA.                    *12130095
089600* ==> PERFORMED FROM:  B100-INITIALIZE                           *12140095
089700******************************************************************12150095
089800 E200-PRINT-NO-DETAIL.                                            12160095
089900                                                                  12170095
090000     IF  RTL-GIFT-CARD-EXCEPTION                                  12180095
090100         MOVE CR-DOLLAR-OVER-VALUE TO RDL-NO-DET-OVER             12190095
090200         WRITE REPORT-RECORD                                      12200095
090300           FROM REPORT-NO-DETAIL-LINE                             12210095
090400           AFTER ADVANCING 1 LINE                                 12220095
090500         ADD PC-ONE TO PA-GC-LINE-COUNTER                         12230095
090600     END-IF.                                                      12240095
090700                                                                  12250095
090800     IF RTL-DOLLAR-EXCEPTION                                      12260095
090900         WRITE DOLLAR-REPORT-RECORD                               12270095
091000           FROM REPORT-NON-ZERO-CENTS-DTL-LINE                    12280095
091100           AFTER ADVANCING 1 LINE                                 12290095
091200         ADD PC-ONE TO PA-DLR-LINE-COUNTER                        12300095
091300     END-IF.                                                      12310095
091400                                                                  12320095
091500                                                                  12330095
091600******************************************************************12340095
091700*     E300-PRINT-END-OF-RPT.                                     *12350095
091800* ==> PROCESSES:                                                 *12360095
091900*     - WRITES A MESSAGE INDICATING THE END OF THE REPORT HAS    *12370095
092000*       BEEN REACHED.                                            *12380095
092100* ==> PERFORMED FROM:  B100-INITIALIZE                           *12390095
092200*                      B200-PROCESS-EXCEPTIONS                   *12400095
092300******************************************************************12410095
092400 E300-PRINT-END-OF-RPT.                                           12420095
092500                                                                  12430095
092600     IF  RTL-GIFT-CARD-EXCEPTION                                  12440095
092700         WRITE REPORT-RECORD                                      12450095
092800           FROM REPORT-END-OF-DETAIL-LINE                         12460095
092900           AFTER ADVANCING 3 LINES                                12470095
093000         ADD PC-THREE TO PA-GC-LINE-COUNTER                       12480095
093100     END-IF.                                                      12490095
093200                                                                  12500095
093300     IF RTL-DOLLAR-EXCEPTION                                      12510095
093400         WRITE DOLLAR-REPORT-RECORD                               12520095
093500           FROM REPORT-END-OF-DETAIL-LINE                         12530095
093600           AFTER ADVANCING 3 LINES                                12540095
093700         ADD PC-THREE TO PA-DLR-LINE-COUNTER                      12550095
093800     END-IF.                                                      12560095
093900                                                                  12570095
094000                                                                  12580095
094100******************************************************************12590095
094200*     F100-PROCESS-PAGE-BREAK.                                   *12600095
094300* ==> PROCESSES:                                                 *12610095
094400*     - ADVANCES TO A NEW PAGE AND WRITES THE REPORT HEADINGS    *12620095
094500* ==> PERFORMED FROM:  B100-INITIALIZE                           *12630095
094600*                      E100-PRINT-DETAIL                         *12640095
094700******************************************************************12650095
094800 F100-PROCESS-PAGE-BREAK.                                         12660095
094900                                                                  12670095
095000     IF  RTL-GIFT-CARD-EXCEPTION                                  12680095
095100         ADD PC-ONE                TO PA-GC-PAGE-COUNTER          12690095
P12431         MOVE PA-GC-PAGE-COUNTER   TO DP200O-PAGE-NUMBER          12700099
095300                                                                  12710095
095400         MOVE PC-HEADER-LINE-COUNT TO PA-GC-LINE-COUNTER          12720095
095500                                                                  12730095
P12431         MOVE 1                TO DP200O-REPORT-NUMBER            12740099
095700         WRITE REPORT-RECORD                                      12750095
P12431             FROM DP200O-STANDRD-HEADER-200-COLS                  12760099
095900             AFTER ADVANCING PAGE                                 12770095
096000                                                                  12780095
P12431         INITIALIZE DP200O-LASER-NEW-PAGE-INDICATR                12790099
096200                                                                  12800095
096300         WRITE REPORT-RECORD                                      12810095
096400             FROM REPORT-TITLE-LINE                               12820095
096500             AFTER ADVANCING 1 LINE                               12830095
096600                                                                  12840095
096700         WRITE REPORT-RECORD                                      12850095
096800             FROM REPORT-SUBTITLE-LINE                            12860095
096900             AFTER ADVANCING 1 LINE                               12870095
097000                                                                  12880095
097100         WRITE REPORT-RECORD                                      12890095
097200             FROM REPORT-DETAIL-HEADER                            12900095
097300             AFTER ADVANCING 2 LINES                              12910095
097400         ADD PC-FOUR  TO PA-GC-LINE-COUNTER                       12920095
097500     END-IF.                                                      12930095
097600                                                                  12940095
097700     IF RTL-DOLLAR-EXCEPTION                                      12950095
097800         ADD PC-ONE                TO PA-DLR-PAGE-COUNTER         12960095
P12431         MOVE PA-DLR-PAGE-COUNTER  TO DP200O-PAGE-NUMBER          12970099
098000                                                                  12980095
098100         MOVE PC-HEADER-LINE-COUNT TO PA-DLR-LINE-COUNTER         12990095
098200                                                                  13000095
P12431         MOVE 2                TO DP200O-REPORT-NUMBER            13010099
098400         WRITE DOLLAR-REPORT-RECORD                               13020095
P12431             FROM DP200O-STANDRD-HEADER-200-COLS                  13030099
098600             AFTER ADVANCING PAGE                                 13040095
098700                                                                  13050095
P12431         INITIALIZE DP200O-LASER-NEW-PAGE-INDICATR                13060099
098900                                                                  13070095
099000         WRITE DOLLAR-REPORT-RECORD                               13080095
099100             FROM REPORT-TITLE-LINE                               13090095
099200             AFTER ADVANCING 1 LINE                               13100095
099300                                                                  13110095
099400         WRITE DOLLAR-REPORT-RECORD                               13120095
099500             FROM REPORT-SUBTITLE-LINE                            13130095
099600             AFTER ADVANCING 1 LINE                               13140095
099700                                                                  13150095
099800         WRITE DOLLAR-REPORT-RECORD                               13160095
099900             FROM REPORT-DETAIL-HEADER                            13170095
100000             AFTER ADVANCING 2 LINES                              13180095
100100         ADD PC-FOUR  TO PA-DLR-LINE-COUNTER                      13190095
100200     END-IF.                                                      13200095
100300                                                                  13210095
100400******************************************************************13220095
100500*     Z900-SQL-ABEND                                             *13230095
100600* ==> PROCESSES:                                                 *13240095
100700*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *13250095
100800* ==> PERFORMED FROM:  B100-INITIALIZE                           *13260095
100900*                      C100-EOJ-ROUTINE                          *13270095
101000*                      D100-FETCH-ACTIVITY-CURSOR                *13280095
101100******************************************************************13290095
101200 Z900-SQL-ABEND.                                                  13300095
101300                                                                  13310095
101400     DISPLAY 'Z900-SQL-ABEND'.                                    13320095
101500     DISPLAY ' '.                                                 13330095
101600     DISPLAY '**  ABEND     **'.                                  13340095
101700     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               13350095
101800     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             13360095
101900     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    13370095
102000                                                                  13380095
102100******************************************************************13390095
102200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *13400095
102300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *13410095
102400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *13420095
102500* FORMAT.                                                        *13430095
102600******************************************************************13440095
102700     COPY DPPD004.                                                13450095
102800                                                                  13460095
102900     MOVE +4013 TO ABEND-CODE.                                    13470095
103000     CALL 'ILBOABN0' USING ABEND-CODE.                            13480095
