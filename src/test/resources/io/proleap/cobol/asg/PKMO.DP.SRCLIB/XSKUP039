000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XSKUP039.                                         00020000
000300 AUTHOR.        BARB ERTL.                                        00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  10/15/2002.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800**       STORE MESSAGE TO POPULATE XST_LOC, XST_LOC_DIST, AND     00080038
000900**       XST_LOC_ATTR                                             00090038
001000******************************************************************00100000
001100**THIS IS A CALLED MODULE FOR LOCATION TABLES.  THIS PROGRAM      00110000
001200**     WILL PERFORM UPDATES/INSERTS/DELETES FOR THE XST_LOC,      00120005
001300**     XST_LOC_DIST AND XST_LOC_ATTR TABLES.                      00130038
001400**     IT DOES THE FOLLOWING WITH THESE RETURN CODES:             00140005
001500**     0000 - END PROGRAM                                         00150000
001600**    -0530 - END PROGRAM                                         00160000
001700**    -0803 - END PROGRAM                                         00170000
001800**    -0911 - RETRY INSERT UP TO 5 TIMES AND THEN END PROGRAM     00180000
001900**                                                                00190032
002000******************************************************************00200038
002100 ENVIRONMENT DIVISION.                                            00210000
002200 CONFIGURATION SECTION.                                           00220000
002300 SOURCE-COMPUTER.  IBM-3090.                                      00230000
002400 OBJECT-COMPUTER.  IBM-3090.                                      00240000
002500 DATA DIVISION.                                                   00250000
002600                                                                  00260000
002700 WORKING-STORAGE SECTION.                                         00270000
002800******************************************************************00280000
002900**PROGRAM SWITCHES                                                00290000
003000******************************************************************00300000
003100 01  PS-PROGRAM-SWITCHES.                                         00310000
003200     05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00320000
003300         88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00330000
003400         88  PS-PROCESS-COMPLETE                VALUE 'N'.        00340000
003500******************************************************************00350000
003600**PROGRAM CONSTANTS                                               00360000
003700******************************************************************00370000
003800 01  PC-PROGRAM-CONSTANTS.                                        00380000
003900     05  PC-PROGRAM-NAME             PIC X(08)  VALUE 'XSKUP039'. 00390029
004000     05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00400000
004100     05  PC-DEPT-STR                 PIC X(02)  VALUE 'DS'.       00410003
004200     05  PC-OSA-LS-STFNG-CDE         PIC X(02)  VALUE '01'.       00420034
004210     05  PC-TX-APPL-CDE              PIC X(01)  VALUE 'N'.        00421039
004220     05  PC-GEO-CDE                  PIC X(02)  VALUE '00'.       00422039
004230     05  PC-TX-ALT-ZIP-10-CDE        PIC X(10)  VALUE SPACES.     00423039
004300******************************************************************00430000
004400**PROGRAM VARIABLES                                               00440000
004500******************************************************************00450000
004600 01  PV-PROGRAM-VARIABLES.                                        00460000
004700     05  PV-RETRY-COUNTER               PIC  9(01)  VALUE ZEROS.  00470000
004800     05  PV-4-COMP-3                    PIC S9(04) COMP-3 VALUE 0.00480000
004900     05  PV-LOC-DIST-IND                PIC  X(01)  VALUE SPACES. 00490000
005000     05  PV-BEG-DTE                     PIC  X(10)  VALUE SPACES. 00500023
005100                                                                  00510013
005200******************************************************************00520000
005300**COPYBOOKS                                                       00530000
005400******************************************************************00540000
005500***DB2 MESSAGE AREA                                               00550000
005600     COPY SQLCA2.                                                 00560032
005700***MESSAGE COPYBOOK                                               00570000
005800     COPY HORD100.                                                00580032
005900***KOHL'S CALENDAR ROUTINE COPYBOOK                               00590029
006000     COPY DPWS500.                                                00600032
006100******************************************************************00610000
006200**DB2 TABLES                                                      00620010
006300******************************************************************00630000
006400***DB2 COMMUNICATIONS AREA                                        00640000
006500     EXEC SQL                                                     00650000
006600          INCLUDE SQLCA                                           00660000
006700     END-EXEC.                                                    00670000
006800* ------------------------------------------------------------- * 00680010
006900*  SQL AND COBOL DECLARATIONS FOR LOCATION TABLE (XST_LOC)        00690010
007000* ------------------------------------------------------------- * 00700010
007100     EXEC SQL                                                     00710010
007200         INCLUDE XST00001                                         00720010
007300     END-EXEC.                                                    00730010
007400                                                                  00740010
007500* ------------------------------------------------------------- * 00750000
007600*  SQL AND COBOL DECLARATIONS FOR LOCATION/DISTRICT TABLE         00760000
007700*  (XST_LOC_DIST)                                                 00770000
007800* ------------------------------------------------------------- * 00780000
007900     EXEC SQL                                                     00790000
008000         INCLUDE XST00002                                         00800000
008100     END-EXEC.                                                    00810000
008200                                                                  00820000
008300* ------------------------------------------------------------- * 00830000
008400*  SQL AND COBOL DECLARATIONS FOR LOCATION ATTRIBUTE TABLE        00840000
008500*  (XST_LOC_ATTR)                                                 00850000
008600* ------------------------------------------------------------- * 00860000
008700     EXEC SQL                                                     00870000
008800         INCLUDE XST00025                                         00880000
008900     END-EXEC.                                                    00890000
009000                                                                  00900000
009100 LINKAGE SECTION.                                                 00910000
009200******************************************************************00920000
009300**LINKAGE VARIABLES                                               00930000
009400******************************************************************00940000
009500 01  LV-LINKAGE-VARIABLES.                                        00950009
009600     05  LV-HORD100-RECORD               PIC X(500).              00960009
009700     05  LV-RETURN-CODE                  PIC S9(04).              00970009
009800                                                                  00980000
009900 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   00990009
010000******************************************************************01000000
010100 0000-MAINLINE.                                                   01010000
010200                                                                  01020000
010300      PERFORM 1000-INITIALIZATION.                                01030000
010400      IF PS-PROCESS-CONTINUE                                      01040029
010500          PERFORM 2000-PROCESS-MESSAGE                            01050029
010600      END-IF.                                                     01060029
010700      PERFORM 9999-WRAPUP.                                        01070000
010800                                                                  01080000
010900***************************************************************** 01090000
011000**INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                01100000
011100***************************************************************** 01110000
011200 1000-INITIALIZATION.                                             01120000
011300                                                                  01130000
011400     INITIALIZE PV-RETRY-COUNTER.                                 01140000
011500     SET PS-PROCESS-CONTINUE TO TRUE.                             01150025
011600                                                                  01160000
011700     MOVE LV-HORD100-RECORD          TO HORD100-RECORD.           01170000
011800                                                                  01180000
011900     INITIALIZE DCLXST00001                                       01190013
012000                DCLXST00025.                                      01200000
012100                                                                  01210000
012200     MOVE HO100-STR-NBR             TO XST00001-LOC-NBR           01220037
012300                                       XST00002-LOC-NBR           01230037
012400                                       XST00025-LOC-NBR.          01240037
012500     MOVE HO100-STR-DISTRICT        TO XST00002-DIST-NBR.         01250037
012600     MOVE PC-DEPT-STR               TO XST00001-LOC-TYP-CDE.      01260000
012700     MOVE HO100-STR-NAME            TO XST00001-LOC-NM.           01270037
012800     MOVE HO100-STR-NAME10          TO XST00001-LOC-10-ABBR-NM.   01280037
012900     MOVE HO100-STR-ADD1            TO XST00001-LNE-1-ADDR.       01290037
013000     MOVE HO100-STR-ADD2            TO XST00001-LNE-2-ADDR.       01300037
013100     MOVE HO100-STR-CITY            TO XST00001-CTY-NM.           01310037
013200     MOVE HO100-STR-STATE-1-2       TO XST00001-ST-CDE.           01320037
013300     MOVE HO100-STR-PCODE           TO XST00001-ZIP-10-CDE.       01330037
013400     MOVE HO100-STR-PHONE-NUMBER    TO XST00001-PHN-NBR.          01340037
013500     MOVE HO100-STR-MGR-NAME        TO XST00001-MGR-NM.           01350037
013600     MOVE HO100-STR-OPEN-DATE       TO XST00001-OPN-DTE.          01360037
013700     MOVE HO100-STR-CLOSE-DATE      TO XST00001-CLO-DTE.          01370037
013800     MOVE HO100-STR-FORMAT          TO XST00001-FMT-CDE.          01380037
013900     MOVE 'Y'                       TO XST00025-AUTO-PHN-SYS-IND. 01390026
014000     MOVE 'M'                       TO XST00025-CS-VOL-LVL-CDE.   01400026
014100     MOVE 0                         TO XST00025-CSH-RFND-GP-NBR   01410031
014200                                       XST00025-CK-AUTH-GP-NBR.   01420042
014100     MOVE 0                         TO XST00025-CRD-AUTH-GP-NBR.  01422045
014300     MOVE PC-OSA-LS-STFNG-CDE       TO XST00025-OSA-LS-STFNG-CDE. 01430034
014310     MOVE PC-TX-APPL-CDE            TO XST00025-TX-APPL-CDE.      01431039
014320     MOVE PC-GEO-CDE                TO XST00025-GEO-CDE.          01432039
014330     MOVE PC-TX-ALT-ZIP-10-CDE      TO XST00025-TX-ALT-ZIP-10-CDE.01433039
014400                                                                  01440034
014500     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01450029
014600                                                                  01460029
014700     EXEC SQL                                                     01470029
014800         SET :DPG52-LK-DATE-INPUT = CURRENT DATE                  01480029
014900     END-EXEC.                                                    01490029
015000                                                                  01500029
015100     SET DPG51-FISCAL-454-CALENDAR                                01510029
015200         DPG52-LK-DTE-ISO-FMT TO TRUE.                            01520029
015300                                                                  01530029
015400     PERFORM 1500-CALL-CALENDAR-ROUTINE.                          01540029
015500                                                                  01550029
015600     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO XST00002-BEG-DTE.         01560029
015700                                                                  01570029
015800     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01580029
015900                                                                  01590029
016000     MOVE XST00002-BEG-DTE TO DPG52-LK-DATE-INPUT.                01600029
016100                                                                  01610029
016200     SET DPG51-ACTUAL-CALENDAR-ONLY                               01620029
016300         DPG51-DECREMENT-DATE                                     01630029
016400         DPG52-LK-DTE-ISO-FMT TO TRUE.                            01640029
016500                                                                  01650029
016600     MOVE 1 TO DPG51-INCR-DECR-DAYS-9.                            01660029
016700                                                                  01670029
016800     PERFORM 1500-CALL-CALENDAR-ROUTINE.                          01680029
016900                                                                  01690029
017000     MOVE DPG55-DB2-ISO-DATE-FMT TO XST00002-END-DTE.             01700029
017100                                                                  01710029
017200***************************************************************** 01720029
017300**CALL CALENDAR ROUTINE FOR BEGINNING AND ENDING DATES.           01730029
017400***************************************************************** 01740029
017500 1500-CALL-CALENDAR-ROUTINE.                                      01750029
017600                                                                  01760029
017700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                01770029
017800                                             DPG52                01780029
017900                                             DPG53                01790029
018000                                             DPG54                01800029
018100                                             DPG55                01810029
018200                                             DPG56.               01820029
018300                                                                  01830029
018400     EVALUATE TRUE                                                01840029
018500         WHEN DPG54-SEVERE-ERROR                                  01850029
018600         WHEN DPG54-WARNING-ERROR                                 01860029
018700             DISPLAY ' '                                          01870029
018800             DISPLAY '** ABEND     **'                            01880029
018900             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        01890029
019000             DISPLAY '** PARAGRAPH **  = '                        01900029
019100                                    '1500-CALL-CALENDAR-ROUTINE'  01910029
019200             DISPLAY '** BAD CALL TO CALENDAR MODULE '            01920029
019300                     DP500-KOHLS-CALENDAR-ROUTINE                 01930029
019400             DISPLAY '** DETERMINE VALID DATE **'                 01940029
019500             DISPLAY 'DATE = ' DPG52-LK-DATE-INPUT                01950029
019600             DISPLAY DPG54-ERROR-MESSAGE                          01960029
019700             DISPLAY ' '                                          01970029
019800             SET PS-PROCESS-COMPLETE TO TRUE                      01980029
019900             MOVE +4019 TO LV-RETURN-CODE                         01990029
020000     END-EVALUATE.                                                02000029
020100                                                                  02010029
020200***************************************************************** 02020000
020300**MAIN PROGRAM LOGIC - READS ACTION TYPE ON HORD100 RECORD        02030000
020400***************************************************************** 02040000
020500 2000-PROCESS-MESSAGE.                                            02050000
020600                                                                  02060000
020700     EVALUATE TRUE                                                02070000
020800        WHEN HO100-ACTN-TYP-INSERT                                02080000
020900             PERFORM 2100-INSERT-DATA                             02090037
021000             IF PS-PROCESS-CONTINUE                               02100000
021100                 PERFORM 4000-INSERT-LOC-ATTR                     02110028
021200                 IF PS-PROCESS-CONTINUE                           02120028
021300                     IF HO100-STR-DISTRICT EQUAL ZEROES           02130028
021400                         SET PS-PROCESS-COMPLETE TO TRUE          02140028
021500                     ELSE                                         02150028
021600                         PERFORM 2500-INSERT-LOC-DIST             02160028
021700                     END-IF                                       02170028
021800                 END-IF                                           02180028
021900             END-IF                                               02190000
022000                                                                  02200000
022100        WHEN HO100-ACTN-TYP-UPDATE                                02210000
022200             PERFORM 2200-UPDATE-DATA                             02220037
022300             IF PS-PROCESS-CONTINUE                               02230000
022400                 IF HO100-STR-DISTRICT EQUAL ZEROES               02240000
022500                     SET PS-PROCESS-COMPLETE TO TRUE              02250000
022600                 ELSE                                             02260000
022700                     MOVE 0      TO PV-4-COMP-3                   02270023
022800                     MOVE SPACES TO PV-BEG-DTE                    02280023
022900                     PERFORM 2600-SELECT-LOC-DIST-ROW             02290010
023000                     IF PV-4-COMP-3 = XST00002-DIST-NBR           02300000
023100                         SET PS-PROCESS-COMPLETE TO TRUE          02310000
023200                     ELSE                                         02320000
023300                         IF PV-4-COMP-3 = 0                       02330000
023400                             PERFORM 2500-INSERT-LOC-DIST         02340010
023500                         ELSE                                     02350000
023600                             IF PV-BEG-DTE < XST00002-BEG-DTE     02360030
023700                                 PERFORM 2700-UPDATE-LOC-DIST-ROW 02370023
023800                             ELSE                                 02380023
023900                                 PERFORM 2800-DELETE-LOC-DIST-ROW 02390023
024000                             END-IF                               02400023
024100                             IF PS-PROCESS-CONTINUE               02410000
024200                                 PERFORM 2500-INSERT-LOC-DIST     02420010
024300                             END-IF                               02430000
024400                         END-IF                                   02440000
024500                     END-IF                                       02450000
024600                 END-IF                                           02460000
024700             END-IF                                               02470000
024800                                                                  02480000
024900        WHEN HO100-ACTN-TYP-DELETE                                02490000
025000             PERFORM 2400-SELECT-LOC-DIST                         02500000
025100             IF PS-PROCESS-CONTINUE                               02510000
025200                 PERFORM 4100-DELETE-LOC-ATTR                     02520006
025300                 IF PS-PROCESS-CONTINUE                           02530006
025400                     PERFORM 2300-DELETE-DATA                     02540006
025500                 END-IF                                           02550006
025600             END-IF                                               02560000
025700     END-EVALUATE.                                                02570000
025800                                                                  02580000
025900***************************************************************** 02590000
026000**INSERT ACTION TYPE                                              02600000
026100***************************************************************** 02610000
026200 2100-INSERT-DATA.                                                02620000
026300                                                                  02630000
026400     PERFORM                                                      02640000
026500         WITH TEST AFTER                                          02650000
026600         VARYING PV-RETRY-COUNTER                                 02660000
026700         FROM 1 BY 1                                              02670000
026800         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    02680000
026900            OR SQLCODE = 0                                        02690000
027000            OR PS-PROCESS-COMPLETE                                02700000
027100                                                                  02710000
027200        EXEC SQL                                                  02720000
027300          INSERT INTO XST_LOC                                     02730000
027400              (LOC_NBR                                            02740000
027500             , LOC_TYP_CDE                                        02750000
027600             , LOC_NM                                             02760000
027700             , LOC_5_ABBR_NM                                      02770015
027800             , LOC_10_ABBR_NM                                     02780000
027900             , LNE_1_ADDR                                         02790000
028000             , LNE_2_ADDR                                         02800000
028100             , CTY_NM                                             02810000
028200             , ST_CDE                                             02820000
028300             , ZIP_10_CDE                                         02830000
028400             , PHN_NBR                                            02840000
028500             , MGR_NM                                             02850000
028600             , OPN_DTE                                            02860000
028700             , CLO_DTE                                            02870000
028800             , FMT_CDE                                            02880004
028900             , LAST_UPD_TMST)                                     02890000
029000     VALUES                                                       02900000
029100            ( : XST00001-LOC-NBR                                  02910000
029200            , : XST00001-LOC-TYP-CDE                              02920000
029300            , : XST00001-LOC-NM                                   02930000
029400            , : XST00001-LOC-5-ABBR-NM                            02940015
029500            , : XST00001-LOC-10-ABBR-NM                           02950000
029600            , : XST00001-LNE-1-ADDR                               02960000
029700            , : XST00001-LNE-2-ADDR                               02970000
029800            , : XST00001-CTY-NM                                   02980000
029900            , : XST00001-ST-CDE                                   02990000
030000            , : XST00001-ZIP-10-CDE                               03000000
030100            , : XST00001-PHN-NBR                                  03010000
030200            , : XST00001-MGR-NM                                   03020000
030300            , : XST00001-OPN-DTE                                  03030000
030400            , : XST00001-CLO-DTE                                  03040000
030500            , : XST00001-FMT-CDE                                  03050004
030600            , CURRENT TIMESTAMP)                                  03060000
030700        END-EXEC                                                  03070000
030800                                                                  03080000
030900         EVALUATE TRUE                                            03090000
031000             WHEN SQLCODE = -911                                  03100000
031100             WHEN SQLCODE = -913                                  03110000
031200             WHEN SQLCODE = 0                                     03120000
031300                 CONTINUE                                         03130000
031400             WHEN SQLWARN0 NOT = SPACE                            03140000
031500             WHEN SQLCODE NOT =  ZERO                             03150000
031600                 SET PS-PROCESS-COMPLETE TO TRUE                  03160000
031700         END-EVALUATE                                             03170000
031800     END-PERFORM.                                                 03180000
031900                                                                  03190000
032000     EVALUATE TRUE                                                03200000
032100        WHEN SQLCODE = 0                                          03210000
032200            CONTINUE                                              03220000
032300        WHEN OTHER                                                03230000
032400             SET PS-PROCESS-COMPLETE     TO TRUE                  03240000
032500     END-EVALUATE.                                                03250000
032600                                                                  03260000
032700******************************************************************03270000
032800**UPDATE ACTION TYPE                                              03280000
032900******************************************************************03290000
033000 2200-UPDATE-DATA.                                                03300000
033100                                                                  03310000
033200     PERFORM                                                      03320000
033300         WITH TEST AFTER                                          03330000
033400         VARYING PV-RETRY-COUNTER                                 03340000
033500         FROM 1 BY 1                                              03350000
033600         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    03360000
033700            OR SQLCODE = 0                                        03370000
033800            OR PS-PROCESS-COMPLETE                                03380000
033900                                                                  03390000
034000        EXEC SQL                                                  03400000
034100          UPDATE XST_LOC                                          03410000
034200          SET LOC_TYP_CDE        = : XST00001-LOC-TYP-CDE         03420000
034300             ,LOC_NM             = : XST00001-LOC-NM              03430000
034400             ,LOC_10_ABBR_NM     = : XST00001-LOC-10-ABBR-NM      03440000
034500             ,LNE_1_ADDR         = : XST00001-LNE-1-ADDR          03450000
034600             ,LNE_2_ADDR         = : XST00001-LNE-2-ADDR          03460000
034700             ,CTY_NM             = : XST00001-CTY-NM              03470000
034800             ,ST_CDE             = : XST00001-ST-CDE              03480000
034900             ,ZIP_10_CDE         = : XST00001-ZIP-10-CDE          03490000
035000             ,PHN_NBR            = : XST00001-PHN-NBR             03500000
035100             ,MGR_NM             = : XST00001-MGR-NM              03510000
035200             ,OPN_DTE            = : XST00001-OPN-DTE             03520000
035300             ,CLO_DTE            = : XST00001-CLO-DTE             03530000
035400             ,FMT_CDE            = : XST00001-FMT-CDE             03540000
035500             ,LAST_UPD_TMST      = CURRENT TIMESTAMP              03550000
035600              WHERE  (LOC_NBR = : XST00001-LOC-NBR)               03560000
035700           END-EXEC                                               03570000
035800                                                                  03580000
035900         EVALUATE TRUE                                            03590000
036000             WHEN SQLCODE = -911                                  03600000
036100             WHEN SQLCODE = -913                                  03610000
036200             WHEN SQLCODE = 0                                     03620000
036300                 CONTINUE                                         03630000
036400             WHEN SQLWARN0 NOT = SPACE                            03640000
036500             WHEN SQLCODE NOT =  ZERO                             03650000
036600                 SET PS-PROCESS-COMPLETE TO TRUE                  03660000
036700         END-EVALUATE                                             03670000
036800     END-PERFORM.                                                 03680000
036900                                                                  03690000
037000     EVALUATE TRUE                                                03700000
037100        WHEN SQLCODE = 0                                          03710000
037200            CONTINUE                                              03720000
037300        WHEN OTHER                                                03730000
037400             SET PS-PROCESS-COMPLETE     TO TRUE                  03740000
037500     END-EVALUATE.                                                03750000
037600                                                                  03760000
037700******************************************************************03770000
037800**DELETE TYPE ACTION                                              03780000
037900******************************************************************03790000
038000 2300-DELETE-DATA.                                                03800000
038100                                                                  03810000
038200     PERFORM                                                      03820000
038300         WITH TEST AFTER                                          03830000
038400         VARYING PV-RETRY-COUNTER                                 03840000
038500         FROM 1 BY 1                                              03850000
038600         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    03860000
038700            OR SQLCODE = 0                                        03870000
038800            OR PS-PROCESS-COMPLETE                                03880000
038900                                                                  03890000
039000           EXEC SQL                                               03900000
039100               DELETE FROM XST_LOC                                03910002
039200             WHERE  (LOC_NBR = :XST00001-LOC-NBR)                 03920002
039300           END-EXEC                                               03930000
039400                                                                  03940000
039500         EVALUATE TRUE                                            03950000
039600             WHEN SQLCODE = -911                                  03960000
039700             WHEN SQLCODE = -913                                  03970000
039800             WHEN SQLCODE = 0                                     03980000
039900                 CONTINUE                                         03990000
040000             WHEN SQLWARN0 NOT = SPACE                            04000000
040100             WHEN SQLCODE NOT =  ZERO                             04010000
040200                 SET PS-PROCESS-COMPLETE TO TRUE                  04020000
040300         END-EVALUATE                                             04030000
040400     END-PERFORM.                                                 04040000
040500                                                                  04050000
040600     SET PS-PROCESS-COMPLETE     TO TRUE.                         04060006
040700                                                                  04070006
040800******************************************************************04080000
040900**SELECT LOC_DIST ROW FOR DELETED LOCATION                        04090002
041000******************************************************************04100000
041100 2400-SELECT-LOC-DIST.                                            04110000
041200                                                                  04120000
041300     EXEC SQL                                                     04130000
041400         SELECT 'Y'                                               04140000
041500           INTO :PV-LOC-DIST-IND                                  04150000
041600           FROM XST_LOC_DIST                                      04160002
041700          WHERE  LOC_NBR = :XST00002-LOC-NBR                      04170002
041800     END-EXEC                                                     04180000
041900                                                                  04190000
042000     EVALUATE TRUE                                                04200000
042100        WHEN SQLCODE = 0                                          04210000
042200        WHEN SQLCODE = -811                                       04220000
042300            SET PS-PROCESS-COMPLETE     TO TRUE                   04230000
042400        WHEN OTHER                                                04240000
042500            CONTINUE                                              04250000
042600     END-EVALUATE.                                                04260000
042700                                                                  04270000
042800******************************************************************04280000
042900**INSERT LOC_DIST  ROW                                            04290007
043000******************************************************************04300000
043100 2500-INSERT-LOC-DIST.                                            04310010
043200                                                                  04320000
043300     PERFORM                                                      04330000
043400         WITH TEST AFTER                                          04340000
043500         VARYING PV-RETRY-COUNTER                                 04350000
043600         FROM 1 BY 1                                              04360000
043700         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    04370000
043800            OR SQLCODE = 0                                        04380000
043900            OR PS-PROCESS-COMPLETE                                04390000
044000                                                                  04400000
044100           EXEC SQL                                               04410000
044200               INSERT INTO XST_LOC_DIST                           04420002
044300                        (LOC_NBR                                  04430002
044400                       , DIST_NBR                                 04440002
044500                       , BEG_DTE)                                 04450000
044600               VALUES (: XST00002-LOC-NBR                         04460002
044700                     , : XST00002-DIST-NBR                        04470002
044800                     , : XST00002-BEG-DTE)                        04480023
044900           END-EXEC                                               04490000
045000                                                                  04500000
045100         EVALUATE TRUE                                            04510000
045200             WHEN SQLCODE = -911                                  04520000
045300             WHEN SQLCODE = -913                                  04530000
045400             WHEN SQLCODE = 0                                     04540000
045500                 CONTINUE                                         04550000
045600             WHEN SQLWARN0 NOT = SPACE                            04560000
045700             WHEN SQLCODE NOT =  ZERO                             04570000
045800                 SET PS-PROCESS-COMPLETE TO TRUE                  04580000
045900         END-EVALUATE                                             04590000
046000     END-PERFORM.                                                 04600000
046100                                                                  04610000
046200     SET PS-PROCESS-COMPLETE TO TRUE.                             04620000
046300                                                                  04630000
046400******************************************************************04640000
046500**SELECT CURRENT LOC_DIST ROW                                     04650000
046600******************************************************************04660000
046700 2600-SELECT-LOC-DIST-ROW.                                        04670010
046800                                                                  04680000
046900     PERFORM                                                      04690000
047000         WITH TEST AFTER                                          04700000
047100         VARYING PV-RETRY-COUNTER                                 04710000
047200         FROM 1 BY 1                                              04720000
047300         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    04730000
047400            OR SQLCODE = 0                                        04740000
047500            OR SQLCODE = +100                                     04750000
047600            OR PS-PROCESS-COMPLETE                                04760000
047700                                                                  04770000
047800         EXEC SQL                                                 04780000
047900           SELECT DIST_NBR                                        04790000
048000                 ,BEG_DTE                                         04800023
048100             INTO :PV-4-COMP-3                                    04810000
048200                 ,:PV-BEG-DTE                                     04820023
048300             FROM XST_LOC_DIST                                    04830000
048400            WHERE  LOC_NBR = :XST00002-LOC-NBR                    04840000
048500              AND  END_DTE IS NULL                                04850022
048600         END-EXEC                                                 04860000
048700                                                                  04870000
048800         EVALUATE TRUE                                            04880000
048900             WHEN SQLCODE = -911                                  04890000
049000             WHEN SQLCODE = -913                                  04900000
049100             WHEN SQLCODE = 0                                     04910000
049200             WHEN SQLCODE = +100                                  04920000
049300                 CONTINUE                                         04930000
049400             WHEN SQLWARN0 NOT = SPACE                            04940000
049500             WHEN SQLCODE NOT =  ZERO                             04950000
049600                 SET PS-PROCESS-COMPLETE TO TRUE                  04960000
049700         END-EVALUATE                                             04970000
049800     END-PERFORM.                                                 04980000
049900                                                                  04990000
050000     EVALUATE TRUE                                                05000000
050100        WHEN SQLCODE = 0                                          05010000
050200        WHEN SQLCODE = +100                                       05020000
050300            CONTINUE                                              05030000
050400        WHEN OTHER                                                05040000
050500             SET PS-PROCESS-COMPLETE     TO TRUE                  05050000
050600     END-EVALUATE.                                                05060000
050700                                                                  05070000
050800******************************************************************05080000
050900**UPDATE LOC_DIST                                                 05090002
051000******************************************************************05100000
051100 2700-UPDATE-LOC-DIST-ROW.                                        05110010
051200                                                                  05120000
051300     PERFORM                                                      05130000
051400         WITH TEST AFTER                                          05140000
051500         VARYING PV-RETRY-COUNTER                                 05150000
051600         FROM 1 BY 1                                              05160000
051700         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    05170000
051800            OR SQLCODE = 0                                        05180000
051900            OR SQLCODE = +100                                     05190000
052000            OR PS-PROCESS-COMPLETE                                05200000
052100                                                                  05210000
052200         EXEC SQL                                                 05220000
052300           UPDATE XST_LOC_DIST                                    05230002
052400              SET END_DTE = :XST00002-END-DTE                     05240029
052500            WHERE  LOC_NBR = :XST00002-LOC-NBR                    05250002
052600              AND END_DTE IS NULL                                 05260000
052700         END-EXEC                                                 05270000
052800                                                                  05280000
052900         EVALUATE TRUE                                            05290000
053000             WHEN SQLCODE = -911                                  05300000
053100             WHEN SQLCODE = -913                                  05310000
053200             WHEN SQLCODE = 0                                     05320000
053300             WHEN SQLCODE = +100                                  05330000
053400                  CONTINUE                                        05340000
053500             WHEN SQLWARN0 NOT = SPACE                            05350000
053600             WHEN SQLCODE NOT = ZERO                              05360000
053700                 SET PS-PROCESS-COMPLETE TO TRUE                  05370000
053800         END-EVALUATE                                             05380000
053900     END-PERFORM.                                                 05390000
054000                                                                  05400000
054100                                                                  05410000
054200     EVALUATE TRUE                                                05420000
054300        WHEN SQLCODE = 0                                          05430000
054400        WHEN SQLCODE = +100                                       05440000
054500            CONTINUE                                              05450000
054600        WHEN OTHER                                                05460000
054700             SET PS-PROCESS-COMPLETE     TO TRUE                  05470000
054800     END-EVALUATE.                                                05480000
054900                                                                  05490000
055000******************************************************************05500023
055100**DELETE LOC_DIST                                                 05510023
055200******************************************************************05520023
055300 2800-DELETE-LOC-DIST-ROW.                                        05530023
055400                                                                  05540023
055500     PERFORM                                                      05550023
055600         WITH TEST AFTER                                          05560023
055700         VARYING PV-RETRY-COUNTER                                 05570023
055800         FROM 1 BY 1                                              05580023
055900         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    05590023
056000            OR SQLCODE = 0                                        05600023
056100            OR SQLCODE = +100                                     05610023
056200            OR PS-PROCESS-COMPLETE                                05620023
056300                                                                  05630023
056400         EXEC SQL                                                 05640023
056500           DELETE FROM XST_LOC_DIST                               05650023
056600            WHERE  LOC_NBR = :XST00002-LOC-NBR                    05660023
056700              AND BEG_DTE  = :PV-BEG-DTE                          05670023
056800              AND END_DTE IS NULL                                 05680023
056900         END-EXEC                                                 05690023
057000                                                                  05700023
057100         EVALUATE TRUE                                            05710023
057200             WHEN SQLCODE = -911                                  05720023
057300             WHEN SQLCODE = -913                                  05730023
057400             WHEN SQLCODE = 0                                     05740023
057500             WHEN SQLCODE = +100                                  05750023
057600                  CONTINUE                                        05760023
057700             WHEN SQLWARN0 NOT = SPACE                            05770023
057800             WHEN SQLCODE NOT = ZERO                              05780023
057900                 SET PS-PROCESS-COMPLETE TO TRUE                  05790023
058000         END-EVALUATE                                             05800023
058100     END-PERFORM.                                                 05810023
058200                                                                  05820023
058300                                                                  05830023
058400     EVALUATE TRUE                                                05840023
058500        WHEN SQLCODE = 0                                          05850023
058600        WHEN SQLCODE = +100                                       05860023
058700            CONTINUE                                              05870023
058800        WHEN OTHER                                                05880023
058900             SET PS-PROCESS-COMPLETE     TO TRUE                  05890023
059000     END-EVALUATE.                                                05900023
059100******************************************************************05910001
059200**INSERT LOC_ATTR                                                 05920001
059300******************************************************************05930001
059400 4000-INSERT-LOC-ATTR.                                            05940001
059500                                                                  05950001
059600     PERFORM                                                      05960001
059700         WITH TEST AFTER                                          05970001
059800         VARYING PV-RETRY-COUNTER                                 05980001
059900         FROM 1 BY 1                                              05990001
060000         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    06000001
060100            OR SQLCODE = 0                                        06010001
060200            OR PS-PROCESS-COMPLETE                                06020001
060300                                                                  06030001
060400           EXEC SQL                                               06040001
060500               INSERT INTO XST_LOC_ATTR                           06050001
060600                        (LOC_NBR                                  06060026
060700                        ,CSH_RFND_GP_NBR                          06070031
060800                        ,CK_AUTH_GP_NBR                           06080031
060900                        ,AUTO_PHN_SYS_IND                         06090026
061000                        ,CS_VOL_LVL_CDE                           06100026
061100                        ,OSA_LS_STFNG_CDE                         06110040
061110                        ,TX_APPL_CDE                              06111040
061120                        ,GEO_CDE                                  06112040
061130                        ,TX_ALT_ZIP_10_CDE                        06113041
061730                        ,CRD_AUTH_GP_NBR)                         06114041
061200               VALUES (:XST00025-LOC-NBR                          06120026
061300                      ,:XST00025-CSH-RFND-GP-NBR                  06130031
061400                      ,:XST00025-CK-AUTH-GP-NBR                   06140031
061500                      ,:XST00025-AUTO-PHN-SYS-IND                 06150026
061600                      ,:XST00025-CS-VOL-LVL-CDE                   06160026
061700                      ,:XST00025-OSA-LS-STFNG-CDE                 06170040
061710                      ,:XST00025-TX-APPL-CDE                      06171040
061720                      ,:XST00025-GEO-CDE                          06172040
061730                      ,:XST00025-TX-ALT-ZIP-10-CDE                06173041
061730                      ,:XST00025-CRD-AUTH-GP-NBR)                 06174041
061800           END-EXEC                                               06180001
061900                                                                  06190001
062000         EVALUATE TRUE                                            06200001
062100             WHEN SQLCODE = -911                                  06210001
062200             WHEN SQLCODE = -913                                  06220001
062300             WHEN SQLCODE = 0                                     06230001
062400                  CONTINUE                                        06240001
062500             WHEN SQLWARN0 NOT = SPACE                            06250001
062600             WHEN SQLCODE NOT = ZERO                              06260001
062700                 SET PS-PROCESS-COMPLETE TO TRUE                  06270001
062800         END-EVALUATE                                             06280001
062900     END-PERFORM.                                                 06290001
063000                                                                  06300001
063100******************************************************************06310006
063200**DELETE LOC_ATTR                                                 06320006
063300******************************************************************06330006
063400 4100-DELETE-LOC-ATTR.                                            06340006
063500                                                                  06350006
063600     PERFORM                                                      06360006
063700         WITH TEST AFTER                                          06370006
063800         VARYING PV-RETRY-COUNTER                                 06380006
063900         FROM 1 BY 1                                              06390006
064000         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    06400006
064100            OR SQLCODE = 0                                        06410006
064200            OR PS-PROCESS-COMPLETE                                06420006
064300                                                                  06430006
064400           EXEC SQL                                               06440006
064500               DELETE FROM XST_LOC_ATTR                           06450006
064600             WHERE  (LOC_NBR = :XST00025-LOC-NBR)                 06460006
064700           END-EXEC                                               06470006
064800                                                                  06480006
064900         EVALUATE TRUE                                            06490006
065000             WHEN SQLCODE = -911                                  06500006
065100             WHEN SQLCODE = -913                                  06510006
065200             WHEN SQLCODE = 0                                     06520006
065300                 CONTINUE                                         06530006
065400             WHEN SQLWARN0 NOT = SPACE                            06540006
065500             WHEN SQLCODE NOT =  ZERO                             06550006
065600                 SET PS-PROCESS-COMPLETE TO TRUE                  06560006
065700         END-EVALUATE                                             06570006
065800     END-PERFORM.                                                 06580006
065900                                                                  06590006
066000     EVALUATE TRUE                                                06600006
066100         WHEN SQLCODE = 0                                         06610006
066200             CONTINUE                                             06620006
066300         WHEN OTHER                                               06630006
066400             SET PS-PROCESS-COMPLETE     TO TRUE                  06640006
066500     END-EVALUATE.                                                06650006
066600                                                                  06660006
066700******************************************************************06670000
066800**PASS SQLCODE TO CALLING AND EXIT PROGRAM                        06680000
066900******************************************************************06690000
067000 9999-WRAPUP.                                                     06700000
067100                                                                  06710000
067200     IF LV-RETURN-CODE = 0                                        06720029
067300         MOVE SQLCODE       TO LV-RETURN-CODE                     06730029
067400     END-IF.                                                      06740029
067500                                                                  06750000
067600     EXIT PROGRAM.                                                06760000
