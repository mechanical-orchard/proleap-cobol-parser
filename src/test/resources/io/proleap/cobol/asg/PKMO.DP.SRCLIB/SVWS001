000100******************************************************************00010031
000200* SVWS001                                                         00020031
000300*   THIS COPYBOOK IS TO BE USED WITH SVPD001, WHICH HANDLES       00030031
000400*   COMMON CODE FOR SEND OF RECORDS TO STORE SERVER FOR OFFLINE   00040031
000500*   PROCESSING.                                                   00050031
000600******************************************************************00060031
000700 01  SVWS001-SWITCHES.                                            00070031
000800     05  SV001-PS-END-OF-STORE-SW      PIC X(01)  VALUE 'N'.      00080031
000900         88  SV001-PS-END-OF-STORE-CURSOR         VALUE 'Y'.      00090031
001000     05  SV001-PS-STORE-FOUND-SW       PIC X(01)  VALUE 'N'.      00100031
001100         88  SV001-PS-STORE-FOUND                 VALUE 'Y'.      00110031
001200         88  SV001-PS-STORE-NOT-FOUND             VALUE 'N'.      00120031
001210     05  SV001-PS-STATE-FOUND-SW       PIC X(01)  VALUE 'N'.      00121046
001220         88  SV001-PS-STATE-FOUND                 VALUE 'Y'.      00122042
001230         88  SV001-PS-STATE-NOT-FOUND             VALUE 'N'.      00123042
001300     05  SV001-PS-METRO-FOUND-SW       PIC X(01)  VALUE 'N'.      00130031
001400         88  SV001-PS-METRO-FOUND                 VALUE 'Y'.      00140031
001500         88  SV001-PS-METRO-NOT-FOUND             VALUE 'N'.      00150031
001600     05  SV001-PS-METRO-ADDED-SW       PIC X(01)  VALUE 'N'.      00160031
001700         88  SV001-PS-METRO-ADDED                 VALUE 'Y'.      00170031
001800         88  SV001-PS-METRO-NOT-ADDED             VALUE 'N'.      00180031
001900     05  SV001-PS-END-OF-METRO-SW      PIC X(01)  VALUE 'N'.      00190031
002000         88  SV001-PS-END-OF-METRO                VALUE 'Y'.      00200031
002100         88  SV001-PS-NOT-END-OF-METRO            VALUE 'N'.      00210031
002200     05  SV001-PS-ASCII-CONVERT-SW     PIC X(01)  VALUE 'N'.      00220031
002300         88  SV001-PS-CONVERTED-TO-ASCII          VALUE 'Y'.      00230031
002400         88  SV001-PS-CONVERTED-TO-ASCII-NO       VALUE 'N'.      00240034
002500     05  SV001-PS-END-OF-PARM-FILE-SW  PIC X(01)  VALUE 'N'.      00250031
002600         88  SV001-PS-END-OF-PARM-FILE            VALUE 'Y'.      00260031
002700                                                                  00270031
002800 01  SVWS001-CONSTANTS.                                           00280031
002900     05  SV001-PC-METRO-TABLE-LIMIT  PIC S9(04)    VALUE +200.    00290043
003000     05  SV001-PC-STORE-LIMIT        PIC S9(04)    VALUE +2000.   00300031
003100     05  SV001-PC-32                 PIC  9(04)    VALUE 32       00310031
003200                                                   COMP-3.        00320031
003300     05  SV001-PC-365                PIC S9(05)    VALUE +365     00330031
003400                                                   COMP-3.        00340031
003500     05  SV001-PC-LINE-FEED          PIC  X(01)    VALUE X'0A'.   00350031
003600     05  SV001-PC-HARD-RETURN        PIC  X(01)    VALUE X'0D'.   00360031
003610     05  SV001-PC-CSV-DELIMITER      PIC  X(01)    VALUE '|'.     00361046
003620     05  SV001-PC-POS-CAP-LVL        PIC  9(02)    VALUE 17.      00362046
003700                                                                  00370031
003800 01  SVWS001-MISC-FIELDS.                                         00380031
003900     05  SV001-PV-METRO-STORE        PIC  9(04)    VALUE ZERO.    00390031
004000     05  SV001-PV-METRO-STORE-CMP    PIC S9(04)    VALUE ZERO     00400031
004100                                          COMP.                   00410031
004200     05  SV001-PV-METRO-STORE-CMP3   PIC S9(04)    VALUE ZERO     00420031
004300                                          COMP-3.                 00430031
004400     05  SV001-PV-ADD-STORE          PIC S9(04)    VALUE ZERO     00440031
004500                                          COMP.                   00450031
004600     05  SV001-PV-ADD-METRO          PIC S9(04)    VALUE ZERO     00460031
004700                                          COMP.                   00470031
004800     05  SV001-PV-STORE-SUB          PIC S9(5)     VALUE ZERO     00480031
004900                                          COMP-3.                 00490031
005000     05  SV001-PV-CARD-METRO-SUB     PIC S9(3)     VALUE ZERO     00500031
005100                                          COMP-3.                 00510031
005200     05  SV001-PV-CARD-BALANCE       PIC S9(7)V99  VALUE ZERO     00520031
005300                                          COMP-3.                 00530031
005400     05  SV001-PV-WORK-CCYY-MM-DD    PIC X(10)     VALUE SPACES.  00540031
005500     05  SV001-PV-COMPARE-OPEN       PIC X(10)     VALUE SPACES.  00550031
005600     05  SV001-PV-YEARS-BACK         PIC S9(3)     VALUE ZERO     00560031
005700                                          COMP-3.                 00570031
005800     05  SV001-PV-DAYS-BACK          PIC S9(5)     VALUE ZERO     00580031
005900                                          COMP-3.                 00590031
006000     05  SV001-PV-STATE-CDE          PIC  X(2)     VALUE SPACES.  00600031
006100     05  SV001-PV-STATE-SUB          PIC S9(4)     VALUE ZERO     00610031
006200                                          COMP-3.                 00620031
006300     05  SV001-PV-STORE-MAX          PIC S9(4)     VALUE ZERO     00630031
006400                                          COMP-3.                 00640031
006500     05  SV001-PV-COMPARE-DATE       PIC X(10)     VALUE SPACE.   00650031
006501     05  SV001-PV-POS-CAP-LVL-ID     PIC S9(5)     VALUE ZERO     00650144
006502                                          COMP-3.                 00650244
006503     05  SV001-PV-SV005-WRITE-CNT    PIC 9(09)     VALUE ZERO.    00650346
006504     05  SV001-PV-SV060-WRITE-CNT    PIC 9(09)     VALUE ZERO.    00650446
006505     05  SV001-PV-STORE-FETCH-CNT    PIC 9(09)     VALUE ZERO.    00650546
006506                                                                  00650646
006507     05  SV001-PV-DECIMAL-DISPLAY-GROUP.                          00650746
006508       10  SV001-PV-DDG-9FOR4DD       PIC 9(04).999.              00650846
006509       10  SV001-PV-DDG-9FOR5DD       PIC 9(05).999.              00650946
006510       10  SV001-PV-DDG-9FOR7DD       PIC 9(07).999.              00651046
006511       10  SV001-PV-DDG-9FOR3D        PIC 9(03).99.               00651146
006512       10  SV001-PV-DDG-9FOR6D        PIC 9(06).99.               00651246
006513       10  SV001-PV-DDG-9FOR7D        PIC 9(07).99.               00651346
006514       10  SV001-PV-DDG-9FOR8D        PIC 9(08).99.               00651446
006515       10  SV001-PV-DDG-9FOR1ND       PIC 9(01).                  00651546
006516       10  SV001-PV-DDG-9FOR3ND       PIC 9(03).                  00651646
006517       10  SV001-PV-DDG-9FOR4ND       PIC 9(04).                  00651746
006518       10  SV001-PV-DDG-9FOR5ND       PIC 9(05).                  00651846
006519       10  SV001-PV-DDG-9FOR8ND       PIC 9(08).                  00651946
006520       10  SV001-PV-DDG-9FOR9ND       PIC 9(09).                  00652046
006521       10  SV001-PV-DDG-9FOR10ND      PIC 9(10).                  00652146
006522       10  SV001-PV-DDG-9FOR11ND      PIC 9(11).                  00652246
006523       10  SV001-PV-DDG-9FOR12ND      PIC 9(12).                  00652346
006524       10  SV001-PV-DDG-9FOR14ND      PIC 9(14).                  00652446
006525       10  SV001-PV-DDG-9FOR15ND      PIC 9(15).                  00652546
006526       10  SV001-PV-DDG-9FOR20ND      PIC 9(20).                  00652646
006527                                                                  00652746
006528   05  SV001-PV-VARIABLE-OUTPUT-FIELD.                            00652846
006529       10  SV001-PV-BIT-VARIABLE       PIC  X(01)                 00652946
006530                                       VALUE SPACES               00653046
006531                                       OCCURS 60 TIMES            00653146
006532                                       INDEXED BY                 00653246
006533                                       SV001-PV-BIT-IDX           00653346
006534                                       SV001-PV-STR-IDX           00653446
006535                                       SV001-PV-EOF-IDX.          00653546
006536                                                                  00653646
006537   05  SV001-PV-TALLY-CNT              PIC 9(05) VALUE ZERO.      00653746
006538   05  SV001-PV-SPACE                  PIC X(01).                 00653846
006539                                                                  00653946
006540   05  SV001-SV060-BREAKDOWN.                                     00654046
006541       10 SV001-SV060-LENGTH           PIC 9(04) COMP.            00654146
006542       10 SV001-SV060-A                PIC X(50).                 00654246
006543       10 SV001-SV060-B                PIC X(08).                 00654346
006544                                                                  00654446
006550                                                                  00655044
006600******************************************************************00660031
006700*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             00670031
006800******************************************************************00680031
006900     COPY DPWS500.                                                00690038
007000******************************************************************00700031
007100* RECORD LAYOUT FOR INPUT YEAR PARAMETER                          00710031
007200******************************************************************00720031
007300  01  CC-YEAR-PARAMETER-CARD.                                     00730031
007400      05  CC-YEAR-PARAMETER            PIC X(02)  VALUE SPACES.   00740031
007500      05  CC-YEAR-PARM REDEFINES CC-YEAR-PARAMETER                00750031
007600                                       PIC 9(02).                 00760031
007700      05  FILLER                       PIC X      VALUE SPACES.   00770031
007800      05  CC-DAYS-BEFORE               PIC X(02)  VALUE SPACES.   00780031
007900      05  CC-DAYS-BEFORE-OPEN REDEFINES CC-DAYS-BEFORE            00790031
008000                                       PIC 9(02).                 00800031
008100      05  FILLER                       PIC X(75)  VALUE SPACES.   00810031
009400******************************************************************00940031
009500*  TABLES FOR PROCESSING.                                         00950031
009600******************************************************************00960031
009700*  THE STORE TABLE WILL HOLD THE STORE AND METRO AREA FROM        00970031
009800*  XST_LOC LOAD WITH TYPE CODE 'DS'                               00980041
009900******************************************************************00990031
010000 01  SVWS001-STORE-TABLE.                                         01000031
010100     05  STORE-RCD OCCURS 2000 TIMES.                             01010031
010200         10  ST-STORE           PIC S9(4) COMP.                   01020044
010300         10  ST-METRO           PIC S9(4) COMP.                   01030044
010400         10  ST-OPEN-DATE       PIC X(10).                        01040044
010500         10  ST-CLOSE-DATE      PIC X(10).                        01050044
010600         10  ST-STATE           PIC X(02).                        01060044
010610         10  ST-POS-CAP-LVL-ID  PIC S9(5) COMP-3.                 01061044
010700                                                                  01070044
010800******************************************************************01080031
010900*  THE CARD METRO TABLE HOLDS THE METRO AREAS FOR THE SV CARD     01090031
011000*  BEING PROCESSED.                                               01100031
011100******************************************************************01110031
011200 01  SVWS001-CARD-METRO-TABLE.                                    01120031
011300     05  CARD-METRO OCCURS 200 TIMES.                             01130043
011400         10  CM-METRO         PIC S9(4) COMP.                     01140031
011801******************************************************************01180145
011802* RECORD LAYOUT FOR OUTPUT SV CARD FILE FOR SQL SERVER            01180245
011803******************************************************************01180345
011804     COPY SVRD060.                                                01180445
011810******************************************************************01181039
011820* WS FIELDS FOR SQLCA MESSAGE ROUTINE                            *01182040
011830******************************************************************01183040
011840     COPY DPWS004.                                                01184040
011900******************************************************************01190031
012000*  DB2 TABLE DB2PDBA.XST_LOC - XS DOMAIN LOCATION TABLE           01200031
012100******************************************************************01210031
012200     EXEC SQL                                                     01220031
012300          INCLUDE XST00001                                        01230031
012400     END-EXEC.                                                    01240031
012500******************************************************************01250031
012600*  DB2 TABLE DB2PDBA.XST_STR_GP - XS DOMAIN STORE GROUP TABLE     01260031
012700******************************************************************01270031
012800     EXEC SQL                                                     01280031
012900          INCLUDE XST00022                                        01290031
013000     END-EXEC.                                                    01300031
013100******************************************************************01310031
013200*  DB2 TABLE DB2PDBA.XST_STR_GP_MBSHP - XS DOMAIN STORE GROUP     01320031
013300*   MEMBERSHIP TABLE                                              01330031
013400******************************************************************01340031
013500     EXEC SQL                                                     01350031
013600          INCLUDE XST00023                                        01360031
013700     END-EXEC.                                                    01370031
013800******************************************************************01380031
013900*  DB2 TABLE DB2PDBA.XST_LOC_ATTR - XS DOMAIN LOCATION ATTRIBUTE  01390031
014000*   TABLE                                                         01400031
014100******************************************************************01410031
014200     EXEC SQL                                                     01420031
014300          INCLUDE XST00025                                        01430031
014400     END-EXEC.                                                    01440031
014401******************************************************************01440140
014402*  DB2 TABLE SVT_CRD_PROD                                         01440240
014403******************************************************************01440340
014404     EXEC SQL                                                     01440440
014405          INCLUDE SVT00000                                        01440548
014406     END-EXEC.                                                    01440640
014424******************************************************************01442440
014425*  DB2 TABLE SVT_CRD_STK_DNMNTN                                   01442540
014426******************************************************************01442640
014427     EXEC SQL                                                     01442740
014428          INCLUDE SVT00008                                        01442840
014429     END-EXEC.                                                    01442940
014430******************************************************************01443040
014431*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *01443140
014432******************************************************************01443240
014440     EXEC SQL                                                     01444040
014450          INCLUDE SQLCA                                           01445048
014460     END-EXEC.                                                    01446040
014500******************************************************************01450031
014600*  STORE CURSOR - USED TO GET ALL DEPARTMENT STORES, ALONG WITH   01460031
014700*   THEIR METRO AREA AND STATE OF THE METRO AREA                  01470031
014800******************************************************************01480031
014900     EXEC SQL                                                     01490031
015000       DECLARE STORE-CSR CURSOR FOR                               01500031
015100           SELECT A.LOC_NBR                                       01510031
015200                 ,B.STR_GP_ID                                     01520031
015300                 ,A.OPN_DTE                                       01530031
015400                 ,A.CLO_DTE                                       01540031
015500                 ,B.ST_CDE                                        01550031
015600                 ,D.POS_CAP_LVL_ID                                01560044
015700           FROM   XST_LOC A                                       01570031
015800                 ,XST_STR_GP B                                    01580031
015900                 ,XST_STR_GP_MBSHP C                              01590031
016000                 ,XST_LOC_ATTR D                                  01600031
016100           WHERE  A.LOC_NBR = C.STR_NBR                           01610031
016200             AND  A.LOC_NBR = D.LOC_NBR                           01620033
016300             AND  B.STR_GP_TYP_CDE = C.STR_GP_TYP_CDE             01630031
016400             AND  B.STR_GP_ID = C.STR_GP_ID                       01640031
016500             AND  B.STR_GP_TYP_CDE = 2000                         01650031
016510             AND  A.E_BUS_IND = 'N'                               01651040
016600             AND  A.LOC_TYP_CDE = 'DS'                            01660031
016610             AND  ((CURRENT DATE BETWEEN C.EFF_BEG_DTE AND        01661038
016620                  C.EFF_END_DTE)                                  01662038
016630              OR  (CURRENT DATE >= C.EFF_BEG_DTE AND              01663038
016640                  C.EFF_END_DTE IS NULL))                         01664038
016700             AND  D.POS_CAP_LVL_ID > 4                            01670031
016800           WITH UR                                                01680031
016900     END-EXEC.                                                    01690031
