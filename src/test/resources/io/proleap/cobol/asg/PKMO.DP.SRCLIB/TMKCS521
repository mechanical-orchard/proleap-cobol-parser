000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.    TMKCS521.                                         00020002
000300 AUTHOR.        LOUIE CRISOSTOMO.                                 00030002
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040002
000500 DATE-WRITTEN.  03-30-94.                                         00050002
000600 DATE-COMPILED.                                                   00060002
000700******************************************************************00070002
000800*    E233 - CREATE/UPDATE TTRBNTF AND TTRBDTL                     00080002
000900*                                                                 00090002
001000*    THIS IS A CALLED ROUTINE TO CREATE A                         00100002
001100*    TROUBLE NOTIFICATION TABLE                                   00110002
001200*                                                                 00120002
      * CHANGE LOG:                                                     00121025
      *  09/26/2022  JEAN KURK  RECOMPILE FOR COBOL UPGRADE             00122025
      *                                            CHG0274597           00123025
001300******************************************************************00130002
001310*                                                                 00131016
001320*********************************************************         00132017
001330* *   IF ANY CHANGES ARE MADE TO THIS PROGRAM         * *         00133017
001340* *   BE SURE TO CHECK THE BATCH PROGRAM (TMKUP521)   * *         00134017
001350* *   TO SEE IF THE SAME CHANGE SHOULD BE MADE        * *         00135017
001360*********************************************************         00136017
001370*                                                                 00137017
001400 ENVIRONMENT DIVISION.                                            00140002
001500 CONFIGURATION SECTION.                                           00150002
001600 SOURCE-COMPUTER.        IBM-3090.                                00160002
001700 OBJECT-COMPUTER.        IBM-3090.                                00170002
001800 DATA DIVISION.                                                   00180002
001900 WORKING-STORAGE SECTION.                                         00190002
002000                                                                  00200002
002100 01  PC-PROGRAM-CONSTANTS.                                        00210002
002200     05  CURRENT-ABSTIME              PIC S9(15) VALUE +0         00220002
002300                                                 COMP-3.          00230002
002400     05  PC-MAX-RETRIES               PIC S9(4) VALUE +3          00240002
002500                                                COMP SYNC.        00250002
002600     05  PC-RAND-PGM                  PIC X(8) VALUE 'DPKUT902'.  00260002
002700     05  PC-ACTIVE                    PIC X(01) VALUE 'A'.        00270002
002800     05  PC-D                         PIC X(01) VALUE 'D'.        00280002
002900     05  PC-N                         PIC X(01) VALUE 'N'.        00290002
003000     05  PC-Y                         PIC X(01) VALUE 'Y'.        00300002
003100     05  PC-I                         PIC X(01) VALUE 'I'.        00310002
003200     05  PC-R                         PIC X(01) VALUE 'R'.        00320002
003300     05  PC-A                         PIC X(01) VALUE 'A'.        00330002
003400     05  PC-T                         PIC X(01) VALUE 'T'.        00340002
003500     05  PC-P                         PIC X(01) VALUE 'P'.        00350002
003600     05  PC-1                         PIC S9(4) VALUE +1   COMP.  00360002
003700     05  PC-50                        PIC S9(4) VALUE +50  COMP.  00370002
003800     05  PC-90                        PIC S9(4) VALUE +90  COMP.  00380002
003900     05  PC-100                       PIC S9(4) VALUE +100 COMP.  00390002
004000     05  PC-150                       PIC S9(4) VALUE +150 COMP.  00400002
004100     05  PC-200                       PIC S9(4) VALUE +200 COMP.  00410002
004200     05  PC-222                       PIC S9(4) VALUE +222 COMP.  00420002
004300     05  PC-225                       PIC S9(4) VALUE +225 COMP.  00430002
004400     05  PC-250                       PIC S9(4) VALUE +250 COMP.  00440002
004500     05  PC-267                       PIC S9(4) VALUE +267 COMP.  00450002
004600     05  PC-502                       PIC S9(4) VALUE +502 COMP.  00460002
004700     05  PC-509                       PIC S9(4) VALUE +509 COMP.  00470002
004800     05  PC-60                        PIC S9(9) VALUE +60  COMP.  00480002
004900     05  PC-1440                      PIC S9(9) VALUE +1440 COMP. 00490002
005000     05  PC-2880                      PIC S9(9) VALUE +2880 COMP. 00500002
005100     05  PC-10080                     PIC S9(9) VALUE +10080 COMP.00510002
005200     05  PC-29-SECS                   PIC X(09) VALUE             00520002
005300         '29.999999'.                                             00530002
005400     05  PC-DEFAULT-TMST              PIC X(26) VALUE             00540002
005500         '9999-09-09-09.09.09.999999'.                            00550002
005600     05  PC-IN-TRBL-MIN-CNT           PIC S9(4) VALUE +59 COMP.   00560002
005700     05  PC-IN-TRBL-HOUR-CNT          PIC S9(4) VALUE +99 COMP.   00570002
005800     05  PC-PRE-RECEIVED              PIC X(18) VALUE             00580002
005900                                          '***PRE-RECEIVED***'.   00590002
006000     05  PC-RTV-MSG-1                 PIC X(28) VALUE             00600002
006100                               'RETURN MERCHANDISE TO VENDOR'.    00610002
006200     05  PC-RTV-MSG-2                 PIC X(21) VALUE             00620002
006300                               'ACCEPT EARLY SHIPMENT'.           00630002
006400     05  PC-RTV-MSG-3                 PIC X(21) VALUE             00640002
006500                               'ACCEPT LATE SHIPMENT '.           00650002
006600                                                                  00660002
006700 01  PS-PROGRAM-SWITCHES.                                         00670002
006800     05 PS-RSN-CURSOR-SW              PIC X(1)  VALUE SPACE.      00680002
006900         88 PS-RSN-CURSOR-COMPLETE              VALUE 'Y'.        00690002
007000         88 PS-RSN-CURSOR-INCOMPLETE            VALUE 'N'.        00700002
007100     05  PS-DO-NOT-USE-OPER-SW        PIC  X    VALUE 'N'.        00710002
007200         88  PS-DO-NOT-USE-OPER                 VALUE 'N'.        00720002
007300         88  PS-DO-USE-OPER                     VALUE 'Y'.        00730002
007400     05  PS-DONE-SW                   PIC  X    VALUE 'N'.        00740002
007500         88  PS-NOT-DONE                        VALUE 'N'.        00750002
007600         88  PS-DONE                            VALUE 'Y'.        00760002
007700     05  PS-RESOLVE-FOUND-SW          PIC  X    VALUE 'N'.        00770002
007800         88  PS-NO-RESOLVE-FOUND                VALUE 'N'.        00780002
007900         88  PS-RESOLVE-FOUND                   VALUE 'Y'.        00790002
008000     05  PS-MORE-TROUBLE-SW           PIC  X    VALUE 'N'.        00800002
008100         88  PS-NO-MORE-TROUBLE                 VALUE 'N'.        00810002
008200         88  PS-MORE-TROUBLE                    VALUE 'Y'.        00820002
008300     05  PS-RECORD-SW                 PIC  X    VALUE 'N'.        00830002
008400         88  PS-NO-MORE-RECORD                  VALUE 'N'.        00840002
008500         88  PS-MORE-RECORD                     VALUE 'Y'.        00850002
008600     05  PS-TWKORIN-CURSOR-SW         PIC X(01) VALUE 'N'.        00860002
008700         88  PS-EOF-TWKORIN-CSR                 VALUE 'Y'.        00870002
008800     05  PS-TWKORIN-ZERO-SW           PIC X(01) VALUE 'N'.        00880002
008900         88  PS-EOF-TWKORIN-ZERO                VALUE 'Y'.        00890002
009000     05  PS-PACK-LVL-UPD-SW           PIC  X    VALUE 'N'.        00900002
009100         88  PS-PACK-LVL-UPD-NOT-DONE           VALUE 'N'.        00910002
009200         88  PS-PACK-LVL-UPD-DONE               VALUE 'Y'.        00920002
009300                                                                  00930002
009400 01  DATE-TIME-VARIABLES.                                         00940002
009500     05  PV-CURRENT-DATE              PIC X(10) VALUE SPACES.     00950002
009600     05  PV-IN-TRBL-DATE              PIC X(10) VALUE SPACES.     00960002
009700     05  PV-CURRENT-TIME              PIC X(08) VALUE SPACES.     00970002
009800     05  PV-IN-TRBL-TIME              PIC X(08) VALUE SPACES.     00980002
009900     05  PV-DB2-DAYS                  PIC S9(9) VALUE +0 COMP.    00990002
010000     05  PV-DB2-HOURS                 PIC S9(9) VALUE +0 COMP.    01000002
010100     05  PV-DB2-MINUTES               PIC S9(9) VALUE +0 COMP.    01010002
010200                                                                  01020002
010300 01  PV-CICS-MSG-AREA.                                            01030002
010400     05  FILLER                       PIC X(10) VALUE             01040002
010500             'TMKCS521 -'.                                        01050002
010600     05  FILLER                       PIC X(08) VALUE             01060002
010700         ' FROM = '.                                              01070002
010800     05  PV-MSG-FROM-DATE             PIC X(10) VALUE SPACES.     01080002
010900     05  FILLER                       PIC X(01) VALUE SPACE.      01090002
011000     05  PV-MSG-FROM-TIME             PIC X(10) VALUE SPACES.     01100002
011100     05  FILLER                       PIC X(08) VALUE             01110002
011200         '   TO = '.                                              01120002
011300     05  PV-MSG-TO-DATE               PIC X(10) VALUE SPACES.     01130002
011400     05  FILLER                       PIC X(01) VALUE SPACE.      01140002
011500     05  PV-MSG-TO-TIME               PIC X(10) VALUE SPACES.     01150002
011600                                                                  01160002
011700 01  PV-CSSL-MSG.                                                 01170002
011800     05  PV-MARKER                    PIC X(01) VALUE SPACES.     01180002
011900     05  PV-CSSL-PARA                 PIC X(20) VALUE SPACES.     01190002
012000     05  PV-CSSL-TEXT                 PIC X(079) VALUE SPACES.    01200002
012100                                                                  01210002
012200 01  PV-CSSL-SQLCODE.                                             01220002
012300     05  PV-MARKER2                   PIC X(01).                  01230002
012400     05  FILLER                       PIC X(11) VALUE             01240002
012500         ' SQLCODE = '.                                           01250002
012600     05  PV-DISP-SQLCODE              PIC 999-.                   01260002
012700                                                                  01270002
012800                                                                  01280002
012900 01  PV-DISP-FIELDS.                                              01290002
013000     05  PV-DISP-1                    PIC 9(9) VALUE ZEROES.      01300002
013100     05  PV-DISP-2                    PIC 9(9) VALUE ZEROES.      01310002
013200     05  PV-DISP-3                    PIC 9(9) VALUE ZEROES.      01320002
013300     05  PV-DISP-4                    PIC 9(9) VALUE ZEROES.      01330002
013400     05  PV-DISP-5                    PIC 9(9) VALUE ZEROES.      01340002
013500     05  PV-DISP-6                    PIC 9(9) VALUE ZEROES.      01350002
013600     05  PV-DISP-7                    PIC 9(9) VALUE ZEROES.      01360002
013700     05  PV-DISP-8                    PIC 9(9) VALUE ZEROES.      01370002
013800                                                                  01380002
013900 01  PV-PROGRAM-VARIABLES.                                        01390002
014000     05  PV-CICS-RESP                 PIC S9(4) VALUE ZERO        01400002
014100                                                COMP SYNC.        01410002
014200     05  PV-RETRY-COUNTER             PIC S9(4) VALUE ZERO        01420002
014300                                                COMP SYNC.        01430002
014400     05  PV-PO-LNE-NBR                PIC S9(4) VALUE +0 COMP.    01440002
014500                                                                  01450002
014600     05  PV-PRC-FCLTY-AREA-ID         PIC X(06) VALUE SPACES.     01460002
014700     05  PV-FREEFORM-TEXT.                                        01470002
014800         10  PV-FREEFORM-TEXT-1       PIC X(50) VALUE SPACES.     01480002
014900         10  PV-FREEFORM-TEXT-2       PIC X(50) VALUE SPACES.     01490002
015000         10  PV-FREEFORM-TEXT-3       PIC X(50) VALUE SPACES.     01500002
015100         10  PV-FREEFORM-TEXT-4       PIC X(50) VALUE SPACES.     01510002
015200         10  PV-FREEFORM-TEXT-5       PIC X(50) VALUE SPACES.     01520002
015300     05  PV-TEMP-TEXT                 PIC X(250).                 01530002
015400     05  PV-SAVE-TEXT                 PIC X(250).                 01540002
015500     05  PV-TEMP-UID                  PIC X(10).                  01550002
015600     05  PV-SHOW-QTY                  PIC Z(8)9.                  01560002
015700                                                                  01570002
015800     05  PV-OP.                                                   01580002
015900         10  PV-OP-N                  PIC 999.                    01590002
016000     05  PV-FCLTY.                                                01600002
016100         10  PV-FCLTY-N               PIC 9.                      01610002
016200     05  PV-PO.                                                   01620002
016300         10  PV-PO-N                  PIC 9(8).                   01630002
016400     05  PV-LINE.                                                 01640002
016500         10  PV-LINE-N                PIC 999.                    01650002
016600     05  PV-REC-SEQ-NBR.                                          01660002
016700         10  PV-REC-SEQ-NBR-N         PIC 999.                    01670002
016800     05  PV-TRECEIV-COUNT             PIC S9(09)  VALUE ZERO      01680002
016900                                              COMP-3.             01690002
017000     05  PV-DB2-COUNT                 PIC S9(09)  VALUE ZERO      01700002
017100                                              COMP-3.             01710002
017200     05  PV-NULL-IND                  PIC S9(4) VALUE ZERO        01720002
017300                                                COMP SYNC.        01730002
017400     05  PV-REASON-CHECKER            PIC S9(4) VALUE ZERO        01740002
017500                                                COMP SYNC.        01750002
017600         88  PV-VERIFIED-ADJUSTMENT   VALUES +600 THRU +625.      01760002
017700                                                                  01770002
017800                                                                  01780002
017900 01  PRV-PROGRAM-RETURN-VARIABLES.                                01790002
018000     05  PRV-00                       PIC X(42) VALUE             01800002
018100         '00PROGRAM CALL WAS SUCCESSFUL             '.            01810002
018200     05  PRV-48                       PIC X(42) VALUE             01820002
018300         '48INVALID LEVEL-IND4                      '.            01830002
018400     05  PRV-50                       PIC X(42) VALUE             01840002
018500         '50DUPLICATE TROUBLE NOTIFICATION          '.            01850002
018600     05  PRV-51                       PIC X(42) VALUE             01860002
018700         '51RECORD NOT FOUND - TTRBNTF UPDATE       '.            01870002
018800     05  PRV-5A                       PIC X(42) VALUE             01880002
018900         '5AINVALID TM500-PROCESS-IND               '.            01890002
019000     05  PRV-5C                       PIC X(42) VALUE             01900002
019100         '5CBAD LINK TO RANDOM NUMBER ROUTINE       '.            01910002
019200     05  PRV-5D                       PIC X(42) VALUE             01920002
019300         '5DDB2-ERROR - TTRBNTF SELECT              '.            01930002
019400     05  PRV-5E                       PIC X(42) VALUE             01940002
019500         '5EDB2-ERROR - TPURCHS SELECT              '.            01950002
019600     05  PRV-5F                       PIC X(42) VALUE             01960002
019700         '5FDB2-ERROR - TTRBNTF INSERT              '.            01970002
019800     05  PRV-5G                       PIC X(42) VALUE             01980002
019900         '5GDB2-ERROR - TRECEIV SELECT              '.            01990002
020000     05  PRV-5H                       PIC X(42) VALUE             02000002
020100         '5HDB2-ERROR - TRECEIV UPDATE              '.            02010002
020200     05  PRV-5I                       PIC X(42) VALUE             02020002
020300         '5IDB2-ERROR - TTRBNTF UPDATE              '.            02030002
020400     05  PRV-5J                       PIC X(42) VALUE             02040002
020500         '5JDB2-ERROR - TTRBDTL INSERT              '.            02050002
020600     05  PRV-5K                       PIC X(42) VALUE             02060002
020700         '5KDB2-ERROR - TTRBRSN SELECT              '.            02070002
020800     05  PRV-5L                       PIC X(42) VALUE             02080002
020900         '5LINVALID TM500-LEVEL-IND                 '.            02090002
021000     05  PRV-5M                       PIC X(42) VALUE             02100002
021100         '5MDB2-ERROR - TPURITM SELECT              '.            02110002
021200     05  PRV-5N                       PIC X(42) VALUE             02120002
021300         '5NDB2-ERROR - TRECITM UPDATE              '.            02130002
021400     05  PRV-5O                       PIC X(42) VALUE             02140002
021500         '5OTROUBLE RECORD ALREADY ACKNOWLEDGED     '.            02150002
021600     05  PRV-5P                       PIC X(42) VALUE             02160002
021700         '5PDB2-ERROR - WKORIN CURSOR OPEN          '.            02170002
021800     05  PRV-5Q                       PIC X(42) VALUE             02180002
021900         '5QDB2-ERROR - WKORIN CURSOR FETCH         '.            02190002
022000     05  PRV-5R                       PIC X(42) VALUE             02200002
022100         '5RDB2-ERROR - WKORIN CURSOR CLOSE         '.            02210002
022200     05  PRV-5S                       PIC X(42) VALUE             02220002
022300         '5SDB2-ERROR - WKORIN0 CURSOR OPEN         '.            02230002
022400     05  PRV-5T                       PIC X(42) VALUE             02240002
022500         '5TDB2-ERROR - WKORIN0 CURSOR FETCH        '.            02250002
022600     05  PRV-5U                       PIC X(42) VALUE             02260002
022700         '5UDB2-ERROR - WKORIN0 CURSOR CLOSE        '.            02270002
022800     05  PRV-5V                       PIC X(42) VALUE             02280002
022900         '5VINVALID TM500-LEVEL-IND                 '.            02290002
023000     05  PRV-5W                       PIC X(42) VALUE             02300002
023100         '5WDB2-ERROR - TTRBDTL SELECT              '.            02310002
023200*JPL                                                              02320002
023300     05  PRV-70                       PIC X(42) VALUE             02330002
023400         '70DB2-ERROR - RECITM-LINE-CSR OPEN        '.            02340002
023500     05  PRV-71                       PIC X(42) VALUE             02350002
023600         '71DB2-ERROR - RECITM-LINE-CSR FETCH       '.            02360002
023700     05  PRV-72                       PIC X(42) VALUE             02370002
023800         '72DB2-ERROR - RECITM-LINE-CSR CLOSE       '.            02380002
023900     05  PRV-73                       PIC X(42) VALUE             02390002
024000         '73DB2-ERROR - RECITM-LINE-CSR UPDATE      '.            02400002
024100                                                                  02410002
024200     05  PRV-74                       PIC X(42) VALUE             02420002
024300         '74DB2-ERROR - TRBRCN-READ-CRS OPEN        '.            02430002
024400     05  PRV-75                       PIC X(42) VALUE             02440002
024500         '75DB2-ERROR - TRBRCN-READ-CRS FETCH       '.            02450002
024600     05  PRV-76                       PIC X(42) VALUE             02460002
024700         '76DB2-ERROR - TRBRCN-READ-CRS CLOSE       '.            02470002
024800                                                                  02480002
024900     05  PRV-TM500-RETURN-MSG.                                    02490002
025000         10  PRV-PGM                  PIC X(3).                   02500002
025100         10  FILLER                   PIC X(1).                   02510002
025200         10  PRV-PARA                 PIC X(4).                   02520002
025300         10  FILLER                   PIC X(1).                   02530002
025400         10  PRV-TBL                  PIC X(7).                   02540002
025500         10  FILLER                   PIC X(1).                   02550002
025600         10  PRV-OP                   PIC X(3).                   02560002
025700         10  FILLER                   PIC X(1).                   02570002
025800         10  PRV-FCLTY                PIC X(1).                   02580002
025900         10  FILLER                   PIC X(1).                   02590002
026000         10  PRV-PO                   PIC X(8).                   02600002
026100         10  FILLER                   PIC X(1).                   02610002
026200         10  PRV-LINE                 PIC X(3).                   02620002
026300         10  FILLER                   PIC X(1).                   02630002
026400         10  PRV-REC-SEQ-NBR          PIC X(3).                   02640002
026500         10  FILLER                   PIC X(1).                   02650002
026600                                                                  02660002
026700******************************************************************02670002
026800*    COPYBOOK AREA                                                02680002
026900******************************************************************02690002
027000     COPY TMWS500.                                                02700002
027100/                                                                 02710002
027200*  RANDOM NUMBER AREA.                                            02720002
027300     COPY DPWS902.                                                02730002
027400/                                                                 02740002
027500*  CORPORATE CALENDAR ROUTINE                                     02750002
027600     COPY DPWS500.                                                02760002
027700/                                                                 02770002
027800******************************************************************02780002
027900*    DB2 SQL COMMUNICATION AREA                                   02790002
028000******************************************************************02800002
028100     EXEC SQL                                                     02810002
028200          INCLUDE SQLCA                                           02820002
028300     END-EXEC.                                                    02830002
028400                                                                  02840002
028500*---------------------------------------------------------------* 02850002
028600*      -TROUBLE REASON CODES TABLE  - PROGRAM ID level          * 02860002
028700*---------------------------------------------------------------* 02870002
028800     EXEC SQL                                                     02880002
028900          INCLUDE TTRBRCN                                         02890002
029000     END-EXEC.                                                    02900002
029100                                                                  02910002
029200******************************************************************02920002
029300*    DB2 DCLGEN FOR TROUBLE NOTIFICATION TABLE                    02930002
029400******************************************************************02940002
029500     EXEC SQL                                                     02950002
029600          INCLUDE TTRBNTF                                         02960002
029700     END-EXEC.                                                    02970002
029800                                                                  02980002
029900******************************************************************02990002
030000*    DB2 DCLGEN FOR TROUBLE DETAIL TABLE                          03000002
030100******************************************************************03010002
030200     EXEC SQL                                                     03020002
030300          INCLUDE TTRBDTL                                         03030002
030400     END-EXEC.                                                    03040002
030500                                                                  03050002
030600******************************************************************03060002
030700*    DB2 DCLGEN FOR TROUBLE REASON TABLE                          03070002
030800******************************************************************03080002
030900     EXEC SQL                                                     03090002
031000          INCLUDE TTRBRSN                                         03100002
031100     END-EXEC.                                                    03110002
031200                                                                  03120002
031300******************************************************************03130002
031400*    DB2 DCLGEN FOR RECEIVER TABLE                                03140002
031500******************************************************************03150002
031600     EXEC SQL                                                     03160002
031700          INCLUDE TRECEIV                                         03170002
031800     END-EXEC.                                                    03180002
031900                                                                  03190002
032000******************************************************************03200002
032100*    DB2 DCLGEN FOR RECEIPT ITEM TABLE                            03210002
032200******************************************************************03220002
032300     EXEC SQL                                                     03230002
032400          INCLUDE TRECITM                                         03240002
032500     END-EXEC.                                                    03250002
032600                                                                  03260002
032700******************************************************************03270002
032800*    DB2 DCLGEN FOR PURCHASE ORDER TABLE                          03280002
032900******************************************************************03290002
033000     EXEC SQL                                                     03300002
033100          INCLUDE TPURCHS                                         03310002
033200     END-EXEC.                                                    03320002
033300                                                                  03330002
033400******************************************************************03340002
033500*    DB2 DCLGEN FOR PURCHASE ITEM TABLE                           03350002
033600******************************************************************03360002
033700     EXEC SQL                                                     03370002
033800          INCLUDE TPURITM                                         03380002
033900     END-EXEC.                                                    03390002
034000/                                                                 03400002
034100******************************************************************03410002
034200*    DB2 DCLGEN FOR WORK ORDER IN PROCESS TABLE                   03420002
034300******************************************************************03430002
034400     EXEC SQL                                                     03440002
034500          INCLUDE TWKORIN                                         03450002
034600     END-EXEC.                                                    03460002
034700                                                                  03470002
034800******************************************************************03480002
034900*    DECLARE RECITM CURSOR W/HOLD (FOR FETCH/UPDATE)             *03490002
035000******************************************************************03500002
035100     EXEC SQL                                                     03510002
035200          DECLARE RECITM-LINE-CSR CURSOR WITH HOLD FOR            03520002
035300          SELECT A.ORD_LNE_NBR                                    03530002
035400               , B.VER_NBR                                        03540002
035500            FROM TRECITM A                                        03550002
035600               , TPURITM B                                        03560002
035700           WHERE A.ORD_NBR        = :TM500-PO-NBR                 03570002
035800             AND A.REC_SEQ_NBR    = :TM500-REC-SEQ-NBR            03580002
035900             AND A.OPER_UNT_ID    = :TM500-OPER-UNT-ID            03590002
036000             AND A.FCLTY_ID       = :TM500-FCLTY-ID               03600002
036100             AND A.PREPK_ID       = :TM500-PREPK-ID               03610002
036200             AND A.VER_STATUS_CDE = :PC-A                         03620002
036300             AND A.ORD_NBR        = B.PO_NBR                      03630002
036400             AND A.ORD_LNE_NBR    = B.APP_PO_LNE_NBR              03640002
036500             AND B.VER_STATUS_CDE = :PC-A                         03650002
036600     END-EXEC.                                                    03660002
036700*                                                                 03670002
036800******************************************************************03680002
036900*    DECLARE RECITM CURSOR W/HOLD AND NO OPER (FOR FETCH/UPDATE) *03690002
037000******************************************************************03700002
037100     EXEC SQL                                                     03710002
037200          DECLARE RECITM-LN-NOOP-CSR CURSOR WITH HOLD FOR         03720007
037300          SELECT A.ORD_LNE_NBR                                    03730002
037400               , B.VER_NBR                                        03740002
037500            FROM TRECITM A                                        03750002
037600               , TPURITM B                                        03760002
037700           WHERE A.ORD_NBR        = :TM500-PO-NBR                 03770002
037800             AND A.REC_SEQ_NBR    = :TM500-REC-SEQ-NBR            03780002
037900             AND A.PREPK_ID       = :TM500-PREPK-ID               03790002
038000             AND A.VER_STATUS_CDE = :PC-A                         03800002
038100             AND A.ORD_NBR        = B.PO_NBR                      03810002
038200             AND A.ORD_LNE_NBR    = B.APP_PO_LNE_NBR              03820002
038300             AND B.VER_STATUS_CDE = :PC-A                         03830002
038400     END-EXEC.                                                    03840002
038500*                                                                 03850002
038600******************************************************************03860002
038700*    DECLARE WKORIN CURSOR FOR A GIVEN LINE NUMBER               *03870002
038800******************************************************************03880002
038900     EXEC SQL                                                     03890002
039000          DECLARE TWKORIN-CSR CURSOR FOR                          03900002
039100          SELECT STRT_TMST                                        03910002
039200               , STOP_TMST                                        03920002
039300               , PRC_FCLTY_AREA_ID                                03930002
039400               , SCREEN_SEQ_NBR                                   03940002
039500            FROM TWKORIN                                          03950002
039600           WHERE ORD_NBR          = :TM500-PO-NBR                 03960002
039700             AND RCVR_SEQ_NBR     = :TM500-REC-SEQ-NBR            03970002
039800             AND ORD_LNE_NBR      = :PV-PO-LNE-NBR                03980002
039900             AND WORK_ORD_SEQ_NBR = 1                             03990002
040000             AND OPER_UNT_ID      = :TM500-OPER-UNT-ID            04000002
040100             AND FCLTY_ID         = :TM500-FCLTY-ID               04010002
040200             AND VER_STATUS_CDE   = :PC-A                         04020002
040300           ORDER BY SCREEN_SEQ_NBR                                04030002
040400     END-EXEC.                                                    04040002
040500*                                                                 04050002
040600******************************************************************04060002
040700*    DECLARE WKORIN0 CURSOR FOR LINE 0                           *04070002
040800******************************************************************04080002
040900     EXEC SQL                                                     04090002
041000          DECLARE WKORIN0-CSR CURSOR FOR                          04100002
041100          SELECT STRT_TMST                                        04110002
041200               , STOP_TMST                                        04120002
041300               , PRC_FCLTY_AREA_ID                                04130002
041400               , SCREEN_SEQ_NBR                                   04140002
041500            FROM TWKORIN                                          04150002
041600           WHERE ORD_NBR          = :TM500-PO-NBR                 04160002
041700             AND RCVR_SEQ_NBR     = :TM500-REC-SEQ-NBR            04170002
041800             AND ORD_LNE_NBR      = 0                             04180002
041900             AND WORK_ORD_SEQ_NBR = 1                             04190002
042000             AND OPER_UNT_ID      = :TM500-OPER-UNT-ID            04200002
042100             AND FCLTY_ID         = :TM500-FCLTY-ID               04210002
042200             AND VER_STATUS_CDE   = :PC-A                         04220002
042300           ORDER BY SCREEN_SEQ_NBR                                04230002
042400     END-EXEC.                                                    04240002
042500                                                                  04250002
042600     EXEC SQL                                                     04260002
042700          DECLARE TTRBRCN-READ-CRS CURSOR FOR                     04270002
042800             SELECT TRBL_RSN_CDE                                  04280002
042900             FROM   TTRBRCN                                       04290002
043000             WHERE  RPT_PGM_NM = 'TMKCS521'                       04300002
043100     END-EXEC.                                                    04310002
043200 LINKAGE SECTION.                                                 04320002
043300                                                                  04330002
043400 01  DFHCOMMAREA.                                                 04340002
043500     05  FILLER                       OCCURS 1 TO 600  TIMES      04350002
043600                                      DEPENDING ON EIBCALEN.      04360002
043700         10  FILLER                   PIC X.                      04370002
043800                                                                  04380002
043900                                                                  04390002
044000 PROCEDURE DIVISION.                                              04400002
044100                                                                  04410002
044200 0000-MAIN-MODULE.                                                04420002
044300                                                                  04430002
044400     PERFORM 1000-INITIAL-PROCESS.                                04440002
044500                                                                  04450002
044600     IF PS-NOT-DONE                                               04460002
044700         PERFORM 2000-MAIN-PROCESS                                04470002
044800     END-IF.                                                      04480002
044900                                                                  04490002
045000     MOVE TM500-FIELDS TO DFHCOMMAREA.                            04500002
045100                                                                  04510002
045200     INITIALIZE PV-CSSL-MSG                                       04520002
045300     MOVE 'GOBACK              '      TO PV-CSSL-PARA             04530002
045400     PERFORM 8000-WRITE-CSSL                                      04540002
045500                                                                  04550002
045600     GOBACK.                                                      04560002
045700                                                                  04570002
045800                                                                  04580002
045900 1000-INITIAL-PROCESS.                                            04590002
046000     INITIALIZE TM500-FIELDS.                                     04600002
046100     INITIALIZE PV-PROGRAM-VARIABLES.                             04610002
046200                                                                  04620002
046300     IF EIBCALEN = 0                                              04630002
046400         SET PS-DONE      TO TRUE                                 04640002
046500     ELSE                                                         04650002
046600         MOVE DFHCOMMAREA TO TM500-FIELDS                         04660002
046700         MOVE PRV-00      TO TM500-RETURN-DATA                    04670002
046800     END-IF.                                                      04680002
046900     PERFORM 1100-PROCESS-REASON-CODES.                           04690002
047000                                                                  04700002
047100     INITIALIZE PV-CSSL-MSG                                       04710002
047200     MOVE '1000-INITIAL-PROCESS'      TO PV-CSSL-PARA             04720002
047300     PERFORM 8000-WRITE-CSSL.                                     04730002
047400                                                                  04740002
047500***  This para reads the TTRBRCN table to determine the           04750008
047600***  TRBL-RSN-CDE's that should not use the OPER-UNIT when        04760008
047700***  accessing the TRECEIV and TRECITM tables.  When the          04770008
047800***  PS-DO-NOT-USE-OPER is set, the SQL executed against these    04780008
047900***  tables will not use the OPER-UNIT in the WHERE clause.       04790008
048000                                                                  04800005
048100 1100-PROCESS-REASON-CODES.                                       04810002
048200     SET PS-DO-USE-OPER  TO TRUE.                                 04820002
048300     PERFORM 1500-OPEN-TTRBRCN-CRS.                               04830002
048400     PERFORM 1600-FETCH-TTRBRCN-CRS                               04840002
048500         UNTIL PS-DO-NOT-USE-OPER   OR                            04850002
048600               PS-RSN-CURSOR-COMPLETE OR                          04860006
048700               PS-DONE.                                           04870006
048800     PERFORM 1700-CLOSE-TTRBRCN-CRS.                              04880002
048900                                                                  04890002
049000 1500-OPEN-TTRBRCN-CRS.                                           04900002
049100                                                                  04910002
049200        EXEC SQL                                                  04920002
049300             OPEN TTRBRCN-READ-CRS                                04930002
049400        END-EXEC.                                                 04940002
049500                                                                  04950002
049600        PERFORM 8001-WRITE-SQLCODE.                               04960002
049700        EVALUATE TRUE                                             04970002
049800                                                                  04980002
049900           WHEN SQLCODE = ZERO                                    04990002
050000                SET PS-RSN-CURSOR-INCOMPLETE TO TRUE              05000002
050100                                                                  05010002
050200           WHEN OTHER                                             05020002
050300                SET  PS-DONE TO TRUE                              05030002
050400                MOVE SQLCA   TO TM500-SQLCA                       05040002
050500                MOVE SQLCODE TO TM500-SQLCODE                     05050002
050600                MOVE PRV-74  TO TM500-RETURN-DATA                 05060002
050700        END-EVALUATE.                                             05070002
050800                                                                  05080002
050900 1600-FETCH-TTRBRCN-CRS.                                          05090002
051000                                                                  05100002
051100        EXEC SQL                                                  05110002
051200          FETCH TTRBRCN-READ-CRS                                  05120002
051300           INTO  :TRBRCN-TRBL-RSN-CDE                             05130002
051400        END-EXEC.                                                 05140002
051500                                                                  05150002
051600       PERFORM 8001-WRITE-SQLCODE.                                05160002
051700       EVALUATE TRUE                                              05170002
051800           WHEN SQLCODE = ZERO                                    05180002
051900               IF TRBRCN-TRBL-RSN-CDE = TM500-TRBL-RSN-CDE        05190002
052000                   SET PS-DO-NOT-USE-OPER   TO TRUE               05200002
052100               END-IF                                             05210002
052200           WHEN SQLCODE = +100                                    05220002
052300               SET PS-RSN-CURSOR-COMPLETE TO TRUE                 05230002
052400                                                                  05240002
052500           WHEN OTHER                                             05250002
052600                SET  PS-DONE TO TRUE                              05260002
052700                MOVE SQLCA   TO TM500-SQLCA                       05270002
052800                MOVE SQLCODE TO TM500-SQLCODE                     05280002
052900                MOVE PRV-75  TO TM500-RETURN-DATA                 05290002
053000        END-EVALUATE.                                             05300002
053100                                                                  05310002
053200                                                                  05320002
053300 1700-CLOSE-TTRBRCN-CRS.                                          05330002
053400                                                                  05340002
053500        EXEC SQL                                                  05350002
053600            CLOSE TTRBRCN-READ-CRS                                05360002
053700        END-EXEC.                                                 05370002
053800                                                                  05380002
053900        EVALUATE TRUE                                             05390002
054000           WHEN SQLCODE = ZERO                                    05400002
054100                CONTINUE                                          05410002
054200                                                                  05420002
054300           WHEN OTHER                                             05430002
054400                SET  PS-DONE TO TRUE                              05440002
054500                MOVE SQLCA   TO TM500-SQLCA                       05450002
054600                MOVE SQLCODE TO TM500-SQLCODE                     05460002
054700                MOVE PRV-76  TO TM500-RETURN-DATA                 05470002
054800        END-EVALUATE.                                             05480002
054900                                                                  05490002
055000 2000-MAIN-PROCESS.                                               05500002
055100******************************************************************05510002
055200*    THIS PARAGRAPH WILL EITHER CREATE A NEW TROUBLE RECORD OR    05520002
055300*    UPDATE A TROUBLE RECORD DEPENDING UPON THE PROCESS INDICATOR 05530002
055400*    OF THE COMM AREA.  IT WILL ALSO CREATE A NEW TROUBLE DETAIL  05540002
055500*    RECORD IF THE DETAIL INDICATOR IS 'Y'.                       05550002
055600******************************************************************05560002
055700                                                                  05570002
055800     MOVE '2000-MAIN-PROCESS'         TO PV-CSSL-PARA             05580002
055900     PERFORM 8000-WRITE-CSSL                                      05590002
056000                                                                  05600002
056100     PERFORM 2100-PREPARE-TTRBNTF.                                05610002
056200                                                                  05620002
056300     EVALUATE TRUE                                                05630002
056400         WHEN TM500-CREATE-AUTO                                   05640002
056500         WHEN TM500-CREATE-MANUAL                                 05650002
056600         WHEN TM500-RESOLVE-AUTO AND TM500-CREATE                 05660002
056700             IF TM500-TRBL-RSN-CDE = PC-502 or PC-509             05670012
056800                  PERFORM 2001-COUNT-TROUBLE                      05680002
056900                  IF PV-DB2-COUNT = ZERO                          05690002
057000                     PERFORM 2200-PREPARE-FOR-INSERT              05700002
057100                  ELSE                                            05710002
057200                     SET PS-DONE TO TRUE                          05720002
057300             ELSE                                                 05730002
057400                  PERFORM 2200-PREPARE-FOR-INSERT                 05740002
057500              END-IF                                              05750002
057600                                                                  05760002
057700             IF PS-NOT-DONE AND TRBRSN-NOTIF-IND = PC-N           05770002
057800                 MOVE TRBNTF-TRBL-RSN-CDE                         05780002
057900                                 TO PV-REASON-CHECKER             05790002
058000                 IF PV-VERIFIED-ADJUSTMENT                        05800002
058100                     CONTINUE                                     05810002
058200                 ELSE                                             05820002
058300                     PERFORM 2002-CHECK-NOTIF                     05830002
058400                 END-IF                                           05840002
058500             END-IF                                               05850002
058600                                                                  05860002
058700              IF PS-NOT-DONE                                      05870002
058800                 IF TRBRSN-RESP-RES-IND = SPACES                  05880002
058900                    PERFORM 2300-INSERT-TTRBNTF                   05890002
059000                 ELSE                                             05900002
059100                    PERFORM 2400-INSERT-TTRBNTF                   05910002
059200                 END-IF                                           05920002
059300              END-IF                                              05930002
059400                                                                  05940002
059500              IF PS-NOT-DONE AND TM500-REC-SEQ-NBR > 0            05950002
059600                  PERFORM 2500-UPDATE-TRECEIV-TMST                05960002
059700              END-IF                                              05970002
059800                                                                  05980002
059900              IF PS-NOT-DONE AND TM500-REC-SEQ-NBR > 0            05990002
060000                  PERFORM 3000-UPDATE-PO-VER-NBR                  06000002
060100              END-IF                                              06010002
060200                                                                  06020002
060300         WHEN TM500-IN-PROCESS                                    06030002
060400         WHEN TM500-RESPOND                                       06040002
060500         WHEN TM500-RESOLVE-MANUAL                                06050002
060600         WHEN TM500-RESOLVE-SPECIFIC                              06060002
060700         WHEN TM500-RESOLVE-AUTO AND TM500-UPDATE                 06070002
060800         WHEN TM500-ACKNOWLEDGE                                   06080002
060900              PERFORM 2600-UPDATE-TTRBNTF                         06090002
061000                                                                  06100002
061100              IF PS-NOT-DONE AND TM500-REC-SEQ-NBR > 0            06110002
061200                  PERFORM 2700-DEFAULT-TRECEIV-TMST               06120002
061300              END-IF                                              06130002
061400                                                                  06140002
061500              IF PS-NOT-DONE AND TM500-REC-SEQ-NBR > 0            06150002
061600                  PERFORM 3000-UPDATE-PO-VER-NBR                  06160002
061700              END-IF                                              06170002
061800                                                                  06180002
061900         WHEN TM500-UPDATE-NOTIF                                  06190002
062000              PERFORM 2800-UPDATE-DEPT-NBR                        06200002
062100                                                                  06210002
062200         WHEN OTHER                                               06220002
062300              SET  PS-DONE TO TRUE                                06230002
062400              MOVE SPACES  TO TM500-SQLCA                         06240002
062500              MOVE ZEROES  TO TM500-SQLCODE                       06250002
062600              MOVE PRV-5A  TO TM500-RETURN-DATA                   06260002
062700                                                                  06270002
062800     END-EVALUATE.                                                06280002
062900                                                                  06290002
063000     IF PS-NOT-DONE                                               06300002
063100         IF PV-TRECEIV-COUNT > ZERO                               06310002
063200             IF TM500-FREEFORM-TEXT > SPACES                      06320002
063300                 MOVE TM500-FREEFORM-TEXT                         06330002
063400                                  TO PV-SAVE-TEXT                 06340002
063500             END-IF                                               06350002
063600                                                                  06360002
063700             MOVE SPACES              TO TM500-FREEFORM-TEXT      06370002
063800             MOVE PC-PRE-RECEIVED TO TM500-FREEFORM-TEXT          06380002
063900             PERFORM 2900-INSERT-TROUBLE-DETAIL                   06390002
064000             MOVE SPACES              TO TM500-FREEFORM-TEXT      06400002
064100                                                                  06410002
064200             IF PV-SAVE-TEXT > SPACES                             06420002
064300                 MOVE PV-SAVE-TEXT        TO TM500-FREEFORM-TEXT  06430002
064400             END-IF                                               06440002
064500         END-IF                                                   06450002
064600     END-IF.                                                      06460002
064700                                                                  06470002
064800     IF PS-NOT-DONE                                               06480002
064900         IF TM500-ADD-DETAILS                                     06490002
065000             EVALUATE TM500-TRBL-RSN-CDE                          06500002
065100             WHEN PC-222                                          06510002
065200             WHEN PC-225                                          06520002
065300                 IF TM500-FREEFORM-TEXT > SPACES                  06530002
065400                     PERFORM 2900-INSERT-TROUBLE-DETAIL           06540002
065500                 END-IF                                           06550002
065600                 IF TM500-RESOLVED-IND = PC-N                     06560002
065700                     MOVE TM500-UNITS-TO-ALLOC                    06570002
065800                                      TO PV-SHOW-QTY              06580002
065900                     STRING 'UNITS RECEIVED: '                    06590002
066000                             PV-SHOW-QTY                          06600002
066100                             DELIMITED BY SIZE                    06610002
066200                                       INTO TM500-FREEFORM-TEXT   06620002
066300                     PERFORM 2900-INSERT-TROUBLE-DETAIL           06630002
066400                 END-IF                                           06640002
066500                                                                  06650002
066600             WHEN PC-502                                          06660002
066700                 EVALUATE TRUE                                    06670002
066800                 WHEN TM500-RTV-YES                               06680002
066900                     MOVE TM500-FREEFORM-TEXT                     06690002
067000                                      TO PV-SAVE-TEXT             06700002
067100                     MOVE SPACES      TO TM500-FREEFORM-TEXT      06710002
067200                     MOVE PC-RTV-MSG-1 TO TM500-FREEFORM-TEXT     06720002
067300                     PERFORM 2900-INSERT-TROUBLE-DETAIL           06730002
067400                     IF PV-SAVE-TEXT > SPACES                     06740002
067500                         MOVE PV-SAVE-TEXT TO TM500-FREEFORM-TEXT 06750002
067600                         PERFORM 2900-INSERT-TROUBLE-DETAIL       06760002
067700                     END-IF                                       06770002
067800                 WHEN TM500-RTV-NO                                06780002
067900                     MOVE TM500-FREEFORM-TEXT                     06790002
068000                                        TO PV-SAVE-TEXT           06800002
068100                     MOVE SPACES        TO TM500-FREEFORM-TEXT    06810002
068200                     MOVE PC-RTV-MSG-2  TO TM500-FREEFORM-TEXT    06820002
068300                     PERFORM 2900-INSERT-TROUBLE-DETAIL           06830002
068400                     IF PV-SAVE-TEXT > SPACES                     06840002
068500                        MOVE PV-SAVE-TEXT  TO TM500-FREEFORM-TEXT 06850002
068600                        PERFORM 2900-INSERT-TROUBLE-DETAIL        06860002
068700                     END-IF                                       06870002
068800                 WHEN OTHER                                       06880002
068900                     IF TM500-FREEFORM-TEXT > SPACES              06890002
069000                         PERFORM 2900-INSERT-TROUBLE-DETAIL       06900002
069100                     END-IF                                       06910002
069200                 END-EVALUATE                                     06920002
069300             WHEN PC-509                                          06930002
069400                 EVALUATE TRUE                                    06940002
069500                 WHEN TM500-RTV-YES                               06950002
069600                     MOVE TM500-FREEFORM-TEXT                     06960002
069700                                      TO PV-SAVE-TEXT             06970002
069800                     MOVE SPACES      TO TM500-FREEFORM-TEXT      06980002
069900                     MOVE PC-RTV-MSG-1 TO TM500-FREEFORM-TEXT     06990002
070000                     PERFORM 2900-INSERT-TROUBLE-DETAIL           07000002
070100                     IF PV-SAVE-TEXT > SPACES                     07010002
070200                         MOVE PV-SAVE-TEXT TO TM500-FREEFORM-TEXT 07020002
070300                         PERFORM 2900-INSERT-TROUBLE-DETAIL       07030002
070400                     END-IF                                       07040002
070500                 WHEN TM500-RTV-NO                                07050002
070600                     MOVE TM500-FREEFORM-TEXT                     07060002
070700                                        TO PV-SAVE-TEXT           07070002
070800                     MOVE SPACES        TO TM500-FREEFORM-TEXT    07080002
070900                     MOVE PC-RTV-MSG-3  TO TM500-FREEFORM-TEXT    07090002
071000                     PERFORM 2900-INSERT-TROUBLE-DETAIL           07100002
071100                     IF PV-SAVE-TEXT > SPACES                     07110002
071200                         MOVE PV-SAVE-TEXT TO TM500-FREEFORM-TEXT 07120002
071300                         PERFORM 2900-INSERT-TROUBLE-DETAIL       07130002
071400                     END-IF                                       07140002
071500                 WHEN OTHER                                       07150002
071600                     IF TM500-FREEFORM-TEXT > SPACES              07160002
071700                         PERFORM 2900-INSERT-TROUBLE-DETAIL       07170002
071800                     END-IF                                       07180002
071900                 END-EVALUATE                                     07190002
072000             WHEN OTHER                                           07200002
072100                     IF TM500-FREEFORM-TEXT > SPACES              07210002
072200                         PERFORM 2900-INSERT-TROUBLE-DETAIL       07220002
072300                     END-IF                                       07230002
072400             END-EVALUATE                                         07240002
072500                                                                  07250002
072600         END-IF                                                   07260002
072700     END-IF.                                                      07270002
072800                                                                  07280002
072900     IF PS-NOT-DONE                                               07290002
073000         IF TM500-RESOLVE-MANUAL            OR                    07300002
073100             (TM500-RESOLVE-AUTO AND TM500-UPDATE AND             07310002
073200              PS-RESOLVE-FOUND)             OR                    07320002
073300             (TM500-RESOLVE-SPECIFIC AND TM500-UPDATE AND         07330002
073400              PS-RESOLVE-FOUND)             OR                    07340002
073500             (TM500-CREATE-AUTO  AND                              07350002
073600              TRBRSN-RESP-RES-IND = SPACES) OR                    07360002
073700             (TM500-RESOLVE-AUTO AND TM500-CREATE AND             07370002
073800              TRBRSN-RESP-RES-IND = SPACES)                       07380002
073900             MOVE TM500-CRE-UID       TO PV-TEMP-UID              07390002
074000             MOVE SPACES              TO TM500-CRE-UID            07400002
074100             MOVE TM500-RESOLVED-UID  TO TM500-CRE-UID            07410002
074200             MOVE TM500-FREEFORM-TEXT TO PV-TEMP-TEXT             07420002
074300             MOVE SPACES              TO TM500-FREEFORM-TEXT      07430002
074400             MOVE 'RESOLVED'          TO TM500-FREEFORM-TEXT      07440002
074500             PERFORM 2900-INSERT-TROUBLE-DETAIL                   07450002
074600             MOVE SPACES              TO TM500-FREEFORM-TEXT      07460002
074700             MOVE PV-TEMP-TEXT        TO TM500-FREEFORM-TEXT      07470002
074800             MOVE SPACES              TO TM500-CRE-UID            07480002
074900             MOVE PV-TEMP-UID         TO TM500-CRE-UID            07490002
075000         END-IF                                                   07500002
075100     END-IF.                                                      07510002
075200                                                                  07520002
075300 2001-COUNT-TROUBLE.                                              07530002
075310**                                                                07531017
075400     MOVE '2001-COUNT-TROUBLE'        TO PV-CSSL-PARA             07540002
075500     PERFORM 8000-WRITE-CSSL                                      07550002
075600                                                                  07560002
075700     MOVE ZERO          TO PV-DB2-COUNT                           07570002
075800     PERFORM WITH TEST AFTER                                      07580002
075900         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    07590002
076000         UNTIL   SQLCODE = +0 OR                                  07600002
076100                 PS-DONE OR                                       07610002
076200                 PV-RETRY-COUNTER > PC-MAX-RETRIES                07620002
076300                                                                  07630002
076310         IF TM500-TRBL-RSN-CDE = PC-502                           07631017
076400            EXEC SQL                                              07640012
076500                 SELECT COUNT(*)                                  07650012
076600                   INTO :PV-DB2-COUNT :PV-NULL-IND                07660012
076700                   FROM TTRBNTF                                   07670012
076800              WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID             07680012
076900                AND FCLTY_ID     = :TM500-FCLTY-ID                07690012
077000                AND PO_NBR       = :TM500-PO-NBR                  07700012
077100                AND PO_LNE_NBR   = :TM500-PO-LNE-NBR              07710012
077200                AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR             07720012
077300                AND TRBL_RSN_CDE = :PC-502                        07730012
077400                AND RTV_IND = :PC-N                               07740012
077500                AND RESOLVED_IND IN (:PC-R, :PC-A)                07750012
077600            END-EXEC                                              07760012
077610         ELSE                                                     07761017
077620            EXEC SQL                                              07762012
077630                 SELECT COUNT(*)                                  07763012
077640                   INTO :PV-DB2-COUNT :PV-NULL-IND                07764012
077650                   FROM TTRBNTF                                   07765012
077660              WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID             07766012
077670                AND FCLTY_ID     = :TM500-FCLTY-ID                07767012
077680                AND PO_NBR       = :TM500-PO-NBR                  07768012
077690                AND PO_LNE_NBR   = :TM500-PO-LNE-NBR              07769012
077691                AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR             07769112
077692                AND TRBL_RSN_CDE = :PC-509                        07769215
077693                AND RTV_IND = :PC-N                               07769312
077694                AND RESOLVED_IND IN (:PC-R, :PC-A)                07769412
077695            END-EXEC                                              07769512
077696         END-IF                                                   07769612
077700                                                                  07770002
077800         PERFORM 8001-WRITE-SQLCODE                               07780002
077900                                                                  07790002
078000         EVALUATE TRUE                                            07800002
078100             WHEN SQLCODE = +0                                    07810002
078200             WHEN SQLCODE = +100                                  07820002
078300             WHEN SQLCODE = -904                                  07830002
078400             WHEN SQLCODE = -911                                  07840002
078500             WHEN SQLCODE = -913                                  07850002
078600                  CONTINUE                                        07860002
078700                                                                  07870002
078800             WHEN OTHER                                           07880002
078900                  SET  PS-DONE TO TRUE                            07890002
079000                  MOVE SQLCA   TO TM500-SQLCA                     07900002
079100                  MOVE SQLCODE TO TM500-SQLCODE                   07910002
079200                  MOVE PRV-48  TO TM500-RETURN-DATA               07920002
079300         END-EVALUATE                                             07930002
079400     END-PERFORM.                                                 07940002
079500                                                                  07950002
079600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         07960002
079700         SET PS-DONE  TO TRUE                                     07970002
079800         MOVE SQLCA   TO TM500-SQLCA                              07980002
079900         MOVE SQLCODE TO TM500-SQLCODE                            07990002
080000         MOVE PRV-48  TO TM500-RETURN-DATA                        08000002
080100     END-IF.                                                      08010002
080200                                                                  08020002
080300                                                                  08030002
080400 2002-CHECK-NOTIF.                                                08040002
080500                                                                  08050002
080600     MOVE '2002-CHECK-NOTIF'          TO PV-CSSL-PARA             08060002
080700     PERFORM 8000-WRITE-CSSL                                      08070002
080800                                                                  08080002
080900     PERFORM WITH TEST AFTER                                      08090002
081000         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    08100002
081100         UNTIL   SQLCODE = +100 OR                                08110002
081200                 SQLCODE = +0 OR                                  08120002
081300                 SQLCODE = -811 OR                                08130002
081400                 PS-DONE OR                                       08140002
081500                 PV-RETRY-COUNTER > PC-MAX-RETRIES                08150002
081600                                                                  08160002
081700         EXEC SQL                                                 08170002
081800             SELECT NOTIF_NBR                                     08180002
081900                 INTO :TRBNTF-NOTIF-NBR                           08190002
082000                 FROM TTRBNTF                                     08200002
082100                 WHERE OPER_UNT_ID    = :TRBNTF-OPER-UNT-ID       08210002
082200                     AND FCLTY_ID     = :TRBNTF-FCLTY-ID          08220002
082300                     AND PO_NBR       = :TRBNTF-PO-NBR            08230002
082400                     AND PO_LNE_NBR   = :TRBNTF-PO-LNE-NBR        08240002
082500                     AND PREPK_ID     = :TRBNTF-PREPK-ID          08250002
082600                     AND REC_SEQ_NBR  = :TRBNTF-REC-SEQ-NBR       08260002
082700                     AND TRBL_RSN_CDE = :TRBNTF-TRBL-RSN-CDE      08270002
082800         END-EXEC                                                 08280002
082900         PERFORM 8001-WRITE-SQLCODE                               08290002
083000         EVALUATE SQLCODE                                         08300002
083100             WHEN ZERO                                            08310002
083200             WHEN -811                                            08320002
083300                 SET PS-DONE TO TRUE                              08330002
083400             WHEN +100                                            08340002
083500             WHEN -904                                            08350002
083600             WHEN -911                                            08360002
083700             WHEN -913                                            08370002
083800                 CONTINUE                                         08380002
083900             WHEN OTHER                                           08390002
084000                 SET PS-DONE TO TRUE                              08400002
084100                 MOVE SQLCA TO TM500-SQLCA                        08410002
084200                 MOVE SQLCODE TO TM500-SQLCODE                    08420002
084300                 MOVE PRV-5D TO TM500-RETURN-DATA                 08430002
084400                 MOVE SPACES TO PRV-TM500-RETURN-MSG              08440002
084500                 MOVE '2002' TO PRV-PARA                          08450002
084600                 MOVE 'TTRBNTF' TO PRV-TBL                        08460002
084700                 PERFORM 9999-RETURN-MSG                          08470002
084800         END-EVALUATE                                             08480002
084900     END-PERFORM.                                                 08490002
085000                                                                  08500002
085100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         08510002
085200         SET  PS-DONE TO TRUE                                     08520002
085300         MOVE SQLCA   TO TM500-SQLCA                              08530002
085400         MOVE SQLCODE TO TM500-SQLCODE                            08540002
085500         MOVE PRV-5D  TO TM500-RETURN-DATA                        08550002
085600                                                                  08560002
085700         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   08570002
085800         MOVE '2002'    TO PRV-PARA                               08580002
085900         MOVE 'TTRBNTF' TO PRV-TBL                                08590002
086000         PERFORM 9999-RETURN-MSG                                  08600002
086100     END-IF.                                                      08610002
086200                                                                  08620002
086300                                                                  08630002
086400                                                                  08640002
086500 2100-PREPARE-TTRBNTF.                                            08650002
086600******************************************************************08660002
086700*    THIS PARAGRAPH PREPARES THE TTRBNTF FIELDS BEFORE INSERTING  08670002
086800*    THE RECORD.  IT CALLS PARAGRAPH 2110 2120 AND 2130 AS WELL   08680002
086900*    AS MOVE MOST OF THE COMM AREA DATA INTO TTRBNTF FIELDS.      08690002
087000******************************************************************08700002
087100                                                                  08710002
087200     MOVE '2100-PREPARE-TTRBNTF'      TO PV-CSSL-PARA             08720002
087300     PERFORM 8000-WRITE-CSSL                                      08730002
087400                                                                  08740002
087500     INITIALIZE DCLTTRBNTF.                                       08750002
087600                                                                  08760002
087700     MOVE TM500-NOTIF-NBR        TO TRBNTF-NOTIF-NBR.             08770002
087800     MOVE TM500-OPER-UNT-ID      TO TRBNTF-OPER-UNT-ID.           08780002
087900     MOVE TM500-FCLTY-ID         TO TRBNTF-FCLTY-ID.              08790002
088000     MOVE TM500-PO-NBR           TO TRBNTF-PO-NBR.                08800002
088100     MOVE TM500-PO-LNE-NBR       TO TRBNTF-PO-LNE-NBR.            08810002
088200     MOVE TM500-REC-SEQ-NBR      TO TRBNTF-REC-SEQ-NBR.           08820002
088300     MOVE TM500-TRBL-RSN-CDE     TO TRBNTF-TRBL-RSN-CDE.          08830002
088400     MOVE TM500-PREPK-ID         TO TRBNTF-PREPK-ID.              08840002
088500     MOVE PC-DEFAULT-TMST        TO TRBNTF-NOTIF-TMST.            08850002
088600     MOVE TM500-NOTIF-UID        TO TRBNTF-NOTIF-UID.             08860002
088700     MOVE PC-DEFAULT-TMST        TO TRBNTF-RESOLVED-TMST.         08870002
088800     MOVE PC-DEFAULT-TMST        TO TRBNTF-ACKNOWLG-TMST.         08880002
088900*    MOVE TM500-SHIPT-ID         TO TRBNTF-SHIPT-ID.              08890002
089000*    MOVE TM500-PKSL-SEQ-NBR     TO TRBNTF-PKSL-SEQ-NBR.          08900002
089100*    MOVE TM500-PKSL-LNE-NBR     TO TRBNTF-PKSL-LNE-NBR.          08910002
089200*    MOVE TM500-WORK-ORD-SEQ-NBR TO TRBNTF-WORK-ORD-SEQ-NBR.      08920002
089300*    MOVE TM500-WO-INSTR-SEQ-NBR TO TRBNTF-WO-INSTR-SEQ-NBR.      08930002
089400     MOVE TM500-OVER-SHORT-PCT   TO TRBNTF-OVER-SHT-PCT.          08940002
089500     MOVE TM500-DEPT-NBR         TO TRBNTF-DEPT-NBR.              08950002
089600     MOVE TM500-RTV-SW           TO TRBNTF-RTV-IND.               08960002
089700     MOVE TM500-PRORATE-IND      TO TRBNTF-PRORATE-IND.           08970002
089800                                                                  08980002
089900 2200-PREPARE-FOR-INSERT.                                         08990002
090000******************************************************************09000002
090100******************************************************************09010002
090200                                                                  09020002
090300     MOVE '2200-PREPARE-FOR-INSERT'   TO PV-CSSL-PARA             09030002
090400     PERFORM 8000-WRITE-CSSL                                      09040002
090500                                                                  09050002
090600     MOVE PC-N TO TRBNTF-RESOLVED-IND.                            09060002
090700                                                                  09070002
090800     PERFORM 2210-CHECK-FOR-DUP.                                  09080002
090900                                                                  09090002
091000     IF PS-NOT-DONE                                               09100002
091100         PERFORM 2220-GET-PO-DATA                                 09110002
091200         MOVE PURCHS-DEPT-NBR TO TRBNTF-DEPT-NBR                  09120002
091300         MOVE PURCHS-ENT-ID   TO TRBNTF-ENT-ID                    09130002
091400     END-IF.                                                      09140002
091500                                                                  09150002
091600     IF PS-NOT-DONE                                               09160002
091700         PERFORM 6000-GET-FCLTY-AREA-ID                           09170002
091800         MOVE WKORIN-PRC-FCLTY-AREA-ID TO TRBNTF-FCLTY-AREA-ID    09180002
091900     END-IF.                                                      09190002
092000                                                                  09200002
092100     IF PS-NOT-DONE                                               09210002
092200         PERFORM 2240-SELECT-RESP-RES-IND                         09220002
092300     END-IF.                                                      09230002
092400                                                                  09240002
092500     IF PS-NOT-DONE                                               09250002
092600         IF PS-DO-NOT-USE-OPER                                    09260002
092700             PERFORM 2250-SELECT-COUNT-TRCV-NO-OPER               09270009
092800         ELSE                                                     09280002
092900             PERFORM 2245-SELECT-COUNT-TRECEIV                    09290002
093000         END-IF                                                   09300002
093100     END-IF.                                                      09310002
093200     IF PS-NOT-DONE AND PV-TRECEIV-COUNT > ZERO                   09320002
093300         MOVE PC-P                    TO TRBNTF-CRE-IND           09330002
093400     END-IF.                                                      09340002
093500                                                                  09350002
093600     IF PS-NOT-DONE                                               09360002
093700         PERFORM 2260-GET-RANDOM-NBR                              09370002
093800         MOVE DP902-RANDOM-NUMBER       TO TM500-NOTIF-NBR        09380002
093900                                           TRBNTF-NOTIF-NBR       09390002
094000     END-IF.                                                      09400002
094100/                                                                 09410002
094200 2210-CHECK-FOR-DUP.                                              09420002
094300                                                                  09430002
094400     MOVE '2210-CHECK-FOR-DUP'        TO PV-CSSL-PARA             09440002
094500     PERFORM 8000-WRITE-CSSL                                      09450002
094600                                                                  09460002
094700     PERFORM WITH TEST AFTER                                      09470002
094800         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    09480002
094900         UNTIL   SQLCODE = +100 OR                                09490002
095000                 SQLCODE = +0 OR                                  09500002
095100                 SQLCODE = -811 OR                                09510002
095200                 PS-DONE OR                                       09520002
095300                 PV-RETRY-COUNTER > PC-MAX-RETRIES                09530002
095400                                                                  09540002
095500         EXEC SQL                                                 09550002
095600              SELECT NOTIF_NBR                                    09560002
095700                INTO :TRBNTF-NOTIF-NBR                            09570002
095800                FROM TTRBNTF                                      09580002
095900               WHERE OPER_UNT_ID  = :TRBNTF-OPER-UNT-ID           09590002
096000                 AND FCLTY_ID     = :TRBNTF-FCLTY-ID              09600002
096100                 AND PO_NBR       = :TRBNTF-PO-NBR                09610002
096200                 AND PO_LNE_NBR   = :TRBNTF-PO-LNE-NBR            09620002
096300                 AND PREPK_ID     = :TRBNTF-PREPK-ID              09630002
096400                 AND REC_SEQ_NBR  = :TRBNTF-REC-SEQ-NBR           09640002
096500                 AND TRBL_RSN_CDE = :TRBNTF-TRBL-RSN-CDE          09650002
096600                 AND RESOLVED_IND IN (:PC-N, :PC-I)               09660002
096700         END-EXEC                                                 09670002
096800                                                                  09680002
096900         PERFORM 8001-WRITE-SQLCODE                               09690002
097000         EVALUATE TRUE                                            09700002
097100             WHEN SQLCODE = +0                                    09710002
097200             WHEN SQLCODE = -811                                  09720002
097300                  SET  PS-DONE TO TRUE                            09730002
097400                  MOVE SQLCA   TO TM500-SQLCA                     09740002
097500                  MOVE SQLCODE TO TM500-SQLCODE                   09750002
097600                  MOVE PRV-50  TO TM500-RETURN-DATA               09760002
097700                                                                  09770002
097800             WHEN SQLCODE = +100                                  09780002
097900                  CONTINUE                                        09790002
098000                                                                  09800002
098100             WHEN SQLCODE = -904                                  09810002
098200             WHEN SQLCODE = -911                                  09820002
098300             WHEN SQLCODE = -913                                  09830002
098400                  CONTINUE                                        09840002
098500                                                                  09850002
098600             WHEN OTHER                                           09860002
098700                  SET  PS-DONE TO TRUE                            09870002
098800                  MOVE SQLCA   TO TM500-SQLCA                     09880002
098900                  MOVE SQLCODE TO TM500-SQLCODE                   09890002
099000                  MOVE PRV-5D  TO TM500-RETURN-DATA               09900002
099100                                                                  09910002
099200                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          09920002
099300                  MOVE '2210'    TO PRV-PARA                      09930002
099400                  MOVE 'TTRBNTF' TO PRV-TBL                       09940002
099500                  PERFORM 9999-RETURN-MSG                         09950002
099600         END-EVALUATE                                             09960002
099700     END-PERFORM.                                                 09970002
099800                                                                  09980002
099900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         09990002
100000         SET  PS-DONE TO TRUE                                     10000002
100100         MOVE SQLCA   TO TM500-SQLCA                              10010002
100200         MOVE SQLCODE TO TM500-SQLCODE                            10020002
100300         MOVE PRV-5D  TO TM500-RETURN-DATA                        10030002
100400                                                                  10040002
100500         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   10050002
100600         MOVE '2210'    TO PRV-PARA                               10060002
100700         MOVE 'TTRBNTF' TO PRV-TBL                                10070002
100800         PERFORM 9999-RETURN-MSG                                  10080002
100900     END-IF.                                                      10090002
101000                                                                  10100002
101100                                                                  10110002
101200 2220-GET-PO-DATA.                                                10120002
101300******************************************************************10130002
101400*    THIS PARAGRAPH RETRIEVES DEPT-NBR AND ENT-ID FROM            10140002
101500*    TPURCHS TABLE.                                               10150002
101600******************************************************************10160002
101700                                                                  10170002
101800     MOVE '2220-GET-PO-DATA'          TO PV-CSSL-PARA             10180002
101900     PERFORM 8000-WRITE-CSSL                                      10190002
102000                                                                  10200002
102100     PERFORM WITH TEST AFTER                                      10210002
102200         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    10220002
102300         UNTIL   SQLCODE = +0 OR                                  10230002
102400                 SQLCODE = +100 OR                                10240002
102500                 PS-DONE OR                                       10250002
102600                 PV-RETRY-COUNTER > PC-MAX-RETRIES                10260002
102700                                                                  10270002
102800         EXEC SQL                                                 10280002
102900              SELECT DEPT_NBR                                     10290002
103000                   , ENT_ID                                       10300002
103100                INTO :PURCHS-DEPT-NBR                             10310002
103200                   , :PURCHS-ENT-ID                               10320002
103300                FROM TPURCHS                                      10330002
103400               WHERE PO_NBR         = :TRBNTF-PO-NBR              10340002
103500                 AND VER_STATUS_CDE = :PC-ACTIVE                  10350002
103600         END-EXEC                                                 10360002
103700                                                                  10370002
103800         PERFORM 8001-WRITE-SQLCODE                               10380002
103900         EVALUATE TRUE                                            10390002
104000             WHEN SQLCODE = +0                                    10400002
104100                  CONTINUE                                        10410002
104200                                                                  10420002
104300             WHEN SQLCODE = +100                                  10430002
104400                  MOVE '000'  TO PURCHS-DEPT-NBR                  10440002
104500                  MOVE ZEROES TO PURCHS-ENT-ID                    10450002
104600                                                                  10460002
104700             WHEN SQLCODE = -904                                  10470002
104800             WHEN SQLCODE = -911                                  10480002
104900             WHEN SQLCODE = -913                                  10490002
105000                  CONTINUE                                        10500002
105100                                                                  10510002
105200             WHEN OTHER                                           10520002
105300                  SET  PS-DONE TO TRUE                            10530002
105400                  MOVE SQLCA   TO TM500-SQLCA                     10540002
105500                  MOVE SQLCODE TO TM500-SQLCODE                   10550002
105600                  MOVE PRV-5E  TO TM500-RETURN-DATA               10560002
105700                                                                  10570002
105800                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          10580002
105900                  MOVE '2220'    TO PRV-PARA                      10590002
106000                  MOVE 'TPURCHS' TO PRV-TBL                       10600002
106100                  PERFORM 9999-RETURN-MSG                         10610002
106200         END-EVALUATE                                             10620002
106300     END-PERFORM.                                                 10630002
106400                                                                  10640002
106500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         10650002
106600         SET PS-DONE  TO TRUE                                     10660002
106700         MOVE SQLCA   TO TM500-SQLCA                              10670002
106800         MOVE SQLCODE TO TM500-SQLCODE                            10680002
106900         MOVE PRV-5E  TO TM500-RETURN-DATA                        10690002
107000                                                                  10700002
107100         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   10710002
107200         MOVE '2220'    TO PRV-PARA                               10720002
107300         MOVE 'TPURCHS' TO PRV-TBL                                10730002
107400         PERFORM 9999-RETURN-MSG                                  10740002
107500     END-IF.                                                      10750002
107600                                                                  10760002
107700                                                                  10770002
107800 2240-SELECT-RESP-RES-IND.                                        10780002
107900******************************************************************10790002
108000******************************************************************10800002
108100                                                                  10810002
108200     MOVE '2240-SELECT-RESP-RES-IND'  TO PV-CSSL-PARA             10820002
108300     PERFORM 8000-WRITE-CSSL                                      10830002
108400                                                                  10840002
108500     PERFORM WITH TEST AFTER                                      10850002
108600         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    10860002
108700         UNTIL   SQLCODE = +0 OR                                  10870002
108800                 PS-DONE OR                                       10880002
108900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                10890002
109000                                                                  10900002
109100         EXEC SQL                                                 10910002
109200              SELECT RESP_RES_IND                                 10920002
109300                  ,  NOTIF_IND                                    10930002
109400                  ,  RSLV_RSPNT_CDE                               10940002
109500                INTO :TRBRSN-RESP-RES-IND                         10950002
109600                  ,  :TRBRSN-NOTIF-IND                            10960002
109700                  ,  :TRBRSN-RSLV-RSPNT-CDE                       10970002
109800                FROM TTRBRSN                                      10980002
109900               WHERE TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE           10990002
110000         END-EXEC                                                 11000002
110100                                                                  11010002
110200         PERFORM 8001-WRITE-SQLCODE                               11020002
110300         EVALUATE TRUE                                            11030002
110400             WHEN SQLCODE = +0                                    11040002
110500                  CONTINUE                                        11050002
110600                                                                  11060002
110700             WHEN SQLCODE = -904                                  11070002
110800             WHEN SQLCODE = -911                                  11080002
110900             WHEN SQLCODE = -913                                  11090002
111000                  CONTINUE                                        11100002
111100                                                                  11110002
111200             WHEN OTHER                                           11120002
111300                  SET  PS-DONE TO TRUE                            11130002
111400                  MOVE SQLCA   TO TM500-SQLCA                     11140002
111500                  MOVE SQLCODE TO TM500-SQLCODE                   11150002
111600                  MOVE PRV-5K  TO TM500-RETURN-DATA               11160002
111700                                                                  11170002
111800                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          11180002
111900                  MOVE '2240'    TO PRV-PARA                      11190002
112000                  MOVE 'TTRBRSN' TO PRV-TBL                       11200002
112100                  PERFORM 9999-RETURN-MSG                         11210002
112200         END-EVALUATE                                             11220002
112300     END-PERFORM.                                                 11230002
112400                                                                  11240002
112500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         11250002
112600         SET PS-DONE  TO TRUE                                     11260002
112700         MOVE SQLCA   TO TM500-SQLCA                              11270002
112800         MOVE SQLCODE TO TM500-SQLCODE                            11280002
112900         MOVE PRV-5K  TO TM500-RETURN-DATA                        11290002
113000                                                                  11300002
113100         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   11310002
113200         MOVE '2240'    TO PRV-PARA                               11320002
113300         MOVE 'TTRBRSN' TO PRV-TBL                                11330002
113400         PERFORM 9999-RETURN-MSG                                  11340002
113500     END-IF.                                                      11350002
113600                                                                  11360002
113700                                                                  11370002
113800 2245-SELECT-COUNT-TRECEIV.                                       11380002
113900******************************************************************11390002
114000******************************************************************11400002
114100                                                                  11410002
114200     MOVE '2245-SELECT-COUNT-TRECEIV' TO PV-CSSL-PARA             11420002
114300     PERFORM 8000-WRITE-CSSL                                      11430002
114400                                                                  11440002
114500     MOVE ZERO          TO PV-TRECEIV-COUNT                       11450002
114600     PERFORM WITH TEST AFTER                                      11460002
114700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    11470002
114800         UNTIL   SQLCODE = +0 OR                                  11480002
114900                 PS-DONE OR                                       11490002
115000                 PV-RETRY-COUNTER > PC-MAX-RETRIES                11500002
115100                                                                  11510002
115200         EXEC SQL                                                 11520002
115300              SELECT COUNT(*)                                     11530002
115400                INTO :PV-TRECEIV-COUNT :PV-NULL-IND               11540002
115500                FROM TRECEIV                                      11550002
115600               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          11560002
115700                 AND FCLTY_ID       = :TM500-FCLTY-ID             11570002
115800                 AND ORD_NBR        = :TM500-PO-NBR               11580002
115900                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          11590002
116000                 AND VER_STATUS_CDE = :PC-ACTIVE                  11600002
116100                 AND SYST_CRE_CDE   = :PC-P                       11610002
116200         END-EXEC                                                 11620002
116300                                                                  11630002
116400         PERFORM 8001-WRITE-SQLCODE                               11640002
116500         EVALUATE TRUE                                            11650002
116600             WHEN SQLCODE = +0                                    11660002
116700             WHEN SQLCODE = +100                                  11670002
116800             WHEN SQLCODE = -904                                  11680002
116900             WHEN SQLCODE = -911                                  11690002
117000             WHEN SQLCODE = -913                                  11700002
117100                  CONTINUE                                        11710002
117200                                                                  11720002
117300             WHEN OTHER                                           11730002
117400                  SET  PS-DONE TO TRUE                            11740002
117500                  MOVE SQLCA   TO TM500-SQLCA                     11750002
117600                  MOVE SQLCODE TO TM500-SQLCODE                   11760002
117700                  MOVE PRV-5G  TO TM500-RETURN-DATA               11770002
117800                                                                  11780002
117900                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          11790002
118000                  MOVE '2245'    TO PRV-PARA                      11800002
118100                  MOVE 'TRECEIV' TO PRV-TBL                       11810002
118200                  PERFORM 9999-RETURN-MSG                         11820002
118300         END-EVALUATE                                             11830002
118400     END-PERFORM.                                                 11840002
118500                                                                  11850002
118600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         11860002
118700         SET PS-DONE  TO TRUE                                     11870002
118800         MOVE SQLCA   TO TM500-SQLCA                              11880002
118900         MOVE SQLCODE TO TM500-SQLCODE                            11890002
119000         MOVE PRV-5G  TO TM500-RETURN-DATA                        11900002
119100                                                                  11910002
119200         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   11920002
119300         MOVE '2245'    TO PRV-PARA                               11930002
119400         MOVE 'TRECEIV' TO PRV-TBL                                11940002
119500         PERFORM 9999-RETURN-MSG                                  11950002
119600     END-IF.                                                      11960002
119700                                                                  11970002
119800 2250-SELECT-COUNT-TRCV-NO-OPER.                                  11980009
119900******************************************************************11990002
120000******************************************************************12000002
120100                                                                  12010002
120200     MOVE '2250-SELECT-COUNT-TRCV-NO-OPER' TO PV-CSSL-PARA        12020009
120300     PERFORM 8000-WRITE-CSSL                                      12030002
120400                                                                  12040002
120500     MOVE ZERO          TO PV-TRECEIV-COUNT                       12050002
120600     PERFORM WITH TEST AFTER                                      12060002
120700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    12070002
120800         UNTIL   SQLCODE = +0 OR                                  12080002
120900                 PS-DONE OR                                       12090002
121000                 PV-RETRY-COUNTER > PC-MAX-RETRIES                12100002
121100                                                                  12110002
121200         EXEC SQL                                                 12120002
121300              SELECT COUNT(*)                                     12130002
121400                INTO :PV-TRECEIV-COUNT :PV-NULL-IND               12140002
121500                FROM TRECEIV                                      12150002
121600               WHERE ORD_NBR        = :TM500-PO-NBR               12160002
121700                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          12170002
121800                 AND VER_STATUS_CDE = :PC-ACTIVE                  12180002
121900                 AND SYST_CRE_CDE   = :PC-P                       12190002
122000         END-EXEC                                                 12200002
122100                                                                  12210002
122200         PERFORM 8001-WRITE-SQLCODE                               12220002
122300         EVALUATE TRUE                                            12230002
122400             WHEN SQLCODE = +0                                    12240002
122500             WHEN SQLCODE = +100                                  12250002
122600             WHEN SQLCODE = -904                                  12260002
122700             WHEN SQLCODE = -911                                  12270002
122800             WHEN SQLCODE = -913                                  12280002
122900                  CONTINUE                                        12290002
123000                                                                  12300002
123100             WHEN OTHER                                           12310002
123200                  SET  PS-DONE TO TRUE                            12320002
123300                  MOVE SQLCA   TO TM500-SQLCA                     12330002
123400                  MOVE SQLCODE TO TM500-SQLCODE                   12340002
123500                  MOVE PRV-5G  TO TM500-RETURN-DATA               12350002
123600                                                                  12360002
123700                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          12370002
123800                  MOVE '2250'    TO PRV-PARA                      12380002
123900                  MOVE 'TRECEIV' TO PRV-TBL                       12390002
124000                  PERFORM 9999-RETURN-MSG                         12400002
124100         END-EVALUATE                                             12410002
124200     END-PERFORM.                                                 12420002
124300                                                                  12430002
124400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         12440002
124500         SET PS-DONE  TO TRUE                                     12450002
124600         MOVE SQLCA   TO TM500-SQLCA                              12460002
124700         MOVE SQLCODE TO TM500-SQLCODE                            12470002
124800         MOVE PRV-5G  TO TM500-RETURN-DATA                        12480002
124900                                                                  12490002
125000         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   12500002
125100         MOVE '2250'    TO PRV-PARA                               12510002
125200         MOVE 'TRECEIV' TO PRV-TBL                                12520002
125300         PERFORM 9999-RETURN-MSG                                  12530002
125400     END-IF.                                                      12540002
125500/                                                                 12550002
125600 2260-GET-RANDOM-NBR.                                             12560002
125700     MOVE '2260-GET-RANDOM-NBR'       TO PV-CSSL-PARA             12570002
125800     PERFORM 8000-WRITE-CSSL                                      12580002
125900                                                                  12590002
126000     CALL PC-RAND-PGM USING DFHEIBLK                              12600002
126100                            DFHCOMMAREA                           12610002
126200                            DP902-RANDNBR-ROUTINE-FIELDS.         12620002
126300                                                                  12630002
126400     IF DP902-SUCCESSFUL                                          12640002
126500         CONTINUE                                                 12650002
126600     ELSE                                                         12660002
126700         SET PS-DONE      TO TRUE                                 12670002
126800         MOVE SQLCA       TO TM500-SQLCA                          12680002
126900         MOVE SQLCODE     TO TM500-SQLCODE                        12690002
127000         MOVE PRV-51      TO TM500-RETURN-DATA                    12700002
127100         MOVE SPACES      TO PRV-TM500-RETURN-MSG                 12710002
127200         MOVE '2260'      TO PRV-PARA                             12720002
127300         MOVE 'TTRBNTF'   TO PRV-TBL                              12730002
127400         PERFORM 9999-RETURN-MSG                                  12740002
127500     END-IF.                                                      12750002
127600/                                                                 12760002
127700 2300-INSERT-TTRBNTF.                                             12770002
127800******************************************************************12780002
127900*    THIS PARAGRAPH INSERTS A PRE-RESOLVED TTRBNTF RECORD.        12790002
128000*                                                                 12800002
128100*    IF A DUPLICATE KEY IS ENCOUNTERED, A NEW RANDOM NUMBER       12810002
128200*    WILL BE CALCULATED AND THE INSERT WILL BE RETRIED.           12820002
128300*    ON THE CHANCE THAT LIGHTNING STRIKES MORE THAN 3 TIMES       12830002
128400*    IN THE SAME SPOT (WE CAN'T FIND A UNIQUE 9 DIGIT KEY),       12840002
128500*    AN ERROR WILL BE PASSED BACK THROUGH THE COMMAREA TO THE     12850002
128600*    CALLING PROGRAM.                                             12860002
128700******************************************************************12870002
128800                                                                  12880002
128900     MOVE '2300-INSERT-TTRBNTF'       TO PV-CSSL-PARA             12890002
129000     PERFORM 8000-WRITE-CSSL                                      12900002
129100                                                                  12910002
129200     PERFORM WITH TEST AFTER                                      12920002
129300         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     12930002
129400         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR               12940002
129500         SQLCODE = ZERO OR PS-DONE                                12950002
129600         EXEC SQL                                                 12960002
129700              INSERT INTO TTRBNTF                                 12970002
129800                     (NOTIF_NBR                                   12980002
129900                   ,  OPER_UNT_ID                                 12990002
130000                   ,  FCLTY_ID                                    13000002
130100                   ,  DEPT_NBR                                    13010002
130200                   ,  ENT_ID                                      13020002
130300                   ,  PO_NBR                                      13030002
130400                   ,  PO_LNE_NBR                                  13040002
130500                   ,  REC_SEQ_NBR                                 13050002
130600                   ,  TRBL_RSN_CDE                                13060002
130700                   ,  NOTIF_TMST                                  13070002
130800                   ,  NOTIF_UID                                   13080002
130900                   ,  RESOLVED_IND                                13090002
131000                   ,  RESOLVED_TMST                               13100002
131100                   ,  RESOLVED_UID                                13110002
131200                   ,  ACKNOWLG_TMST                               13120002
131300                   ,  ACKNOWLG_UID                                13130002
131400                   ,  CNTCT_EXT                                   13140002
131500                   ,  FCLTY_AREA_ID                               13150002
131600                   ,  SHIPT_ID                                    13160002
131700                   ,  PKSL_SEQ_NBR                                13170002
131800                   ,  PKSL_LNE_NBR                                13180002
131900                   ,  WORK_ORD_SEQ_NBR                            13190002
132000                   ,  WO_INSTR_SEQ_NBR                            13200002
132100                   ,  OVER_SHT_PCT                                13210002
132200                   ,  LAST_DTL_CRE_TMST                           13220002
132300                   ,  CRE_IND                                     13230002
132400                   ,  PRORATE_IND                                 13240002
132500                   ,  RTV_IND                                     13250002
132600                   ,  RTV_RESPONSE_TMST                           13260002
132700                   ,  PREPK_ID)                                   13270002
132800              VALUES (:TRBNTF-NOTIF-NBR                           13280002
132900                   ,  :TRBNTF-OPER-UNT-ID                         13290002
133000                   ,  :TRBNTF-FCLTY-ID                            13300002
133100                   ,  :TRBNTF-DEPT-NBR                            13310002
133200                   ,  :TRBNTF-ENT-ID                              13320002
133300                   ,  :TRBNTF-PO-NBR                              13330002
133400                   ,  :TRBNTF-PO-LNE-NBR                          13340002
133500                   ,  :TRBNTF-REC-SEQ-NBR                         13350002
133600                   ,  :TRBNTF-TRBL-RSN-CDE                        13360002
133700                   ,  CURRENT TIMESTAMP                           13370002
133800                   ,  :TRBNTF-NOTIF-UID                           13380002
133900                   ,  :PC-R                                       13390002
134000                   ,  CURRENT TIMESTAMP                           13400002
134100                   ,  :TRBNTF-NOTIF-UID                           13410002
134200                   ,  :TRBNTF-ACKNOWLG-TMST                       13420002
134300                   ,  :TRBNTF-ACKNOWLG-UID                        13430002
134400                   ,  :TRBNTF-CNTCT-EXT                           13440002
134500                   ,  :TRBNTF-FCLTY-AREA-ID                       13450002
134600                   ,  :TRBNTF-SHIPT-ID                            13460002
134700                   ,  :TRBNTF-PKSL-SEQ-NBR                        13470002
134800                   ,  :TRBNTF-PKSL-LNE-NBR                        13480002
134900                   ,  :TRBNTF-WORK-ORD-SEQ-NBR                    13490002
135000                   ,  :TRBNTF-WO-INSTR-SEQ-NBR                    13500002
135100                   ,  :TRBNTF-OVER-SHT-PCT                        13510002
135200                   ,  :PC-DEFAULT-TMST                            13520002
135300                   ,  :TRBNTF-CRE-IND                             13530002
135400                   ,  :TRBNTF-PRORATE-IND                         13540002
135500                   ,  :TRBNTF-RTV-IND                             13550002
135600                   ,  :PC-DEFAULT-TMST                            13560002
135700                   ,  :TRBNTF-PREPK-ID)                           13570002
135800         END-EXEC                                                 13580002
135900                                                                  13590002
136000         PERFORM 8001-WRITE-SQLCODE                               13600002
136100     EVALUATE TRUE                                                13610002
136200         WHEN SQLCODE = ZERO                                      13620002
136300             MOVE PC-R TO TM500-RESOLVED-IND                      13630002
136400         WHEN SQLCODE = -803                                      13640002
136500             PERFORM 2260-GET-RANDOM-NBR                          13650002
136600             MOVE DP902-RANDOM-NUMBER   TO TM500-NOTIF-NBR        13660002
136700                                           TRBNTF-NOTIF-NBR       13670002
136800         WHEN SQLCODE = -904                                      13680002
136900         WHEN SQLCODE = -911                                      13690002
137000         WHEN SQLCODE = -913                                      13700002
137100                  CONTINUE                                        13710002
137200         WHEN OTHER                                               13720002
137300              SET  PS-DONE TO TRUE                                13730002
137400              MOVE SQLCA   TO TM500-SQLCA                         13740002
137500              MOVE SQLCODE TO TM500-SQLCODE                       13750002
137600              MOVE PRV-5F  TO TM500-RETURN-DATA                   13760002
137700                                                                  13770002
137800              MOVE SPACES    TO PRV-TM500-RETURN-MSG              13780002
137900              MOVE '2300'    TO PRV-PARA                          13790002
138000              MOVE 'TTRBNTF' TO PRV-TBL                           13800002
138100              PERFORM 9999-RETURN-MSG                             13810002
138200     END-EVALUATE                                                 13820002
138300     END-PERFORM.                                                 13830002
138400                                                                  13840002
138500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     13850002
138600               SQLCODE NOT = ZERO                                 13860002
138700         SET  PS-DONE TO TRUE                                     13870002
138800         MOVE SQLCA   TO TM500-SQLCA                              13880002
138900         MOVE SQLCODE TO TM500-SQLCODE                            13890002
139000         MOVE PRV-5F  TO TM500-RETURN-DATA                        13900002
139100                                                                  13910002
139200         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   13920002
139300         MOVE '2300'    TO PRV-PARA                               13930002
139400         MOVE 'TTRBNTF' TO PRV-TBL                                13940002
139500         PERFORM 9999-RETURN-MSG                                  13950002
139600     END-IF.                                                      13960002
139700                                                                  13970002
139800 2400-INSERT-TTRBNTF.                                             13980002
139900******************************************************************13990002
140000*    THIS PARAGRAPH INSERTS A TTRBNTF RECORD.                     14000002
140100*                                                                 14010002
140200*    IF A DUPLICATE KEY IS ENCOUNTERED, A NEW RANDOM NUMBER       14020002
140300*    WILL BE CALCULATED AND THE INSERT WILL BE RETRIED.           14030002
140400*    ON THE CHANCE THAT LIGHTNING STRIKES MORE THAN 3 TIMES       14040002
140500*    IN THE SAME SPOT (WE CAN'T FIND A UNIQUE 9 DIGIT KEY),       14050002
140600*    AN ERROR WILL BE PASSED BACK THROUGH THE COMMAREA TO THE     14060002
140700*    CALLING PROGRAM.                                             14070002
140800******************************************************************14080002
140900                                                                  14090002
141000     MOVE '2400-INSERT-TTRBNTF'       TO PV-CSSL-PARA             14100002
141100     PERFORM 8000-WRITE-CSSL                                      14110002
141200                                                                  14120002
141300     PERFORM WITH TEST AFTER                                      14130002
141400         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     14140002
141500         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR               14150002
141600         SQLCODE = ZERO OR PS-DONE                                14160002
141700                                                                  14170002
141800     EXEC SQL                                                     14180002
141900          INSERT INTO TTRBNTF                                     14190002
142000                 (NOTIF_NBR                                       14200002
142100               ,  OPER_UNT_ID                                     14210002
142200               ,  FCLTY_ID                                        14220002
142300               ,  DEPT_NBR                                        14230002
142400               ,  ENT_ID                                          14240002
142500               ,  PO_NBR                                          14250002
142600               ,  PO_LNE_NBR                                      14260002
142700               ,  REC_SEQ_NBR                                     14270002
142800               ,  TRBL_RSN_CDE                                    14280002
142900               ,  NOTIF_TMST                                      14290002
143000               ,  NOTIF_UID                                       14300002
143100               ,  RESOLVED_IND                                    14310002
143200               ,  RESOLVED_TMST                                   14320002
143300               ,  RESOLVED_UID                                    14330002
143400               ,  ACKNOWLG_TMST                                   14340002
143500               ,  ACKNOWLG_UID                                    14350002
143600               ,  CNTCT_EXT                                       14360002
143700               ,  FCLTY_AREA_ID                                   14370002
143800               ,  SHIPT_ID                                        14380002
143900               ,  PKSL_SEQ_NBR                                    14390002
144000               ,  PKSL_LNE_NBR                                    14400002
144100               ,  WORK_ORD_SEQ_NBR                                14410002
144200               ,  WO_INSTR_SEQ_NBR                                14420002
144300               ,  OVER_SHT_PCT                                    14430002
144400               ,  LAST_DTL_CRE_TMST                               14440002
144500               ,  CRE_IND                                         14450002
144600               ,  PRORATE_IND                                     14460002
144700               ,  RTV_IND                                         14470002
144800               ,  RTV_RESPONSE_TMST                               14480002
144900               ,  PREPK_ID)                                       14490002
145000          VALUES (:TRBNTF-NOTIF-NBR                               14500002
145100               ,  :TRBNTF-OPER-UNT-ID                             14510002
145200               ,  :TRBNTF-FCLTY-ID                                14520002
145300               ,  :TRBNTF-DEPT-NBR                                14530002
145400               ,  :TRBNTF-ENT-ID                                  14540002
145500               ,  :TRBNTF-PO-NBR                                  14550002
145600               ,  :TRBNTF-PO-LNE-NBR                              14560002
145700               ,  :TRBNTF-REC-SEQ-NBR                             14570002
145800               ,  :TRBNTF-TRBL-RSN-CDE                            14580002
145900               ,  CURRENT TIMESTAMP                               14590002
146000               ,  :TRBNTF-NOTIF-UID                               14600002
146100               ,  :TRBNTF-RESOLVED-IND                            14610002
146200               ,  :TRBNTF-RESOLVED-TMST                           14620002
146300               ,  :TRBNTF-RESOLVED-UID                            14630002
146400               ,  :TRBNTF-ACKNOWLG-TMST                           14640002
146500               ,  :TRBNTF-ACKNOWLG-UID                            14650002
146600               ,  :TRBNTF-CNTCT-EXT                               14660002
146700               ,  :TRBNTF-FCLTY-AREA-ID                           14670002
146800               ,  :TRBNTF-SHIPT-ID                                14680002
146900               ,  :TRBNTF-PKSL-SEQ-NBR                            14690002
147000               ,  :TRBNTF-PKSL-LNE-NBR                            14700002
147100               ,  :TRBNTF-WORK-ORD-SEQ-NBR                        14710002
147200               ,  :TRBNTF-WO-INSTR-SEQ-NBR                        14720002
147300               ,  :TRBNTF-OVER-SHT-PCT                            14730002
147400               ,  :PC-DEFAULT-TMST                                14740002
147500               ,  :TRBNTF-CRE-IND                                 14750002
147600               ,  :TRBNTF-PRORATE-IND                             14760002
147700               ,  :TRBNTF-RTV-IND                                 14770002
147800               ,  :PC-DEFAULT-TMST                                14780002
147900               ,  :TRBNTF-PREPK-ID)                               14790002
148000         END-EXEC                                                 14800002
148100                                                                  14810002
148200         PERFORM 8001-WRITE-SQLCODE                               14820002
148300     EVALUATE TRUE                                                14830002
148400         WHEN SQLCODE = ZERO                                      14840002
148500              MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND      14850002
148600         WHEN SQLCODE = -803                                      14860002
148700             PERFORM 2260-GET-RANDOM-NBR                          14870002
148800             MOVE DP902-RANDOM-NUMBER   TO TM500-NOTIF-NBR        14880002
148900                                           TRBNTF-NOTIF-NBR       14890002
149000                                                                  14900002
149100         WHEN SQLCODE = -904                                      14910002
149200         WHEN SQLCODE = -911                                      14920002
149300         WHEN SQLCODE = -913                                      14930002
149400             CONTINUE                                             14940002
149500                                                                  14950002
149600         WHEN OTHER                                               14960002
149700              SET  PS-DONE TO TRUE                                14970002
149800              MOVE SQLCA   TO TM500-SQLCA                         14980002
149900              MOVE SQLCODE TO TM500-SQLCODE                       14990002
150000              MOVE PRV-5F  TO TM500-RETURN-DATA                   15000002
150100              MOVE SPACES    TO PRV-TM500-RETURN-MSG              15010002
150200              MOVE '2400'    TO PRV-PARA                          15020002
150300              MOVE 'TTRBNTF' TO PRV-TBL                           15030002
150400              PERFORM 9999-RETURN-MSG                             15040002
150500     END-EVALUATE                                                 15050002
150600     END-PERFORM.                                                 15060002
150700                                                                  15070002
150800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     15080002
150900               SQLCODE NOT = ZERO                                 15090002
151000         SET  PS-DONE TO TRUE                                     15100002
151100         MOVE SQLCA   TO TM500-SQLCA                              15110002
151200         MOVE SQLCODE TO TM500-SQLCODE                            15120002
151300         MOVE PRV-5F  TO TM500-RETURN-DATA                        15130002
151400                                                                  15140002
151500         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   15150002
151600         MOVE '2400'    TO PRV-PARA                               15160002
151700         MOVE 'TTRBNTF' TO PRV-TBL                                15170002
151800         PERFORM 9999-RETURN-MSG                                  15180002
151900     END-IF.                                                      15190002
152000                                                                  15200002
152100                                                                  15210002
152200 2500-UPDATE-TRECEIV-TMST.                                        15220002
152300******************************************************************15230002
152400*    THIS PARAGRAPH UPDATES TRECEIV TIMESTAMP.                    15240002
152500******************************************************************15250002
152600                                                                  15260002
152700     MOVE '2500-UPDATE-TRECEIV-TMST'  TO PV-CSSL-PARA             15270002
152800     PERFORM 8000-WRITE-CSSL                                      15280002
152900                                                                  15290002
153000     PERFORM 4000-SELECT-NOTIF-IND.                               15300002
153100                                                                  15310002
153200     IF PS-NOT-DONE AND TRBRSN-NOTIF-IND = PC-T                   15320002
153300         IF PS-DO-NOT-USE-OPER                                    15330002
153400             PERFORM 2515-SELECT-IN-TRBL-TMST-NO-OP               15340009
153500         ELSE                                                     15350002
153600             PERFORM 2510-SELECT-IN-TRBL-TMST                     15360002
153700         END-IF                                                   15370002
153800                                                                  15380002
153900         IF PS-NOT-DONE AND RECEIV-IN-TRBL-TMST = PC-DEFAULT-TMST 15390002
154000             IF PS-DO-NOT-USE-OPER                                15400002
154100                 PERFORM 2525-UPDATE-IN-TRBL-TMST-NO-OP           15410009
154200             ELSE                                                 15420002
154300                 PERFORM 2520-UPDATE-IN-TRBL-TMST                 15430002
154400             END-IF                                               15440002
154500         END-IF                                                   15450002
154600     END-IF.                                                      15460002
154700                                                                  15470002
154800                                                                  15480002
154810******************************************************************15481018
154900 2510-SELECT-IN-TRBL-TMST.                                        15490002
155000******************************************************************15500002
155200                                                                  15520002
155300     MOVE '2510-SELECT-IN-TRBL-TMST'  TO PV-CSSL-PARA             15530002
155400     PERFORM 8000-WRITE-CSSL                                      15540002
155500                                                                  15550002
155600     PERFORM WITH TEST AFTER                                      15560002
155700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    15570002
155800         UNTIL   SQLCODE = +0 OR                                  15580002
155810                 SQLCODE = +100 OR                                15581018
155900                 PS-DONE OR                                       15590002
156000                 PV-RETRY-COUNTER > PC-MAX-RETRIES                15600002
156100                                                                  15610002
156200         EXEC SQL                                                 15620002
156300              SELECT IN_TRBL_TMST                                 15630002
156400                INTO :RECEIV-IN-TRBL-TMST                         15640002
156500                FROM TRECEIV                                      15650002
156600               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          15660002
156700                 AND FCLTY_ID       = :TM500-FCLTY-ID             15670002
156800                 AND ORD_NBR        = :TM500-PO-NBR               15680002
156900                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          15690002
157000                 AND VER_STATUS_CDE = :PC-ACTIVE                  15700002
157100         END-EXEC                                                 15710002
157200                                                                  15720002
157300         PERFORM 8001-WRITE-SQLCODE                               15730002
157400         EVALUATE TRUE                                            15740002
157500             WHEN SQLCODE = +0                                    15750002
157600                  CONTINUE                                        15760002
157601                                                                  15760118
157610             WHEN SQLCODE = +100                                  15761018
157611                  IF  TM500-NOTIF-UID  =  'SUKRF502'  OR          15761120
157612                      TM500-NOTIF-UID  =  'SUKCS771'              15761220
157620                  PERFORM 2512-SELECT-IN-TRBL-TMST-2              15762018
157621                  ELSE                                            15762120
157630                      SET  PS-DONE TO TRUE                        15763020
157640                      MOVE SQLCA   TO TM500-SQLCA                 15764020
157650                      MOVE SQLCODE TO TM500-SQLCODE               15765020
157660                      MOVE PRV-5G  TO TM500-RETURN-DATA           15766020
157670                                                                  15767020
157680                      MOVE SPACES    TO PRV-TM500-RETURN-MSG      15768020
157690                      MOVE '2510'    TO PRV-PARA                  15769020
157691                      MOVE 'TRECEIV' TO PRV-TBL                   15769120
157692                      PERFORM 9999-RETURN-MSG                     15769220
157693                  END-IF                                          15769320
157700                                                                  15770002
157800             WHEN SQLCODE = -904                                  15780002
157900             WHEN SQLCODE = -911                                  15790002
158000             WHEN SQLCODE = -913                                  15800002
158100                  CONTINUE                                        15810002
158200                                                                  15820002
158300             WHEN OTHER                                           15830002
158400                  SET  PS-DONE TO TRUE                            15840002
158500                  MOVE SQLCA   TO TM500-SQLCA                     15850002
158600                  MOVE SQLCODE TO TM500-SQLCODE                   15860002
158700                  MOVE PRV-5G  TO TM500-RETURN-DATA               15870002
158800                                                                  15880002
158900                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          15890002
159000                  MOVE '2510'    TO PRV-PARA                      15900002
159100                  MOVE 'TRECEIV' TO PRV-TBL                       15910002
159200                  PERFORM 9999-RETURN-MSG                         15920002
159300         END-EVALUATE                                             15930002
159400     END-PERFORM.                                                 15940002
159500                                                                  15950002
159600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         15960002
159700         SET PS-DONE  TO TRUE                                     15970002
159800         MOVE SQLCA   TO TM500-SQLCA                              15980002
159900         MOVE SQLCODE TO TM500-SQLCODE                            15990002
160000         MOVE PRV-5G  TO TM500-RETURN-DATA                        16000002
160100                                                                  16010002
160200         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   16020002
160300         MOVE '2510'    TO PRV-PARA                               16030002
160400         MOVE 'TRECEIV' TO PRV-TBL                                16040002
160500         PERFORM 9999-RETURN-MSG                                  16050002
160600     END-IF.                                                      16060002
160700                                                                  16070002
160710******************************************************************16071018
160711* added 1/28/09                                                   16071118
160720 2512-SELECT-IN-TRBL-TMST-2.                                      16072018
160730******************************************************************16073018
160740                                                                  16074018
160750     MOVE '2512-SELECT-IN-TRBL-TMST-2'  TO PV-CSSL-PARA           16075018
160760     PERFORM 8000-WRITE-CSSL                                      16076018
160770                                                                  16077018
160780     PERFORM WITH TEST AFTER                                      16078018
160790         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    16079018
160791         UNTIL   SQLCODE = +0 OR                                  16079118
160792                 PS-DONE OR                                       16079218
160793                 PV-RETRY-COUNTER > PC-MAX-RETRIES                16079318
160794                                                                  16079418
160795         EXEC SQL                                                 16079518
160796              SELECT IN_TRBL_TMST                                 16079618
160797                   , OPER_UNT_ID                                  16079720
160799                INTO :RECEIV-IN-TRBL-TMST                         16079920
160800                   , :TM500-OPER-UNT-ID                           16080020
160801                FROM TRECEIV                                      16080120
160802               WHERE ORD_NBR        = :TM500-PO-NBR               16080218
160803                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          16080318
160804                 AND VER_STATUS_CDE = :PC-ACTIVE                  16080418
160805         END-EXEC                                                 16080518
160806                                                                  16080618
160807         PERFORM 8001-WRITE-SQLCODE                               16080718
160808         EVALUATE TRUE                                            16080818
160809             WHEN SQLCODE = +0                                    16080918
160811                  CONTINUE                                        16081118
160812                                                                  16081218
160813             WHEN SQLCODE = -904                                  16081318
160814             WHEN SQLCODE = -911                                  16081418
160815             WHEN SQLCODE = -913                                  16081518
160816                  CONTINUE                                        16081618
160817                                                                  16081718
160818             WHEN OTHER                                           16081818
160819                  SET  PS-DONE TO TRUE                            16081918
160820                  MOVE SQLCA   TO TM500-SQLCA                     16082018
160821                  MOVE SQLCODE TO TM500-SQLCODE                   16082118
160822                  MOVE PRV-5G  TO TM500-RETURN-DATA               16082218
160823                                                                  16082318
160824                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          16082418
160825                  MOVE '2512'    TO PRV-PARA                      16082518
160826                  MOVE 'TRECEIV' TO PRV-TBL                       16082618
160827                  PERFORM 9999-RETURN-MSG                         16082718
160828         END-EVALUATE                                             16082818
160829     END-PERFORM.                                                 16082918
160830                                                                  16083018
160831     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         16083118
160832         SET PS-DONE  TO TRUE                                     16083218
160833         MOVE SQLCA   TO TM500-SQLCA                              16083318
160834         MOVE SQLCODE TO TM500-SQLCODE                            16083418
160835         MOVE PRV-5G  TO TM500-RETURN-DATA                        16083518
160836                                                                  16083618
160837         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   16083718
160838         MOVE '2512'    TO PRV-PARA                               16083818
160839         MOVE 'TRECEIV' TO PRV-TBL                                16083918
160840         PERFORM 9999-RETURN-MSG                                  16084018
160841     END-IF.                                                      16084118
160842                                                                  16084218
160843                                                                  16084318
160844******************************************************************16084418
160850 2515-SELECT-IN-TRBL-TMST-NO-OP.                                  16085009
160900******************************************************************16090002
161000******************************************************************16100002
161100                                                                  16110002
161200     MOVE '2515-SELECT-IN-TRBL-TMST-NO-OP'    TO PV-CSSL-PARA     16120009
161300     PERFORM 8000-WRITE-CSSL                                      16130002
161400                                                                  16140002
161500     PERFORM WITH TEST AFTER                                      16150002
161600         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    16160002
161700         UNTIL   SQLCODE = +0 OR                                  16170002
161800                 PS-DONE OR                                       16180002
161900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                16190002
162000                                                                  16200002
162100         EXEC SQL                                                 16210002
162200              SELECT IN_TRBL_TMST                                 16220002
162300                INTO :RECEIV-IN-TRBL-TMST                         16230002
162400                FROM TRECEIV                                      16240002
162500               WHERE ORD_NBR        = :TM500-PO-NBR               16250002
162600                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          16260002
162700                 AND VER_STATUS_CDE = :PC-ACTIVE                  16270002
162800         END-EXEC                                                 16280002
162900                                                                  16290002
163000         PERFORM 8001-WRITE-SQLCODE                               16300002
163100         EVALUATE TRUE                                            16310002
163200             WHEN SQLCODE = +0                                    16320002
163300                  CONTINUE                                        16330002
163400                                                                  16340002
163500             WHEN SQLCODE = -904                                  16350002
163600             WHEN SQLCODE = -911                                  16360002
163700             WHEN SQLCODE = -913                                  16370002
163800                  CONTINUE                                        16380002
163900                                                                  16390002
164000             WHEN OTHER                                           16400002
164100                  SET  PS-DONE TO TRUE                            16410002
164200                  MOVE SQLCA   TO TM500-SQLCA                     16420002
164300                  MOVE SQLCODE TO TM500-SQLCODE                   16430002
164400                  MOVE PRV-5G  TO TM500-RETURN-DATA               16440002
164500                                                                  16450002
164600                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          16460002
164700                  MOVE '2515'    TO PRV-PARA                      16470002
164800                  MOVE 'TRECEIV' TO PRV-TBL                       16480002
164900                  PERFORM 9999-RETURN-MSG                         16490002
165000         END-EVALUATE                                             16500002
165100     END-PERFORM.                                                 16510002
165200                                                                  16520002
165300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         16530002
165400         SET PS-DONE  TO TRUE                                     16540002
165500         MOVE SQLCA   TO TM500-SQLCA                              16550002
165600         MOVE SQLCODE TO TM500-SQLCODE                            16560002
165700         MOVE PRV-5G  TO TM500-RETURN-DATA                        16570002
165800                                                                  16580002
165900         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   16590002
166000         MOVE '2515'    TO PRV-PARA                               16600002
166100         MOVE 'TRECEIV' TO PRV-TBL                                16610002
166200         PERFORM 9999-RETURN-MSG                                  16620002
166300     END-IF.                                                      16630002
166400                                                                  16640002
166500                                                                  16650002
166600 2520-UPDATE-IN-TRBL-TMST.                                        16660002
166700******************************************************************16670002
166800******************************************************************16680002
166900                                                                  16690002
167000     MOVE '2520-UPDATE-IN-TRBL-TMST'  TO PV-CSSL-PARA             16700002
167100     PERFORM 8000-WRITE-CSSL                                      16710002
167200                                                                  16720002
167300     PERFORM WITH TEST AFTER                                      16730002
167400         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    16740002
167500         UNTIL   SQLCODE = +0 OR                                  16750021
167600                 PS-DONE OR                                       16760002
167700                 PV-RETRY-COUNTER > PC-MAX-RETRIES                16770002
167800                                                                  16780002
167900         EXEC SQL                                                 16790002
168000              UPDATE TRECEIV                                      16800002
168100                 SET IN_TRBL_TMST = CURRENT TIMESTAMP             16810002
168200               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          16820002
168300                 AND FCLTY_ID       = :TM500-FCLTY-ID             16830002
168400                 AND ORD_NBR        = :TM500-PO-NBR               16840002
168500                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          16850002
168600                 AND VER_STATUS_CDE = :PC-ACTIVE                  16860002
168700         END-EXEC                                                 16870002
168800                                                                  16880002
168900         PERFORM 8001-WRITE-SQLCODE                               16890002
169000         EVALUATE TRUE                                            16900002
169100             WHEN SQLCODE = +0                                    16910002
169200                  CONTINUE                                        16920002
169201                                                                  16920119
169400             WHEN SQLCODE = -904                                  16940002
169500             WHEN SQLCODE = -911                                  16950002
169600             WHEN SQLCODE = -913                                  16960002
169700                  CONTINUE                                        16970002
169800                                                                  16980002
169900             WHEN OTHER                                           16990002
170000                  SET  PS-DONE TO TRUE                            17000002
170100                  MOVE SQLCA   TO TM500-SQLCA                     17010002
170200                  MOVE SQLCODE TO TM500-SQLCODE                   17020002
170300                  MOVE PRV-5H  TO TM500-RETURN-DATA               17030002
170400                                                                  17040002
170500                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          17050002
170600                  MOVE '2520'    TO PRV-PARA                      17060002
170700                  MOVE 'TRECEIV' TO PRV-TBL                       17070002
170800                  PERFORM 9999-RETURN-MSG                         17080002
170900         END-EVALUATE                                             17090002
171000     END-PERFORM.                                                 17100002
171100                                                                  17110002
171200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         17120002
171300         SET  PS-DONE TO TRUE                                     17130002
171400         MOVE SQLCA   TO TM500-SQLCA                              17140002
171500         MOVE SQLCODE TO TM500-SQLCODE                            17150002
171600         MOVE PRV-5H  TO TM500-RETURN-DATA                        17160002
171700                                                                  17170002
171800         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   17180002
171900         MOVE '2520'    TO PRV-PARA                               17190002
172000         MOVE 'TRECEIV' TO PRV-TBL                                17200002
172100         PERFORM 9999-RETURN-MSG                                  17210002
172200     END-IF.                                                      17220002
172300                                                                  17230002
172440                                                                  17244019
172450 2525-UPDATE-IN-TRBL-TMST-NO-OP.                                  17245019
172500******************************************************************17250002
172600******************************************************************17260002
172700                                                                  17270002
172800     MOVE '2525-UPDATE-IN-TRBL-TMST-NO-OP'    TO PV-CSSL-PARA     17280009
172900     PERFORM 8000-WRITE-CSSL                                      17290002
173000                                                                  17300002
173100     PERFORM WITH TEST AFTER                                      17310002
173200         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    17320002
173300         UNTIL   SQLCODE = +0 OR                                  17330002
173400                 PS-DONE OR                                       17340002
173500                 PV-RETRY-COUNTER > PC-MAX-RETRIES                17350002
173600                                                                  17360002
173700         EXEC SQL                                                 17370002
173800              UPDATE TRECEIV                                      17380002
173900                 SET IN_TRBL_TMST = CURRENT TIMESTAMP             17390002
174000               WHERE ORD_NBR        = :TM500-PO-NBR               17400002
174100                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          17410002
174200                 AND VER_STATUS_CDE = :PC-ACTIVE                  17420002
174300         END-EXEC                                                 17430002
174400                                                                  17440002
174500         PERFORM 8001-WRITE-SQLCODE                               17450002
174600         EVALUATE TRUE                                            17460002
174700             WHEN SQLCODE = +0                                    17470002
174800                  CONTINUE                                        17480002
174900                                                                  17490002
175000             WHEN SQLCODE = -904                                  17500002
175100             WHEN SQLCODE = -911                                  17510002
175200             WHEN SQLCODE = -913                                  17520002
175300                  CONTINUE                                        17530002
175400                                                                  17540002
175500             WHEN OTHER                                           17550002
175600                  SET  PS-DONE TO TRUE                            17560002
175700                  MOVE SQLCA   TO TM500-SQLCA                     17570002
175800                  MOVE SQLCODE TO TM500-SQLCODE                   17580002
175900                  MOVE PRV-5H  TO TM500-RETURN-DATA               17590002
176000                                                                  17600002
176100                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          17610002
176200                  MOVE '2525'    TO PRV-PARA                      17620002
176300                  MOVE 'TRECEIV' TO PRV-TBL                       17630002
176400                  PERFORM 9999-RETURN-MSG                         17640002
176500         END-EVALUATE                                             17650002
176600     END-PERFORM.                                                 17660002
176700                                                                  17670002
176800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         17680002
176900         SET  PS-DONE TO TRUE                                     17690002
177000         MOVE SQLCA   TO TM500-SQLCA                              17700002
177100         MOVE SQLCODE TO TM500-SQLCODE                            17710002
177200         MOVE PRV-5H  TO TM500-RETURN-DATA                        17720002
177300                                                                  17730002
177400         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   17740002
177500         MOVE '2525'    TO PRV-PARA                               17750002
177600         MOVE 'TRECEIV' TO PRV-TBL                                17760002
177700         PERFORM 9999-RETURN-MSG                                  17770002
177800     END-IF.                                                      17780002
177900                                                                  17790002
178000                                                                  17800002
178100 2600-UPDATE-TTRBNTF.                                             17810002
178200******************************************************************17820002
178300*    THIS PARAGRAPH UPDATES TTRBNTF.                              17830002
178400******************************************************************17840002
178500                                                                  17850002
178600     MOVE '2600-UPDATE-TTRBNTF'       TO PV-CSSL-PARA             17860002
178700     PERFORM 8000-WRITE-CSSL                                      17870002
178800                                                                  17880002
178900     EVALUATE TRUE                                                17890002
179000         WHEN TM500-IN-PROCESS                                    17900002
179100         WHEN TM500-RESPOND                                       17910002
179200              MOVE PC-I TO TRBNTF-RESOLVED-IND                    17920002
179300              PERFORM 2610-IN-PROCESS-UPDATE                      17930002
179400                                                                  17940002
179500         WHEN TM500-RESOLVE-AUTO                                  17950002
179600         WHEN TM500-RESOLVE-SPECIFIC                              17960002
179610              IF PS-DO-NOT-USE-OPER                               17961010
179700                  PERFORM 2625-VALIDATE-FOR-RESOLVE               17970010
179701              ELSE                                                17970110
179710                  PERFORM 2620-VALIDATE-FOR-RESOLVE               17971010
179800              END-IF                                              17980010
179900              IF PS-NOT-DONE AND PS-RESOLVE-FOUND                 17990002
180000                  MOVE TRBNTF-NOTIF-NBR   TO TM500-NOTIF-NBR      18000002
180100                  MOVE PC-R               TO TRBNTF-RESOLVED-IND  18010002
180200                  MOVE TM500-RESOLVED-UID TO TRBNTF-RESOLVED-UID  18020002
180300                  PERFORM 2630-RESOLVE-UPDATE                     18030002
180400***************************************************************** 18040002
180500*                 IF A DC BAD PACK IS BEING RESOLVED ON A PREPACK 18050002
180600*                 RECEIPT, ACKNOWLEDGE THE TROUBLE IMMEDIATELY.   18060002
180700***************************************************************** 18070002
180800                  IF TM500-TRBL-RSN-CDE = PC-267 OR               18080002
180900                     TM500-RESOLVE-SPECIFIC                       18090002
181000                     MOVE PC-A   TO TRBNTF-RESOLVED-IND           18100002
181100                     MOVE TM500-RESOLVED-UID                      18110002
181200                                 TO TRBNTF-ACKNOWLG-UID           18120002
181300                     PERFORM 2640-ACKNOWLEDGE-UPDATE              18130002
181400                  END-IF                                          18140002
181500              END-IF                                              18150002
181600                                                                  18160002
181700         WHEN TM500-RESOLVE-MANUAL                                18170002
181800**** IF A DC MANUAL TROUBLE IS BEING RESOLVED, AFTER RESOLUTION   18180002
181900**** IT SHOULD BE ACKNOWLEDGED IMMEDIATELY. IF THE TROUBLE BEING  18190002
182000**** RESOLVED IS NOT A DC TROUBLE, PROCESSING CONTINUNES AS USUAL 18200002
182100              PERFORM 2240-SELECT-RESP-RES-IND                    18210002
182200              IF TRBRSN-RSLV-RSPNT-CDE = PC-D                     18220002
182300                  MOVE PC-R               TO TRBNTF-RESOLVED-IND  18230002
182400                  MOVE TM500-RESOLVED-UID TO TRBNTF-RESOLVED-UID  18240002
182500                  MOVE TM500-PRORATE-IND  TO TRBNTF-PRORATE-IND   18250002
182600                  PERFORM 2630-RESOLVE-UPDATE                     18260002
182700                  MOVE PC-A               TO TRBNTF-RESOLVED-IND  18270002
182800**** IT'S BEING ACKNOWLEDGED BY SAME PERSON WHO RESOLVED IT       18280002
182900                  MOVE TM500-RESOLVED-UID TO TRBNTF-ACKNOWLG-UID  18290002
183000                  PERFORM 2640-ACKNOWLEDGE-UPDATE                 18300002
183100              ELSE                                                18310002
183200                  MOVE PC-R               TO TRBNTF-RESOLVED-IND  18320002
183300                  MOVE TM500-RESOLVED-UID TO TRBNTF-RESOLVED-UID  18330002
183400                  MOVE TM500-PRORATE-IND  TO TRBNTF-PRORATE-IND   18340002
183500                  PERFORM 2630-RESOLVE-UPDATE                     18350002
183600              END-IF                                              18360002
183700                                                                  18370002
183800         WHEN TM500-ACKNOWLEDGE                                   18380002
183900              MOVE PC-A               TO TRBNTF-RESOLVED-IND      18390002
184000              MOVE TM500-ACKNOWLG-UID TO TRBNTF-ACKNOWLG-UID      18400002
184100              PERFORM 2640-ACKNOWLEDGE-UPDATE                     18410002
184200                                                                  18420002
184300         WHEN OTHER                                               18430002
184400              SET  PS-DONE TO TRUE                                18440002
184500              MOVE SPACES  TO TM500-SQLCA                         18450002
184600              MOVE ZEROES  TO TM500-SQLCODE                       18460002
184700              MOVE PRV-5A  TO TM500-RETURN-DATA                   18470002
184800                                                                  18480002
184900     END-EVALUATE.                                                18490002
185000                                                                  18500002
185100                                                                  18510002
185200 2610-IN-PROCESS-UPDATE.                                          18520002
185300******************************************************************18530002
185400*    THIS PARAGRAPH UPDATES TTRBNTF RESOLVED-IND TO IN-PROCESS.   18540002
185500******************************************************************18550002
185600                                                                  18560002
185700     MOVE '2610-IN-PROCESS-UPDATE'    TO PV-CSSL-PARA             18570002
185800     PERFORM 8000-WRITE-CSSL                                      18580002
185900                                                                  18590002
186000     PERFORM WITH TEST AFTER                                      18600002
186100         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    18610002
186200         UNTIL   SQLCODE = +0 OR                                  18620002
186300                 PS-DONE OR                                       18630002
186400                 PV-RETRY-COUNTER > PC-MAX-RETRIES                18640002
186500                                                                  18650002
186600* DID THE USER ENTER A 'Y' OR 'N' IN 'RETURN TO VENDOR'           18660002
186700*  OTHERWISE IT COULD BE BLANK                                    18670002
186800         IF TM500-RTV-YES OR TM500-RTV-NO                         18680002
186900             EXEC SQL                                             18690002
187000                  UPDATE TTRBNTF                                  18700002
187100                        SET RESOLVED_IND = :TRBNTF-RESOLVED-IND   18710002
187200                          , RTV_IND      = :TM500-RTV-SW          18720002
187300                          , RTV_RESPONSE_TMST = CURRENT TIMESTAMP 18730002
187400                   WHERE NOTIF_NBR    = :TRBNTF-NOTIF-NBR         18740002
187500             END-EXEC                                             18750002
187600         ELSE                                                     18760002
187700             EXEC SQL                                             18770002
187800                  UPDATE TTRBNTF                                  18780002
187900                     SET RESOLVED_IND = :TRBNTF-RESOLVED-IND      18790002
188000                  WHERE NOTIF_NBR    = :TRBNTF-NOTIF-NBR          18800002
188100             END-EXEC                                             18810002
188200         END-IF                                                   18820002
188300                                                                  18830002
188400         PERFORM 8001-WRITE-SQLCODE                               18840002
188500         EVALUATE TRUE                                            18850002
188600             WHEN SQLCODE = +0                                    18860002
188700                  MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND  18870002
188800                                                                  18880002
188900             WHEN SQLCODE = -904                                  18890002
189000             WHEN SQLCODE = -911                                  18900002
189100             WHEN SQLCODE = -913                                  18910002
189200                  CONTINUE                                        18920002
189300                                                                  18930002
189400             WHEN OTHER                                           18940002
189500                  SET  PS-DONE TO TRUE                            18950002
189600                  MOVE SQLCA   TO TM500-SQLCA                     18960002
189700                  MOVE SQLCODE TO TM500-SQLCODE                   18970002
189800                  MOVE PRV-5I  TO TM500-RETURN-DATA               18980002
189900                                                                  18990002
190000                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          19000002
190100                  MOVE '2610'    TO PRV-PARA                      19010002
190200                  MOVE 'TTRBNTF' TO PRV-TBL                       19020002
190300                  PERFORM 9999-RETURN-MSG                         19030002
190400         END-EVALUATE                                             19040002
190500     END-PERFORM.                                                 19050002
190600                                                                  19060002
190700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         19070002
190800         SET  PS-DONE TO TRUE                                     19080002
190900         MOVE SQLCA   TO TM500-SQLCA                              19090002
191000         MOVE SQLCODE TO TM500-SQLCODE                            19100002
191100         MOVE PRV-5I  TO TM500-RETURN-DATA                        19110002
191200                                                                  19120002
191300         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   19130002
191400         MOVE '2610'    TO PRV-PARA                               19140002
191500         MOVE 'TTRBNTF' TO PRV-TBL                                19150002
191600         PERFORM 9999-RETURN-MSG                                  19160002
191700     END-IF.                                                      19170002
191800                                                                  19180002
191900                                                                  19190002
192000 2620-VALIDATE-FOR-RESOLVE.                                       19200002
192100******************************************************************19210002
192200******************************************************************19220002
192300                                                                  19230002
192400     MOVE '2620-VALIDATE-FOR-RESOLVE' TO PV-CSSL-PARA             19240002
192500     PERFORM 8000-WRITE-CSSL                                      19250002
192600                                                                  19260002
192700     PERFORM WITH TEST AFTER                                      19270002
192800         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    19280002
192900         UNTIL   SQLCODE = +0 OR                                  19290002
193000                 SQLCODE = +100 OR                                19300002
193100                 PS-DONE OR                                       19310002
193200                 PV-RETRY-COUNTER > PC-MAX-RETRIES                19320002
193300                                                                  19330002
193400         EXEC SQL                                                 19340002
193500              SELECT NOTIF_NBR                                    19350002
193600                INTO :TRBNTF-NOTIF-NBR                            19360002
193700                FROM TTRBNTF                                      19370002
193800               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          19380002
193900                 AND FCLTY_ID       = :TM500-FCLTY-ID             19390002
194000                 AND PO_NBR         = :TM500-PO-NBR               19400002
194100                 AND PO_LNE_NBR     = :TM500-PO-LNE-NBR           19410002
194200                 AND PREPK_ID       = :TM500-PREPK-ID             19420002
194300                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          19430002
194400                 AND TRBL_RSN_CDE   = :TM500-TRBL-RSN-CDE         19440002
194500                 AND RESOLVED_IND   IN (:PC-N, :PC-I)             19450002
194600         END-EXEC                                                 19460002
194700                                                                  19470002
194800         PERFORM 8001-WRITE-SQLCODE                               19480002
194900         EVALUATE TRUE                                            19490002
195000             WHEN SQLCODE = +0                                    19500002
195100                  SET PS-RESOLVE-FOUND TO TRUE                    19510002
195200                                                                  19520002
195300             WHEN SQLCODE = +100                                  19530002
195400                  SET PS-NO-RESOLVE-FOUND TO TRUE                 19540002
195500                                                                  19550002
195600             WHEN SQLCODE = -904                                  19560002
195700             WHEN SQLCODE = -911                                  19570002
195800             WHEN SQLCODE = -913                                  19580002
195900                  CONTINUE                                        19590002
196000                                                                  19600002
196100             WHEN OTHER                                           19610002
196200                  SET  PS-DONE TO TRUE                            19620002
196300                  MOVE SQLCA   TO TM500-SQLCA                     19630002
196400                  MOVE SQLCODE TO TM500-SQLCODE                   19640002
196500                  MOVE PRV-5D  TO TM500-RETURN-DATA               19650002
196600                                                                  19660002
196700                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          19670002
196800                  MOVE '2620'    TO PRV-PARA                      19680002
196900                  MOVE 'TTRBNTF' TO PRV-TBL                       19690002
197000                  PERFORM 9999-RETURN-MSG                         19700002
197100         END-EVALUATE                                             19710002
197200     END-PERFORM.                                                 19720002
197300                                                                  19730002
197400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         19740002
197500         SET PS-DONE  TO TRUE                                     19750002
197600         MOVE SQLCA   TO TM500-SQLCA                              19760002
197700         MOVE SQLCODE TO TM500-SQLCODE                            19770002
197800         MOVE PRV-5D  TO TM500-RETURN-DATA                        19780002
197900                                                                  19790002
198000         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   19800002
198100         MOVE '2620'    TO PRV-PARA                               19810002
198200         MOVE 'TTRBNTF' TO PRV-TBL                                19820002
198300         PERFORM 9999-RETURN-MSG                                  19830002
198400     END-IF.                                                      19840002
198500                                                                  19850002
198510 2625-VALIDATE-FOR-RESOLVE.                                       19851010
198520******************************************************************19852010
198530******************************************************************19853010
198540                                                                  19854010
198550     MOVE '2625-VALIDATE-FOR-RESOLVE' TO PV-CSSL-PARA             19855010
198560     PERFORM 8000-WRITE-CSSL                                      19856010
198570                                                                  19857010
198580     PERFORM WITH TEST AFTER                                      19858010
198590         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    19859010
198591         UNTIL   SQLCODE = +0 OR                                  19859110
198592                 SQLCODE = +100 OR                                19859210
198593                 PS-DONE OR                                       19859310
198594                 PV-RETRY-COUNTER > PC-MAX-RETRIES                19859410
198595                                                                  19859510
198596         EXEC SQL                                                 19859610
198597              SELECT NOTIF_NBR                                    19859710
198598                INTO :TRBNTF-NOTIF-NBR                            19859810
198599                FROM TTRBNTF                                      19859910
198602               WHERE PO_NBR         = :TM500-PO-NBR               19860211
198603                 AND PO_LNE_NBR     = :TM500-PO-LNE-NBR           19860310
198604                 AND PREPK_ID       = :TM500-PREPK-ID             19860410
198605                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          19860510
198606                 AND TRBL_RSN_CDE   = :TM500-TRBL-RSN-CDE         19860610
198607                 AND RESOLVED_IND   IN (:PC-N, :PC-I)             19860710
198608         END-EXEC                                                 19860810
198609                                                                  19860910
198610         PERFORM 8001-WRITE-SQLCODE                               19861010
198611         EVALUATE TRUE                                            19861110
198612             WHEN SQLCODE = +0                                    19861210
198613                  SET PS-RESOLVE-FOUND TO TRUE                    19861310
198614                                                                  19861410
198615             WHEN SQLCODE = +100                                  19861510
198616                  SET PS-NO-RESOLVE-FOUND TO TRUE                 19861610
198617                                                                  19861710
198618             WHEN SQLCODE = -904                                  19861810
198619             WHEN SQLCODE = -911                                  19861910
198620             WHEN SQLCODE = -913                                  19862010
198621                  CONTINUE                                        19862110
198622                                                                  19862210
198623             WHEN OTHER                                           19862310
198624                  SET  PS-DONE TO TRUE                            19862410
198625                  MOVE SQLCA   TO TM500-SQLCA                     19862510
198626                  MOVE SQLCODE TO TM500-SQLCODE                   19862610
198627                  MOVE PRV-5D  TO TM500-RETURN-DATA               19862710
198628                                                                  19862810
198629                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          19862910
198630                  MOVE '2625'    TO PRV-PARA                      19863010
198631                  MOVE 'TTRBNTF' TO PRV-TBL                       19863110
198632                  PERFORM 9999-RETURN-MSG                         19863210
198633         END-EVALUATE                                             19863310
198634     END-PERFORM.                                                 19863410
198635                                                                  19863510
198636     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         19863610
198637         SET PS-DONE  TO TRUE                                     19863710
198638         MOVE SQLCA   TO TM500-SQLCA                              19863810
198639         MOVE SQLCODE TO TM500-SQLCODE                            19863910
198640         MOVE PRV-5D  TO TM500-RETURN-DATA                        19864010
198641                                                                  19864110
198642         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   19864210
198643         MOVE '2625'    TO PRV-PARA                               19864310
198644         MOVE 'TTRBNTF' TO PRV-TBL                                19864410
198645         PERFORM 9999-RETURN-MSG                                  19864510
198646     END-IF.                                                      19864610
198647                                                                  19864710
198650                                                                  19865010
198700 2630-RESOLVE-UPDATE.                                             19870002
198800******************************************************************19880002
198900*    THIS PARAGRAPH UPDATES TTRBNTF RESOLVED-IND TO RESOLVE.      19890002
199000******************************************************************19900002
199100                                                                  19910002
199200     MOVE '2630-RESOLVE-UPDATE'       TO PV-CSSL-PARA             19920002
199300     PERFORM 8000-WRITE-CSSL                                      19930002
199400                                                                  19940002
199500     PERFORM WITH TEST AFTER                                      19950002
199600         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    19960002
199700         UNTIL   SQLCODE = +0 OR                                  19970002
199800                 PS-DONE OR                                       19980002
199900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                19990002
200000                                                                  20000002
200100         EVALUATE TRUE                                            20010002
200200                                                                  20020002
200300             WHEN TM500-RTV-YES OR TM500-RTV-NO                   20030002
200400                                                                  20040002
200500              EXEC SQL                                            20050002
200600                 UPDATE TTRBNTF                                   20060002
200700                    SET RESOLVED_IND  = :TRBNTF-RESOLVED-IND      20070002
200800                      , RESOLVED_TMST = CURRENT TIMESTAMP         20080002
200900                      , RESOLVED_UID  = :TRBNTF-RESOLVED-UID      20090002
201000                      , RTV_IND       = :TM500-RTV-SW             20100002
201100                      , RTV_RESPONSE_TMST = CURRENT TIMESTAMP     20110002
201200                 WHERE NOTIF_NBR     = :TRBNTF-NOTIF-NBR          20120002
201300              END-EXEC                                            20130002
201400                                                                  20140002
201500             WHEN TRBNTF-PRORATE-IND = PC-Y                       20150002
201600                                                                  20160002
201700              EXEC SQL                                            20170002
201800                 UPDATE TTRBNTF                                   20180002
201900                    SET RESOLVED_IND  = :TRBNTF-RESOLVED-IND      20190002
202000                      , RESOLVED_TMST = CURRENT TIMESTAMP         20200002
202100                      , RESOLVED_UID  = :TRBNTF-RESOLVED-UID      20210002
202200                      , PRORATE_IND   = :TRBNTF-PRORATE-IND       20220002
202300                 WHERE NOTIF_NBR     = :TRBNTF-NOTIF-NBR          20230002
202400              END-EXEC                                            20240002
202500                                                                  20250002
202600             WHEN OTHER                                           20260002
202700                                                                  20270002
202800            EXEC SQL                                              20280002
202900              UPDATE TTRBNTF                                      20290002
203000                 SET RESOLVED_IND  = :TRBNTF-RESOLVED-IND         20300002
203100                   , RESOLVED_TMST = CURRENT TIMESTAMP            20310002
203200                   , RESOLVED_UID  = :TRBNTF-RESOLVED-UID         20320002
203300               WHERE NOTIF_NBR     = :TRBNTF-NOTIF-NBR            20330002
203400            END-EXEC                                              20340002
203500         END-EVALUATE                                             20350002
203600                                                                  20360002
203700         PERFORM 8001-WRITE-SQLCODE                               20370002
203800         EVALUATE TRUE                                            20380002
203900             WHEN SQLCODE = +0                                    20390002
204000                  MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND  20400002
204100                                                                  20410002
204200             WHEN SQLCODE = -904                                  20420002
204300             WHEN SQLCODE = -911                                  20430002
204400             WHEN SQLCODE = -913                                  20440002
204500                  CONTINUE                                        20450002
204600                                                                  20460002
204700             WHEN OTHER                                           20470002
204800                  SET  PS-DONE TO TRUE                            20480002
204900                  MOVE SQLCA   TO TM500-SQLCA                     20490002
205000                  MOVE SQLCODE TO TM500-SQLCODE                   20500002
205100                  MOVE PRV-5I  TO TM500-RETURN-DATA               20510002
205200                                                                  20520002
205300                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          20530002
205400                  MOVE '2630'    TO PRV-PARA                      20540002
205500                  MOVE 'TTRBNTF' TO PRV-TBL                       20550002
205600                  PERFORM 9999-RETURN-MSG                         20560002
205700         END-EVALUATE                                             20570002
205800     END-PERFORM.                                                 20580002
205900                                                                  20590002
206000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         20600002
206100         SET  PS-DONE TO TRUE                                     20610002
206200         MOVE SQLCA   TO TM500-SQLCA                              20620002
206300         MOVE SQLCODE TO TM500-SQLCODE                            20630002
206400         MOVE PRV-5I  TO TM500-RETURN-DATA                        20640002
206500                                                                  20650002
206600         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   20660002
206700         MOVE '2630'    TO PRV-PARA                               20670002
206800         MOVE 'TTRBNTF' TO PRV-TBL                                20680002
206900         PERFORM 9999-RETURN-MSG                                  20690002
207000     END-IF.                                                      20700002
207100                                                                  20710002
207200                                                                  20720002
207300 2640-ACKNOWLEDGE-UPDATE.                                         20730002
207400******************************************************************20740002
207500*    THIS PARAGRAPH UPDATES TTRBNTF RESOLVED-IND TO ACKNOWLEDGE.  20750002
207600******************************************************************20760002
207700                                                                  20770002
207800     MOVE '2640-ACKNOWLEDGE-UPDATE'   TO PV-CSSL-PARA             20780002
207900     PERFORM 8000-WRITE-CSSL                                      20790002
208000                                                                  20800002
208100     PERFORM WITH TEST AFTER                                      20810002
208200         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    20820002
208300         UNTIL   SQLCODE = +0 OR                                  20830002
208400                 PS-DONE OR                                       20840002
208500                 PV-RETRY-COUNTER > PC-MAX-RETRIES                20850002
208600                                                                  20860002
208700         EXEC SQL                                                 20870002
208800              UPDATE TTRBNTF                                      20880002
208900                 SET RESOLVED_IND  = :TRBNTF-RESOLVED-IND         20890002
209000                   , ACKNOWLG_TMST = CURRENT TIMESTAMP            20900002
209100                   , ACKNOWLG_UID  = :TRBNTF-ACKNOWLG-UID         20910002
209200               WHERE NOTIF_NBR     = :TRBNTF-NOTIF-NBR            20920002
209300         END-EXEC                                                 20930002
209400                                                                  20940002
209500         PERFORM 8001-WRITE-SQLCODE                               20950002
209600         EVALUATE TRUE                                            20960002
209700             WHEN SQLCODE = +0                                    20970002
209800                  MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND  20980002
209900                                                                  20990002
210000             WHEN SQLCODE = -904                                  21000002
210100             WHEN SQLCODE = -911                                  21010002
210200             WHEN SQLCODE = -913                                  21020002
210300                  CONTINUE                                        21030002
210400                                                                  21040002
210500             WHEN OTHER                                           21050002
210600                  SET  PS-DONE TO TRUE                            21060002
210700                  MOVE SQLCA   TO TM500-SQLCA                     21070002
210800                  MOVE SQLCODE TO TM500-SQLCODE                   21080002
210900                  MOVE PRV-5I  TO TM500-RETURN-DATA               21090002
211000                                                                  21100002
211100                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          21110002
211200                  MOVE '2640'    TO PRV-PARA                      21120002
211300                  MOVE 'TTRBNTF' TO PRV-TBL                       21130002
211400                  PERFORM 9999-RETURN-MSG                         21140002
211500         END-EVALUATE                                             21150002
211600     END-PERFORM.                                                 21160002
211700                                                                  21170002
211800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         21180002
211900         SET  PS-DONE TO TRUE                                     21190002
212000         MOVE SQLCA   TO TM500-SQLCA                              21200002
212100         MOVE SQLCODE TO TM500-SQLCODE                            21210002
212200         MOVE PRV-5I  TO TM500-RETURN-DATA                        21220002
212300                                                                  21230002
212400         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   21240002
212500         MOVE '2640'    TO PRV-PARA                               21250002
212600         MOVE 'TTRBNTF' TO PRV-TBL                                21260002
212700         PERFORM 9999-RETURN-MSG                                  21270002
212800     END-IF.                                                      21280002
212900                                                                  21290002
213000                                                                  21300002
213100 2700-DEFAULT-TRECEIV-TMST.                                       21310002
213200******************************************************************21320002
213300******************************************************************21330002
213400                                                                  21340002
213500     MOVE '2700-DEFAULT-TRECEIV-TMST' TO PV-CSSL-PARA             21350002
213600     PERFORM 8000-WRITE-CSSL                                      21360002
213700                                                                  21370002
213800     IF TM500-RESOLVE-MANUAL OR TM500-RESOLVE-AUTO OR             21380002
213900        TM500-RESOLVE-SPECIFIC                                    21390002
214000         PERFORM 4000-SELECT-NOTIF-IND                            21400002
214100                                                                  21410002
214200         IF PS-NOT-DONE AND TRBRSN-NOTIF-IND = PC-T               21420002
214300             PERFORM 2710-SELECT-RESOLVED-IND                     21430002
214400                                                                  21440002
214500             IF PS-NOT-DONE AND PS-NO-MORE-TROUBLE                21450002
214600                 PERFORM 2720-DEFAULT-IN-TRBL-TMST                21460002
214700             END-IF                                               21470002
214800         END-IF                                                   21480002
214900     END-IF.                                                      21490002
215000                                                                  21500002
215100                                                                  21510002
215200 2710-SELECT-RESOLVED-IND.                                        21520002
215300******************************************************************21530002
215400******************************************************************21540002
215500                                                                  21550002
215600     MOVE '2710-SELECT-RESOLVED-IND'  TO PV-CSSL-PARA             21560002
215700     PERFORM 8000-WRITE-CSSL                                      21570002
215800                                                                  21580002
215900     PERFORM WITH TEST AFTER                                      21590002
216000         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    21600002
216100         UNTIL   SQLCODE = +0 OR                                  21610002
216200                 SQLCODE = +100 OR                                21620002
216300                 SQLCODE = -811 OR                                21630002
216400                 PS-DONE OR                                       21640002
216500                 PV-RETRY-COUNTER > PC-MAX-RETRIES                21650002
216600                                                                  21660002
216700         EXEC SQL                                                 21670002
216800              SELECT NOTIF_NBR                                    21680002
216900                INTO :TRBNTF-NOTIF-NBR                            21690002
217000                FROM TTRBNTF                                      21700002
217100               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          21710002
217200                 AND FCLTY_ID       = :TM500-FCLTY-ID             21720002
217300                 AND PO_NBR         = :TM500-PO-NBR               21730002
217400                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          21740002
217500                 AND RESOLVED_IND   IN (:PC-N, :PC-I)             21750002
217600         END-EXEC                                                 21760002
217700                                                                  21770002
217800         PERFORM 8001-WRITE-SQLCODE                               21780002
217900         EVALUATE TRUE                                            21790002
218000             WHEN SQLCODE = +0                                    21800002
218100                  SET PS-MORE-TROUBLE TO TRUE                     21810002
218200                                                                  21820002
218300             WHEN SQLCODE = +100                                  21830002
218400             WHEN SQLCODE = -811                                  21840002
218500                  SET PS-NO-MORE-TROUBLE TO TRUE                  21850002
218600                                                                  21860002
218700             WHEN SQLCODE = -904                                  21870002
218800             WHEN SQLCODE = -911                                  21880002
218900             WHEN SQLCODE = -913                                  21890002
219000                  CONTINUE                                        21900002
219100                                                                  21910002
219200             WHEN OTHER                                           21920002
219300                  SET  PS-DONE TO TRUE                            21930002
219400                  MOVE SQLCA   TO TM500-SQLCA                     21940002
219500                  MOVE SQLCODE TO TM500-SQLCODE                   21950002
219600                  MOVE PRV-5D  TO TM500-RETURN-DATA               21960002
219700                                                                  21970002
219800                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          21980002
219900                  MOVE '2710'    TO PRV-PARA                      21990002
220000                  MOVE 'TTRBNTF' TO PRV-TBL                       22000002
220100                  PERFORM 9999-RETURN-MSG                         22010002
220200         END-EVALUATE                                             22020002
220300     END-PERFORM.                                                 22030002
220400                                                                  22040002
220500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         22050002
220600         SET PS-DONE  TO TRUE                                     22060002
220700         MOVE SQLCA   TO TM500-SQLCA                              22070002
220800         MOVE SQLCODE TO TM500-SQLCODE                            22080002
220900         MOVE PRV-5D  TO TM500-RETURN-DATA                        22090002
221000                                                                  22100002
221100         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   22110002
221200         MOVE '2710'    TO PRV-PARA                               22120002
221300         MOVE 'TTRBNTF' TO PRV-TBL                                22130002
221400         PERFORM 9999-RETURN-MSG                                  22140002
221500     END-IF.                                                      22150002
221600                                                                  22160002
221700                                                                  22170002
221800 2720-DEFAULT-IN-TRBL-TMST.                                       22180002
221900******************************************************************22190002
222000******************************************************************22200002
222100                                                                  22210002
222200     MOVE '2720-DEFAULT-IN-TRBL-TMST' TO PV-CSSL-PARA             22220002
222300     PERFORM 8000-WRITE-CSSL                                      22230002
222400                                                                  22240002
222500     IF PS-DO-NOT-USE-OPER                                        22250002
222600         PERFORM 2721A-GET-IN-TRBL-TMST-NO-OPER                   22260006
222700     ELSE                                                         22270002
222800         PERFORM 2721-GET-IN-TRBL-TMST                            22280002
222900     END-IF.                                                      22290002
223000                                                                  22300002
223100     IF PS-NOT-DONE                                               22310002
223200         IF RECEIV-IN-TRBL-TMST NOT = PC-DEFAULT-TMST             22320002
223300             PERFORM 2722-CALC-LGTH-OF-TRBL                       22330002
223400             IF PS-DO-NOT-USE-OPER                                22340002
223500                 PERFORM 2724-UPDATE-TRECEIV-NO-OPER              22350006
223600             ELSE                                                 22360002
223700                 PERFORM 2723-UPDATE-TRECEIV                      22370002
223800             END-IF                                               22380002
223900         END-IF                                                   22390002
224000     END-IF.                                                      22400002
224100                                                                  22410002
224200                                                                  22420002
224300 2721-GET-IN-TRBL-TMST.                                           22430002
224400******************************************************************22440002
224500******************************************************************22450002
224600                                                                  22460002
224700     MOVE '2721-GET-IN-TRBL-TMST'     TO PV-CSSL-PARA             22470002
224800     PERFORM 8000-WRITE-CSSL                                      22480002
224900                                                                  22490002
225000     PERFORM WITH TEST AFTER                                      22500002
225100         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    22510002
225200         UNTIL   SQLCODE = +0 OR                                  22520002
225300                 PS-DONE OR                                       22530002
225400                 PV-RETRY-COUNTER > PC-MAX-RETRIES                22540002
225500                                                                  22550002
225600         EXEC SQL                                                 22560002
225700              SELECT IN_TRBL_TMST                                 22570002
225800                   , DAY(CURRENT TIMESTAMP - IN_TRBL_TMST)        22580002
225900                   , HOUR(CURRENT TIMESTAMP - IN_TRBL_TMST)       22590002
226000                   , MINUTE(CURRENT TIMESTAMP - IN_TRBL_TMST)     22600002
226100                   , DATE(CURRENT TIMESTAMP)                      22610002
226200                   , TIME(CURRENT TIMESTAMP)                      22620002
226300                   , DATE(IN_TRBL_TMST)                           22630002
226400                   , TIME(IN_TRBL_TMST)                           22640002
226500                INTO :RECEIV-IN-TRBL-TMST                         22650002
226600                   , :PV-DB2-DAYS                                 22660002
226700                   , :PV-DB2-HOURS                                22670002
226800                   , :PV-DB2-MINUTES                              22680002
226900                   , :PV-CURRENT-DATE                             22690002
227000                   , :PV-CURRENT-TIME                             22700002
227100                   , :PV-IN-TRBL-DATE                             22710002
227200                   , :PV-IN-TRBL-TIME                             22720002
227300                FROM TRECEIV                                      22730002
227400** 1/2/09      WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          22740017
227500** 1/2/09        AND FCLTY_ID       = :TM500-FCLTY-ID             22750017
227600               where ORD_NBR        = :TM500-PO-NBR               22760017
227700                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          22770002
227800                 AND VER_STATUS_CDE = :PC-ACTIVE                  22780002
227900         END-EXEC                                                 22790002
228000                                                                  22800002
228100         PERFORM 8001-WRITE-SQLCODE                               22810002
228200         EVALUATE TRUE                                            22820002
228300             WHEN SQLCODE = +0                                    22830002
228400                  CONTINUE                                        22840002
228500                                                                  22850002
228600             WHEN SQLCODE = -904                                  22860002
228700             WHEN SQLCODE = -911                                  22870002
228800             WHEN SQLCODE = -913                                  22880002
228900                  CONTINUE                                        22890002
229000                                                                  22900002
229100             WHEN OTHER                                           22910002
229200                  SET  PS-DONE TO TRUE                            22920002
229300                  MOVE SQLCA   TO TM500-SQLCA                     22930002
229400                  MOVE SQLCODE TO TM500-SQLCODE                   22940002
229500                  MOVE PRV-5G  TO TM500-RETURN-DATA               22950002
229600                                                                  22960002
229700                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          22970002
229800                  MOVE '2721'    TO PRV-PARA                      22980002
229900                  MOVE 'TRECEIV' TO PRV-TBL                       22990002
230000                  PERFORM 9999-RETURN-MSG                         23000002
230100         END-EVALUATE                                             23010002
230200     END-PERFORM.                                                 23020002
230300                                                                  23030002
230400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         23040002
230500         SET PS-DONE  TO TRUE                                     23050002
230600         MOVE SQLCA   TO TM500-SQLCA                              23060002
230700         MOVE SQLCODE TO TM500-SQLCODE                            23070002
230800         MOVE PRV-5G  TO TM500-RETURN-DATA                        23080002
230900                                                                  23090002
231000         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   23100002
231100         MOVE '2721'    TO PRV-PARA                               23110002
231200         MOVE 'TRECEIV' TO PRV-TBL                                23120002
231300         PERFORM 9999-RETURN-MSG                                  23130002
231400     END-IF.                                                      23140002
231500                                                                  23150002
231600                                                                  23160002
231700 2721A-GET-IN-TRBL-TMST-NO-OPER.                                  23170006
231800******************************************************************23180002
231900******************************************************************23190002
232000                                                                  23200002
232100     MOVE '2721A-GET-IN-TRBL-TMST-NO-OPER'    TO PV-CSSL-PARA     23210006
232200     PERFORM 8000-WRITE-CSSL                                      23220002
232300                                                                  23230002
232400     PERFORM WITH TEST AFTER                                      23240002
232500         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    23250002
232600         UNTIL   SQLCODE = +0 OR                                  23260002
232700                 PS-DONE OR                                       23270002
232800                 PV-RETRY-COUNTER > PC-MAX-RETRIES                23280002
232900                                                                  23290002
233000         EXEC SQL                                                 23300002
233100              SELECT IN_TRBL_TMST                                 23310002
233200                   , DAY(CURRENT TIMESTAMP - IN_TRBL_TMST)        23320002
233300                   , HOUR(CURRENT TIMESTAMP - IN_TRBL_TMST)       23330002
233400                   , MINUTE(CURRENT TIMESTAMP - IN_TRBL_TMST)     23340002
233500                   , DATE(CURRENT TIMESTAMP)                      23350002
233600                   , TIME(CURRENT TIMESTAMP)                      23360002
233700                   , DATE(IN_TRBL_TMST)                           23370002
233800                   , TIME(IN_TRBL_TMST)                           23380002
233900                INTO :RECEIV-IN-TRBL-TMST                         23390002
234000                   , :PV-DB2-DAYS                                 23400002
234100                   , :PV-DB2-HOURS                                23410002
234200                   , :PV-DB2-MINUTES                              23420002
234300                   , :PV-CURRENT-DATE                             23430002
234400                   , :PV-CURRENT-TIME                             23440002
234500                   , :PV-IN-TRBL-DATE                             23450002
234600                   , :PV-IN-TRBL-TIME                             23460002
234700                FROM TRECEIV                                      23470002
234800               WHERE ORD_NBR        = :TM500-PO-NBR               23480002
234900                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          23490002
235000                 AND VER_STATUS_CDE = :PC-ACTIVE                  23500002
235100         END-EXEC                                                 23510002
235200                                                                  23520002
235300         PERFORM 8001-WRITE-SQLCODE                               23530002
235400         EVALUATE TRUE                                            23540002
235500             WHEN SQLCODE = +0                                    23550002
235600                  CONTINUE                                        23560002
235700                                                                  23570002
235800             WHEN SQLCODE = -904                                  23580002
235900             WHEN SQLCODE = -911                                  23590002
236000             WHEN SQLCODE = -913                                  23600002
236100                  CONTINUE                                        23610002
236200                                                                  23620002
236300             WHEN OTHER                                           23630002
236400                  SET  PS-DONE TO TRUE                            23640002
236500                  MOVE SQLCA   TO TM500-SQLCA                     23650002
236600                  MOVE SQLCODE TO TM500-SQLCODE                   23660002
236700                  MOVE PRV-5G  TO TM500-RETURN-DATA               23670002
236800                                                                  23680002
236900                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          23690002
237000                  MOVE '272A'    TO PRV-PARA                      23700004
237100                  MOVE 'TRECEIV' TO PRV-TBL                       23710002
237200                  PERFORM 9999-RETURN-MSG                         23720002
237300         END-EVALUATE                                             23730002
237400     END-PERFORM.                                                 23740002
237500                                                                  23750002
237600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         23760002
237700         SET PS-DONE  TO TRUE                                     23770002
237800         MOVE SQLCA   TO TM500-SQLCA                              23780002
237900         MOVE SQLCODE TO TM500-SQLCODE                            23790002
238000         MOVE PRV-5G  TO TM500-RETURN-DATA                        23800002
238100                                                                  23810002
238200         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   23820002
238300         MOVE '272A'    TO PRV-PARA                               23830004
238400         MOVE 'TRECEIV' TO PRV-TBL                                23840002
238500         PERFORM 9999-RETURN-MSG                                  23850002
238600     END-IF.                                                      23860002
238700                                                                  23870002
238800                                                                  23880002
238900 2722-CALC-LGTH-OF-TRBL.                                          23890002
239000                                                                  23900002
239100     MOVE '2722-CALC-LGTH-OF-TRBL'    TO PV-CSSL-PARA             23910002
239200     PERFORM 8000-WRITE-CSSL                                      23920002
239300                                                                  23930002
239400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56               23940002
239500     SET DPG51-ACTUAL-CALENDAR-ONLY                               23950002
239600                                      TO TRUE                     23960002
239700                                                                  23970002
239800     MOVE PV-CURRENT-DATE             TO DPG52-LK-DATE-INPUT      23980002
239900     SET DPG52-LK-DTE-ISO-FMT         TO TRUE                     23990002
240000                                                                  24000002
240100     MOVE PV-IN-TRBL-DATE             TO DPG53-LK-CMPR-DATE-INPUT 24010002
240200     SET DPG53-LK-CMPR-DTE-ISO-FMT    TO TRUE                     24020002
240300                                                                  24030002
240400     CALL DP500-KOHLS-CALENDAR-ROUTINE                            24040002
240500                          USING DPG51 DPG52 DPG53                 24050002
240600                                DPG54 DPG55 DPG56                 24060002
240700                                                                  24070002
240800     EVALUATE TRUE                                                24080002
240900         WHEN DPG54-NO-ERROR                                      24090002
241000             MOVE DPG55-BUS-DAYS-DIFFERENCE                       24100002
241100                                      TO PV-DB2-DAYS              24110002
241200     END-EVALUATE                                                 24120002
241300                                                                  24130002
241400* AN ADJUSTMENT MUST BE MADE TO THE NUMBER OF DAYS BECAUSE THE    24140002
241500* CALENDAR ROUTINE COUNTS A DAY AS A DAY REGARDLESS OF THE HOUR   24150002
241600* OF THE DAY.  SO IF THE IN-TRBL DATE/TIME IS 06-30-1999 / 1300   24160002
241700* AND THE CURRENT DATE/TIME IS 07-01-99 / 1400, THE RESULT WOULD  24170002
241800* BE 1 DAY 25 HOURS IF WE DIDN'T ADJUST IT BY 1 DAY.              24180002
241900                                                                  24190002
242000     IF PV-DB2-DAYS > ZERO                                        24200002
242100         COMPUTE PV-DB2-HOURS = PV-DB2-HOURS + (PV-DB2-DAYS * 24) 24210002
242200             IF PV-IN-TRBL-TIME > PV-CURRENT-TIME                 24220002
242300                 SUBTRACT 24 FROM PV-DB2-HOURS                    24230002
242400             END-IF                                               24240002
242500     END-IF                                                       24250002
242600                                                                  24260002
242700     MOVE PV-DB2-HOURS                TO RECEIV-IN-TRBL-HOUR-CNT  24270002
242800     MOVE PV-DB2-MINUTES              TO RECEIV-IN-TRBL-MIN-CNT.  24280002
242900                                                                  24290002
243000                                                                  24300002
243100     IF RECEIV-IN-TRBL-HOUR-CNT < ZERO OR                         24310002
243200         RECEIV-IN-TRBL-MIN-CNT < ZERO                            24320002
243300         MOVE PV-IN-TRBL-DATE         TO PV-MSG-FROM-DATE         24330002
243400         MOVE PV-IN-TRBL-TIME         TO PV-MSG-FROM-TIME         24340002
243500         MOVE PV-CURRENT-DATE         TO PV-MSG-TO-DATE           24350002
243600         MOVE PV-CURRENT-TIME         TO PV-MSG-TO-TIME           24360002
243700         EXEC CICS                                                24370002
243800             WRITEQ TD                                            24380002
243900                 QUEUE  ('CSSL')                                  24390002
244000                 FROM   (PV-CICS-MSG-AREA)                        24400002
244100                 RESP   (PV-CICS-RESP)                            24410002
244200         END-EXEC                                                 24420002
244300     END-IF.                                                      24430002
244400                                                                  24440002
244500                                                                  24450002
244600 2723-UPDATE-TRECEIV.                                             24460002
244700                                                                  24470002
244800     MOVE '2723-UPDATE-TRECEIV'       TO PV-CSSL-PARA             24480002
244900     PERFORM 8000-WRITE-CSSL                                      24490002
245000                                                                  24500002
245100     PERFORM WITH TEST AFTER                                      24510002
245200         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    24520002
245300         UNTIL   SQLCODE = +0 OR                                  24530002
245310                 SQLCODE = +100  or                               24531024
245400                 PS-DONE OR                                       24540002
245500                 PV-RETRY-COUNTER > PC-MAX-RETRIES                24550002
245600                                                                  24560002
245700         EXEC SQL                                                 24570002
245800              UPDATE TRECEIV                                      24580002
245900                 SET IN_TRBL_TMST     = :PC-DEFAULT-TMST          24590002
246000                   , IN_TRBL_MIN_CNT  = :RECEIV-IN-TRBL-MIN-CNT   24600002
246100                   , IN_TRBL_HOUR_CNT = :RECEIV-IN-TRBL-HOUR-CNT  24610002
246200               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          24620002
246300                 AND FCLTY_ID       = :TM500-FCLTY-ID             24630002
246400                 AND ORD_NBR        = :TM500-PO-NBR               24640002
246500                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          24650002
246600                 AND VER_STATUS_CDE = :PC-ACTIVE                  24660002
246700         END-EXEC                                                 24670002
246800                                                                  24680002
246900         PERFORM 8001-WRITE-SQLCODE                               24690002
247000         EVALUATE TRUE                                            24700002
247100             WHEN SQLCODE = +0                                    24710002
247200                  CONTINUE                                        24720002
247300                                                                  24730002
247310             WHEN SQLCODE = +100                                  24731024
247320                  PERFORM 2724-UPDATE-TRECEIV-NO-OPER             24732024
247340                                                                  24734024
247400             WHEN SQLCODE = -904                                  24740002
247500             WHEN SQLCODE = -911                                  24750002
247600             WHEN SQLCODE = -913                                  24760002
247700                  CONTINUE                                        24770002
247800                                                                  24780002
247900             WHEN OTHER                                           24790002
248000                  SET  PS-DONE TO TRUE                            24800002
248100                  MOVE SQLCA   TO TM500-SQLCA                     24810002
248200                  MOVE SQLCODE TO TM500-SQLCODE                   24820002
248300                  MOVE PRV-5H  TO TM500-RETURN-DATA               24830002
248400                                                                  24840002
248500                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          24850002
248600                  MOVE '2723'    TO PRV-PARA                      24860002
248700                  MOVE 'TRECEIV' TO PRV-TBL                       24870002
248800                  PERFORM 9999-RETURN-MSG                         24880002
248900         END-EVALUATE                                             24890002
249000     END-PERFORM.                                                 24900002
249100                                                                  24910002
249200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         24920002
249300         SET  PS-DONE TO TRUE                                     24930002
249400         MOVE SQLCA   TO TM500-SQLCA                              24940002
249500         MOVE SQLCODE TO TM500-SQLCODE                            24950002
249600         MOVE PRV-5H  TO TM500-RETURN-DATA                        24960002
249700                                                                  24970002
249800         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   24980002
249900         MOVE '2723'    TO PRV-PARA                               24990002
250000         MOVE 'TRECEIV' TO PRV-TBL                                25000002
250100         PERFORM 9999-RETURN-MSG                                  25010002
250200     END-IF.                                                      25020002
250300                                                                  25030002
250400 2724-UPDATE-TRECEIV-NO-OPER.                                     25040006
250500                                                                  25050002
250600     MOVE '2724-UPDATE-TRECEIV-NO-OPER'   TO PV-CSSL-PARA         25060006
250700     PERFORM 8000-WRITE-CSSL                                      25070002
250800                                                                  25080002
250900     PERFORM WITH TEST AFTER                                      25090002
251000         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    25100002
251100         UNTIL   SQLCODE = +0 OR                                  25110002
251200                 PS-DONE OR                                       25120002
251300                 PV-RETRY-COUNTER > PC-MAX-RETRIES                25130002
251400                                                                  25140002
251500         EXEC SQL                                                 25150002
251600              UPDATE TRECEIV                                      25160002
251700                 SET IN_TRBL_TMST     = :PC-DEFAULT-TMST          25170002
251800                   , IN_TRBL_MIN_CNT  = :RECEIV-IN-TRBL-MIN-CNT   25180002
251900                   , IN_TRBL_HOUR_CNT = :RECEIV-IN-TRBL-HOUR-CNT  25190002
252000               WHERE ORD_NBR        = :TM500-PO-NBR               25200002
252100                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          25210002
252200                 AND VER_STATUS_CDE = :PC-ACTIVE                  25220002
252300         END-EXEC                                                 25230002
252400                                                                  25240002
252500         PERFORM 8001-WRITE-SQLCODE                               25250002
252600         EVALUATE TRUE                                            25260002
252700             WHEN SQLCODE = +0                                    25270002
252800                  CONTINUE                                        25280002
252900                                                                  25290002
253000             WHEN SQLCODE = -904                                  25300002
253100             WHEN SQLCODE = -911                                  25310002
253200             WHEN SQLCODE = -913                                  25320002
253300                  CONTINUE                                        25330002
253400                                                                  25340002
253500             WHEN OTHER                                           25350002
253600                  SET  PS-DONE TO TRUE                            25360002
253700                  MOVE SQLCA   TO TM500-SQLCA                     25370002
253800                  MOVE SQLCODE TO TM500-SQLCODE                   25380002
253900                  MOVE PRV-5H  TO TM500-RETURN-DATA               25390002
254000                                                                  25400002
254100                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          25410002
254200                  MOVE '2724'    TO PRV-PARA                      25420002
254300                  MOVE 'TRECEIV' TO PRV-TBL                       25430002
254400                  PERFORM 9999-RETURN-MSG                         25440002
254500         END-EVALUATE                                             25450002
254600     END-PERFORM.                                                 25460002
254700                                                                  25470002
254800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         25480002
254900         SET  PS-DONE TO TRUE                                     25490002
255000         MOVE SQLCA   TO TM500-SQLCA                              25500002
255100         MOVE SQLCODE TO TM500-SQLCODE                            25510002
255200         MOVE PRV-5H  TO TM500-RETURN-DATA                        25520002
255300                                                                  25530002
255400         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   25540002
255500         MOVE '2724'    TO PRV-PARA                               25550002
255600         MOVE 'TRECEIV' TO PRV-TBL                                25560002
255700         PERFORM 9999-RETURN-MSG                                  25570002
255800     END-IF.                                                      25580002
255900                                                                  25590002
256000                                                                  25600002
256100 2800-UPDATE-DEPT-NBR.                                            25610002
256200******************************************************************25620002
256300*    THIS PARAGRAPH UPDATES TTRBNTF DEPT-NBR.                     25630002
256400******************************************************************25640002
256500                                                                  25650002
256600     MOVE '2800-UPDATE-DEPT-NBR'      TO PV-CSSL-PARA             25660002
256700     PERFORM 8000-WRITE-CSSL                                      25670002
256800                                                                  25680002
256900     PERFORM WITH TEST AFTER                                      25690002
257000         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    25700002
257100         UNTIL   SQLCODE = +0 OR                                  25710002
257200                 PS-DONE OR                                       25720002
257300                 PV-RETRY-COUNTER > PC-MAX-RETRIES                25730002
257400                                                                  25740002
257500         EXEC SQL                                                 25750002
257600              UPDATE TTRBNTF                                      25760002
257700                 SET DEPT_NBR  = :TRBNTF-DEPT-NBR                 25770002
257800               WHERE NOTIF_NBR = :TRBNTF-NOTIF-NBR                25780002
257900         END-EXEC                                                 25790002
258000                                                                  25800002
258100         PERFORM 8001-WRITE-SQLCODE                               25810002
258200         EVALUATE TRUE                                            25820002
258300             WHEN SQLCODE = +0                                    25830002
258400                  CONTINUE                                        25840002
258500                                                                  25850002
258600             WHEN SQLCODE = -904                                  25860002
258700             WHEN SQLCODE = -911                                  25870002
258800             WHEN SQLCODE = -913                                  25880002
258900                  CONTINUE                                        25890002
259000                                                                  25900002
259100             WHEN OTHER                                           25910002
259200                  SET  PS-DONE TO TRUE                            25920002
259300                  MOVE SQLCA   TO TM500-SQLCA                     25930002
259400                  MOVE SQLCODE TO TM500-SQLCODE                   25940002
259500                  MOVE PRV-5I  TO TM500-RETURN-DATA               25950002
259600                                                                  25960002
259700                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          25970002
259800                  MOVE '2800'    TO PRV-PARA                      25980002
259900                  MOVE 'TTRBNTF' TO PRV-TBL                       25990002
260000                  PERFORM 9999-RETURN-MSG                         26000002
260100         END-EVALUATE                                             26010002
260200     END-PERFORM.                                                 26020002
260300                                                                  26030002
260400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         26040002
260500         SET  PS-DONE TO TRUE                                     26050002
260600         MOVE SQLCA   TO TM500-SQLCA                              26060002
260700         MOVE SQLCODE TO TM500-SQLCODE                            26070002
260800         MOVE PRV-5I  TO TM500-RETURN-DATA                        26080002
260900                                                                  26090002
261000         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   26100002
261100         MOVE '2800'    TO PRV-PARA                               26110002
261200         MOVE 'TTRBNTF' TO PRV-TBL                                26120002
261300         PERFORM 9999-RETURN-MSG                                  26130002
261400     END-IF.                                                      26140002
261500                                                                  26150002
261600                                                                  26160002
261700 2900-INSERT-TROUBLE-DETAIL.                                      26170002
261800******************************************************************26180002
261900******************************************************************26190002
262000                                                                  26200002
262100     MOVE '2900-INSERT-TROUBLE-DETAIL' TO PV-CSSL-PARA            26210002
262200     PERFORM 8000-WRITE-CSSL                                      26220002
262300                                                                  26230002
262400     PERFORM 2910-PREPARE-TTRBDTL.                                26240002
262500                                                                  26250002
262600     IF PS-NOT-DONE                                               26260002
262700         PERFORM 2920-INSERT-TTRBDTL                              26270002
262800     END-IF.                                                      26280002
262900                                                                  26290002
263000     IF PS-NOT-DONE                                               26300002
263100         PERFORM 2930-GET-TRBDTL-CRE-TMST                         26310002
263200     END-IF.                                                      26320002
263300                                                                  26330002
263400     IF PS-NOT-DONE                                               26340002
263500         PERFORM 2940-UPDATE-LAST-DTL-TMST                        26350002
263600     END-IF.                                                      26360002
263700                                                                  26370002
263800                                                                  26380002
263900 2910-PREPARE-TTRBDTL.                                            26390002
264000******************************************************************26400002
264100*    THIS PARAGRAPH PREPARES THE TTRBDTL FIELDS BEFORE INSERTING  26410002
264200*    THE RECORD.                                                  26420002
264300******************************************************************26430002
264400                                                                  26440002
264500     MOVE '2910-PREPARE-TTRBDTL'       TO PV-CSSL-PARA            26450002
264600     PERFORM 8000-WRITE-CSSL                                      26460002
264700                                                                  26470002
264800     INITIALIZE DCLTTRBDTL                                        26480002
264900                                                                  26490002
265000     MOVE TM500-NOTIF-NBR         TO TRBDTL-NOTIF-NBR             26500002
265100     MOVE TM500-CRE-UID           TO TRBDTL-CRE-UID               26510002
265200     MOVE TM500-FREEFORM-TEXT TO PV-FREEFORM-TEXT                 26520002
265300     MOVE TM500-FREEFORM-TEXT TO TRBDTL-FREEFORM-TEXT-TEXT        26530002
265400                                                                  26540002
265500     EVALUATE TRUE                                                26550002
265600         WHEN PV-FREEFORM-TEXT-5 > SPACES                         26560002
265700              MOVE PC-250 TO TRBDTL-FREEFORM-TEXT-LEN             26570002
265800         WHEN PV-FREEFORM-TEXT-4 > SPACES                         26580002
265900              MOVE PC-200 TO TRBDTL-FREEFORM-TEXT-LEN             26590002
266000         WHEN PV-FREEFORM-TEXT-3 > SPACES                         26600002
266100              MOVE PC-150 TO TRBDTL-FREEFORM-TEXT-LEN             26610002
266200         WHEN PV-FREEFORM-TEXT-2 > SPACES                         26620002
266300              MOVE PC-100 TO TRBDTL-FREEFORM-TEXT-LEN             26630002
266400         WHEN PV-FREEFORM-TEXT-1 > SPACES                         26640002
266500              MOVE PC-50 TO TRBDTL-FREEFORM-TEXT-LEN              26650002
266600         WHEN OTHER                                               26660002
266700             SET PS-DONE TO TRUE                                  26670002
266800     END-EVALUATE.                                                26680002
266900                                                                  26690002
267000                                                                  26700002
267100 2920-INSERT-TTRBDTL.                                             26710002
267200******************************************************************26720002
267300*    THIS PARAGRAPH INSERTS A TTRBDTL RECORD.                     26730002
267400******************************************************************26740002
267500                                                                  26750002
267600     MOVE '2920-INSERT-TTRBDTL'        TO PV-CSSL-PARA            26760002
267700     PERFORM 8000-WRITE-CSSL                                      26770002
267800                                                                  26780002
267900     PERFORM WITH TEST AFTER                                      26790002
268000         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    26800002
268100         UNTIL   SQLCODE = +0 OR                                  26810002
268200                 PS-DONE OR                                       26820002
268300                 PV-RETRY-COUNTER > PC-MAX-RETRIES                26830002
268400                                                                  26840002
268500         EXEC SQL                                                 26850002
268600              INSERT INTO TTRBDTL                                 26860002
268700                     (NOTIF_NBR                                   26870002
268800                   ,  CRE_TMST                                    26880002
268900                   ,  CRE_UID                                     26890002
269000                   ,  FREEFORM_TEXT)                              26900002
269100              VALUES (:TRBDTL-NOTIF-NBR                           26910002
269200                   ,  CURRENT TIMESTAMP                           26920002
269300                   ,  :TRBDTL-CRE-UID                             26930002
269400                   ,  :TRBDTL-FREEFORM-TEXT)                      26940002
269500         END-EXEC                                                 26950002
269600                                                                  26960002
269700         PERFORM 8001-WRITE-SQLCODE                               26970002
269800         EVALUATE TRUE                                            26980002
269900             WHEN SQLCODE = +0                                    26990002
270000                  CONTINUE                                        27000002
270100                                                                  27010002
270200             WHEN SQLCODE = -904                                  27020002
270300             WHEN SQLCODE = -911                                  27030002
270400             WHEN SQLCODE = -913                                  27040002
270500                  CONTINUE                                        27050002
270600                                                                  27060002
270700             WHEN OTHER                                           27070002
270800                  SET  PS-DONE TO TRUE                            27080002
270900                  MOVE SQLCA   TO TM500-SQLCA                     27090002
271000                  MOVE SQLCODE TO TM500-SQLCODE                   27100002
271100                  MOVE PRV-5J  TO TM500-RETURN-DATA               27110002
271200                                                                  27120002
271300                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          27130002
271400                  MOVE TRBDTL-NOTIF-NBR  TO TM500-NOTIF-NBR       27140002
271500                  MOVE '2920'    TO PRV-PARA                      27150002
271600                  MOVE 'TTRBDTL' TO PRV-TBL                       27160002
271700                  PERFORM 9999-RETURN-MSG                         27170002
271800         END-EVALUATE                                             27180002
271900     END-PERFORM.                                                 27190002
272000                                                                  27200002
272100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         27210002
272200         SET  PS-DONE TO TRUE                                     27220002
272300         MOVE SQLCA   TO TM500-SQLCA                              27230002
272400         MOVE SQLCODE TO TM500-SQLCODE                            27240002
272500         MOVE PRV-5J  TO TM500-RETURN-DATA                        27250002
272600                                                                  27260002
272700         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   27270002
272800         MOVE TRBDTL-NOTIF-NBR  TO TM500-NOTIF-NBR                27280002
272900         MOVE '2920'    TO PRV-PARA                               27290002
273000         MOVE 'TTRBDTL' TO PRV-TBL                                27300002
273100         MOVE 'RTR'     TO PRV-OP                                 27310002
273200         PERFORM 9999-RETURN-MSG                                  27320002
273300     END-IF.                                                      27330002
273400                                                                  27340002
273500                                                                  27350002
273600 2930-GET-TRBDTL-CRE-TMST.                                        27360002
273700******************************************************************27370002
273800******************************************************************27380002
273900                                                                  27390002
274000     MOVE '2930-GET-TRBDTL-CRE-TMST'   TO PV-CSSL-PARA            27400002
274100     PERFORM 8000-WRITE-CSSL                                      27410002
274200                                                                  27420002
274300     PERFORM WITH TEST AFTER                                      27430002
274400         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    27440002
274500         UNTIL   SQLCODE = +0 OR                                  27450002
274600                 PS-DONE OR                                       27460002
274700                 PV-RETRY-COUNTER > PC-MAX-RETRIES                27470002
274800                                                                  27480002
274900         EXEC SQL                                                 27490002
275000              SELECT MAX(CRE_TMST)                                27500002
275100                INTO :TRBDTL-CRE-TMST                             27510002
275200                FROM TTRBDTL                                      27520002
275300               WHERE NOTIF_NBR = :TRBDTL-NOTIF-NBR                27530002
275400         END-EXEC                                                 27540002
275500                                                                  27550002
275600         PERFORM 8001-WRITE-SQLCODE                               27560002
275700         EVALUATE TRUE                                            27570002
275800             WHEN SQLCODE = +0                                    27580002
275900                  CONTINUE                                        27590002
276000                                                                  27600002
276100             WHEN SQLCODE = -904                                  27610002
276200             WHEN SQLCODE = -911                                  27620002
276300             WHEN SQLCODE = -913                                  27630002
276400                  CONTINUE                                        27640002
276500                                                                  27650002
276600             WHEN OTHER                                           27660002
276700                  SET  PS-DONE TO TRUE                            27670002
276800                  MOVE SQLCA   TO TM500-SQLCA                     27680002
276900                  MOVE SQLCODE TO TM500-SQLCODE                   27690002
277000                  MOVE PRV-5W  TO TM500-RETURN-DATA               27700002
277100                                                                  27710002
277200                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          27720002
277300                  MOVE '2930'    TO PRV-PARA                      27730002
277400                  MOVE 'TTRBDTL' TO PRV-TBL                       27740002
277500                  PERFORM 9999-RETURN-MSG                         27750002
277600         END-EVALUATE                                             27760002
277700     END-PERFORM.                                                 27770002
277800                                                                  27780002
277900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         27790002
278000         SET  PS-DONE TO TRUE                                     27800002
278100         MOVE SQLCA   TO TM500-SQLCA                              27810002
278200         MOVE SQLCODE TO TM500-SQLCODE                            27820002
278300         MOVE PRV-5W  TO TM500-RETURN-DATA                        27830002
278400                                                                  27840002
278500         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   27850002
278600         MOVE '2930'    TO PRV-PARA                               27860002
278700         MOVE 'TTRBDTL' TO PRV-TBL                                27870002
278800         PERFORM 9999-RETURN-MSG                                  27880002
278900     END-IF.                                                      27890002
279000                                                                  27900002
279100                                                                  27910002
279200 2940-UPDATE-LAST-DTL-TMST.                                       27920002
279300******************************************************************27930002
279400*    THIS PARAGRAPH UPDATES TTRBNTF LAST-DTL-CRE-TMST.            27940002
279500******************************************************************27950002
279600                                                                  27960002
279700     MOVE '2940-UPDATE-LAST-DTL-TMST'  TO PV-CSSL-PARA            27970002
279800     PERFORM 8000-WRITE-CSSL                                      27980002
279900                                                                  27990002
280000     MOVE TM500-NOTIF-NBR TO TRBNTF-NOTIF-NBR.                    28000002
280100     MOVE TRBDTL-CRE-TMST TO TRBNTF-LAST-DTL-CRE-TMST.            28010002
280200                                                                  28020002
280300     PERFORM WITH TEST AFTER                                      28030002
280400         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    28040002
280500         UNTIL   SQLCODE = +0 OR                                  28050002
280600                 PS-DONE OR                                       28060002
280700                 PV-RETRY-COUNTER > PC-MAX-RETRIES                28070002
280800                                                                  28080002
280900         EXEC SQL                                                 28090002
281000              UPDATE TTRBNTF                                      28100002
281100                 SET LAST_DTL_CRE_TMST = :TRBNTF-LAST-DTL-CRE-TMST28110002
281200               WHERE NOTIF_NBR         = :TRBNTF-NOTIF-NBR        28120002
281300         END-EXEC                                                 28130002
281400                                                                  28140002
281500         PERFORM 8001-WRITE-SQLCODE                               28150002
281600         EVALUATE TRUE                                            28160002
281700             WHEN SQLCODE = +0                                    28170002
281800                  CONTINUE                                        28180002
281900                                                                  28190002
282000             WHEN SQLCODE = -904                                  28200002
282100             WHEN SQLCODE = -911                                  28210002
282200             WHEN SQLCODE = -913                                  28220002
282300                  CONTINUE                                        28230002
282400                                                                  28240002
282500             WHEN OTHER                                           28250002
282600                  SET  PS-DONE TO TRUE                            28260002
282700                  MOVE SQLCA   TO TM500-SQLCA                     28270002
282800                  MOVE SQLCODE TO TM500-SQLCODE                   28280002
282900                  MOVE PRV-5I  TO TM500-RETURN-DATA               28290002
283000                                                                  28300002
283100                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          28310002
283200                  MOVE '2940'    TO PRV-PARA                      28320002
283300                  MOVE 'TTRBNTF' TO PRV-TBL                       28330002
283400                  PERFORM 9999-RETURN-MSG                         28340002
283500         END-EVALUATE                                             28350002
283600     END-PERFORM.                                                 28360002
283700                                                                  28370002
283800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         28380002
283900         SET  PS-DONE TO TRUE                                     28390002
284000         MOVE SQLCA   TO TM500-SQLCA                              28400002
284100         MOVE SQLCODE TO TM500-SQLCODE                            28410002
284200         MOVE PRV-5I  TO TM500-RETURN-DATA                        28420002
284300                                                                  28430002
284400         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   28440002
284500         MOVE '2940'    TO PRV-PARA                               28450002
284600         MOVE 'TTRBNTF' TO PRV-TBL                                28460002
284700         PERFORM 9999-RETURN-MSG                                  28470002
284800     END-IF.                                                      28480002
284900                                                                  28490002
285000                                                                  28500002
285100 3000-UPDATE-PO-VER-NBR.                                          28510002
285200******************************************************************28520002
285300******************************************************************28530002
285400                                                                  28540002
285500     MOVE '3000-UPDATE-PO-VER-NBR'     TO PV-CSSL-PARA            28550002
285600     PERFORM 8000-WRITE-CSSL                                      28560002
285700                                                                  28570002
285800     IF TM500-RESOLVE-AUTO                                        28580002
285900      OR TM500-RESOLVE-SPECIFIC                                   28590002
286000      OR (TM500-RESOLVE-MANUAL AND                                28600002
286100          TM500-TRBL-RSN-CDE = 263)                               28610002
286200         EVALUATE TRUE                                            28620002
286300             WHEN TM500-PO-LEVEL                                  28630002
286400                  PERFORM 3100-SELECT-TPURCHS                     28640002
286500                                                                  28650002
286600                  IF PS-NOT-DONE                                  28660002
286700                      IF PS-DO-NOT-USE-OPER                       28670002
286800                          PERFORM 3210-UPDATE-TRECEIV-NO-OPER     28680006
286900                      ELSE                                        28690002
287000                          PERFORM 3200-UPDATE-TRECEIV             28700002
287100                      END-IF                                      28710002
287200                  END-IF                                          28720002
287300                                                                  28730002
287400             WHEN TM500-LINE-LEVEL                                28740002
287500                  PERFORM 3300-SELECT-TPURITM                     28750002
287600                                                                  28760002
287700                  IF PS-NOT-DONE                                  28770002
287800                      IF PS-DO-NOT-USE-OPER                       28780002
287900                          PERFORM 3410-UPDATE-TRECITM-NO-OPER     28790006
288000                      ELSE                                        28800002
288100                          PERFORM 3400-UPDATE-TRECITM             28810002
288200                      END-IF                                      28820002
288300                  END-IF                                          28830002
288400                                                                  28840002
288500             WHEN TM500-PACK-LEVEL                                28850002
288600                  PERFORM 3500-PROCESS-TPURITM                    28860002
288700                                                                  28870002
288800             WHEN OTHER                                           28880002
288900                  SET PS-DONE  TO TRUE                            28890002
289000                  MOVE SPACES  TO TM500-SQLCA                     28900002
289100                  MOVE ZEROES  TO TM500-SQLCODE                   28910002
289200                  MOVE PRV-5L  TO TM500-RETURN-DATA               28920002
289300         END-EVALUATE                                             28930002
289400     END-IF.                                                      28940002
289500                                                                  28950002
289600                                                                  28960002
289700 3100-SELECT-TPURCHS.                                             28970002
289800******************************************************************28980002
289900******************************************************************28990002
290000                                                                  29000002
290100     MOVE '3100-SELECT-TPURCHS'        TO PV-CSSL-PARA            29010002
290200     PERFORM 8000-WRITE-CSSL                                      29020002
290300                                                                  29030002
290400     PERFORM WITH TEST AFTER                                      29040002
290500         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    29050002
290600         UNTIL   SQLCODE = +0 OR                                  29060002
290700                 SQLCODE = +100 OR                                29070002
290800                 PS-DONE OR                                       29080002
290900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                29090002
291000                                                                  29100002
291100         EXEC SQL                                                 29110002
291200              SELECT VER_NBR                                      29120002
291300                INTO :PURCHS-VER-NBR                              29130002
291400                FROM TPURCHS                                      29140002
291500               WHERE PO_NBR         = :TM500-PO-NBR               29150002
291600                 AND VER_STATUS_CDE = :PC-A                       29160002
291700         END-EXEC                                                 29170002
291800                                                                  29180002
291900         PERFORM 8001-WRITE-SQLCODE                               29190002
292000         EVALUATE TRUE                                            29200002
292100             WHEN SQLCODE = +0                                    29210002
292200                  CONTINUE                                        29220002
292300                                                                  29230002
292400             WHEN SQLCODE = +100                                  29240002
292500                  MOVE ZEROES TO PURCHS-VER-NBR                   29250002
292600                                                                  29260002
292700             WHEN SQLCODE = -904                                  29270002
292800             WHEN SQLCODE = -911                                  29280002
292900             WHEN SQLCODE = -913                                  29290002
293000                  CONTINUE                                        29300002
293100                                                                  29310002
293200             WHEN OTHER                                           29320002
293300                  SET  PS-DONE TO TRUE                            29330002
293400                  MOVE SQLCA   TO TM500-SQLCA                     29340002
293500                  MOVE SQLCODE TO TM500-SQLCODE                   29350002
293600                  MOVE PRV-5E  TO TM500-RETURN-DATA               29360002
293700                                                                  29370002
293800                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          29380002
293900                  MOVE '3100'    TO PRV-PARA                      29390002
294000                  MOVE 'TPURCHS' TO PRV-TBL                       29400002
294100                  PERFORM 9999-RETURN-MSG                         29410002
294200         END-EVALUATE                                             29420002
294300     END-PERFORM.                                                 29430002
294400                                                                  29440002
294500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         29450002
294600         SET  PS-DONE TO TRUE                                     29460002
294700         MOVE SQLCA   TO TM500-SQLCA                              29470002
294800         MOVE SQLCODE TO TM500-SQLCODE                            29480002
294900         MOVE PRV-5E  TO TM500-RETURN-DATA                        29490002
295000                                                                  29500002
295100         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   29510002
295200         MOVE '3100'    TO PRV-PARA                               29520002
295300         MOVE 'TPURCHS' TO PRV-TBL                                29530002
295400         PERFORM 9999-RETURN-MSG                                  29540002
295500     END-IF.                                                      29550002
295600                                                                  29560002
295700                                                                  29570002
295800 3200-UPDATE-TRECEIV.                                             29580002
295900******************************************************************29590002
296000******************************************************************29600002
296100                                                                  29610002
296200     MOVE '3200-UPDATE-TRECEIV'        TO PV-CSSL-PARA            29620002
296300     PERFORM 8000-WRITE-CSSL                                      29630002
296400                                                                  29640002
296500     PERFORM WITH TEST AFTER                                      29650002
296600         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    29660002
296700         UNTIL   SQLCODE = +0 OR                                  29670002
296800                 PS-DONE OR                                       29680002
296900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                29690002
297000                                                                  29700002
297100         EXEC SQL                                                 29710002
297200              UPDATE TRECEIV                                      29720002
297300                 SET PO_VER_NBR     = :PURCHS-VER-NBR             29730002
297400               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          29740002
297500                 AND FCLTY_ID       = :TM500-FCLTY-ID             29750002
297600                 AND ORD_NBR        = :TM500-PO-NBR               29760002
297700                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          29770002
297800                 AND VER_STATUS_CDE = :PC-A                       29780002
297900         END-EXEC                                                 29790002
298000                                                                  29800002
298100         PERFORM 8001-WRITE-SQLCODE                               29810002
298200         EVALUATE TRUE                                            29820002
298300             WHEN SQLCODE = +0                                    29830002
298400                  CONTINUE                                        29840002
298500                                                                  29850002
298600             WHEN SQLCODE = -904                                  29860002
298700             WHEN SQLCODE = -911                                  29870002
298800             WHEN SQLCODE = -913                                  29880002
298900                  CONTINUE                                        29890002
299000                                                                  29900002
299100             WHEN OTHER                                           29910002
299200                  SET  PS-DONE TO TRUE                            29920002
299300                  MOVE SQLCA   TO TM500-SQLCA                     29930002
299400                  MOVE SQLCODE TO TM500-SQLCODE                   29940002
299500                  MOVE PRV-5H  TO TM500-RETURN-DATA               29950002
299600                                                                  29960002
299700                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          29970002
299800                  MOVE '3200'    TO PRV-PARA                      29980002
299900                  MOVE 'TRECEIV' TO PRV-TBL                       29990002
300000                  PERFORM 9999-RETURN-MSG                         30000002
300100         END-EVALUATE                                             30010002
300200     END-PERFORM.                                                 30020002
300300                                                                  30030002
300400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         30040002
300500         SET  PS-DONE TO TRUE                                     30050002
300600         MOVE SQLCA   TO TM500-SQLCA                              30060002
300700         MOVE SQLCODE TO TM500-SQLCODE                            30070002
300800         MOVE PRV-5H  TO TM500-RETURN-DATA                        30080002
300900                                                                  30090002
301000         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   30100002
301100         MOVE '3200'    TO PRV-PARA                               30110002
301200         MOVE 'TRECEIV' TO PRV-TBL                                30120002
301300         PERFORM 9999-RETURN-MSG                                  30130002
301400     END-IF.                                                      30140002
301500                                                                  30150002
301600 3210-UPDATE-TRECEIV-NO-OPER.                                     30160006
301700******************************************************************30170002
301800******************************************************************30180002
301900                                                                  30190002
302000     MOVE '3210-UPDATE-TRECEIV-NO-OPER'        TO PV-CSSL-PARA    30200006
302100     PERFORM 8000-WRITE-CSSL                                      30210002
302200                                                                  30220002
302300     PERFORM WITH TEST AFTER                                      30230002
302400         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    30240002
302500         UNTIL   SQLCODE = +0 OR                                  30250002
302600                 PS-DONE OR                                       30260002
302700                 PV-RETRY-COUNTER > PC-MAX-RETRIES                30270002
302800                                                                  30280002
302900         EXEC SQL                                                 30290002
303000              UPDATE TRECEIV                                      30300002
303100                 SET PO_VER_NBR     = :PURCHS-VER-NBR             30310002
303200               WHERE ORD_NBR        = :TM500-PO-NBR               30320002
303300                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          30330002
303400                 AND VER_STATUS_CDE = :PC-A                       30340002
303500         END-EXEC                                                 30350002
303600                                                                  30360002
303700         PERFORM 8001-WRITE-SQLCODE                               30370002
303800         EVALUATE TRUE                                            30380002
303900             WHEN SQLCODE = +0                                    30390002
304000                  CONTINUE                                        30400002
304100                                                                  30410002
304200             WHEN SQLCODE = -904                                  30420002
304300             WHEN SQLCODE = -911                                  30430002
304400             WHEN SQLCODE = -913                                  30440002
304500                  CONTINUE                                        30450002
304600                                                                  30460002
304700             WHEN OTHER                                           30470002
304800                  SET  PS-DONE TO TRUE                            30480002
304900                  MOVE SQLCA   TO TM500-SQLCA                     30490002
305000                  MOVE SQLCODE TO TM500-SQLCODE                   30500002
305100                  MOVE PRV-5H  TO TM500-RETURN-DATA               30510002
305200                                                                  30520002
305300                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          30530002
305400                  MOVE '3210'    TO PRV-PARA                      30540002
305500                  MOVE 'TRECEIV' TO PRV-TBL                       30550002
305600                  PERFORM 9999-RETURN-MSG                         30560002
305700         END-EVALUATE                                             30570002
305800     END-PERFORM.                                                 30580002
305900                                                                  30590002
306000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         30600002
306100         SET  PS-DONE TO TRUE                                     30610002
306200         MOVE SQLCA   TO TM500-SQLCA                              30620002
306300         MOVE SQLCODE TO TM500-SQLCODE                            30630002
306400         MOVE PRV-5H  TO TM500-RETURN-DATA                        30640002
306500                                                                  30650002
306600         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   30660002
306700         MOVE '3210'    TO PRV-PARA                               30670002
306800         MOVE 'TRECEIV' TO PRV-TBL                                30680002
306900         PERFORM 9999-RETURN-MSG                                  30690002
307000     END-IF.                                                      30700002
307100                                                                  30710002
307200                                                                  30720002
307300 3300-SELECT-TPURITM.                                             30730002
307400******************************************************************30740002
307500******************************************************************30750002
307600                                                                  30760002
307700     MOVE '3300-SELECT-TPURITM'        TO PV-CSSL-PARA            30770002
307800     PERFORM 8000-WRITE-CSSL                                      30780002
307900                                                                  30790002
308000     PERFORM WITH TEST AFTER                                      30800002
308100         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    30810002
308200         UNTIL   SQLCODE = +0 OR                                  30820002
308300                 SQLCODE = +100 OR                                30830002
308400                 PS-DONE OR                                       30840002
308500                 PV-RETRY-COUNTER > PC-MAX-RETRIES                30850002
308600                                                                  30860002
308700         EXEC SQL                                                 30870002
308800              SELECT VER_NBR                                      30880002
308900                INTO :PURITM-VER-NBR                              30890002
309000                FROM TPURITM                                      30900002
309100               WHERE PO_NBR         = :TM500-PO-NBR               30910002
309200                 AND APP_PO_LNE_NBR = :TM500-PO-LNE-NBR           30920002
309300                 AND VER_STATUS_CDE = :PC-A                       30930002
309400         END-EXEC                                                 30940002
309500                                                                  30950002
309600         PERFORM 8001-WRITE-SQLCODE                               30960002
309700         EVALUATE TRUE                                            30970002
309800             WHEN SQLCODE = +0                                    30980002
309900                  CONTINUE                                        30990002
310000                                                                  31000002
310100             WHEN SQLCODE = +100                                  31010002
310200                  MOVE ZEROES TO PURITM-VER-NBR                   31020002
310300                                                                  31030002
310400             WHEN SQLCODE = -904                                  31040002
310500             WHEN SQLCODE = -911                                  31050002
310600             WHEN SQLCODE = -913                                  31060002
310700                  CONTINUE                                        31070002
310800                                                                  31080002
310900             WHEN OTHER                                           31090002
311000                  SET  PS-DONE TO TRUE                            31100002
311100                  MOVE SQLCA   TO TM500-SQLCA                     31110002
311200                  MOVE SQLCODE TO TM500-SQLCODE                   31120002
311300                  MOVE PRV-5M  TO TM500-RETURN-DATA               31130002
311400                                                                  31140002
311500                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          31150002
311600                  MOVE '3300'    TO PRV-PARA                      31160002
311700                  MOVE 'TPURITM' TO PRV-TBL                       31170002
311800                  PERFORM 9999-RETURN-MSG                         31180002
311900         END-EVALUATE                                             31190002
312000     END-PERFORM.                                                 31200002
312100                                                                  31210002
312200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         31220002
312300         SET  PS-DONE TO TRUE                                     31230002
312400         MOVE SQLCA   TO TM500-SQLCA                              31240002
312500         MOVE SQLCODE TO TM500-SQLCODE                            31250002
312600         MOVE PRV-5M  TO TM500-RETURN-DATA                        31260002
312700                                                                  31270002
312800         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   31280002
312900         MOVE '3300'    TO PRV-PARA                               31290002
313000         MOVE 'TPURITM' TO PRV-TBL                                31300002
313100         PERFORM 9999-RETURN-MSG                                  31310002
313200     END-IF.                                                      31320002
313300                                                                  31330002
313400                                                                  31340002
313500 3400-UPDATE-TRECITM.                                             31350002
313600******************************************************************31360002
313700******************************************************************31370002
313800                                                                  31380002
313900     MOVE '3400-UPDATE-TRECITM'        TO PV-CSSL-PARA            31390002
314000     PERFORM 8000-WRITE-CSSL                                      31400002
314100                                                                  31410002
314200     PERFORM WITH TEST AFTER                                      31420002
314300         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    31430002
314400         UNTIL   SQLCODE = +0 OR                                  31440002
314500                 PS-DONE OR                                       31450002
314600                 PV-RETRY-COUNTER > PC-MAX-RETRIES                31460002
314700                                                                  31470002
314800         EXEC SQL                                                 31480002
314900              UPDATE TRECITM                                      31490002
315000                 SET PO_VER_NBR     = :PURITM-VER-NBR             31500002
315100               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          31510002
315200                 AND FCLTY_ID       = :TM500-FCLTY-ID             31520002
315300                 AND ORD_NBR        = :TM500-PO-NBR               31530002
315400                 AND ORD_LNE_NBR    = :TM500-PO-LNE-NBR           31540002
315500                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          31550002
315600                 AND VER_STATUS_CDE = :PC-A                       31560002
315700         END-EXEC                                                 31570002
315800                                                                  31580002
315900         PERFORM 8001-WRITE-SQLCODE                               31590002
316000         EVALUATE TRUE                                            31600002
316100             WHEN SQLCODE = +0                                    31610002
316200                  CONTINUE                                        31620002
316300                                                                  31630002
316400             WHEN SQLCODE = -904                                  31640002
316500             WHEN SQLCODE = -911                                  31650002
316600             WHEN SQLCODE = -913                                  31660002
316700                  CONTINUE                                        31670002
316800                                                                  31680002
316900             WHEN OTHER                                           31690002
317000                  SET  PS-DONE TO TRUE                            31700002
317100                  MOVE SQLCA   TO TM500-SQLCA                     31710002
317200                  MOVE SQLCODE TO TM500-SQLCODE                   31720002
317300                  MOVE PRV-5N  TO TM500-RETURN-DATA               31730002
317400                                                                  31740002
317500                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          31750002
317600                  MOVE '3400'    TO PRV-PARA                      31760002
317700                  MOVE 'TRECITM' TO PRV-TBL                       31770002
317800                  PERFORM 9999-RETURN-MSG                         31780002
317900         END-EVALUATE                                             31790002
318000     END-PERFORM.                                                 31800002
318100                                                                  31810002
318200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         31820002
318300         SET  PS-DONE TO TRUE                                     31830002
318400         MOVE SQLCA   TO TM500-SQLCA                              31840002
318500         MOVE SQLCODE TO TM500-SQLCODE                            31850002
318600         MOVE PRV-5N  TO TM500-RETURN-DATA                        31860002
318700                                                                  31870002
318800         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   31880002
318900         MOVE '3400'    TO PRV-PARA                               31890002
319000         MOVE 'TRECITM' TO PRV-TBL                                31900002
319100         PERFORM 9999-RETURN-MSG                                  31910002
319200     END-IF.                                                      31920002
319300                                                                  31930002
319400 3410-UPDATE-TRECITM-NO-OPER.                                     31940006
319500******************************************************************31950002
319600******************************************************************31960002
319700                                                                  31970002
319800     MOVE '3410-UPDATE-TRECITM-NO-OPER'  TO PV-CSSL-PARA          31980006
319900     PERFORM 8000-WRITE-CSSL                                      31990002
320000                                                                  32000002
320100     PERFORM WITH TEST AFTER                                      32010002
320200         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    32020002
320300         UNTIL   SQLCODE = +0 OR                                  32030002
320400                 PS-DONE OR                                       32040002
320500                 PV-RETRY-COUNTER > PC-MAX-RETRIES                32050002
320600                                                                  32060002
320700         EXEC SQL                                                 32070002
320800              UPDATE TRECITM                                      32080002
320900                 SET PO_VER_NBR     = :PURITM-VER-NBR             32090002
321000               WHERE ORD_NBR        = :TM500-PO-NBR               32100002
321100                 AND ORD_LNE_NBR    = :TM500-PO-LNE-NBR           32110002
321200                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          32120002
321300                 AND VER_STATUS_CDE = :PC-A                       32130002
321400         END-EXEC                                                 32140002
321500                                                                  32150002
321600         PERFORM 8001-WRITE-SQLCODE                               32160002
321700         EVALUATE TRUE                                            32170002
321800             WHEN SQLCODE = +0                                    32180002
321900                  CONTINUE                                        32190002
322000                                                                  32200002
322100             WHEN SQLCODE = -904                                  32210002
322200             WHEN SQLCODE = -911                                  32220002
322300             WHEN SQLCODE = -913                                  32230002
322400                  CONTINUE                                        32240002
322500                                                                  32250002
322600             WHEN OTHER                                           32260002
322700                  SET  PS-DONE TO TRUE                            32270002
322800                  MOVE SQLCA   TO TM500-SQLCA                     32280002
322900                  MOVE SQLCODE TO TM500-SQLCODE                   32290002
323000                  MOVE PRV-5N  TO TM500-RETURN-DATA               32300002
323100                                                                  32310002
323200                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          32320002
323300                  MOVE '3410'    TO PRV-PARA                      32330002
323400                  MOVE 'TRECITM' TO PRV-TBL                       32340002
323500                  PERFORM 9999-RETURN-MSG                         32350002
323600         END-EVALUATE                                             32360002
323700     END-PERFORM.                                                 32370002
323800                                                                  32380002
323900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         32390002
324000         SET  PS-DONE TO TRUE                                     32400002
324100         MOVE SQLCA   TO TM500-SQLCA                              32410002
324200         MOVE SQLCODE TO TM500-SQLCODE                            32420002
324300         MOVE PRV-5N  TO TM500-RETURN-DATA                        32430002
324400                                                                  32440002
324500         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   32450002
324600         MOVE '3410'    TO PRV-PARA                               32460004
324700         MOVE 'TRECITM' TO PRV-TBL                                32470002
324800         PERFORM 9999-RETURN-MSG                                  32480002
324900     END-IF.                                                      32490002
325000                                                                  32500002
325100*JPL                                                              32510002
325200 3500-PROCESS-TPURITM.                                            32520002
325300                                                                  32530002
325400     MOVE '3500-PROCESS-TPURITM'       TO PV-CSSL-PARA            32540002
325500     PERFORM 8000-WRITE-CSSL                                      32550002
325600                                                                  32560002
325700     SET PS-PACK-LVL-UPD-NOT-DONE TO TRUE                         32570002
325800     IF PS-DO-NOT-USE-OPER                                        32580002
325900         PERFORM 3515-OPEN-RECITM-CSR-NO-OPER                     32590006
326000                                                                  32600002
326100         PERFORM 3523-FETCH-RECITM-CSR-NO-OPER                    32610006
326200           UNTIL PS-PACK-LVL-UPD-DONE                             32620002
326300                                                                  32630002
326400         PERFORM 3535-CLOSE-RECITM-CSR-NO-OPER                    32640006
326500     ELSE                                                         32650002
326600         PERFORM 3510-OPEN-RECITM-CSR                             32660002
326700                                                                  32670002
326800         PERFORM 3520-FETCH-RECITM-CSR                            32680002
326900           UNTIL PS-PACK-LVL-UPD-DONE                             32690002
327000                                                                  32700002
327100         PERFORM 3530-CLOSE-RECITM-CSR                            32710002
327200     END-IF.                                                      32720002
327300                                                                  32730002
327400                                                                  32740002
327500******************************************************************32750002
327600*  THIS PARAGRAPH OPENS THE CURSOR FOR TABLE RECITM.              32760002
327700******************************************************************32770002
327800 3510-OPEN-RECITM-CSR.                                            32780002
327900                                                                  32790002
328000     MOVE '3510-OPEN-RECITM-CSR'       TO PV-CSSL-PARA            32800002
328100     PERFORM 8000-WRITE-CSSL                                      32810002
328200                                                                  32820002
328300     EXEC SQL                                                     32830002
328400         OPEN RECITM-LINE-CSR                                     32840002
328500     END-EXEC.                                                    32850002
328600                                                                  32860002
328700         PERFORM 8001-WRITE-SQLCODE                               32870002
328800     IF SQLCODE NOT = +0                                          32880002
328900         SET PS-PACK-LVL-UPD-DONE TO TRUE                         32890002
329000         SET PS-DONE              TO TRUE                         32900002
329100         MOVE SQLCA               TO TM500-SQLCA                  32910002
329200         MOVE SQLCODE             TO TM500-SQLCODE                32920002
329300         MOVE PRV-70              TO TM500-RETURN-DATA            32930002
329400     END-IF.                                                      32940002
329500                                                                  32950002
329600 3515-OPEN-RECITM-CSR-NO-OPER.                                    32960006
329700                                                                  32970002
329800     MOVE '3515-OPEN-RECITM-CSR-NO-OPER'       TO PV-CSSL-PARA    32980006
329900     PERFORM 8000-WRITE-CSSL                                      32990002
330000                                                                  33000002
330100     EXEC SQL                                                     33010002
330200         OPEN RECITM-LN-NOOP-CSR                                  33020007
330300     END-EXEC.                                                    33030002
330400                                                                  33040002
330500         PERFORM 8001-WRITE-SQLCODE                               33050002
330600     IF SQLCODE NOT = +0                                          33060002
330700         SET PS-PACK-LVL-UPD-DONE TO TRUE                         33070002
330800         SET PS-DONE              TO TRUE                         33080002
330900         MOVE SQLCA               TO TM500-SQLCA                  33090002
331000         MOVE SQLCODE             TO TM500-SQLCODE                33100002
331100         MOVE PRV-70              TO TM500-RETURN-DATA            33110002
331200     END-IF.                                                      33120002
331300                                                                  33130002
331400******************************************************************33140002
331500*  THIS PARAGRAPH GETS THE NEXT RECORD FROM TABLE RECITM.         33150002
331600******************************************************************33160002
331700 3520-FETCH-RECITM-CSR.                                           33170002
331800                                                                  33180002
331900     MOVE '3520-FETCH-RECITM-CSR'      TO PV-CSSL-PARA            33190002
332000     PERFORM 8000-WRITE-CSSL                                      33200002
332100                                                                  33210002
332200     EXEC SQL                                                     33220002
332300         FETCH RECITM-LINE-CSR                                    33230002
332400          INTO :RECITM-ORD-LNE-NBR                                33240002
332500             , :PURITM-VER-NBR                                    33250002
332600     END-EXEC.                                                    33260002
332700                                                                  33270002
332800         PERFORM 8001-WRITE-SQLCODE                               33280002
332900     EVALUATE TRUE                                                33290002
333000       WHEN SQLCODE = +0                                          33300002
333100           PERFORM 3525-UPDATE-RECITM-CSR                         33310002
333200                                                                  33320002
333300       WHEN SQLCODE = +100                                        33330002
333400           SET PS-PACK-LVL-UPD-DONE TO TRUE                       33340002
333500                                                                  33350002
333600       WHEN OTHER                                                 33360002
333700           SET PS-PACK-LVL-UPD-DONE TO TRUE                       33370002
333800           SET PS-DONE              TO TRUE                       33380002
333900           MOVE SQLCA               TO TM500-SQLCA                33390002
334000           MOVE SQLCODE             TO TM500-SQLCODE              33400002
334100           MOVE PRV-71              TO TM500-RETURN-DATA          33410002
334200     END-EVALUATE.                                                33420002
334300                                                                  33430002
334400 3523-FETCH-RECITM-CSR-NO-OPER.                                   33440006
334500                                                                  33450002
334600     MOVE '3523-FETCH-RECITM-CSR-NO-OPER'   TO PV-CSSL-PARA       33460006
334700     PERFORM 8000-WRITE-CSSL                                      33470002
334800                                                                  33480002
334900     EXEC SQL                                                     33490002
335000         FETCH RECITM-LN-NOOP-CSR                                 33500007
335100          INTO :RECITM-ORD-LNE-NBR                                33510002
335200             , :PURITM-VER-NBR                                    33520002
335300     END-EXEC.                                                    33530002
335400                                                                  33540002
335500         PERFORM 8001-WRITE-SQLCODE                               33550002
335600     EVALUATE TRUE                                                33560002
335700       WHEN SQLCODE = +0                                          33570002
335800           PERFORM 3528-UPDATE-RECITM-CSR-NO-OPER                 33580006
335900                                                                  33590002
336000       WHEN SQLCODE = +100                                        33600002
336100           SET PS-PACK-LVL-UPD-DONE TO TRUE                       33610002
336200                                                                  33620002
336300       WHEN OTHER                                                 33630002
336400           SET PS-PACK-LVL-UPD-DONE TO TRUE                       33640002
336500           SET PS-DONE              TO TRUE                       33650002
336600           MOVE SQLCA               TO TM500-SQLCA                33660002
336700           MOVE SQLCODE             TO TM500-SQLCODE              33670002
336800           MOVE PRV-71              TO TM500-RETURN-DATA          33680002
336900     END-EVALUATE.                                                33690002
337000                                                                  33700002
337100******************************************************************33710002
337200*  THIS PARAGRAPH UPDATES THE RECITM RECORD.                      33720002
337300******************************************************************33730002
337400 3525-UPDATE-RECITM-CSR.                                          33740002
337500                                                                  33750002
337600     MOVE '3525-UPDATE-RECITM-CSR'     TO PV-CSSL-PARA            33760002
337700     PERFORM 8000-WRITE-CSSL                                      33770002
337800                                                                  33780002
337900     PERFORM WITH TEST AFTER                                      33790002
338000       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       33800002
338100         UNTIL SQLCODE = +0                                       33810002
338200            OR PS-DONE                                            33820002
338300            OR PV-RETRY-COUNTER > PC-MAX-RETRIES                  33830002
338400                                                                  33840002
338500         EXEC SQL                                                 33850002
338600           UPDATE TRECITM                                         33860002
338700              SET PO_VER_NBR      = :PURITM-VER-NBR               33870002
338800            WHERE ORD_NBR         = :TM500-PO-NBR                 33880002
338900              AND ORD_LNE_NBR     = :RECITM-ORD-LNE-NBR           33890002
339000              AND REC_SEQ_NBR     = :TM500-REC-SEQ-NBR            33900002
339100              AND OPER_UNT_ID     = :TM500-OPER-UNT-ID            33910002
339200              AND FCLTY_ID        = :TM500-FCLTY-ID               33920002
339300              AND VER_STATUS_CDE  = :PC-A                         33930002
339400         END-EXEC                                                 33940002
339500                                                                  33950002
339600         PERFORM 8001-WRITE-SQLCODE                               33960002
339700         EVALUATE TRUE                                            33970002
339800           WHEN SQLCODE = +0                                      33980002
339900               CONTINUE                                           33990002
340000                                                                  34000002
340100           WHEN SQLCODE = -904                                    34010002
340200           WHEN SQLCODE = -911                                    34020002
340300           WHEN SQLCODE = -913                                    34030002
340400               CONTINUE                                           34040002
340500                                                                  34050002
340600           WHEN OTHER                                             34060002
340700               SET PS-PACK-LVL-UPD-DONE TO TRUE                   34070002
340800               SET PS-DONE              TO TRUE                   34080002
340900               MOVE SQLCA               TO TM500-SQLCA            34090002
341000               MOVE SQLCODE             TO TM500-SQLCODE          34100002
341100               MOVE PRV-73              TO TM500-RETURN-DATA      34110002
341200         END-EVALUATE                                             34120002
341300     END-PERFORM.                                                 34130002
341400                                                                  34140002
341500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         34150002
341600         SET  PS-DONE TO TRUE                                     34160002
341700         MOVE SQLCA   TO TM500-SQLCA                              34170002
341800         MOVE SQLCODE TO TM500-SQLCODE                            34180002
341900         MOVE PRV-73  TO TM500-RETURN-DATA                        34190002
342000     END-IF.                                                      34200002
342100                                                                  34210002
342200 3528-UPDATE-RECITM-CSR-NO-OPER.                                  34220006
342300                                                                  34230002
342400     MOVE '3528-UPDATE-RECITM-CSR-NO-OPER'  TO PV-CSSL-PARA       34240006
342500     PERFORM 8000-WRITE-CSSL                                      34250002
342600                                                                  34260002
342700     PERFORM WITH TEST AFTER                                      34270002
342800       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       34280002
342900         UNTIL SQLCODE = +0                                       34290002
343000            OR PS-DONE                                            34300002
343100            OR PV-RETRY-COUNTER > PC-MAX-RETRIES                  34310002
343200                                                                  34320002
343300         EXEC SQL                                                 34330002
343400           UPDATE TRECITM                                         34340002
343500              SET PO_VER_NBR      = :PURITM-VER-NBR               34350002
343600            WHERE ORD_NBR         = :TM500-PO-NBR                 34360002
343700              AND ORD_LNE_NBR     = :RECITM-ORD-LNE-NBR           34370002
343800              AND REC_SEQ_NBR     = :TM500-REC-SEQ-NBR            34380002
343900              AND VER_STATUS_CDE  = :PC-A                         34390002
344000         END-EXEC                                                 34400002
344100                                                                  34410002
344200         PERFORM 8001-WRITE-SQLCODE                               34420002
344300         EVALUATE TRUE                                            34430002
344400           WHEN SQLCODE = +0                                      34440002
344500               CONTINUE                                           34450002
344600                                                                  34460002
344700           WHEN SQLCODE = -904                                    34470002
344800           WHEN SQLCODE = -911                                    34480002
344900           WHEN SQLCODE = -913                                    34490002
345000               CONTINUE                                           34500002
345100                                                                  34510002
345200           WHEN OTHER                                             34520002
345300               SET PS-PACK-LVL-UPD-DONE TO TRUE                   34530002
345400               SET PS-DONE              TO TRUE                   34540002
345500               MOVE SQLCA               TO TM500-SQLCA            34550002
345600               MOVE SQLCODE             TO TM500-SQLCODE          34560002
345700               MOVE PRV-73              TO TM500-RETURN-DATA      34570002
345800         END-EVALUATE                                             34580002
345900     END-PERFORM.                                                 34590002
346000                                                                  34600002
346100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         34610002
346200         SET  PS-DONE TO TRUE                                     34620002
346300         MOVE SQLCA   TO TM500-SQLCA                              34630002
346400         MOVE SQLCODE TO TM500-SQLCODE                            34640002
346500         MOVE PRV-73  TO TM500-RETURN-DATA                        34650002
346600     END-IF.                                                      34660002
346700                                                                  34670002
346800******************************************************************34680002
346900*  THIS PARAGRAPH CLOSES THE CURSOR FOR TABLE RECITM.             34690002
347000******************************************************************34700002
347100 3530-CLOSE-RECITM-CSR.                                           34710002
347200                                                                  34720002
347300     MOVE '3530-CLOSE-RECITM-CSR'      TO PV-CSSL-PARA            34730002
347400     PERFORM 8000-WRITE-CSSL                                      34740002
347500                                                                  34750002
347600     EXEC SQL                                                     34760002
347700         CLOSE RECITM-LINE-CSR                                    34770002
347800     END-EXEC.                                                    34780002
347900                                                                  34790002
348000         PERFORM 8001-WRITE-SQLCODE                               34800002
348100     IF SQLCODE = +100                                            34810002
348200         CONTINUE                                                 34820002
348300     ELSE                                                         34830002
348400         IF SQLCODE NOT = +0                                      34840002
348500             SET  PS-DONE TO TRUE                                 34850002
348600             MOVE SQLCA   TO TM500-SQLCA                          34860002
348700             MOVE SQLCODE TO TM500-SQLCODE                        34870002
348800             MOVE PRV-72  TO TM500-RETURN-DATA                    34880002
348900         END-IF                                                   34890002
349000     END-IF.                                                      34900002
349100                                                                  34910002
349200 3535-CLOSE-RECITM-CSR-NO-OPER.                                   34920006
349300                                                                  34930002
349400     MOVE '3535-CLOSE-RECITM-CSR-NO-OPER'      TO PV-CSSL-PARA    34940006
349500     PERFORM 8000-WRITE-CSSL                                      34950002
349600                                                                  34960002
349700     EXEC SQL                                                     34970002
349800         CLOSE RECITM-LN-NOOP-CSR                                 34980007
349900     END-EXEC.                                                    34990002
350000                                                                  35000002
350100         PERFORM 8001-WRITE-SQLCODE                               35010002
350200     IF SQLCODE = +100                                            35020002
350300         CONTINUE                                                 35030002
350400     ELSE                                                         35040002
350500         IF SQLCODE NOT = +0                                      35050002
350600             SET  PS-DONE TO TRUE                                 35060002
350700             MOVE SQLCA   TO TM500-SQLCA                          35070002
350800             MOVE SQLCODE TO TM500-SQLCODE                        35080002
350900             MOVE PRV-72  TO TM500-RETURN-DATA                    35090002
351000         END-IF                                                   35100002
351100     END-IF.                                                      35110002
351200                                                                  35120002
351300                                                                  35130002
351400 4000-SELECT-NOTIF-IND.                                           35140002
351500******************************************************************35150002
351600******************************************************************35160002
351700                                                                  35170002
351800     MOVE '4000-SELECT-NOTIF-IND'      TO PV-CSSL-PARA            35180002
351900     PERFORM 8000-WRITE-CSSL                                      35190002
352000                                                                  35200002
352100     PERFORM WITH TEST AFTER                                      35210002
352200         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    35220002
352300         UNTIL   SQLCODE = +0 OR                                  35230002
352400                 PS-DONE OR                                       35240002
352500                 PV-RETRY-COUNTER > PC-MAX-RETRIES                35250002
352600                                                                  35260002
352700         EXEC SQL                                                 35270002
352800              SELECT NOTIF_IND                                    35280002
352900                INTO :TRBRSN-NOTIF-IND                            35290002
353000                FROM TTRBRSN                                      35300002
353100               WHERE TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE           35310002
353200         END-EXEC                                                 35320002
353300                                                                  35330002
353400         PERFORM 8001-WRITE-SQLCODE                               35340002
353500         EVALUATE TRUE                                            35350002
353600             WHEN SQLCODE = +0                                    35360002
353700                  CONTINUE                                        35370002
353800                                                                  35380002
353900             WHEN SQLCODE = -904                                  35390002
354000             WHEN SQLCODE = -911                                  35400002
354100             WHEN SQLCODE = -913                                  35410002
354200                  CONTINUE                                        35420002
354300                                                                  35430002
354400             WHEN OTHER                                           35440002
354500                  SET  PS-DONE TO TRUE                            35450002
354600                  MOVE SQLCA   TO TM500-SQLCA                     35460002
354700                  MOVE SQLCODE TO TM500-SQLCODE                   35470002
354800                  MOVE PRV-5K  TO TM500-RETURN-DATA               35480002
354900                                                                  35490002
355000                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          35500002
355100                  MOVE '4000'    TO PRV-PARA                      35510002
355200                  MOVE 'TTRBRSN' TO PRV-TBL                       35520002
355300                  PERFORM 9999-RETURN-MSG                         35530002
355400         END-EVALUATE                                             35540002
355500     END-PERFORM.                                                 35550002
355600                                                                  35560002
355700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         35570002
355800         SET PS-DONE  TO TRUE                                     35580002
355900         MOVE SQLCA   TO TM500-SQLCA                              35590002
356000         MOVE SQLCODE TO TM500-SQLCODE                            35600002
356100         MOVE PRV-5K  TO TM500-RETURN-DATA                        35610002
356200                                                                  35620002
356300         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   35630002
356400         MOVE '4000'    TO PRV-PARA                               35640002
356500         MOVE 'TTRBRSN' TO PRV-TBL                                35650002
356600         PERFORM 9999-RETURN-MSG                                  35660002
356700     END-IF.                                                      35670002
356800                                                                  35680002
356900                                                                  35690002
357000 6000-GET-FCLTY-AREA-ID.                                          35700002
357100******************************************************************35710002
357200******************************************************************35720002
357300                                                                  35730002
357400     MOVE '6000-GET-FCLTY-AREA-ID'     TO PV-CSSL-PARA            35740002
357500     PERFORM 8000-WRITE-CSSL                                      35750002
357600                                                                  35760002
357700     COMPUTE PV-PO-LNE-NBR = TM500-PO-LNE-NBR * 1.                35770002
357800                                                                  35780002
357900     PERFORM 6550-OPEN-TWKORIN.                                   35790002
358000                                                                  35800002
358100     IF PS-NOT-DONE                                               35810002
358200         PERFORM 6600-FETCH-TWKORIN-LOOP                          35820002
358300     END-IF.                                                      35830002
358400                                                                  35840002
358500                                                                  35850002
358600 6550-OPEN-TWKORIN.                                               35860002
358700******************************************************************35870002
358800******************************************************************35880002
358900                                                                  35890002
359000     MOVE '6550-OPEN-TWKORIN'          TO PV-CSSL-PARA            35900002
359100     PERFORM 8000-WRITE-CSSL                                      35910002
359200                                                                  35920002
359300     EXEC SQL                                                     35930002
359400         OPEN TWKORIN-CSR                                         35940002
359500     END-EXEC.                                                    35950002
359600                                                                  35960002
359700         PERFORM 8001-WRITE-SQLCODE                               35970002
359800     EVALUATE TRUE                                                35980002
359900         WHEN SQLWARN0 NOT = SPACES                               35990002
360000         WHEN SQLCODE < ZERO                                      36000002
360100         WHEN SQLCODE > ZERO                                      36010002
360200              SET PS-DONE  TO TRUE                                36020002
360300              MOVE SQLCA   TO TM500-SQLCA                         36030002
360400              MOVE SQLCODE TO TM500-SQLCODE                       36040002
360500              MOVE PRV-5P  TO TM500-RETURN-DATA                   36050002
360600                                                                  36060002
360700              MOVE SPACES    TO PRV-TM500-RETURN-MSG              36070002
360800              MOVE '6550'    TO PRV-PARA                          36080002
360900              MOVE 'TWKORIN' TO PRV-TBL                           36090002
361000              PERFORM 9999-RETURN-MSG                             36100002
361100         WHEN SQLCODE = ZEROS                                     36110002
361200              CONTINUE                                            36120002
361300     END-EVALUATE.                                                36130002
361400                                                                  36140002
361500                                                                  36150002
361600 6575-CLOSE-TWKORIN.                                              36160002
361700******************************************************************36170002
361800******************************************************************36180002
361900                                                                  36190002
362000     MOVE '6575-CLOSE-TWKORIN'         TO PV-CSSL-PARA            36200002
362100     PERFORM 8000-WRITE-CSSL                                      36210002
362200                                                                  36220002
362300     EXEC SQL                                                     36230002
362400         CLOSE TWKORIN-CSR                                        36240002
362500     END-EXEC.                                                    36250002
362600                                                                  36260002
362700         PERFORM 8001-WRITE-SQLCODE                               36270002
362800     EVALUATE TRUE                                                36280002
362900         WHEN SQLWARN0 NOT = SPACES                               36290002
363000         WHEN SQLCODE < ZERO                                      36300002
363100         WHEN SQLCODE > ZERO                                      36310002
363200              SET PS-DONE  TO TRUE                                36320002
363300              MOVE SQLCA   TO TM500-SQLCA                         36330002
363400              MOVE SQLCODE TO TM500-SQLCODE                       36340002
363500              MOVE PRV-5R  TO TM500-RETURN-DATA                   36350002
363600                                                                  36360002
363700              MOVE SPACES    TO PRV-TM500-RETURN-MSG              36370002
363800              MOVE '6575'    TO PRV-PARA                          36380002
363900              MOVE 'TWKORIN' TO PRV-TBL                           36390002
364000              PERFORM 9999-RETURN-MSG                             36400002
364100         WHEN SQLCODE = ZEROS                                     36410002
364200              CONTINUE                                            36420002
364300     END-EVALUATE.                                                36430002
364400                                                                  36440002
364500                                                                  36450002
364600 6600-FETCH-TWKORIN-LOOP.                                         36460002
364700******************************************************************36470002
364800******************************************************************36480002
364900                                                                  36490002
365000     MOVE '6600-FETCH-TWKORIN-LOOP'    TO PV-CSSL-PARA            36500002
365100     PERFORM 8000-WRITE-CSSL                                      36510002
365200                                                                  36520002
365300     MOVE 'N' TO PS-TWKORIN-CURSOR-SW.                            36530002
365400     MOVE 'N' TO PS-TWKORIN-ZERO-SW.                              36540002
365500                                                                  36550002
365600     PERFORM 6650-FETCH-TWKORIN.                                  36560002
365700                                                                  36570002
365800     IF PS-NOT-DONE                                               36580002
365900         IF PS-EOF-TWKORIN-CSR                                    36590002
366000         OR WKORIN-STRT-TMST = PC-DEFAULT-TMST                    36600002
366100             PERFORM 6575-CLOSE-TWKORIN                           36610002
366200                                                                  36620002
366300             IF PS-NOT-DONE                                       36630002
366400                 PERFORM 6800-OPEN-WKORIN0-CURSOR                 36640002
366500             END-IF                                               36650002
366600                                                                  36660002
366700             IF PS-NOT-DONE                                       36670002
366800                 PERFORM 6850-FETCH-TWKORIN-ZERO                  36680002
366900             END-IF                                               36690002
367000                                                                  36700002
367100             IF PS-NOT-DONE                                       36710002
367200                 IF WKORIN-STRT-TMST = PC-DEFAULT-TMST            36720002
367300                     MOVE WKORIN-PRC-FCLTY-AREA-ID                36730002
367400                       TO PV-PRC-FCLTY-AREA-ID                    36740002
367500                     MOVE 'N' TO PS-TWKORIN-ZERO-SW               36750002
367600                     PERFORM 6805-CLOSE-WKORIN0                   36760002
367700                 ELSE                                             36770002
367800                     MOVE WKORIN-PRC-FCLTY-AREA-ID                36780002
367900                       TO PV-PRC-FCLTY-AREA-ID                    36790002
368000                     PERFORM 6850-FETCH-TWKORIN-ZERO              36800002
368100                       UNTIL PS-EOF-TWKORIN-ZERO                  36810002
368200                          OR PS-DONE                              36820002
368300                                                                  36830002
368400                     IF PS-NOT-DONE                               36840002
368500                         PERFORM 6805-CLOSE-WKORIN0               36850002
368600                     END-IF                                       36860002
368700                 END-IF                                           36870002
368800             END-IF                                               36880002
368900         ELSE                                                     36890002
369000             MOVE WKORIN-PRC-FCLTY-AREA-ID                        36900002
369100               TO PV-PRC-FCLTY-AREA-ID                            36910002
369200             PERFORM 6650-FETCH-TWKORIN                           36920002
369300               UNTIL PS-EOF-TWKORIN-CSR                           36930002
369400                  OR PS-DONE                                      36940002
369500                                                                  36950002
369600             IF PS-NOT-DONE                                       36960002
369700                 PERFORM 6575-CLOSE-TWKORIN                       36970002
369800             END-IF                                               36980002
369900         END-IF                                                   36990002
370000     END-IF.                                                      37000002
370100                                                                  37010002
370200                                                                  37020002
370300 6650-FETCH-TWKORIN.                                              37030002
370400******************************************************************37040002
370500******************************************************************37050002
370600                                                                  37060002
370700     MOVE '6650-FETCH-TWKORIN'         TO PV-CSSL-PARA            37070002
370800     PERFORM 8000-WRITE-CSSL                                      37080002
370900                                                                  37090002
371000     EXEC SQL                                                     37100002
371100          FETCH TWKORIN-CSR                                       37110002
371200           INTO :WKORIN-STRT-TMST                                 37120002
371300              , :WKORIN-STOP-TMST                                 37130002
371400              , :WKORIN-PRC-FCLTY-AREA-ID                         37140002
371500              , :WKORIN-SCREEN-SEQ-NBR                            37150002
371600     END-EXEC.                                                    37160002
371700                                                                  37170002
371800         PERFORM 8001-WRITE-SQLCODE                               37180002
371900     EVALUATE TRUE                                                37190002
372000         WHEN SQLCODE = +0                                        37200002
372100              PERFORM 6675-CHECK-DATES                            37210002
372200         WHEN SQLCODE = +100                                      37220002
372300              SET PS-EOF-TWKORIN-CSR TO TRUE                      37230002
372400         WHEN SQLWARN0 NOT = SPACES                               37240002
372500         WHEN SQLCODE < ZERO                                      37250002
372600         WHEN SQLCODE > ZERO                                      37260002
372700              SET PS-DONE  TO TRUE                                37270002
372800              MOVE SQLCA   TO TM500-SQLCA                         37280002
372900              MOVE SQLCODE TO TM500-SQLCODE                       37290002
373000              MOVE PRV-5Q  TO TM500-RETURN-DATA                   37300002
373100                                                                  37310002
373200              MOVE SPACES    TO PRV-TM500-RETURN-MSG              37320002
373300              MOVE '6650'    TO PRV-PARA                          37330002
373400              MOVE 'TWKORIN' TO PRV-TBL                           37340002
373500              PERFORM 9999-RETURN-MSG                             37350002
373600     END-EVALUATE.                                                37360002
373700                                                                  37370002
373800                                                                  37380002
373900 6675-CHECK-DATES.                                                37390002
374000******************************************************************37400002
374100******************************************************************37410002
374200                                                                  37420002
374300     MOVE '6675-CHECK-DATES'           TO PV-CSSL-PARA            37430002
374400     PERFORM 8000-WRITE-CSSL                                      37440002
374500                                                                  37450002
374600     IF WKORIN-STRT-TMST NOT = PC-DEFAULT-TMST                    37460002
374700         IF WKORIN-STOP-TMST NOT = PC-DEFAULT-TMST                37470002
374800             MOVE WKORIN-PRC-FCLTY-AREA-ID                        37480002
374900               TO PV-PRC-FCLTY-AREA-ID                            37490002
375000         ELSE                                                     37500002
375100             MOVE WKORIN-PRC-FCLTY-AREA-ID                        37510002
375200               TO PV-PRC-FCLTY-AREA-ID                            37520002
375300             SET PS-EOF-TWKORIN-CSR TO TRUE                       37530002
375400         END-IF                                                   37540002
375500     ELSE                                                         37550002
375600         SET PS-EOF-TWKORIN-CSR TO TRUE                           37560002
375700     END-IF.                                                      37570002
375800                                                                  37580002
375900                                                                  37590002
376000 6800-OPEN-WKORIN0-CURSOR.                                        37600002
376100******************************************************************37610002
376200******************************************************************37620002
376300                                                                  37630002
376400     MOVE '6800-OPEN-WKORIN0-CURSOR'   TO PV-CSSL-PARA            37640002
376500     PERFORM 8000-WRITE-CSSL                                      37650002
376600                                                                  37660002
376700     EXEC SQL                                                     37670002
376800         OPEN WKORIN0-CSR                                         37680002
376900     END-EXEC.                                                    37690002
377000                                                                  37700002
377100         PERFORM 8001-WRITE-SQLCODE                               37710002
377200     EVALUATE TRUE                                                37720002
377300         WHEN SQLWARN0 NOT = SPACES                               37730002
377400         WHEN SQLCODE < ZERO                                      37740002
377500         WHEN SQLCODE > ZERO                                      37750002
377600              SET PS-DONE  TO TRUE                                37760002
377700              MOVE SQLCA   TO TM500-SQLCA                         37770002
377800              MOVE SQLCODE TO TM500-SQLCODE                       37780002
377900              MOVE PRV-5S  TO TM500-RETURN-DATA                   37790002
378000                                                                  37800002
378100              MOVE SPACES    TO PRV-TM500-RETURN-MSG              37810002
378200              MOVE '6800'    TO PRV-PARA                          37820002
378300              MOVE 'TWKORIN' TO PRV-TBL                           37830002
378400              PERFORM 9999-RETURN-MSG                             37840002
378500         WHEN SQLCODE = ZERO                                      37850002
378600              CONTINUE                                            37860002
378700     END-EVALUATE.                                                37870002
378800                                                                  37880002
378900                                                                  37890002
379000 6805-CLOSE-WKORIN0.                                              37900002
379100******************************************************************37910002
379200******************************************************************37920002
379300                                                                  37930002
379400     MOVE '6805-CLOSE-WKORIN0'         TO PV-CSSL-PARA            37940002
379500     PERFORM 8000-WRITE-CSSL                                      37950002
379600                                                                  37960002
379700     EXEC SQL                                                     37970002
379800         CLOSE WKORIN0-CSR                                        37980002
379900     END-EXEC.                                                    37990002
380000                                                                  38000002
380100         PERFORM 8001-WRITE-SQLCODE                               38010002
380200     EVALUATE TRUE                                                38020002
380300         WHEN SQLWARN0 NOT = SPACES                               38030002
380400         WHEN SQLCODE < ZERO                                      38040002
380500         WHEN SQLCODE > ZERO                                      38050002
380600              SET PS-DONE  TO TRUE                                38060002
380700              MOVE SQLCA   TO TM500-SQLCA                         38070002
380800              MOVE SQLCODE TO TM500-SQLCODE                       38080002
380900              MOVE PRV-5U  TO TM500-RETURN-DATA                   38090002
381000                                                                  38100002
381100              MOVE SPACES    TO PRV-TM500-RETURN-MSG              38110002
381200              MOVE '6805'    TO PRV-PARA                          38120002
381300              MOVE 'TWKORIN' TO PRV-TBL                           38130002
381400              PERFORM 9999-RETURN-MSG                             38140002
381500         WHEN SQLCODE = 0                                         38150002
381600              CONTINUE                                            38160002
381700     END-EVALUATE.                                                38170002
381800                                                                  38180002
381900                                                                  38190002
382000 6850-FETCH-TWKORIN-ZERO.                                         38200002
382100******************************************************************38210002
382200******************************************************************38220002
382300                                                                  38230002
382400     MOVE '6850-FETCH-TWKORIN-ZERO'    TO PV-CSSL-PARA            38240002
382500     PERFORM 8000-WRITE-CSSL                                      38250002
382600                                                                  38260002
382700     EXEC SQL                                                     38270002
382800          FETCH WKORIN0-CSR                                       38280002
382900           INTO :WKORIN-STRT-TMST                                 38290002
383000              , :WKORIN-STOP-TMST                                 38300002
383100              , :WKORIN-PRC-FCLTY-AREA-ID                         38310002
383200              , :WKORIN-SCREEN-SEQ-NBR                            38320002
383300     END-EXEC.                                                    38330002
383400                                                                  38340002
383500         PERFORM 8001-WRITE-SQLCODE                               38350002
383600     EVALUATE TRUE                                                38360002
383700         WHEN SQLCODE = +0                                        38370002
383800              PERFORM 6860-CHECK-DATES                            38380002
383900         WHEN SQLCODE = +100                                      38390002
384000              SET PS-EOF-TWKORIN-ZERO TO TRUE                     38400002
384100         WHEN SQLWARN0 NOT = SPACES                               38410002
384200         WHEN SQLCODE < ZERO                                      38420002
384300         WHEN SQLCODE > ZERO                                      38430002
384400              SET PS-DONE  TO TRUE                                38440002
384500              MOVE SQLCA   TO TM500-SQLCA                         38450002
384600              MOVE SQLCODE TO TM500-SQLCODE                       38460002
384700              MOVE PRV-5T  TO TM500-RETURN-DATA                   38470002
384800                                                                  38480002
384900              MOVE SPACES    TO PRV-TM500-RETURN-MSG              38490002
385000              MOVE '6850'    TO PRV-PARA                          38500002
385100              MOVE 'TWKORIN' TO PRV-TBL                           38510002
385200              PERFORM 9999-RETURN-MSG                             38520002
385300     END-EVALUATE.                                                38530002
385400                                                                  38540002
385500                                                                  38550002
385600 6860-CHECK-DATES.                                                38560002
385700******************************************************************38570002
385800******************************************************************38580002
385900                                                                  38590002
386000     MOVE '6860-CHECK-DATES'           TO PV-CSSL-PARA            38600002
386100     PERFORM 8000-WRITE-CSSL                                      38610002
386200                                                                  38620002
386300     IF WKORIN-STRT-TMST NOT = PC-DEFAULT-TMST                    38630002
386400         IF WKORIN-STOP-TMST NOT = PC-DEFAULT-TMST                38640002
386500             MOVE WKORIN-PRC-FCLTY-AREA-ID                        38650002
386600               TO PV-PRC-FCLTY-AREA-ID                            38660002
386700         ELSE                                                     38670002
386800             MOVE WKORIN-PRC-FCLTY-AREA-ID                        38680002
386900               TO PV-PRC-FCLTY-AREA-ID                            38690002
387000             SET PS-EOF-TWKORIN-CSR TO TRUE                       38700002
387100         END-IF                                                   38710002
387200     ELSE                                                         38720002
387300         MOVE WKORIN-PRC-FCLTY-AREA-ID                            38730002
387400           TO PV-PRC-FCLTY-AREA-ID                                38740002
387500         SET PS-EOF-TWKORIN-CSR TO TRUE                           38750002
387600     END-IF.                                                      38760002
387700                                                                  38770002
387800                                                                  38780002
387900 8000-WRITE-CSSL.                                                 38790002
388000     IF TM500-PO-NBR = 1948405                                    38800002
388100                                                                  38810002
388200         MOVE '#'                     TO PV-MARKER                38820002
388300         EXEC CICS                                                38830002
388400             WRITEQ TD                                            38840002
388500             QUEUE  ('CSSL')                                      38850002
388600             FROM   (PV-CSSL-MSG)                                 38860002
388700             LENGTH(100)                                          38870002
388800             RESP   (PV-CICS-RESP)                                38880002
388900         END-EXEC                                                 38890002
389000                                                                  38900002
389100         MOVE '#'                     TO PV-MARKER                38910002
389200         MOVE SPACES                  TO PV-CSSL-PARA             38920002
389300         MOVE TM500-OPER-UNT-ID       TO PV-DISP-1                38930002
389400         MOVE TM500-FCLTY-ID          TO PV-DISP-2                38940002
389500         MOVE TM500-PO-NBR            TO PV-DISP-3                38950002
389600         MOVE TM500-PO-LNE-NBR        TO PV-DISP-4                38960002
389700         MOVE TM500-REC-SEQ-NBR       TO PV-DISP-5                38970002
389800         MOVE TRBDTL-NOTIF-NBR        TO PV-DISP-6                38980002
389900         MOVE TM500-TRBL-RSN-CDE      TO PV-DISP-7                38990002
390000         MOVE TM500-PREPK-ID          TO PV-DISP-8                39000002
390100         STRING 'OPER=' PV-DISP-1                                 39010002
390200                ' FCLTY=' PV-DISP-2                               39020002
390300                ' PO=' PV-DISP-3                                  39030002
390400                ' LINE=' PV-DISP-4                                39040002
390500             DELIMITED BY SIZE                                    39050002
390600             INTO PV-CSSL-TEXT                                    39060002
390700         EXEC CICS                                                39070002
390800             WRITEQ TD                                            39080002
390900             QUEUE  ('CSSL')                                      39090002
391000             FROM   (PV-CSSL-MSG)                                 39100002
391100             LENGTH(100)                                          39110002
391200             RESP   (PV-CICS-RESP)                                39120002
391300         END-EXEC                                                 39130002
391400                                                                  39140002
391500         INITIALIZE PV-CSSL-TEXT                                  39150002
391600         MOVE '#'                     TO PV-MARKER                39160002
391700         STRING                                                   39170002
391800                ' RCVR=' PV-DISP-5                                39180002
391900                ' NOTIF=' PV-DISP-6                               39190002
392000                ' RSN=' PV-DISP-7                                 39200002
392100                ' PPK=' PV-DISP-8                                 39210002
392200             DELIMITED BY SIZE                                    39220002
392300             INTO PV-CSSL-TEXT                                    39230002
392400         EXEC CICS                                                39240002
392500             WRITEQ TD                                            39250002
392600             QUEUE  ('CSSL')                                      39260002
392700             FROM   (PV-CSSL-MSG)                                 39270002
392800             LENGTH(100)                                          39280002
392900             RESP   (PV-CICS-RESP)                                39290002
393000         END-EXEC                                                 39300002
393100                                                                  39310002
393200         INITIALIZE PV-CSSL-TEXT                                  39320002
393300                    PV-DISP-FIELDS                                39330002
393400         MOVE TM500-REQUIRED-FIELDS   TO PV-CSSL-TEXT             39340002
393500         EXEC CICS                                                39350002
393600             WRITEQ TD                                            39360002
393700             QUEUE  ('CSSL')                                      39370002
393800             FROM   (PV-CSSL-MSG)                                 39380002
393900             LENGTH(100)                                          39390002
394000             RESP   (PV-CICS-RESP)                                39400002
394100         END-EXEC                                                 39410002
394200                                                                  39420002
394300         INITIALIZE PV-CSSL-MSG                                   39430002
394400     END-IF.                                                      39440002
394500                                                                  39450002
394600 8001-WRITE-SQLCODE.                                              39460002
394700     IF TM500-PO-NBR = 1948405                                    39470002
394800         MOVE '#'                     TO PV-MARKER2               39480002
394900         MOVE SQLCODE                 TO PV-DISP-SQLCODE          39490002
395000         EXEC CICS                                                39500002
395100             WRITEQ TD                                            39510002
395200             QUEUE  ('CSSL')                                      39520002
395300             FROM   (PV-CSSL-SQLCODE)                             39530002
395400*            LENGTH(015)                                          39540002
395500             RESP   (PV-CICS-RESP)                                39550002
395600     END-EXEC                                                     39560002
395700     END-IF.                                                      39570002
395800/                                                                 39580002
395900 9999-RETURN-MSG.                                                 39590002
396000******************************************************************39600002
396100******************************************************************39610002
396200                                                                  39620002
396300     MOVE '9999-RETURN-MSG'            TO PV-CSSL-PARA            39630002
396400     PERFORM 8000-WRITE-CSSL                                      39640002
396500                                                                  39650002
396600     COMPUTE PV-OP-N = TM500-OPER-UNT-ID * 1.                     39660002
396700     COMPUTE PV-FCLTY-N = TM500-FCLTY-ID * 1.                     39670002
396800     COMPUTE PV-PO-N = TM500-PO-NBR      * 1.                     39680002
396900     COMPUTE PV-LINE-N = TM500-PO-LNE-NBR * 1.                    39690002
397000     COMPUTE PV-REC-SEQ-NBR-N = TM500-REC-SEQ-NBR * 1.            39700002
397100                                                                  39710002
397200     MOVE '521'                 TO PRV-PGM.                       39720002
397300     MOVE PV-OP                 TO PRV-OP.                        39730002
397400     MOVE PV-FCLTY              TO PRV-FCLTY.                     39740002
397500     MOVE PV-PO                 TO PRV-PO.                        39750002
397600     MOVE PV-LINE               TO PRV-LINE.                      39760002
397700     MOVE PV-REC-SEQ-NBR        TO PRV-REC-SEQ-NBR.               39770002
397800                                                                  39780002
397900     MOVE PRV-TM500-RETURN-MSG  TO TM500-RETURN-MSG.              39790002
