000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    TRKCS152.                                         00040099
000500 AUTHOR.        LARRY SCHLEICHER (STRATAGEM).                     00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  06-12-97.                                         00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    Y152 - FREE ON BOARD LIST PROGRAM.                         * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM GENERATES A LIST OF FOB CODES.  THE           * 00130099
001400*    ASSOCIATED TABLE VALUES ARE DISPLAYED. THE                 * 00140099
001500*    APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR SELECTS   * 00150099
001600*    ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.              * 00160099
001700*                                                               * 00170099
001800*    02/19/2003     MADE CHANGES TO INCLUDE THE DECONSOLIDATOR  * 00180099
001900*                   SCAC TO FOB SCREENS    -VISWA KARUTURI      * 00190099
002000*---------------------------------------------------------------* 00200099
P5207 *    11/20/2013   ADDED A NEW FIELD INCOTERM CODE TO TRKM152     *00210099
P5207 *    SCREEN AND HENCE CORRESPONIDNG CODE CHANGES HAVE BEEN DONE  *00220099
P5207 *    IN THIS PROGRAM.  - SHEBENA                                 *00230099
P5207 *    CHANGE TAG : P5207  CR # : CHG0081355                       *00240099
P5207 *----------------------------------------------------------------*00250099
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00252099
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00253099
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00254099
263697*---------------------------------------------------------------* 00255099
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495         00256099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00257099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00258099
CICS  *-----------------------------------------------------------------00259099
002100 EJECT                                                            00260099
002200 ENVIRONMENT DIVISION.                                            00270099
002300                                                                  00280099
002400 DATA DIVISION.                                                   00290099
002500                                                                  00300099
002600 WORKING-STORAGE SECTION.                                         00310099
002700                                                                  00320099
002800 01  DK-DB2-KEYS.                                                 00330099
002900     15  DK-FOB-CODE                    PIC  X(03)  VALUE SPACE.  00340099
003000     15  DK-CNTRY-CODE                  PIC  X(03)  VALUE SPACE.  00350099
003100     15  DK-ENT-ID                      PIC S9(09) COMP.          00360099
003200     15  DK-POE-CODE                    PIC  X(03)  VALUE SPACE.  00370099
003300     15  DK-STAT-CDE                    PIC  X(01)  VALUE SPACE.  00380099
003400                                                                  00390099
003500 01  PC-PROGRAM-CONSTANTS.                                        00400099
003600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00410099
003700                                                    'TR152A  '.   00420099
003800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00430099
003900                                                    'TRKM152 '.   00440099
004000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00450099
004100                                                    'TRKCS152'.   00460099
004200     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00470099
004300     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00480099
004400     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00490099
004500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00500099
004600                                                    COMP SYNC.    00510099
004700     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00520099
004800                                                    COMP SYNC.    00530099
004900     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00540099
005000                                                    +1000000      00550099
005100                                                    COMP-3.       00560099
005200     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00570099
005300                                                    COMP SYNC.    00580099
005400     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00590099
005500     05  PC-ASTRK                       PIC  X(01)  VALUE '*'.    00600099
005600     05  PC-A                           PIC  X(01)  VALUE 'A'.    00610099
005700     05  PC-I                           PIC  X(01)  VALUE 'I'.    00620099
005800     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00630099
005900     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00640099
006000     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00650099
006100     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00660099
006200     05  PC-PRIMARY                     PIC XX    VALUE '01'.     00670099
006300     05  PC-SPACE                       PIC  X(01)  VALUE ' '.    00680099
006400     05  PC-INTER-APPL-CODES.                                     00690099
006500         10  PC-INTER-APPL-LIST-ACT                               00700099
006600                                  PIC  X(01)  VALUE  '2'.         00710099
006700*                                                                 00720099
006800     05  PC-TSYMSG-NUMBERS.                                       00730099
006900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00740099
007000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00750099
007100         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00760099
007200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00770099
007300         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00780099
007400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00790099
007500         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00800099
007600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00810099
007700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00820099
007800         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00830099
007900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00840099
008000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00850099
008100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00860099
008200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00870099
008300         10  PC-TSYMSG-01645            PIC  9(05)  VALUE 01645.  00880099
008400         10  PC-TSYMSG-01451            PIC  9(05)  VALUE 01451.  00890099
008500         10  PC-TSYMSG-01646            PIC  9(05)  VALUE 01646.  00900099
008600         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00910099
008700*                                                                 00920099
008800 01  PS-PROGRAM-SWITCHES.                                         00930099
008900     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00940099
009000         88  PS-NO-ERROR                            VALUE 'Y'.    00950099
009100         88  PS-ERROR                               VALUE 'N'.    00960099
009200     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00970099
009300         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00980099
009400         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00990099
009500     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01000099
009600         88  PS-DONE                                VALUE 'Y'.    01010099
009700         88  PS-NOT-DONE                            VALUE 'N'.    01020099
009800*                                                                 01030099
009900 01  PV-PROGRAM-VARIABLES.                                        01040099
010000     05  PV-SUB                         PIC S9(04)  VALUE +0      01050099
010100                                                    COMP SYNC.    01060099
010200     05  PV-ASTRK-CNT                   PIC S9(04)  VALUE +0      01070099
010300                                                    COMP SYNC.    01080099
010400     05  PV-NUMBER-OF-SELECTED-ITEMS    PIC S9(09)                01090099
010500                                                    COMP-3.       01100099
010600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01110099
010700                                                    COMP SYNC.    01120099
010800     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01130099
010900                                                    COMP-3.       01140099
011000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01150099
011100                                                    COMP-3.       01160099
011200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01170099
011300                                                    COMP-3.       01180099
011400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01190099
011500                                                    COMP-3.       01200099
011600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01210099
011700                                                    COMP-3.       01220099
011800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01230099
011900                                                    COMP-3.       01240099
012000     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01250099
012100                                                    COMP-3.       01260099
012200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01270099
012300                                                    COMP SYNC.    01280099
012400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01290099
012500                                                    COMP SYNC.    01300099
012600     05  PV-ITEM                        PIC S9(04)  VALUE +0      01310099
012700                                                    COMP SYNC.    01320099
012800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01330099
012900                                                    COMP SYNC.    01340099
013000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01350099
013100                                                    COMP SYNC.    01360099
013200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01370099
013300                                                    COMP SYNC.    01380099
013400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01390099
013500                                                    COMP SYNC.    01400099
013600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01410099
013700                                                    COMP SYNC.    01420099
013800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01430099
013900                                                    COMP SYNC.    01440099
014000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01450099
014100                                                    COMP SYNC.    01460099
014200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01470099
014300                                                    COMP SYNC.    01480099
014400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01490099
014500                                                    COMP SYNC.    01500099
014600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01510099
014700                                                    COMP SYNC.    01520099
014800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01530099
014900                                                    COMP SYNC.    01540099
015000     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01550099
015100                                                    COMP SYNC.    01560099
015200     05  PV-LINE-1-DETAIL.                                        01570099
015300         10  PV-L1-FOB-CODE             PIC  X(03).               01580099
015400         10  FILLER                     PIC  X(01)  VALUE SPACES. 01590099
015500         10  PV-L1-EDI-CODE             PIC  X(05).               01600099
015600         10  FILLER                     PIC  X(01)  VALUE SPACES. 01610099
015700         10  PV-L1-FOB-CITY             PIC  X(28).               01620099
015800         10  FILLER                     PIC  X(01)  VALUE SPACES. 01630099
015900         10  PV-L1-FOB-COUNTRY          PIC  X(28).               01640099
016000     05  PV-LINE-2-DETAIL.                                        01650099
016100         10  PV-L2-CONSOLIDATOR-NAME    PIC  X(21).               01660099
016200         10  FILLER                     PIC  X(02)  VALUE SPACES. 01670099
016300         10  PV-L2-CUSTOM-BROKER-NAME   PIC  X(21).               01680099
016400         10  FILLER                     PIC  X(02)  VALUE SPACES. 01690099
016500         10  PV-L2-POE-NAME             PIC  X(21).               01700099
016600******************************************************************01710099
016700**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01720099
016800**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01730099
016900**  APPLICATION-SPECIFIC COMMAREA.                              **01740099
017000******************************************************************01750099
017100 01  LQW-LIST-QUEUE-WORK-AREA.                                    01760099
017200     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01770099
017300     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01780099
017400                                        INDEXED BY LQW-IDX.       01790099
017500         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01800099
017600         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01810099
017700         10  LQW-SELECTED-SW            PIC  X(01).               01820099
017800             88  LQW-SELECT                         VALUE 'S'.    01830099
017900             88  LQW-DESELECT                       VALUE ' '.    01840099
018000         10  LQW-ACTION                 PIC  X(03).               01850099
018100         10  LQW-FOB-CODE               PIC  X(03).               01860099
018200         10  LQW-FOB-COUNTRY-CODE       PIC  X(03).               01870099
018300         10  LQW-FOB-COUNTRY-NAME       PIC  X(12).               01880099
P5207          10  LQW-FOB-CITY-NAME          PIC  X(15).               01890099
018500         10  LQW-CONSLR-SCAC            PIC  X(04).               01900099
018600         10  LQW-CONSLR-ENT-ID          PIC S9(9).                01910099
018700         10  LQW-CSTM-BKR-SCAC          PIC  X(04).               01920099
018800         10  LQW-CSTM-BKR-ENT-ID        PIC S9(9).                01930099
018900         10  LQW-POE-NAME               PIC  X(03).               01940099
019000         10  LQW-FOB-STD-EDI-CDE        PIC  X(05).               01950099
019100         10  LQW-DECONL-SCAC            PIC  X(04).               01960099
019200         10  LQW-DECONL-ENT-ID          PIC S9(9).                01970099
P5207          10  LQW-INCOTERM-CODE          PIC  X(03).               01980099
019300                                                                  01990099
019400     EJECT                                                        02000099
019500*---------------------------------------------------------------* 02010099
019600*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 02020099
019700*---------------------------------------------------------------* 02030099
019800                                                                  02040099
019900     COPY TRWS021.                                                02050099
020000                                                                  02060099
020100     EJECT                                                        02070099
020200*---------------------------------------------------------------* 02080099
020300*    MAP LAYOUT                                                 * 02090099
020400*---------------------------------------------------------------* 02100099
020500                                                                  02110099
020600     COPY TRKM152.                                                02120099
020700*                                                                 02130099
020800 01  MR-OCCURS-LAYOUT                   REDEFINES  TR152AO.       02140099
020900     05  FILLER                         PIC X(42).                02150099
021000     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          02160099
021100         10  MR-SELECTL                 PIC S9(04) COMP.          02170099
021200         10  MR-SELECTA                 PIC  X(01).               02180099
021300         10  MR-SELECTC                 PIC  X(01).               02190099
021400         10  MR-SELECTH                 PIC  X(01).               02200099
021500         10  MR-SELECTI                 PIC  X(01).               02210099
021600                                                                  02220099
021700         10  MR-ACTIONL                 PIC S9(04) COMP.          02230099
021800         10  MR-ACTIONA                 PIC  X(01).               02240099
021900         10  MR-ACTIONC                 PIC  X(01).               02250099
022000         10  MR-ACTIONH                 PIC  X(01).               02260099
022100         10  MR-ACTION                  PIC  X(03).               02270099
022200                                                                  02280099
022300         10  MR-COUNTRY-NAMEL           PIC S9(04) COMP.          02290099
022400         10  MR-COUNTRY-NAMEA           PIC  X(01).               02300099
022500         10  MR-COUNTRY-NAMEC           PIC  X(01).               02310099
022600         10  MR-COUNTRY-NAMEH           PIC  X(01).               02320099
022700         10  MR-COUNTRY-NAME            PIC  X(12).               02330099
022800                                                                  02340099
022900         10  MR-FOB-CODEL               PIC S9(04) COMP.          02350099
023000         10  MR-FOB-CODEA               PIC  X(01).               02360099
023100         10  MR-FOB-CODEC               PIC  X(01).               02370099
023200         10  MR-FOB-CODEH               PIC  X(01).               02380099
023300         10  MR-FOB-CODE                PIC  X(03).               02390099
023400                                                                  02400099
023500         10  MR-CITY-NAMEL              PIC S9(04) COMP.          02410099
023600         10  MR-CITY-NAMEA              PIC  X(01).               02420099
023700         10  MR-CITY-NAMEC              PIC  X(01).               02430099
023800         10  MR-CITY-NAMEH              PIC  X(01).               02440099
P5207          10  MR-CITY-NAME               PIC  X(15).               02450099
024000                                                                  02460099
024100         10  MR-CONSL-SCACL             PIC S9(04) COMP.          02470099
024200         10  MR-CONSL-SCACA             PIC  X(01).               02480099
024300         10  MR-CONSL-SCACC             PIC  X(01).               02490099
024400         10  MR-CONSL-SCACH             PIC  X(01).               02500099
024500         10  MR-CONSL-SCAC              PIC  X(04).               02510099
024600                                                                  02520099
024700         10  MR-CUSTMS-BKR-SCACL        PIC S9(04) COMP.          02530099
024800         10  MR-CUSTMS-BKR-SCACA        PIC  X(01).               02540099
024900         10  MR-CUSTMS-BKR-SCACC        PIC  X(01).               02550099
025000         10  MR-CUSTMS-BKR-SCACH        PIC  X(01).               02560099
025100         10  MR-CUSTMS-BKR-SCAC         PIC  X(04).               02570099
025200                                                                  02580099
025300         10  MR-POEL                    PIC S9(04) COMP.          02590099
025400         10  MR-POEA                    PIC  X(01).               02600099
025500         10  MR-POEC                    PIC  X(01).               02610099
025600         10  MR-POEH                    PIC  X(01).               02620099
025700         10  MR-POE                     PIC  X(03).               02630099
025800                                                                  02640099
025900         10  MR-EDI-CODEL               PIC S9(04) COMP.          02650099
026000         10  MR-EDI-CODEA               PIC  X(01).               02660099
026100         10  MR-EDI-CODEC               PIC  X(01).               02670099
026200         10  MR-EDI-CODEH               PIC  X(01).               02680099
026300         10  MR-EDI-CODE                PIC  X(05).               02690099
026400                                                                  02700099
026500         10  MR-DECON-SCACL             PIC S9(04) COMP.          02710099
026600         10  MR-DECON-SCACA             PIC  X(01).               02720099
026700         10  MR-DECON-SCACC             PIC  X(01).               02730099
026800         10  MR-DECON-SCACH             PIC  X(01).               02740099
026900         10  MR-DECON-SCAC              PIC  X(04).               02750099
P5207                                                                   02760099
P5207          10  MR-INCOT-CODEL             PIC S9(04) COMP.          02770099
P5207          10  MR-INCOT-CODEA             PIC  X(01).               02780099
P5207          10  MR-INCOT-CODEC             PIC  X(01).               02790099
P5207          10  MR-INCOT-CODEH             PIC  X(01).               02800099
P5207          10  MR-INCOT-CODE              PIC  X(03).               02810099
027000                                                                  02820099
027100     EJECT                                                        02830099
027200*---------------------------------------------------------------* 02840099
027300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02850099
027400*---------------------------------------------------------------* 02860099
027500                                                                  02870099
027600     COPY DPWS015.                                                02880099
027700                                                                  02890099
027800*---------------------------------------------------------------* 02900099
027900*    FUNCTION KEYS COPYBOOK.                                    * 02910099
028000*---------------------------------------------------------------* 02920099
028100                                                                  02930099
028200     COPY DPWS016.                                                02940099
028300                                                                  02950099
028400*---------------------------------------------------------------* 02960099
028500*    NUMERIC EDIT LAYOUT.                                       * 02970099
028600*---------------------------------------------------------------* 02980099
028700                                                                  02990099
028800     COPY DPWS010I.                                               03000099
028900 EJECT                                                            03010099
029000*---------------------------------------------------------------* 03020099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03030099
029200*---------------------------------------------------------------* 03040099
029300                                                                  03050099
029400     COPY DPWS030.                                                03060099
CICS       COPY DPWS930.                                                03061099
029500 EJECT                                                            03070099
029600*---------------------------------------------------------------* 03080099
029700*    STANDARD COMMAREA.                                         * 03090099
029800*---------------------------------------------------------------* 03100099
029900                                                                  03110099
030000     COPY DPWS020.                                                03120099
030100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03130099
030200                                                                  03140099
030300*---------------------------------------------------------------* 03150099
030400* INTER-APPLICATION COMMAREA.                                   * 03160099
030500*   TRWS019 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03170099
030600*             SPEC SCREEN.                                      * 03180099
030700*---------------------------------------------------------------* 03190099
030800                                                                  03200099
030900         10  INTER-APPL-COMM-AREA       PIC X(200).               03220099
031000     COPY TRWS019.                                                03230099
031100*---------------------------------------------------------------* 03240099
031200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03250099
031300*---------------------------------------------------------------* 03260099
031400         10  ASC-SPECIFIC-COMMAREA.                               03270099
031500             15  ASC-LIST-KEYS.                                   03280099
031600                 20  ASC-KEY-FOB-CODE                PIC  X(03).  03290099
031700                 20  ASC-KEY-FOB-STAT                PIC  X(01).  03300099
031800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03310099
031900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03320099
032000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03330099
032100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03340099
032200                                                                  03350099
032300                 20  ASC-ITEM-ARRAY.                              03360099
032400                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        03370099
032500                         30  ASC-LIST-ITEM-NUMBER                 03380099
032600                                                     PIC S9(09)   03390099
032700                                                     COMP-3.      03400099
032800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03410099
032900                             88  ASC-VALID-SELECT    VALUE ' '    03420099
033000                                                           'S'    03430099
033100                                                           'B'    03440099
033200                                                           'E'.   03450099
033300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03460099
033400                             88  ASC-TEMP-SELECT     VALUE 'S'.   03470099
033500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03480099
033600                             88  ASC-TEMP-END        VALUE 'E'.   03490099
033700                         30  ASC-SELECTED-SW         PIC  X(01).  03500099
033800                             88  ASC-NO-SELECT       VALUE ' '.   03510099
033900                             88  ASC-SELECT          VALUE 'S'.   03520099
034000                             88  ASC-BEGIN           VALUE 'B'.   03530099
034100                             88  ASC-END             VALUE 'E'.   03540099
034200                         30  ASC-ACTION              PIC  X(03).  03550099
034300                         30  ASC-FOB-CODE            PIC  X(03).  03560099
034400                         30  ASC-FOB-CNTRY-CODE      PIC  X(03).  03570099
034500                         30  ASC-FOB-CNTRY-NAME      PIC  X(12).  03580099
P5207                          30  ASC-FOB-CITY-NAME       PIC  X(15).  03590099
034700                         30  ASC-CONSLR-SCAC         PIC  X(04).  03600099
034800                         30  ASC-CONSLR-ENT-ID       PIC S9(9).   03610099
034900                         30  ASC-CSTM-BKR-SCAC       PIC  X(04).  03620099
035000                         30  ASC-CSTM-BKR-ENT-ID     PIC S9(9).   03630099
035100                         30  ASC-POE-CODE            PIC  X(03).  03640099
035200                         30  ASC-FOB-STD-EDI-CDE     PIC  X(05).  03650099
035300                         30  ASC-DECONL-SCAC         PIC  X(04).  03660099
035400                         30  ASC-DECONL-ENT-ID       PIC S9(9).   03670099
P5207                          30  ASC-INCOTERM-CODE       PIC  X(03).  03680099
035500                                                                  03690099
035600             15  ASC-BLK-SUB                         PIC S9(04)   03700099
035700                                                          COMP    03710099
035800                                                          SYNC.   03720099
035900             15  ASC-ITEM-SUB                        PIC S9(04)   03730099
036000                                                          COMP    03740099
036100                                                          SYNC.   03750099
036200             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03760099
036300                                                          COMP-3. 03770099
036400             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03780099
036500                                                          COMP-3. 03790099
036600             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03800099
036700                                                          COMP-3. 03810099
036800             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03820099
036900                                                          COMP-3. 03830099
037000             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03840099
037100                                                          COMP-3. 03850099
037200             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03860099
037300                                                          COMP    03870099
037400                                                          SYNC.   03880099
037500             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03890099
037600                                                          COMP-3. 03900099
037700             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03910099
037800                                                          COMP-3. 03920099
037900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03930099
038000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03940099
038100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03950099
038200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03960099
038300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03970099
038400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03980099
038500             15  ASC-LIST-QUEUE-NAME.                             03990099
038600                 20  ASC-LIST-TERM-ID                PIC  X(04).  04000099
038700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04010099
038800                                                          COMP-3. 04020099
038900                 20  ASC-LIST-SEQ                    PIC  9(01).  04030099
039000             15  ASC-SEL-QUEUE-NAME.                              04040099
039100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04050099
039200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04060099
039300                                                          COMP-3. 04070099
039400                 20  ASC-SEL-SEQ                     PIC  9(01).  04080099
039500                                                                  04090099
039600             15  ASC-CURSOR-SW                       PIC  X(01).  04100099
039700                 88  ASC-USE-LIKE-CURSOR             VALUE 'L'.   04110099
039800                 88  ASC-USE-ALL-CURSOR              VALUE 'A'.   04120099
039900             15  ASC-START-ITEM-REQUEST.                          04130099
040000                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04140099
040100     EJECT                                                        04150099
040200*---------------------------------------------------------------* 04160099
040300*    ABEND PROCESSING COPYBOOK.                                 * 04170099
040400*---------------------------------------------------------------* 04180099
040500                                                                  04190099
040600     COPY DPWS013.                                                04200099
040700                                                                  04210099
040800 EJECT                                                            04220099
040900*---------------------------------------------------------------* 04230099
041000*    DB2 AREA FOR TEXTENT                                       * 04240099
041100*---------------------------------------------------------------* 04250099
041200     EXEC SQL                                                     04260099
041300          INCLUDE TEXTENT                                         04270099
041400     END-EXEC.                                                    04280099
041500*---------------------------------------------------------------* 04290099
041600*    DB2 AREA FOR TIMFOB                                        * 04300099
041700*---------------------------------------------------------------* 04310099
041800     EXEC SQL                                                     04320099
041900          INCLUDE TIMFOB                                          04330099
042000     END-EXEC.                                                    04340099
042100*---------------------------------------------------------------* 04350099
042200*    DB2 AREA FOR TCNRTY                                        * 04360099
042300*---------------------------------------------------------------* 04370099
042400     EXEC SQL                                                     04380099
042500          INCLUDE TCNTRY                                          04390099
042600     END-EXEC.                                                    04400099
042700*---------------------------------------------------------------* 04410099
042800*    DB2 AREA FOR TENTNME                                       * 04420099
042900*---------------------------------------------------------------* 04430099
043000     EXEC SQL                                                     04440099
043100          INCLUDE TENTNME                                         04450099
043200     END-EXEC.                                                    04460099
043300*---------------------------------------------------------------* 04470099
043400*    DB2 AREA FOR COMMUNICATIONS                                * 04480099
043500*---------------------------------------------------------------* 04490099
043600     EXEC SQL                                                     04500099
043700          INCLUDE SQLCA                                           04510099
043800     END-EXEC.                                                    04520099
043900                                                                  04530099
044000*---------------------------------------------------------------* 04540099
044100*    TIMFOB CURSOR FOR ALL FOB CODES                            * 04550099
044200*---------------------------------------------------------------* 04560099
044300                                                                  04570099
044400     EXEC SQL                                                     04580099
044500          DECLARE FOB-ALL-CSR CURSOR                              04590099
044600          FOR SELECT                                              04600099
044700                A.FOB_CDE                                         04610099
044800              , A.FOB_STD_EDI_CDE                                 04620099
044900              , A.FOB_CTY_NM                                      04630099
045000              , A.FOB_CNTRY_CDE                                   04640099
045100              , B.CNTRY_NM                                        04650099
045200              , A.CONSLR_ENT_ID                                   04660099
045300              , A.CSTM_BKR_ENT_ID                                 04670099
045400              , A.POE_CDE                                         04680099
045500              , A.DCONSLR_ENT_ID                                  04690099
P5207               , A.INCTRM_CDE                                      04700099
045600          FROM  TIMFOB A,                                         04710099
045700                TCNTRY B                                          04720099
045800          WHERE A.STAT_CDE = :DK-STAT-CDE                         04730099
045900            AND A.FOB_CNTRY_CDE = B.CNTRY_CDE                     04740099
046000          ORDER BY                                                04750099
046100                B.CNTRY_NM                                        04760099
046200     END-EXEC.                                                    04770099
046300                                                                  04780099
046400*---------------------------------------------------------------* 04790099
046500*    TIMFOB CURSOR FOR ALL FOB CODES BEGINNING WITH ENTERED     * 04800099
046600*    CHARACTERS                                                 * 04810099
046700*---------------------------------------------------------------* 04820099
046800                                                                  04830099
046900     EXEC SQL                                                     04840099
047000          DECLARE FOB-LIKE-CSR CURSOR                             04850099
047100          FOR SELECT                                              04860099
047200                A.FOB_CDE                                         04870099
047300              , A.FOB_STD_EDI_CDE                                 04880099
047400              , A.FOB_CTY_NM                                      04890099
047500              , A.FOB_CNTRY_CDE                                   04900099
047600              , B.CNTRY_NM                                        04910099
047700              , A.CONSLR_ENT_ID                                   04920099
047800              , A.CSTM_BKR_ENT_ID                                 04930099
047900              , A.POE_CDE                                         04940099
048000              , A.DCONSLR_ENT_ID                                  04950099
P5207               , A.INCTRM_CDE                                      04960099
048100          FROM  TIMFOB A,                                         04970099
048200                TCNTRY B                                          04980099
048300          WHERE FOB_CDE   LIKE :DK-FOB-CODE                       04990099
048400            AND A.FOB_CNTRY_CDE = B.CNTRY_CDE                     05000099
048500            AND A.STAT_CDE = :DK-STAT-CDE                         05010099
048600          ORDER BY                                                05020099
048700                FOB_CDE                                           05030099
048800     END-EXEC.                                                    05040099
048900                                                                  05050099
049000                                                                  05060099
049100 EJECT                                                            05070099
049200 LINKAGE SECTION.                                                 05080099
049300                                                                  05090099
049400 01  DFHCOMMAREA.                                                 05100099
049500     05  FILLER                         OCCURS  1 TO 4072 TIMES   05110099
049600                                        DEPENDING ON EIBCALEN.    05120099
049700         10  FILLER                     PIC X.                    05130099
049800                                                                  05140099
049900 EJECT                                                            05150099
050000 PROCEDURE DIVISION.                                              05160099
050100******************************************************************05170099
050200**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05180099
050300**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05190099
050400**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05200099
050500******************************************************************05210099
050600 0000-MAIN-MODULE.                                                05220099
050700     INITIALIZE DP030-CICS-API-FIELDS.                            05230099
050800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05240099
050900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05250099
051000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05260099
051100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05270099
051200     MOVE LENGTH OF TR152AI        TO DP030-MAP-LENGTH (1).       05280099
051300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05290099
051400     PERFORM 0001-CALL-CICS-ARCH-API.                             05300099
051500*                                                                 05310099
051600     PERFORM 1000-CONTROL-PROCESSING                              05320099
051700*                                                                 05330099
051800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05340099
051900     PERFORM 0001-CALL-CICS-ARCH-API.                             05350099
052000                                                                  05360099
052100******************************************************************05370099
052200**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05380099
052300**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05390099
052400******************************************************************05400099
052500 0001-CALL-CICS-ARCH-API.                                         05410099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05420099
052700                                    DFHCOMMAREA                   05430099
052800                                    DP030-CICS-API-FIELDS         05440099
052900                                    DP020-STANDARD-COMMAREA       05450099
053000                                    TR152AI.                      05460099
053100*                                                                 05470099
053200     IF  DP030-RC-CALL-SUCCESSFUL                                 05480099
053300         CONTINUE                                                 05490099
053400     ELSE                                                         05500099
053500         SET DP013-NO-ROLLBACK                                    05510099
053600             DP013-XCTL-DISPLAY-RESTART                           05520099
053700             DP013-CICS-ABEND      TO TRUE                        05530099
053800         MOVE '0001-CALL-CICS-ARCH-API'                           05540099
053900                                   TO DP013-PARAGRAPH             05550099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05560099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05570099
054200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05580099
054300         PERFORM DP013-0000-PROCESS-ABEND                         05590099
054400     END-IF.                                                      05600099
054500*----------------------------------------------------------------*05610099
054600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05620099
054700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05630099
054800*                                                                *05640099
054900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05650099
055000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05660099
055100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05670099
055200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05680099
055300*----------------------------------------------------------------*05690099
055400                                                                  05700099
055500 1000-CONTROL-PROCESSING.                                         05710099
055600                                                                  05720099
055700     EVALUATE TRUE                                                05730099
055800         WHEN DP020-NEXT-ACT-INITIAL                              05740099
055900             IF ASC-NUMBER-OF-SELECTED-ITEMS NUMERIC              05750099
056000                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO            05760099
056100                  PV-NUMBER-OF-SELECTED-ITEMS                     05770099
056200             ELSE                                                 05780099
056300                 MOVE 0 TO PV-NUMBER-OF-SELECTED-ITEMS            05790099
056400             END-IF                                               05800099
056500             INITIALIZE ASC-SPECIFIC-COMMAREA                     05810099
056600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05820099
056700                                      ASC-SEL-TERM-ID             05830099
056800             MOVE DP020-SRC-TASK-NUMBER                           05840099
056900                                   TO ASC-LIST-TASK-NUMBER        05850099
057000                                      ASC-SEL-TASK-NUMBER         05860099
057100             MOVE PC-LIST-QUEUE-SEQ                               05870099
057200                                   TO ASC-LIST-SEQ                05880099
057300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05890099
057400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05900099
057500***-----$TEMPLATE NOTE$-------------------------------------------05910099
057600*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05920099
057700*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05930099
057800*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05940099
057900***---------------------------------------------------------------05950099
058000             IF  PS-COMMAREA-NOT-VALID                            05960099
058100***              MOVE PC-TSYMSG-99901                             05970099
058200***                                TO DP020-MSG-NUMBER            05980099
058300***              SET DP020-MSG-FATAL                              05990099
058400***                                TO TRUE                        06000099
058500                 SET DP020-NEXT-ACT-APPL-ERROR                    06010099
058600                                   TO TRUE                        06020099
058700             ELSE                                                 06030099
058800                 PERFORM 4000-BUILD-INITIAL-PANEL                 06040099
058900             END-IF                                               06050099
059000                                                                  06060099
059100         WHEN DP020-NEXT-ACT-READ-MAP                             06070099
059200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06080099
059300                                   TO PV-TOP-ITEM                 06090099
059400             PERFORM 2000-PROCESS-PANEL                           06100099
059500                                                                  06110099
059600         WHEN DP020-NEXT-ACT-RETURN                               06120099
059700*                                                                 06130099
059800            IF  TR019-RECORD-UPDATED                              06140099
059900                MOVE +0 TO  ASC-NUMBER-OF-SELECTED-ITEMS          06150099
060000                MOVE 'A' TO DK-STAT-CDE                           06160099
060100                MOVE ASC-ITEM-AT-TOP-OF-PANEL                     06170099
060200                                     TO PV-TOP-ITEM               06180099
060300                MOVE ZERO          TO ASC-ITEM-AT-TOP-OF-PANEL    06190099
060400                PERFORM 2050-DELETE-LIST-QUEUE                    06200099
060500              IF ASC-USE-LIKE-CURSOR                              06210099
060600                    MOVE TR019-FOB-CODE TO                        06220099
060700                         DK-FOB-CODE                              06230099
060800              END-IF                                              06240099
060900                PERFORM 4000-BUILD-INITIAL-PANEL                  06250099
061000             ELSE                                                 06260099
061100                 MOVE ASC-ITEM-AT-TOP-OF-PANEL                    06270099
061200                                       TO PV-TOP-ITEM             06280099
061300                 MOVE ZERO           TO ASC-ITEM-AT-TOP-OF-PANEL  06290099
061400                 PERFORM 6000-REFRESH-PANEL-FROM-TEMP             06300099
061500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06310099
061600                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               06320099
061700             END-IF                                               06330099
061800                                                                  06340099
061900         WHEN OTHER                                               06350099
062000             SET DP013-LOGIC-ABEND TO TRUE                        06360099
062100             SET DP013-NO-ROLLBACK TO TRUE                        06370099
062200             MOVE '1000-CONTROL-PROCESSING'                       06380099
062300                                   TO DP013-PARAGRAPH             06390099
062400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06400099
062500                                   TO DP013-MESSAGE-TEXT(1)       06410099
062600             PERFORM DP013-0000-PROCESS-ABEND                     06420099
062700     END-EVALUATE.                                                06430099
062800                                                                  06440099
062900 EJECT                                                            06450099
063000*----------------------------------------------------------------*06460099
063100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06470099
063200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06480099
063300*----------------------------------------------------------------*06490099
063400                                                                  06500099
063500 1100-PROCESS-INTER-APPL-COMM.                                    06510099
063600                                                                  06520099
063700     SET PS-COMMAREA-VALID         TO TRUE.                       06530099
063800     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06540099
063900     MOVE TR019-FOB-CODE           TO ASC-KEY-FOB-CODE            06550099
064000                                      DK-FOB-CODE.                06560099
064100     MOVE TR019-COUNTRY-CODE       TO                             06570099
064200                                      DK-CNTRY-CODE.              06580099
064300     MOVE TR019-STAT-CDE           TO DK-STAT-CDE.                06590099
064400                                                                  06600099
064500     IF TR019-FOB-CODE = SPACES                                   06610099
064600         MOVE SPACES TO DK-FOB-CODE                               06620099
064700                        ASC-KEY-FOB-CODE                          06630099
064800         SET ASC-USE-ALL-CURSOR TO TRUE                           06640099
064900     ELSE                                                         06650099
065000         SET ASC-USE-LIKE-CURSOR TO TRUE                          06660099
065100     END-IF.                                                      06670099
065200                                                                  06680099
065300     INSPECT DK-FOB-CODE TALLYING PV-ASTRK-CNT FOR ALL            06690099
065400                                       PC-ASTRK.                  06700099
065500     IF PV-ASTRK-CNT > 0                                          06710099
065600         SET ASC-USE-LIKE-CURSOR TO TRUE                          06720099
065700         INSPECT DK-FOB-CODE                                      06730099
065800             REPLACING FIRST PC-ASTRK BY PC-PERCENT               06740099
065900         INSPECT ASC-KEY-FOB-CODE                                 06750099
066000             REPLACING FIRST PC-ASTRK BY PC-PERCENT               06760099
066100     END-IF.                                                      06770099
066200                                                                  06780099
066300     INSPECT DK-FOB-CODE TALLYING PV-ASTRK-CNT FOR ALL            06790099
066400                                       PC-ASTRK.                  06800099
066500     IF PV-ASTRK-CNT > 0                                          06810099
066600         SET ASC-USE-LIKE-CURSOR TO TRUE                          06820099
066700         INSPECT DK-FOB-CODE                                      06830099
066800             REPLACING FIRST PC-ASTRK BY PC-PERCENT               06840099
066900         INSPECT ASC-KEY-FOB-CODE                                 06850099
067000             REPLACING FIRST PC-ASTRK BY PC-PERCENT               06860099
067100     END-IF.                                                      06870099
067200                                                                  06880099
067300     INSPECT DK-FOB-CODE TALLYING PV-ASTRK-CNT FOR ALL            06890099
067400                                       PC-SPACE.                  06900099
067500     IF PV-ASTRK-CNT > 0                                          06910099
067600         SET ASC-USE-LIKE-CURSOR TO TRUE                          06920099
067700         INSPECT DK-FOB-CODE                                      06930099
067800             REPLACING FIRST PC-SPACE BY PC-PERCENT               06940099
067900         INSPECT ASC-KEY-FOB-CODE                                 06950099
068000             REPLACING FIRST PC-SPACE BY PC-PERCENT               06960099
068100     END-IF.                                                      06970099
068200                                                                  06980099
068300     INSPECT DK-FOB-CODE TALLYING PV-ASTRK-CNT FOR ALL            06990099
068400                                       PC-SPACE.                  07000099
068500     IF PV-ASTRK-CNT > 0                                          07010099
068600         SET ASC-USE-LIKE-CURSOR TO TRUE                          07020099
068700         INSPECT DK-FOB-CODE                                      07030099
068800             REPLACING FIRST PC-SPACE BY PC-PERCENT               07040099
068900         INSPECT ASC-KEY-FOB-CODE                                 07050099
069000             REPLACING FIRST PC-SPACE BY PC-PERCENT               07060099
069100     END-IF.                                                      07070099
069200                                                                  07080099
069300     INSPECT DK-FOB-CODE TALLYING PV-ASTRK-CNT FOR ALL            07090099
069400                                       PC-SPACE.                  07100099
069500     IF PV-ASTRK-CNT > 0                                          07110099
069600         SET ASC-USE-LIKE-CURSOR TO TRUE                          07120099
069700         INSPECT DK-FOB-CODE                                      07130099
069800             REPLACING FIRST PC-SPACE BY PC-PERCENT               07140099
069900         INSPECT ASC-KEY-FOB-CODE                                 07150099
070000             REPLACING FIRST PC-SPACE BY PC-PERCENT               07160099
070100     END-IF.                                                      07170099
070200                                                                  07180099
070300 EJECT                                                            07190099
070400*----------------------------------------------------------------*07200099
070500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07210099
070600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07220099
070700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07230099
070800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07240099
070900* FUNCTION KEYS CAN GET THIS FAR.                                *07250099
071000*----------------------------------------------------------------*07260099
071100                                                                  07270099
071200 2000-PROCESS-PANEL.                                              07280099
071300     EVALUATE TRUE                                                07290099
071400         WHEN DP020-SRC-AID = DP016-CLEAR                         07300099
071500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07310099
071600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07320099
071700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07330099
071800                                                                  07340099
071900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07350099
072000             PERFORM 2050-DELETE-LIST-QUEUE                       07360099
072100             MOVE 0 TO PV-NUMBER-OF-SELECTED-ITEMS                07370099
072200             MOVE ASC-FOB-CNTRY-NAME                              07380099
072300                           (ASC-BLK-SUB ASC-ITEM-SUB)             07390099
072400                                   TO DK-CNTRY-CODE               07400099
072500             MOVE ASC-KEY-FOB-STAT  TO DK-STAT-CDE                07410099
072600             IF ASC-USE-LIKE-CURSOR                               07420099
072700                 MOVE ASC-KEY-FOB-CODE TO                         07430099
072800                      DK-FOB-CODE                                 07440099
072900                 INSPECT DK-CNTRY-CODE TALLYING                   07450099
073000                      PV-ASTRK-CNT FOR ALL                        07460099
073100                                       PC-ASTRK                   07470099
073200                 IF PV-ASTRK-CNT > 0                              07480099
073300                     SET ASC-USE-LIKE-CURSOR TO TRUE              07490099
073400                     INSPECT DK-CNTRY-CODE                        07500099
073500                         REPLACING FIRST PC-ASTRK BY PC-PERCENT   07510099
073600                     INSPECT DK-CNTRY-CODE                        07520099
073700                         REPLACING FIRST PC-ASTRK BY PC-PERCENT   07530099
073800                     INSPECT DK-CNTRY-CODE                        07540099
073900                         REPLACING FIRST PC-SPACE BY PC-PERCENT   07550099
074000                 END-IF                                           07560099
074100             END-IF                                               07570099
074200*            MOVE TR019-STAT-CDE   TO DK-STAT-CDE                 07580099
074300             PERFORM 4000-BUILD-INITIAL-PANEL                     07590099
074400             MOVE +0 TO  ASC-NUMBER-OF-SELECTED-ITEMS             07600099
074500                                                                  07610099
074600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07620099
074700             PERFORM 2140-DESELECT-ALL-ITEMS                      07630099
074800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07640099
074900                                                                  07650099
075000         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07660099
075100             PERFORM 2150-SELECT-ALL-ITEMS                        07670099
075200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07680099
075300                                                                  07690099
075400         WHEN OTHER                                               07700099
075500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07710099
075600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07720099
075700             IF  PS-NO-ERROR                                      07730099
075800                 SET DP030-CONTINUE-GO                            07740099
075900                                 TO TRUE                          07750099
076000                 PERFORM 2100-CHECK-FUNCTION-KEY                  07760099
076100             ELSE                                                 07770099
076200                 SET DP030-OVERRIDE-GO                            07780099
076300                                 TO TRUE                          07790099
076400             END-IF                                               07800099
076500     END-EVALUATE.                                                07810099
076600 EJECT                                                            07820099
076700*----------------------------------------------------------------*07830099
076800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07840099
076900*----------------------------------------------------------------*07850099
077000 2050-DELETE-LIST-QUEUE.                                          07860099
077100                                                                  07870099
077200     EXEC CICS                                                    07880099
077300         DELETEQ TS                                               07890099
077400             QUEUE (ASC-LIST-QUEUE-NAME)                          07900099
077500             RESP  (PV-CICS-RESP)                                 07910099
077600     END-EXEC.                                                    07920099
077700                                                                  07930099
077800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07940099
077900        (PV-CICS-RESP = DFHRESP(QIDERR))                          07950099
078000         CONTINUE                                                 07960099
078100     ELSE                                                         07970099
078200         SET DP013-CICS-ABEND      TO TRUE                        07980099
078300         SET DP013-NO-ROLLBACK     TO TRUE                        07990099
078400                                                                  08000099
078500         MOVE '2050-DELETE-LIST-QUEUE'                            08010099
078600                                   TO DP013-PARAGRAPH             08020099
078700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08030099
078800                                   TO DP013-MESSAGE-TEXT (1)      08040099
078900         PERFORM DP013-0000-PROCESS-ABEND                         08050099
079000     END-IF.                                                      08060099
079100                                                                  08070099
079200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08080099
079300 EJECT                                                            08090099
079400*----------------------------------------------------------------*08100099
079500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08110099
079600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08120099
079700* CICS ARCHITECTURE API.                                         *08130099
079800*----------------------------------------------------------------*08140099
079900 2100-CHECK-FUNCTION-KEY.                                         08150099
080000     EVALUATE TRUE                                                08160099
080100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              08170099
080200         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08180099
080300             IF  ASC-NUMBER-OF-SELECTED-ITEMS > 0                 08190099
080400                 INITIALIZE TR019-INTER-APPL-COMMAREA             08200099
080500                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08210099
080600                                TO TR019-NUMBER-OF-SELECTED-ITEMS 08220099
080700                 PERFORM 5000-PREPARE-SEL-QUEUE                   08230099
080800             ELSE                                                 08240099
080900                 SET DP030-OVERRIDE-GO                            08250099
081000                                   TO TRUE                        08260099
081100                 MOVE PC-TSYMSG-00057                             08270099
081200                                   TO DP020-MSG-NUMBER            08280099
081300                 SET DP020-MSG-WARNING                            08290099
081400                                   TO TRUE                        08300099
081500             END-IF                                               08310099
081600                                                                  08320099
081700         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              08330099
081800             IF  ASC-NUMBER-OF-SELECTED-ITEMS > 0                 08340099
081900                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08350099
082000                            TO TR019-NUMBER-OF-SELECTED-ITEMS     08360099
082100*                                                                 08370099
082200                 MOVE +1 TO ASC-NUMBER-OF-SELECTED-ITEMS          08380099
082300                 INITIALIZE TR019-INTER-APPL-COMMAREA             08390099
082400                 MOVE 'I' TO TR019-STAT-CDE                       08400099
082500                 MOVE SPACES TO TR019-COUNTRY-CODE                08410099
082600                 PERFORM 5000-PREPARE-SEL-QUEUE                   08420099
082700             ELSE                                                 08430099
082800                 IF  ASC-NUMBER-OF-SELECTED-ITEMS < +1            08440099
082900                     MOVE +0 TO ASC-NUMBER-OF-SELECTED-ITEMS      08450099
083000                     INITIALIZE TR019-INTER-APPL-COMMAREA         08460099
083100                     MOVE 'I' TO TR019-STAT-CDE                   08470099
083200                     MOVE SPACES TO TR019-COUNTRY-CODE            08480099
083300                     PERFORM 5000-PREPARE-SEL-QUEUE               08490099
083400                  END-IF                                          08500099
083500             END-IF                                               08510099
083600                                                                  08520099
083700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08530099
083800             MOVE +1               TO PV-TOP-ITEM                 08540099
083900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08550099
084000             PERFORM 3200-RESET-ATTRIBUTES                        08560099
084100                                                                  08570099
084200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08580099
084300             PERFORM 2110-BROWSE-BACKWARD                         08590099
084400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08600099
084500             PERFORM 3200-RESET-ATTRIBUTES                        08610099
084600                                                                  08620099
084700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08630099
084800             PERFORM 2120-BROWSE-FORWARD                          08640099
084900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08650099
085000             PERFORM 3200-RESET-ATTRIBUTES                        08660099
085100                                                                  08670099
085200         WHEN DP020-SRC-AID = DP016-ENTER                         08680099
085300             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08690099
085400             IF  PS-ERROR                                         08700099
085500                 CONTINUE                                         08710099
085600             ELSE                                                 08720099
085700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08730099
085800             END-IF                                               08740099
085900                                                                  08750099
086000         WHEN OTHER                                               08760099
086100             SET DP013-NO-ROLLBACK                                08770099
086200                 DP013-XCTL-DISPLAY-RESTART                       08780099
086300                 DP013-CICS-ABEND  TO TRUE                        08790099
086400             MOVE '2100-CHECK-FUNCTION-KEY'                       08800099
086500                                   TO DP013-PARAGRAPH             08810099
086600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08820099
086700                                   TO DP013-MESSAGE-TEXT (1)      08830099
086800             PERFORM DP013-0000-PROCESS-ABEND                     08840099
086900     END-EVALUATE.                                                08850099
087000*                                                                 08860099
087100*----------------------------------------------------------------*08870099
087200*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08880099
087300*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08890099
087400*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08900099
087500*    MESSAGE.                                                    *08910099
087600*----------------------------------------------------------------*08920099
087700                                                                  08930099
087800 2110-BROWSE-BACKWARD.                                            08940099
087900     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08950099
088000         GIVING PV-TOP-ITEM.                                      08960099
088100*                                                                 08970099
088200     IF  ((PV-TOP-ITEM < +1)                                      08980099
088300       OR (PV-TOP-ITEM = +1))                                     08990099
088400         MOVE +1                   TO PV-TOP-ITEM                 09000099
088500*        -- TOP OF LIST --                                        09010099
088600         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09020099
088700         SET DP020-MSG-INFORMATIONAL TO TRUE                      09030099
088800     END-IF.                                                      09040099
088900                                                                  09050099
089000 EJECT                                                            09060099
089100*----------------------------------------------------------------*09070099
089200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09080099
089300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09090099
089400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09100099
089500*----------------------------------------------------------------*09110099
089600                                                                  09120099
089700 2120-BROWSE-FORWARD.                                             09130099
089800                                                                  09140099
089900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09150099
090000         GIVING PV-TOP-ITEM.                                      09160099
090100     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09170099
090200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09180099
090300                                   TO PV-TOP-ITEM                 09190099
090400*        -- BOTTOM OF LIST --                                     09200099
090500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09210099
090600         SET DP020-MSG-INFORMATIONAL                              09220099
090700                                   TO TRUE                        09230099
090800     ELSE                                                         09240099
090900         COMPUTE PV-BOTTOM-ITEM =                                 09250099
091000             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09260099
091100         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09270099
091200*            -- BOTTOM OF LIST --                                 09280099
091300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09290099
091400             SET DP020-MSG-INFORMATIONAL                          09300099
091500                                   TO TRUE                        09310099
091600         END-IF                                                   09320099
091700     END-IF.                                                      09330099
091800 EJECT                                                            09340099
091900*----------------------------------------------------------------*09350099
092000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09360099
092100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09370099
092200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09380099
092300*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09390099
092400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09400099
092500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09410099
092600*----------------------------------------------------------------*09420099
092700                                                                  09430099
092800 2130-CHECK-FOR-JUMP-BROWSE.                                      09440099
092900     SET PS-NO-ERROR               TO TRUE.                       09450099
093000     IF (ASC-START-ITEM-REQUEST = SPACE)                          09460099
093100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09470099
093200                                   TO PV-TOP-ITEM                 09480099
093300     ELSE                                                         09490099
093400         MOVE ASC-START-ITEM-REQUEST                              09500099
093500                                   TO DP010I-UNEDITED-FIELD       09510099
093600         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09520099
093700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09530099
093800         SET DP010I-NEGATIVE-NOT-ALLOWED                          09540099
093900                                   TO TRUE                        09550099
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09561099
263697              USING DP010I-NUMERIC-EDIT-AREA                      09562099
094100                                                                  09570099
094200         IF  NOT DP010I-ERROR-DETECTED                            09580099
094300             MOVE DP010I-NUMERIC-FIELD                            09590099
094400                                   TO  ASC-START-ITEM-REQUEST-N   09600099
094500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09610099
094600                 IF  ASC-START-ITEM-REQUEST-N >                   09620099
094700                                          ASC-NUMBER-OF-ITEMS-READ09630099
094800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09640099
094900                     COMPUTE PV-TOP-ITEM =                        09650099
095000                             ASC-NUMBER-OF-ITEMS-READ             09660099
095100                             - PC-ITEMS-PER-PANEL + 1             09670099
095200                     IF  PV-TOP-ITEM < +1                         09680099
095300                         MOVE +1   TO PV-TOP-ITEM                 09690099
095400                         MOVE PC-TSYMSG-00070                     09700099
095500                                   TO DP020-MSG-NUMBER            09710099
095600                         SET DP020-MSG-INFORMATIONAL              09720099
095700                                   TO TRUE                        09730099
095800                     END-IF                                       09740099
095900                 ELSE                                             09750099
096000                     MOVE ASC-START-ITEM-REQUEST-N                09760099
096100                                   TO PV-TOP-ITEM                 09770099
096200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09780099
096300                     COMPUTE PV-BOTTOM-ITEM =                     09790099
096400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09800099
096500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09810099
096600*                        -- BOTTOM OF LIST --                     09820099
096700                         MOVE PC-TSYMSG-00070                     09830099
096800                                   TO DP020-MSG-NUMBER            09840099
096900                         SET DP020-MSG-INFORMATIONAL              09850099
097000                                   TO TRUE                        09860099
097100                     END-IF                                       09870099
097200                 END-IF                                           09880099
097300             ELSE                                                 09890099
097400*                --- VALUE OUT OF RANGE ----                      09900099
097500                 MOVE PC-TSYMSG-00101                             09910099
097600                                   TO DP020-MSG-NUMBER            09920099
097700                 MOVE -1           TO ASTRTITL                    09930099
097800                 SET DP030-SET-CURSOR-APPL-1                      09940099
097900                                   TO TRUE                        09950099
098000                 MOVE DP015-REVERSE                               09960099
098100                                   TO ASTRTITH                    09970099
098200                 MOVE DP015-RED    TO ASTRTITC                    09980099
098300                 MOVE DP015-UNP-NUM-BRT-MDT                       09990099
098400                                   TO ASTRTITA                    10000099
098500                 SET DP020-MSG-FATAL                              10010099
098600                                   TO TRUE                        10020099
098700                 SET PS-ERROR      TO TRUE                        10030099
098800             END-IF                                               10040099
098900                                                                  10050099
099000         ELSE                                                     10060099
099100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10070099
099200             MOVE -1               TO ASTRTITL                    10080099
099300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10090099
099400             MOVE DP015-REVERSE    TO ASTRTITH                    10100099
099500             MOVE DP015-RED        TO ASTRTITC                    10110099
099600             MOVE DP015-UNP-NUM-BRT-MDT                           10120099
099700                                   TO ASTRTITA                    10130099
099800             SET DP020-MSG-FATAL   TO TRUE                        10140099
099900             SET PS-ERROR          TO TRUE                        10150099
100000         END-IF                                                   10160099
100100     END-IF.                                                      10170099
100200 EJECT                                                            10180099
100300*----------------------------------------------------------------*10190099
100400*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10200099
100500*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10210099
100600*----------------------------------------------------------------*10220099
100700 2140-DESELECT-ALL-ITEMS.                                         10230099
100800     MOVE +1                       TO ASC-BLK-SUB.                10240099
100900                                                                  10250099
101000     PERFORM 2141-CLEAR-SELECTED-INDS                             10260099
101100         VARYING ASC-ITEM-SUB                                     10270099
101200         FROM 1 BY 1                                              10280099
101300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10290099
101400                                                                  10300099
101500     ADD +1                        TO ASC-BLK-SUB.                10310099
101600                                                                  10320099
101700     PERFORM 2141-CLEAR-SELECTED-INDS                             10330099
101800         VARYING ASC-ITEM-SUB                                     10340099
101900         FROM 1 BY 1                                              10350099
102000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10360099
102100                                                                  10370099
102200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10380099
102300                                   TO PV-LIST-ITEM-NUMBER.        10390099
102400                                                                  10400099
102500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10410099
102600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10420099
102700                                                                  10430099
102800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10440099
102900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10450099
103000         MOVE +1                   TO ASC-BLK-SUB                 10460099
103100                                                                  10470099
103200         PERFORM 5100-WRITE-TEMP-STORAGE                          10480099
103300                                                                  10490099
103400         MOVE +1                   TO PV-BLOCK-NUMBER             10500099
103500                                                                  10510099
103600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10520099
103700             PV-FIRST-BLOCK-IN-ARRAY - 1                          10530099
103800                                                                  10540099
103900         PERFORM                                                  10550099
104000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10560099
104100                                                                  10570099
104200             PERFORM 4410-READ-TEMP-STORAGE                       10580099
104300                                                                  10590099
104400             PERFORM 2141-CLEAR-SELECTED-INDS                     10600099
104500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10610099
104600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10620099
104700                                                                  10630099
104800             PERFORM 5100-WRITE-TEMP-STORAGE                      10640099
104900                                                                  10650099
105000             ADD +1                TO PV-BLOCK-NUMBER             10660099
105100                                                                  10670099
105200         END-PERFORM                                              10680099
105300                                                                  10690099
105400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10700099
105500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10710099
105600                                                                  10720099
105700         PERFORM                                                  10730099
105800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10740099
105900                   ASC-HIGHEST-BLOCK-WRITTEN                      10750099
106000                                                                  10760099
106100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10770099
106200                                   TO PV-BLOCK-NUMBER             10780099
106300                                                                  10790099
106400             PERFORM 4410-READ-TEMP-STORAGE                       10800099
106500                                                                  10810099
106600             PERFORM 2141-CLEAR-SELECTED-INDS                     10820099
106700                 VARYING ASC-ITEM-SUB                             10830099
106800                 FROM 1 BY 1                                      10840099
106900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10850099
107000                                                                  10860099
107100             PERFORM 5100-WRITE-TEMP-STORAGE                      10870099
107200                                                                  10880099
107300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10890099
107400                                                                  10900099
107500         END-PERFORM                                              10910099
107600                                                                  10920099
107700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10930099
107800                                   TO PV-BLOCK-NUMBER             10940099
107900                                                                  10950099
108000         PERFORM 4410-READ-TEMP-STORAGE                           10960099
108100     END-IF.                                                      10970099
108200                                                                  10980099
108300                                                                  10990099
108400     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 11000099
108500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.11010099
108600     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  11020099
108700                                                                  11030099
108800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11040099
108900                                                                  11050099
109000 EJECT                                                            11060099
109100*----------------------------------------------------------------*11070099
109200*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11080099
109300*----------------------------------------------------------------*11090099
109400                                                                  11100099
109500 2141-CLEAR-SELECTED-INDS.                                        11110099
109600                                                                  11120099
109700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11130099
109800             NOT EQUAL ZERO                                       11140099
109900         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11150099
110000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11160099
110100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11170099
110200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11180099
110300                                   TO TRUE                        11190099
110400         END-IF                                                   11200099
110500     END-IF.                                                      11210099
110600                                                                  11220099
110700 EJECT                                                            11230099
110800*----------------------------------------------------------------*11240099
110900*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11250099
111000*  FOR ALL ITEMS.                                                *11260099
111100*----------------------------------------------------------------*11270099
111200                                                                  11280099
111300 2150-SELECT-ALL-ITEMS.                                           11290099
111400                                                                  11300099
111500     MOVE +1                       TO ASC-BLK-SUB.                11310099
111600                                                                  11320099
111700     PERFORM 2151-SET-SELECTED-INDS                               11330099
111800         VARYING ASC-ITEM-SUB                                     11340099
111900         FROM 1 BY 1                                              11350099
112000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11360099
112100                                                                  11370099
112200     ADD +1                        TO ASC-BLK-SUB.                11380099
112300                                                                  11390099
112400     PERFORM 2151-SET-SELECTED-INDS                               11400099
112500         VARYING ASC-ITEM-SUB                                     11410099
112600         FROM 1 BY 1                                              11420099
112700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11430099
112800                                                                  11440099
112900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11450099
113000                                   TO PV-LIST-ITEM-NUMBER.        11460099
113100                                                                  11470099
113200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11480099
113300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11490099
113400                                                                  11500099
113500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11510099
113600        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11520099
113700         MOVE +1                   TO ASC-BLK-SUB                 11530099
113800                                                                  11540099
113900         PERFORM 5100-WRITE-TEMP-STORAGE                          11550099
114000                                                                  11560099
114100         MOVE +1                   TO PV-BLOCK-NUMBER             11570099
114200                                                                  11580099
114300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11590099
114400             PV-FIRST-BLOCK-IN-ARRAY - 1                          11600099
114500                                                                  11610099
114600         PERFORM                                                  11620099
114700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11630099
114800                                                                  11640099
114900             PERFORM 4410-READ-TEMP-STORAGE                       11650099
115000                                                                  11660099
115100             PERFORM 2151-SET-SELECTED-INDS                       11670099
115200                 VARYING ASC-ITEM-SUB                             11680099
115300                 FROM 1 BY 1                                      11690099
115400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11700099
115500                                                                  11710099
115600             PERFORM 5100-WRITE-TEMP-STORAGE                      11720099
115700                                                                  11730099
115800             ADD +1                TO PV-BLOCK-NUMBER             11740099
115900                                                                  11750099
116000         END-PERFORM                                              11760099
116100                                                                  11770099
116200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11780099
116300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11790099
116400                                                                  11800099
116500         PERFORM                                                  11810099
116600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11820099
116700                   ASC-HIGHEST-BLOCK-WRITTEN                      11830099
116800                                                                  11840099
116900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11850099
117000                                   TO PV-BLOCK-NUMBER             11860099
117100                                                                  11870099
117200             PERFORM 4410-READ-TEMP-STORAGE                       11880099
117300                                                                  11890099
117400             PERFORM 2151-SET-SELECTED-INDS                       11900099
117500                 VARYING ASC-ITEM-SUB                             11910099
117600                 FROM 1 BY 1                                      11920099
117700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11930099
117800                                                                  11940099
117900             PERFORM 5100-WRITE-TEMP-STORAGE                      11950099
118000                                                                  11960099
118100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11970099
118200                                                                  11980099
118300         END-PERFORM                                              11990099
118400                                                                  12000099
118500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12010099
118600                                   TO PV-BLOCK-NUMBER             12020099
118700                                                                  12030099
118800         PERFORM 4410-READ-TEMP-STORAGE                           12040099
118900     END-IF.                                                      12050099
119000                                                                  12060099
119100                                                                  12070099
119200**   MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12080099
119300**                     ASC-NUMBER-OF-SELECTED-ITEMS.              12090099
119400                                                                  12100099
119500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12110099
119600                                                                  12120099
119700 EJECT                                                            12130099
119800*----------------------------------------------------------------*12140099
119900*    MARK EACH ITEM AS BEING SELECTED.                           *12150099
120000*----------------------------------------------------------------*12160099
120100                                                                  12170099
120200 2151-SET-SELECTED-INDS.                                          12180099
120300                                                                  12190099
120400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12200099
120500             NOT EQUAL ZERO                                       12210099
120600         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12220099
120700             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12230099
120800                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12240099
120900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12250099
121000                               TO  TRUE                           12260099
121100         END-IF                                                   12270099
121200     END-IF.                                                      12280099
121300******************************************************************12290099
121400** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12300099
121500** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12310099
121600******************************************************************12320099
121700 2200-MOVE-SCREEN-TO-COMMAREA.                                    12330099
121800                                                                  12340099
121900     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12350099
122000     MOVE +1                       TO PV-SUB.                     12360099
122100*                                                                 12370099
122200     PERFORM 3100-SET-SUBSCRIPTS.                                 12380099
122300     IF  ASTRTITL > ZERO                                          12390099
122400         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12400099
122500     ELSE                                                         12410099
122600         IF  ASTRTITF = DP015-ERASE-EOF                           12420099
122700             INITIALIZE ASC-START-ITEM-REQUEST                    12430099
122800         END-IF                                                   12440099
122900     END-IF.                                                      12450099
123000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12460099
123100         VARYING PV-SUB                                           12470099
123200         FROM 1 BY 1                                              12480099
123300         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12490099
123400******************************************************************12500099
123500** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12510099
123600******************************************************************12520099
123700 2210-MOVE-LINES-TO-COMMAREA.                                     12530099
123800     IF  MR-SELECTL (PV-SUB) > ZERO                               12540099
123900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12550099
124000         MOVE MR-SELECTI (PV-SUB)                                 12560099
124100                                   TO ASC-TEMP-SELECTED-SW        12570099
124200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12580099
124300     ELSE                                                         12590099
124400         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12600099
124500                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12610099
124600                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12620099
124700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12630099
124800         END-IF                                                   12640099
124900     END-IF.                                                      12650099
125000     ADD +1                        TO ASC-ITEM-SUB.               12660099
125100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12670099
125200         ADD +1                    TO ASC-BLK-SUB                 12680099
125300         MOVE +1                   TO ASC-ITEM-SUB                12690099
125400     END-IF.                                                      12700099
125500******************************************************************12710099
125600** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **12720099
125700** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **12730099
125800******************************************************************12740099
125900 3000-EDIT-DATA-IN-COMMAREA.                                      12750099
126000     SET PS-NO-ERROR               TO TRUE.                       12760099
126100     PERFORM 3200-RESET-ATTRIBUTES.                               12770099
126200     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12780099
126300**                                                                12790099
126400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12800099
126500* EDITTING IS DONE FROM THE BOTTOM UP.                            12810099
126600**                                                                12820099
126700     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12830099
126800         ASC-ITEMS-DISPLAYED - 1.                                 12840099
126900     PERFORM 3100-SET-SUBSCRIPTS.                                 12850099
127000     PERFORM 3300-EDIT-SELECTIONS                                 12860099
127100         VARYING PV-SUB                                           12870099
127200         FROM PV-SUB BY -1                                        12880099
127300         UNTIL PV-SUB < +1                                        12890099
127400*                                                                 12900099
127500     IF  PS-NO-ERROR                                              12910099
127600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12920099
127700     END-IF.                                                      12930099
127800*                                                                 12940099
127900     IF  ((PS-NO-ERROR)                                           12950099
128000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12960099
128100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12970099
128200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12980099
128300     END-IF.                                                      12990099
128400 EJECT                                                            13000099
128500*----------------------------------------------------------------*13010099
128600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13020099
128700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13030099
128800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13040099
128900*                                                                *13050099
129000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13060099
129100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13070099
129200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13080099
129300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13090099
129400*----------------------------------------------------------------*13100099
129500                                                                  13110099
129600 3100-SET-SUBSCRIPTS.                                             13120099
129700                                                                  13130099
129800     COMPUTE ASC-ITEM-SUB =                                       13140099
129900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13150099
130000                                                                  13160099
130100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13170099
130200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13180099
130300                                                                  13190099
130400         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13200099
130500     ELSE                                                         13210099
130600         MOVE +1                     TO ASC-BLK-SUB               13220099
130700     END-IF.                                                      13230099
130800******************************************************************13240099
130900** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13250099
131000******************************************************************13260099
131100                                                                  13270099
131200 3200-RESET-ATTRIBUTES.                                           13280099
131300     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13290099
131400     MOVE DP015-GREEN              TO ASTRTITC.                   13300099
131500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13310099
131600*                                                                 13320099
131700     PERFORM                                                      13330099
131800         VARYING PV-SUB                                           13340099
131900         FROM 1 BY 1                                              13350099
132000         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13360099
132100         MOVE DP015-UNP-ALP-NOR-OFF                               13370099
132200                                   TO MR-SELECTA (PV-SUB)         13380099
132300         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         13390099
132400         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         13400099
132500     END-PERFORM.                                                 13410099
132600******************************************************************13420099
132700** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **13430099
132800** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **13440099
132900** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **13450099
133000** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **13460099
133100******************************************************************13470099
133200 3300-EDIT-SELECTIONS.                                            13480099
133300     EVALUATE TRUE                                                13490099
133400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13500099
133500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13510099
133600                 CONTINUE                                         13520099
133700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13530099
133800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13540099
133900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13550099
134000                 MOVE ASC-TEMP-SELECTED-SW                        13560099
134100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13570099
134200                                TO ASC-SELECTED-SW                13580099
134300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13590099
134400             END-IF                                               13600099
134500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13610099
134600                 = SPACE                                          13620099
134700             EVALUATE TRUE                                        13630099
134800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13640099
134900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13650099
135000                     MOVE SPACE TO ASC-SELECTED-SW                13660099
135100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13670099
135200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13680099
135300                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13690099
135400                     MOVE SPACE TO ASC-SELECTED-SW                13700099
135500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13710099
135600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13720099
135700                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13730099
135800                     MOVE SPACE TO ASC-SELECTED-SW                13740099
135900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13750099
136000             END-EVALUATE                                         13760099
136100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13770099
136200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13780099
136300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13790099
136400             END-IF                                               13800099
136500             PERFORM 3310-EDIT-RANGE                              13810099
136600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13820099
136700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13830099
136800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13840099
136900             END-IF                                               13850099
137000             PERFORM 3310-EDIT-RANGE                              13860099
137100         WHEN OTHER                                               13870099
137200             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13880099
137300             SET DP020-MSG-FATAL    TO TRUE                       13890099
137400             MOVE -1                TO MR-SELECTL (PV-SUB)        13900099
137500             SET DP030-SET-CURSOR-APPL-1                          13910099
137600                                    TO TRUE                       13920099
137700             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13930099
137800             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13940099
137900             SET PS-ERROR TO TRUE                                 13950099
138000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13960099
138100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13970099
138200                 MOVE SPACE         TO ASC-SELECTED-SW            13980099
138300                                        (ASC-BLK-SUB ASC-ITEM-SUB)13990099
138400             END-IF                                               14000099
138500     END-EVALUATE.                                                14010099
138600***********************************************                   14020099
138700     IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    14030099
138800         MOVE ASC-FOB-CODE (ASC-BLK-SUB ASC-ITEM-SUB) TO          14040099
138900                                   TR019-FOB-CODE                 14050099
139000         MOVE ASC-FOB-CNTRY-CODE (ASC-BLK-SUB ASC-ITEM-SUB) TO    14060099
139100                                   TR019-COUNTRY-CODE             14070099
139200*        MOVE ASC-FOB-CNTRY-NAME (ASC-BLK-SUB ASC-ITEM-SUB) TO    14080099
139300*                                  TR019-COUNTRY-CODE-DESC        14090099
139400         MOVE ASC-FOB-CITY-NAME  (ASC-BLK-SUB ASC-ITEM-SUB) TO    14100099
139500                                   TR019-FOB-CITY-NAME            14110099
139600         MOVE ASC-CONSLR-SCAC    (ASC-BLK-SUB ASC-ITEM-SUB) TO    14120099
139700                 TR019-CONSLR-NAME                                14130099
139800         MOVE ASC-CONSLR-ENT-ID  (ASC-BLK-SUB ASC-ITEM-SUB) TO    14140099
139900                 TR019-CONSLR-ENT-ID                              14150099
140000         MOVE ASC-DECONL-SCAC    (ASC-BLK-SUB ASC-ITEM-SUB) TO    14160099
140100                 TR019-DECONL-NAME                                14170099
140200         MOVE ASC-DECONL-ENT-ID  (ASC-BLK-SUB ASC-ITEM-SUB) TO    14180099
140300                 TR019-DECONL-ENT-ID                              14190099
P5207          MOVE ASC-INCOTERM-CODE  (ASC-BLK-SUB ASC-ITEM-SUB) TO    14200099
P5207                  TR019-INCOTERM-CODE                              14210099
140400         MOVE ASC-CSTM-BKR-SCAC  (ASC-BLK-SUB ASC-ITEM-SUB) TO    14220099
140500                 TR019-CSTM-BKR-NAME                              14230099
140600         MOVE ASC-CSTM-BKR-ENT-ID (ASC-BLK-SUB ASC-ITEM-SUB) TO   14240099
140700                 TR019-CSTM-BKR-ENT-ID                            14250099
140800         MOVE ASC-POE-CODE       (ASC-BLK-SUB ASC-ITEM-SUB) TO    14260099
140900                                   TR019-POE-CODE                 14270099
141000         MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)     14280099
141100                                TO TR019-LIST-ITEM-NUMBER         14290099
141200                                                                  14300099
141300        MOVE ASC-FOB-STD-EDI-CDE  (ASC-BLK-SUB ASC-ITEM-SUB) TO   14310099
141400                 TR019-FOB-STD-EDI-CDE                            14320099
141500***********************************************                   14330099
141600     END-IF                                                       14340099
141700                                                                  14350099
141800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14360099
141900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14370099
142000     IF  ASC-ITEM-SUB < 1                                         14380099
142100         SUBTRACT +1 FROM ASC-BLK-SUB                             14390099
142200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14400099
142300     END-IF.                                                      14410099
142400******************************************************************14420099
142500** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **14430099
142600** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **14440099
142700** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**14450099
142800** THE ENDING.                                                  **14460099
142900******************************************************************14470099
143000 3310-EDIT-RANGE.                                                 14480099
143100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14490099
143200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14500099
143300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14510099
143400                                   TO ASC-SELECTED-SW             14520099
143500                                        (ASC-BLK-SUB ASC-ITEM-SUB)14530099
143600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14540099
143700         ELSE                                                     14550099
143800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14560099
143900                 CONTINUE                                         14570099
144000             ELSE                                                 14580099
144100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14590099
144200                 MOVE PC-TSYMSG-00054                             14600099
144300                                   TO DP020-MSG-NUMBER            14610099
144400                 SET DP020-MSG-FATAL                              14620099
144500                                   TO TRUE                        14630099
144600                 MOVE -1           TO MR-SELECTL (PV-SUB)         14640099
144700                 SET DP030-SET-CURSOR-APPL-1                      14650099
144800                                   TO TRUE                        14660099
144900                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14670099
145000                 MOVE DP015-UNDERLINE                             14680099
145100                                   TO MR-SELECTH (PV-SUB)         14690099
145200                 SET PS-ERROR      TO TRUE                        14700099
145300             END-IF                                               14710099
145400         END-IF                                                   14720099
145500     ELSE                                                         14730099
145600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14740099
145700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14750099
145800                                   TO ASC-SELECTED-SW             14760099
145900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14770099
146000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14780099
146100         ELSE                                                     14790099
146200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14800099
146300                 CONTINUE                                         14810099
146400             ELSE                                                 14820099
146500*                -- ONLY ONE END-OF-RANGE ALLOWED --              14830099
146600                 MOVE PC-TSYMSG-00055                             14840099
146700                                   TO DP020-MSG-NUMBER            14850099
146800                 SET DP020-MSG-FATAL                              14860099
146900                                   TO TRUE                        14870099
147000                 MOVE -1           TO MR-SELECTL (PV-SUB)         14880099
147100                 SET DP030-SET-CURSOR-APPL-1                      14890099
147200                                   TO TRUE                        14900099
147300                 SET PS-ERROR      TO TRUE                        14910099
147400             END-IF                                               14920099
147500         END-IF                                                   14930099
147600     END-IF.                                                      14940099
147700*                                                                 14950099
147800******************************************************************14960099
147900** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **14970099
148000** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **14980099
148100******************************************************************14990099
148200 3400-CHECK-RANGE-SEQUENCE.                                       15000099
148300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15010099
148400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15020099
148500       AND  ASC-START-OF-SELECTED-RANGE >                         15030099
148600                                         ASC-END-OF-SELECTED-RANGE15040099
148700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15050099
148800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 15060099
148900         SET DP020-MSG-FATAL TO TRUE                              15070099
149000         SET PS-ERROR TO TRUE                                     15080099
149100         PERFORM 3410-POSITION-AT-ERROR                           15090099
149200     END-IF.                                                      15100099
149300******************************************************************15110099
149400** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **15120099
149500** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **15130099
149600** SHOULD BE POSITIONED ON A RANGE ERROR.                       **15140099
149700******************************************************************15150099
149800 3410-POSITION-AT-ERROR.                                          15160099
149900     SET DP030-SET-CURSOR-APPL-1                                  15170099
150000                                   TO TRUE.                       15180099
150100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15190099
150200                    - PV-TOP-ITEM + 1.                            15200099
150300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15210099
150400         CONTINUE                                                 15220099
150500     ELSE                                                         15230099
150600         MOVE -1                   TO MR-SELECTL (PV-SUB)         15240099
150700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15250099
150800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15260099
150900     END-IF.                                                      15270099
151000*                                                                 15280099
151100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15290099
151200                    - PV-TOP-ITEM + 1.                            15300099
151300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15310099
151400         CONTINUE                                                 15320099
151500     ELSE                                                         15330099
151600         MOVE -1                   TO MR-SELECTL (PV-SUB)         15340099
151700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15350099
151800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15360099
151900     END-IF.                                                      15370099
152000 EJECT                                                            15380099
152100*----------------------------------------------------------------*15390099
152200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15400099
152300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15410099
152400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15420099
152500*----------------------------------------------------------------*15430099
152600                                                                  15440099
152700 3500-MARK-RANGE-AS-SELECTED.                                     15450099
152800     MOVE +1                       TO  ASC-BLK-SUB.               15460099
152900     PERFORM 3510-MARK-SELECTED-INDS                              15470099
153000         VARYING ASC-ITEM-SUB                                     15480099
153100         FROM 1 BY 1                                              15490099
153200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15500099
153300                                                                  15510099
153400     ADD +1                        TO ASC-BLK-SUB.                15520099
153500     PERFORM 3510-MARK-SELECTED-INDS                              15530099
153600         VARYING ASC-ITEM-SUB                                     15540099
153700         FROM 1 BY 1                                              15550099
153800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15560099
153900                                                                  15570099
154000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15580099
154100                                   TO  PV-LIST-ITEM-NUMBER.       15590099
154200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15600099
154300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15610099
154400               PC-ITEMS-PER-PANEL).                               15620099
154500                                                                  15630099
154600     MOVE ASC-START-OF-SELECTED-RANGE                             15640099
154700                                   TO PV-START-OF-SELECTED-RANGE. 15650099
154800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15660099
154900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15670099
155000               PC-ITEMS-PER-PANEL).                               15680099
155100                                                                  15690099
155200     MOVE ASC-END-OF-SELECTED-RANGE                               15700099
155300                                   TO  PV-END-OF-SELECTED-RANGE.  15710099
155400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15720099
155500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15730099
155600               PC-ITEMS-PER-PANEL).                               15740099
155700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15750099
155800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15760099
155900                                                                  15770099
156000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15780099
156100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15790099
156200         MOVE +1                   TO ASC-BLK-SUB                 15800099
156300         PERFORM 5100-WRITE-TEMP-STORAGE                          15810099
156400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15820099
156500             PV-FIRST-BLOCK-IN-ARRAY - 1                          15830099
156600                                                                  15840099
156700         PERFORM                                                  15850099
156800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15860099
156900                   PV-PREV-BLOCK-IN-ARRAY                         15870099
157000             MOVE PV-FIRST-BLOCK-IN-RANGE                         15880099
157100                                   TO PV-BLOCK-NUMBER             15890099
157200             PERFORM 4410-READ-TEMP-STORAGE                       15900099
157300             PERFORM 3510-MARK-SELECTED-INDS                      15910099
157400                 VARYING ASC-ITEM-SUB                             15920099
157500                 FROM 1 BY 1                                      15930099
157600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15940099
157700             PERFORM 5100-WRITE-TEMP-STORAGE                      15950099
157800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15960099
157900         END-PERFORM                                              15970099
158000                                                                  15980099
158100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15990099
158200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16000099
158300         PERFORM                                                  16010099
158400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16020099
158500                   PV-LAST-BLOCK-IN-RANGE                         16030099
158600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16040099
158700                                   TO PV-BLOCK-NUMBER             16050099
158800             PERFORM 4410-READ-TEMP-STORAGE                       16060099
158900             PERFORM 3510-MARK-SELECTED-INDS                      16070099
159000                 VARYING ASC-ITEM-SUB                             16080099
159100                 FROM 1 BY 1                                      16090099
159200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16100099
159300             PERFORM 5100-WRITE-TEMP-STORAGE                      16110099
159400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16120099
159500         END-PERFORM                                              16130099
159600                                                                  16140099
159700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16150099
159800                                   TO PV-BLOCK-NUMBER             16160099
159900         PERFORM 4410-READ-TEMP-STORAGE                           16170099
160000     END-IF.                                                      16180099
160100                                                                  16190099
160200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16200099
160300                                      ASC-END-OF-SELECTED-RANGE.  16210099
160400                                                                  16220099
160500 EJECT                                                            16230099
160600*----------------------------------------------------------------*16240099
160700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *16250099
160800*----------------------------------------------------------------*16260099
160900                                                                  16270099
161000 3510-MARK-SELECTED-INDS.                                         16280099
161100                                                                  16290099
161200     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16300099
161300                                ASC-ITEM-SUB) >                   16310099
161400         ASC-START-OF-SELECTED-RANGE)                             16320099
161500     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16330099
161600                                ASC-ITEM-SUB) =                   16340099
161700         ASC-START-OF-SELECTED-RANGE)                             16350099
161800                                                                  16360099
161900         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16370099
162000                                    ASC-ITEM-SUB) <               16380099
162100             ASC-END-OF-SELECTED-RANGE)                           16390099
162200         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16400099
162300                                    ASC-ITEM-SUB) =               16410099
162400             ASC-END-OF-SELECTED-RANGE)                           16420099
162500                                                                  16430099
162600             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16440099
162700                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16450099
162800                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16460099
162900                               TO TRUE                            16470099
163000                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16480099
163100                               TO TRUE                            16490099
163200                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16500099
163300             END-IF                                               16510099
163400         END-IF                                                   16520099
163500     END-IF.                                                      16530099
163600                                                                  16540099
163700 EJECT                                                            16550099
163800*----------------------------------------------------------------*16560099
163900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16570099
164000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16580099
164100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16590099
164200*    DISPLAY THE PANEL TO USER.                                  *16600099
164300*----------------------------------------------------------------*16610099
164400                                                                  16620099
164500 4000-BUILD-INITIAL-PANEL.                                        16630099
164600                                                                  16640099
164700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            16650099
164800                                 ASC-BLOCK-ENTRIES (2).           16660099
164900     MOVE +1                 TO ASC-BLK-SUB.                      16670099
165000     SET ASC-ITEMS-LEFT-ON-DB                                     16680099
165100                             TO TRUE.                             16690099
165200                                                                  16700099
165300     MOVE +0                 TO ASC-ITEM-SUB                      16710099
165400                                ASC-NUMBER-OF-ITEMS-READ          16720099
165500                                ASC-NUMBER-OF-SELECTED-ITEMS      16730099
165600                                ASC-HIGHEST-BLOCK-WRITTEN         16740099
165700                                ASC-START-OF-SELECTED-RANGE       16750099
165800                                ASC-END-OF-SELECTED-RANGE         16760099
165900                                ASC-ITEM-AT-TOP-OF-PANEL.         16770099
166000     PERFORM 4100-PREPARE-CURSOR                                  16780099
166100                                                                  16790099
166200     PERFORM 4010-OPEN-CURSOR.                                    16800099
166300                                                                  16810099
166400     PERFORM 4300-READ-ITEMS-FROM-DB.                             16820099
166500                                                                  16830099
166600     PERFORM 4020-CLOSE-CURSOR.                                   16840099
166700                                                                  16850099
166800     MOVE +1                   TO  PV-TOP-ITEM.                   16860099
166900     IF (ASC-NUMBER-OF-ITEMS-READ = ZERO                          16870099
167000         AND PV-NUMBER-OF-SELECTED-ITEMS > 0                      16880099
167100         AND DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-LIST-ACT)  16890099
167200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    16900099
167300         SET DP020-MSG-FATAL   TO  TRUE                           16910099
167400         MOVE PC-TSYMSG-01646  TO  DP020-MSG-NUMBER               16920099
167500         MOVE -1               TO MR-SELECTL (1)                  16930099
167600         SET DP030-SET-CURSOR-APPL-1                              16940099
167700                               TO TRUE                            16950099
167800                 SET DP030-OVERRIDE-GO                            16960099
167900                                 TO TRUE                          16970099
168000                                                                  16980099
168100***  MOVE +1                   TO  PV-TOP-ITEM.                   16990099
168200***  IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17000099
168300***      SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    17010099
168400***      SET DP020-MSG-FATAL   TO  TRUE                           17020099
168500***      MOVE PC-TSYMSG-01451  TO  DP020-MSG-NUMBER               17030099
168600     ELSE                                                         17040099
168700         MOVE -1               TO MR-SELECTL (1)                  17050099
168800         SET DP030-SET-CURSOR-APPL-1                              17060099
168900                               TO TRUE                            17070099
169000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17080099
169100     END-IF.                                                      17090099
169200 EJECT                                                            17100099
169300*----------------------------------------------------------------*17110099
169400* OPEN THE TMESSAGE CURSOR.                                      *17120099
169500*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *17130099
169600*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *17140099
169700*   USER.                                                        *17150099
169800*----------------------------------------------------------------*17160099
169900                                                                  17170099
170000 4010-OPEN-CURSOR.                                                17180099
170100     EVALUATE TRUE                                                17190099
170200         WHEN ASC-USE-LIKE-CURSOR                                 17200099
170300             MOVE 'CURSOR:  FOB-LIKE-CSR'                         17210099
170400                               TO DP013-MESSAGE-TEXT (2)          17220099
170500             EXEC SQL                                             17230099
170600                  OPEN FOB-LIKE-CSR                               17240099
170700             END-EXEC                                             17250099
170800                                                                  17260099
170900         WHEN ASC-USE-ALL-CURSOR                                  17270099
171000             MOVE 'CURSOR:  FOB-ALL-CSR'                          17280099
171100                               TO DP013-MESSAGE-TEXT (2)          17290099
171200             EXEC SQL                                             17300099
171300                  OPEN FOB-ALL-CSR                                17310099
171400             END-EXEC                                             17320099
171500                                                                  17330099
171600     END-EVALUATE.                                                17340099
171700                                                                  17350099
171800     EVALUATE TRUE                                                17360099
171900         WHEN SQLCODE = ZERO                                      17370099
172000             CONTINUE                                             17380099
172100         WHEN SQLWARN0 NOT = SPACES                               17390099
172200         WHEN SQLCODE < ZERO                                      17400099
172300         WHEN SQLCODE > ZERO                                      17410099
172400             MOVE '4010-OPEN-CURSOR'                              17420099
172500                               TO DP013-PARAGRAPH                 17430099
172600             MOVE 'OPEN SYSTEM MESSAGE CURSOR - '                 17440099
172700                               TO DP013-MESSAGE-TEXT (1)          17450099
172800             MOVE SQLCA        TO DP013-SQLCA                     17460099
172900             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        17470099
173000             SET DP013-DB2-ABEND                                  17480099
173100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17490099
173200             PERFORM DP013-0000-PROCESS-ABEND                     17500099
173300     END-EVALUATE.                                                17510099
173400*                                                                 17520099
173500 EJECT                                                            17530099
173600*----------------------------------------------------------------*17540099
173700* CLOSE THE TMESSAGE CURSOR.                                     *17550099
173800*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *17560099
173900*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *17570099
174000*   USER.                                                        *17580099
174100*----------------------------------------------------------------*17590099
174200                                                                  17600099
174300 4020-CLOSE-CURSOR.                                               17610099
174400     EVALUATE TRUE                                                17620099
174500         WHEN ASC-USE-LIKE-CURSOR                                 17630099
174600             MOVE 'CURSOR:  FOB-LIKE-CSR'                         17640099
174700                               TO DP013-MESSAGE-TEXT (2)          17650099
174800             EXEC SQL                                             17660099
174900                  CLOSE FOB-LIKE-CSR                              17670099
175000             END-EXEC                                             17680099
175100                                                                  17690099
175200         WHEN ASC-USE-ALL-CURSOR                                  17700099
175300             MOVE 'CURSOR:  FOB-ALL-CSR'                          17710099
175400                               TO DP013-MESSAGE-TEXT (2)          17720099
175500             EXEC SQL                                             17730099
175600                  CLOSE FOB-ALL-CSR                               17740099
175700             END-EXEC                                             17750099
175800                                                                  17760099
175900     END-EVALUATE.                                                17770099
176000*                                                                 17780099
176100     EVALUATE TRUE                                                17790099
176200         WHEN SQLCODE = ZERO                                      17800099
176300             CONTINUE                                             17810099
176400         WHEN SQLWARN0 NOT = SPACES                               17820099
176500         WHEN SQLCODE < ZERO                                      17830099
176600         WHEN SQLCODE > ZERO                                      17840099
176700             MOVE '4020-CLOSE-CURSOR'                             17850099
176800                               TO DP013-PARAGRAPH                 17860099
176900             MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  17870099
177000                               TO DP013-MESSAGE-TEXT (1)          17880099
177100             MOVE SQLCA        TO DP013-SQLCA                     17890099
177200             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        17900099
177300             SET DP013-DB2-ABEND                                  17910099
177400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17920099
177500             PERFORM DP013-0000-PROCESS-ABEND                     17930099
177600     END-EVALUATE.                                                17940099
177700                                                                  17950099
177800 EJECT                                                            17960099
177900*----------------------------------------------------------------*17970099
178000*    SET UP THE HOST VARIABLES.                                  *17980099
178100*----------------------------------------------------------------*17990099
178200                                                                  18000099
178300 4100-PREPARE-CURSOR.                                             18010099
178400                                                                  18020099
178500     MOVE ASC-KEY-FOB-CODE TO DK-FOB-CODE.                        18030099
178600                                                                  18040099
178700 EJECT                                                            18050099
178800*----------------------------------------------------------------*18060099
178900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18070099
179000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18080099
179100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18090099
179200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18100099
179300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18110099
179400*                                                                *18120099
179500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *18130099
179600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *18140099
179700*    UPON INITIALIZATION.                                        *18150099
179800*----------------------------------------------------------------*18160099
179900                                                                  18170099
180000 4300-READ-ITEMS-FROM-DB.                                         18180099
180100                                                                  18190099
180200     PERFORM                                                      18200099
180300         VARYING PV-READ-COUNT                                    18210099
180400         FROM 1 BY 1                                              18220099
180500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18230099
180600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18240099
180700                                                                  18250099
180800         PERFORM 4310-FETCH                                       18260099
180900                                                                  18270099
181000         IF  ASC-ITEMS-LEFT-ON-DB                                 18280099
181100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18290099
181200                 ADD +1            TO ASC-ITEM-SUB                18300099
181300             ELSE                                                 18310099
181400                 ADD +1            TO ASC-BLK-SUB                 18320099
181500                 MOVE +1           TO ASC-ITEM-SUB                18330099
181600                                                                  18340099
181700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18350099
181800                     MOVE +1       TO ASC-BLK-SUB                 18360099
181900                     SET ASC-BLOCK-MODIFIED (1)                   18370099
182000                                   TO TRUE                        18380099
182100                     PERFORM 5100-WRITE-TEMP-STORAGE              18390099
182200                     MOVE ASC-BLOCK-ENTRIES                       18400099
182300                               (PC-MAX-BLOCKS-IN-ARRAY)           18410099
182400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18420099
182500                     ADD +1        TO ASC-BLK-SUB                 18430099
182600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18440099
182700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18450099
182800                                   TO TRUE                        18460099
182900                 END-IF                                           18470099
183000             END-IF                                               18480099
183100             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18490099
183200             MOVE ASC-NUMBER-OF-ITEMS-READ                        18500099
183300                                   TO ASC-LIST-ITEM-NUMBER        18510099
183400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18520099
183500             MOVE IMFOB-FOB-CDE    TO ASC-FOB-CODE                18530099
183600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18540099
183700             MOVE IMFOB-FOB-STD-EDI-CDE                           18550099
183800                                   TO ASC-FOB-STD-EDI-CDE         18560099
183900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18570099
184000             MOVE IMFOB-FOB-CTY-NM                                18580099
184100                                   TO ASC-FOB-CITY-NAME           18590099
184200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18600099
184300             MOVE IMFOB-FOB-CNTRY-CDE TO                          18610099
184400                                      ASC-FOB-CNTRY-CODE          18620099
184500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18630099
184600             MOVE CNTRY-CNTRY-NM TO DK-CNTRY-CODE                 18640099
184700                                      ASC-FOB-CNTRY-NAME          18650099
184800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18660099
184900                                                                  18670099
185000             MOVE DK-STAT-CDE       TO   ASC-KEY-FOB-STAT         18680099
185100             MOVE IMFOB-CONSLR-ENT-ID TO DK-ENT-ID                18690099
185200             PERFORM 4330-SELECT-SCAC                             18700099
185300                                                                  18710099
185400             MOVE EXTENT-SCAC-CDE                                 18720099
185500                                   TO ASC-CONSLR-SCAC             18730099
185600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18740099
185700             MOVE IMFOB-CONSLR-ENT-ID TO                          18750099
185800                             ASC-CONSLR-ENT-ID                    18760099
185900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18770099
186000             MOVE IMFOB-DCONSLR-ENT-ID TO DK-ENT-ID               18780099
186100             PERFORM 4330-SELECT-SCAC                             18790099
186200                                                                  18800099
186300             MOVE EXTENT-SCAC-CDE                                 18810099
186400                                   TO ASC-DECONL-SCAC             18820099
186500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18830099
186600             MOVE IMFOB-DCONSLR-ENT-ID TO                         18840099
186700                             ASC-DECONL-ENT-ID                    18850099
186800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18860099
P5207              MOVE IMFOB-INCTRM-CDE     TO                         18870099
P5207                              ASC-INCOTERM-CODE                    18880099
P5207                                        (ASC-BLK-SUB ASC-ITEM-SUB) 18890099
186900             MOVE IMFOB-CSTM-BKR-ENT-ID TO                        18900099
187000                             ASC-CSTM-BKR-ENT-ID                  18910099
187100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18920099
187200             MOVE IMFOB-CSTM-BKR-ENT-ID TO DK-ENT-ID              18930099
187300             PERFORM 4330-SELECT-SCAC                             18940099
187400             MOVE EXTENT-SCAC-CDE                                 18950099
187500                                   TO ASC-CSTM-BKR-SCAC           18960099
187600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18970099
187700             MOVE IMFOB-POE-CDE    TO DK-POE-CODE                 18980099
187800                                      ASC-POE-CODE                18990099
187900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19000099
188000         END-IF                                                   19010099
188100     END-PERFORM.                                                 19020099
188200                                                                  19030099
188300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19040099
188400         MOVE +1               TO ASC-BLK-SUB                     19050099
188500         PERFORM 5100-WRITE-TEMP-STORAGE                          19060099
188600         ADD +1                TO ASC-BLK-SUB                     19070099
188700         PERFORM 5100-WRITE-TEMP-STORAGE                          19080099
188800                                                                  19090099
188900         MOVE 1                TO ASC-BLK-SUB                     19100099
189000                                  PV-BLOCK-NUMBER                 19110099
189100         PERFORM 4410-READ-TEMP-STORAGE                           19120099
189200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19130099
189300             MOVE 2            TO ASC-BLK-SUB                     19140099
189400                                  PV-BLOCK-NUMBER                 19150099
189500             PERFORM 4410-READ-TEMP-STORAGE                       19160099
189600         END-IF                                                   19170099
189700     END-IF.                                                      19180099
189800 EJECT                                                            19190099
189900*----------------------------------------------------------------*19200099
190000*    FETCH THE MESSAGE CURSOR.                                   *19210099
190100*----------------------------------------------------------------*19220099
190200                                                                  19230099
190300 4310-FETCH.                                                      19240099
190400                                                                  19250099
190500     EVALUATE TRUE                                                19260099
190600         WHEN ASC-USE-LIKE-CURSOR                                 19270099
190700             MOVE 'CURSOR:  FOB-LIKE-CSR'                         19280099
190800                               TO DP013-MESSAGE-TEXT (2)          19290099
190900             EXEC SQL                                             19300099
191000                  FETCH FOB-LIKE-CSR                              19310099
191100                  INTO  :IMFOB-FOB-CDE                            19320099
191200                      , :IMFOB-FOB-STD-EDI-CDE                    19330099
191300                      , :IMFOB-FOB-CTY-NM                         19340099
191400                      , :IMFOB-FOB-CNTRY-CDE                      19350099
191500                      , :CNTRY-CNTRY-NM                           19360099
191600                      , :IMFOB-CONSLR-ENT-ID                      19370099
191700                      , :IMFOB-CSTM-BKR-ENT-ID                    19380099
191800                      , :IMFOB-POE-CDE                            19390099
191900                      , :IMFOB-DCONSLR-ENT-ID                     19400099
P5207                       , :IMFOB-INCTRM-CDE                         19410099
192000             END-EXEC                                             19420099
192100                                                                  19430099
192200         WHEN ASC-USE-ALL-CURSOR                                  19440099
192300             MOVE 'CURSOR:  FOB-ALL-CSR'                          19450099
192400                               TO DP013-MESSAGE-TEXT (2)          19460099
192500             EXEC SQL                                             19470099
192600                  FETCH FOB-ALL-CSR                               19480099
192700                  INTO  :IMFOB-FOB-CDE                            19490099
192800                      , :IMFOB-FOB-STD-EDI-CDE                    19500099
192900                      , :IMFOB-FOB-CTY-NM                         19510099
193000                      , :IMFOB-FOB-CNTRY-CDE                      19520099
193100                      , :CNTRY-CNTRY-NM                           19530099
193200                      , :IMFOB-CONSLR-ENT-ID                      19540099
193300                      , :IMFOB-CSTM-BKR-ENT-ID                    19550099
193400                      , :IMFOB-POE-CDE                            19560099
193500                      , :IMFOB-DCONSLR-ENT-ID                     19570099
P5207                       , :IMFOB-INCTRM-CDE                         19580099
193600             END-EXEC                                             19590099
193700                                                                  19600099
193800     END-EVALUATE.                                                19610099
193900                                                                  19620099
194000     EVALUATE TRUE                                                19630099
194100         WHEN SQLCODE = ZERO                                      19640099
194200         WHEN SQLCODE = +100                                      19650099
194300              IF PV-NUMBER-OF-SELECTED-ITEMS NOT NUMERIC          19660099
194400                   MOVE 0  TO PV-NUMBER-OF-SELECTED-ITEMS         19670099
194500               END-IF                                             19680099
194600         WHEN SQLWARN0 NOT = SPACE                                19690099
194700         WHEN SQLCODE NOT = ZERO                                  19700099
194800              MOVE '4310-FETCH-CURSOR'                            19710099
194900                               TO DP013-PARAGRAPH                 19720099
195000              MOVE 'FETCH MESSAGE CURSOR'                         19730099
195100                               TO DP013-MESSAGE-TEXT (1)          19740099
195200              MOVE SQLCA       TO DP013-SQLCA                     19750099
195300              SET DP013-DB2-ABEND                                 19760099
195400                               TO TRUE                            19770099
195500              PERFORM DP013-0000-PROCESS-ABEND                    19780099
195600     END-EVALUATE.                                                19790099
195700                                                                  19800099
195800     IF  SQLCODE EQUAL +100                                       19810099
195900         SET ASC-NO-ITEMS-LEFT-ON-DB                              19820099
196000                                   TO TRUE                        19830099
196100     END-IF.                                                      19840099
196200                                                                  19850099
196300 4320-SELECT-COUNTRY.                                             19860099
196400                                                                  19870099
196500     EXEC SQL                                                     19880099
196600         SELECT A.CNTRY_NM                                        19890099
196700            INTO :CNTRY-CNTRY-NM                                  19900099
196800             FROM TCNTRY A                                        19910099
196900             WHERE A.CNTRY_CDE = :DK-CNTRY-CODE                   19920099
197000               AND A.STAT_CDE  = :PC-A                            19930099
197100     END-EXEC                                                     19940099
197200                                                                  19950099
197300         EVALUATE TRUE                                            19960099
197400             WHEN SQLCODE = ZERO                                  19970099
197500                 CONTINUE                                         19980099
197600             WHEN SQLCODE = +100                                  19990099
197700                 MOVE SPACES TO CNTRY-CNTRY-NM                    20000099
197800                 CONTINUE                                         20010099
197900             WHEN OTHER                                           20020099
198000                 MOVE '4320-SELECT-COUNTRY'                       20030099
198100                                   TO DP013-PARAGRAPH             20040099
198200                 MOVE 'SQL ERROR SELECTING COUNTRY NAME'          20050099
198300                                   TO DP013-MESSAGE-TEXT (1)      20060099
198400                 MOVE SQLCA        TO DP013-SQLCA                 20070099
198500                 MOVE 'TCNTRY  '   TO DP013-DB2-TABLE-NAME (1)    20080099
198600                 SET DP013-DB2-ABEND                              20090099
198700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20100099
198800                 PERFORM DP013-0000-PROCESS-ABEND                 20110099
198900         END-EVALUATE.                                            20120099
199000                                                                  20130099
199100 4330-SELECT-SCAC.                                                20140099
199200                                                                  20150099
199300     EXEC SQL                                                     20160099
199400         SELECT B.SCAC_CDE                                        20170099
199500            INTO :EXTENT-SCAC-CDE                                 20180099
199600             FROM TENTNME A,                                      20190099
199700                  TEXTENT B                                       20200099
199800             WHERE A.ENT_ID = B.ENT_ID                            20210099
199900               AND B.ENT_ID = :DK-ENT-ID                          20220099
200000               AND A.TYPE_CDE = :PC-PRIMARY                       20230099
200100     END-EXEC                                                     20240099
200200                                                                  20250099
200300**   EXEC SQL                                                     20260099
200400**       SELECT B.SCAC_CDE                                        20270099
200500**          INTO :EXTENT-SCAC-CDE                                 20280099
200600**           FROM TENTNME A,                                      20290099
200700**                TEXTENT B                                       20300099
200800**           WHERE A.ENT_ID    = B.ENT_ID                         20310099
200900**             AND A.ENT_ID    = :DK-ENT-ID                       20320099
201000**           AND SEQ_NBR =                                        20330099
201100**               (SELECT MAX(SEQ_NBR)                             20340099
201200**                  FROM TENTNME                                  20350099
201300**                 WHERE ENT_ID   = :DK-ENT-ID                    20360099
201400**                   AND TYPE_CDE = :PC-PRIMARY)                  20370099
201500**           AND TYPE_CDE = :PC-PRIMARY                           20380099
201600**   END-EXEC                                                     20390099
201700                                                                  20400099
201800         EVALUATE TRUE                                            20410099
201900             WHEN SQLCODE = -811                                  20420099
202000             WHEN SQLCODE = ZERO                                  20430099
202100                 CONTINUE                                         20440099
202200             WHEN SQLCODE = +100                                  20450099
202300                 MOVE SPACES TO EXTENT-SCAC-CDE                   20460099
202400                 MOVE SPACES TO ENTNME-ENT-NAME-DESC              20470099
202500                 CONTINUE                                         20480099
202600             WHEN OTHER                                           20490099
202700                 MOVE '4330-SELECT-SCAC'                          20500099
202800                                   TO DP013-PARAGRAPH             20510099
202900                 MOVE 'SQL ERROR SELECTING ENTNME NAME'           20520099
203000                                   TO DP013-MESSAGE-TEXT (1)      20530099
203100                 MOVE SQLCA        TO DP013-SQLCA                 20540099
203200                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    20550099
203300                 SET DP013-DB2-ABEND                              20560099
203400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20570099
203500                 PERFORM DP013-0000-PROCESS-ABEND                 20580099
203600         END-EVALUATE.                                            20590099
203700                                                                  20600099
203800 EJECT                                                            20610099
203900*----------------------------------------------------------------*20620099
204000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *20630099
204100*----------------------------------------------------------------*20640099
204200                                                                  20650099
204300 4400-MOVE-COMMAREA-TO-SCREEN.                                    20660099
204400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             20670099
204500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          20680099
204600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          20690099
204700             MOVE +1    TO ASC-BLK-SUB                            20700099
204800             PERFORM 5100-WRITE-TEMP-STORAGE                      20710099
204900             ADD +1     TO ASC-BLK-SUB                            20720099
205000             PERFORM 5100-WRITE-TEMP-STORAGE                      20730099
205100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             20740099
205200                 GIVING PV-BLOCK-NUMBER                           20750099
205300                 REMAINDER PV-REMAINDER                           20760099
205400             IF  PV-REMAINDER > ZERO                              20770099
205500                 ADD +1 TO PV-BLOCK-NUMBER                        20780099
205600             END-IF                                               20790099
205700             MOVE +1    TO ASC-BLK-SUB                            20800099
205800             PERFORM 4410-READ-TEMP-STORAGE                       20810099
205900             ADD +1     TO ASC-BLK-SUB                            20820099
206000                           PV-BLOCK-NUMBER                        20830099
206100             PERFORM 4410-READ-TEMP-STORAGE                       20840099
206200     END-IF.                                                      20850099
206300     MOVE +1            TO ASC-BLK-SUB.                           20860099
206400     COMPUTE ASC-ITEM-SUB =                                       20870099
206500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              20880099
206600         + PC-ITEMS-PER-PANEL).                                   20890099
206700*                                                                 20900099
206800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        20910099
206900         ADD +1         TO ASC-BLK-SUB                            20920099
207000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            20930099
207100     END-IF.                                                      20940099
207200*                                                                 20950099
207300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           20960099
207400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                20970099
207500     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        20980099
207600     PERFORM 4420-FORMAT-LIST-LINES                               20990099
207700         VARYING PV-SUB                                           21000099
207800         FROM PC-ITEMS-PER-PANEL BY -1                            21010099
207900         UNTIL PV-SUB < +1.                                       21020099
208000*                                                                 21030099
208100     COMPUTE ASC-ITEMS-DISPLAYED =                                21040099
208200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          21050099
208300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    21060099
208400                                      ASTRTITO.                   21070099
208500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    21080099
208600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    21090099
208700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21100099
208800                                   TO ASELITO.                    21110099
208900*                                                                 21120099
209000*                                                                 21130099
209100     IF  DP020-MSG-NUMBER-X = SPACE                               21140099
209200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  21150099
209300*            --- MORE ITEMS TO DISPLAY ----                       21160099
209400             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            21170099
209500             SET DP020-MSG-INFORMATIONAL TO TRUE                  21180099
209600         END-IF                                                   21190099
209700        IF ASC-KEY-FOB-STAT = 'I'                                 21200099
209800           MOVE PC-TSYMSG-01645  TO DP020-MSG-NUMBER              21210099
209900                SET DP020-MSG-INFORMATIONAL TO TRUE               21220099
210000        END-IF                                                    21230099
210100     END-IF.                                                      21240099
210200*----------------------------------------------------------------*21250099
210300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *21260099
210400*----------------------------------------------------------------*21270099
210500                                                                  21280099
210600 4410-READ-TEMP-STORAGE.                                          21290099
210700                                                                  21300099
210800     EXEC CICS                                                    21310099
210900         READQ TS                                                 21320099
211000             QUEUE (ASC-LIST-QUEUE-NAME)                          21330099
211100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21340099
211200             ITEM  (PV-BLOCK-NUMBER)                              21350099
211300             RESP  (PV-CICS-RESP)                                 21360099
211400     END-EXEC.                                                    21370099
211500                                                                  21380099
211600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       21390099
211700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     21400099
211800         CONTINUE                                                 21410099
211900     ELSE                                                         21420099
212000         SET DP013-CICS-ABEND     TO TRUE                         21430099
212100         SET DP013-NO-ROLLBACK    TO TRUE                         21440099
212200         MOVE '4410-READ-TEMP-STORAGE'                            21450099
212300                                  TO DP013-PARAGRAPH              21460099
212400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      21470099
212500                                  TO DP013-MESSAGE-TEXT(1)        21480099
212600         PERFORM DP013-0000-PROCESS-ABEND                         21490099
212700     END-IF.                                                      21500099
212800                                                                  21510099
212900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             21520099
213000*                                                                 21530099
213100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         21540099
213200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               21550099
213300     END-IF.                                                      21560099
213400 EJECT                                                            21570099
213500*----------------------------------------------------------------*21580099
213600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *21590099
213700*----------------------------------------------------------------*21600099
213800                                                                  21610099
213900 4420-FORMAT-LIST-LINES.                                          21620099
214000                                                                  21630099
214100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      21640099
214200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                21650099
214300         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           21660099
214400         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           21670099
214500         MOVE SPACE              TO MR-SELECTI (PV-SUB)           21680099
214600                                                                  21690099
214700         MOVE SPACE              TO MR-CITY-NAME (PV-SUB)         21700099
214800                                    MR-FOB-CODE (PV-SUB)          21710099
214900                                    MR-EDI-CODE (PV-SUB)          21720099
215000                                    MR-CITY-NAME (PV-SUB)         21730099
215100                                    MR-COUNTRY-NAME (PV-SUB)      21740099
215200                                    MR-CONSL-SCAC (PV-SUB)        21750099
215300                                    MR-DECON-SCAC (PV-SUB)        21760099
215400                                    MR-CUSTMS-BKR-SCAC (PV-SUB)   21770099
215500                                    MR-POE(PV-SUB)                21780099
P5207                                     MR-INCOT-CODE(PV-SUB)         21790099
215600     ELSE                                                         21800099
215700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21810099
215800                                                   > SPACE        21820099
215900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21830099
216000                                 TO MR-SELECTI (PV-SUB)           21840099
216100*                                                                 21850099
216200         ELSE                                                     21860099
216300             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21870099
216400                                 TO MR-SELECTI (PV-SUB)           21880099
216500         END-IF                                                   21890099
216600*                                                                 21900099
216700         IF  DP030-SET-CURSOR-TRAILER                             21910099
216800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)21920099
216900                 > SPACE)                                         21930099
217000               OR (PV-SUB = 1))                                   21940099
217100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               21950099
217200                MOVE -1          TO MR-SELECTL (PV-SUB)           21960099
217300             END-IF                                               21970099
217400         END-IF                                                   21980099
217500*                                                                 21990099
217600         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           22000099
217700             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           22010099
217800                                 TO MR-ACTION (PV-SUB)            22020099
217900             MOVE ASC-FOB-CODE (ASC-BLK-SUB ASC-ITEM-SUB)         22030099
218000                                 TO MR-FOB-CODE (PV-SUB)          22040099
218100             MOVE ASC-FOB-STD-EDI-CDE(ASC-BLK-SUB ASC-ITEM-SUB)   22050099
218200                                 TO MR-EDI-CODE (PV-SUB)          22060099
218300             MOVE ASC-FOB-CITY-NAME  (ASC-BLK-SUB ASC-ITEM-SUB)   22070099
218400                                 TO MR-CITY-NAME (PV-SUB)         22080099
218500             MOVE ASC-FOB-CNTRY-NAME (ASC-BLK-SUB ASC-ITEM-SUB)   22090099
218600                                 TO MR-COUNTRY-NAME (PV-SUB)      22100099
218700             MOVE ASC-CONSLR-SCAC    (ASC-BLK-SUB ASC-ITEM-SUB)   22110099
218800                                 TO MR-CONSL-SCAC (PV-SUB)        22120099
218900             MOVE ASC-DECONL-SCAC    (ASC-BLK-SUB ASC-ITEM-SUB)   22130099
219000                                 TO MR-DECON-SCAC (PV-SUB)        22140099
P5207              MOVE ASC-INCOTERM-CODE  (ASC-BLK-SUB ASC-ITEM-SUB)   22150099
P5207                                  TO MR-INCOT-CODE (PV-SUB)        22160099
219100             MOVE ASC-CSTM-BKR-SCAC  (ASC-BLK-SUB ASC-ITEM-SUB)   22170099
219200                                 TO MR-CUSTMS-BKR-SCAC (PV-SUB)   22180099
219300             MOVE ASC-POE-CODE       (ASC-BLK-SUB ASC-ITEM-SUB)   22190099
219400                                 TO MR-POE(PV-SUB)                22200099
219500         END-IF                                                   22210099
219600     END-IF.                                                      22220099
219700     SUBTRACT +1 FROM ASC-ITEM-SUB                                22230099
219800     IF  ASC-ITEM-SUB < + 1                                       22240099
219900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  22250099
220000         MOVE +1                 TO ASC-BLK-SUB                   22260099
220100     END-IF.                                                      22270099
220200******************************************************************22280099
220300** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **22290099
220400** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **22300099
220500** ISSUE A WARNING.                                             **22310099
220600******************************************************************22320099
220700 4430-CHECK-FOR-BEGIN-AND-END.                                    22330099
220800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       22340099
220900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     22350099
221000*            -- NO END-OF-RANGE SPECFIED ---                      22360099
221100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            22370099
221200             SET DP020-MSG-WARNING TO TRUE                        22380099
221300             PERFORM 4431-POSITION-AT-WARNING                     22390099
221400         END-IF                                                   22400099
221500     ELSE                                                         22410099
221600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     22420099
221700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                22430099
221800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            22440099
221900             SET DP020-MSG-WARNING TO TRUE                        22450099
222000             PERFORM 4431-POSITION-AT-WARNING                     22460099
222100         END-IF                                                   22470099
222200     END-IF.                                                      22480099
222300******************************************************************22490099
222400** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **22500099
222500** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **22510099
222600** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **22520099
222700** POSITION THE CURSOR THERE.                                   **22530099
222800******************************************************************22540099
222900 4431-POSITION-AT-WARNING.                                        22550099
223000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 22560099
223100                    - PV-TOP-ITEM + 1.                            22570099
223200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      22580099
223300         CONTINUE                                                 22590099
223400     ELSE                                                         22600099
223500         SET DP030-SET-CURSOR-APPL-1                              22610099
223600                                   TO TRUE                        22620099
223700         MOVE -1                   TO MR-SELECTL (PV-SUB)         22630099
223800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22640099
223900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22650099
224000     END-IF.                                                      22660099
224100*                                                                 22670099
224200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   22680099
224300                    - PV-TOP-ITEM + 1.                            22690099
224400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      22700099
224500         CONTINUE                                                 22710099
224600     ELSE                                                         22720099
224700         SET DP030-SET-CURSOR-APPL-1                              22730099
224800                                   TO TRUE                        22740099
224900         MOVE -1                   TO MR-SELECTL (PV-SUB)         22750099
225000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22760099
225100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22770099
225200     END-IF.                                                      22780099
225300 EJECT                                                            22790099
225400*----------------------------------------------------------------*22800099
225500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *22810099
225600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *22820099
225700* FOR THE SELECTED ITEMS QUEUE.                                  *22830099
225800*                                                                *22840099
225900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *22850099
226000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *22860099
226100* THE ARRAY IS FULL.                                             *22870099
226200*----------------------------------------------------------------*22880099
226300                                                                  22890099
226400 5000-PREPARE-SEL-QUEUE.                                          22900099
226500                                                                  22910099
226600     MOVE +1                   TO  ASC-BLK-SUB.                   22920099
226700     PERFORM 5100-WRITE-TEMP-STORAGE.                             22930099
226800     ADD +1                    TO  ASC-BLK-SUB.                   22940099
226900     PERFORM 5100-WRITE-TEMP-STORAGE.                             22950099
227000                                                                  22960099
227100     MOVE ASC-SEL-QUEUE-NAME  TO  TR019-SEL-QUEUE-NAME.           22970099
227200                                                                  22980099
227300     PERFORM 6010-DELETE-SEL-QUEUE.                               22990099
227400                                                                  23000099
227500     SET ASC-UPDATE-TSQ        TO  TRUE.                          23010099
227600                                                                  23020099
227700     SET TR021-IDX             TO  1.                             23030099
227800     MOVE ZERO                 TO TR019-NUMBER-OF-TS-ITEMS.       23040099
227900     INITIALIZE TR021-SELECTED-ITEM-ARRAY.                        23050099
228000                                                                  23060099
228100     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           23070099
228200             VARYING PV-ITEM                                      23080099
228300             FROM 1 BY 1                                          23090099
228400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     23100099
228500                                                                  23110099
228600     IF  TR021-IDX > 1                                            23120099
228700         PERFORM 5205-WRITE-SEL-QUEUE                             23130099
228800         ADD +1                TO TR019-NUMBER-OF-TS-ITEMS        23140099
228900     END-IF.                                                      23150099
229000 EJECT                                                            23160099
229100*----------------------------------------------------------------*23170099
229200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *23180099
229300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *23190099
229400*----------------------------------------------------------------*23200099
229500                                                                  23210099
229600 5100-WRITE-TEMP-STORAGE.                                         23220099
229700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23230099
229800                                   TO PV-LIST-ITEM-NUMBER.        23240099
229900     COMPUTE PV-BLOCK-NUMBER =                                    23250099
230000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    23260099
230100                                                                  23270099
230200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             23280099
230300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             23290099
230400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      23300099
230500             PERFORM 5105-REWRITE-ASC-LISTQ                       23310099
230600         END-IF                                                   23320099
230700     ELSE                                                         23330099
230800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23340099
230900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            23350099
231000         PERFORM 5110-WRITE-ASC-LISTQ                             23360099
231100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   23370099
231200     END-IF.                                                      23380099
231300                                                                  23390099
231400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23400099
231500******************************************************************23410099
231600** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **23420099
231700** SPECIFIC COMMAREA.                                           **23430099
231800******************************************************************23440099
231900 5105-REWRITE-ASC-LISTQ.                                          23450099
232000     EXEC CICS                                                    23460099
232100         WRITEQ TS                                                23470099
232200             QUEUE (ASC-LIST-QUEUE-NAME)                          23480099
232300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23490099
232400             ITEM  (PV-BLOCK-NUMBER)                              23500099
232500             REWRITE                                              23510099
232600             RESP  (PV-CICS-RESP)                                 23520099
232700     END-EXEC.                                                    23530099
232800                                                                  23540099
232900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           23550099
233000         CONTINUE                                                 23560099
233100     ELSE                                                         23570099
233200         SET DP013-CICS-ABEND            TO TRUE                  23580099
233300         SET DP013-NO-ROLLBACK           TO TRUE                  23590099
233400         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       23600099
233500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     23610099
233600                                         TO DP013-MESSAGE-TEXT(1) 23620099
233700         PERFORM DP013-0000-PROCESS-ABEND                         23630099
233800     END-IF.                                                      23640099
233900                                                                  23650099
234000******************************************************************23660099
234100** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **23670099
234200** SPECIFIC COMMAREA.                                           **23680099
234300******************************************************************23690099
234400 5110-WRITE-ASC-LISTQ.                                            23700099
234500     EXEC CICS                                                    23710099
234600         WRITEQ TS                                                23720099
234700             QUEUE (ASC-LIST-QUEUE-NAME)                          23730099
234800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23740099
234900             ITEM  (PV-BLOCK-NUMBER)                              23750099
235000             RESP  (PV-CICS-RESP)                                 23760099
235100     END-EXEC.                                                    23770099
235200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      23780099
235300         SET DP013-CICS-ABEND      TO TRUE                        23790099
235400         SET DP013-NO-ROLLBACK     TO TRUE                        23800099
235500         MOVE '5110-WRITE-ASC-LISTQ'                              23810099
235600                                   TO DP013-PARAGRAPH             23820099
235700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           23830099
235800                                   TO DP013-MESSAGE-TEXT(1)       23840099
235900         PERFORM DP013-0000-PROCESS-ABEND                         23850099
236000     END-IF.                                                      23860099
236100 EJECT                                                            23870099
236200*----------------------------------------------------------------*23880099
236300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *23890099
236400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *23900099
236500*----------------------------------------------------------------*23910099
236600                                                                  23920099
236700 5200-FILL-SEL-QUEUE-RECORD.                                      23930099
236800                                                                  23940099
236900     PERFORM 6112-READ-LIST-QUEUE.                                23950099
237000                                                                  23960099
237100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       23970099
237200         PERFORM                                                  23980099
237300         VARYING LQW-IDX                                          23990099
237400         FROM 1 BY 1                                              24000099
237500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            24010099
237600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          24020099
237700                                                                  24030099
237800             IF  LQW-SELECT (LQW-IDX)                             24040099
237900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              24050099
238000                                   TO TR021-ITEM (TR021-IDX)      24060099
238100                 MOVE LQW-FOB-CODE (LQW-IDX)                      24070099
238200                            TO TR021-FOB-CODE (TR021-IDX)         24080099
238300                               TR019-FOB-CODE                     24090099
238400                 MOVE LQW-FOB-COUNTRY-CODE (LQW-IDX)              24100099
238500                            TO TR021-FOB-CNTRY-CODE (TR021-IDX)   24110099
238600                               TR019-COUNTRY-CODE                 24120099
238700                 MOVE LQW-FOB-COUNTRY-NAME (LQW-IDX)              24130099
238800                            TO TR021-FOB-CNTRY-NAME (TR021-IDX)   24140099
238900*                              TR019-COUNTRY-CODE-DESC            24150099
239000                 MOVE LQW-FOB-CITY-NAME (LQW-IDX)                 24160099
239100                            TO TR021-FOB-CITY-NAME (TR021-IDX)    24170099
239200                               TR019-FOB-CITY-NAME                24180099
239300                 MOVE LQW-CONSLR-SCAC (LQW-IDX)                   24190099
239400                            TO TR021-CONSLR-SCAC (TR021-IDX)      24200099
239500                               TR019-CONSLR-SCAC                  24210099
239600                 MOVE LQW-CONSLR-ENT-ID (LQW-IDX)                 24220099
239700                            TO TR021-CONSLR-ENT-ID (TR021-IDX)    24230099
239800                               TR019-CONSLR-ENT-ID                24240099
239900                 MOVE LQW-DECONL-SCAC (LQW-IDX)                   24250099
240000                            TO TR021-DECONL-SCAC (TR021-IDX)      24260099
240100                               TR019-DECONL-SCAC                  24270099
240200                 MOVE LQW-DECONL-ENT-ID (LQW-IDX)                 24280099
240300                            TO TR021-DECONL-ENT-ID (TR021-IDX)    24290099
240400                               TR019-DECONL-ENT-ID                24300099
P5207                  MOVE LQW-INCOTERM-CODE (LQW-IDX)                 24310099
P5207                             TO TR021-INCOTERM-CODE (TR021-IDX)    24320099
P5207                                TR019-INCOTERM-CODE                24330099
240500                 MOVE LQW-CSTM-BKR-SCAC (LQW-IDX)                 24340099
240600                            TO TR021-CSTM-BKR-SCAC (TR021-IDX)    24350099
240700                               TR019-CSTM-BKR-SCAC                24360099
240800                 MOVE LQW-CSTM-BKR-ENT-ID (LQW-IDX)               24370099
240900                            TO TR021-CSTM-BKR-ENT-ID (TR021-IDX)  24380099
241000                               TR019-CSTM-BKR-ENT-ID              24390099
241100                 MOVE LQW-POE-NAME (LQW-IDX)                      24400099
241200                            TO TR021-POE-CODE (TR021-IDX)         24410099
241300                               TR019-POE-CODE                     24420099
241400                 MOVE LQW-FOB-STD-EDI-CDE (LQW-IDX)               24430099
241500                            TO TR021-FOB-STD-EDI-CDE (TR021-IDX)  24440099
241600                               TR019-FOB-STD-EDI-CDE              24450099
241700*                                                                 24460099
241800                 MOVE SPACE        TO TR021-ACTION-SW (TR021-IDX) 24470099
241900                 SET TR021-IDX UP BY 1                            24480099
242000                 IF  TR021-IDX > TR021-MAX-ITEMS                  24490099
242100                     PERFORM 5205-WRITE-SEL-QUEUE                 24500099
242200                     ADD +1        TO TR019-NUMBER-OF-TS-ITEMS    24510099
242300                     INITIALIZE TR021-SELECTED-ITEM-ARRAY         24520099
242400                     SET TR021-IDX TO  1                          24530099
242500                     CONTINUE                                     24540099
242600                 END-IF                                           24550099
242700             END-IF                                               24560099
242800         END-PERFORM                                              24570099
242900     END-IF.                                                      24580099
243000                                                                  24590099
243100*----------------------------------------------------------------*24600099
243200*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *24610099
243300*----------------------------------------------------------------*24620099
243400                                                                  24630099
243500 5205-WRITE-SEL-QUEUE.                                            24640099
243600                                                                  24650099
243700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            24660099
243800                                   TO TR021-SELECTED-ITEMS.       24670099
243900                                                                  24680099
244000     EXEC CICS                                                    24690099
244100          WRITEQ TS                                               24700099
244200              QUEUE (ASC-SEL-QUEUE-NAME)                          24710099
244300              FROM  (TR021-FOB-SEL-REC)                           24720099
244400              ITEM  (PV-SEL-QUEUE-ITEM)                           24730099
244500              RESP  (PV-CICS-RESP)                                24740099
244600     END-EXEC.                                                    24750099
244700                                                                  24760099
244800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24770099
244900         CONTINUE                                                 24780099
245000     ELSE                                                         24790099
245100         SET DP013-CICS-ABEND      TO TRUE                        24800099
245200         SET DP013-NO-ROLLBACK     TO TRUE                        24810099
245300         MOVE '5205-WRITE-SEL-QUEUE'                              24820099
245400                                   TO DP013-PARAGRAPH             24830099
245500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          24840099
245600                                   TO DP013-MESSAGE-TEXT(1)       24850099
245700         PERFORM DP013-0000-PROCESS-ABEND                         24860099
245800     END-IF.                                                      24870099
245900 EJECT                                                            24880099
246000******************************************************************24890099
246100** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **24900099
246200** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **24910099
246300** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **24920099
246400** THE USER.                                                    **24930099
246500******************************************************************24940099
246600 6000-REFRESH-PANEL-FROM-TEMP.                                    24950099
246700     IF  ASC-UPDATE-TSQ                                           24960099
246800         SET ASC-NO-TSQ-UPDATE TO TRUE                            24970099
246900         MOVE ZERO                 TO PV-SAVE-ITEM                24980099
247000                                      PV-SEL-QUEUE-ITEM           24990099
247100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        25000099
247200                                   TO PV-HOLD-SELECTED-ITEMS      25010099
247300         MOVE +1                   TO PV-ITEMS-PROCESSED          25020099
247400         PERFORM 6100-UPDATE-TSQ                                  25030099
247500             UNTIL PV-ITEMS-PROCESSED >                           25040099
247600                                     PV-HOLD-SELECTED-ITEMS       25050099
247700         PERFORM 6010-DELETE-SEL-QUEUE                            25060099
247800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         25070099
247900                    ASC-BLOCK-ENTRIES (2)                         25080099
248000     END-IF.                                                      25090099
248100                                                                  25100099
248200*----------------------------------------------------------------*25110099
248300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *25120099
248400*----------------------------------------------------------------*25130099
248500 6010-DELETE-SEL-QUEUE.                                           25140099
248600                                                                  25150099
248700     EXEC CICS                                                    25160099
248800         DELETEQ TS                                               25170099
248900             QUEUE (ASC-SEL-QUEUE-NAME)                           25180099
249000             RESP  (PV-CICS-RESP)                                 25190099
249100     END-EXEC.                                                    25200099
249200*                                                                 25210099
249300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      25220099
249400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         25230099
249500         CONTINUE                                                 25240099
249600     ELSE                                                         25250099
249700         SET DP013-CICS-ABEND TO TRUE                             25260099
249800         SET DP013-NO-ROLLBACK TO TRUE                            25270099
249900         MOVE '6010-DELETE-SEL-QUEUE'                             25280099
250000                        TO DP013-PARAGRAPH                        25290099
250100         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         25300099
250200                        TO DP013-MESSAGE-TEXT (1)                 25310099
250300         PERFORM DP013-0000-PROCESS-ABEND                         25320099
250400     END-IF.                                                      25330099
250500                                                                  25340099
250600*----------------------------------------------------------------*25350099
250700*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *25360099
250800*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *25370099
250900*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *25380099
251000*    THE TEMP QUEUE.                                             *25390099
251100*----------------------------------------------------------------*25400099
251200                                                                  25410099
251300 6100-UPDATE-TSQ.                                                 25420099
251400                                                                  25430099
251500     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             25440099
251600     PERFORM 6105-READ-SEL-QUEUE.                                 25450099
251700     PERFORM                                                      25460099
251800         VARYING TR021-IDX                                        25470099
251900         FROM 1 BY 1                                              25480099
252000         UNTIL ((PV-ITEMS-PROCESSED >                             25490099
252100                              PV-HOLD-SELECTED-ITEMS)             25500099
252200         OR (TR021-IDX GREATER THAN TR021-MAX-ITEMS))             25510099
252300         IF  TR021-ACTION-SW (TR021-IDX) > SPACE                  25520099
252400             PERFORM 6110-PROCESS-ITEMS                           25530099
252500         END-IF                                                   25540099
252600         ADD +1                TO PV-ITEMS-PROCESSED              25550099
252700     END-PERFORM.                                                 25560099
252800     PERFORM 6111-WRITE-LIST-QUEUE.                               25570099
252900*----------------------------------------------------------------*25580099
253000*    READ THE LIST QUEUE RECORD.                                 *25590099
253100*----------------------------------------------------------------*25600099
253200                                                                  25610099
253300 6105-READ-SEL-QUEUE.                                             25620099
253400                                                                  25630099
253500     EXEC CICS                                                    25640099
253600          READQ TS                                                25650099
253700              QUEUE (ASC-SEL-QUEUE-NAME)                          25660099
253800              INTO  (TR021-FOB-SEL-REC)                           25670099
253900              ITEM  (PV-SEL-QUEUE-ITEM)                           25680099
254000              RESP  (PV-CICS-RESP)                                25690099
254100     END-EXEC.                                                    25700099
254200*                                                                 25710099
254300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25720099
254400         CONTINUE                                                 25730099
254500     ELSE                                                         25740099
254600         SET DP013-CICS-ABEND      TO  TRUE                       25750099
254700         SET DP013-NO-ROLLBACK     TO  TRUE                       25760099
254800         MOVE '6105-READ-SEL-QUEUE'                               25770099
254900                                   TO  DP013-PARAGRAPH            25780099
255000         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           25790099
255100                                   TO  DP013-MESSAGE-TEXT(1)      25800099
255200         PERFORM DP013-0000-PROCESS-ABEND                         25810099
255300     END-IF.                                                      25820099
255400 EJECT                                                            25830099
255500*----------------------------------------------------------------*25840099
255600*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*25850099
255700*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*25860099
255800*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *25870099
255900*----------------------------------------------------------------*25880099
256000                                                                  25890099
256100 6110-PROCESS-ITEMS.                                              25900099
256200                                                                  25910099
256300     COMPUTE PV-ITEM = 1 + ((TR021-ITEM (TR021-IDX) - 1)          25920099
256400                     / PC-ITEMS-PER-PANEL).                       25930099
256500                                                                  25940099
256600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           25950099
256700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          25960099
256800             PERFORM 6111-WRITE-LIST-QUEUE                        25970099
256900         END-IF                                                   25980099
257000         MOVE PV-ITEM          TO PV-SAVE-ITEM                    25990099
257100                                                                  26000099
257200         PERFORM 6112-READ-LIST-QUEUE                             26010099
257300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               26020099
257400             CONTINUE                                             26030099
257500         END-IF                                                   26040099
257600     END-IF.                                                      26050099
257700                                                                  26060099
257800     COMPUTE PV-SUB = (TR021-ITEM (TR021-IDX)                     26070099
257900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              26080099
258000     SET LQW-DESELECT (PV-SUB) TO    TRUE                         26090099
258100     MOVE LQW-SELECTED-SW (PV-SUB)                                26100099
258200                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  26110099
258300     EVALUATE TRUE                                                26120099
258400         WHEN TR021-INQ (TR021-IDX)                               26130099
258500              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             26140099
258600                                                                  26150099
258700         WHEN TR021-UPD (TR021-IDX)                               26160099
258800              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             26170099
258900***                                                               26180099
259000***           MOVE TR019-COUNTRY-CODE-DESC                        26190099
259100***                            TO LQW-COUNTRY-DESC (PV-SUB)       26200099
259200              MOVE TR019-COUNTRY-CODE TO                          26210099
259300                             LQW-FOB-COUNTRY-CODE (PV-SUB)        26220099
                    PERFORM 6200-SELECT-COUNTRY-DESC                    26230099
259400*             MOVE TR019-COUNTRY-CODE-DESC TO                     26240099
259500*                            LQW-FOB-COUNTRY-NAME (PV-SUB)        26250099
259600              MOVE TR019-FOB-CODE TO                              26260099
259700                             LQW-FOB-CODE (PV-SUB)                26270099
259800              MOVE TR019-FOB-CITY-NAME TO                         26280099
259900                             LQW-FOB-CITY-NAME (PV-SUB)           26290099
260000              MOVE TR019-POE-CODE TO                              26300099
260100                             LQW-POE-NAME (PV-SUB)                26310099
260200              MOVE TR019-CONSLR-ENT-ID TO                         26320099
260300                             LQW-CONSLR-ENT-ID (PV-SUB)           26330099
260400              MOVE TR019-DECONL-ENT-ID TO                         26340099
260500                             LQW-DECONL-ENT-ID (PV-SUB)           26350099
260600              MOVE TR019-CSTM-BKR-ENT-ID TO                       26360099
260700                             LQW-CSTM-BKR-ENT-ID (PV-SUB)         26370099
260800              MOVE TR019-FOB-STD-EDI-CDE TO                       26380099
260900                             LQW-FOB-STD-EDI-CDE (PV-SUB)         26390099
261000              MOVE TR019-CONSLR-SCAC TO                           26400099
261100                             LQW-CONSLR-SCAC (PV-SUB)             26410099
261200              MOVE TR019-DECONL-SCAC TO                           26420099
261300                             LQW-DECONL-SCAC (PV-SUB)             26430099
P5207               MOVE TR019-INCOTERM-CODE TO                         26440099
P5207                              LQW-INCOTERM-CODE (PV-SUB)           26450099
261400              MOVE TR019-CSTM-BKR-SCAC TO                         26460099
261500                             LQW-CSTM-BKR-SCAC (PV-SUB)           26470099
261600                                                                  26480099
261700         WHEN TR021-DEL (TR021-IDX)                               26490099
261800              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             26500099
261900                                                                  26510099
262000         WHEN TR021-ERR (TR021-IDX)                               26520099
262100              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             26530099
262200     END-EVALUATE.                                                26540099
262300                                                                  26550099
262400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                26560099
262500                                                                  26570099
262600*----------------------------------------------------------------*26580099
262700*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *26590099
262800*----------------------------------------------------------------*26600099
262900                                                                  26610099
263000 6111-WRITE-LIST-QUEUE.                                           26620099
263100                                                                  26630099
263200     EXEC CICS                                                    26640099
263300         WRITEQ TS                                                26650099
263400             QUEUE (ASC-LIST-QUEUE-NAME)                          26660099
263500             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     26670099
263600             ITEM  (PV-SAVE-ITEM)                                 26680099
263700             REWRITE                                              26690099
263800             RESP  (PV-CICS-RESP)                                 26700099
263900     END-EXEC.                                                    26710099
264000*                                                                 26720099
264100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26730099
264200         CONTINUE                                                 26740099
264300     ELSE                                                         26750099
264400         SET DP013-CICS-ABEND  TO  TRUE                           26760099
264500         SET DP013-NO-ROLLBACK TO  TRUE                           26770099
264600         MOVE '6111-WRITE-LIST-QUEUE'                             26780099
264700                               TO  DP013-PARAGRAPH                26790099
264800         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  26800099
264900                               TO  DP013-MESSAGE-TEXT(1)          26810099
265000         PERFORM DP013-0000-PROCESS-ABEND                         26820099
265100     END-IF.                                                      26830099
265200                                                                  26840099
265300 EJECT                                                            26850099
265400*----------------------------------------------------------------*26860099
265500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*26870099
265600*----------------------------------------------------------------*26880099
265700                                                                  26890099
265800 6112-READ-LIST-QUEUE.                                            26900099
265900                                                                  26910099
266000     EXEC CICS                                                    26920099
266100         READQ TS                                                 26930099
266200             QUEUE (ASC-LIST-QUEUE-NAME)                          26940099
266300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     26950099
266400             ITEM  (PV-ITEM)                                      26960099
266500             RESP  (PV-CICS-RESP)                                 26970099
266600     END-EXEC.                                                    26980099
266700*                                                                 26990099
266800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27000099
266900         CONTINUE                                                 27010099
267000     ELSE                                                         27020099
267100         SET DP013-CICS-ABEND        TO TRUE                      27030099
267200         SET DP013-NO-ROLLBACK       TO TRUE                      27040099
267300         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           27050099
267400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    27060099
267500                                     TO DP013-MESSAGE-TEXT(1)     27070099
267600         PERFORM DP013-0000-PROCESS-ABEND                         27080099
267700     END-IF.                                                      27090099
267800                                                                  27100099
267900 EJECT                                                            27110099
                                                                        27120099
047100 6200-SELECT-COUNTRY-DESC.                                        27130099
047200                                                                  27140099
047300     EXEC SQL                                                     27150099
047400         SELECT A.CNTRY_NM                                        27160099
047500            INTO :CNTRY-CNTRY-NM                                  27170099
047600             FROM TCNTRY A                                        27180099
047700             WHERE A.CNTRY_CDE = :DK-CNTRY-CODE                   27190099
047800               AND A.STAT_CDE IN (:PC-A, :PC-I)                   27200099
047900     END-EXEC                                                     27210099
048000                                                                  27220099
048100         EVALUATE TRUE                                            27230099
048200             WHEN SQLCODE = ZERO                                  27240099
048510*            WHEN SQLCODE = -811                                  27250099
                       MOVE CNTRY-CNTRY-NM TO                           27260099
                           LQW-FOB-COUNTRY-NAME (PV-SUB)                27270099
048400             WHEN SQLCODE = +100                                  27280099
048520                 MOVE SPACES TO LQW-FOB-COUNTRY-NAME (PV-SUB)     27290099
048700             WHEN OTHER                                           27300099
048800                 MOVE '6200-SELECT-COUNTRY-DESC'                  27310099
048900                                   TO DP013-PARAGRAPH             27320099
049000                 MOVE 'SQL ERROR SELECTING COUNTRY NAME'          27330099
049100                                   TO DP013-MESSAGE-TEXT (1)      27340099
049200                 MOVE SQLCA        TO DP013-SQLCA                 27350099
049300                 MOVE 'TCNTRY  '   TO DP013-DB2-TABLE-NAME (1)    27360099
049400                 SET DP013-DB2-ABEND                              27370099
049500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           27380099
049600                 PERFORM DP013-0000-PROCESS-ABEND                 27390099
049700         END-EVALUATE.                                            27400099
049800                                                                  27410099
049900 EJECT                                                            27420099
268000*----------------------------------------------------------------*27430099
268100*    ABEND PROCESSOR MODULE                                      *27440099
268200*----------------------------------------------------------------*27450099
268300                                                                  27460099
268400     COPY DPPD013.                                                27470099
