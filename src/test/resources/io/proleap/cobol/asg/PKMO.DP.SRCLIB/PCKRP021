000100 IDENTIFICATION DIVISION.                                         00010058
000200 TITLE 'INVENTORY STORES UNBALANCED STORE EXPECTED REPORT'.       00020058
000300                                                                  00030058
000400 PROGRAM-ID.             PCKRP021.                                00040058
000500 AUTHOR.                 PATRICK BURKE.                           00050058
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060058
000700 DATE-WRITTEN.           MARCH 2004.                              00070058
000800 DATE-COMPILED.                                                   00080058
000900                                                                  00090058
001000 ENVIRONMENT DIVISION.                                            00100058
001100 CONFIGURATION SECTION.                                           00110058
001200 SOURCE-COMPUTER.                        IBM-3090.                00120058
001300 OBJECT-COMPUTER.                        IBM-3090.                00130058
001400 INPUT-OUTPUT SECTION.                                            00140058
001500 FILE-CONTROL.                                                    00150058
001600                                                                  00160058
001700     SELECT EXTRACT-FILE                                          00170058
001800         ASSIGN TO INP01.                                         00180058
001900                                                                  00190058
002000     SELECT  REPORT-FILE                                          00200058
002100         ASSIGN TO RPT01.                                         00210058
002200                                                                  00220058
002300                                                                  00230058
002400 DATA DIVISION.                                                   00240058
002500 FILE SECTION.                                                    00250058
002600                                                                  00260058
002700 FD  EXTRACT-FILE                                                 00270058
002800     RECORDING MODE IS F                                          00280058
002900     LABEL RECORDS ARE STANDARD                                   00290058
003000     BLOCK CONTAINS 0 RECORDS.                                    00300058
003100 01  ERROR-RECORD                     PIC X(150).                 00310058
003200                                                                  00320058
003300 FD  REPORT-FILE                                                  00330058
003400     RECORDING MODE IS F                                          00340058
003500     LABEL RECORDS ARE STANDARD                                   00350058
003600     BLOCK CONTAINS 0 RECORDS.                                    00360058
003700 01  REPORT-RECORD                    PIC X(132).                 00370058
003800/                                                                 00380058
003900 WORKING-STORAGE SECTION.                                         00390058
004000 01  PS-SWITCHES.                                                 00400058
004100     05  PS-EOF-ERROR-SWITCH          PIC X(01) VALUE 'N'.        00410058
004200         88  PS-EOF-ERROR-FILE                  VALUE 'Y'.        00420058
004300                                                                  00430058
004400     05  PS-BLANK-LINE-SWITCH         PIC X(01) VALUE 'N'.        00440058
004500         88  PS-BLANK-LINE                      VALUE 'Y'.        00450058
004600         88  PS-BLANK-LINE-NO                   VALUE 'N'.        00460058
004700                                                                  00470058
004800                                                                  00480058
004900 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       00490058
005000                                                 COMP SYNC.       00500058
005100     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00510058
005200                                                                  00520058
005300 01  SD-SYSTEM-DATE.                                              00530058
005400     05  SD-SYSTEM-DATE-YY          PIC  9(02)   VALUE ZERO.      00540058
005500     05  SD-SYSTEM-DATE-MM          PIC  9(02)   VALUE ZERO.      00550058
005600     05  SD-SYSTEM-DATE-DD          PIC  9(02)   VALUE ZERO.      00560058
005700                                                                  00570058
005800 01  ST-SYSTEM-TIME.                                              00580058
005900     05  ST-SYSTEM-HOUR             PIC  9(02)   VALUE ZERO.      00590058
006000     05  ST-SYSTEM-MINUTE           PIC  9(02)   VALUE ZERO.      00600058
006100     05  FILLER                     PIC  9(04)   VALUE ZERO.      00610058
006200                                                                  00620058
006300 01  PV-VARIABLES.                                                00630058
006400     05  PV-TMST                      PIC X(26) VALUE SPACES.     00640058
006500     05  PV-READ-COUNT                PIC S9(7) COMP-3            00650058
006600                                                VALUE ZERO.       00660058
006700     05  PV-BOSS-COUNT                PIC S9(7) COMP-3            00670058
006800                                                VALUE ZERO.       00680058
006900     05  PV-WRITE-COUNT               PIC S9(7) COMP-3            00690058
007000                                                VALUE ZERO.       00700058
007100     05  PV-PAGE-COUNT                PIC S9(7) COMP-3            00710058
007200                                                VALUE ZERO.       00720058
007300     05  PV-LINES-USED                PIC S9(4) COMP-3            00730058
007400                                                VALUE ZERO.       00740058
007500     05  PV-RETRY-COUNTER             PIC S9(04) VALUE ZERO       00750058
007600                                                 COMP SYNC.       00760058
007700     05  PV-DB2-FUNCTION              PIC X(30) VALUE SPACES.     00770058
007800     05  PV-PARAGRAPH                 PIC X(30) VALUE SPACES.     00780058
007900     05  PV-DISP-NUMBER               PIC Z,ZZZ,ZZ9.              00790058
008000     05  PV-DISP-COUNT                PIC Z,ZZZ,ZZZ,ZZ9.          00800058
008100     05  PV-PREV-OPER                 PIC 9(05).                  00810058
008200     05  PV-PREV-PO                   PIC S9(09) COMP.            00820058
008300     05  PV-PREV-RCVR                 PIC S9(09) COMP.            00830058
008400     05  PV-CLEAN4-DAYS               PIC S9(09) COMP.            00840058
008500                                                                  00850058
008600     05  PV-RUN-DATE                  PIC X(10) VALUE SPACES.     00860058
008700     05  PV-SAVE-START-DATE           PIC X(10) VALUE SPACES.     00870058
008800     05  PV-DB2-DATE.                                             00880058
008900         10  PV-DB2-CC                  PIC X(02).                00890058
009000         10  PV-DB2-YY                  PIC X(02).                00900058
009100         10  FILLER                     PIC X(01).                00910058
009200         10  PV-DB2-MM                  PIC X(02).                00920058
009300         10  FILLER                     PIC X(01).                00930058
009400         10  PV-DB2-DD                  PIC X(02).                00940058
009500         10  FILLER                     PIC X(01).                00950058
009600         10  PV-DB2-HH                  PIC X(02).                00960058
009700         10  FILLER                     PIC X(01).                00970058
009800         10  PV-DB2-MN                  PIC X(02).                00980058
009900         10  FILLER                     PIC X(01).                00990058
010000         10  PV-DB2-SS                  PIC X(09).                01000058
010100     05  PV-KEY-DATE.                                             01010058
010200         10  PV-KEY-MM               PIC X(02).                   01020058
010300         10  FILLER                  PIC X(01) VALUE '/'.         01030058
010400         10  PV-KEY-DD               PIC X(02).                   01040058
010500         10  FILLER                  PIC X(01) VALUE '/'.         01050058
010600         10  PV-KEY-YY               PIC X(02).                   01060058
010700     05  PV-BOSS-PARM-RECV           PIC S9(09) COMP.             01070058
010800     05  PV-BOSS-PARM-DISP           PIC -9(04).                  01080058
010900                                                                  01090058
011000 01  PC-CONSTANTS.                                                01100058
011100     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'PCKRP021'. 01110058
011200     05  PC-END-OF-PAGE               PIC S9(3) COMP-3 VALUE +60. 01120058
011300     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3  COMP.  01130058
011400                                                                  01140058
011500***  STANDARD REPORT HEADER FOR 132 COLUMN REPORT                 01150058
011600     COPY DPWS132O.                                               01160058
011700                                                                  01170058
011800*    ERROR EXTRACT                                                01180058
011900     COPY PCRD038.                                                01190058
012000                                                                  01200058
012100 01  HL-HEADING-LINE-1.                                           01210058
012200     05  FILLER                      PIC  X(50)  VALUE SPACES.    01220058
012300     05  FILLER                      PIC  X(41)  VALUE            01230058
012400      ' PRE INVENTORY STORE EXPECTED CLEAN      '.                01240058
012500     05  FILLER                      PIC  X(41)  VALUE SPACES.    01250062
012600                                                                  01260058
012700 01  HL-HEADING-LINE-1A.                                          01270058
012800     05  FILLER                      PIC  X(40)  VALUE SPACES.    01280058
012900     05  FILLER                      PIC  X(49)  VALUE            01290058
013000      'INVENTORY STORES WITH UNBALANCED STORE EXPECTED >'.        01300058
013100     05  HL1-CLEAN4-DAYS             PIC  ZZZ9   VALUE ZERO.      01310058
013200     05  FILLER                      PIC  X(06) VALUE             01320058
013300         ' DAYS '.                                                01330058
013400     05  FILLER                      PIC  X(33)  VALUE SPACES.    01340062
013500                                                                  01350058
013600 01  HL-HEADING-LINE-2A.                                          01360058
013700     05  FILLER                      PIC  X(05) VALUE  SPACES.    01370060
013800     05  FILLER                      PIC  X(05) VALUE             01380060
013900         'STORE'.                                                 01390060
014000     05  FILLER                      PIC  X(23) VALUE  SPACES.    01400060
014100     05  FILLER                      PIC  X(03) VALUE             01410058
014200         'REC'.                                                   01420058
014300     05  FILLER                      PIC  X(20) VALUE  SPACES.    01430060
014400     05  FILLER                      PIC  X(14) VALUE             01440060
014500         'LINE STORE EXP'.                                        01450060
014600     05  FILLER                      PIC  X(02) VALUE  SPACES.    01460058
014700     05  FILLER                      PIC  X(08) VALUE             01470058
014800         'LAST ACT'.                                              01480058
014900     05  FILLER                      PIC  X(03) VALUE  SPACES.    01490060
015000     05  FILLER                      PIC  X(10) VALUE             01500058
015100         'EXT RETAIL'.                                            01510058
015200     05  FILLER                      PIC  X(03) VALUE  SPACES.    01520058
015300     05  FILLER                      PIC  X(36) VALUE  SPACES.    01530062
015400                                                                  01540058
015500 01  HL-HEADING-LINE-2.                                           01550058
015600     05  FILLER                      PIC  X(01) VALUE  SPACES.    01560060
015700     05  FILLER                      PIC  X(02) VALUE             01570058
015800         'DC'.                                                    01580058
015900     05  FILLER                      PIC  X(03) VALUE  SPACES.    01590058
016000     05  FILLER                      PIC  X(03) VALUE             01600060
016100         'NBR'.                                                   01610060
016200     05  FILLER                      PIC  X(02) VALUE  SPACES.    01620060
016300     05  FILLER                      PIC  X(11) VALUE             01630058
016400         'PO/RECEIVER'.                                           01640058
016500     05  FILLER                      PIC  X(02) VALUE  SPACES.    01650058
016600     05  FILLER                      PIC  X(08) VALUE             01660058
016700         'VRFD DTE'.                                              01670058
016800     05  FILLER                      PIC  X(01) VALUE  SPACES.    01680060
016900     05  FILLER                      PIC  X(03) VALUE             01690058
017000         'TYP'.                                                   01700058
017100     05  FILLER                      PIC  X(01) VALUE  SPACES.    01710060
017200     05  FILLER                      PIC  X(04) VALUE             01720058
017300         'DEPT'.                                                  01730058
017310     05  FILLER                      PIC  X(01) VALUE  SPACES.    01731060
017320     05  FILLER                      PIC  X(04) VALUE             01732060
017330         'SEPH'.                                                  01733060
017400     05  FILLER                      PIC  X(03) VALUE  SPACES.    01740060
017500     05  FILLER                      PIC  X(03) VALUE             01750058
017600         'SKU'.                                                   01760058
017700     05  FILLER                      PIC  X(04) VALUE  SPACES.    01770060
017800     05  FILLER                      PIC  X(04) VALUE             01780058
017900         'NBR'.                                                   01790058
018000     05  FILLER                      PIC  X(03) VALUE  SPACES.    01800060
018100     05  FILLER                      PIC  X(05) VALUE             01810058
018200         'UNITS'.                                                 01820058
018300     05  FILLER                      PIC  X(06) VALUE  SPACES.    01830058
018400     05  FILLER                      PIC  X(04) VALUE             01840058
018500         'DATE'.                                                  01850058
018600     05  FILLER                      PIC  X(05) VALUE  SPACES.    01860060
018700     05  FILLER                      PIC  X(11) VALUE             01870058
018800         'CALCULATION'.                                           01880058
018900     05  FILLER                      PIC  X(01) VALUE  SPACES.    01890060
019000     05  FILLER                      PIC  X(15) VALUE             01900058
019100         'CLEAN UP REASON'.                                       01910058
019200     05  FILLER                      PIC  X(22) VALUE  SPACES.    01920063
019300                                                                  01930058
019400 01  HL-HEADING-LINE-3.                                           01940061
019600     05  FILLER                      PIC  X(04) VALUE             01960060
019700         '----'.                                                  01970060
019800     05  FILLER                      PIC  X(01) VALUE  SPACES.    01980060
019900     05  FILLER                      PIC  X(04) VALUE             01990060
020000         '----'.                                                  02000060
020100     05  FILLER                      PIC  X(01) VALUE  SPACES.    02010060
020200     05  FILLER                      PIC  X(13) VALUE             02020060
020300         '-------------'.                                         02030060
020400     05  FILLER                      PIC  X(01) VALUE  SPACES.    02040060
020500     05  FILLER                      PIC  X(08) VALUE             02050058
020600         '--------'.                                              02060058
020700     05  FILLER                      PIC  X(01) VALUE  SPACES.    02070060
020800     05  FILLER                      PIC  X(03) VALUE             02080058
020900         '---'.                                                   02090058
021000     05  FILLER                      PIC  X(01) VALUE  SPACES.    02100060
021100     05  FILLER                      PIC  X(04) VALUE             02110058
021200         '----'.                                                  02120058
021210     05  FILLER                      PIC  X(01) VALUE  SPACES.    02121060
021220     05  FILLER                      PIC  X(04) VALUE             02122060
021230         '----'.                                                  02123060
021300     05  FILLER                      PIC  X(01) VALUE  SPACES.    02130060
021400     05  FILLER                      PIC  X(08) VALUE             02140058
021500         '--------'.                                              02150058
021600     05  FILLER                      PIC  X(01) VALUE  SPACES.    02160060
021700     05  FILLER                      PIC  X(04) VALUE             02170058
021800         '----'.                                                  02180058
021900     05  FILLER                      PIC  X(01) VALUE  SPACES.    02190060
022000     05  FILLER                      PIC  X(09) VALUE             02200058
022100         '---------'.                                             02210058
022200     05  FILLER                      PIC  X(01) VALUE  SPACES.    02220060
022300     05  FILLER                      PIC  X(10) VALUE             02230060
022400         '----------'.                                            02240060
022500     05  FILLER                      PIC  X(01) VALUE  SPACES.    02250060
022600     05  FILLER                      PIC  X(11) VALUE             02260060
022700         '-----------'.                                           02270058
022800     05  FILLER                      PIC  X(01) VALUE  SPACES.    02280060
022900     05  FILLER                      PIC  X(38) VALUE             02290065
023000         '--------------------------------------'.                02300065
023200                                                                  02320058
023300 01  DL-DETAIL-LINE-1.                                            02330061
023500     05  DL-OPER-UNT-ID              PIC  ZZZ9  VALUE ZERO.       02350060
023600     05  FILLER                      PIC  X(01) VALUE  SPACES.    02360060
023700     05  DL-STORE-NBR                PIC  ZZZ9  VALUE ZERO.       02370060
023800     05  FILLER                      PIC  X(01) VALUE  SPACES.    02380060
023900     05  DL-PO-RCVR.                                              02390058
024000         10  DL-PO                   PIC  ZZZZZZZZ9  VALUE ZERO.  02400058
024100         10  DL-DASH                 PIC  X(01) VALUE  '-'.       02410058
024200         10  DL-RCVR                 PIC  9(03) VALUE  ZEROES.    02420058
024300         10  DL-RCVR-X  REDEFINES    DL-RCVR                      02430058
024400                                     PIC  X(03).                  02440058
024500     05  FILLER                      PIC  X(01) VALUE  SPACES.    02450060
024600     05  DL-VRFD-DATE                PIC  X(08) VALUE SPACES.     02460058
024700     05  FILLER                      PIC  X(01) VALUE  SPACES.    02470060
024800     05  DL-REC-TYP                  PIC  X(03) VALUE SPACES.     02480058
024900     05  FILLER                      PIC  X(02) VALUE  SPACES.    02490060
025000     05  DL-DEPT-NBR                 PIC  9(03) VALUE ZERO.       02500058
025010     05  FILLER                      PIC  X(02) VALUE  SPACES.    02501060
025020     05  DL-SEPHORA-ORDER            PIC  X(01) VALUE ZERO.       02502060
025100     05  FILLER                      PIC  X(03) VALUE  SPACES.    02510060
025200     05  DL-SKU-NBR                  PIC  9(08) VALUE  ZEROES.    02520058
025300     05  FILLER                      PIC  X(01) VALUE  SPACES.    02530060
025400     05  DL-APP-PO-LNE-NBR           PIC  ZZZ9.                   02540058
025500     05  DL-APP-PO-LNE-NBR-X REDEFINES DL-APP-PO-LNE-NBR          02550058
025600                                     PIC  X(04).                  02560058
025700     05  FILLER                      PIC  X(03) VALUE  SPACES.    02570060
025800     05  DL-STORE-EXP-UNITS          PIC  ZZZZ9-.                 02580058
025900     05  FILLER                      PIC  X(02) VALUE  SPACES.    02590060
026000     05  DL-LAST-ACT-DATE            PIC  X(10) VALUE  ZEROES.    02600058
026100     05  FILLER                      PIC  X(02) VALUE  SPACES.    02610058
026200     05  DL-EXT-RTL-AMT              PIC ZZZ,ZZZ.99.              02620060
026300     05  FILLER                      PIC  X(02) VALUE  SPACES.    02630058
026400     05  DL-CLEAN-REASON             PIC  X(37) VALUE  ZEROES.    02640063
026600                                                                  02660058
026700 01  EP-EMPTY-REPORT-LINE.                                        02670058
026800     05  FILLER                       PIC X(54)  VALUE SPACES.    02680058
026900     05  FILLER                       PIC X(25)  VALUE            02690058
027000         '******* NO DATA *********'.                             02700058
027100     05  FILLER                       PIC X(53)  VALUE SPACES.    02710062
027200 01  DL-BLANK-LINE                    PIC X(132) VALUE SPACES.    02720058
027300                                                                  02730058
027400 01  END-OF-REPORT-LINE.                                          02740058
027500     05  FILLER                  PIC  X(44)    VALUE SPACES.      02750058
027600     05  FILLER                  PIC  X(45)    VALUE              02760058
027700          '*******   E N D   O F   R E P O R T   *******'.        02770058
027800     05  FILLER                  PIC  X(43)    VALUE SPACES.      02780058
027900/                                                                 02790058
028000******************************************************************02800058
028100                                                                  02810058
028200     EXEC SQL                                                     02820058
028300         INCLUDE SQLCA                                            02830058
028400     END-EXEC.                                                    02840058
028500*----------------------------------------------------------------*02850058
028600*    DB2 DCLGEN FOR TKRPRPM TABLE                                 02860058
028700*----------------------------------------------------------------*02870058
028800     EXEC SQL                                                     02880058
028900          INCLUDE TKRPRPM                                         02890058
029000     END-EXEC.                                                    02900058
029100                                                                  02910058
029200*----------------------------------------------------------------*02920058
029300*    DB2 DCLGEN FOR TRECEIV TABLE                                 02930058
029400*----------------------------------------------------------------*02940058
029500     EXEC SQL                                                     02950058
029600          INCLUDE TRECEIV                                         02960058
029700     END-EXEC.                                                    02970058
029800                                                                  02980058
029900                                                                  02990058
030000     COPY SQLCA2.                                                 03000058
030100/                                                                 03010058
030200 PROCEDURE DIVISION.                                              03020058
030300                                                                  03030058
030400 0000-MAINLINE.                                                   03040058
030500                                                                  03050058
030600     PERFORM 1000-INITIALIZE                                      03060058
030700                                                                  03070058
030800     PERFORM 2000-PROCESS UNTIL PS-EOF-ERROR-FILE                 03080058
030900                                                                  03090058
031000     PERFORM 9000-EOJ.                                            03100058
031100                                                                  03110058
031200 THE-DUMPER.                                                      03120058
031300     GOBACK.                                                      03130058
031400                                                                  03140058
031500 1000-INITIALIZE.                                                 03150058
031600                                                                  03160058
031700     DISPLAY ' PCKRP021 STARTED'                                  03170058
031800     EXEC SQL SET :PV-TMST = CURRENT TIMESTAMP END-EXEC           03180058
031900                                                                  03190058
032000     OPEN OUTPUT REPORT-FILE                                      03200058
032100* LOAD SYSTEM DATE INTO HEADINGS                                  03210058
032200     ACCEPT SD-SYSTEM-DATE FROM DATE.                             03220058
032300     ACCEPT ST-SYSTEM-TIME FROM TIME.                             03230058
032400                                                                  03240058
032500     MOVE SD-SYSTEM-DATE-YY      TO DP132O-RUN-YEAR.              03250058
032600     MOVE SD-SYSTEM-DATE-MM      TO DP132O-RUN-MONTH.             03260058
032700     MOVE SD-SYSTEM-DATE-DD      TO DP132O-RUN-DAY.               03270058
032800     MOVE ST-SYSTEM-HOUR         TO DP132O-RUN-HOUR.              03280058
032900     MOVE ST-SYSTEM-MINUTE       TO DP132O-RUN-MINUTE.            03290058
033000                                                                  03300058
033100     MOVE PC-CURRENT-PROGRAM-NAME                                 03310058
033200                                 TO DP132O-PROGRAM-NAME.          03320058
033300     MOVE 1                      TO DP132O-REPORT-NUMBER          03330058
033400                                    DP132O-PAGE-NUMBER            03340058
033500                                                                  03350058
033600     PERFORM 2200-GET-CLEAN4-DAYS                                 03360058
033700     PERFORM 8100-WRITE-MAIN-HEADINGS                             03370058
033800                                                                  03380058
033900     OPEN INPUT EXTRACT-FILE                                      03390058
034000     PERFORM 8000-READ-EXTRACT                                    03400058
034100     MOVE PC038-OPER-UNT-ID  TO      PV-PREV-OPER                 03410058
034200     IF PS-EOF-ERROR-FILE                                         03420058
034300         DISPLAY ' -- NO UNBALANCED STR EXP -- '                  03430058
034400         WRITE REPORT-RECORD FROM EP-EMPTY-REPORT-LINE            03440058
034500             AFTER ADVANCING 3 LINES                              03450058
034600     END-IF.                                                      03460058
034700                                                                  03470058
034800     PERFORM 2300-GET-BOSS-PARM-RCVR.                             03480058
034900/                                                                 03490058
035000 2000-PROCESS.                                                    03500058
035100                                                                  03510058
035200     PERFORM 2100-BUILD-LINE.                                     03520058
035300     IF PS-BLANK-LINE                                             03530058
035400        WRITE REPORT-RECORD FROM DL-BLANK-LINE                    03540058
035500           AFTER ADVANCING 1 LINES                                03550058
035600        ADD 1                   TO PV-LINES-USED                  03560058
035700        SET PS-BLANK-LINE-NO    TO TRUE                           03570058
035800     END-IF                                                       03580058
035900                                                                  03590058
036000     WRITE REPORT-RECORD FROM DL-DETAIL-LINE-1                    03600058
036100            AFTER ADVANCING 1 LINES                               03610058
036200     ADD 1                        TO PV-LINES-USED                03620058
036300                                                                  03630058
036400     IF PV-LINES-USED > PC-END-OF-PAGE                            03640058
036500         PERFORM 8100-WRITE-MAIN-HEADINGS                         03650058
036600     END-IF                                                       03660058
036700                                                                  03670058
036800     PERFORM 8000-READ-EXTRACT.                                   03680058
036900/                                                                 03690058
037000 2100-BUILD-LINE.                                                 03700058
037100     IF   PC038-OPER-UNT-ID    =         PV-PREV-OPER             03710058
037200         MOVE PC038-OPER-UNT-ID       TO DL-OPER-UNT-ID           03720058
037300      ELSE                                                        03730058
037400         SET PS-BLANK-LINE            TO TRUE                     03740058
037500         MOVE PC038-OPER-UNT-ID       TO DL-OPER-UNT-ID           03750058
037600         MOVE PC038-OPER-UNT-ID       TO PV-PREV-OPER             03760058
037700     END-IF.                                                      03770058
037800                                                                  03780058
037900     MOVE PC038-LOC-NBR               TO DL-STORE-NBR.            03790058
038000                                                                  03800058
038100     IF PC038-RCVR-SEQ-NBR  =   ZEROES                            03810058
038200          MOVE SPACES      TO DL-VRFD-DATE                        03820058
038300     ELSE                                                         03830058
038400         IF PC038-PO-NBR            =     PV-PREV-PO              03840058
038500             IF PC038-RCVR-SEQ-NBR  =     PV-PREV-RCVR            03850058
038600                  MOVE PV-KEY-DATE TO DL-VRFD-DATE                03860058
038700             ELSE                                                 03870058
038800                 PERFORM 2400-GET-TRECEIV-VFYD-DATE               03880058
038900                 MOVE PC038-RCVR-SEQ-NBR  TO PV-PREV-RCVR         03890058
039000            END-IF                                                03900058
039100         ELSE                                                     03910058
039200             PERFORM 2400-GET-TRECEIV-VFYD-DATE                   03920058
039300             MOVE PC038-PO-NBR           TO PV-PREV-PO            03930058
039400         END-IF                                                   03940058
039500     END-IF.                                                      03950058
039600                                                                  03960058
039700     MOVE PC038-PO-NBR                TO DL-PO                    03970058
039800     MOVE '-'                         TO DL-DASH.                 03980058
039900                                                                  03990058
040000     IF PC038-RCVR-SEQ-NBR = PV-BOSS-PARM-RECV                    04000058
040100        MOVE 'BSS'                    TO DL-RCVR-X                04010058
040200        ADD 1                         TO PV-BOSS-COUNT            04020058
040300     ELSE                                                         04030058
040400        MOVE PC038-RCVR-SEQ-NBR       TO DL-RCVR                  04040058
040500     END-IF.                                                      04050058
040600                                                                  04060058
040700     MOVE PC038-REC-TYP-CDE           TO DL-REC-TYP.              04070058
040800     MOVE PC038-DEPT-NBR              TO DL-DEPT-NBR.             04080058
040810     MOVE PC038-SEPHORA-IND           TO DL-SEPHORA-ORDER.        04081066
040900     MOVE PC038-SKU-9                 TO DL-SKU-NBR.              04090058
041000     MOVE PC038-STR-EXPECTED-UNITS    TO DL-STORE-EXP-UNITS.      04100058
041100     MOVE PC038-INTRNST-TRN-DTE       TO PV-DB2-DATE.             04110058
041200     MOVE PV-DB2-YY                   TO PV-KEY-YY.               04120058
041300     MOVE PV-DB2-MM                   TO PV-KEY-MM.               04130058
041400     MOVE PV-DB2-DD                   TO PV-KEY-DD.               04140058
041500     MOVE PV-KEY-DATE                 TO DL-LAST-ACT-DATE.        04150058
041600     MOVE PC038-EXTD-RTL-AMT          TO DL-EXT-RTL-AMT.          04160058
041700     MOVE PC038-CLEAN-REASON          TO DL-CLEAN-REASON.         04170058
041800     IF PC038-APP-PO-LNE-NBR-X NUMERIC                            04180058
041900          MOVE PC038-APP-PO-LNE-NBR   TO DL-APP-PO-LNE-NBR        04190058
042000     ELSE                                                         04200058
042100          MOVE PC038-APP-PO-LNE-NBR-X TO DL-APP-PO-LNE-NBR-X      04210058
042200     END-IF.                                                      04220058
042300****************************************************************  04230058
042400 2200-GET-CLEAN4-DAYS.                                            04240058
042500      EXEC SQL                                                    04250058
042600          SELECT FUNC_QTY                                         04260058
042700            INTO  :PV-CLEAN4-DAYS                                 04270058
042800            FROM TKRPRPM                                          04280058
042900            WHERE                                                 04290058
043000               LOC_ID                = 90                         04300058
043100               AND INTFC_SYS_CDE     = 'KHL'                      04310058
043200               AND SYS_PRC_FUNC_CDE  = 'CLEAN4'                   04320058
043300               AND FUNC_PRC_STAT_CDE = 'AC'                       04330058
043400            WITH UR                                               04340058
043500      END-EXEC.                                                   04350058
043600                                                                  04360058
043700      EVALUATE TRUE                                               04370058
043800          WHEN SQLCODE = +0                                       04380058
043900              MOVE PV-CLEAN4-DAYS TO HL1-CLEAN4-DAYS              04390058
044000          WHEN SQLCODE = +100                                     04400058
044100              CONTINUE                                            04410058
044200          WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                 04420058
044300              DISPLAY '**************************************'    04430058
044400              DISPLAY '2200-GET-CLEAN4-DAYS'                      04440058
044500              DISPLAY 'SELECT TKRPRPM                        '    04450058
044600              DISPLAY '**************************************'    04460058
044700              PERFORM 9300-SQL-WARNING                            04470058
044800                                                                  04480058
044900          WHEN SQLCODE < ZERO                                     04490058
045000              DISPLAY '**************************************'    04500058
045100              DISPLAY 'ERROR ISSUED ON                       '    04510058
045200              DISPLAY 'SELECT TKRPRPM                        '    04520058
045300              DISPLAY '**************************************'    04530058
045400              PERFORM 9200-SQL-ERROR                              04540058
045500                                                                  04550058
045600      END-EVALUATE.                                               04560058
045700/                                                                 04570058
045800******************************************************************04580058
045900*- READ TKRPRPM TO RETRIEVE THE BOSS RECEIVER PARM                04590058
046000******************************************************************04600058
046100 2300-GET-BOSS-PARM-RCVR.                                         04610058
046200                                                                  04620058
046300     EXEC SQL                                                     04630058
046400         SELECT FUNC_QTY                                          04640058
046500           INTO :PV-BOSS-PARM-RECV                                04650058
046600           FROM TKRPRPM                                           04660058
046700          WHERE LOC_ID            = 90                            04670058
046800            AND INTFC_SYS_CDE     = 'GIV'                         04680058
046900            AND SYS_PRC_FUNC_CDE  = 'BSSRCV'                      04690058
047000            AND FUNC_PRC_STAT_CDE = 'AC'                          04700058
047100          WITH UR                                                 04710058
047200     END-EXEC.                                                    04720058
047300                                                                  04730058
047400     EVALUATE TRUE                                                04740058
047500          WHEN SQLCODE = +0                                       04750058
047600              MOVE PV-BOSS-PARM-RECV     TO PV-BOSS-PARM-DISP     04760058
047700              DISPLAY ' BOSS PARM RECEIVER  = '                   04770058
047800                                            PV-BOSS-PARM-DISP     04780058
047900                                                                  04790058
048000          WHEN SQLCODE = +100                                     04800058
048100              MOVE ZEROES                TO PV-BOSS-PARM-RECV     04810058
048200                                                                  04820058
048300          WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                 04830058
048400              DISPLAY '**************************************'    04840058
048500              DISPLAY '2300-GET-BOSS-PARM-RCVR               '    04850058
048600              DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER        '    04860058
048700              DISPLAY '**************************************'    04870058
048800              PERFORM 9300-SQL-WARNING                            04880058
048900                                                                  04890058
049000          WHEN SQLCODE < ZERO                                     04900058
049100              DISPLAY '**************************************'    04910058
049200              DISPLAY '2300-GET-BOSS-PARM-RCVR               '    04920058
049300              DISPLAY 'ERROR ISSUED ON                       '    04930058
049400              DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER        '    04940058
049500              DISPLAY '**************************************'    04950058
049600              PERFORM 9200-SQL-ERROR                              04960058
049700                                                                  04970058
049800      END-EVALUATE.                                               04980058
049900/                                                                 04990058
050000****************************************************************  05000058
050100 2400-GET-TRECEIV-VFYD-DATE.                                      05010058
050200                                                                  05020058
050300     MOVE '2400-GET-TRECEIV-VFYD-DATE'    TO PV-PARAGRAPH.        05030058
050400                                                                  05040058
050500     INITIALIZE RECEIV-VERFYD-TMST.                               05050058
050600                                                                  05060058
050700     PERFORM                                                      05070058
050800         WITH TEST AFTER                                          05080058
050900         VARYING PV-RETRY-COUNTER                                 05090058
051000         FROM 1 BY 1                                              05100058
051100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05110058
051200            OR  (SQLCODE = +100)                                  05120058
051300            OR  (SQLCODE = +0))                                   05130058
051400                                                                  05140058
051500         EXEC SQL                                                 05150058
051600             SELECT VERFYD_TMST                                   05160058
051700              INTO :RECEIV-VERFYD-TMST                            05170058
051800              FROM  TRECEIV                                       05180058
051900             WHERE  ORD_NBR     = :PC038-PO-NBR                   05190058
052000               AND  REC_SEQ_NBR = :PC038-RCVR-SEQ-NBR             05200058
052100         WITH UR                                                  05210058
052200         END-EXEC                                                 05220058
052300                                                                  05230058
052400         EVALUATE TRUE                                            05240058
052500             WHEN SQLCODE = ZERO                                  05250058
052600                 IF RECEIV-VERFYD-TMST NOT =                      05260058
052700                                     '9999-09-09-09.09.09.999999' 05270058
052800                     MOVE RECEIV-VERFYD-TMST TO PV-DB2-DATE       05280058
052900                     MOVE PV-DB2-YY   TO PV-KEY-YY                05290058
053000                     MOVE PV-DB2-MM   TO PV-KEY-MM                05300058
053100                     MOVE PV-DB2-DD   TO PV-KEY-DD                05310058
053200                     MOVE PV-KEY-DATE TO DL-VRFD-DATE             05320058
053300                 ELSE                                             05330058
053400                     MOVE SPACES TO   DL-VRFD-DATE                05340058
053500                 END-IF                                           05350058
053600             WHEN SQLCODE = +100                                  05360058
053700                 MOVE SPACES TO   DL-VRFD-DATE                    05370058
053800             WHEN SQLCODE = -904                                  05380058
053900             WHEN SQLCODE = -911                                  05390058
054000             WHEN SQLCODE = -913                                  05400058
054100                  CONTINUE                                        05410058
054200                                                                  05420058
054300             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              05430058
054400                 DISPLAY '**************************************' 05440058
054500                 DISPLAY 'WARNING ISSUED '                        05450058
054600                 DISPLAY 'SELECT TRECEIV                        ' 05460058
054700                 DISPLAY '**************************************' 05470058
054800                 PERFORM 9300-SQL-WARNING                         05480058
054900                                                                  05490058
055000             WHEN SQLCODE < ZERO                                  05500058
055100                 DISPLAY '**************************************' 05510058
055200                 DISPLAY 'ERROR ISSUED ON                       ' 05520058
055300                 DISPLAY 'SELECT TRECEIV                        ' 05530058
055400                 DISPLAY '**************************************' 05540058
055500                 PERFORM 9200-SQL-ERROR                           05550058
055600                                                                  05560058
055700         END-EVALUATE                                             05570058
055800     END-PERFORM.                                                 05580058
055900                                                                  05590058
056000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05600058
056100         SQLCODE NOT = ZERO                                       05610058
056200         DISPLAY '**************************************'         05620058
056300         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         05630058
056400         DISPLAY 'SELECT TRECEIV         '                        05640058
056500         DISPLAY '**************************************'         05650058
056600         PERFORM 9200-SQL-ERROR                                   05660058
056700     END-IF.                                                      05670058
056800                                                                  05680058
056900 8000-READ-EXTRACT.                                               05690058
057000     READ EXTRACT-FILE                                            05700058
057100         INTO PC038-SE-UNBALANCED-RPT-REC                         05710058
057200     AT END                                                       05720058
057300         SET PS-EOF-ERROR-FILE        TO TRUE                     05730058
057400     NOT AT END                                                   05740058
057500         ADD 1                        TO PV-READ-COUNT            05750058
057600     END-READ.                                                    05760058
057700                                                                  05770058
057800 8100-WRITE-MAIN-HEADINGS.                                        05780058
057900                                                                  05790058
058000     ADD 1                            TO PV-PAGE-COUNT.           05800058
058100     MOVE PV-PAGE-COUNT               TO DP132O-PAGE-NUMBER.      05810058
058200     MOVE ZERO                        TO PV-LINES-USED            05820058
058300                                                                  05830058
058400     WRITE REPORT-RECORD FROM DP132O-STANDRD-HEADER-132-COLS      05840058
058500                 AFTER ADVANCING PAGE                             05850058
058600                                                                  05860058
058700     WRITE REPORT-RECORD FROM HL-HEADING-LINE-1                   05870058
058800        AFTER ADVANCING 2 LINES.                                  05880058
058900     WRITE REPORT-RECORD FROM HL-HEADING-LINE-1A                  05890058
059000        AFTER ADVANCING 1 LINES.                                  05900058
059100     WRITE REPORT-RECORD FROM DL-BLANK-LINE                       05910058
059200        AFTER ADVANCING 1 LINES.                                  05920058
059300     WRITE REPORT-RECORD FROM HL-HEADING-LINE-2A                  05930058
059400        AFTER ADVANCING 1 LINES.                                  05940058
059500     WRITE REPORT-RECORD FROM HL-HEADING-LINE-2                   05950058
059600        AFTER ADVANCING 1 LINES.                                  05960058
059700     ADD 6                            TO PV-LINES-USED.           05970058
059800                                                                  05980058
059900     WRITE REPORT-RECORD FROM HL-HEADING-LINE-3                   05990058
060000        AFTER ADVANCING 2 LINES.                                  06000058
060100                                                                  06010058
060200     WRITE REPORT-RECORD FROM DL-BLANK-LINE                       06020058
060300        AFTER ADVANCING 1 LINES.                                  06030058
060400                                                                  06040058
060500     INITIALIZE DP132O-LASER-NEW-PAGE-INDICATR.                   06050058
060600     ADD  3                           TO PV-LINES-USED.           06060058
060700/                                                                 06070058
060800 9000-EOJ.                                                        06080058
060900                                                                  06090058
061000     WRITE REPORT-RECORD                                          06100058
061100       FROM END-OF-REPORT-LINE                                    06110058
061200         AFTER ADVANCING 2 LINES.                                 06120058
061300                                                                  06130058
061400     CLOSE REPORT-FILE                                            06140058
061500           EXTRACT-FILE.                                          06150058
061600     MOVE PV-READ-COUNT               TO PV-DISP-COUNT            06160058
061700     DISPLAY ' RECORDS READ       = ' PV-DISP-COUNT.              06170058
061800     MOVE PV-BOSS-COUNT               TO PV-DISP-COUNT            06180058
061900     DISPLAY ' BOSS RECORDS READ  = ' PV-DISP-COUNT.              06190058
062000/                                                                 06200058
062100 9100-ABEND.                                                      06210058
062200                                                                  06220058
062300     CLOSE EXTRACT-FILE                                           06230058
062400           REPORT-FILE                                            06240058
062500                                                                  06250058
062600     MOVE +4013                       TO ABEND-CODE.              06260058
062700     CALL 'ILBOABN0' USING ABEND-CODE.                            06270058
062800                                                                  06280058
062900 9200-SQL-ERROR.                                                  06290058
063000                                                                  06300058
063100     MOVE SQLCODE                     TO SQLCODE2.                06310058
063200     MOVE SQLERRD(3)                  TO SQLERRD3.                06320058
063300                                                                  06330058
063400     DISPLAY '** ABEND **         ** = SQLERROR'.                 06340058
063500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        06350058
063600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   06360058
063700     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                06370058
063800                                                                  06380058
063900     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                06390058
064000     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                06400058
064100     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 06410058
064200     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                06420058
064300                                                                  06430058
064400                                                                  06440058
064500     MOVE +4013                       TO ABEND-CODE.              06450058
064600     CALL 'ILBOABN0' USING ABEND-CODE.                            06460058
064700                                                                  06470058
064800 9300-SQL-WARNING.                                                06480058
064900                                                                  06490058
065000     DISPLAY '9300-SQL-WARNING'.                                  06500058
065100     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        06510058
065200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   06520058
065300     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                06530058
065400                                                                  06540058
065500     MOVE SQLCODE                     TO SQLCODE2.                06550058
065600     MOVE SQLERRD(3)                  TO SQLERRD3.                06560058
065700     DISPLAY '** ABEND **       ** = SQLWARNING'.                 06570058
065800     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  06580058
065900     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  06590058
066000     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  06600058
066100     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  06610058
066200     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  06620058
066300     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  06630058
066400     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  06640058
066500     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  06650058
066600     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  06660058
066700     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  06670058
066800                                                                  06680058
066900     MOVE +4013                       TO ABEND-CODE.              06690058
067000     CALL 'ILBOABN0' USING ABEND-CODE.                            06700058
067100                                                                  06710058
