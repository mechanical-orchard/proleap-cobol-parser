000100 IDENTIFICATION DIVISION.                                         00010001
000200                                                                  00020002
000300 PROGRAM-ID.             RCKRP014.                                00030001
000400 AUTHOR.                 PAT DOYLE - IBS.                         00040001
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050001
000600 DATE-WRITTEN            06/18/96.                                00060001
000700 DATE-COMPILED.                                                   00070001
000800                                                                  00080002
000900******************************************************************00090001
001000*                                                                 00100001
001100*  THIS PROGRAM CREATES AN ERROR REPORT FROM THE PROCESS OF       00110001
001200*  EXTRACTING CARTON LEVEL INFORMATION FROM ASN TABLES AND        00120001
001300*  THE PROCESS OF POPULATING THE INFORMATION TO SHIPPING UNIT     00130001
001400*  TABLES.                                                        00140001
001500*                                                                 00150001
001600*  THE INPUT FILE SHOULD BE SORTED IN OPER UNIT, VENDOR,          00160019
001700*  PO NUMBER, UPC, DATE SHIPPED, CARTON NBR, STORE, ERROR CODE    00170019
001800*  SEQUENCE.                                                      00180019
001900*                                                                 00190019
002000******************************************************************00200001
002100                                                                  00210002
002200                                                                  00220002
002300 ENVIRONMENT DIVISION.                                            00230001
002400 INPUT-OUTPUT SECTION.                                            00240001
002500                                                                  00250002
002600 FILE-CONTROL.                                                    00260001
002700                                                                  00270002
002800     SELECT ERROR-FILE        ASSIGN TO INP01.                    00280002
002900                                                                  00290002
003000     SELECT ERROR-REPORT-FILE ASSIGN TO RPT01.                    00300002
003100                                                                  00310002
003200                                                                  00320002
003300 DATA DIVISION.                                                   00330001
003400                                                                  00340002
003500 FILE SECTION.                                                    00350001
003600 FD  ERROR-FILE                                                   00360002
003700     RECORDING MODE IS F                                          00370001
003800     LABEL RECORDS ARE STANDARD                                   00380001
003900     BLOCK CONTAINS 0 RECORDS.                                    00390002
004000 01  ERROR-RECORD                   PIC X(120).                   00400002
004100                                                                  00410002
004200                                                                  00420002
004300 FD  ERROR-REPORT-FILE                                            00430008
004400     RECORDING MODE IS F                                          00440001
004500     BLOCK CONTAINS 0 RECORDS                                     00450001
004600     LABEL RECORDS ARE OMITTED.                                   00460002
004700 01  ERROR-REPORT-RECORD            PIC  X(132).                  00470002
004800                                                                  00480002
004900                                                                  00490002
005000                                                                  00500002
005100 WORKING-STORAGE SECTION.                                         00510001
005200 01  PS-SWITCHES.                                                 00520001
005300     05  PS-EOF-SW                   PIC  X(03)    VALUE 'N'.     00530003
005400         88  PS-EOF                                VALUE 'Y'.     00540003
005500         88  PS-NOT-EOF                            VALUE 'N'.     00550006
005600     05  PS-END-OF-CURSOR-SW         PIC  X(03)    VALUE 'N'.     00560019
005700         88  PS-END-OF-CURSOR                      VALUE 'Y'.     00570019
005800         88  PS-NOT-END-OF-CURSOR                  VALUE 'N'.     00580019
005900     05  PS-DUP-FOUND-SW             PIC  X(03)    VALUE 'N'.     00590021
006000         88  PS-DUP-FOUND                          VALUE 'Y'.     00600021
006100         88  PS-NO-DUP-FOUND                       VALUE 'N'.     00610021
006110     05  PS-NOT-FIRST-TIME-IN-SW     PIC  X(03)    VALUE 'N'.     00611031
006120         88  FIRST-TIME-IN                         VALUE 'Y'.     00612031
006130         88  NOT-FIRST-TIME-IN                     VALUE 'N'.     00613031
006200                                                                  00620002
006300 01  CD-CPU-DATE.                                                 00630001
006400     03  CD-YEAR                     PIC  9(02)    VALUE ZERO.    00640001
006500     03  CD-MONTH                    PIC  9(02)    VALUE ZERO.    00650001
006600     03  CD-DAY                      PIC  9(02)    VALUE ZERO.    00660001
006700                                                                  00670002
006800 01  CT-CPU-TIME.                                                 00680001
006900     03  CT-HOUR                     PIC  9(02)    VALUE ZERO.    00690001
007000     03  CT-MINUTE                   PIC  9(02)    VALUE ZERO.    00700001
007100     03  FILLER                      PIC  9(04)    VALUE ZERO.    00710001
007200                                                                  00720002
007300 01  PC-PROGRAM-CONSTANTS.                                        00730001
007400     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00740001
007500                                          'RCKRP014'.             00750002
007600                                                                  00760001
007700     05  PC-SLASH                    PIC  X(01)    VALUE '/'.     00770001
007800     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +60      00780005
007900                                                   COMP SYNC.     00790001
008000     05  PC-1                        PIC  9(02)    VALUE 1.       00800001
008100                                                                  00810002
008200 01  PV-PROGRAM-VARIABLES.                                        00820001
008300     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     00830001
008400                                                   COMP SYNC.     00840001
008500     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  00850001
008600     05  PV-LINE-COUNT               PIC S9(04)    VALUE +80      00860001
008700                                                   COMP SYNC.     00870001
008800     05  PV-LINE-ADVANCE             PIC S9(04)    VALUE +1       00880027
008900                                                   COMP SYNC.     00890027
009000     05  PV-PAGE-COUNT               PIC S9(04)    VALUE ZERO     00900001
009100                                                   COMP SYNC.     00910001
009200                                                                  00920002
009300     05  PV-SAVE-FIELDS.                                          00930001
009400         10  PV-SAVE-LOC             PIC  X(04)    VALUE SPACES.  00940008
009500         10  PV-SAVE-VENDOR          PIC  X(09)    VALUE SPACES.  00950008
009600         10  PV-SAVE-PO              PIC  9(09)    VALUE ZERO.    00960008
009700         10  PV-SAVE-ASNHDR          PIC  X(30)    VALUE SPACES.  00970023
009800         10  PV-SAVE-DATE-SHIPPED    PIC  9(08)    VALUE ZERO.    00980008
009900         10  PV-SAVE-CARTON          PIC  X(40)    VALUE SPACES.  00990026
010000                                                                  01000002
010100     05  PV-ISO-DATE.                                             01010007
010200         10  PV-ISO-YYYY             PIC  X(04).                  01020007
010300         10  FILLER                  PIC  X(01).                  01030007
010400         10  PV-ISO-MM               PIC  X(02).                  01040007
010500         10  FILLER                  PIC  X(01).                  01050007
010600         10  PV-ISO-DD               PIC  X(02).                  01060007
010700                                                                  01070007
010800     05  PV-SHIP-DATE.                                            01080006
010900         10  PV-SHIP-MM              PIC  X(02).                  01090006
011000         10  PV-SHIP-DD              PIC  X(02).                  01100006
011100         10  PV-SHIP-YYYY            PIC  X(04).                  01110006
011200                                                                  01120006
011300     05  PV-SHIP-CODE.                                            01130006
011400         10  PV-SHIP-1-2             PIC  X(02).                  01140005
011500         10  PV-SHIP-3               PIC  X(01).                  01150005
011600         10  PV-SHIP-4-10            PIC  X(07).                  01160005
011700         10  PV-SHIP-11-19           PIC  X(09).                  01170005
011800         10  PV-SHIP-20              PIC  X(01).                  01180005
011900         10  FILLER                  PIC  X(20).                  01190005
012000                                                                  01200005
012100     05  PV-SHIP-CODE-FORMAT.                                     01210005
012200         10  FILLER                  PIC  X(01)    VALUE '('.     01220005
012300         10  PV-SHIP-FMT-1-2         PIC  X(02).                  01230005
012400         10  FILLER                  PIC  X(02)    VALUE ') '.    01240005
012500         10  PV-SHIP-FMT-3           PIC  X(01).                  01250005
012600         10  FILLER                  PIC  X(01)    VALUE SPACE.   01260005
012700         10  PV-SHIP-FMT-4-10        PIC  X(07).                  01270005
012800         10  FILLER                  PIC  X(01)    VALUE SPACE.   01280005
012900         10  PV-SHIP-FMT-11-19       PIC  X(09).                  01290005
013000         10  FILLER                  PIC  X(01)    VALUE SPACE.   01300005
013100         10  PV-SHIP-FMT-20          PIC  X(01).                  01310005
013200                                                                  01320017
013300     05  PV-SHIP-CODE-EXTRACT-NUM.                                01330017
013400         10  FILLER                  PIC  X(02).                  01340017
013500         10  PV-SHIP-CODE-NUM        PIC  X(18).                  01350017
013600         10  FILLER                  PIC  X(20).                  01360017
013700                                                                  01370017
013800     05  PV-ERROR-MSG-TEXT.                                       01380005
013900                                                                  01390005
014000         10  PV-ERROR-MSG-01         PIC X(80)     VALUE          01400005
014100     'SERIAL SHIP CODE NUMBER FORMAT IS INVALID'.                 01410005
014200                                                                  01420005
014300         10  PV-ERROR-MSG-02         PIC X(80)     VALUE          01430005
014400     'SERIAL SHIP CODE NUMBER FORMAT IS INVALID'.                 01440005
014500                                                                  01450005
014600         10  PV-ERROR-MSG-03         PIC X(80)     VALUE          01460005
014700     'SERIAL SHIP CODE NUMBER FORMAT IS INVALID'.                 01470005
014800                                                                  01480005
014900         10  PV-ERROR-MSG-04         PIC X(80)     VALUE          01490005
015000     'ASN INFORMATION RECEIVED WITHOUT SHIPPING UNIT INFORMATION'.01500005
015100                                                                  01510005
015200         10  PV-ERROR-MSG-05.                                     01520025
015300             15  FILLER              PIC X(45)     VALUE          01530025
015400             'SERIAL SHIP CODE HAS BEEN PREVIOUSLY SENT ON '.     01540025
015500             15  PV-ERROR-MSG-05-MM  PIC X(02)     VALUE SPACES.  01550024
015600             15  FILLER-05-1         PIC X(01)     VALUE '/'.     01560024
015700             15  PV-ERROR-MSG-05-DD  PIC X(02)     VALUE SPACES.  01570024
015800             15  FILLER-05-2         PIC X(01)     VALUE '/'.     01580024
015900             15  PV-ERROR-MSG-05-YYYY PIC X(04)    VALUE SPACES.  01590024
016000             15  FILLER-05-3         PIC X(25)     VALUE SPACES.  01600024
016100                                                                  01610005
016200         10  PV-ERROR-MSG-06         PIC X(80)     VALUE          01620022
016300        'DOWNLOADED PO/STR DOES NOT EQUAL MANUALLY ADDED PO/STR'. 01630022
016400         10  PV-ERROR-MSG-07         PIC X(80)     VALUE SPACES.  01640005
016500         10  PV-ERROR-MSG-08         PIC X(80)     VALUE SPACES.  01650005
016600         10  PV-ERROR-MSG-09         PIC X(80)     VALUE SPACES.  01660005
016700         10  PV-ERROR-MSG-10         PIC X(80)     VALUE SPACES.  01670005
016800                                                                  01680005
016900     05  PV-ERROR-MSG-TABLE REDEFINES PV-ERROR-MSG-TEXT.          01690005
017000         10  PV-ERROR-MSG            OCCURS 10 TIMES              01700005
017100                                     PIC X(80).                   01710005
017200     05  PV-ERROR-CODE               PIC 9(02)     COMP-3         01720005
017300                                                   VALUE ZERO.    01730005
017400                                                                  01740005
017500     COPY DPWS132O.                                               01750010
017600                                                                  01760002
017700                                                                  01770002
017800 01  HL1-HEADING-LINE-1.                                          01780001
017900     05  FILLER                      PIC  X(45)    VALUE SPACES.  01790003
018000     05  FILLER                      PIC  X(43)    VALUE          01800003
018100         'SHIPPING UNIT INFORMATION LOAD - EXCEPTIONS'.           01810003
018200     05  FILLER                      PIC  X(44)    VALUE SPACES.  01820003
018300                                                                  01830001
018400 01  HL2-HEADING-LINE-2.                                          01840001
018500     05  FILLER                      PIC  X(01)    VALUE SPACES.  01850001
018600     05  FILLER                      PIC  X(14)    VALUE          01860001
018700         'OPER UNIT:    '.                                        01870003
018800     05  HL2-OPER-UNIT-NBR           PIC  ZZZZ     VALUE ZERO.    01880020
018900     05  FILLER                      PIC  X(01)    VALUE SPACES.  01890003
019000     05  HL2-OPER-UNIT-DESC          PIC  X(30)    VALUE SPACES.  01900003
019100     05  FILLER                      PIC  X(82)    VALUE SPACES.  01910003
019200                                                                  01920001
019300 01  HL3-HEADING-LINE-3.                                          01930003
019400     05  FILLER                      PIC  X(01)    VALUE SPACES.  01940003
019500     05  FILLER                      PIC  X(14)    VALUE          01950003
019600         'VENDOR:       '.                                        01960003
019700     05  HL3-VENDOR-NAME             PIC  X(30)    VALUE SPACES.  01970003
019800     05  FILLER                      PIC  X(87)    VALUE SPACES.  01980003
019900                                                                  01990003
020000 01  HL4-HEADING-LINE-4.                                          02000003
020100     05  FILLER                      PIC  X(03)    VALUE SPACES.  02010003
020200     05  FILLER                      PIC  X(12)    VALUE          02020003
020300         'PO NUMBER:  '.                                          02030003
020400     05  HL4-PO-NBR                  PIC  9(09)    VALUE ZERO.    02040003
020500     05  FILLER                      PIC  X(07)    VALUE SPACES.  02050023
020600     05  FILLER                      PIC  X(08)    VALUE          02060003
020700         'ASN:    '.                                              02070003
020800     05  HL4-ASN                     PIC  X(30)    VALUE ZERO.    02080023
020900     05  FILLER                      PIC  X(10)    VALUE SPACES.  02090003
021000     05  FILLER                      PIC  X(15)    VALUE          02100003
021100         'DATE SHIPPED:  '.                                       02110003
021200     05  HL4-SHIP-MM                 PIC  9(02)    VALUE ZERO.    02120003
021300     05  FILLER                      PIC  X(01)    VALUE '/'.     02130003
021400     05  HL4-SHIP-DD                 PIC  9(02)    VALUE ZERO.    02140003
021500     05  FILLER                      PIC  X(01)    VALUE '/'.     02150003
021600     05  HL4-SHIP-YYYY               PIC  9(04)    VALUE ZERO.    02160003
021700     05  FILLER                      PIC  X(28)    VALUE SPACES.  02170003
021800                                                                  02180003
021900 01  DL1-DETAIL-LINE-1.                                           02190003
022000     05  FILLER                      PIC  X(05)    VALUE SPACES.  02200003
022100     05  FILLER                      PIC  X(26)    VALUE          02210003
022200         'SERIAL SHIP CODE NUMBER:  '.                            02220003
022300     05  DL1-SHIP-CDE-NBR            PIC  X(40)    VALUE ZERO.    02230003
022400     05  FILLER                      PIC  X(09)    VALUE SPACES.  02240003
022500     05  FILLER                      PIC  X(08)    VALUE          02250003
022600         'STORE:  '.                                              02260003
022700     05  DL1-STORE-NBR               PIC  Z(04)    VALUE ZERO.    02270003
022800     05  FILLER                      PIC  X(40)    VALUE SPACES.  02280003
022900                                                                  02290001
023000 01  DL2-DETAIL-LINE-2.                                           02300003
023100     05  FILLER                      PIC  X(05)    VALUE SPACES.  02310003
023200     05  FILLER                      PIC  X(09)    VALUE          02320003
023300         'ERRORS:  '.                                             02330003
023400     05  DL2-ERROR-MSG               PIC  X(118)   VALUE SPACES.  02340003
023500                                                                  02350003
023600 01  DL3-DETAIL-LINE-3.                                           02360003
023700     05  FILLER                      PIC  X(14)    VALUE SPACES.  02370003
023800     05  FILLER                      PIC  X(20)    VALUE          02380003
023900         'PREVIOUS USE:  PO:  '.                                  02390003
024000     05  DL3-PO-NBR                  PIC  9(09)    VALUE ZERO.    02400003
024100     05  FILLER                      PIC  X(08)    VALUE          02410003
024200         ' LINE:  '.                                                      
024300     05  DL3-LINE-NBR                PIC  ZZ9      VALUE ZERO.    02430026
024400     05  FILLER                      PIC  X(11)    VALUE          02440003
024500         '   STORE:  '.                                           02450003
024600     05  DL3-STORE-NBR               PIC  ZZZ9     VALUE ZERO.    02460003
024700     05  FILLER                      PIC  X(63)    VALUE SPACES.  02470003
024800                                                                  02480003
024900 01  BL-BLANK-LINE                   PIC  X(132)   VALUE SPACES.  02490003
025000                                                                  02500001
025100 01  PR-PRINT-NO-DETAIL.                                          02510001
025200     05  FILLER                      PIC X(02)  VALUE SPACES.     02520001
025300     05  FILLER                      PIC X(35)  VALUE             02530001
025400         '*** THERE WAS NO DATA TO REPORT ON '.                   02540001
025500     05  FILLER                      PIC X(24)  VALUE             02550001
025600         'FOR THIS TIME PERIOD ***'.                              02560001
025700                                                                  02570001
025800 01  PR-PRINT-FINAL.                                              02580001
025900     05  FILLER                      PIC X(53)  VALUE SPACES.     02590001
026000     05  FILLER                      PIC X(21)  VALUE             02600001
026100         '*** END OF REPORT ***'.                                 02610001
026200                                                                  02620001
026200*******  COPYBOOK FOR LOGISTICS LOCATION MODULE (XLKUT071)        02620001
026300     COPY XLWS071.                                                02630010
026400                                                                  02640002
026300     COPY RCRD016.                                                02630010
026400                                                                  02640002
026500     COPY DPWS004.                                                02650010
026600                                                                  02660010
027300*---------------------------------------------------------------* 02730007
027400*    DB2 AREA FOR TSHUUPC                                       * 02740007
027500*---------------------------------------------------------------* 02750007
027600     EXEC SQL                                                     02760007
027700          INCLUDE TSHUUPC                                         02770007
027800     END-EXEC.                                                    02780007
027900*---------------------------------------------------------------* 02790007
028000*    DB2 AREA FOR TSHPUNT                                       * 02800007
028100*---------------------------------------------------------------* 02810007
028200     EXEC SQL                                                     02820007
028300          INCLUDE TSHPUNT                                         02830007
028400     END-EXEC.                                                    02840007
028500*---------------------------------------------------------------* 02850007
028600*    DB2 AREA FOR TENTNME                                       * 02860007
028700*---------------------------------------------------------------* 02870007
028800     EXEC SQL                                                     02880007
028900          INCLUDE TENTNME                                         02890007
029000     END-EXEC.                                                    02900007
029100*---------------------------------------------------------------* 02910007
029200*    DB2 AREA FOR TEXTENT                                       * 02920007
029300*---------------------------------------------------------------* 02930007
029400     EXEC SQL                                                     02940007
029500          INCLUDE TEXTENT                                         02950007
029600     END-EXEC.                                                    02960007
029700*---------------------------------------------------------------* 02970007
029800*    DB2 AREA FOR COMMUNICATIONS                                * 02980007
029900*---------------------------------------------------------------* 02990007
030000     EXEC SQL                                                     03000007
030100          INCLUDE SQLCA                                           03010007
030200     END-EXEC.                                                    03020007
030300*---------------------------------------------------------------* 03030019
030400*    CURSOR TO GET DUPLICATE SHIPMENTS                          * 03040019
030500*---------------------------------------------------------------* 03050019
030600     EXEC SQL                                                     03060019
030710         DECLARE DUP-CSR CURSOR FOR                               03071030
030800             SELECT DISTINCT                                      03080030
030810                    B.CRE_DTE,                                    03081030
030900                    B.DEST_OPER_UNT_ID,                           03090019
031000                    A.TRN_NBR,                                    03100019
031100                    A.TRN_LNE_NBR                                 03110019
031200             FROM TSHUUPC A,                                      03120019
031300                  TSHPUNT B                                       03130019
031400             WHERE A.SHIPT_UNT_ID = :SHUUPC-SHIPT-UNT-ID          03140019
031500               AND A.SHIPT_UNT_ID = B.SHIPT_UNT_ID                03150019
031600               ORDER BY B.CRE_DTE, A.TRN_NBR, A.TRN_LNE_NBR       03160019
031700     END-EXEC.                                                    03170019
031800                                                                  03180019
031900***************************************************************** 03190001
032000 PROCEDURE DIVISION.                                              03200001
032100***************************************************************** 03210001
032200                                                                  03220002
032300 0000-MAINLINE.                                                   03230001
032400***************************************************************** 03240001
032500*  THIS PARAGRAPH DRIVES THE PROGRAM.                           * 03250001
032600***************************************************************** 03260001
032700     PERFORM 1000-INITIALIZE.                                     03270001
032800                                                                  03280002
032900     IF  PS-EOF                                                   03290003
033000         PERFORM 6900-NO-DETAIL                                   03300001
033100     ELSE                                                         03310001
033200         PERFORM 2000-MAIN-PROCESS                                03320001
033300           UNTIL  PS-EOF                                          03330003
033400     END-IF.                                                      03340001
033500                                                                  03350002
033600     PERFORM 9000-END-PROCESS.                                    03360001
033700                                                                  03370002
033800     GOBACK.                                                      03380002
033900                                                                  03390002
034000 1000-INITIALIZE.                                                 03400001
034100***************************************************************** 03410001
034200*  PROGRAM INITIALIZATION                                       * 03420001
034300*    -- OPEN INPUT AND OUTPUT FILES.                            * 03430001
034400*    -- ACCEPT DATE AND TIME FROM THE SYSTEM AND INITIALIZE     * 03440001
034500*       THE REPORT HEADINGS.                                    * 03450001
034600***************************************************************** 03460001
034700     OPEN  INPUT ERROR-FILE                                       03470003
034800           OUTPUT ERROR-REPORT-FILE.                              03480003
034900                                                                  03490002
035000     ACCEPT CD-CPU-DATE FROM DATE.                                03500001
035100     ACCEPT CT-CPU-TIME FROM TIME.                                03510001
035200                                                                  03520002
035300     PERFORM 7000-READ-ERROR-FILE.                                03530006
035310     SET FIRST-TIME-IN TO TRUE                                    03531031
035400     PERFORM 1200-INITIALIZE-HEADINGS.                            03540001
035500     PERFORM 6999-PRINT-HEADINGS.                                 03550001
035600                                                                  03560001
035700 1200-INITIALIZE-HEADINGS.                                        03570001
035800***************************************************************** 03580001
035900*  INITIALIZE REPORT HEADINGS                                   * 03590001
036000***************************************************************** 03600001
036100     MOVE CD-YEAR                TO DP132O-RUN-YEAR.              03610001
036200     MOVE CD-MONTH               TO DP132O-RUN-MONTH.             03620001
036300     MOVE CD-DAY                 TO DP132O-RUN-DAY.               03630001
036400     MOVE CT-HOUR                TO DP132O-RUN-HOUR.              03640001
036500     MOVE CT-MINUTE              TO DP132O-RUN-MINUTE.            03650001
036600     MOVE 'RCKRP014'             TO DP132O-PROGRAM-NAME.          03660003
036700     MOVE PC-1                   TO DP132O-REPORT-NUMBER.         03670001
036800                                                                  03680006
036900     IF PS-EOF                                                    03690006
037000         MOVE ZERO               TO HL2-OPER-UNIT-NBR             03700008
037100         MOVE SPACES             TO HL2-OPER-UNIT-DESC            03710006
037200     ELSE                                                         03720006
037300         PERFORM 1210-GET-OPER-UNIT                               03730006
037400     END-IF.                                                      03740006
037500                                                                  03750006
037600 1210-GET-OPER-UNIT.                                              03760006
037700     INITIALIZE XL071-COMMAREA-REC.                               03770006
037800     MOVE RC016-ASN-OPER-UNIT                                     03780020
037900                             TO PV-SAVE-LOC.                      03790020
038000     IF RC016-ASN-OPER-UNIT IS NUMERIC                            03800020
038100         MOVE RC016-ASN-OPER-UNIT                                 03810020
038200                             TO XL071-LOCATION-NUMBER             03820020
038300                                HL2-OPER-UNIT-NBR                 03830020
038400                                                                  03840020
038500         CALL XL071-LOCATION-MODULE USING XL071-COMMAREA-REC      03850020
038600                                                                  03860020
039100         EVALUATE TRUE                                            03910020
039200             WHEN XL071-NO-ERRORS                                 03920020
039300                 MOVE XL071-LOC-NM   TO HL2-OPER-UNIT-DESC        03930020
039400             WHEN XL071-LOC-NOT-FOUND                             03940020
039500                 MOVE SPACES         TO HL2-OPER-UNIT-DESC        03950020
039600             WHEN XL071-BAD-DB2-RETURN                            03960020
039700                 DISPLAY '** ABEND ** IN RCKRP014'                03970020
039800                 DISPLAY 'PARAGRAPH:  1210-GET-OPER-UNIT'         03980020
039900                 DISPLAY 'MESSAGE:  SQL ERROR SELECTING OPER UNIT'03990020
039900                 DISPLAY 'OPER. UNT:  ' XL071-LOCATION-NUMBER     03990020
040000                 PERFORM 9999-SQL-ERROR                           04000020
040100         END-EVALUATE                                             04010020
040300     ELSE                                                         04030020
040400         MOVE ZERO             TO HL2-OPER-UNIT-NBR               04040020
040500         MOVE 'UNKNOWN'        TO HL2-OPER-UNIT-DESC              04050020
040600     END-IF.                                                      04060020
040700                                                                  04070020
040800 2000-MAIN-PROCESS.                                               04080001
040900                                                                  04090002
041000     PERFORM 3000-PROCESS-DETAIL-RECORD.                          04100001
041100                                                                  04110002
041200     PERFORM 7000-READ-ERROR-FILE.                                04120003
041300                                                                  04130002
041400 3000-PROCESS-DETAIL-RECORD.                                      04140001
041500                                                                  04150001
041510     IF RC016-NO-CART-RECS                                        04151033
041520         IF  RC016-ASN-OPER-UNIT = PV-SAVE-LOC                    04190026
041530             PERFORM 6000-PRINT-DETAIL-LINE                       04200026
041540         ELSE                                                     04210026
041550             PERFORM 1210-GET-OPER-UNIT                           04220026
041560             PERFORM 6999-PRINT-HEADINGS                          04230026
041570             PERFORM 6000-PRINT-DETAIL-LINE                       04240026
041580         END-IF                                                   04250026
041590     ELSE                                                                 
041600        IF RC016-ASN-CARTON-NBR = PV-SAVE-CARTON                          
041620            CONTINUE                                                 04162
041800        ELSE                                                         04180
041810            SET NOT-FIRST-TIME-IN TO TRUE                            04181
041900            IF  RC016-ASN-OPER-UNIT = PV-SAVE-LOC                    04190
042000                PERFORM 6000-PRINT-DETAIL-LINE                       04200
042100            ELSE                                                     04210
042200                PERFORM 1210-GET-OPER-UNIT                           04220
042300                PERFORM 6999-PRINT-HEADINGS                          04230
042400                PERFORM 6000-PRINT-DETAIL-LINE                       04240
042500            END-IF                                                   04250
042600        END-IF                                                       04260
042610     END-IF.                                                      04260   
042700                                                                  04270002
042800 6000-PRINT-DETAIL-LINE.                                          04280001
042900                                                                  04290002
043100     IF  PV-LINE-COUNT > PC-LINE-LIMIT                            04310001
043200         PERFORM 6999-PRINT-HEADINGS                              04320001
043300     END-IF.                                                      04330001
043400                                                                  04340002
043500     IF  RC016-ASN-VENDOR-NBR = PV-SAVE-VENDOR                    04350004
043600         CONTINUE                                                 04360004
043700     ELSE                                                         04370004
043800         MOVE RC016-ASN-VENDOR-NBR                                04380004
043900                                 TO PV-SAVE-VENDOR                04390004
044000         PERFORM 6100-PRINT-VENDOR-LINE                           04400006
044100         IF  PV-LINE-COUNT > PC-LINE-LIMIT                        04410004
044200             PERFORM 6999-PRINT-HEADINGS                          04420004
044300         END-IF                                                   04430004
044400     END-IF.                                                      04440004
044500                                                                  04450004
044600     IF  RC016-ASN-CARTON-PO = PV-SAVE-PO AND                     04460004
044700         RC016-ASN-ASNHDR-NBR = PV-SAVE-ASNHDR AND                04470023
044800         RC016-ASN-DATE-SHIPPED = PV-SAVE-DATE-SHIPPED            04480004
044900         CONTINUE                                                 04490004
045000     ELSE                                                         04500004
045010         SET FIRST-TIME-IN TO TRUE                                        
045100         MOVE RC016-ASN-CARTON-PO                                 04510004
045200                                 TO PV-SAVE-PO                    04520004
045300                                    HL4-PO-NBR                    04530004
045400         MOVE RC016-ASN-ASNHDR-NBR                                04540023
045500                                 TO PV-SAVE-ASNHDR                04550023
045600                                    HL4-ASN                       04560023
045700         MOVE RC016-ASN-DATE-SHIPPED                              04570004
045800                                 TO PV-SAVE-DATE-SHIPPED          04580004
045900         PERFORM 6010-DATE-SHIPPED                                04590006
046000         WRITE ERROR-REPORT-RECORD                                04600006
046100           FROM HL4-HEADING-LINE-4                                04610006
046200             AFTER ADVANCING 2 LINES                              04620006
046300         ADD 2                      TO PV-LINE-COUNT              04630006
046400         MOVE 1                     TO PV-LINE-ADVANCE            04640027
046500         IF  PV-LINE-COUNT > PC-LINE-LIMIT                        04650004
046600             PERFORM 6999-PRINT-HEADINGS                          04660004
046700         END-IF                                                   04670004
046800     END-IF.                                                      04680004
046900                                                                  04690004
047000     IF RC016-FIRST-NOT-00    OR                                  04700016
047100        RC016-NOT-NUMERIC     OR                                  04710016
047200        RC016-21-40-GT-SPACES OR                                  04720016
047300        RC016-ASN-CARTON-NBR = SPACES                             04730016
047400         MOVE RC016-ASN-CARTON-NBR                                04740014
047500                                TO DL1-SHIP-CDE-NBR               04750014
047600     ELSE                                                         04760014
047700         MOVE RC016-ASN-CARTON-NBR                                04770014
047800                                TO PV-SHIP-CODE                   04780014
047900         MOVE PV-SHIP-1-2       TO PV-SHIP-FMT-1-2                04790014
048000         MOVE PV-SHIP-3         TO PV-SHIP-FMT-3                  04800014
048100         MOVE PV-SHIP-4-10      TO PV-SHIP-FMT-4-10               04810014
048200         MOVE PV-SHIP-11-19     TO PV-SHIP-FMT-11-19              04820014
048300         MOVE PV-SHIP-20        TO PV-SHIP-FMT-20                 04830014
048400         MOVE PV-SHIP-CODE-FORMAT                                 04840014
048500                                TO DL1-SHIP-CDE-NBR               04850014
048600     END-IF.                                                      04860014
048700     MOVE RC016-ASN-STORE-NBR   TO DL1-STORE-NBR.                 04870004
048800                                                                  04880004
048810     IF RC016-ASN-CARTON-NBR = PV-SAVE-CARTON AND                         
048811        NOT-FIRST-TIME-IN                                                 
048820        CONTINUE                                                          
048830     ELSE                                                                 
048840        SET NOT-FIRST-TIME-IN TO TRUE                                     
048900        WRITE ERROR-REPORT-RECORD                                    04890
049000          FROM DL1-DETAIL-LINE-1                                     04900
049100            AFTER ADVANCING PV-LINE-ADVANCE LINES                    04910
049200        ADD PV-LINE-ADVANCE        TO PV-LINE-COUNT                  04920
049300        MOVE 2                     TO PV-LINE-ADVANCE                04930
049500        IF RC016-PREVIOUSLY-SENT                                     04950
049600            PERFORM 6030-PREV-SENT-ERROR                             04960
049700        ELSE                                                         04970
049800            PERFORM 6020-MISC-ERROR                                  04980
049900        END-IF                                                       04990
049910     END-IF.                                                      04990   
050000                                                                  05000005
050010     MOVE RC016-ASN-CARTON-NBR TO PV-SAVE-CARTON.                 04300026
050020                                                                  05000005
050100 6010-DATE-SHIPPED.                                               05010006
050200                                                                  05020006
050300     MOVE RC016-ASN-DATE-SHIPPED                                  05030006
050400                                TO PV-SHIP-DATE.                  05040006
050500     MOVE PV-SHIP-MM            TO HL4-SHIP-MM.                   05050006
050600     MOVE PV-SHIP-DD            TO HL4-SHIP-DD.                   05060006
050700     MOVE PV-SHIP-YYYY          TO HL4-SHIP-YYYY.                 05070006
050800                                                                  05080006
050900 6020-MISC-ERROR.                                                 05090007
051000                                                                  05100007
051100     MOVE RC016-ASN-CARTON-ERR  TO PV-ERROR-CODE.                 05110007
051200     MOVE PV-ERROR-MSG (PV-ERROR-CODE)                            05120007
051300                                TO DL2-ERROR-MSG.                 05130007
051400                                                                  05140007
051500     WRITE ERROR-REPORT-RECORD                                    05150007
051600       FROM DL2-DETAIL-LINE-2                                     05160007
051700         AFTER ADVANCING 1 LINE.                                  05170007
051800     ADD 1                      TO PV-LINE-COUNT.                 05180007
051900     IF  PV-LINE-COUNT > PC-LINE-LIMIT                            05190007
052000         PERFORM 6999-PRINT-HEADINGS                              05200007
052100     END-IF.                                                      05210007
052200                                                                  05220007
052300 6030-PREV-SENT-ERROR.                                            05230007
052400                                                                  05240007
052500     MOVE RC016-ASN-CARTON-NBR TO PV-SHIP-CODE-EXTRACT-NUM.       05250018
052600     MOVE PV-SHIP-CODE-NUM     TO SHUUPC-SHIPT-UNT-ID.            05260018
052700                                                                  05270019
052800     EXEC SQL                                                     05280019
052900          OPEN DUP-CSR                                            05290019
053000     END-EXEC.                                                    05300019
053100     EVALUATE TRUE                                                05310019
053200         WHEN SQLCODE = ZERO                                      05320019
053300             CONTINUE                                             05330019
053400         WHEN OTHER                                               05340019
053500             DISPLAY '** ABEND ** IN RCKRP014'                    05350019
053600             DISPLAY 'PARAGRAPH:  6030-PREV-SENT-ERROR'           05360019
053700             DISPLAY 'MESSAGE:  SQL ERROR OPENING DUP CURSOR'     05370019
053800             PERFORM 9999-SQL-ERROR                               05380019
053900     END-EVALUATE.                                                05390019
054000                                                                  05400019
054100     SET PS-NOT-END-OF-CURSOR                                     05410021
054200         PS-NO-DUP-FOUND      TO TRUE.                            05420021
054300     PERFORM 6031-PROCESS-CURSOR                                  05430019
054400         UNTIL PS-END-OF-CURSOR.                                  05440019
054500                                                                  05450019
054600     EXEC SQL                                                     05460019
054700          CLOSE DUP-CSR                                           05470019
054800     END-EXEC.                                                    05480019
054900     EVALUATE TRUE                                                05490019
055000         WHEN SQLCODE = ZERO                                      05500019
055100             CONTINUE                                             05510019
055200         WHEN OTHER                                               05520019
055300             DISPLAY '** ABEND ** IN RCKRP014'                    05530019
055400             DISPLAY 'PARAGRAPH:  6030-PREV-SENT-ERROR'           05540019
055500             DISPLAY 'MESSAGE:  SQL ERROR CLOSING DUP CURSOR'     05550019
055600             PERFORM 9999-SQL-ERROR                               05560019
055700     END-EVALUATE.                                                05570019
055800                                                                  05580019
055900     IF PS-NO-DUP-FOUND                                           05590021
056000         MOVE SPACES            TO PV-ERROR-MSG-05-MM             05600021
056100                                   PV-ERROR-MSG-05-DD             05610021
056200                                   PV-ERROR-MSG-05-YYYY           05620021
056300         MOVE RC016-ASN-CARTON-ERR                                05630021
056400                                TO PV-ERROR-CODE                  05640021
056500         MOVE PV-ERROR-MSG (PV-ERROR-CODE)                        05650021
056600                                TO DL2-ERROR-MSG                  05660021
056700         WRITE ERROR-REPORT-RECORD                                05670021
056800           FROM DL2-DETAIL-LINE-2                                 05680021
056900             AFTER ADVANCING 1 LINE                               05690021
057000         ADD 1                  TO PV-LINE-COUNT                  05700021
057100         IF  PV-LINE-COUNT > PC-LINE-LIMIT                        05710021
057200             PERFORM 6999-PRINT-HEADINGS                          05720021
057300         END-IF                                                   05730021
057400     END-IF.                                                      05740021
057500***************************************************************** 05750019
057600*  PROCESS THE DUPLICATE CURSOR.                                * 05760019
057700***************************************************************** 05770019
057800 6031-PROCESS-CURSOR.                                             05780019
057900                                                                  05790019
058000     EXEC SQL                                                     05800019
058100         FETCH DUP-CSR                                            05810019
058200         INTO :SHPUNT-CRE-DTE,                                    05820019
058300              :SHPUNT-DEST-OPER-UNT-ID,                           05830019
058400              :SHUUPC-TRN-NBR,                                    05840019
058500              :SHUUPC-TRN-LNE-NBR                                 05850019
058600     END-EXEC.                                                    05860019
058700     EVALUATE TRUE                                                05870019
058800         WHEN SQLCODE = ZERO                                      05880019
058900             SET PS-DUP-FOUND     TO TRUE                         05890021
059000         WHEN SQLCODE = +100                                      05900019
059100             SET PS-END-OF-CURSOR TO TRUE                         05910019
059200         WHEN OTHER                                               05920019
059300             DISPLAY '** ABEND ** IN RCKRP014'                    05930019
059400             DISPLAY 'PARAGRAPH:  6031-PROCESS-CURSOR'            05940019
059500             DISPLAY 'MESSAGE:  SQL ERROR FETCHING DUP CURSOR'    05950019
059600             PERFORM 9999-SQL-ERROR                               05960019
059700     END-EVALUATE.                                                05970019
059800                                                                  05980019
059900     IF PS-NOT-END-OF-CURSOR                                      05990019
060000         MOVE SHPUNT-CRE-DTE    TO PV-ISO-DATE                    06000019
060100         MOVE PV-ISO-YYYY       TO PV-ERROR-MSG-05-YYYY           06010019
060200         MOVE PV-ISO-MM         TO PV-ERROR-MSG-05-MM             06020019
060300         MOVE PV-ISO-DD         TO PV-ERROR-MSG-05-DD             06030019
060400         MOVE SHUUPC-TRN-NBR    TO DL3-PO-NBR                     06040019
060500         MOVE SHUUPC-TRN-LNE-NBR                                  06050019
060600                                TO DL3-LINE-NBR                   06060019
060700         MOVE SHPUNT-DEST-OPER-UNT-ID                             06070019
060800                                TO DL3-STORE-NBR                  06080019
060900         MOVE RC016-ASN-CARTON-ERR                                06090019
061000                                TO PV-ERROR-CODE                  06100019
061100         MOVE PV-ERROR-MSG (PV-ERROR-CODE)                        06110019
061200                                TO DL2-ERROR-MSG                  06120019
061300         WRITE ERROR-REPORT-RECORD                                06130019
061400           FROM DL2-DETAIL-LINE-2                                 06140019
061500             AFTER ADVANCING 1 LINE                               06150019
061600         WRITE ERROR-REPORT-RECORD                                06160019
061700           FROM DL3-DETAIL-LINE-3                                 06170019
061800             AFTER ADVANCING 1 LINE                               06180019
061900         ADD 2                  TO PV-LINE-COUNT                  06190019
062000         IF  PV-LINE-COUNT > PC-LINE-LIMIT                        06200019
062100             PERFORM 6999-PRINT-HEADINGS                          06210019
062200         END-IF                                                   06220019
062300     END-IF.                                                      06230019
062400                                                                  06240019
062500***************************************************************** 06250006
062600*  PRINT THE VENDOR LINE.                                       * 06260006
062700***************************************************************** 06270006
062800 6100-PRINT-VENDOR-LINE.                                          06280006
062900                                                                  06290006
063000     EXEC SQL                                                     06300006
063100         SELECT N.ENT_NAME_DESC                                   06310006
063200         INTO :ENTNME-ENT-NAME-DESC                               06320006
063300         FROM TENTNME N,                                          06330006
063400              TEXTENT X                                           06340006
063500         WHERE X.DUN_NBR = :RC016-ASN-VENDOR-NBR                  06350006
063600           AND X.ENT_ID  = N.ENT_ID                               06360006
                 AND N.TYPE_CDE = '01'                                          
063700     END-EXEC.                                                    06370006
063800     EVALUATE TRUE                                                06380006
063900         WHEN SQLCODE = ZERO                                      06390006
064000         WHEN SQLCODE = -811                                      06400006
064100             CONTINUE                                             06410006
064200         WHEN SQLCODE = +100                                      06420006
064300             MOVE SPACES         TO ENTNME-ENT-NAME-DESC          06430006
064400         WHEN OTHER                                               06440006
064500             DISPLAY '** ABEND ** IN RCKRP014'                    06450009
064600             DISPLAY 'PARAGRAPH:  6100-PRINT-VENDOR-LINE'         06460009
064700             DISPLAY 'MESSAGE:  SQL ERROR SELECTING VENDOR NAME'  06470009
064800             PERFORM 9999-SQL-ERROR                               06480009
064900     END-EVALUATE.                                                06490006
065000     MOVE ENTNME-ENT-NAME-DESC TO HL3-VENDOR-NAME.                06500006
065100     WRITE ERROR-REPORT-RECORD                                    06510006
065200       FROM HL3-HEADING-LINE-3                                    06520006
065300         AFTER ADVANCING 2 LINES.                                 06530006
065400     ADD 3                      TO PV-LINE-COUNT.                 06540006
065500                                                                  06550006
065600 6900-NO-DETAIL.                                                  06560001
065700***************************************************************** 06570001
065800*  PRINT NO DETAIL LINE.                                        * 06580006
065900***************************************************************** 06590001
066000     WRITE ERROR-REPORT-RECORD                                    06600003
066100       FROM PR-PRINT-NO-DETAIL                                    06610001
066200         AFTER ADVANCING 3 LINES.                                 06620003
066300                                                                  06630002
066400 6999-PRINT-HEADINGS.                                             06640001
066500***************************************************************** 06650001
066600*  HEADING ROUTINE.                                             * 06660001
066700***************************************************************** 06670001
066800     ADD 1                       TO PV-PAGE-COUNT.                06680001
066900     MOVE PV-PAGE-COUNT          TO DP132O-PAGE-NUMBER.           06690001
067000                                                                  06700002
067100     WRITE ERROR-REPORT-RECORD                                    06710003
067200       FROM DP132O-STANDRD-HEADER-132-COLS                        06720001
067300         AFTER ADVANCING PAGE.                                    06730001
067400                                                                  06740002
067500     WRITE ERROR-REPORT-RECORD                                    06750003
067600       FROM HL1-HEADING-LINE-1                                    06760001
067700         AFTER ADVANCING 2 LINES.                                 06770003
067800                                                                  06780002
067900     WRITE ERROR-REPORT-RECORD                                    06790003
068000       FROM HL2-HEADING-LINE-2                                    06800001
068100         AFTER ADVANCING 3 LINES.                                 06810004
068200                                                                  06820002
068300     MOVE 6                      TO PV-LINE-COUNT.                06830004
068400                                                                  06840002
068500 7000-READ-ERROR-FILE.                                            06850003
068600      READ ERROR-FILE INTO RC016-ASN-CARTON-ERRORS                06860003
068700          AT END                                                  06870001
068800             SET PS-EOF TO TRUE.                                  06880003
068900                                                                  06890001
069000 9000-END-PROCESS.                                                06900001
069100***************************************************************** 06910001
069200*  CLOSE FILES.                                                   06920001
069300***************************************************************** 06930001
069400                                                                  06940001
069500     WRITE ERROR-REPORT-RECORD                                    06950003
069600       FROM PR-PRINT-FINAL                                        06960001
069700         AFTER ADVANCING 3 LINES.                                 06970003
069800                                                                  06980001
069900     CLOSE ERROR-FILE                                             06990003
070000           ERROR-REPORT-FILE.                                     07000003
070100                                                                  07010002
070200 9999-SQL-ERROR.                                                  07020009
070300                                                                  07030009
070400     COPY DPPD004.                                                07040009
070500                                                                  07050009
070600     MOVE +4013 TO PV-ABEND-CODE.                                 07060009
070700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07070009
070800                                                                  07080009
