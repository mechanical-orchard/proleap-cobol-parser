000100 IDENTIFICATION DIVISION.                                         00010000
000200******************************************************************00020099
000300 PROGRAM-ID.    PXKUT025.                                         00030099
000400 AUTHOR.        JOYCE KNOKE.                                      00040099
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050099
000600 DATE-WRITTEN.  NOVEMBER 2006.                                    00060099
000700 DATE-COMPILED.                                                   00070099
000800******************************************************************00080099
000900* THIS PROGRAM READS IN THE SORTED OUTPUT FROM PXKUT024 AND       00090099
001000* DETERMINES ALL THE SKU NUMBERS AND LOCATIONS FOR EACH EVENT     00100099
001100* DATE.                                                           00110099
001200***************************************************************** 00120099
001300* 09/13/2007 - DAVE WELLER                                        00130099
001400*     ADDED DEPT_NBR TO THE OUTPUT FILE                           00140099
001500***************************************************************** 00150099
001600 ENVIRONMENT DIVISION.                                            00160099
001700***************************************************************** 00170099
001800 CONFIGURATION SECTION.                                           00180099
001900                                                                  00190099
002000 INPUT-OUTPUT SECTION.                                            00200099
002100                                                                  00210099
002200 FILE-CONTROL.                                                    00220099
002300                                                                  00230099
002400     SELECT IN-EVENT-FILE                                         00240099
002500         ASSIGN TO INP01.                                         00250099
002600                                                                  00260099
002700     SELECT OUT-SKU-FILE                                          00270099
002800         ASSIGN TO OUT01.                                         00280099
002900                                                                  00290099
003000******************************************************************00300099
003100 DATA DIVISION.                                                   00310099
003200******************************************************************00320099
003300 FILE SECTION.                                                    00330099
003400                                                                  00340099
003500 FD  IN-EVENT-FILE                                                00350099
003600     RECORDING MODE F                                             00360099
003700     LABEL RECORDS ARE STANDARD                                   00370099
003800     BLOCK CONTAINS 0 RECORDS.                                    00380099
003900 01  IN-EVENT-RECORD                     PIC  X(20).              00390099
004000                                                                  00400099
004100 FD  OUT-SKU-FILE                                                 00410099
004200     RECORDING MODE F                                             00420099
004300     LABEL RECORDS ARE STANDARD                                   00430099
004400     BLOCK CONTAINS 0 RECORDS.                                    00440099
004500*01  OUT-SKU-RECORD                      PIC  X(21).              00450099
004600 01  OUT-SKU-RECORD                      PIC  X(24).              00460099
004700                                                                  00470099
004800****************************************************************  00480099
004900 WORKING-STORAGE SECTION.                                         00490099
005000****************************************************************  00500099
005100**PROGRAM ACCUMULATORS                                            00510099
005200****************************************************************  00520099
005300 01  PA-PROGRAM-ACCUMULATORS.                                     00530099
005400     05  PA-TOT-INPUT-RECS-READ       PIC 9(05) VALUE ZEROS.      00540099
005500     05  PA-TOT-SKU-RECS-READ         PIC 9(13) VALUE ZEROS.      00550099
005600     05  PA-TOT-SKU-WRITTEN           PIC 9(13) VALUE ZEROS.      00560099
005700                                                                  00570099
005800****************************************************************  00580099
005900**PROGRAM VARIABLES.                                              00590099
006000****************************************************************  00600099
006100 01  PV-PROGRAM-VARIABLES.                                        00610099
006200     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     00620099
006300     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACE.     00630099
006400     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACE.     00640099
006500     05  PV-OPERATION-MSG             PIC  X(30) VALUE SPACE.     00650099
006600     05  PV-DB2-OPERATION             PIC  X(30) VALUE SPACE.     00660099
006700     05  PV-EVENT-DATE                PIC  X(10) VALUE SPACE.     00670099
006800     05  PV-SQL-SUB                   PIC S9(04) COMP             00680099
006900                                                 VALUE +0.        00690099
007000                                                                  00700099
007100****************************************************************  00710099
007200**PROGRAM SWITCHES.                                               00720099
007300****************************************************************  00730099
007400 01  PS-PROGRAM-SWITCHES.                                         00740099
007500     05  PS-END-OF-FILE-SW            PIC  X(01) VALUE 'N'.       00750099
007600         88 PS-END-OF-FILE-N                     VALUE 'N'.       00760099
007700         88 PS-END-OF-FILE-Y                     VALUE 'Y'.       00770099
007800     05  PS-END-OF-CSR-SW             PIC  X(01) VALUE 'N'.       00780099
007900         88 PS-END-OF-CSR-N                      VALUE 'N'.       00790099
008000         88 PS-END-OF-CSR-Y                      VALUE 'Y'.       00800099
008100                                                                  00810099
008200****************************************************************  00820099
008300**PROGRAM CONSTANTS.                                              00830099
008400****************************************************************  00840099
008500 01  PC-PROGRAM-CONSTANTS.                                        00850099
008600     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08) VALUE 'PXKUT025'.00860099
008700     05  PC-MAX-RETRIES               PIC S9(004) COMP            00870099
008800                                                 VALUE +5.        00880099
008900****************************************************************  00890099
009000**ABEND INFORMATION                                               00900099
009100****************************************************************  00910099
009200 01  AC-ABEND-CODE                    PIC S9(04) VALUE ZERO       00920099
009300                                                 COMP SYNC.       00930099
009400     88  AC-DB2-ERROR                            VALUE +4013.     00940099
009500     88  AC-CONTROL-CARD-ERROR                   VALUE +4003.     00950099
009600                                                                  00960099
009700************************************************************      00970099
009800* MOS EVENTS FIRST MARKDOWN                                       00980099
009900************************************************************      00990099
010000     COPY PXRD030.                                                01000099
010100                                                                  01010099
010200************************************************************      01020099
010300* MOS SKU EXTRACT                                                 01030099
010400************************************************************      01040099
010500     COPY PXRD031.                                                01050099
010600                                                                  01060099
010700***************************************************************** 01070099
010800*  ABEND ROUTINE INFORMATION                                      01080099
010900***************************************************************** 01090099
011000     COPY DPWS900.                                                01100000
011100                                                                  01110099
011200***************************************************************** 01120099
011300*  ABEND ROUTINE INFORMATION                                      01130099
011400***************************************************************** 01140099
011500     COPY DPWS004.                                                01150099
011600                                                                  01160099
011700************************************************************      01170099
011800* DB2 MESSAGE AREA                                                01180099
011900************************************************************      01190099
012000     COPY SQLCA2.                                                 01200099
012100                                                                  01210099
012200************************************************************      01220099
012300* DB2 COMMUNICATIONS AREA                                         01230099
012400************************************************************      01240099
012500     EXEC SQL                                                     01250099
012600       INCLUDE SQLCA                                              01260099
012700     END-EXEC.                                                    01270099
012800                                                                  01280099
012900************************************************************      01290099
013000* DB2 TABLE XST_PRCHG (XST00063)                                  01300099
013100************************************************************      01310099
013200     EXEC SQL                                                     01320099
013300       INCLUDE XST00063                                           01330099
013400     END-EXEC.                                                    01340099
013500                                                                  01350099
013600************************************************************      01360099
013700* DB2 TABLE XST_STR_GP_PRCHG (XST00064)                           01370099
013800************************************************************      01380099
013900     EXEC SQL                                                     01390099
014000       INCLUDE XST00064                                           01400099
014100     END-EXEC.                                                    01410099
014200                                                                  01420099
014300************************************************************      01430099
014400* DB2 TABLE XST_STR_GP_MBSHP (XST00023)                           01440099
014500************************************************************      01450099
014600     EXEC SQL                                                     01460099
014700       INCLUDE XST00023                                           01470099
014800     END-EXEC.                                                    01480099
014900                                                                  01490099
015000************************************************************      01500099
015100* DB2 TABLE XST_PRCHG_MDSE (XST00065)                             01510099
015200************************************************************      01520099
015300     EXEC SQL                                                     01530099
015400       INCLUDE XST00065                                           01540099
015500     END-EXEC.                                                    01550099
015600                                                                  01560099
015700************************************************************      01570099
015800* DB2 TABLE TSKXREF                                               01580099
015900************************************************************      01590099
016000     EXEC SQL                                                     01600099
016100       INCLUDE TSKXREF                                            01610099
016200     END-EXEC.                                                    01620099
016300                                                                  01630099
016400************************************************************      01640099
016500* DB2 TABLE TSKST                                                 01650099
016600************************************************************      01660099
016700     EXEC SQL                                                     01670099
016800       INCLUDE TSKST                                              01680099
016900     END-EXEC.                                                    01690099
017000                                                                  01700099
017100************************************************************      01710099
017200* DB2 TABLE XST_PRCHGH HISTORY TABLE                              01720099
017300************************************************************      01730099
017400     EXEC SQL                                                     01740099
017500       INCLUDE XST00127                                           01750099
017600     END-EXEC.                                                    01760099
017700                                                                  01770099
017800************************************************************      01780099
017900* DB2 TABLE XST_STR_GP_PRCHGH HISTORY TABLE                       01790099
018000************************************************************      01800099
018100     EXEC SQL                                                     01810099
018200       INCLUDE XST00128                                           01820099
018300     END-EXEC.                                                    01830099
018400                                                                  01840099
018500************************************************************      01850099
018600* DB2 TABLE XST_PRCHG_MDSEH HISTORY TABLE                         01860099
018700************************************************************      01870099
018800     EXEC SQL                                                     01880099
018900       INCLUDE XST00129                                           01890099
019000     END-EXEC.                                                    01900099
019100                                                                  01910099
019200************************************************************      01920099
019300* SKU LOCATION CURSOR                                             01930099
019400************************************************************      01940099
019500     EXEC SQL                                                     01950099
019600       DECLARE SKU-CSR   CURSOR FOR                               01960099
019700         SELECT C.STR_NBR                                         01970099
019800               ,D.SKU_NBR                                         01980099
019900               ,E.INTR_UPC_ID                                     01990099
020000               ,A.DEPT_NBR                                        02000099
020100         FROM  XST_PRCHG        A                                 02010099
020200              ,XST_STR_GP_PRCHG B                                 02020099
020300              ,XST_STR_GP_MBSHP C                                 02030099
020400              ,XST_PRCHG_MDSE   D                                 02040099
020500              ,TSKXREF          E                                 02050099
020600              ,TSKST            F                                 02060099
020700         WHERE A.PRCHG_ID        = B.PRCHG_ID                     02070099
020800           AND A.LAST_ACTN_CDE   <> 'D'                           02080099
020900           AND A.PRCHG_ST_CDE    = 'APR'                          02090099
021000           AND A.EVNT_CTG_CDE    = 'CLR'                          02100099
021100           AND A.PRCHG_TYP_CDE   IN ('CLR','RCP','MK1','MK2',     02110099
021200                                     'FNL')                       02120099
021300           AND B.STR_GP_TYP_CDE  = C.STR_GP_TYP_CDE               02130099
021400           AND B.STR_GP_ID       = C.STR_GP_ID                    02140099
021500           AND B.LAST_ACTN_CDE   <> 'D'                           02150099
021600           AND B.PRCHG_EFF_DTE   = :PV-EVENT-DATE                 02160099
021700           AND C.EFF_BEG_DTE     <= B.PRCHG_EFF_DTE               02170099
021800           AND (C.EFF_END_DTE    >= B.PRCHG_EFF_DTE               02180099
021900             OR C.EFF_END_DTE IS NULL)                            02190099
022000           AND C.STR_NBR         = F.LOC_NBR                      02200099
022100           AND B.STR_GP_TYP_CDE  = D.STR_GP_TYP_CDE               02210099
022200           AND B.STR_GP_ID       = D.STR_GP_ID                    02220099
022300           AND B.PRCHG_ID        = D.PRCHG_ID                     02230099
022400           AND D.LAST_ACTN_CDE   <> 'D'                           02240099
022500           AND D.SKU_NBR         = E.SKU                          02250099
022600           AND E.ITM_NBR         = F.ITEM_NMBR                    02260099
022700           AND D.DEPT_NBR        IS NULL                          02270099
022800           AND D.MAJ_CL_NBR      IS NULL                          02280099
022900           AND D.SUB_CL_NBR      IS NULL                          02290099
023000           AND D.STYL_ID         IS NULL                          02300099
023100         UNION ALL                                                02310099
023200         SELECT C.STR_NBR                                         02320099
023300               ,D.SKU_NBR                                         02330099
023400               ,E.INTR_UPC_ID                                     02340099
023500               ,A.DEPT_NBR                                        02350099
023600         FROM  XST_PRCHGH       A                                 02360099
023700              ,XST_STR_GP_PRCHGH B                                02370099
023800              ,XST_STR_GP_MBSHP C                                 02380099
023900              ,XST_PRCHG_MDSEH  D                                 02390099
024000              ,TSKXREF          E                                 02400099
024100              ,TSKST            F                                 02410099
024200         WHERE A.PRCHG_ID        = B.PRCHG_ID                     02420099
024300           AND A.LAST_ACTN_CDE   <> 'D'                           02430099
024400           AND A.PRCHG_ST_CDE    = 'APR'                          02440099
024500           AND A.EVNT_CTG_CDE    = 'CLR'                          02450099
024600           AND A.PRCHG_TYP_CDE   IN ('CLR','RCP','MK1','MK2',     02460099
024700                                     'FNL')                       02470099
024800           AND B.STR_GP_TYP_CDE  = C.STR_GP_TYP_CDE               02480099
024900           AND B.STR_GP_ID       = C.STR_GP_ID                    02490099
025000           AND B.LAST_ACTN_CDE   <> 'D'                           02500099
025100           AND B.PRCHG_EFF_DTE   = :PV-EVENT-DATE                 02510099
025200           AND C.EFF_BEG_DTE     <= B.PRCHG_EFF_DTE               02520099
025300           AND (C.EFF_END_DTE    >= B.PRCHG_EFF_DTE               02530099
025400             OR C.EFF_END_DTE IS NULL)                            02540099
025500           AND C.STR_NBR         = F.LOC_NBR                      02550099
025600           AND B.STR_GP_TYP_CDE  = D.STR_GP_TYP_CDE               02560099
025700           AND B.STR_GP_ID       = D.STR_GP_ID                    02570099
025800           AND B.PRCHG_ID        = D.PRCHG_ID                     02580099
025900           AND D.LAST_ACTN_CDE   <> 'D'                           02590099
026000           AND D.SKU_NBR         = E.SKU                          02600099
026100           AND E.ITM_NBR         = F.ITEM_NMBR                    02610099
026200           AND D.DEPT_NBR        IS NULL                          02620099
026300           AND D.MAJ_CL_NBR      IS NULL                          02630099
026400           AND D.SUB_CL_NBR      IS NULL                          02640099
026500           AND D.STYL_ID         IS NULL                          02650099
026600         WITH UR                                                  02660099
026700     END-EXEC.                                                    02670099
026800                                                                  02680099
026900****************************************************************  02690099
027000 PROCEDURE DIVISION.                                              02700099
027100******************************************************************02710099
027200 0000-MAINLINE.                                                   02720099
027300     PERFORM 1000-HOUSEKEEPING.                                   02730099
027400                                                                  02740099
027500     PERFORM 2000-PROCESS-INPUT-FILE                              02750099
027600         UNTIL PS-END-OF-FILE-Y.                                  02760099
027700                                                                  02770099
027800     PERFORM 9000-END-OF-JOB.                                     02780099
027900                                                                  02790099
028000     STOP RUN.                                                    02800099
028100                                                                  02810099
028200****************************************************************  02820099
028300*     OPEN FILES, READ IN AND VALIDATE CONTROL DATE.              02830099
028400****************************************************************  02840099
028500 1000-HOUSEKEEPING.                                               02850099
028600     OPEN INPUT  IN-EVENT-FILE                                    02860099
028700          OUTPUT OUT-SKU-FILE.                                    02870099
028800                                                                  02880099
028900     PERFORM 3000-READ-INPUT-FILE.                                02890099
029000                                                                  02900099
029100     IF PS-END-OF-FILE-Y                                          02910099
029200         DISPLAY SPACES                                           02920099
029300         DISPLAY ALL '*'                                          02930099
029400         DISPLAY '  INPUT FILE IS EMPTY '                         02940099
029500         DISPLAY ALL '*'                                          02950099
029600         DISPLAY SPACES                                           02960099
029700     END-IF.                                                      02970099
029800                                                                  02980099
029900****************************************************************  02990099
030000*     PROCESS INPUT FILE                                          03000099
030100****************************************************************  03010099
030200 2000-PROCESS-INPUT-FILE.                                         03020099
030300     MOVE PX030-FRST-MKDN-DATE TO PV-EVENT-DATE.                  03030099
030400                                                                  03040099
030500     PERFORM 2200-OPEN-SKU-CSR.                                   03050099
030600                                                                  03060099
030700     PERFORM 2600-FETCH-SKU-CSR.                                  03070099
030800                                                                  03080099
030900     PERFORM 2400-PROCESS-CURSOR                                  03090099
031000             UNTIL PS-END-OF-CSR-Y.                               03100099
031100     SET PS-END-OF-CSR-N TO TRUE.                                 03110099
031200                                                                  03120099
031300     PERFORM 2800-CLOSE-SKU-CSR.                                  03130099
031400                                                                  03140099
031500     PERFORM 3000-READ-INPUT-FILE.                                03150099
031600                                                                  03160099
031700******************************************************************03170099
031800* OPEN SKU CSR                                                    03180099
031900******************************************************************03190099
032000 2200-OPEN-SKU-CSR.                                               03200099
032100                                                                  03210099
032200     PERFORM                                                      03220099
032300         WITH TEST AFTER                                          03230099
032400         VARYING PV-SQL-SUB                                       03240099
032500         FROM 1 BY 1                                              03250099
032600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03260099
032700                   OR  SQLCODE = 0)                               03270099
032800                                                                  03280099
032900         EXEC SQL                                                 03290099
033000           OPEN SKU-CSR                                           03300099
033100         END-EXEC                                                 03310099
033200                                                                  03320099
033300         EVALUATE TRUE                                            03330099
033400           WHEN SQLCODE = -904                                    03340099
033500           WHEN SQLCODE = -911                                    03350099
033600           WHEN SQLCODE = -913                                    03360099
033700           WHEN SQLCODE = 0                                       03370099
033800             CONTINUE                                             03380099
033900           WHEN SQLWARN0 NOT EQUAL SPACE                          03390099
034000           WHEN SQLCODE NOT EQUAL ZERO                            03400099
034100             MOVE '2200-OPEN-SKU-CSR'                             03410099
034200                                     TO PV-PARAGRAPH-NAME         03420099
034300             MOVE 'ERROR ON OPEN OF SKU-CSR CURSOR'               03430099
034400                                     TO PV-DB2-OPERATION          03440099
034500             PERFORM 9999-SQL-ABEND                               03450099
034600         END-EVALUATE                                             03460099
034700     END-PERFORM.                                                 03470099
034800                                                                  03480099
034900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03490099
035000       MOVE '2200-OPEN-SKU-CSR'                                   03500099
035100                             TO  PV-PARAGRAPH-NAME                03510099
035200       MOVE '2200- OPEN RETRIES EXCEEDED'                         03520099
035300                              TO  PV-DB2-OPERATION                03530099
035400       PERFORM 9999-SQL-ABEND                                     03540099
035500     END-IF.                                                      03550099
035600                                                                  03560099
035700****************************************************************  03570099
035800**    PROCESS CURSOR                                              03580099
035900****************************************************************  03590099
036000 2400-PROCESS-CURSOR.                                             03600099
036100     PERFORM 4000-WRITE-OUTPUT-FILE.                              03610099
036200                                                                  03620099
036300     PERFORM 2600-FETCH-SKU-CSR.                                  03630099
036400                                                                  03640099
036500                                                                  03650099
036600****************************************************************  03660099
036700**    FETCH SKU CURSOR                                            03670099
036800****************************************************************  03680099
036900 2600-FETCH-SKU-CSR.                                              03690099
037000     INITIALIZE DCLXST00023                                       03700099
037100                DCLXST00065                                       03710099
037200                DCLXST00063.                                      03720099
037300                                                                  03730099
037400     PERFORM                                                      03740099
037500         WITH TEST AFTER                                          03750099
037600         VARYING PV-SQL-SUB                                       03760099
037700         FROM 1 BY 1                                              03770099
037800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03780099
037900                   OR  SQLCODE = 0                                03790099
038000                   OR  SQLCODE = +100)                            03800099
038100                                                                  03810099
038200         EXEC SQL                                                 03820099
038300           FETCH SKU-CSR                                          03830099
038400           INTO  :XST00023-STR-NBR                                03840099
038500                ,:XST00065-SKU-NBR                                03850099
038600                ,:SKXREF-INTR-UPC-ID                              03860099
038700                ,:XST00063-DEPT-NBR                               03870099
038800         END-EXEC                                                 03880099
038900                                                                  03890099
039000         EVALUATE TRUE                                            03900099
039100           WHEN SQLCODE = -904                                    03910099
039200           WHEN SQLCODE = -911                                    03920099
039300           WHEN SQLCODE = -913                                    03930099
039400             CONTINUE                                             03940099
039500           WHEN SQLCODE = ZERO                                    03950099
039600                ADD 1 TO PA-TOT-SKU-RECS-READ                     03960099
039700                                                                  03970099
039800           WHEN SQLCODE = +100                                    03980099
039900             SET PS-END-OF-CSR-Y TO TRUE                          03990099
040000           WHEN SQLWARN0 NOT EQUAL SPACE                          04000099
040100           WHEN SQLCODE NOT EQUAL ZERO                            04010099
040200             MOVE '2600-FETCH-SKU-CSR'                            04020099
040300                                     TO PV-PARAGRAPH-NAME         04030099
040400             MOVE 'ERROR ON SKU-CSR FETCH'                        04040099
040500                                     TO PV-DB2-OPERATION          04050099
040600             PERFORM 9999-SQL-ABEND                               04060099
040700         END-EVALUATE                                             04070099
040800     END-PERFORM.                                                 04080099
040900                                                                  04090099
041000     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04100099
041100       MOVE '2600-FETCH-SKU-CSR'                                  04110099
041200                               TO  PV-PARAGRAPH-NAME              04120099
041300       MOVE '2600- FETCH RETRIES EXCEEDED'                        04130099
041400                               TO  PV-DB2-OPERATION               04140099
041500       PERFORM 9999-SQL-ABEND                                     04150099
041600     END-IF.                                                      04160099
041700                                                                  04170099
041800******************************************************************04180099
041900* CLOSE ITEM CSR                                                  04190099
042000******************************************************************04200099
042100 2800-CLOSE-SKU-CSR.                                              04210099
042200                                                                  04220099
042300     PERFORM                                                      04230099
042400         WITH TEST AFTER                                          04240099
042500         VARYING PV-SQL-SUB                                       04250099
042600         FROM 1 BY 1                                              04260099
042700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04270099
042800                   OR  SQLCODE = 0)                               04280099
042900                                                                  04290099
043000         EXEC SQL                                                 04300099
043100           CLOSE SKU-CSR                                          04310099
043200         END-EXEC                                                 04320099
043300                                                                  04330099
043400         EVALUATE TRUE                                            04340099
043500           WHEN SQLCODE = -904                                    04350099
043600           WHEN SQLCODE = -911                                    04360099
043700           WHEN SQLCODE = -913                                    04370099
043800           WHEN SQLCODE = 0                                       04380099
043900             CONTINUE                                             04390099
044000           WHEN SQLWARN0 NOT EQUAL SPACE                          04400099
044100           WHEN SQLCODE NOT EQUAL ZERO                            04410099
044200             MOVE '2800-CLOSE-SKU-CSR'                            04420099
044300                                     TO PV-PARAGRAPH-NAME         04430099
044400             MOVE 'ERROR ON CLOSE OF ITEM-CSR CSR'                04440099
044500                                     TO PV-DB2-OPERATION          04450099
044600             PERFORM 9999-SQL-ABEND                               04460099
044700         END-EVALUATE                                             04470099
044800     END-PERFORM.                                                 04480099
044900                                                                  04490099
045000     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04500099
045100       MOVE '2800-CLOSE-SKU-CSR'                                  04510099
045200                               TO  PV-PARAGRAPH-NAME              04520099
045300       MOVE '2800- CLOSE RETRIES EXCEEDED'                        04530099
045400                               TO  PV-DB2-OPERATION               04540099
045500       PERFORM 9999-SQL-ABEND                                     04550099
045600     END-IF.                                                      04560099
045700                                                                  04570099
045800****************************************************************  04580099
045900*     READ AND PROCESS INPUT FILE.                                04590099
046000****************************************************************  04600099
046100 3000-READ-INPUT-FILE.                                            04610099
046200     READ IN-EVENT-FILE INTO PX030-MARKDOWN-DATE-EXTRACT          04620099
046300        AT END                                                    04630099
046400           SET PS-END-OF-FILE-Y      TO TRUE                      04640099
046500     END-READ.                                                    04650099
046600                                                                  04660099
046700     IF PS-END-OF-FILE-N                                          04670099
046800         ADD 1 TO PA-TOT-INPUT-RECS-READ                          04680099
046900     END-IF.                                                      04690099
047000                                                                  04700099
047100****************************************************************  04710099
047200**    WRITE OUTPUT FILE                                           04720099
047300****************************************************************  04730099
047400 4000-WRITE-OUTPUT-FILE.                                          04740099
047500     INITIALIZE PX031-SKU-EXTRACT.                                04750099
047600     MOVE XST00023-STR-NBR     TO PX031-LOC-NBR.                  04760099
047700     MOVE XST00065-SKU-NBR     TO PX031-SKU-NBR.                  04770099
047800     MOVE SKXREF-INTR-UPC-ID   TO PX031-INTR-UPC-ID.              04780099
047900     MOVE PX030-MOS-EFF-DATE   TO PX031-MOS-EFF-DATE.             04790099
048000     MOVE XST00063-DEPT-NBR    TO PX031-DEPT-NBR.                 04800099
048100     WRITE OUT-SKU-RECORD FROM PX031-SKU-EXTRACT.                 04810099
048200     ADD 1 TO  PA-TOT-SKU-WRITTEN.                                04820099
048300                                                                  04830099
048400****************************************************************  04840099
048500*     CLOSE FILES.                                                04850099
048600****************************************************************  04860099
048700 9000-END-OF-JOB.                                                 04870099
048800     CLOSE IN-EVENT-FILE                                          04880099
048900           OUT-SKU-FILE.                                          04890099
049000                                                                  04900099
049100     DISPLAY ' '.                                                 04910099
049200     DISPLAY '*********************************************'.     04920099
049300     DISPLAY '    PXKUT025 SUMMARY STATISTICS              '      04930099
049400     DISPLAY '*********************************************'.     04940099
049500     DISPLAY 'INPUT RECORDS READ........: ' PA-TOT-INPUT-RECS-READ04950099
049600     DISPLAY 'SKU RECORDS READ..........: ' PA-TOT-SKU-RECS-READ  04960099
049700     DISPLAY 'OUTPUT RECS WRITTEN.......: ' PA-TOT-SKU-WRITTEN    04970099
049800     DISPLAY '*********************************************'.     04980099
049900                                                                  04990099
050000****************************************************************  05000099
050100*     NON-DATABASE ABEND.                                         05010099
050200****************************************************************  05020099
050300 9800-ABEND.                                                      05030099
050400     DISPLAY '** ABEND     **'.                                   05040099
050500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05050099
050600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05060099
050700     DISPLAY '** OPERATION ** = ' PV-OPERATION-MSG.               05070099
050800                                                                  05080099
050900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         05090099
051000                                                                  05100099
051100******************************************************************05110099
051200*     SQL ABEND PARAGRAPH.                                        05120099
051300******************************************************************05130099
051400 9999-SQL-ABEND.                                                  05140099
051500     DISPLAY '** ABEND     **'.                                   05150099
051600     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05160099
051700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05170099
051800     DISPLAY '** OPERATION ** = ' PV-OPERATION-MSG.               05180099
051900                                                                  05190099
052000******************************************************************05200099
052100* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     05210099
052200* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      05220099
052300******************************************************************05230099
052400     COPY DPPD004.                                                05240099
052500     SET AC-DB2-ERROR TO TRUE.                                    05250099
052600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         05260099
