000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    POKCS088.                                         00040000
000500 AUTHOR.        RENEE JAEGER.                                     00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  11/97.                                            00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001000*    W088 - IMPORT ORDER TRACKING                                *00100000
001100*                                                                *00110000
001200*    THIS PROGRAM ALLOWS THE USER TO VIEW IMPORT INFORMATION     *00120000
001300*    FOR A PURCHASE ORDER IN INQUIRY ONLY.                       *00130000
001400*----------------------------------------------------------------*00140000
002200* 11/15/99 TKMA340  ADD F23 FUNCTION KEY TO TRANSFER TO A CLONED *00150099
002300*                   VERSION OF THIS PROGRAM FOR DC'S 845 AND 840.*00160099
002310*                   POKCS107 IS THE CLONED VERSION.              *00170099
002400*                   REMOVED TOTAL COLUMN FROM MAP AND PROGRAM.   *00180099
002401*                   TOTALS ARE SHOWN ON POKCS107.                *00190099
002402*                   COPYBOOK POWS017 IS USED TO PASS THE         *00200099
002403*                   UNITS VERIFIED TOTALS TO POKCS107 SO THE     *00210099
002404*                   TOTAL OF ALL 5 DC'S CAN BE SHOWN.            *00220099
C98147*----------------------------------------------------------------*        
C98147* 11/18/14 TKMA394  LINDA FRIESS            - CHG0098147                  
C98147*    - EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND COMMAREA                 
C98147*    - REMOVED UNUSED FIELDS AND LOGIC                                    
002500******************************************************************00230099
CICS  *  CHANGED 11/15/2022    BY BARB SCHULTZ    WR: CHG0278485                
CICS  *                                                                         
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL             
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.              
002500******************************************************************00230099
002501                                                                  00240000
002502 ENVIRONMENT DIVISION.                                            00250000
002503 DATA DIVISION.                                                   00260000
002504 WORKING-STORAGE SECTION.                                         00270000
002505                                                                  00280000
002506 01  DK-DB2-KEYS.                                                 00290000
002507     05  DK-PO-NBR                PIC S9(09) VALUE +0 COMP.       00300000
002508                                                                  00310000
002509 01  PC-PROGRAM-CONSTANTS.                                        00320000
002510     05  PC-PCT                         PIC  X(01)  VALUE '%'.    00330024
002511     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'POKCS088'.  00340000
002512     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'PO088A  '.  00350000
002600     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'POKM088 '.  00360000
002700     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00370000
002800                                              COMP.               00380000
002900     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00390000
003000                                              COMP.               00400000
003100     05  PC-MAX-ITEMS             PIC S9(09)  VALUE +1000000      00410000
003200                                              COMP-3.             00420000
003300     05  PC-TSYMSG-NUMBERS.                                       00430000
003410         10  PC-TSYMSG-00050      PIC  9(05)  VALUE  00050.       00440000
003420         10  PC-TSYMSG-00726      PIC  9(05)  VALUE  00726.       00450099
003440 01  PS-PROGRAM-SWITCHES.                                         00460000
003450     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00470000
003460         88  PS-ERROR                         VALUE  'Y'.         00480000
003470         88  PS-NO-ERROR                      VALUE  'N'.         00490000
003471     05  PS-VSORAIR-SW            PIC  X(01)  VALUE  'Y'.         00500050
003473         88  PS-ALL-VSORAIR                   VALUE  'Y'.         00510050
003474         88  PS-NOT-ALL-VSORAIR               VALUE  'N'.         00520050
003475     05  PS-AM-STAT-FOUND-SW      PIC  X(01)  VALUE  'Y'.         00521099
003476         88  PS-AM-STAT-FOUND                 VALUE  'Y'.         00522099
003477         88  PS-AM-STAT-FOUND-NO              VALUE  'N'.         00523099
003480*                                                                 00530000
003490 01  PV-PROGRAM-VARIABLES.                                        00540000
003493     05  PV-TOT-REC-PCT                 PIC S9(03)V99             00550015
003494                                                     COMP-3.      00560061
003495    05  PV-NORMAL-TOTALS.                                         00570061
003501        10  PV-TOTREC1PCT-X.                                      00580061
003502           15 PV-TREC-PCT1                  PIC  ZZ9.             00590061
003503           15 PV-TREC-PCT1-SIGN             PIC  X(01).           00600061
003504        10  FILLER                          PIC X(08).            00610061
003505        10  PV-TOTREC2PCT-X.                                      00620061
003506           15 PV-TREC-PCT2                  PIC  ZZ9.             00630061
003507           15 PV-TREC-PCT2-SIGN             PIC  X(01).           00640061
003508        10  FILLER                          PIC X(08).            00650099
003509        10  PV-TOTREC3PCT-X.                                      00660099
003510           15 PV-TREC-PCT3                  PIC  ZZ9.             00670099
003511           15 PV-TREC-PCT3-SIGN             PIC  X(01).           00680099
003512        10  FILLER                          PIC X(08).            00690099
003513        10  PV-TOTRECPCT-X.                                       00700062
003514           15 PV-TREC-PCT                   PIC  ZZ9.             00710062
003515           15 PV-TREC-PCT-SIGN              PIC  X(01).           00720062
003516     05  PV-DC-REC-QTY                  PIC S9(09)   VALUE +0     00730013
003517                                                     COMP.        00740013
003518     05  PV-QTY-NULL                    PIC S9(04)   VALUE +0     00750013
003519                                                     COMP.        00760013
003530     05  PV-OTB                         PIC X(06)    VALUE SPACES.00770097
003600     05  PV-OTB-RED REDEFINES PV-OTB.                             00780000
003700         10 PV-OTB-CC                   PIC X(02).                00790097
003710         10 PV-OTB-YY                   PIC X(02).                00800097
003800         10 PV-OTB-MM                   PIC X(02).                00810000
003910     05  PV-OTB2                        PIC X(06)    VALUE SPACES.00820097
004000     05  PV-OTB-RED2 REDEFINES PV-OTB2.                           00830000
004100         10 PV-OTB-MM2                  PIC X(02).                00840000
004200         10 PV-OTB-YY2                  PIC X(02).                00850000
004201         10 PV-OTB-CC2                  PIC X(02).                00860097
004206     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00910097
004207                                              COMP SYNC.          00920097
004208     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00930097
004209                                              COMP SYNC.          00940097
004210     05  PV-READ-COUNT            PIC S9(09)  VALUE +0            00950097
004211                                              COMP-3.             00960097
004220     05  PV-OPER-UNT-ID           PIC  S9(4)  COMP.               00970000
004230     05  PV-MAX-STATUS-DTE        PIC  X(10).                     00980000
004240     05  PV-MIN-STATUS-DTE        PIC  X(10).                     00990000
004241     05  PV-MAX-VERIFD-DTE        PIC  X(10).                     01000010
004242     05  PV-MIN-VERIFD-DTE        PIC  X(10).                     01010010
004250     05  PV-SHIPST-ETA-DATE       PIC  X(10).                     01020044
004260     05  PV-DATE-BREAK.                                           01030000
004270         10  FILLER               PIC  X(02).                     01040000
004280         10  PV-DB-YY             PIC  X(02).                     01050000
004290         10  FILLER               PIC  X(01).                     01060000
004300         10  PV-DB-MM             PIC  X(02).                     01070000
004400         10  FILLER               PIC  X(01).                     01080000
004500         10  PV-DB-DD             PIC  X(02).                     01090000
004600     05  PV-DATE-DISPLAY.                                         01100000
004700         10  PV-DD-MM             PIC  X(02).                     01110000
004800         10  FILLER               PIC  X(01) VALUE '/'.           01120000
004900         10  PV-DD-DD             PIC  X(02).                     01130000
005000         10  FILLER               PIC  X(01) VALUE '/'.           01140000
005100         10  PV-DD-YY             PIC  X(02).                     01150000
005200                                                                  01160000
005300*----------------------------------------------------------------*01170000
005400*    MAP LAYOUT                                                  *01180000
005500*----------------------------------------------------------------*01190000
005600     COPY POKM088.                                                01200000
005610 01  MR-OCCURS-LAYOUT                   REDEFINES  PO088AO.       01210061
C98147     05  FILLER                         PIC X(531).               01220099
005633     05  MR-TOTAL-LINEL                 PIC S9(04) COMP.          01230071
005634     05  MR-TOTAL-LINEA                 PIC  X(01).               01240071
005635     05  MR-TOTAL-LINEC                 PIC  X(01).               01250071
005636     05  MR-TOTAL-LINEH                 PIC  X(01).               01260071
005640     05  MR-TOTAL-LINE                  PIC  X(40).               01270062
005720*----------------------------------------------------------------*01280000
005800*    ATTRIBUTE SETTINGS COPYBOOK.                                *01290000
005900*----------------------------------------------------------------*01300000
006000     COPY DPWS015.                                                01310000
006100*----------------------------------------------------------------*01320000
006200*    FUNCTION KEYS COPYBOOK                                      *01330000
006300*----------------------------------------------------------------*01340000
006400                                                                  01350000
006500     COPY DPWS016.                                                01360000
006600 EJECT                                                            01370000
006700                                                                  01380000
006800**--------------------------------------------------------------**01390000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          **01400000
007000**--------------------------------------------------------------**01410000
007100     COPY DPWS030.                                                01420000
CICS       COPY DPWS930.                                                01420000
007200 EJECT                                                            01430000
007300                                                                  01440000
007400**--------------------------------------------------------------**01450000
007500*    STANDARD COMMAREA.                                           01460000
007600**--------------------------------------------------------------**01470000
007700                                                                  01480000
007800     COPY DPWS020.                                                01490000
007900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01500000
008000                                                                  01510000
008100***************************************************************** 01520000
008200*    INTER-APPLICATION COMMAREA.                                  01530000
008300***************************************************************** 01540000
008400                                                                  01550000
008500         10  INTER-APPL-COMM-AREA PIC X(200).                     01560000
008600     COPY POWS017.                                                01570099
008610     COPY TRWS105.                                                01580099
008700***************************************************************** 01590000
008800*    SPECIFIC COMMMAREA FOR POKCS088.                             01600000
008900***************************************************************** 01610000
009000         10  ASC-SPECIFIC-COMMAREA.                               01620000
009100           15 ASC-SCREEN-FIELDS.                                  01630000
009200             20  ASC-KEY-PO-NUMBER         PIC S9(09) COMP.       01640000
C98147             20  ASC-PO-NBR                PIC  9(08).            01650000
009400             20  ASC-STRT-FCTRY-DTE        PIC  X(10).            01660000
009500             20  ASC-SHIP-DATE             PIC  X(08).            01670000
009600             20  ASC-OTB                   PIC  X(04).            01680000
009700             20  ASC-LAST-FCTRY-DTE        PIC  X(10).            01690000
009800             20  ASC-CANCEL-DATE           PIC  X(08).            01700000
009900             20  ASC-FOB-POINT             PIC  X(30).            01710000
010000             20  ASC-VENDOR                PIC  X(30).            01720000
010100             20  ASC-DEPT                  PIC  X(03).            01730000
010200             20  ASC-DC1                   PIC  X(10).            01740000
010300             20  ASC-DC2                   PIC  X(10).            01750000
010400             20  ASC-DC3                   PIC  X(10).            01760000
010500             20  ASC-DECON-DATE1           PIC  X(08).            01770000
010600             20  ASC-DECON-DATE2           PIC  X(08).            01780000
010700             20  ASC-DECON-DATE3           PIC  X(08).            01790000
010800             20  ASC-DC-DEL-DATE1          PIC  X(08).            01800000
010900             20  ASC-DC-DEL-DATE2          PIC  X(08).            01810000
011000             20  ASC-DC-DEL-DATE3          PIC  X(08).            01820000
011100             20  ASC-FST-RCPT-DT1          PIC  X(08).            01830000
011200             20  ASC-FST-RCPT-DT2          PIC  X(08).            01840000
011300             20  ASC-FST-RCPT-DT3          PIC  X(08).            01850000
011400             20  ASC-LST-RCPT-DT1          PIC  X(08).            01860000
011500             20  ASC-LST-RCPT-DT2          PIC  X(08).            01870000
011600             20  ASC-LST-RCPT-DT3          PIC  X(08).            01880000
011610             20  ASC-FST-VFD-DT1           PIC  X(08).            01890008
011620             20  ASC-FST-VFD-DT2           PIC  X(08).            01900008
011630             20  ASC-FST-VFD-DT3           PIC  X(08).            01910008
011640             20  ASC-LST-VFD-DT1           PIC  X(08).            01920008
011650             20  ASC-LST-VFD-DT2           PIC  X(08).            01930008
011660             20  ASC-LST-VFD-DT3           PIC  X(08).            01940008
011670             20  ASC-UNT-ORD1              PIC  S9(09) COMP-3.    01950021
011680             20  ASC-UNT-ORD2              PIC  S9(09) COMP-3.    01960021
011690             20  ASC-UNT-ORD3              PIC  S9(09) COMP-3.    01970021
011691             20  ASC-TOT-ORD               PIC  S9(09) COMP-3.    01980022
011692             20  ASC-UNT-VFD1              PIC  S9(09) COMP-3.    01990022
011693             20  ASC-UNT-VFD1-C            PIC  X(1).             02000093
011694             20  ASC-UNT-VFD2              PIC  S9(09) COMP-3.    02010093
011695             20  ASC-UNT-VFD2-C            PIC  X(1).             02020093
011696             20  ASC-UNT-VFD3              PIC  S9(09) COMP-3.    02030093
011697             20  ASC-UNT-VFD3-C            PIC  X(1).             02040093
011698             20  ASC-TOT-VFD               PIC  S9(09) COMP-3.    02050093
011699             20  ASC-PCT-RCD1              PIC  X(4).             02060093
011700             20  FILLER REDEFINES ASC-PCT-RCD1.                   02070093
011701                 25  ASC-PCT-RCD1-N        PIC  9(03).            02080093
011702                 25  ASC-PCT-RCD1-SIGN     PIC  X(01).            02090093
011703             20  ASC-PCT-RCD2              PIC  X(4).             02100062
011710             20  FILLER REDEFINES ASC-PCT-RCD2.                   02110062
011711                 25  ASC-PCT-RCD2-N        PIC  9(03).            02120062
011712                 25  ASC-PCT-RCD2-SIGN     PIC  X(01).            02130062
011714             20  ASC-PCT-RCD3              PIC  X(4).             02140062
011715             20  FILLER REDEFINES ASC-PCT-RCD3.                   02150062
011716                 25  ASC-PCT-RCD3-N        PIC  9(03).            02160062
011717                 25  ASC-PCT-RCD3-SIGN     PIC  X(01).            02170062
011719             20  ASC-TOT-PCT-RCD           PIC  X(4).             02180062
011720             20  FILLER REDEFINES ASC-TOT-PCT-RCD.                02190062
011721                 25  ASC-TOT-PCT-RCD-N     PIC  9(03).            02200063
011722                 25  ASC-TOT-PCT-RCD-SIGN  PIC  X(01).            02210063
011730                                                                  02220022
011800             15  ASC-ITEMS-LEFT-INDICATOR  PIC  X(01).            02230000
011900                 88 ASC-ITEMS-LEFT-ON-DB    VALUE 'Y'.            02240000
012000                 88 ASC-NO-ITEMS-LEFT-ON-DB VALUE 'N'.            02250000
012100             15  ASC-NUMBER-OF-ITEMS-READ  PIC S9(09)             02260000
012200                                               COMP-3.            02270000
012300                                                                  02280000
012400*----------------------------------------------------------------*02290000
012500*    ABEND PROCESSING COPYBOOK.                                  *02300000
012600*----------------------------------------------------------------*02310000
012700                                                                  02320000
012800     COPY DPWS013.                                                02330000
012900                                                                  02340000
013000*----------------------------------------------------------------*02350000
013100*    DB2 AREA FOR PURCHASE ORDER                                 *02360000
013200*----------------------------------------------------------------*02370000
013300     EXEC SQL                                                     02380000
013400          INCLUDE TPURCHS                                         02390000
013500     END-EXEC.                                                    02400000
013501     EXEC SQL                                                     02410099
013502          INCLUDE TENTNME                                         02420099
013503     END-EXEC.                                                    02430099
013504*----------------------------------------------------------------*02440033
013505*    DB2 AREA FOR PURCHASE LINE ITEM TABLE                       *02450033
013506*----------------------------------------------------------------*02460033
013507     EXEC SQL                                                     02470033
013508          INCLUDE TPURITM                                         02480033
013509     END-EXEC.                                                    02490033
013510*----------------------------------------------------------------*02500012
013511*    DB2 AREA FOR DC SPLIT QUANTITIES TABLE                      *02510012
013512*----------------------------------------------------------------*02520012
013513     EXEC SQL                                                     02530012
013514          INCLUDE TALLPLN                                         02540012
013515     END-EXEC.                                                    02550012
013516*----------------------------------------------------------------*02560010
013520*    DB2 AREA FOR RECEIPTS TABLE                                 *02570010
013530*----------------------------------------------------------------*02580010
013540     EXEC SQL                                                     02590010
013550          INCLUDE TRECEIV                                         02600010
013560     END-EXEC.                                                    02610010
013570     EXEC SQL                                                     02620013
013580          INCLUDE TRECITM                                         02630013
013590     END-EXEC.                                                    02640013
013591     EXEC SQL                                                     02650013
013592          INCLUDE TRECDIS                                         02660013
013593     END-EXEC.                                                    02670013
013600*----------------------------------------------------------------*02680000
013700*    DB2 AREA FOR TRIP STATUS TABLE                              *02690000
013800*----------------------------------------------------------------*02700000
013900     EXEC SQL                                                     02710000
014000          INCLUDE TTRIPST                                         02720000
014100     END-EXEC.                                                    02730000
014200*----------------------------------------------------------------*02740000
014300*    DB2 AREA FOR LOCATION TABLE                                 *02750099
014400*----------------------------------------------------------------*02760000
014500     EXEC SQL                                                     02770000
014600          INCLUDE XMT00001                                        02780099
014700     END-EXEC.                                                    02790000
014800*----------------------------------------------------------------*02800000
014900*    DB2 AREA FOR SHIPMENTS                                      *02810000
015000*----------------------------------------------------------------*02820000
015100     EXEC SQL                                                     02830000
015200          INCLUDE TSHIPMT                                         02840000
015300     END-EXEC.                                                    02850000
015400*----------------------------------------------------------------*02860000
015500*    DB2 AREA FOR SHIPMENTS BY PO                                *02870000
015600*----------------------------------------------------------------*02880000
015700     EXEC SQL                                                     02890000
015800          INCLUDE TSHPTPO                                         02900000
015900     END-EXEC.                                                    02910000
016330*----------------------------------------------------------------*02920000
016340*    DB2 AREA FOR VEHICLES PER TRIP                              *02930000
016350*----------------------------------------------------------------*02940000
016360     EXEC SQL                                                     02950000
016370          INCLUDE TVEHICL                                         02960000
016380     END-EXEC.                                                    02970000
016390*----------------------------------------------------------------*02980000
016400*    DB2 AREA FOR SHIPMENT STATUSES                              *02990000
016401*----------------------------------------------------------------*03000000
016402     EXEC SQL                                                     03010000
016403          INCLUDE TSHIPST                                         03020000
016404     END-EXEC.                                                    03030000
016405*----------------------------------------------------------------*03040000
016406*    DB2 AREA FOR PLANNED SHIPMENTS                              *03050000
016407*----------------------------------------------------------------*03060000
016408     EXEC SQL                                                     03070000
016409          INCLUDE TPLNSHP                                         03080000
016410     END-EXEC.                                                    03090000
016420*----------------------------------------------------------------*03100000
016430*    DB2 AREA FOR THE FREE ON BOARD TABLE                        *03110000
016440*----------------------------------------------------------------*03120000
016450     EXEC SQL                                                     03130000
016460          INCLUDE TIMFOB                                          03140000
016470     END-EXEC.                                                    03150000
016480*----------------------------------------------------------------*03160000
016490*    DB2 AREA FOR COMMUNICATIONS                                 *03170000
016500*----------------------------------------------------------------*03180000
016600     EXEC SQL                                                     03190000
016700          INCLUDE SQLCA                                           03200000
016800     END-EXEC.                                                    03210000
016900                                                                  03220000
017000                                                                  03230000
017100* THIS CURSOR WILL PULL BACK ALL THE SHIPMENTS FOR A GIVEN PO     03240000
017200     EXEC SQL                                                     03250000
017300       DECLARE SHIPMT-CSR CURSOR                                  03260000
017400          FOR SELECT DISTINCT                                     03270000
017500               A.SHIPT_ID,                                        03280000
017600               A.TRIP_ID,                                         03290000
017700               E.OPER_UNT_ID                                      03300000
017800          FROM TSHIPMT A,                                         03310000
017900               TSHPTPO B,                                         03320000
018000               TTRIPST E                                          03330000
018100          WHERE B.PO_NBR   =:ASC-KEY-PO-NUMBER                    03340000
018200            AND A.SHIPT_ID = B.SHIPT_ID                           03350000
018300            AND E.TRIP_ID = A.TRIP_ID                             03360000
018500          ORDER BY E.OPER_UNT_ID                                  03370000
018600          FOR FETCH ONLY                                          03380000
018700     END-EXEC.                                                    03390000
018800                                                                  03400000
018900 LINKAGE SECTION.                                                 03410000
019000                                                                  03420000
019100 01  DFHCOMMAREA.                                                 03430000
019200     05  FILLER                         OCCURS  1 TO 4072 TIMES   03440000
019300                                        DEPENDING ON EIBCALEN.    03450000
019400         10  FILLER                     PIC X.                    03460000
019500                                                                  03470000
019600                                                                  03480000
019700 PROCEDURE DIVISION.                                              03490000
019800***************************************************************** 03500000
019900** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03510000
020000** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03520000
020100** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03530000
020200**                                                             ** 03540000
020300** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03550000
020400** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03560000
020500***************************************************************** 03570000
020600 0000-MAIN-MODULE.                                                03580000
020700     INITIALIZE DP030-CICS-API-FIELDS.                            03590000
020800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03600000
020900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03610000
021000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03620000
021100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03630000
021200     MOVE LENGTH OF PO088AI        TO DP030-MAP-LENGTH (1).       03640000
021300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03650000
021400     PERFORM 0001-CALL-CICS-ARCH-API.                             03660000
021500     PERFORM 1000-CONTROL-PROCESSING                              03670000
021600*                                                                 03680000
021700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03690000
021800     PERFORM 0001-CALL-CICS-ARCH-API.                             03700000
021900                                                                  03710000
022000 0001-CALL-CICS-ARCH-API.                                         03720000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03730000
022200                                    DFHCOMMAREA                   03740000
022300                                    DP030-CICS-API-FIELDS         03750000
022400                                    DP020-STANDARD-COMMAREA       03760000
022500                                    PO088AI.                      03770000
022600*                                                                 03780000
022700     IF  DP030-RC-CALL-SUCCESSFUL                                 03790000
022800         CONTINUE                                                 03800000
022900     ELSE                                                         03810000
023000         SET DP013-NO-ROLLBACK                                    03820000
023100             DP013-XCTL-DISPLAY-RESTART                           03830000
023200             DP013-CICS-ABEND      TO TRUE                        03840000
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           03850000
023400                                   TO DP013-PARAGRAPH             03860000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03870000
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03880000
023700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03890000
023800         PERFORM DP013-0000-PROCESS-ABEND                         03900000
023900     END-IF.                                                      03910000
024000 EJECT                                                            03920000
024100                                                                  03930000
024200*----------------------------------------------------------------*03940000
024300*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03950000
024400*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03960000
024500*----------------------------------------------------------------*03970000
024600 1000-CONTROL-PROCESSING.                                         03980000
024700                                                                  03990000
024800     EVALUATE TRUE                                                04000000
024900         WHEN DP020-NEXT-ACT-INITIAL                              04010000
025000             PERFORM 1100-FIND-OBJECT-KEYS                        04020000
025100             PERFORM 4120-GET-PO-TYP                              04030006
025311             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     04040054
025312             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04050054
025320             PERFORM 4220-PRESCAN-ITEMS-FROM-DB                   04060052
025330             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04070052
025340             IF PS-ALL-VSORAIR                                    04080052
025350                 MOVE DP016-PF14 TO DP020-SRC-AID                 04090052
025360             ELSE                                                 04100052
025500                  PERFORM 2000-PROCESS-PANEL                      04110058
025700                  IF  PS-ERROR                                    04120000
025800                    CONTINUE                                      04130000
025900                  ELSE                                            04140000
026000                     PERFORM 4000-BUILD-INITIAL-PANEL             04150000
026100                  END-IF                                          04160000
026110             END-IF                                               04170052
026120                                                                  04180000
026130         WHEN DP020-NEXT-ACT-READ-MAP                             04190000
026140             PERFORM 2000-PROCESS-PANEL                           04200000
026150                                                                  04210000
026160         WHEN DP020-NEXT-ACT-RETURN                               04220000
026190             MOVE ASC-KEY-PO-NUMBER TO TR105-PO-NBR               04230099
026420             MOVE 0 TO ASC-TOT-VFD                                04240058
026430             MOVE 0 TO ASC-TOT-PCT-RCD                            04250058
026440                                                                  04260058
026450             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     04270055
026460             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04280055
026470             PERFORM 4220-PRESCAN-ITEMS-FROM-DB                   04290055
026480             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04300055
026490             IF PS-ALL-VSORAIR                                    04310055
026491                 MOVE DP016-PF3  TO DP020-SRC-AID                 04320055
026492             ELSE                                                 04330055
026500                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              04340000
026600             END-IF                                               04350055
026700                                                                  04360000
026800         WHEN OTHER                                               04370000
026900             IF PS-NO-ERROR                                       04380099
027000                 PERFORM 2100-CHECK-FUNCTION-KEY                  04390099
027100             END-IF                                               04400099
027107     END-EVALUATE.                                                04410000
027108 EJECT                                                            04420000
027109                                                                  04430000
027110******************************************************************04440000
027120 1100-FIND-OBJECT-KEYS.                                           04450000
027130     INITIALIZE ASC-SPECIFIC-COMMAREA.                            04460000
027140     MOVE TR105-PO-NBR TO ASC-KEY-PO-NUMBER.                      04470099
027170 EJECT                                                            04480000
027180                                                                  04490000
027190*----------------------------------------------------------------*04500000
027200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04510000
027300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04520000
027400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04530000
027500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04540000
027600* FUNCTION KEYS CAN GET THIS FAR.                                *04550000
027700*----------------------------------------------------------------*04560000
027800                                                                  04570000
027900 2000-PROCESS-PANEL.                                              04580000
028000     EVALUATE TRUE                                                04590000
028400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04600000
028410             INITIALIZE ASC-SCREEN-FIELDS                         04610000
028420             MOVE TR105-PO-NBR TO ASC-KEY-PO-NUMBER               04620099
028450             PERFORM 4120-GET-PO-TYP                              04630006
028460             PERFORM 4000-BUILD-INITIAL-PANEL                     04640000
028470                                                                  04650000
028480         WHEN DP020-SRC-AID = DP016-CLEAR                         04660000
028482              MOVE 0 TO ASC-TOT-VFD                               04670027
028483              MOVE 0 TO ASC-TOT-PCT-RCD                           04680027
028490             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04690000
028500                                                                  04700000
028600         WHEN OTHER                                               04710000
028820             MOVE 0 TO ASC-TOT-VFD                                04720058
028830             MOVE 0 TO ASC-TOT-PCT-RCD                            04730058
028840                                                                  04740058
028850             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     04750056
028860             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04760056
028870             PERFORM 4220-PRESCAN-ITEMS-FROM-DB                   04770056
028880             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04780056
028890             IF PS-ALL-VSORAIR                                    04790056
028891                 MOVE DP016-PF3  TO DP020-SRC-AID                 04800056
028892             ELSE                                                 04810056
028900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04820000
029000             END-IF                                               04830056
029100     END-EVALUATE.                                                04840000
029200                                                                  04850000
029300  EJECT                                                           04860000
029400*----------------------------------------------------------------*04870000
029500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04880000
029600* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *04890000
029700* FROM THE CICS ARCHITECTURE API.                                *04900000
029800*----------------------------------------------------------------*04910000
029900                                                                  04920000
030000 2100-CHECK-FUNCTION-KEY.                                         04930000
030410                                                                  04940000
030420     EVALUATE TRUE                                                04950000
030430         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04960000
030440             PERFORM 2110-PREPARE-INTER-APPL-COMM                 04970000
030450                                                                  04980000
030451         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              04990099
030452             PERFORM 4401-PREP-INTERAPPL-COMMAREA                 05000099
030453                                                                  05010099
030460         WHEN DP020-SRC-AID = DP016-ENTER                         05020000
030470             CONTINUE                                             05030000
030480                                                                  05040000
030490         WHEN OTHER                                               05050000
030500             SET DP013-NO-ROLLBACK                                05060000
030600                 DP013-XCTL-DISPLAY-RESTART                       05070000
030700                 DP013-CICS-ABEND  TO TRUE                        05080000
030800             MOVE '2100-CHECK-FUNCTION-KEY'                       05090000
030900                                   TO DP013-PARAGRAPH             05100000
031000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05110000
031100                                   TO DP013-MESSAGE-TEXT (1)      05120000
031200             PERFORM DP013-0000-PROCESS-ABEND                     05130000
031300     END-EVALUATE.                                                05140000
031400                                                                  05150000
031500 EJECT                                                            05160000
031600                                                                  05170000
031700*----------------------------------------------------------------*05180000
031800** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **05190000
031900** INTER-APPLICATION COMMAREA.                                  **05200000
032000*----------------------------------------------------------------*05210000
032100 2110-PREPARE-INTER-APPL-COMM.                                    05220000
032200     MOVE ASC-KEY-PO-NUMBER        TO TR105-PO-NBR.               05230099
032300                                                                  05240000
032400/                                                                 05250000
032500*----------------------------------------------------------------*05260000
032600*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *05270000
032700*    ENTRY.                                                      *05280000
032800*----------------------------------------------------------------*05290000
032900                                                                  05300000
033000 4000-BUILD-INITIAL-PANEL.                                        05310000
033001                                                                  05320000
033002     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            05330000
C98147     MOVE +0 TO ASC-NUMBER-OF-ITEMS-READ.                         05340000
C98147     MOVE ASC-KEY-PO-NUMBER TO ASC-PO-NBR.                        05350000
                                                                                
033015     IF PURCHS-PO-TYP-CDE = ('IM' OR 'IE' OR 'IF')                05460099
033016        PERFORM 4100-GET-IMPORT                                   05470007
033017     ELSE                                                         05480007
033018        PERFORM 4200-GET-DOMESTIC                                 05490007
033019     END-IF                                                       05500007
033040         IF PURCHS-PO-TYP-CDE = ('IM' OR 'IE' OR 'IF')            05510099
033050             MOVE PLNSHP-STRT-FCTRY-DTE                           05520000
033060                                   TO ASC-STRT-FCTRY-DTE          05530000
033070             MOVE PLNSHP-LAST-FCTRY-DTE                           05540000
033080                                   TO ASC-LAST-FCTRY-DTE          05550000
033081             MOVE IMFOB-FOB-CTY-NM TO ASC-FOB-POINT               05560002
033082         ELSE                                                     05570002
033083             MOVE SPACES TO ASC-STRT-FCTRY-DTE                    05580002
033084                            ASC-LAST-FCTRY-DTE                    05590002
033085                            ASC-FOB-POINT                         05600002
033086         END-IF                                                   05610002
033087             MOVE ENTNME-ENT-NAME-DESC TO ASC-VENDOR              05620099
033088             MOVE PURCHS-DEPT-NBR TO ASC-DEPT                     05630099
033090             MOVE PURCHS-OTB-PER-NBR TO PV-OTB                    05640000
033100             MOVE PV-OTB-CC TO PV-OTB-CC2                         05650097
033110             MOVE PV-OTB-YY TO PV-OTB-YY2                         05660097
033200             MOVE PV-OTB-MM TO PV-OTB-MM2                         05670000
033310             MOVE PV-OTB2(1:4) TO ASC-OTB                         05680097
033400             MOVE PLNSHP-DONT-SHIP-BEF-DTE TO PV-DATE-BREAK       05690000
033500             MOVE PV-DB-YY TO PV-DD-YY                            05700000
033600             MOVE PV-DB-MM TO PV-DD-MM                            05710000
033700             MOVE PV-DB-DD TO PV-DD-DD                            05720000
033800             IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES AND       05730000
033900                PV-DD-MM = SPACES                                 05740000
034000                  MOVE SPACES TO ASC-SHIP-DATE                    05750000
034100             ELSE                                                 05760000
034200                 MOVE PV-DATE-DISPLAY TO ASC-SHIP-DATE            05770000
034300             END-IF                                               05780000
034400             MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO PV-DATE-BREAK      05790000
034500             MOVE PV-DB-YY TO PV-DD-YY                            05800000
034600             MOVE PV-DB-MM TO PV-DD-MM                            05810000
034700             MOVE PV-DB-DD TO PV-DD-DD                            05820000
034800             IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES AND       05830000
034900                PV-DD-MM = SPACES                                 05840000
035000                  MOVE SPACES TO ASC-CANCEL-DATE                  05850000
035100             ELSE                                                 05860000
035200                 MOVE PV-DATE-DISPLAY TO ASC-CANCEL-DATE          05870000
035300             END-IF                                               05880000
035440              MOVE 0 TO ASC-TOT-VFD                               05890026
035495              MOVE 0 TO ASC-TOT-PCT-RCD                           05900026
035510             PERFORM 4300-READ-ITEMS-FROM-DB                      05910051
035600             IF ASC-NUMBER-OF-ITEMS-READ = ZERO                   05920000
035700                SET DP020-NEXT-ACT-APPL-ERROR TO TRUE             05930000
035800                SET DP020-MSG-FATAL TO TRUE                       05940000
035900                MOVE PC-TSYMSG-00050 TO DP020-MSG-NUMBER          05950000
036000             ELSE                                                 05960000
036020                 MOVE 0 TO ASC-TOT-VFD                            05970027
036030                 MOVE 0 TO ASC-TOT-PCT-RCD                        05980027
036100                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              05990000
036200             END-IF.                                              06000006
036900  EJECT                                                           06010000
037000                                                                  06020000
037100*----------------------------------------------------------------*06030000
037200* OPEN THE SHIPMT-CSR CURSOR.                                    *06040000
037300*----------------------------------------------------------------*06050000
037400                                                                  06060000
037500 4010-OPEN-CURSOR.                                                06070000
037600     PERFORM                                                      06080000
037700         WITH TEST AFTER                                          06090000
037800         VARYING PV-RETRY-COUNTER                                 06100000
037900         FROM 1 BY 1                                              06110000
038000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06120000
038100                   OR (SQLCODE = ZERO))                           06130000
038200                                                                  06140000
038300              EXEC SQL                                            06150000
038400                 OPEN SHIPMT-CSR                                  06160000
038500              END-EXEC                                            06170000
038600                                                                  06180000
038700         EVALUATE TRUE                                            06190000
038800             WHEN SQLCODE = ZERO                                  06200000
038900             WHEN SQLCODE = -904                                  06210000
039000             WHEN SQLCODE = -913                                  06220000
039100                 CONTINUE                                         06230000
039200             WHEN SQLWARN0 NOT = SPACES                           06240000
039300             WHEN SQLCODE < ZERO                                  06250000
039400             WHEN SQLCODE > ZERO                                  06260000
039500                 MOVE '4010-OPEN-CURSOR'                          06270000
039600                                   TO DP013-PARAGRAPH             06280000
039700                 MOVE 'OPEN SHIPMT-CSR CURSOR - '                 06290000
039800                                   TO DP013-MESSAGE-TEXT (1)      06300000
039900                 MOVE SQLCA        TO DP013-SQLCA                 06310000
040000                 MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)    06320000
040100                 SET DP013-DB2-ABEND                              06330000
040200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06340000
040300                 PERFORM DP013-0000-PROCESS-ABEND                 06350000
040400         END-EVALUATE                                             06360000
040500     END-PERFORM.                                                 06370000
040600*                                                                 06380000
040700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06390000
040800         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             06400000
040900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   06410000
041000                                   TO DP013-MESSAGE-TEXT (1)      06420000
041100         MOVE SQLCA                TO DP013-SQLCA                 06430000
041200         MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)    06440000
041300         SET DP013-DB2-ABEND                                      06450000
041310             DP013-XCTL-DISPLAY-RESTART                           06460000
041320                                   TO TRUE                        06470000
041330         PERFORM DP013-0000-PROCESS-ABEND                         06480000
041340     END-IF.                                                      06490000
041341                                                                  06500000
041342 EJECT                                                            06510000
041343                                                                  06520000
041344*----------------------------------------------------------------*06530000
041345* CLOSE THE SHIPMT-CSR CURSOR.                                   *06540000
041346*----------------------------------------------------------------*06550000
041347                                                                  06560000
041348 4020-CLOSE-CURSOR.                                               06570000
041349*                                                                 06580000
041350     EXEC SQL                                                     06590000
041351         CLOSE SHIPMT-CSR                                         06600000
041352     END-EXEC                                                     06610000
041353                                                                  06620000
041354     EVALUATE TRUE                                                06630000
041355         WHEN SQLCODE = ZERO                                      06640000
041356             CONTINUE                                             06650000
041357         WHEN SQLWARN0 NOT = SPACES                               06660000
041358         WHEN SQLCODE < ZERO                                      06670000
041359         WHEN SQLCODE > ZERO                                      06680000
041360             MOVE '4020-CLOSE-CURSOR'                             06690000
041361                               TO DP013-PARAGRAPH                 06700000
041362             MOVE 'CLOSE SHIPMT-CSR CURSOR '                      06710000
041363                               TO DP013-MESSAGE-TEXT (1)          06720000
041364             MOVE SQLCA        TO DP013-SQLCA                     06730000
041365             MOVE 'SHIPMT  '   TO DP013-DB2-TABLE-NAME (1)        06740000
041366             SET DP013-DB2-ABEND                                  06750000
041367                 DP013-XCTL-DISPLAY-RESTART TO TRUE               06760000
041368             PERFORM DP013-0000-PROCESS-ABEND                     06770000
041369     END-EVALUATE.                                                06780000
041370                                                                  06790000
041371  EJECT                                                           06800000
041372                                                                  06810000
041373*----------------------------------------------------------------*06820000
041374* GET IMPORT SCREEN FIELDS                                       *06830000
041375*----------------------------------------------------------------*06840000
041376                                                                  06850000
041377 4100-GET-IMPORT.                                                 06860000
041378     PERFORM                                                      06870000
041379         WITH TEST AFTER                                          06880000
041380         VARYING PV-RETRY-COUNTER                                 06890000
041390         FROM 1 BY 1                                              06900000
041400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06910000
041500             OR (SQLCODE = ZERO)                                  06920000
041600             OR (SQLCODE = +100))                                 06930000
041700             EXEC SQL                                             06940000
041800                 SELECT A.OTB_PER_NBR,                            06950000
041810                        A.PO_TYP_CDE,                             06960002
041820                        A.TOT_UNT_QTY,                            06970045
041900                        B.STRT_FCTRY_DTE,                         06980000
042000                        B.LAST_FCTRY_DTE,                         06990000
042100                        B.DONT_SHIP_BEF_DTE,                      07000000
042200                        B.CAN_IFNOT_SHIP_DTE,                     07010000
042300                        C.FOB_CTY_NM,                             07020099
042310                        A.DEPT_NBR,                               07030099
042320                        D.ENT_NAME_DESC                           07040099
042400                 INTO :PURCHS-OTB-PER-NBR,                        07050000
042410                      :PURCHS-PO-TYP-CDE,                         07060002
042420                      :PURCHS-TOT-UNT-QTY,                        07070045
042500                      :PLNSHP-STRT-FCTRY-DTE,                     07080000
042600                      :PLNSHP-LAST-FCTRY-DTE,                     07090000
042700                      :PLNSHP-DONT-SHIP-BEF-DTE,                  07100000
042800                      :PLNSHP-CAN-IFNOT-SHIP-DTE,                 07110000
042900                      :IMFOB-FOB-CTY-NM,                          07120099
042910                      :PURCHS-DEPT-NBR,                           07130099
042920                      :ENTNME-ENT-NAME-DESC                       07140099
043000                 FROM TPURCHS A,                                  07150000
043100                      TPLNSHP B,                                  07160000
043200                      TIMFOB C,                                   07170099
043210                      TENTNME D                                   07180099
043300                 WHERE A.PO_NBR = :ASC-KEY-PO-NUMBER              07190000
043400                   AND A.VER_STATUS_CDE = 'A'                     07200000
043500                   AND B.VER_STATUS_CDE = 'A'                     07210000
043700                   AND B.PO_NBR = A.PO_NBR                        07220000
043800                   AND C.FOB_CDE = B.FOB_CDE                      07230000
043810                   AND A.ENT_ID = D.ENT_ID                        07240099
043820                   AND D.TYPE_CDE = '04'                          07250099
043900             END-EXEC                                             07260000
044000         EVALUATE TRUE                                            07270000
044010             WHEN SQLCODE = +100                                  07280048
044020               PERFORM 4150-GET-QTY-ORDERED                       07290048
044100             WHEN SQLCODE = ZERO                                  07300000
044300             WHEN SQLCODE = -904                                  07310000
044400             WHEN SQLCODE = -913                                  07320000
044500                 CONTINUE                                         07330000
044600             WHEN SQLWARN0 NOT = SPACES                           07340000
044700             WHEN SQLCODE < ZERO                                  07350000
044800             WHEN SQLCODE > ZERO                                  07360000
044900                 MOVE '4100-GET-IMPORT'                           07370000
045000                                   TO DP013-PARAGRAPH             07380000
045100                 MOVE 'SQL ERROR SELECTING IMPORT INFO'           07390000
045200                                   TO DP013-MESSAGE-TEXT (1)      07400000
045300                 MOVE SQLCA        TO DP013-SQLCA                 07410000
045400                 MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)    07420000
045500                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)    07430000
045600                 MOVE 'TIMFOB  '   TO DP013-DB2-TABLE-NAME (3)    07440000
045700                 SET DP013-DB2-ABEND                              07450000
045800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07460000
045900                 PERFORM DP013-0000-PROCESS-ABEND                 07470000
046000         END-EVALUATE                                             07480000
046100     END-PERFORM.                                                 07490000
046200*                                                                 07500000
046300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07510000
046400         MOVE '4100-GET-IMPORT'    TO DP013-PARAGRAPH             07520000
046500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  07530000
046600                                   TO DP013-MESSAGE-TEXT (1)      07540000
046700         MOVE SQLCA                TO DP013-SQLCA                 07550000
046800         MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)            07560000
046900         MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)            07570000
047000         MOVE 'TIMFOB  '   TO DP013-DB2-TABLE-NAME (3)            07580000
047100         SET DP013-DB2-ABEND                                      07590000
047200             DP013-XCTL-DISPLAY-RESTART                           07600000
047300                                   TO TRUE                        07610000
047400         PERFORM DP013-0000-PROCESS-ABEND                         07620000
047500     END-IF.                                                      07630000
047600                                                                  07640000
047700  EJECT                                                           07650000
047701                                                                  07660048
047702*----------------------------------------------------------------*07670048
047703* GET TOTAL QUANTITY ORDERED FROM TPURCHS                        *07680048
047704*----------------------------------------------------------------*07690048
047705 4150-GET-QTY-ORDERED.                                            07700048
047706     PERFORM                                                      07710048
047707         WITH TEST AFTER                                          07720048
047708         VARYING PV-RETRY-COUNTER                                 07730048
047709         FROM 1 BY 1                                              07740048
047710         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07750048
047711             OR (SQLCODE = ZERO)                                  07760048
047712             OR (SQLCODE = +100))                                 07770048
047713             EXEC SQL                                             07780048
047716                 SELECT TOT_UNT_QTY                               07790049
047724                 INTO :PURCHS-TOT-UNT-QTY                         07800048
047730                 FROM TPURCHS                                     07810048
047733                 WHERE PO_NBR = :ASC-KEY-PO-NUMBER                07820048
047734                   AND VER_STATUS_CDE = 'A'                       07830048
047738             END-EXEC                                             07840048
047739         EVALUATE TRUE                                            07850048
047740             WHEN SQLCODE = ZERO                                  07860048
047741             WHEN SQLCODE = +100                                  07870048
047742             WHEN SQLCODE = -904                                  07880048
047743             WHEN SQLCODE = -913                                  07890048
047744                 CONTINUE                                         07900048
047745             WHEN SQLWARN0 NOT = SPACES                           07910048
047746             WHEN SQLCODE < ZERO                                  07920048
047747             WHEN SQLCODE > ZERO                                  07930048
047748                 MOVE '4150-GET-QTY-ORDERED'                      07940048
047749                                   TO DP013-PARAGRAPH             07950048
047750                 MOVE 'SQL ERROR SELECTING QTY ORDERED'           07960048
047751                                   TO DP013-MESSAGE-TEXT (1)      07970048
047752                 MOVE SQLCA        TO DP013-SQLCA                 07980048
047753                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    07990048
047754                 SET DP013-DB2-ABEND                              08000048
047755                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08010048
047756                 PERFORM DP013-0000-PROCESS-ABEND                 08020048
047757         END-EVALUATE                                             08030048
047758     END-PERFORM.                                                 08040048
047759*                                                                 08050048
047760     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08060048
047761         MOVE '4150-GET-QTY-ORDERED' TO DP013-PARAGRAPH           08070048
047762         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  08080048
047763                                   TO DP013-MESSAGE-TEXT (1)      08090048
047764         MOVE SQLCA                TO DP013-SQLCA                 08100048
047765         MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)            08110048
047766         SET DP013-DB2-ABEND                                      08120048
047767             DP013-XCTL-DISPLAY-RESTART                           08130048
047768                                   TO TRUE                        08140048
047769         PERFORM DP013-0000-PROCESS-ABEND                         08150048
047770     END-IF.                                                      08160048
047771                                                                  08170048
047772  EJECT                                                           08180048
047773                                                                  08190048
047774                                                                  08200048
047775*----------------------------------------------------------------*08210007
047776* GET IMPORT SCREEN FIELDS FOR DOMESTIC ORDERS                   *08220007
047777*----------------------------------------------------------------*08230007
047778                                                                  08240007
047779 4200-GET-DOMESTIC.                                               08250007
047780     PERFORM                                                      08260007
047781         WITH TEST AFTER                                          08270007
047782         VARYING PV-RETRY-COUNTER                                 08280007
047790         FROM 1 BY 1                                              08290007
047791         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08300007
047792             OR (SQLCODE = ZERO)                                  08310007
047793             OR (SQLCODE = +100))                                 08320007
047794             EXEC SQL                                             08330007
047795                 SELECT A.OTB_PER_NBR,                            08340007
047796                        A.PO_TYP_CDE,                             08350007
047799                        B.DONT_SHIP_BEF_DTE,                      08360007
047800                        B.CAN_IFNOT_SHIP_DTE,                     08370057
047801                        A.TOT_UNT_QTY,                            08380099
047802                        A.DEPT_NBR,                               08390099
047803                        C.ENT_NAME_DESC                           08400099
047804                 INTO :PURCHS-OTB-PER-NBR,                        08410007
047805                      :PURCHS-PO-TYP-CDE,                         08420007
047806                      :PLNSHP-DONT-SHIP-BEF-DTE,                  08430007
047807                      :PLNSHP-CAN-IFNOT-SHIP-DTE,                 08440057
047808                      :PURCHS-TOT-UNT-QTY,                        08450099
047809                      :PURCHS-DEPT-NBR,                           08460099
047810                      :ENTNME-ENT-NAME-DESC                       08470099
047811                 FROM TPURCHS A,                                  08480099
047812                      TPLNSHP B,                                  08490099
047813                      TENTNME C                                   08500099
047814                 WHERE A.PO_NBR = :ASC-KEY-PO-NUMBER              08510007
047815                   AND A.VER_STATUS_CDE = 'A'                     08520007
047816                   AND B.VER_STATUS_CDE = 'A'                     08530007
047817                   AND B.PO_NBR = A.PO_NBR                        08540007
047818                   AND A.ENT_ID = C.ENT_ID                        08550099
047819                   AND C.TYPE_CDE = '04'                          08560099
047820             END-EXEC                                             08570007
047821         EVALUATE TRUE                                            08580007
047822             WHEN SQLCODE = ZERO                                  08590007
047823             WHEN SQLCODE = +100                                  08600007
047824             WHEN SQLCODE = -904                                  08610007
047825             WHEN SQLCODE = -913                                  08620007
047826                 CONTINUE                                         08630007
047827             WHEN SQLWARN0 NOT = SPACES                           08640007
047828             WHEN SQLCODE < ZERO                                  08650007
047829             WHEN SQLCODE > ZERO                                  08660007
047830                 MOVE '4200-GET-DOMESTIC'                         08670007
047831                                   TO DP013-PARAGRAPH             08680007
047832                 MOVE 'SQL ERROR SELECTING IMPORT INFO'           08690007
047833                                   TO DP013-MESSAGE-TEXT (1)      08700007
047834                 MOVE SQLCA        TO DP013-SQLCA                 08710007
047835                 MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)    08720007
047836                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)    08730007
047837                 MOVE 'TIMFOB  '   TO DP013-DB2-TABLE-NAME (3)    08740007
047838                 SET DP013-DB2-ABEND                              08750007
047839                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08760007
047840                 PERFORM DP013-0000-PROCESS-ABEND                 08770007
047841         END-EVALUATE                                             08780007
047842     END-PERFORM.                                                 08790007
047843*                                                                 08800007
047844     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08810007
047845         MOVE '4200-GET-DOMESTIC'  TO DP013-PARAGRAPH             08820007
047846         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  08830007
047847                                   TO DP013-MESSAGE-TEXT (1)      08840007
047848         MOVE SQLCA                TO DP013-SQLCA                 08850007
047849         MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)            08860007
047850         MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)            08870007
047851         SET DP013-DB2-ABEND                                      08880007
047852             DP013-XCTL-DISPLAY-RESTART                           08890007
047853                                   TO TRUE                        08900007
047854         PERFORM DP013-0000-PROCESS-ABEND                         08910007
047855     END-IF.                                                      08920007
047856                                                                  08930007
047857  EJECT                                                           08940007
047860                                                                  08950000
047900*----------------------------------------------------------------*08960000
048000* GET DC NAME                                                    *08970000
048100*----------------------------------------------------------------*08980000
048200                                                                  08990000
048300 4110-GET-DC-NAME.                                                09000000
048400     PERFORM                                                      09010000
048500         WITH TEST AFTER                                          09020000
048600         VARYING PV-RETRY-COUNTER                                 09030000
048700         FROM 1 BY 1                                              09040000
048800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09050000
048900             OR (SQLCODE = ZERO)                                  09060000
049000             OR (SQLCODE = +100))                                 09070000
049100             EXEC SQL                                             09080000
049200             SELECT LOC_5_ABBR_NM                                 09090099
049300             INTO :XMT00001-LOC-5-ABBR-NM                         09100099
049400             FROM XMT_LOC                                         09110099
049500             WHERE LOC_NBR = :PV-OPER-UNT-ID                      09120099
049530             END-EXEC                                             09150000
049540         EVALUATE TRUE                                            09160000
049550             WHEN SQLCODE = +100                                  09170000
049560               MOVE SPACES TO XMT00001-LOC-5-ABBR-NM              09180099
049570             WHEN SQLCODE = ZERO                                  09190000
049580             WHEN SQLCODE = -904                                  09200000
049590             WHEN SQLCODE = -913                                  09210000
049600                 CONTINUE                                         09220000
049601             WHEN SQLWARN0 NOT = SPACES                           09230000
049602             WHEN SQLCODE < ZERO                                  09240000
049603             WHEN SQLCODE > ZERO                                  09250000
049604                 MOVE '4110-GET-DC-NAME'                          09260000
049605                                   TO DP013-PARAGRAPH             09270000
049606                 MOVE 'SQL ERROR SELECTING DC NAME'               09280000
049607                                   TO DP013-MESSAGE-TEXT (1)      09290000
049608                 MOVE SQLCA        TO DP013-SQLCA                 09300000
049609                 MOVE 'XMT_LOC '   TO DP013-DB2-TABLE-NAME (1)    09310099
049610                 SET DP013-DB2-ABEND                              09320000
049611                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09330000
049612                 PERFORM DP013-0000-PROCESS-ABEND                 09340000
049613         END-EVALUATE                                             09350000
049614     END-PERFORM.                                                 09360000
049615*                                                                 09370000
049616     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09380000
049617         MOVE '4110-GET-DC NAME'   TO DP013-PARAGRAPH             09390000
049618         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT DC'  09400000
049619                                   TO DP013-MESSAGE-TEXT (1)      09410000
049620         MOVE SQLCA                TO DP013-SQLCA                 09420000
049621         MOVE 'XMT_LOC '   TO DP013-DB2-TABLE-NAME (1)            09430099
049622         SET DP013-DB2-ABEND                                      09440000
049623             DP013-XCTL-DISPLAY-RESTART                           09450000
049624                                   TO TRUE                        09460000
049625         PERFORM DP013-0000-PROCESS-ABEND                         09470000
049626     END-IF.                                                      09480000
049627                                                                  09490000
049628  EJECT                                                           09500000
049629                                                                  09510000
049630*----------------------------------------------------------------*09520000
049631* GET THE PO TYPE CODE                                           *09530000
049632*----------------------------------------------------------------*09540000
049633                                                                  09550000
049634 4120-GET-PO-TYP.                                                 09560000
049635     PERFORM                                                      09570000
049636         WITH TEST AFTER                                          09580000
049637         VARYING PV-RETRY-COUNTER                                 09590000
049638         FROM 1 BY 1                                              09600000
049639         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09610000
049640             OR (SQLCODE = ZERO)                                  09620099
049641             OR (SQLCODE = +100))                                 09630099
049642             EXEC SQL                                             09640099
049643                 SELECT PO_TYP_CDE                                09650099
049644                 INTO :PURCHS-PO-TYP-CDE                          09660099
049645                 FROM TPURCHS                                     09670099
049646                 WHERE PO_NBR = :ASC-KEY-PO-NUMBER                09680099
049647                   AND VER_STATUS_CDE = 'A'                       09690099
049648             END-EXEC                                             09700099
049649         EVALUATE TRUE                                            09710099
049651             WHEN SQLCODE = +100                                  09720099
049652                SET DP020-NEXT-ACT-APPL-ERROR TO TRUE             09730099
049653                SET DP020-MSG-FATAL TO TRUE                       09740099
049654                MOVE PC-TSYMSG-00726 TO DP020-MSG-NUMBER          09750099
049655             WHEN SQLCODE = ZERO                                  09760099
049656             WHEN SQLCODE = -904                                  09770099
049657             WHEN SQLCODE = -913                                  09780099
049658                 CONTINUE                                         09790099
049659             WHEN SQLWARN0 NOT = SPACES                           09800099
049660             WHEN SQLCODE < ZERO                                  09810099
049661             WHEN SQLCODE > ZERO                                  09820099
049662                 MOVE '4120-GET-PO-TYP'                           09830099
049663                                   TO DP013-PARAGRAPH             09840099
049664                 MOVE 'SQL ERROR SELECTING PO TYP CODE'           09850099
049665                                   TO DP013-MESSAGE-TEXT (1)      09860099
049666                 MOVE SQLCA        TO DP013-SQLCA                 09870099
049667                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    09880099
049668                 SET DP013-DB2-ABEND                              09890099
049669                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09900099
049670                 PERFORM DP013-0000-PROCESS-ABEND                 09910099
049671         END-EVALUATE                                             09920099
049672     END-PERFORM.                                                 09930099
049673*                                                                 09940099
049674     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09950099
049675         MOVE '4120-GET-PO-TYP'    TO DP013-PARAGRAPH             09960099
049676         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO T'09970099
049677                                   TO DP013-MESSAGE-TEXT (1)      09980099
049678         MOVE SQLCA                TO DP013-SQLCA                 09990099
049679         MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)            10000099
049680         SET DP013-DB2-ABEND                                      10010099
049681             DP013-XCTL-DISPLAY-RESTART                           10020099
049682                                   TO TRUE                        10030099
049683         PERFORM DP013-0000-PROCESS-ABEND                         10040099
049684     END-IF.                                                      10050099
049685                                                                  10060099
049686  EJECT                                                           10070099
049687                                                                  10080099
049688 4220-PRESCAN-ITEMS-FROM-DB.                                      10090099
049689     SET PS-ALL-VSORAIR TO TRUE.                                  10100099
049690     PERFORM 4010-OPEN-CURSOR.                                    10110099
049691     PERFORM                                                      10120099
049692         VARYING PV-READ-COUNT                                    10130099
049693         FROM 1 BY 1                                              10140099
049694         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    10150099
049695         OR  ASC-NO-ITEMS-LEFT-ON-DB)                             10160099
049696             PERFORM 4310-FETCH                                   10170099
049697               IF ASC-ITEMS-LEFT-ON-DB                            10180099
049698                  ADD +1 TO ASC-NUMBER-OF-ITEMS-READ              10190099
049699                    IF NOT VEHICL-CURR-OPER-UNT-ID = 90           10200099
049700                        SET PS-NOT-ALL-VSORAIR TO TRUE            10210099
049701                    END-IF                                        10220099
049702               END-IF                                             10230099
049703     END-PERFORM.                                                 10240099
049704                                                                  10250099
049705     IF ASC-NUMBER-OF-ITEMS-READ = 0 AND PS-ALL-VSORAIR           10260099
049706       SET PS-NOT-ALL-VSORAIR TO TRUE                             10270099
049707     END-IF.                                                      10280099
049708                                                                  10290099
049709     PERFORM 4020-CLOSE-CURSOR.                                   10300099
049710*----------------------------------------------------------------*10310099
049711*    READ EACH SHIPMENT FROM THE DB                              *10320099
049712*----------------------------------------------------------------*10330099
049713 4300-READ-ITEMS-FROM-DB.                                         10340099
049714     PERFORM 4010-OPEN-CURSOR.                                    10350099
049715     PERFORM                                                      10360099
049716         VARYING PV-READ-COUNT                                    10370099
049717         FROM 1 BY 1                                              10380099
049718         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    10390099
049719         OR  ASC-NO-ITEMS-LEFT-ON-DB)                             10400099
049720             PERFORM 4310-FETCH                                   10410099
049721               IF ASC-ITEMS-LEFT-ON-DB                            10420099
049722                  ADD +1 TO ASC-NUMBER-OF-ITEMS-READ              10430099
049723                  MOVE VEHICL-CURR-OPER-UNT-ID TO PV-OPER-UNT-ID  10440099
049724                  PERFORM 4110-GET-DC-NAME                        10450099
049725                  PERFORM 5000-RETRIEVE-MAXDATES                  10460099
049726                  PERFORM 5020-RETRIEVE-MAXDATES                  10470099
049727                  IF PS-AM-STAT-FOUND                                     
049728                    CONTINUE                                              
049729                  ELSE                                                    
049730                    PERFORM 5025-GET-AF-STATUS-DTE                        
049731                  END-IF                                                  
049732                  PERFORM 5030-RETRIEVE-RCPTDATES                 10480099
049733                  PERFORM 5040-RETRIEVE-VERDATES                  10490099
049734                  PERFORM 5050-RETRIEVE-UNITS-ORD                 10500099
049735                  PERFORM 5060-RETRIEVE-UNITS-VFD                 10510099
049736                  PERFORM 5070-DETERMINE-IN-PROCESS               10520099
049737                                                                  10530099
049738                  IF PV-OPER-UNT-ID = 85                          10540099
049739                     IF SQLCODE = +0                              10550099
049740                        MOVE DP015-YELLOW TO ASC-UNT-VFD1-C       10560099
049741                      ELSE                                        10570099
049742                        MOVE DP015-BLUE TO ASC-UNT-VFD1-C         10580099
049743                     END-IF                                       10590099
049744                     MOVE PV-DC-REC-QTY TO ASC-UNT-VFD1           10600099
049745                     MOVE ALLPLN-CURR-SPLIT-QTY TO ASC-UNT-ORD1   10610099
049746                     IF ASC-UNT-VFD1 = 0 OR ASC-UNT-ORD1 = 0      10620099
049747                         MOVE ZEROES TO ASC-PCT-RCD1-N            10630099
049748                         MOVE SPACES TO ASC-PCT-RCD1-SIGN         10640099
049749                     ELSE                                         10650099
049750                         COMPUTE PV-TOT-REC-PCT                   10660099
049751                         ROUNDED =                                10670099
049752                            (ASC-UNT-VFD1 / ASC-UNT-ORD1)         10680099
049753                         COMPUTE PV-TOT-REC-PCT =                 10690099
049754                                  PV-TOT-REC-PCT * 100            10700099
049755                   IF PV-TOT-REC-PCT = ZERO AND ASC-UNT-VFD1 > 0  10710099
049756                           MOVE 1 TO ASC-PCT-RCD1-N               10720099
049757                           MOVE '%' TO ASC-PCT-RCD1-SIGN          10730099
049758                   ELSE                                           10740099
049759                        MOVE PV-TOT-REC-PCT TO ASC-PCT-RCD1-N     10750099
049760                        MOVE '%' TO ASC-PCT-RCD1-SIGN             10760099
049761                   END-IF                                         10770099
049762                   END-IF                                         10780099
049763                     MOVE PV-MAX-VERIFD-DTE TO PV-DATE-BREAK      10790099
049764                     MOVE PV-DB-MM          TO PV-DD-MM           10800099
049765                     MOVE PV-DB-DD          TO PV-DD-DD           10810099
049766                     MOVE PV-DB-YY          TO PV-DD-YY           10820099
049767                     IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES   10830099
049768                                       AND    PV-DD-MM = SPACES   10840099
049769                         MOVE SPACES TO ASC-LST-VFD-DT1           10850099
049770                     ELSE                                         10860099
049771                         MOVE PV-DATE-DISPLAY TO ASC-LST-VFD-DT1  10870099
049772                     END-IF                                       10880099
049773                     MOVE PV-MIN-VERIFD-DTE TO PV-DATE-BREAK      10890099
049774                     MOVE PV-DB-MM          TO PV-DD-MM           10900099
049775                     MOVE PV-DB-DD          TO PV-DD-DD           10910099
049776                     MOVE PV-DB-YY          TO PV-DD-YY           10920099
049777                     IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES   10930099
049778                                       AND    PV-DD-MM = SPACES   10940099
049779                         MOVE SPACES TO ASC-FST-VFD-DT1           10950099
049780                     ELSE                                         10960099
049781                         MOVE PV-DATE-DISPLAY TO ASC-FST-VFD-DT1  10970099
049782                     END-IF                                       10980099
049783                     IF ASC-LST-VFD-DT1 = ASC-FST-VFD-DT1         10990099
049784                       MOVE SPACES TO ASC-LST-VFD-DT1             11000099
049785                     END-IF                                       11010099
049786                                                                  11020099
049787                     MOVE XMT00001-LOC-5-ABBR-NM TO ASC-DC1       11030099
049788                     MOVE PV-MAX-STATUS-DTE TO PV-DATE-BREAK      11040099
049789                     MOVE PV-DB-MM          TO PV-DD-MM           11050099
049790                     MOVE PV-DB-DD          TO PV-DD-DD           11060099
049791                     MOVE PV-DB-YY          TO PV-DD-YY           11070099
049792                     IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES   11080099
049793                        AND    PV-DD-MM = SPACES                  11090099
049794                         MOVE SPACES TO ASC-LST-RCPT-DT1          11100099
049795                     ELSE                                         11110099
049796                         MOVE PV-DATE-DISPLAY TO ASC-LST-RCPT-DT1 11120099
049797                     END-IF                                       11130099
049798                     MOVE PV-MIN-STATUS-DTE TO PV-DATE-BREAK      11140099
049799                     MOVE PV-DB-MM          TO PV-DD-MM           11150099
049800                     MOVE PV-DB-DD          TO PV-DD-DD           11160099
049801                     MOVE PV-DB-YY          TO PV-DD-YY           11170099
049802                     IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES   11180099
049803                        AND    PV-DD-MM = SPACES                  11190099
049804                         MOVE SPACES TO ASC-FST-RCPT-DT1          11200099
049805                     ELSE                                         11210099
049806                        MOVE PV-DATE-DISPLAY TO ASC-FST-RCPT-DT1  11220099
049807                     END-IF                                       11230099
049808                     IF ASC-LST-RCPT-DT1 = ASC-FST-RCPT-DT1       11240099
049809                       MOVE SPACES TO ASC-LST-RCPT-DT1            11250099
049810                     END-IF                                       11260099
049811                     MOVE PV-SHIPST-ETA-DATE TO PV-DATE-BREAK     11270099
049812                     MOVE PV-DB-MM          TO PV-DD-MM           11280099
049813                     MOVE PV-DB-DD          TO PV-DD-DD           11290099
049814                     MOVE PV-DB-YY          TO PV-DD-YY           11300099
049815                     IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES   11310099
049816                        AND PV-DD-MM = SPACES                     11320099
049817                           MOVE SPACES TO ASC-DC-DEL-DATE1        11330099
049818                     ELSE                                         11340099
049819                       MOVE PV-DATE-DISPLAY TO ASC-DC-DEL-DATE1   11350099
049820                     END-IF                                       11360099
049821                     MOVE SHIPST-STATUS-DTE TO PV-DATE-BREAK      11370099
049822                     MOVE PV-DB-MM          TO PV-DD-MM           11380099
049823                     MOVE PV-DB-DD          TO PV-DD-DD           11390099
049824                     MOVE PV-DB-YY          TO PV-DD-YY           11400099
049825                     IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES   11410099
049826                        AND PV-DD-MM = SPACES                     11420099
049827                           MOVE SPACES TO ASC-DECON-DATE1         11430099
049828                     ELSE                                         11440099
049829                          MOVE PV-DATE-DISPLAY TO ASC-DECON-DATE1 11450099
049830                     END-IF                                       11460099
049831                  ELSE                                            11470099
049832                     IF PV-OPER-UNT-ID = 810                      11480099
049833                        IF SQLCODE = +0                           11490099
049834                           MOVE DP015-YELLOW TO ASC-UNT-VFD2-C    11500093
049835                         ELSE                                     11510091
049836                            MOVE DP015-BLUE TO ASC-UNT-VFD2-C     11520093
049837                        END-IF                                    11530091
049838                        MOVE PV-DC-REC-QTY TO ASC-UNT-VFD2        11540031
049839                        MOVE ALLPLN-CURR-SPLIT-QTY TO ASC-UNT-ORD211550031
049840                     IF ASC-UNT-VFD2 = 0 OR ASC-UNT-ORD2 = 0      11560031
049841                         MOVE ZEROES TO ASC-PCT-RCD2              11570031
049842                     ELSE                                         11580031
049843                         COMPUTE PV-TOT-REC-PCT                   11590031
049844                         ROUNDED =                                11600031
049845                            (ASC-UNT-VFD2 / ASC-UNT-ORD2)         11610031
049846                         COMPUTE PV-TOT-REC-PCT =                 11620031
049847                                  PV-TOT-REC-PCT * 100            11630031
049848                   IF PV-TOT-REC-PCT = ZERO AND ASC-UNT-VFD2 > 0  11640031
049849                           MOVE 1 TO ASC-PCT-RCD2-N               11650064
049850                           MOVE '%' TO ASC-PCT-RCD2-SIGN          11660090
049851                   ELSE                                           11670031
049852                        MOVE PV-TOT-REC-PCT TO ASC-PCT-RCD2-N     11680064
049853                        MOVE '%' TO ASC-PCT-RCD2-SIGN             11690090
049854                   END-IF                                         11700031
049855                   END-IF                                         11710031
049856                        MOVE PV-MAX-VERIFD-DTE TO PV-DATE-BREAK   11720031
049857                        MOVE PV-DB-MM          TO PV-DD-MM        11730031
049858                        MOVE PV-DB-DD          TO PV-DD-DD        11740031
049859                        MOVE PV-DB-YY          TO PV-DD-YY        11750031
049860                        IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES11760031
049861                                          AND    PV-DD-MM = SPACES11770031
049862                            MOVE SPACES TO ASC-LST-VFD-DT2        11780031
049863                        ELSE                                      11790031
049864                           MOVE PV-DATE-DISPLAY TO ASC-LST-VFD-DT211800031
049865                        END-IF                                    11810031
049866                        MOVE PV-MIN-VERIFD-DTE TO PV-DATE-BREAK   11820031
049867                        MOVE PV-DB-MM          TO PV-DD-MM        11830031
049868                        MOVE PV-DB-DD          TO PV-DD-DD        11840031
049869                        MOVE PV-DB-YY          TO PV-DD-YY        11850031
049870                        IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES11860031
049871                                          AND    PV-DD-MM = SPACES11870031
049872                            MOVE SPACES TO ASC-FST-VFD-DT2        11880031
049873                        ELSE                                      11890031
049874                           MOVE PV-DATE-DISPLAY TO ASC-FST-VFD-DT211900031
049875                        END-IF                                    11910031
049876                        IF ASC-LST-VFD-DT2 = ASC-FST-VFD-DT2      11920060
049877                          MOVE SPACES TO ASC-LST-VFD-DT2          11930060
049878                        END-IF                                    11940060
049879                        MOVE XMT00001-LOC-5-ABBR-NM TO ASC-DC2    11950099
049880                        MOVE PV-MAX-STATUS-DTE TO PV-DATE-BREAK   11960031
049881                        MOVE PV-DB-MM          TO PV-DD-MM        11970031
049882                        MOVE PV-DB-DD          TO PV-DD-DD        11980031
049883                        MOVE PV-DB-YY          TO PV-DD-YY        11990031
049884                        IF PV-DD-DD = SPACES AND PV-DD-YY =       12000031
049885                            SPACES AND    PV-DD-MM = SPACES       12010031
049886                               MOVE SPACES TO ASC-LST-RCPT-DT2    12020031
049887                        ELSE                                      12030031
049888                         MOVE PV-DATE-DISPLAY TO ASC-LST-RCPT-DT2 12040031
049889                        END-IF                                    12050031
049890                        MOVE PV-MIN-STATUS-DTE TO PV-DATE-BREAK   12060031
049891                        MOVE PV-DB-MM          TO PV-DD-MM        12070031
049892                        MOVE PV-DB-DD          TO PV-DD-DD        12080031
049893                        MOVE PV-DB-YY          TO PV-DD-YY        12090031
049894                        IF PV-DD-DD = SPACES AND PV-DD-YY =       12100031
049895                            SPACES AND    PV-DD-MM = SPACES       12110031
049896                               MOVE SPACES TO ASC-FST-RCPT-DT2    12120031
049897                        ELSE                                      12130031
049898                          MOVE PV-DATE-DISPLAY TO ASC-FST-RCPT-DT212140031
049899                        END-IF                                    12150031
049900                        IF ASC-LST-RCPT-DT2 = ASC-FST-RCPT-DT2    12160059
049901                          MOVE SPACES TO ASC-LST-RCPT-DT2         12170059
049902                        END-IF                                    12180059
049903                        MOVE PV-SHIPST-ETA-DATE TO PV-DATE-BREAK  12190044
049904                        MOVE PV-DB-MM          TO PV-DD-MM        12200031
049905                        MOVE PV-DB-DD          TO PV-DD-DD        12210031
049906                        MOVE PV-DB-YY          TO PV-DD-YY        12220031
049907                        IF PV-DD-DD = SPACES AND PV-DD-YY =       12230031
049908                            SPACES AND    PV-DD-MM = SPACES       12240031
049909                              MOVE SPACES TO ASC-DC-DEL-DATE2     12250031
049910                        ELSE                                      12260031
049911                          MOVE PV-DATE-DISPLAY TO ASC-DC-DEL-DATE212270031
049912                        END-IF                                    12280031
049913                        MOVE SHIPST-STATUS-DTE TO                 12290031
049914                                                 PV-DATE-BREAK    12300031
049915                        MOVE PV-DB-MM          TO PV-DD-MM        12310031
049916                        MOVE PV-DB-DD          TO PV-DD-DD        12320031
049917                        MOVE PV-DB-YY          TO PV-DD-YY        12330031
049918                        IF PV-DD-DD = SPACES AND PV-DD-YY =       12340031
049919                           SPACES AND PV-DD-MM = SPACES           12350031
049920                              MOVE SPACES TO ASC-DECON-DATE2      12360031
049921                        ELSE                                      12370031
049922                           MOVE PV-DATE-DISPLAY TO ASC-DECON-DATE212380031
049923                        END-IF                                    12390031
049924                     ELSE                                         12400031
049925                       IF PV-OPER-UNT-ID = 830                    12410031
049926                        IF SQLCODE = +0                           12420091
049927                          MOVE DP015-YELLOW TO ASC-UNT-VFD3-C     12430093
049928                         ELSE                                     12440091
049929                          MOVE DP015-BLUE TO ASC-UNT-VFD3-C       12450093
049930                        END-IF                                    12460091
049931                        MOVE PV-DC-REC-QTY TO ASC-UNT-VFD3        12470031
049932                        MOVE ALLPLN-CURR-SPLIT-QTY TO ASC-UNT-ORD312480031
049933                     IF ASC-UNT-VFD3 = 0 OR ASC-UNT-ORD3 = 0      12490031
049934                         MOVE ZEROES TO ASC-PCT-RCD3              12500031
049935                     ELSE                                         12510031
049936                         COMPUTE PV-TOT-REC-PCT                   12520031
049937                         ROUNDED =                                12530031
049938                            (ASC-UNT-VFD3 / ASC-UNT-ORD3)         12540031
049939                         COMPUTE PV-TOT-REC-PCT =                 12550031
049940                                  PV-TOT-REC-PCT * 100            12560031
049941                   IF PV-TOT-REC-PCT = ZERO AND ASC-UNT-VFD3 > 0  12570031
049942                           MOVE 1 TO ASC-PCT-RCD3-N               12580064
049943                           MOVE '%' TO ASC-PCT-RCD3-SIGN          12590090
049944                   ELSE                                           12600031
049945                        MOVE PV-TOT-REC-PCT TO ASC-PCT-RCD3-N     12610064
049946                        MOVE '%' TO ASC-PCT-RCD3-SIGN             12620090
049947                   END-IF                                         12630031
049948                   END-IF                                         12640031
049949                        MOVE PV-MAX-VERIFD-DTE TO PV-DATE-BREAK   12650017
049950                        MOVE PV-DB-MM          TO PV-DD-MM        12660017
049951                        MOVE PV-DB-DD          TO PV-DD-DD        12670017
049952                        MOVE PV-DB-YY          TO PV-DD-YY        12680017
049953                        IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES12690017
049954                                          AND    PV-DD-MM = SPACES12700017
049955                            MOVE SPACES TO ASC-LST-VFD-DT3        12710017
049956                        ELSE                                      12720017
049957                           MOVE PV-DATE-DISPLAY TO ASC-LST-VFD-DT312730017
049958                        END-IF                                    12740017
049959                        MOVE PV-MIN-VERIFD-DTE TO PV-DATE-BREAK   12750017
049960                        MOVE PV-DB-MM          TO PV-DD-MM        12760017
049961                        MOVE PV-DB-DD          TO PV-DD-DD        12770017
049962                        MOVE PV-DB-YY          TO PV-DD-YY        12780017
049963                        IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES12790017
049964                                          AND    PV-DD-MM = SPACES12800017
049965                            MOVE SPACES TO ASC-FST-VFD-DT3        12810017
049966                        ELSE                                      12820017
049967                           MOVE PV-DATE-DISPLAY TO ASC-FST-VFD-DT312830017
049968                        END-IF                                    12840017
049969                        IF ASC-LST-VFD-DT3 = ASC-FST-VFD-DT3      12850060
049970                            MOVE SPACES TO ASC-LST-VFD-DT3        12860060
049971                        END-IF                                    12870060
049972                                                                  12880060
049973                        MOVE XMT00001-LOC-5-ABBR-NM TO ASC-DC3    12890099
049974                        MOVE PV-MAX-STATUS-DTE TO PV-DATE-BREAK   12900017
049975                        MOVE PV-DB-MM          TO PV-DD-MM        12910017
049976                        MOVE PV-DB-DD          TO PV-DD-DD        12920017
049977                        MOVE PV-DB-YY          TO PV-DD-YY        12930017
049978                        IF PV-DD-DD = SPACES AND PV-DD-YY =       12940017
049979                            SPACES AND PV-DD-MM = SPACES          12950017
049980                               MOVE SPACES TO ASC-LST-RCPT-DT3    12960017
049981                        ELSE                                      12970017
049982                         MOVE PV-DATE-DISPLAY TO ASC-LST-RCPT-DT3 12980017
049983                        END-IF                                    12990017
049984                        MOVE PV-MIN-STATUS-DTE TO PV-DATE-BREAK   13000017
049985                        MOVE PV-DB-MM          TO PV-DD-MM        13010017
049986                        MOVE PV-DB-DD          TO PV-DD-DD        13020017
049987                        MOVE PV-DB-YY          TO PV-DD-YY        13030017
049988                        IF PV-DD-DD = SPACES AND PV-DD-YY =       13040017
049989                            SPACES AND PV-DD-MM = SPACES          13050017
049990                               MOVE SPACES TO ASC-FST-RCPT-DT3    13060017
049991                        ELSE                                      13070017
049992                          MOVE PV-DATE-DISPLAY TO ASC-FST-RCPT-DT313080017
049993                        END-IF                                    13090017
049994                        IF ASC-LST-RCPT-DT3 = ASC-FST-RCPT-DT3    13100059
049995                          MOVE SPACES TO ASC-LST-RCPT-DT3         13110059
049996                        END-IF                                    13120059
049997                        MOVE PV-SHIPST-ETA-DATE TO PV-DATE-BREAK  13130044
049998                        MOVE PV-DB-MM           TO PV-DD-MM       13140017
049999                        MOVE PV-DB-DD           TO PV-DD-DD       13150017
050000                        MOVE PV-DB-YY           TO PV-DD-YY       13160017
050001                        IF PV-DD-DD = SPACES AND PV-DD-YY =       13170017
050002                           SPACES AND PV-DD-MM = SPACES           13180017
050003                               MOVE SPACES TO ASC-DC-DEL-DATE3    13190017
050004                        ELSE                                      13200017
050005                               MOVE PV-DATE-DISPLAY TO            13210017
050006                                                ASC-DC-DEL-DATE3  13220017
050007                        END-IF                                    13230017
050008                        MOVE SHIPST-STATUS-DTE TO                 13240017
050009                                                 PV-DATE-BREAK    13250017
050010                        MOVE PV-DB-MM         TO PV-DD-MM         13260017
050011                        MOVE PV-DB-DD         TO PV-DD-DD         13270017
050012                        MOVE PV-DB-YY         TO PV-DD-YY         13280017
050013                        IF PV-DD-DD = SPACES AND PV-DD-YY =       13290017
050014                           SPACES AND PV-DD-MM = SPACES           13300017
050015                               MOVE SPACES TO ASC-DECON-DATE3     13310017
050016                        ELSE                                      13320017
050017                            MOVE PV-DATE-DISPLAY TO               13330017
050018                                           ASC-DECON-DATE3        13340017
050019                        END-IF                                    13350099
050020*END IF FOR DC 830                                                13360099
050021                    END-IF                                        13370099
050030*END IF FOR DC 810                                                13380099
050040                   END-IF                                         13390099
050041*END IF FOR DC 085                                                13400099
050042                 END-IF                                           13410099
050043                  MOVE PURCHS-TOT-UNT-QTY TO ASC-TOT-ORD          13420046
050044               END-IF                                             13430017
050045*END IF FOR ASC-ITEMS-LEFT-ON-DB                                  13440099
050046     END-PERFORM.                                                 13450017
050047                                                                  13460017
050048     PERFORM 4020-CLOSE-CURSOR.                                   13470017
050049    EJECT                                                         13480017
050050                                                                  13490017
050051*----------------------------------------------------------------*13500017
050052*    FETCH THE SHIPMT-CSR CURSOR.                                *13510017
050053*----------------------------------------------------------------*13520017
050054                                                                  13530017
050055 4310-FETCH.                                                      13540000
050056     EXEC SQL                                                     13550000
050100        FETCH SHIPMT-CSR                                          13560000
050200          INTO  :SHIPMT-SHIPT-ID                                  13570000
050300               ,:SHIPMT-TRIP-ID                                   13580000
050400               ,:VEHICL-CURR-OPER-UNT-ID                          13590000
050500         END-EXEC.                                                13600000
050600     EVALUATE TRUE                                                13610000
050610         WHEN SQLCODE = ZERO                                      13620000
050620            CONTINUE                                              13630000
050621         WHEN SQLCODE = +100                                      13640000
050622             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  13650000
050623         WHEN SQLWARN0 NOT = SPACE                                13660000
050624         WHEN SQLCODE NOT = ZERO                                  13670000
050625              MOVE '4310-FETCH-CURSOR'                            13680000
050626                               TO DP013-PARAGRAPH                 13690000
050627              MOVE 'FETCH SHIPMT-CSR CURSOR'                      13700000
050628                               TO DP013-MESSAGE-TEXT (1)          13710000
050629              MOVE SQLCA       TO DP013-SQLCA                     13720000
050630              SET DP013-DB2-ABEND                                 13730000
050631                               TO TRUE                            13740000
050632              PERFORM DP013-0000-PROCESS-ABEND                    13750000
050633     END-EVALUATE.                                                13760000
050634  EJECT                                                           13770000
050635                                                                  13780000
050636*----------------------------------------------------------------*13790000
050637*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *13800000
050638*----------------------------------------------------------------*13810000
050639                                                                  13820000
050640 4400-MOVE-COMMAREA-TO-SCREEN.                                    13830000
050650                                                                  13840000
050660     MOVE ASC-PO-NBR               TO APONUMO.                    13850000
050670     MOVE ASC-LAST-FCTRY-DTE       TO PV-DATE-BREAK.              13860000
050680     MOVE PV-DB-MM                 TO PV-DD-MM.                   13870000
050690     MOVE PV-DB-DD                 TO PV-DD-DD.                   13880000
050700     MOVE PV-DB-YY                 TO PV-DD-YY.                   13890000
050800     MOVE PV-DATE-DISPLAY          TO ALASEXTO.                   13900000
050900     MOVE ASC-STRT-FCTRY-DTE       TO PV-DATE-BREAK.              13910000
051000     MOVE PV-DB-MM                 TO PV-DD-MM.                   13920000
051100     MOVE PV-DB-DD                 TO PV-DD-DD.                   13930000
051200     MOVE PV-DB-YY                 TO PV-DD-YY.                   13940000
051300     MOVE PV-DATE-DISPLAY          TO ASTEXTO.                    13950000
051400     MOVE ASC-DC1                  TO ADCNBR1O.                   13960000
051500     MOVE ASC-DC2                  TO ADCNBR2O.                   13970000
051600     MOVE ASC-DC3                  TO ADCNBR3O.                   13980000
051700     MOVE ASC-SHIP-DATE            TO ASHIPDTO.                   13990000
051800     MOVE ASC-OTB                  TO AOTBPERO.                   14000000
051900     MOVE ASC-CANCEL-DATE          TO ACNCLDTO.                   14010000
052000     MOVE ASC-FOB-POINT            TO AFOBNMEO.                   14020000
052100     MOVE ASC-VENDOR               TO AVDRNAMO.                   14030000
052200     MOVE ASC-DEPT                 TO ADEPTNOO.                   14040000
052300     MOVE ASC-DECON-DATE1          TO ADECDT1O.                   14050000
052400     MOVE ASC-DECON-DATE2          TO ADECDT2O.                   14060000
052500     MOVE ASC-DECON-DATE3          TO ADECDT3O.                   14070000
052600     MOVE ASC-DC-DEL-DATE1         TO ADCDEL1O.                   14080000
052700     MOVE ASC-DC-DEL-DATE2         TO ADCDEL2O.                   14090000
052800     MOVE ASC-DC-DEL-DATE3         TO ADCDEL3O.                   14100000
052900     MOVE ASC-FST-RCPT-DT1         TO AFSTRCP1O.                  14110000
053000     MOVE ASC-FST-RCPT-DT2         TO AFSTRCP2O.                  14120000
053100     MOVE ASC-FST-RCPT-DT3         TO AFSTRCP3O.                  14130000
053200     MOVE ASC-LST-RCPT-DT1         TO ALSTRCP1O.                  14140000
053300     MOVE ASC-LST-RCPT-DT2         TO ALSTRCP2O.                  14150000
053400     MOVE ASC-LST-RCPT-DT3         TO ALSTRCP3O.                  14160000
053410     MOVE ASC-FST-VFD-DT1          TO AFSTVFD1O.                  14170010
053420     MOVE ASC-FST-VFD-DT2          TO AFSTVFD2O.                  14180010
053430     MOVE ASC-FST-VFD-DT3          TO AFSTVFD3O.                  14190010
053440     MOVE ASC-LST-VFD-DT1          TO ALSTVFD1O.                  14200010
053450     MOVE ASC-LST-VFD-DT2          TO ALSTVFD2O.                  14210010
053460     MOVE ASC-LST-VFD-DT3          TO ALSTVFD3O.                  14220010
053470     MOVE ASC-UNT-ORD1             TO AUNORD1O.                   14230013
053480     MOVE ASC-UNT-ORD2             TO AUNORD2O.                   14240013
053490     MOVE ASC-UNT-ORD3             TO AUNORD3O.                   14250013
053496     ADD  ASC-UNT-VFD1             TO ASC-TOT-VFD                 14260025
053497     ADD  ASC-UNT-VFD2             TO ASC-TOT-VFD                 14270025
053498     ADD  ASC-UNT-VFD3             TO ASC-TOT-VFD                 14280025
053499     MOVE ASC-TOT-VFD              TO PO017-TOTVFD.               14290099
053521     MOVE ASC-UNT-VFD1             TO AUNVFD1O.                   14300025
053522     MOVE ASC-UNT-VFD1-C           TO AUNVFD1C.                   14310093
053523     MOVE ASC-UNT-VFD2             TO AUNVFD2O.                   14320093
053524     MOVE ASC-UNT-VFD2-C           TO AUNVFD2C.                   14330093
053525     MOVE ASC-UNT-VFD3             TO AUNVFD3O.                   14340093
053526     MOVE ASC-UNT-VFD3-C           TO AUNVFD3C.                   14350093
053527     MOVE ASC-PCT-RCD1-N           TO PV-TREC-PCT1.               14360065
053531     MOVE ASC-PCT-RCD1-SIGN        TO PV-TREC-PCT1-SIGN.          14370061
053535     MOVE ASC-PCT-RCD2-N           TO PV-TREC-PCT2.               14380065
053536     MOVE ASC-PCT-RCD2-SIGN        TO PV-TREC-PCT2-SIGN.          14390061
053539     MOVE ASC-PCT-RCD3-N           TO PV-TREC-PCT3.               14400065
053540     MOVE ASC-PCT-RCD3-SIGN        TO PV-TREC-PCT3-SIGN.          14410061
053542     MOVE PV-NORMAL-TOTALS         TO MR-TOTAL-LINE.              14420091
053550                                                                  14430031
053600   EJECT                                                          14440000
053700                                                                  14450000
053701 4401-PREP-INTERAPPL-COMMAREA.                                    14460099
053702                                                                  14470099
053703     MOVE ASC-PO-NBR               TO TR105-PO-NBR.               14480099
053704                                                                  14490099
053800*----------------------------------------------------------------*14500000
053900* RETRIEVE THE MAX PICKUP DATE AND MAX VHTRIP ETA DATE PER DC    *14510000
054000*----------------------------------------------------------------*14520000
054100 5000-RETRIEVE-MAXDATES.                                          14530000
054200     PERFORM                                                      14540000
054300         WITH TEST AFTER                                          14550000
054400         VARYING PV-RETRY-COUNTER                                 14560000
054500         FROM 1 BY 1                                              14570000
054600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14580000
054700             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              14590000
054800             OR (SQLCODE = -305))                                 14600000
054900           EXEC SQL                                               14610000
055000             SELECT MAX(F.STATUS_DTE)                             14620044
055100             INTO :PV-SHIPST-ETA-DATE                             14630044
055200             FROM TSHIPMT A,                                      14640044
055300                  TSHPTPO B,                                      14650044
055400                  TTRIPST C,                                      14660044
055500                  TSHIPST F                                       14670044
055600             WHERE B.PO_NBR = :ASC-KEY-PO-NUMBER                  14680044
055700               AND A.SHIPT_ID = B.SHIPT_ID                        14690044
055800               AND C.TRIP_ID = A.TRIP_ID                          14700044
055900               AND C.OPER_UNT_ID = :PV-OPER-UNT-ID                14710044
056000               AND F.SHIPT_STATUS_CDE = 'AG'                      14720044
056010               AND F.SHIPT_ID = A.SHIPT_ID                        14730044
056100           END-EXEC                                               14740000
056200       EVALUATE TRUE                                              14750000
056300           WHEN SQLCODE = +100                                    14760000
056400           WHEN SQLCODE = -305                                    14770000
056500               MOVE SPACES TO PV-SHIPST-ETA-DATE                  14780044
056600           WHEN SQLCODE = ZERO                                    14790000
056700           WHEN SQLCODE = -904                                    14800000
056710           WHEN SQLCODE = -913                                    14810000
056720               CONTINUE                                           14820000
056730           WHEN SQLWARN0 NOT = SPACES                             14830000
056740           WHEN SQLCODE < ZERO                                    14840000
056750           WHEN SQLCODE > ZERO                                    14850000
056751               MOVE '5000-RETRIEVE-MAXDATES'                      14860000
056752                                 TO DP013-PARAGRAPH               14870000
056753               MOVE 'SQL ERROR GET MAX DATES'                     14880000
056754                                 TO DP013-MESSAGE-TEXT (1)        14890000
056755               MOVE SQLCA        TO DP013-SQLCA                   14900000
056756               MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (1)       14910000
056757               SET DP013-DB2-ABEND                                14920000
056758                   DP013-XCTL-DISPLAY-RESTART TO TRUE             14930000
056759               PERFORM DP013-0000-PROCESS-ABEND                   14940000
056760       END-EVALUATE                                               14950000
056761      END-PERFORM.                                                14960000
056762                                                                  14970000
056763      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       14980000
056764       MOVE '5000-RETRIEVE-MAXDATES'                              14990000
056765                                 TO DP013-PARAGRAPH               15000000
056766       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET MAX DTES'     15010000
056767                                 TO DP013-MESSAGE-TEXT (1)        15020000
056768       MOVE SQLCA                TO DP013-SQLCA                   15030000
056769       MOVE 'TSHIPMT'           TO DP013-DB2-TABLE-NAME (1)       15040000
056770       SET DP013-DB2-ABEND                                        15050000
056771           DP013-XCTL-DISPLAY-RESTART                             15060000
056772                                 TO TRUE                          15070000
056773       PERFORM DP013-0000-PROCESS-ABEND                           15080000
056774      END-IF.                                                     15090000
056775                                                                  15100000
056845*----------------------------------------------------------------*15110000
056846* RETRIEVE THE MAX PICKUP DATE AND MAX VHTRIP ETA DATE PER DC    *15120000
056847*----------------------------------------------------------------*15130000
056848 5020-RETRIEVE-MAXDATES.                                          15140000
056849                                                                  15141099
056850     SET PS-AM-STAT-FOUND-NO  TO TRUE.                            15142099
056851                                                                          
056852     PERFORM                                                      15150000
056853         WITH TEST AFTER                                          15160000
056854         VARYING PV-RETRY-COUNTER                                 15170000
056855         FROM 1 BY 1                                              15180000
056856         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15190000
056857             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              15200000
056858             OR (SQLCODE = -305))                                 15210000
056859           EXEC SQL                                               15220000
056860             SELECT MAX(F.STATUS_DTE)                             15230000
056861             INTO :SHIPST-STATUS-DTE                              15240000
056862             FROM TSHIPMT A,                                      15250000
056863                  TSHPTPO B,                                      15260000
056864                  TTRIPST C,                                      15270000
056865                  TSHIPST F                                       15280000
056866             WHERE B.PO_NBR = :ASC-KEY-PO-NUMBER                  15290000
056867               AND A.SHIPT_ID = B.SHIPT_ID                        15300000
056868               AND C.TRIP_ID = A.TRIP_ID                          15310000
056869               AND C.OPER_UNT_ID = :PV-OPER-UNT-ID                15320000
056870               AND F.SHIPT_STATUS_CDE = 'AM'                      15330000
056871               AND F.SHIPT_ID = A.SHIPT_ID                        15340000
056872           END-EXEC                                               15350000
056873       EVALUATE TRUE                                              15360000
056874           WHEN SQLCODE = +100                                    15370000
056875           WHEN SQLCODE = -305                                    15380001
056876           WHEN SQLCODE = -904                                    15410000
056877           WHEN SQLCODE = -913                                    15420000
056878             CONTINUE                                                     
056879****         PERFORM 5025-GET-AF-STATUS-DTE                       15390099
056880           WHEN SQLCODE = ZERO                                    15400000
056881             SET PS-AM-STAT-FOUND     TO TRUE                     15401099
056884           WHEN SQLWARN0 NOT = SPACES                             15440000
056885           WHEN SQLCODE < ZERO                                    15450000
056886           WHEN SQLCODE > ZERO                                    15460000
056887               MOVE '5020-RETRIEVE-MAXDATES'                      15470000
056888                                 TO DP013-PARAGRAPH               15480000
056889               MOVE 'SQL ERROR GET MAX DATES'                     15490000
056890                                 TO DP013-MESSAGE-TEXT (1)        15500000
056891               MOVE SQLCA        TO DP013-SQLCA                   15510000
056892               MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (1)       15520000
056893               SET DP013-DB2-ABEND                                15530000
056894                   DP013-XCTL-DISPLAY-RESTART TO TRUE             15540000
056895               PERFORM DP013-0000-PROCESS-ABEND                   15550000
056896       END-EVALUATE                                               15560000
056897      END-PERFORM.                                                15570000
056898                                                                  15580000
056899      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       15590000
056900       MOVE '5020-RETRIEVE-MAXDATES'                              15600000
056901                                 TO DP013-PARAGRAPH               15610000
056902       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET MAX DTES'     15620000
056903                                 TO DP013-MESSAGE-TEXT (1)        15630000
056904       MOVE SQLCA                TO DP013-SQLCA                   15640000
056905       MOVE 'TSHIPMT'           TO DP013-DB2-TABLE-NAME (1)       15650000
056906       SET DP013-DB2-ABEND                                        15660000
056907           DP013-XCTL-DISPLAY-RESTART                             15670000
056908                                 TO TRUE                          15680000
056909       PERFORM DP013-0000-PROCESS-ABEND                           15690000
056910      END-IF.                                                     15700000
056911                                                                  15710000
056912  EJECT                                                           15720000
056913                                                                  15730000
056914*----------------------------------------------------------------*15740000
056915* RETRIEVE THE MAX PICKUP DATE AND MAX VHTRIP ETA DATE PER DC    *15750000
056916*----------------------------------------------------------------*15760000
056917 5025-GET-AF-STATUS-DTE.                                          15770000
056918     PERFORM                                                      15780000
056919         WITH TEST AFTER                                          15790000
056920         VARYING PV-RETRY-COUNTER                                 15800000
056921         FROM 1 BY 1                                              15810000
056922         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15820000
056923             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              15830000
056924             OR (SQLCODE = -305))                                 15840000
056925           EXEC SQL                                               15850000
056926             SELECT MAX(F.STATUS_DTE)                             15860000
056927             INTO :SHIPST-STATUS-DTE                              15870000
056928             FROM TSHIPMT A,                                      15880000
056929                  TSHPTPO B,                                      15890000
056930                  TTRIPST C,                                      15900000
056931                  TSHIPST F                                       15910000
056932             WHERE B.PO_NBR = :ASC-KEY-PO-NUMBER                  15920000
056933               AND A.SHIPT_ID = B.SHIPT_ID                        15930000
056934               AND C.TRIP_ID = A.TRIP_ID                          15940000
056935               AND C.OPER_UNT_ID = :PV-OPER-UNT-ID                15950000
056936               AND F.SHIPT_STATUS_CDE = 'AF'                      15960000
056937               AND F.SHIPT_ID = A.SHIPT_ID                        15970000
056938           END-EXEC                                               15980000
056939       EVALUATE TRUE                                              15990000
056940           WHEN SQLCODE = +100                                    16000000
056941           WHEN SQLCODE = -305                                    16010000
056942             MOVE SPACES TO SHIPST-STATUS-DTE                     16020000
056943           WHEN SQLCODE = ZERO                                    16030000
056944           WHEN SQLCODE = -904                                    16040000
056945           WHEN SQLCODE = -913                                    16050000
056946               CONTINUE                                           16060000
056947           WHEN SQLWARN0 NOT = SPACES                             16070000
056948           WHEN SQLCODE < ZERO                                    16080000
056949           WHEN SQLCODE > ZERO                                    16090000
056950               MOVE '5025-GET-AF-STATUS-DTE'                      16100000
056951                                 TO DP013-PARAGRAPH               16110000
056952               MOVE 'SQL ERROR GET MAX DATES'                     16120000
056953                                 TO DP013-MESSAGE-TEXT (1)        16130000
056954               MOVE SQLCA        TO DP013-SQLCA                   16140000
056955               MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (1)       16150000
056956               SET DP013-DB2-ABEND                                16160000
056957                   DP013-XCTL-DISPLAY-RESTART TO TRUE             16170000
056958               PERFORM DP013-0000-PROCESS-ABEND                   16180000
056959       END-EVALUATE                                               16190000
056960      END-PERFORM.                                                16200000
056961                                                                  16210000
056962      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       16220000
056963       MOVE '5025-GET-AF-STATUS-DTE'                              16230000
056964                                 TO DP013-PARAGRAPH               16240000
056965       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET MAX DTES'     16250000
056966                                 TO DP013-MESSAGE-TEXT (1)        16260000
056967       MOVE SQLCA                TO DP013-SQLCA                   16270000
056968       MOVE 'TSHIPMT'           TO DP013-DB2-TABLE-NAME (1)       16280000
056969       SET DP013-DB2-ABEND                                        16290000
056970           DP013-XCTL-DISPLAY-RESTART                             16300000
056971                                 TO TRUE                          16310000
056972       PERFORM DP013-0000-PROCESS-ABEND                           16320000
056973      END-IF.                                                     16330000
056974                                                                  16340000
056975  EJECT                                                           16350000
056976                                                                  16360000
056977*----------------------------------------------------------------*16370000
056978* RETRIEVE THE MAX AND MIN RCPT DATES PER DC                     *16380000
056979*----------------------------------------------------------------*16390000
056980 5030-RETRIEVE-RCPTDATES.                                         16400000
056981     PERFORM                                                      16410000
056982         WITH TEST AFTER                                          16420000
056983         VARYING PV-RETRY-COUNTER                                 16430000
056984         FROM 1 BY 1                                              16440000
056985         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16450000
056986             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              16460000
056987             OR (SQLCODE = -305))                                 16470000
056988           EXEC SQL                                               16480000
056989             SELECT MAX(E.STATUS_DTE),                            16490000
056990                    MIN(E.STATUS_DTE)                             16500000
056991             INTO  :PV-MAX-STATUS-DTE                             16510000
056992                  ,:PV-MIN-STATUS-DTE                             16520000
056993             FROM   TSHIPMT A,                                    16530000
056994                    TSHPTPO B,                                    16540000
056995                    TTRIPST C,                                    16550000
056996                    TSHIPST E                                     16560000
056997             WHERE B.PO_NBR = :ASC-KEY-PO-NUMBER                  16570000
056998               AND A.SHIPT_ID = B.SHIPT_ID                        16580000
056999               AND C.TRIP_ID = A.TRIP_ID                          16590000
057000               AND C.OPER_UNT_ID = :PV-OPER-UNT-ID                16600000
057001               AND E.SHIPT_STATUS_CDE = 'AR'                      16610000
057002               AND E.SHIPT_ID = A.SHIPT_ID                        16620000
057003           END-EXEC                                               16630000
057004       EVALUATE TRUE                                              16640000
057005           WHEN SQLCODE = +100                                    16650000
057006           WHEN SQLCODE = -305                                    16660000
057007             MOVE SPACES TO PV-MAX-STATUS-DTE PV-MIN-STATUS-DTE   16670000
057008           WHEN SQLCODE = ZERO                                    16680000
057009           WHEN SQLCODE = -904                                    16690000
057010           WHEN SQLCODE = -913                                    16700000
057011               CONTINUE                                           16710000
057012           WHEN SQLWARN0 NOT = SPACES                             16720000
057013           WHEN SQLCODE < ZERO                                    16730000
057014           WHEN SQLCODE > ZERO                                    16740000
057015               MOVE '5030-RETRIEVE-RCPTDATES'                     16750000
057016                                 TO DP013-PARAGRAPH               16760000
057017               MOVE 'SQL ERROR GET MAX AND MIN RCPT DATES'        16770000
057018                                 TO DP013-MESSAGE-TEXT (1)        16780000
057019               MOVE SQLCA        TO DP013-SQLCA                   16790000
057020               MOVE 'TSHIPST'   TO DP013-DB2-TABLE-NAME (1)       16800000
057021               SET DP013-DB2-ABEND                                16810000
057022                   DP013-XCTL-DISPLAY-RESTART TO TRUE             16820000
057023               PERFORM DP013-0000-PROCESS-ABEND                   16830000
057024       END-EVALUATE                                               16840000
057025      END-PERFORM.                                                16850000
057026                                                                  16860000
057027      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       16870000
057028       MOVE '5030-RETRIEVE-RCPTDATES'                             16880000
057029                                 TO DP013-PARAGRAPH               16890000
057030       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET RCPT DTES'    16900000
057031                                 TO DP013-MESSAGE-TEXT (1)        16910000
057032       MOVE SQLCA                TO DP013-SQLCA                   16920000
057033       MOVE 'TSHIPST'           TO DP013-DB2-TABLE-NAME (1)       16930000
057034       SET DP013-DB2-ABEND                                        16940000
057035           DP013-XCTL-DISPLAY-RESTART                             16950000
057036                                 TO TRUE                          16960000
057037       PERFORM DP013-0000-PROCESS-ABEND                           16970000
057038      END-IF.                                                     16980000
057039                                                                  16990000
057040 EJECT                                                            17000000
057041*----------------------------------------------------------------*17010010
057042* RETRIEVE THE MAX AND MIN VERIFIED DATES PER DC                 *17020010
057043*----------------------------------------------------------------*17030010
057044 5040-RETRIEVE-VERDATES.                                          17040010
057045     PERFORM                                                      17050010
057046         WITH TEST AFTER                                          17060010
057047         VARYING PV-RETRY-COUNTER                                 17070010
057048         FROM 1 BY 1                                              17080010
057049         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17090010
057050             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              17100010
057051             OR (SQLCODE = -305))                                 17110010
057052           EXEC SQL                                               17120010
057053             SELECT MAX(DATE(VERFYD_TMST)),                       17130010
057054                    MIN(DATE(VERFYD_TMST))                        17140010
057055             INTO  :PV-MAX-VERIFD-DTE                             17150010
057056                  ,:PV-MIN-VERIFD-DTE                             17160010
057057             FROM TRECEIV                                         17170010
057058             WHERE ORD_NBR = :ASC-KEY-PO-NUMBER                   17180010
057059               AND VER_STATUS_CDE = 'A'                           17190010
057060               AND STATUS_CDE = 'VE'                              17200010
057061               AND OPER_UNT_ID = :PV-OPER-UNT-ID                  17210010
057063           END-EXEC                                               17220010
057064       EVALUATE TRUE                                              17230010
057065           WHEN SQLCODE = +100                                    17240010
057066           WHEN SQLCODE = -305                                    17250010
057068             MOVE SPACES TO PV-MAX-VERIFD-DTE PV-MIN-VERIFD-DTE   17260010
057069           WHEN SQLCODE = ZERO                                    17270010
057070           WHEN SQLCODE = -904                                    17280010
057071           WHEN SQLCODE = -913                                    17290010
057072               CONTINUE                                           17300010
057073           WHEN SQLWARN0 NOT = SPACES                             17310010
057074           WHEN SQLCODE < ZERO                                    17320010
057075           WHEN SQLCODE > ZERO                                    17330010
057076               MOVE '5040-RETRIEVE-VERDATES'                      17340010
057077                                 TO DP013-PARAGRAPH               17350010
057078               MOVE 'SQL ERROR GET MAX AND MIN VERFD DATES'       17360010
057079                                 TO DP013-MESSAGE-TEXT (1)        17370010
057080               MOVE SQLCA        TO DP013-SQLCA                   17380010
057081               MOVE 'TRECEIV'   TO DP013-DB2-TABLE-NAME (1)       17390010
057082               SET DP013-DB2-ABEND                                17400010
057083                   DP013-XCTL-DISPLAY-RESTART TO TRUE             17410010
057084               PERFORM DP013-0000-PROCESS-ABEND                   17420010
057085       END-EVALUATE                                               17430010
057086      END-PERFORM.                                                17440010
057087                                                                  17450010
057088      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       17460010
057089       MOVE '5040-RETRIEVE-VERDATES'                              17470010
057090                                 TO DP013-PARAGRAPH               17480010
057091       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET VERFD DTES'   17490010
057092                                 TO DP013-MESSAGE-TEXT (1)        17500010
057093       MOVE SQLCA                TO DP013-SQLCA                   17510010
057094       MOVE 'TRECEIV'           TO DP013-DB2-TABLE-NAME (1)       17520010
057095       SET DP013-DB2-ABEND                                        17530010
057096           DP013-XCTL-DISPLAY-RESTART                             17540010
057097                                 TO TRUE                          17550010
057098       PERFORM DP013-0000-PROCESS-ABEND                           17560010
057099      END-IF.                                                     17570010
057100                                                                  17580010
057101 EJECT                                                            17590010
057102*----------------------------------------------------------------*17600011
057103* RETRIEVE THE QTY PER DC ORDERED                                *17610011
057104*----------------------------------------------------------------*17620011
057105 5050-RETRIEVE-UNITS-ORD.                                         17630011
057106     PERFORM                                                      17640011
057107         WITH TEST AFTER                                          17650011
057108         VARYING PV-RETRY-COUNTER                                 17660011
057109         FROM 1 BY 1                                              17670011
057110         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17680011
057111             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              17690011
057112             OR (SQLCODE = -305))                                 17700011
057113           EXEC SQL                                               17710011
057114             SELECT SUM(CURR_SPLIT_QTY)                           17720011
057116             INTO  :ALLPLN-CURR-SPLIT-QTY:PV-QTY-NULL             17730033
057117             FROM TPURITM A,                                      17740033
057118                  TALLPLN B                                       17750033
057119             WHERE A.PO_NBR   = :ASC-KEY-PO-NUMBER                17760033
057122               AND B.DEST_NBR = :PV-OPER-UNT-ID                   17770033
057129               AND A.VER_STATUS_CDE = 'A'                         17780033
057130               AND A.STATUS_CDE NOT IN ('CA')                     17790033
057131               AND A.PO_NBR         = B.PO_NBR                    17800033
057132               AND A.PO_LNE_NBR     = B.PO_LNE_NBR                17810033
057134           END-EXEC                                               17820011
057135       EVALUATE TRUE                                              17830011
057136           WHEN SQLCODE = +100                                    17840011
057137           WHEN SQLCODE = -305                                    17850011
057138             MOVE 0 TO ALLPLN-CURR-SPLIT-QTY                      17860011
057139           WHEN SQLCODE = ZERO                                    17870011
057140           WHEN SQLCODE = -904                                    17880011
057141           WHEN SQLCODE = -913                                    17890011
057142               CONTINUE                                           17900011
057143           WHEN SQLWARN0 NOT = SPACES                             17910011
057144           WHEN SQLCODE < ZERO                                    17920011
057145           WHEN SQLCODE > ZERO                                    17930011
057146               MOVE '5050-RETRIEVE-UNITS-ORD'                     17940011
057147                                 TO DP013-PARAGRAPH               17950011
057148               MOVE 'SQL ERROR GET UNITS ORDERED'                 17960011
057149                                 TO DP013-MESSAGE-TEXT (1)        17970011
057150               MOVE SQLCA        TO DP013-SQLCA                   17980011
057151               MOVE 'TALLPLN'   TO DP013-DB2-TABLE-NAME (1)       17990011
057152               MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (2)       18000033
057153               SET DP013-DB2-ABEND                                18010033
057154                   DP013-XCTL-DISPLAY-RESTART TO TRUE             18020033
057155               PERFORM DP013-0000-PROCESS-ABEND                   18030033
057156       END-EVALUATE                                               18040033
057157      END-PERFORM.                                                18050033
057158                                                                  18060033
057159      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       18070033
057160       MOVE '5050-RETRIEVE-UNITS-ORD'                             18080033
057161                                 TO DP013-PARAGRAPH               18090033
057162       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET UNITS ORDERED'18100033
057163                                 TO DP013-MESSAGE-TEXT (1)        18110033
057164       MOVE SQLCA                TO DP013-SQLCA                   18120033
057165       MOVE 'TALLPLN'           TO DP013-DB2-TABLE-NAME (1)       18130033
057166       MOVE 'TPURITM'           TO DP013-DB2-TABLE-NAME (2)       18140033
057167       SET DP013-DB2-ABEND                                        18150033
057168           DP013-XCTL-DISPLAY-RESTART                             18160033
057169                                 TO TRUE                          18170033
057170       PERFORM DP013-0000-PROCESS-ABEND                           18180033
057171      END-IF.                                                     18190033
057172                                                                  18200033
057173 EJECT                                                            18210033
057174*----------------------------------------------------------------*18220033
057175* RETRIEVE THE RECEIVED QUANTITY FOR A DC.                       *18230033
057176*----------------------------------------------------------------*18240033
057177 5060-RETRIEVE-UNITS-VFD.                                         18250033
057178                                                                  18260033
057179     MOVE +0                       TO PV-DC-REC-QTY.              18270033
057180                                                                  18280033
057181     PERFORM                                                      18290033
057182         WITH TEST AFTER                                          18300033
057183         VARYING PV-RETRY-COUNTER                                 18310033
057184         FROM 1 BY 1                                              18320033
057185         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18330033
057186                   OR (SQLCODE = ZERO)                            18340033
057187                   OR (SQLCODE = 100))                            18350033
057188         EXEC SQL                                                 18360033
057189             SELECT SUM(AP_VERIFY_ITM_QTY)                        18370033
057190               INTO :PV-DC-REC-QTY:PV-QTY-NULL                    18380033
057191               FROM TRECITM A,                                    18390033
057192                    TRECDIS B                                     18400033
057193              WHERE                                               18410033
057194                    A.ORD_NBR        = :ASC-KEY-PO-NUMBER         18420033
057195                AND A.VER_STATUS_CDE = 'A'                        18430033
057196                AND A.OPER_UNT_ID    = :PV-OPER-UNT-ID            18440033
057197                AND A.STATUS_CDE     = 'VE'                       18450033
057198                AND A.ORD_NBR        = B.ORD_NBR                  18460033
057199                AND A.ORD_LNE_NBR    = B.ORD_LNE_NBR              18470033
057200                AND A.REC_SEQ_NBR    = B.REC_SEQ_NBR              18480033
057201                AND A.OPER_UNT_ID    = B.OPER_UNT_ID              18490033
057202                AND A.FCLTY_ID       = B.FCLTY_ID                 18500033
057203                AND B.VER_STATUS_CDE = 'A'                        18510033
057204         END-EXEC                                                 18520033
057205                                                                  18530033
057206         EVALUATE TRUE                                            18540033
057207             WHEN SQLCODE = ZERO                                  18550033
057208                 CONTINUE                                         18560033
057209             WHEN SQLCODE = +100                                  18570033
057210                 CONTINUE                                         18580033
057211             WHEN SQLCODE = -904                                  18590033
057212             WHEN SQLCODE = -913                                  18600033
057213                 CONTINUE                                         18610033
057214             WHEN SQLWARN0 NOT = SPACES                           18620033
057215             WHEN SQLCODE < ZERO                                  18630033
057216             WHEN SQLCODE > ZERO                                  18640033
057217                 MOVE '5060-RETRIEVE-UNITS-VFD'                   18650033
057218                                   TO DP013-PARAGRAPH             18660033
057219                 MOVE 'RETRIEVING RECEIVED QTY'                   18670033
057220                                   TO DP013-MESSAGE-TEXT (1)      18680033
057221                 MOVE SQLCA        TO DP013-SQLCA                 18690033
057222                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)    18700033
057223                 MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (2)    18710033
057224                 SET DP013-DB2-ABEND                              18720033
057225                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18730033
057226                 PERFORM DP013-0000-PROCESS-ABEND                 18740033
057227         END-EVALUATE                                             18750033
057228     END-PERFORM.                                                 18760033
057229*                                                                 18770033
057230     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18780033
057231         MOVE '5060-RETRIEVE-UNITS-VFD' TO DP013-PARAGRAPH        18790033
057232         MOVE 'MAXIMUM RETRIES EXCEEDED'                          18800033
057233                                   TO DP013-MESSAGE-TEXT (1)      18810033
057234         MOVE SQLCA                TO DP013-SQLCA                 18820033
057235         MOVE 'TRECITM '           TO DP013-DB2-TABLE-NAME (1)    18830033
057236         MOVE 'TRECDIS '           TO DP013-DB2-TABLE-NAME (2)    18840033
057237         SET DP013-DB2-ABEND                                      18850033
057238             DP013-XCTL-DISPLAY-RESTART                           18860033
057239                                   TO TRUE                        18870033
057240         PERFORM DP013-0000-PROCESS-ABEND                         18880033
057241     END-IF.                                                      18890033
057242                                                                  18900033
057243*----------------------------------------------------------------*18910033
057244* FIND OUT IF ANY RECEIVERS ARE STILL IN PROCESS FOR THIS DC     *18920033
057245*----------------------------------------------------------------*18930033
057246 5070-DETERMINE-IN-PROCESS.                                       18940033
057247     PERFORM                                                      18950033
057248         WITH TEST AFTER                                          18960033
057249         VARYING PV-RETRY-COUNTER                                 18970033
057250         FROM 1 BY 1                                              18980033
057251         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18990033
057252             OR (SQLCODE = ZERO) OR (SQLCODE = +100) OR           19000040
057253                (SQLCODE = -305))                                 19010040
057254           EXEC SQL                                               19020033
057261             SELECT MAX(REC_SEQ_NBR)                              19030036
057262             INTO :RECITM-REC-SEQ-NBR                             19040039
057263             FROM TRECITM                                         19050036
057264             WHERE ORD_NBR =: ASC-KEY-PO-NUMBER                   19060036
057265               AND VER_STATUS_CDE = 'A'                           19070036
057266               AND OPER_UNT_ID = :PV-OPER-UNT-ID                  19080036
057267               AND STATUS_CDE = 'IP'                              19090036
057268               AND CRE_TMST IN                                    19100036
057269                       (SELECT MAX(CRE_TMST)                      19110036
057270                        FROM TRECITM                              19120036
057271                        WHERE ORD_NBR = : ASC-KEY-PO-NUMBER       19130041
057272                          AND VER_STATUS_CDE = 'A'                19140036
057273                          AND OPER_UNT_ID = :PV-OPER-UNT-ID       19150036
057274                          AND STATUS_CDE = 'IP')                  19160036
057275           END-EXEC                                               19170033
057276       EVALUATE TRUE                                              19180033
057277           WHEN SQLCODE = ZERO                                    19190033
057278           WHEN SQLCODE = -305                                    19200040
057279           WHEN SQLCODE = +100                                    19210040
057280           WHEN SQLCODE = -904                                    19220040
057281           WHEN SQLCODE = -913                                    19230040
057282               CONTINUE                                           19240040
057283           WHEN SQLWARN0 NOT = SPACES                             19250040
057284           WHEN SQLCODE < ZERO                                    19260040
057285           WHEN SQLCODE > ZERO                                    19270040
057286               MOVE '5070-DETERMINE-IN-PROCESS'                   19280040
057287                                 TO DP013-PARAGRAPH               19290040
057288               MOVE 'SQL ERROR GET RCVR STATUS'                   19300040
057289                                 TO DP013-MESSAGE-TEXT (1)        19310040
057290               MOVE SQLCA        TO DP013-SQLCA                   19320040
057291               MOVE 'TRECITM'   TO DP013-DB2-TABLE-NAME (1)       19330040
057292               SET DP013-DB2-ABEND                                19340040
057293                   DP013-XCTL-DISPLAY-RESTART TO TRUE             19350040
057294               PERFORM DP013-0000-PROCESS-ABEND                   19360040
057295       END-EVALUATE                                               19370040
057296      END-PERFORM.                                                19380040
057297                                                                  19390040
057298      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       19400040
057299       MOVE '5070-DETERMINE-IN-PROCESS'                           19410040
057300                                 TO DP013-PARAGRAPH               19420040
057301       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET RCVR STATUS'  19430040
057302                                 TO DP013-MESSAGE-TEXT (1)        19440040
057303       MOVE SQLCA                TO DP013-SQLCA                   19450040
057304       MOVE 'TRECITM'           TO DP013-DB2-TABLE-NAME (1)       19460040
057305       SET DP013-DB2-ABEND                                        19470040
057306           DP013-XCTL-DISPLAY-RESTART                             19480040
057307                                 TO TRUE                          19490040
057308       PERFORM DP013-0000-PROCESS-ABEND                           19500040
057309      END-IF.                                                     19510040
057310                                                                  19520040
057311*----------------------------------------------------------------*19530040
057312*    ABEND PROCESSOR MODULE                                      *19540040
057320*----------------------------------------------------------------*19550036
057400     COPY DPPD013.                                                19560000
