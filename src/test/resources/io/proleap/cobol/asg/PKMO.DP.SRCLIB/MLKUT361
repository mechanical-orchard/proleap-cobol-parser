       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.              MLKUT361.                                       
       AUTHOR.                  JOHN SELWITSCHKA.                               
       INSTALLATION.            KOHLS DEPARTMENT STORES.                        
       DATE-WRITTEN.            06/07/2007.                                     
       DATE-COMPILED.                                                           
      ******************************************************************        
      *                                                                *        
      *  ALLOCATE UNKNOWN BRANDS.                                      *        
      *                                                                *        
      *  THIS PROGRAM WILL RE-ALLOCATE PURCHASE ADJUSTMENTS FOR UNKNOWN*        
      *  BRANDS ON THE MONTHLY DETAIL LEDGER. A FILE CONTAINING THE    *        
      *  VENDORS TO BE RE-ALLOCATED IS READ. FOR EACH VENDOR, THE      *        
      *  DEPARTMENTS AND DKEYS ARE SELECTED FROM THE BRAND RELATIONSHIP*        
      *  TABLE. FOR EACH DEPT, BRAND, VENDOR COMBINATION, PURCHASE     *        
      *  ADJUSTMENTS ARE SUMMED FOR THE PERIOD. A REVERSAL TRANSACTION *        
      *  WITH THE SUMMED PURCHASE ADJUSTMENTS IS CREATED AND WRITTEN TO*        
      *  AN OUTPUT FILE. TRANSACTIONS ARE THEN CREATED TO RE-ALLOCATE  *        
      *  THE SUMMED PURCHASE ADJUSTMENTS ACROSS ALL BRANDS FOR THAT    *        
      *  DEPARTMENT ACCORDING TO PERCENTAGES ON THE FREIGHT SALVAGE    *        
      *  AND LICENSE FEE FILES. THESE FILES ARE LOADED INTO INTERNAL   *        
      *  TABLES FOR REFERENCE.                                         *        
      *                                                                *        
      ******************** HISTORY OF CHANGES **************************        
      * CHG ID/                                                        *        
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *        
      * -------  ----------  ----------------------------------------  *        
      * WR28582  2007-06-07  INITIAL IMPLEMENTATION.                   *        
      *                      J SELWITSCHKA                             *        
      * WR34517  2008-07-22  GET FSCL-MN-END-DTE FOR PADJ CURSOR.      *        
      *                      ASSIGN ML254-FSCL-MN-END-DTE FROM         *        
      *                      DTATTR-FSCL-MN-END-DTE. MATCH ON GROUP    *        
      *                      ID FOR LICENSE FEES.                      *        
      *                      J SELWITSCHKA                             *        
      * WR34517  2009-03-02  FISCAL DATE WILL BE PASSED STARTING IN THE*        
      *                      SECOND POSITION ON THE CONTROL CARD. ESP  *        
      *                      NOT RECOGNIZING FIRST POSITION WHEN USING *        
      *                      SYMBOLICS.                                *        
      *                      J SELWITSCHKA                             *        
W37965* WR37965  02-16-2010  BRAND VENDOR TRANSACTION AND EXCEPTION    *        
W37965*                      MANAGEMENT                                *        
W37965*                      PROGRAM CHANGED TO WRITE DETAIL AUDIT FILE*        
W37965*                      FOR PURCHASE ADJUSTMENTS AND PRICE CHANGES*        
W37965*                      SURENDAR B                                *        
P18333*P18333    09-28-2012  ML PERFORMANCE TUNING FOR PEAK                     
P18333*                      REMOVED UNWANTED DISPLAYS.                         
P18333*                      COGNIZANT                                          
C53520*C53520    10-05-2016  INCREASED ARRAY LENGTH FROM 1000 TO 2000           
C53520*                      FOR PT-LICENSE-FEES-TABLE TABLE.                   
C53520*                      COGNIZANT                                          
C40810*C40810    03-05-2020  INCREASED ARRAY LENGTH FROM 20000 TO 30000         
C40810*                      FOR PT-FREIGHT-SALVAGE-TABLE                       
C40810*                      INCREASED ARRAY LENGTH FROM 2000 TO 3000           
C40810*                      FOR PT-LICENSE-FEES-TABLE TABLE.                   
C40810*                      COGNIZANT                                          
C40810******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT DATE-FILE                                                     
               ASSIGN TO INP01.                                                 
                                                                                
           SELECT FREIGHT-SALVAGE-FILE                                          
               ASSIGN TO INP02.                                                 
                                                                                
           SELECT LICENSE-FEES-FILE                                             
               ASSIGN TO INP03.                                                 
                                                                                
           SELECT VENDOR-FILE                                                   
               ASSIGN TO INP04.                                                 
                                                                                
           SELECT ADJUSTMENT-FILE                                               
               ASSIGN TO OUT01.                                                 
                                                                                
W34517     SELECT TSL-DIST-NOTFND-FILE                                          
W34517         ASSIGN TO OUT02.                                                 
W34517                                                                          
W34517     SELECT LIC-DIST-NOTFND-FILE                                          
W34517         ASSIGN TO OUT03.                                                 
W34517                                                                          
W37965     SELECT DTL-AUDIT-PADJ-FILE                                           
W37965         ASSIGN TO OUT04.                                                 
W37965     SELECT DTL-AUDIT-PCHG-FILE                                           
W37965         ASSIGN TO OUT05.                                                 
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  DATE-FILE                                                            
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
       01  DATE-REC                        PIC X(80).                           
                                                                                
       FD  FREIGHT-SALVAGE-FILE                                                 
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
W34517*01  FREIGHT-SALVAGE-REC             PIC X(150).                          
W34517 01  FREIGHT-SALVAGE-REC             PIC X(180).                          
                                                                                
       FD  LICENSE-FEES-FILE                                                    
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
W34517*01  LICENSE-FEES-REC                PIC X(150).                          
W34517 01  LICENSE-FEES-REC                PIC X(180).                          
                                                                                
       FD  VENDOR-FILE                                                          
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
       01  VENDOR-REC                      PIC X(80).                           
                                                                                
       FD  ADJUSTMENT-FILE                                                      
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
       01  ADJUSTMENT-REC                  PIC X(450).                          
                                                                                
W34517 FD  TSL-DIST-NOTFND-FILE                                                 
W34517     RECORDING MODE IS F                                                  
W34517     LABEL RECORDS ARE STANDARD                                           
W34517     BLOCK CONTAINS 0 RECORDS.                                            
W34517 01  TSL-DIST-NOTFND-REC             PIC X(80).                           
W34517                                                                          
W34517 FD  LIC-DIST-NOTFND-FILE                                                 
W34517     RECORDING MODE IS F                                                  
W34517     LABEL RECORDS ARE STANDARD                                           
W34517     BLOCK CONTAINS 0 RECORDS.                                            
W34517 01  LIC-DIST-NOTFND-REC             PIC X(80).                           
W34517                                                                          
W37965 FD  DTL-AUDIT-PADJ-FILE                                                  
W37965     RECORDING MODE IS F                                                  
W37965     LABEL RECORDS ARE STANDARD                                           
W37965     BLOCK CONTAINS 0 RECORDS.                                            
W37965 01  DTL-AUDIT-PADJ-RECORD                PIC X(200).                     
                                                                                
W37965 FD  DTL-AUDIT-PCHG-FILE                                                  
W37965     RECORDING MODE IS F                                                  
W37965     LABEL RECORDS ARE STANDARD                                           
W37965     BLOCK CONTAINS 0 RECORDS.                                            
W37965 01  DTL-AUDIT-PCHG-RECORD                PIC X(200).                     
                                                                                
       EJECT                                                                    
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** WORKING STORAGE AREA BEGIN ***'.                                
                                                                                
      *****************************************************************         
      *    CONTROL CARD                                                         
      *****************************************************************         
       01  CC-CONTROL-CARD.                                                     
W34517*    05  CC-FSCL-BEG-DTE           PIC  X(10).                            
W34517*    05  FILLER                    PIC  X(01).                            
W34517*    05  CC-FSCL-END-DTE           PIC  X(10).                            
W34517*    05  FILLER                    PIC  X(59).                            
W34517     05  FILLER                    PIC  X(01).                            
W34517     05  CC-FSCL-WK-END-DTE        PIC  X(10).                            
W34517     05  FILLER                    PIC  X(69).                            
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAMMING CONSTANT BEGIN ***'.                                
                                                                                
       01  PC-PROGRAM-CONSTANTS-AREA.                                           
           05  PC-MONTHLY-TM-LVL-CDE       PIC X           VALUE 'M'.           
           05  PC-WEEKLY-TM-LVL-CDE        PIC X           VALUE 'W'.           
           05  PC-UNKNOWN-BRAND            PIC  S9(4) COMP VALUE +2230.         
W34517     05  PC-TSL-DIST-NOTFND-HEADER   PIC X(80)       VALUE                
W34157     'TRANSPORTATION/SALVAGE DIST PCT NOT FOUND                 '.        
W34517     05  PC-LIC-DIST-NOTFND-HEADER   PIC X(80)       VALUE                
W34157     'LICENSE FEE DIST PCT NOT FOUND                            '.        
W34517     05  PC-DIST-NOTFND-HEADER       PIC X(80)       VALUE                
W34517     'DEPT    VENDOR  NAME                  PADJ RTL         PADJ         
W34517-    'NET COST    MKDN RTL'.                                              
W34517     05 PC-UNKNOWN                   PIC X(08)   VALUE '????????'.        
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAMMING SWITCHES BEGIN ***'.                                
                                                                                
       01  PS-SWITCHES-AREA.                                                    
           05  PS-END-OF-DATES             PIC X           VALUE 'N'.           
               88  END-OF-DATES                            VALUE 'Y'.           
           05  PS-FREIGHT-SALVAGE          PIC X           VALUE 'N'.           
               88  PS-FREIGHT-SALVAGE-EOF                  VALUE 'Y'.           
           05  PS-LICENSE-FEES             PIC X           VALUE 'N'.           
               88  PS-LICENSE-FEES-EOF                     VALUE 'Y'.           
           05  PS-FS-FOUND-SW              PIC X           VALUE 'N'.           
               88  PS-FS-FOUND                             VALUE 'Y'.           
               88  PS-FS-NOT-FOUND                         VALUE 'N'.           
           05  PS-LF-FOUND-SW              PIC X           VALUE 'N'.           
               88  PS-LF-FOUND                             VALUE 'Y'.           
               88  PS-LF-NOT-FOUND                         VALUE 'N'.           
           05  PS-END-OF-DEPT-CSR          PIC X           VALUE 'N'.           
               88  NOT-END-OF-DEPT-CSR                     VALUE 'N'.           
               88  END-OF-DEPT-CSR                         VALUE 'Y'.           
           05  PS-END-OF-PADJ-SUM-CSR      PIC X           VALUE 'N'.           
               88  NOT-END-OF-PADJ-SUM-CSR                 VALUE 'N'.           
               88  END-OF-PADJ-SUM-CSR                     VALUE 'Y'.           
           05  PS-END-OF-VENDORS           PIC X           VALUE 'N'.           
               88  NOT-END-OF-VENDORS                      VALUE 'N'.           
               88  END-OF-VENDORS                          VALUE 'Y'.           
W34517     05  PS-MNLY-AMTS-NOT-ZERO       PIC X           VALUE 'N'.           
W34517         88  MNLY-AMTS-NOT-ZERO                      VALUE 'N'.           
W34517         88  MNLY-AMTS-ZERO                          VALUE 'Y'.           
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** REPORT REQUEST CONTROL REC ***'.                                
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAMMING VARIABLE BEGIN ***'.                                
                                                                                
       01  PV-PROGRAM-VARIABLES-AREA.                                           
           05  PV-PREV-VENDOR-ID           PIC 9(09)       VALUE ZEROES.        
           05  PV-DEPT-NBR-9               PIC 9(03)       VALUE ZEROES.        
           05  PV-DEPT-NBR REDEFINES PV-DEPT-NBR-9                              
                                           PIC X(03).                           
           05  PV-MAJ-CL-NBR-9             PIC 9(02)       VALUE ZEROES.        
           05  PV-MAJ-CL-NBR REDEFINES PV-MAJ-CL-NBR-9                          
                                           PIC X(02).                           
           05  PV-PERCENT                  PIC 9(03)V9(2)  VALUE ZEROES.        
           05  PV-PERCENT-SIGNED           PIC S9(03)V9(2) VALUE ZEROES.        
           05  PV-FREIGHT-SALVAGE-LOADED   PIC S9(11)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-LICENSE-FEES-LOADED      PIC S9(11)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-VENDORS-READ             PIC S9(11)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-VENDORS-PROCESSED        PIC S9(11)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-VENDORS-DUPLICATES       PIC S9(11)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-FETCHED                  PIC S9(11)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TOT-FETCHED              PIC S9(13)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-FETCHED             PIC S9(11)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TOT-TRANS-WRITTEN        PIC S9(13)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-REVERSALS-WRITTEN        PIC S9(11)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-REALLOCATIONS-WRITTEN    PIC S9(13)      VALUE ZEROES         
                               COMP-3.                                          
W34517     05  PV-TOT-TSL-NOTFND-WRITTEN   PIC S9(11)      VALUE ZEROES         
W34517                         COMP-3.                                          
W34517     05  PV-TOT-LIC-NOTFND-WRITTEN   PIC S9(11)      VALUE ZEROES         
W34517                         COMP-3.                                          
W37965     05  PV-TOT-PADJ-AUDIT-WRITTEN   PIC S9(11)      VALUE ZEROES         
W37965                         COMP-3.                                          
W37965     05  PV-TOT-PCHG-AUDIT-WRITTEN   PIC S9(11)      VALUE ZEROES         
W37965                         COMP-3.                                          
           05  PV-PCT                      PIC S9(03)V9(2) VALUE ZEROES         
                               COMP-3.                                          
W34517     05  PV-LARGEST-PCT-POS          PIC S9(03)V9(2) VALUE ZEROES         
W34517                         COMP-3.                                          
W34517     05  PV-LARGEST-PCT-NEG          PIC S9(03)V9(2) VALUE ZEROES         
W34517                         COMP-3.                                          
           05  PV-PADJ-RTL-AMT             PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-FRGT-COST-AMT       PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-DISC-COST-AMT       PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-RTV-COST-AMT        PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-RTV-RTL-AMT         PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-DA-COST-AMT         PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-DA-RTL-AMT          PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-NET-COST-AMT        PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-OTH-COST-AMT        PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-OTH-RTL-AMT         PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-RTL-AMT-REM         PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-FRGT-COST-AMT-REM   PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-DISC-COST-AMT-REM   PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-RTV-COST-AMT-REM    PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-RTV-RTL-AMT-REM     PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-DA-COST-AMT-REM     PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-DA-RTL-AMT-REM      PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-NET-COST-AMT-REM    PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-OTH-COST-AMT-REM    PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PADJ-OTH-RTL-AMT-REM     PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-PLU-RTL-AMT         PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-PROMO-RTL-AMT       PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-RGST-RTL-AMT        PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-GLDST-RTL-AMT       PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-UMTCH-RTL-AMT       PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-BYR-RTL-AMT         PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-STR-RTL-AMT         PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-PRPT-RTL-AMT        PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-OTH-RTL-AMT         PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-RTL-AMT             PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-DR-ALW-RTL-AMT           PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-RTV-RTL-AMT              PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
W34517     05  PV-TOT-PADJ-RTL-AMT         PIC S9(11)V9(2) VALUE ZEROES         
W34517                         COMP-3.                                          
W34517     05  PV-TOT-PADJ-NET-COST-AMT    PIC S9(11)V9(2) VALUE ZEROES         
W34517                         COMP-3.                                          
W34517     05  PV-TOT-MKDN-RTL-AMT         PIC S9(11)V9(2) VALUE ZEROES         
W34517                         COMP-3.                                          
           05  PV-MKDN-PLU-RTL-AMT-REM     PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-PROMO-RTL-AMT-REM   PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-RGST-RTL-AMT-REM    PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-GLDST-RTL-AMT-REM   PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-UMTCH-RTL-AMT-REM   PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-BYR-RTL-AMT-REM     PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-STR-RTL-AMT-REM     PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-PRPT-RTL-AMT-REM    PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-OTH-RTL-AMT-REM     PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-MKDN-RTL-AMT-REM         PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-DR-ALW-RTL-AMT-REM       PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-RTV-RTL-AMT-REM          PIC S9(11)V9(2) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-DISPLAY-AMT              PIC ----------9.99.                  
           05  PV-OPER-ATTEMPTED           PIC X(25)       VALUE SPACES.        
           05  PV-PARAGRAPH-NAME           PIC X(30)       VALUE SPACES.        
           05  PV-SQLCODE                  PIC -999        VALUE ZEROES.        
           05  PV-PROCESSING-DATE          PIC X(10)       VALUE SPACES.        
           05  PV-PROCESSING-DATE-RDF REDEFINES PV-PROCESSING-DATE.             
               10  PV-PROCESSING-CC        PIC X(02).                           
               10  PV-PROCESSING-YY        PIC X(02).                           
               10  PV-PROC-DSH1            PIC X(01).                           
               10  PV-PROCESSING-MM        PIC X(02).                           
               10  PV-PROC-DSH2            PIC X(01).                           
               10  PV-PROCESSING-DD        PIC X(02).                           
           05  PV-TODAYS-DATE.                                                  
               10  PV-TODAYS-DATE-YY       PIC 9(02)       VALUE ZEROES.        
               10  PV-TODAYS-DATE-MM       PIC 9(02)       VALUE ZEROES.        
               10  PV-TODAYS-DATE-DD       PIC 9(02)       VALUE ZEROES.        
           05  PV-TODAYS-TIME.                                                  
               10  PV-TODAYS-TIME-HR       PIC 9(02)       VALUE ZEROES.        
               10  PV-TODAYS-TIME-MIN      PIC 9(02)       VALUE ZEROES.        
               10  PV-TODAYS-TIME-SEC      PIC 9(02)       VALUE ZEROES.        
               10  FILLER                  PIC 9(02)       VALUE ZEROES.        
W34517     05  PV-LARGEST-LBL-SEQ-POS      PIC S9(04) COMP VALUE +0.            
W34517     05  PV-LARGEST-ENT-ID-POS       PIC S9(09) COMP VALUE +0.            
W34517     05  PV-LARGEST-DKEY-POS         PIC S9(09) COMP VALUE +0.            
W34517     05  PV-LARGEST-LBL-SEQ-NEG      PIC S9(04) COMP VALUE +0.            
W34517     05  PV-LARGEST-ENT-ID-NEG       PIC S9(09) COMP VALUE +0.            
W34517     05  PV-LARGEST-DKEY-NEG         PIC S9(09) COMP VALUE +0.            
W37965*01  MLRD-VENDOR-REC.                                                     
W37965*    05  MLRD-VENDOR-ID              PIC 9(09)       VALUE ZEROES.        
W37965*    05  MLRD-VENDOR-TYPE            PIC X(01)       VALUE SPACE.         
W37965*    05  FILLER                      PIC X(01)       VALUE SPACE.         
W37965*    05  MLRD-GROUP-ID               PIC 9(04)       VALUE ZEROS.         
W37965*    05  FILLER                      PIC X(65)       VALUE SPACE.         
                                                                                
       01  MLRD-FREIGHT-SALVAGE-REC.                                            
W34517     05  MLRD-FS-DIST-TYPE           PIC 9(01) VALUE ZEROS.               
W34517     05  FILLER                      PIC X(01).                           
           05  MLRD-FS-DEPT-NBR            PIC 9(03) VALUE ZEROS.               
           05  FILLER                      PIC X(01).                           
W34517     05  MLRD-FS-GROUP-ID            PIC 9(04) VALUE ZEROS.               
W34517     05  FILLER                      PIC X(01).                           
           05  MLRD-FS-LABEL-SEQ           PIC 9(10) VALUE ZEROS.               
           05  FILLER                      PIC X(01).                           
           05  MLRD-FS-ENT-ID              PIC 9(10) VALUE ZEROS.               
           05  FILLER                      PIC X(01).                           
           05  MLRD-FS-MKDN-BYR-RTL-PCT    PIC X(08).                           
           05  FILLER                      PIC X(01).                           
           05  MLRD-FS-RCPT-GRO-COST-PCT   PIC X(08).                           
           05  FILLER                      PIC X(01).                           
           05  MLRD-FS-DIST-PCT            PIC X(08).                           
           05  FILLER                      PIC X(01).                           
           05  MLRD-FS-DKEY                PIC 9(10) VALUE ZEROS.               
           05  FILLER                      PIC X(01).                           
           05  MLRD-FS-DEPT-LAST           PIC X(01) VALUE SPACE.               
                                                                                
       01  MLRD-LICENSE-FEES-REC.                                               
W34517     05  MLRD-LF-DIST-TYPE           PIC 9(01) VALUE ZEROS.               
W34517     05  FILLER                      PIC X(01).                           
           05  MLRD-LF-DEPT-NBR            PIC 9(03) VALUE ZEROS.               
           05  FILLER                      PIC X(01).                           
W34517     05  MLRD-LF-GROUP-ID            PIC 9(04) VALUE ZEROS.               
W34517     05  FILLER                      PIC X(01).                           
           05  MLRD-LF-LABEL-SEQ           PIC 9(10) VALUE ZEROS.               
           05  FILLER                      PIC X(01).                           
           05  MLRD-LF-ENT-ID              PIC 9(10) VALUE ZEROS.               
           05  FILLER                      PIC X(01).                           
           05  MLRD-LF-MKDN-BYR-RTL-PCT    PIC X(08).                           
           05  FILLER                      PIC X(01).                           
           05  MLRD-LF-RCPT-GRO-COST-PCT   PIC X(08).                           
           05  FILLER                      PIC X(01).                           
           05  MLRD-LF-DIST-PCT            PIC X(08).                           
           05  FILLER                      PIC X(01).                           
           05  MLRD-LF-DKEY                PIC 9(10) VALUE ZEROS.               
           05  FILLER                      PIC X(01).                           
           05  MLRD-LF-DEPT-LAST           PIC X(01) VALUE SPACE.               
                                                                                
       01  PT-FREIGHT-SALVAGE-TABLE.                                            
C40810     05  PT-FS-INDX-MAX              PIC S9(05)      VALUE +30000.        
C40810     05  PT-FREIGHT-SALVAGE OCCURS 30000 TIMES                            
                                           INDEXED BY PT-FS-INDX                
                                                      PT-FS-INDX-BEG            
                                                      PT-FS-INDX-TOT.           
               10  PT-FS-DEPT-NBR          PIC S9(04) COMP-3 VALUE +0.          
               10  PT-FS-LABEL-SEQ         PIC S9(04) COMP   VALUE +0.          
               10  PT-FS-ENT-ID            PIC S9(09) COMP   VALUE +0.          
               10  PT-FS-RCPT-GRO-COST-PCT PIC S9(03)V9(2)                      
                                                      COMP-3 VALUE +0.          
               10  PT-FS-MKDN-BYR-RTL-PCT  PIC S9(03)V9(2)                      
                                                      COMP-3 VALUE +0.          
               10  PT-FS-DKEY              PIC S9(09) COMP   VALUE +0.          
               10  PT-FS-DEPT-LAST         PIC X(01)        VALUE SPACE.        
                                                                                
       01  PT-LICENSE-FEES-TABLE.                                               
C40810     05  PT-LF-INDX-MAX              PIC S9(05)      VALUE +3000.         
C40810     05  PT-LICENSE-FEES OCCURS 3000 TIMES                                
                                           INDEXED BY PT-LF-INDX                
                                                      PT-LF-INDX-BEG            
                                                      PT-LF-INDX-TOT.           
W34517         10  PT-LF-GROUP-ID          PIC  9(04)        VALUE  0.          
               10  PT-LF-DEPT-NBR          PIC S9(04) COMP-3 VALUE +0.          
               10  PT-LF-LABEL-SEQ         PIC S9(04) COMP   VALUE +0.          
               10  PT-LF-ENT-ID            PIC S9(09) COMP   VALUE +0.          
               10  PT-LF-DIST-PCT          PIC S9(03)V9(2)                      
                                                      COMP-3 VALUE +0.          
               10  PT-LF-DKEY              PIC S9(09) COMP   VALUE +0.          
               10  PT-LF-DEPT-LAST         PIC X(01)        VALUE SPACE.        
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** SQL WORK AREA BEGIN ***'.                                       
                                                                                
      *****************************************************************         
      *  SQL ABEND ROUTINE WORKING STORAGE                                      
      *****************************************************************         
      *01  DP004-DB2-ERROR-FIELDS.                                              
           COPY DPWS004.                                                        
                                                                                
       01  ABEND-CODE                      PIC S9(04)      VALUE ZEROES         
                               COMP SYNC.                                       
           88  ABEND-4003                                  VALUE +4003.         
                                                                                
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
      *---------------------------------------------------------------*         
      *    MLT_PARTN_BAL  - ML'S PARTITION BALANCE TABLE              *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
               INCLUDE MLT00002                                                 
           END-EXEC.                                                            
                                                                                
      *---------------------------------------------------------------*         
      *    MLT_PARTN_CNTL - ML'S PARTITION CONTROL TABLE              *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
               INCLUDE MLT00003                                                 
           END-EXEC.                                                            
                                                                                
      *---------------------------------------------------------------*         
      *    MLT_MNLY_SUM - MONTHLY SUMMARY TABLE                       *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
               INCLUDE MLT00004                                                 
           END-EXEC.                                                            
                                                                                
      *---------------------------------------------------------------*         
      *    MLV_BRND_VND TABLE                                         *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
               INCLUDE MLV00000                                                 
           END-EXEC.                                                            
                                                                                
      *---------------------------------------------------------------*         
      *    DATE ATTRIBUTE TABLE                                       *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
               INCLUDE TDTATTR                                                  
           END-EXEC.                                                            
                                                                                
W34517*---------------------------------------------------------------*         
W34517*    DB2 XMT_VND (GET VENDOR NAME)                              *         
W34517*---------------------------------------------------------------*         
W34517     EXEC SQL                                                             
W34517         INCLUDE XMT00000                                                 
W34517     END-EXEC.                                                            
W34517                                                                          
W34517*---------------------------------------------------------------*         
W34517*    ML TRANS, SALVALGE, LICENSE FEES NOT FOUND COPYBOOK        *         
W34517*---------------------------------------------------------------*         
W34517     COPY MLRD084.                                                        
W34517                                                                          
      *---------------------------------------------------------------*         
      *    DETAILED MERCH LEDGER UPDATE TRANSACTION COPYBOOK          *         
      *---------------------------------------------------------------*         
           COPY MLRD254.                                                        
W37965*---------------------------------------------------------------*         
W37965*    DETAIL AUDIT RECORD LAYOUT                                 *         
W37965*---------------------------------------------------------------*         
W37965     COPY MLRD090.                                                        
W37965*---------------------------------------------------------------*         
W37965*    EXPENSE VENDOR RECORD LAYOUT                               *         
W37965*---------------------------------------------------------------*         
W37965     COPY MLRD363.                                                        
      *---------------------------------------------------------------*         
      *    DEPT_CSR CURSOR                                            *         
      *---------------------------------------------------------------*         
                                                                                
           EXEC SQL   DECLARE DEPT_CSR CURSOR FOR                               
               SELECT ML_LO_MDSE_LVL_ID                                         
                     ,DEPT_NBR                                                  
                     ,LBL_SEQ_NBR                                               
                     ,ENT_ID                                                    
                     ,EFF_BEG_DTE                                               
                     ,EFF_END_DTE                                               
               FROM  MLV_BRND_VND                                               
               WHERE ENT_ID      = :MLV00000-ENT-ID                             
                 AND LBL_SEQ_NBR = :PC-UNKNOWN-BRAND                            
W34517          WITH UR                                                         
           END-EXEC.                                                            
                                                                                
      *---------------------------------------------------------------*         
      *    PADJ_SUM_CSR CURSOR                                        *         
      *---------------------------------------------------------------*         
                                                                                
           EXEC SQL   DECLARE PADJ_SUM_CSR CURSOR FOR                           
               SELECT DEPT_NBR                                                  
                     ,MAJ_CL_NBR                                                
                     ,SUB_CL_NBR                                                
                     ,LOC_NBR                                                   
                     ,ML_LO_MDSE_LVL_ID                                         
                     ,VALUE(SUM(PADJ_RTL_AMT),0)                                
                     ,VALUE(SUM(PADJ_FRGT_COST_AMT),0)                          
                     ,VALUE(SUM(PADJ_DISC_COST_AMT),0)                          
                     ,VALUE(SUM(PADJ_RTV_COST_AMT),0)                           
                     ,VALUE(SUM(PADJ_RTV_RTL_AMT),0)                            
                     ,VALUE(SUM(PADJ_DA_COST_AMT),0)                            
                     ,VALUE(SUM(PADJ_DA_RTL_AMT),0)                             
                     ,VALUE(SUM(PADJ_NET_COST_AMT),0)                           
                     ,VALUE(SUM(PADJ_OTH_COST_AMT),0)                           
                     ,VALUE(SUM(PADJ_OTH_RTL_AMT),0)                            
                     ,VALUE(SUM(MKDN_PLU_RTL_AMT),0)                            
                     ,VALUE(SUM(MKDN_PROMO_RTL_AMT),0)                          
                     ,VALUE(SUM(MKDN_RGST_RTL_AMT ),0)                          
                     ,VALUE(SUM(MKDN_GLDST_RTL_AMT),0)                          
                     ,VALUE(SUM(MKDN_UMTCH_RTL_AMT),0)                          
                     ,VALUE(SUM(MKDN_BYR_RTL_AMT),0)                            
                     ,VALUE(SUM(MKDN_STR_RTL_AMT),0)                            
                     ,VALUE(SUM(MKDN_PRPT_RTL_AMT),0)                           
                     ,VALUE(SUM(MKDN_OTH_RTL_AMT),0)                            
                     ,VALUE(SUM(MKDN_RTL_AMT),0)                                
                     ,VALUE(SUM(DR_ALW_RTL_AMT),0)                              
                     ,VALUE(SUM(RTV_RTL_AMT),0)                                 
               FROM MLT_MNLY_SUM                                                
               WHERE PARTN_NBR IN                                               
                        (SELECT PARTN_NBR                                       
                           FROM MLT_PARTN_CNTL                                  
                          WHERE TBL_TM_LVL_CDE = :PC-MONTHLY-TM-LVL-CDE         
W34517*                     AND FSCL_DTE BETWEEN :CC-FSCL-BEG-DTE               
W34517                      AND FSCL_DTE BETWEEN :DTATTR-FSCL-MN-BEG-DTE        
                                            AND :DTATTR-FSCL-MN-END-DTE)        
                 AND DEPT_NBR          = :MLT00004-DEPT-NBR                     
                 AND ML_LO_MDSE_LVL_ID = :MLT00004-ML-LO-MDSE-LVL-ID            
               GROUP BY DEPT_NBR                                                
                       ,MAJ_CL_NBR                                              
                       ,SUB_CL_NBR                                              
                       ,LOC_NBR                                                 
                       ,ML_LO_MDSE_LVL_ID                                       
W34517          WITH UR                                                         
           END-EXEC.                                                            
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** WORKING STORAGE END ***'.                                       
                                                                                
       EJECT                                                                    
       PROCEDURE DIVISION.                                                      
                                                                                
       A100-MAIN-MODULE.                                                        
      ******************************************************************        
      *  MAIN PROCESSING.                                                       
      ******************************************************************        
           PERFORM B100-HOUSEKEEPING.                                           
                                                                                
           PERFORM Z100-READ-VENDOR.                                            
           PERFORM B200-PROCESS-VENDORS                                         
               UNTIL END-OF-VENDORS.                                            
                                                                                
           PERFORM B900-FINALIZE.                                               
                                                                                
           STOP RUN.                                                            
                                                                                
      ******************************************************************        
      * GET THE SYSTEM DATE AND TIME. OPEN FILES. READ CONTROL CARD.            
      * LOAD INTERNAL TABLES.                                                   
      ******************************************************************        
       B100-HOUSEKEEPING.                                                       
           INITIALIZE ML254-UPDATE-REC.                                         
           ACCEPT PV-TODAYS-DATE FROM DATE.                                     
           ACCEPT PV-TODAYS-TIME FROM TIME.                                     
                                                                                
           MOVE PV-TODAYS-DATE-YY TO PV-PROCESSING-YY.                          
           MOVE PV-TODAYS-DATE-MM TO PV-PROCESSING-MM.                          
           MOVE PV-TODAYS-DATE-DD TO PV-PROCESSING-DD.                          
                                                                                
           MOVE '-' TO PV-PROC-DSH1.                                            
           MOVE '-' TO PV-PROC-DSH2.                                            
                                                                                
           IF PV-TODAYS-DATE-YY > '80'                                          
               MOVE '19' TO PV-PROCESSING-CC                                    
           ELSE                                                                 
               MOVE '20' TO PV-PROCESSING-CC                                    
           END-IF.                                                              
                                                                                
           OPEN INPUT  DATE-FILE                                                
                       FREIGHT-SALVAGE-FILE                                     
                       LICENSE-FEES-FILE                                        
                       VENDOR-FILE.                                             
           OPEN OUTPUT ADJUSTMENT-FILE                                          
W34517                 TSL-DIST-NOTFND-FILE                                     
W34517                 LIC-DIST-NOTFND-FILE                                     
W37965                 DTL-AUDIT-PADJ-FILE                                      
W37965                 DTL-AUDIT-PCHG-FILE.                                     
                                                                                
           PERFORM C100-PROCESS-RQ-CNTL.                                        
                                                                                
           PERFORM Z110-READ-FREIGHT-SALVAGE.                                   
           PERFORM B110-LOAD-FREIGHT-SALVAGE                                    
             VARYING PT-FS-INDX FROM 1 BY 1                                     
               UNTIL PS-FREIGHT-SALVAGE-EOF                                     
                  OR PT-FS-INDX > PT-FS-INDX-MAX.                               
           IF PT-FS-INDX > PT-FS-INDX-MAX                                       
               DISPLAY ' **** NUMBER OF FREIGHT SALVAGE EXCEEDED'               
               DISPLAY ' **** CHECK INTERNAL WORKING STORAGE TABLE'             
               DISPLAY ' **** DEFINED SIZE: ' PT-FS-INDX-MAX                    
               PERFORM Z999-ABEND                                               
           END-IF.                                                              
           SET PT-FS-INDX-TOT TO PT-FS-INDX.                                    
                                                                                
           PERFORM Z120-READ-LICENSE-FEES                                       
           PERFORM B120-LOAD-LICENSE-FEES                                       
             VARYING PT-LF-INDX FROM 1 BY 1                                     
               UNTIL PS-LICENSE-FEES-EOF                                        
                  OR PT-LF-INDX > PT-LF-INDX-MAX.                               
           IF PT-LF-INDX > PT-LF-INDX-MAX                                       
               DISPLAY ' **** NUMBER OF LICENSE FEES EXCEEDED'                  
               DISPLAY ' **** CHECK INTERNAL WORKING STORAGE TABLE'             
               DISPLAY ' **** DEFINED SIZE: ' PT-LF-INDX-MAX                    
               PERFORM Z999-ABEND                                               
           END-IF.                                                              
           SET PT-LF-INDX-TOT TO PT-LF-INDX.                                    
                                                                                
W34517     MOVE CC-FSCL-WK-END-DTE         TO DTATTR-KY-DTE.                    
W34517     PERFORM B130-GET-MN-END-DTE.                                         
W34517                                                                          
      ******************************************************************        
      *    LOAD FREIGHT SALVAGE INTERNAL TABLE                                  
      ******************************************************************        
       B110-LOAD-FREIGHT-SALVAGE.                                               
                                                                                
           MOVE MLRD-FS-DEPT-NBR                                                
             TO PT-FS-DEPT-NBR          (PT-FS-INDX).                           
           MOVE MLRD-FS-LABEL-SEQ                                               
             TO PT-FS-LABEL-SEQ         (PT-FS-INDX).                           
           MOVE MLRD-FS-ENT-ID                                                  
             TO PT-FS-ENT-ID            (PT-FS-INDX).                           
           MOVE MLRD-FS-RCPT-GRO-COST-PCT (3:3)                                 
             TO PV-PERCENT (1:3)                                                
           MOVE MLRD-FS-RCPT-GRO-COST-PCT (7:2)                                 
             TO PV-PERCENT (4:2)                                                
           IF MLRD-FS-RCPT-GRO-COST-PCT (1:1) = '-'                             
               COMPUTE PV-PERCENT-SIGNED = PV-PERCENT * -1                      
               MOVE PV-PERCENT-SIGNED                                           
                 TO PT-FS-RCPT-GRO-COST-PCT (PT-FS-INDX)                        
           ELSE                                                                 
               MOVE PV-PERCENT                                                  
                 TO PT-FS-RCPT-GRO-COST-PCT (PT-FS-INDX)                        
           END-IF                                                               
           MOVE MLRD-FS-MKDN-BYR-RTL-PCT (3:3)                                  
             TO PV-PERCENT (1:3)                                                
           MOVE MLRD-FS-MKDN-BYR-RTL-PCT (7:2)                                  
             TO PV-PERCENT (4:2)                                                
           IF MLRD-FS-MKDN-BYR-RTL-PCT (1:1) = '-'                              
               COMPUTE PV-PERCENT-SIGNED = PV-PERCENT * -1                      
               MOVE PV-PERCENT-SIGNED                                           
                 TO PT-FS-MKDN-BYR-RTL-PCT  (PT-FS-INDX)                        
           ELSE                                                                 
               MOVE PV-PERCENT                                                  
                 TO PT-FS-MKDN-BYR-RTL-PCT  (PT-FS-INDX)                        
           END-IF                                                               
           MOVE MLRD-FS-DEPT-LAST                                               
             TO PT-FS-DEPT-LAST         (PT-FS-INDX).                           
           MOVE MLRD-FS-DKEY (2:9)                                              
             TO PT-FS-DKEY              (PT-FS-INDX).                           
           ADD 1 TO PV-FREIGHT-SALVAGE-LOADED.                                  
                                                                                
           PERFORM Z110-READ-FREIGHT-SALVAGE.                                   
                                                                                
      ******************************************************************        
      *    LOAD LICENSE FEES INTERNAL TABLE                                     
      ******************************************************************        
       B120-LOAD-LICENSE-FEES.                                                  
                                                                                
           MOVE MLRD-LF-DEPT-NBR                                                
             TO PT-LF-DEPT-NBR          (PT-LF-INDX).                           
W34517     MOVE MLRD-LF-GROUP-ID                                                
W34517       TO PT-LF-GROUP-ID          (PT-LF-INDX).                           
           MOVE MLRD-LF-LABEL-SEQ                                               
             TO PT-LF-LABEL-SEQ         (PT-LF-INDX).                           
           MOVE MLRD-LF-ENT-ID                                                  
             TO PT-LF-ENT-ID            (PT-LF-INDX).                           
           MOVE MLRD-LF-DIST-PCT          (3:3)                                 
             TO PV-PERCENT (1:3)                                                
           MOVE MLRD-LF-DIST-PCT          (7:2)                                 
             TO PV-PERCENT (4:2)                                                
           IF MLRD-LF-DIST-PCT          (1:1) = '-'                             
               COMPUTE PV-PERCENT-SIGNED = PV-PERCENT * -1                      
               MOVE PV-PERCENT-SIGNED                                           
                 TO PT-LF-DIST-PCT          (PT-LF-INDX)                        
           ELSE                                                                 
               MOVE PV-PERCENT                                                  
                 TO PT-LF-DIST-PCT          (PT-LF-INDX)                        
           END-IF                                                               
           MOVE MLRD-LF-DEPT-LAST                                               
             TO PT-LF-DEPT-LAST         (PT-LF-INDX).                           
           MOVE MLRD-LF-DKEY (2:9)                                              
             TO PT-LF-DKEY              (PT-LF-INDX).                           
           ADD 1 TO PV-LICENSE-FEES-LOADED.                                     
                                                                                
           PERFORM Z120-READ-LICENSE-FEES.                                      
                                                                                
W34517******************************************************************        
W34517*  GET THE MONTH END FISCAL DATE FOR A DATE                               
W34517******************************************************************        
W34517 B130-GET-MN-END-DTE.                                                     
W34517                                                                          
W34517     EXEC SQL                                                             
W34517         SELECT                                                           
W34517                 FSCL_MN_NBR                                              
W34517                ,FSCL_WK_NBR                                              
W34517                ,PFM_END_DTE                                              
W34517                ,PFW_END_DTE                                              
W34517                ,FSCL_MN_BEG_DTE                                          
W34517                ,FSCL_MN_END_DTE                                          
W34517                ,FSCL_WK_END_DTE                                          
W34517                ,SEA_END_DTE                                              
W34517           INTO                                                           
W34517                 :DTATTR-FSCL-MN-NBR                                      
W34517                ,:DTATTR-FSCL-WK-NBR                                      
W34517                ,:DTATTR-PFM-END-DTE                                      
W34517                ,:DTATTR-PFW-END-DTE                                      
W34517                ,:DTATTR-FSCL-MN-BEG-DTE                                  
W34517                ,:DTATTR-FSCL-MN-END-DTE                                  
W34517                ,:DTATTR-FSCL-WK-END-DTE                                  
W34517                ,:DTATTR-SEA-END-DTE                                      
W34517           FROM                                                           
W34517                 TDTATTR                                                  
W34517           WHERE                                                          
W34517                 KY_DTE = :DTATTR-KY-DTE                                  
W34517         WITH UR                                                          
W34517     END-EXEC.                                                            
W34517                                                                          
W34517     EVALUATE SQLCODE                                                     
W34517         WHEN +0                                                          
W34517             CONTINUE                                                     
W34517         WHEN +100                                                        
W34517             DISPLAY ' FISCAL DATE: ' DTATTR-KY-DTE                       
W34517             MOVE 'SELECT TDTATTR'       TO PV-OPER-ATTEMPTED             
W34517             MOVE 'B130-GET-MN-END-DTE ' TO PV-PARAGRAPH-NAME             
W34517             PERFORM Z950-SQL-ABEND                                       
W34517         WHEN OTHER                                                       
W34517             DISPLAY ' FISCAL DATE: ' DTATTR-KY-DTE                       
W34517             MOVE 'SELECT TDTATTR'       TO PV-OPER-ATTEMPTED             
W34517             MOVE 'B130-GET-MN-END-DTE ' TO PV-PARAGRAPH-NAME             
W34517             PERFORM Z950-SQL-ABEND                                       
W34517     END-EVALUATE.                                                        
W34517                                                                          
W34517     DISPLAY ' '.                                                         
W34517     DISPLAY 'FISCAL BEG DATE: ' DTATTR-FSCL-MN-BEG-DTE                   
W34517     DISPLAY 'FISCAL END DATE: ' CC-FSCL-WK-END-DTE                       
W34517     DISPLAY ' '.                                                         
W34517                                                                          
      ******************************************************************        
      *    PROCESS VENDORS                                                      
      ******************************************************************        
       B200-PROCESS-VENDORS.                                                    
W37965     IF ML363-ENT-ID NOT = PV-PREV-VENDOR-ID                              
W37965         MOVE ML363-ENT-ID TO MLV00000-ENT-ID                             
               PERFORM Z170-OPEN-DEPT-CSR                                       
               MOVE ZEROES         TO PV-FETCHED                                
                                                                                
               PERFORM Z180-FETCH-DEPT-CSR                                      
                                                                                
               IF END-OF-DEPT-CSR                                               
                   DISPLAY                                                      
                       'VENDOR, UNKNOWN BRAND NOT FOUND ON MLV_BRND_VND'        
                   DISPLAY 'VENDOR: ' MLV00000-ENT-ID                           
                   DISPLAY 'BRAND : ' PC-UNKNOWN-BRAND                          
               END-IF                                                           
                                                                                
               PERFORM B300-PROCESS-DEPT-CSR                                    
                   UNTIL END-OF-DEPT-CSR                                        
                                                                                
               DISPLAY ' FETCHED  ' PV-FETCHED                                  
                       ' ROWS FOR VENDOR    ' MLV00000-ENT-ID                   
                                                                                
               PERFORM Z190-CLOSE-DEPT-CSR                                      
               ADD 1 TO PV-VENDORS-PROCESSED                                    
           ELSE                                                                 
               ADD 1 TO PV-VENDORS-DUPLICATES                                   
           END-IF.                                                              
                                                                                
W37965     MOVE ML363-ENT-ID TO PV-PREV-VENDOR-ID.                              
           PERFORM Z100-READ-VENDOR.                                            
                                                                                
      ******************************************************************        
      *    PROCESS DEPARTMENTS                                                  
      ******************************************************************        
       B300-PROCESS-DEPT-CSR.                                                   
           SET PS-FS-NOT-FOUND TO TRUE.                                         
           SET PS-LF-NOT-FOUND TO TRUE.                                         
                                                                                
           EVALUATE TRUE                                                        
W37965       WHEN ML363-EXP-TYP = 1 OR 2                                        
               SET PT-FS-INDX TO 1                                              
               SEARCH PT-FREIGHT-SALVAGE                                        
                VARYING PT-FS-INDX                                              
                  WHEN PT-FS-DEPT-NBR (PT-FS-INDX) =                            
                       MLV00000-DEPT-NBR                                        
                    MOVE PT-FS-DEPT-NBR (PT-FS-INDX)                            
                      TO PV-DEPT-NBR                                            
                    SET PT-FS-INDX-BEG TO PT-FS-INDX                            
                    SET PS-FS-FOUND    TO TRUE                                  
               END-SEARCH                                                       
W37965       WHEN ML363-EXP-TYP = 3                                             
               SET PT-LF-INDX TO 1                                              
               SEARCH PT-LICENSE-FEES                                           
                VARYING PT-LF-INDX                                              
                  WHEN PT-LF-DEPT-NBR (PT-LF-INDX) =                            
                       MLV00000-DEPT-NBR AND                                    
W34517                 PT-LF-GROUP-ID (PT-LF-INDX) =                            
W37965                 ML363-GRP-ID                                             
                    MOVE PT-LF-DEPT-NBR (PT-LF-INDX)                            
                      TO PV-DEPT-NBR                                            
                    SET PT-LF-INDX-BEG TO PT-LF-INDX                            
                    SET PS-LF-FOUND    TO TRUE                                  
               END-SEARCH                                                       
           END-EVALUATE.                                                        
                                                                                
W34517*    IF PS-FS-FOUND OR PS-LF-FOUND                                        
W34517*        PERFORM B310-PROCESS-PADJ-SUMS                                   
W34517*    ELSE                                                                 
W37965*        IF ML363-EXP-TYP = 1 OR 2                                        
W34517*            DISPLAY 'FREIGHT/SALVAGE ALLOCATION NOT FOUND FOR: '         
W34517*        ELSE                                                             
W34517*            DISPLAY 'LICENSE FEES ALLOCATION NOT FOUND FOR: '            
W34517*        END-IF                                                           
W34517*        DISPLAY 'DEPT_NBR         : ' MLV00000-DEPT-NBR                  
W34517*        DISPLAY 'LBL_SEQ_NBR      : ' MLV00000-LBL-SEQ-NBR               
W34517*        DISPLAY 'ENT_ID           : ' MLV00000-ENT-ID                    
W34517*        DISPLAY 'ML_LO_MDSE_LVL_ID: ' MLV00000-ML-LO-MDSE-LVL-ID         
W34517*    END-IF.                                                              
W34517     PERFORM B310-PROCESS-PADJ-SUMS.                                      
                                                                                
           PERFORM Z180-FETCH-DEPT-CSR.                                         
                                                                                
      ******************************************************************        
      *    PROCESS PURCHASE ADJUSTMENT SUMS                                     
      ******************************************************************        
       B310-PROCESS-PADJ-SUMS.                                                  
           INITIALIZE DCLMLT00004.                                              
                                                                                
           MOVE MLV00000-DEPT-NBR          TO MLT00004-DEPT-NBR                 
           MOVE MLV00000-ML-LO-MDSE-LVL-ID TO MLT00004-ML-LO-MDSE-LVL-ID        
W34517     SET MNLY-AMTS-NOT-ZERO TO TRUE.                                      
           PERFORM Z200-OPEN-PADJ-SUM-CSR.                                      
           PERFORM Z210-FETCH-PADJ-SUM-CSR.                                     
W34517*    PERFORM B320-REVERSE-REALLOCATE                                      
W34517*      UNTIL END-OF-PADJ-SUM-CSR.                                         
W34517     IF NOT-END-OF-PADJ-SUM-CSR                                           
W34517         IF PS-FS-FOUND OR PS-LF-FOUND                                    
W34517             PERFORM B320-REVERSE-REALLOCATE                              
W34517               UNTIL END-OF-PADJ-SUM-CSR                                  
W34517         ELSE                                                             
W37965             IF ML363-EXP-TYP = 1 OR 2                                    
W34517                 IF MLT00004-PADJ-RTL-AMT  NOT = ZEROES OR                
W34517                    MLT00004-PADJ-NET-COST-AMT NOT = ZEROES OR            
W34517                    MLT00004-MKDN-RTL-AMT  NOT = ZEROES                   
W34517                     PERFORM Z320-WRITE-TSL-DIST-NOTFND                   
W34517                 END-IF                                                   
W34517                 DISPLAY                                                  
W34517                     'FREIGHT/SALVAGE ALLOCATION NOT FOUND FOR: '         
W34517             ELSE                                                         
W34517                 IF MLT00004-PADJ-RTL-AMT  NOT = ZEROES OR                
W34517                    MLT00004-PADJ-NET-COST-AMT NOT = ZEROES OR            
W34517                    MLT00004-MKDN-RTL-AMT  NOT = ZEROES                   
W34517                     PERFORM Z330-WRITE-LIC-DIST-NOTFND                   
W34517                 END-IF                                                   
W34517                 DISPLAY 'LICENSE FEES ALLOCATION NOT FOUND FOR: '        
W34517             END-IF                                                       
W34517             DISPLAY 'DEPT_NBR         : ' MLV00000-DEPT-NBR              
W34517             DISPLAY 'ENT_ID           : ' MLV00000-ENT-ID                
W34517             DISPLAY 'LBL_SEQ_NBR      : ' MLV00000-LBL-SEQ-NBR           
W37965             DISPLAY 'GROUP ID         : ' ML363-GRP-ID                   
W34517             DISPLAY                                                      
W34517                 'ML_LO_MDSE_LVL_ID: ' MLV00000-ML-LO-MDSE-LVL-ID         
W34517         END-IF                                                           
W34517     END-IF.                                                              
                                                                                
           PERFORM Z220-CLOSE-PADJ-SUM-CSR.                                     
                                                                                
      ******************************************************************        
      *    CREATE UNKNOWN BRAND REVERSAL TRANSACTION. CREATE                    
      *    RE-ALLOCATION TRANSACTIONS.                                          
      ******************************************************************        
       B320-REVERSE-REALLOCATE.                                                 
W34517*    COMPUTE ML254-PADJ-FRGT-COST-AMT    =                                
W34517*            MLT00004-PADJ-FRGT-COST-AMT * -1                             
W34517*    COMPUTE ML254-PADJ-DISC-COST-AMT    =                                
W34517*            MLT00004-PADJ-DISC-COST-AMT * -1                             
W34517*    COMPUTE ML254-PADJ-RTV-COST-AMT     =                                
W34517*            MLT00004-PADJ-RTV-COST-AMT  * -1                             
W34517*    COMPUTE ML254-PADJ-DA-COST-AMT      =                                
W34517*            MLT00004-PADJ-DA-COST-AMT   * -1                             
W34517*    COMPUTE ML254-PADJ-NET-COST-AMT     =                                
W34517*            MLT00004-PADJ-NET-COST-AMT  * -1                             
W34517*    COMPUTE ML254-PADJ-OTH-COST-AMT     =                                
W34517*            MLT00004-PADJ-OTH-COST-AMT  * -1                             
W34517*    IF ML363-EXP-TYP = 2                                                 
W34517*        COMPUTE ML254-PADJ-RTL-AMT          =                            
W34517*                MLT00004-PADJ-RTL-AMT       * -1                         
W34517*        COMPUTE ML254-PADJ-RTV-RTL-AMT      =                            
W34517*                MLT00004-PADJ-RTV-RTL-AMT   * -1                         
W34517*        COMPUTE ML254-PADJ-DA-RTL-AMT       =                            
W34517*                MLT00004-PADJ-DA-RTL-AMT    * -1                         
W34517*        COMPUTE ML254-PADJ-OTH-RTL-AMT      =                            
W34517*                MLT00004-PADJ-OTH-RTL-AMT   * -1                         
W34517*        COMPUTE ML254-MKDN-RTL-AMT          =                            
W34517*                MLT00004-MKDN-RTL-AMT       * -1                         
W34517*        COMPUTE ML254-MKDN-PLU-RTL-AMT      =                            
W34517*                MLT00004-MKDN-PLU-RTL-AMT   * -1                         
W34517*        COMPUTE ML254-MKDN-PROMO-RTL-AMT    =                            
W34517*                MLT00004-MKDN-PROMO-RTL-AMT * -1                         
W34517*        COMPUTE ML254-MKDN-RGST-RTL-AMT     =                            
W34517*                MLT00004-MKDN-RGST-RTL-AMT  * -1                         
W34517*        COMPUTE ML254-MKDN-GLDST-RTL-AMT    =                            
W34517*                MLT00004-MKDN-GLDST-RTL-AMT * -1                         
W34517*        COMPUTE ML254-MKDN-UMTCH-RTL-AMT    =                            
W34517*                MLT00004-MKDN-UMTCH-RTL-AMT * -1                         
W34517*        COMPUTE ML254-MKDN-BYR-RTL-AMT      =                            
W34517*                MLT00004-MKDN-BYR-RTL-AMT   * -1                         
W34517*        COMPUTE ML254-MKDN-STR-RTL-AMT      =                            
W34517*                MLT00004-MKDN-STR-RTL-AMT   * -1                         
W34517*        COMPUTE ML254-MKDN-PRPT-RTL-AMT     =                            
W34517*                MLT00004-MKDN-PRPT-RTL-AMT  * -1                         
W34517*        COMPUTE ML254-MKDN-OTH-RTL-AMT      =                            
W34517*                MLT00004-MKDN-OTH-RTL-AMT   * -1                         
W34517*        COMPUTE ML254-DR-ALW-RTL-AMT        =                            
W34517*                MLT00004-DR-ALW-RTL-AMT     * -1                         
W34517*        COMPUTE ML254-RTV-RTL-AMT           =                            
W34517*                MLT00004-RTV-RTL-AMT        * -1                         
W34517*    ELSE                                                                 
W34517*        MOVE ZEROES                                                      
W34517*          TO ML254-PADJ-RTL-AMT                                          
W34517*             ML254-PADJ-RTV-RTL-AMT                                      
W34517*             ML254-PADJ-DA-RTL-AMT                                       
W34517*             ML254-PADJ-OTH-RTL-AMT                                      
W34517*             ML254-MKDN-RTL-AMT                                          
W34517*             ML254-MKDN-PLU-RTL-AMT                                      
W34517*             ML254-MKDN-PROMO-RTL-AMT                                    
W34517*             ML254-MKDN-RGST-RTL-AMT                                     
W34517*             ML254-MKDN-GLDST-RTL-AMT                                    
W34517*             ML254-MKDN-UMTCH-RTL-AMT                                    
W34517*             ML254-MKDN-BYR-RTL-AMT                                      
W34517*             ML254-MKDN-STR-RTL-AMT                                      
W34517*             ML254-MKDN-PRPT-RTL-AMT                                     
W34517*             ML254-MKDN-OTH-RTL-AMT                                      
W34517*             ML254-DR-ALW-RTL-AMT                                        
W34517*             ML254-RTV-RTL-AMT                                           
W34517*    END-IF                                                               
W34517*                                                                         
W34517*    MOVE CC-FSCL-END-DTE            TO MLT00003-FSCL-DTE.                
W34517*    MOVE MLT00004-DEPT-NBR          TO MLT00002-DEPT-NBR.                
W34517*    MOVE PC-MONTHLY-TM-LVL-CDE      TO MLT00003-TBL-TM-LVL-CDE.          
W34517*    PERFORM Z300-GET-PARTN-INFO.                                         
W34517*    MOVE MLT00003-PARTN-NBR         TO ML254-MTH-PARTN-NBR               
W34517*    MOVE MLT00003-DEPT-GP-CDE       TO ML254-MTH-DEPT-GP-CDE             
W34517*    MOVE PC-WEEKLY-TM-LVL-CDE       TO MLT00003-TBL-TM-LVL-CDE.          
W34517*    PERFORM Z300-GET-PARTN-INFO.                                         
W34517*    MOVE MLT00003-PARTN-NBR         TO ML254-WK-PARTN-NBR                
W34517*    MOVE MLT00003-DEPT-GP-CDE       TO ML254-WK-DEPT-GP-CDE              
W34517*    MOVE DTATTR-FSCL-WK-NBR         TO ML254-FSCL-WK-NBR                 
W34517*    MOVE DTATTR-FSCL-WK-END-DTE     TO ML254-FSCL-WK-END-DTE             
W34517*    MOVE CC-FSCL-END-DTE            TO ML254-FSCL-MN-END-DTE             
W34517*    MOVE DTATTR-FSCL-MN-NBR         TO ML254-FSCL-MN-NBR                 
W34517*    MOVE MLT00004-DEPT-NBR          TO ML254-DEPT-NBR                    
W34517*    MOVE MLT00004-MAJ-CL-NBR        TO ML254-MAJ-CL-NBR                  
W34517*    MOVE MLT00004-SUB-CL-NBR        TO ML254-SUB-CL-NBR                  
W34517*    MOVE MLT00004-LOC-NBR           TO ML254-LOC-NBR                     
W34517*    MOVE MLT00004-ML-LO-MDSE-LVL-ID TO ML254-ML-LWST-ID                  
W34517*                                                                         
W34517* WRITE REVERSAL TRANSACTION                                              
W34517*    PERFORM Z310-WRITE-TRANSACTION.                                      
W34517*    ADD 1 TO PV-REVERSALS-WRITTEN.                                       
W34517*                                                                         
W34517*    COMPUTE ML254-PADJ-FRGT-COST-AMT    =                                
W34517*            ML254-PADJ-FRGT-COST-AMT    * -1                             
W34517*    COMPUTE ML254-PADJ-DISC-COST-AMT    =                                
W34517*            ML254-PADJ-DISC-COST-AMT    * -1                             
W34517*    COMPUTE ML254-PADJ-RTV-COST-AMT     =                                
W34517*            ML254-PADJ-RTV-COST-AMT     * -1                             
W34517*    COMPUTE ML254-PADJ-DA-COST-AMT      =                                
W34517*            ML254-PADJ-DA-COST-AMT      * -1                             
W34517*    COMPUTE ML254-PADJ-NET-COST-AMT     =                                
W34517*            ML254-PADJ-NET-COST-AMT     * -1                             
W34517*    COMPUTE ML254-PADJ-OTH-COST-AMT     =                                
W34517*            ML254-PADJ-OTH-COST-AMT     * -1                             
W34517*    IF ML363-EXP-TYP = 2                                                 
W34517*        COMPUTE ML254-PADJ-RTL-AMT          =                            
W34517*                ML254-PADJ-RTL-AMT          * -1                         
W34517*        COMPUTE ML254-PADJ-RTV-RTL-AMT      =                            
W34517*                ML254-PADJ-RTV-RTL-AMT      * -1                         
W34517*        COMPUTE ML254-PADJ-DA-RTL-AMT       =                            
W34517*                ML254-PADJ-DA-RTL-AMT       * -1                         
W34517*        COMPUTE ML254-PADJ-OTH-RTL-AMT      =                            
W34517*                ML254-PADJ-OTH-RTL-AMT      * -1                         
W34517*        COMPUTE ML254-MKDN-RTL-AMT          =                            
W34517*                ML254-MKDN-RTL-AMT          * -1                         
W34517*        COMPUTE ML254-MKDN-PLU-RTL-AMT      =                            
W34517*                ML254-MKDN-PLU-RTL-AMT      * -1                         
W34517*        COMPUTE ML254-MKDN-PROMO-RTL-AMT    =                            
W34517*                ML254-MKDN-PROMO-RTL-AMT    * -1                         
W34517*        COMPUTE ML254-MKDN-RGST-RTL-AMT     =                            
W34517*                ML254-MKDN-RGST-RTL-AMT     * -1                         
W34517*        COMPUTE ML254-MKDN-GLDST-RTL-AMT    =                            
W34517*                ML254-MKDN-GLDST-RTL-AMT    * -1                         
W34517*        COMPUTE ML254-MKDN-UMTCH-RTL-AMT    =                            
W34517*                ML254-MKDN-UMTCH-RTL-AMT    * -1                         
W34517*        COMPUTE ML254-MKDN-BYR-RTL-AMT      =                            
W34517*                ML254-MKDN-BYR-RTL-AMT      * -1                         
W34517*        COMPUTE ML254-MKDN-STR-RTL-AMT      =                            
W34517*                ML254-MKDN-STR-RTL-AMT      * -1                         
W34517*        COMPUTE ML254-MKDN-PRPT-RTL-AMT     =                            
W34517*                ML254-MKDN-PRPT-RTL-AMT     * -1                         
W34517*        COMPUTE ML254-MKDN-OTH-RTL-AMT      =                            
W34517*                ML254-MKDN-OTH-RTL-AMT      * -1                         
W34517*        COMPUTE ML254-DR-ALW-RTL-AMT        =                            
W34517*                ML254-DR-ALW-RTL-AMT        * -1                         
W34517*        COMPUTE ML254-RTV-RTL-AMT           =                            
W34517*                ML254-RTV-RTL-AMT           * -1                         
W34517*    END-IF                                                               
W34517* RE-ALLOCATE REVERSED AMOUNTS                                            
W34517*    EVALUATE TRUE                                                        
W34517*      WHEN ML363-EXP-TYP = 1 OR 2                                        
W34517*        PERFORM B400-FREIGHT-SALVAGE-ALLOC                               
W34517*      WHEN ML363-EXP-TYP = 3                                             
W34517*        PERFORM B500-LICENSE-FEES-ALLOC                                  
W34517*    END-EVALUATE.                                                        
                                                                                
W34517* ONLY REVERSE AND RE-ALLOCATE WHEN DOLLARS ARE PRESENT                   
W34517     IF MNLY-AMTS-NOT-ZERO                                                
W34517         PERFORM B330-REVERSE-REALLOCATE                                  
W34517     END-IF.                                                              
W34517                                                                          
           PERFORM Z210-FETCH-PADJ-SUM-CSR.                                     
                                                                                
W34517******************************************************************        
W34517*    CREATE UNKNOWN BRAND REVERSAL TRANSACTION. CREATE                    
W34517*    RE-ALLOCATION TRANSACTIONS.                                          
W34517******************************************************************        
W34517 B330-REVERSE-REALLOCATE.                                                 
W34517     COMPUTE ML254-PADJ-FRGT-COST-AMT    =                                
W34517             MLT00004-PADJ-FRGT-COST-AMT * -1                             
W34517     COMPUTE ML254-PADJ-DISC-COST-AMT    =                                
W34517             MLT00004-PADJ-DISC-COST-AMT * -1                             
W34517     COMPUTE ML254-PADJ-RTV-COST-AMT     =                                
W34517             MLT00004-PADJ-RTV-COST-AMT  * -1                             
W34517     COMPUTE ML254-PADJ-DA-COST-AMT      =                                
W34517             MLT00004-PADJ-DA-COST-AMT   * -1                             
W34517     COMPUTE ML254-PADJ-NET-COST-AMT     =                                
W34517             MLT00004-PADJ-NET-COST-AMT  * -1                             
W34517     COMPUTE ML254-PADJ-OTH-COST-AMT     =                                
W34517             MLT00004-PADJ-OTH-COST-AMT  * -1                             
W37965     IF ML363-EXP-TYP = 2                                                 
W34517         COMPUTE ML254-PADJ-RTL-AMT          =                            
W34517                 MLT00004-PADJ-RTL-AMT       * -1                         
W34517         COMPUTE ML254-PADJ-RTV-RTL-AMT      =                            
W34517                 MLT00004-PADJ-RTV-RTL-AMT   * -1                         
W34517         COMPUTE ML254-PADJ-DA-RTL-AMT       =                            
W34517                 MLT00004-PADJ-DA-RTL-AMT    * -1                         
W34517         COMPUTE ML254-PADJ-OTH-RTL-AMT      =                            
W34517                 MLT00004-PADJ-OTH-RTL-AMT   * -1                         
W34517         COMPUTE ML254-MKDN-RTL-AMT          =                            
W34517                 MLT00004-MKDN-RTL-AMT       * -1                         
W34517         COMPUTE ML254-MKDN-PLU-RTL-AMT      =                            
W34517                 MLT00004-MKDN-PLU-RTL-AMT   * -1                         
W34517         COMPUTE ML254-MKDN-PROMO-RTL-AMT    =                            
W34517                 MLT00004-MKDN-PROMO-RTL-AMT * -1                         
W34517         COMPUTE ML254-MKDN-RGST-RTL-AMT     =                            
W34517                 MLT00004-MKDN-RGST-RTL-AMT  * -1                         
W34517         COMPUTE ML254-MKDN-GLDST-RTL-AMT    =                            
W34517                 MLT00004-MKDN-GLDST-RTL-AMT * -1                         
W34517         COMPUTE ML254-MKDN-UMTCH-RTL-AMT    =                            
W34517                 MLT00004-MKDN-UMTCH-RTL-AMT * -1                         
W34517         COMPUTE ML254-MKDN-BYR-RTL-AMT      =                            
W34517                 MLT00004-MKDN-BYR-RTL-AMT   * -1                         
W34517         COMPUTE ML254-MKDN-STR-RTL-AMT      =                            
W34517                 MLT00004-MKDN-STR-RTL-AMT   * -1                         
W34517         COMPUTE ML254-MKDN-PRPT-RTL-AMT     =                            
W34517                 MLT00004-MKDN-PRPT-RTL-AMT  * -1                         
W34517         COMPUTE ML254-MKDN-OTH-RTL-AMT      =                            
W34517                 MLT00004-MKDN-OTH-RTL-AMT   * -1                         
W34517         COMPUTE ML254-DR-ALW-RTL-AMT        =                            
W34517                 MLT00004-DR-ALW-RTL-AMT     * -1                         
W34517         COMPUTE ML254-RTV-RTL-AMT           =                            
W34517                 MLT00004-RTV-RTL-AMT        * -1                         
W34517     ELSE                                                                 
W34517         MOVE ZEROES                                                      
W34517           TO ML254-PADJ-RTL-AMT                                          
W34517              ML254-PADJ-RTV-RTL-AMT                                      
W34517              ML254-PADJ-DA-RTL-AMT                                       
W34517              ML254-PADJ-OTH-RTL-AMT                                      
W34517              ML254-MKDN-RTL-AMT                                          
W34517              ML254-MKDN-PLU-RTL-AMT                                      
W34517              ML254-MKDN-PROMO-RTL-AMT                                    
W34517              ML254-MKDN-RGST-RTL-AMT                                     
W34517              ML254-MKDN-GLDST-RTL-AMT                                    
W34517              ML254-MKDN-UMTCH-RTL-AMT                                    
W34517              ML254-MKDN-BYR-RTL-AMT                                      
W34517              ML254-MKDN-STR-RTL-AMT                                      
W34517              ML254-MKDN-PRPT-RTL-AMT                                     
W34517              ML254-MKDN-OTH-RTL-AMT                                      
W34517              ML254-DR-ALW-RTL-AMT                                        
W34517              ML254-RTV-RTL-AMT                                           
W34517     END-IF.                                                              
W34517                                                                          
W34517     MOVE DTATTR-FSCL-MN-END-DTE     TO MLT00003-FSCL-DTE.                
W34517     MOVE MLT00004-DEPT-NBR          TO MLT00002-DEPT-NBR.                
W34517     MOVE PC-MONTHLY-TM-LVL-CDE      TO MLT00003-TBL-TM-LVL-CDE.          
W34517     PERFORM Z300-GET-PARTN-INFO.                                         
W34517     MOVE MLT00003-PARTN-NBR         TO ML254-MTH-PARTN-NBR               
W34517     MOVE MLT00003-DEPT-GP-CDE       TO ML254-MTH-DEPT-GP-CDE             
W34517     MOVE CC-FSCL-WK-END-DTE         TO MLT00003-FSCL-DTE.                
W34517     MOVE PC-WEEKLY-TM-LVL-CDE       TO MLT00003-TBL-TM-LVL-CDE.          
W34517     PERFORM Z300-GET-PARTN-INFO.                                         
W34517     MOVE MLT00003-PARTN-NBR         TO ML254-WK-PARTN-NBR                
W34517     MOVE MLT00003-DEPT-GP-CDE       TO ML254-WK-DEPT-GP-CDE              
W34517     MOVE DTATTR-FSCL-WK-NBR         TO ML254-FSCL-WK-NBR                 
W34517     MOVE CC-FSCL-WK-END-DTE         TO ML254-FSCL-WK-END-DTE             
W34517     MOVE DTATTR-FSCL-MN-END-DTE     TO ML254-FSCL-MN-END-DTE             
W34517     MOVE DTATTR-FSCL-MN-NBR         TO ML254-FSCL-MN-NBR                 
W34517     MOVE MLT00004-DEPT-NBR          TO ML254-DEPT-NBR                    
W34517     MOVE MLT00004-MAJ-CL-NBR        TO ML254-MAJ-CL-NBR                  
W34517     MOVE MLT00004-SUB-CL-NBR        TO ML254-SUB-CL-NBR                  
W34517     MOVE MLT00004-LOC-NBR           TO ML254-LOC-NBR                     
W34517     MOVE MLT00004-ML-LO-MDSE-LVL-ID TO ML254-ML-LWST-ID                  
W34517                                        ML254-ML-LWST-ID-ORIG             
W34517     MOVE MLV00000-LBL-SEQ-NBR       TO ML254-LBL-SEQ-NBR                 
W37965     MOVE ML363-ENT-ID               TO ML254-ENT-ID                      
W34517     SET ML254-PRORATE-REVERSAL      TO TRUE                              
W34517                                                                          
W34517* WRITE REVERSAL TRANSACTION                                              
W34517     PERFORM Z310-WRITE-TRANSACTION.                                      
W34517     ADD 1 TO PV-REVERSALS-WRITTEN.                                       
W34517                                                                          
W34517     MOVE ZEROES                     TO PV-LARGEST-PCT-POS                
W34517                                        PV-LARGEST-LBL-SEQ-POS            
W34517                                        PV-LARGEST-ENT-ID-POS             
W34517                                        PV-LARGEST-DKEY-POS               
W34517                                        PV-LARGEST-PCT-NEG                
W34517                                        PV-LARGEST-LBL-SEQ-NEG            
W34517                                        PV-LARGEST-ENT-ID-NEG             
W34517                                        PV-LARGEST-DKEY-NEG               
W34517     SET ML254-PRORATE-ALLOCATE      TO TRUE                              
W34517     COMPUTE ML254-PADJ-FRGT-COST-AMT    =                                
W34517             ML254-PADJ-FRGT-COST-AMT    * -1                             
W34517     COMPUTE ML254-PADJ-DISC-COST-AMT    =                                
W34517             ML254-PADJ-DISC-COST-AMT    * -1                             
W34517     COMPUTE ML254-PADJ-RTV-COST-AMT     =                                
W34517             ML254-PADJ-RTV-COST-AMT     * -1                             
W34517     COMPUTE ML254-PADJ-DA-COST-AMT      =                                
W34517             ML254-PADJ-DA-COST-AMT      * -1                             
W34517     COMPUTE ML254-PADJ-NET-COST-AMT     =                                
W34517             ML254-PADJ-NET-COST-AMT     * -1                             
W34517     COMPUTE ML254-PADJ-OTH-COST-AMT     =                                
W34517             ML254-PADJ-OTH-COST-AMT     * -1                             
W37965     IF ML363-EXP-TYP = 2                                                 
W34517         COMPUTE ML254-PADJ-RTL-AMT          =                            
W34517                 ML254-PADJ-RTL-AMT          * -1                         
W34517         COMPUTE ML254-PADJ-RTV-RTL-AMT      =                            
W34517                 ML254-PADJ-RTV-RTL-AMT      * -1                         
W34517         COMPUTE ML254-PADJ-DA-RTL-AMT       =                            
W34517                 ML254-PADJ-DA-RTL-AMT       * -1                         
W34517         COMPUTE ML254-PADJ-OTH-RTL-AMT      =                            
W34517                 ML254-PADJ-OTH-RTL-AMT      * -1                         
W34517         COMPUTE ML254-MKDN-RTL-AMT          =                            
W34517                 ML254-MKDN-RTL-AMT          * -1                         
W34517         COMPUTE ML254-MKDN-PLU-RTL-AMT      =                            
W34517                 ML254-MKDN-PLU-RTL-AMT      * -1                         
W34517         COMPUTE ML254-MKDN-PROMO-RTL-AMT    =                            
W34517                 ML254-MKDN-PROMO-RTL-AMT    * -1                         
W34517         COMPUTE ML254-MKDN-RGST-RTL-AMT     =                            
W34517                 ML254-MKDN-RGST-RTL-AMT     * -1                         
W34517         COMPUTE ML254-MKDN-GLDST-RTL-AMT    =                            
W34517                 ML254-MKDN-GLDST-RTL-AMT    * -1                         
W34517         COMPUTE ML254-MKDN-UMTCH-RTL-AMT    =                            
W34517                 ML254-MKDN-UMTCH-RTL-AMT    * -1                         
W34517         COMPUTE ML254-MKDN-BYR-RTL-AMT      =                            
W34517                 ML254-MKDN-BYR-RTL-AMT      * -1                         
W34517         COMPUTE ML254-MKDN-STR-RTL-AMT      =                            
W34517                 ML254-MKDN-STR-RTL-AMT      * -1                         
W34517         COMPUTE ML254-MKDN-PRPT-RTL-AMT     =                            
W34517                 ML254-MKDN-PRPT-RTL-AMT     * -1                         
W34517         COMPUTE ML254-MKDN-OTH-RTL-AMT      =                            
W34517                 ML254-MKDN-OTH-RTL-AMT      * -1                         
W34517         COMPUTE ML254-DR-ALW-RTL-AMT        =                            
W34517                 ML254-DR-ALW-RTL-AMT        * -1                         
W34517         COMPUTE ML254-RTV-RTL-AMT           =                            
W34517                 ML254-RTV-RTL-AMT           * -1                         
W34517     END-IF.                                                              
W34517                                                                          
W34517* RE-ALLOCATE REVERSED AMOUNTS                                            
W34517     EVALUATE TRUE                                                        
W37965       WHEN ML363-EXP-TYP = 1 OR 2                                        
W34517         PERFORM B400-FREIGHT-SALVAGE-ALLOC                               
W37965       WHEN ML363-EXP-TYP = 3                                             
W34517         PERFORM B500-LICENSE-FEES-ALLOC                                  
W34517     END-EVALUATE.                                                        
W34517                                                                          
      ******************************************************************        
      *    RE-ALLOCATE PURCHASE ADJUSTMENTS FOR FREIGHT SALVAGE                 
      ******************************************************************        
       B400-FREIGHT-SALVAGE-ALLOC.                                              
                                                                                
           MOVE ML254-PADJ-FRGT-COST-AMT                                        
             TO PV-PADJ-FRGT-COST-AMT                                           
                PV-PADJ-FRGT-COST-AMT-REM                                       
           MOVE ML254-PADJ-DISC-COST-AMT                                        
             TO PV-PADJ-DISC-COST-AMT                                           
                PV-PADJ-DISC-COST-AMT-REM                                       
           MOVE ML254-PADJ-RTV-COST-AMT                                         
             TO PV-PADJ-RTV-COST-AMT                                            
                PV-PADJ-RTV-COST-AMT-REM                                        
           MOVE ML254-PADJ-DA-COST-AMT                                          
             TO PV-PADJ-DA-COST-AMT                                             
                PV-PADJ-DA-COST-AMT-REM                                         
           MOVE ML254-PADJ-NET-COST-AMT                                         
             TO PV-PADJ-NET-COST-AMT                                            
                PV-PADJ-NET-COST-AMT-REM                                        
           MOVE ML254-PADJ-OTH-COST-AMT                                         
             TO PV-PADJ-OTH-COST-AMT                                            
                PV-PADJ-OTH-COST-AMT-REM                                        
W37965     IF ML363-EXP-TYP = 2                                                 
               MOVE ML254-PADJ-RTL-AMT                                          
                 TO PV-PADJ-RTL-AMT                                             
                    PV-PADJ-RTL-AMT-REM                                         
               MOVE ML254-PADJ-RTV-RTL-AMT                                      
                 TO PV-PADJ-RTV-RTL-AMT                                         
                    PV-PADJ-RTV-RTL-AMT-REM                                     
               MOVE ML254-PADJ-DA-RTL-AMT                                       
                 TO PV-PADJ-DA-RTL-AMT                                          
                    PV-PADJ-DA-RTL-AMT-REM                                      
               MOVE ML254-PADJ-OTH-RTL-AMT                                      
                 TO PV-PADJ-OTH-RTL-AMT                                         
                    PV-PADJ-OTH-RTL-AMT-REM                                     
               MOVE ML254-MKDN-RTL-AMT                                          
                 TO PV-MKDN-RTL-AMT                                             
                    PV-MKDN-RTL-AMT-REM                                         
               MOVE ML254-MKDN-PLU-RTL-AMT                                      
                 TO PV-MKDN-PLU-RTL-AMT                                         
                    PV-MKDN-PLU-RTL-AMT-REM                                     
               MOVE ML254-MKDN-PROMO-RTL-AMT                                    
                 TO PV-MKDN-PROMO-RTL-AMT                                       
                    PV-MKDN-PROMO-RTL-AMT-REM                                   
               MOVE ML254-MKDN-RGST-RTL-AMT                                     
                 TO PV-MKDN-RGST-RTL-AMT                                        
                    PV-MKDN-RGST-RTL-AMT-REM                                    
               MOVE ML254-MKDN-GLDST-RTL-AMT                                    
                 TO PV-MKDN-GLDST-RTL-AMT                                       
                    PV-MKDN-GLDST-RTL-AMT-REM                                   
               MOVE ML254-MKDN-UMTCH-RTL-AMT                                    
                 TO PV-MKDN-UMTCH-RTL-AMT                                       
                    PV-MKDN-UMTCH-RTL-AMT-REM                                   
               MOVE ML254-MKDN-BYR-RTL-AMT                                      
                 TO PV-MKDN-BYR-RTL-AMT                                         
                    PV-MKDN-BYR-RTL-AMT-REM                                     
               MOVE ML254-MKDN-STR-RTL-AMT                                      
                 TO PV-MKDN-STR-RTL-AMT                                         
                    PV-MKDN-STR-RTL-AMT-REM                                     
               MOVE ML254-MKDN-PRPT-RTL-AMT                                     
                 TO PV-MKDN-PRPT-RTL-AMT                                        
                    PV-MKDN-PRPT-RTL-AMT-REM                                    
               MOVE ML254-MKDN-OTH-RTL-AMT                                      
                 TO PV-MKDN-OTH-RTL-AMT                                         
                    PV-MKDN-OTH-RTL-AMT-REM                                     
               MOVE ML254-DR-ALW-RTL-AMT                                        
                 TO PV-DR-ALW-RTL-AMT                                           
                    PV-DR-ALW-RTL-AMT-REM                                       
               MOVE ML254-RTV-RTL-AMT                                           
                 TO PV-RTV-RTL-AMT                                              
                    PV-RTV-RTL-AMT-REM                                          
           END-IF                                                               
           PERFORM WITH TEST AFTER                                              
             VARYING PT-FS-INDX FROM PT-FS-INDX-BEG BY 1                        
             UNTIL PT-FS-DEPT-LAST (PT-FS-INDX) = 'Y'                           
                OR PT-FS-INDX >= PT-FS-INDX-TOT                                 
               MOVE ZERO TO PV-PCT                                              
W37965         EVALUATE ML363-EXP-TYP                                           
W37965           WHEN 1                                                         
                   MOVE PT-FS-RCPT-GRO-COST-PCT (PT-FS-INDX)                    
                     TO PV-PCT                                                  
W37965           WHEN 2                                                         
                   MOVE PT-FS-MKDN-BYR-RTL-PCT (PT-FS-INDX)                     
                     TO PV-PCT                                                  
               END-EVALUATE                                                     
               COMPUTE ML254-PADJ-FRGT-COST-AMT ROUNDED =                       
                      (PV-PADJ-FRGT-COST-AMT    *                               
                       PV-PCT) / 100                                            
               COMPUTE PV-PADJ-FRGT-COST-AMT-REM =                              
                       PV-PADJ-FRGT-COST-AMT-REM -                              
                       ML254-PADJ-FRGT-COST-AMT                                 
               COMPUTE ML254-PADJ-DISC-COST-AMT ROUNDED =                       
                      (PV-PADJ-DISC-COST-AMT    *                               
                       PV-PCT) / 100                                            
               COMPUTE PV-PADJ-DISC-COST-AMT-REM =                              
                       PV-PADJ-DISC-COST-AMT-REM -                              
                       ML254-PADJ-DISC-COST-AMT                                 
               COMPUTE ML254-PADJ-RTV-COST-AMT ROUNDED =                        
                      (PV-PADJ-RTV-COST-AMT     *                               
                       PV-PCT) / 100                                            
               COMPUTE PV-PADJ-RTV-COST-AMT-REM =                               
                       PV-PADJ-RTV-COST-AMT-REM -                               
                       ML254-PADJ-RTV-COST-AMT                                  
               COMPUTE ML254-PADJ-DA-COST-AMT ROUNDED =                         
                      (PV-PADJ-DA-COST-AMT      *                               
                       PV-PCT) / 100                                            
               COMPUTE PV-PADJ-DA-COST-AMT-REM  =                               
                       PV-PADJ-DA-COST-AMT-REM  -                               
                       ML254-PADJ-DA-COST-AMT                                   
               COMPUTE ML254-PADJ-NET-COST-AMT ROUNDED =                        
                      (PV-PADJ-NET-COST-AMT     *                               
                       PV-PCT) / 100                                            
               COMPUTE PV-PADJ-NET-COST-AMT-REM =                               
                       PV-PADJ-NET-COST-AMT-REM -                               
                       ML254-PADJ-NET-COST-AMT                                  
               COMPUTE ML254-PADJ-OTH-COST-AMT ROUNDED =                        
                      (PV-PADJ-OTH-COST-AMT     *                               
                       PV-PCT) / 100                                            
               COMPUTE PV-PADJ-OTH-COST-AMT-REM =                               
                       PV-PADJ-OTH-COST-AMT-REM -                               
                       ML254-PADJ-OTH-COST-AMT                                  
W37965         IF ML363-EXP-TYP = 2                                             
                   COMPUTE ML254-PADJ-RTL-AMT ROUNDED =                         
                          (PV-PADJ-RTL-AMT       *                              
                           PV-PCT) / 100                                        
                   COMPUTE PV-PADJ-RTL-AMT-REM   =                              
                           PV-PADJ-RTL-AMT-REM   -                              
                           ML254-PADJ-RTL-AMT                                   
                   COMPUTE ML254-PADJ-RTV-RTL-AMT ROUNDED =                     
                          (PV-PADJ-RTV-RTL-AMT      *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-PADJ-RTV-RTL-AMT-REM  =                           
                           PV-PADJ-RTV-RTL-AMT-REM  -                           
                           ML254-PADJ-RTV-RTL-AMT                               
                   COMPUTE ML254-PADJ-DA-RTL-AMT ROUNDED =                      
                          (PV-PADJ-DA-RTL-AMT       *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-PADJ-DA-RTL-AMT-REM   =                           
                           PV-PADJ-DA-RTL-AMT-REM   -                           
                           ML254-PADJ-DA-RTL-AMT                                
                   COMPUTE ML254-PADJ-OTH-RTL-AMT ROUNDED =                     
                          (PV-PADJ-OTH-RTL-AMT      *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-PADJ-OTH-RTL-AMT-REM  =                           
                           PV-PADJ-OTH-RTL-AMT-REM  -                           
                           ML254-PADJ-OTH-RTL-AMT                               
                   COMPUTE ML254-MKDN-RTL-AMT ROUNDED =                         
                          (PV-MKDN-RTL-AMT       *                              
                           PV-PCT) / 100                                        
                   COMPUTE PV-MKDN-RTL-AMT-REM   =                              
                           PV-MKDN-RTL-AMT-REM   -                              
                           ML254-MKDN-RTL-AMT                                   
                   COMPUTE ML254-MKDN-PLU-RTL-AMT ROUNDED =                     
                          (PV-MKDN-PLU-RTL-AMT      *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-MKDN-PLU-RTL-AMT-REM =                            
                           PV-MKDN-PLU-RTL-AMT-REM -                            
                           ML254-MKDN-PLU-RTL-AMT                               
                   COMPUTE ML254-MKDN-PROMO-RTL-AMT ROUNDED =                   
                          (PV-MKDN-PROMO-RTL-AMT    *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-MKDN-PROMO-RTL-AMT-REM =                          
                           PV-MKDN-PROMO-RTL-AMT-REM -                          
                           ML254-MKDN-PROMO-RTL-AMT                             
                   COMPUTE ML254-MKDN-RGST-RTL-AMT ROUNDED =                    
                          (PV-MKDN-RGST-RTL-AMT     *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-MKDN-RGST-RTL-AMT-REM =                           
                           PV-MKDN-RGST-RTL-AMT-REM -                           
                           ML254-MKDN-RGST-RTL-AMT                              
                   COMPUTE ML254-MKDN-GLDST-RTL-AMT ROUNDED =                   
                          (PV-MKDN-GLDST-RTL-AMT    *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-MKDN-GLDST-RTL-AMT-REM =                          
                           PV-MKDN-GLDST-RTL-AMT-REM -                          
                           ML254-MKDN-GLDST-RTL-AMT                             
                   COMPUTE ML254-MKDN-UMTCH-RTL-AMT ROUNDED =                   
                          (PV-MKDN-UMTCH-RTL-AMT    *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-MKDN-UMTCH-RTL-AMT-REM =                          
                           PV-MKDN-UMTCH-RTL-AMT-REM -                          
                           ML254-MKDN-UMTCH-RTL-AMT                             
                   COMPUTE ML254-MKDN-BYR-RTL-AMT ROUNDED =                     
                          (PV-MKDN-BYR-RTL-AMT      *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-MKDN-BYR-RTL-AMT-REM  =                           
                           PV-MKDN-BYR-RTL-AMT-REM  -                           
                           ML254-MKDN-BYR-RTL-AMT                               
                   COMPUTE ML254-MKDN-STR-RTL-AMT ROUNDED =                     
                          (PV-MKDN-STR-RTL-AMT      *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-MKDN-STR-RTL-AMT-REM =                            
                           PV-MKDN-STR-RTL-AMT-REM -                            
                           ML254-MKDN-STR-RTL-AMT                               
                   COMPUTE ML254-MKDN-PRPT-RTL-AMT ROUNDED =                    
                          (PV-MKDN-PRPT-RTL-AMT     *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-MKDN-PRPT-RTL-AMT-REM =                           
                           PV-MKDN-PRPT-RTL-AMT-REM -                           
                           ML254-MKDN-PRPT-RTL-AMT                              
                   COMPUTE ML254-MKDN-OTH-RTL-AMT ROUNDED =                     
                          (PV-MKDN-OTH-RTL-AMT      *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-MKDN-OTH-RTL-AMT-REM  =                           
                           PV-MKDN-OTH-RTL-AMT-REM  -                           
                           ML254-MKDN-OTH-RTL-AMT                               
                   COMPUTE ML254-DR-ALW-RTL-AMT   ROUNDED =                     
                          (PV-DR-ALW-RTL-AMT        *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-DR-ALW-RTL-AMT-REM    =                           
                           PV-DR-ALW-RTL-AMT-REM    -                           
                           ML254-DR-ALW-RTL-AMT                                 
                   COMPUTE ML254-RTV-RTL-AMT      ROUNDED =                     
                          (PV-RTV-RTL-AMT           *                           
                           PV-PCT) / 100                                        
                   COMPUTE PV-RTV-RTL-AMT-REM       =                           
                           PV-RTV-RTL-AMT-REM       -                           
                           ML254-RTV-RTL-AMT                                    
               END-IF                                                           
W34517         MOVE PT-FS-LABEL-SEQ (PT-FS-INDX)                                
W34517           TO ML254-LBL-SEQ-NBR                                           
W34517         MOVE PT-FS-ENT-ID    (PT-FS-INDX)                                
W34517           TO ML254-ENT-ID                                                
               MOVE PT-FS-DKEY (PT-FS-INDX)                                     
                 TO ML254-ML-LWST-ID                                            
W34517         IF PV-PCT >= ZERO                                                
W34517             IF PV-PCT > PV-LARGEST-PCT-POS                               
W34517                 MOVE PV-PCT TO PV-LARGEST-PCT-POS                        
W34517                 MOVE PT-FS-LABEL-SEQ (PT-FS-INDX)                        
W34517                   TO PV-LARGEST-LBL-SEQ-POS                              
W34517                 MOVE PT-FS-ENT-ID (PT-FS-INDX)                           
W34517                   TO PV-LARGEST-ENT-ID-POS                               
W34517                 MOVE PT-FS-DKEY (PT-FS-INDX)                             
W34517                   TO PV-LARGEST-DKEY-POS                                 
W34517             END-IF                                                       
W34517         ELSE                                                             
W34517             IF PV-PCT < PV-LARGEST-PCT-NEG                               
W34517                 MOVE PV-PCT TO PV-LARGEST-PCT-NEG                        
W34517                 MOVE PT-FS-LABEL-SEQ (PT-FS-INDX)                        
W34517                   TO PV-LARGEST-LBL-SEQ-NEG                              
W34517                 MOVE PT-FS-ENT-ID (PT-FS-INDX)                           
W34517                   TO PV-LARGEST-ENT-ID-NEG                               
W34517                 MOVE PT-FS-DKEY (PT-FS-INDX)                             
W34517                   TO PV-LARGEST-DKEY-NEG                                 
W34517             END-IF                                                       
W34517         END-IF                                                           
      * WRITE RE-ALLOCATION TRANSACTION                                         
               PERFORM Z310-WRITE-TRANSACTION                                   
               ADD 1 TO PV-REALLOCATIONS-WRITTEN                                
           END-PERFORM                                                          
                                                                                
           MOVE PV-PADJ-FRGT-COST-AMT-REM                                       
             TO ML254-PADJ-FRGT-COST-AMT                                        
           MOVE PV-PADJ-DISC-COST-AMT-REM                                       
             TO ML254-PADJ-DISC-COST-AMT                                        
           MOVE PV-PADJ-RTV-COST-AMT-REM                                        
             TO ML254-PADJ-RTV-COST-AMT                                         
           MOVE PV-PADJ-DA-COST-AMT-REM                                         
             TO ML254-PADJ-DA-COST-AMT                                          
           MOVE PV-PADJ-NET-COST-AMT-REM                                        
             TO ML254-PADJ-NET-COST-AMT                                         
           MOVE PV-PADJ-OTH-COST-AMT-REM                                        
             TO ML254-PADJ-OTH-COST-AMT                                         
W37965     IF ML363-EXP-TYP = 2                                                 
               MOVE PV-PADJ-RTL-AMT-REM                                         
                 TO ML254-PADJ-RTL-AMT                                          
               MOVE PV-PADJ-RTV-RTL-AMT-REM                                     
                 TO ML254-PADJ-RTV-RTL-AMT                                      
               MOVE PV-PADJ-DA-RTL-AMT-REM                                      
                 TO ML254-PADJ-DA-RTL-AMT                                       
               MOVE PV-PADJ-OTH-RTL-AMT-REM                                     
                 TO ML254-PADJ-OTH-RTL-AMT                                      
               MOVE PV-MKDN-RTL-AMT-REM                                         
                 TO ML254-MKDN-RTL-AMT                                          
               MOVE PV-MKDN-PLU-RTL-AMT-REM                                     
                 TO ML254-MKDN-PLU-RTL-AMT                                      
               MOVE PV-MKDN-PROMO-RTL-AMT-REM                                   
                 TO ML254-MKDN-PROMO-RTL-AMT                                    
               MOVE PV-MKDN-RGST-RTL-AMT-REM                                    
                 TO ML254-MKDN-RGST-RTL-AMT                                     
               MOVE PV-MKDN-GLDST-RTL-AMT-REM                                   
                 TO ML254-MKDN-GLDST-RTL-AMT                                    
               MOVE PV-MKDN-UMTCH-RTL-AMT-REM                                   
                 TO ML254-MKDN-UMTCH-RTL-AMT                                    
               MOVE PV-MKDN-BYR-RTL-AMT-REM                                     
                 TO ML254-MKDN-BYR-RTL-AMT                                      
               MOVE PV-MKDN-STR-RTL-AMT-REM                                     
                 TO ML254-MKDN-STR-RTL-AMT                                      
               MOVE PV-MKDN-PRPT-RTL-AMT-REM                                    
                 TO ML254-MKDN-PRPT-RTL-AMT                                     
               MOVE PV-MKDN-OTH-RTL-AMT-REM                                     
                 TO ML254-MKDN-OTH-RTL-AMT                                      
               MOVE PV-DR-ALW-RTL-AMT-REM                                       
                 TO ML254-DR-ALW-RTL-AMT                                        
               MOVE PV-RTV-RTL-AMT-REM                                          
                 TO ML254-RTV-RTL-AMT                                           
           END-IF                                                               
W34517*    MOVE PT-FS-DKEY (PT-FS-INDX)                                         
W34517*      TO ML254-ML-LWST-ID                                                
W34517     IF PV-PADJ-NET-COST-AMT-REM >= ZERO                                  
W34517         IF PV-LARGEST-DKEY-POS NOT = ZERO                                
W34517             MOVE PV-LARGEST-LBL-SEQ-POS                                  
W34517               TO ML254-LBL-SEQ-NBR                                       
W34517             MOVE PV-LARGEST-ENT-ID-POS                                   
W34517               TO ML254-ENT-ID                                            
W34517             MOVE PV-LARGEST-DKEY-POS                                     
W34517               TO ML254-ML-LWST-ID                                        
W34517         END-IF                                                           
W34517     ELSE                                                                 
W34517         IF PV-LARGEST-DKEY-NEG NOT = ZERO                                
W34517             MOVE PV-LARGEST-LBL-SEQ-NEG                                  
W34517               TO ML254-LBL-SEQ-NBR                                       
W34517             MOVE PV-LARGEST-ENT-ID-NEG                                   
W34517               TO ML254-ENT-ID                                            
W34517             MOVE PV-LARGEST-DKEY-NEG                                     
W34517               TO ML254-ML-LWST-ID                                        
W34517         END-IF                                                           
W34517     END-IF.                                                              
      * WRITE RE-ALLOCATION REMAINDER TRANSACTION                               
           PERFORM Z310-WRITE-TRANSACTION.                                      
           ADD 1 TO PV-REALLOCATIONS-WRITTEN.                                   
                                                                                
      ******************************************************************        
      *    RE-ALLOCATE PURCHASE ADJUSTMENTS FOR LICENSE FEES                    
      ******************************************************************        
       B500-LICENSE-FEES-ALLOC.                                                 
                                                                                
      *    MOVE ML254-PADJ-RTL-AMT                                              
      *      TO PV-PADJ-RTL-AMT                                                 
      *         PV-PADJ-RTL-AMT-REM                                             
           MOVE ML254-PADJ-FRGT-COST-AMT                                        
             TO PV-PADJ-FRGT-COST-AMT                                           
                PV-PADJ-FRGT-COST-AMT-REM                                       
           MOVE ML254-PADJ-DISC-COST-AMT                                        
             TO PV-PADJ-DISC-COST-AMT                                           
                PV-PADJ-DISC-COST-AMT-REM                                       
           MOVE ML254-PADJ-RTV-COST-AMT                                         
             TO PV-PADJ-RTV-COST-AMT                                            
                PV-PADJ-RTV-COST-AMT-REM                                        
      *    MOVE ML254-PADJ-RTV-RTL-AMT                                          
      *      TO PV-PADJ-RTV-RTL-AMT                                             
      *         PV-PADJ-RTV-RTL-AMT-REM                                         
           MOVE ML254-PADJ-DA-COST-AMT                                          
             TO PV-PADJ-DA-COST-AMT                                             
                PV-PADJ-DA-COST-AMT-REM                                         
      *    MOVE ML254-PADJ-DA-RTL-AMT                                           
      *      TO PV-PADJ-DA-RTL-AMT                                              
      *         PV-PADJ-DA-RTL-AMT-REM                                          
           MOVE ML254-PADJ-NET-COST-AMT                                         
             TO PV-PADJ-NET-COST-AMT                                            
                PV-PADJ-NET-COST-AMT-REM                                        
           MOVE ML254-PADJ-OTH-COST-AMT                                         
             TO PV-PADJ-OTH-COST-AMT                                            
                PV-PADJ-OTH-COST-AMT-REM                                        
      *    MOVE ML254-PADJ-OTH-RTL-AMT                                          
      *      TO PV-PADJ-OTH-RTL-AMT                                             
      *         PV-PADJ-OTH-RTL-AMT-REM                                         
           PERFORM WITH TEST AFTER                                              
             VARYING PT-LF-INDX FROM PT-LF-INDX-BEG BY 1                        
             UNTIL PT-LF-DEPT-LAST (PT-LF-INDX) = 'Y'                           
                OR PT-LF-INDX >= PT-LF-INDX-TOT                                 
               MOVE ZERO TO PV-PCT                                              
               MOVE PT-LF-DIST-PCT (PT-LF-INDX)                                 
                 TO PV-PCT                                                      
      *        COMPUTE ML254-PADJ-RTL-AMT ROUNDED =                             
      *               (PV-PADJ-RTL-AMT       *                                  
      *                PV-PCT) / 100                                            
      *        COMPUTE PV-PADJ-RTL-AMT-REM   =                                  
      *                PV-PADJ-RTL-AMT-REM   -                                  
      *                ML254-PADJ-RTL-AMT                                       
               COMPUTE ML254-PADJ-FRGT-COST-AMT ROUNDED =                       
                      (PV-PADJ-FRGT-COST-AMT    *                               
                       PV-PCT) / 100                                            
               COMPUTE PV-PADJ-FRGT-COST-AMT-REM =                              
                       PV-PADJ-FRGT-COST-AMT-REM -                              
                       ML254-PADJ-FRGT-COST-AMT                                 
               COMPUTE ML254-PADJ-DISC-COST-AMT ROUNDED =                       
                      (PV-PADJ-DISC-COST-AMT    *                               
                       PV-PCT) / 100                                            
               COMPUTE PV-PADJ-DISC-COST-AMT-REM =                              
                       PV-PADJ-DISC-COST-AMT-REM -                              
                       ML254-PADJ-DISC-COST-AMT                                 
               COMPUTE ML254-PADJ-RTV-COST-AMT ROUNDED =                        
                      (PV-PADJ-RTV-COST-AMT     *                               
                       PV-PCT) / 100                                            
               COMPUTE PV-PADJ-RTV-COST-AMT-REM =                               
                       PV-PADJ-RTV-COST-AMT-REM -                               
                       ML254-PADJ-RTV-COST-AMT                                  
      *        COMPUTE ML254-PADJ-RTV-RTL-AMT ROUNDED =                         
      *               (PV-PADJ-RTV-RTL-AMT      *                               
      *                PV-PCT) / 100                                            
      *        COMPUTE PV-PADJ-RTV-RTL-AMT-REM  =                               
      *                PV-PADJ-RTV-RTL-AMT-REM  -                               
      *                ML254-PADJ-RTV-RTL-AMT                                   
               COMPUTE ML254-PADJ-DA-COST-AMT ROUNDED =                         
                      (PV-PADJ-DA-COST-AMT      *                               
                       PV-PCT) / 100                                            
               COMPUTE PV-PADJ-DA-COST-AMT-REM  =                               
                       PV-PADJ-DA-COST-AMT-REM  -                               
                       ML254-PADJ-DA-COST-AMT                                   
      *        COMPUTE ML254-PADJ-DA-RTL-AMT ROUNDED =                          
      *               (PV-PADJ-DA-RTL-AMT       *                               
      *                PV-PCT) / 100                                            
      *        COMPUTE PV-PADJ-DA-RTL-AMT-REM   =                               
      *                PV-PADJ-DA-RTL-AMT-REM   -                               
      *                ML254-PADJ-DA-RTL-AMT                                    
               COMPUTE ML254-PADJ-NET-COST-AMT ROUNDED =                        
                      (PV-PADJ-NET-COST-AMT     *                               
                       PV-PCT) / 100                                            
               COMPUTE PV-PADJ-NET-COST-AMT-REM =                               
                       PV-PADJ-NET-COST-AMT-REM -                               
                       ML254-PADJ-NET-COST-AMT                                  
               COMPUTE ML254-PADJ-OTH-COST-AMT ROUNDED =                        
                      (PV-PADJ-OTH-COST-AMT     *                               
                       PV-PCT) / 100                                            
               COMPUTE PV-PADJ-OTH-COST-AMT-REM =                               
                       PV-PADJ-OTH-COST-AMT-REM -                               
                       ML254-PADJ-OTH-COST-AMT                                  
      *        COMPUTE ML254-PADJ-OTH-RTL-AMT ROUNDED =                         
      *               (PV-PADJ-OTH-RTL-AMT      *                               
      *                PV-PCT) / 100                                            
      *        COMPUTE PV-PADJ-OTH-RTL-AMT-REM  =                               
      *                PV-PADJ-OTH-RTL-AMT-REM  -                               
      *                ML254-PADJ-OTH-RTL-AMT                                   
W34517         MOVE PT-LF-LABEL-SEQ (PT-LF-INDX)                                
W34517           TO ML254-LBL-SEQ-NBR                                           
W34517         MOVE PT-LF-ENT-ID    (PT-LF-INDX)                                
W34517           TO ML254-ENT-ID                                                
               MOVE PT-LF-DKEY (PT-LF-INDX)                                     
                 TO ML254-ML-LWST-ID                                            
W34517         IF PV-PCT >= ZERO                                                
W34517             IF PV-PCT > PV-LARGEST-PCT-POS                               
W34517                 MOVE PV-PCT TO PV-LARGEST-PCT-POS                        
W34517                 MOVE PT-LF-LABEL-SEQ (PT-LF-INDX)                        
W34517                   TO PV-LARGEST-LBL-SEQ-POS                              
W34517                 MOVE PT-LF-ENT-ID (PT-LF-INDX)                           
W34517                   TO PV-LARGEST-ENT-ID-POS                               
W34517                 MOVE PT-LF-DKEY (PT-LF-INDX)                             
W34517                   TO PV-LARGEST-DKEY-POS                                 
W34517             END-IF                                                       
W34517         ELSE                                                             
W34517             IF PV-PCT < PV-LARGEST-PCT-NEG                               
W34517                 MOVE PV-PCT TO PV-LARGEST-PCT-NEG                        
W34517                 MOVE PT-LF-LABEL-SEQ (PT-LF-INDX)                        
W34517                   TO PV-LARGEST-LBL-SEQ-NEG                              
W34517                 MOVE PT-LF-ENT-ID (PT-LF-INDX)                           
W34517                   TO PV-LARGEST-ENT-ID-NEG                               
W34517                 MOVE PT-LF-DKEY (PT-LF-INDX)                             
W34517                   TO PV-LARGEST-DKEY-NEG                                 
W34517             END-IF                                                       
W34517         END-IF                                                           
      * WRITE RE-ALLOCATION TRANSACTION                                         
               PERFORM Z310-WRITE-TRANSACTION                                   
               ADD 1 TO PV-REALLOCATIONS-WRITTEN                                
           END-PERFORM                                                          
                                                                                
      *    MOVE PV-PADJ-RTL-AMT-REM                                             
      *      TO ML254-PADJ-RTL-AMT                                              
           MOVE PV-PADJ-FRGT-COST-AMT-REM                                       
             TO ML254-PADJ-FRGT-COST-AMT                                        
           MOVE PV-PADJ-DISC-COST-AMT-REM                                       
             TO ML254-PADJ-DISC-COST-AMT                                        
           MOVE PV-PADJ-RTV-COST-AMT-REM                                        
             TO ML254-PADJ-RTV-COST-AMT                                         
      *    MOVE PV-PADJ-RTV-RTL-AMT-REM                                         
      *      TO ML254-PADJ-RTV-RTL-AMT                                          
           MOVE PV-PADJ-DA-COST-AMT-REM                                         
             TO ML254-PADJ-DA-COST-AMT                                          
      *    MOVE PV-PADJ-DA-RTL-AMT-REM                                          
      *      TO ML254-PADJ-DA-RTL-AMT                                           
           MOVE PV-PADJ-NET-COST-AMT-REM                                        
             TO ML254-PADJ-NET-COST-AMT                                         
           MOVE PV-PADJ-OTH-COST-AMT-REM                                        
             TO ML254-PADJ-OTH-COST-AMT                                         
      *    MOVE PV-PADJ-OTH-RTL-AMT-REM                                         
      *      TO ML254-PADJ-OTH-RTL-AMT                                          
W34517*    MOVE PT-LF-DKEY (PT-LF-INDX)                                         
W34517*      TO ML254-ML-LWST-ID                                                
W34517     IF PV-PADJ-NET-COST-AMT-REM >= ZERO                                  
W34517         IF PV-LARGEST-DKEY-POS NOT = ZERO                                
W34517             MOVE PV-LARGEST-LBL-SEQ-POS                                  
W34517               TO ML254-LBL-SEQ-NBR                                       
W34517             MOVE PV-LARGEST-ENT-ID-POS                                   
W34517               TO ML254-ENT-ID                                            
W34517             MOVE PV-LARGEST-DKEY-POS                                     
W34517               TO ML254-ML-LWST-ID                                        
W34517         END-IF                                                           
W34517     ELSE                                                                 
W34517         IF PV-LARGEST-DKEY-NEG NOT = ZERO                                
W34517             MOVE PV-LARGEST-LBL-SEQ-NEG                                  
W34517               TO ML254-LBL-SEQ-NBR                                       
W34517             MOVE PV-LARGEST-ENT-ID-NEG                                   
W34517               TO ML254-ENT-ID                                            
W34517             MOVE PV-LARGEST-DKEY-NEG                                     
W34517               TO ML254-ML-LWST-ID                                        
W34517         END-IF                                                           
W34517     END-IF.                                                              
      * WRITE RE-ALLOCATION REMAINDER TRANSACTION                               
           PERFORM Z310-WRITE-TRANSACTION.                                      
           ADD 1 TO PV-REALLOCATIONS-WRITTEN.                                   
                                                                                
      ******************************************************************        
      *    FINALIZE AND CLOSE OUT FILES                                         
      ******************************************************************        
       B900-FINALIZE.                                                           
                                                                                
           DISPLAY ' **** TOTAL FREIGHT SALVAGE LOADED : '                      
                          PV-FREIGHT-SALVAGE-LOADED                             
           DISPLAY ' **** TOTAL LICENSE FEES LOADED    : '                      
                          PV-LICENSE-FEES-LOADED                                
           DISPLAY ' **** TOTAL VENDORS READ           : '                      
                          PV-VENDORS-READ                                       
           DISPLAY ' **** TOTAL VENDORS PROCESSED      : '                      
                          PV-VENDORS-PROCESSED                                  
           DISPLAY ' **** TOTAL VENDORS DUPLICATES     : '                      
                          PV-VENDORS-DUPLICATES                                 
           DISPLAY ' **** TOTAL FETCHED                : '                      
                          PV-TOT-FETCHED                                        
           DISPLAY ' **** TOTAL PADJ FETCHED           : '                      
                          PV-PADJ-FETCHED                                       
           DISPLAY ' **** TOTAL REVERSALS WRITTEN      : '                      
                          PV-REVERSALS-WRITTEN                                  
           DISPLAY ' **** TOTAL RE-ALLOCATIONS WRITTEN : '                      
                          PV-REALLOCATIONS-WRITTEN                              
           DISPLAY ' **** TOTAL TRANSACTIONS WRITTEN   : '                      
                          PV-TOT-TRANS-WRITTEN                                  
W34517     DISPLAY ' **** TOTAL TSL NOT FOUND WRITTEN  : '                      
W34517                    PV-TOT-TSL-NOTFND-WRITTEN                             
W34517     DISPLAY ' **** TOTAL LIC NOT FOUND WRITTEN  : '                      
W34517                    PV-TOT-LIC-NOTFND-WRITTEN                             
W37965     DISPLAY ' **** TOTAL PADJ AUDIT WRITTEN     : '                      
W37965                    PV-TOT-PADJ-AUDIT-WRITTEN                             
W37965     DISPLAY ' **** TOTAL PGHG AUDIT WRITTEN     : '                      
W37965                    PV-TOT-PCHG-AUDIT-WRITTEN                             
                                                                                
           CLOSE   DATE-FILE                                                    
                   FREIGHT-SALVAGE-FILE                                         
                   LICENSE-FEES-FILE                                            
                   VENDOR-FILE                                                  
                   ADJUSTMENT-FILE                                              
W34517             TSL-DIST-NOTFND-FILE                                         
W34517             LIC-DIST-NOTFND-FILE                                         
W37965             DTL-AUDIT-PADJ-FILE                                          
W37965             DTL-AUDIT-PCHG-FILE.                                         
                                                                                
                                                                                
      ******************************************************************        
      *    PROCESS REQUEST CONTROL CARD AND/OR GET REQUEST DATES                
      ******************************************************************        
       C100-PROCESS-RQ-CNTL.                                                    
                                                                                
           PERFORM Z500-READ-DATES.                                             
                                                                                
W34517*    DISPLAY ' '.                                                         
W34517*    DISPLAY 'FISCAL BEG DATE: ' CC-FSCL-BEG-DTE                          
W34517*    DISPLAY 'FISCAL END DATE: ' CC-FSCL-END-DTE                          
W34517*    DISPLAY ' '.                                                         
                                                                                
      ******************************************************************        
      *    READ VENDOR FILE                                                     
      ******************************************************************        
       Z100-READ-VENDOR.                                                        
           READ VENDOR-FILE                                                     
W37965         INTO ML363-VNDR-REC                                              
               AT END SET END-OF-VENDORS TO TRUE.                               
                                                                                
           IF NOT END-OF-VENDORS                                                
               ADD 1 TO PV-VENDORS-READ                                         
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * READ FREIGHT SALVAGE                                                    
      ******************************************************************        
       Z110-READ-FREIGHT-SALVAGE.                                               
                                                                                
           READ FREIGHT-SALVAGE-FILE INTO MLRD-FREIGHT-SALVAGE-REC              
               AT END                                                           
                  SET PS-FREIGHT-SALVAGE-EOF TO TRUE.                           
                                                                                
      ******************************************************************        
      * READ LICENSE FEES                                                       
      ******************************************************************        
       Z120-READ-LICENSE-FEES.                                                  
                                                                                
           READ LICENSE-FEES-FILE INTO MLRD-LICENSE-FEES-REC                    
               AT END                                                           
                  SET PS-LICENSE-FEES-EOF TO TRUE.                              
                                                                                
      ******************************************************************        
      *    OPEN DEPARTMENT CURSOR                                               
      *    - GET DEPARTMENTS FOR VENDOR AND UNKNOWN BRAND                       
      ******************************************************************        
       Z170-OPEN-DEPT-CSR.                                                      
                                                                                
           EXEC SQL                                                             
               OPEN DEPT_CSR                                                    
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = +0                                                      
               SET NOT-END-OF-DEPT-CSR TO TRUE                                  
           ELSE                                                                 
               DISPLAY 'ENT_ID     : ' MLV00000-ENT-ID                          
               DISPLAY 'LBL_SEQ_NBR: ' PC-UNKNOWN-BRAND                         
               MOVE SQLCODE            TO PV-SQLCODE                            
               DISPLAY 'SQLCODE    : ' PV-SQLCODE                               
               MOVE 'OPEN DEPT_CSR   ' TO PV-OPER-ATTEMPTED                     
               PERFORM Z950-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    FETCH THE NEXT ROW FROM THE DEPT_CSR CURSOR                          
      ******************************************************************        
       Z180-FETCH-DEPT-CSR.                                                     
           EXEC SQL                                                             
             FETCH DEPT_CSR                                                     
              INTO  :MLV00000-ML-LO-MDSE-LVL-ID                                 
                   ,:MLV00000-DEPT-NBR                                          
                   ,:MLV00000-LBL-SEQ-NBR                                       
                   ,:MLV00000-ENT-ID                                            
                   ,:MLV00000-EFF-BEG-DTE                                       
                   ,:MLV00000-EFF-END-DTE                                       
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   ADD +1                  TO PV-FETCHED                        
                                              PV-TOT-FETCHED                    
                   DISPLAY 'LVD ID     :' MLV00000-ML-LO-MDSE-LVL-ID            
P18333*            DISPLAY 'DEPT NO    :' MLV00000-DEPT-NBR                     
P18333*            DISPLAY 'LBL SEQ    :' MLV00000-LBL-SEQ-NBR                  
                   DISPLAY 'ENT ID     :' MLV00000-ENT-ID                       
P18333*            DISPLAY 'BIGN DATE  :' MLV00000-EFF-BEG-DTE                  
P18333*            DISPLAY 'END DATE   :' MLV00000-EFF-END-DTE                  
               WHEN +100                                                        
                   SET END-OF-DEPT-CSR TO TRUE                                  
               WHEN OTHER                                                       
                   MOVE 'FETCH DEPT_CSR' TO    PV-OPER-ATTEMPTED                
                   PERFORM Z950-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *    CLOSE THE DEPT_CSR                                                   
      ******************************************************************        
       Z190-CLOSE-DEPT-CSR.                                                     
                                                                                
           EXEC SQL                                                             
                CLOSE DEPT_CSR                                                  
           END-EXEC                                                             
           IF SQLCODE NOT = +0                                                  
               MOVE 'CLOSE DEPT_CSR    ' TO PV-OPER-ATTEMPTED                   
               PERFORM Z950-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    OPEN PURCHASE ADJUSTMENT SUMS CURSOR                                 
      ******************************************************************        
       Z200-OPEN-PADJ-SUM-CSR.                                                  
           EXEC SQL                                                             
               OPEN PADJ_SUM_CSR                                                
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = +0                                                      
               SET NOT-END-OF-PADJ-SUM-CSR TO TRUE                              
           ELSE                                                                 
               DISPLAY '*** DEPT_NBR          ' MLT00004-DEPT-NBR               
               DISPLAY '*** ML_LO_MDSE_LVL_ID '                                 
                                              MLT00004-ML-LO-MDSE-LVL-ID        
               MOVE 'OPEN PADJ_SUM_CSR ' TO PV-OPER-ATTEMPTED                   
               PERFORM Z950-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    FETCH THE NEXT ROW FROM THE PADJ_SUM_CSR CURSOR                      
      ******************************************************************        
       Z210-FETCH-PADJ-SUM-CSR.                                                 
           EXEC SQL                                                             
             FETCH PADJ_SUM_CSR                                                 
               INTO  :MLT00004-DEPT-NBR                                         
                    ,:MLT00004-MAJ-CL-NBR                                       
                    ,:MLT00004-SUB-CL-NBR                                       
                    ,:MLT00004-LOC-NBR                                          
                    ,:MLT00004-ML-LO-MDSE-LVL-ID                                
                    ,:MLT00004-PADJ-RTL-AMT                                     
                    ,:MLT00004-PADJ-FRGT-COST-AMT                               
                    ,:MLT00004-PADJ-DISC-COST-AMT                               
                    ,:MLT00004-PADJ-RTV-COST-AMT                                
                    ,:MLT00004-PADJ-RTV-RTL-AMT                                 
                    ,:MLT00004-PADJ-DA-COST-AMT                                 
                    ,:MLT00004-PADJ-DA-RTL-AMT                                  
                    ,:MLT00004-PADJ-NET-COST-AMT                                
                    ,:MLT00004-PADJ-OTH-COST-AMT                                
                    ,:MLT00004-PADJ-OTH-RTL-AMT                                 
                    ,:MLT00004-MKDN-PLU-RTL-AMT                                 
                    ,:MLT00004-MKDN-PROMO-RTL-AMT                               
                    ,:MLT00004-MKDN-RGST-RTL-AMT                                
                    ,:MLT00004-MKDN-GLDST-RTL-AMT                               
                    ,:MLT00004-MKDN-UMTCH-RTL-AMT                               
                    ,:MLT00004-MKDN-BYR-RTL-AMT                                 
                    ,:MLT00004-MKDN-STR-RTL-AMT                                 
                    ,:MLT00004-MKDN-PRPT-RTL-AMT                                
                    ,:MLT00004-MKDN-OTH-RTL-AMT                                 
                    ,:MLT00004-MKDN-RTL-AMT                                     
                    ,:MLT00004-DR-ALW-RTL-AMT                                   
                    ,:MLT00004-RTV-RTL-AMT                                      
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   ADD +1                  TO PV-PADJ-FETCHED                   
W34517             IF MLT00004-PADJ-RTL-AMT       = ZERO AND                    
W34517                MLT00004-PADJ-FRGT-COST-AMT = ZERO AND                    
W34517                MLT00004-PADJ-DISC-COST-AMT = ZERO AND                    
W34517                MLT00004-PADJ-RTV-COST-AMT  = ZERO AND                    
W34517                MLT00004-PADJ-RTV-RTL-AMT   = ZERO AND                    
W34517                MLT00004-PADJ-DA-COST-AMT   = ZERO AND                    
W34517                MLT00004-PADJ-DA-RTL-AMT    = ZERO AND                    
W34517                MLT00004-PADJ-NET-COST-AMT  = ZERO AND                    
W34517                MLT00004-PADJ-OTH-COST-AMT  = ZERO AND                    
W34517                MLT00004-PADJ-OTH-RTL-AMT   = ZERO AND                    
W34517                MLT00004-MKDN-PLU-RTL-AMT   = ZERO AND                    
W34517                MLT00004-MKDN-PROMO-RTL-AMT = ZERO AND                    
W34517                MLT00004-MKDN-RGST-RTL-AMT  = ZERO AND                    
W34517                MLT00004-MKDN-GLDST-RTL-AMT = ZERO AND                    
W34517                MLT00004-MKDN-UMTCH-RTL-AMT = ZERO AND                    
W34517                MLT00004-MKDN-BYR-RTL-AMT   = ZERO AND                    
W34517                MLT00004-MKDN-STR-RTL-AMT   = ZERO AND                    
W34517                MLT00004-MKDN-PRPT-RTL-AMT  = ZERO AND                    
W34517                MLT00004-MKDN-OTH-RTL-AMT   = ZERO AND                    
W34517                MLT00004-MKDN-RTL-AMT       = ZERO AND                    
W34517                MLT00004-DR-ALW-RTL-AMT     = ZERO AND                    
W34517                MLT00004-RTV-RTL-AMT        = ZERO                        
W34517                 SET MNLY-AMTS-ZERO     TO TRUE                           
W34517             ELSE                                                         
W34517                 SET MNLY-AMTS-NOT-ZERO TO TRUE                           
W34517             END-IF                                                       
               WHEN +100                                                        
                   DISPLAY 'END OF PADJ-SUM-CSR'                                
                   SET END-OF-PADJ-SUM-CSR TO TRUE                              
               WHEN OTHER                                                       
                   MOVE 'FETCH PADJ_SUM_CSR' TO    PV-OPER-ATTEMPTED            
                   PERFORM Z950-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *    CLOSE THE PADJ_SUM_CSR                                               
      ******************************************************************        
       Z220-CLOSE-PADJ-SUM-CSR.                                                 
           EXEC SQL                                                             
                CLOSE PADJ_SUM_CSR                                              
           END-EXEC                                                             
           IF SQLCODE NOT = +0                                                  
               MOVE 'CLOSE PADJ_SUM_CSR' TO PV-OPER-ATTEMPTED                   
               PERFORM Z950-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *  GET PARTITION INFORMATION FOR A GIVEN FISCAL DATE                      
      ******************************************************************        
       Z300-GET-PARTN-INFO.                                                     
           EXEC SQL                                                             
               SELECT                                                           
                       B.PARTN_NBR                                              
                      ,B.DEPT_GP_CDE                                            
                      ,D.FSCL_MN_NBR                                            
                      ,D.FSCL_WK_NBR                                            
                      ,D.PFM_END_DTE                                            
                      ,D.PFW_END_DTE                                            
                      ,D.FSCL_MN_END_DTE                                        
                      ,D.FSCL_WK_END_DTE                                        
                      ,D.SEA_END_DTE                                            
                 INTO                                                           
                       :MLT00003-PARTN-NBR                                      
                      ,:MLT00003-DEPT-GP-CDE                                    
                      ,:DTATTR-FSCL-MN-NBR                                      
                      ,:DTATTR-FSCL-WK-NBR                                      
                      ,:DTATTR-PFM-END-DTE                                      
                      ,:DTATTR-PFW-END-DTE                                      
                      ,:DTATTR-FSCL-MN-END-DTE                                  
                      ,:DTATTR-FSCL-WK-END-DTE                                  
                      ,:DTATTR-SEA-END-DTE                                      
                 FROM                                                           
                       MLT_PARTN_CNTL  B                                        
                      ,TDTATTR         D                                        
                 WHERE                                                          
                       B.TBL_TM_LVL_CDE = :MLT00003-TBL-TM-LVL-CDE              
                   AND B.FSCL_DTE = :MLT00003-FSCL-DTE                          
                   AND B.DEPT_GP_CDE IN (                                       
                         SELECT  C.DEPT_GP_CDE                                  
                           FROM  MLT_PARTN_BAL  C                               
                           WHERE C.TBL_TM_LVL_CDE                               
                                     = :MLT00003-TBL-TM-LVL-CDE                 
                             AND C.DEPT_NBR = :MLT00002-DEPT-NBR                
                             AND :MLT00003-FSCL-DTE                             
                                 BETWEEN C.EFF_BEG_DTE AND                      
                                     VALUE (C.EFF_END_DTE,                      
                                         '9999-12-30')                          
                           )                                                    
                   AND KY_DTE = :MLT00003-FSCL-DTE                              
               WITH UR                                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   CONTINUE                                                     
               WHEN +100                                                        
                   DISPLAY ' TABLE LEVEL: ' MLT00003-TBL-TM-LVL-CDE             
                           ' FISCAL DATE: ' MLT00003-FSCL-DTE                   
                   MOVE 'SELECT CURR PARTN_CNTL'                                
                                               TO PV-OPER-ATTEMPTED             
                   MOVE 'Z300-GET-PARTN-INFO ' TO PV-PARAGRAPH-NAME             
                   PERFORM Z950-SQL-ABEND                                       
               WHEN OTHER                                                       
                   DISPLAY ' TABLE LEVEL: ' MLT00003-TBL-TM-LVL-CDE             
                           ' FISCAL DATE: ' MLT00003-FSCL-DTE                   
                   MOVE 'SELECT CURR PARTN_CNTL'                                
                                               TO PV-OPER-ATTEMPTED             
                   MOVE 'Z300-GET-PARTN-INFO ' TO PV-PARAGRAPH-NAME             
                   PERFORM Z950-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      * WRITE ADJUSTMENT TRANSACTION (MLRD254 FORMAT)                           
      ******************************************************************        
       Z310-WRITE-TRANSACTION.                                                  
                                                                                
           WRITE ADJUSTMENT-REC FROM ML254-UPDATE-REC.                          
           ADD 1 TO PV-TOT-TRANS-WRITTEN                                        
W37965     PERFORM Z600-WRITE-AUDIT-DTL.                                        
W34517******************************************************************        
W34517* WRITE TRANS, SALVAGE DIST PCT NOT FOUND RECORD (MLRD084 FORMAT)         
W34517******************************************************************        
W34517 Z320-WRITE-TSL-DIST-NOTFND.                                              
W34517                                                                          
W34517     IF PV-TOT-TSL-NOTFND-WRITTEN = ZERO                                  
W34517         MOVE SPACES TO ML084-HEADER                                      
W34157         MOVE PC-TSL-DIST-NOTFND-HEADER TO ML084-HEADER                   
W34517         WRITE TSL-DIST-NOTFND-REC FROM ML084-DIST-PCT-NOTFND             
W34157         MOVE PC-DIST-NOTFND-HEADER     TO ML084-HEADER                   
W34517         WRITE TSL-DIST-NOTFND-REC FROM ML084-DIST-PCT-NOTFND             
W34517     END-IF                                                               
W34517                                                                          
W34517     MOVE SPACES TO ML084-HEADER.                                         
W34517     INITIALIZE ML084-DIST-PCT-NOTFND.                                    
W34517     MOVE MLV00000-DEPT-NBR            TO ML084-DEPT-NBR.                 
W34517     MOVE MLV00000-ENT-ID              TO ML084-ENT-ID                    
W34517                                          XMT00000-ENT-ID.                
W34517     PERFORM Z400-GET-VENDOR-NAME.                                        
W34517     MOVE XMT00000-PRIM-VND-NM         TO ML084-ENT-NAME.                 
W34517     PERFORM Z410-SUM-MNLY-AMTS.                                          
W34517     MOVE PV-TOT-PADJ-RTL-AMT          TO ML084-PADJ-RTL-AMT.             
W34517     MOVE PV-TOT-PADJ-NET-COST-AMT     TO ML084-PADJ-NET-COST-AMT.        
W34517     MOVE PV-TOT-MKDN-RTL-AMT          TO ML084-MKDN-RTL-AMT.             
W34517     WRITE TSL-DIST-NOTFND-REC FROM ML084-DIST-PCT-NOTFND.                
W34517     ADD 1 TO PV-TOT-TSL-NOTFND-WRITTEN.                                  
W34517                                                                          
W34517******************************************************************        
W34517* WRITE LICENSE FEE DIST PCT NOT FOUND RECORD (MLRD084 FORMAT)            
W34517******************************************************************        
W34517 Z330-WRITE-LIC-DIST-NOTFND.                                              
W34517                                                                          
W34517     IF PV-TOT-LIC-NOTFND-WRITTEN = ZERO                                  
W34517         MOVE SPACES TO ML084-HEADER                                      
W34157         MOVE PC-LIC-DIST-NOTFND-HEADER TO ML084-HEADER                   
W34517         WRITE LIC-DIST-NOTFND-REC FROM ML084-DIST-PCT-NOTFND             
W34157         MOVE PC-DIST-NOTFND-HEADER TO ML084-HEADER                       
W34517         WRITE LIC-DIST-NOTFND-REC FROM ML084-DIST-PCT-NOTFND             
W34517     END-IF                                                               
W34517                                                                          
W34517     MOVE SPACES TO ML084-HEADER.                                         
W34517     INITIALIZE ML084-DIST-PCT-NOTFND.                                    
W34517     MOVE MLV00000-DEPT-NBR            TO ML084-DEPT-NBR.                 
W34517     MOVE MLV00000-ENT-ID              TO ML084-ENT-ID.                   
W34517     MOVE MLV00000-ENT-ID              TO ML084-ENT-ID                    
W34517                                          XMT00000-ENT-ID.                
W34517     PERFORM Z400-GET-VENDOR-NAME.                                        
W34517     MOVE XMT00000-PRIM-VND-NM         TO ML084-ENT-NAME.                 
W34517     PERFORM Z410-SUM-MNLY-AMTS.                                          
W34517     MOVE PV-TOT-PADJ-RTL-AMT          TO ML084-PADJ-RTL-AMT.             
W34517     MOVE PV-TOT-PADJ-NET-COST-AMT     TO ML084-PADJ-NET-COST-AMT.        
W34517     MOVE PV-TOT-MKDN-RTL-AMT          TO ML084-MKDN-RTL-AMT.             
W34517     WRITE LIC-DIST-NOTFND-REC FROM ML084-DIST-PCT-NOTFND.                
W34517     ADD 1 TO PV-TOT-LIC-NOTFND-WRITTEN.                                  
W34517                                                                          
W34517******************************************************************        
W34517*  GET THE VENDOR NAME FROM XMT_VND                                       
W34517******************************************************************        
W34517 Z400-GET-VENDOR-NAME.                                                    
W34517                                                                          
W34517     EXEC SQL                                                             
W34517        SELECT   PRIM_VND_NM                                              
W34517          INTO  :XMT00000-PRIM-VND-NM                                     
W34517          FROM   XMT_VND                                                  
W34517         WHERE   ENT_ID = :XMT00000-ENT-ID                                
W34517        WITH UR                                                           
W34517     END-EXEC.                                                            
W34517                                                                          
W34517     IF SQLCODE = +0                                                      
W34517         INSPECT XMT00000-PRIM-VND-NM                                     
W34517                                REPLACING ALL ',' BY ' '                  
W34517     ELSE                                                                 
W34517         IF SQLCODE = +100                                                
W34517             MOVE PC-UNKNOWN         TO XMT00000-PRIM-VND-NM              
W34517     ELSE                                                                 
W34517         DISPLAY ' ENT-ID: ' XMT00000-ENT-ID                              
W34517         MOVE 'SELECT XMT_VND     '  TO PV-OPER-ATTEMPTED                 
W34517         MOVE 'Z410-SUM-MNLY-AMTS  ' TO PV-PARAGRAPH-NAME                 
W34517         PERFORM Z950-SQL-ABEND                                           
W34517     END-IF.                                                              
W34517                                                                          
W34517******************************************************************        
W34517*    SUM AMOUNTS FOR DEPT, DKEY                                           
W34517******************************************************************        
W34517 Z410-SUM-MNLY-AMTS.                                                      
W34517                                                                          
W34517     EXEC SQL                                                             
W34517         SELECT VALUE(SUM(PADJ_RTL_AMT),0)                                
W34517               ,VALUE(SUM(PADJ_NET_COST_AMT),0)                           
W34517               ,VALUE(SUM(MKDN_RTL_AMT),0)                                
W34517         INTO  :PV-TOT-PADJ-RTL-AMT                                       
W34517              ,:PV-TOT-PADJ-NET-COST-AMT                                  
W34517              ,:PV-TOT-MKDN-RTL-AMT                                       
W34517         FROM MLT_MNLY_SUM                                                
W34517         WHERE PARTN_NBR IN                                               
W34517                  (SELECT PARTN_NBR                                       
W34517                     FROM MLT_PARTN_CNTL                                  
W34517                    WHERE TBL_TM_LVL_CDE = :PC-MONTHLY-TM-LVL-CDE         
W34517                      AND FSCL_DTE BETWEEN :DTATTR-FSCL-MN-BEG-DTE        
W34517                                      AND :DTATTR-FSCL-MN-END-DTE)        
W34517           AND DEPT_NBR          = :MLT00004-DEPT-NBR                     
W34517           AND ML_LO_MDSE_LVL_ID = :MLT00004-ML-LO-MDSE-LVL-ID            
W34517          WITH UR                                                         
W34517     END-EXEC.                                                            
W34517                                                                          
W34517     EVALUATE SQLCODE                                                     
W34517         WHEN +0                                                          
W34517             CONTINUE                                                     
W34517         WHEN OTHER                                                       
W34517             DISPLAY ' DEPT_NBR        : ' MLT00004-DEPT-NBR              
W34517             DISPLAY ' ML_LO_MDSE_LVL_ID: '                               
W34517                                        MLT00004-ML-LO-MDSE-LVL-ID        
W34517             MOVE 'SELECT MLT_MNLY_SUM   '                                
W34517                                         TO PV-OPER-ATTEMPTED             
W34517             MOVE 'Z410-SUM-MNLY-AMTS  ' TO PV-PARAGRAPH-NAME             
W34517             PERFORM Z950-SQL-ABEND                                       
W34517     END-EVALUATE.                                                        
W34517                                                                          
      ******************************************************************        
      *    READ DATE CONTROL CARD                                               
      ******************************************************************        
       Z500-READ-DATES.                                                         
                                                                                
           READ DATE-FILE                                                       
               INTO CC-CONTROL-CARD                                             
               AT END SET END-OF-DATES TO TRUE.                                 
W37965******************************************************************        
W37965*    WRITE AUDIT DETAIL                                                   
W37965******************************************************************        
W37965 Z600-WRITE-AUDIT-DTL.                                                    
W37965     INITIALIZE ML090-AUDIT-REC                                           
W37965     MOVE CC-FSCL-WK-END-DTE      TO ML090-FSCL-WK-END-DTE                
W37965     MOVE CC-FSCL-WK-END-DTE      TO ML090-PRCG-DTE                       
W37965     IF ML363-EXP-TYP = 1 OR 2                                            
W37965         MOVE 'BVFRS'             TO ML090-FINCL-PRC-GP-CDE               
W37965     ELSE                                                                 
W37965         MOVE 'BVLIC'             TO ML090-FINCL-PRC-GP-CDE               
W37965     END-IF                                                               
W37965     MOVE '9'                     TO ML090-SRC-SYS-ID                     
W37965     MOVE ML254-DEPT-NBR          TO ML090-DEPT-NBR                       
W37965     MOVE ML254-MAJ-CL-NBR        TO ML090-MAJ-CL-NBR                     
W37965     MOVE ML254-SUB-CL-NBR        TO ML090-SUB-CL-NBR                     
W37965     MOVE ML254-LOC-NBR           TO ML090-LOC-NBR                        
W37965     MOVE ML254-ML-LWST-ID        TO ML090-ML-LO-MDSE-LVL-ID              
W37965     MOVE ML363-ENT-ID            TO ML090-ORIG-ENT-ID                    
W37965     MOVE PC-UNKNOWN-BRAND        TO ML090-ORIG-LBL-SEQ-NBR               
W37965     MOVE '015'                   TO ML090-TRN-TYP-CDE                    
W37965     MOVE ML254-ENT-ID            TO ML090-ENT-ID                         
W37965     MOVE ML254-LBL-SEQ-NBR       TO ML090-LBL-SEQ-NBR                    
W37965     MOVE ML254-PADJ-NET-COST-AMT TO ML090-PADJ-NET-COST-AMT              
W37965     MOVE ML254-PADJ-GRO-COST-AMT TO ML090-PADJ-GRO-COST-AMT              
W37965     MOVE ML254-PADJ-DISC-COST-AMT TO ML090-PADJ-DISC-COST-AMT            
W37965     MOVE ML254-PADJ-RTL-AMT      TO ML090-PADJ-RTL-AMT                   
W37965     MOVE 'N'                     TO ML090-DUMMY-SKU-IND                  
W37965     EVALUATE TRUE                                                        
W37965         WHEN ML254-PRORATE-REVERSAL                                      
W37965             MOVE '02'                  TO ML090-DR-CR-CDE                
W37965             SET ML090-PRORATE-REVERSAL TO TRUE                           
W37965         WHEN ML254-PRORATE-ALLOCATE                                      
W37965             MOVE '01'                  TO ML090-DR-CR-CDE                
W37965             SET ML090-PRORATE-ALLOCATE TO TRUE                           
W37965     END-EVALUATE                                                         
W37965     WRITE DTL-AUDIT-PADJ-RECORD FROM ML090-AUDIT-REC                     
W37965     ADD 1                        TO PV-TOT-PADJ-AUDIT-WRITTEN            
W37965     IF ML363-EXP-TYP-SALVAGE                                             
W37965           MOVE '040'              TO ML090-TRN-TYP-CDE                   
W37965           MOVE ML254-MKDN-RTL-AMT TO ML090-PRCHG-RTL-AMT                 
W37965           WRITE DTL-AUDIT-PCHG-RECORD FROM ML090-AUDIT-REC               
W37965           ADD 1                   TO PV-TOT-PCHG-AUDIT-WRITTEN           
W37965     END-IF.                                                              
      ******************************************************************        
      *    SQL ERROR - ABEND                                                    
      ******************************************************************        
       Z950-SQL-ABEND.                                                          
                                                                                
           MOVE +4013                 TO ABEND-CODE.                            
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   **  =  MLKUT361'.                             
           DISPLAY '**  OPERATION **  = '  PV-OPER-ATTEMPTED                    
           DISPLAY '**  PARAGRAPH **  = '  PV-PARAGRAPH-NAME                    
                                                                                
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE                 
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.                
                                                                                
           COPY DPPD004.                                                        
                                                                                
           PERFORM Z999-ABEND.                                                  
                                                                                
      ******************************************************************        
      *    ABEND CALL                                                           
      ******************************************************************        
       Z999-ABEND.                                                              
                                                                                
           CALL 'ILBOABN0'  USING ABEND-CODE.                                   
                                                                                
