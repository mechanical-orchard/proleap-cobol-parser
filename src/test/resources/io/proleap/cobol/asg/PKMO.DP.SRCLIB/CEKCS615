000100*-----------------------*                                         00010089
000200 IDENTIFICATION DIVISION.                                         00020089
000300*-----------------------*                                         00030089
000400 PROGRAM-ID.    CEKCS615.                                         00040089
000500 AUTHOR.        JOE LAROSA.                                       00050089
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060089
000700 DATE-WRITTEN.  JULY 2000.                                        00070089
000800 DATE-COMPILED.                                                   00080089
000900*---------------------------------------------------------------* 00090089
001000*    S615 - CENTRAL STOCK STORE ADJUSTMENT REASON               * 00100089
001100*---------------------------------------------------------------* 00110089
CICS  * CHANGED 10/20/2022    BY JIM HUNTER      WR: CHG0276924         00111095
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00112094
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00113094
CICS  *-----------------------------------------------------------------00114094
001200 ENVIRONMENT DIVISION.                                            00120089
001300 DATA DIVISION.                                                   00130089
001400                                                                  00140089
001500 WORKING-STORAGE SECTION.                                         00150089
001600 01  PS-PROGRAM-SWITCHES.                                         00160089
001700     05  PS-COMMAREA-SW            PIC X(01) VALUE 'N'.           00170089
001800         88  PS-COMMAREA-VALID               VALUE 'Y'.           00180089
001900         88  PS-COMMAREA-NOT-VALID           VALUE 'N'.           00190089
002000     05  PS-LIST-END-SW            PIC X(01) VALUE 'N'.           00200089
002100         88  PS-LIST-END                     VALUE 'Y'.           00210089
002200         88  PS-NO-LIST-END                  VALUE 'N'.           00220089
002300     05  PS-LNAME-DONE-SW          PIC X(01) VALUE 'N'.           00230090
002400         88  PS-LNAME-DONE                   VALUE 'Y'.           00240090
002500         88  PS-LNAME-NOT-DONE               VALUE 'N'.           00250090
002600     05  PS-FNAME-DONE-SW          PIC X(01) VALUE 'N'.           00260090
002700         88  PS-FNAME-DONE                   VALUE 'Y'.           00270090
002800         88  PS-FNAME-NOT-DONE               VALUE 'N'.           00280090
002900                                                                  00290089
003000 01  DK-DB2-KEYS.                                                 00300089
003100     15  DK-PULL-NUMBER            PIC S9(9) VALUE ZERO COMP.     00310089
003200     15  DK-LINE-NUMBER            PIC S9(4) VALUE ZERO COMP.     00320089
003300     15  DK-STR-NUMBER             PIC S9(4) VALUE ZERO COMP.     00330089
003400     15  DK-ADJ-TMST               PIC X(26) VALUE SPACES.        00340090
003500                                                                  00350089
003600 01  PC-PROGRAM-CONSTANTS.                                        00360089
003700     05  PC-CURRENT-MAP-NAME       PIC X(08) VALUE 'CE615A  '.    00370089
003800     05  PC-CURRENT-MAPSET-NAME    PIC X(08) VALUE 'CEKM615 '.    00380089
003900     05  PC-CURRENT-PROGRAM-NAME   PIC X(08) VALUE 'CEKCS615'.    00390089
004000     05  PC-LIST-QUEUE-SEQ         PIC 9(01) VALUE 1.             00400089
004100     05  PC-SEL-QUEUE-SEQ          PIC 9(01) VALUE 2.             00410089
004200                                                                  00420089
004300*----------------------------------------------------------------*00430089
004400*  SYSTEM MESSAGES                                               *00440089
004500*----------------------------------------------------------------*00450089
004600*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00460089
004700*   00069 - TOP OF LIST                                          *00470089
004800*   00070 - BOTTOM OF LIST                                       *00480089
004900*----------------------------------------------------------------*00490089
005000     05  PC-TSYMSG-NUMBERS.                                       00500089
005100         10  PC-TSYMSG-00057       PIC 9(05) VALUE 00057.         00510089
005200         10  PC-TSYMSG-00069       PIC 9(05) VALUE 00069.         00520089
005300         10  PC-TSYMSG-00070       PIC 9(05) VALUE 00070.         00530089
005400                                                                  00540089
005500 01  PV-PROGRAM-VARIABLES.                                        00550089
005600     05  PV-CICS-RESP              PIC S9(4) VALUE +0 COMP SYNC.  00560089
005700     05  PV-NULL-IND-1             PIC S9(4) VALUE +0 COMP SYNC.  00570089
005800     05  PV-NULL-IND-2             PIC S9(4) VALUE +0 COMP SYNC.  00580089
005900     05  PV-DISPLAY-ZERO           PIC Z(3)9.                     00590090
285700*----------------------------------------------------------------*00591093
285800*                                               **   WR # 230ZZ  *00592093
285900* COMMENTED: PROGRAM STRUCTURE PV-SKU-10 & PV-SKU-8.             *00593093
286000*----------------------------------------------------------------*00595093
006000*    05  PV-SKU-10.                                               00600093
006100*        10  PV-SKU-10-1           PIC X(03).                     00610093
006200*        10  FILLER                PIC X(01).                     00620093
006300*        10  PV-SKU-10-2           PIC X(02).                     00630093
006400*        10  FILLER                PIC X(01).                     00640093
006500*        10  PV-SKU-10-3           PIC X(03).                     00650093
006600*    05  PV-SKU-8.                                                00660093
006700*        10  PV-SKU-8-1            PIC X(03).                     00670093
006800*        10  PV-SKU-8-2            PIC X(02).                     00680093
006900*        10  PV-SKU-8-3            PIC X(03).                     00690093
285400*----------------------------------------------------------------*00691093
285500* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *00692093
285600*----------------------------------------------------------------*00693093
007000                                                                  00700089
007100     05  PV-CEPLAU-TMST.                                          00710089
007200         10  PV-CEPLAU-CC          PIC X(02).                     00720090
007300         10  PV-CEPLAU-YY          PIC X(02).                     00730090
007400         10  FILLER                PIC X(01).                     00740090
007500         10  PV-CEPLAU-MM          PIC X(02).                     00750090
007600         10  FILLER                PIC X(01).                     00760090
007700         10  PV-CEPLAU-DD          PIC X(02).                     00770090
007800         10  FILLER                PIC X(01).                     00780090
007900         10  PV-CEPLAU-HR          PIC X(02).                     00790090
008000         10  FILLER                PIC X(01).                     00800090
008100         10  PV-CEPLAU-MIN         PIC X(02).                     00810090
008200         10  FILLER                PIC X(10).                     00820090
008300                                                                  00830089
008400     05  PV-CEPLAU-TMST-FORMAT.                                   00840089
008500         10  PV-CEPLAU-MM-F        PIC X(02).                     00850090
008600         10  FILLER                PIC X(01)   VALUE '/'.         00860090
008700         10  PV-CEPLAU-DD-F        PIC X(02).                     00870090
008800         10  FILLER                PIC X(01)   VALUE '/'.         00880090
008900         10  PV-CEPLAU-CC-F        PIC X(02).                     00890090
009000         10  PV-CEPLAU-YY-F        PIC X(02).                     00900090
009100         10  FILLER                PIC X(01)   VALUE SPACES.      00910090
009200         10  PV-CEPLAU-HR-F        PIC X(02).                     00920090
009300         10  FILLER                PIC X(01)   VALUE ':'.         00930090
009400         10  PV-CEPLAU-MIN-F       PIC X(02).                     00940090
009500     05  PV-CEPLAU-TMST-DISPLAY REDEFINES PV-CEPLAU-TMST-FORMAT   00950089
009600                                   PIC X(16).                     00960090
009700                                                                  00970089
009800 01  WS-WORKING-STORAGE-FIELDS.                                   00980090
009900     05  WS-LNAME-SUB              PIC S9(4) VALUE +0 COMP SYNC.  00990090
010000     05  WS-LNAME-SUB-2            PIC S9(4) VALUE +0 COMP SYNC.  01000090
010100     05  WS-FNAME-SUB              PIC S9(4) VALUE +0 COMP SYNC.  01010090
010200     05  WS-FNAME-SUB-2            PIC S9(4) VALUE +0 COMP SYNC.  01020090
010300     05  WS-ONAME-SUB              PIC S9(4) VALUE +0 COMP SYNC.  01030090
010400     05  WS-OUTPUT-NAME            PIC X(30).                     01040090
010500     05  FILLER REDEFINES WS-OUTPUT-NAME.                         01050090
010600         10  WS-ONAME-BYTE         PIC X(01) OCCURS 30 TIMES.     01060090
010700     05  WS-LAST-NAME              PIC X(18).                     01070090
010800     05  FILLER REDEFINES WS-LAST-NAME.                           01080090
010900         10  WS-LNAME-BYTE         PIC X(01) OCCURS 18 TIMES.     01090090
011000     05  WS-FIRST-NAME             PIC X(12).                     01100090
011100     05  FILLER REDEFINES WS-FIRST-NAME.                          01110090
011200         10  WS-FNAME-BYTE         PIC X(01) OCCURS 12 TIMES.     01120090
011300                                                                  01130090
011400*---------------------------------------------------------------* 01140089
011500* SELECTON QUEUE LAYOUT                                         * 01150089
011600*---------------------------------------------------------------* 01160089
011700     COPY CEWS003.                                                01170089
011800                                                                  01180089
011900*---------------------------------------------------------------* 01190089
012000*    MAP LAYOUT                                                 * 01200089
012100*---------------------------------------------------------------* 01210089
012200     COPY CEKM615.                                                01220089
012300                                                                  01230089
012400*---------------------------------------------------------------* 01240089
012500*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01250089
012600*---------------------------------------------------------------* 01260089
012700     COPY DPWS015.                                                01270089
012800                                                                  01280089
012900*---------------------------------------------------------------* 01290089
013000*    FUNCTION KEYS COPYBOOK.                                    * 01300089
013100*---------------------------------------------------------------* 01310089
013200     COPY DPWS016.                                                01320089
013300                                                                  01330089
013400*---------------------------------------------------------------* 01340089
013500*    NUMERIC EDIT LAYOUT.                                       * 01350089
013600*---------------------------------------------------------------* 01360089
013700     COPY DPWS010I.                                               01370089
013800                                                                  01380089
013900*---------------------------------------------------------------* 01390089
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01401094
014100*---------------------------------------------------------------* 01410089
014200     COPY DPWS030.                                                01420089
CICS       COPY DPWS930.                                                01421094
014300                                                                  01430089
014400*---------------------------------------------------------------* 01440089
014500*    STANDARD COMMAREA.                                         * 01450089
014600*---------------------------------------------------------------* 01460089
014700     COPY DPWS020.                                                01470089
014800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01480089
014900         10  INTER-APPL-COMM-AREA       PIC X(200).               01490089
015000     COPY CEWS002.                                                01500089
015100*---------------------------------------------------------------* 01510089
015200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 01520089
015300*---------------------------------------------------------------* 01530089
015400         10  ASC-SPECIFIC-COMMAREA.                               01540089
015500             15  ASC-USE-SELECTION-QUEUE-IND  PIC X(01).          01550089
015600                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 01560089
015700             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(5) COMP-3.   01570089
015800             15  ASC-LIST-QUEUE-NAME.                             01580089
015900                 20  ASC-LIST-TERM-ID         PIC X(04).          01590089
016000                 20  ASC-LIST-TASK-NUMBER     PIC S9(5) COMP-3.   01600089
016100                 20  ASC-LIST-SEQ             PIC 9(01).          01610089
016200             15  ASC-SEL-QUEUE-NAME-IN        PIC X(08).          01620089
016300             15  ASC-SEL-QUEUE-NAME.                              01630089
016400                 20  ASC-SEL-TERM-ID          PIC X(04).          01640089
016500                 20  ASC-SEL-TASK-NUMBER      PIC S9(5) COMP-3.   01650089
016600                 20  ASC-SEL-SEQ              PIC 9(01).          01660089
016700             15  ASC-SEL-SUB                  PIC S9(4) COMP.     01670089
016800             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     01680089
016900             15  ASC-CS-LOC                   PIC  9(04).         01690089
017000             15  ASC-KEY-STORE-NBR            PIC  9(04).         01700089
017100             15  ASC-PULL-NBR                 PIC  9(09).         01710089
017200             15  ASC-LINE-NBR                 PIC  9(04).         01720089
017300                                                                  01730089
017400             15  ASC-SKU-NUMBER               PIC  X(08).         01740089
017500             15  ASC-SKU-RETAIL               PIC S9(05)V99.      01750089
017600                                                                  01760089
017700             15  ASC-MANIFEST-UNTS            PIC S9(05).         01770089
017800             15  ASC-ADJUST-UNTS              PIC S9(05).         01780089
017900             15  ASC-DISTRB-UNTS              PIC S9(05).         01790089
018000             15  ASC-DISTRB-RETAIL            PIC S9(07)V99.      01800089
018100                                                                  01810089
018200             15  ASC-ADJ-UNITS                PIC S9(05).         01820089
018300             15  ASC-BEF-UNITS                PIC S9(05).         01830089
018400             15  ASC-AFT-UNITS                PIC S9(05).         01840089
018500             15  ASC-BATCH-NBR                PIC  X(03).         01850089
018600             15  ASC-DATE-TIME                PIC  X(16).         01860089
018700             15  ASC-KEY-ADJ-TMST             PIC  X(26).         01870090
018800             15  ASC-ADJ-BY                   PIC  X(08).         01880089
018900             15  ASC-TK-NAME                  PIC  X(35).         01890089
019000             15  ASC-REASON.                                      01900089
019100                 20  ASC-REASON-L1            PIC  X(50).         01910089
019200                 20  ASC-REASON-L2            PIC  X(50).         01920089
019300                 20  ASC-REASON-L3            PIC  X(50).         01930089
019400                 20  ASC-REASON-L4            PIC  X(50).         01940089
019500                 20  ASC-REASON-L5            PIC  X(50).         01950089
019600                                                                  01960089
019700*---------------------------------------------------------------* 01970089
019800*    ABEND PROCESSING COPYBOOK.                                 * 01980089
019900*---------------------------------------------------------------* 01990089
020000     COPY DPWS013.                                                02000089
020100                                                                  02010089
020200*---------------------------------------------------------------* 02020089
020300*    TCEPLDS - CENTRAL STOCK PULL DISTRIBUTION                  * 02030089
020400*---------------------------------------------------------------* 02040089
020500     EXEC SQL                                                     02050089
020600          INCLUDE TCEPLDS                                         02060089
020700     END-EXEC.                                                    02070089
020800                                                                  02080089
020900*---------------------------------------------------------------* 02090089
021000*    TCEPLMF - CENTRAL STOCK MANIFEST                           * 02100089
021100*---------------------------------------------------------------* 02110089
021200     EXEC SQL                                                     02120089
021300          INCLUDE TCEPLMF                                         02130089
021400     END-EXEC.                                                    02140089
021500                                                                  02150089
021600*---------------------------------------------------------------* 02160089
021700*    TCEPLAU - CENTRAL STOCK ADJUST AUDIT                       * 02170089
021800*---------------------------------------------------------------* 02180089
021900     EXEC SQL                                                     02190089
022000          INCLUDE TCEPLAU                                         02200089
022100     END-EXEC.                                                    02210089
022200                                                                  02220089
022300*---------------------------------------------------------------* 02230090
022400*    TWORKER - MB-WORKER TABLE                                  * 02240090
022500*---------------------------------------------------------------* 02250090
022600     EXEC SQL                                                     02260090
022700          INCLUDE TWORKER                                         02270090
022800     END-EXEC.                                                    02280090
022900                                                                  02290090
023000*---------------------------------------------------------------* 02300089
023100*    DB2 AREA FOR COMMUNICATIONS                                * 02310089
023200*---------------------------------------------------------------* 02320089
023300     EXEC SQL                                                     02330089
023400          INCLUDE SQLCA                                           02340089
023500     END-EXEC.                                                    02350089
023600                                                                  02360089
023700*---------------------------------------------------------------* 02370089
023800*---------------------------------------------------------------* 02380089
023900 LINKAGE SECTION.                                                 02390089
024000                                                                  02400089
024100 01  DFHCOMMAREA.                                                 02410089
024200     05  FILLER                         OCCURS  1 TO 4072 TIMES   02420089
024300                                        DEPENDING ON EIBCALEN.    02430089
024400         10  FILLER                     PIC X.                    02440089
024500                                                                  02450089
024600/*****************************************************************02460089
024700******************************************************************02470089
024800 PROCEDURE DIVISION.                                              02480089
024900******************************************************************02490089
025000**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **02500089
025100**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **02510089
025200**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **02520089
025300******************************************************************02530089
025400 0000-MAIN-MODULE.                                                02540089
025500                                                                  02550089
025600     INITIALIZE DP030-CICS-API-FIELDS.                            02560089
025700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02570089
025800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02580089
025900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02590089
026000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02600089
026100     MOVE LENGTH OF CE615AI        TO DP030-MAP-LENGTH (1).       02610089
026200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02620089
026300     PERFORM 0001-CALL-CICS-ARCH-API.                             02630089
026400                                                                  02640089
026500     PERFORM 1000-CONTROL-PROCESSING                              02650089
026600                                                                  02660089
026700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02670089
026800     PERFORM 0001-CALL-CICS-ARCH-API.                             02680089
026900                                                                  02690089
027000******************************************************************02700089
027100**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **02710089
027200**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **02720089
027300******************************************************************02730089
027400 0001-CALL-CICS-ARCH-API.                                         02740089
027500                                                                  02750089
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02761094
027700                                    DFHCOMMAREA                   02770094
027800                                    DP030-CICS-API-FIELDS         02780094
027900                                    DP020-STANDARD-COMMAREA       02790094
028000                                    CE615AI.                      02800094
028100                                                                  02810089
028200     IF DP030-RC-CALL-SUCCESSFUL                                  02820089
028300         CONTINUE                                                 02830089
028400     ELSE                                                         02840089
028500         SET DP013-NO-ROLLBACK                                    02850089
028600             DP013-XCTL-DISPLAY-RESTART                           02860089
028700             DP013-CICS-ABEND      TO TRUE                        02870089
028800         MOVE '0001-CALL-CICS-ARCH-API'                           02880089
028900                                   TO DP013-PARAGRAPH             02890089
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02891094
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02892094
029200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02920089
029300         PERFORM DP013-0000-PROCESS-ABEND                         02930089
029400     END-IF.                                                      02940089
029500                                                                  02950089
029600*----------------------------------------------------------------*02960089
029700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *02970089
029800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *02980089
029900*                                                                *02990089
030000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *03000089
030100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *03010089
030200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *03020089
030300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *03030089
030400*----------------------------------------------------------------*03040089
030500 1000-CONTROL-PROCESSING.                                         03050089
030600                                                                  03060089
030700     EVALUATE TRUE                                                03070089
030800         WHEN DP020-NEXT-ACT-INITIAL                              03080089
030900             INITIALIZE ASC-SPECIFIC-COMMAREA                     03090089
031000             MOVE EIBTRMID          TO ASC-LIST-TERM-ID           03100089
031100                                       ASC-SEL-TERM-ID            03110089
031200             MOVE DP020-SRC-TASK-NUMBER                           03120089
031300                                    TO ASC-LIST-TASK-NUMBER       03130089
031400                                       ASC-SEL-TASK-NUMBER        03140089
031500             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               03150089
031600             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                03160089
031700             PERFORM 1100-PROCESS-INTER-APPL-COMM                 03170089
031800             IF PS-COMMAREA-NOT-VALID                             03180089
031900                 SET DP020-NEXT-ACT-APPL-ERROR                    03190089
032000                                    TO TRUE                       03200089
032100             ELSE                                                 03210089
032200                 PERFORM 4000-BUILD-INITIAL-PANEL                 03220089
032300             END-IF                                               03230089
032400                                                                  03240089
032500         WHEN DP020-NEXT-ACT-READ-MAP                             03250089
032600             PERFORM 2000-PROCESS-PANEL                           03260089
032700                                                                  03270089
032800         WHEN DP020-NEXT-ACT-RETURN                               03280089
032900             PERFORM 4000-BUILD-INITIAL-PANEL                     03290089
033000                                                                  03300089
033100         WHEN OTHER                                               03310089
033200             SET DP013-LOGIC-ABEND TO TRUE                        03320089
033300             SET DP013-NO-ROLLBACK TO TRUE                        03330089
033400             MOVE '1000-CONTROL-PROCESSING'                       03340089
033500                                   TO DP013-PARAGRAPH             03350089
033600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    03360089
033700                                   TO DP013-MESSAGE-TEXT(1)       03370089
033800             PERFORM DP013-0000-PROCESS-ABEND                     03380089
033900     END-EVALUATE.                                                03390089
034000                                                                  03400089
034100*----------------------------------------------------------------*03410089
034200* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *03420089
034300* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *03430089
034400*----------------------------------------------------------------*03440089
034500 1100-PROCESS-INTER-APPL-COMM.                                    03450089
034600                                                                  03460089
034700     SET PS-COMMAREA-VALID         TO TRUE.                       03470089
034800                                                                  03480089
034900     IF CE002-NUMBER-OF-SELECTED-ITEMS > 0                        03490089
035000         MOVE CE002-CS-LOCATION        TO ASC-CS-LOC              03500089
035100         MOVE CE002-PULL-NBR           TO ASC-PULL-NBR            03510089
035200         MOVE CE002-LNE-NBR            TO ASC-LINE-NBR            03520089
035300         MOVE CE002-SKU-NBR            TO ASC-SKU-NUMBER          03530090
035400***      MOVE CE002-SKU-NBR            TO PV-SKU-10               03540090
035500***      MOVE PV-SKU-10-1              TO PV-SKU-8-1              03550090
035600***      MOVE PV-SKU-10-2              TO PV-SKU-8-2              03560090
035700***      MOVE PV-SKU-10-3              TO PV-SKU-8-3              03570090
035800***      MOVE PV-SKU-8                 TO ASC-SKU-NUMBER          03580090
035900         MOVE CE002-SKU-RETAIL         TO ASC-SKU-RETAIL          03590089
036000         MOVE CE002-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  03600089
036100         MOVE CE002-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME-IN   03610089
036200         SET ASC-USE-SELECTION-QUEUE   TO TRUE                    03620089
036300         PERFORM 1120-PREPARE-LIST-ENTRY                          03630089
036400     ELSE                                                         03640089
036500         MOVE PC-TSYMSG-00057       TO DP020-MSG-NUMBER           03650089
036600         SET  PS-COMMAREA-NOT-VALID TO TRUE                       03660089
036700     END-IF.                                                      03670089
036800                                                                  03680089
036900*----------------------------------------------------------------*03690089
037000*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*03700089
037100*----------------------------------------------------------------*03710089
037200 1120-PREPARE-LIST-ENTRY.                                         03720089
037300                                                                  03730089
037400     MOVE CE003-MAX-ITEMS          TO ASC-SEL-SUB.                03740089
037500     MOVE ZERO                     TO ASC-SEL-ITEM.               03750089
037600     PERFORM 1130-GET-NEXT-RECORD.                                03760089
037700                                                                  03770089
037800*----------------------------------------------------------------*03780089
037900 1130-GET-NEXT-RECORD.                                            03790089
038000                                                                  03800089
038100     ADD +1 TO ASC-SEL-SUB.                                       03810089
038200                                                                  03820089
038300     IF ASC-SEL-SUB > CE003-MAX-ITEMS                             03830089
038400         ADD  +1 TO ASC-SEL-ITEM                                  03840089
038500         MOVE +1 TO ASC-SEL-SUB                                   03850089
038600     END-IF.                                                      03860089
038700                                                                  03870089
038800     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 03880089
038900         PERFORM 9100-READ-SEL-QUEUE                              03890089
039000         IF CE003-ITEM (ASC-SEL-SUB) > ZERO                       03900089
039100             MOVE CE003-STR-NBR      (ASC-SEL-SUB)                03910089
039200               TO ASC-KEY-STORE-NBR                               03920090
039300             MOVE CE003-ADJ-TMST     (ASC-SEL-SUB)                03930090
039400               TO ASC-KEY-ADJ-TMST                                03940090
039500                  PV-CEPLAU-TMST                                  03950090
039600             MOVE PV-CEPLAU-CC    TO PV-CEPLAU-CC-F               03960090
039700             MOVE PV-CEPLAU-YY    TO PV-CEPLAU-YY-F               03970090
039800             MOVE PV-CEPLAU-MM    TO PV-CEPLAU-MM-F               03980090
039900             MOVE PV-CEPLAU-DD    TO PV-CEPLAU-DD-F               03990090
040000             MOVE PV-CEPLAU-HR    TO PV-CEPLAU-HR-F               04000090
040100             MOVE PV-CEPLAU-MIN   TO PV-CEPLAU-MIN-F              04010090
040200             MOVE PV-CEPLAU-TMST-DISPLAY                          04020090
040300               TO ASC-DATE-TIME                                   04030090
040400             SET CE003-INQ (ASC-SEL-SUB) TO TRUE                  04040089
040500             PERFORM 9200-REWRITE-SEL-QUEUE                       04050089
040600         ELSE                                                     04060089
040700             SUBTRACT +1 FROM ASC-SEL-SUB                         04070089
040800             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             04080089
040900             SET DP020-MSG-INFORMATIONAL                          04090089
041000                 PS-LIST-END      TO TRUE                         04100089
041100         END-IF                                                   04110089
041200     ELSE                                                         04120089
041300         SUBTRACT +1 FROM ASC-SEL-ITEM                            04130089
041400         MOVE CE003-MAX-ITEMS     TO ASC-SEL-SUB                  04140089
041500         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             04150089
041600         SET DP020-MSG-INFORMATIONAL                              04160089
041700             PS-LIST-END          TO TRUE                         04170089
041800     END-IF.                                                      04180089
041900                                                                  04190089
042000*----------------------------------------------------------------*04200089
042100*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *04210089
042200*    PROCESSED.                                                  *04220089
042300*----------------------------------------------------------------*04230089
042400 1140-GET-PREV-RECORD.                                            04240089
042500                                                                  04250089
042600     SUBTRACT +1 FROM ASC-SEL-SUB.                                04260089
042700                                                                  04270089
042800     IF ASC-SEL-SUB < +1                                          04280089
042900         SUBTRACT +1 FROM ASC-SEL-ITEM                            04290089
043000         MOVE CE003-MAX-ITEMS     TO ASC-SEL-SUB                  04300089
043100     END-IF.                                                      04310089
043200                                                                  04320089
043300     IF ASC-SEL-ITEM > ZERO                                       04330089
043400         PERFORM 9100-READ-SEL-QUEUE                              04340089
043500         MOVE CE003-STR-NBR      (ASC-SEL-SUB)                    04350089
043600           TO ASC-KEY-STORE-NBR                                   04360089
043700         MOVE CE003-ADJ-TMST     (ASC-SEL-SUB)                    04370090
043800           TO ASC-KEY-ADJ-TMST                                    04380090
043900              PV-CEPLAU-TMST                                      04390090
044000         MOVE PV-CEPLAU-CC    TO PV-CEPLAU-CC-F                   04400090
044100         MOVE PV-CEPLAU-YY    TO PV-CEPLAU-YY-F                   04410090
044200         MOVE PV-CEPLAU-MM    TO PV-CEPLAU-MM-F                   04420090
044300         MOVE PV-CEPLAU-DD    TO PV-CEPLAU-DD-F                   04430090
044400         MOVE PV-CEPLAU-HR    TO PV-CEPLAU-HR-F                   04440090
044500         MOVE PV-CEPLAU-MIN   TO PV-CEPLAU-MIN-F                  04450090
044600         MOVE PV-CEPLAU-TMST-DISPLAY                              04460090
044700           TO ASC-DATE-TIME                                       04470090
044800         SET CE003-INQ (ASC-SEL-SUB) TO TRUE                      04480089
044900         PERFORM 9200-REWRITE-SEL-QUEUE                           04490089
045000     ELSE                                                         04500089
045100         MOVE +1              TO ASC-SEL-ITEM                     04510089
045200                                 ASC-SEL-SUB                      04520089
045300         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                 04530089
045400         SET DP020-MSG-INFORMATIONAL                              04540089
045500             PS-LIST-END      TO TRUE                             04550089
045600     END-IF.                                                      04560089
045700                                                                  04570089
045800*----------------------------------------------------------------*04580089
045900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04590089
046000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04600089
046100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04610089
046200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04620089
046300* FUNCTION KEYS CAN GET THIS FAR.                                *04630089
046400*----------------------------------------------------------------*04640089
046500 2000-PROCESS-PANEL.                                              04650089
046600                                                                  04660089
046700     EVALUATE TRUE                                                04670089
046800         WHEN DP020-SRC-AID = DP016-CLEAR                         04680089
046900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04690089
047000                                                                  04700089
047100*F5=REFRESH                                                       04710089
047200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04720089
047300             PERFORM 2050-DELETE-LIST-QUEUE                       04730089
047400             PERFORM 4000-BUILD-INITIAL-PANEL                     04740089
047500                                                                  04750089
047600*F20=NEXT SELECTION                                               04760089
047700         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             04770089
047800             IF ASC-USE-SELECTION-QUEUE                           04780089
047900                 PERFORM 1130-GET-NEXT-RECORD                     04790089
048000***              IF PS-LIST-END                                   04800091
048100***                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         04810091
048200***                  SET PS-NO-LIST-END TO TRUE                   04820091
048300***              ELSE                                             04830091
048400                     PERFORM 2050-DELETE-LIST-QUEUE               04840089
048500                     PERFORM 4000-BUILD-INITIAL-PANEL             04850089
048600***              END-IF                                           04860091
048700             ELSE                                                 04870089
048800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04880089
048900*                --- BOTTOM OF LIST ---                           04890089
049000                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         04900089
049100                 SET DP020-MSG-INFORMATIONAL TO TRUE              04910089
049200             END-IF                                               04920089
049300                                                                  04930089
049400*F19=PREV SELECTION                                               04940089
049500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             04950089
049600             IF ASC-USE-SELECTION-QUEUE                           04960089
049700                 PERFORM 1140-GET-PREV-RECORD                     04970089
049800                 PERFORM 2050-DELETE-LIST-QUEUE                   04980091
049900                 PERFORM 4000-BUILD-INITIAL-PANEL                 04990091
050000             ELSE                                                 05000089
050100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05010089
050200*                --- TOP OF LIST ---                              05020089
050300                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         05030089
050400                 SET DP020-MSG-INFORMATIONAL TO TRUE              05040089
050500             END-IF                                               05050089
050600                                                                  05060089
050700         WHEN OTHER                                               05070089
050800             SET DP030-CONTINUE-GO TO TRUE                        05080089
050900             PERFORM 2100-CHECK-FUNCTION-KEY                      05090089
051000     END-EVALUATE.                                                05100089
051100                                                                  05110089
051200*----------------------------------------------------------------*05120089
051300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05130089
051400*----------------------------------------------------------------*05140089
051500 2050-DELETE-LIST-QUEUE.                                          05150089
051600                                                                  05160089
051700     EXEC CICS                                                    05170089
051800         DELETEQ TS                                               05180089
051900             QUEUE (ASC-LIST-QUEUE-NAME)                          05190089
052000             RESP  (PV-CICS-RESP)                                 05200089
052100     END-EXEC.                                                    05210089
052200                                                                  05220089
052300     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05230089
052400        (PV-CICS-RESP = DFHRESP(QIDERR))                          05240089
052500         CONTINUE                                                 05250089
052600     ELSE                                                         05260089
052700         SET DP013-CICS-ABEND      TO TRUE                        05270089
052800         SET DP013-NO-ROLLBACK     TO TRUE                        05280089
052900                                                                  05290089
053000         MOVE '2050-DELETE-LIST-QUEUE'                            05300089
053100                                   TO DP013-PARAGRAPH             05310089
053200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05320089
053300                                   TO DP013-MESSAGE-TEXT (1)      05330089
053400         PERFORM DP013-0000-PROCESS-ABEND                         05340089
053500     END-IF.                                                      05350089
053600                                                                  05360089
053700*----------------------------------------------------------------*05370089
053800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05380089
053900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05390089
054000* CICS ARCHITECTURE API.                                         *05400089
054100*----------------------------------------------------------------*05410089
054200 2100-CHECK-FUNCTION-KEY.                                         05420089
054300                                                                  05430089
054400     EVALUATE TRUE                                                05440089
054500* ENTER KEY                                                       05450089
054600         WHEN DP020-SRC-AID = DP016-ENTER                         05460089
054700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05470089
054800                                                                  05480089
054900         WHEN OTHER                                               05490089
055000             SET DP013-NO-ROLLBACK                                05500089
055100                 DP013-XCTL-DISPLAY-RESTART                       05510089
055200                 DP013-CICS-ABEND  TO TRUE                        05520089
055300             MOVE '2100-CHECK-FUNCTION-KEY'                       05530089
055400                                   TO DP013-PARAGRAPH             05540089
055500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05550089
055600                                   TO DP013-MESSAGE-TEXT (1)      05560089
055700             PERFORM DP013-0000-PROCESS-ABEND                     05570089
055800     END-EVALUATE.                                                05580089
055900                                                                  05590089
056000*----------------------------------------------------------------*05600089
056100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *05610089
056200*    DISPLAY THE PANEL TO USER.                                  *05620089
056300*----------------------------------------------------------------*05630089
056400 4000-BUILD-INITIAL-PANEL.                                        05640089
056500                                                                  05650089
056600     PERFORM 4100-PREPARE-DBKEYS.                                 05660089
056700                                                                  05670089
056800     PERFORM 4500-GET-CEPLDS-QTY.                                 05680089
056900     PERFORM 4510-GET-CEPLMF-QTY.                                 05690089
057000     PERFORM 4525-GET-CEPLAU-QTY.                                 05700090
057100                                                                  05710089
057200     PERFORM 4520-GET-CEPLAU-RCD.                                 05720090
057300     PERFORM 4530-GET-USR-NAME.                                   05730090
057400                                                                  05740089
057500     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         05750089
057600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        05760089
057700                                                                  05770089
057800*----------------------------------------------------------------*05780089
057900*    SET UP THE HOST VARIABLES.                                  *05790089
058000*----------------------------------------------------------------*05800089
058100 4100-PREPARE-DBKEYS.                                             05810089
058200                                                                  05820089
058300     MOVE ASC-PULL-NBR         TO DK-PULL-NUMBER.                 05830089
058400     MOVE ASC-LINE-NBR         TO DK-LINE-NUMBER.                 05840089
058500     MOVE ASC-KEY-STORE-NBR    TO DK-STR-NUMBER.                  05850089
058600     MOVE ASC-KEY-ADJ-TMST     TO DK-ADJ-TMST.                    05860090
058700                                                                  05870089
058800*----------------------------------------------------------------*05880089
058900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *05890089
059000*----------------------------------------------------------------*05900089
059100 4400-MOVE-COMMAREA-TO-SCREEN.                                    05910089
059200                                                                  05920089
059300     MOVE ASC-CS-LOC                 TO PV-DISPLAY-ZERO.          05930089
059400     MOVE PV-DISPLAY-ZERO            TO ALOCIDO.                  05940089
059500                                                                  05950089
059600     MOVE ASC-KEY-STORE-NBR          TO PV-DISPLAY-ZERO           05960089
059700                                        DK-STR-NUMBER.            05970089
059800     MOVE PV-DISPLAY-ZERO            TO ASTRNOO.                  05980089
059900                                                                  05990089
060000     MOVE ASC-PULL-NBR               TO APULNOO                   06000089
060100                                        DK-PULL-NUMBER.           06010089
060200     MOVE ASC-LINE-NBR               TO ALNENOO                   06020089
060300                                        DK-LINE-NUMBER.           06030089
060400                                                                  06040089
060500     MOVE ASC-SKU-NUMBER             TO ASKUO.                    06050089
060600     MOVE ASC-SKU-RETAIL             TO ASKRETO.                  06060089
060700                                                                  06070089
060800     MOVE ASC-MANIFEST-UNTS          TO AMFUNTO.                  06080089
060900     MOVE ASC-ADJUST-UNTS            TO AADJUNTO.                 06090089
061000     MOVE ASC-DISTRB-UNTS            TO ADSUNTO.                  06100089
061100     MOVE ASC-DISTRB-RETAIL          TO ADSRTLO.                  06110089
061200                                                                  06120089
061300     MOVE ASC-ADJ-UNITS              TO AADJO.                    06130090
061400     MOVE ASC-BEF-UNITS              TO AADJBO.                   06140090
061500     MOVE ASC-AFT-UNITS              TO AADJAO.                   06150090
061600     MOVE ASC-BATCH-NBR              TO ABTCHO.                   06160090
061700     MOVE ASC-DATE-TIME              TO ADATEO.                   06170090
061800     MOVE ASC-ADJ-BY                 TO AADJTKO.                  06180090
061900     MOVE ASC-TK-NAME                TO AADJNMO.                  06190090
062000     MOVE ASC-REASON-L1              TO ARSN01O.                  06200090
062100     MOVE ASC-REASON-L2              TO ARSN02O.                  06210090
062200     MOVE ASC-REASON-L3              TO ARSN03O.                  06220090
062300     MOVE ASC-REASON-L4              TO ARSN04O.                  06230090
062400     MOVE ASC-REASON-L5              TO ARSN05O.                  06240090
062500                                                                  06250089
062600*----------------------------------------------------------------*06260089
062700* GET STORE DISTRIBUTION QUANTITY                                *06270089
062800*----------------------------------------------------------------*06280089
062900 4500-GET-CEPLDS-QTY.                                             06290089
063000                                                                  06300089
063100     INITIALIZE PV-NULL-IND-1.                                    06310089
063200                                                                  06320089
063300     EXEC SQL                                                     06330089
063400          SELECT  ACTL_DISTRB_QTY                                 06340089
063500            INTO  :CEPLDS-ACTL-DISTRB-QTY :PV-NULL-IND-1          06350089
063600            FROM  TCEPLDS                                         06360089
063700           WHERE  CNSTK_REQ_PL_NBR = :DK-PULL-NUMBER              06370089
063800             AND  PL_LNE_NBR       = :DK-LINE-NUMBER              06380089
063900             AND  STR_NBR          = :DK-STR-NUMBER               06390089
064000     END-EXEC.                                                    06400089
064100                                                                  06410089
064200     EVALUATE TRUE                                                06420089
064300         WHEN SQLCODE = +0                                        06430089
064400             IF PV-NULL-IND-1 < +0                                06440089
064500                 MOVE ZEROES TO ASC-DISTRB-UNTS                   06450089
064600                                ASC-DISTRB-RETAIL                 06460089
064700             ELSE                                                 06470089
064800                 MOVE CEPLDS-ACTL-DISTRB-QTY TO ASC-DISTRB-UNTS   06480089
064900                 COMPUTE ASC-DISTRB-RETAIL ROUNDED                06490089
065000                       = ASC-DISTRB-UNTS                          06500089
065100                       * ASC-SKU-RETAIL                           06510089
065200             END-IF                                               06520089
065300                                                                  06530089
065400         WHEN SQLCODE = +100                                      06540089
065500             MOVE ZEROES TO ASC-DISTRB-UNTS                       06550089
065600                            ASC-DISTRB-RETAIL                     06560089
065700                                                                  06570089
065800         WHEN OTHER                                               06580089
065900             MOVE '4500-GET-CEPLDS-QTY'  TO DP013-PARAGRAPH       06590089
066000             MOVE 'GET PULL DISTRIBTION' TO DP013-MESSAGE-TEXT (1)06600089
066100             MOVE SQLCA                  TO DP013-SQLCA           06610089
066200             MOVE 'TCEPLDS ' TO DP013-DB2-TABLE-NAME (1)          06620089
066300             SET DP013-DB2-ABEND                                  06630089
066400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               06640089
066500             PERFORM DP013-0000-PROCESS-ABEND                     06650089
066600     END-EVALUATE.                                                06660089
066700                                                                  06670089
066800*----------------------------------------------------------------*06680089
066900* GET STORE MANIFEST QUANTITY                                    *06690089
067000*----------------------------------------------------------------*06700089
067100 4510-GET-CEPLMF-QTY.                                             06710089
067200                                                                  06720089
067300     INITIALIZE PV-NULL-IND-2.                                    06730089
067400                                                                  06740089
067500     EXEC SQL                                                     06750089
067600         SELECT  SUM(MFST_UNT_QTY)                                06760090
067700           INTO  :CEPLMF-MFST-UNT-QTY :PV-NULL-IND-2              06770090
067800           FROM  TCEPLMF                                          06780090
067900          WHERE  CNSTK_REQ_PL_NBR   = :DK-PULL-NUMBER             06790090
068000            AND  PL_LNE_NBR         = :DK-LINE-NUMBER             06800090
068100            AND  STR_NBR            = :DK-STR-NUMBER              06810090
068200     END-EXEC.                                                    06820089
068300                                                                  06830089
068400     EVALUATE TRUE                                                06840089
068500         WHEN SQLCODE = ZERO                                      06850089
068600             IF PV-NULL-IND-2 < +0                                06860089
068700                 MOVE ZEROES TO ASC-MANIFEST-UNTS                 06870089
068800             ELSE                                                 06880089
068900                 MOVE CEPLMF-MFST-UNT-QTY TO ASC-MANIFEST-UNTS    06890089
069000             END-IF                                               06900089
069100                                                                  06910089
069200         WHEN OTHER                                               06920089
069300             MOVE '4510-GET-CEPLMF-QTY' TO DP013-PARAGRAPH        06930089
069400             MOVE 'GET MANIFEST UNITS'  TO DP013-MESSAGE-TEXT (1) 06940089
069500             MOVE SQLCA                 TO DP013-SQLCA            06950089
069600             MOVE 'TCEPLMF ' TO DP013-DB2-TABLE-NAME (1)          06960089
069700             SET DP013-DB2-ABEND                                  06970089
069800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               06980089
069900             PERFORM DP013-0000-PROCESS-ABEND                     06990089
070000     END-EVALUATE.                                                07000089
070100                                                                  07010089
070200*----------------------------------------------------------------*07020089
070300* GET STORE ADJUSTMENT RECORD                                    *07030090
070400*----------------------------------------------------------------*07040089
070500 4520-GET-CEPLAU-RCD.                                             07050090
070600                                                                  07060089
070700     MOVE SPACES TO ASC-REASON-L1                                 07070091
070800                    ASC-REASON-L2                                 07080091
070900                    ASC-REASON-L3                                 07090091
071000                    ASC-REASON-L4                                 07100091
071100                    ASC-REASON-L5.                                07110091
071200                                                                  07120091
071300     INITIALIZE PV-NULL-IND-1                                     07130089
071400                PV-NULL-IND-2                                     07140089
071500                CEPLAU-BEF-ADJ-UNT-QTY                            07150089
071600                CEPLAU-AFT-ADJ-UNT-QTY                            07160091
071700                CEPLAU-ADJ-RSN-DESC.                              07170091
071800                                                                  07180089
071900     EXEC SQL                                                     07190089
072000         SELECT  BEF_ADJ_UNT_QTY                                  07200090
072100              ,  AFT_ADJ_UNT_QTY                                  07210090
072200              ,  ADJ_BY_USR_ID                                    07220090
072300              ,  EXPRT_PRC_BTCH_ID                                07230090
072400              ,  ADJ_RSN_DESC                                     07240090
072500           INTO :CEPLAU-BEF-ADJ-UNT-QTY :PV-NULL-IND-1            07250090
072600              , :CEPLAU-AFT-ADJ-UNT-QTY :PV-NULL-IND-2            07260090
072700              , :CEPLAU-ADJ-BY-USR-ID                             07270090
072800              , :CEPLAU-EXPRT-PRC-BTCH-ID                         07280090
072900              , :CEPLAU-ADJ-RSN-DESC                              07290091
073000           FROM  TCEPLAU                                          07300090
073100          WHERE  CNSTK_REQ_PL_NBR   = :DK-PULL-NUMBER             07310090
073200            AND  PL_LNE_NBR         = :DK-LINE-NUMBER             07320090
073300            AND  STR_NBR            = :DK-STR-NUMBER              07330090
073400            AND  ADJ_TMST           = :DK-ADJ-TMST                07340090
073500     END-EXEC.                                                    07350089
073600                                                                  07360089
073700     EVALUATE TRUE                                                07370089
073800         WHEN SQLCODE = ZERO                                      07380089
073900             COMPUTE ASC-ADJ-UNITS = CEPLAU-AFT-ADJ-UNT-QTY       07390090
074000                                   - CEPLAU-BEF-ADJ-UNT-QTY       07400090
074100             MOVE CEPLAU-BEF-ADJ-UNT-QTY   TO ASC-BEF-UNITS       07410090
074200             MOVE CEPLAU-AFT-ADJ-UNT-QTY   TO ASC-AFT-UNITS       07420090
074300             MOVE CEPLAU-ADJ-BY-USR-ID     TO ASC-ADJ-BY          07430090
074400             MOVE CEPLAU-EXPRT-PRC-BTCH-ID TO ASC-BATCH-NBR       07440090
074500             MOVE CEPLAU-ADJ-RSN-DESC-TEXT TO ASC-REASON          07450091
074600                                                                  07460089
074700         WHEN OTHER                                               07470089
074800             MOVE '4520-GET-CEPLAU-RCD' TO DP013-PARAGRAPH        07480090
074900             MOVE 'GET ADJUSTMENT REC ' TO DP013-MESSAGE-TEXT (1) 07490090
075000             MOVE SQLCA                 TO DP013-SQLCA            07500090
075100             MOVE 'TCEPLAU ' TO DP013-DB2-TABLE-NAME (1)          07510089
075200             SET DP013-DB2-ABEND                                  07520089
075300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               07530089
075400             PERFORM DP013-0000-PROCESS-ABEND                     07540089
075500     END-EVALUATE.                                                07550089
075600                                                                  07560089
075700*----------------------------------------------------------------*07570090
075800* GET STORE ADJUSTMENT QUANTITY                                  *07580090
075900*----------------------------------------------------------------*07590090
076000 4525-GET-CEPLAU-QTY.                                             07600090
076100                                                                  07610090
076200     INITIALIZE PV-NULL-IND-1                                     07620090
076300                PV-NULL-IND-2                                     07630090
076400                CEPLAU-BEF-ADJ-UNT-QTY                            07640090
076500                CEPLAU-AFT-ADJ-UNT-QTY.                           07650090
076600                                                                  07660090
076700     EXEC SQL                                                     07670090
076800        SELECT  SUM(BEF_ADJ_UNT_QTY)                              07680090
076900             ,  SUM(AFT_ADJ_UNT_QTY)                              07690090
077000          INTO :CEPLAU-BEF-ADJ-UNT-QTY :PV-NULL-IND-1             07700090
077100             , :CEPLAU-AFT-ADJ-UNT-QTY :PV-NULL-IND-2             07710090
077200          FROM  TCEPLAU                                           07720090
077300         WHERE  CNSTK_REQ_PL_NBR   = :DK-PULL-NUMBER              07730090
077400           AND  PL_LNE_NBR         = :DK-LINE-NUMBER              07740090
077500           AND  STR_NBR            = :DK-STR-NUMBER               07750090
077600     END-EXEC.                                                    07760090
077700                                                                  07770090
077800     EVALUATE TRUE                                                07780090
077900         WHEN SQLCODE = ZERO                                      07790090
078000             COMPUTE ASC-ADJUST-UNTS = CEPLAU-AFT-ADJ-UNT-QTY     07800090
078100                                     - CEPLAU-BEF-ADJ-UNT-QTY     07810090
078200                                                                  07820090
078300         WHEN OTHER                                               07830090
078400             MOVE '4520-GET-CEPLAU-QTY'  TO DP013-PARAGRAPH       07840090
078500             MOVE 'GET ADJUSTMENT UNITS' TO DP013-MESSAGE-TEXT (1)07850090
078600             MOVE SQLCA                  TO DP013-SQLCA           07860090
078700             MOVE 'TCEPLAU ' TO DP013-DB2-TABLE-NAME (1)          07870090
078800             SET DP013-DB2-ABEND                                  07880090
078900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               07890090
079000             PERFORM DP013-0000-PROCESS-ABEND                     07900090
079100     END-EVALUATE.                                                07910090
079200                                                                  07920090
079300*----------------------------------------------------------------*07930090
079400*    GET USER NAME BASED ON ID (TWORKER)                         *07940090
079500*----------------------------------------------------------------*07950090
079600 4530-GET-USR-NAME.                                               07960090
079700                                                                  07970090
079800     EXEC SQL                                                     07980090
079900         SELECT LAST_NAME                                         07990090
080000              , FIR_NAME                                          08000090
080100              , MID_INIT_NAME                                     08010090
080200           INTO :WORKER-LAST-NAME                                 08020090
080300              , :WORKER-FIR-NAME                                  08030090
080400              , :WORKER-MID-INIT-NAME                             08040090
080500           FROM TWORKER                                           08050090
080600          WHERE UID_NBR  = :ASC-ADJ-BY                            08060090
080700     END-EXEC.                                                    08070090
080800                                                                  08080090
080900     EVALUATE TRUE                                                08090090
081000         WHEN SQLCODE = ZERO                                      08100090
081100             IF (WORKER-LAST-NAME NOT > SPACES)                   08110090
081200               AND (WORKER-FIR-NAME NOT > SPACES)                 08120090
081300                 MOVE SPACES         TO ASC-TK-NAME               08130090
081400             ELSE                                                 08140090
081500                 PERFORM 4531-STRING-TK-NAME                      08150090
081600                 MOVE WS-OUTPUT-NAME TO ASC-TK-NAME               08160090
081700             END-IF                                               08170090
081800                                                                  08180090
081900         WHEN SQLCODE = +100                                      08190090
082000             MOVE 'UNKNOWN                          '             08200092
082100                                     TO ASC-TK-NAME               08210090
082200                                                                  08220090
082300         WHEN OTHER                                               08230090
082400             MOVE SQLCA               TO DP013-SQLCA              08240090
082500             MOVE '4530-GET-USR-NAME' TO DP013-PARAGRAPH          08250090
082600             MOVE 'TWORKER'           TO DP013-DB2-TABLE-NAME (1) 08260090
082700             MOVE 'SELECT NAME FROM WORKER TABLE'                 08270090
082800                                      TO DP013-MESSAGE-TEXT (1)   08280090
082900             SET DP013-DB2-ABEND      TO TRUE                     08290090
083000             PERFORM DP013-0000-PROCESS-ABEND                     08300090
083100     END-EVALUATE.                                                08310090
083200                                                                  08320090
083300*----------------------------------------------------------------*08330090
083400*    CONCATENATE USER LAST/FIRST NAME FOR SCREEN DISPLAY         *08340090
083500*----------------------------------------------------------------*08350090
083600 4531-STRING-TK-NAME.                                             08360090
083700                                                                  08370090
083800     MOVE SPACES TO WS-OUTPUT-NAME.                               08380090
083900     MOVE +1     TO WS-ONAME-SUB.                                 08390090
084000                                                                  08400090
084100     MOVE WORKER-LAST-NAME  TO WS-LAST-NAME.                      08410090
084200     IF WS-LAST-NAME > SPACES                                     08420090
084300         SET PS-LNAME-NOT-DONE TO TRUE                            08430090
084400         MOVE +0 TO WS-LNAME-SUB                                  08440090
084500         MOVE +1 TO WS-LNAME-SUB-2                                08450090
084600         PERFORM 4532-MOVE-LAST-NAME                              08460090
084700           UNTIL PS-LNAME-DONE                                    08470090
084800     END-IF.                                                      08480090
084900                                                                  08490090
085000     MOVE WORKER-FIR-NAME   TO WS-FIRST-NAME.                     08500090
085100     IF WS-FIRST-NAME > SPACES                                    08510090
085200         SET PS-FNAME-NOT-DONE TO TRUE                            08520090
085300         MOVE +0 TO WS-FNAME-SUB                                  08530090
085400         MOVE +1 TO WS-FNAME-SUB-2                                08540090
085500         PERFORM 4533-MOVE-FIRST-NAME                             08550090
085600           UNTIL PS-FNAME-DONE                                    08560090
085700     END-IF.                                                      08570090
085800                                                                  08580090
085900*----------------------------------------------------------------*08590090
086000 4532-MOVE-LAST-NAME.                                             08600090
086100                                                                  08610090
086200     ADD +1 TO WS-LNAME-SUB                                       08620090
086300               WS-LNAME-SUB-2.                                    08630090
086400                                                                  08640090
086500*CHECK LNAME FIELD LENGTH.                                        08650090
086600     IF WS-LNAME-SUB > 18                                         08660090
086700         SET PS-LNAME-DONE TO TRUE                                08670090
086800     ELSE                                                         08680090
086900*MOVE LNAME FIELD CHARACTER.                                      08690090
087000     IF WS-LNAME-BYTE (WS-LNAME-SUB) > SPACES                     08700090
087100         MOVE WS-LNAME-BYTE (WS-LNAME-SUB)                        08710090
087200           TO WS-ONAME-BYTE (WS-ONAME-SUB)                        08720090
087300         ADD +1 TO WS-ONAME-SUB                                   08730090
087400     ELSE                                                         08740090
087500*IF TWO CONTIGUOUS SPACES FOUND, ASSUME DONE WITH LAST NAME.      08750090
087600*(PLACE ', ' IN OUTPUT FIELD TO MARK BEGINNING OF FIRST NAME)     08760090
087700         IF WS-LNAME-BYTE (WS-LNAME-SUB) = SPACES                 08770090
087800             IF WS-LNAME-BYTE (WS-LNAME-SUB-2) = SPACES           08780090
087900                 MOVE ',' TO WS-ONAME-BYTE (WS-ONAME-SUB)         08790090
088000                 ADD +1   TO WS-ONAME-SUB                         08800090
088100                 MOVE ' ' TO WS-ONAME-BYTE (WS-ONAME-SUB)         08810090
088200                 ADD +1   TO WS-ONAME-SUB                         08820090
088300                 SET PS-LNAME-DONE TO TRUE                        08830090
088400             ELSE                                                 08840090
088500                 MOVE ' ' TO WS-ONAME-BYTE (WS-ONAME-SUB)         08850090
088600                 ADD +1   TO WS-ONAME-SUB                         08860090
088700             END-IF                                               08870090
088800         END-IF                                                   08880090
088900     END-IF.                                                      08890090
089000                                                                  08900090
089100*----------------------------------------------------------------*08910090
089200 4533-MOVE-FIRST-NAME.                                            08920090
089300                                                                  08930090
089400     ADD +1 TO WS-FNAME-SUB                                       08940090
089500               WS-FNAME-SUB-2.                                    08950090
089600                                                                  08960090
089700*CHECK FNAME FIELD LENGTH.                                        08970090
089800     IF WS-FNAME-SUB > 12                                         08980090
089900         SET PS-FNAME-DONE TO TRUE                                08990090
090000     ELSE                                                         09000090
090100*MOVE FNAME FIELD CHARACTER.                                      09010090
090200     IF WS-FNAME-BYTE (WS-FNAME-SUB) > SPACES                     09020090
090300         MOVE WS-FNAME-BYTE (WS-FNAME-SUB)                        09030090
090400           TO WS-ONAME-BYTE (WS-ONAME-SUB)                        09040090
090500         ADD +1 TO WS-ONAME-SUB                                   09050090
090600     ELSE                                                         09060090
090700*IF TWO CONTIGUOUS SPACES FOUND, ASSUME DONE WITH FIRST NAME.     09070090
090800     IF WS-FNAME-BYTE (WS-FNAME-SUB) = SPACES                     09080090
090900       AND WS-FNAME-BYTE (WS-FNAME-SUB-2) = SPACES                09090090
091000         MOVE ' ' TO WS-ONAME-BYTE (WS-ONAME-SUB)                 09100090
091100         ADD +1   TO WS-ONAME-SUB                                 09110090
091200*DISPLACE MIDDLE INITIAL, IF PRESENT.                             09120090
091300         MOVE WORKER-MID-INIT-NAME                                09130090
091400                  TO WS-ONAME-BYTE (WS-ONAME-SUB)                 09140090
091500         SET PS-FNAME-DONE TO TRUE                                09150090
091600     END-IF                                                       09160090
091700     END-IF                                                       09170090
091800     END-IF.                                                      09180090
091900                                                                  09190090
092000*----------------------------------------------------------------*09200089
092100* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *09210089
092200*----------------------------------------------------------------*09220089
092300 9100-READ-SEL-QUEUE.                                             09230089
092400                                                                  09240089
092500     EXEC CICS                                                    09250089
092600         READQ TS                                                 09260089
092700             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        09270089
092800             INTO  (CE003-SELECT-RECORD)                          09280089
092900             ITEM  (ASC-SEL-ITEM)                                 09290089
093000             RESP  (PV-CICS-RESP)                                 09300089
093100     END-EXEC.                                                    09310089
093200     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        09320089
093300         CONTINUE                                                 09330089
093400     ELSE                                                         09340089
093500         SET DP013-LOGIC-ABEND                                    09350089
093600             DP013-NO-ROLLBACK   TO   TRUE                        09360089
093700         MOVE '9100-READ-SEL-QUEUE'                               09370089
093800                                 TO   DP013-PARAGRAPH             09380089
093900         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   09390089
094000                                 TO   DP013-MESSAGE-TEXT (1)      09400089
094100         PERFORM DP013-0000-PROCESS-ABEND                         09410089
094200     END-IF.                                                      09420089
094300                                                                  09430089
094400*----------------------------------------------------------------*09440089
094500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *09450089
094600*----------------------------------------------------------------*09460089
094700 9200-REWRITE-SEL-QUEUE.                                          09470089
094800                                                                  09480089
094900     EXEC CICS                                                    09490089
095000          WRITEQ TS                                               09500089
095100              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      09510089
095200              FROM   (CE003-SELECT-RECORD)                        09520089
095300              ITEM   (ASC-SEL-ITEM)                               09530089
095400              RESP   (PV-CICS-RESP)                               09540089
095500              REWRITE                                             09550089
095600     END-EXEC.                                                    09560089
095700                                                                  09570089
095800     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   09580089
095900         SET DP013-CICS-ABEND                                     09590089
096000             DP013-NO-ROLLBACK     TO TRUE                        09600089
096100         MOVE '9200-REWRITE-SEL-QUEUE'                            09610089
096200                                   TO DP013-PARAGRAPH             09620089
096300         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   09630089
096400                                   TO DP013-MESSAGE-TEXT (1)      09640089
096500         PERFORM DP013-0000-PROCESS-ABEND                         09650089
096600     END-IF.                                                      09660089
096700                                                                  09670089
096800*----------------------------------------------------------------*09680089
096900*    ABEND PROCESSOR MODULE                                      *09690089
097000*----------------------------------------------------------------*09700089
097100     COPY DPPD013.                                                09710089
