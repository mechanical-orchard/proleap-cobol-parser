000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             BCKUT017.                                00050000
000600 AUTHOR.                 RICK TULLOCH.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           10-13-20.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*       THIS PROGRAM DOES A MATCH/MERGE OF CANDIDATE EMPLOYEE    *00120003
001300*  TERMINATIONS AND FUSION KEY CONTACT RECORDS TO PREPARE A      *00130003
001310*  FUSION ACCOUNT DELETION CSV FILE.  TERMINATIONS THAT DO NOT   *00131003
001311*  HAVE A CURRENT DEFINITION IN FUSION WILL BE DISPLAYED AND     *00131103
001312*  DISCARDED.  THE CSV FILE WILL MERGE IN THE FUSION ID          *00131203
001313*  (DATALESS KEY TO FF__KEY_CONTACT__C) TO ALLOW ACCOUNT         *00131303
001314*  DELETION IN A DELETE BEAN BY THE SALESFORCE DATA LOADER.      *00131403
001320*                                                                *00132000
001400*       EACH FILE MUST BE SORTED BY ASCENDING EMPLOYEE ID.       *00140000
001600******************************************************************00160000
001700                                                                  00170000
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000******************************************************************00200000
002100                                                                  00210000
002200 CONFIGURATION SECTION.                                           00220000
002300                                                                  00230000
002400 SOURCE-COMPUTER.        IBM-3090.                                00240000
002500 OBJECT-COMPUTER.        IBM-3090.                                00250000
002600                                                                  00260000
002700 INPUT-OUTPUT SECTION.                                            00270000
002800                                                                  00280000
002900 FILE-CONTROL.                                                    00290000
003000                                                                  00300000
003100     SELECT EMPLOYEE-TERMS-FILE                                   00310000
003200         ASSIGN TO INP01.                                         00320000
003300                                                                  00330000
003400     SELECT FUSION-DETAIL-FILE                                    00340000
003500         ASSIGN TO INP02.                                         00350000
003600                                                                  00360000
003700     SELECT ACCOUNT-DELETE-CSV-FILE                               00370000
003800         ASSIGN TO OUT01.                                         00380000
003900                                                                  00390000
004000******************************************************************00400000
004100 DATA DIVISION.                                                   00410000
004200******************************************************************00420000
004300                                                                  00430000
004400 FILE SECTION.                                                    00440000
004500                                                                  00450000
004600 FD  EMPLOYEE-TERMS-FILE                                          00460004
004700     RECORDING MODE IS F                                          00470000
004800     LABEL RECORDS ARE STANDARD                                   00480000
004900     BLOCK CONTAINS 0 RECORDS                                     00490000
005000     RECORD CONTAINS 7 CHARACTERS                                 00500000
005100     DATA RECORDS IS ET-EMPLOYEE-TERMS-RECORD.                    00510000
005200                                                                  00520000
005300 01  ET-EMPLOYEE-TERMS-RECORD    PIC X(7).                        00530000
005400                                                                  00540000
005500 FD  FUSION-DETAIL-FILE                                           00550000
005600     RECORDING MODE IS F                                          00560000
005700     LABEL RECORDS ARE STANDARD                                   00570000
005800     BLOCK CONTAINS 0 RECORDS                                     00580000
005900     RECORD CONTAINS 37 CHARACTERS                                00590000
006000     DATA RECORDS IS FD-FUSION-DETAIL-RECORD.                     00600000
006100                                                                  00610000
006200 01  FD-FUSION-DETAIL-RECORD     PIC X(37).                       00620000
006300                                                                  00630000
006400 FD  ACCOUNT-DELETE-CSV-FILE                                      00640000
006500     RECORDING MODE IS V                                          00650006
006600     LABEL RECORDS ARE STANDARD                                   00660000
006700     BLOCK CONTAINS 0 RECORDS                                     00670000
006800     RECORD CONTAINS 1 TO 42 CHARACTERS                           00680006
006900     DATA RECORDS ARE AD-ACCOUNT-DELETE-CSV-RECORD                00690006
006910                      AD-ACCOUNT-DELETE-CSV-RECORD-V.             00691006
007000                                                                  00700000
007100 01  AD-ACCOUNT-DELETE-CSV-RECORD                                 00710000
007200                                 PIC X(42).                       00720005
007210 01  AD-ACCOUNT-DELETE-CSV-RECORD-V.                              00721007
007220     05  FILLER                   PIC X(1)                        00722006
007230                                  OCCURS 1 TO 42 TIMES            00723006
007240                                  DEPENDING ON                    00724006
007250                                      PV-CSV-RECORD-LENGTH.       00725006
007300                                                                  00730000
007400 WORKING-STORAGE SECTION.                                         00740000
007500                                                                  00750000
007600 01  ABEND-CODE                  PIC S9(04)   VALUE ZERO          00760000
007700                                              COMP SYNC.          00770000
007800     88  AC-FILE-SEQUENCE-ERROR               VALUE +4007.        00780000
007900                                                                  00790000
008000 01  PS-PROGRAM-SWITCHES.                                         00800000
008100     05  PS-END-OF-TERMS-FILE-SW PIC X(1)     VALUE 'N'.          00810000
008300         88  PS-END-OF-TERMS-FILE             VALUE 'Y'.          00830000
008400     05  PS-END-OF-FUSION-FILE-SW                                 00840000
008500                                 PIC X(1)     VALUE 'N'.          00850000
008600         88  PS-END-OF-FUSION-FILE            VALUE 'Y'.          00860000
008700                                                                  00870000
008720 01  PC-PROGRAM-CONSTANTS.                                        00872001
008730     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'BCKUT017'.   00873001
008731     05  PC-DOUBLE-QUOTE         PIC X(1)     VALUE '"'.          00873103
008732     05  PC-COMMA                PIC X(1)     VALUE ','.          00873203
008740                                                                  00874001
008800 01  PV-PROGRAM-VARIABLES.                                        00880000
008900     05  PV-CURR-TF-EMPLOYEE-ID  PIC X(7)     VALUE SPACES.       00890000
009000         88  PV-CURR-TF-EOF-EMPLOYEE-ID       VALUE HIGH-VALUES.  00900000
009200     05  PV-CURR-FF-EMPLOYEE-ID  PIC X(7)     VALUE SPACES.       00920000
009300         88  PV-CURR-FF-EOF-EMPLOYEE-ID       VALUE HIGH-VALUES.  00930000
009400     05  PV-ACCOUNT-DELETE-RECORD                                 00940001
009500                                 PIC X(42)    VALUE SPACES.       00950005
009600     05  PV-CSV-RECORD-LENGTH    PIC S9(04)   VALUE ZEROS         00960006
009700                                              COMP SYNC.          00970006
013410                                                                  01341001
013420 01  TR-TERMS-RECORD.                                             01342001
013430     05  TR-EMPLOYEE-ID          PIC X(7)     VALUE SPACES.       01343001
013440                                                                  01344001
013450 01  FR-FUSION-RECORD.                                            01345001
013460     05  FR-EMPLOYEE-ID          PIC X(7)     VALUE SPACES.       01346001
013470     05  FR-FUSION-ID            PIC X(30)    VALUE SPACES.       01347001
013471                                                                  01347101
013480 01  AD-ACCOUNT-DELETE-HEADER.                                    01348001
013490     05  FILLER                  PIC X(4)     VALUE '"ID"'.       01349001
013491     05  FILLER                  PIC X(1)     VALUE ','.          01349104
013492     05  FILLER                  PIC X(9)     VALUE '"EMP NBR"'.  01349201
013500                                                                  01350000
013600 01  PT-PROGRAM-TOTALS.                                           01360000
013700     05  PT-TERMS-RCDS-READ      PIC S9(7)    VALUE ZEROS         01370000
013800                                              COMP-3.             01380000
013900     05  PT-FUSION-RCDS-READ     PIC S9(7)    VALUE ZEROS         01390000
014000                                              COMP-3.             01400000
014100     05  PT-TERMS-WO-FUSION-RECORD                                01410003
014200                                 PIC S9(7)    VALUE ZEROS         01420000
014300                                              COMP-3.             01430000
014700     05  PT-DELETE-CSV-RCDS-WRITTEN                               01470001
014710                                 PIC S9(7)    VALUE ZEROS         01471000
014800                                              COMP-3.             01480000
014900                                                                  01490000
015000 01  TD-TOTAL-DISPLAY-MESSAGE.                                    01500000
015100     05  TD-TOTAL-ID             PIC X(51)    VALUE SPACES.       01510000
015200         88  TD-TERMS-RCDS-READ-ID            VALUE               01520000
015300             'EMPLOYEE TERMS RECORDS READ  . . . . . . . . . . .'.01530000
015400         88  TD-FUSION-RCDS-READ-ID           VALUE               01540000
015500             'FUSION DETAIL RECORDS READ . . . . . . . . . . . .'.01550000
015800         88  TD-TERMS-WO-FUSION-RECORD-ID     VALUE               01580003
015900             'EMPLOYEE TERMS RECORDS W/O FUSION RECORD . . . . .'.01590003
016000         88  TD-DELETE-CSV-RCDS-WRITTEN-ID    VALUE               01600001
016100             'ACCOUNT DELETE CSV RECORDS WRITTEN . . . . . . . .'.01610000
016200     05  TD-TOTAL-AMOUNT         PIC Z,ZZZ,ZZ9                    01620000
016300                                              VALUE ZEROS.        01630000
016400                                                                  01640000
016500******************************************************************01650000
016600 PROCEDURE DIVISION.                                              01660000
016700******************************************************************01670000
016800                                                                  01680000
016900 0000-MAINLINE.                                                   01690000
017000                                                                  01700000
017100     PERFORM 1000-INITIALIZE.                                     01710000
017200                                                                  01720000
017300     PERFORM 2000-PROCESS-EMPLOYEE                                01730002
017400         UNTIL ((PS-END-OF-TERMS-FILE)                            01740002
017500                 AND (PS-END-OF-FUSION-FILE)).                    01750002
017600                                                                  01760000
017700     PERFORM 1500-DISPLAY-PROGRAM-TOTALS.                         01770000
017701                                                                  01770100
017710     PERFORM 9000-EOJ-ROUTINE.                                    01771000
017800                                                                  01780000
017900     GOBACK.                                                      01790000
018000                                                                  01800000
018100******************************************************************01810000
018200*  INITIALIZE FOR PROGRAM PROCESSING.  OPEN ALL FILES,           *01820000
018300*  WRITE AN ACCOUNT DELETE CSV HEADER, AND PERFORM A PRIMING     *01830002
018400*  READ ON BOTH FILES.                                           *01840002
018700******************************************************************01870000
018800                                                                  01880000
018900 1000-INITIALIZE.                                                 01890000
019000     OPEN INPUT EMPLOYEE-TERMS-FILE                               01900000
019100                FUSION-DETAIL-FILE                                01910000
019200          OUTPUT ACCOUNT-DELETE-CSV-FILE.                         01920000
019300                                                                  01930000
019400     INITIALIZE TR-TERMS-RECORD                                   01940000
019500                FR-FUSION-RECORD.                                 01950000
021800                                                                  02180000
021810     MOVE AD-ACCOUNT-DELETE-HEADER TO PV-ACCOUNT-DELETE-RECORD.   02181001
021811     MOVE LENGTH OF AD-ACCOUNT-DELETE-HEADER TO                   02181111
021820               PV-CSV-RECORD-LENGTH.                              02182011
022110     PERFORM 8000-WRITE-DELETE-CSV-RECORD.                        02211001
022120                                                                  02212001
022130     PERFORM 7000-READ-TERMS-FILE.                                02213001
022140     PERFORM 7100-READ-FUSION-FILE.                               02214001
022400*1000-EXIT.                                                       02240000
022500                                                                  02250000
022600******************************************************************02260000
022700*  DISPLAY SUMMARY TOTALS OF I/O ACTIVITY.                       *02270000
022800******************************************************************02280000
022900                                                                  02290000
023000 1500-DISPLAY-PROGRAM-TOTALS.                                     02300000
023100     SET TD-TERMS-RCDS-READ-ID TO TRUE.                           02310001
023200     MOVE PT-TERMS-RCDS-READ TO TD-TOTAL-AMOUNT.                  02320001
023300     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       02330000
023400               TD-TOTAL-DISPLAY-MESSAGE.                          02340000
023500                                                                  02350000
023600     SET TD-FUSION-RCDS-READ-ID TO TRUE.                          02360001
023700     MOVE PT-FUSION-RCDS-READ TO TD-TOTAL-AMOUNT.                 02370001
023800     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       02380000
023900               TD-TOTAL-DISPLAY-MESSAGE.                          02390000
024000                                                                  02400000
024100     SET TD-TERMS-WO-FUSION-RECORD-ID TO TRUE.                    02410003
024200     MOVE PT-TERMS-WO-FUSION-RECORD TO TD-TOTAL-AMOUNT.           02420003
024300     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       02430000
024310               TD-TOTAL-DISPLAY-MESSAGE.                          02431000
024800                                                                  02480000
024900     SET TD-DELETE-CSV-RCDS-WRITTEN-ID TO TRUE.                   02490001
025000     MOVE PT-DELETE-CSV-RCDS-WRITTEN TO TD-TOTAL-AMOUNT.          02500001
025100     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       02510000
025200               TD-TOTAL-DISPLAY-MESSAGE.                          02520000
025300*1500-EXIT.                                                       02530000
025400                                                                  02540000
025500******************************************************************02550000
025600*  PROCESS AN EMPLOYEE.  WHEN THERE IS A MATCHING FUSION RECORD  *02560003
025610*  FOR A CANDIDATE EMPLOYEE TERMINATION, MERGE IN THE FUSION ID, *02561003
025620*  AND CREATE AND WRITE AN ACCOUNT DELETE CSV RECORD.  WHEN      *02562003
025630*  THERE IS NO MATCHING FUSION RECORD FOR A CANDIDATE EMPLOYEE   *02563003
025640*  TERMINATION, DISPLAY THE UNMATCHED DETAIL AND DISCARD         *02564003
025650*  PROCESSING THE EMPLOYEE TERMINATION.                          *02565003
025700******************************************************************02570000
025800                                                                  02580000
025900 2000-PROCESS-EMPLOYEE.                                           02590002
026000     EVALUATE TRUE                                                02600000
026100         WHEN (PV-CURR-TF-EMPLOYEE-ID = PV-CURR-FF-EMPLOYEE-ID)   02610003
026200             INITIALIZE PV-ACCOUNT-DELETE-RECORD                  02620003
026201                        PV-CSV-RECORD-LENGTH                      02620111
026210             STRING PC-DOUBLE-QUOTE           DELIMITED BY SIZE   02621003
026220                    FR-FUSION-ID              DELIMITED BY SPACES 02622003
026221                    PC-DOUBLE-QUOTE           DELIMITED BY SIZE   02622103
026222                    PC-COMMA                  DELIMITED BY SIZE   02622203
026223                    PC-DOUBLE-QUOTE           DELIMITED BY SIZE   02622303
026224                    FR-EMPLOYEE-ID            DELIMITED BY SIZE   02622403
026225                    PC-DOUBLE-QUOTE           DELIMITED BY SIZE   02622503
026226                 INTO PV-ACCOUNT-DELETE-RECORD                    02622603
026228             INSPECT PV-ACCOUNT-DELETE-RECORD                     02622811
026229                 TALLYING PV-CSV-RECORD-LENGTH                    02622911
026230                 FOR CHARACTERS BEFORE INITIAL SPACE              02623011
026240             PERFORM 8000-WRITE-DELETE-CSV-RECORD                 02624003
026500             PERFORM 7000-READ-TERMS-FILE                         02650003
026600             PERFORM 7100-READ-FUSION-FILE                        02660003
026700         WHEN (PV-CURR-TF-EMPLOYEE-ID < PV-CURR-FF-EMPLOYEE-ID)   02670003
026800*                                                                 02680000
026900* AN EMPLOYEE TERMINATION WAS FOUND WITH A MATCHING FUSION RECORD 02690003
027000*                                                                 02700000
027010             DISPLAY PC-CURRENT-PROGRAM-NAME  ' - NO FUSION '     02701003
027020                       'RECORD FOUND FOR TERMED EMPLOYEE '        02702003
027030                       PV-CURR-FF-EMPLOYEE-ID '; RECORD NOT '     02703003
027040                       'WRITTEN TO CSV FILE'                      02704003
027100             ADD +1 TO PT-TERMS-WO-FUSION-RECORD                  02710003
027500             PERFORM 7000-READ-TERMS-FILE                         02750003
027600         WHEN OTHER                                               02760000
028100             PERFORM 7100-READ-FUSION-FILE                        02810003
028200     END-EVALUATE.                                                02820000
028300*2000-EXIT.                                                       02830000
028400                                                                  02840000
028500******************************************************************02850000
028600*  READ AN EMPLOYEE TERMINATIONS RECORD, AND ACCUMULATE I/O      *02860003
028610*  TOTALS.                                                       *02861003
028700******************************************************************02870000
028800                                                                  02880000
028900 7000-READ-TERMS-FILE.                                            02890001
029000     READ EMPLOYEE-TERMS-FILE                                     02900001
029100         INTO TR-TERMS-RECORD                                     02910001
029200         AT END                                                   02920000
029300             SET PS-END-OF-TERMS-FILE TO TRUE                     02930001
029400             SET PV-CURR-TF-EOF-EMPLOYEE-ID TO TRUE               02940001
029500     END-READ.                                                    02950000
029600                                                                  02960000
029700     IF (NOT PS-END-OF-TERMS-FILE)                                02970001
029800         ADD +1 TO PT-TERMS-RCDS-READ                             02980001
029900         MOVE TR-EMPLOYEE-ID TO PV-CURR-TF-EMPLOYEE-ID            02990001
030000     END-IF.                                                      03000000
030100*7000-EXIT.                                                       03010000
030200                                                                  03020000
030300******************************************************************03030000
030400*  READ A FUSION DETAIL RECORD, AND ACCUMULATE I/O TOTALS.       *03040001
030500******************************************************************03050000
030600                                                                  03060000
030700 7100-READ-FUSION-FILE.                                           03070001
030800     READ FUSION-DETAIL-FILE                                      03080001
030900         INTO FR-FUSION-RECORD                                    03090001
031000         AT END                                                   03100000
031100             SET PS-END-OF-FUSION-FILE TO TRUE                    03110001
031200             SET PV-CURR-FF-EOF-EMPLOYEE-ID TO TRUE               03120001
031300     END-READ.                                                    03130000
031400                                                                  03140000
031500     IF (NOT PS-END-OF-FUSION-FILE)                               03150001
031600         ADD +1 TO PT-FUSION-RCDS-READ                            03160001
031700         MOVE FR-EMPLOYEE-ID TO PV-CURR-FF-EMPLOYEE-ID            03170001
031800     END-IF.                                                      03180000
031900*7100-EXIT.                                                       03190000
032000                                                                  03200000
033040******************************************************************03304001
033050*  WRITE AN ACCOUNT DELETE CSV RECORD, AND ACCUMULATE I/O TOTALS.*03305011
033070******************************************************************03307001
033080                                                                  03308001
033090 8000-WRITE-DELETE-CSV-RECORD.                                    03309001
033098     WRITE AD-ACCOUNT-DELETE-CSV-RECORD-V                         03309810
033099         FROM PV-ACCOUNT-DELETE-RECORD.                           03309901
033100                                                                  03310001
033101     ADD +1 TO PT-DELETE-CSV-RCDS-WRITTEN.                        03310101
033102*8000-EXIT.                                                       03310201
033110                                                                  03311000
033200******************************************************************03320000
033300*  CLOSE ALL FILES.                                              *03330000
033400******************************************************************03340000
033500                                                                  03350000
033600 9000-EOJ-ROUTINE.                                                03360000
033700     CLOSE EMPLOYEE-TERMS-FILE                                    03370000
033800           FUSION-DETAIL-FILE                                     03380001
033900           ACCOUNT-DELETE-CSV-FILE.                               03390001
034000*9000-EXIT.                                                       03400000
